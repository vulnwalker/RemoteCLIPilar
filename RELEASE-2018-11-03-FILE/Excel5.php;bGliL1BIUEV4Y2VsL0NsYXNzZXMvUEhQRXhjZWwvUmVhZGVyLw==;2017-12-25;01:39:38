{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Reader\/Excel5.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KICAgIGRlZmluZSgnUEhQRVhDRUxfUk9PVCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8uLi8uLi8nKTsKICAgIHJlcXVpcmUoUEhQRVhDRUxfUk9PVCAuICdQSFBFeGNlbC9BdXRvbG9hZGVyLnBocCcpOwp9CgovKioKICogUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKICogdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBCiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDUKICogQGNvcHlyaWdodCAgQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbCAoaHR0cDovL3d3dy5jb2RlcGxleC5jb20vUEhQRXhjZWwpCiAqIEBsaWNlbnNlICAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9vbGQtbGljZW5zZXMvbGdwbC0yLjEudHh0ICAgIExHUEwKICogQHZlcnNpb24gICAgIyNWRVJTSU9OIyMsICMjREFURSMjCiAqLwoKLy8gT3JpZ2luYWwgZmlsZSBoZWFkZXIgb2YgUGFyc2VYTCAodXNlZCBhcyB0aGUgYmFzZSBmb3IgdGhpcyBjbGFzcyk6Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEFkYXB0ZWQgZnJvbSBFeGNlbF9TcHJlYWRzaGVldF9SZWFkZXIgZGV2ZWxvcGVkIGJ5IHVzZXJzIGJpem9uMTUzLAovLyB0cmV4MDA1LCBhbmQgbW1wMTEgKFNvdXJjZUZvcmdlLm5ldCkKLy8gaHR0cDovL3NvdXJjZWZvcmdlLm5ldC9wcm9qZWN0cy9waHBleGNlbHJlYWRlci8KLy8gUHJpbWFyeSBjaGFuZ2VzIG1hZGUgYnkgY2FueW9uY2FzYSAoZHZjKSBmb3IgUGFyc2VYTCAxLjAwIC4uLgovLyAgICAgTW9kZWxsZWQgbW9yZXNvIGFmdGVyIFBlcmwgRXhjZWwgUGFyc2UvV3JpdGUgbW9kdWxlcwovLyAgICAgQWRkZWQgUGFyc2VfRXhjZWxfU3ByZWFkc2hlZXQgb2JqZWN0Ci8vICAgICAgICAgUmVhZHMgYSB3aG9sZSB3b3Jrc2hlZXQgb3IgdGFiIGFzIHJvdyxjb2x1bW4gYXJyYXkgb3IgYXMKLy8gICAgICAgICBhc3NvY2lhdGVkIGhhc2ggb2YgaW5kZXhlZCByb3dzIGFuZCBuYW1lZCBjb2x1bW4gZmllbGRzCi8vICAgICBBZGRlZCB2YXJpYWJsZXMgZm9yIHdvcmtzaGVldCAodGFiKSBpbmRleGVzIGFuZCBuYW1lcwovLyAgICAgQWRkZWQgYW4gb2JqZWN0IGNhbGwgZm9yIGxvYWRpbmcgaW5kaXZpZHVhbCB3b29ya3NoZWV0cwovLyAgICAgQ2hhbmdlZCBkZWZhdWx0IGluZGV4aW5nIGRlZmF1bHRzIHRvIDAgYmFzZWQgYXJyYXlzCi8vICAgICBGaXhlZCBkYXRlL3RpbWUgYW5kIHBlcmNlbnQgZm9ybWF0cwovLyAgICAgSW5jbHVkZXMgcGF0Y2hlcyBmb3VuZCBhdCBTb3VyY2VGb3JnZS4uLgovLyAgICAgICAgIHVuaWNvZGUgcGF0Y2ggYnkgbm9ib2R5Ci8vICAgICAgICAgdW5wYWNrKCJkIikgbWFjaGluZSBkZXBlZGVuY3kgcGF0Y2ggYnkgbWF0Y2h5Ci8vICAgICAgICAgYm91bmRzaGVldCB1dGYxNiBwYXRjaCBieSBiamFlbmljaGVuCi8vICAgICBSZW5hbWVkIGZ1bmN0aW9ucyBmb3Igc2hvcnRlciBuYW1lcwovLyAgICAgR2VuZXJhbCBjb2RlIGNsZWFudXAgYW5kIHJpZ29yLCBpbmNsdWRpbmcgPDgwIGNvbHVtbiB3aWR0aAovLyAgICAgSW5jbHVkZWQgYSB0ZXN0Y2FzZSBFeGNlbCBmaWxlIGFuZCBQSFAgZXhhbXBsZSBjYWxscwovLyAgICAgQ29kZSB3b3JrcyBmb3IgUEhQIDUueAoKLy8gUHJpbWFyeSBjaGFuZ2VzIG1hZGUgYnkgY2FueW9uY2FzYSAoZHZjKSBmb3IgUGFyc2VYTCAxLjEwIC4uLgovLyBodHRwOi8vc291cmNlZm9yZ2UubmV0L3RyYWNrZXIvaW5kZXgucGhwP2Z1bmM9ZGV0YWlsJmFpZD0xNDY2OTY0Jmdyb3VwX2lkPTk5MTYwJmF0aWQ9NjIzMzM0Ci8vICAgICBEZWNvZGluZyBvZiBmb3JtdWxhIGNvbmRpdGlvbnMsIHJlc3VsdHMsIGFuZCB0b2tlbnMuCi8vICAgICBTdXBwb3J0IGZvciB1c2VyLWRlZmluZWQgbmFtZWQgY2VsbHMgYWRkZWQgYXMgYW4gYXJyYXkgIm5hbWVkY2VsbHMiCi8vICAgICAgICAgUGF0Y2ggY29kZSBmb3IgdXNlci1kZWZpbmVkIG5hbWVkIGNlbGxzIHN1cHBvcnRzIHNpbmdsZSBjZWxscyBvbmx5LgovLyAgICAgICAgIE5PVEU6IHRoaXMgcGF0Y2ggb25seSB3b3JrcyBmb3IgQklGRjggYXMgQklGRjUtNyB1c2UgYSBkaWZmZXJlbnQKLy8gICAgICAgICBleHRlcm5hbCBzaGVldCByZWZlcmVuY2Ugc3RydWN0dXJlCmNsYXNzIFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDUgZXh0ZW5kcyBQSFBFeGNlbF9SZWFkZXJfQWJzdHJhY3QgaW1wbGVtZW50cyBQSFBFeGNlbF9SZWFkZXJfSVJlYWRlcgp7CiAgICAvLyBQYXJzZVhMIGRlZmluaXRpb25zCiAgICBjb25zdCBYTFNfQklGRjggICAgICAgICAgICAgICAgICAgICA9IDB4MDYwMDsKICAgIGNvbnN0IFhMU19CSUZGNyAgICAgICAgICAgICAgICAgICAgID0gMHgwNTAwOwogICAgY29uc3QgWExTX1dvcmtib29rR2xvYmFscyAgICAgICAgICAgPSAweDAwMDU7CiAgICBjb25zdCBYTFNfV29ya3NoZWV0ICAgICAgICAgICAgICAgICA9IDB4MDAxMDsKCiAgICAvLyByZWNvcmQgaWRlbnRpZmllcnMKICAgIGNvbnN0IFhMU19UWVBFX0ZPUk1VTEEgICAgICAgICAgICAgID0gMHgwMDA2OwogICAgY29uc3QgWExTX1RZUEVfRU9GICAgICAgICAgICAgICAgICAgPSAweDAwMGE7CiAgICBjb25zdCBYTFNfVFlQRV9QUk9URUNUICAgICAgICAgICAgICA9IDB4MDAxMjsKICAgIGNvbnN0IFhMU19UWVBFX09CSkVDVFBST1RFQ1QgICAgICAgID0gMHgwMDYzOwogICAgY29uc3QgWExTX1RZUEVfU0NFTlBST1RFQ1QgICAgICAgICAgPSAweDAwZGQ7CiAgICBjb25zdCBYTFNfVFlQRV9QQVNTV09SRCAgICAgICAgICAgICA9IDB4MDAxMzsKICAgIGNvbnN0IFhMU19UWVBFX0hFQURFUiAgICAgICAgICAgICAgID0gMHgwMDE0OwogICAgY29uc3QgWExTX1RZUEVfRk9PVEVSICAgICAgICAgICAgICAgPSAweDAwMTU7CiAgICBjb25zdCBYTFNfVFlQRV9FWFRFUk5TSEVFVCAgICAgICAgICA9IDB4MDAxNzsKICAgIGNvbnN0IFhMU19UWVBFX0RFRklORUROQU1FICAgICAgICAgID0gMHgwMDE4OwogICAgY29uc3QgWExTX1RZUEVfVkVSVElDQUxQQUdFQlJFQUtTICAgPSAweDAwMWE7CiAgICBjb25zdCBYTFNfVFlQRV9IT1JJWk9OVEFMUEFHRUJSRUFLUyA9IDB4MDAxYjsKICAgIGNvbnN0IFhMU19UWVBFX05PVEUgICAgICAgICAgICAgICAgID0gMHgwMDFjOwogICAgY29uc3QgWExTX1RZUEVfU0VMRUNUSU9OICAgICAgICAgICAgPSAweDAwMWQ7CiAgICBjb25zdCBYTFNfVFlQRV9EQVRFTU9ERSAgICAgICAgICAgICA9IDB4MDAyMjsKICAgIGNvbnN0IFhMU19UWVBFX0VYVEVSTk5BTUUgICAgICAgICAgID0gMHgwMDIzOwogICAgY29uc3QgWExTX1RZUEVfTEVGVE1BUkdJTiAgICAgICAgICAgPSAweDAwMjY7CiAgICBjb25zdCBYTFNfVFlQRV9SSUdIVE1BUkdJTiAgICAgICAgICA9IDB4MDAyNzsKICAgIGNvbnN0IFhMU19UWVBFX1RPUE1BUkdJTiAgICAgICAgICAgID0gMHgwMDI4OwogICAgY29uc3QgWExTX1RZUEVfQk9UVE9NTUFSR0lOICAgICAgICAgPSAweDAwMjk7CiAgICBjb25zdCBYTFNfVFlQRV9QUklOVEdSSURMSU5FUyAgICAgICA9IDB4MDAyYjsKICAgIGNvbnN0IFhMU19UWVBFX0ZJTEVQQVNTICAgICAgICAgICAgID0gMHgwMDJmOwogICAgY29uc3QgWExTX1RZUEVfRk9OVCAgICAgICAgICAgICAgICAgPSAweDAwMzE7CiAgICBjb25zdCBYTFNfVFlQRV9DT05USU5VRSAgICAgICAgICAgICA9IDB4MDAzYzsKICAgIGNvbnN0IFhMU19UWVBFX1BBTkUgICAgICAgICAgICAgICAgID0gMHgwMDQxOwogICAgY29uc3QgWExTX1RZUEVfQ09ERVBBR0UgICAgICAgICAgICAgPSAweDAwNDI7CiAgICBjb25zdCBYTFNfVFlQRV9ERUZDT0xXSURUSCAgICAgICAgICA9IDB4MDA1NTsKICAgIGNvbnN0IFhMU19UWVBFX09CSiAgICAgICAgICAgICAgICAgID0gMHgwMDVkOwogICAgY29uc3QgWExTX1RZUEVfQ09MSU5GTyAgICAgICAgICAgICAgPSAweDAwN2Q7CiAgICBjb25zdCBYTFNfVFlQRV9JTURBVEEgICAgICAgICAgICAgICA9IDB4MDA3ZjsKICAgIGNvbnN0IFhMU19UWVBFX1NIRUVUUFIgICAgICAgICAgICAgID0gMHgwMDgxOwogICAgY29uc3QgWExTX1RZUEVfSENFTlRFUiAgICAgICAgICAgICAgPSAweDAwODM7CiAgICBjb25zdCBYTFNfVFlQRV9WQ0VOVEVSICAgICAgICAgICAgICA9IDB4MDA4NDsKICAgIGNvbnN0IFhMU19UWVBFX1NIRUVUICAgICAgICAgICAgICAgID0gMHgwMDg1OwogICAgY29uc3QgWExTX1RZUEVfUEFMRVRURSAgICAgICAgICAgICAgPSAweDAwOTI7CiAgICBjb25zdCBYTFNfVFlQRV9TQ0wgICAgICAgICAgICAgICAgICA9IDB4MDBhMDsKICAgIGNvbnN0IFhMU19UWVBFX1BBR0VTRVRVUCAgICAgICAgICAgID0gMHgwMGExOwogICAgY29uc3QgWExTX1RZUEVfTVVMUksgICAgICAgICAgICAgICAgPSAweDAwYmQ7CiAgICBjb25zdCBYTFNfVFlQRV9NVUxCTEFOSyAgICAgICAgICAgICA9IDB4MDBiZTsKICAgIGNvbnN0IFhMU19UWVBFX0RCQ0VMTCAgICAgICAgICAgICAgID0gMHgwMGQ3OwogICAgY29uc3QgWExTX1RZUEVfWEYgICAgICAgICAgICAgICAgICAgPSAweDAwZTA7CiAgICBjb25zdCBYTFNfVFlQRV9NRVJHRURDRUxMUyAgICAgICAgICA9IDB4MDBlNTsKICAgIGNvbnN0IFhMU19UWVBFX01TT0RSQVdJTkdHUk9VUCAgICAgID0gMHgwMGViOwogICAgY29uc3QgWExTX1RZUEVfTVNPRFJBV0lORyAgICAgICAgICAgPSAweDAwZWM7CiAgICBjb25zdCBYTFNfVFlQRV9TU1QgICAgICAgICAgICAgICAgICA9IDB4MDBmYzsKICAgIGNvbnN0IFhMU19UWVBFX0xBQkVMU1NUICAgICAgICAgICAgID0gMHgwMGZkOwogICAgY29uc3QgWExTX1RZUEVfRVhUU1NUICAgICAgICAgICAgICAgPSAweDAwZmY7CiAgICBjb25zdCBYTFNfVFlQRV9FWFRFUk5BTEJPT0sgICAgICAgICA9IDB4MDFhZTsKICAgIGNvbnN0IFhMU19UWVBFX0RBVEFWQUxJREFUSU9OUyAgICAgID0gMHgwMWIyOwogICAgY29uc3QgWExTX1RZUEVfVFhPICAgICAgICAgICAgICAgICAgPSAweDAxYjY7CiAgICBjb25zdCBYTFNfVFlQRV9IWVBFUkxJTksgICAgICAgICAgICA9IDB4MDFiODsKICAgIGNvbnN0IFhMU19UWVBFX0RBVEFWQUxJREFUSU9OICAgICAgID0gMHgwMWJlOwogICAgY29uc3QgWExTX1RZUEVfRElNRU5TSU9OICAgICAgICAgICAgPSAweDAyMDA7CiAgICBjb25zdCBYTFNfVFlQRV9CTEFOSyAgICAgICAgICAgICAgICA9IDB4MDIwMTsKICAgIGNvbnN0IFhMU19UWVBFX05VTUJFUiAgICAgICAgICAgICAgID0gMHgwMjAzOwogICAgY29uc3QgWExTX1RZUEVfTEFCRUwgICAgICAgICAgICAgICAgPSAweDAyMDQ7CiAgICBjb25zdCBYTFNfVFlQRV9CT09MRVJSICAgICAgICAgICAgICA9IDB4MDIwNTsKICAgIGNvbnN0IFhMU19UWVBFX1NUUklORyAgICAgICAgICAgICAgID0gMHgwMjA3OwogICAgY29uc3QgWExTX1RZUEVfUk9XICAgICAgICAgICAgICAgICAgPSAweDAyMDg7CiAgICBjb25zdCBYTFNfVFlQRV9JTkRFWCAgICAgICAgICAgICAgICA9IDB4MDIwYjsKICAgIGNvbnN0IFhMU19UWVBFX0FSUkFZICAgICAgICAgICAgICAgID0gMHgwMjIxOwogICAgY29uc3QgWExTX1RZUEVfREVGQVVMVFJPV0hFSUdIVCAgICAgPSAweDAyMjU7CiAgICBjb25zdCBYTFNfVFlQRV9XSU5ET1cyICAgICAgICAgICAgICA9IDB4MDIzZTsKICAgIGNvbnN0IFhMU19UWVBFX1JLICAgICAgICAgICAgICAgICAgID0gMHgwMjdlOwogICAgY29uc3QgWExTX1RZUEVfU1RZTEUgICAgICAgICAgICAgICAgPSAweDAyOTM7CiAgICBjb25zdCBYTFNfVFlQRV9GT1JNQVQgICAgICAgICAgICAgICA9IDB4MDQxZTsKICAgIGNvbnN0IFhMU19UWVBFX1NIQVJFREZNTEEgICAgICAgICAgID0gMHgwNGJjOwogICAgY29uc3QgWExTX1RZUEVfQk9GICAgICAgICAgICAgICAgICAgPSAweDA4MDk7CiAgICBjb25zdCBYTFNfVFlQRV9TSEVFVFBST1RFQ1RJT04gICAgICA9IDB4MDg2NzsKICAgIGNvbnN0IFhMU19UWVBFX1JBTkdFUFJPVEVDVElPTiAgICAgID0gMHgwODY4OwogICAgY29uc3QgWExTX1RZUEVfU0hFRVRMQVlPVVQgICAgICAgICAgPSAweDA4NjI7CiAgICBjb25zdCBYTFNfVFlQRV9YRkVYVCAgICAgICAgICAgICAgICA9IDB4MDg3ZDsKICAgIGNvbnN0IFhMU19UWVBFX1BBR0VMQVlPVVRWSUVXICAgICAgID0gMHgwODhiOwogICAgY29uc3QgWExTX1RZUEVfVU5LTk9XTiAgICAgICAgICAgICAgPSAweGZmZmY7CgogICAgLy8gRW5jcnlwdGlvbiB0eXBlCiAgICBjb25zdCBNU19CSUZGX0NSWVBUT19OT05FICAgICAgICAgICA9IDA7CiAgICBjb25zdCBNU19CSUZGX0NSWVBUT19YT1IgICAgICAgICAgICA9IDE7CiAgICBjb25zdCBNU19CSUZGX0NSWVBUT19SQzQgICAgICAgICAgICA9IDI7CiAgICAKICAgIC8vIFNpemUgb2Ygc3RyZWFtIGJsb2NrcyB3aGVuIHVzaW5nIFJDNCBlbmNyeXB0aW9uCiAgICBjb25zdCBSRUtFWV9CTE9DSyAgICAgICAgICAgICAgICAgICA9IDB4NDAwOwoKICAgIC8qKgogICAgICogU3VtbWFyeSBJbmZvcm1hdGlvbiBzdHJlYW0gZGF0YS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICRzdW1tYXJ5SW5mb3JtYXRpb247CgogICAgLyoqCiAgICAgKiBFeHRlbmRlZCBTdW1tYXJ5IEluZm9ybWF0aW9uIHN0cmVhbSBkYXRhLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByaXZhdGUgJGRvY3VtZW50U3VtbWFyeUluZm9ybWF0aW9uOwoKICAgIC8qKgogICAgICogVXNlci1EZWZpbmVkIFByb3BlcnRpZXMgc3RyZWFtIGRhdGEuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSAkdXNlckRlZmluZWRQcm9wZXJ0aWVzOwoKICAgIC8qKgogICAgICogV29ya2Jvb2sgc3RyZWFtIGRhdGEuIChJbmNsdWRlcyB3b3JrYm9vayBnbG9iYWxzIHN1YnN0cmVhbSBhcyB3ZWxsIGFzIHNoZWV0IHN1YnN0cmVhbXMpCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSAkZGF0YTsKCiAgICAvKioKICAgICAqIFNpemUgaW4gYnl0ZXMgb2YgJHRoaXMtPmRhdGEKICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBwcml2YXRlICRkYXRhU2l6ZTsKCiAgICAvKioKICAgICAqIEN1cnJlbnQgcG9zaXRpb24gaW4gc3RyZWFtCiAgICAgKgogICAgICogQHZhciBpbnRlZ2VyCiAgICAgKi8KICAgIHByaXZhdGUgJHBvczsKCiAgICAvKioKICAgICAqIFdvcmtib29rIHRvIGJlIHJldHVybmVkIGJ5IHRoZSByZWFkZXIuCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbAogICAgICovCiAgICBwcml2YXRlICRwaHBFeGNlbDsKCiAgICAvKioKICAgICAqIFdvcmtzaGVldCB0aGF0IGlzIGN1cnJlbnRseSBiZWluZyBidWlsdCBieSB0aGUgcmVhZGVyLgogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHByaXZhdGUgJHBocFNoZWV0OwoKICAgIC8qKgogICAgICogQklGRiB2ZXJzaW9uCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJpdmF0ZSAkdmVyc2lvbjsKCiAgICAvKioKICAgICAqIENvZGVwYWdlIHNldCBpbiB0aGUgRXhjZWwgZmlsZSBiZWluZyByZWFkLiBPbmx5IGltcG9ydGFudCBmb3IgQklGRjUgKEV4Y2VsIDUuMCAtIEV4Y2VsIDk1KQogICAgICogRm9yIEJJRkY4IChFeGNlbCA5NyAtIEV4Y2VsIDIwMDMpIHRoaXMgd2lsbCBhbHdheXMgaGF2ZSB0aGUgdmFsdWUgJ1VURi0xNkxFJwogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByaXZhdGUgJGNvZGVwYWdlOwoKICAgIC8qKgogICAgICogU2hhcmVkIGZvcm1hdHMKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJGZvcm1hdHM7CgogICAgLyoqCiAgICAgKiBTaGFyZWQgZm9udHMKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJG9iakZvbnRzOwoKICAgIC8qKgogICAgICogQ29sb3IgcGFsZXR0ZQogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkcGFsZXR0ZTsKCiAgICAvKioKICAgICAqIFdvcmtzaGVldHMKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJHNoZWV0czsKCiAgICAvKioKICAgICAqIEV4dGVybmFsIGJvb2tzCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcml2YXRlICRleHRlcm5hbEJvb2tzOwoKICAgIC8qKgogICAgICogUkVGIHN0cnVjdHVyZXMuIE9ubHkgYXBwbGllcyB0byBCSUZGOC4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJHJlZjsKCiAgICAvKioKICAgICAqIEV4dGVybmFsIG5hbWVzCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcml2YXRlICRleHRlcm5hbE5hbWVzOwoKICAgIC8qKgogICAgICogRGVmaW5lZCBuYW1lcwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkZGVmaW5lZG5hbWU7CgogICAgLyoqCiAgICAgKiBTaGFyZWQgc3RyaW5ncy4gT25seSBhcHBsaWVzIHRvIEJJRkY4LgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkc3N0OwoKICAgIC8qKgogICAgICogUGFuZXMgYXJlIGZyb3plbj8gKGluIHNoZWV0IGN1cnJlbnRseSBiZWluZyByZWFkKS4gU2VlIFdJTkRPVzIgcmVjb3JkLgogICAgICoKICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwcml2YXRlICRmcm96ZW47CgogICAgLyoqCiAgICAgKiBGaXQgcHJpbnRvdXQgdG8gbnVtYmVyIG9mIHBhZ2VzPyAoaW4gc2hlZXQgY3VycmVudGx5IGJlaW5nIHJlYWQpLiBTZWUgU0hFRVRQUiByZWNvcmQuCiAgICAgKgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHByaXZhdGUgJGlzRml0VG9QYWdlczsKCiAgICAvKioKICAgICAqIE9iamVjdHMuIE9uZSBPQkogcmVjb3JkIGNvbnRyaWJ1dGVzIHdpdGggb25lIGVudHJ5LgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkb2JqczsKCiAgICAvKioKICAgICAqIFRleHQgT2JqZWN0cy4gT25lIFRYTyByZWNvcmQgY29ycmVzcG9uZHMgd2l0aCBvbmUgZW50cnkuCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcml2YXRlICR0ZXh0T2JqZWN0czsKCiAgICAvKioKICAgICAqIENlbGwgQW5ub3RhdGlvbnMgKEJJRkY4KQogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkY2VsbE5vdGVzOwoKICAgIC8qKgogICAgICogVGhlIGNvbWJpbmVkIE1TT0RSQVdJTkdHUk9VUCBkYXRhCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSAkZHJhd2luZ0dyb3VwRGF0YTsKCiAgICAvKioKICAgICAqIFRoZSBjb21iaW5lZCBNU09EUkFXSU5HIGRhdGEgKHBlciBzaGVldCkKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICRkcmF3aW5nRGF0YTsKCiAgICAvKioKICAgICAqIEtlZXAgdHJhY2sgb2YgWEYgaW5kZXgKICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBwcml2YXRlICR4ZkluZGV4OwoKICAgIC8qKgogICAgICogTWFwcGluZyBvZiBYRiBpbmRleCAodGhhdCBpcyBhIGNlbGwgWEYpIHRvIGZpbmFsIGluZGV4IGluIGNlbGxYZiBjb2xsZWN0aW9uCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcml2YXRlICRtYXBDZWxsWGZJbmRleDsKCiAgICAvKioKICAgICAqIE1hcHBpbmcgb2YgWEYgaW5kZXggKHRoYXQgaXMgYSBzdHlsZSBYRikgdG8gZmluYWwgaW5kZXggaW4gY2VsbFN0eWxlWGYgY29sbGVjdGlvbgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkbWFwQ2VsbFN0eWxlWGZJbmRleDsKCiAgICAvKioKICAgICAqIFRoZSBzaGFyZWQgZm9ybXVsYXMgaW4gYSBzaGVldC4gT25lIFNIQVJFREZNTEEgcmVjb3JkIGNvbnRyaWJ1dGVzIHdpdGggb25lIHZhbHVlLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkc2hhcmVkRm9ybXVsYXM7CgogICAgLyoqCiAgICAgKiBUaGUgc2hhcmVkIGZvcm11bGEgcGFydHMgaW4gYSBzaGVldC4gT25lIEZPUk1VTEEgcmVjb3JkIGNvbnRyaWJ1dGVzIHdpdGggb25lIHZhbHVlIGlmIGl0CiAgICAgKiByZWZlcnMgdG8gYSBzaGFyZWQgZm9ybXVsYS4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJHNoYXJlZEZvcm11bGFQYXJ0czsKCiAgICAvKioKICAgICAqIFRoZSB0eXBlIG9mIGVuY3J5cHRpb24gaW4gdXNlCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJpdmF0ZSAkZW5jcnlwdGlvbiA9IDA7CiAgICAKICAgIC8qKgogICAgICogVGhlIHBvc2l0aW9uIGluIHRoZSBzdHJlYW0gYWZ0ZXIgd2hpY2ggY29udGVudHMgYXJlIGVuY3J5cHRlZAogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHByaXZhdGUgJGVuY3J5cHRpb25TdGFydFBvcyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVGhlIGN1cnJlbnQgUkM0IGRlY3J5cHRpb24gb2JqZWN0CiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X1JDNAogICAgICovCiAgICBwcml2YXRlICRyYzRLZXkgPSBudWxsOwoKICAgIC8qKgogICAgICogVGhlIHBvc2l0aW9uIGluIHRoZSBzdHJlYW0gdGhhdCB0aGUgUkM0IGRlY3J5cHRpb24gb2JqZWN0IHdhcyBsZWZ0IGF0CiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJpdmF0ZSAkcmM0UG9zID0gMDsKCiAgICAvKioKICAgICAqIFRoZSBjdXJyZW50IE1ENSBjb250ZXh0IHN0YXRlCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSAkbWQ1Q3R4dCA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNSBpbnN0YW5jZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKQogICAgewogICAgICAgICR0aGlzLT5yZWFkRmlsdGVyID0gbmV3IFBIUEV4Y2VsX1JlYWRlcl9EZWZhdWx0UmVhZEZpbHRlcigpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FuIHRoZSBjdXJyZW50IFBIUEV4Y2VsX1JlYWRlcl9JUmVhZGVyIHJlYWQgdGhlIGZpbGU\/CiAgICAgKgogICAgICogQHBhcmFtICAgICBzdHJpbmcgICAgICAgICAkcEZpbGVuYW1lCiAgICAgKiBAcmV0dXJuICAgICBib29sZWFuCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNhblJlYWQoJHBGaWxlbmFtZSkKICAgIHsKICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGV4aXN0cwogICAgICAgIGlmICghZmlsZV9leGlzdHMoJHBGaWxlbmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oIkNvdWxkIG5vdCBvcGVuICIgLiAkcEZpbGVuYW1lIC4gIiBmb3IgcmVhZGluZyEgRmlsZSBkb2VzIG5vdCBleGlzdC4iKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIFVzZSBQYXJzZVhMIGZvciB0aGUgaGFyZCB3b3JrLgogICAgICAgICAgICAkb2xlID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9PTEVSZWFkKCk7CgogICAgICAgICAgICAvLyBnZXQgZXhjZWwgZGF0YQogICAgICAgICAgICAkcmVzID0gJG9sZS0+cmVhZCgkcEZpbGVuYW1lKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBjYXRjaCAoUEhQRXhjZWxfRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkcyBuYW1lcyBvZiB0aGUgd29ya3NoZWV0cyBmcm9tIGEgZmlsZSwgd2l0aG91dCBwYXJzaW5nIHRoZSB3aG9sZSBmaWxlIHRvIGEgUEhQRXhjZWwgb2JqZWN0CiAgICAgKgogICAgICogQHBhcmFtICAgICBzdHJpbmcgICAgICAgICAkcEZpbGVuYW1lCiAgICAgKiBAdGhyb3dzICAgICBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBsaXN0V29ya3NoZWV0TmFtZXMoJHBGaWxlbmFtZSkKICAgIHsKICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGV4aXN0cwogICAgICAgIGlmICghZmlsZV9leGlzdHMoJHBGaWxlbmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oIkNvdWxkIG5vdCBvcGVuICIgLiAkcEZpbGVuYW1lIC4gIiBmb3IgcmVhZGluZyEgRmlsZSBkb2VzIG5vdCBleGlzdC4iKTsKICAgICAgICB9CgogICAgICAgICR3b3Jrc2hlZXROYW1lcyA9IGFycmF5KCk7CgogICAgICAgIC8vIFJlYWQgdGhlIE9MRSBmaWxlCiAgICAgICAgJHRoaXMtPmxvYWRPTEUoJHBGaWxlbmFtZSk7CgogICAgICAgIC8vIHRvdGFsIGJ5dGUgc2l6ZSBvZiBFeGNlbCBkYXRhICh3b3JrYm9vayBnbG9iYWwgc3Vic3RyZWFtICsgc2hlZXQgc3Vic3RyZWFtcykKICAgICAgICAkdGhpcy0+ZGF0YVNpemUgPSBzdHJsZW4oJHRoaXMtPmRhdGEpOwoKICAgICAgICAkdGhpcy0+cG9zICAgICAgICA9IDA7CiAgICAgICAgJHRoaXMtPnNoZWV0cyAgICA9IGFycmF5KCk7CgogICAgICAgIC8vIFBhcnNlIFdvcmtib29rIEdsb2JhbCBTdWJzdHJlYW0KICAgICAgICB3aGlsZSAoJHRoaXMtPnBvcyA8ICR0aGlzLT5kYXRhU2l6ZSkgewogICAgICAgICAgICAkY29kZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zKTsKCiAgICAgICAgICAgIHN3aXRjaCAoJGNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQk9GOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkQm9mKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1NIRUVUOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkU2hlZXQoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfRU9GOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIDI7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3JlYWNoICgkdGhpcy0+c2hlZXRzIGFzICRzaGVldCkgewogICAgICAgICAgICBpZiAoJHNoZWV0WydzaGVldFR5cGUnXSAhPSAweDAwKSB7CiAgICAgICAgICAgICAgICAvLyAweDAwOiBXb3Jrc2hlZXQsIDB4MDI6IENoYXJ0LCAweDA2OiBWaXN1YWwgQmFzaWMgbW9kdWxlCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHdvcmtzaGVldE5hbWVzW10gPSAkc2hlZXRbJ25hbWUnXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkd29ya3NoZWV0TmFtZXM7CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJuIHdvcmtzaGVldCBpbmZvIChOYW1lLCBMYXN0IENvbHVtbiBMZXR0ZXIsIExhc3QgQ29sdW1uIEluZGV4LCBUb3RhbCBSb3dzLCBUb3RhbCBDb2x1bW5zKQogICAgICoKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgJHBGaWxlbmFtZQogICAgICogQHRocm93cyAgIFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGxpc3RXb3Jrc2hlZXRJbmZvKCRwRmlsZW5hbWUpCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSBleGlzdHMKICAgICAgICBpZiAoIWZpbGVfZXhpc3RzKCRwRmlsZW5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCJDb3VsZCBub3Qgb3BlbiAiIC4gJHBGaWxlbmFtZSAuICIgZm9yIHJlYWRpbmchIEZpbGUgZG9lcyBub3QgZXhpc3QuIik7CiAgICAgICAgfQoKICAgICAgICAkd29ya3NoZWV0SW5mbyA9IGFycmF5KCk7CgogICAgICAgIC8vIFJlYWQgdGhlIE9MRSBmaWxlCiAgICAgICAgJHRoaXMtPmxvYWRPTEUoJHBGaWxlbmFtZSk7CgogICAgICAgIC8vIHRvdGFsIGJ5dGUgc2l6ZSBvZiBFeGNlbCBkYXRhICh3b3JrYm9vayBnbG9iYWwgc3Vic3RyZWFtICsgc2hlZXQgc3Vic3RyZWFtcykKICAgICAgICAkdGhpcy0+ZGF0YVNpemUgPSBzdHJsZW4oJHRoaXMtPmRhdGEpOwoKICAgICAgICAvLyBpbml0aWFsaXplCiAgICAgICAgJHRoaXMtPnBvcyAgICA9IDA7CiAgICAgICAgJHRoaXMtPnNoZWV0cyA9IGFycmF5KCk7CgogICAgICAgIC8vIFBhcnNlIFdvcmtib29rIEdsb2JhbCBTdWJzdHJlYW0KICAgICAgICB3aGlsZSAoJHRoaXMtPnBvcyA8ICR0aGlzLT5kYXRhU2l6ZSkgewogICAgICAgICAgICAkY29kZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zKTsKCiAgICAgICAgICAgIHN3aXRjaCAoJGNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQk9GOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkQm9mKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1NIRUVUOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkU2hlZXQoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfRU9GOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIDI7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBQYXJzZSB0aGUgaW5kaXZpZHVhbCBzaGVldHMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+c2hlZXRzIGFzICRzaGVldCkgewogICAgICAgICAgICBpZiAoJHNoZWV0WydzaGVldFR5cGUnXSAhPSAweDAwKSB7CiAgICAgICAgICAgICAgICAvLyAweDAwOiBXb3Jrc2hlZXQKICAgICAgICAgICAgICAgIC8vIDB4MDI6IENoYXJ0CiAgICAgICAgICAgICAgICAvLyAweDA2OiBWaXN1YWwgQmFzaWMgbW9kdWxlCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRtcEluZm8gPSBhcnJheSgpOwogICAgICAgICAgICAkdG1wSW5mb1snd29ya3NoZWV0TmFtZSddID0gJHNoZWV0WyduYW1lJ107CiAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uTGV0dGVyJ10gPSAnQSc7CiAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uSW5kZXgnXSA9IDA7CiAgICAgICAgICAgICR0bXBJbmZvWyd0b3RhbFJvd3MnXSA9IDA7CiAgICAgICAgICAgICR0bXBJbmZvWyd0b3RhbENvbHVtbnMnXSA9IDA7CgogICAgICAgICAgICAkdGhpcy0+cG9zID0gJHNoZWV0WydvZmZzZXQnXTsKCiAgICAgICAgICAgIHdoaWxlICgkdGhpcy0+cG9zIDw9ICR0aGlzLT5kYXRhU2l6ZSAtIDQpIHsKICAgICAgICAgICAgICAgICRjb2RlID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MpOwoKICAgICAgICAgICAgICAgIHN3aXRjaCAoJGNvZGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1JLOgogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfTEFCRUxTU1Q6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9OVU1CRVI6CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9GT1JNVUxBOgogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQk9PTEVSUjoKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0xBQkVMOgogICAgICAgICAgICAgICAgICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRyb3dJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5JbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICR0bXBJbmZvWyd0b3RhbFJvd3MnXSA9IG1heCgkdG1wSW5mb1sndG90YWxSb3dzJ10sICRyb3dJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uSW5kZXgnXSA9IG1heCgkdG1wSW5mb1snbGFzdENvbHVtbkluZGV4J10sICRjb2x1bW5JbmRleCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQk9GOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZEJvZigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0VPRjoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIDI7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkdG1wSW5mb1snbGFzdENvbHVtbkxldHRlciddID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCR0bXBJbmZvWydsYXN0Q29sdW1uSW5kZXgnXSk7CiAgICAgICAgICAgICR0bXBJbmZvWyd0b3RhbENvbHVtbnMnXSA9ICR0bXBJbmZvWydsYXN0Q29sdW1uSW5kZXgnXSArIDE7CgogICAgICAgICAgICAkd29ya3NoZWV0SW5mb1tdID0gJHRtcEluZm87CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHdvcmtzaGVldEluZm87CiAgICB9CgoKICAgIC8qKgogICAgICogTG9hZHMgUEhQRXhjZWwgZnJvbSBmaWxlCiAgICAgKgogICAgICogQHBhcmFtICAgICBzdHJpbmcgICAgICAgICAkcEZpbGVuYW1lCiAgICAgKiBAcmV0dXJuICAgICBQSFBFeGNlbAogICAgICogQHRocm93cyAgICAgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbG9hZCgkcEZpbGVuYW1lKQogICAgewogICAgICAgIC8vIFJlYWQgdGhlIE9MRSBmaWxlCiAgICAgICAgJHRoaXMtPmxvYWRPTEUoJHBGaWxlbmFtZSk7CgogICAgICAgIC8vIEluaXRpYWxpc2F0aW9ucwogICAgICAgICR0aGlzLT5waHBFeGNlbCA9IG5ldyBQSFBFeGNlbDsKICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPnJlbW92ZVNoZWV0QnlJbmRleCgwKTsgLy8gcmVtb3ZlIDFzdCBzaGVldAogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPnJlbW92ZUNlbGxTdHlsZVhmQnlJbmRleCgwKTsgLy8gcmVtb3ZlIHRoZSBkZWZhdWx0IHN0eWxlCiAgICAgICAgICAgICR0aGlzLT5waHBFeGNlbC0+cmVtb3ZlQ2VsbFhmQnlJbmRleCgwKTsgLy8gcmVtb3ZlIHRoZSBkZWZhdWx0IHN0eWxlCiAgICAgICAgfQoKICAgICAgICAvLyBSZWFkIHRoZSBzdW1tYXJ5IGluZm9ybWF0aW9uIHN0cmVhbSAoY29udGFpbmluZyBtZXRhIGRhdGEpCiAgICAgICAgJHRoaXMtPnJlYWRTdW1tYXJ5SW5mb3JtYXRpb24oKTsKCiAgICAgICAgLy8gUmVhZCB0aGUgQWRkaXRpb25hbCBkb2N1bWVudCBzdW1tYXJ5IGluZm9ybWF0aW9uIHN0cmVhbSAoY29udGFpbmluZyBhcHBsaWNhdGlvbi1zcGVjaWZpYyBtZXRhIGRhdGEpCiAgICAgICAgJHRoaXMtPnJlYWREb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbigpOwoKICAgICAgICAvLyB0b3RhbCBieXRlIHNpemUgb2YgRXhjZWwgZGF0YSAod29ya2Jvb2sgZ2xvYmFsIHN1YnN0cmVhbSArIHNoZWV0IHN1YnN0cmVhbXMpCiAgICAgICAgJHRoaXMtPmRhdGFTaXplID0gc3RybGVuKCR0aGlzLT5kYXRhKTsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZQogICAgICAgICR0aGlzLT5wb3MgICAgICAgICAgICAgICAgID0gMDsKICAgICAgICAkdGhpcy0+Y29kZXBhZ2UgICAgICAgICAgICA9ICdDUDEyNTInOwogICAgICAgICR0aGlzLT5mb3JtYXRzICAgICAgICAgICAgID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+b2JqRm9udHMgICAgICAgICAgICA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPnBhbGV0dGUgICAgICAgICAgICAgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5zaGVldHMgICAgICAgICAgICAgID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+ZXh0ZXJuYWxCb29rcyAgICAgICA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPnJlZiAgICAgICAgICAgICAgICAgPSBhcnJheSgpOwogICAgICAgICR0aGlzLT5kZWZpbmVkbmFtZSAgICAgICAgID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+c3N0ICAgICAgICAgICAgICAgICA9IGFycmF5KCk7CiAgICAgICAgJHRoaXMtPmRyYXdpbmdHcm91cERhdGEgICAgPSAnJzsKICAgICAgICAkdGhpcy0+eGZJbmRleCAgICAgICAgICAgICA9ICcnOwogICAgICAgICR0aGlzLT5tYXBDZWxsWGZJbmRleCAgICAgID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+bWFwQ2VsbFN0eWxlWGZJbmRleCA9IGFycmF5KCk7CgogICAgICAgIC8vIFBhcnNlIFdvcmtib29rIEdsb2JhbCBTdWJzdHJlYW0KICAgICAgICB3aGlsZSAoJHRoaXMtPnBvcyA8ICR0aGlzLT5kYXRhU2l6ZSkgewogICAgICAgICAgICAkY29kZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zKTsKCiAgICAgICAgICAgIHN3aXRjaCAoJGNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQk9GOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkQm9mKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0ZJTEVQQVNTOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRmlsZXBhc3MoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQ09ERVBBR0U6CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRDb2RlcGFnZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9EQVRFTU9ERToKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZERhdGVNb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0ZPTlQ6CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRGb250KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0ZPUk1BVDoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZEZvcm1hdCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9YRjoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFhmKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1hGRVhUOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkWGZFeHQoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfU1RZTEU6CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRTdHlsZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9QQUxFVFRFOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkUGFsZXR0ZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9TSEVFVDoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFNoZWV0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0VYVEVSTkFMQk9PSzoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZEV4dGVybmFsQm9vaygpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9FWFRFUk5OQU1FOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRXh0ZXJuTmFtZSgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9FWFRFUk5TSEVFVDoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZEV4dGVyblNoZWV0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0RFRklORUROQU1FOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGVmaW5lZE5hbWUoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfTVNPRFJBV0lOR0dST1VQOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkTXNvRHJhd2luZ0dyb3VwKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1NTVDoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFNzdCgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9FT0Y6CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgMjsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFJlc29sdmUgaW5kZXhlZCBjb2xvcnMgZm9yIGZvbnQsIGZpbGwsIGFuZCBib3JkZXIgY29sb3JzCiAgICAgICAgLy8gQ2Fubm90IGJlIHJlc29sdmVkIGFscmVhZHkgaW4gWEYgcmVjb3JkLCBiZWNhdXNlIFBBTEVUVEUgcmVjb3JkIGNvbWVzIGFmdGVyd2FyZHMKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPm9iakZvbnRzIGFzICRvYmpGb250KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJG9iakZvbnQtPmNvbG9ySW5kZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgJGNvbG9yID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9Db2xvcjo6bWFwKCRvYmpGb250LT5jb2xvckluZGV4LCAkdGhpcy0+cGFsZXR0ZSwgJHRoaXMtPnZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICRvYmpGb250LT5nZXRDb2xvcigpLT5zZXRSR0IoJGNvbG9yWydyZ2InXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT5waHBFeGNlbC0+Z2V0Q2VsbFhmQ29sbGVjdGlvbigpIGFzICRvYmpTdHlsZSkgewogICAgICAgICAgICAgICAgLy8gZmlsbCBzdGFydCBhbmQgZW5kIGNvbG9yCiAgICAgICAgICAgICAgICAkZmlsbCA9ICRvYmpTdHlsZS0+Z2V0RmlsbCgpOwoKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZmlsbC0+c3RhcnRjb2xvckluZGV4KSkgewogICAgICAgICAgICAgICAgICAgICRzdGFydENvbG9yID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9Db2xvcjo6bWFwKCRmaWxsLT5zdGFydGNvbG9ySW5kZXgsICR0aGlzLT5wYWxldHRlLCAkdGhpcy0+dmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAgJGZpbGwtPmdldFN0YXJ0Q29sb3IoKS0+c2V0UkdCKCRzdGFydENvbG9yWydyZ2InXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGZpbGwtPmVuZGNvbG9ySW5kZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgJGVuZENvbG9yID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9Db2xvcjo6bWFwKCRmaWxsLT5lbmRjb2xvckluZGV4LCAkdGhpcy0+cGFsZXR0ZSwgJHRoaXMtPnZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICRmaWxsLT5nZXRFbmRDb2xvcigpLT5zZXRSR0IoJGVuZENvbG9yWydyZ2InXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gYm9yZGVyIGNvbG9ycwogICAgICAgICAgICAgICAgJHRvcCAgICAgID0gJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPmdldFRvcCgpOwogICAgICAgICAgICAgICAgJHJpZ2h0ICAgID0gJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPmdldFJpZ2h0KCk7CiAgICAgICAgICAgICAgICAkYm90dG9tICAgPSAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0Qm90dG9tKCk7CiAgICAgICAgICAgICAgICAkbGVmdCAgICAgPSAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0TGVmdCgpOwogICAgICAgICAgICAgICAgJGRpYWdvbmFsID0gJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPmdldERpYWdvbmFsKCk7CgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0b3AtPmNvbG9ySW5kZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgJGJvcmRlclRvcENvbG9yID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9Db2xvcjo6bWFwKCR0b3AtPmNvbG9ySW5kZXgsICR0aGlzLT5wYWxldHRlLCAkdGhpcy0+dmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAgJHRvcC0+Z2V0Q29sb3IoKS0+c2V0UkdCKCRib3JkZXJUb3BDb2xvclsncmdiJ10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyaWdodC0+Y29sb3JJbmRleCkpIHsKICAgICAgICAgICAgICAgICAgICAkYm9yZGVyUmlnaHRDb2xvciA9IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfQ29sb3I6Om1hcCgkcmlnaHQtPmNvbG9ySW5kZXgsICR0aGlzLT5wYWxldHRlLCAkdGhpcy0+dmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAgJHJpZ2h0LT5nZXRDb2xvcigpLT5zZXRSR0IoJGJvcmRlclJpZ2h0Q29sb3JbJ3JnYiddKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYm90dG9tLT5jb2xvckluZGV4KSkgewogICAgICAgICAgICAgICAgICAgICRib3JkZXJCb3R0b21Db2xvciA9IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfQ29sb3I6Om1hcCgkYm90dG9tLT5jb2xvckluZGV4LCAkdGhpcy0+cGFsZXR0ZSwgJHRoaXMtPnZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICRib3R0b20tPmdldENvbG9yKCktPnNldFJHQigkYm9yZGVyQm90dG9tQ29sb3JbJ3JnYiddKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc3NldCgkbGVmdC0+Y29sb3JJbmRleCkpIHsKICAgICAgICAgICAgICAgICAgICAkYm9yZGVyTGVmdENvbG9yID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9Db2xvcjo6bWFwKCRsZWZ0LT5jb2xvckluZGV4LCAkdGhpcy0+cGFsZXR0ZSwgJHRoaXMtPnZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICRsZWZ0LT5nZXRDb2xvcigpLT5zZXRSR0IoJGJvcmRlckxlZnRDb2xvclsncmdiJ10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRkaWFnb25hbC0+Y29sb3JJbmRleCkpIHsKICAgICAgICAgICAgICAgICAgICAkYm9yZGVyRGlhZ29uYWxDb2xvciA9IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfQ29sb3I6Om1hcCgkZGlhZ29uYWwtPmNvbG9ySW5kZXgsICR0aGlzLT5wYWxldHRlLCAkdGhpcy0+dmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAgJGRpYWdvbmFsLT5nZXRDb2xvcigpLT5zZXRSR0IoJGJvcmRlckRpYWdvbmFsQ29sb3JbJ3JnYiddKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gdHJlYXQgTVNPRFJBV0lOR0dST1VQIHJlY29yZHMsIHdvcmtib29rLWxldmVsIEVzY2hlcgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSAmJiAkdGhpcy0+ZHJhd2luZ0dyb3VwRGF0YSkgewogICAgICAgICAgICAkZXNjaGVyV29ya2Jvb2sgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0VzY2hlcigpOwogICAgICAgICAgICAkcmVhZGVyID0gbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfRXNjaGVyKCRlc2NoZXJXb3JrYm9vayk7CiAgICAgICAgICAgICRlc2NoZXJXb3JrYm9vayA9ICRyZWFkZXItPmxvYWQoJHRoaXMtPmRyYXdpbmdHcm91cERhdGEpOwoKICAgICAgICAgICAgLy8gZGVidWcgRXNjaGVyIHN0cmVhbQogICAgICAgICAgICAvLyRkZWJ1ZyA9IG5ldyBEZWJ1Z19Fc2NoZXIobmV3IFBIUEV4Y2VsX1NoYXJlZF9Fc2NoZXIoKSk7CiAgICAgICAgICAgIC8vJGRlYnVnLT5sb2FkKCR0aGlzLT5kcmF3aW5nR3JvdXBEYXRhKTsKICAgICAgICB9CgogICAgICAgIC8vIFBhcnNlIHRoZSBpbmRpdmlkdWFsIHNoZWV0cwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5zaGVldHMgYXMgJHNoZWV0KSB7CiAgICAgICAgICAgIGlmICgkc2hlZXRbJ3NoZWV0VHlwZSddICE9IDB4MDApIHsKICAgICAgICAgICAgICAgIC8vIDB4MDA6IFdvcmtzaGVldCwgMHgwMjogQ2hhcnQsIDB4MDY6IFZpc3VhbCBCYXNpYyBtb2R1bGUKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBjaGVjayBpZiBzaGVldCBzaG91bGQgYmUgc2tpcHBlZAogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPmxvYWRTaGVldHNPbmx5KSAmJiAhaW5fYXJyYXkoJHNoZWV0WyduYW1lJ10sICR0aGlzLT5sb2FkU2hlZXRzT25seSkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhZGQgc2hlZXQgdG8gUEhQRXhjZWwgb2JqZWN0CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldCA9ICR0aGlzLT5waHBFeGNlbC0+Y3JlYXRlU2hlZXQoKTsKICAgICAgICAgICAgLy8gICAgVXNlIGZhbHNlIGZvciAkdXBkYXRlRm9ybXVsYUNlbGxSZWZlcmVuY2VzIHRvIHByZXZlbnQgYWRqdXN0bWVudCBvZiB3b3Jrc2hlZXQgcmVmZXJlbmNlcyBpbiBmb3JtdWxhCiAgICAgICAgICAgIC8vICAgICAgICBjZWxscy4uLiBkdXJpbmcgdGhlIGxvYWQsIGFsbCBmb3JtdWxhZSBzaG91bGQgYmUgY29ycmVjdCwgYW5kIHdlJ3JlIHNpbXBseSBicmluZ2luZyB0aGUgd29ya3NoZWV0CiAgICAgICAgICAgIC8vICAgICAgICBuYW1lIGluIGxpbmUgd2l0aCB0aGUgZm9ybXVsYSwgbm90IHRoZSByZXZlcnNlCiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+c2V0VGl0bGUoJHNoZWV0WyduYW1lJ10sIGZhbHNlKTsKICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5zZXRTaGVldFN0YXRlKCRzaGVldFsnc2hlZXRTdGF0ZSddKTsKCiAgICAgICAgICAgICR0aGlzLT5wb3MgPSAkc2hlZXRbJ29mZnNldCddOwoKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBpc0ZpdFRvUGFnZXMuIE1heSBjaGFuZ2UgYWZ0ZXIgcmVhZGluZyBTSEVFVFBSIHJlY29yZC4KICAgICAgICAgICAgJHRoaXMtPmlzRml0VG9QYWdlcyA9IGZhbHNlOwoKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBkcmF3aW5nRGF0YQogICAgICAgICAgICAkdGhpcy0+ZHJhd2luZ0RhdGEgPSAnJzsKCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgb2JqcwogICAgICAgICAgICAkdGhpcy0+b2JqcyA9IGFycmF5KCk7CgogICAgICAgICAgICAvLyBJbml0aWFsaXplIHNoYXJlZCBmb3JtdWxhIHBhcnRzCiAgICAgICAgICAgICR0aGlzLT5zaGFyZWRGb3JtdWxhUGFydHMgPSBhcnJheSgpOwoKICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBzaGFyZWQgZm9ybXVsYXMKICAgICAgICAgICAgJHRoaXMtPnNoYXJlZEZvcm11bGFzID0gYXJyYXkoKTsKCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGV4dCBvYmpzCiAgICAgICAgICAgICR0aGlzLT50ZXh0T2JqZWN0cyA9IGFycmF5KCk7CgogICAgICAgICAgICAvLyBJbml0aWFsaXplIGNlbGwgYW5ub3RhdGlvbnMKICAgICAgICAgICAgJHRoaXMtPmNlbGxOb3RlcyA9IGFycmF5KCk7CiAgICAgICAgICAgICR0aGlzLT50ZXh0T2JqUmVmID0gLTE7CgogICAgICAgICAgICB3aGlsZSAoJHRoaXMtPnBvcyA8PSAkdGhpcy0+ZGF0YVNpemUgLSA0KSB7CiAgICAgICAgICAgICAgICAkY29kZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zKTsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRjb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9CT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkQm9mKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfUFJJTlRHUklETElORVM6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkUHJpbnRHcmlkbGluZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9ERUZBVUxUUk9XSEVJR0hUOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZERlZmF1bHRSb3dIZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9TSEVFVFBSOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFNoZWV0UHIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9IT1JJWk9OVEFMUEFHRUJSRUFLUzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRIb3Jpem9udGFsUGFnZUJyZWFrcygpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1ZFUlRJQ0FMUEFHRUJSRUFLUzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRWZXJ0aWNhbFBhZ2VCcmVha3MoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9IRUFERVI6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkSGVhZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfRk9PVEVSOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZEZvb3RlcigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0hDRU5URVI6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkSGNlbnRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1ZDRU5URVI6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkVmNlbnRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0xFRlRNQVJHSU46CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkTGVmdE1hcmdpbigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1JJR0hUTUFSR0lOOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFJpZ2h0TWFyZ2luKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfVE9QTUFSR0lOOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFRvcE1hcmdpbigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0JPVFRPTU1BUkdJTjoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRCb3R0b21NYXJnaW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9QQUdFU0VUVVA6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkUGFnZVNldHVwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfUFJPVEVDVDoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRQcm90ZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfU0NFTlBST1RFQ1Q6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkU2NlblByb3RlY3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9PQkpFQ1RQUk9URUNUOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZE9iamVjdFByb3RlY3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9QQVNTV09SRDoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRQYXNzd29yZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0RFRkNPTFdJRFRIOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZERlZkNvbFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQ09MSU5GTzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRDb2xJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfRElNRU5TSU9OOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9ST1c6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkUm93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfREJDRUxMOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9SSzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRSaygpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0xBQkVMU1NUOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZExhYmVsU3N0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfTVVMUks6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkTXVsUmsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9OVU1CRVI6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkTnVtYmVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfRk9STVVMQToKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRGb3JtdWxhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfU0hBUkVERk1MQToKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRTaGFyZWRGbWxhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQk9PTEVSUjoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRCb29sRXJyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfTVVMQkxBTks6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkTXVsQmxhbmsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9MQUJFTDoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRMYWJlbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0JMQU5LOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZEJsYW5rKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfTVNPRFJBV0lORzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRNc29EcmF3aW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfT0JKOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZE9iaigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1dJTkRPVzI6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkV2luZG93MigpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1BBR0VMQVlPVVRWSUVXOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFBhZ2VMYXlvdXRWaWV3KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfU0NMOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZFNjbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1BBTkU6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkUGFuZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1NFTEVDVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRTZWxlY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9NRVJHRURDRUxMUzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRNZXJnZWRDZWxscygpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX0hZUEVSTElOSzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRIeXBlckxpbmsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9EQVRBVkFMSURBVElPTlM6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGF0YVZhbGlkYXRpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfREFUQVZBTElEQVRJT046CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGF0YVZhbGlkYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9TSEVFVExBWU9VVDoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRTaGVldExheW91dCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1NIRUVUUFJPVEVDVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRTaGVldFByb3RlY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9SQU5HRVBST1RFQ1RJT046CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkUmFuZ2VQcm90ZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfTk9URToKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWROb3RlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIC8vY2FzZSBzZWxmOjpYTFNfVFlQRV9JTURBVEE6ICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkSW1EYXRhKCk7ICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19UWVBFX1RYTzoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRUZXh0T2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1RZUEVfQ09OVElOVUU6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkQ29udGludWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBzZWxmOjpYTFNfVFlQRV9FT0Y6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhayAyOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkRGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRyZWF0IE1TT0RSQVdJTkcgcmVjb3Jkcywgc2hlZXQtbGV2ZWwgRXNjaGVyCiAgICAgICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSAmJiAkdGhpcy0+ZHJhd2luZ0RhdGEpIHsKICAgICAgICAgICAgICAgICRlc2NoZXJXb3Jrc2hlZXQgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0VzY2hlcigpOwogICAgICAgICAgICAgICAgJHJlYWRlciA9IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X0VzY2hlcigkZXNjaGVyV29ya3NoZWV0KTsKICAgICAgICAgICAgICAgICRlc2NoZXJXb3Jrc2hlZXQgPSAkcmVhZGVyLT5sb2FkKCR0aGlzLT5kcmF3aW5nRGF0YSk7CgogICAgICAgICAgICAgICAgLy8gZGVidWcgRXNjaGVyIHN0cmVhbQogICAgICAgICAgICAgICAgLy8kZGVidWcgPSBuZXcgRGVidWdfRXNjaGVyKG5ldyBQSFBFeGNlbF9TaGFyZWRfRXNjaGVyKCkpOwogICAgICAgICAgICAgICAgLy8kZGVidWctPmxvYWQoJHRoaXMtPmRyYXdpbmdEYXRhKTsKCiAgICAgICAgICAgICAgICAvLyBnZXQgYWxsIHNwQ29udGFpbmVycyBpbiBvbmUgbG9uZyBhcnJheSwgc28gdGhleSBjYW4gYmUgbWFwcGVkIHRvIE9CSiByZWNvcmRzCiAgICAgICAgICAgICAgICAkYWxsU3BDb250YWluZXJzID0gJGVzY2hlcldvcmtzaGVldC0+Z2V0RGdDb250YWluZXIoKS0+Z2V0U3BnckNvbnRhaW5lcigpLT5nZXRBbGxTcENvbnRhaW5lcnMoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gdHJlYXQgT0JKIHJlY29yZHMKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPm9ianMgYXMgJG4gPT4gJG9iaikgewovLyAgICAgICAgICAgICAgICBlY2hvICc8aHIgLz48Yj5PYmplY3Q8L2I+IHJlZmVyZW5jZSBpcyAnLCAkbiwnPGJyIC8+JzsKLy8gICAgICAgICAgICAgICAgdmFyX2R1bXAoJG9iaik7Ci8vICAgICAgICAgICAgICAgIGVjaG8gJzxiciAvPic7CgogICAgICAgICAgICAgICAgLy8gdGhlIGZpcnN0IHNoYXBlIGNvbnRhaW5lciBuZXZlciBoYXMgYSBjb3JyZXNwb25kaW5nIE9CSiByZWNvcmQsIGhlbmNlICRuICsgMQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRhbGxTcENvbnRhaW5lcnNbJG4gKyAxXSkgJiYgaXNfb2JqZWN0KCRhbGxTcENvbnRhaW5lcnNbJG4gKyAxXSkpIHsKICAgICAgICAgICAgICAgICAgICAkc3BDb250YWluZXIgPSAkYWxsU3BDb250YWluZXJzWyRuICsgMV07CgogICAgICAgICAgICAgICAgICAgIC8vIHdlIHNraXAgYWxsIHNwQ29udGFpbmVycyB0aGF0IGFyZSBhIHBhcnQgb2YgYSBncm91cCBzaGFwZSBzaW5jZSB3ZSBjYW5ub3QgeWV0IGhhbmRsZSB0aG9zZQogICAgICAgICAgICAgICAgICAgIGlmICgkc3BDb250YWluZXItPmdldE5lc3RpbmdMZXZlbCgpID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgc2hhcGUKICAgICAgICAgICAgICAgICAgICBsaXN0KCRzdGFydENvbHVtbiwgJHN0YXJ0Um93KSA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRzcENvbnRhaW5lci0+Z2V0U3RhcnRDb29yZGluYXRlcygpKTsKICAgICAgICAgICAgICAgICAgICBsaXN0KCRlbmRDb2x1bW4sICRlbmRSb3cpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHNwQ29udGFpbmVyLT5nZXRFbmRDb29yZGluYXRlcygpKTsKCiAgICAgICAgICAgICAgICAgICAgJHN0YXJ0T2Zmc2V0WCA9ICRzcENvbnRhaW5lci0+Z2V0U3RhcnRPZmZzZXRYKCk7CiAgICAgICAgICAgICAgICAgICAgJHN0YXJ0T2Zmc2V0WSA9ICRzcENvbnRhaW5lci0+Z2V0U3RhcnRPZmZzZXRZKCk7CiAgICAgICAgICAgICAgICAgICAgJGVuZE9mZnNldFggPSAkc3BDb250YWluZXItPmdldEVuZE9mZnNldFgoKTsKICAgICAgICAgICAgICAgICAgICAkZW5kT2Zmc2V0WSA9ICRzcENvbnRhaW5lci0+Z2V0RW5kT2Zmc2V0WSgpOwoKICAgICAgICAgICAgICAgICAgICAkd2lkdGggPSBQSFBFeGNlbF9TaGFyZWRfRXhjZWw1OjpnZXREaXN0YW5jZVgoJHRoaXMtPnBocFNoZWV0LCAkc3RhcnRDb2x1bW4sICRzdGFydE9mZnNldFgsICRlbmRDb2x1bW4sICRlbmRPZmZzZXRYKTsKICAgICAgICAgICAgICAgICAgICAkaGVpZ2h0ID0gUEhQRXhjZWxfU2hhcmVkX0V4Y2VsNTo6Z2V0RGlzdGFuY2VZKCR0aGlzLT5waHBTaGVldCwgJHN0YXJ0Um93LCAkc3RhcnRPZmZzZXRZLCAkZW5kUm93LCAkZW5kT2Zmc2V0WSk7CgogICAgICAgICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBvZmZzZXRYIGFuZCBvZmZzZXRZIG9mIHRoZSBzaGFwZQogICAgICAgICAgICAgICAgICAgICRvZmZzZXRYID0gJHN0YXJ0T2Zmc2V0WCAqIFBIUEV4Y2VsX1NoYXJlZF9FeGNlbDU6OnNpemVDb2woJHRoaXMtPnBocFNoZWV0LCAkc3RhcnRDb2x1bW4pIC8gMTAyNDsKICAgICAgICAgICAgICAgICAgICAkb2Zmc2V0WSA9ICRzdGFydE9mZnNldFkgKiBQSFBFeGNlbF9TaGFyZWRfRXhjZWw1OjpzaXplUm93KCR0aGlzLT5waHBTaGVldCwgJHN0YXJ0Um93KSAvIDI1NjsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgkb2JqWydvdE9ialR5cGUnXSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MTk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RlCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJ0NlbGwgQW5ub3RhdGlvbiBPYmplY3Q8YnIgLz4nOwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdPYmplY3QgSUQgaXMgJywgJG9ialsnaWRPYmpJRCddLCc8YnIgLz4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5jZWxsTm90ZXNbJG9ialsnaWRPYmpJRCddXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbE5vdGUgPSAkdGhpcy0+Y2VsbE5vdGVzWyRvYmpbJ2lkT2JqSUQnXV07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+dGV4dE9iamVjdHNbJG9ialsnaWRPYmpJRCddXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRleHRPYmplY3QgPSAkdGhpcy0+dGV4dE9iamVjdHNbJG9ialsnaWRPYmpJRCddXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNlbGxOb3Rlc1skb2JqWydpZE9iaklEJ11dWydvYmpUZXh0RGF0YSddID0gJHRleHRPYmplY3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwODoKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnUGljdHVyZSBPYmplY3Q8YnIgLz4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGljdHVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGluZGV4IHRvIEJTRSBlbnRyeSAoMS1iYXNlZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRCU0VpbmRleCA9ICRzcENvbnRhaW5lci0+Z2V0T1BUKDB4MDEwNCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQlNFQ29sbGVjdGlvbiA9ICRlc2NoZXJXb3JrYm9vay0+Z2V0RGdnQ29udGFpbmVyKCktPmdldEJzdG9yZUNvbnRhaW5lcigpLT5nZXRCU0VDb2xsZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQlNFID0gJEJTRUNvbGxlY3Rpb25bJEJTRWluZGV4IC0gMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYmxpcFR5cGUgPSAkQlNFLT5nZXRCbGlwVHlwZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5lZWQgY2hlY2sgYmVjYXVzZSBzb21lIGJsaXAgdHlwZXMgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgRXNjaGVyIHJlYWRlciBzdWNoIGFzIEVNRgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRibGlwID0gJEJTRS0+Z2V0QmxpcCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGloID0gaW1hZ2VjcmVhdGVmcm9tc3RyaW5nKCRibGlwLT5nZXREYXRhKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcmF3aW5nID0gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldF9NZW1vcnlEcmF3aW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmctPnNldEltYWdlUmVzb3VyY2UoJGloKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2lkdGgsIGhlaWdodCwgb2Zmc2V0WCwgb2Zmc2V0WQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcmF3aW5nLT5zZXRSZXNpemVQcm9wb3J0aW9uYWwoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcmF3aW5nLT5zZXRXaWR0aCgkd2lkdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcmF3aW5nLT5zZXRIZWlnaHQoJGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmctPnNldE9mZnNldFgoJG9mZnNldFgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcmF3aW5nLT5zZXRPZmZzZXRZKCRvZmZzZXRZKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgkYmxpcFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TaGFyZWRfRXNjaGVyX0RnZ0NvbnRhaW5lcl9Cc3RvcmVDb250YWluZXJfQlNFOjpCTElQVFlQRV9KUEVHOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmctPnNldFJlbmRlcmluZ0Z1bmN0aW9uKFBIUEV4Y2VsX1dvcmtzaGVldF9NZW1vcnlEcmF3aW5nOjpSRU5ERVJJTkdfSlBFRyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJhd2luZy0+c2V0TWltZVR5cGUoUEhQRXhjZWxfV29ya3NoZWV0X01lbW9yeURyYXdpbmc6Ok1JTUVUWVBFX0pQRUcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU2hhcmVkX0VzY2hlcl9EZ2dDb250YWluZXJfQnN0b3JlQ29udGFpbmVyX0JTRTo6QkxJUFRZUEVfUE5HOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmctPnNldFJlbmRlcmluZ0Z1bmN0aW9uKFBIUEV4Y2VsX1dvcmtzaGVldF9NZW1vcnlEcmF3aW5nOjpSRU5ERVJJTkdfUE5HKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcmF3aW5nLT5zZXRNaW1lVHlwZShQSFBFeGNlbF9Xb3Jrc2hlZXRfTWVtb3J5RHJhd2luZzo6TUlNRVRZUEVfUE5HKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmctPnNldFdvcmtzaGVldCgkdGhpcy0+cGhwU2hlZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcmF3aW5nLT5zZXRDb29yZGluYXRlcygkc3BDb250YWluZXItPmdldFN0YXJ0Q29vcmRpbmF0ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG90aGVyIG9iamVjdCB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRyZWF0IFNIQVJFREZNTEEgcmVjb3JkcwogICAgICAgICAgICBpZiAoJHRoaXMtPnZlcnNpb24gPT0gc2VsZjo6WExTX0JJRkY4KSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+c2hhcmVkRm9ybXVsYVBhcnRzIGFzICRjZWxsID0+ICRiYXNlQ2VsbCkgewogICAgICAgICAgICAgICAgICAgIGxpc3QoJGNvbHVtbiwgJHJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkY2VsbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpICE9PSBudWxsKSAmJiAkdGhpcy0+Z2V0UmVhZEZpbHRlcigpLT5yZWFkQ2VsbCgkY29sdW1uLCAkcm93LCAkdGhpcy0+cGhwU2hlZXQtPmdldFRpdGxlKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtdWxhID0gJHRoaXMtPmdldEZvcm11bGFGcm9tU3RydWN0dXJlKCR0aGlzLT5zaGFyZWRGb3JtdWxhc1skYmFzZUNlbGxdLCAkY2VsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Q2VsbCgkY2VsbCktPnNldFZhbHVlRXhwbGljaXQoJz0nIC4gJGZvcm11bGEsIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfRk9STVVMQSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5jZWxsTm90ZXMpKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+Y2VsbE5vdGVzIGFzICRub3RlID0+ICRub3RlRGV0YWlscykgewogICAgICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJG5vdGVEZXRhaWxzWydvYmpUZXh0RGF0YSddKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPnRleHRPYmplY3RzWyRub3RlXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0ZXh0T2JqZWN0ID0gJHRoaXMtPnRleHRPYmplY3RzWyRub3RlXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRub3RlRGV0YWlsc1snb2JqVGV4dERhdGEnXSA9ICR0ZXh0T2JqZWN0OwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5vdGVEZXRhaWxzWydvYmpUZXh0RGF0YSddWyd0ZXh0J10gPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KLy8gICAgICAgICAgICAgICAgICAgIGVjaG8gJzxiPkNlbGwgYW5ub3RhdGlvbiAnLCAkbm90ZSwnPC9iPjxiciAvPic7Ci8vICAgICAgICAgICAgICAgICAgICB2YXJfZHVtcCgkbm90ZURldGFpbHMpOwovLyAgICAgICAgICAgICAgICAgICAgZWNobyAnPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAkY2VsbEFkZHJlc3MgPSBzdHJfcmVwbGFjZSgnJCcsICcnLCAkbm90ZURldGFpbHNbJ2NlbGxSZWYnXSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRDb21tZW50KCRjZWxsQWRkcmVzcyktPnNldEF1dGhvcigkbm90ZURldGFpbHNbJ2F1dGhvciddKS0+c2V0VGV4dCgkdGhpcy0+cGFyc2VSaWNoVGV4dCgkbm90ZURldGFpbHNbJ29ialRleHREYXRhJ11bJ3RleHQnXSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgdGhlIG5hbWVkIHJhbmdlcyAoZGVmaW5lZCBuYW1lcykKICAgICAgICBmb3JlYWNoICgkdGhpcy0+ZGVmaW5lZG5hbWUgYXMgJGRlZmluZWROYW1lKSB7CiAgICAgICAgICAgIGlmICgkZGVmaW5lZE5hbWVbJ2lzQnVpbHRJbk5hbWUnXSkgewogICAgICAgICAgICAgICAgc3dpdGNoICgkZGVmaW5lZE5hbWVbJ25hbWUnXSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgcGFjaygnQycsIDB4MDYpOgogICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmludCBhcmVhCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGluIGdlbmVyYWwsIGZvcm11bGEgbG9va3MgbGlrZSB0aGlzOiBGb28hJEMkNzokSiQ2NixCYXIhJEEkMTokSVYkMgogICAgICAgICAgICAgICAgICAgICAgICAkcmFuZ2VzID0gZXhwbG9kZSgnLCcsICRkZWZpbmVkTmFtZVsnZm9ybXVsYSddKTsgLy8gRklYTUU6IHdoYXQgaWYgc2hlZXRuYW1lIGNvbnRhaW5zIGNvbW1hPwoKICAgICAgICAgICAgICAgICAgICAgICAgJGV4dHJhY3RlZFJhbmdlcyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyYW5nZXMgYXMgJHJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAkcmFuZ2Ugc2hvdWxkIGxvb2sgbGlrZSBvbmUgb2YgdGhlc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBGb28hJEMkNzokSiQ2NgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIEJhciEkQSQxOiRJViQyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhwbG9kZXMgPSBleHBsb2RlKCchJywgJHJhbmdlKTsgICAgLy8gRklYTUU6IHdoYXQgaWYgc2hlZXRuYW1lIGNvbnRhaW5zIGV4Y2xhbWF0aW9uIG1hcms\/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hlZXROYW1lID0gdHJpbSgkZXhwbG9kZXNbMF0sICInIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQoJGV4cGxvZGVzKSA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkZXhwbG9kZXNbMV0sICc6JykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHBsb2Rlc1sxXSA9ICRleHBsb2Rlc1sxXSAuICc6JyAuICRleHBsb2Rlc1sxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4dHJhY3RlZFJhbmdlc1tdID0gc3RyX3JlcGxhY2UoJyQnLCAnJywgJGV4cGxvZGVzWzFdKTsgLy8gQzc6SjY2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRkb2NTaGVldCA9ICR0aGlzLT5waHBFeGNlbC0+Z2V0U2hlZXRCeU5hbWUoJHNoZWV0TmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldFByaW50QXJlYShpbXBsb2RlKCcsJywgJGV4dHJhY3RlZFJhbmdlcykpOyAvLyBDNzpKNjYsQTE6SVYyCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBwYWNrKCdDJywgMHgwNyk6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByaW50IHRpdGxlcyAocmVwZWF0aW5nIHJvd3MpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc3VtaW5nIEJJRkY4LCB0aGVyZSBhcmUgMyBjYXNlcwogICAgICAgICAgICAgICAgICAgICAgICAvLyAxLiByZXBlYXRpbmcgcm93cwogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgZm9ybXVsYSBsb29rcyBsaWtlIHRoaXM6IFNoZWV0ISRBJDE6JElWJDIKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHJvd3MgMS0yIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAvLyAyLiByZXBlYXRpbmcgY29sdW1ucwogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgZm9ybXVsYSBsb29rcyBsaWtlIHRoaXM6IFNoZWV0ISRBJDE6JEIkNjU1MzYKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIGNvbHVtbnMgQS1CIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAvLyAzLiBib3RoIHJlcGVhdGluZyByb3dzIGFuZCByZXBlYXRpbmcgY29sdW1ucwogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgZm9ybXVsYSBsb29rcyBsaWtlIHRoaXM6IFNoZWV0ISRBJDE6JEIkNjU1MzYsU2hlZXQhJEEkMTokSVYkMgogICAgICAgICAgICAgICAgICAgICAgICAkcmFuZ2VzID0gZXhwbG9kZSgnLCcsICRkZWZpbmVkTmFtZVsnZm9ybXVsYSddKTsgLy8gRklYTUU6IHdoYXQgaWYgc2hlZXRuYW1lIGNvbnRhaW5zIGNvbW1hPwogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmFuZ2VzIGFzICRyYW5nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJHJhbmdlIHNob3VsZCBsb29rIGxpa2UgdGhpcyBvbmUgb2YgdGhlc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBTaGVldCEkQSQxOiRCJDY1NTM2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgU2hlZXQhJEEkMTokSVYkMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4cGxvZGVzID0gZXhwbG9kZSgnIScsICRyYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQoJGV4cGxvZGVzKSA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRkb2NTaGVldCA9ICR0aGlzLT5waHBFeGNlbC0+Z2V0U2hlZXRCeU5hbWUoJGV4cGxvZGVzWzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSAkZXhwbG9kZXNbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHRyYWN0ZWRSYW5nZSA9IHN0cl9yZXBsYWNlKCckJywgJycsICRleHRyYWN0ZWRSYW5nZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29vcmRpbmF0ZVN0cmluZ3MgPSBleHBsb2RlKCc6JywgJGV4dHJhY3RlZFJhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50KCRjb29yZGluYXRlU3RyaW5ncykgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCgkZmlyc3RDb2x1bW4sICRmaXJzdFJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkY29vcmRpbmF0ZVN0cmluZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCgkbGFzdENvbHVtbiwgJGxhc3RSb3cpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJGNvb3JkaW5hdGVTdHJpbmdzWzFdKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGZpcnN0Q29sdW1uID09ICdBJyBhbmQgJGxhc3RDb2x1bW4gPT0gJ0lWJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gd2UgaGF2ZSByZXBlYXRpbmcgcm93cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldFJvd3NUb1JlcGVhdEF0VG9wKGFycmF5KCRmaXJzdFJvdywgJGxhc3RSb3cpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZmlyc3RSb3cgPT0gMSBhbmQgJGxhc3RSb3cgPT0gNjU1MzYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGVuIHdlIGhhdmUgcmVwZWF0aW5nIGNvbHVtbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5zZXRDb2x1bW5zVG9SZXBlYXRBdExlZnQoYXJyYXkoJGZpcnN0Q29sdW1uLCAkbGFzdENvbHVtbikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRXh0cmFjdCByYW5nZQogICAgICAgICAgICAgICAgJGV4cGxvZGVzID0gZXhwbG9kZSgnIScsICRkZWZpbmVkTmFtZVsnZm9ybXVsYSddKTsKCiAgICAgICAgICAgICAgICBpZiAoY291bnQoJGV4cGxvZGVzKSA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkZG9jU2hlZXQgPSAkdGhpcy0+cGhwRXhjZWwtPmdldFNoZWV0QnlOYW1lKCRleHBsb2Rlc1swXSkpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICgkZG9jU2hlZXQgPSAkdGhpcy0+cGhwRXhjZWwtPmdldFNoZWV0QnlOYW1lKHRyaW0oJGV4cGxvZGVzWzBdLCAiJyIpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGV4dHJhY3RlZFJhbmdlID0gJGV4cGxvZGVzWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSBzdHJfcmVwbGFjZSgnJCcsICcnLCAkZXh0cmFjdGVkUmFuZ2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2FsT25seSA9ICgkZGVmaW5lZE5hbWVbJ3Njb3BlJ10gPT0gMCkgPyBmYWxzZSA6IHRydWU7CgogICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUgPSAoJGRlZmluZWROYW1lWydzY29wZSddID09IDApID8gbnVsbCA6ICR0aGlzLT5waHBFeGNlbC0+Z2V0U2hlZXRCeU5hbWUoJHRoaXMtPnNoZWV0c1skZGVmaW5lZE5hbWVbJ3Njb3BlJ10gLSAxXVsnbmFtZSddKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5waHBFeGNlbC0+YWRkTmFtZWRSYW5nZShuZXcgUEhQRXhjZWxfTmFtZWRSYW5nZSgoc3RyaW5nKSRkZWZpbmVkTmFtZVsnbmFtZSddLCAkZG9jU2hlZXQsICRleHRyYWN0ZWRSYW5nZSwgJGxvY2FsT25seSwgJHNjb3BlKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAgICBOYW1lZCBWYWx1ZQogICAgICAgICAgICAgICAgICAgIC8vICAgIFRPRE8gUHJvdmlkZSBzdXBwb3J0IGZvciBuYW1lZCB2YWx1ZXMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkdGhpcy0+ZGF0YSA9IG51bGw7CgogICAgICAgIHJldHVybiAkdGhpcy0+cGhwRXhjZWw7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogUmVhZCByZWNvcmQgZGF0YSBmcm9tIHN0cmVhbSwgZGVjcnlwdGluZyBhcyByZXF1aXJlZAogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRhdGEgICBEYXRhIHN0cmVhbSB0byByZWFkIGZyb20KICAgICAqIEBwYXJhbSBpbnQgICAgJHBvcyAgICBQb3NpdGlvbiB0byBzdGFydCByZWFkaW5nIGZyb20KICAgICAqIEBwYXJhbSBpbnQgICAgJGxlbmd0aCBSZWNvcmQgZGF0YSBsZW5ndGgKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBSZWNvcmQgZGF0YQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRSZWNvcmREYXRhKCRkYXRhLCAkcG9zLCAkbGVuKQogICAgewogICAgICAgICRkYXRhID0gc3Vic3RyKCRkYXRhLCAkcG9zLCAkbGVuKTsKICAgICAgICAKICAgICAgICAvLyBGaWxlIG5vdCBlbmNyeXB0ZWQsIG9yIHJlY29yZCBiZWZvcmUgZW5jcnlwdGlvbiBzdGFydCBwb2ludAogICAgICAgIGlmICgkdGhpcy0+ZW5jcnlwdGlvbiA9PSBzZWxmOjpNU19CSUZGX0NSWVBUT19OT05FIHx8ICRwb3MgPCAkdGhpcy0+ZW5jcnlwdGlvblN0YXJ0UG9zKSB7CiAgICAgICAgICAgIHJldHVybiAkZGF0YTsKICAgICAgICB9CiAgICAKICAgICAgICAkcmVjb3JkRGF0YSA9ICcnOwogICAgICAgIGlmICgkdGhpcy0+ZW5jcnlwdGlvbiA9PSBzZWxmOjpNU19CSUZGX0NSWVBUT19SQzQpIHsKICAgICAgICAgICAgJG9sZEJsb2NrID0gZmxvb3IoJHRoaXMtPnJjNFBvcyAvIHNlbGY6OlJFS0VZX0JMT0NLKTsKICAgICAgICAgICAgJGJsb2NrID0gZmxvb3IoJHBvcyAvIHNlbGY6OlJFS0VZX0JMT0NLKTsKICAgICAgICAgICAgJGVuZEJsb2NrID0gZmxvb3IoKCRwb3MgKyAkbGVuKSAvIHNlbGY6OlJFS0VZX0JMT0NLKTsKCiAgICAgICAgICAgIC8vIFNwaW4gYW4gUkM0IGRlY3J5cHRvciB0byB0aGUgcmlnaHQgc3BvdC4gSWYgd2UgaGF2ZSBhIGRlY3J5cHRvciBzaXR0aW5nCiAgICAgICAgICAgIC8vIGF0IGEgcG9pbnQgZWFybGllciBpbiB0aGUgY3VycmVudCBibG9jaywgcmUtdXNlIGl0IGFzIHdlIGNhbiBzYXZlIHNvbWUgdGltZS4KICAgICAgICAgICAgaWYgKCRibG9jayAhPSAkb2xkQmxvY2sgfHwgJHBvcyA8ICR0aGlzLT5yYzRQb3MgfHwgISR0aGlzLT5yYzRLZXkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5yYzRLZXkgPSAkdGhpcy0+bWFrZUtleSgkYmxvY2ssICR0aGlzLT5tZDVDdHh0KTsKICAgICAgICAgICAgICAgICRzdGVwID0gJHBvcyAlIHNlbGY6OlJFS0VZX0JMT0NLOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHN0ZXAgPSAkcG9zIC0gJHRoaXMtPnJjNFBvczsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+cmM0S2V5LT5SQzQoc3RyX3JlcGVhdCgiXDAiLCAkc3RlcCkpOwoKICAgICAgICAgICAgLy8gRGVjcnlwdCByZWNvcmQgZGF0YSAocmUta2V5aW5nIGF0IHRoZSBlbmQgb2YgZXZlcnkgYmxvY2spCiAgICAgICAgICAgIHdoaWxlICgkYmxvY2sgIT0gJGVuZEJsb2NrKSB7CiAgICAgICAgICAgICAgICAkc3RlcCA9IHNlbGY6OlJFS0VZX0JMT0NLIC0gKCRwb3MgJSBzZWxmOjpSRUtFWV9CTE9DSyk7CiAgICAgICAgICAgICAgICAkcmVjb3JkRGF0YSAuPSAkdGhpcy0+cmM0S2V5LT5SQzQoc3Vic3RyKCRkYXRhLCAwLCAkc3RlcCkpOwogICAgICAgICAgICAgICAgJGRhdGEgPSBzdWJzdHIoJGRhdGEsICRzdGVwKTsKICAgICAgICAgICAgICAgICRwb3MgKz0gJHN0ZXA7CiAgICAgICAgICAgICAgICAkbGVuIC09ICRzdGVwOwogICAgICAgICAgICAgICAgJGJsb2NrKys7CiAgICAgICAgICAgICAgICAkdGhpcy0+cmM0S2V5ID0gJHRoaXMtPm1ha2VLZXkoJGJsb2NrLCAkdGhpcy0+bWQ1Q3R4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHJlY29yZERhdGEgLj0gJHRoaXMtPnJjNEtleS0+UkM0KHN1YnN0cigkZGF0YSwgMCwgJGxlbikpOwoKICAgICAgICAgICAgLy8gS2VlcCB0cmFjayBvZiB0aGUgcG9zaXRpb24gb2YgdGhpcyBkZWNyeXB0b3IuCiAgICAgICAgICAgIC8vIFdlJ2xsIHRyeSBhbmQgcmUtdXNlIGl0IGxhdGVyIGlmIHdlIGNhbiB0byBzcGVlZCB0aGluZ3MgdXAKICAgICAgICAgICAgJHRoaXMtPnJjNFBvcyA9ICRwb3MgKyAkbGVuOwogICAgICAgIH0gZWxzZWlmICgkdGhpcy0+ZW5jcnlwdGlvbiA9PSBzZWxmOjpNU19CSUZGX0NSWVBUT19YT1IpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJ1hPciBlbmNyeXB0aW9uIG5vdCBzdXBwb3J0ZWQnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZWNvcmREYXRhOwogICAgfQoKICAgIC8qKgogICAgICogVXNlIE9MRSByZWFkZXIgdG8gZXh0cmFjdCB0aGUgcmVsZXZhbnQgZGF0YSBzdHJlYW1zIGZyb20gdGhlIE9MRSBmaWxlCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcEZpbGVuYW1lCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gbG9hZE9MRSgkcEZpbGVuYW1lKQogICAgewogICAgICAgIC8vIE9MRSByZWFkZXIKICAgICAgICAkb2xlID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9PTEVSZWFkKCk7CiAgICAgICAgLy8gZ2V0IGV4Y2VsIGRhdGEsCiAgICAgICAgJHJlcyA9ICRvbGUtPnJlYWQoJHBGaWxlbmFtZSk7CiAgICAgICAgLy8gR2V0IHdvcmtib29rIGRhdGE6IHdvcmtib29rIHN0cmVhbSArIHNoZWV0IHN0cmVhbXMKICAgICAgICAkdGhpcy0+ZGF0YSA9ICRvbGUtPmdldFN0cmVhbSgkb2xlLT53cmtib29rKTsKICAgICAgICAvLyBHZXQgc3VtbWFyeSBpbmZvcm1hdGlvbiBkYXRhCiAgICAgICAgJHRoaXMtPnN1bW1hcnlJbmZvcm1hdGlvbiA9ICRvbGUtPmdldFN0cmVhbSgkb2xlLT5zdW1tYXJ5SW5mb3JtYXRpb24pOwogICAgICAgIC8vIEdldCBhZGRpdGlvbmFsIGRvY3VtZW50IHN1bW1hcnkgaW5mb3JtYXRpb24gZGF0YQogICAgICAgICR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiA9ICRvbGUtPmdldFN0cmVhbSgkb2xlLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbik7CiAgICAgICAgLy8gR2V0IHVzZXItZGVmaW5lZCBwcm9wZXJ0eSBkYXRhCi8vICAgICAgICAkdGhpcy0+dXNlckRlZmluZWRQcm9wZXJ0aWVzID0gJG9sZS0+Z2V0VXNlckRlZmluZWRQcm9wZXJ0aWVzKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBzdW1tYXJ5IGluZm9ybWF0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFN1bW1hcnlJbmZvcm1hdGlvbigpCiAgICB7CiAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+c3VtbWFyeUluZm9ybWF0aW9uKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IG11c3QgYmUgMHhGRSAweEZGIChVVEYtMTYgTEUgYnl0ZSBvcmRlciBtYXJrKQogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsKICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDI7IE9TIHZlcnNpb24KICAgICAgICAvLyBvZmZzZXQ6IDY7IHNpemU6IDI7IE9TIGluZGljYXRvcgogICAgICAgIC8vIG9mZnNldDogODsgc2l6ZTogMTYKICAgICAgICAvLyBvZmZzZXQ6IDI0OyBzaXplOiA0OyBzZWN0aW9uIGNvdW50CiAgICAgICAgJHNlY0NvdW50ID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPnN1bW1hcnlJbmZvcm1hdGlvbiwgMjQpOwoKICAgICAgICAvLyBvZmZzZXQ6IDI4OyBzaXplOiAxNjsgZmlyc3Qgc2VjdGlvbidzIGNsYXNzIGlkOiBlMCA4NSA5ZiBmMiBmOSA0ZiA2OCAxMCBhYiA5MSAwOCAwMCAyYiAyNyBiMyBkOQogICAgICAgIC8vIG9mZnNldDogNDQ7IHNpemU6IDQKICAgICAgICAkc2VjT2Zmc2V0ID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPnN1bW1hcnlJbmZvcm1hdGlvbiwgNDQpOwoKICAgICAgICAvLyBzZWN0aW9uIGhlYWRlcgogICAgICAgIC8vIG9mZnNldDogJHNlY09mZnNldDsgc2l6ZTogNDsgc2VjdGlvbiBsZW5ndGgKICAgICAgICAkc2VjTGVuZ3RoID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPnN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCk7CgogICAgICAgIC8vIG9mZnNldDogJHNlY09mZnNldCs0OyBzaXplOiA0OyBwcm9wZXJ0eSBjb3VudAogICAgICAgICRjb3VudFByb3BlcnRpZXMgPSBzZWxmOjpnZXRJbnQ0ZCgkdGhpcy0+c3VtbWFyeUluZm9ybWF0aW9uLCAkc2VjT2Zmc2V0KzQpOwoKICAgICAgICAvLyBpbml0aWFsaXplIGNvZGUgcGFnZSAodXNlZCB0byByZXNvbHZlIHN0cmluZyB2YWx1ZXMpCiAgICAgICAgJGNvZGVQYWdlID0gJ0NQMTI1Mic7CgogICAgICAgIC8vIG9mZnNldDogKCRzZWNPZmZzZXQrOCk7IHNpemU6IHZhcgogICAgICAgIC8vIGxvb3AgdGhyb3VnaCBwcm9wZXJ0eSBkZWNhcmF0aW9ucyBhbmQgcHJvcGVydGllcwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRjb3VudFByb3BlcnRpZXM7ICsrJGkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAoJHNlY09mZnNldCs4KSArICg4ICogJGkpOyBzaXplOiA0OyBwcm9wZXJ0eSBJRAogICAgICAgICAgICAkaWQgPSBzZWxmOjpnZXRJbnQ0ZCgkdGhpcy0+c3VtbWFyeUluZm9ybWF0aW9uLCAoJHNlY09mZnNldCs4KSArICg4ICogJGkpKTsKCiAgICAgICAgICAgIC8vIFVzZSB2YWx1ZSBvZiBwcm9wZXJ0eSBpZCBhcyBhcHByb3ByaWF0ZQogICAgICAgICAgICAvLyBvZmZzZXQ6ICgkc2VjT2Zmc2V0KzEyKSArICg4ICogJGkpOyBzaXplOiA0OyBvZmZzZXQgZnJvbSBiZWdpbm5pbmcgb2Ygc2VjdGlvbiAoNDgpCiAgICAgICAgICAgICRvZmZzZXQgPSBzZWxmOjpnZXRJbnQ0ZCgkdGhpcy0+c3VtbWFyeUluZm9ybWF0aW9uLCAoJHNlY09mZnNldCsxMikgKyAoOCAqICRpKSk7CgogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmdldEludDRkKCR0aGlzLT5zdW1tYXJ5SW5mb3JtYXRpb24sICRzZWNPZmZzZXQgKyAkb2Zmc2V0KTsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgcHJvcGVydHkgdmFsdWUKICAgICAgICAgICAgJHZhbHVlID0gbnVsbDsKCiAgICAgICAgICAgIC8vIGV4dHJhY3QgcHJvcGVydHkgdmFsdWUgYmFzZWQgb24gcHJvcGVydHkgdHlwZQogICAgICAgICAgICBzd2l0Y2ggKCR0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDI6IC8vIDIgYnl0ZSBzaWduZWQgaW50ZWdlcgogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5zdW1tYXJ5SW5mb3JtYXRpb24sICRzZWNPZmZzZXQgKyA0ICsgJG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDM6IC8vIDQgYnl0ZSBzaWduZWQgaW50ZWdlcgogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IHNlbGY6OmdldEludDRkKCR0aGlzLT5zdW1tYXJ5SW5mb3JtYXRpb24sICRzZWNPZmZzZXQgKyA0ICsgJG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MTM6IC8vIDQgYnl0ZSB1bnNpZ25lZCBpbnRlZ2VyCiAgICAgICAgICAgICAgICAgICAgLy8gbm90IG5lZWRlZCB5ZXQsIGZpeCBsYXRlciBpZiBuZWNlc3NhcnkKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgxRTogLy8gbnVsbC10ZXJtaW5hdGVkIHN0cmluZyBwcmVwZW5kZWQgYnkgZHdvcmQgc3RyaW5nIGxlbmd0aAogICAgICAgICAgICAgICAgICAgICRieXRlTGVuZ3RoID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPnN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCArIDQgKyAkb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBzdWJzdHIoJHRoaXMtPnN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCArIDggKyAkb2Zmc2V0LCAkYnl0ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q29udmVydEVuY29kaW5nKCR2YWx1ZSwgJ1VURi04JywgJGNvZGVQYWdlKTsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBydHJpbSgkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDQwOiAvLyBGaWxldGltZSAoNjQtYml0IHZhbHVlIHJlcHJlc2VudGluZyB0aGUgbnVtYmVyIG9mIDEwMC1uYW5vc2Vjb25kIGludGVydmFscyBzaW5jZSBKYW51YXJ5IDEsIDE2MDEpCiAgICAgICAgICAgICAgICAgICAgLy8gUEhQLXRpbWUKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBQSFBFeGNlbF9TaGFyZWRfT0xFOjpPTEUyTG9jYWxEYXRlKHN1YnN0cigkdGhpcy0+c3VtbWFyeUluZm9ybWF0aW9uLCAkc2VjT2Zmc2V0ICsgNCArICRvZmZzZXQsIDgpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHg0NzogLy8gQ2xpcGJvYXJkIGZvcm1hdAogICAgICAgICAgICAgICAgICAgIC8vIG5vdCBuZWVkZWQgeWV0LCBmaXggbGF0ZXIgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoJGlkKSB7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDE6ICAgIC8vICAgIENvZGUgUGFnZQogICAgICAgICAgICAgICAgICAgICRjb2RlUGFnZSA9IFBIUEV4Y2VsX1NoYXJlZF9Db2RlUGFnZTo6TnVtYmVyVG9OYW1lKCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDI6ICAgIC8vICAgIFRpdGxlCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBocEV4Y2VsLT5nZXRQcm9wZXJ0aWVzKCktPnNldFRpdGxlKCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDM6ICAgIC8vICAgIFN1YmplY3QKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPmdldFByb3BlcnRpZXMoKS0+c2V0U3ViamVjdCgkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDA0OiAgICAvLyAgICBBdXRob3IgKENyZWF0b3IpCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBocEV4Y2VsLT5nZXRQcm9wZXJ0aWVzKCktPnNldENyZWF0b3IoJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwNTogICAgLy8gICAgS2V5d29yZHMKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPmdldFByb3BlcnRpZXMoKS0+c2V0S2V5d29yZHMoJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwNjogICAgLy8gICAgQ29tbWVudHMgKERlc2NyaXB0aW9uKQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5waHBFeGNlbC0+Z2V0UHJvcGVydGllcygpLT5zZXREZXNjcmlwdGlvbigkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDA3OiAgICAvLyAgICBUZW1wbGF0ZQogICAgICAgICAgICAgICAgICAgIC8vICAgIE5vdCBzdXBwb3J0ZWQgYnkgUEhQRXhjZWwKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwODogICAgLy8gICAgTGFzdCBTYXZlZCBCeSAoTGFzdE1vZGlmaWVkQnkpCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBocEV4Y2VsLT5nZXRQcm9wZXJ0aWVzKCktPnNldExhc3RNb2RpZmllZEJ5KCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDk6ICAgIC8vICAgIFJldmlzaW9uCiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBBOiAgICAvLyAgICBUb3RhbCBFZGl0aW5nIFRpbWUKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MEI6ICAgIC8vICAgIExhc3QgUHJpbnRlZAogICAgICAgICAgICAgICAgICAgIC8vICAgIE5vdCBzdXBwb3J0ZWQgYnkgUEhQRXhjZWwKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwQzogICAgLy8gICAgQ3JlYXRlZCBEYXRlL1RpbWUKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPmdldFByb3BlcnRpZXMoKS0+c2V0Q3JlYXRlZCgkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBEOiAgICAvLyAgICBNb2RpZmllZCBEYXRlL1RpbWUKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPmdldFByb3BlcnRpZXMoKS0+c2V0TW9kaWZpZWQoJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwRTogICAgLy8gICAgTnVtYmVyIG9mIFBhZ2VzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBGOiAgICAvLyAgICBOdW1iZXIgb2YgV29yZHMKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MTA6ICAgIC8vICAgIE51bWJlciBvZiBDaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDExOiAgICAvLyAgICBUaHVtYm5haWwKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MTI6ICAgIC8vICAgIE5hbWUgb2YgY3JlYXRpbmcgYXBwbGljYXRpb24KICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MTM6ICAgIC8vICAgIFNlY3VyaXR5CiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgYWRkaXRpb25hbCBkb2N1bWVudCBzdW1tYXJ5IGluZm9ybWF0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZERvY3VtZW50U3VtbWFyeUluZm9ybWF0aW9uKCkKICAgIHsKICAgICAgICBpZiAoIWlzc2V0KCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbikpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgb2Zmc2V0OiAwOyAgICBzaXplOiAyOyAgICBtdXN0IGJlIDB4RkUgMHhGRiAoVVRGLTE2IExFIGJ5dGUgb3JkZXIgbWFyaykKICAgICAgICAvLyAgICBvZmZzZXQ6IDI7ICAgIHNpemU6IDI7CiAgICAgICAgLy8gICAgb2Zmc2V0OiA0OyAgICBzaXplOiAyOyAgICBPUyB2ZXJzaW9uCiAgICAgICAgLy8gICAgb2Zmc2V0OiA2OyAgICBzaXplOiAyOyAgICBPUyBpbmRpY2F0b3IKICAgICAgICAvLyAgICBvZmZzZXQ6IDg7ICAgIHNpemU6IDE2CiAgICAgICAgLy8gICAgb2Zmc2V0OiAyNDsgICAgc2l6ZTogNDsgICAgc2VjdGlvbiBjb3VudAogICAgICAgICRzZWNDb3VudCA9IHNlbGY6OmdldEludDRkKCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiwgMjQpOwovLyAgICAgICAgZWNobyAnJHNlY0NvdW50ID0gJywgJHNlY0NvdW50LCc8YnIgLz4nOwoKICAgICAgICAvLyBvZmZzZXQ6IDI4OyAgICBzaXplOiAxNjsgICAgZmlyc3Qgc2VjdGlvbidzIGNsYXNzIGlkOiAwMiBkNSBjZCBkNSA5YyAyZSAxYiAxMCA5MyA5NyAwOCAwMCAyYiAyYyBmOSBhZQogICAgICAgIC8vIG9mZnNldDogNDQ7ICAgIHNpemU6IDQ7ICAgIGZpcnN0IHNlY3Rpb24gb2Zmc2V0CiAgICAgICAgJHNlY09mZnNldCA9IHNlbGY6OmdldEludDRkKCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiwgNDQpOwovLyAgICAgICAgZWNobyAnJHNlY09mZnNldCA9ICcsICRzZWNPZmZzZXQsJzxiciAvPic7CgogICAgICAgIC8vICAgIHNlY3Rpb24gaGVhZGVyCiAgICAgICAgLy8gICAgb2Zmc2V0OiAkc2VjT2Zmc2V0OyAgICBzaXplOiA0OyAgICBzZWN0aW9uIGxlbmd0aAogICAgICAgICRzZWNMZW5ndGggPSBzZWxmOjpnZXRJbnQ0ZCgkdGhpcy0+ZG9jdW1lbnRTdW1tYXJ5SW5mb3JtYXRpb24sICRzZWNPZmZzZXQpOwovLyAgICAgICAgZWNobyAnJHNlY0xlbmd0aCA9ICcsICRzZWNMZW5ndGgsJzxiciAvPic7CgogICAgICAgIC8vICAgIG9mZnNldDogJHNlY09mZnNldCs0OyAgICBzaXplOiA0OyAgICBwcm9wZXJ0eSBjb3VudAogICAgICAgICRjb3VudFByb3BlcnRpZXMgPSBzZWxmOjpnZXRJbnQ0ZCgkdGhpcy0+ZG9jdW1lbnRTdW1tYXJ5SW5mb3JtYXRpb24sICRzZWNPZmZzZXQrNCk7Ci8vICAgICAgICBlY2hvICckY291bnRQcm9wZXJ0aWVzID0gJywgJGNvdW50UHJvcGVydGllcywnPGJyIC8+JzsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSBjb2RlIHBhZ2UgKHVzZWQgdG8gcmVzb2x2ZSBzdHJpbmcgdmFsdWVzKQogICAgICAgICRjb2RlUGFnZSA9ICdDUDEyNTInOwoKICAgICAgICAvLyAgICBvZmZzZXQ6ICgkc2VjT2Zmc2V0KzgpOyAgICBzaXplOiB2YXIKICAgICAgICAvLyAgICBsb29wIHRocm91Z2ggcHJvcGVydHkgZGVjYXJhdGlvbnMgYW5kIHByb3BlcnRpZXMKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkY291bnRQcm9wZXJ0aWVzOyArKyRpKSB7Ci8vICAgICAgICAgICAgZWNobyAnUHJvcGVydHkgJywgJGksJzxiciAvPic7CiAgICAgICAgICAgIC8vICAgIG9mZnNldDogKCRzZWNPZmZzZXQrOCkgKyAoOCAqICRpKTsgICAgc2l6ZTogNDsgICAgcHJvcGVydHkgSUQKICAgICAgICAgICAgJGlkID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPmRvY3VtZW50U3VtbWFyeUluZm9ybWF0aW9uLCAoJHNlY09mZnNldCs4KSArICg4ICogJGkpKTsKLy8gICAgICAgICAgICBlY2hvICdJRCBpcyAnLCAkaWQsJzxiciAvPic7CgogICAgICAgICAgICAvLyBVc2UgdmFsdWUgb2YgcHJvcGVydHkgaWQgYXMgYXBwcm9wcmlhdGUKICAgICAgICAgICAgLy8gb2Zmc2V0OiA2MCArIDggKiAkaTsgICAgc2l6ZTogNDsgICAgb2Zmc2V0IGZyb20gYmVnaW5uaW5nIG9mIHNlY3Rpb24gKDQ4KQogICAgICAgICAgICAkb2Zmc2V0ID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPmRvY3VtZW50U3VtbWFyeUluZm9ybWF0aW9uLCAoJHNlY09mZnNldCsxMikgKyAoOCAqICRpKSk7CgogICAgICAgICAgICAkdHlwZSA9IHNlbGY6OmdldEludDRkKCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCArICRvZmZzZXQpOwovLyAgICAgICAgICAgIGVjaG8gJ1R5cGUgaXMgJywgJHR5cGUsJywgJzsKCiAgICAgICAgICAgIC8vIGluaXRpYWxpemUgcHJvcGVydHkgdmFsdWUKICAgICAgICAgICAgJHZhbHVlID0gbnVsbDsKCiAgICAgICAgICAgIC8vIGV4dHJhY3QgcHJvcGVydHkgdmFsdWUgYmFzZWQgb24gcHJvcGVydHkgdHlwZQogICAgICAgICAgICBzd2l0Y2ggKCR0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDI6ICAgIC8vICAgIDIgYnl0ZSBzaWduZWQgaW50ZWdlcgogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCArIDQgKyAkb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwMzogICAgLy8gICAgNCBieXRlIHNpZ25lZCBpbnRlZ2VyCiAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPmRvY3VtZW50U3VtbWFyeUluZm9ybWF0aW9uLCAkc2VjT2Zmc2V0ICsgNCArICRvZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBCOiAgLy8gQm9vbGVhbgogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCArIDQgKyAkb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSAoJHZhbHVlID09IDAgPyBmYWxzZSA6IHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDEzOiAgICAvLyAgICA0IGJ5dGUgdW5zaWduZWQgaW50ZWdlcgogICAgICAgICAgICAgICAgICAgIC8vIG5vdCBuZWVkZWQgeWV0LCBmaXggbGF0ZXIgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MUU6ICAgIC8vICAgIG51bGwtdGVybWluYXRlZCBzdHJpbmcgcHJlcGVuZGVkIGJ5IGR3b3JkIHN0cmluZyBsZW5ndGgKICAgICAgICAgICAgICAgICAgICAkYnl0ZUxlbmd0aCA9IHNlbGY6OmdldEludDRkKCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCArIDQgKyAkb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBzdWJzdHIoJHRoaXMtPmRvY3VtZW50U3VtbWFyeUluZm9ybWF0aW9uLCAkc2VjT2Zmc2V0ICsgOCArICRvZmZzZXQsICRieXRlTGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb252ZXJ0RW5jb2RpbmcoJHZhbHVlLCAnVVRGLTgnLCAkY29kZVBhZ2UpOwogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IHJ0cmltKCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4NDA6ICAgIC8vICAgIEZpbGV0aW1lICg2NC1iaXQgdmFsdWUgcmVwcmVzZW50aW5nIHRoZSBudW1iZXIgb2YgMTAwLW5hbm9zZWNvbmQgaW50ZXJ2YWxzIHNpbmNlIEphbnVhcnkgMSwgMTYwMSkKICAgICAgICAgICAgICAgICAgICAvLyBQSFAtVGltZQogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IFBIUEV4Y2VsX1NoYXJlZF9PTEU6Ok9MRTJMb2NhbERhdGUoc3Vic3RyKCR0aGlzLT5kb2N1bWVudFN1bW1hcnlJbmZvcm1hdGlvbiwgJHNlY09mZnNldCArIDQgKyAkb2Zmc2V0LCA4KSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4NDc6ICAgIC8vICAgIENsaXBib2FyZCBmb3JtYXQKICAgICAgICAgICAgICAgICAgICAvLyBub3QgbmVlZGVkIHlldCwgZml4IGxhdGVyIGlmIG5lY2Vzc2FyeQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKCRpZCkgewogICAgICAgICAgICAgICAgY2FzZSAweDAxOiAgICAvLyAgICBDb2RlIFBhZ2UKICAgICAgICAgICAgICAgICAgICAkY29kZVBhZ2UgPSBQSFBFeGNlbF9TaGFyZWRfQ29kZVBhZ2U6Ok51bWJlclRvTmFtZSgkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDAyOiAgICAvLyAgICBDYXRlZ29yeQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5waHBFeGNlbC0+Z2V0UHJvcGVydGllcygpLT5zZXRDYXRlZ29yeSgkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDAzOiAgICAvLyAgICBQcmVzZW50YXRpb24gVGFyZ2V0CiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDA0OiAgICAvLyAgICBCeXRlcwogICAgICAgICAgICAgICAgICAgIC8vICAgIE5vdCBzdXBwb3J0ZWQgYnkgUEhQRXhjZWwKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwNTogICAgLy8gICAgTGluZXMKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDY6ICAgIC8vICAgIFBhcmFncmFwaHMKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDc6ICAgIC8vICAgIFNsaWRlcwogICAgICAgICAgICAgICAgICAgIC8vICAgIE5vdCBzdXBwb3J0ZWQgYnkgUEhQRXhjZWwKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgwODogICAgLy8gICAgTm90ZXMKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MDk6ICAgIC8vICAgIEhpZGRlbiBTbGlkZXMKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MEE6ICAgIC8vICAgIE1NIENsaXBzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBCOiAgICAvLyAgICBTY2FsZSBDcm9wCiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBDOiAgICAvLyAgICBIZWFkaW5nIFBhaXJzCiAgICAgICAgICAgICAgICAgICAgLy8gICAgTm90IHN1cHBvcnRlZCBieSBQSFBFeGNlbAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBEOiAgICAvLyAgICBUaXRsZXMgb2YgUGFydHMKICAgICAgICAgICAgICAgICAgICAvLyAgICBOb3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MEU6ICAgIC8vICAgIE1hbmFnZXIKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPmdldFByb3BlcnRpZXMoKS0+c2V0TWFuYWdlcigkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDBGOiAgICAvLyAgICBDb21wYW55CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBocEV4Y2VsLT5nZXRQcm9wZXJ0aWVzKCktPnNldENvbXBhbnkoJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMHgxMDogICAgLy8gICAgTGlua3MgdXAtdG8tZGF0ZQogICAgICAgICAgICAgICAgICAgIC8vICAgIE5vdCBzdXBwb3J0ZWQgYnkgUEhQRXhjZWwKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkcyBhIGdlbmVyYWwgdHlwZSBvZiBCSUZGIHJlY29yZC4gRG9lcyBub3RoaW5nIGV4Y2VwdCBmb3IgbW92aW5nIHN0cmVhbSBwb2ludGVyIGZvcndhcmQgdG8gbmV4dCByZWNvcmQuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZERlZmF1bHQoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwovLyAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CiAgICB9CgoKICAgIC8qKgogICAgICogICAgVGhlIE5PVEUgcmVjb3JkIHNwZWNpZmllcyBhIGNvbW1lbnQgYXNzb2NpYXRlZCB3aXRoIGEgcGFydGljdWxhciBjZWxsLiBJbiBFeGNlbCA5NSAoQklGRjcpIGFuZCBlYXJsaWVyIHZlcnNpb25zLAogICAgICogICAgICAgIHRoaXMgcmVjb3JkIHN0b3JlcyBhIG5vdGUgKGNlbGwgbm90ZSkuIFRoaXMgZmVhdHVyZSB3YXMgc2lnbmlmaWNhbnRseSBlbmhhbmNlZCBpbiBFeGNlbCA5Ny4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkTm90ZSgpCiAgICB7Ci8vICAgICAgICBlY2hvICc8Yj5SZWFkIENlbGwgQW5ub3RhdGlvbjwvYj48YnIgLz4nOwogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAkY2VsbEFkZHJlc3MgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbEFkZHJlc3Moc3Vic3RyKCRyZWNvcmREYXRhLCAwLCA0KSk7CiAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAkbm90ZU9iaklEID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDYpOwogICAgICAgICAgICAkbm90ZUF1dGhvciA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nTG9uZyhzdWJzdHIoJHJlY29yZERhdGEsIDgpKTsKICAgICAgICAgICAgJG5vdGVBdXRob3IgPSAkbm90ZUF1dGhvclsndmFsdWUnXTsKLy8gICAgICAgICAgICBlY2hvICdOb3RlIEFkZHJlc3M9JywgJGNlbGxBZGRyZXNzLCc8YnIgLz4nOwovLyAgICAgICAgICAgIGVjaG8gJ05vdGUgT2JqZWN0IElEPScsICRub3RlT2JqSUQsJzxiciAvPic7Ci8vICAgICAgICAgICAgZWNobyAnTm90ZSBBdXRob3I9JywgJG5vdGVBdXRob3IsJzxociAvPic7Ci8vCiAgICAgICAgICAgICR0aGlzLT5jZWxsTm90ZXNbJG5vdGVPYmpJRF0gPSBhcnJheSgKICAgICAgICAgICAgICAgICdjZWxsUmVmJyAgID0+ICRjZWxsQWRkcmVzcywKICAgICAgICAgICAgICAgICdvYmplY3RJRCcgID0+ICRub3RlT2JqSUQsCiAgICAgICAgICAgICAgICAnYXV0aG9yJyAgICA9PiAkbm90ZUF1dGhvcgogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRleHRlbnNpb24gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKCRjZWxsQWRkcmVzcyA9PSAnJEIkNjU1MzYnKSB7CiAgICAgICAgICAgICAgICAvLyAgICBJZiB0aGUgYWRkcmVzcyByb3cgaXMgLTEgYW5kIHRoZSBjb2x1bW4gaXMgMCwgKHdoaWNoIHRyYW5zbGF0ZXMgYXMgJEIkNjU1MzYpIHRoZW4gdGhpcyBpcyBhIGNvbnRpbnVhdGlvbgogICAgICAgICAgICAgICAgLy8gICAgICAgIG5vdGUgZnJvbSB0aGUgcHJldmlvdXMgY2VsbCBhbm5vdGF0aW9uLiBXZSdyZSBub3QgeWV0IGhhbmRsaW5nIHRoaXMsIHNvIGFubm90YXRpb25zIGxvbmdlciB0aGFuIHRoZQogICAgICAgICAgICAgICAgLy8gICAgICAgIG1heCAyMDQ4IGJ5dGVzIHdpbGwgcHJvYmFibHkgdGhyb3cgYSB3b2JibHkuCiAgICAgICAgICAgICAgICAkcm93ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwogICAgICAgICAgICAgICAgJGV4dGVuc2lvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAkY2VsbEFkZHJlc3MgPSBhcnJheV9wb3AoYXJyYXlfa2V5cygkdGhpcy0+cGhwU2hlZXQtPmdldENvbW1lbnRzKCkpKTsKICAgICAgICAgICAgfQovLyAgICAgICAgICAgIGVjaG8gJ05vdGUgQWRkcmVzcz0nLCAkY2VsbEFkZHJlc3MsJzxiciAvPic7CgogICAgICAgICAgICAkY2VsbEFkZHJlc3MgPSBzdHJfcmVwbGFjZSgnJCcsICcnLCAkY2VsbEFkZHJlc3MpOwogICAgICAgICAgICAkbm90ZUxlbmd0aCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA0KTsKICAgICAgICAgICAgJG5vdGVUZXh0ID0gdHJpbShzdWJzdHIoJHJlY29yZERhdGEsIDYpKTsKLy8gICAgICAgICAgICBlY2hvICdOb3RlIExlbmd0aD0nLCAkbm90ZUxlbmd0aCwnPGJyIC8+JzsKLy8gICAgICAgICAgICBlY2hvICdOb3RlIFRleHQ9JywgJG5vdGVUZXh0LCc8YnIgLz4nOwoKICAgICAgICAgICAgaWYgKCRleHRlbnNpb24pIHsKICAgICAgICAgICAgICAgIC8vICAgIENvbmNhdGVuYXRlIHRoaXMgZXh0ZW5zaW9uIHdpdGggdGhlIGN1cnJlbnRseSBzZXQgY29tbWVudCBmb3IgdGhlIGNlbGwKICAgICAgICAgICAgICAgICRjb21tZW50ID0gJHRoaXMtPnBocFNoZWV0LT5nZXRDb21tZW50KCRjZWxsQWRkcmVzcyk7CiAgICAgICAgICAgICAgICAkY29tbWVudFRleHQgPSAkY29tbWVudC0+Z2V0VGV4dCgpLT5nZXRQbGFpblRleHQoKTsKICAgICAgICAgICAgICAgICRjb21tZW50LT5zZXRUZXh0KCR0aGlzLT5wYXJzZVJpY2hUZXh0KCRjb21tZW50VGV4dC4kbm90ZVRleHQpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vICAgIFNldCBjb21tZW50IGZvciB0aGUgY2VsbAogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRDb21tZW50KCRjZWxsQWRkcmVzcyktPnNldFRleHQoJHRoaXMtPnBhcnNlUmljaFRleHQoJG5vdGVUZXh0KSk7Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+c2V0QXV0aG9yKCRhdXRob3IpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKCiAgICAvKioKICAgICAqICAgIFRoZSBURVhUIE9iamVjdCByZWNvcmQgY29udGFpbnMgdGhlIHRleHQgYXNzb2NpYXRlZCB3aXRoIGEgY2VsbCBhbm5vdGF0aW9uLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRUZXh0T2JqZWN0KCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVjb3JkRGF0YSBjb25zaXN0cyBvZiBhbiBhcnJheSBvZiBzdWJyZWNvcmRzIGxvb2tpbmcgbGlrZSB0aGlzOgogICAgICAgIC8vICAgIGdyYml0OiAyIGJ5dGVzOyBPcHRpb24gRmxhZ3MKICAgICAgICAvLyAgICByb3Q6IDIgYnl0ZXM7IHJvdGF0aW9uCiAgICAgICAgLy8gICAgY2NoVGV4dDogMiBieXRlczsgbGVuZ3RoIG9mIHRoZSB0ZXh0IChpbiB0aGUgZmlyc3QgY29udGludWUgcmVjb3JkKQogICAgICAgIC8vICAgIGNiUnVuczogMiBieXRlczsgbGVuZ3RoIG9mIHRoZSBmb3JtYXR0aW5nIChpbiB0aGUgc2Vjb25kIGNvbnRpbnVlIHJlY29yZCkKICAgICAgICAvLyBmb2xsb3dlZCBieSB0aGUgY29udGludWF0aW9uIHJlY29yZHMgY29udGFpbmluZyB0aGUgYWN0dWFsIHRleHQgYW5kIGZvcm1hdHRpbmcKICAgICAgICAkZ3JiaXRPcHRzICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKICAgICAgICAkcm90ICAgICAgICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKICAgICAgICAkY2NoVGV4dCAgICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAxMCk7CiAgICAgICAgJGNiUnVucyAgICAgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMTIpOwogICAgICAgICR0ZXh0ICAgICAgID0gJHRoaXMtPmdldFNwbGljZWRSZWNvcmREYXRhKCk7CgogICAgICAgICR0aGlzLT50ZXh0T2JqZWN0c1skdGhpcy0+dGV4dE9ialJlZl0gPSBhcnJheSgKICAgICAgICAgICAgJ3RleHQnICAgICAgPT4gc3Vic3RyKCR0ZXh0WyJyZWNvcmREYXRhIl0sICR0ZXh0WyJzcGxpY2VPZmZzZXRzIl1bMF0rMSwgJGNjaFRleHQpLAogICAgICAgICAgICAnZm9ybWF0JyAgICA9PiBzdWJzdHIoJHRleHRbInJlY29yZERhdGEiXSwgJHRleHRbInNwbGljZU9mZnNldHMiXVsxXSwgJGNiUnVucyksCiAgICAgICAgICAgICdhbGlnbm1lbnQnID0+ICRncmJpdE9wdHMsCiAgICAgICAgICAgICdyb3RhdGlvbicgID0+ICRyb3QKICAgICAgICApOwoKLy8gICAgICAgIGVjaG8gJzxiPl9yZWFkVGV4dE9iamVjdCgpPC9iPjxiciAvPic7Ci8vICAgICAgICB2YXJfZHVtcCgkdGhpcy0+dGV4dE9iamVjdHNbJHRoaXMtPnRleHRPYmpSZWZdKTsKLy8gICAgICAgIGVjaG8gJzxiciAvPic7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBCT0YKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkQm9mKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9IHN1YnN0cigkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyB0eXBlIG9mIHRoZSBmb2xsb3dpbmcgZGF0YQogICAgICAgICRzdWJzdHJlYW1UeXBlID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwoKICAgICAgICBzd2l0Y2ggKCRzdWJzdHJlYW1UeXBlKSB7CiAgICAgICAgICAgIGNhc2Ugc2VsZjo6WExTX1dvcmtib29rR2xvYmFsczoKICAgICAgICAgICAgICAgICR2ZXJzaW9uID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwogICAgICAgICAgICAgICAgaWYgKCgkdmVyc2lvbiAhPSBzZWxmOjpYTFNfQklGRjgpICYmICgkdmVyc2lvbiAhPSBzZWxmOjpYTFNfQklGRjcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJ0Nhbm5vdCByZWFkIHRoaXMgRXhjZWwgZmlsZS4gVmVyc2lvbiBpcyB0b28gb2xkLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnZlcnNpb24gPSAkdmVyc2lvbjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHNlbGY6OlhMU19Xb3Jrc2hlZXQ6CiAgICAgICAgICAgICAgICAvLyBkbyBub3QgdXNlIHRoaXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmb3IgYW55dGhpbmcKICAgICAgICAgICAgICAgIC8vIGl0IGlzIHVucmVsaWFibGUgKE9wZW5PZmZpY2UgZG9jLCA1LjgpLCB1c2Ugb25seSB2ZXJzaW9uIGluZm9ybWF0aW9uIGZyb20gdGhlIGdsb2JhbCBzdHJlYW0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gc3Vic3RyZWFtLCBlLmcuIGNoYXJ0CiAgICAgICAgICAgICAgICAvLyBqdXN0IHNraXAgdGhlIGVudGlyZSBzdWJzdHJlYW0KICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAkY29kZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cmVhZERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKCRjb2RlICE9IHNlbGY6OlhMU19UWVBFX0VPRiAmJiAkdGhpcy0+cG9zIDwgJHRoaXMtPmRhdGFTaXplKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBGSUxFUEFTUwogICAgICoKICAgICAqIFRoaXMgcmVjb3JkIGlzIHBhcnQgb2YgdGhlIEZpbGUgUHJvdGVjdGlvbiBCbG9jay4gSXQKICAgICAqIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHRoZSByZWFkL3dyaXRlIHBhc3N3b3JkIG9mIHRoZQogICAgICogZmlsZS4gQWxsIHJlY29yZCBjb250ZW50cyBmb2xsb3dpbmcgdGhpcyByZWNvcmQgd2lsbCBiZQogICAgICogZW5jcnlwdGVkLgogICAgICoKICAgICAqIC0tICAgICJPcGVuT2ZmaWNlLm9yZydzIERvY3VtZW50YXRpb24gb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICBFeGNlbCBGaWxlIEZvcm1hdCIKICAgICAqCiAgICAgKiBUaGUgZGVjcnlwdGlvbiBmdW5jdGlvbnMgYW5kIG9iamVjdHMgdXNlZCBmcm9tIGhlcmUgb24gaW4KICAgICAqIGFyZSBiYXNlZCBvbiB0aGUgc291cmNlIG9mIFNwcmVhZHNoZWV0LVBhcnNlRXhjZWw6CiAgICAgKiBodHRwOi8vc2VhcmNoLmNwYW4ub3JnL35qbWNuYW1hcmEvU3ByZWFkc2hlZXQtUGFyc2VFeGNlbC8KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkRmlsZXBhc3MoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwoKICAgICAgICBpZiAoJGxlbmd0aCAhPSA1NCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbignVW5leHBlY3RlZCBmaWxlIHBhc3MgcmVjb3JkIGxlbmd0aCcpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwogICAgICAgIAogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT52ZXJpZnlQYXNzd29yZCgnVmVsdmV0U3dlYXRzaG9wJywgc3Vic3RyKCRyZWNvcmREYXRhLCA2LCAxNiksIHN1YnN0cigkcmVjb3JkRGF0YSwgMjIsIDE2KSwgc3Vic3RyKCRyZWNvcmREYXRhLCAzOCwgMTYpLCAkdGhpcy0+bWQ1Q3R4dCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJ0RlY3J5cHRpb24gcGFzc3dvcmQgaW5jb3JyZWN0Jyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICR0aGlzLT5lbmNyeXB0aW9uID0gc2VsZjo6TVNfQklGRl9DUllQVE9fUkM0OwoKICAgICAgICAvLyBEZWNyeXB0aW9uIHJlcXVpcmVkIGZyb20gdGhlIHJlY29yZCBhZnRlciBuZXh0IG9ud2FyZHMKICAgICAgICAkdGhpcy0+ZW5jcnlwdGlvblN0YXJ0UG9zID0gJHRoaXMtPnBvcyArIHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGFuIFJDNCBkZWNyeXB0b3IgZm9yIHRoZSBnaXZlbiBibG9jawogICAgICoKICAgICAqIEB2YXIgaW50ICAgICRibG9jayAgICAgIEJsb2NrIGZvciB3aGljaCB0byBjcmVhdGUgZGVjcnlwdG8KICAgICAqIEB2YXIgc3RyaW5nICR2YWxDb250ZXh0IE1ENSBjb250ZXh0IHN0YXRlCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X1JDNAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIG1ha2VLZXkoJGJsb2NrLCAkdmFsQ29udGV4dCkKICAgIHsKICAgICAgICAkcHdhcnJheSA9IHN0cl9yZXBlYXQoIlwwIiwgNjQpOwoKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCA1OyAkaSsrKSB7CiAgICAgICAgICAgICRwd2FycmF5WyRpXSA9ICR2YWxDb250ZXh0WyRpXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJHB3YXJyYXlbNV0gPSBjaHIoJGJsb2NrICYgMHhmZik7CiAgICAgICAgJHB3YXJyYXlbNl0gPSBjaHIoKCRibG9jayA+PiA4KSAmIDB4ZmYpOwogICAgICAgICRwd2FycmF5WzddID0gY2hyKCgkYmxvY2sgPj4gMTYpICYgMHhmZik7CiAgICAgICAgJHB3YXJyYXlbOF0gPSBjaHIoKCRibG9jayA+PiAyNCkgJiAweGZmKTsKCiAgICAgICAgJHB3YXJyYXlbOV0gPSAiXHg4MCI7CiAgICAgICAgJHB3YXJyYXlbNTZdID0gIlx4NDgiOwoKICAgICAgICAkbWQ1ID0gbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfTUQ1KCk7CiAgICAgICAgJG1kNS0+YWRkKCRwd2FycmF5KTsKCiAgICAgICAgJHMgPSAkbWQ1LT5nZXRDb250ZXh0KCk7CiAgICAgICAgcmV0dXJuIG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X1JDNCgkcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBWZXJpZnkgUkM0IGZpbGUgcGFzc3dvcmQKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZyAkcGFzc3dvcmQgICAgICAgIFBhc3N3b3JkIHRvIGNoZWNrCiAgICAgKiBAdmFyIHN0cmluZyAkZG9jaWQgICAgICAgICAgIERvY3VtZW50IGlkCiAgICAgKiBAdmFyIHN0cmluZyAkc2FsdF9kYXRhICAgICAgIFNhbHQgZGF0YQogICAgICogQHZhciBzdHJpbmcgJGhhc2hlZHNhbHRfZGF0YSBIYXNoZWQgc2FsdCBkYXRhCiAgICAgKiBAdmFyIHN0cmluZyAmJHZhbENvbnRleHQgICAgIFNldCB0byB0aGUgTUQ1IGNvbnRleHQgb2YgdGhlIHZhbHVlCiAgICAgKgogICAgICogQHJldHVybiBib29sIFN1Y2Nlc3MKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB2ZXJpZnlQYXNzd29yZCgkcGFzc3dvcmQsICRkb2NpZCwgJHNhbHRfZGF0YSwgJGhhc2hlZHNhbHRfZGF0YSwgJiR2YWxDb250ZXh0KQogICAgewogICAgICAgICRwd2FycmF5ID0gc3RyX3JlcGVhdCgiXDAiLCA2NCk7CgogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8IHN0cmxlbigkcGFzc3dvcmQpOyAkaSsrKSB7CiAgICAgICAgICAgICRvID0gb3JkKHN1YnN0cigkcGFzc3dvcmQsICRpLCAxKSk7CiAgICAgICAgICAgICRwd2FycmF5WzIgKiAkaV0gPSBjaHIoJG8gJiAweGZmKTsKICAgICAgICAgICAgJHB3YXJyYXlbMiAqICRpICsgMV0gPSBjaHIoKCRvID4+IDgpICYgMHhmZik7CiAgICAgICAgfQogICAgICAgICRwd2FycmF5WzIgKiAkaV0gPSBjaHIoMHg4MCk7CiAgICAgICAgJHB3YXJyYXlbNTZdID0gY2hyKCgkaSA8PCA0KSAmIDB4ZmYpOwoKICAgICAgICAkbWQ1ID0gbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfTUQ1KCk7CiAgICAgICAgJG1kNS0+YWRkKCRwd2FycmF5KTsKCiAgICAgICAgJG1kQ29udGV4dDEgPSAkbWQ1LT5nZXRDb250ZXh0KCk7CgogICAgICAgICRvZmZzZXQgPSAwOwogICAgICAgICRrZXlvZmZzZXQgPSAwOwogICAgICAgICR0b2NvcHkgPSA1OwoKICAgICAgICAkbWQ1LT5yZXNldCgpOwoKICAgICAgICB3aGlsZSAoJG9mZnNldCAhPSAxNikgewogICAgICAgICAgICBpZiAoKDY0IC0gJG9mZnNldCkgPCA1KSB7CiAgICAgICAgICAgICAgICAkdG9jb3B5ID0gNjQgLSAkb2Zmc2V0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8PSAkdG9jb3B5OyAkaSsrKSB7CiAgICAgICAgICAgICAgICAkcHdhcnJheVskb2Zmc2V0ICsgJGldID0gJG1kQ29udGV4dDFbJGtleW9mZnNldCArICRpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkb2Zmc2V0ICs9ICR0b2NvcHk7CgogICAgICAgICAgICBpZiAoJG9mZnNldCA9PSA2NCkgewogICAgICAgICAgICAgICAgJG1kNS0+YWRkKCRwd2FycmF5KTsKICAgICAgICAgICAgICAgICRrZXlvZmZzZXQgPSAkdG9jb3B5OwogICAgICAgICAgICAgICAgJHRvY29weSA9IDUgLSAkdG9jb3B5OwogICAgICAgICAgICAgICAgJG9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGtleW9mZnNldCA9IDA7CiAgICAgICAgICAgICR0b2NvcHkgPSA1OwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAxNjsgJGkrKykgewogICAgICAgICAgICAgICAgJHB3YXJyYXlbJG9mZnNldCArICRpXSA9ICRkb2NpZFskaV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG9mZnNldCArPSAxNjsKICAgICAgICB9CgogICAgICAgICRwd2FycmF5WzE2XSA9ICJceDgwIjsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCA0NzsgJGkrKykgewogICAgICAgICAgICAkcHdhcnJheVsxNyArICRpXSA9ICJcMCI7CiAgICAgICAgfQogICAgICAgICRwd2FycmF5WzU2XSA9ICJceDgwIjsKICAgICAgICAkcHdhcnJheVs1N10gPSAiXHgwYSI7CgogICAgICAgICRtZDUtPmFkZCgkcHdhcnJheSk7CiAgICAgICAgJHZhbENvbnRleHQgPSAkbWQ1LT5nZXRDb250ZXh0KCk7CgogICAgICAgICRrZXkgPSAkdGhpcy0+bWFrZUtleSgwLCAkdmFsQ29udGV4dCk7CgogICAgICAgICRzYWx0ID0gJGtleS0+UkM0KCRzYWx0X2RhdGEpOwogICAgICAgICRoYXNoZWRzYWx0ID0gJGtleS0+UkM0KCRoYXNoZWRzYWx0X2RhdGEpOwogICAgICAgIAogICAgICAgICRzYWx0IC49ICJceDgwIiAuIHN0cl9yZXBlYXQoIlwwIiwgNDcpOwogICAgICAgICRzYWx0WzU2XSA9ICJceDgwIjsKCiAgICAgICAgJG1kNS0+cmVzZXQoKTsKICAgICAgICAkbWQ1LT5hZGQoJHNhbHQpOwogICAgICAgICRtZENvbnRleHQyID0gJG1kNS0+Z2V0Q29udGV4dCgpOwoKICAgICAgICByZXR1cm4gJG1kQ29udGV4dDIgPT0gJGhhc2hlZHNhbHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBDT0RFUEFHRQogICAgICoKICAgICAqIFRoaXMgcmVjb3JkIHN0b3JlcyB0aGUgdGV4dCBlbmNvZGluZyB1c2VkIHRvIHdyaXRlIGJ5dGUKICAgICAqIHN0cmluZ3MsIHN0b3JlZCBhcyBNUyBXaW5kb3dzIGNvZGUgcGFnZSBpZGVudGlmaWVyLgogICAgICoKICAgICAqIC0tICAgICJPcGVuT2ZmaWNlLm9yZydzIERvY3VtZW50YXRpb24gb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICBFeGNlbCBGaWxlIEZvcm1hdCIKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkQ29kZXBhZ2UoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGNvZGUgcGFnZSBpZGVudGlmaWVyCiAgICAgICAgJGNvZGVwYWdlID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwoKICAgICAgICAkdGhpcy0+Y29kZXBhZ2UgPSBQSFBFeGNlbF9TaGFyZWRfQ29kZVBhZ2U6Ok51bWJlclRvTmFtZSgkY29kZXBhZ2UpOwogICAgfQoKCiAgICAvKioKICAgICAqIERBVEVNT0RFCiAgICAgKgogICAgICogVGhpcyByZWNvcmQgc3BlY2lmaWVzIHRoZSBiYXNlIGRhdGUgZm9yIGRpc3BsYXlpbmcgZGF0ZQogICAgICogdmFsdWVzLiBBbGwgZGF0ZXMgYXJlIHN0b3JlZCBhcyBjb3VudCBvZiBkYXlzIHBhc3QgdGhpcwogICAgICogYmFzZSBkYXRlLiBJbiBCSUZGMi1CSUZGNCB0aGlzIHJlY29yZCBpcyBwYXJ0IG9mIHRoZQogICAgICogQ2FsY3VsYXRpb24gU2V0dGluZ3MgQmxvY2suIEluIEJJRkY1LUJJRkY4IGl0IGlzCiAgICAgKiBzdG9yZWQgaW4gdGhlIFdvcmtib29rIEdsb2JhbHMgU3Vic3RyZWFtLgogICAgICoKICAgICAqIC0tICAgICJPcGVuT2ZmaWNlLm9yZydzIERvY3VtZW50YXRpb24gb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICBFeGNlbCBGaWxlIEZvcm1hdCIKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkRGF0ZU1vZGUoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IDAgPSBiYXNlIDE5MDAsIDEgPSBiYXNlIDE5MDQKICAgICAgICBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6c2V0RXhjZWxDYWxlbmRhcihQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6Q0FMRU5EQVJfV0lORE9XU18xOTAwKTsKICAgICAgICBpZiAob3JkKCRyZWNvcmREYXRhezB9KSA9PSAxKSB7CiAgICAgICAgICAgIFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpzZXRFeGNlbENhbGVuZGFyKFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpDQUxFTkRBUl9NQUNfMTkwNCk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgYSBGT05UIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRGb250KCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICRvYmpGb250ID0gbmV3IFBIUEV4Y2VsX1N0eWxlX0ZvbnQoKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgaGVpZ2h0IG9mIHRoZSBmb250IChpbiB0d2lwcyA9IDEvMjAgb2YgYSBwb2ludCkKICAgICAgICAgICAgJHNpemUgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CiAgICAgICAgICAgICRvYmpGb250LT5zZXRTaXplKCRzaXplIC8gMjApOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBvcHRpb24gZmxhZ3MKICAgICAgICAgICAgLy8gYml0OiAwOyBtYXNrIDB4MDAwMTsgYm9sZCAocmVkdW5kYW50IGluIEJJRkY1LUJJRkY4KQogICAgICAgICAgICAvLyBiaXQ6IDE7IG1hc2sgMHgwMDAyOyBpdGFsaWMKICAgICAgICAgICAgJGlzSXRhbGljID0gKDB4MDAwMiAmIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKSkgPj4gMTsKICAgICAgICAgICAgaWYgKCRpc0l0YWxpYykgewogICAgICAgICAgICAgICAgJG9iakZvbnQtPnNldEl0YWxpYyh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYml0OiAyOyBtYXNrIDB4MDAwNDsgdW5kZXJsaW5lZCAocmVkdW5kYW50IGluIEJJRkY1LUJJRkY4KQogICAgICAgICAgICAvLyBiaXQ6IDM7IG1hc2sgMHgwMDA4OyBzdHJpa2UKICAgICAgICAgICAgJGlzU3RyaWtlID0gKDB4MDAwOCAmIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKSkgPj4gMzsKICAgICAgICAgICAgaWYgKCRpc1N0cmlrZSkgewogICAgICAgICAgICAgICAgJG9iakZvbnQtPnNldFN0cmlrZXRocm91Z2godHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgY29sb3VyIGluZGV4CiAgICAgICAgICAgICRjb2xvckluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDQpOwogICAgICAgICAgICAkb2JqRm9udC0+Y29sb3JJbmRleCA9ICRjb2xvckluZGV4OwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA2OyBzaXplOiAyOyBmb250IHdlaWdodAogICAgICAgICAgICAkd2VpZ2h0ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDYpOwogICAgICAgICAgICBzd2l0Y2ggKCR3ZWlnaHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMHgwMkJDOgogICAgICAgICAgICAgICAgICAgICRvYmpGb250LT5zZXRCb2xkKHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDg7IHNpemU6IDI7IGVzY2FwZW1lbnQgdHlwZQogICAgICAgICAgICAkZXNjYXBlbWVudCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA4KTsKICAgICAgICAgICAgc3dpdGNoICgkZXNjYXBlbWVudCkgewogICAgICAgICAgICAgICAgY2FzZSAweDAwMDE6CiAgICAgICAgICAgICAgICAgICAgJG9iakZvbnQtPnNldFN1cGVyU2NyaXB0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDAwMDI6CiAgICAgICAgICAgICAgICAgICAgJG9iakZvbnQtPnNldFN1YlNjcmlwdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxMDsgc2l6ZTogMTsgdW5kZXJsaW5lIHR5cGUKICAgICAgICAgICAgJHVuZGVybGluZVR5cGUgPSBvcmQoJHJlY29yZERhdGF7MTB9KTsKICAgICAgICAgICAgc3dpdGNoICgkdW5kZXJsaW5lVHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBubyB1bmRlcmxpbmUKICAgICAgICAgICAgICAgIGNhc2UgMHgwMToKICAgICAgICAgICAgICAgICAgICAkb2JqRm9udC0+c2V0VW5kZXJsaW5lKFBIUEV4Y2VsX1N0eWxlX0ZvbnQ6OlVOREVSTElORV9TSU5HTEUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDAyOgogICAgICAgICAgICAgICAgICAgICRvYmpGb250LT5zZXRVbmRlcmxpbmUoUEhQRXhjZWxfU3R5bGVfRm9udDo6VU5ERVJMSU5FX0RPVUJMRSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MjE6CiAgICAgICAgICAgICAgICAgICAgJG9iakZvbnQtPnNldFVuZGVybGluZShQSFBFeGNlbF9TdHlsZV9Gb250OjpVTkRFUkxJTkVfU0lOR0xFQUNDT1VOVElORyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDB4MjI6CiAgICAgICAgICAgICAgICAgICAgJG9iakZvbnQtPnNldFVuZGVybGluZShQSFBFeGNlbF9TdHlsZV9Gb250OjpVTkRFUkxJTkVfRE9VQkxFQUNDT1VOVElORyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG9mZnNldDogMTE7IHNpemU6IDE7IGZvbnQgZmFtaWx5CiAgICAgICAgICAgIC8vIG9mZnNldDogMTI7IHNpemU6IDE7IGNoYXJhY3RlciBzZXQKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxMzsgc2l6ZTogMTsgbm90IHVzZWQKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxNDsgc2l6ZTogdmFyOyBmb250IG5hbWUKICAgICAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAgICAgJHN0cmluZyA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nU2hvcnQoc3Vic3RyKCRyZWNvcmREYXRhLCAxNCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHN0cmluZyA9ICR0aGlzLT5yZWFkQnl0ZVN0cmluZ1Nob3J0KHN1YnN0cigkcmVjb3JkRGF0YSwgMTQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkb2JqRm9udC0+c2V0TmFtZSgkc3RyaW5nWyd2YWx1ZSddKTsKCiAgICAgICAgICAgICR0aGlzLT5vYmpGb250c1tdID0gJG9iakZvbnQ7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIEZPUk1BVAogICAgICoKICAgICAqIFRoaXMgcmVjb3JkIGNvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IGEgbnVtYmVyIGZvcm1hdC4KICAgICAqIEFsbCBGT1JNQVQgcmVjb3JkcyBvY2N1ciB0b2dldGhlciBpbiBhIHNlcXVlbnRpYWwgbGlzdC4KICAgICAqCiAgICAgKiBJbiBCSUZGMi1CSUZGNCBvdGhlciByZWNvcmRzIHJlZmVyZW5jaW5nIGEgRk9STUFUIHJlY29yZAogICAgICogY29udGFpbiBhIHplcm8tYmFzZWQgaW5kZXggaW50byB0aGlzIGxpc3QuIEZyb20gQklGRjUgb24KICAgICAqIHRoZSBGT1JNQVQgcmVjb3JkIGNvbnRhaW5zIHRoZSBpbmRleCBpdHNlbGYgdGhhdCB3aWxsIGJlCiAgICAgKiB1c2VkIGJ5IG90aGVyIHJlY29yZHMuCiAgICAgKgogICAgICogLS0gICAgIk9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0CiAgICAgKiAgICAgICAgIEV4Y2VsIEZpbGUgRm9ybWF0IgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRGb3JtYXQoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgJGluZGV4Q29kZSA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgICAgIGlmICgkdGhpcy0+dmVyc2lvbiA9PSBzZWxmOjpYTFNfQklGRjgpIHsKICAgICAgICAgICAgICAgICRzdHJpbmcgPSBzZWxmOjpyZWFkVW5pY29kZVN0cmluZ0xvbmcoc3Vic3RyKCRyZWNvcmREYXRhLCAyKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBCSUZGNwogICAgICAgICAgICAgICAgJHN0cmluZyA9ICR0aGlzLT5yZWFkQnl0ZVN0cmluZ1Nob3J0KHN1YnN0cigkcmVjb3JkRGF0YSwgMikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZm9ybWF0U3RyaW5nID0gJHN0cmluZ1sndmFsdWUnXTsKICAgICAgICAgICAgJHRoaXMtPmZvcm1hdHNbJGluZGV4Q29kZV0gPSAkZm9ybWF0U3RyaW5nOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBYRiAtIEV4dGVuZGVkIEZvcm1hdAogICAgICoKICAgICAqIFRoaXMgcmVjb3JkIGNvbnRhaW5zIGZvcm1hdHRpbmcgaW5mb3JtYXRpb24gZm9yIGNlbGxzLCByb3dzLCBjb2x1bW5zIG9yIHN0eWxlcy4KICAgICAqIEFjY29yZGluZyB0byBodHRwOi8vc3VwcG9ydC5taWNyb3NvZnQuY29tL2tiLzE0NzczMiB0aGVyZSBhcmUgYWx3YXlzIGF0IGxlYXN0IDE1IGNlbGwgc3R5bGUgWEYKICAgICAqIGFuZCAxIGNlbGwgWEYuCiAgICAgKiBJbnNwZWN0aW9uIG9mIEV4Y2VsIGZpbGVzIGdlbmVyYXRlZCBieSBNUyBPZmZpY2UgRXhjZWwgc2hvd3MgdGhhdCBYRiByZWNvcmRzIDAtMTQgYXJlIGNlbGwgc3R5bGUgWEYKICAgICAqIGFuZCBYRiByZWNvcmQgMTUgaXMgYSBjZWxsIFhGCiAgICAgKiBXZSBvbmx5IHJlYWQgdGhlIGZpcnN0IGNlbGwgc3R5bGUgWEYgYW5kIHNraXAgdGhlIHJlbWFpbmluZyBjZWxsIHN0eWxlIFhGIHJlY29yZHMKICAgICAqIFdlIHJlYWQgYWxsIGNlbGwgWEYgcmVjb3Jkcy4KICAgICAqCiAgICAgKiAtLSAgICAiT3Blbk9mZmljZS5vcmcncyBEb2N1bWVudGF0aW9uIG9mIHRoZSBNaWNyb3NvZnQKICAgICAqICAgICAgICAgRXhjZWwgRmlsZSBGb3JtYXQiCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFhmKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgJG9ialN0eWxlID0gbmV3IFBIUEV4Y2VsX1N0eWxlKCk7CgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6ICAwOyBzaXplOiAyOyBJbmRleCB0byBGT05UIHJlY29yZAogICAgICAgICAgICBpZiAoc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApIDwgNCkgewogICAgICAgICAgICAgICAgJGZvbnRJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMgaGFzIHRvIGRvIHdpdGggdGhhdCBpbmRleCA0IGlzIG9taXR0ZWQgaW4gYWxsIEJJRkYgdmVyc2lvbnMgZm9yIHNvbWUgc3RyYW5nZSByZWFzb24KICAgICAgICAgICAgICAgIC8vIGNoZWNrIHRoZSBPcGVuT2ZmaWNlIGRvY3VtZW50YXRpb24gb2YgdGhlIEZPTlQgcmVjb3JkCiAgICAgICAgICAgICAgICAkZm9udEluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApIC0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkb2JqU3R5bGUtPnNldEZvbnQoJHRoaXMtPm9iakZvbnRzWyRmb250SW5kZXhdKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogIDI7IHNpemU6IDI7IEluZGV4IHRvIEZPUk1BVCByZWNvcmQKICAgICAgICAgICAgJG51bWJlckZvcm1hdEluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPmZvcm1hdHNbJG51bWJlckZvcm1hdEluZGV4XSkpIHsKICAgICAgICAgICAgICAgIC8vIHRoZW4gd2UgaGF2ZSB1c2VyLWRlZmluZWQgZm9ybWF0IGNvZGUKICAgICAgICAgICAgICAgICRudW1iZXJmb3JtYXQgPSBhcnJheSgnY29kZScgPT4gJHRoaXMtPmZvcm1hdHNbJG51bWJlckZvcm1hdEluZGV4XSk7CiAgICAgICAgICAgIH0gZWxzZWlmICgoJGNvZGUgPSBQSFBFeGNlbF9TdHlsZV9OdW1iZXJGb3JtYXQ6OmJ1aWx0SW5Gb3JtYXRDb2RlKCRudW1iZXJGb3JtYXRJbmRleCkpICE9PSAnJykgewogICAgICAgICAgICAgICAgLy8gdGhlbiB3ZSBoYXZlIGJ1aWx0LWluIGZvcm1hdCBjb2RlCiAgICAgICAgICAgICAgICAkbnVtYmVyZm9ybWF0ID0gYXJyYXkoJ2NvZGUnID0+ICRjb2RlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHdlIHNldCB0aGUgZ2VuZXJhbCBmb3JtYXQgY29kZQogICAgICAgICAgICAgICAgJG51bWJlcmZvcm1hdCA9IGFycmF5KCdjb2RlJyA9PiAnR2VuZXJhbCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0TnVtYmVyRm9ybWF0KCktPnNldEZvcm1hdENvZGUoJG51bWJlcmZvcm1hdFsnY29kZSddKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogIDQ7IHNpemU6IDI7IFhGIHR5cGUsIGNlbGwgcHJvdGVjdGlvbiwgYW5kIHBhcmVudCBzdHlsZSBYRgogICAgICAgICAgICAvLyBiaXQgMi0wOyBtYXNrIDB4MDAwNzsgWEZfVFlQRV9QUk9UCiAgICAgICAgICAgICR4ZlR5cGVQcm90ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDQpOwogICAgICAgICAgICAvLyBiaXQgMDsgbWFzayAweDAxOyAxID0gY2VsbCBpcyBsb2NrZWQKICAgICAgICAgICAgJGlzTG9ja2VkID0gKDB4MDEgJiAkeGZUeXBlUHJvdCkgPj4gMDsKICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRQcm90ZWN0aW9uKCktPnNldExvY2tlZCgkaXNMb2NrZWQgPyBQSFBFeGNlbF9TdHlsZV9Qcm90ZWN0aW9uOjpQUk9URUNUSU9OX0lOSEVSSVQgOiBQSFBFeGNlbF9TdHlsZV9Qcm90ZWN0aW9uOjpQUk9URUNUSU9OX1VOUFJPVEVDVEVEKTsKCiAgICAgICAgICAgIC8vIGJpdCAxOyBtYXNrIDB4MDI7IDEgPSBGb3JtdWxhIGlzIGhpZGRlbgogICAgICAgICAgICAkaXNIaWRkZW4gPSAoMHgwMiAmICR4ZlR5cGVQcm90KSA+PiAxOwogICAgICAgICAgICAkb2JqU3R5bGUtPmdldFByb3RlY3Rpb24oKS0+c2V0SGlkZGVuKCRpc0hpZGRlbiA\/IFBIUEV4Y2VsX1N0eWxlX1Byb3RlY3Rpb246OlBST1RFQ1RJT05fUFJPVEVDVEVEIDogUEhQRXhjZWxfU3R5bGVfUHJvdGVjdGlvbjo6UFJPVEVDVElPTl9VTlBST1RFQ1RFRCk7CgogICAgICAgICAgICAvLyBiaXQgMjsgbWFzayAweDA0OyAwID0gQ2VsbCBYRiwgMSA9IENlbGwgU3R5bGUgWEYKICAgICAgICAgICAgJGlzQ2VsbFN0eWxlWGYgPSAoMHgwNCAmICR4ZlR5cGVQcm90KSA+PiAyOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAgNjsgc2l6ZTogMTsgQWxpZ25tZW50IGFuZCB0ZXh0IGJyZWFrCiAgICAgICAgICAgIC8vIGJpdCAyLTAsIG1hc2sgMHgwNzsgaG9yaXpvbnRhbCBhbGlnbm1lbnQKICAgICAgICAgICAgJGhvckFsaWduID0gKDB4MDcgJiBvcmQoJHJlY29yZERhdGF7Nn0pKSA+PiAwOwogICAgICAgICAgICBzd2l0Y2ggKCRob3JBbGlnbikgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEhvcml6b250YWwoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0dFTkVSQUwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEhvcml6b250YWwoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0xFRlQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEhvcml6b250YWwoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0NFTlRFUik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRBbGlnbm1lbnQoKS0+c2V0SG9yaXpvbnRhbChQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfUklHSFQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEhvcml6b250YWwoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0ZJTEwpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEhvcml6b250YWwoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0pVU1RJRlkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEhvcml6b250YWwoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0NFTlRFUl9DT05USU5VT1VTKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBiaXQgMywgbWFzayAweDA4OyB3cmFwIHRleHQKICAgICAgICAgICAgJHdyYXBUZXh0ID0gKDB4MDggJiBvcmQoJHJlY29yZERhdGF7Nn0pKSA+PiAzOwogICAgICAgICAgICBzd2l0Y2ggKCR3cmFwVGV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldFdyYXBUZXh0KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRXcmFwVGV4dCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBiaXQgNi00LCBtYXNrIDB4NzA7IHZlcnRpY2FsIGFsaWdubWVudAogICAgICAgICAgICAkdmVydEFsaWduID0gKDB4NzAgJiBvcmQoJHJlY29yZERhdGF7Nn0pKSA+PiA0OwogICAgICAgICAgICBzd2l0Y2ggKCR2ZXJ0QWxpZ24pIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRWZXJ0aWNhbChQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OlZFUlRJQ0FMX1RPUCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRBbGlnbm1lbnQoKS0+c2V0VmVydGljYWwoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpWRVJUSUNBTF9DRU5URVIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldFZlcnRpY2FsKFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfQk9UVE9NKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRWZXJ0aWNhbChQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OlZFUlRJQ0FMX0pVU1RJRlkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJHRoaXMtPnZlcnNpb24gPT0gc2VsZjo6WExTX0JJRkY4KSB7CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6ICA3OyBzaXplOiAxOyBYRl9ST1RBVElPTjogVGV4dCByb3RhdGlvbiBhbmdsZQogICAgICAgICAgICAgICAgJGFuZ2xlID0gb3JkKCRyZWNvcmREYXRhezd9KTsKICAgICAgICAgICAgICAgICRyb3RhdGlvbiA9IDA7CiAgICAgICAgICAgICAgICBpZiAoJGFuZ2xlIDw9IDkwKSB7CiAgICAgICAgICAgICAgICAgICAgJHJvdGF0aW9uID0gJGFuZ2xlOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRhbmdsZSA8PSAxODApIHsKICAgICAgICAgICAgICAgICAgICAkcm90YXRpb24gPSA5MCAtICRhbmdsZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkYW5nbGUgPT0gMjU1KSB7CiAgICAgICAgICAgICAgICAgICAgJHJvdGF0aW9uID0gLTE2NTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldFRleHRSb3RhdGlvbigkcm90YXRpb24pOwoKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogIDg7IHNpemU6IDE7IEluZGVudGF0aW9uLCBzaHJpbmsgdG8gY2VsbCBzaXplLCBhbmQgdGV4dCBkaXJlY3Rpb24KICAgICAgICAgICAgICAgIC8vIGJpdDogMy0wOyBtYXNrOiAweDBGOyBpbmRlbnQgbGV2ZWwKICAgICAgICAgICAgICAgICRpbmRlbnQgPSAoMHgwRiAmIG9yZCgkcmVjb3JkRGF0YXs4fSkpID4+IDA7CiAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRJbmRlbnQoJGluZGVudCk7CgogICAgICAgICAgICAgICAgLy8gYml0OiA0OyBtYXNrOiAweDEwOyAxID0gc2hyaW5rIGNvbnRlbnQgdG8gZml0IGludG8gY2VsbAogICAgICAgICAgICAgICAgJHNocmlua1RvRml0ID0gKDB4MTAgJiBvcmQoJHJlY29yZERhdGF7OH0pKSA+PiA0OwogICAgICAgICAgICAgICAgc3dpdGNoICgkc2hyaW5rVG9GaXQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldFNocmlua1RvRml0KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRTaHJpbmtUb0ZpdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAgOTsgc2l6ZTogMTsgRmxhZ3MgdXNlZCBmb3IgYXR0cmlidXRlIGdyb3VwcwoKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTA7IHNpemU6IDQ7IENlbGwgYm9yZGVyIGxpbmVzIGFuZCBiYWNrZ3JvdW5kIGFyZWEKICAgICAgICAgICAgICAgIC8vIGJpdDogMy0wOyBtYXNrOiAweDAwMDAwMDBGOyBsZWZ0IHN0eWxlCiAgICAgICAgICAgICAgICBpZiAoJGJvcmRlcnNMZWZ0U3R5bGUgPSBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X1N0eWxlX0JvcmRlcjo6bG9va3VwKCgweDAwMDAwMDBGICYgc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDEwKSkgPj4gMCkpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0TGVmdCgpLT5zZXRCb3JkZXJTdHlsZSgkYm9yZGVyc0xlZnRTdHlsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBiaXQ6IDctNDsgbWFzazogMHgwMDAwMDBGMDsgcmlnaHQgc3R5bGUKICAgICAgICAgICAgICAgIGlmICgkYm9yZGVyc1JpZ2h0U3R5bGUgPSBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X1N0eWxlX0JvcmRlcjo6bG9va3VwKCgweDAwMDAwMEYwICYgc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDEwKSkgPj4gNCkpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0UmlnaHQoKS0+c2V0Qm9yZGVyU3R5bGUoJGJvcmRlcnNSaWdodFN0eWxlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGJpdDogMTEtODsgbWFzazogMHgwMDAwMEYwMDsgdG9wIHN0eWxlCiAgICAgICAgICAgICAgICBpZiAoJGJvcmRlcnNUb3BTdHlsZSA9IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfU3R5bGVfQm9yZGVyOjpsb29rdXAoKDB4MDAwMDBGMDAgJiBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgMTApKSA+PiA4KSkgewogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRUb3AoKS0+c2V0Qm9yZGVyU3R5bGUoJGJvcmRlcnNUb3BTdHlsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBiaXQ6IDE1LTEyOyBtYXNrOiAweDAwMDBGMDAwOyBib3R0b20gc3R5bGUKICAgICAgICAgICAgICAgIGlmICgkYm9yZGVyc0JvdHRvbVN0eWxlID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9TdHlsZV9Cb3JkZXI6Omxvb2t1cCgoMHgwMDAwRjAwMCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMCkpID4+IDEyKSkgewogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRCb3R0b20oKS0+c2V0Qm9yZGVyU3R5bGUoJGJvcmRlcnNCb3R0b21TdHlsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBiaXQ6IDIyLTE2OyBtYXNrOiAweDAwN0YwMDAwOyBsZWZ0IGNvbG9yCiAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0TGVmdCgpLT5jb2xvckluZGV4ID0gKDB4MDA3RjAwMDAgJiBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgMTApKSA+PiAxNjsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDI5LTIzOyBtYXNrOiAweDNGODAwMDAwOyByaWdodCBjb2xvcgogICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPmdldFJpZ2h0KCktPmNvbG9ySW5kZXggPSAoMHgzRjgwMDAwMCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMCkpID4+IDIzOwoKICAgICAgICAgICAgICAgIC8vIGJpdDogMzA7IG1hc2s6IDB4NDAwMDAwMDA7IDEgPSBkaWFnb25hbCBsaW5lIGZyb20gdG9wIGxlZnQgdG8gcmlnaHQgYm90dG9tCiAgICAgICAgICAgICAgICAkZGlhZ29uYWxEb3duID0gKDB4NDAwMDAwMDAgJiBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgMTApKSA+PiAzMCA\/IHRydWUgOiBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDMxOyBtYXNrOiAweDgwMDAwMDAwOyAxID0gZGlhZ29uYWwgbGluZSBmcm9tIGJvdHRvbSBsZWZ0IHRvIHRvcCByaWdodAogICAgICAgICAgICAgICAgJGRpYWdvbmFsVXAgPSAoMHg4MDAwMDAwMCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMCkpID4+IDMxID8gdHJ1ZSA6IGZhbHNlOwoKICAgICAgICAgICAgICAgIGlmICgkZGlhZ29uYWxVcCA9PSBmYWxzZSAmJiAkZGlhZ29uYWxEb3duID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPnNldERpYWdvbmFsRGlyZWN0aW9uKFBIUEV4Y2VsX1N0eWxlX0JvcmRlcnM6OkRJQUdPTkFMX05PTkUpOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRkaWFnb25hbFVwID09IHRydWUgJiYgJGRpYWdvbmFsRG93biA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5zZXREaWFnb25hbERpcmVjdGlvbihQSFBFeGNlbF9TdHlsZV9Cb3JkZXJzOjpESUFHT05BTF9VUCk7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRpYWdvbmFsVXAgPT0gZmFsc2UgJiYgJGRpYWdvbmFsRG93biA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPnNldERpYWdvbmFsRGlyZWN0aW9uKFBIUEV4Y2VsX1N0eWxlX0JvcmRlcnM6OkRJQUdPTkFMX0RPV04pOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRkaWFnb25hbFVwID09IHRydWUgJiYgJGRpYWdvbmFsRG93biA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPnNldERpYWdvbmFsRGlyZWN0aW9uKFBIUEV4Y2VsX1N0eWxlX0JvcmRlcnM6OkRJQUdPTkFMX0JPVEgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTQ7IHNpemU6IDQ7CiAgICAgICAgICAgICAgICAvLyBiaXQ6IDYtMDsgbWFzazogMHgwMDAwMDA3RjsgdG9wIGNvbG9yCiAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0VG9wKCktPmNvbG9ySW5kZXggPSAoMHgwMDAwMDA3RiAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxNCkpID4+IDA7CgogICAgICAgICAgICAgICAgLy8gYml0OiAxMy03OyBtYXNrOiAweDAwMDAzRjgwOyBib3R0b20gY29sb3IKICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRCb3R0b20oKS0+Y29sb3JJbmRleCA9ICgweDAwMDAzRjgwICYgc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDE0KSkgPj4gNzsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDIwLTE0OyBtYXNrOiAweDAwMUZDMDAwOyBkaWFnb25hbCBjb2xvcgogICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPmdldERpYWdvbmFsKCktPmNvbG9ySW5kZXggPSAoMHgwMDFGQzAwMCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxNCkpID4+IDE0OwoKICAgICAgICAgICAgICAgIC8vIGJpdDogMjQtMjE7IG1hc2s6IDB4MDFFMDAwMDA7IGRpYWdvbmFsIHN0eWxlCiAgICAgICAgICAgICAgICBpZiAoJGJvcmRlcnNEaWFnb25hbFN0eWxlID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9TdHlsZV9Cb3JkZXI6Omxvb2t1cCgoMHgwMUUwMDAwMCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxNCkpID4+IDIxKSkgewogICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXREaWFnb25hbCgpLT5zZXRCb3JkZXJTdHlsZSgkYm9yZGVyc0RpYWdvbmFsU3R5bGUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGJpdDogMzEtMjY7IG1hc2s6IDB4RkMwMDAwMDAgZmlsbCBwYXR0ZXJuCiAgICAgICAgICAgICAgICBpZiAoJGZpbGxUeXBlID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9TdHlsZV9GaWxsUGF0dGVybjo6bG9va3VwKCgweEZDMDAwMDAwICYgc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDE0KSkgPj4gMjYpKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRGaWxsKCktPnNldEZpbGxUeXBlKCRmaWxsVHlwZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDE4OyBzaXplOiAyOyBwYXR0ZXJuIGFuZCBiYWNrZ3JvdW5kIGNvbG91cgogICAgICAgICAgICAgICAgLy8gYml0OiA2LTA7IG1hc2s6IDB4MDA3RjsgY29sb3IgaW5kZXggZm9yIHBhdHRlcm4gY29sb3IKICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0RmlsbCgpLT5zdGFydGNvbG9ySW5kZXggPSAoMHgwMDdGICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDE4KSkgPj4gMDsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDEzLTc7IG1hc2s6IDB4M0Y4MDsgY29sb3IgaW5kZXggZm9yIHBhdHRlcm4gYmFja2dyb3VuZAogICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRGaWxsKCktPmVuZGNvbG9ySW5kZXggPSAoMHgzRjgwICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDE4KSkgPj4gNzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEJJRkY1CgogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiA3OyBzaXplOiAxOyBUZXh0IG9yaWVudGF0aW9uIGFuZCBmbGFncwogICAgICAgICAgICAgICAgJG9yaWVudGF0aW9uQW5kRmxhZ3MgPSBvcmQoJHJlY29yZERhdGF7N30pOwoKICAgICAgICAgICAgICAgIC8vIGJpdDogMS0wOyBtYXNrOiAweDAzOyBYRl9PUklFTlRBVElPTjogVGV4dCBvcmllbnRhdGlvbgogICAgICAgICAgICAgICAgJHhmT3JpZW50YXRpb24gPSAoMHgwMyAmICRvcmllbnRhdGlvbkFuZEZsYWdzKSA+PiAwOwogICAgICAgICAgICAgICAgc3dpdGNoICgkeGZPcmllbnRhdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRBbGlnbm1lbnQoKS0+c2V0VGV4dFJvdGF0aW9uKDApOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldFRleHRSb3RhdGlvbigtMTY1KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRUZXh0Um90YXRpb24oOTApOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldFRleHRSb3RhdGlvbigtOTApOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDg7IHNpemU6IDQ7IGNlbGwgYm9yZGVyIGxpbmVzIGFuZCBiYWNrZ3JvdW5kIGFyZWEKICAgICAgICAgICAgICAgICRib3JkZXJBbmRCYWNrZ3JvdW5kID0gc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDgpOwoKICAgICAgICAgICAgICAgIC8vIGJpdDogNi0wOyBtYXNrOiAweDAwMDAwMDdGOyBjb2xvciBpbmRleCBmb3IgcGF0dGVybiBjb2xvcgogICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRGaWxsKCktPnN0YXJ0Y29sb3JJbmRleCA9ICgweDAwMDAwMDdGICYgJGJvcmRlckFuZEJhY2tncm91bmQpID4+IDA7CgogICAgICAgICAgICAgICAgLy8gYml0OiAxMy03OyBtYXNrOiAweDAwMDAzRjgwOyBjb2xvciBpbmRleCBmb3IgcGF0dGVybiBiYWNrZ3JvdW5kCiAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEZpbGwoKS0+ZW5kY29sb3JJbmRleCA9ICgweDAwMDAzRjgwICYgJGJvcmRlckFuZEJhY2tncm91bmQpID4+IDc7CgogICAgICAgICAgICAgICAgLy8gYml0OiAyMS0xNjsgbWFzazogMHgwMDNGMDAwMDsgZmlsbCBwYXR0ZXJuCiAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEZpbGwoKS0+c2V0RmlsbFR5cGUoUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9TdHlsZV9GaWxsUGF0dGVybjo6bG9va3VwKCgweDAwM0YwMDAwICYgJGJvcmRlckFuZEJhY2tncm91bmQpID4+IDE2KSk7CgogICAgICAgICAgICAgICAgLy8gYml0OiAyNC0yMjsgbWFzazogMHgwMUMwMDAwMDsgYm90dG9tIGxpbmUgc3R5bGUKICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRCb3R0b20oKS0+c2V0Qm9yZGVyU3R5bGUoUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9TdHlsZV9Cb3JkZXI6Omxvb2t1cCgoMHgwMUMwMDAwMCAmICRib3JkZXJBbmRCYWNrZ3JvdW5kKSA+PiAyMikpOwoKICAgICAgICAgICAgICAgIC8vIGJpdDogMzEtMjU7IG1hc2s6IDB4RkUwMDAwMDA7IGJvdHRvbSBsaW5lIGNvbG9yCiAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0Qm90dG9tKCktPmNvbG9ySW5kZXggPSAoMHhGRTAwMDAwMCAmICRib3JkZXJBbmRCYWNrZ3JvdW5kKSA+PiAyNTsKCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDEyOyBzaXplOiA0OyBjZWxsIGJvcmRlciBsaW5lcwogICAgICAgICAgICAgICAgJGJvcmRlckxpbmVzID0gc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDEyKTsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDItMDsgbWFzazogMHgwMDAwMDAwNzsgdG9wIGxpbmUgc3R5bGUKICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRUb3AoKS0+c2V0Qm9yZGVyU3R5bGUoUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9TdHlsZV9Cb3JkZXI6Omxvb2t1cCgoMHgwMDAwMDAwNyAmICRib3JkZXJMaW5lcykgPj4gMCkpOwoKICAgICAgICAgICAgICAgIC8vIGJpdDogNS0zOyBtYXNrOiAweDAwMDAwMDM4OyBsZWZ0IGxpbmUgc3R5bGUKICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRMZWZ0KCktPnNldEJvcmRlclN0eWxlKFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfU3R5bGVfQm9yZGVyOjpsb29rdXAoKDB4MDAwMDAwMzggJiAkYm9yZGVyTGluZXMpID4+IDMpKTsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDgtNjsgbWFzazogMHgwMDAwMDFDMDsgcmlnaHQgbGluZSBzdHlsZQogICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPmdldFJpZ2h0KCktPnNldEJvcmRlclN0eWxlKFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDVfU3R5bGVfQm9yZGVyOjpsb29rdXAoKDB4MDAwMDAxQzAgJiAkYm9yZGVyTGluZXMpID4+IDYpKTsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDE1LTk7IG1hc2s6IDB4MDAwMEZFMDA7IHRvcCBsaW5lIGNvbG9yIGluZGV4CiAgICAgICAgICAgICAgICAkb2JqU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0VG9wKCktPmNvbG9ySW5kZXggPSAoMHgwMDAwRkUwMCAmICRib3JkZXJMaW5lcykgPj4gOTsKCiAgICAgICAgICAgICAgICAvLyBiaXQ6IDIyLTE2OyBtYXNrOiAweDAwN0YwMDAwOyBsZWZ0IGxpbmUgY29sb3IgaW5kZXgKICAgICAgICAgICAgICAgICRvYmpTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRMZWZ0KCktPmNvbG9ySW5kZXggPSAoMHgwMDdGMDAwMCAmICRib3JkZXJMaW5lcykgPj4gMTY7CgogICAgICAgICAgICAgICAgLy8gYml0OiAyOS0yMzsgbWFzazogMHgzRjgwMDAwMDsgcmlnaHQgbGluZSBjb2xvciBpbmRleAogICAgICAgICAgICAgICAgJG9ialN0eWxlLT5nZXRCb3JkZXJzKCktPmdldFJpZ2h0KCktPmNvbG9ySW5kZXggPSAoMHgzRjgwMDAwMCAmICRib3JkZXJMaW5lcykgPj4gMjM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFkZCBjZWxsU3R5bGVYZiBvciBjZWxsWGYgYW5kIHVwZGF0ZSBtYXBwaW5nCiAgICAgICAgICAgIGlmICgkaXNDZWxsU3R5bGVYZikgewogICAgICAgICAgICAgICAgLy8gd2Ugb25seSByZWFkIG9uZSBzdHlsZSBYRiByZWNvcmQgd2hpY2ggaXMgYWx3YXlzIHRoZSBmaXJzdAogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT54ZkluZGV4ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPmFkZENlbGxTdHlsZVhmKCRvYmpTdHlsZSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm1hcENlbGxTdHlsZVhmSW5kZXhbJHRoaXMtPnhmSW5kZXhdID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHdlIHJlYWQgYWxsIGNlbGwgWEYgcmVjb3JkcwogICAgICAgICAgICAgICAgJHRoaXMtPnBocEV4Y2VsLT5hZGRDZWxsWGYoJG9ialN0eWxlKTsKICAgICAgICAgICAgICAgICR0aGlzLT5tYXBDZWxsWGZJbmRleFskdGhpcy0+eGZJbmRleF0gPSBjb3VudCgkdGhpcy0+cGhwRXhjZWwtPmdldENlbGxYZkNvbGxlY3Rpb24oKSkgLSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB1cGRhdGUgWEYgaW5kZXggZm9yIHdoZW4gd2UgcmVhZCBuZXh0IHJlY29yZAogICAgICAgICAgICArKyR0aGlzLT54ZkluZGV4OwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRYZkV4dCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IDB4MDg3RCA9IHJlcGVhdGVkIGhlYWRlcgoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyCgogICAgICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDg7IG5vdCB1c2VkCgogICAgICAgICAgICAvLyBvZmZzZXQ6IDEyOyBzaXplOiAyOyByZWNvcmQgdmVyc2lvbgoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxNDsgc2l6ZTogMjsgaW5kZXggdG8gWEYgcmVjb3JkIHdoaWNoIHRoaXMgcmVjb3JkIG1vZGlmaWVzCiAgICAgICAgICAgICRpeGZlID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDE0KTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMTY7IHNpemU6IDI7IG5vdCB1c2VkCgogICAgICAgICAgICAvLyBvZmZzZXQ6IDE4OyBzaXplOiAyOyBudW1iZXIgb2YgZXh0ZW5zaW9uIHByb3BlcnRpZXMgdGhhdCBmb2xsb3cKICAgICAgICAgICAgJGNleHRzID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDE4KTsKCiAgICAgICAgICAgIC8vIHN0YXJ0IHJlYWRpbmcgdGhlIGFjdHVhbCBleHRlbnNpb24gZGF0YQogICAgICAgICAgICAkb2Zmc2V0ID0gMjA7CiAgICAgICAgICAgIHdoaWxlICgkb2Zmc2V0IDwgJGxlbmd0aCkgewogICAgICAgICAgICAgICAgLy8gZXh0ZW5zaW9uIHR5cGUKICAgICAgICAgICAgICAgICRleHRUeXBlID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsICRvZmZzZXQpOwoKICAgICAgICAgICAgICAgIC8vIGV4dGVuc2lvbiBsZW5ndGgKICAgICAgICAgICAgICAgICRjYiA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAkb2Zmc2V0ICsgMik7CgogICAgICAgICAgICAgICAgLy8gZXh0ZW5zaW9uIGRhdGEKICAgICAgICAgICAgICAgICRleHREYXRhID0gc3Vic3RyKCRyZWNvcmREYXRhLCAkb2Zmc2V0ICsgNCwgJGNiKTsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRleHRUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OiAgICAgICAgLy8gZmlsbCBzdGFydCBjb2xvcgogICAgICAgICAgICAgICAgICAgICAgICAkeGNsZlR5cGUgID0gc2VsZjo6Z2V0SW50MmQoJGV4dERhdGEsIDApOyAvLyBjb2xvciB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICR4Y2xyVmFsdWUgPSBzdWJzdHIoJGV4dERhdGEsIDQsIDQpOyAvLyBjb2xvciB2YWx1ZSAodmFsdWUgYmFzZWQgb24gY29sb3IgdHlwZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeGNsZlR5cGUgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJnYiA9IHNwcmludGYoJyUwMlglMDJYJTAyWCcsIG9yZCgkeGNsclZhbHVlezB9KSwgb3JkKCR4Y2xyVmFsdWV7MX0pLCBvcmQoJHhjbHJWYWx1ZXsyfSkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vZGlmeSB0aGUgcmVsZXZhbnQgc3R5bGUgcHJvcGVydHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+bWFwQ2VsbFhmSW5kZXhbJGl4ZmVdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWxsID0gJHRoaXMtPnBocEV4Y2VsLT5nZXRDZWxsWGZCeUluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskaXhmZV0pLT5nZXRGaWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGwtPmdldFN0YXJ0Q29sb3IoKS0+c2V0UkdCKCRyZ2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRmaWxsLT5zdGFydGNvbG9ySW5kZXgpOyAvLyBub3JtYWwgY29sb3IgaW5kZXggZG9lcyBub3QgYXBwbHksIGRpc2NhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDU6ICAgICAgICAvLyBmaWxsIGVuZCBjb2xvcgogICAgICAgICAgICAgICAgICAgICAgICAkeGNsZlR5cGUgID0gc2VsZjo6Z2V0SW50MmQoJGV4dERhdGEsIDApOyAvLyBjb2xvciB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICR4Y2xyVmFsdWUgPSBzdWJzdHIoJGV4dERhdGEsIDQsIDQpOyAvLyBjb2xvciB2YWx1ZSAodmFsdWUgYmFzZWQgb24gY29sb3IgdHlwZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeGNsZlR5cGUgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJnYiA9IHNwcmludGYoJyUwMlglMDJYJTAyWCcsIG9yZCgkeGNsclZhbHVlezB9KSwgb3JkKCR4Y2xyVmFsdWV7MX0pLCBvcmQoJHhjbHJWYWx1ZXsyfSkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vZGlmeSB0aGUgcmVsZXZhbnQgc3R5bGUgcHJvcGVydHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+bWFwQ2VsbFhmSW5kZXhbJGl4ZmVdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWxsID0gJHRoaXMtPnBocEV4Y2VsLT5nZXRDZWxsWGZCeUluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskaXhmZV0pLT5nZXRGaWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGwtPmdldEVuZENvbG9yKCktPnNldFJHQigkcmdiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNldCgkZmlsbC0+ZW5kY29sb3JJbmRleCk7IC8vIG5vcm1hbCBjb2xvciBpbmRleCBkb2VzIG5vdCBhcHBseSwgZGlzY2FyZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzogICAgICAgIC8vIGJvcmRlciBjb2xvciB0b3AKICAgICAgICAgICAgICAgICAgICAgICAgJHhjbGZUeXBlICA9IHNlbGY6OmdldEludDJkKCRleHREYXRhLCAwKTsgLy8gY29sb3IgdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAkeGNsclZhbHVlID0gc3Vic3RyKCRleHREYXRhLCA0LCA0KTsgLy8gY29sb3IgdmFsdWUgKHZhbHVlIGJhc2VkIG9uIGNvbG9yIHR5cGUpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhjbGZUeXBlID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZ2IgPSBzcHJpbnRmKCclMDJYJTAyWCUwMlgnLCBvcmQoJHhjbHJWYWx1ZXswfSksIG9yZCgkeGNsclZhbHVlezF9KSwgb3JkKCR4Y2xyVmFsdWV7Mn0pKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtb2RpZnkgdGhlIHJlbGV2YW50IHN0eWxlIHByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPm1hcENlbGxYZkluZGV4WyRpeGZlXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9wID0gJHRoaXMtPnBocEV4Y2VsLT5nZXRDZWxsWGZCeUluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskaXhmZV0pLT5nZXRCb3JkZXJzKCktPmdldFRvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3AtPmdldENvbG9yKCktPnNldFJHQigkcmdiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNldCgkdG9wLT5jb2xvckluZGV4KTsgLy8gbm9ybWFsIGNvbG9yIGluZGV4IGRvZXMgbm90IGFwcGx5LCBkaXNjYXJkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OiAgICAgICAgLy8gYm9yZGVyIGNvbG9yIGJvdHRvbQogICAgICAgICAgICAgICAgICAgICAgICAkeGNsZlR5cGUgID0gc2VsZjo6Z2V0SW50MmQoJGV4dERhdGEsIDApOyAvLyBjb2xvciB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICR4Y2xyVmFsdWUgPSBzdWJzdHIoJGV4dERhdGEsIDQsIDQpOyAvLyBjb2xvciB2YWx1ZSAodmFsdWUgYmFzZWQgb24gY29sb3IgdHlwZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeGNsZlR5cGUgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJnYiA9IHNwcmludGYoJyUwMlglMDJYJTAyWCcsIG9yZCgkeGNsclZhbHVlezB9KSwgb3JkKCR4Y2xyVmFsdWV7MX0pLCBvcmQoJHhjbHJWYWx1ZXsyfSkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vZGlmeSB0aGUgcmVsZXZhbnQgc3R5bGUgcHJvcGVydHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+bWFwQ2VsbFhmSW5kZXhbJGl4ZmVdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRib3R0b20gPSAkdGhpcy0+cGhwRXhjZWwtPmdldENlbGxYZkJ5SW5kZXgoJHRoaXMtPm1hcENlbGxYZkluZGV4WyRpeGZlXSktPmdldEJvcmRlcnMoKS0+Z2V0Qm90dG9tKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJvdHRvbS0+Z2V0Q29sb3IoKS0+c2V0UkdCKCRyZ2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRib3R0b20tPmNvbG9ySW5kZXgpOyAvLyBub3JtYWwgY29sb3IgaW5kZXggZG9lcyBub3QgYXBwbHksIGRpc2NhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk6ICAgICAgICAvLyBib3JkZXIgY29sb3IgbGVmdAogICAgICAgICAgICAgICAgICAgICAgICAkeGNsZlR5cGUgID0gc2VsZjo6Z2V0SW50MmQoJGV4dERhdGEsIDApOyAvLyBjb2xvciB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICR4Y2xyVmFsdWUgPSBzdWJzdHIoJGV4dERhdGEsIDQsIDQpOyAvLyBjb2xvciB2YWx1ZSAodmFsdWUgYmFzZWQgb24gY29sb3IgdHlwZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeGNsZlR5cGUgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJnYiA9IHNwcmludGYoJyUwMlglMDJYJTAyWCcsIG9yZCgkeGNsclZhbHVlezB9KSwgb3JkKCR4Y2xyVmFsdWV7MX0pLCBvcmQoJHhjbHJWYWx1ZXsyfSkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vZGlmeSB0aGUgcmVsZXZhbnQgc3R5bGUgcHJvcGVydHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+bWFwQ2VsbFhmSW5kZXhbJGl4ZmVdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZWZ0ID0gJHRoaXMtPnBocEV4Y2VsLT5nZXRDZWxsWGZCeUluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskaXhmZV0pLT5nZXRCb3JkZXJzKCktPmdldExlZnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVmdC0+Z2V0Q29sb3IoKS0+c2V0UkdCKCRyZ2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRsZWZ0LT5jb2xvckluZGV4KTsgLy8gbm9ybWFsIGNvbG9yIGluZGV4IGRvZXMgbm90IGFwcGx5LCBkaXNjYXJkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDogICAgICAgIC8vIGJvcmRlciBjb2xvciByaWdodAogICAgICAgICAgICAgICAgICAgICAgICAkeGNsZlR5cGUgID0gc2VsZjo6Z2V0SW50MmQoJGV4dERhdGEsIDApOyAvLyBjb2xvciB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICR4Y2xyVmFsdWUgPSBzdWJzdHIoJGV4dERhdGEsIDQsIDQpOyAvLyBjb2xvciB2YWx1ZSAodmFsdWUgYmFzZWQgb24gY29sb3IgdHlwZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeGNsZlR5cGUgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJnYiA9IHNwcmludGYoJyUwMlglMDJYJTAyWCcsIG9yZCgkeGNsclZhbHVlezB9KSwgb3JkKCR4Y2xyVmFsdWV7MX0pLCBvcmQoJHhjbHJWYWx1ZXsyfSkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vZGlmeSB0aGUgcmVsZXZhbnQgc3R5bGUgcHJvcGVydHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+bWFwQ2VsbFhmSW5kZXhbJGl4ZmVdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyaWdodCA9ICR0aGlzLT5waHBFeGNlbC0+Z2V0Q2VsbFhmQnlJbmRleCgkdGhpcy0+bWFwQ2VsbFhmSW5kZXhbJGl4ZmVdKS0+Z2V0Qm9yZGVycygpLT5nZXRSaWdodCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyaWdodC0+Z2V0Q29sb3IoKS0+c2V0UkdCKCRyZ2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRyaWdodC0+Y29sb3JJbmRleCk7IC8vIG5vcm1hbCBjb2xvciBpbmRleCBkb2VzIG5vdCBhcHBseSwgZGlzY2FyZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6ICAgICAgICAvLyBib3JkZXIgY29sb3IgZGlhZ29uYWwKICAgICAgICAgICAgICAgICAgICAgICAgJHhjbGZUeXBlICA9IHNlbGY6OmdldEludDJkKCRleHREYXRhLCAwKTsgLy8gY29sb3IgdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAkeGNsclZhbHVlID0gc3Vic3RyKCRleHREYXRhLCA0LCA0KTsgLy8gY29sb3IgdmFsdWUgKHZhbHVlIGJhc2VkIG9uIGNvbG9yIHR5cGUpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhjbGZUeXBlID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZ2IgPSBzcHJpbnRmKCclMDJYJTAyWCUwMlgnLCBvcmQoJHhjbHJWYWx1ZXswfSksIG9yZCgkeGNsclZhbHVlezF9KSwgb3JkKCR4Y2xyVmFsdWV7Mn0pKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtb2RpZnkgdGhlIHJlbGV2YW50IHN0eWxlIHByb3BlcnR5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPm1hcENlbGxYZkluZGV4WyRpeGZlXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlhZ29uYWwgPSAkdGhpcy0+cGhwRXhjZWwtPmdldENlbGxYZkJ5SW5kZXgoJHRoaXMtPm1hcENlbGxYZkluZGV4WyRpeGZlXSktPmdldEJvcmRlcnMoKS0+Z2V0RGlhZ29uYWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlhZ29uYWwtPmdldENvbG9yKCktPnNldFJHQigkcmdiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNldCgkZGlhZ29uYWwtPmNvbG9ySW5kZXgpOyAvLyBub3JtYWwgY29sb3IgaW5kZXggZG9lcyBub3QgYXBwbHksIGRpc2NhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOiAgICAvLyBmb250IGNvbG9yCiAgICAgICAgICAgICAgICAgICAgICAgICR4Y2xmVHlwZSAgPSBzZWxmOjpnZXRJbnQyZCgkZXh0RGF0YSwgMCk7IC8vIGNvbG9yIHR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgJHhjbHJWYWx1ZSA9IHN1YnN0cigkZXh0RGF0YSwgNCwgNCk7IC8vIGNvbG9yIHZhbHVlICh2YWx1ZSBiYXNlZCBvbiBjb2xvciB0eXBlKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR4Y2xmVHlwZSA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmdiID0gc3ByaW50ZignJTAyWCUwMlglMDJYJywgb3JkKCR4Y2xyVmFsdWV7MH0pLCBvcmQoJHhjbHJWYWx1ZXsxfSksIG9yZCgkeGNsclZhbHVlezJ9KSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbW9kaWZ5IHRoZSByZWxldmFudCBzdHlsZSBwcm9wZXJ0eQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskaXhmZV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZvbnQgPSAkdGhpcy0+cGhwRXhjZWwtPmdldENlbGxYZkJ5SW5kZXgoJHRoaXMtPm1hcENlbGxYZkluZGV4WyRpeGZlXSktPmdldEZvbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZm9udC0+Z2V0Q29sb3IoKS0+c2V0UkdCKCRyZ2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRmb250LT5jb2xvckluZGV4KTsgLy8gbm9ybWFsIGNvbG9yIGluZGV4IGRvZXMgbm90IGFwcGx5LCBkaXNjYXJkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJG9mZnNldCArPSAkY2I7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgU1RZTEUgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFN0eWxlKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgaW5kZXggdG8gWEYgcmVjb3JkIGFuZCBmbGFnIGZvciBidWlsdC1pbiBzdHlsZQogICAgICAgICAgICAkaXhmZSA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgICAgIC8vIGJpdDogMTEtMDsgbWFzayAweDBGRkY7IGluZGV4IHRvIFhGIHJlY29yZAogICAgICAgICAgICAkeGZJbmRleCA9ICgweDBGRkYgJiAkaXhmZSkgPj4gMDsKCiAgICAgICAgICAgIC8vIGJpdDogMTU7IG1hc2sgMHg4MDAwOyAwID0gdXNlci1kZWZpbmVkIHN0eWxlLCAxID0gYnVpbHQtaW4gc3R5bGUKICAgICAgICAgICAgJGlzQnVpbHRJbiA9IChib29sKSAoKDB4ODAwMCAmICRpeGZlKSA+PiAxNSk7CgogICAgICAgICAgICBpZiAoJGlzQnVpbHRJbikgewogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAxOyBpZGVudGlmaWVyIGZvciBidWlsdC1pbiBzdHlsZQogICAgICAgICAgICAgICAgJGJ1aWx0SW5JZCA9IG9yZCgkcmVjb3JkRGF0YXsyfSk7CgogICAgICAgICAgICAgICAgc3dpdGNoICgkYnVpbHRJbklkKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50bHksIHdlIGFyZSBub3QgdXNpbmcgdGhpcyBmb3IgYW55dGhpbmcKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB1c2VyLWRlZmluZWQ7IG5vdCBzdXBwb3J0ZWQgYnkgUEhQRXhjZWwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIFBBTEVUVEUgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFBhbGV0dGUoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBudW1iZXIgb2YgZm9sbG93aW5nIGNvbG9ycwogICAgICAgICAgICAkbm0gPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgICAgICAvLyBsaXN0IG9mIFJHQiBjb2xvcnMKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG5tOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkcmdiID0gc3Vic3RyKCRyZWNvcmREYXRhLCAyICsgNCAqICRpLCA0KTsKICAgICAgICAgICAgICAgICR0aGlzLT5wYWxldHRlW10gPSBzZWxmOjpyZWFkUkdCKCRyZ2IpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFNIRUVUCiAgICAgKgogICAgICogVGhpcyByZWNvcmQgaXMgIGxvY2F0ZWQgaW4gdGhlICBXb3JrYm9vayBHbG9iYWxzCiAgICAgKiBTdWJzdHJlYW0gIGFuZCByZXByZXNlbnRzIGEgc2hlZXQgaW5zaWRlIHRoZSB3b3JrYm9vay4KICAgICAqIE9uZSBTSEVFVCByZWNvcmQgaXMgd3JpdHRlbiBmb3IgZWFjaCBzaGVldC4gSXQgc3RvcmVzIHRoZQogICAgICogc2hlZXQgbmFtZSBhbmQgYSBzdHJlYW0gb2Zmc2V0IHRvIHRoZSBCT0YgcmVjb3JkIG9mIHRoZQogICAgICogcmVzcGVjdGl2ZSBTaGVldCBTdWJzdHJlYW0gd2l0aGluIHRoZSBXb3JrYm9vayBTdHJlYW0uCiAgICAgKgogICAgICogLS0gICAgIk9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0CiAgICAgKiAgICAgICAgIEV4Y2VsIEZpbGUgRm9ybWF0IgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRTaGVldCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiA0OyBhYnNvbHV0ZSBzdHJlYW0gcG9zaXRpb24gb2YgdGhlIEJPRiByZWNvcmQgb2YgdGhlIHNoZWV0CiAgICAgICAgLy8gTk9URTogbm90IGVuY3J5cHRlZAogICAgICAgICRyZWNfb2Zmc2V0ID0gc2VsZjo6Z2V0SW50NGQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0KTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMTsgc2hlZXQgc3RhdGUKICAgICAgICBzd2l0Y2ggKG9yZCgkcmVjb3JkRGF0YXs0fSkpIHsKICAgICAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgICAgICAgJHNoZWV0U3RhdGUgPSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OlNIRUVUU1RBVEVfVklTSUJMRTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDE6CiAgICAgICAgICAgICAgICAkc2hlZXRTdGF0ZSA9IFBIUEV4Y2VsX1dvcmtzaGVldDo6U0hFRVRTVEFURV9ISURERU47CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDAyOgogICAgICAgICAgICAgICAgJHNoZWV0U3RhdGUgPSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OlNIRUVUU1RBVEVfVkVSWUhJRERFTjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHNoZWV0U3RhdGUgPSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OlNIRUVUU1RBVEVfVklTSUJMRTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLy8gb2Zmc2V0OiA1OyBzaXplOiAxOyBzaGVldCB0eXBlCiAgICAgICAgJHNoZWV0VHlwZSA9IG9yZCgkcmVjb3JkRGF0YXs1fSk7CgogICAgICAgIC8vIG9mZnNldDogNjsgc2l6ZTogdmFyOyBzaGVldCBuYW1lCiAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAkc3RyaW5nID0gc2VsZjo6cmVhZFVuaWNvZGVTdHJpbmdTaG9ydChzdWJzdHIoJHJlY29yZERhdGEsIDYpKTsKICAgICAgICAgICAgJHJlY19uYW1lID0gJHN0cmluZ1sndmFsdWUnXTsKICAgICAgICB9IGVsc2VpZiAoJHRoaXMtPnZlcnNpb24gPT0gc2VsZjo6WExTX0JJRkY3KSB7CiAgICAgICAgICAgICRzdHJpbmcgPSAkdGhpcy0+cmVhZEJ5dGVTdHJpbmdTaG9ydChzdWJzdHIoJHJlY29yZERhdGEsIDYpKTsKICAgICAgICAgICAgJHJlY19uYW1lID0gJHN0cmluZ1sndmFsdWUnXTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5zaGVldHNbXSA9IGFycmF5KAogICAgICAgICAgICAnbmFtZScgPT4gJHJlY19uYW1lLAogICAgICAgICAgICAnb2Zmc2V0JyA9PiAkcmVjX29mZnNldCwKICAgICAgICAgICAgJ3NoZWV0U3RhdGUnID0+ICRzaGVldFN0YXRlLAogICAgICAgICAgICAnc2hlZXRUeXBlJyA9PiAkc2hlZXRUeXBlLAogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBFWFRFUk5BTEJPT0sgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEV4dGVybmFsQm9vaygpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldCB3aXRoaW4gcmVjb3JkIGRhdGEKICAgICAgICAkb2Zmc2V0ID0gMDsKCiAgICAgICAgLy8gdGhlcmUgYXJlIDQgdHlwZXMgb2YgcmVjb3JkcwogICAgICAgIGlmIChzdHJsZW4oJHJlY29yZERhdGEpID4gNCkgewogICAgICAgICAgICAvLyBleHRlcm5hbCByZWZlcmVuY2UKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBudW1iZXIgb2Ygc2hlZXQgbmFtZXMgKCRubSkKICAgICAgICAgICAgJG5tID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwogICAgICAgICAgICAkb2Zmc2V0ICs9IDI7CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IHZhcjsgZW5jb2RlZCBVUkwgd2l0aG91dCBzaGVldCBuYW1lIChVbmljb2RlIHN0cmluZywgMTYtYml0IGxlbmd0aCkKICAgICAgICAgICAgJGVuY29kZWRVcmxTdHJpbmcgPSBzZWxmOjpyZWFkVW5pY29kZVN0cmluZ0xvbmcoc3Vic3RyKCRyZWNvcmREYXRhLCAyKSk7CiAgICAgICAgICAgICRvZmZzZXQgKz0gJGVuY29kZWRVcmxTdHJpbmdbJ3NpemUnXTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiB2YXI7IGxpc3Qgb2YgJG5tIHNoZWV0IG5hbWVzIChVbmljb2RlIHN0cmluZ3MsIDE2LWJpdCBsZW5ndGgpCiAgICAgICAgICAgICRleHRlcm5hbFNoZWV0TmFtZXMgPSBhcnJheSgpOwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkbm07ICsrJGkpIHsKICAgICAgICAgICAgICAgICRleHRlcm5hbFNoZWV0TmFtZVN0cmluZyA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nTG9uZyhzdWJzdHIoJHJlY29yZERhdGEsICRvZmZzZXQpKTsKICAgICAgICAgICAgICAgICRleHRlcm5hbFNoZWV0TmFtZXNbXSA9ICRleHRlcm5hbFNoZWV0TmFtZVN0cmluZ1sndmFsdWUnXTsKICAgICAgICAgICAgICAgICRvZmZzZXQgKz0gJGV4dGVybmFsU2hlZXROYW1lU3RyaW5nWydzaXplJ107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHN0b3JlIHRoZSByZWNvcmQgZGF0YQogICAgICAgICAgICAkdGhpcy0+ZXh0ZXJuYWxCb29rc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2V4dGVybmFsJywKICAgICAgICAgICAgICAgICdlbmNvZGVkVXJsJyA9PiAkZW5jb2RlZFVybFN0cmluZ1sndmFsdWUnXSwKICAgICAgICAgICAgICAgICdleHRlcm5hbFNoZWV0TmFtZXMnID0+ICRleHRlcm5hbFNoZWV0TmFtZXMsCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlaWYgKHN1YnN0cigkcmVjb3JkRGF0YSwgMiwgMikgPT0gcGFjaygnQ0MnLCAweDAxLCAweDA0KSkgewogICAgICAgICAgICAvLyBpbnRlcm5hbCByZWZlcmVuY2UKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBudW1iZXIgb2Ygc2hlZXQgaW4gdGhpcyBkb2N1bWVudAogICAgICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IDB4MDEgMHgwNAogICAgICAgICAgICAkdGhpcy0+ZXh0ZXJuYWxCb29rc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2ludGVybmFsJywKICAgICAgICAgICAgKTsKICAgICAgICB9IGVsc2VpZiAoc3Vic3RyKCRyZWNvcmREYXRhLCAwLCA0KSA9PSBwYWNrKCd2Q0MnLCAweDAwMDEsIDB4MDEsIDB4M0EpKSB7CiAgICAgICAgICAgIC8vIGFkZC1pbiBmdW5jdGlvbgogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IDB4MDAwMQogICAgICAgICAgICAkdGhpcy0+ZXh0ZXJuYWxCb29rc1tdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2FkZEluRnVuY3Rpb24nLAogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZWlmIChzdWJzdHIoJHJlY29yZERhdGEsIDAsIDIpID09IHBhY2soJ3YnLCAweDAwMDApKSB7CiAgICAgICAgICAgIC8vIERERSBsaW5rcywgT0xFIGxpbmtzCiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgMHgwMDAwCiAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogdmFyOyBlbmNvZGVkIHNvdXJjZSBkb2N1bWVudCBuYW1lCiAgICAgICAgICAgICR0aGlzLT5leHRlcm5hbEJvb2tzW10gPSBhcnJheSgKICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnRERFb3JPTEUnLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIEVYVEVSTk5BTUUgcmVjb3JkLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRFeHRlcm5OYW1lKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgLy8gZXh0ZXJuYWwgc2hlZXQgcmVmZXJlbmNlcyBwcm92aWRlZCBmb3IgbmFtZWQgY2VsbHMKICAgICAgICBpZiAoJHRoaXMtPnZlcnNpb24gPT0gc2VsZjo6WExTX0JJRkY4KSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgb3B0aW9ucwogICAgICAgICAgICAkb3B0aW9ucyA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsKCiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgbm90IHVzZWQKCiAgICAgICAgICAgIC8vIG9mZnNldDogNjsgc2l6ZTogdmFyCiAgICAgICAgICAgICRuYW1lU3RyaW5nID0gc2VsZjo6cmVhZFVuaWNvZGVTdHJpbmdTaG9ydChzdWJzdHIoJHJlY29yZERhdGEsIDYpKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiB2YXI7IGZvcm11bGEgZGF0YQogICAgICAgICAgICAkb2Zmc2V0ID0gNiArICRuYW1lU3RyaW5nWydzaXplJ107CiAgICAgICAgICAgICRmb3JtdWxhID0gJHRoaXMtPmdldEZvcm11bGFGcm9tU3RydWN0dXJlKHN1YnN0cigkcmVjb3JkRGF0YSwgJG9mZnNldCkpOwoKICAgICAgICAgICAgJHRoaXMtPmV4dGVybmFsTmFtZXNbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgJ25hbWUnID0+ICRuYW1lU3RyaW5nWyd2YWx1ZSddLAogICAgICAgICAgICAgICAgJ2Zvcm11bGEnID0+ICRmb3JtdWxhLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIEVYVEVSTlNIRUVUIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRFeHRlcm5TaGVldCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIGV4dGVybmFsIHNoZWV0IHJlZmVyZW5jZXMgcHJvdmlkZWQgZm9yIG5hbWVkIGNlbGxzCiAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IG51bWJlciBvZiBmb2xsb3dpbmcgcmVmIHN0cnVjdHVyZXMKICAgICAgICAgICAgJG5tID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkbm07ICsrJGkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5yZWZbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMiArIDYgKiAkaTsgaW5kZXggdG8gRVhURVJOQUxCT09LIHJlY29yZAogICAgICAgICAgICAgICAgICAgICdleHRlcm5hbEJvb2tJbmRleCcgPT4gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIgKyA2ICogJGkpLAogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogNCArIDYgKiAkaTsgaW5kZXggdG8gZmlyc3Qgc2hlZXQgaW4gRVhURVJOQUxCT09LIHJlY29yZAogICAgICAgICAgICAgICAgICAgICdmaXJzdFNoZWV0SW5kZXgnID0+IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA0ICsgNiAqICRpKSwKICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDYgKyA2ICogJGk7IGluZGV4IHRvIGxhc3Qgc2hlZXQgaW4gRVhURVJOQUxCT09LIHJlY29yZAogICAgICAgICAgICAgICAgICAgICdsYXN0U2hlZXRJbmRleCcgPT4gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDYgKyA2ICogJGkpLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBERUZJTkVETkFNRQogICAgICoKICAgICAqIFRoaXMgcmVjb3JkIGlzIHBhcnQgb2YgYSBMaW5rIFRhYmxlLiBJdCBjb250YWlucyB0aGUgbmFtZQogICAgICogYW5kIHRoZSB0b2tlbiBhcnJheSBvZiBhbiBpbnRlcm5hbCBkZWZpbmVkIG5hbWUuIFRva2VuCiAgICAgKiBhcnJheXMgb2YgZGVmaW5lZCBuYW1lcyBjb250YWluIHRva2VucyB3aXRoIGFiZXJyYW50CiAgICAgKiB0b2tlbiBjbGFzc2VzLgogICAgICoKICAgICAqIC0tICAgICJPcGVuT2ZmaWNlLm9yZydzIERvY3VtZW50YXRpb24gb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICBFeGNlbCBGaWxlIEZvcm1hdCIKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkRGVmaW5lZE5hbWUoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoJHRoaXMtPnZlcnNpb24gPT0gc2VsZjo6WExTX0JJRkY4KSB7CiAgICAgICAgICAgIC8vIHJldHJpZXZlcyBuYW1lZCBjZWxscwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBvcHRpb24gZmxhZ3MKICAgICAgICAgICAgJG9wdHMgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgICAgICAvLyBiaXQ6IDU7IG1hc2s6IDB4MDAyMDsgMCA9IHVzZXItZGVmaW5lZCBuYW1lLCAxID0gYnVpbHQtaW4tbmFtZQogICAgICAgICAgICAkaXNCdWlsdEluTmFtZSA9ICgweDAwMjAgJiAkb3B0cykgPj4gNTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMTsga2V5Ym9hcmQgc2hvcnRjdXQKCiAgICAgICAgICAgIC8vIG9mZnNldDogMzsgc2l6ZTogMTsgbGVuZ3RoIG9mIHRoZSBuYW1lIChjaGFyYWN0ZXIgY291bnQpCiAgICAgICAgICAgICRubGVuID0gb3JkKCRyZWNvcmREYXRhezN9KTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgc2l6ZSBvZiB0aGUgZm9ybXVsYSBkYXRhIChpdCBjYW4gaGFwcGVuIHRoYXQgdGhpcyBpcyB6ZXJvKQogICAgICAgICAgICAvLyBub3RlOiB0aGVyZSBjYW4gYWxzbyBiZSBhZGRpdGlvbmFsIGRhdGEsIHRoaXMgaXMgbm90IGluY2x1ZGVkIGluICRmbGVuCiAgICAgICAgICAgICRmbGVuID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDQpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA4OyBzaXplOiAyOyAwPUdsb2JhbCBuYW1lLCBvdGhlcndpc2UgaW5kZXggdG8gc2hlZXQgKDEtYmFzZWQpCiAgICAgICAgICAgICRzY29wZSA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA4KTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMTQ7IHNpemU6IHZhcjsgTmFtZSAoVW5pY29kZSBzdHJpbmcgd2l0aG91dCBsZW5ndGggZmllbGQpCiAgICAgICAgICAgICRzdHJpbmcgPSBzZWxmOjpyZWFkVW5pY29kZVN0cmluZyhzdWJzdHIoJHJlY29yZERhdGEsIDE0KSwgJG5sZW4pOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemU6ICRmbGVuOyBmb3JtdWxhIGRhdGEKICAgICAgICAgICAgJG9mZnNldCA9IDE0ICsgJHN0cmluZ1snc2l6ZSddOwogICAgICAgICAgICAkZm9ybXVsYVN0cnVjdHVyZSA9IHBhY2soJ3YnLCAkZmxlbikgLiBzdWJzdHIoJHJlY29yZERhdGEsICRvZmZzZXQpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRmb3JtdWxhID0gJHRoaXMtPmdldEZvcm11bGFGcm9tU3RydWN0dXJlKCRmb3JtdWxhU3RydWN0dXJlKTsKICAgICAgICAgICAgfSBjYXRjaCAoUEhQRXhjZWxfRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgICAgICAkZm9ybXVsYSA9ICcnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGhpcy0+ZGVmaW5lZG5hbWVbXSA9IGFycmF5KAogICAgICAgICAgICAgICAgJ2lzQnVpbHRJbk5hbWUnID0+ICRpc0J1aWx0SW5OYW1lLAogICAgICAgICAgICAgICAgJ25hbWUnID0+ICRzdHJpbmdbJ3ZhbHVlJ10sCiAgICAgICAgICAgICAgICAnZm9ybXVsYScgPT4gJGZvcm11bGEsCiAgICAgICAgICAgICAgICAnc2NvcGUnID0+ICRzY29wZSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBNU09EUkFXSU5HR1JPVVAgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZE1zb0RyYXdpbmdHcm91cCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CgogICAgICAgIC8vIGdldCBzcGxpY2VkIHJlY29yZCBkYXRhCiAgICAgICAgJHNwbGljZWRSZWNvcmREYXRhID0gJHRoaXMtPmdldFNwbGljZWRSZWNvcmREYXRhKCk7CiAgICAgICAgJHJlY29yZERhdGEgPSAkc3BsaWNlZFJlY29yZERhdGFbJ3JlY29yZERhdGEnXTsKCiAgICAgICAgJHRoaXMtPmRyYXdpbmdHcm91cERhdGEgLj0gJHJlY29yZERhdGE7CiAgICB9CgoKICAgIC8qKgogICAgICogU1NUIC0gU2hhcmVkIFN0cmluZyBUYWJsZQogICAgICoKICAgICAqIFRoaXMgcmVjb3JkIGNvbnRhaW5zIGEgbGlzdCBvZiBhbGwgc3RyaW5ncyB1c2VkIGFueXdoZXJlCiAgICAgKiBpbiB0aGUgd29ya2Jvb2suIEVhY2ggc3RyaW5nIG9jY3VycyBvbmx5IG9uY2UuIFRoZQogICAgICogd29ya2Jvb2sgdXNlcyBpbmRleGVzIGludG8gdGhlIGxpc3QgdG8gcmVmZXJlbmNlIHRoZQogICAgICogc3RyaW5ncy4KICAgICAqCiAgICAgKiAtLSAgICAiT3Blbk9mZmljZS5vcmcncyBEb2N1bWVudGF0aW9uIG9mIHRoZSBNaWNyb3NvZnQKICAgICAqICAgICAgICAgRXhjZWwgRmlsZSBGb3JtYXQiCiAgICAgKiovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRTc3QoKQogICAgewogICAgICAgIC8vIG9mZnNldCB3aXRoaW4gKHNwbGljZWQpIHJlY29yZCBkYXRhCiAgICAgICAgJHBvcyA9IDA7CgogICAgICAgIC8vIGdldCBzcGxpY2VkIHJlY29yZCBkYXRhCiAgICAgICAgJHNwbGljZWRSZWNvcmREYXRhID0gJHRoaXMtPmdldFNwbGljZWRSZWNvcmREYXRhKCk7CgogICAgICAgICRyZWNvcmREYXRhID0gJHNwbGljZWRSZWNvcmREYXRhWydyZWNvcmREYXRhJ107CiAgICAgICAgJHNwbGljZU9mZnNldHMgPSAkc3BsaWNlZFJlY29yZERhdGFbJ3NwbGljZU9mZnNldHMnXTsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiA0OyB0b3RhbCBudW1iZXIgb2Ygc3RyaW5ncyBpbiB0aGUgd29ya2Jvb2sKICAgICAgICAkcG9zICs9IDQ7CgogICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogNDsgbnVtYmVyIG9mIGZvbGxvd2luZyBzdHJpbmdzICgkbm0pCiAgICAgICAgJG5tID0gc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDQpOwogICAgICAgICRwb3MgKz0gNDsKCiAgICAgICAgLy8gbG9vcCB0aHJvdWdoIHRoZSBVbmljb2RlIHN0cmluZ3MgKDE2LWJpdCBsZW5ndGgpCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG5tOyArKyRpKSB7CiAgICAgICAgICAgIC8vIG51bWJlciBvZiBjaGFyYWN0ZXJzIGluIHRoZSBVbmljb2RlIHN0cmluZwogICAgICAgICAgICAkbnVtQ2hhcnMgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgJHBvcyk7CiAgICAgICAgICAgICRwb3MgKz0gMjsKCiAgICAgICAgICAgIC8vIG9wdGlvbiBmbGFncwogICAgICAgICAgICAkb3B0aW9uRmxhZ3MgPSBvcmQoJHJlY29yZERhdGF7JHBvc30pOwogICAgICAgICAgICArKyRwb3M7CgogICAgICAgICAgICAvLyBiaXQ6IDA7IG1hc2s6IDB4MDE7IDAgPSBjb21wcmVzc2VkOyAxID0gdW5jb21wcmVzc2VkCiAgICAgICAgICAgICRpc0NvbXByZXNzZWQgPSAoKCRvcHRpb25GbGFncyAmIDB4MDEpID09IDApIDsKCiAgICAgICAgICAgIC8vIGJpdDogMjsgbWFzazogMHgwMjsgMCA9IG9yZGluYXJ5OyAxID0gQXNpYW4gcGhvbmV0aWMKICAgICAgICAgICAgJGhhc0FzaWFuID0gKCgkb3B0aW9uRmxhZ3MgJiAweDA0KSAhPSAwKTsKCiAgICAgICAgICAgIC8vIGJpdDogMzsgbWFzazogMHgwMzsgMCA9IG9yZGluYXJ5OyAxID0gUmljaC1UZXh0CiAgICAgICAgICAgICRoYXNSaWNoVGV4dCA9ICgoJG9wdGlvbkZsYWdzICYgMHgwOCkgIT0gMCk7CgogICAgICAgICAgICBpZiAoJGhhc1JpY2hUZXh0KSB7CiAgICAgICAgICAgICAgICAvLyBudW1iZXIgb2YgUmljaC1UZXh0IGZvcm1hdHRpbmcgcnVucwogICAgICAgICAgICAgICAgJGZvcm1hdHRpbmdSdW5zID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsICRwb3MpOwogICAgICAgICAgICAgICAgJHBvcyArPSAyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJGhhc0FzaWFuKSB7CiAgICAgICAgICAgICAgICAvLyBzaXplIG9mIEFzaWFuIHBob25ldGljIHNldHRpbmcKICAgICAgICAgICAgICAgICRleHRlbmRlZFJ1bkxlbmd0aCA9IHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAkcG9zKTsKICAgICAgICAgICAgICAgICRwb3MgKz0gNDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZXhwZWN0ZWQgYnl0ZSBsZW5ndGggb2YgY2hhcmFjdGVyIGFycmF5IGlmIG5vdCBzcGxpdAogICAgICAgICAgICAkbGVuID0gKCRpc0NvbXByZXNzZWQpID8gJG51bUNoYXJzIDogJG51bUNoYXJzICogMjsKCiAgICAgICAgICAgIC8vIGxvb2sgdXAgbGltaXQgcG9zaXRpb24KICAgICAgICAgICAgZm9yZWFjaCAoJHNwbGljZU9mZnNldHMgYXMgJHNwbGljZU9mZnNldCkgewogICAgICAgICAgICAgICAgLy8gaXQgY2FuIGhhcHBlbiB0aGF0IHRoZSBzdHJpbmcgaXMgZW1wdHksIHRoZXJlZm9yZSB3ZSBuZWVkCiAgICAgICAgICAgICAgICAvLyA8PSBhbmQgbm90IGp1c3QgPAogICAgICAgICAgICAgICAgaWYgKCRwb3MgPD0gJHNwbGljZU9mZnNldCkgewogICAgICAgICAgICAgICAgICAgICRsaW1pdHBvcyA9ICRzcGxpY2VPZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkcG9zICsgJGxlbiA8PSAkbGltaXRwb3MpIHsKICAgICAgICAgICAgICAgIC8vIGNoYXJhY3RlciBhcnJheSBpcyBub3Qgc3BsaXQgYmV0d2VlbiByZWNvcmRzCgogICAgICAgICAgICAgICAgJHJldHN0ciA9IHN1YnN0cigkcmVjb3JkRGF0YSwgJHBvcywgJGxlbik7CiAgICAgICAgICAgICAgICAkcG9zICs9ICRsZW47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBjaGFyYWN0ZXIgYXJyYXkgaXMgc3BsaXQgYmV0d2VlbiByZWNvcmRzCgogICAgICAgICAgICAgICAgLy8gZmlyc3QgcGFydCBvZiBjaGFyYWN0ZXIgYXJyYXkKICAgICAgICAgICAgICAgICRyZXRzdHIgPSBzdWJzdHIoJHJlY29yZERhdGEsICRwb3MsICRsaW1pdHBvcyAtICRwb3MpOwoKICAgICAgICAgICAgICAgICRieXRlc1JlYWQgPSAkbGltaXRwb3MgLSAkcG9zOwoKICAgICAgICAgICAgICAgIC8vIHJlbWFpbmluZyBjaGFyYWN0ZXJzIGluIFVuaWNvZGUgc3RyaW5nCiAgICAgICAgICAgICAgICAkY2hhcnNMZWZ0ID0gJG51bUNoYXJzIC0gKCgkaXNDb21wcmVzc2VkKSA\/ICRieXRlc1JlYWQgOiAoJGJ5dGVzUmVhZCAvIDIpKTsKCiAgICAgICAgICAgICAgICAkcG9zID0gJGxpbWl0cG9zOwoKICAgICAgICAgICAgICAgIC8vIGtlZXAgcmVhZGluZyB0aGUgY2hhcmFjdGVycwogICAgICAgICAgICAgICAgd2hpbGUgKCRjaGFyc0xlZnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbG9vayB1cCBuZXh0IGxpbWl0IHBvc2l0aW9uLCBpbiBjYXNlIHRoZSBzdHJpbmcgc3BhbiBtb3JlIHRoYW4gb25lIGNvbnRpbnVlIHJlY29yZAogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzcGxpY2VPZmZzZXRzIGFzICRzcGxpY2VPZmZzZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRwb3MgPCAkc3BsaWNlT2Zmc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGltaXRwb3MgPSAkc3BsaWNlT2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIHJlcGVhdGVkIG9wdGlvbiBmbGFncwogICAgICAgICAgICAgICAgICAgIC8vIE9wZW5PZmZpY2Uub3JnIGRvY3VtZW50YXRpb24gNS4yMQogICAgICAgICAgICAgICAgICAgICRvcHRpb24gPSBvcmQoJHJlY29yZERhdGF7JHBvc30pOwogICAgICAgICAgICAgICAgICAgICsrJHBvczsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRpc0NvbXByZXNzZWQgJiYgKCRvcHRpb24gPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gMXN0IGZyYWdtZW50IGNvbXByZXNzZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBmcmFnbWVudCBjb21wcmVzc2VkCiAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSBtaW4oJGNoYXJzTGVmdCwgJGxpbWl0cG9zIC0gJHBvcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRzdHIgLj0gc3Vic3RyKCRyZWNvcmREYXRhLCAkcG9zLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGNoYXJzTGVmdCAtPSAkbGVuOwogICAgICAgICAgICAgICAgICAgICAgICAkaXNDb21wcmVzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoISRpc0NvbXByZXNzZWQgJiYgKCRvcHRpb24gIT0gMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gMXN0IGZyYWdtZW50IHVuY29tcHJlc3NlZAogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGZyYWdtZW50IHVuY29tcHJlc3NlZAogICAgICAgICAgICAgICAgICAgICAgICAkbGVuID0gbWluKCRjaGFyc0xlZnQgKiAyLCAkbGltaXRwb3MgLSAkcG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJldHN0ciAuPSBzdWJzdHIoJHJlY29yZERhdGEsICRwb3MsICRsZW4pOwogICAgICAgICAgICAgICAgICAgICAgICAkY2hhcnNMZWZ0IC09ICRsZW4gLyAyOwogICAgICAgICAgICAgICAgICAgICAgICAkaXNDb21wcmVzc2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCEkaXNDb21wcmVzc2VkICYmICgkb3B0aW9uID09IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDFzdCBmcmFnbWVudCB1bmNvbXByZXNzZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBmcmFnbWVudCBjb21wcmVzc2VkCiAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gPSBtaW4oJGNoYXJzTGVmdCwgJGxpbWl0cG9zIC0gJHBvcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiA8ICRsZW47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXRzdHIgLj0gJHJlY29yZERhdGF7JHBvcyArICRqfSAuIGNocigwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkY2hhcnNMZWZ0IC09ICRsZW47CiAgICAgICAgICAgICAgICAgICAgICAgICRpc0NvbXByZXNzZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAxc3QgZnJhZ21lbnQgY29tcHJlc3NlZAogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGZyYWdtZW50IHVuY29tcHJlc3NlZAogICAgICAgICAgICAgICAgICAgICAgICAkbmV3c3RyID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiA8IHN0cmxlbigkcmV0c3RyKTsgKyskaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5ld3N0ciAuPSAkcmV0c3RyWyRqXSAuIGNocigwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcmV0c3RyID0gJG5ld3N0cjsKICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9IG1pbigkY2hhcnNMZWZ0ICogMiwgJGxpbWl0cG9zIC0gJHBvcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRzdHIgLj0gc3Vic3RyKCRyZWNvcmREYXRhLCAkcG9zLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGNoYXJzTGVmdCAtPSAkbGVuIC8gMjsKICAgICAgICAgICAgICAgICAgICAgICAgJGlzQ29tcHJlc3NlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJHBvcyArPSAkbGVuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBjb252ZXJ0IHRvIFVURi04CiAgICAgICAgICAgICRyZXRzdHIgPSBzZWxmOjplbmNvZGVVVEYxNigkcmV0c3RyLCAkaXNDb21wcmVzc2VkKTsKCiAgICAgICAgICAgIC8vIHJlYWQgYWRkaXRpb25hbCBSaWNoLVRleHQgaW5mb3JtYXRpb24sIGlmIGFueQogICAgICAgICAgICAkZm10UnVucyA9IGFycmF5KCk7CiAgICAgICAgICAgIGlmICgkaGFzUmljaFRleHQpIHsKICAgICAgICAgICAgICAgIC8vIGxpc3Qgb2YgZm9ybWF0dGluZyBydW5zCiAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkZm9ybWF0dGluZ1J1bnM7ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAvLyBmaXJzdCBmb3JtYXR0ZWQgY2hhcmFjdGVyOyB6ZXJvLWJhc2VkCiAgICAgICAgICAgICAgICAgICAgJGNoYXJQb3MgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgJHBvcyArICRqICogNCk7CgogICAgICAgICAgICAgICAgICAgIC8vIGluZGV4IHRvIGZvbnQgcmVjb3JkCiAgICAgICAgICAgICAgICAgICAgJGZvbnRJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAkcG9zICsgMiArICRqICogNCk7CgogICAgICAgICAgICAgICAgICAgICRmbXRSdW5zW10gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJQb3MnID0+ICRjaGFyUG9zLAogICAgICAgICAgICAgICAgICAgICAgICAnZm9udEluZGV4JyA9PiAkZm9udEluZGV4LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkcG9zICs9IDQgKiAkZm9ybWF0dGluZ1J1bnM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJlYWQgYWRkaXRpb25hbCBBc2lhbiBwaG9uZXRpY3MgaW5mb3JtYXRpb24sIGlmIGFueQogICAgICAgICAgICBpZiAoJGhhc0FzaWFuKSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgQXNpYW4gcGhvbmV0aWMgc2V0dGluZ3MsIHdlIHNraXAgdGhlIGV4dGVuZGVkIHN0cmluZyBkYXRhCiAgICAgICAgICAgICAgICAkcG9zICs9ICRleHRlbmRlZFJ1bkxlbmd0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gc3RvcmUgdGhlIHNoYXJlZCBzdGluZwogICAgICAgICAgICAkdGhpcy0+c3N0W10gPSBhcnJheSgKICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHJldHN0ciwKICAgICAgICAgICAgICAgICdmbXRSdW5zJyA9PiAkZm10UnVucywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIC8vIGdldFNwbGljZWRSZWNvcmREYXRhKCkgdGFrZXMgY2FyZSBvZiBtb3ZpbmcgY3VycmVudCBwb3NpdGlvbiBpbiBkYXRhIHN0cmVhbQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgUFJJTlRHUklETElORVMgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFByaW50R3JpZGxpbmVzKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IDAgPSBkbyBub3QgcHJpbnQgc2hlZXQgZ3JpZCBsaW5lczsgMSA9IHByaW50IHNoZWV0IGdyaWRsaW5lcwogICAgICAgICAgICAkcHJpbnRHcmlkbGluZXMgPSAoYm9vbCkgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwogICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPnNldFByaW50R3JpZGxpbmVzKCRwcmludEdyaWRsaW5lcyk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgREVGQVVMVFJPV0hFSUdIVCByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkRGVmYXVsdFJvd0hlaWdodCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgb3B0aW9uIGZsYWdzCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBkZWZhdWx0IGhlaWdodCBmb3IgdW51c2VkIHJvd3MsICh0d2lwcyAxLzIwIHBvaW50KQogICAgICAgICRoZWlnaHQgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMik7CiAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXREZWZhdWx0Um93RGltZW5zaW9uKCktPnNldFJvd0hlaWdodCgkaGVpZ2h0IC8gMjApOwogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgU0hFRVRQUiByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkU2hlZXRQcigpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMgoKICAgICAgICAvLyBiaXQ6IDY7IG1hc2s6IDB4MDA0MDsgMCA9IG91dGxpbmUgYnV0dG9ucyBhYm92ZSBvdXRsaW5lIGdyb3VwCiAgICAgICAgJGlzU3VtbWFyeUJlbG93ID0gKDB4MDA0MCAmIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKSkgPj4gNjsKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPnNldFNob3dTdW1tYXJ5QmVsb3coJGlzU3VtbWFyeUJlbG93KTsKCiAgICAgICAgLy8gYml0OiA3OyBtYXNrOiAweDAwODA7IDAgPSBvdXRsaW5lIGJ1dHRvbnMgbGVmdCBvZiBvdXRsaW5lIGdyb3VwCiAgICAgICAgJGlzU3VtbWFyeVJpZ2h0ID0gKDB4MDA4MCAmIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKSkgPj4gNzsKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPnNldFNob3dTdW1tYXJ5UmlnaHQoJGlzU3VtbWFyeVJpZ2h0KTsKCiAgICAgICAgLy8gYml0OiA4OyBtYXNrOiAweDEwMDsgMCA9IHNjYWxlIHByaW50b3V0IGluIHBlcmNlbnQsIDEgPSBmaXQgcHJpbnRvdXQgdG8gbnVtYmVyIG9mIHBhZ2VzCiAgICAgICAgLy8gdGhpcyBjb3JyZXNwb25kcyB0byByYWRpbyBidXR0b24gc2V0dGluZyBpbiBwYWdlIHNldHVwIGRpYWxvZyBpbiBFeGNlbAogICAgICAgICR0aGlzLT5pc0ZpdFRvUGFnZXMgPSAoYm9vbCkgKCgweDAxMDAgJiBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCkpID4+IDgpOwogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgSE9SSVpPTlRBTFBBR0VCUkVBS1MgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEhvcml6b250YWxQYWdlQnJlYWtzKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IG51bWJlciBvZiB0aGUgZm9sbG93aW5nIHJvdyBpbmRleCBzdHJ1Y3R1cmVzCiAgICAgICAgICAgICRubSA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogNiAqICRubTsgbGlzdCBvZiAkbm0gcm93IGluZGV4IHN0cnVjdHVyZXMKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG5tOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkciA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyICsgNiAqICRpKTsKICAgICAgICAgICAgICAgICRjZiA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyICsgNiAqICRpICsgMik7CiAgICAgICAgICAgICAgICAkY2wgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMiArIDYgKiAkaSArIDQpOwoKICAgICAgICAgICAgICAgIC8vIG5vdCBzdXJlIHdoeSB0d28gY29sdW1uIGluZGV4ZXMgYXJlIG5lY2Vzc2FyeT8KICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+c2V0QnJlYWtCeUNvbHVtbkFuZFJvdygkY2YsICRyLCBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLX1JPVyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBWRVJUSUNBTFBBR0VCUkVBS1MgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFZlcnRpY2FsUGFnZUJyZWFrcygpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICgkdGhpcy0+dmVyc2lvbiA9PSBzZWxmOjpYTFNfQklGRjggJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBudW1iZXIgb2YgdGhlIGZvbGxvd2luZyBjb2x1bW4gaW5kZXggc3RydWN0dXJlcwogICAgICAgICAgICAkbm0gPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDYgKiAkbm07IGxpc3Qgb2YgJG5tIHJvdyBpbmRleCBzdHJ1Y3R1cmVzCiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRubTsgKyskaSkgewogICAgICAgICAgICAgICAgJGMgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMiArIDYgKiAkaSk7CiAgICAgICAgICAgICAgICAkcmYgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMiArIDYgKiAkaSArIDIpOwogICAgICAgICAgICAgICAgJHJsID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIgKyA2ICogJGkgKyA0KTsKCiAgICAgICAgICAgICAgICAvLyBub3Qgc3VyZSB3aHkgdHdvIHJvdyBpbmRleGVzIGFyZSBuZWNlc3Nhcnk\/CiAgICAgICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPnNldEJyZWFrQnlDb2x1bW5BbmRSb3coJGMsICRyZiwgUEhQRXhjZWxfV29ya3NoZWV0OjpCUkVBS19DT0xVTU4pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgSEVBREVSIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRIZWFkZXIoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiB2YXIKICAgICAgICAgICAgLy8gcmVhbGl6ZWQgdGhhdCAkcmVjb3JkRGF0YSBjYW4gYmUgZW1wdHkgZXZlbiB3aGVuIHJlY29yZCBleGlzdHMKICAgICAgICAgICAgaWYgKCRyZWNvcmREYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPnZlcnNpb24gPT0gc2VsZjo6WExTX0JJRkY4KSB7CiAgICAgICAgICAgICAgICAgICAgJHN0cmluZyA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nTG9uZygkcmVjb3JkRGF0YSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRzdHJpbmcgPSAkdGhpcy0+cmVhZEJ5dGVTdHJpbmdTaG9ydCgkcmVjb3JkRGF0YSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+c2V0T2RkSGVhZGVyKCRzdHJpbmdbJ3ZhbHVlJ10pOwogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+c2V0RXZlbkhlYWRlcigkc3RyaW5nWyd2YWx1ZSddKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIEZPT1RFUiByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkRm9vdGVyKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogdmFyCiAgICAgICAgICAgIC8vIHJlYWxpemVkIHRoYXQgJHJlY29yZERhdGEgY2FuIGJlIGVtcHR5IGV2ZW4gd2hlbiByZWNvcmQgZXhpc3RzCiAgICAgICAgICAgIGlmICgkcmVjb3JkRGF0YSkgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAgICAgICAgICRzdHJpbmcgPSBzZWxmOjpyZWFkVW5pY29kZVN0cmluZ0xvbmcoJHJlY29yZERhdGEpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc3RyaW5nID0gJHRoaXMtPnJlYWRCeXRlU3RyaW5nU2hvcnQoJHJlY29yZERhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+c2V0T2RkRm9vdGVyKCRzdHJpbmdbJ3ZhbHVlJ10pOwogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+c2V0RXZlbkZvb3Rlcigkc3RyaW5nWyd2YWx1ZSddKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIEhDRU5URVIgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEhjZW50ZXIoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyAwID0gcHJpbnQgc2hlZXQgbGVmdCBhbGlnbmVkLCAxID0gcHJpbnQgc2hlZXQgY2VudGVyZWQgaG9yaXpvbnRhbGx5CiAgICAgICAgICAgICRpc0hvcml6b250YWxDZW50ZXJlZCA9IChib29sKSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5zZXRIb3Jpem9udGFsQ2VudGVyZWQoJGlzSG9yaXpvbnRhbENlbnRlcmVkKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBWQ0VOVEVSIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRWY2VudGVyKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgMCA9IHByaW50IHNoZWV0IGFsaWduZWQgYXQgdG9wIHBhZ2UgYm9yZGVyLCAxID0gcHJpbnQgc2hlZXQgdmVydGljYWxseSBjZW50ZXJlZAogICAgICAgICAgICAkaXNWZXJ0aWNhbENlbnRlcmVkID0gKGJvb2wpIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldFZlcnRpY2FsQ2VudGVyZWQoJGlzVmVydGljYWxDZW50ZXJlZCk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgTEVGVE1BUkdJTiByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkTGVmdE1hcmdpbigpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDgKICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlTWFyZ2lucygpLT5zZXRMZWZ0KHNlbGY6OmV4dHJhY3ROdW1iZXIoJHJlY29yZERhdGEpKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBSSUdIVE1BUkdJTiByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkUmlnaHRNYXJnaW4oKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiA4CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZU1hcmdpbnMoKS0+c2V0UmlnaHQoc2VsZjo6ZXh0cmFjdE51bWJlcigkcmVjb3JkRGF0YSkpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIFRPUE1BUkdJTiByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkVG9wTWFyZ2luKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogOAogICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPnNldFRvcChzZWxmOjpleHRyYWN0TnVtYmVyKCRyZWNvcmREYXRhKSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgQk9UVE9NTUFSR0lOIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRCb3R0b21NYXJnaW4oKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiA4CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZU1hcmdpbnMoKS0+c2V0Qm90dG9tKHNlbGY6OmV4dHJhY3ROdW1iZXIoJHJlY29yZERhdGEpKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBQQUdFU0VUVVAgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFBhZ2VTZXR1cCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IHBhcGVyIHNpemUKICAgICAgICAgICAgJHBhcGVyU2l6ZSA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgc2NhbGluZyBmYWN0b3IKICAgICAgICAgICAgJHNjYWxlID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA2OyBzaXplOiAyOyBmaXQgd29ya3NoZWV0IHdpZHRoIHRvIHRoaXMgbnVtYmVyIG9mIHBhZ2VzLCAwID0gdXNlIGFzIG1hbnkgYXMgbmVlZGVkCiAgICAgICAgICAgICRmaXRUb1dpZHRoID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDYpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA4OyBzaXplOiAyOyBmaXQgd29ya3NoZWV0IGhlaWdodCB0byB0aGlzIG51bWJlciBvZiBwYWdlcywgMCA9IHVzZSBhcyBtYW55IGFzIG5lZWRlZAogICAgICAgICAgICAkZml0VG9IZWlnaHQgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgOCk7CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDEwOyBzaXplOiAyOyBvcHRpb24gZmxhZ3MKCiAgICAgICAgICAgIC8vIGJpdDogMTsgbWFzazogMHgwMDAyOyAwPWxhbmRzY2FwZSwgMT1wb3J0cmFpdAogICAgICAgICAgICAkaXNQb3J0cmFpdCA9ICgweDAwMDIgJiBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMTApKSA+PiAxOwoKICAgICAgICAgICAgLy8gYml0OiAyOyBtYXNrOiAweDAwMDQ7IDE9IHBhcGVyIHNpemUsIHNjYWxpbmcgZmFjdG9yLCBwYXBlciBvcmllbnQuIG5vdCBpbml0CiAgICAgICAgICAgIC8vIHdoZW4gdGhpcyBiaXQgaXMgc2V0LCBkbyBub3QgdXNlIGZsYWdzIGZvciB0aG9zZSBwcm9wZXJ0aWVzCiAgICAgICAgICAgICRpc05vdEluaXQgPSAoMHgwMDA0ICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDEwKSkgPj4gMjsKCiAgICAgICAgICAgIGlmICghJGlzTm90SW5pdCkgewogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+c2V0UGFwZXJTaXplKCRwYXBlclNpemUpOwogICAgICAgICAgICAgICAgc3dpdGNoICgkaXNQb3J0cmFpdCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+c2V0T3JpZW50YXRpb24oUEhQRXhjZWxfV29ya3NoZWV0X1BhZ2VTZXR1cDo6T1JJRU5UQVRJT05fTEFORFNDQVBFKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5zZXRPcmllbnRhdGlvbihQSFBFeGNlbF9Xb3Jrc2hlZXRfUGFnZVNldHVwOjpPUklFTlRBVElPTl9QT1JUUkFJVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldFNjYWxlKCRzY2FsZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+c2V0Rml0VG9QYWdlKChib29sKSAkdGhpcy0+aXNGaXRUb1BhZ2VzKTsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldEZpdFRvV2lkdGgoJGZpdFRvV2lkdGgsIGZhbHNlKTsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldEZpdFRvSGVpZ2h0KCRmaXRUb0hlaWdodCwgZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDE2OyBzaXplOiA4OyBoZWFkZXIgbWFyZ2luIChJRUVFIDc1NCBmbG9hdGluZy1wb2ludCB2YWx1ZSkKICAgICAgICAgICAgJG1hcmdpbkhlYWRlciA9IHNlbGY6OmV4dHJhY3ROdW1iZXIoc3Vic3RyKCRyZWNvcmREYXRhLCAxNiwgOCkpOwogICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPnNldEhlYWRlcigkbWFyZ2luSGVhZGVyKTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjQ7IHNpemU6IDg7IGZvb3RlciBtYXJnaW4gKElFRUUgNzU0IGZsb2F0aW5nLXBvaW50IHZhbHVlKQogICAgICAgICAgICAkbWFyZ2luRm9vdGVyID0gc2VsZjo6ZXh0cmFjdE51bWJlcihzdWJzdHIoJHJlY29yZERhdGEsIDI0LCA4KSk7CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZU1hcmdpbnMoKS0+c2V0Rm9vdGVyKCRtYXJnaW5Gb290ZXIpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBQUk9URUNUIC0gU2hlZXQgcHJvdGVjdGlvbiAoQklGRjIgdGhyb3VnaCBCSUZGOCkKICAgICAqICAgaWYgdGhpcyByZWNvcmQgaXMgb21pdHRlZCwgdGhlbiBpdCBhbHNvIG1lYW5zIG5vIHNoZWV0IHByb3RlY3Rpb24KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkUHJvdGVjdCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICgkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsKCiAgICAgICAgLy8gYml0IDAsIG1hc2sgMHgwMTsgMSA9IHNoZWV0IGlzIHByb3RlY3RlZAogICAgICAgICRib29sID0gKDB4MDEgJiBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCkpID4+IDA7CiAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPnNldFNoZWV0KChib29sKSRib29sKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBTQ0VOUFJPVEVDVAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRTY2VuUHJvdGVjdCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICgkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsKCiAgICAgICAgLy8gYml0OiAwLCBtYXNrIDB4MDE7IDEgPSBzY2VuYXJpb3MgYXJlIHByb3RlY3RlZAogICAgICAgICRib29sID0gKDB4MDEgJiBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCkpID4+IDA7CgogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRTY2VuYXJpb3MoKGJvb2wpJGJvb2wpOwogICAgfQoKCiAgICAvKioKICAgICAqIE9CSkVDVFBST1RFQ1QKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkT2JqZWN0UHJvdGVjdCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICgkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsKCiAgICAgICAgLy8gYml0OiAwLCBtYXNrIDB4MDE7IDEgPSBvYmplY3RzIGFyZSBwcm90ZWN0ZWQKICAgICAgICAkYm9vbCA9ICgweDAxICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApKSA+PiAwOwoKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+c2V0T2JqZWN0cygoYm9vbCkkYm9vbCk7CiAgICB9CgoKICAgIC8qKgogICAgICogUEFTU1dPUkQgLSBTaGVldCBwcm90ZWN0aW9uIChoYXNoZWQpIHBhc3N3b3JkIChCSUZGMiB0aHJvdWdoIEJJRkY4KQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRQYXNzd29yZCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IDE2LWJpdCBoYXNoIHZhbHVlIG9mIHBhc3N3b3JkCiAgICAgICAgICAgICRwYXNzd29yZCA9IHN0cnRvdXBwZXIoZGVjaGV4KHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKSkpOyAvLyB0aGUgaGFzaGVkIHBhc3N3b3JkCiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRQYXNzd29yZCgkcGFzc3dvcmQsIHRydWUpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIERFRkNPTFdJRFRIIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWREZWZDb2xXaWR0aCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgZGVmYXVsdCBjb2x1bW4gd2lkdGgKICAgICAgICAkd2lkdGggPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CiAgICAgICAgaWYgKCR3aWR0aCAhPSA4KSB7CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0RGVmYXVsdENvbHVtbkRpbWVuc2lvbigpLT5zZXRXaWR0aCgkd2lkdGgpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIENPTElORk8gcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZENvbEluZm8oKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBpbmRleCB0byBmaXJzdCBjb2x1bW4gaW4gcmFuZ2UKICAgICAgICAgICAgJGZjID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOyAvLyBmaXJzdCBjb2x1bW4gaW5kZXgKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgaW5kZXggdG8gbGFzdCBjb2x1bW4gaW4gcmFuZ2UKICAgICAgICAgICAgJGxjID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOyAvLyBmaXJzdCBjb2x1bW4gaW5kZXgKCiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgd2lkdGggb2YgdGhlIGNvbHVtbiBpbiAxLzI1NiBvZiB0aGUgd2lkdGggb2YgdGhlIHplcm8gY2hhcmFjdGVyCiAgICAgICAgICAgICR3aWR0aCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA0KTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogNjsgc2l6ZTogMjsgaW5kZXggdG8gWEYgcmVjb3JkIGZvciBkZWZhdWx0IGNvbHVtbiBmb3JtYXR0aW5nCiAgICAgICAgICAgICR4ZkluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDYpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA4OyBzaXplOiAyOyBvcHRpb24gZmxhZ3MKICAgICAgICAgICAgLy8gYml0OiAwOyBtYXNrOiAweDAwMDE7IDE9IGNvbHVtbnMgYXJlIGhpZGRlbgogICAgICAgICAgICAkaXNIaWRkZW4gPSAoMHgwMDAxICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDgpKSA+PiAwOwoKICAgICAgICAgICAgLy8gYml0OiAxMC04OyBtYXNrOiAweDA3MDA7IG91dGxpbmUgbGV2ZWwgb2YgdGhlIGNvbHVtbnMgKDAgPSBubyBvdXRsaW5lKQogICAgICAgICAgICAkbGV2ZWwgPSAoMHgwNzAwICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDgpKSA+PiA4OwoKICAgICAgICAgICAgLy8gYml0OiAxMjsgbWFzazogMHgxMDAwOyAxID0gY29sbGFwc2VkCiAgICAgICAgICAgICRpc0NvbGxhcHNlZCA9ICgweDEwMDAgJiBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgOCkpID4+IDEyOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxMDsgc2l6ZTogMjsgbm90IHVzZWQKCiAgICAgICAgICAgIGZvciAoJGkgPSAkZmM7ICRpIDw9ICRsYzsgKyskaSkgewogICAgICAgICAgICAgICAgaWYgKCRsYyA9PSAyNTUgfHwgJGxjID09IDI1NikgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0RGVmYXVsdENvbHVtbkRpbWVuc2lvbigpLT5zZXRXaWR0aCgkd2lkdGggLyAyNTYpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRDb2x1bW5EaW1lbnNpb25CeUNvbHVtbigkaSktPnNldFdpZHRoKCR3aWR0aCAvIDI1Nik7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbkJ5Q29sdW1uKCRpKS0+c2V0VmlzaWJsZSghJGlzSGlkZGVuKTsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Q29sdW1uRGltZW5zaW9uQnlDb2x1bW4oJGkpLT5zZXRPdXRsaW5lTGV2ZWwoJGxldmVsKTsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Q29sdW1uRGltZW5zaW9uQnlDb2x1bW4oJGkpLT5zZXRDb2xsYXBzZWQoJGlzQ29sbGFwc2VkKTsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Q29sdW1uRGltZW5zaW9uQnlDb2x1bW4oJGkpLT5zZXRYZkluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskeGZJbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJPVwogICAgICoKICAgICAqIFRoaXMgcmVjb3JkIGNvbnRhaW5zIHRoZSBwcm9wZXJ0aWVzIG9mIGEgc2luZ2xlIHJvdyBpbiBhCiAgICAgKiBzaGVldC4gUm93cyBhbmQgY2VsbHMgaW4gYSBzaGVldCBhcmUgZGl2aWRlZCBpbnRvIGJsb2NrcwogICAgICogb2YgMzIgcm93cy4KICAgICAqCiAgICAgKiAtLSAgICAiT3Blbk9mZmljZS5vcmcncyBEb2N1bWVudGF0aW9uIG9mIHRoZSBNaWNyb3NvZnQKICAgICAqICAgICAgICAgRXhjZWwgRmlsZSBGb3JtYXQiCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFJvdygpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGluZGV4IG9mIHRoaXMgcm93CiAgICAgICAgICAgICRyID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBpbmRleCB0byBjb2x1bW4gb2YgdGhlIGZpcnN0IGNlbGwgd2hpY2ggaXMgZGVzY3JpYmVkIGJ5IGEgY2VsbCByZWNvcmQKCiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgaW5kZXggdG8gY29sdW1uIG9mIHRoZSBsYXN0IGNlbGwgd2hpY2ggaXMgZGVzY3JpYmVkIGJ5IGEgY2VsbCByZWNvcmQsIGluY3JlYXNlZCBieSAxCgogICAgICAgICAgICAvLyBvZmZzZXQ6IDY7IHNpemU6IDI7CgogICAgICAgICAgICAvLyBiaXQ6IDE0LTA7IG1hc2s6IDB4N0ZGRjsgaGVpZ2h0IG9mIHRoZSByb3csIGluIHR3aXBzID0gMS8yMCBvZiBhIHBvaW50CiAgICAgICAgICAgICRoZWlnaHQgPSAoMHg3RkZGICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDYpKSA+PiAwOwoKICAgICAgICAgICAgLy8gYml0OiAxNTogbWFzazogMHg4MDAwOyAwID0gcm93IGhhcyBjdXN0b20gaGVpZ2h0OyAxPSByb3cgaGFzIGRlZmF1bHQgaGVpZ2h0CiAgICAgICAgICAgICR1c2VEZWZhdWx0SGVpZ2h0ID0gKDB4ODAwMCAmIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA2KSkgPj4gMTU7CgogICAgICAgICAgICBpZiAoISR1c2VEZWZhdWx0SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFJvd0RpbWVuc2lvbigkciArIDEpLT5zZXRSb3dIZWlnaHQoJGhlaWdodCAvIDIwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA4OyBzaXplOiAyOyBub3QgdXNlZAoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxMDsgc2l6ZTogMjsgbm90IHVzZWQgaW4gQklGRjUtQklGRjgKCiAgICAgICAgICAgIC8vIG9mZnNldDogMTI7IHNpemU6IDQ7IG9wdGlvbiBmbGFncyBhbmQgZGVmYXVsdCByb3cgZm9ybWF0dGluZwoKICAgICAgICAgICAgLy8gYml0OiAyLTA6IG1hc2s6IDB4MDAwMDAwMDc7IG91dGxpbmUgbGV2ZWwgb2YgdGhlIHJvdwogICAgICAgICAgICAkbGV2ZWwgPSAoMHgwMDAwMDAwNyAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMikpID4+IDA7CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Um93RGltZW5zaW9uKCRyICsgMSktPnNldE91dGxpbmVMZXZlbCgkbGV2ZWwpOwoKICAgICAgICAgICAgLy8gYml0OiA0OyBtYXNrOiAweDAwMDAwMDEwOyAxID0gb3V0bGluZSBncm91cCBzdGFydCBvciBlbmRzIGhlcmUuLi4gYW5kIGlzIGNvbGxhcHNlZAogICAgICAgICAgICAkaXNDb2xsYXBzZWQgPSAoMHgwMDAwMDAxMCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMikpID4+IDQ7CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Um93RGltZW5zaW9uKCRyICsgMSktPnNldENvbGxhcHNlZCgkaXNDb2xsYXBzZWQpOwoKICAgICAgICAgICAgLy8gYml0OiA1OyBtYXNrOiAweDAwMDAwMDIwOyAxID0gcm93IGlzIGhpZGRlbgogICAgICAgICAgICAkaXNIaWRkZW4gPSAoMHgwMDAwMDAyMCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMikpID4+IDU7CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Um93RGltZW5zaW9uKCRyICsgMSktPnNldFZpc2libGUoISRpc0hpZGRlbik7CgogICAgICAgICAgICAvLyBiaXQ6IDc7IG1hc2s6IDB4MDAwMDAwODA7IDEgPSByb3cgaGFzIGV4cGxpY2l0IGZvcm1hdAogICAgICAgICAgICAkaGFzRXhwbGljaXRGb3JtYXQgPSAoMHgwMDAwMDA4MCAmIHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMikpID4+IDc7CgogICAgICAgICAgICAvLyBiaXQ6IDI3LTE2OyBtYXNrOiAweDBGRkYwMDAwOyBvbmx5IGFwcGxpZXMgd2hlbiBoYXNFeHBsaWNpdEZvcm1hdCA9IDE7IGluZGV4IHRvIFhGIHJlY29yZAogICAgICAgICAgICAkeGZJbmRleCA9ICgweDBGRkYwMDAwICYgc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsIDEyKSkgPj4gMTY7CgogICAgICAgICAgICBpZiAoJGhhc0V4cGxpY2l0Rm9ybWF0KSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFJvd0RpbWVuc2lvbigkciArIDEpLT5zZXRYZkluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskeGZJbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgUksgcmVjb3JkCiAgICAgKiBUaGlzIHJlY29yZCByZXByZXNlbnRzIGEgY2VsbCB0aGF0IGNvbnRhaW5zIGFuIFJLIHZhbHVlCiAgICAgKiAoZW5jb2RlZCBpbnRlZ2VyIG9yIGZsb2F0aW5nLXBvaW50IHZhbHVlKS4gSWYgYQogICAgICogZmxvYXRpbmctcG9pbnQgdmFsdWUgY2Fubm90IGJlIGVuY29kZWQgdG8gYW4gUksgdmFsdWUsCiAgICAgKiBhIE5VTUJFUiByZWNvcmQgd2lsbCBiZSB3cml0dGVuLiBUaGlzIHJlY29yZCByZXBsYWNlcyB0aGUKICAgICAqIHJlY29yZCBJTlRFR0VSIHdyaXR0ZW4gaW4gQklGRjIuCiAgICAgKgogICAgICogLS0gICAgIk9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0CiAgICAgKiAgICAgICAgIEV4Y2VsIEZpbGUgRm9ybWF0IgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRSaygpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgaW5kZXggdG8gcm93CiAgICAgICAgJHJvdyA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBpbmRleCB0byBjb2x1bW4KICAgICAgICAkY29sdW1uID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwogICAgICAgICRjb2x1bW5TdHJpbmcgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbHVtbik7CgogICAgICAgIC8vIFJlYWQgY2VsbD8KICAgICAgICBpZiAoKCR0aGlzLT5nZXRSZWFkRmlsdGVyKCkgIT09IG51bGwpICYmICR0aGlzLT5nZXRSZWFkRmlsdGVyKCktPnJlYWRDZWxsKCRjb2x1bW5TdHJpbmcsICRyb3cgKyAxLCAkdGhpcy0+cGhwU2hlZXQtPmdldFRpdGxlKCkpKSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgaW5kZXggdG8gWEYgcmVjb3JkCiAgICAgICAgICAgICR4ZkluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDQpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA2OyBzaXplOiA0OyBSSyB2YWx1ZQogICAgICAgICAgICAkcmtudW0gPSBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgNik7CiAgICAgICAgICAgICRudW1WYWx1ZSA9IHNlbGY6OmdldElFRUU3NTQoJHJrbnVtKTsKCiAgICAgICAgICAgICRjZWxsID0gJHRoaXMtPnBocFNoZWV0LT5nZXRDZWxsKCRjb2x1bW5TdHJpbmcgLiAoJHJvdyArIDEpKTsKICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAvLyBhZGQgc3R5bGUgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICRjZWxsLT5zZXRYZkluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskeGZJbmRleF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhZGQgY2VsbAogICAgICAgICAgICAkY2VsbC0+c2V0VmFsdWVFeHBsaWNpdCgkbnVtVmFsdWUsIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfTlVNRVJJQyk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgTEFCRUxTU1QgcmVjb3JkCiAgICAgKiBUaGlzIHJlY29yZCByZXByZXNlbnRzIGEgY2VsbCB0aGF0IGNvbnRhaW5zIGEgc3RyaW5nLiBJdAogICAgICogcmVwbGFjZXMgdGhlIExBQkVMIHJlY29yZCBhbmQgUlNUUklORyByZWNvcmQgdXNlZCBpbgogICAgICogQklGRjItQklGRjUuCiAgICAgKgogICAgICogLS0gICAgIk9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0CiAgICAgKiAgICAgICAgIEV4Y2VsIEZpbGUgRm9ybWF0IgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRMYWJlbFNzdCgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgaW5kZXggdG8gcm93CiAgICAgICAgJHJvdyA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBpbmRleCB0byBjb2x1bW4KICAgICAgICAkY29sdW1uID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwogICAgICAgICRjb2x1bW5TdHJpbmcgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbHVtbik7CgogICAgICAgICRlbXB0eUNlbGwgPSB0cnVlOwogICAgICAgIC8vIFJlYWQgY2VsbD8KICAgICAgICBpZiAoKCR0aGlzLT5nZXRSZWFkRmlsdGVyKCkgIT09IG51bGwpICYmICR0aGlzLT5nZXRSZWFkRmlsdGVyKCktPnJlYWRDZWxsKCRjb2x1bW5TdHJpbmcsICRyb3cgKyAxLCAkdGhpcy0+cGhwU2hlZXQtPmdldFRpdGxlKCkpKSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgaW5kZXggdG8gWEYgcmVjb3JkCiAgICAgICAgICAgICR4ZkluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDQpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA2OyBzaXplOiA0OyBpbmRleCB0byBTU1QgcmVjb3JkCiAgICAgICAgICAgICRpbmRleCA9IHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCA2KTsKCiAgICAgICAgICAgIC8vIGFkZCBjZWxsCiAgICAgICAgICAgIGlmICgoJGZtdFJ1bnMgPSAkdGhpcy0+c3N0WyRpbmRleF1bJ2ZtdFJ1bnMnXSkgJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgIC8vIHRoZW4gd2Ugc2hvdWxkIHRyZWF0IGFzIHJpY2ggdGV4dAogICAgICAgICAgICAgICAgJHJpY2hUZXh0ID0gbmV3IFBIUEV4Y2VsX1JpY2hUZXh0KCk7CiAgICAgICAgICAgICAgICAkY2hhclBvcyA9IDA7CiAgICAgICAgICAgICAgICAkc3N0Q291bnQgPSBjb3VudCgkdGhpcy0+c3N0WyRpbmRleF1bJ2ZtdFJ1bnMnXSk7CiAgICAgICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPD0gJHNzdENvdW50OyArKyRpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRmbXRSdW5zWyRpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRleHQgPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpTdWJzdHJpbmcoJHRoaXMtPnNzdFskaW5kZXhdWyd2YWx1ZSddLCAkY2hhclBvcywgJGZtdFJ1bnNbJGldWydjaGFyUG9zJ10gLSAkY2hhclBvcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjaGFyUG9zID0gJGZtdFJ1bnNbJGldWydjaGFyUG9zJ107CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRleHQgPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpTdWJzdHJpbmcoJHRoaXMtPnNzdFskaW5kZXhdWyd2YWx1ZSddLCAkY2hhclBvcywgUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q291bnRDaGFyYWN0ZXJzKCR0aGlzLT5zc3RbJGluZGV4XVsndmFsdWUnXSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkNvdW50Q2hhcmFjdGVycygkdGV4dCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaSA9PSAwKSB7IC8vIGZpcnN0IHRleHQgcnVuLCBubyBzdHlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJpY2hUZXh0LT5jcmVhdGVUZXh0KCR0ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0ZXh0UnVuID0gJHJpY2hUZXh0LT5jcmVhdGVUZXh0UnVuKCR0ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZm10UnVuc1skaSAtIDFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZm10UnVuc1skaSAtIDFdWydmb250SW5kZXgnXSA8IDQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZvbnRJbmRleCA9ICRmbXRSdW5zWyRpIC0gMV1bJ2ZvbnRJbmRleCddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaGFzIHRvIGRvIHdpdGggdGhhdCBpbmRleCA0IGlzIG9taXR0ZWQgaW4gYWxsIEJJRkYgdmVyc2lvbnMgZm9yIHNvbWUgc3RyYW5nZSByZWFzb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgdGhlIE9wZW5PZmZpY2UgZG9jdW1lbnRhdGlvbiBvZiB0aGUgRk9OVCByZWNvcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZvbnRJbmRleCA9ICRmbXRSdW5zWyRpIC0gMV1bJ2ZvbnRJbmRleCddIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRleHRSdW4tPnNldEZvbnQoY2xvbmUgJHRoaXMtPm9iakZvbnRzWyRmb250SW5kZXhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+cmVhZEVtcHR5Q2VsbHMgfHwgdHJpbSgkcmljaFRleHQtPmdldFBsYWluVGV4dCgpKSAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkY2VsbCA9ICR0aGlzLT5waHBTaGVldC0+Z2V0Q2VsbCgkY29sdW1uU3RyaW5nIC4gKCRyb3cgKyAxKSk7CiAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJHJpY2hUZXh0LCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX1NUUklORyk7CiAgICAgICAgICAgICAgICAgICAgJGVtcHR5Q2VsbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5yZWFkRW1wdHlDZWxscyB8fCB0cmltKCR0aGlzLT5zc3RbJGluZGV4XVsndmFsdWUnXSkgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgJGNlbGwgPSAkdGhpcy0+cGhwU2hlZXQtPmdldENlbGwoJGNvbHVtblN0cmluZyAuICgkcm93ICsgMSkpOwogICAgICAgICAgICAgICAgICAgICRjZWxsLT5zZXRWYWx1ZUV4cGxpY2l0KCR0aGlzLT5zc3RbJGluZGV4XVsndmFsdWUnXSwgUEhQRXhjZWxfQ2VsbF9EYXRhVHlwZTo6VFlQRV9TVFJJTkcpOwogICAgICAgICAgICAgICAgICAgICRlbXB0eUNlbGwgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5ICYmICEkZW1wdHlDZWxsKSB7CiAgICAgICAgICAgICAgICAvLyBhZGQgc3R5bGUgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICRjZWxsLT5zZXRYZkluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskeGZJbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgTVVMUksgcmVjb3JkCiAgICAgKiBUaGlzIHJlY29yZCByZXByZXNlbnRzIGEgY2VsbCByYW5nZSBjb250YWluaW5nIFJLIHZhbHVlCiAgICAgKiBjZWxscy4gQWxsIGNlbGxzIGFyZSBsb2NhdGVkIGluIHRoZSBzYW1lIHJvdy4KICAgICAqCiAgICAgKiAtLSAgICAiT3Blbk9mZmljZS5vcmcncyBEb2N1bWVudGF0aW9uIG9mIHRoZSBNaWNyb3NvZnQKICAgICAqICAgICAgICAgRXhjZWwgRmlsZSBGb3JtYXQiCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZE11bFJrKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBpbmRleCB0byByb3cKICAgICAgICAkcm93ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwoKICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IGluZGV4IHRvIGZpcnN0IGNvbHVtbgogICAgICAgICRjb2xGaXJzdCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKCiAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemU6IDI7IGluZGV4IHRvIGxhc3QgY29sdW1uCiAgICAgICAgJGNvbExhc3QgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgJGxlbmd0aCAtIDIpOwogICAgICAgICRjb2x1bW5zID0gJGNvbExhc3QgLSAkY29sRmlyc3QgKyAxOwoKICAgICAgICAvLyBvZmZzZXQgd2l0aGluIHJlY29yZCBkYXRhCiAgICAgICAgJG9mZnNldCA9IDQ7CgogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRjb2x1bW5zOyArKyRpKSB7CiAgICAgICAgICAgICRjb2x1bW5TdHJpbmcgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbEZpcnN0ICsgJGkpOwoKICAgICAgICAgICAgLy8gUmVhZCBjZWxsPwogICAgICAgICAgICBpZiAoKCR0aGlzLT5nZXRSZWFkRmlsdGVyKCkgIT09IG51bGwpICYmICR0aGlzLT5nZXRSZWFkRmlsdGVyKCktPnJlYWRDZWxsKCRjb2x1bW5TdHJpbmcsICRyb3cgKyAxLCAkdGhpcy0+cGhwU2hlZXQtPmdldFRpdGxlKCkpKSB7CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogMjsgaW5kZXggdG8gWEYgcmVjb3JkCiAgICAgICAgICAgICAgICAkeGZJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAkb2Zmc2V0KTsKCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogNDsgUksgdmFsdWUKICAgICAgICAgICAgICAgICRudW1WYWx1ZSA9IHNlbGY6OmdldElFRUU3NTQoc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsICRvZmZzZXQgKyAyKSk7CiAgICAgICAgICAgICAgICAkY2VsbCA9ICR0aGlzLT5waHBTaGVldC0+Z2V0Q2VsbCgkY29sdW1uU3RyaW5nIC4gKCRyb3cgKyAxKSk7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBhZGQgc3R5bGUKICAgICAgICAgICAgICAgICAgICAkY2VsbC0+c2V0WGZJbmRleCgkdGhpcy0+bWFwQ2VsbFhmSW5kZXhbJHhmSW5kZXhdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBhZGQgY2VsbCB2YWx1ZQogICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJG51bVZhbHVlLCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTUVSSUMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkb2Zmc2V0ICs9IDY7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgTlVNQkVSIHJlY29yZAogICAgICogVGhpcyByZWNvcmQgcmVwcmVzZW50cyBhIGNlbGwgdGhhdCBjb250YWlucyBhCiAgICAgKiBmbG9hdGluZy1wb2ludCB2YWx1ZS4KICAgICAqCiAgICAgKiAtLSAgICAiT3Blbk9mZmljZS5vcmcncyBEb2N1bWVudGF0aW9uIG9mIHRoZSBNaWNyb3NvZnQKICAgICAqICAgICAgICAgRXhjZWwgRmlsZSBGb3JtYXQiCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZE51bWJlcigpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgaW5kZXggdG8gcm93CiAgICAgICAgJHJvdyA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplIDI7IGluZGV4IHRvIGNvbHVtbgogICAgICAgICRjb2x1bW4gPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMik7CiAgICAgICAgJGNvbHVtblN0cmluZyA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkY29sdW1uKTsKCiAgICAgICAgLy8gUmVhZCBjZWxsPwogICAgICAgIGlmICgoJHRoaXMtPmdldFJlYWRGaWx0ZXIoKSAhPT0gbnVsbCkgJiYgJHRoaXMtPmdldFJlYWRGaWx0ZXIoKS0+cmVhZENlbGwoJGNvbHVtblN0cmluZywgJHJvdyArIDEsICR0aGlzLT5waHBTaGVldC0+Z2V0VGl0bGUoKSkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0IDQ7IHNpemU6IDI7IGluZGV4IHRvIFhGIHJlY29yZAogICAgICAgICAgICAkeGZJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA0KTsKCiAgICAgICAgICAgICRudW1WYWx1ZSA9IHNlbGY6OmV4dHJhY3ROdW1iZXIoc3Vic3RyKCRyZWNvcmREYXRhLCA2LCA4KSk7CgogICAgICAgICAgICAkY2VsbCA9ICR0aGlzLT5waHBTaGVldC0+Z2V0Q2VsbCgkY29sdW1uU3RyaW5nIC4gKCRyb3cgKyAxKSk7CiAgICAgICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgLy8gYWRkIGNlbGwgc3R5bGUKICAgICAgICAgICAgICAgICRjZWxsLT5zZXRYZkluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskeGZJbmRleF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhZGQgY2VsbCB2YWx1ZQogICAgICAgICAgICAkY2VsbC0+c2V0VmFsdWVFeHBsaWNpdCgkbnVtVmFsdWUsIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfTlVNRVJJQyk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgRk9STVVMQSByZWNvcmQgKyBwZXJoYXBzIGEgZm9sbG93aW5nIFNUUklORyByZWNvcmQgaWYgZm9ybXVsYSByZXN1bHQgaXMgYSBzdHJpbmcKICAgICAqIFRoaXMgcmVjb3JkIGNvbnRhaW5zIHRoZSB0b2tlbiBhcnJheSBhbmQgdGhlIHJlc3VsdCBvZiBhCiAgICAgKiBmb3JtdWxhIGNlbGwuCiAgICAgKgogICAgICogLS0gICAgIk9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0CiAgICAgKiAgICAgICAgIEV4Y2VsIEZpbGUgRm9ybWF0IgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRGb3JtdWxhKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyByb3cgaW5kZXgKICAgICAgICAkcm93ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwoKICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IGNvbCBpbmRleAogICAgICAgICRjb2x1bW4gPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMik7CiAgICAgICAgJGNvbHVtblN0cmluZyA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkY29sdW1uKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyMDogc2l6ZTogdmFyaWFibGU7IGZvcm11bGEgc3RydWN0dXJlCiAgICAgICAgJGZvcm11bGFTdHJ1Y3R1cmUgPSBzdWJzdHIoJHJlY29yZERhdGEsIDIwKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAxNDogc2l6ZTogMjsgb3B0aW9uIGZsYWdzLCByZWNhbGN1bGF0ZSBhbHdheXMsIHJlY2FsY3VsYXRlIG9uIG9wZW4gZXRjLgogICAgICAgICRvcHRpb25zID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDE0KTsKCiAgICAgICAgLy8gYml0OiAwOyBtYXNrOiAweDAwMDE7IDEgPSByZWNhbGN1bGF0ZSBhbHdheXMKICAgICAgICAvLyBiaXQ6IDE7IG1hc2s6IDB4MDAwMjsgMSA9IGNhbGN1bGF0ZSBvbiBvcGVuCiAgICAgICAgLy8gYml0OiAyOyBtYXNrOiAweDAwMDg7IDEgPSBwYXJ0IG9mIGEgc2hhcmVkIGZvcm11bGEKICAgICAgICAkaXNQYXJ0T2ZTaGFyZWRGb3JtdWxhID0gKGJvb2wpICgweDAwMDggJiAkb3B0aW9ucyk7CgogICAgICAgIC8vIFdBUk5JTkc6CiAgICAgICAgLy8gV2UgY2FuIGFwcGFyZW50bHkgbm90IHJlbHkgb24gJGlzUGFydE9mU2hhcmVkRm9ybXVsYS4gRXZlbiB3aGVuICRpc1BhcnRPZlNoYXJlZEZvcm11bGEgPSB0cnVlCiAgICAgICAgLy8gdGhlIGZvcm11bGEgZGF0YSBtYXkgYmUgb3JkaW5hcnkgZm9ybXVsYSBkYXRhLCB0aGVyZWZvcmUgd2UgbmVlZCB0byBjaGVjawogICAgICAgIC8vIGV4cGxpY2l0bHkgZm9yIHRoZSB0RXhwIHRva2VuICgweDAxKQogICAgICAgICRpc1BhcnRPZlNoYXJlZEZvcm11bGEgPSAkaXNQYXJ0T2ZTaGFyZWRGb3JtdWxhICYmIG9yZCgkZm9ybXVsYVN0cnVjdHVyZXsyfSkgPT0gMHgwMTsKCiAgICAgICAgaWYgKCRpc1BhcnRPZlNoYXJlZEZvcm11bGEpIHsKICAgICAgICAgICAgLy8gcGFydCBvZiBzaGFyZWQgZm9ybXVsYSB3aGljaCBtZWFucyB0aGVyZSB3aWxsIGJlIGEgZm9ybXVsYSB3aXRoIGEgdEV4cCB0b2tlbiBhbmQgbm90aGluZyBlbHNlCiAgICAgICAgICAgIC8vIGdldCB0aGUgYmFzZSBjZWxsLCBncmFiIHRFeHAgdG9rZW4KICAgICAgICAgICAgJGJhc2VSb3cgPSBzZWxmOjpnZXRJbnQyZCgkZm9ybXVsYVN0cnVjdHVyZSwgMyk7CiAgICAgICAgICAgICRiYXNlQ29sID0gc2VsZjo6Z2V0SW50MmQoJGZvcm11bGFTdHJ1Y3R1cmUsIDUpOwogICAgICAgICAgICAkdGhpcy0+X2Jhc2VDZWxsID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRiYXNlQ29sKS4gKCRiYXNlUm93ICsgMSk7CiAgICAgICAgfQoKICAgICAgICAvLyBSZWFkIGNlbGw\/CiAgICAgICAgaWYgKCgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpICE9PSBudWxsKSAmJiAkdGhpcy0+Z2V0UmVhZEZpbHRlcigpLT5yZWFkQ2VsbCgkY29sdW1uU3RyaW5nLCAkcm93ICsgMSwgJHRoaXMtPnBocFNoZWV0LT5nZXRUaXRsZSgpKSkgewogICAgICAgICAgICBpZiAoJGlzUGFydE9mU2hhcmVkRm9ybXVsYSkgewogICAgICAgICAgICAgICAgLy8gZm9ybXVsYSBpcyBhZGRlZCB0byB0aGlzIGNlbGwgYWZ0ZXIgdGhlIHNoZWV0IGhhcyBiZWVuIHJlYWQKICAgICAgICAgICAgICAgICR0aGlzLT5zaGFyZWRGb3JtdWxhUGFydHNbJGNvbHVtblN0cmluZyAuICgkcm93ICsgMSldID0gJHRoaXMtPl9iYXNlQ2VsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxNjogc2l6ZTogNDsgbm90IHVzZWQKCiAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgWEYgaW5kZXgKICAgICAgICAgICAgJHhmSW5kZXggPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgNCk7CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDY7IHNpemU6IDg7IHJlc3VsdCBvZiB0aGUgZm9ybXVsYQogICAgICAgICAgICBpZiAoKG9yZCgkcmVjb3JkRGF0YXs2fSkgPT0gMCkgJiYgKG9yZCgkcmVjb3JkRGF0YXsxMn0pID09IDI1NSkgJiYgKG9yZCgkcmVjb3JkRGF0YXsxM30pID09IDI1NSkpIHsKICAgICAgICAgICAgICAgIC8vIFN0cmluZyBmb3JtdWxhLiBSZXN1bHQgZm9sbG93cyBpbiBhcHBlbmRlZCBTVFJJTkcgcmVjb3JkCiAgICAgICAgICAgICAgICAkZGF0YVR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX1NUUklORzsKCiAgICAgICAgICAgICAgICAvLyByZWFkIHBvc3NpYmxlIFNIQVJFREZNTEEgcmVjb3JkCiAgICAgICAgICAgICAgICAkY29kZSA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zKTsKICAgICAgICAgICAgICAgIGlmICgkY29kZSA9PSBzZWxmOjpYTFNfVFlQRV9TSEFSRURGTUxBKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJlYWRTaGFyZWRGbWxhKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gcmVhZCBTVFJJTkcgcmVjb3JkCiAgICAgICAgICAgICAgICAkdmFsdWUgPSAkdGhpcy0+cmVhZFN0cmluZygpOwogICAgICAgICAgICB9IGVsc2VpZiAoKG9yZCgkcmVjb3JkRGF0YXs2fSkgPT0gMSkKICAgICAgICAgICAgICAgICYmIChvcmQoJHJlY29yZERhdGF7MTJ9KSA9PSAyNTUpCiAgICAgICAgICAgICAgICAmJiAob3JkKCRyZWNvcmREYXRhezEzfSkgPT0gMjU1KSkgewogICAgICAgICAgICAgICAgLy8gQm9vbGVhbiBmb3JtdWxhLiBSZXN1bHQgaXMgaW4gKzI7IDA9ZmFsc2UsIDE9dHJ1ZQogICAgICAgICAgICAgICAgJGRhdGFUeXBlID0gUEhQRXhjZWxfQ2VsbF9EYXRhVHlwZTo6VFlQRV9CT09MOwogICAgICAgICAgICAgICAgJHZhbHVlID0gKGJvb2wpIG9yZCgkcmVjb3JkRGF0YXs4fSk7CiAgICAgICAgICAgIH0gZWxzZWlmICgob3JkKCRyZWNvcmREYXRhezZ9KSA9PSAyKQogICAgICAgICAgICAgICAgJiYgKG9yZCgkcmVjb3JkRGF0YXsxMn0pID09IDI1NSkKICAgICAgICAgICAgICAgICYmIChvcmQoJHJlY29yZERhdGF7MTN9KSA9PSAyNTUpKSB7CiAgICAgICAgICAgICAgICAvLyBFcnJvciBmb3JtdWxhLiBFcnJvciBjb2RlIGlzIGluICsyCiAgICAgICAgICAgICAgICAkZGF0YVR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX0VSUk9SOwogICAgICAgICAgICAgICAgJHZhbHVlID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9FcnJvckNvZGU6Omxvb2t1cChvcmQoJHJlY29yZERhdGF7OH0pKTsKICAgICAgICAgICAgfSBlbHNlaWYgKChvcmQoJHJlY29yZERhdGF7Nn0pID09IDMpCiAgICAgICAgICAgICAgICAmJiAob3JkKCRyZWNvcmREYXRhezEyfSkgPT0gMjU1KQogICAgICAgICAgICAgICAgJiYgKG9yZCgkcmVjb3JkRGF0YXsxM30pID09IDI1NSkpIHsKICAgICAgICAgICAgICAgIC8vIEZvcm11bGEgcmVzdWx0IGlzIGEgbnVsbCBzdHJpbmcKICAgICAgICAgICAgICAgICRkYXRhVHlwZSA9IFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfTlVMTDsKICAgICAgICAgICAgICAgICR2YWx1ZSA9ICcnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gZm9ydW1sYSByZXN1bHQgaXMgYSBudW1iZXIsIGZpcnN0IDE0IGJ5dGVzIGxpa2UgX05VTUJFUiByZWNvcmQKICAgICAgICAgICAgICAgICRkYXRhVHlwZSA9IFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfTlVNRVJJQzsKICAgICAgICAgICAgICAgICR2YWx1ZSA9IHNlbGY6OmV4dHJhY3ROdW1iZXIoc3Vic3RyKCRyZWNvcmREYXRhLCA2LCA4KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRjZWxsID0gJHRoaXMtPnBocFNoZWV0LT5nZXRDZWxsKCRjb2x1bW5TdHJpbmcgLiAoJHJvdyArIDEpKTsKICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAvLyBhZGQgY2VsbCBzdHlsZQogICAgICAgICAgICAgICAgJGNlbGwtPnNldFhmSW5kZXgoJHRoaXMtPm1hcENlbGxYZkluZGV4WyR4ZkluZGV4XSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHN0b3JlIHRoZSBmb3JtdWxhCiAgICAgICAgICAgIGlmICghJGlzUGFydE9mU2hhcmVkRm9ybXVsYSkgewogICAgICAgICAgICAgICAgLy8gbm90IHBhcnQgb2Ygc2hhcmVkIGZvcm11bGEKICAgICAgICAgICAgICAgIC8vIGFkZCBjZWxsIHZhbHVlLiBJZiB3ZSBjYW4gcmVhZCBmb3JtdWxhLCBwb3B1bGF0ZSB3aXRoIGZvcm11bGEsIG90aGVyd2lzZSBqdXN0IHVzZWQgY2FjaGVkIHZhbHVlCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+dmVyc2lvbiAhPSBzZWxmOjpYTFNfQklGRjgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJ05vdCBCSUZGOC4gQ2FuIG9ubHkgcmVhZCBCSUZGOCBmb3JtdWxhcycpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkZm9ybXVsYSA9ICR0aGlzLT5nZXRGb3JtdWxhRnJvbVN0cnVjdHVyZSgkZm9ybXVsYVN0cnVjdHVyZSk7IC8vIGdldCBmb3JtdWxhIGluIGh1bWFuIGxhbmd1YWdlCiAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJz0nIC4gJGZvcm11bGEsIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfRk9STVVMQSk7CgogICAgICAgICAgICAgICAgfSBjYXRjaCAoUEhQRXhjZWxfRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJHZhbHVlLCAkZGF0YVR5cGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcgYXQgdGhpcyBwb2ludCwgZm9ybXVsYSBpZCBhZGRlZCBsYXRlciBpbiB0aGUgY29kZQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkY2VsbC0+c2V0VmFsdWVFeHBsaWNpdCgkdmFsdWUsICRkYXRhVHlwZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHN0b3JlIHRoZSBjYWNoZWQgY2FsY3VsYXRlZCB2YWx1ZQogICAgICAgICAgICAkY2VsbC0+c2V0Q2FsY3VsYXRlZFZhbHVlKCR2YWx1ZSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgYSBTSEFSRURGTUxBIHJlY29yZC4gVGhpcyBmdW5jdGlvbiBqdXN0IHN0b3JlcyB0aGUgYmluYXJ5IHNoYXJlZCBmb3JtdWxhIGluIHRoZSByZWFkZXIsCiAgICAgKiB3aGljaCB1c3VhbGx5IGNvbnRhaW5zIHJlbGF0aXZlIHJlZmVyZW5jZXMuCiAgICAgKiBUaGVzZSB3aWxsIGJlIHVzZWQgdG8gY29uc3RydWN0IHRoZSBmb3JtdWxhIGluIGVhY2ggc2hhcmVkIGZvcm11bGEgcGFydCBhZnRlciB0aGUgc2hlZXQgaXMgcmVhZC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkU2hhcmVkRm1sYSgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIG9mZnNldDogMCwgc2l6ZTogNjsgY2VsbCByYW5nZSBhZGRyZXNzIG9mIHRoZSBhcmVhIHVzZWQgYnkgdGhlIHNoYXJlZCBmb3JtdWxhLCBub3QgdXNlZCBmb3IgYW55dGhpbmcKICAgICAgICAkY2VsbFJhbmdlID0gc3Vic3RyKCRyZWNvcmREYXRhLCAwLCA2KTsKICAgICAgICAkY2VsbFJhbmdlID0gJHRoaXMtPnJlYWRCSUZGNUNlbGxSYW5nZUFkZHJlc3NGaXhlZCgkY2VsbFJhbmdlKTsgLy8gbm90ZTogZXZlbiBCSUZGOCB1c2VzIEJJRkY1IHN5bnRheAoKICAgICAgICAvLyBvZmZzZXQ6IDYsIHNpemU6IDE7IG5vdCB1c2VkCgogICAgICAgIC8vIG9mZnNldDogNywgc2l6ZTogMTsgbnVtYmVyIG9mIGV4aXN0aW5nIEZPUk1VTEEgcmVjb3JkcyBmb3IgdGhpcyBzaGFyZWQgZm9ybXVsYQogICAgICAgICRubyA9IG9yZCgkcmVjb3JkRGF0YXs3fSk7CgogICAgICAgIC8vIG9mZnNldDogOCwgc2l6ZTogdmFyOyBCaW5hcnkgdG9rZW4gYXJyYXkgb2YgdGhlIHNoYXJlZCBmb3JtdWxhCiAgICAgICAgJGZvcm11bGEgPSBzdWJzdHIoJHJlY29yZERhdGEsIDgpOwoKICAgICAgICAvLyBhdCB0aGlzIHBvaW50IHdlIG9ubHkgc3RvcmUgdGhlIHNoYXJlZCBmb3JtdWxhIGZvciBsYXRlciB1c2UKICAgICAgICAkdGhpcy0+c2hhcmVkRm9ybXVsYXNbJHRoaXMtPl9iYXNlQ2VsbF0gPSAkZm9ybXVsYTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIGEgU1RSSU5HIHJlY29yZCBmcm9tIGN1cnJlbnQgc3RyZWFtIHBvc2l0aW9uIGFuZCBhZHZhbmNlIHRoZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICogVGhpcyByZWNvcmQgaXMgdXNlZCBmb3Igc3RvcmluZyByZXN1bHQgZnJvbSBGT1JNVUxBIHJlY29yZCB3aGVuIGl0IGlzIGEgc3RyaW5nLCBhbmQKICAgICAqIGl0IG9jY3VycyBkaXJlY3RseSBhZnRlciB0aGUgRk9STVVMQSByZWNvcmQKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgc3RyaW5nIGNvbnRlbnRzIGFzIFVURi04CiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFN0cmluZygpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICgkdGhpcy0+dmVyc2lvbiA9PSBzZWxmOjpYTFNfQklGRjgpIHsKICAgICAgICAgICAgJHN0cmluZyA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nTG9uZygkcmVjb3JkRGF0YSk7CiAgICAgICAgICAgICR2YWx1ZSA9ICRzdHJpbmdbJ3ZhbHVlJ107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHN0cmluZyA9ICR0aGlzLT5yZWFkQnl0ZVN0cmluZ0xvbmcoJHJlY29yZERhdGEpOwogICAgICAgICAgICAkdmFsdWUgPSAkc3RyaW5nWyd2YWx1ZSddOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR2YWx1ZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIEJPT0xFUlIgcmVjb3JkCiAgICAgKiBUaGlzIHJlY29yZCByZXByZXNlbnRzIGEgQm9vbGVhbiB2YWx1ZSBvciBlcnJvciB2YWx1ZQogICAgICogY2VsbC4KICAgICAqCiAgICAgKiAtLSAgICAiT3Blbk9mZmljZS5vcmcncyBEb2N1bWVudGF0aW9uIG9mIHRoZSBNaWNyb3NvZnQKICAgICAqICAgICAgICAgRXhjZWwgRmlsZSBGb3JtYXQiCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEJvb2xFcnIoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IHJvdyBpbmRleAogICAgICAgICRyb3cgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgY29sdW1uIGluZGV4CiAgICAgICAgJGNvbHVtbiA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKICAgICAgICAkY29sdW1uU3RyaW5nID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjb2x1bW4pOwoKICAgICAgICAvLyBSZWFkIGNlbGw\/CiAgICAgICAgaWYgKCgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpICE9PSBudWxsKSAmJiAkdGhpcy0+Z2V0UmVhZEZpbHRlcigpLT5yZWFkQ2VsbCgkY29sdW1uU3RyaW5nLCAkcm93ICsgMSwgJHRoaXMtPnBocFNoZWV0LT5nZXRUaXRsZSgpKSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDI7IGluZGV4IHRvIFhGIHJlY29yZAogICAgICAgICAgICAkeGZJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA0KTsKCiAgICAgICAgICAgIC8vIG9mZnNldDogNjsgc2l6ZTogMTsgdGhlIGJvb2xlYW4gdmFsdWUgb3IgZXJyb3IgdmFsdWUKICAgICAgICAgICAgJGJvb2xFcnIgPSBvcmQoJHJlY29yZERhdGF7Nn0pOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA3OyBzaXplOiAxOyAwPWJvb2xlYW47IDE9ZXJyb3IKICAgICAgICAgICAgJGlzRXJyb3IgPSBvcmQoJHJlY29yZERhdGF7N30pOwoKICAgICAgICAgICAgJGNlbGwgPSAkdGhpcy0+cGhwU2hlZXQtPmdldENlbGwoJGNvbHVtblN0cmluZyAuICgkcm93ICsgMSkpOwogICAgICAgICAgICBzd2l0Y2ggKCRpc0Vycm9yKSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6IC8vIGJvb2xlYW4KICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSAoYm9vbCkgJGJvb2xFcnI7CgogICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjZWxsIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJHZhbHVlLCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX0JPT0wpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxOiAvLyBlcnJvciB0eXBlCiAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9FcnJvckNvZGU6Omxvb2t1cCgkYm9vbEVycik7CgogICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjZWxsIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJHZhbHVlLCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX0VSUk9SKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAvLyBhZGQgY2VsbCBzdHlsZQogICAgICAgICAgICAgICAgJGNlbGwtPnNldFhmSW5kZXgoJHRoaXMtPm1hcENlbGxYZkluZGV4WyR4ZkluZGV4XSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBNVUxCTEFOSyByZWNvcmQKICAgICAqIFRoaXMgcmVjb3JkIHJlcHJlc2VudHMgYSBjZWxsIHJhbmdlIG9mIGVtcHR5IGNlbGxzLiBBbGwKICAgICAqIGNlbGxzIGFyZSBsb2NhdGVkIGluIHRoZSBzYW1lIHJvdwogICAgICoKICAgICAqIC0tICAgICJPcGVuT2ZmaWNlLm9yZydzIERvY3VtZW50YXRpb24gb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICBFeGNlbCBGaWxlIEZvcm1hdCIKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkTXVsQmxhbmsoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGluZGV4IHRvIHJvdwogICAgICAgICRyb3cgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgaW5kZXggdG8gZmlyc3QgY29sdW1uCiAgICAgICAgJGZjID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwoKICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDIgeCBuYzsgbGlzdCBvZiBpbmRleGVzIHRvIFhGIHJlY29yZHMKICAgICAgICAvLyBhZGQgc3R5bGUgaW5mb3JtYXRpb24KICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkgJiYgJHRoaXMtPnJlYWRFbXB0eUNlbGxzKSB7CiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRsZW5ndGggLyAyIC0gMzsgKyskaSkgewogICAgICAgICAgICAgICAgJGNvbHVtblN0cmluZyA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkZmMgKyAkaSk7CgogICAgICAgICAgICAgICAgLy8gUmVhZCBjZWxsPwogICAgICAgICAgICAgICAgaWYgKCgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpICE9PSBudWxsKSAmJiAkdGhpcy0+Z2V0UmVhZEZpbHRlcigpLT5yZWFkQ2VsbCgkY29sdW1uU3RyaW5nLCAkcm93ICsgMSwgJHRoaXMtPnBocFNoZWV0LT5nZXRUaXRsZSgpKSkgewogICAgICAgICAgICAgICAgICAgICR4ZkluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDQgKyAyICogJGkpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0Q2VsbCgkY29sdW1uU3RyaW5nIC4gKCRyb3cgKyAxKSktPnNldFhmSW5kZXgoJHRoaXMtPm1hcENlbGxYZkluZGV4WyR4ZkluZGV4XSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG9mZnNldDogNjsgc2l6ZSAyOyBpbmRleCB0byBsYXN0IGNvbHVtbiAobm90IG5lZWRlZCkKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIExBQkVMIHJlY29yZAogICAgICogVGhpcyByZWNvcmQgcmVwcmVzZW50cyBhIGNlbGwgdGhhdCBjb250YWlucyBhIHN0cmluZy4gSW4KICAgICAqIEJJRkY4IGl0IGlzIHVzdWFsbHkgcmVwbGFjZWQgYnkgdGhlIExBQkVMU1NUIHJlY29yZC4KICAgICAqIEV4Y2VsIHN0aWxsIHVzZXMgdGhpcyByZWNvcmQsIGlmIGl0IGNvcGllcyB1bmZvcm1hdHRlZAogICAgICogdGV4dCBjZWxscyB0byB0aGUgY2xpcGJvYXJkLgogICAgICoKICAgICAqIC0tICAgICJPcGVuT2ZmaWNlLm9yZydzIERvY3VtZW50YXRpb24gb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICBFeGNlbCBGaWxlIEZvcm1hdCIKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkTGFiZWwoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGluZGV4IHRvIHJvdwogICAgICAgICRyb3cgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgaW5kZXggdG8gY29sdW1uCiAgICAgICAgJGNvbHVtbiA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKICAgICAgICAkY29sdW1uU3RyaW5nID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjb2x1bW4pOwoKICAgICAgICAvLyBSZWFkIGNlbGw\/CiAgICAgICAgaWYgKCgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpICE9PSBudWxsKSAmJiAkdGhpcy0+Z2V0UmVhZEZpbHRlcigpLT5yZWFkQ2VsbCgkY29sdW1uU3RyaW5nLCAkcm93ICsgMSwgJHRoaXMtPnBocFNoZWV0LT5nZXRUaXRsZSgpKSkgewogICAgICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDI7IFhGIGluZGV4CiAgICAgICAgICAgICR4ZkluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDQpOwoKICAgICAgICAgICAgLy8gYWRkIGNlbGwgdmFsdWUKICAgICAgICAgICAgLy8gdG9kbzogd2hhdCBpZiBzdHJpbmcgaXMgdmVyeSBsb25nPyBjb250aW51ZSByZWNvcmQKICAgICAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAgICAgJHN0cmluZyA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nTG9uZyhzdWJzdHIoJHJlY29yZERhdGEsIDYpKTsKICAgICAgICAgICAgICAgICR2YWx1ZSA9ICRzdHJpbmdbJ3ZhbHVlJ107CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkc3RyaW5nID0gJHRoaXMtPnJlYWRCeXRlU3RyaW5nTG9uZyhzdWJzdHIoJHJlY29yZERhdGEsIDYpKTsKICAgICAgICAgICAgICAgICR2YWx1ZSA9ICRzdHJpbmdbJ3ZhbHVlJ107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCR0aGlzLT5yZWFkRW1wdHlDZWxscyB8fCB0cmltKCR2YWx1ZSkgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAkY2VsbCA9ICR0aGlzLT5waHBTaGVldC0+Z2V0Q2VsbCgkY29sdW1uU3RyaW5nIC4gKCRyb3cgKyAxKSk7CiAgICAgICAgICAgICAgICAkY2VsbC0+c2V0VmFsdWVFeHBsaWNpdCgkdmFsdWUsIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfU1RSSU5HKTsKCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBhZGQgY2VsbCBzdHlsZQogICAgICAgICAgICAgICAgICAgICRjZWxsLT5zZXRYZkluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskeGZJbmRleF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgQkxBTksgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEJsYW5rKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyByb3cgaW5kZXgKICAgICAgICAkcm93ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwoKICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IGNvbCBpbmRleAogICAgICAgICRjb2wgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMik7CiAgICAgICAgJGNvbHVtblN0cmluZyA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkY29sKTsKCiAgICAgICAgLy8gUmVhZCBjZWxsPwogICAgICAgIGlmICgoJHRoaXMtPmdldFJlYWRGaWx0ZXIoKSAhPT0gbnVsbCkgJiYgJHRoaXMtPmdldFJlYWRGaWx0ZXIoKS0+cmVhZENlbGwoJGNvbHVtblN0cmluZywgJHJvdyArIDEsICR0aGlzLT5waHBTaGVldC0+Z2V0VGl0bGUoKSkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiA0OyBzaXplOiAyOyBYRiBpbmRleAogICAgICAgICAgICAkeGZJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA0KTsKCiAgICAgICAgICAgIC8vIGFkZCBzdHlsZSBpbmZvcm1hdGlvbgogICAgICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkgJiYgJHRoaXMtPnJlYWRFbXB0eUNlbGxzKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldENlbGwoJGNvbHVtblN0cmluZyAuICgkcm93ICsgMSkpLT5zZXRYZkluZGV4KCR0aGlzLT5tYXBDZWxsWGZJbmRleFskeGZJbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgTVNPRFJBV0lORyByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkTXNvRHJhd2luZygpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CgogICAgICAgIC8vIGdldCBzcGxpY2VkIHJlY29yZCBkYXRhCiAgICAgICAgJHNwbGljZWRSZWNvcmREYXRhID0gJHRoaXMtPmdldFNwbGljZWRSZWNvcmREYXRhKCk7CiAgICAgICAgJHJlY29yZERhdGEgPSAkc3BsaWNlZFJlY29yZERhdGFbJ3JlY29yZERhdGEnXTsKCiAgICAgICAgJHRoaXMtPmRyYXdpbmdEYXRhIC49ICRyZWNvcmREYXRhOwogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgT0JKIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRPYmooKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoJHRoaXMtPnJlYWREYXRhT25seSB8fCAkdGhpcy0+dmVyc2lvbiAhPSBzZWxmOjpYTFNfQklGRjgpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVjb3JkRGF0YSBjb25zaXN0cyBvZiBhbiBhcnJheSBvZiBzdWJyZWNvcmRzIGxvb2tpbmcgbGlrZSB0aGlzOgogICAgICAgIC8vICAgIGZ0OiAyIGJ5dGVzOyBmdENtbyB0eXBlICgweDE1KQogICAgICAgIC8vICAgIGNiOiAyIGJ5dGVzOyBzaXplIGluIGJ5dGVzIG9mIGZ0Q21vIGRhdGEKICAgICAgICAvLyAgICBvdDogMiBieXRlczsgT2JqZWN0IFR5cGUKICAgICAgICAvLyAgICBpZDogMiBieXRlczsgT2JqZWN0IGlkIG51bWJlcgogICAgICAgIC8vICAgIGdyYml0OiAyIGJ5dGVzOyBPcHRpb24gRmxhZ3MKICAgICAgICAvLyAgICBkYXRhOiB2YXI7IHN1YnJlY29yZCBkYXRhCgogICAgICAgIC8vIGZvciBub3csIHdlIGFyZSBqdXN0IGludGVyZXN0ZWQgaW4gdGhlIHNlY29uZCBzdWJyZWNvcmQgY29udGFpbmluZyB0aGUgb2JqZWN0IHR5cGUKICAgICAgICAkZnRDbW9UeXBlICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKICAgICAgICAkY2JDbW9TaXplICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKICAgICAgICAkb3RPYmpUeXBlICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA0KTsKICAgICAgICAkaWRPYmpJRCAgICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA2KTsKICAgICAgICAkZ3JiaXRPcHRzICA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCA2KTsKCiAgICAgICAgJHRoaXMtPm9ianNbXSA9IGFycmF5KAogICAgICAgICAgICAnZnRDbW9UeXBlJyA9PiAkZnRDbW9UeXBlLAogICAgICAgICAgICAnY2JDbW9TaXplJyA9PiAkY2JDbW9TaXplLAogICAgICAgICAgICAnb3RPYmpUeXBlJyA9PiAkb3RPYmpUeXBlLAogICAgICAgICAgICAnaWRPYmpJRCcgICA9PiAkaWRPYmpJRCwKICAgICAgICAgICAgJ2dyYml0T3B0cycgPT4gJGdyYml0T3B0cwogICAgICAgICk7CiAgICAgICAgJHRoaXMtPnRleHRPYmpSZWYgPSAkaWRPYmpJRDsKCi8vICAgICAgICBlY2hvICc8Yj5fcmVhZE9iaigpPC9iPjxiciAvPic7Ci8vICAgICAgICB2YXJfZHVtcChlbmQoJHRoaXMtPm9ianMpKTsKLy8gICAgICAgIGVjaG8gJzxiciAvPic7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBXSU5ET1cyIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRXaW5kb3cyKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBvcHRpb24gZmxhZ3MKICAgICAgICAkb3B0aW9ucyA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBpbmRleCB0byBmaXJzdCB2aXNpYmxlIHJvdwogICAgICAgICRmaXJzdFZpc2libGVSb3cgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMik7CgogICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgaW5kZXggdG8gZmlyc3QgdmlzaWJsZSBjb2x1bQogICAgICAgICRmaXJzdFZpc2libGVDb2x1bW4gPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgNCk7CiAgICAgICAgaWYgKCR0aGlzLT52ZXJzaW9uID09PSBzZWxmOjpYTFNfQklGRjgpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAgODsgc2l6ZTogMjsgbm90IHVzZWQKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxMDsgc2l6ZTogMjsgY2FjaGVkIG1hZ25pZmljYXRpb24gZmFjdG9yIGluIHBhZ2UgYnJlYWsgcHJldmlldyAoaW4gcGVyY2VudCk7IDAgPSBEZWZhdWx0ICg2MCUpCiAgICAgICAgICAgIC8vIG9mZnNldDogMTI7IHNpemU6IDI7IGNhY2hlZCBtYWduaWZpY2F0aW9uIGZhY3RvciBpbiBub3JtYWwgdmlldyAoaW4gcGVyY2VudCk7IDAgPSBEZWZhdWx0ICgxMDAlKQogICAgICAgICAgICAvLyBvZmZzZXQ6IDE0OyBzaXplOiA0OyBub3QgdXNlZAogICAgICAgICAgICAkem9vbXNjYWxlSW5QYWdlQnJlYWtQcmV2aWV3ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDEwKTsKICAgICAgICAgICAgaWYgKCR6b29tc2NhbGVJblBhZ2VCcmVha1ByZXZpZXcgPT09IDApIHsKICAgICAgICAgICAgICAgICR6b29tc2NhbGVJblBhZ2VCcmVha1ByZXZpZXcgPSA2MDsKICAgICAgICAgICAgfQogICAgICAgICAgICAkem9vbXNjYWxlSW5Ob3JtYWxWaWV3ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDEyKTsKICAgICAgICAgICAgaWYgKCR6b29tc2NhbGVJbk5vcm1hbFZpZXcgPT09IDApIHsKICAgICAgICAgICAgICAgICR6b29tc2NhbGVJbk5vcm1hbFZpZXcgPSAxMDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGJpdDogMTsgbWFzazogMHgwMDAyOyAwID0gZG8gbm90IHNob3cgZ3JpZGxpbmVzLCAxID0gc2hvdyBncmlkbGluZXMKICAgICAgICAkc2hvd0dyaWRsaW5lcyA9IChib29sKSAoKDB4MDAwMiAmICRvcHRpb25zKSA+PiAxKTsKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPnNldFNob3dHcmlkbGluZXMoJHNob3dHcmlkbGluZXMpOwoKICAgICAgICAvLyBiaXQ6IDI7IG1hc2s6IDB4MDAwNDsgMCA9IGRvIG5vdCBzaG93IGhlYWRlcnMsIDEgPSBzaG93IGhlYWRlcnMKICAgICAgICAkc2hvd1Jvd0NvbEhlYWRlcnMgPSAoYm9vbCkgKCgweDAwMDQgJiAkb3B0aW9ucykgPj4gMik7CiAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5zZXRTaG93Um93Q29sSGVhZGVycygkc2hvd1Jvd0NvbEhlYWRlcnMpOwoKICAgICAgICAvLyBiaXQ6IDM7IG1hc2s6IDB4MDAwODsgMCA9IHBhbmVzIGFyZSBub3QgZnJvemVuLCAxID0gcGFuZXMgYXJlIGZyb3plbgogICAgICAgICR0aGlzLT5mcm96ZW4gPSAoYm9vbCkgKCgweDAwMDggJiAkb3B0aW9ucykgPj4gMyk7CgogICAgICAgIC8vIGJpdDogNjsgbWFzazogMHgwMDQwOyAwID0gY29sdW1ucyBmcm9tIGxlZnQgdG8gcmlnaHQsIDEgPSBjb2x1bW5zIGZyb20gcmlnaHQgdG8gbGVmdAogICAgICAgICR0aGlzLT5waHBTaGVldC0+c2V0UmlnaHRUb0xlZnQoKGJvb2wpKCgweDAwNDAgJiAkb3B0aW9ucykgPj4gNikpOwoKICAgICAgICAvLyBiaXQ6IDEwOyBtYXNrOiAweDA0MDA7IDAgPSBzaGVldCBub3QgYWN0aXZlLCAxID0gc2hlZXQgYWN0aXZlCiAgICAgICAgJGlzQWN0aXZlID0gKGJvb2wpICgoMHgwNDAwICYgJG9wdGlvbnMpID4+IDEwKTsKICAgICAgICBpZiAoJGlzQWN0aXZlKSB7CiAgICAgICAgICAgICR0aGlzLT5waHBFeGNlbC0+c2V0QWN0aXZlU2hlZXRJbmRleCgkdGhpcy0+cGhwRXhjZWwtPmdldEluZGV4KCR0aGlzLT5waHBTaGVldCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gYml0OiAxMTsgbWFzazogMHgwODAwOyAwID0gbm9ybWFsIHZpZXcsIDEgPSBwYWdlIGJyZWFrIHZpZXcKICAgICAgICAkaXNQYWdlQnJlYWtQcmV2aWV3ID0gKGJvb2wpICgoMHgwODAwICYgJG9wdGlvbnMpID4+IDExKTsKCiAgICAgICAgLy9GSVhNRTogc2V0ICRmaXJzdFZpc2libGVSb3cgYW5kICRmaXJzdFZpc2libGVDb2x1bW4KCiAgICAgICAgaWYgKCR0aGlzLT5waHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPmdldFZpZXcoKSAhPT0gUEhQRXhjZWxfV29ya3NoZWV0X1NoZWV0Vmlldzo6U0hFRVRWSUVXX1BBR0VfTEFZT1VUKSB7CiAgICAgICAgICAgIC8vTk9URTogdGhpcyBzZXR0aW5nIGlzIGluZmVyaW9yIHRvIHBhZ2UgbGF5b3V0IHZpZXcoRXhjZWwyMDA3LSkKICAgICAgICAgICAgJHZpZXcgPSAkaXNQYWdlQnJlYWtQcmV2aWV3ID8gUEhQRXhjZWxfV29ya3NoZWV0X1NoZWV0Vmlldzo6U0hFRVRWSUVXX1BBR0VfQlJFQUtfUFJFVklFVyA6IFBIUEV4Y2VsX1dvcmtzaGVldF9TaGVldFZpZXc6OlNIRUVUVklFV19OT1JNQUw7CiAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPnNldFZpZXcoJHZpZXcpOwogICAgICAgICAgICBpZiAoJHRoaXMtPnZlcnNpb24gPT09IHNlbGY6OlhMU19CSUZGOCkgewogICAgICAgICAgICAgICAgJHpvb21TY2FsZSA9ICRpc1BhZ2VCcmVha1ByZXZpZXcgPyAkem9vbXNjYWxlSW5QYWdlQnJlYWtQcmV2aWV3IDogJHpvb21zY2FsZUluTm9ybWFsVmlldzsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPnNldFpvb21TY2FsZSgkem9vbVNjYWxlKTsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPnNldFpvb21TY2FsZU5vcm1hbCgkem9vbXNjYWxlSW5Ob3JtYWxWaWV3KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgUExWIFJlY29yZChDcmVhdGVkIGJ5IEV4Y2VsMjAwNyBvciB1cHBlcikKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkUGFnZUxheW91dFZpZXcoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAvL3Zhcl9kdW1wKHVucGFjaygidnJ0L3ZncmJpdEZydC9WMnJlc2VydmVkL3Z3U2NhbGVQTFYvdmdyYml0IiwgJHJlY29yZERhdGEpKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBydAogICAgICAgIC8vLT5pZ25vcmUKICAgICAgICAkcnQgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBncmJpdGZyCiAgICAgICAgLy8tPmlnbm9yZQogICAgICAgICRncmJpdEZydCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDg7IHJlc2VydmVkCiAgICAgICAgLy8tPmlnbm9yZQoKICAgICAgICAvLyBvZmZzZXQ6IDEyOyBzaXplIDI7IHpvb20gc2NhbGUKICAgICAgICAkd1NjYWxlUExWID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDEyKTsKICAgICAgICAvLyBvZmZzZXQ6IDE0OyBzaXplIDI7IGdyYml0CiAgICAgICAgJGdyYml0ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDE0KTsKCiAgICAgICAgLy8gZGVjb21wcmlzZSBncmJpdAogICAgICAgICRmUGFnZUxheW91dFZpZXcgICA9ICRncmJpdCAmIDB4MDE7CiAgICAgICAgJGZSdWxlclZpc2libGUgICAgID0gKCRncmJpdCA+PiAxKSAmIDB4MDE7IC8vbm8gc3VwcG9ydAogICAgICAgICRmV2hpdGVzcGFjZUhpZGRlbiA9ICgkZ3JiaXQgPj4gMykgJiAweDAxOyAvL25vIHN1cHBvcnQKCiAgICAgICAgaWYgKCRmUGFnZUxheW91dFZpZXcgPT09IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRTaGVldFZpZXcoKS0+c2V0VmlldyhQSFBFeGNlbF9Xb3Jrc2hlZXRfU2hlZXRWaWV3OjpTSEVFVFZJRVdfUEFHRV9MQVlPVVQpOwogICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFNoZWV0VmlldygpLT5zZXRab29tU2NhbGUoJHdTY2FsZVBMVik7IC8vc2V0IGJ5IEV4Y2VsMjAwNyBvbmx5IGlmIFNIRUVUVklFV19QQUdFX0xBWU9VVAogICAgICAgIH0KICAgICAgICAvL290aGVyd2lzZSwgd2UgY2Fubm90IGtub3cgd2hldGhlciBTSEVFVFZJRVdfUEFHRV9MQVlPVVQgb3IgU0hFRVRWSUVXX1BBR0VfQlJFQUtfUFJFVklFVy4KICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgU0NMIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRTY2woKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IG51bWVyYXRvciBvZiB0aGUgdmlldyBtYWduaWZpY2F0aW9uCiAgICAgICAgJG51bWVyYXRvciA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBudW1lcmF0b3Igb2YgdGhlIHZpZXcgbWFnbmlmaWNhdGlvbgogICAgICAgICRkZW51bWVyYXRvciA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyKTsKCiAgICAgICAgLy8gc2V0IHRoZSB6b29tIHNjYWxlIChpbiBwZXJjZW50KQogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPnNldFpvb21TY2FsZSgkbnVtZXJhdG9yICogMTAwIC8gJGRlbnVtZXJhdG9yKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIFBBTkUgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFBhbmUoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBwb3NpdGlvbiBvZiB2ZXJ0aWNhbCBzcGxpdAogICAgICAgICAgICAkcHggPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMCk7CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IHBvc2l0aW9uIG9mIGhvcml6b250YWwgc3BsaXQKICAgICAgICAgICAgJHB5ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwoKICAgICAgICAgICAgaWYgKCR0aGlzLT5mcm96ZW4pIHsKICAgICAgICAgICAgICAgIC8vIGZyb3plbiBwYW5lcwogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5mcmVlemVQYW5lKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcHgpIC4gKCRweSArIDEpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIHVuZnJvemVuIHBhbmVzOyBzcGxpdCB3aW5kb3dzOyBub3Qgc3VwcG9ydGVkIGJ5IFBIUEV4Y2VsIGNvcmUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIFNFTEVDVElPTiByZWNvcmQuIFRoZXJlIGlzIG9uZSBzdWNoIHJlY29yZCBmb3IgZWFjaCBwYW5lIGluIHRoZSBzaGVldC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkU2VsZWN0aW9uKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMTsgcGFuZSBpZGVudGlmaWVyCiAgICAgICAgICAgICRwYW5lSWQgPSBvcmQoJHJlY29yZERhdGF7MH0pOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAyOyBpbmRleCB0byByb3cgb2YgdGhlIGFjdGl2ZSBjZWxsCiAgICAgICAgICAgICRyID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDEpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAzOyBzaXplOiAyOyBpbmRleCB0byBjb2x1bW4gb2YgdGhlIGFjdGl2ZSBjZWxsCiAgICAgICAgICAgICRjID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDMpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA1OyBzaXplOiAyOyBpbmRleCBpbnRvIHRoZSBmb2xsb3dpbmcgY2VsbCByYW5nZSBsaXN0IHRvIHRoZQogICAgICAgICAgICAvLyAgZW50cnkgdGhhdCBjb250YWlucyB0aGUgYWN0aXZlIGNlbGwKICAgICAgICAgICAgJGluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDUpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiA3OyBzaXplOiB2YXI7IGNlbGwgcmFuZ2UgYWRkcmVzcyBsaXN0IGNvbnRhaW5pbmcgYWxsIHNlbGVjdGVkIGNlbGwgcmFuZ2VzCiAgICAgICAgICAgICRkYXRhID0gc3Vic3RyKCRyZWNvcmREYXRhLCA3KTsKICAgICAgICAgICAgJGNlbGxSYW5nZUFkZHJlc3NMaXN0ID0gJHRoaXMtPnJlYWRCSUZGNUNlbGxSYW5nZUFkZHJlc3NMaXN0KCRkYXRhKTsgLy8gbm90ZTogYWxzbyBCSUZGOCB1c2VzIEJJRkY1IHN5bnRheAoKICAgICAgICAgICAgJHNlbGVjdGVkQ2VsbHMgPSAkY2VsbFJhbmdlQWRkcmVzc0xpc3RbJ2NlbGxSYW5nZUFkZHJlc3NlcyddWzBdOwoKICAgICAgICAgICAgLy8gZmlyc3Qgcm93ICcxJyArIGxhc3Qgcm93ICcxNjM4NCcgaW5kaWNhdGVzIHRoYXQgZnVsbCBjb2x1bW4gaXMgc2VsZWN0ZWQgKGFwcGFyZW50bHkgYWxzbyBpbiBCSUZGOCEpCiAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvXihbQS1aXSsxXDpbQS1aXSspMTYzODQkLycsICRzZWxlY3RlZENlbGxzKSkgewogICAgICAgICAgICAgICAgJHNlbGVjdGVkQ2VsbHMgPSBwcmVnX3JlcGxhY2UoJy9eKFtBLVpdKzFcOltBLVpdKykxNjM4NCQvJywgJyR7MX0xMDQ4NTc2JywgJHNlbGVjdGVkQ2VsbHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBmaXJzdCByb3cgJzEnICsgbGFzdCByb3cgJzY1NTM2JyBpbmRpY2F0ZXMgdGhhdCBmdWxsIGNvbHVtbiBpcyBzZWxlY3RlZAogICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgnL14oW0EtWl0rMVw6W0EtWl0rKTY1NTM2JC8nLCAkc2VsZWN0ZWRDZWxscykpIHsKICAgICAgICAgICAgICAgICRzZWxlY3RlZENlbGxzID0gcHJlZ19yZXBsYWNlKCcvXihbQS1aXSsxXDpbQS1aXSspNjU1MzYkLycsICckezF9MTA0ODU3NicsICRzZWxlY3RlZENlbGxzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZmlyc3QgY29sdW1uICdBJyArIGxhc3QgY29sdW1uICdJVicgaW5kaWNhdGVzIHRoYXQgZnVsbCByb3cgaXMgc2VsZWN0ZWQKICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJy9eKEFbMC05XStcOilJVihbMC05XSspJC8nLCAkc2VsZWN0ZWRDZWxscykpIHsKICAgICAgICAgICAgICAgICRzZWxlY3RlZENlbGxzID0gcHJlZ19yZXBsYWNlKCcvXihBWzAtOV0rXDopSVYoWzAtOV0rKSQvJywgJyR7MX1YRkQkezJ9JywgJHNlbGVjdGVkQ2VsbHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPnNldFNlbGVjdGVkQ2VsbHMoJHNlbGVjdGVkQ2VsbHMpOwogICAgICAgIH0KICAgIH0KCgogICAgcHJpdmF0ZSBmdW5jdGlvbiBpbmNsdWRlQ2VsbFJhbmdlRmlsdGVyZWQoJGNlbGxSYW5nZUFkZHJlc3MpCiAgICB7CiAgICAgICAgJGluY2x1ZGVDZWxsUmFuZ2UgPSB0cnVlOwogICAgICAgIGlmICgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpICE9PSBudWxsKSB7CiAgICAgICAgICAgICRpbmNsdWRlQ2VsbFJhbmdlID0gZmFsc2U7CiAgICAgICAgICAgICRyYW5nZUJvdW5kYXJpZXMgPSBQSFBFeGNlbF9DZWxsOjpnZXRSYW5nZUJvdW5kYXJpZXMoJGNlbGxSYW5nZUFkZHJlc3MpOwogICAgICAgICAgICAkcmFuZ2VCb3VuZGFyaWVzWzFdWzBdKys7CiAgICAgICAgICAgIGZvciAoJHJvdyA9ICRyYW5nZUJvdW5kYXJpZXNbMF1bMV07ICRyb3cgPD0gJHJhbmdlQm91bmRhcmllc1sxXVsxXTsgJHJvdysrKSB7CiAgICAgICAgICAgICAgICBmb3IgKCRjb2x1bW4gPSAkcmFuZ2VCb3VuZGFyaWVzWzBdWzBdOyAkY29sdW1uICE9ICRyYW5nZUJvdW5kYXJpZXNbMV1bMF07ICRjb2x1bW4rKykgewogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpLT5yZWFkQ2VsbCgkY29sdW1uLCAkcm93LCAkdGhpcy0+cGhwU2hlZXQtPmdldFRpdGxlKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbmNsdWRlQ2VsbFJhbmdlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgMjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRpbmNsdWRlQ2VsbFJhbmdlOwogICAgfQoKCiAgICAvKioKICAgICAqIE1FUkdFRENFTExTCiAgICAgKgogICAgICogVGhpcyByZWNvcmQgY29udGFpbnMgdGhlIGFkZHJlc3NlcyBvZiBtZXJnZWQgY2VsbCByYW5nZXMKICAgICAqIGluIHRoZSBjdXJyZW50IHNoZWV0LgogICAgICoKICAgICAqIC0tICAgICJPcGVuT2ZmaWNlLm9yZydzIERvY3VtZW50YXRpb24gb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICBFeGNlbCBGaWxlIEZvcm1hdCIKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkTWVyZ2VkQ2VsbHMoKQogICAgewogICAgICAgICRsZW5ndGggPSBzZWxmOjpnZXRJbnQyZCgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDIpOwogICAgICAgICRyZWNvcmREYXRhID0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoJHRoaXMtPnZlcnNpb24gPT0gc2VsZjo6WExTX0JJRkY4ICYmICEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICRjZWxsUmFuZ2VBZGRyZXNzTGlzdCA9ICR0aGlzLT5yZWFkQklGRjhDZWxsUmFuZ2VBZGRyZXNzTGlzdCgkcmVjb3JkRGF0YSk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRjZWxsUmFuZ2VBZGRyZXNzTGlzdFsnY2VsbFJhbmdlQWRkcmVzc2VzJ10gYXMgJGNlbGxSYW5nZUFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIGlmICgoc3RycG9zKCRjZWxsUmFuZ2VBZGRyZXNzLCAnOicpICE9PSBmYWxzZSkgJiYKICAgICAgICAgICAgICAgICAgICAoJHRoaXMtPmluY2x1ZGVDZWxsUmFuZ2VGaWx0ZXJlZCgkY2VsbFJhbmdlQWRkcmVzcykpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5tZXJnZUNlbGxzKCRjZWxsUmFuZ2VBZGRyZXNzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIEhZUEVSTElOSyByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkSHlwZXJMaW5rKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIGZvcndhcmQgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiA4OyBjZWxsIHJhbmdlIGFkZHJlc3Mgb2YgYWxsIGNlbGxzIGNvbnRhaW5pbmcgdGhpcyBoeXBlcmxpbmsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRjZWxsUmFuZ2UgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbFJhbmdlQWRkcmVzc0ZpeGVkKCRyZWNvcmREYXRhLCAwLCA4KTsKICAgICAgICAgICAgfSBjYXRjaCAoUEhQRXhjZWxfRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG9mZnNldDogOCwgc2l6ZTogMTY7IEdVSUQgb2YgU3RkTGluawoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAyNCwgc2l6ZTogNDsgdW5rbm93biB2YWx1ZQoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAyOCwgc2l6ZTogNDsgb3B0aW9uIGZsYWdzCiAgICAgICAgICAgIC8vIGJpdDogMDsgbWFzazogMHgwMDAwMDAwMTsgMCA9IG5vIGxpbmsgb3IgZXh0YW50LCAxID0gZmlsZSBsaW5rIG9yIFVSTAogICAgICAgICAgICAkaXNGaWxlTGlua09yVXJsID0gKDB4MDAwMDAwMDEgJiBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMjgpKSA+PiAwOwoKICAgICAgICAgICAgLy8gYml0OiAxOyBtYXNrOiAweDAwMDAwMDAyOyAwID0gcmVsYXRpdmUgcGF0aCwgMSA9IGFic29sdXRlIHBhdGggb3IgVVJMCiAgICAgICAgICAgICRpc0Fic1BhdGhPclVybCA9ICgweDAwMDAwMDAxICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDI4KSkgPj4gMTsKCiAgICAgICAgICAgIC8vIGJpdDogMiAoYW5kIDQpOyBtYXNrOiAweDAwMDAwMDE0OyAwID0gbm8gZGVzY3JpcHRpb24KICAgICAgICAgICAgJGhhc0Rlc2MgPSAoMHgwMDAwMDAxNCAmIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyOCkpID4+IDI7CgogICAgICAgICAgICAvLyBiaXQ6IDM7IG1hc2s6IDB4MDAwMDAwMDg7IDAgPSBubyB0ZXh0LCAxID0gaGFzIHRleHQKICAgICAgICAgICAgJGhhc1RleHQgPSAoMHgwMDAwMDAwOCAmIHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAyOCkpID4+IDM7CgogICAgICAgICAgICAvLyBiaXQ6IDc7IG1hc2s6IDB4MDAwMDAwODA7IDAgPSBubyB0YXJnZXQgZnJhbWUsIDEgPSBoYXMgdGFyZ2V0IGZyYW1lCiAgICAgICAgICAgICRoYXNGcmFtZSA9ICgweDAwMDAwMDgwICYgc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDI4KSkgPj4gNzsKCiAgICAgICAgICAgIC8vIGJpdDogODsgbWFzazogMHgwMDAwMDEwMDsgMCA9IGZpbGUgbGluayBvciBVUkwsIDEgPSBVTkMgcGF0aCAoaW5jLiBzZXJ2ZXIgbmFtZSkKICAgICAgICAgICAgJGlzVU5DID0gKDB4MDAwMDAxMDAgJiBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMjgpKSA+PiA4OwoKICAgICAgICAgICAgLy8gb2Zmc2V0IHdpdGhpbiByZWNvcmQgZGF0YQogICAgICAgICAgICAkb2Zmc2V0ID0gMzI7CgogICAgICAgICAgICBpZiAoJGhhc0Rlc2MpIHsKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMzI7IHNpemU6IHZhcjsgY2hhcmFjdGVyIGNvdW50IG9mIGRlc2NyaXB0aW9uIHRleHQKICAgICAgICAgICAgICAgICRkbCA9IHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAzMik7CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDM2OyBzaXplOiB2YXI7IGNoYXJhY3RlciBhcnJheSBvZiBkZXNjcmlwdGlvbiB0ZXh0LCBubyBVbmljb2RlIHN0cmluZyBoZWFkZXIsIGFsd2F5cyAxNi1iaXQgY2hhcmFjdGVycywgemVybyB0ZXJtaW5hdGVkCiAgICAgICAgICAgICAgICAkZGVzYyA9IHNlbGY6OmVuY29kZVVURjE2KHN1YnN0cigkcmVjb3JkRGF0YSwgMzYsIDIgKiAoJGRsIC0gMSkpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAkb2Zmc2V0ICs9IDQgKyAyICogJGRsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkaGFzRnJhbWUpIHsKICAgICAgICAgICAgICAgICRmbCA9IHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAkb2Zmc2V0KTsKICAgICAgICAgICAgICAgICRvZmZzZXQgKz0gNCArIDIgKiAkZmw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGRldGVjdCB0eXBlIG9mIGh5cGVybGluayAodGhlcmUgYXJlIDQgdHlwZXMpCiAgICAgICAgICAgICRoeXBlcmxpbmtUeXBlID0gbnVsbDsKCiAgICAgICAgICAgIGlmICgkaXNVTkMpIHsKICAgICAgICAgICAgICAgICRoeXBlcmxpbmtUeXBlID0gJ1VOQyc7CiAgICAgICAgICAgIH0gZWxzZWlmICghJGlzRmlsZUxpbmtPclVybCkgewogICAgICAgICAgICAgICAgJGh5cGVybGlua1R5cGUgPSAnd29ya2Jvb2snOwogICAgICAgICAgICB9IGVsc2VpZiAob3JkKCRyZWNvcmREYXRheyRvZmZzZXR9KSA9PSAweDAzKSB7CiAgICAgICAgICAgICAgICAkaHlwZXJsaW5rVHlwZSA9ICdsb2NhbCc7CiAgICAgICAgICAgIH0gZWxzZWlmIChvcmQoJHJlY29yZERhdGF7JG9mZnNldH0pID09IDB4RTApIHsKICAgICAgICAgICAgICAgICRoeXBlcmxpbmtUeXBlID0gJ1VSTCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoJGh5cGVybGlua1R5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ1VSTCc6CiAgICAgICAgICAgICAgICAgICAgLy8gc2VjdGlvbiA1LjU4LjI6IEh5cGVybGluayBjb250YWluaW5nIGEgVVJMCiAgICAgICAgICAgICAgICAgICAgLy8gZS5nLiBodHRwOi8vZXhhbXBsZS5vcmcvaW5kZXgucGhwCgogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiAxNjsgR1VJRCBvZiBVUkwgTW9uaWtlcgogICAgICAgICAgICAgICAgICAgICRvZmZzZXQgKz0gMTY7CiAgICAgICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemU6IDQ7IHNpemUgKGluIGJ5dGVzKSBvZiBjaGFyYWN0ZXIgYXJyYXkgb2YgdGhlIFVSTCBpbmNsdWRpbmcgdHJhaWxpbmcgemVybyB3b3JkCiAgICAgICAgICAgICAgICAgICAgJHVzID0gc2VsZjo6Z2V0SW50NGQoJHJlY29yZERhdGEsICRvZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICRvZmZzZXQgKz0gNDsKICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogJHVzOyBjaGFyYWN0ZXIgYXJyYXkgb2YgdGhlIFVSTCwgbm8gVW5pY29kZSBzdHJpbmcgaGVhZGVyLCBhbHdheXMgMTYtYml0IGNoYXJhY3RlcnMsIHplcm8tdGVybWluYXRlZAogICAgICAgICAgICAgICAgICAgICR1cmwgPSBzZWxmOjplbmNvZGVVVEYxNihzdWJzdHIoJHJlY29yZERhdGEsICRvZmZzZXQsICR1cyAtIDIpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgJG51bGxPZmZzZXQgPSBzdHJwb3MoJHVybCwgMHgwMCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRudWxsT2Zmc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR1cmwgPSBzdWJzdHIoJHVybCwgMCwgJG51bGxPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkdXJsIC49ICRoYXNUZXh0ID8gJyMnIDogJyc7CiAgICAgICAgICAgICAgICAgICAgJG9mZnNldCArPSAkdXM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdsb2NhbCc6CiAgICAgICAgICAgICAgICAgICAgLy8gc2VjdGlvbiA1LjU4LjM6IEh5cGVybGluayB0byBsb2NhbCBmaWxlCiAgICAgICAgICAgICAgICAgICAgLy8gZXhhbXBsZXM6CiAgICAgICAgICAgICAgICAgICAgLy8gICBteWRvYy50eHQKICAgICAgICAgICAgICAgICAgICAvLyAgIC4uLy4uL3NvbWVkb2MueGxzI1NoZWV0IUExCgogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiAxNjsgR1VJIG9mIEZpbGUgTW9uaWtlcgogICAgICAgICAgICAgICAgICAgICRvZmZzZXQgKz0gMTY7CgogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiAyOyBkaXJlY3RvcnkgdXAtbGV2ZWwgY291bnQuCiAgICAgICAgICAgICAgICAgICAgJHVwTGV2ZWxDb3VudCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAkb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAkb2Zmc2V0ICs9IDI7CgogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiA0OyBjaGFyYWN0ZXIgY291bnQgb2YgdGhlIHNob3J0ZW5lZCBmaWxlIHBhdGggYW5kIG5hbWUsIGluY2x1ZGluZyB0cmFpbGluZyB6ZXJvIHdvcmQKICAgICAgICAgICAgICAgICAgICAkc2wgPSBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgJG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgJG9mZnNldCArPSA0OwoKICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogc2w7IGNoYXJhY3RlciBhcnJheSBvZiB0aGUgc2hvcnRlbmVkIGZpbGUgcGF0aCBhbmQgbmFtZSBpbiA4LjMtRE9TLWZvcm1hdCAoY29tcHJlc3NlZCBVbmljb2RlIHN0cmluZykKICAgICAgICAgICAgICAgICAgICAkc2hvcnRlbmVkRmlsZVBhdGggPSBzdWJzdHIoJHJlY29yZERhdGEsICRvZmZzZXQsICRzbCk7CiAgICAgICAgICAgICAgICAgICAgJHNob3J0ZW5lZEZpbGVQYXRoID0gc2VsZjo6ZW5jb2RlVVRGMTYoJHNob3J0ZW5lZEZpbGVQYXRoLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAkc2hvcnRlbmVkRmlsZVBhdGggPSBzdWJzdHIoJHNob3J0ZW5lZEZpbGVQYXRoLCAwLCAtMSk7IC8vIHJlbW92ZSB0cmFpbGluZyB6ZXJvCgogICAgICAgICAgICAgICAgICAgICRvZmZzZXQgKz0gJHNsOwoKICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogMjQ7IHVua25vd24gc2VxdWVuY2UKICAgICAgICAgICAgICAgICAgICAkb2Zmc2V0ICs9IDI0OwoKICAgICAgICAgICAgICAgICAgICAvLyBleHRlbmRlZCBmaWxlIHBhdGgKICAgICAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogNDsgc2l6ZSBvZiB0aGUgZm9sbG93aW5nIGZpbGUgbGluayBmaWVsZCBpbmNsdWRpbmcgc3RyaW5nIGxlbnRoIG1hcmsKICAgICAgICAgICAgICAgICAgICAkc3ogPSBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgJG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgJG9mZnNldCArPSA0OwoKICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IHByZXNlbnQgaWYgJHN6ID4gMAogICAgICAgICAgICAgICAgICAgIGlmICgkc3ogPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiA0OyBzaXplIG9mIHRoZSBjaGFyYWN0ZXIgYXJyYXkgb2YgdGhlIGV4dGVuZGVkIGZpbGUgcGF0aCBhbmQgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkeGwgPSBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgJG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRvZmZzZXQgKz0gNDsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplIDI7IHVua25vd24KICAgICAgICAgICAgICAgICAgICAgICAgJG9mZnNldCArPSAyOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemUgJHhsOyBjaGFyYWN0ZXIgYXJyYXkgb2YgdGhlIGV4dGVuZGVkIGZpbGUgcGF0aCBhbmQgbmFtZS4KICAgICAgICAgICAgICAgICAgICAgICAgJGV4dGVuZGVkRmlsZVBhdGggPSBzdWJzdHIoJHJlY29yZERhdGEsICRvZmZzZXQsICR4bCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRleHRlbmRlZEZpbGVQYXRoID0gc2VsZjo6ZW5jb2RlVVRGMTYoJGV4dGVuZGVkRmlsZVBhdGgsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG9mZnNldCArPSAkeGw7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBjb25zdHJ1Y3QgdGhlIHBhdGgKICAgICAgICAgICAgICAgICAgICAkdXJsID0gc3RyX3JlcGVhdCgnLi5cXCcsICR1cExldmVsQ291bnQpOwogICAgICAgICAgICAgICAgICAgICR1cmwgLj0gKCRzeiA+IDApID8gJGV4dGVuZGVkRmlsZVBhdGggOiAkc2hvcnRlbmVkRmlsZVBhdGg7IC8vIHVzZSBleHRlbmRlZCBwYXRoIGlmIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgICAgICR1cmwgLj0gJGhhc1RleHQgPyAnIycgOiAnJzsKCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdVTkMnOgogICAgICAgICAgICAgICAgICAgIC8vIHNlY3Rpb24gNS41OC40OiBIeXBlcmxpbmsgdG8gYSBGaWxlIHdpdGggVU5DIChVbml2ZXJzYWwgTmFtaW5nIENvbnZlbnRpb24pIFBhdGgKICAgICAgICAgICAgICAgICAgICAvLyB0b2RvOiBpbXBsZW1lbnQKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlICd3b3JrYm9vayc6CiAgICAgICAgICAgICAgICAgICAgLy8gc2VjdGlvbiA1LjU4LjU6IEh5cGVybGluayB0byB0aGUgQ3VycmVudCBXb3JrYm9vawogICAgICAgICAgICAgICAgICAgIC8vIGUuZy4gU2hlZXQyIUIxOkMyLCBzdG9yZWQgaW4gdGV4dCBtYXJrIGZpZWxkCiAgICAgICAgICAgICAgICAgICAgJHVybCA9ICdzaGVldDovLyc7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRoYXNUZXh0KSB7CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogNDsgY2hhcmFjdGVyIGNvdW50IG9mIHRleHQgbWFyayBpbmNsdWRpbmcgdHJhaWxpbmcgemVybyB3b3JkCiAgICAgICAgICAgICAgICAkdGwgPSBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgJG9mZnNldCk7CiAgICAgICAgICAgICAgICAkb2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogdmFyOyBjaGFyYWN0ZXIgYXJyYXkgb2YgdGhlIHRleHQgbWFyayB3aXRob3V0IHRoZSAjIHNpZ24sIG5vIFVuaWNvZGUgaGVhZGVyLCBhbHdheXMgMTYtYml0IGNoYXJhY3RlcnMsIHplcm8tdGVybWluYXRlZAogICAgICAgICAgICAgICAgJHRleHQgPSBzZWxmOjplbmNvZGVVVEYxNihzdWJzdHIoJHJlY29yZERhdGEsICRvZmZzZXQsIDIgKiAoJHRsIC0gMSkpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAkdXJsIC49ICR0ZXh0OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhcHBseSB0aGUgaHlwZXJsaW5rIHRvIGFsbCB0aGUgcmVsZXZhbnQgY2VsbHMKICAgICAgICAgICAgZm9yZWFjaCAoUEhQRXhjZWxfQ2VsbDo6ZXh0cmFjdEFsbENlbGxSZWZlcmVuY2VzSW5SYW5nZSgkY2VsbFJhbmdlKSBhcyAkY29vcmRpbmF0ZSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRDZWxsKCRjb29yZGluYXRlKS0+Z2V0SHlwZXJMaW5rKCktPnNldFVybCgkdXJsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIERBVEFWQUxJREFUSU9OUyByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkRGF0YVZhbGlkYXRpb25zKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIGZvcndhcmQgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWQgREFUQVZBTElEQVRJT04gcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZERhdGFWYWxpZGF0aW9uKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIGZvcndhcmQgdG8gbmV4dCByZWNvcmQKICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICBpZiAoJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDQ7IE9wdGlvbnMKICAgICAgICAkb3B0aW9ucyA9IHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAwKTsKCiAgICAgICAgLy8gYml0OiAwLTM7IG1hc2s6IDB4MDAwMDAwMEY7IHR5cGUKICAgICAgICAkdHlwZSA9ICgweDAwMDAwMDBGICYgJG9wdGlvbnMpID4+IDA7CiAgICAgICAgc3dpdGNoICgkdHlwZSkgewogICAgICAgICAgICBjYXNlIDB4MDA6CiAgICAgICAgICAgICAgICAkdHlwZSA9IFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246OlRZUEVfTk9ORTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDE6CiAgICAgICAgICAgICAgICAkdHlwZSA9IFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246OlRZUEVfV0hPTEU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDAyOgogICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX0RFQ0lNQUw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDAzOgogICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX0xJU1Q7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX0RBVEU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA1OgogICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX1RJTUU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA2OgogICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX1RFWFRMRU5HVEg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA3OgogICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX0NVU1RPTTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLy8gYml0OiA0LTY7IG1hc2s6IDB4MDAwMDAwNzA7IGVycm9yIHR5cGUKICAgICAgICAkZXJyb3JTdHlsZSA9ICgweDAwMDAwMDcwICYgJG9wdGlvbnMpID4+IDQ7CiAgICAgICAgc3dpdGNoICgkZXJyb3JTdHlsZSkgewogICAgICAgICAgICBjYXNlIDB4MDA6CiAgICAgICAgICAgICAgICAkZXJyb3JTdHlsZSA9IFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246OlNUWUxFX1NUT1A7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDAxOgogICAgICAgICAgICAgICAgJGVycm9yU3R5bGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpTVFlMRV9XQVJOSU5HOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwMjoKICAgICAgICAgICAgICAgICRlcnJvclN0eWxlID0gUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6U1RZTEVfSU5GT1JNQVRJT047CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIC8vIGJpdDogNzsgbWFzazogMHgwMDAwMDA4MDsgMT0gZm9ybXVsYSBpcyBleHBsaWNpdCAob25seSBhcHBsaWVzIHRvIGxpc3QpCiAgICAgICAgLy8gSSBoYXZlIG9ubHkgc2VlbiBjYXNlcyB3aGVyZSB0aGlzIGlzIDEKICAgICAgICAkZXhwbGljaXRGb3JtdWxhID0gKDB4MDAwMDAwODAgJiAkb3B0aW9ucykgPj4gNzsKCiAgICAgICAgLy8gYml0OiA4OyBtYXNrOiAweDAwMDAwMTAwOyAxPSBlbXB0eSBjZWxscyBhbGxvd2VkCiAgICAgICAgJGFsbG93QmxhbmsgPSAoMHgwMDAwMDEwMCAmICRvcHRpb25zKSA+PiA4OwoKICAgICAgICAvLyBiaXQ6IDk7IG1hc2s6IDB4MDAwMDAyMDA7IDE9IHN1cHByZXNzIGRyb3AgZG93biBhcnJvdyBpbiBsaXN0IHR5cGUgdmFsaWRpdHkKICAgICAgICAkc3VwcHJlc3NEcm9wRG93biA9ICgweDAwMDAwMjAwICYgJG9wdGlvbnMpID4+IDk7CgogICAgICAgIC8vIGJpdDogMTg7IG1hc2s6IDB4MDAwNDAwMDA7IDE9IHNob3cgcHJvbXB0IGJveCBpZiBjZWxsIHNlbGVjdGVkCiAgICAgICAgJHNob3dJbnB1dE1lc3NhZ2UgPSAoMHgwMDA0MDAwMCAmICRvcHRpb25zKSA+PiAxODsKCiAgICAgICAgLy8gYml0OiAxOTsgbWFzazogMHgwMDA4MDAwMDsgMT0gc2hvdyBlcnJvciBib3ggaWYgaW52YWxpZCB2YWx1ZXMgZW50ZXJlZAogICAgICAgICRzaG93RXJyb3JNZXNzYWdlID0gKDB4MDAwODAwMDAgJiAkb3B0aW9ucykgPj4gMTk7CgogICAgICAgIC8vIGJpdDogMjAtMjM7IG1hc2s6IDB4MDBGMDAwMDA7IGNvbmRpdGlvbiBvcGVyYXRvcgogICAgICAgICRvcGVyYXRvciA9ICgweDAwRjAwMDAwICYgJG9wdGlvbnMpID4+IDIwOwogICAgICAgIHN3aXRjaCAoJG9wZXJhdG9yKSB7CiAgICAgICAgICAgIGNhc2UgMHgwMDoKICAgICAgICAgICAgICAgICRvcGVyYXRvciA9IFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246Ok9QRVJBVE9SX0JFVFdFRU47CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDAxOgogICAgICAgICAgICAgICAgJG9wZXJhdG9yID0gUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6T1BFUkFUT1JfTk9UQkVUV0VFTjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDI6CiAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpPUEVSQVRPUl9FUVVBTDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDM6CiAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpPUEVSQVRPUl9OT1RFUVVBTDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDQ6CiAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpPUEVSQVRPUl9HUkVBVEVSVEhBTjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDU6CiAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpPUEVSQVRPUl9MRVNTVEhBTjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDY6CiAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpPUEVSQVRPUl9HUkVBVEVSVEhBTk9SRVFVQUw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA3OgogICAgICAgICAgICAgICAgJG9wZXJhdG9yID0gUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6T1BFUkFUT1JfTEVTU1RIQU5PUkVRVUFMOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IHZhcjsgdGl0bGUgb2YgdGhlIHByb21wdCBib3gKICAgICAgICAkb2Zmc2V0ID0gNDsKICAgICAgICAkc3RyaW5nID0gc2VsZjo6cmVhZFVuaWNvZGVTdHJpbmdMb25nKHN1YnN0cigkcmVjb3JkRGF0YSwgJG9mZnNldCkpOwogICAgICAgICRwcm9tcHRUaXRsZSA9ICRzdHJpbmdbJ3ZhbHVlJ10gIT09IGNocigwKSA\/ICRzdHJpbmdbJ3ZhbHVlJ10gOiAnJzsKICAgICAgICAkb2Zmc2V0ICs9ICRzdHJpbmdbJ3NpemUnXTsKCiAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemU6IHZhcjsgdGl0bGUgb2YgdGhlIGVycm9yIGJveAogICAgICAgICRzdHJpbmcgPSBzZWxmOjpyZWFkVW5pY29kZVN0cmluZ0xvbmcoc3Vic3RyKCRyZWNvcmREYXRhLCAkb2Zmc2V0KSk7CiAgICAgICAgJGVycm9yVGl0bGUgPSAkc3RyaW5nWyd2YWx1ZSddICE9PSBjaHIoMCkgPyAkc3RyaW5nWyd2YWx1ZSddIDogJyc7CiAgICAgICAgJG9mZnNldCArPSAkc3RyaW5nWydzaXplJ107CgogICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiB2YXI7IHRleHQgb2YgdGhlIHByb21wdCBib3gKICAgICAgICAkc3RyaW5nID0gc2VsZjo6cmVhZFVuaWNvZGVTdHJpbmdMb25nKHN1YnN0cigkcmVjb3JkRGF0YSwgJG9mZnNldCkpOwogICAgICAgICRwcm9tcHQgPSAkc3RyaW5nWyd2YWx1ZSddICE9PSBjaHIoMCkgPyAkc3RyaW5nWyd2YWx1ZSddIDogJyc7CiAgICAgICAgJG9mZnNldCArPSAkc3RyaW5nWydzaXplJ107CgogICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiB2YXI7IHRleHQgb2YgdGhlIGVycm9yIGJveAogICAgICAgICRzdHJpbmcgPSBzZWxmOjpyZWFkVW5pY29kZVN0cmluZ0xvbmcoc3Vic3RyKCRyZWNvcmREYXRhLCAkb2Zmc2V0KSk7CiAgICAgICAgJGVycm9yID0gJHN0cmluZ1sndmFsdWUnXSAhPT0gY2hyKDApID8gJHN0cmluZ1sndmFsdWUnXSA6ICcnOwogICAgICAgICRvZmZzZXQgKz0gJHN0cmluZ1snc2l6ZSddOwoKICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogMjsgc2l6ZSBvZiB0aGUgZm9ybXVsYSBkYXRhIGZvciB0aGUgZmlyc3QgY29uZGl0aW9uCiAgICAgICAgJHN6MSA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAkb2Zmc2V0KTsKICAgICAgICAkb2Zmc2V0ICs9IDI7CgogICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiAyOyBub3QgdXNlZAogICAgICAgICRvZmZzZXQgKz0gMjsKCiAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemU6ICRzejE7IGZvcm11bGEgZGF0YSBmb3IgZmlyc3QgY29uZGl0aW9uICh3aXRob3V0IHNpemUgZmllbGQpCiAgICAgICAgJGZvcm11bGExID0gc3Vic3RyKCRyZWNvcmREYXRhLCAkb2Zmc2V0LCAkc3oxKTsKICAgICAgICAkZm9ybXVsYTEgPSBwYWNrKCd2JywgJHN6MSkgLiAkZm9ybXVsYTE7IC8vIHByZXBlbmQgdGhlIGxlbmd0aAogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRmb3JtdWxhMSA9ICR0aGlzLT5nZXRGb3JtdWxhRnJvbVN0cnVjdHVyZSgkZm9ybXVsYTEpOwoKICAgICAgICAgICAgLy8gaW4gbGlzdCB0eXBlIHZhbGlkaXR5LCBudWxsIGNoYXJhY3RlcnMgYXJlIHVzZWQgYXMgaXRlbSBzZXBhcmF0b3JzCiAgICAgICAgICAgIGlmICgkdHlwZSA9PSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX0xJU1QpIHsKICAgICAgICAgICAgICAgICRmb3JtdWxhMSA9IHN0cl9yZXBsYWNlKGNocigwKSwgJywnLCAkZm9ybXVsYTEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoUEhQRXhjZWxfRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgJG9mZnNldCArPSAkc3oxOwoKICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogMjsgc2l6ZSBvZiB0aGUgZm9ybXVsYSBkYXRhIGZvciB0aGUgZmlyc3QgY29uZGl0aW9uCiAgICAgICAgJHN6MiA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAkb2Zmc2V0KTsKICAgICAgICAkb2Zmc2V0ICs9IDI7CgogICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiAyOyBub3QgdXNlZAogICAgICAgICRvZmZzZXQgKz0gMjsKCiAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemU6ICRzejI7IGZvcm11bGEgZGF0YSBmb3Igc2Vjb25kIGNvbmRpdGlvbiAod2l0aG91dCBzaXplIGZpZWxkKQogICAgICAgICRmb3JtdWxhMiA9IHN1YnN0cigkcmVjb3JkRGF0YSwgJG9mZnNldCwgJHN6Mik7CiAgICAgICAgJGZvcm11bGEyID0gcGFjaygndicsICRzejIpIC4gJGZvcm11bGEyOyAvLyBwcmVwZW5kIHRoZSBsZW5ndGgKICAgICAgICB0cnkgewogICAgICAgICAgICAkZm9ybXVsYTIgPSAkdGhpcy0+Z2V0Rm9ybXVsYUZyb21TdHJ1Y3R1cmUoJGZvcm11bGEyKTsKICAgICAgICB9IGNhdGNoIChQSFBFeGNlbF9FeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAkb2Zmc2V0ICs9ICRzejI7CgogICAgICAgIC8vIG9mZnNldDogdmFyOyBzaXplOiB2YXI7IGNlbGwgcmFuZ2UgYWRkcmVzcyBsaXN0IHdpdGgKICAgICAgICAkY2VsbFJhbmdlQWRkcmVzc0xpc3QgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbFJhbmdlQWRkcmVzc0xpc3Qoc3Vic3RyKCRyZWNvcmREYXRhLCAkb2Zmc2V0KSk7CiAgICAgICAgJGNlbGxSYW5nZUFkZHJlc3NlcyA9ICRjZWxsUmFuZ2VBZGRyZXNzTGlzdFsnY2VsbFJhbmdlQWRkcmVzc2VzJ107CgogICAgICAgIGZvcmVhY2ggKCRjZWxsUmFuZ2VBZGRyZXNzZXMgYXMgJGNlbGxSYW5nZSkgewogICAgICAgICAgICAkc3RSYW5nZSA9ICR0aGlzLT5waHBTaGVldC0+c2hyaW5rUmFuZ2VUb0ZpdCgkY2VsbFJhbmdlKTsKICAgICAgICAgICAgZm9yZWFjaCAoUEhQRXhjZWxfQ2VsbDo6ZXh0cmFjdEFsbENlbGxSZWZlcmVuY2VzSW5SYW5nZSgkc3RSYW5nZSkgYXMgJGNvb3JkaW5hdGUpIHsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uID0gJHRoaXMtPnBocFNoZWV0LT5nZXRDZWxsKCRjb29yZGluYXRlKS0+Z2V0RGF0YVZhbGlkYXRpb24oKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRUeXBlKCR0eXBlKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRFcnJvclN0eWxlKCRlcnJvclN0eWxlKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRBbGxvd0JsYW5rKChib29sKSRhbGxvd0JsYW5rKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRTaG93SW5wdXRNZXNzYWdlKChib29sKSRzaG93SW5wdXRNZXNzYWdlKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRTaG93RXJyb3JNZXNzYWdlKChib29sKSRzaG93RXJyb3JNZXNzYWdlKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRTaG93RHJvcERvd24oISRzdXBwcmVzc0Ryb3BEb3duKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRPcGVyYXRvcigkb3BlcmF0b3IpOwogICAgICAgICAgICAgICAgJG9ialZhbGlkYXRpb24tPnNldEVycm9yVGl0bGUoJGVycm9yVGl0bGUpOwogICAgICAgICAgICAgICAgJG9ialZhbGlkYXRpb24tPnNldEVycm9yKCRlcnJvcik7CiAgICAgICAgICAgICAgICAkb2JqVmFsaWRhdGlvbi0+c2V0UHJvbXB0VGl0bGUoJHByb21wdFRpdGxlKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRQcm9tcHQoJHByb21wdCk7CiAgICAgICAgICAgICAgICAkb2JqVmFsaWRhdGlvbi0+c2V0Rm9ybXVsYTEoJGZvcm11bGExKTsKICAgICAgICAgICAgICAgICRvYmpWYWxpZGF0aW9uLT5zZXRGb3JtdWxhMigkZm9ybXVsYTIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVhZCBTSEVFVExBWU9VVCByZWNvcmQuIFN0b3JlcyBzaGVldCB0YWIgY29sb3IgaW5mb3JtYXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFNoZWV0TGF5b3V0KCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBtb3ZlIHN0cmVhbSBwb2ludGVyIHRvIG5leHQgcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgLy8gbG9jYWwgcG9pbnRlciBpbiByZWNvcmQgZGF0YQogICAgICAgICRvZmZzZXQgPSAwOwoKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyByZXBlYXRlZCByZWNvcmQgaWRlbnRpZmllciAweDA4NjIKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMTA7IG5vdCB1c2VkCgogICAgICAgICAgICAvLyBvZmZzZXQ6IDEyOyBzaXplOiA0OyBzaXplIG9mIHJlY29yZCBkYXRhCiAgICAgICAgICAgIC8vIEV4Y2VsIDIwMDMgdXNlcyBzaXplIG9mIDB4MTQgKGRvY3VtZW50ZWQpLCBFeGNlbCAyMDA3IHVzZXMgc2l6ZSBvZiAweDI4IChub3QgZG9jdW1lbnRlZD8pCiAgICAgICAgICAgICRzeiA9IHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAxMik7CgogICAgICAgICAgICBzd2l0Y2ggKCRzeikgewogICAgICAgICAgICAgICAgY2FzZSAweDE0OgogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTY7IHNpemU6IDI7IGNvbG9yIGluZGV4IGZvciBzaGVldCB0YWIKICAgICAgICAgICAgICAgICAgICAkY29sb3JJbmRleCA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAxNik7CiAgICAgICAgICAgICAgICAgICAgJGNvbG9yID0gUEhQRXhjZWxfUmVhZGVyX0V4Y2VsNV9Db2xvcjo6bWFwKCRjb2xvckluZGV4LCAkdGhpcy0+cGFsZXR0ZSwgJHRoaXMtPnZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0VGFiQ29sb3IoKS0+c2V0UkdCKCRjb2xvclsncmdiJ10pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAweDI4OgogICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IEludmVzdGlnYXRlIHN0cnVjdHVyZSBmb3IgLnhscyBTSEVFVExBWU9VVCByZWNvcmQgYXMgc2F2ZWQgYnkgTVMgT2ZmaWNlIEV4Y2VsIDIwMDcKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBTSEVFVFBST1RFQ1RJT04gcmVjb3JkIChGRUFUSEVBRFIpCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFNoZWV0UHJvdGVjdGlvbigpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIGlmICgkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgcmVwZWF0ZWQgcmVjb3JkIGhlYWRlcgoKICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IEZSVCBjZWxsIHJlZmVyZW5jZSBmbGFnICg9MCBjdXJyZW50bHkpCgogICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogODsgQ3VycmVudGx5IG5vdCB1c2VkIGFuZCBzZXQgdG8gMAoKICAgICAgICAvLyBvZmZzZXQ6IDEyOyBzaXplOiAyOyBTaGFyZWQgZmVhdHVyZSB0eXBlIGluZGV4ICgyPUVuaGFuY2VkIFByb3RldGlvbiwgND1TbWFydFRhZykKICAgICAgICAkaXNmID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDEyKTsKICAgICAgICBpZiAoJGlzZiAhPSAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG9mZnNldDogMTQ7IHNpemU6IDE7ID0xIHNpbmNlIHRoaXMgaXMgYSBmZWF0IGhlYWRlcgoKICAgICAgICAvLyBvZmZzZXQ6IDE1OyBzaXplOiA0OyBzaXplIG9mIHJnYkhkclNEYXRhCgogICAgICAgIC8vIHJnYkhkclNEYXRhLCBhc3N1bWUgIkVuaGFuY2VkIFByb3RlY3Rpb24iCiAgICAgICAgLy8gb2Zmc2V0OiAxOTsgc2l6ZTogMjsgb3B0aW9uIGZsYWdzCiAgICAgICAgJG9wdGlvbnMgPSBzZWxmOjpnZXRJbnQyZCgkcmVjb3JkRGF0YSwgMTkpOwoKICAgICAgICAvLyBiaXQ6IDA7IG1hc2sgMHgwMDAxOyAxID0gdXNlciBtYXkgZWRpdCBvYmplY3RzLCAwID0gdXNlcnMgbXVzdCBub3QgZWRpdCBvYmplY3RzCiAgICAgICAgJGJvb2wgPSAoMHgwMDAxICYgJG9wdGlvbnMpID4+IDA7CiAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPnNldE9iamVjdHMoISRib29sKTsKCiAgICAgICAgLy8gYml0OiAxOyBtYXNrIDB4MDAwMjsgZWRpdCBzY2VuYXJpb3MKICAgICAgICAkYm9vbCA9ICgweDAwMDIgJiAkb3B0aW9ucykgPj4gMTsKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+c2V0U2NlbmFyaW9zKCEkYm9vbCk7CgogICAgICAgIC8vIGJpdDogMjsgbWFzayAweDAwMDQ7IGZvcm1hdCBjZWxscwogICAgICAgICRib29sID0gKDB4MDAwNCAmICRvcHRpb25zKSA+PiAyOwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRGb3JtYXRDZWxscyghJGJvb2wpOwoKICAgICAgICAvLyBiaXQ6IDM7IG1hc2sgMHgwMDA4OyBmb3JtYXQgY29sdW1ucwogICAgICAgICRib29sID0gKDB4MDAwOCAmICRvcHRpb25zKSA+PiAzOwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRGb3JtYXRDb2x1bW5zKCEkYm9vbCk7CgogICAgICAgIC8vIGJpdDogNDsgbWFzayAweDAwMTA7IGZvcm1hdCByb3dzCiAgICAgICAgJGJvb2wgPSAoMHgwMDEwICYgJG9wdGlvbnMpID4+IDQ7CiAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPnNldEZvcm1hdFJvd3MoISRib29sKTsKCiAgICAgICAgLy8gYml0OiA1OyBtYXNrIDB4MDAyMDsgaW5zZXJ0IGNvbHVtbnMKICAgICAgICAkYm9vbCA9ICgweDAwMjAgJiAkb3B0aW9ucykgPj4gNTsKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+c2V0SW5zZXJ0Q29sdW1ucyghJGJvb2wpOwoKICAgICAgICAvLyBiaXQ6IDY7IG1hc2sgMHgwMDQwOyBpbnNlcnQgcm93cwogICAgICAgICRib29sID0gKDB4MDA0MCAmICRvcHRpb25zKSA+PiA2OwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRJbnNlcnRSb3dzKCEkYm9vbCk7CgogICAgICAgIC8vIGJpdDogNzsgbWFzayAweDAwODA7IGluc2VydCBoeXBlcmxpbmtzCiAgICAgICAgJGJvb2wgPSAoMHgwMDgwICYgJG9wdGlvbnMpID4+IDc7CiAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPnNldEluc2VydEh5cGVybGlua3MoISRib29sKTsKCiAgICAgICAgLy8gYml0OiA4OyBtYXNrIDB4MDEwMDsgZGVsZXRlIGNvbHVtbnMKICAgICAgICAkYm9vbCA9ICgweDAxMDAgJiAkb3B0aW9ucykgPj4gODsKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+c2V0RGVsZXRlQ29sdW1ucyghJGJvb2wpOwoKICAgICAgICAvLyBiaXQ6IDk7IG1hc2sgMHgwMjAwOyBkZWxldGUgcm93cwogICAgICAgICRib29sID0gKDB4MDIwMCAmICRvcHRpb25zKSA+PiA5OwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXREZWxldGVSb3dzKCEkYm9vbCk7CgogICAgICAgIC8vIGJpdDogMTA7IG1hc2sgMHgwNDAwOyBzZWxlY3QgbG9ja2VkIGNlbGxzCiAgICAgICAgJGJvb2wgPSAoMHgwNDAwICYgJG9wdGlvbnMpID4+IDEwOwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRTZWxlY3RMb2NrZWRDZWxscyghJGJvb2wpOwoKICAgICAgICAvLyBiaXQ6IDExOyBtYXNrIDB4MDgwMDsgc29ydCBjZWxsIHJhbmdlCiAgICAgICAgJGJvb2wgPSAoMHgwODAwICYgJG9wdGlvbnMpID4+IDExOwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRTb3J0KCEkYm9vbCk7CgogICAgICAgIC8vIGJpdDogMTI7IG1hc2sgMHgxMDAwOyBhdXRvIGZpbHRlcgogICAgICAgICRib29sID0gKDB4MTAwMCAmICRvcHRpb25zKSA+PiAxMjsKICAgICAgICAkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+c2V0QXV0b0ZpbHRlcighJGJvb2wpOwoKICAgICAgICAvLyBiaXQ6IDEzOyBtYXNrIDB4MjAwMDsgcGl2b3QgdGFibGVzCiAgICAgICAgJGJvb2wgPSAoMHgyMDAwICYgJG9wdGlvbnMpID4+IDEzOwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRQaXZvdFRhYmxlcyghJGJvb2wpOwoKICAgICAgICAvLyBiaXQ6IDE0OyBtYXNrIDB4NDAwMDsgc2VsZWN0IHVubG9ja2VkIGNlbGxzCiAgICAgICAgJGJvb2wgPSAoMHg0MDAwICYgJG9wdGlvbnMpID4+IDE0OwogICAgICAgICR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5zZXRTZWxlY3RVbmxvY2tlZENlbGxzKCEkYm9vbCk7CgogICAgICAgIC8vIG9mZnNldDogMjE7IHNpemU6IDI7IG5vdCB1c2VkCiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBSQU5HRVBST1RFQ1RJT04gcmVjb3JkCiAgICAgKiBSZWFkaW5nIG9mIHRoaXMgcmVjb3JkIGlzIGJhc2VkIG9uIE1pY3Jvc29mdCBPZmZpY2UgRXhjZWwgOTctMjAwMCBCaW5hcnkgRmlsZSBGb3JtYXQgU3BlY2lmaWNhdGlvbiwKICAgICAqIHdoZXJlIGl0IGlzIHJlZmVycmVkIHRvIGFzIEZFQVQgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFJhbmdlUHJvdGVjdGlvbigpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CiAgICAgICAgJHJlY29yZERhdGEgPSAkdGhpcy0+cmVhZFJlY29yZERhdGEoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyA0LCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CgogICAgICAgIC8vIGxvY2FsIHBvaW50ZXIgaW4gcmVjb3JkIGRhdGEKICAgICAgICAkb2Zmc2V0ID0gMDsKCiAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICRvZmZzZXQgKz0gMTI7CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDEyOyBzaXplOiAyOyBzaGFyZWQgZmVhdHVyZSB0eXBlLCAyID0gZW5oYW5jZWQgcHJvdGVjdGlvbiwgNCA9IHNtYXJ0IHRhZwogICAgICAgICAgICAkaXNmID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDEyKTsKICAgICAgICAgICAgaWYgKCRpc2YgIT0gMikgewogICAgICAgICAgICAgICAgLy8gd2Ugb25seSByZWFkIEZFQVQgcmVjb3JkcyBvZiB0eXBlIDIKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkb2Zmc2V0ICs9IDI7CgogICAgICAgICAgICAkb2Zmc2V0ICs9IDU7CgogICAgICAgICAgICAvLyBvZmZzZXQ6IDE5OyBzaXplOiAyOyBjb3VudCBvZiByZWYgcmFuZ2VzIHRoaXMgZmVhdHVyZSBpcyBvbgogICAgICAgICAgICAkY3JlZiA9IHNlbGY6OmdldEludDJkKCRyZWNvcmREYXRhLCAxOSk7CiAgICAgICAgICAgICRvZmZzZXQgKz0gMjsKCiAgICAgICAgICAgICRvZmZzZXQgKz0gNjsKCiAgICAgICAgICAgIC8vIG9mZnNldDogMjc7IHNpemU6IDggKiAkY3JlZjsgbGlzdCBvZiBjZWxsIHJhbmdlcyAobGlrZSBpbiBoeXBlcmxpbmsgcmVjb3JkKQogICAgICAgICAgICAkY2VsbFJhbmdlcyA9IGFycmF5KCk7CiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRjcmVmOyArKyRpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICRjZWxsUmFuZ2UgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbFJhbmdlQWRkcmVzc0ZpeGVkKHN1YnN0cigkcmVjb3JkRGF0YSwgMjcgKyA4ICogJGksIDgpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFBIUEV4Y2VsX0V4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRjZWxsUmFuZ2VzW10gPSAkY2VsbFJhbmdlOwogICAgICAgICAgICAgICAgJG9mZnNldCArPSA4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBvZmZzZXQ6IHZhcjsgc2l6ZTogdmFyOyB2YXJpYWJsZSBsZW5ndGggb2YgZmVhdHVyZSBzcGVjaWZpYyBkYXRhCiAgICAgICAgICAgICRyZ2JGZWF0ID0gc3Vic3RyKCRyZWNvcmREYXRhLCAkb2Zmc2V0KTsKICAgICAgICAgICAgJG9mZnNldCArPSA0OwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiB2YXI7IHNpemU6IDQ7IHRoZSBlbmNyeXB0ZWQgcGFzc3dvcmQgKG9ubHkgMTYtYml0IGFsdGhvdWdoIGZpZWxkIGlzIDMyLWJpdCkKICAgICAgICAgICAgJHdQYXNzd29yZCA9IHNlbGY6OmdldEludDRkKCRyZWNvcmREYXRhLCAkb2Zmc2V0KTsKICAgICAgICAgICAgJG9mZnNldCArPSA0OwoKICAgICAgICAgICAgLy8gQXBwbHkgcmFuZ2UgcHJvdGVjdGlvbiB0byBzaGVldAogICAgICAgICAgICBpZiAoJGNlbGxSYW5nZXMpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5waHBTaGVldC0+cHJvdGVjdENlbGxzKGltcGxvZGUoJyAnLCAkY2VsbFJhbmdlcyksIHN0cnRvdXBwZXIoZGVjaGV4KCR3UGFzc3dvcmQpKSwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBJTURBVEEgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEltRGF0YSgpCiAgICB7CiAgICAgICAgJGxlbmd0aCA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgMik7CgogICAgICAgIC8vIGdldCBzcGxpY2VkIHJlY29yZCBkYXRhCiAgICAgICAgJHNwbGljZWRSZWNvcmREYXRhID0gJHRoaXMtPmdldFNwbGljZWRSZWNvcmREYXRhKCk7CiAgICAgICAgJHJlY29yZERhdGEgPSAkc3BsaWNlZFJlY29yZERhdGFbJ3JlY29yZERhdGEnXTsKCiAgICAgICAgLy8gVU5ERVIgQ09OU1RSVUNUSU9OCgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgaW1hZ2UgZm9ybWF0CiAgICAgICAgJGNmID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDApOwoKICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IGVudmlyb25tZW50IGZyb20gd2hpY2ggdGhlIGZpbGUgd2FzIHdyaXR0ZW4KICAgICAgICAkZW52ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwoKICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDQ7IGxlbmd0aCBvZiB0aGUgaW1hZ2UgZGF0YQogICAgICAgICRsY2IgPSBzZWxmOjpnZXRJbnQ0ZCgkcmVjb3JkRGF0YSwgNCk7CgogICAgICAgIC8vIG9mZnNldDogODsgc2l6ZTogdmFyOyBpbWFnZSBkYXRhCiAgICAgICAgJGlEYXRhID0gc3Vic3RyKCRyZWNvcmREYXRhLCA4KTsKCiAgICAgICAgc3dpdGNoICgkY2YpIHsKICAgICAgICAgICAgY2FzZSAweDA5OiAvLyBXaW5kb3dzIGJpdG1hcCBmb3JtYXQKICAgICAgICAgICAgICAgIC8vIEJJVE1BUENPUkVJTkZPCiAgICAgICAgICAgICAgICAvLyAxLiBCSVRNQVBDT1JFSEVBREVSCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDQ7IGJjU2l6ZSwgU3BlY2lmaWVzIHRoZSBudW1iZXIgb2YgYnl0ZXMgcmVxdWlyZWQgYnkgdGhlIHN0cnVjdHVyZQogICAgICAgICAgICAgICAgJGJjU2l6ZSA9IHNlbGY6OmdldEludDRkKCRpRGF0YSwgMCk7CiAgICAvLyAgICAgICAgICAgIHZhcl9kdW1wKCRiY1NpemUpOwoKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgYmNXaWR0aCwgc3BlY2lmaWVzIHRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLCBpbiBwaXhlbHMKICAgICAgICAgICAgICAgICRiY1dpZHRoID0gc2VsZjo6Z2V0SW50MmQoJGlEYXRhLCA0KTsKICAgIC8vICAgICAgICAgICAgdmFyX2R1bXAoJGJjV2lkdGgpOwoKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogNjsgc2l6ZTogMjsgYmNIZWlnaHQsIHNwZWNpZmllcyB0aGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAsIGluIHBpeGVscy4KICAgICAgICAgICAgICAgICRiY0hlaWdodCA9IHNlbGY6OmdldEludDJkKCRpRGF0YSwgNik7CiAgICAvLyAgICAgICAgICAgIHZhcl9kdW1wKCRiY0hlaWdodCk7CiAgICAgICAgICAgICAgICAkaWggPSBpbWFnZWNyZWF0ZXRydWVjb2xvcigkYmNXaWR0aCwgJGJjSGVpZ2h0KTsKCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDg7IHNpemU6IDI7IGJjUGxhbmVzLCBzcGVjaWZpZXMgdGhlIG51bWJlciBvZiBwbGFuZXMgZm9yIHRoZSB0YXJnZXQgZGV2aWNlLiBUaGlzIHZhbHVlIG11c3QgYmUgMQoKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTA7IHNpemU6IDI7IGJjQml0Q291bnQgc3BlY2lmaWVzIHRoZSBudW1iZXIgb2YgYml0cy1wZXItcGl4ZWwuIFRoaXMgdmFsdWUgbXVzdCBiZSAxLCA0LCA4LCBvciAyNAogICAgICAgICAgICAgICAgJGJjQml0Q291bnQgPSBzZWxmOjpnZXRJbnQyZCgkaURhdGEsIDEwKTsKICAgIC8vICAgICAgICAgICAgdmFyX2R1bXAoJGJjQml0Q291bnQpOwoKICAgICAgICAgICAgICAgICRyZ2JTdHJpbmcgPSBzdWJzdHIoJGlEYXRhLCAxMik7CiAgICAgICAgICAgICAgICAkcmdiVHJpcGxlcyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3RybGVuKCRyZ2JTdHJpbmcpID4gMCkgewogICAgICAgICAgICAgICAgICAgICRyZ2JUcmlwbGVzW10gPSB1bnBhY2soJ0NiL0NnL0NyJywgJHJnYlN0cmluZyk7CiAgICAgICAgICAgICAgICAgICAgJHJnYlN0cmluZyA9IHN1YnN0cigkcmdiU3RyaW5nLCAzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR4ID0gMDsKICAgICAgICAgICAgICAgICR5ID0gMDsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZ2JUcmlwbGVzIGFzICRpID0+ICRyZ2JUcmlwbGUpIHsKICAgICAgICAgICAgICAgICAgICAkY29sb3IgPSBpbWFnZWNvbG9yYWxsb2NhdGUoJGloLCAkcmdiVHJpcGxlWydyJ10sICRyZ2JUcmlwbGVbJ2cnXSwgJHJnYlRyaXBsZVsnYiddKTsKICAgICAgICAgICAgICAgICAgICBpbWFnZXNldHBpeGVsKCRpaCwgJHgsICRiY0hlaWdodCAtIDEgLSAkeSwgJGNvbG9yKTsKICAgICAgICAgICAgICAgICAgICAkeCA9ICgkeCArIDEpICUgJGJjV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgJHkgPSAkeSArIGZsb29yKCgkeCArIDEpIC8gJGJjV2lkdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9pbWFnZXBuZygkaWgsICdpbWFnZS5wbmcnKTsKCiAgICAgICAgICAgICAgICAkZHJhd2luZyA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfRHJhd2luZygpOwogICAgICAgICAgICAgICAgJGRyYXdpbmctPnNldFBhdGgoJGZpbGVuYW1lKTsKICAgICAgICAgICAgICAgICRkcmF3aW5nLT5zZXRXb3Jrc2hlZXQoJHRoaXMtPnBocFNoZWV0KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDI6IC8vIFdpbmRvd3MgbWV0YWZpbGUgb3IgTWFjaW50b3NoIFBJQ1QgZm9ybWF0CiAgICAgICAgICAgIGNhc2UgMHgwZTogLy8gbmF0aXZlIGZvcm1hdAogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAvLyBnZXRTcGxpY2VkUmVjb3JkRGF0YSgpIHRha2VzIGNhcmUgb2YgbW92aW5nIGN1cnJlbnQgcG9zaXRpb24gaW4gZGF0YSBzdHJlYW0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIGEgZnJlZSBDT05USU5VRSByZWNvcmQuIEZyZWUgQ09OVElOVUUgcmVjb3JkIG1heSBiZSBhIGNhbW91ZmxhZ2VkIE1TT0RSQVdJTkcgcmVjb3JkCiAgICAgKiBXaGVuIE1TT0RSQVdJTkcgZGF0YSBvbiBhIHNoZWV0IGV4Y2VlZHMgODIyNCBieXRlcywgQ09OVElOVUUgcmVjb3JkcyBhcmUgdXNlZCBpbnN0ZWFkLiBVbmRvY3VtZW50ZWQuCiAgICAgKiBJbiB0aGlzIGNhc2UsIHdlIG11c3QgdHJlYXQgdGhlIENPTlRJTlVFIHJlY29yZCBhcyBhIE1TT0RSQVdJTkcgcmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZENvbnRpbnVlKCkKICAgIHsKICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAkcmVjb3JkRGF0YSA9ICR0aGlzLT5yZWFkUmVjb3JkRGF0YSgkdGhpcy0+ZGF0YSwgJHRoaXMtPnBvcyArIDQsICRsZW5ndGgpOwoKICAgICAgICAvLyBjaGVjayBpZiB3ZSBhcmUgcmVhZGluZyBkcmF3aW5nIGRhdGEKICAgICAgICAvLyB0aGlzIGlzIGluIGNhc2UgYSBmcmVlIENPTlRJTlVFIHJlY29yZCBvY2N1cnMgaW4gb3RoZXIgY2lyY3Vtc3RhbmNlcyB3ZSBhcmUgdW5hd2FyZSBvZgogICAgICAgIGlmICgkdGhpcy0+ZHJhd2luZ0RhdGEgPT0gJycpIHsKICAgICAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICAgICAkdGhpcy0+cG9zICs9IDQgKyAkbGVuZ3RoOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgaWYgcmVjb3JkIGRhdGEgaXMgYXQgbGVhc3QgNCBieXRlcyBsb25nLCBvdGhlcndpc2UgdGhlcmUgaXMgbm8gY2hhbmNlIHRoaXMgaXMgTVNPRFJBV0lORyBkYXRhCiAgICAgICAgaWYgKCRsZW5ndGggPCA0KSB7CiAgICAgICAgICAgIC8vIG1vdmUgc3RyZWFtIHBvaW50ZXIgdG8gbmV4dCByZWNvcmQKICAgICAgICAgICAgJHRoaXMtPnBvcyArPSA0ICsgJGxlbmd0aDsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGRpcnR5IGNoZWNrIHRvIHNlZSBpZiBDT05USU5VRSByZWNvcmQgY291bGQgYmUgYSBjYW1vdWZsYWdlZCBNU09EUkFXSU5HIHJlY29yZAogICAgICAgIC8vIGxvb2sgaW5zaWRlIENPTlRJTlVFIHJlY29yZCB0byBzZWUgaWYgaXQgbG9va3MgbGlrZSBhIHBhcnQgb2YgYW4gRXNjaGVyIHN0cmVhbQogICAgICAgIC8vIHdlIGtub3cgdGhhdCBFc2NoZXIgc3RyZWFtIG1heSBiZSBzcGxpdCBhdCBsZWFzdCBhdAogICAgICAgIC8vICAgICAgICAweEYwMDMgTXNvZmJ0U3BnckNvbnRhaW5lcgogICAgICAgIC8vICAgICAgICAweEYwMDQgTXNvZmJ0U3BDb250YWluZXIKICAgICAgICAvLyAgICAgICAgMHhGMDBEIE1zb2ZidENsaWVudFRleHRib3gKICAgICAgICAkdmFsaWRTcGxpdFBvaW50cyA9IGFycmF5KDB4RjAwMywgMHhGMDA0LCAweEYwMEQpOyAvLyBhZGQgaWRlbnRpZmllcnMgaWYgd2UgZmluZCBtb3JlCgogICAgICAgICRzcGxpdFBvaW50ID0gc2VsZjo6Z2V0SW50MmQoJHJlY29yZERhdGEsIDIpOwogICAgICAgIGlmIChpbl9hcnJheSgkc3BsaXRQb2ludCwgJHZhbGlkU3BsaXRQb2ludHMpKSB7CiAgICAgICAgICAgIC8vIGdldCBzcGxpY2VkIHJlY29yZCBkYXRhIChhbmQgbW92ZSBwb2ludGVyIHRvIG5leHQgcmVjb3JkKQogICAgICAgICAgICAkc3BsaWNlZFJlY29yZERhdGEgPSAkdGhpcy0+Z2V0U3BsaWNlZFJlY29yZERhdGEoKTsKICAgICAgICAgICAgJHRoaXMtPmRyYXdpbmdEYXRhIC49ICRzcGxpY2VkUmVjb3JkRGF0YVsncmVjb3JkRGF0YSddOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gbW92ZSBzdHJlYW0gcG9pbnRlciB0byBuZXh0IHJlY29yZAogICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgYSByZWNvcmQgZnJvbSBjdXJyZW50IHBvc2l0aW9uIGluIGRhdGEgc3RyZWFtIGFuZCBjb250aW51ZXMgcmVhZGluZyBkYXRhIGFzIGxvbmcgYXMgQ09OVElOVUUKICAgICAqIHJlY29yZHMgYXJlIGZvdW5kLiBTcGxpY2VzIHRoZSByZWNvcmQgZGF0YSBwaWVjZXMgYW5kIHJldHVybnMgdGhlIGNvbWJpbmVkIHN0cmluZyBhcyBpZiByZWNvcmQgZGF0YQogICAgICogaXMgaW4gb25lIHBpZWNlLgogICAgICogTW92ZXMgdG8gbmV4dCBjdXJyZW50IHBvc2l0aW9uIGluIGRhdGEgc3RyZWFtIHRvIHN0YXJ0IG9mIG5leHQgcmVjb3JkIGRpZmZlcmVudCBmcm9tIGEgQ09OdElOVUUgcmVjb3JkCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGdldFNwbGljZWRSZWNvcmREYXRhKCkKICAgIHsKICAgICAgICAkZGF0YSA9ICcnOwogICAgICAgICRzcGxpY2VPZmZzZXRzID0gYXJyYXkoKTsKCiAgICAgICAgJGkgPSAwOwogICAgICAgICRzcGxpY2VPZmZzZXRzWzBdID0gMDsKCiAgICAgICAgZG8gewogICAgICAgICAgICArKyRpOwoKICAgICAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBpZGVudGlmaWVyCiAgICAgICAgICAgICRpZGVudGlmaWVyID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MpOwogICAgICAgICAgICAvLyBvZmZzZXQ6IDI7IHNpemU6IDI7IGxlbmd0aAogICAgICAgICAgICAkbGVuZ3RoID0gc2VsZjo6Z2V0SW50MmQoJHRoaXMtPmRhdGEsICR0aGlzLT5wb3MgKyAyKTsKICAgICAgICAgICAgJGRhdGEgLj0gJHRoaXMtPnJlYWRSZWNvcmREYXRhKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zICsgNCwgJGxlbmd0aCk7CgogICAgICAgICAgICAkc3BsaWNlT2Zmc2V0c1skaV0gPSAkc3BsaWNlT2Zmc2V0c1skaSAtIDFdICsgJGxlbmd0aDsKCiAgICAgICAgICAgICR0aGlzLT5wb3MgKz0gNCArICRsZW5ndGg7CiAgICAgICAgICAgICRuZXh0SWRlbnRpZmllciA9IHNlbGY6OmdldEludDJkKCR0aGlzLT5kYXRhLCAkdGhpcy0+cG9zKTsKICAgICAgICB9IHdoaWxlICgkbmV4dElkZW50aWZpZXIgPT0gc2VsZjo6WExTX1RZUEVfQ09OVElOVUUpOwoKICAgICAgICAkc3BsaWNlZERhdGEgPSBhcnJheSgKICAgICAgICAgICAgJ3JlY29yZERhdGEnID0+ICRkYXRhLAogICAgICAgICAgICAnc3BsaWNlT2Zmc2V0cycgPT4gJHNwbGljZU9mZnNldHMsCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuICRzcGxpY2VkRGF0YTsKCiAgICB9CgoKICAgIC8qKgogICAgICogQ29udmVydCBmb3JtdWxhIHN0cnVjdHVyZSBpbnRvIGh1bWFuIHJlYWRhYmxlIEV4Y2VsIGZvcm11bGEgbGlrZSAnQTMrQTUqNScKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRmb3JtdWxhU3RydWN0dXJlIFRoZSBjb21wbGV0ZSBiaW5hcnkgZGF0YSBmb3IgdGhlIGZvcm11bGEKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJhc2VDZWxsIEJhc2UgY2VsbCwgb25seSBuZWVkZWQgd2hlbiBmb3JtdWxhIGNvbnRhaW5zIHRSZWZOIHRva2VucywgZS5nLiB3aXRoIHNoYXJlZCBmb3JtdWxhcwogICAgICogQHJldHVybiBzdHJpbmcgSHVtYW4gcmVhZGFibGUgZm9ybXVsYQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGdldEZvcm11bGFGcm9tU3RydWN0dXJlKCRmb3JtdWxhU3RydWN0dXJlLCAkYmFzZUNlbGwgPSAnQTEnKQogICAgewogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgc2l6ZSBvZiB0aGUgZm9sbG93aW5nIGZvcm11bGEgZGF0YQogICAgICAgICRzeiA9IHNlbGY6OmdldEludDJkKCRmb3JtdWxhU3RydWN0dXJlLCAwKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiBzegogICAgICAgICRmb3JtdWxhRGF0YSA9IHN1YnN0cigkZm9ybXVsYVN0cnVjdHVyZSwgMiwgJHN6KTsKCiAgICAgICAgLy8gZm9yIGRlYnVnOiBkdW1wIHRoZSBmb3JtdWxhIGRhdGEKICAgICAgICAvL2VjaG8gJzx4bXA+JzsKICAgICAgICAvL2VjaG8gJ3NpemU6ICcgLiAkc3ogLiAiXG4iOwogICAgICAgIC8vZWNobyAndGhlIGVudGlyZSBmb3JtdWxhIGRhdGE6ICc7CiAgICAgICAgLy9EZWJ1Zzo6ZHVtcCgkZm9ybXVsYURhdGEpOwogICAgICAgIC8vZWNobyAiXG4tLS0tXG4iOwoKICAgICAgICAvLyBvZmZzZXQ6IDIgKyBzejsgc2l6ZTogdmFyaWFibGUgKG9wdGlvbmFsKQogICAgICAgIGlmIChzdHJsZW4oJGZvcm11bGFTdHJ1Y3R1cmUpID4gMiArICRzeikgewogICAgICAgICAgICAkYWRkaXRpb25hbERhdGEgPSBzdWJzdHIoJGZvcm11bGFTdHJ1Y3R1cmUsIDIgKyAkc3opOwoKICAgICAgICAgICAgLy8gZm9yIGRlYnVnOiBkdW1wIHRoZSBhZGRpdGlvbmFsIGRhdGEKICAgICAgICAgICAgLy9lY2hvICd0aGUgZW50aXJlIGFkZGl0aW9uYWwgZGF0YTogJzsKICAgICAgICAgICAgLy9EZWJ1Zzo6ZHVtcCgkYWRkaXRpb25hbERhdGEpOwogICAgICAgICAgICAvL2VjaG8gIlxuLS0tLVxuIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkYWRkaXRpb25hbERhdGEgPSAnJzsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpcy0+Z2V0Rm9ybXVsYUZyb21EYXRhKCRmb3JtdWxhRGF0YSwgJGFkZGl0aW9uYWxEYXRhLCAkYmFzZUNlbGwpOwogICAgfQoKCiAgICAvKioKICAgICAqIFRha2UgZm9ybXVsYSBkYXRhIGFuZCBhZGRpdGlvbmFsIGRhdGEgZm9yIGZvcm11bGEgYW5kIHJldHVybiBodW1hbiByZWFkYWJsZSBmb3JtdWxhCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkZm9ybXVsYURhdGEgVGhlIGJpbmFyeSBkYXRhIGZvciB0aGUgZm9ybXVsYSBpdHNlbGYKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZGl0aW9uYWxEYXRhIEFkZGl0aW9uYWwgYmluYXJ5IGRhdGEgZ29pbmcgd2l0aCB0aGUgZm9ybXVsYQogICAgICogQHBhcmFtIHN0cmluZyAkYmFzZUNlbGwgQmFzZSBjZWxsLCBvbmx5IG5lZWRlZCB3aGVuIGZvcm11bGEgY29udGFpbnMgdFJlZk4gdG9rZW5zLCBlLmcuIHdpdGggc2hhcmVkIGZvcm11bGFzCiAgICAgKiBAcmV0dXJuIHN0cmluZyBIdW1hbiByZWFkYWJsZSBmb3JtdWxhCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZ2V0Rm9ybXVsYUZyb21EYXRhKCRmb3JtdWxhRGF0YSwgJGFkZGl0aW9uYWxEYXRhID0gJycsICRiYXNlQ2VsbCA9ICdBMScpCiAgICB7CiAgICAgICAgLy8gc3RhcnQgcGFyc2luZyB0aGUgZm9ybXVsYSBkYXRhCiAgICAgICAgJHRva2VucyA9IGFycmF5KCk7CgogICAgICAgIHdoaWxlIChzdHJsZW4oJGZvcm11bGFEYXRhKSA+IDAgYW5kICR0b2tlbiA9ICR0aGlzLT5nZXROZXh0VG9rZW4oJGZvcm11bGFEYXRhLCAkYmFzZUNlbGwpKSB7CiAgICAgICAgICAgICR0b2tlbnNbXSA9ICR0b2tlbjsKICAgICAgICAgICAgJGZvcm11bGFEYXRhID0gc3Vic3RyKCRmb3JtdWxhRGF0YSwgJHRva2VuWydzaXplJ10pOwoKICAgICAgICAgICAgLy8gZm9yIGRlYnVnOiBkdW1wIHRoZSB0b2tlbgogICAgICAgICAgICAvL3Zhcl9kdW1wKCR0b2tlbik7CiAgICAgICAgfQoKICAgICAgICAkZm9ybXVsYVN0cmluZyA9ICR0aGlzLT5jcmVhdGVGb3JtdWxhRnJvbVRva2VucygkdG9rZW5zLCAkYWRkaXRpb25hbERhdGEpOwoKICAgICAgICByZXR1cm4gJGZvcm11bGFTdHJpbmc7CiAgICB9CgoKICAgIC8qKgogICAgICogVGFrZSBhcnJheSBvZiB0b2tlbnMgdG9nZXRoZXIgd2l0aCBhZGRpdGlvbmFsIGRhdGEgZm9yIGZvcm11bGEgYW5kIHJldHVybiBodW1hbiByZWFkYWJsZSBmb3JtdWxhCiAgICAgKgogICAgICogQHBhcmFtIGFycmF5ICR0b2tlbnMKICAgICAqIEBwYXJhbSBhcnJheSAkYWRkaXRpb25hbERhdGEgQWRkaXRpb25hbCBiaW5hcnkgZGF0YSBnb2luZyB3aXRoIHRoZSBmb3JtdWxhCiAgICAgKiBAcGFyYW0gc3RyaW5nICRiYXNlQ2VsbCBCYXNlIGNlbGwsIG9ubHkgbmVlZGVkIHdoZW4gZm9ybXVsYSBjb250YWlucyB0UmVmTiB0b2tlbnMsIGUuZy4gd2l0aCBzaGFyZWQgZm9ybXVsYXMKICAgICAqIEByZXR1cm4gc3RyaW5nIEh1bWFuIHJlYWRhYmxlIGZvcm11bGEKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBjcmVhdGVGb3JtdWxhRnJvbVRva2VucygkdG9rZW5zLCAkYWRkaXRpb25hbERhdGEpCiAgICB7CiAgICAgICAgLy8gZW1wdHkgZm9ybXVsYT8KICAgICAgICBpZiAoZW1wdHkoJHRva2VucykpIHsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KCiAgICAgICAgJGZvcm11bGFTdHJpbmdzID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdG9rZW5zIGFzICR0b2tlbikgewogICAgICAgICAgICAvLyBpbml0aWFsaXplIHNwYWNlcwogICAgICAgICAgICAkc3BhY2UwID0gaXNzZXQoJHNwYWNlMCkgPyAkc3BhY2UwIDogJyc7IC8vIHNwYWNlcyBiZWZvcmUgbmV4dCB0b2tlbiwgbm90IHRQYXJlbgogICAgICAgICAgICAkc3BhY2UxID0gaXNzZXQoJHNwYWNlMSkgPyAkc3BhY2UxIDogJyc7IC8vIGNhcnJpYWdlIHJldHVybnMgYmVmb3JlIG5leHQgdG9rZW4sIG5vdCB0UGFyZW4KICAgICAgICAgICAgJHNwYWNlMiA9IGlzc2V0KCRzcGFjZTIpID8gJHNwYWNlMiA6ICcnOyAvLyBzcGFjZXMgYmVmb3JlIG9wZW5pbmcgcGFyZW50aGVzaXMKICAgICAgICAgICAgJHNwYWNlMyA9IGlzc2V0KCRzcGFjZTMpID8gJHNwYWNlMyA6ICcnOyAvLyBjYXJyaWFnZSByZXR1cm5zIGJlZm9yZSBvcGVuaW5nIHBhcmVudGhlc2lzCiAgICAgICAgICAgICRzcGFjZTQgPSBpc3NldCgkc3BhY2U0KSA\/ICRzcGFjZTQgOiAnJzsgLy8gc3BhY2VzIGJlZm9yZSBjbG9zaW5nIHBhcmVudGhlc2lzCiAgICAgICAgICAgICRzcGFjZTUgPSBpc3NldCgkc3BhY2U1KSA\/ICRzcGFjZTUgOiAnJzsgLy8gY2FycmlhZ2UgcmV0dXJucyBiZWZvcmUgY2xvc2luZyBwYXJlbnRoZXNpcwoKICAgICAgICAgICAgc3dpdGNoICgkdG9rZW5bJ25hbWUnXSkgewogICAgICAgICAgICAgICAgY2FzZSAndEFkZCc6IC8vIGFkZGl0aW9uCiAgICAgICAgICAgICAgICBjYXNlICd0Q29uY2F0JzogLy8gYWRkaXRpb24KICAgICAgICAgICAgICAgIGNhc2UgJ3REaXYnOiAvLyBkaXZpc2lvbgogICAgICAgICAgICAgICAgY2FzZSAndEVRJzogLy8gZXF1YWxpdHkKICAgICAgICAgICAgICAgIGNhc2UgJ3RHRSc6IC8vIGdyZWF0ZXIgdGhhbiBvciBlcXVhbAogICAgICAgICAgICAgICAgY2FzZSAndEdUJzogLy8gZ3JlYXRlciB0aGFuCiAgICAgICAgICAgICAgICBjYXNlICd0SXNlY3QnOiAvLyBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgICAgIGNhc2UgJ3RMRSc6IC8vIGxlc3MgdGhhbiBvciBlcXVhbAogICAgICAgICAgICAgICAgY2FzZSAndExpc3QnOiAvLyBsZXNzIHRoYW4gb3IgZXF1YWwKICAgICAgICAgICAgICAgIGNhc2UgJ3RMVCc6IC8vIGxlc3MgdGhhbgogICAgICAgICAgICAgICAgY2FzZSAndE11bCc6IC8vIG11bHRpcGxpY2F0aW9uCiAgICAgICAgICAgICAgICBjYXNlICd0TkUnOiAvLyBtdWx0aXBsaWNhdGlvbgogICAgICAgICAgICAgICAgY2FzZSAndFBvd2VyJzogLy8gcG93ZXIKICAgICAgICAgICAgICAgIGNhc2UgJ3RSYW5nZSc6IC8vIHJhbmdlCiAgICAgICAgICAgICAgICBjYXNlICd0U3ViJzogLy8gc3VidHJhY3Rpb24KICAgICAgICAgICAgICAgICAgICAkb3AyID0gYXJyYXlfcG9wKCRmb3JtdWxhU3RyaW5ncyk7CiAgICAgICAgICAgICAgICAgICAgJG9wMSA9IGFycmF5X3BvcCgkZm9ybXVsYVN0cmluZ3MpOwogICAgICAgICAgICAgICAgICAgICRmb3JtdWxhU3RyaW5nc1tdID0gIiRvcDEkc3BhY2UxJHNwYWNlMHskdG9rZW5bJ2RhdGEnXX0kb3AyIjsKICAgICAgICAgICAgICAgICAgICB1bnNldCgkc3BhY2UwLCAkc3BhY2UxKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3RVcGx1cyc6IC8vIHVuYXJ5IHBsdXMKICAgICAgICAgICAgICAgIGNhc2UgJ3RVbWludXMnOiAvLyB1bmFyeSBtaW51cwogICAgICAgICAgICAgICAgICAgICRvcCA9IGFycmF5X3BvcCgkZm9ybXVsYVN0cmluZ3MpOwogICAgICAgICAgICAgICAgICAgICRmb3JtdWxhU3RyaW5nc1tdID0gIiRzcGFjZTEkc3BhY2UweyR0b2tlblsnZGF0YSddfSRvcCI7CiAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHNwYWNlMCwgJHNwYWNlMSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd0UGVyY2VudCc6IC8vIHBlcmNlbnQgc2lnbgogICAgICAgICAgICAgICAgICAgICRvcCA9IGFycmF5X3BvcCgkZm9ybXVsYVN0cmluZ3MpOwogICAgICAgICAgICAgICAgICAgICRmb3JtdWxhU3RyaW5nc1tdID0gIiRvcCRzcGFjZTEkc3BhY2UweyR0b2tlblsnZGF0YSddfSI7CiAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHNwYWNlMCwgJHNwYWNlMSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd0QXR0clZvbGF0aWxlJzogLy8gaW5kaWNhdGVzIHZvbGF0aWxlIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICBjYXNlICd0QXR0cklmJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3RBdHRyU2tpcCc6CiAgICAgICAgICAgICAgICBjYXNlICd0QXR0ckNob29zZSc6CiAgICAgICAgICAgICAgICAgICAgLy8gdG9rZW4gaXMgb25seSBpbXBvcnRhbnQgZm9yIEV4Y2VsIGZvcm11bGEgZXZhbHVhdG9yCiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAndEF0dHJTcGFjZSc6IC8vIHNwYWNlIC8gY2FycmlhZ2UgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgLy8gc3BhY2Ugd2lsbCBiZSB1c2VkIHdoZW4gbmV4dCB0b2tlbiBhcnJpdmVzLCBkbyBub3QgYWx0ZXIgZm9ybXVsYVN0cmluZyBzdGFjawogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoJHRva2VuWydkYXRhJ11bJ3NwYWNldHlwZSddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3R5cGUwJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZTAgPSBzdHJfcmVwZWF0KCcgJywgJHRva2VuWydkYXRhJ11bJ3NwYWNlY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndHlwZTEnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwYWNlMSA9IHN0cl9yZXBlYXQoIlxuIiwgJHRva2VuWydkYXRhJ11bJ3NwYWNlY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndHlwZTInOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwYWNlMiA9IHN0cl9yZXBlYXQoJyAnLCAkdG9rZW5bJ2RhdGEnXVsnc3BhY2Vjb3VudCddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd0eXBlMyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3BhY2UzID0gc3RyX3JlcGVhdCgiXG4iLCAkdG9rZW5bJ2RhdGEnXVsnc3BhY2Vjb3VudCddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd0eXBlNCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3BhY2U0ID0gc3RyX3JlcGVhdCgnICcsICR0b2tlblsnZGF0YSddWydzcGFjZWNvdW50J10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3R5cGU1JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZTUgPSBzdHJfcmVwZWF0KCJcbiIsICR0b2tlblsnZGF0YSddWydzcGFjZWNvdW50J10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAndEF0dHJTdW0nOiAvLyBTVU0gZnVuY3Rpb24gd2l0aCBvbmUgcGFyYW1ldGVyCiAgICAgICAgICAgICAgICAgICAgJG9wID0gYXJyYXlfcG9wKCRmb3JtdWxhU3RyaW5ncyk7CiAgICAgICAgICAgICAgICAgICAgJGZvcm11bGFTdHJpbmdzW10gPSAieyRzcGFjZTF9eyRzcGFjZTB9U1VNKCRvcCkiOwogICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzcGFjZTAsICRzcGFjZTEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAndEZ1bmMnOiAvLyBmdW5jdGlvbiB3aXRoIGZpeGVkIG51bWJlciBvZiBhcmd1bWVudHMKICAgICAgICAgICAgICAgIGNhc2UgJ3RGdW5jVic6IC8vIGZ1bmN0aW9uIHdpdGggdmFyaWFibGUgbnVtYmVyIG9mIGFyZ3VtZW50cwogICAgICAgICAgICAgICAgICAgIGlmICgkdG9rZW5bJ2RhdGEnXVsnZnVuY3Rpb24nXSAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBub3JtYWwgZnVuY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgJG9wcyA9IGFycmF5KCk7IC8vIGFycmF5IG9mIG9wZXJhdG9ycwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdG9rZW5bJ2RhdGEnXVsnYXJncyddOyArKyRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3BzW10gPSBhcnJheV9wb3AoJGZvcm11bGFTdHJpbmdzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkb3BzID0gYXJyYXlfcmV2ZXJzZSgkb3BzKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGZvcm11bGFTdHJpbmdzW10gPSAiJHNwYWNlMSRzcGFjZTB7JHRva2VuWydkYXRhJ11bJ2Z1bmN0aW9uJ119KCIgLiBpbXBsb2RlKCcsJywgJG9wcykgLiAiKSI7CiAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzcGFjZTAsICRzcGFjZTEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZC1pbiBmdW5jdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAkb3BzID0gYXJyYXkoKTsgLy8gYXJyYXkgb2Ygb3BlcmF0b3JzCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICR0b2tlblsnZGF0YSddWydhcmdzJ10gLSAxOyArKyRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3BzW10gPSBhcnJheV9wb3AoJGZvcm11bGFTdHJpbmdzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkb3BzID0gYXJyYXlfcmV2ZXJzZSgkb3BzKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gYXJyYXlfcG9wKCRmb3JtdWxhU3RyaW5ncyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtdWxhU3RyaW5nc1tdID0gIiRzcGFjZTEkc3BhY2UwJGZ1bmN0aW9uKCIgLiBpbXBsb2RlKCcsJywgJG9wcykgLiAiKSI7CiAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzcGFjZTAsICRzcGFjZTEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3RQYXJlbic6IC8vIHBhcmVudGhlc2lzCiAgICAgICAgICAgICAgICAgICAgJGV4cHJlc3Npb24gPSBhcnJheV9wb3AoJGZvcm11bGFTdHJpbmdzKTsKICAgICAgICAgICAgICAgICAgICAkZm9ybXVsYVN0cmluZ3NbXSA9ICIkc3BhY2UzJHNwYWNlMigkZXhwcmVzc2lvbiRzcGFjZTUkc3BhY2U0KSI7CiAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHNwYWNlMiwgJHNwYWNlMywgJHNwYWNlNCwgJHNwYWNlNSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd0QXJyYXknOiAvLyBhcnJheSBjb25zdGFudAogICAgICAgICAgICAgICAgICAgICRjb25zdGFudEFycmF5ID0gc2VsZjo6cmVhZEJJRkY4Q29uc3RhbnRBcnJheSgkYWRkaXRpb25hbERhdGEpOwogICAgICAgICAgICAgICAgICAgICRmb3JtdWxhU3RyaW5nc1tdID0gJHNwYWNlMSAuICRzcGFjZTAgLiAkY29uc3RhbnRBcnJheVsndmFsdWUnXTsKICAgICAgICAgICAgICAgICAgICAkYWRkaXRpb25hbERhdGEgPSBzdWJzdHIoJGFkZGl0aW9uYWxEYXRhLCAkY29uc3RhbnRBcnJheVsnc2l6ZSddKTsgLy8gYml0ZSBvZiBjaHVuayBvZiBhZGRpdGlvbmFsIGRhdGEKICAgICAgICAgICAgICAgICAgICB1bnNldCgkc3BhY2UwLCAkc3BhY2UxKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3RNZW1BcmVhJzoKICAgICAgICAgICAgICAgICAgICAvLyBiaXRlIG9mZiBjaHVuayBvZiBhZGRpdGlvbmFsIGRhdGEKICAgICAgICAgICAgICAgICAgICAkY2VsbFJhbmdlQWRkcmVzc0xpc3QgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbFJhbmdlQWRkcmVzc0xpc3QoJGFkZGl0aW9uYWxEYXRhKTsKICAgICAgICAgICAgICAgICAgICAkYWRkaXRpb25hbERhdGEgPSBzdWJzdHIoJGFkZGl0aW9uYWxEYXRhLCAkY2VsbFJhbmdlQWRkcmVzc0xpc3RbJ3NpemUnXSk7CiAgICAgICAgICAgICAgICAgICAgJGZvcm11bGFTdHJpbmdzW10gPSAiJHNwYWNlMSRzcGFjZTB7JHRva2VuWydkYXRhJ119IjsKICAgICAgICAgICAgICAgICAgICB1bnNldCgkc3BhY2UwLCAkc3BhY2UxKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3RBcmVhJzogLy8gY2VsbCByYW5nZSBhZGRyZXNzCiAgICAgICAgICAgICAgICBjYXNlICd0Qm9vbCc6IC8vIGJvb2xlYW4KICAgICAgICAgICAgICAgIGNhc2UgJ3RFcnInOiAvLyBlcnJvciBjb2RlCiAgICAgICAgICAgICAgICBjYXNlICd0SW50JzogLy8gaW50ZWdlcgogICAgICAgICAgICAgICAgY2FzZSAndE1lbUVycic6CiAgICAgICAgICAgICAgICBjYXNlICd0TWVtRnVuYyc6CiAgICAgICAgICAgICAgICBjYXNlICd0TWlzc0FyZyc6CiAgICAgICAgICAgICAgICBjYXNlICd0TmFtZSc6CiAgICAgICAgICAgICAgICBjYXNlICd0TmFtZVgnOgogICAgICAgICAgICAgICAgY2FzZSAndE51bSc6IC8vIG51bWJlcgogICAgICAgICAgICAgICAgY2FzZSAndFJlZic6IC8vIHNpbmdsZSBjZWxsIHJlZmVyZW5jZQogICAgICAgICAgICAgICAgY2FzZSAndFJlZjNkJzogLy8gM2QgY2VsbCByZWZlcmVuY2UKICAgICAgICAgICAgICAgIGNhc2UgJ3RBcmVhM2QnOiAvLyAzZCBjZWxsIHJhbmdlIHJlZmVyZW5jZQogICAgICAgICAgICAgICAgY2FzZSAndFJlZk4nOgogICAgICAgICAgICAgICAgY2FzZSAndEFyZWFOJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3RTdHInOiAvLyBzdHJpbmcKICAgICAgICAgICAgICAgICAgICAkZm9ybXVsYVN0cmluZ3NbXSA9ICIkc3BhY2UxJHNwYWNlMHskdG9rZW5bJ2RhdGEnXX0iOwogICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzcGFjZTAsICRzcGFjZTEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRmb3JtdWxhU3RyaW5nID0gJGZvcm11bGFTdHJpbmdzWzBdOwoKICAgICAgICAvLyBmb3IgZGVidWc6IGR1bXAgdGhlIGh1bWFuIHJlYWRhYmxlIGZvcm11bGEKICAgICAgICAvL2VjaG8gJy0tLS0nIC4gIlxuIjsKICAgICAgICAvL2VjaG8gJ0Zvcm11bGE6ICcgLiAkZm9ybXVsYVN0cmluZzsKCiAgICAgICAgcmV0dXJuICRmb3JtdWxhU3RyaW5nOwogICAgfQoKCiAgICAvKioKICAgICAqIEZldGNoIG5leHQgdG9rZW4gZnJvbSBiaW5hcnkgZm9ybXVsYSBkYXRhCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyBGb3JtdWxhIGRhdGEKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJhc2VDZWxsIEJhc2UgY2VsbCwgb25seSBuZWVkZWQgd2hlbiBmb3JtdWxhIGNvbnRhaW5zIHRSZWZOIHRva2VucywgZS5nLiB3aXRoIHNoYXJlZCBmb3JtdWxhcwogICAgICogQHJldHVybiBhcnJheQogICAgICogQHRocm93cyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZ2V0TmV4dFRva2VuKCRmb3JtdWxhRGF0YSwgJGJhc2VDZWxsID0gJ0ExJykKICAgIHsKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDE7IHRva2VuIGlkCiAgICAgICAgJGlkID0gb3JkKCRmb3JtdWxhRGF0YVswXSk7IC8vIHRva2VuIGlkCiAgICAgICAgJG5hbWUgPSBmYWxzZTsgLy8gaW5pdGlhbGl6ZSB0b2tlbiBuYW1lCgogICAgICAgIHN3aXRjaCAoJGlkKSB7CiAgICAgICAgICAgIGNhc2UgMHgwMzoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBZGQnOwogICAgICAgICAgICAgICAgJHNpemUgPSAxOwogICAgICAgICAgICAgICAgJGRhdGEgPSAnKyc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgICAgICAgJG5hbWUgPSAndFN1Yic7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICctJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDU6CiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0TXVsJzsKICAgICAgICAgICAgICAgICRzaXplID0gMTsKICAgICAgICAgICAgICAgICRkYXRhID0gJyonOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwNjoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3REaXYnOwogICAgICAgICAgICAgICAgJHNpemUgPSAxOwogICAgICAgICAgICAgICAgJGRhdGEgPSAnLyc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA3OgogICAgICAgICAgICAgICAgJG5hbWUgPSAndFBvd2VyJzsKICAgICAgICAgICAgICAgICRzaXplID0gMTsKICAgICAgICAgICAgICAgICRkYXRhID0gJ14nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwODoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RDb25jYXQnOwogICAgICAgICAgICAgICAgJHNpemUgPSAxOwogICAgICAgICAgICAgICAgJGRhdGEgPSAnJic7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDA5OgogICAgICAgICAgICAgICAgJG5hbWUgPSAndExUJzsKICAgICAgICAgICAgICAgICRzaXplID0gMTsKICAgICAgICAgICAgICAgICRkYXRhID0gJzwnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwQToKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RMRSc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICc8PSc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDBCOgogICAgICAgICAgICAgICAgJG5hbWUgPSAndEVRJzsKICAgICAgICAgICAgICAgICRzaXplID0gMTsKICAgICAgICAgICAgICAgICRkYXRhID0gJz0nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwQzoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RHRSc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICc+PSc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDBEOgogICAgICAgICAgICAgICAgJG5hbWUgPSAndEdUJzsKICAgICAgICAgICAgICAgICRzaXplID0gMTsKICAgICAgICAgICAgICAgICRkYXRhID0gJz4nOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwRToKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RORSc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICc8Pic7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDBGOgogICAgICAgICAgICAgICAgJG5hbWUgPSAndElzZWN0JzsKICAgICAgICAgICAgICAgICRzaXplID0gMTsKICAgICAgICAgICAgICAgICRkYXRhID0gJyAnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgxMDoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RMaXN0JzsKICAgICAgICAgICAgICAgICRzaXplID0gMTsKICAgICAgICAgICAgICAgICRkYXRhID0gJywnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgxMToKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RSYW5nZSc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICc6JzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MTI6CiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0VXBsdXMnOwogICAgICAgICAgICAgICAgJHNpemUgPSAxOwogICAgICAgICAgICAgICAgJGRhdGEgPSAnKyc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDEzOgogICAgICAgICAgICAgICAgJG5hbWUgPSAndFVtaW51cyc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICctJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MTQ6CiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0UGVyY2VudCc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICclJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MTU6ICAgIC8vICAgIHBhcmVudGhlc2lzCiAgICAgICAgICAgICAgICAkbmFtZSAgPSAndFBhcmVuJzsKICAgICAgICAgICAgICAgICRzaXplICA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDE2OiAgICAvLyAgICBtaXNzaW5nIGFyZ3VtZW50CiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0TWlzc0FyZyc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDE7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICcnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgxNzogICAgLy8gICAgc3RyaW5nCiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0U3RyJzsKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTsgc2l6ZTogdmFyOyBVbmljb2RlIHN0cmluZywgOC1iaXQgc3RyaW5nIGxlbmd0aAogICAgICAgICAgICAgICAgJHN0cmluZyA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nU2hvcnQoc3Vic3RyKCRmb3JtdWxhRGF0YSwgMSkpOwogICAgICAgICAgICAgICAgJHNpemUgPSAxICsgJHN0cmluZ1snc2l6ZSddOwogICAgICAgICAgICAgICAgJGRhdGEgPSBzZWxmOjpVVEY4dG9FeGNlbERvdWJsZVF1b3RlZCgkc3RyaW5nWyd2YWx1ZSddKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MTk6ICAgIC8vICAgIFNwZWNpYWwgYXR0cmlidXRlCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDE7IHNpemU6IDE7IGF0dHJpYnV0ZSB0eXBlIGZsYWdzOgogICAgICAgICAgICAgICAgc3dpdGNoIChvcmQoJGZvcm11bGFEYXRhWzFdKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMToKICAgICAgICAgICAgICAgICAgICAgICAgJG5hbWUgPSAndEF0dHJWb2xhdGlsZSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRzaXplID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDI6CiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBdHRySWYnOwogICAgICAgICAgICAgICAgICAgICAgICAkc2l6ZSA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgICAgICAgICAgICAgICAkbmFtZSA9ICd0QXR0ckNob29zZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgbnVtYmVyIG9mIGNob2ljZXMgaW4gdGhlIENIT09TRSBmdW5jdGlvbiAoJG5jLCBudW1iZXIgb2YgcGFyYW1ldGVycyBkZWNyZWFzZWQgYnkgMSkKICAgICAgICAgICAgICAgICAgICAgICAgJG5jID0gc2VsZjo6Z2V0SW50MmQoJGZvcm11bGFEYXRhLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiA0OyBzaXplOiAyICogJG5jCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogNCArIDIgKiAkbmM7IHNpemU6IDIKICAgICAgICAgICAgICAgICAgICAgICAgJHNpemUgPSAyICogJG5jICsgNjsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDg6CiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBdHRyU2tpcCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRzaXplID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MTA6CiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBdHRyU3VtJzsKICAgICAgICAgICAgICAgICAgICAgICAgJHNpemUgPSA0OwogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHg0MDoKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4NDE6CiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBdHRyU3BhY2UnOwogICAgICAgICAgICAgICAgICAgICAgICAkc2l6ZSA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgc3BhY2UgdHlwZSBhbmQgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChvcmQoJGZvcm11bGFEYXRhWzJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZXR5cGUgPSAndHlwZTAnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZXR5cGUgPSAndHlwZTEnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZXR5cGUgPSAndHlwZTInOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZXR5cGUgPSAndHlwZTMnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZXR5cGUgPSAndHlwZTQnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAweDA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZXR5cGUgPSAndHlwZTUnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbignVW5yZWNvZ25pemVkIHNwYWNlIHR5cGUgaW4gdEF0dHJTcGFjZSB0b2tlbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMzsgc2l6ZTogMTsgbnVtYmVyIG9mIGluc2VydGVkIHNwYWNlcy9jYXJyaWFnZSByZXR1cm5zCiAgICAgICAgICAgICAgICAgICAgICAgICRzcGFjZWNvdW50ID0gb3JkKCRmb3JtdWxhRGF0YVszXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9IGFycmF5KCdzcGFjZXR5cGUnID0+ICRzcGFjZXR5cGUsICdzcGFjZWNvdW50JyA9PiAkc3BhY2Vjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCdVbnJlY29nbml6ZWQgYXR0cmlidXRlIGZsYWcgaW4gdEF0dHIgdG9rZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDFDOiAgICAvLyAgICBlcnJvciBjb2RlCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDE7IHNpemU6IDE7IGVycm9yIGNvZGUKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RFcnInOwogICAgICAgICAgICAgICAgJHNpemUgPSAyOwogICAgICAgICAgICAgICAgJGRhdGEgPSBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X0Vycm9yQ29kZTo6bG9va3VwKG9yZCgkZm9ybXVsYURhdGFbMV0pKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MUQ6ICAgIC8vICAgIGJvb2xlYW4KICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTsgc2l6ZTogMTsgMCA9IGZhbHNlLCAxID0gdHJ1ZTsKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RCb29sJzsKICAgICAgICAgICAgICAgICRzaXplID0gMjsKICAgICAgICAgICAgICAgICRkYXRhID0gb3JkKCRmb3JtdWxhRGF0YVsxXSkgPyAnVFJVRScgOiAnRkFMU0UnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgxRTogICAgLy8gICAgaW50ZWdlcgogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAyOyB1bnNpZ25lZCAxNi1iaXQgaW50ZWdlcgogICAgICAgICAgICAgICAgJG5hbWUgPSAndEludCc7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDM7CiAgICAgICAgICAgICAgICAkZGF0YSA9IHNlbGY6OmdldEludDJkKCRmb3JtdWxhRGF0YSwgMSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDFGOiAgICAvLyAgICBudW1iZXIKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTsgc2l6ZTogODsKICAgICAgICAgICAgICAgICRuYW1lID0gJ3ROdW0nOwogICAgICAgICAgICAgICAgJHNpemUgPSA5OwogICAgICAgICAgICAgICAgJGRhdGEgPSBzZWxmOjpleHRyYWN0TnVtYmVyKHN1YnN0cigkZm9ybXVsYURhdGEsIDEpKTsKICAgICAgICAgICAgICAgICRkYXRhID0gc3RyX3JlcGxhY2UoJywnLCAnLicsIChzdHJpbmcpJGRhdGEpOyAvLyBpbiBjYXNlIG5vbi1FbmdsaXNoIGxvY2FsZQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgyMDogICAgLy8gICAgYXJyYXkgY29uc3RhbnQKICAgICAgICAgICAgY2FzZSAweDQwOgogICAgICAgICAgICBjYXNlIDB4NjA6CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDE7IHNpemU6IDc7IG5vdCB1c2VkCiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0QXJyYXknOwogICAgICAgICAgICAgICAgJHNpemUgPSA4OwogICAgICAgICAgICAgICAgJGRhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgyMTogICAgLy8gICAgZnVuY3Rpb24gd2l0aCBmaXhlZCBudW1iZXIgb2YgYXJndW1lbnRzCiAgICAgICAgICAgIGNhc2UgMHg0MToKICAgICAgICAgICAgY2FzZSAweDYxOgogICAgICAgICAgICAgICAgJG5hbWUgPSAndEZ1bmMnOwogICAgICAgICAgICAgICAgJHNpemUgPSAzOwogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAyOyBpbmRleCB0byBidWlsdC1pbiBzaGVldCBmdW5jdGlvbgogICAgICAgICAgICAgICAgc3dpdGNoIChzZWxmOjpnZXRJbnQyZCgkZm9ybXVsYURhdGEsIDEpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSVNOQSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSVNFUlJPUic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ05BJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU0lOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQ09TJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnVEFOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQVRBTic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1BJJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU1FSVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0VYUCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0xOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTE9HMTAnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdBQlMnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJTlQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTSUdOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUk9VTkQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdSRVBUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTUlEJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTEVOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnVkFMVUUnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUUlVFJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRkFMU0UnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdOT1QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdNT0QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdEQ09VTlQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDE6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdEU1VNJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnREFWRVJBR0UnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdETUlOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRE1BWCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0NToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0RTVERFVic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA0ODoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1RFWFQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjE6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdNSVJSJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDYzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUkFORCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2NToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0RBVEUnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUSU1FJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnREFZJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTU9OVEgnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjk6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdZRUFSJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSE9VUic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ01JTlVURSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1NFQ09ORCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3NDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ05PVyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3NToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0FSRUFTJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDc2OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUk9XUyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3NzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NPTFVNTlMnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgODM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUUkFOU1BPU0UnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgODY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUWVBFJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQVRBTjInOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgOTg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdBU0lOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQUNPUyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDU6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJU1JFRic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdDSEFSJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExMjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0xPV0VSJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExMzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1VQUEVSJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExNDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1BST1BFUic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdFWEFDVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUUklNJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExOToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1JFUExBQ0UnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTIxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQ09ERSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJU0VSUic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJU1RFWFQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTI4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSVNOVU1CRVInOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTI5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSVNCTEFOSyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ04nOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTQwOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnREFURVZBTFVFJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE0MToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1RJTUVWQUxVRSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxNDI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTTE4nOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTQzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU1lEJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSA0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2MjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NMRUFOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2MzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ01ERVRFUk0nOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTY0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTUlOVkVSU0UnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTY1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTU1VTFQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTg0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRkFDVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxODk6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdEUFJPRFVDVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOTA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJU05PTlRFWFQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTk1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRFNUREVWUCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOTY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdEVkFSUCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOTg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJU0xPR0lDQUwnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTk5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRENPVU5UQSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdSRVBMQUNFQic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMTA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdNSURCJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0xFTkInOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjEyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUk9VTkRVUCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMTM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdST1VORERPV04nOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjE0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQVNDJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIxNToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0RCQ1MnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjIxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnVE9EQVknOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjI5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU0lOSCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMzA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdDT1NIJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIzMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1RBTkgnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjMyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQVNJTkgnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjMzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQUNPU0gnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjM0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQVRBTkgnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjM1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnREdFVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJTkZPJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI1MjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0ZSRVFVRU5DWSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNjE6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdFUlJPUi5UWVBFJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI3MToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0dBTU1BTE4nOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjczOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQklOT01ESVNUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSA0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI3NDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NISURJU1QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjc1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQ0hJSU5WJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI3NjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NPTUJJTic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNzc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdDT05GSURFTkNFJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI3ODoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NSSVRCSU5PTSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNzk6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdFVkVOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI4MDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0VYUE9ORElTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyODE6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdGRElTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyODI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdGSU5WJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI4MzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0ZJU0hFUic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyODQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdGSVNIRVJJTlYnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjg1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRkxPT1InOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjg2OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnR0FNTUFESVNUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSA0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI4NzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0dBTU1BSU5WJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI4ODoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NFSUxJTkcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjg5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSFlQR0VPTURJU1QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjkwOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTE9HTk9STURJU1QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjkxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTE9HSU5WJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI5MjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ05FR0JJTk9NRElTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOTM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdOT1JNRElTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOTQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdOT1JNU0RJU1QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjk1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTk9STUlOVic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOTY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdOT1JNU0lOVic7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOTc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTVEFOREFSRElaRSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOTg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdPREQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjk5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUEVSTVVUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwMDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1BPSVNTT04nOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzAxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnVERJU1QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzAyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnV0VJQlVMTCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMDM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTVU1YTVkyJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwNDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1NVTVgyTVkyJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwNToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1NVTVgyUFkyJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwNjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NISVRFU1QnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzA3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQ09SUkVMJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwODoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NPVkFSJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMwOToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0ZPUkVDQVNUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxMDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0ZURVNUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0lOVEVSQ0VQVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMTI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdQRUFSU09OJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxMzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1JTUSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMTQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTVEVZWCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMTU6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTTE9QRSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMTY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUVEVTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjU6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdMQVJHRSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTTUFMTCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdRVUFSVElMRSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdQRVJDRU5USUxFJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMzMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1RSSU1NRUFOJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMzMjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1RJTlYnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzM3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUE9XRVInOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzQyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUkFESUFOUyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNDM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdERUdSRUVTJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM0NjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NPVU5USUYnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzQ3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQ09VTlRCTEFOSyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNTA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJU1BNVCc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmdzID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNTE6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdEQVRFRElGJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM1MjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0RBVEVTVFJJTkcnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJncyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzUzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTlVNQkVSU1RSSU5HJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2MDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1BIT05FVElDJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2ODoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0JBSFRURVhUJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3MgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbignVW5yZWNvZ25pemVkIGZ1bmN0aW9uIGluIGZvcm11bGEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZGF0YSA9IGFycmF5KCdmdW5jdGlvbicgPT4gJGZ1bmN0aW9uLCAnYXJncycgPT4gJGFyZ3MpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgyMjogICAgLy8gICAgZnVuY3Rpb24gd2l0aCB2YXJpYWJsZSBudW1iZXIgb2YgYXJndW1lbnRzCiAgICAgICAgICAgIGNhc2UgMHg0MjoKICAgICAgICAgICAgY2FzZSAweDYyOgogICAgICAgICAgICAgICAgJG5hbWUgPSAndEZ1bmNWJzsKICAgICAgICAgICAgICAgICRzaXplID0gNDsKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTsgc2l6ZTogMTsgbnVtYmVyIG9mIGFyZ3VtZW50cwogICAgICAgICAgICAgICAgJGFyZ3MgPSBvcmQoJGZvcm11bGFEYXRhWzFdKTsKICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMjogc2l6ZTogMjsgaW5kZXggdG8gYnVpbHQtaW4gc2hlZXQgZnVuY3Rpb24KICAgICAgICAgICAgICAgICRpbmRleCA9IHNlbGY6OmdldEludDJkKCRmb3JtdWxhRGF0YSwgMik7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NPVU5UJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSUYnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTVU0nOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdBVkVSQUdFJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTUlOJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTUFYJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUk9XJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQ09MVU1OJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ05QVic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTVERFVic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdET0xMQVInOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRklYRUQnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTE9PS1VQJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0lOREVYJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0FORCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdPUic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdWQVInOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTElORVNUJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1RSRU5EJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1MToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0xPR0VTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdHUk9XVEgnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDU2OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUFYnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDU3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnRlYnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDU4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTlBFUic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNTk6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdQTVQnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDYwOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUkFURSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNjI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdJUlInOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTUFUQ0gnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcwOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnV0VFS0RBWSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNzg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdPRkZTRVQnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDgyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU0VBUkNIJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdDSE9PU0UnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0hMT09LVVAnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwMjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1ZMT09LVVAnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0xPRyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnTEVGVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE2OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUklHSFQnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyMDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1NVQlNUSVRVVEUnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyNDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0ZJTkQnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyNToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NFTEwnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE0NDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0REQic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTQ4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnSU5ESVJFQ1QnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2NzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0lQTVQnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2ODoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1BQTVQnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NPVU5UQSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTgzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUFJPRFVDVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTkzOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU1RERVZQJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOTQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdWQVJQJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOTc6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdUUlVOQyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA0OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnVVNET0xMQVInOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIwNToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0ZJTkRCJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTRUFSQ0hCJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMDg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdMRUZUQic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjA5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUklHSFRCJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMTY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdSQU5LJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMTk6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdBRERSRVNTJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMjA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdEQVlTMzYwJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdWREInOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDIyNzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ01FRElBTic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjI4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU1VNUFJPRFVDVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjQ3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnREInOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI1NToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjY5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQVZFREVWJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyNzA6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdCRVRBRElTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjcyOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQkVUQUlOVic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE3OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUFJPQic7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzE4OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnREVWU1EnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMxOToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0dFT01FQU4nOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMyMDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0hBUk1FQU4nOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMyMToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1NVTVNRJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjI6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdLVVJUJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjM6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTS0VXJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdaVEVTVCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzI5OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnUEVSQ0VOVFJBTksnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMzMDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ01PREUnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDMzNjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0NPTkNBVEVOQVRFJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNDQ6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTVUJUT1RBTCc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzQ1OgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnU1VNSUYnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM1NDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1JPTUFOJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNTg6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdHRVRQSVZPVERBVEEnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM1OToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ0hZUEVSTElOSyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzYxOgogICAgICAgICAgICAgICAgICAgICAgICAkZnVuY3Rpb24gPSAnQVZFUkFHRUEnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2MjoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ01BWEEnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2MzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ01JTkEnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2NDoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1NUREVWUEEnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2NToKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1ZBUlBBJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNjY6CiAgICAgICAgICAgICAgICAgICAgICAgICRmdW5jdGlvbiA9ICdTVERFVkEnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDM2NzoKICAgICAgICAgICAgICAgICAgICAgICAgJGZ1bmN0aW9uID0gJ1ZBUkEnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbignVW5yZWNvZ25pemVkIGZ1bmN0aW9uIGluIGZvcm11bGEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZGF0YSA9IGFycmF5KCdmdW5jdGlvbicgPT4gJGZ1bmN0aW9uLCAnYXJncycgPT4gJGFyZ3MpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgyMzogICAgLy8gICAgaW5kZXggdG8gZGVmaW5lZCBuYW1lCiAgICAgICAgICAgIGNhc2UgMHg0MzoKICAgICAgICAgICAgY2FzZSAweDYzOgogICAgICAgICAgICAgICAgJG5hbWUgPSAndE5hbWUnOwogICAgICAgICAgICAgICAgJHNpemUgPSA1OwogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAyOyBvbmUtYmFzZWQgaW5kZXggdG8gZGVmaW5lZG5hbWUgcmVjb3JkCiAgICAgICAgICAgICAgICAkZGVmaW5lZE5hbWVJbmRleCA9IHNlbGY6OmdldEludDJkKCRmb3JtdWxhRGF0YSwgMSkgLSAxOwogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBub3QgdXNlZAogICAgICAgICAgICAgICAgJGRhdGEgPSAkdGhpcy0+ZGVmaW5lZG5hbWVbJGRlZmluZWROYW1lSW5kZXhdWyduYW1lJ107CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDI0OiAgICAvLyAgICBzaW5nbGUgY2VsbCByZWZlcmVuY2UgZS5nLiBBNQogICAgICAgICAgICBjYXNlIDB4NDQ6CiAgICAgICAgICAgIGNhc2UgMHg2NDoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RSZWYnOwogICAgICAgICAgICAgICAgJHNpemUgPSA1OwogICAgICAgICAgICAgICAgJGRhdGEgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbEFkZHJlc3Moc3Vic3RyKCRmb3JtdWxhRGF0YSwgMSwgNCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgyNTogICAgLy8gICAgY2VsbCByYW5nZSByZWZlcmVuY2UgdG8gY2VsbHMgaW4gdGhlIHNhbWUgc2hlZXQgKDJkKQogICAgICAgICAgICBjYXNlIDB4NDU6CiAgICAgICAgICAgIGNhc2UgMHg2NToKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBcmVhJzsKICAgICAgICAgICAgICAgICRzaXplID0gOTsKICAgICAgICAgICAgICAgICRkYXRhID0gJHRoaXMtPnJlYWRCSUZGOENlbGxSYW5nZUFkZHJlc3Moc3Vic3RyKCRmb3JtdWxhRGF0YSwgMSwgOCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgyNjogICAgLy8gICAgQ29uc3RhbnQgcmVmZXJlbmNlIHN1Yi1leHByZXNzaW9uCiAgICAgICAgICAgIGNhc2UgMHg0NjoKICAgICAgICAgICAgY2FzZSAweDY2OgogICAgICAgICAgICAgICAgJG5hbWUgPSAndE1lbUFyZWEnOwogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiA0OyBub3QgdXNlZAogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiA1OyBzaXplOiAyOyBzaXplIG9mIHRoZSBmb2xsb3dpbmcgc3ViZXhwcmVzc2lvbgogICAgICAgICAgICAgICAgJHN1YlNpemUgPSBzZWxmOjpnZXRJbnQyZCgkZm9ybXVsYURhdGEsIDUpOwogICAgICAgICAgICAgICAgJHNpemUgPSA3ICsgJHN1YlNpemU7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICR0aGlzLT5nZXRGb3JtdWxhRnJvbURhdGEoc3Vic3RyKCRmb3JtdWxhRGF0YSwgNywgJHN1YlNpemUpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4Mjc6ICAgIC8vICAgIERlbGV0ZWQgY29uc3RhbnQgcmVmZXJlbmNlIHN1Yi1leHByZXNzaW9uCiAgICAgICAgICAgIGNhc2UgMHg0NzoKICAgICAgICAgICAgY2FzZSAweDY3OgogICAgICAgICAgICAgICAgJG5hbWUgPSAndE1lbUVycic7CiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDE7IHNpemU6IDQ7IG5vdCB1c2VkCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDU7IHNpemU6IDI7IHNpemUgb2YgdGhlIGZvbGxvd2luZyBzdWJleHByZXNzaW9uCiAgICAgICAgICAgICAgICAkc3ViU2l6ZSA9IHNlbGY6OmdldEludDJkKCRmb3JtdWxhRGF0YSwgNSk7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDcgKyAkc3ViU2l6ZTsKICAgICAgICAgICAgICAgICRkYXRhID0gJHRoaXMtPmdldEZvcm11bGFGcm9tRGF0YShzdWJzdHIoJGZvcm11bGFEYXRhLCA3LCAkc3ViU2l6ZSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgyOTogICAgLy8gICAgVmFyaWFibGUgcmVmZXJlbmNlIHN1Yi1leHByZXNzaW9uCiAgICAgICAgICAgIGNhc2UgMHg0OToKICAgICAgICAgICAgY2FzZSAweDY5OgogICAgICAgICAgICAgICAgJG5hbWUgPSAndE1lbUZ1bmMnOwogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAyOyBzaXplIG9mIHRoZSBmb2xsb3dpbmcgc3ViLWV4cHJlc3Npb24KICAgICAgICAgICAgICAgICRzdWJTaXplID0gc2VsZjo6Z2V0SW50MmQoJGZvcm11bGFEYXRhLCAxKTsKICAgICAgICAgICAgICAgICRzaXplID0gMyArICRzdWJTaXplOwogICAgICAgICAgICAgICAgJGRhdGEgPSAkdGhpcy0+Z2V0Rm9ybXVsYUZyb21EYXRhKHN1YnN0cigkZm9ybXVsYURhdGEsIDMsICRzdWJTaXplKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDJDOiAvLyBSZWxhdGl2ZSAyZCBjZWxsIHJlZmVyZW5jZSByZWZlcmVuY2UsIHVzZWQgaW4gc2hhcmVkIGZvcm11bGFzIGFuZCBzb21lIG90aGVyIHBsYWNlcwogICAgICAgICAgICBjYXNlIDB4NEM6CiAgICAgICAgICAgIGNhc2UgMHg2QzoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RSZWZOJzsKICAgICAgICAgICAgICAgICRzaXplID0gNTsKICAgICAgICAgICAgICAgICRkYXRhID0gJHRoaXMtPnJlYWRCSUZGOENlbGxBZGRyZXNzQihzdWJzdHIoJGZvcm11bGFEYXRhLCAxLCA0KSwgJGJhc2VDZWxsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MkQ6ICAgIC8vICAgIFJlbGF0aXZlIDJkIHJhbmdlIHJlZmVyZW5jZQogICAgICAgICAgICBjYXNlIDB4NEQ6CiAgICAgICAgICAgIGNhc2UgMHg2RDoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBcmVhTic7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDk7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICR0aGlzLT5yZWFkQklGRjhDZWxsUmFuZ2VBZGRyZXNzQihzdWJzdHIoJGZvcm11bGFEYXRhLCAxLCA4KSwgJGJhc2VDZWxsKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4Mzk6ICAgIC8vICAgIEV4dGVybmFsIG5hbWUKICAgICAgICAgICAgY2FzZSAweDU5OgogICAgICAgICAgICBjYXNlIDB4Nzk6CiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0TmFtZVgnOwogICAgICAgICAgICAgICAgJHNpemUgPSA3OwogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAyOyBpbmRleCB0byBSRUYgZW50cnkgaW4gRVhURVJOU0hFRVQgcmVjb3JkCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDM7IHNpemU6IDI7IG9uZS1iYXNlZCBpbmRleCB0byBERUZJTkVETkFNRSBvciBFWFRFUk5OQU1FIHJlY29yZAogICAgICAgICAgICAgICAgJGluZGV4ID0gc2VsZjo6Z2V0SW50MmQoJGZvcm11bGFEYXRhLCAzKTsKICAgICAgICAgICAgICAgIC8vIGFzc3VtZSBpbmRleCBpcyB0byBFWFRFUk5OQU1FIHJlY29yZAogICAgICAgICAgICAgICAgJGRhdGEgPSAkdGhpcy0+ZXh0ZXJuYWxOYW1lc1skaW5kZXggLSAxXVsnbmFtZSddOwogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiA1OyBzaXplOiAyOyBub3QgdXNlZAogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgzQTogICAgLy8gICAgM2QgcmVmZXJlbmNlIHRvIGNlbGwKICAgICAgICAgICAgY2FzZSAweDVBOgogICAgICAgICAgICBjYXNlIDB4N0E6CiAgICAgICAgICAgICAgICAkbmFtZSA9ICd0UmVmM2QnOwogICAgICAgICAgICAgICAgJHNpemUgPSA3OwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAyOyBpbmRleCB0byBSRUYgZW50cnkKICAgICAgICAgICAgICAgICAgICAkc2hlZXRSYW5nZSA9ICR0aGlzLT5yZWFkU2hlZXRSYW5nZUJ5UmVmSW5kZXgoc2VsZjo6Z2V0SW50MmQoJGZvcm11bGFEYXRhLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAzOyBzaXplOiA0OyBjZWxsIGFkZHJlc3MKICAgICAgICAgICAgICAgICAgICAkY2VsbEFkZHJlc3MgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbEFkZHJlc3Moc3Vic3RyKCRmb3JtdWxhRGF0YSwgMywgNCkpOwoKICAgICAgICAgICAgICAgICAgICAkZGF0YSA9ICIkc2hlZXRSYW5nZSEkY2VsbEFkZHJlc3MiOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoUEhQRXhjZWxfRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlZCBzaGVldCByZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAkZGF0YSA9ICcjUkVGISc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDNCOiAgICAvLyAgICAzZCByZWZlcmVuY2UgdG8gY2VsbCByYW5nZQogICAgICAgICAgICBjYXNlIDB4NUI6CiAgICAgICAgICAgIGNhc2UgMHg3QjoKICAgICAgICAgICAgICAgICRuYW1lID0gJ3RBcmVhM2QnOwogICAgICAgICAgICAgICAgJHNpemUgPSAxMTsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMTsgc2l6ZTogMjsgaW5kZXggdG8gUkVGIGVudHJ5CiAgICAgICAgICAgICAgICAgICAgJHNoZWV0UmFuZ2UgPSAkdGhpcy0+cmVhZFNoZWV0UmFuZ2VCeVJlZkluZGV4KHNlbGY6OmdldEludDJkKCRmb3JtdWxhRGF0YSwgMSkpOwogICAgICAgICAgICAgICAgICAgIC8vIG9mZnNldDogMzsgc2l6ZTogODsgY2VsbCBhZGRyZXNzCiAgICAgICAgICAgICAgICAgICAgJGNlbGxSYW5nZUFkZHJlc3MgPSAkdGhpcy0+cmVhZEJJRkY4Q2VsbFJhbmdlQWRkcmVzcyhzdWJzdHIoJGZvcm11bGFEYXRhLCAzLCA4KSk7CgogICAgICAgICAgICAgICAgICAgICRkYXRhID0gIiRzaGVldFJhbmdlISRjZWxsUmFuZ2VBZGRyZXNzIjsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFBIUEV4Y2VsX0V4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZWQgc2hlZXQgcmVmZXJlbmNlCiAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSAnI1JFRiEnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8vIFVua25vd24gY2FzZXMgICAgLy8gZG9uJ3Qga25vdyBob3cgdG8gZGVhbCB3aXRoCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbignVW5yZWNvZ25pemVkIHRva2VuICcgLiBzcHJpbnRmKCclMDJYJywgJGlkKSAuICcgaW4gZm9ybXVsYScpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgICdpZCcgPT4gJGlkLAogICAgICAgICAgICAnbmFtZScgPT4gJG5hbWUsCiAgICAgICAgICAgICdzaXplJyA9PiAkc2l6ZSwKICAgICAgICAgICAgJ2RhdGEnID0+ICRkYXRhLAogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgYSBjZWxsIGFkZHJlc3MgaW4gQklGRjggZS5nLiAnQTInIG9yICckQSQyJwogICAgICogc2VjdGlvbiAzLjMuNAogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNlbGxBZGRyZXNzU3RydWN0dXJlCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRCSUZGOENlbGxBZGRyZXNzKCRjZWxsQWRkcmVzc1N0cnVjdHVyZSkKICAgIHsKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGluZGV4IHRvIHJvdyAoMC4uLiA2NTUzNSkgKG9yIG9mZnNldCAoLTMyNzY4Li4uIDMyNzY3KSkKICAgICAgICAkcm93ID0gc2VsZjo6Z2V0SW50MmQoJGNlbGxBZGRyZXNzU3RydWN0dXJlLCAwKSArIDE7CgogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgaW5kZXggdG8gY29sdW1uIG9yIGNvbHVtbiBvZmZzZXQgKyByZWxhdGl2ZSBmbGFncwogICAgICAgIC8vIGJpdDogNy0wOyBtYXNrIDB4MDBGRjsgY29sdW1uIGluZGV4CiAgICAgICAgJGNvbHVtbiA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgweDAwRkYgJiBzZWxmOjpnZXRJbnQyZCgkY2VsbEFkZHJlc3NTdHJ1Y3R1cmUsIDIpKTsKCiAgICAgICAgLy8gYml0OiAxNDsgbWFzayAweDQwMDA7ICgxID0gcmVsYXRpdmUgY29sdW1uIGluZGV4LCAwID0gYWJzb2x1dGUgY29sdW1uIGluZGV4KQogICAgICAgIGlmICghKDB4NDAwMCAmIHNlbGY6OmdldEludDJkKCRjZWxsQWRkcmVzc1N0cnVjdHVyZSwgMikpKSB7CiAgICAgICAgICAgICRjb2x1bW4gPSAnJCcgLiAkY29sdW1uOwogICAgICAgIH0KICAgICAgICAvLyBiaXQ6IDE1OyBtYXNrIDB4ODAwMDsgKDEgPSByZWxhdGl2ZSByb3cgaW5kZXgsIDAgPSBhYnNvbHV0ZSByb3cgaW5kZXgpCiAgICAgICAgaWYgKCEoMHg4MDAwICYgc2VsZjo6Z2V0SW50MmQoJGNlbGxBZGRyZXNzU3RydWN0dXJlLCAyKSkpIHsKICAgICAgICAgICAgJHJvdyA9ICckJyAuICRyb3c7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGNvbHVtbiAuICRyb3c7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgYSBjZWxsIGFkZHJlc3MgaW4gQklGRjggZm9yIHNoYXJlZCBmb3JtdWxhcy4gVXNlcyBwb3NpdGl2ZSBhbmQgbmVnYXRpdmUgdmFsdWVzIGZvciByb3cgYW5kIGNvbHVtbgogICAgICogdG8gaW5kaWNhdGUgb2Zmc2V0cyBmcm9tIGEgYmFzZSBjZWxsCiAgICAgKiBzZWN0aW9uIDMuMy40CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkY2VsbEFkZHJlc3NTdHJ1Y3R1cmUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJhc2VDZWxsIEJhc2UgY2VsbCwgb25seSBuZWVkZWQgd2hlbiBmb3JtdWxhIGNvbnRhaW5zIHRSZWZOIHRva2VucywgZS5nLiB3aXRoIHNoYXJlZCBmb3JtdWxhcwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkQklGRjhDZWxsQWRkcmVzc0IoJGNlbGxBZGRyZXNzU3RydWN0dXJlLCAkYmFzZUNlbGwgPSAnQTEnKQogICAgewogICAgICAgIGxpc3QoJGJhc2VDb2wsICRiYXNlUm93KSA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRiYXNlQ2VsbCk7CiAgICAgICAgJGJhc2VDb2wgPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGJhc2VDb2wpIC0gMTsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBpbmRleCB0byByb3cgKDAuLi4gNjU1MzUpIChvciBvZmZzZXQgKC0zMjc2OC4uLiAzMjc2NykpCiAgICAgICAgJHJvd0luZGV4ID0gc2VsZjo6Z2V0SW50MmQoJGNlbGxBZGRyZXNzU3RydWN0dXJlLCAwKTsKICAgICAgICAkcm93ID0gc2VsZjo6Z2V0SW50MmQoJGNlbGxBZGRyZXNzU3RydWN0dXJlLCAwKSArIDE7CgogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgaW5kZXggdG8gY29sdW1uIG9yIGNvbHVtbiBvZmZzZXQgKyByZWxhdGl2ZSBmbGFncwogICAgICAgIC8vIGJpdDogNy0wOyBtYXNrIDB4MDBGRjsgY29sdW1uIGluZGV4CiAgICAgICAgJGNvbEluZGV4ID0gMHgwMEZGICYgc2VsZjo6Z2V0SW50MmQoJGNlbGxBZGRyZXNzU3RydWN0dXJlLCAyKTsKCiAgICAgICAgLy8gYml0OiAxNDsgbWFzayAweDQwMDA7ICgxID0gcmVsYXRpdmUgY29sdW1uIGluZGV4LCAwID0gYWJzb2x1dGUgY29sdW1uIGluZGV4KQogICAgICAgIGlmICghKDB4NDAwMCAmIHNlbGY6OmdldEludDJkKCRjZWxsQWRkcmVzc1N0cnVjdHVyZSwgMikpKSB7CiAgICAgICAgICAgICRjb2x1bW4gPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbEluZGV4KTsKICAgICAgICAgICAgJGNvbHVtbiA9ICckJyAuICRjb2x1bW47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGNvbEluZGV4ID0gKCRjb2xJbmRleCA8PSAxMjcpID8gJGNvbEluZGV4IDogJGNvbEluZGV4IC0gMjU2OwogICAgICAgICAgICAkY29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRiYXNlQ29sICsgJGNvbEluZGV4KTsKICAgICAgICB9CgogICAgICAgIC8vIGJpdDogMTU7IG1hc2sgMHg4MDAwOyAoMSA9IHJlbGF0aXZlIHJvdyBpbmRleCwgMCA9IGFic29sdXRlIHJvdyBpbmRleCkKICAgICAgICBpZiAoISgweDgwMDAgJiBzZWxmOjpnZXRJbnQyZCgkY2VsbEFkZHJlc3NTdHJ1Y3R1cmUsIDIpKSkgewogICAgICAgICAgICAkcm93ID0gJyQnIC4gJHJvdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcm93SW5kZXggPSAoJHJvd0luZGV4IDw9IDMyNzY3KSA\/ICRyb3dJbmRleCA6ICRyb3dJbmRleCAtIDY1NTM2OwogICAgICAgICAgICAkcm93ID0gJGJhc2VSb3cgKyAkcm93SW5kZXg7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGNvbHVtbiAuICRyb3c7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgYSBjZWxsIHJhbmdlIGFkZHJlc3MgaW4gQklGRjUgZS5nLiAnQTI6QjYnIG9yICdBMScKICAgICAqIGFsd2F5cyBmaXhlZCByYW5nZQogICAgICogc2VjdGlvbiAyLjUuMTQKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJEYXRhCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICogQHRocm93cyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEJJRkY1Q2VsbFJhbmdlQWRkcmVzc0ZpeGVkKCRzdWJEYXRhKQogICAgewogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgaW5kZXggdG8gZmlyc3Qgcm93CiAgICAgICAgJGZyID0gc2VsZjo6Z2V0SW50MmQoJHN1YkRhdGEsIDApICsgMTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBpbmRleCB0byBsYXN0IHJvdwogICAgICAgICRsciA9IHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCAyKSArIDE7CgogICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMTsgaW5kZXggdG8gZmlyc3QgY29sdW1uCiAgICAgICAgJGZjID0gb3JkKCRzdWJEYXRhezR9KTsKCiAgICAgICAgLy8gb2Zmc2V0OiA1OyBzaXplOiAxOyBpbmRleCB0byBsYXN0IGNvbHVtbgogICAgICAgICRsYyA9IG9yZCgkc3ViRGF0YXs1fSk7CgogICAgICAgIC8vIGNoZWNrIHZhbHVlcwogICAgICAgIGlmICgkZnIgPiAkbHIgfHwgJGZjID4gJGxjKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCdOb3QgYSBjZWxsIHJhbmdlIGFkZHJlc3MnKTsKICAgICAgICB9CgogICAgICAgIC8vIGNvbHVtbiBpbmRleCB0byBsZXR0ZXIKICAgICAgICAkZmMgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGZjKTsKICAgICAgICAkbGMgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGxjKTsKCiAgICAgICAgaWYgKCRmciA9PSAkbHIgYW5kICRmYyA9PSAkbGMpIHsKICAgICAgICAgICAgcmV0dXJuICIkZmMkZnIiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gIiRmYyRmcjokbGMkbHIiOwogICAgfQoKCiAgICAvKioKICAgICAqIFJlYWRzIGEgY2VsbCByYW5nZSBhZGRyZXNzIGluIEJJRkY4IGUuZy4gJ0EyOkI2JyBvciAnQTEnCiAgICAgKiBhbHdheXMgZml4ZWQgcmFuZ2UKICAgICAqIHNlY3Rpb24gMi41LjE0CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3ViRGF0YQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRCSUZGOENlbGxSYW5nZUFkZHJlc3NGaXhlZCgkc3ViRGF0YSkKICAgIHsKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGluZGV4IHRvIGZpcnN0IHJvdwogICAgICAgICRmciA9IHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCAwKSArIDE7CgogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgaW5kZXggdG8gbGFzdCByb3cKICAgICAgICAkbHIgPSBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgMikgKyAxOwoKICAgICAgICAvLyBvZmZzZXQ6IDQ7IHNpemU6IDI7IGluZGV4IHRvIGZpcnN0IGNvbHVtbgogICAgICAgICRmYyA9IHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA0KTsKCiAgICAgICAgLy8gb2Zmc2V0OiA2OyBzaXplOiAyOyBpbmRleCB0byBsYXN0IGNvbHVtbgogICAgICAgICRsYyA9IHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA2KTsKCiAgICAgICAgLy8gY2hlY2sgdmFsdWVzCiAgICAgICAgaWYgKCRmciA+ICRsciB8fCAkZmMgPiAkbGMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJ05vdCBhIGNlbGwgcmFuZ2UgYWRkcmVzcycpOwogICAgICAgIH0KCiAgICAgICAgLy8gY29sdW1uIGluZGV4IHRvIGxldHRlcgogICAgICAgICRmYyA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkZmMpOwogICAgICAgICRsYyA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkbGMpOwoKICAgICAgICBpZiAoJGZyID09ICRsciBhbmQgJGZjID09ICRsYykgewogICAgICAgICAgICByZXR1cm4gIiRmYyRmciI7CiAgICAgICAgfQogICAgICAgIHJldHVybiAiJGZjJGZyOiRsYyRsciI7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgYSBjZWxsIHJhbmdlIGFkZHJlc3MgaW4gQklGRjggZS5nLiAnQTI6QjYnIG9yICckQSQyOiRCJDYnCiAgICAgKiB0aGVyZSBhcmUgZmxhZ3MgaW5kaWNhdGluZyB3aGV0aGVyIGNvbHVtbi9yb3cgaW5kZXggaXMgcmVsYXRpdmUKICAgICAqIHNlY3Rpb24gMy4zLjQKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJEYXRhCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRCSUZGOENlbGxSYW5nZUFkZHJlc3MoJHN1YkRhdGEpCiAgICB7CiAgICAgICAgLy8gdG9kbzogaWYgY2VsbCByYW5nZSBpcyBqdXN0IGEgc2luZ2xlIGNlbGwsIHNob3VsZCB0aGlzIGZ1bmNpdG9uCiAgICAgICAgLy8gbm90IGp1c3QgcmV0dXJuIGUuZy4gJ0ExJyBhbmQgbm90ICdBMTpBMScgPwoKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGluZGV4IHRvIGZpcnN0IHJvdyAoMC4uLiA2NTUzNSkgKG9yIG9mZnNldCAoLTMyNzY4Li4uIDMyNzY3KSkKICAgICAgICAgICAgJGZyID0gc2VsZjo6Z2V0SW50MmQoJHN1YkRhdGEsIDApICsgMTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAyOyBpbmRleCB0byBsYXN0IHJvdyAoMC4uLiA2NTUzNSkgKG9yIG9mZnNldCAoLTMyNzY4Li4uIDMyNzY3KSkKICAgICAgICAgICAgJGxyID0gc2VsZjo6Z2V0SW50MmQoJHN1YkRhdGEsIDIpICsgMTsKCiAgICAgICAgLy8gb2Zmc2V0OiA0OyBzaXplOiAyOyBpbmRleCB0byBmaXJzdCBjb2x1bW4gb3IgY29sdW1uIG9mZnNldCArIHJlbGF0aXZlIGZsYWdzCgogICAgICAgIC8vIGJpdDogNy0wOyBtYXNrIDB4MDBGRjsgY29sdW1uIGluZGV4CiAgICAgICAgJGZjID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KDB4MDBGRiAmIHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA0KSk7CgogICAgICAgIC8vIGJpdDogMTQ7IG1hc2sgMHg0MDAwOyAoMSA9IHJlbGF0aXZlIGNvbHVtbiBpbmRleCwgMCA9IGFic29sdXRlIGNvbHVtbiBpbmRleCkKICAgICAgICBpZiAoISgweDQwMDAgJiBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgNCkpKSB7CiAgICAgICAgICAgICRmYyA9ICckJyAuICRmYzsKICAgICAgICB9CgogICAgICAgIC8vIGJpdDogMTU7IG1hc2sgMHg4MDAwOyAoMSA9IHJlbGF0aXZlIHJvdyBpbmRleCwgMCA9IGFic29sdXRlIHJvdyBpbmRleCkKICAgICAgICBpZiAoISgweDgwMDAgJiBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgNCkpKSB7CiAgICAgICAgICAgICRmciA9ICckJyAuICRmcjsKICAgICAgICB9CgogICAgICAgIC8vIG9mZnNldDogNjsgc2l6ZTogMjsgaW5kZXggdG8gbGFzdCBjb2x1bW4gb3IgY29sdW1uIG9mZnNldCArIHJlbGF0aXZlIGZsYWdzCgogICAgICAgIC8vIGJpdDogNy0wOyBtYXNrIDB4MDBGRjsgY29sdW1uIGluZGV4CiAgICAgICAgJGxjID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KDB4MDBGRiAmIHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA2KSk7CgogICAgICAgIC8vIGJpdDogMTQ7IG1hc2sgMHg0MDAwOyAoMSA9IHJlbGF0aXZlIGNvbHVtbiBpbmRleCwgMCA9IGFic29sdXRlIGNvbHVtbiBpbmRleCkKICAgICAgICBpZiAoISgweDQwMDAgJiBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgNikpKSB7CiAgICAgICAgICAgICRsYyA9ICckJyAuICRsYzsKICAgICAgICB9CgogICAgICAgIC8vIGJpdDogMTU7IG1hc2sgMHg4MDAwOyAoMSA9IHJlbGF0aXZlIHJvdyBpbmRleCwgMCA9IGFic29sdXRlIHJvdyBpbmRleCkKICAgICAgICBpZiAoISgweDgwMDAgJiBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgNikpKSB7CiAgICAgICAgICAgICRsciA9ICckJyAuICRscjsKICAgICAgICB9CgogICAgICAgIHJldHVybiAiJGZjJGZyOiRsYyRsciI7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgYSBjZWxsIHJhbmdlIGFkZHJlc3MgaW4gQklGRjggZm9yIHNoYXJlZCBmb3JtdWxhcy4gVXNlcyBwb3NpdGl2ZSBhbmQgbmVnYXRpdmUgdmFsdWVzIGZvciByb3cgYW5kIGNvbHVtbgogICAgICogdG8gaW5kaWNhdGUgb2Zmc2V0cyBmcm9tIGEgYmFzZSBjZWxsCiAgICAgKiBzZWN0aW9uIDMuMy40CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3ViRGF0YQogICAgICogQHBhcmFtIHN0cmluZyAkYmFzZUNlbGwgQmFzZSBjZWxsCiAgICAgKiBAcmV0dXJuIHN0cmluZyBDZWxsIHJhbmdlIGFkZHJlc3MKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkQklGRjhDZWxsUmFuZ2VBZGRyZXNzQigkc3ViRGF0YSwgJGJhc2VDZWxsID0gJ0ExJykKICAgIHsKICAgICAgICBsaXN0KCRiYXNlQ29sLCAkYmFzZVJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkYmFzZUNlbGwpOwogICAgICAgICRiYXNlQ29sID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRiYXNlQ29sKSAtIDE7CgogICAgICAgIC8vIFRPRE86IGlmIGNlbGwgcmFuZ2UgaXMganVzdCBhIHNpbmdsZSBjZWxsLCBzaG91bGQgdGhpcyBmdW5jaXRvbgogICAgICAgIC8vIG5vdCBqdXN0IHJldHVybiBlLmcuICdBMScgYW5kIG5vdCAnQTE6QTEnID8KCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBmaXJzdCByb3cKICAgICAgICAkZnJJbmRleCA9IHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCAwKTsgLy8gYWRqdXN0IGJlbG93CgogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogMjsgcmVsYXRpdmUgaW5kZXggdG8gZmlyc3Qgcm93ICgwLi4uIDY1NTM1KSBzaG91bGQgYmUgdHJlYXRlZCBhcyBvZmZzZXQgKC0zMjc2OC4uLiAzMjc2NykKICAgICAgICAkbHJJbmRleCA9IHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCAyKTsgLy8gYWRqdXN0IGJlbG93CgogICAgICAgIC8vIG9mZnNldDogNDsgc2l6ZTogMjsgZmlyc3QgY29sdW1uIHdpdGggcmVsYXRpdmUvYWJzb2x1dGUgZmxhZ3MKCiAgICAgICAgLy8gYml0OiA3LTA7IG1hc2sgMHgwMEZGOyBjb2x1bW4gaW5kZXgKICAgICAgICAkZmNJbmRleCA9IDB4MDBGRiAmIHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA0KTsKCiAgICAgICAgLy8gYml0OiAxNDsgbWFzayAweDQwMDA7ICgxID0gcmVsYXRpdmUgY29sdW1uIGluZGV4LCAwID0gYWJzb2x1dGUgY29sdW1uIGluZGV4KQogICAgICAgIGlmICghKDB4NDAwMCAmIHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA0KSkpIHsKICAgICAgICAgICAgLy8gYWJzb2x1dGUgY29sdW1uIGluZGV4CiAgICAgICAgICAgICRmYyA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkZmNJbmRleCk7CiAgICAgICAgICAgICRmYyA9ICckJyAuICRmYzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjb2x1bW4gb2Zmc2V0CiAgICAgICAgICAgICRmY0luZGV4ID0gKCRmY0luZGV4IDw9IDEyNykgPyAkZmNJbmRleCA6ICRmY0luZGV4IC0gMjU2OwogICAgICAgICAgICAkZmMgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGJhc2VDb2wgKyAkZmNJbmRleCk7CiAgICAgICAgfQoKICAgICAgICAvLyBiaXQ6IDE1OyBtYXNrIDB4ODAwMDsgKDEgPSByZWxhdGl2ZSByb3cgaW5kZXgsIDAgPSBhYnNvbHV0ZSByb3cgaW5kZXgpCiAgICAgICAgaWYgKCEoMHg4MDAwICYgc2VsZjo6Z2V0SW50MmQoJHN1YkRhdGEsIDQpKSkgewogICAgICAgICAgICAvLyBhYnNvbHV0ZSByb3cgaW5kZXgKICAgICAgICAgICAgJGZyID0gJGZySW5kZXggKyAxOwogICAgICAgICAgICAkZnIgPSAnJCcgLiAkZnI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcm93IG9mZnNldAogICAgICAgICAgICAkZnJJbmRleCA9ICgkZnJJbmRleCA8PSAzMjc2NykgPyAkZnJJbmRleCA6ICRmckluZGV4IC0gNjU1MzY7CiAgICAgICAgICAgICRmciA9ICRiYXNlUm93ICsgJGZySW5kZXg7CiAgICAgICAgfQoKICAgICAgICAvLyBvZmZzZXQ6IDY7IHNpemU6IDI7IGxhc3QgY29sdW1uIHdpdGggcmVsYXRpdmUvYWJzb2x1dGUgZmxhZ3MKCiAgICAgICAgLy8gYml0OiA3LTA7IG1hc2sgMHgwMEZGOyBjb2x1bW4gaW5kZXgKICAgICAgICAkbGNJbmRleCA9IDB4MDBGRiAmIHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA2KTsKICAgICAgICAkbGNJbmRleCA9ICgkbGNJbmRleCA8PSAxMjcpID8gJGxjSW5kZXggOiAkbGNJbmRleCAtIDI1NjsKICAgICAgICAkbGMgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGJhc2VDb2wgKyAkbGNJbmRleCk7CgogICAgICAgIC8vIGJpdDogMTQ7IG1hc2sgMHg0MDAwOyAoMSA9IHJlbGF0aXZlIGNvbHVtbiBpbmRleCwgMCA9IGFic29sdXRlIGNvbHVtbiBpbmRleCkKICAgICAgICBpZiAoISgweDQwMDAgJiBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgNikpKSB7CiAgICAgICAgICAgIC8vIGFic29sdXRlIGNvbHVtbiBpbmRleAogICAgICAgICAgICAkbGMgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGxjSW5kZXgpOwogICAgICAgICAgICAkbGMgPSAnJCcgLiAkbGM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gY29sdW1uIG9mZnNldAogICAgICAgICAgICAkbGNJbmRleCA9ICgkbGNJbmRleCA8PSAxMjcpID8gJGxjSW5kZXggOiAkbGNJbmRleCAtIDI1NjsKICAgICAgICAgICAgJGxjID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRiYXNlQ29sICsgJGxjSW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgLy8gYml0OiAxNTsgbWFzayAweDgwMDA7ICgxID0gcmVsYXRpdmUgcm93IGluZGV4LCAwID0gYWJzb2x1dGUgcm93IGluZGV4KQogICAgICAgIGlmICghKDB4ODAwMCAmIHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCA2KSkpIHsKICAgICAgICAgICAgLy8gYWJzb2x1dGUgcm93IGluZGV4CiAgICAgICAgICAgICRsciA9ICRsckluZGV4ICsgMTsKICAgICAgICAgICAgJGxyID0gJyQnIC4gJGxyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHJvdyBvZmZzZXQKICAgICAgICAgICAgJGxySW5kZXggPSAoJGxySW5kZXggPD0gMzI3NjcpID8gJGxySW5kZXggOiAkbHJJbmRleCAtIDY1NTM2OwogICAgICAgICAgICAkbHIgPSAkYmFzZVJvdyArICRsckluZGV4OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICIkZmMkZnI6JGxjJGxyIjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIEJJRkY4IGNlbGwgcmFuZ2UgYWRkcmVzcyBsaXN0CiAgICAgKiBzZWN0aW9uIDIuNS4xNQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YkRhdGEKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkQklGRjhDZWxsUmFuZ2VBZGRyZXNzTGlzdCgkc3ViRGF0YSkKICAgIHsKICAgICAgICAkY2VsbFJhbmdlQWRkcmVzc2VzID0gYXJyYXkoKTsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplOiAyOyBudW1iZXIgb2YgdGhlIGZvbGxvd2luZyBjZWxsIHJhbmdlIGFkZHJlc3NlcwogICAgICAgICRubSA9IHNlbGY6OmdldEludDJkKCRzdWJEYXRhLCAwKTsKCiAgICAgICAgJG9mZnNldCA9IDI7CiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiA4ICogJG5tOyBsaXN0IG9mICRubSAoZml4ZWQpIGNlbGwgcmFuZ2UgYWRkcmVzc2VzCiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG5tOyArKyRpKSB7CiAgICAgICAgICAgICRjZWxsUmFuZ2VBZGRyZXNzZXNbXSA9ICR0aGlzLT5yZWFkQklGRjhDZWxsUmFuZ2VBZGRyZXNzRml4ZWQoc3Vic3RyKCRzdWJEYXRhLCAkb2Zmc2V0LCA4KSk7CiAgICAgICAgICAgICRvZmZzZXQgKz0gODsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgJ3NpemUnID0+IDIgKyA4ICogJG5tLAogICAgICAgICAgICAnY2VsbFJhbmdlQWRkcmVzc2VzJyA9PiAkY2VsbFJhbmdlQWRkcmVzc2VzLAogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBCSUZGNSBjZWxsIHJhbmdlIGFkZHJlc3MgbGlzdAogICAgICogc2VjdGlvbiAyLjUuMTUKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJEYXRhCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZEJJRkY1Q2VsbFJhbmdlQWRkcmVzc0xpc3QoJHN1YkRhdGEpCiAgICB7CiAgICAgICAgJGNlbGxSYW5nZUFkZHJlc3NlcyA9IGFycmF5KCk7CgogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMjsgbnVtYmVyIG9mIHRoZSBmb2xsb3dpbmcgY2VsbCByYW5nZSBhZGRyZXNzZXMKICAgICAgICAkbm0gPSBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgMCk7CgogICAgICAgICRvZmZzZXQgPSAyOwogICAgICAgIC8vIG9mZnNldDogMjsgc2l6ZTogNiAqICRubTsgbGlzdCBvZiAkbm0gKGZpeGVkKSBjZWxsIHJhbmdlIGFkZHJlc3NlcwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRubTsgKyskaSkgewogICAgICAgICAgICAkY2VsbFJhbmdlQWRkcmVzc2VzW10gPSAkdGhpcy0+cmVhZEJJRkY1Q2VsbFJhbmdlQWRkcmVzc0ZpeGVkKHN1YnN0cigkc3ViRGF0YSwgJG9mZnNldCwgNikpOwogICAgICAgICAgICAkb2Zmc2V0ICs9IDY7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgICdzaXplJyA9PiAyICsgNiAqICRubSwKICAgICAgICAgICAgJ2NlbGxSYW5nZUFkZHJlc3NlcycgPT4gJGNlbGxSYW5nZUFkZHJlc3NlcywKICAgICAgICApOwogICAgfQoKCiAgICAvKioKICAgICAqIEdldCBhIHNoZWV0IHJhbmdlIGxpa2UgU2hlZXQxOlNoZWV0MyBmcm9tIFJFRiBpbmRleAogICAgICogTm90ZTogSWYgdGhlcmUgaXMgb25seSBvbmUgc2hlZXQgaW4gdGhlIHJhbmdlLCBvbmUgZ2V0cyBlLmcgU2hlZXQxCiAgICAgKiBJdCBjYW4gYWxzbyBoYXBwZW4gdGhhdCB0aGUgUkVGIHN0cnVjdHVyZSB1c2VzIHRoZSAtMSAoRkZGRikgY29kZSB0byBpbmRpY2F0ZSBkZWxldGVkIHNoZWV0cywKICAgICAqIGluIHdoaWNoIGNhc2UgYW4gUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbiBpcyB0aHJvd24KICAgICAqCiAgICAgKiBAcGFyYW0gaW50ICRpbmRleAogICAgICogQHJldHVybiBzdHJpbmd8ZmFsc2UKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRTaGVldFJhbmdlQnlSZWZJbmRleCgkaW5kZXgpCiAgICB7CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5yZWZbJGluZGV4XSkpIHsKICAgICAgICAgICAgJHR5cGUgPSAkdGhpcy0+ZXh0ZXJuYWxCb29rc1skdGhpcy0+cmVmWyRpbmRleF1bJ2V4dGVybmFsQm9va0luZGV4J11dWyd0eXBlJ107CgogICAgICAgICAgICBzd2l0Y2ggKCR0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICdpbnRlcm5hbCc6CiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgd2UgaGF2ZSBhIGRlbGV0ZWQgM2QgcmVmZXJlbmNlCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5yZWZbJGluZGV4XVsnZmlyc3RTaGVldEluZGV4J10gPT0gMHhGRkZGIG9yICR0aGlzLT5yZWZbJGluZGV4XVsnbGFzdFNoZWV0SW5kZXgnXSA9PSAweEZGRkYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJ0RlbGV0ZWQgc2hlZXQgcmVmZXJlbmNlJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIG5vcm1hbCBzaGVldCByYW5nZSAoY29sbGFwc2VkIG9yIHVuY29sbGFwc2VkKQogICAgICAgICAgICAgICAgICAgICRmaXJzdFNoZWV0TmFtZSA9ICR0aGlzLT5zaGVldHNbJHRoaXMtPnJlZlskaW5kZXhdWydmaXJzdFNoZWV0SW5kZXgnXV1bJ25hbWUnXTsKICAgICAgICAgICAgICAgICAgICAkbGFzdFNoZWV0TmFtZSA9ICR0aGlzLT5zaGVldHNbJHRoaXMtPnJlZlskaW5kZXhdWydsYXN0U2hlZXRJbmRleCddXVsnbmFtZSddOwoKICAgICAgICAgICAgICAgICAgICBpZiAoJGZpcnN0U2hlZXROYW1lID09ICRsYXN0U2hlZXROYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbGxhcHNlZCBzaGVldCByYW5nZQogICAgICAgICAgICAgICAgICAgICAgICAkc2hlZXRSYW5nZSA9ICRmaXJzdFNoZWV0TmFtZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkc2hlZXRSYW5nZSA9ICIkZmlyc3RTaGVldE5hbWU6JGxhc3RTaGVldE5hbWUiOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gZXNjYXBlIHRoZSBzaW5nbGUtcXVvdGVzCiAgICAgICAgICAgICAgICAgICAgJHNoZWV0UmFuZ2UgPSBzdHJfcmVwbGFjZSgiJyIsICInJyIsICRzaGVldFJhbmdlKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIHNwZWNpYWwgY2hhcmFjdGVycywgd2UgbmVlZCB0byBlbmNsb3NlIHRoZSByYW5nZSBpbiBzaW5nbGUtcXVvdGVzCiAgICAgICAgICAgICAgICAgICAgLy8gdG9kbzogY2hlY2sgaWYgd2UgaGF2ZSBpZGVudGlmaWVkIHRoZSB3aG9sZSBzZXQgb2Ygc3BlY2lhbCBjaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICAgICAgLy8gaXQgc2VlbXMgdGhhdCB0aGUgZm9sbG93aW5nIGNoYXJhY3RlcnMgYXJlIG5vdCBhY2NlcHRlZCBmb3Igc2hlZXQgbmFtZXMKICAgICAgICAgICAgICAgICAgICAvLyBhbmQgd2UgbWF5IGFzc3VtZSB0aGF0IHRoZXkgYXJlIG5vdCBwcmVzZW50OiBbXSovOlw\/CiAgICAgICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goIi9bICFcIkAjwqMkJSZ7KCl9PD49Kyd8Xiw7LV0vIiwgJHNoZWV0UmFuZ2UpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzaGVldFJhbmdlID0gIickc2hlZXRSYW5nZSciOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzaGVldFJhbmdlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBleHRlcm5hbCBzaGVldCBzdXBwb3J0CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJ0V4Y2VsNSByZWFkZXIgb25seSBzdXBwb3J0cyBpbnRlcm5hbCBzaGVldHMgaW4gZm9tdWxhcycpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiByZWFkIEJJRkY4IGNvbnN0YW50IHZhbHVlIGFycmF5IGZyb20gYXJyYXkgZGF0YQogICAgICogcmV0dXJucyBlLmcuIGFycmF5KCd2YWx1ZScgPT4gJ3sxLDI7Myw0fScsICdzaXplJyA9PiA0MH0KICAgICAqIHNlY3Rpb24gMi41LjgKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhcnJheURhdGEKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gcmVhZEJJRkY4Q29uc3RhbnRBcnJheSgkYXJyYXlEYXRhKQogICAgewogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMTsgbnVtYmVyIG9mIGNvbHVtbnMgZGVjcmVhc2VkIGJ5IDEKICAgICAgICAkbmMgPSBvcmQoJGFycmF5RGF0YVswXSk7CgogICAgICAgIC8vIG9mZnNldDogMTsgc2l6ZTogMjsgbnVtYmVyIG9mIHJvd3MgZGVjcmVhc2VkIGJ5IDEKICAgICAgICAkbnIgPSBzZWxmOjpnZXRJbnQyZCgkYXJyYXlEYXRhLCAxKTsKICAgICAgICAkc2l6ZSA9IDM7IC8vIGluaXRpYWxpemUKICAgICAgICAkYXJyYXlEYXRhID0gc3Vic3RyKCRhcnJheURhdGEsIDMpOwoKICAgICAgICAvLyBvZmZzZXQ6IDM7IHNpemU6IHZhcjsgbGlzdCBvZiAoJG5jICsgMSkgKiAoJG5yICsgMSkgY29uc3RhbnQgdmFsdWVzCiAgICAgICAgJG1hdHJpeENodW5rcyA9IGFycmF5KCk7CiAgICAgICAgZm9yICgkciA9IDE7ICRyIDw9ICRuciArIDE7ICsrJHIpIHsKICAgICAgICAgICAgJGl0ZW1zID0gYXJyYXkoKTsKICAgICAgICAgICAgZm9yICgkYyA9IDE7ICRjIDw9ICRuYyArIDE7ICsrJGMpIHsKICAgICAgICAgICAgICAgICRjb25zdGFudCA9IHNlbGY6OnJlYWRCSUZGOENvbnN0YW50KCRhcnJheURhdGEpOwogICAgICAgICAgICAgICAgJGl0ZW1zW10gPSAkY29uc3RhbnRbJ3ZhbHVlJ107CiAgICAgICAgICAgICAgICAkYXJyYXlEYXRhID0gc3Vic3RyKCRhcnJheURhdGEsICRjb25zdGFudFsnc2l6ZSddKTsKICAgICAgICAgICAgICAgICRzaXplICs9ICRjb25zdGFudFsnc2l6ZSddOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRtYXRyaXhDaHVua3NbXSA9IGltcGxvZGUoJywnLCAkaXRlbXMpOyAvLyBsb29rcyBsaWtlIGUuZy4gJzEsImhlbGxvIicKICAgICAgICB9CiAgICAgICAgJG1hdHJpeCA9ICd7JyAuIGltcGxvZGUoJzsnLCAkbWF0cml4Q2h1bmtzKSAuICd9JzsKCiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICAndmFsdWUnID0+ICRtYXRyaXgsCiAgICAgICAgICAgICdzaXplJyA9PiAkc2l6ZSwKICAgICAgICApOwogICAgfQoKCiAgICAvKioKICAgICAqIHJlYWQgQklGRjggY29uc3RhbnQgdmFsdWUgd2hpY2ggbWF5IGJlICdFbXB0eSBWYWx1ZScsICdOdW1iZXInLCAnU3RyaW5nIFZhbHVlJywgJ0Jvb2xlYW4gVmFsdWUnLCAnRXJyb3IgVmFsdWUnCiAgICAgKiBzZWN0aW9uIDIuNS43CiAgICAgKiByZXR1cm5zIGUuZy4gYXJyYXkoJ3ZhbHVlJyA9PiAnNScsICdzaXplJyA9PiA5KQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHZhbHVlRGF0YQogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiByZWFkQklGRjhDb25zdGFudCgkdmFsdWVEYXRhKQogICAgewogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMTsgaWRlbnRpZmllciBmb3IgdHlwZSBvZiBjb25zdGFudAogICAgICAgICRpZGVudGlmaWVyID0gb3JkKCR2YWx1ZURhdGFbMF0pOwoKICAgICAgICBzd2l0Y2ggKCRpZGVudGlmaWVyKSB7CiAgICAgICAgICAgIGNhc2UgMHgwMDogLy8gZW1wdHkgY29uc3RhbnQgKHdoYXQgaXMgdGhpcz8pCiAgICAgICAgICAgICAgICAkdmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgICRzaXplID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4MDE6IC8vIG51bWJlcgogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiA4OyBJRUVFIDc1NCBmbG9hdGluZy1wb2ludCB2YWx1ZQogICAgICAgICAgICAgICAgJHZhbHVlID0gc2VsZjo6ZXh0cmFjdE51bWJlcihzdWJzdHIoJHZhbHVlRGF0YSwgMSwgOCkpOwogICAgICAgICAgICAgICAgJHNpemUgPSA5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwMjogLy8gc3RyaW5nIHZhbHVlCiAgICAgICAgICAgICAgICAvLyBvZmZzZXQ6IDE7IHNpemU6IHZhcjsgVW5pY29kZSBzdHJpbmcsIDE2LWJpdCBzdHJpbmcgbGVuZ3RoCiAgICAgICAgICAgICAgICAkc3RyaW5nID0gc2VsZjo6cmVhZFVuaWNvZGVTdHJpbmdMb25nKHN1YnN0cigkdmFsdWVEYXRhLCAxKSk7CiAgICAgICAgICAgICAgICAkdmFsdWUgPSAnIicgLiAkc3RyaW5nWyd2YWx1ZSddIC4gJyInOwogICAgICAgICAgICAgICAgJHNpemUgPSAxICsgJHN0cmluZ1snc2l6ZSddOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwNDogLy8gYm9vbGVhbgogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAxOyAwID0gRkFMU0UsIDEgPSBUUlVFCiAgICAgICAgICAgICAgICBpZiAob3JkKCR2YWx1ZURhdGFbMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gJ1RSVUUnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSAnRkFMU0UnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHNpemUgPSA5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgxMDogLy8gZXJyb3IgY29kZQogICAgICAgICAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAxOyBlcnJvciBjb2RlCiAgICAgICAgICAgICAgICAkdmFsdWUgPSBQSFBFeGNlbF9SZWFkZXJfRXhjZWw1X0Vycm9yQ29kZTo6bG9va3VwKG9yZCgkdmFsdWVEYXRhWzFdKSk7CiAgICAgICAgICAgICAgICAkc2l6ZSA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICAndmFsdWUnID0+ICR2YWx1ZSwKICAgICAgICAgICAgJ3NpemUnID0+ICRzaXplLAogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogRXh0cmFjdCBSR0IgY29sb3IKICAgICAqIE9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0IEV4Y2VsIEZpbGUgRm9ybWF0LCBzZWN0aW9uIDIuNS40CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcmdiIEVuY29kZWQgUkdCIHZhbHVlICg0IGJ5dGVzKQogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiByZWFkUkdCKCRyZ2IpCiAgICB7CiAgICAgICAgLy8gb2Zmc2V0OiAwOyBzaXplIDE7IFJlZCBjb21wb25lbnQKICAgICAgICAkciA9IG9yZCgkcmdiezB9KTsKCiAgICAgICAgLy8gb2Zmc2V0OiAxOyBzaXplOiAxOyBHcmVlbiBjb21wb25lbnQKICAgICAgICAkZyA9IG9yZCgkcmdiezF9KTsKCiAgICAgICAgLy8gb2Zmc2V0OiAyOyBzaXplOiAxOyBCbHVlIGNvbXBvbmVudAogICAgICAgICRiID0gb3JkKCRyZ2J7Mn0pOwoKICAgICAgICAvLyBIRVggbm90YXRpb24sIGUuZy4gJ0ZGMDBGQycKICAgICAgICAkcmdiID0gc3ByaW50ZignJTAyWCUwMlglMDJYJywgJHIsICRnLCAkYik7CgogICAgICAgIHJldHVybiBhcnJheSgncmdiJyA9PiAkcmdiKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkIGJ5dGUgc3RyaW5nICg4LWJpdCBzdHJpbmcgbGVuZ3RoKQogICAgICogT3Blbk9mZmljZSBkb2N1bWVudGF0aW9uOiAyLjUuMgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YkRhdGEKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiByZWFkQnl0ZVN0cmluZ1Nob3J0KCRzdWJEYXRhKQogICAgewogICAgICAgIC8vIG9mZnNldDogMDsgc2l6ZTogMTsgbGVuZ3RoIG9mIHRoZSBzdHJpbmcgKGNoYXJhY3RlciBjb3VudCkKICAgICAgICAkbG4gPSBvcmQoJHN1YkRhdGFbMF0pOwoKICAgICAgICAvLyBvZmZzZXQ6IDE6IHNpemU6IHZhcjsgY2hhcmFjdGVyIGFycmF5ICg4LWJpdCBjaGFyYWN0ZXJzKQogICAgICAgICR2YWx1ZSA9ICR0aGlzLT5kZWNvZGVDb2RlcGFnZShzdWJzdHIoJHN1YkRhdGEsIDEsICRsbikpOwoKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlLAogICAgICAgICAgICAnc2l6ZScgPT4gMSArICRsbiwgLy8gc2l6ZSBpbiBieXRlcyBvZiBkYXRhIHN0cnVjdHVyZQogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBieXRlIHN0cmluZyAoMTYtYml0IHN0cmluZyBsZW5ndGgpCiAgICAgKiBPcGVuT2ZmaWNlIGRvY3VtZW50YXRpb246IDIuNS4yCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3ViRGF0YQogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHJlYWRCeXRlU3RyaW5nTG9uZygkc3ViRGF0YSkKICAgIHsKICAgICAgICAvLyBvZmZzZXQ6IDA7IHNpemU6IDI7IGxlbmd0aCBvZiB0aGUgc3RyaW5nIChjaGFyYWN0ZXIgY291bnQpCiAgICAgICAgJGxuID0gc2VsZjo6Z2V0SW50MmQoJHN1YkRhdGEsIDApOwoKICAgICAgICAvLyBvZmZzZXQ6IDI6IHNpemU6IHZhcjsgY2hhcmFjdGVyIGFycmF5ICg4LWJpdCBjaGFyYWN0ZXJzKQogICAgICAgICR2YWx1ZSA9ICR0aGlzLT5kZWNvZGVDb2RlcGFnZShzdWJzdHIoJHN1YkRhdGEsIDIpKTsKCiAgICAgICAgLy9yZXR1cm4gJHN0cmluZzsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlLAogICAgICAgICAgICAnc2l6ZScgPT4gMiArICRsbiwgLy8gc2l6ZSBpbiBieXRlcyBvZiBkYXRhIHN0cnVjdHVyZQogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogRXh0cmFjdHMgYW4gRXhjZWwgVW5pY29kZSBzaG9ydCBzdHJpbmcgKDgtYml0IHN0cmluZyBsZW5ndGgpCiAgICAgKiBPcGVuT2ZmaWNlIGRvY3VtZW50YXRpb246IDIuNS4zCiAgICAgKiBmdW5jdGlvbiB3aWxsIGF1dG9tYXRpY2FsbHkgZmluZCBvdXQgd2hlcmUgdGhlIFVuaWNvZGUgc3RyaW5nIGVuZHMuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3ViRGF0YQogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiByZWFkVW5pY29kZVN0cmluZ1Nob3J0KCRzdWJEYXRhKQogICAgewogICAgICAgICR2YWx1ZSA9ICcnOwoKICAgICAgICAvLyBvZmZzZXQ6IDA6IHNpemU6IDE7IGxlbmd0aCBvZiB0aGUgc3RyaW5nIChjaGFyYWN0ZXIgY291bnQpCiAgICAgICAgJGNoYXJhY3RlckNvdW50ID0gb3JkKCRzdWJEYXRhWzBdKTsKCiAgICAgICAgJHN0cmluZyA9IHNlbGY6OnJlYWRVbmljb2RlU3RyaW5nKHN1YnN0cigkc3ViRGF0YSwgMSksICRjaGFyYWN0ZXJDb3VudCk7CgogICAgICAgIC8vIGFkZCAxIGZvciB0aGUgc3RyaW5nIGxlbmd0aAogICAgICAgICRzdHJpbmdbJ3NpemUnXSArPSAxOwoKICAgICAgICByZXR1cm4gJHN0cmluZzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBFeHRyYWN0cyBhbiBFeGNlbCBVbmljb2RlIGxvbmcgc3RyaW5nICgxNi1iaXQgc3RyaW5nIGxlbmd0aCkKICAgICAqIE9wZW5PZmZpY2UgZG9jdW1lbnRhdGlvbjogMi41LjMKICAgICAqIHRoaXMgZnVuY3Rpb24gaXMgdW5kZXIgY29uc3RydWN0aW9uLCBuZWVkcyB0byBzdXBwb3J0IHJpY2ggdGV4dCwgYW5kIEFzaWFuIHBob25ldGljIHNldHRpbmdzCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3ViRGF0YQogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiByZWFkVW5pY29kZVN0cmluZ0xvbmcoJHN1YkRhdGEpCiAgICB7CiAgICAgICAgJHZhbHVlID0gJyc7CgogICAgICAgIC8vIG9mZnNldDogMDogc2l6ZTogMjsgbGVuZ3RoIG9mIHRoZSBzdHJpbmcgKGNoYXJhY3RlciBjb3VudCkKICAgICAgICAkY2hhcmFjdGVyQ291bnQgPSBzZWxmOjpnZXRJbnQyZCgkc3ViRGF0YSwgMCk7CgogICAgICAgICRzdHJpbmcgPSBzZWxmOjpyZWFkVW5pY29kZVN0cmluZyhzdWJzdHIoJHN1YkRhdGEsIDIpLCAkY2hhcmFjdGVyQ291bnQpOwoKICAgICAgICAvLyBhZGQgMiBmb3IgdGhlIHN0cmluZyBsZW5ndGgKICAgICAgICAkc3RyaW5nWydzaXplJ10gKz0gMjsKCiAgICAgICAgcmV0dXJuICRzdHJpbmc7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZCBVbmljb2RlIHN0cmluZyB3aXRoIG5vIHN0cmluZyBsZW5ndGggZmllbGQsIGJ1dCB3aXRoIGtub3duIGNoYXJhY3RlciBjb3VudAogICAgICogdGhpcyBmdW5jdGlvbiBpcyB1bmRlciBjb25zdHJ1Y3Rpb24sIG5lZWRzIHRvIHN1cHBvcnQgcmljaCB0ZXh0LCBhbmQgQXNpYW4gcGhvbmV0aWMgc2V0dGluZ3MKICAgICAqIE9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0IEV4Y2VsIEZpbGUgRm9ybWF0LCBzZWN0aW9uIDIuNS4zCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3ViRGF0YQogICAgICogQHBhcmFtIGludCAkY2hhcmFjdGVyQ291bnQKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gcmVhZFVuaWNvZGVTdHJpbmcoJHN1YkRhdGEsICRjaGFyYWN0ZXJDb3VudCkKICAgIHsKICAgICAgICAkdmFsdWUgPSAnJzsKCiAgICAgICAgLy8gb2Zmc2V0OiAwOiBzaXplOiAxOyBvcHRpb24gZmxhZ3MKICAgICAgICAvLyBiaXQ6IDA7IG1hc2s6IDB4MDE7IGNoYXJhY3RlciBjb21wcmVzc2lvbiAoMCA9IGNvbXByZXNzZWQgOC1iaXQsIDEgPSB1bmNvbXByZXNzZWQgMTYtYml0KQogICAgICAgICRpc0NvbXByZXNzZWQgPSAhKCgweDAxICYgb3JkKCRzdWJEYXRhWzBdKSkgPj4gMCk7CgogICAgICAgIC8vIGJpdDogMjsgbWFzazogMHgwNDsgQXNpYW4gcGhvbmV0aWMgc2V0dGluZ3MKICAgICAgICAkaGFzQXNpYW4gPSAoMHgwNCkgJiBvcmQoJHN1YkRhdGFbMF0pID4+IDI7CgogICAgICAgIC8vIGJpdDogMzsgbWFzazogMHgwODsgUmljaC1UZXh0IHNldHRpbmdzCiAgICAgICAgJGhhc1JpY2hUZXh0ID0gKDB4MDgpICYgb3JkKCRzdWJEYXRhWzBdKSA+PiAzOwoKICAgICAgICAvLyBvZmZzZXQ6IDE6IHNpemU6IHZhcjsgY2hhcmFjdGVyIGFycmF5CiAgICAgICAgLy8gdGhpcyBvZmZzZXQgYXNzdW1lcyByaWNodGV4dCBhbmQgQXNpYW4gcGhvbmV0aWMgc2V0dGluZ3MgYXJlIG9mZiB3aGljaCBpcyBnZW5lcmFsbHkgd3JvbmcKICAgICAgICAvLyBuZWVkcyB0byBiZSBmaXhlZAogICAgICAgICR2YWx1ZSA9IHNlbGY6OmVuY29kZVVURjE2KHN1YnN0cigkc3ViRGF0YSwgMSwgJGlzQ29tcHJlc3NlZCA\/ICRjaGFyYWN0ZXJDb3VudCA6IDIgKiAkY2hhcmFjdGVyQ291bnQpLCAkaXNDb21wcmVzc2VkKTsKCiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICAndmFsdWUnID0+ICR2YWx1ZSwKICAgICAgICAgICAgJ3NpemUnID0+ICRpc0NvbXByZXNzZWQgPyAxICsgJGNoYXJhY3RlckNvdW50IDogMSArIDIgKiAkY2hhcmFjdGVyQ291bnQsIC8vIHRoZSBzaXplIGluIGJ5dGVzIGluY2x1ZGluZyB0aGUgb3B0aW9uIGZsYWdzCiAgICAgICAgKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBDb252ZXJ0IFVURi04IHN0cmluZyB0byBzdHJpbmcgc3Vyb3VuZGVkIGJ5IGRvdWJsZSBxdW90ZXMuIFVzZWQgZm9yIGV4cGxpY2l0IHN0cmluZyB0b2tlbnMgaW4gZm9ybXVsYXMuCiAgICAgKiBFeGFtcGxlOiAgaGVsbG8id29ybGQgIC0tPiAgImhlbGxvIiJ3b3JsZCIKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICR2YWx1ZSBVVEYtOCBlbmNvZGVkIHN0cmluZwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gVVRGOHRvRXhjZWxEb3VibGVRdW90ZWQoJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiAnIicgLiBzdHJfcmVwbGFjZSgnIicsICciIicsICR2YWx1ZSkgLiAnIic7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgZmlyc3QgOCBieXRlcyBvZiBhIHN0cmluZyBhbmQgcmV0dXJuIElFRUUgNzU0IGZsb2F0CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkZGF0YSBCaW5hcnkgc3RyaW5nIHRoYXQgaXMgYXQgbGVhc3QgOCBieXRlcyBsb25nCiAgICAgKiBAcmV0dXJuIGZsb2F0CiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGV4dHJhY3ROdW1iZXIoJGRhdGEpCiAgICB7CiAgICAgICAgJHJrbnVtaGlnaCA9IHNlbGY6OmdldEludDRkKCRkYXRhLCA0KTsKICAgICAgICAkcmtudW1sb3cgPSBzZWxmOjpnZXRJbnQ0ZCgkZGF0YSwgMCk7CiAgICAgICAgJHNpZ24gPSAoJHJrbnVtaGlnaCAmIDB4ODAwMDAwMDApID4+IDMxOwogICAgICAgICRleHAgPSAoKCRya251bWhpZ2ggJiAweDdmZjAwMDAwKSA+PiAyMCkgLSAxMDIzOwogICAgICAgICRtYW50aXNzYSA9ICgweDEwMDAwMCB8ICgkcmtudW1oaWdoICYgMHgwMDBmZmZmZikpOwogICAgICAgICRtYW50aXNzYWxvdzEgPSAoJHJrbnVtbG93ICYgMHg4MDAwMDAwMCkgPj4gMzE7CiAgICAgICAgJG1hbnRpc3NhbG93MiA9ICgkcmtudW1sb3cgJiAweDdmZmZmZmZmKTsKICAgICAgICAkdmFsdWUgPSAkbWFudGlzc2EgLyBwb3coMiwgKDIwIC0gJGV4cCkpOwoKICAgICAgICBpZiAoJG1hbnRpc3NhbG93MSAhPSAwKSB7CiAgICAgICAgICAgICR2YWx1ZSArPSAxIC8gcG93KDIsICgyMSAtICRleHApKTsKICAgICAgICB9CgogICAgICAgICR2YWx1ZSArPSAkbWFudGlzc2Fsb3cyIC8gcG93KDIsICg1MiAtICRleHApKTsKICAgICAgICBpZiAoJHNpZ24pIHsKICAgICAgICAgICAgJHZhbHVlICo9IC0xOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR2YWx1ZTsKICAgIH0KCgogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gZ2V0SUVFRTc1NCgkcmtudW0pCiAgICB7CiAgICAgICAgaWYgKCgkcmtudW0gJiAweDAyKSAhPSAwKSB7CiAgICAgICAgICAgICR2YWx1ZSA9ICRya251bSA+PiAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGNoYW5nZXMgYnkgbW1wLCBpbmZvIG9uIElFRUU3NTQgZW5jb2RpbmcgZnJvbQogICAgICAgICAgICAvLyByZXNlYXJjaC5taWNyb3NvZnQuY29tL35ob2xsYXNjaC9jZ2luZGV4L2NvZGluZy9pZWVlZmxvYXQuaHRtbAogICAgICAgICAgICAvLyBUaGUgUksgZm9ybWF0IGNhbGxzIGZvciB1c2luZyBvbmx5IHRoZSBtb3N0IHNpZ25pZmljYW50IDMwIGJpdHMKICAgICAgICAgICAgLy8gb2YgdGhlIDY0IGJpdCBmbG9hdGluZyBwb2ludCB2YWx1ZS4gVGhlIG90aGVyIDM0IGJpdHMgYXJlIGFzc3VtZWQKICAgICAgICAgICAgLy8gdG8gYmUgMCBzbyB3ZSB1c2UgdGhlIHVwcGVyIDMwIGJpdHMgb2YgJHJrbnVtIGFzIGZvbGxvd3MuLi4KICAgICAgICAgICAgJHNpZ24gPSAoJHJrbnVtICYgMHg4MDAwMDAwMCkgPj4gMzE7CiAgICAgICAgICAgICRleHAgPSAoJHJrbnVtICYgMHg3ZmYwMDAwMCkgPj4gMjA7CiAgICAgICAgICAgICRtYW50aXNzYSA9ICgweDEwMDAwMCB8ICgkcmtudW0gJiAweDAwMGZmZmZjKSk7CiAgICAgICAgICAgICR2YWx1ZSA9ICRtYW50aXNzYSAvIHBvdygyLCAoMjAtICgkZXhwIC0gMTAyMykpKTsKICAgICAgICAgICAgaWYgKCRzaWduKSB7CiAgICAgICAgICAgICAgICAkdmFsdWUgPSAtMSAqICR2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2VuZCBvZiBjaGFuZ2VzIGJ5IG1tcAogICAgICAgIH0KICAgICAgICBpZiAoKCRya251bSAmIDB4MDEpICE9IDApIHsKICAgICAgICAgICAgJHZhbHVlIC89IDEwMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR2YWx1ZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBHZXQgVVRGLTggc3RyaW5nIGZyb20gKGNvbXByZXNzZWQgb3IgdW5jb21wcmVzc2VkKSBVVEYtMTYgc3RyaW5nCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nCiAgICAgKiBAcGFyYW0gYm9vbCAkY29tcHJlc3NlZAogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gZW5jb2RlVVRGMTYoJHN0cmluZywgJGNvbXByZXNzZWQgPSAnJykKICAgIHsKICAgICAgICBpZiAoJGNvbXByZXNzZWQpIHsKICAgICAgICAgICAgJHN0cmluZyA9IHNlbGY6OnVuY29tcHJlc3NCeXRlU3RyaW5nKCRzdHJpbmcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkNvbnZlcnRFbmNvZGluZygkc3RyaW5nLCAnVVRGLTgnLCAnVVRGLTE2TEUnKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlcnQgVVRGLTE2IHN0cmluZyBpbiBjb21wcmVzc2VkIG5vdGF0aW9uIHRvIHVuY29tcHJlc3NlZCBmb3JtLiBPbmx5IHVzZWQgZm9yIEJJRkY4LgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZwogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gdW5jb21wcmVzc0J5dGVTdHJpbmcoJHN0cmluZykKICAgIHsKICAgICAgICAkdW5jb21wcmVzc2VkU3RyaW5nID0gJyc7CiAgICAgICAgJHN0ckxlbiA9IHN0cmxlbigkc3RyaW5nKTsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkc3RyTGVuOyArKyRpKSB7CiAgICAgICAgICAgICR1bmNvbXByZXNzZWRTdHJpbmcgLj0gJHN0cmluZ1skaV0gLiAiXDAiOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR1bmNvbXByZXNzZWRTdHJpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHN0cmluZyB0byBVVEYtOC4gT25seSB1c2VkIGZvciBCSUZGNS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZGVjb2RlQ29kZXBhZ2UoJHN0cmluZykKICAgIHsKICAgICAgICByZXR1cm4gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q29udmVydEVuY29kaW5nKCRzdHJpbmcsICdVVEYtOCcsICR0aGlzLT5jb2RlcGFnZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIDE2LWJpdCB1bnNpZ25lZCBpbnRlZ2VyCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkZGF0YQogICAgICogQHBhcmFtIGludCAkcG9zCiAgICAgKiBAcmV0dXJuIGludAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldEludDJkKCRkYXRhLCAkcG9zKQogICAgewogICAgICAgIHJldHVybiBvcmQoJGRhdGFbJHBvc10pIHwgKG9yZCgkZGF0YVskcG9zKzFdKSA8PCA4KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQgMzItYml0IHNpZ25lZCBpbnRlZ2VyCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkZGF0YQogICAgICogQHBhcmFtIGludCAkcG9zCiAgICAgKiBAcmV0dXJuIGludAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldEludDRkKCRkYXRhLCAkcG9zKQogICAgewogICAgICAgIC8vIEZJWDogcmVwcmVzZW50IG51bWJlcnMgY29ycmVjdGx5IG9uIDY0LWJpdCBzeXN0ZW0KICAgICAgICAvLyBodHRwOi8vc291cmNlZm9yZ2UubmV0L3RyYWNrZXIvaW5kZXgucGhwP2Z1bmM9ZGV0YWlsJmFpZD0xNDg3MzcyJmdyb3VwX2lkPTk5MTYwJmF0aWQ9NjIzMzM0CiAgICAgICAgLy8gSGFja2VkIGJ5IEFuZHJlYXMgUmVobSAyMDA2IHRvIGVuc3VyZSBjb3JyZWN0IHJlc3VsdCBvZiB0aGUgPDwyNCBibG9jayBvbiAzMiBhbmQgNjRiaXQgc3lzdGVtcwogICAgICAgICRfb3JfMjQgPSBvcmQoJGRhdGFbJHBvcyArIDNdKTsKICAgICAgICBpZiAoJF9vcl8yNCA+PSAxMjgpIHsKICAgICAgICAgICAgLy8gbmVnYXRpdmUgbnVtYmVyCiAgICAgICAgICAgICRfb3JkXzI0ID0gLWFicygoMjU2IC0gJF9vcl8yNCkgPDwgMjQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRfb3JkXzI0ID0gKCRfb3JfMjQgJiAxMjcpIDw8IDI0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gb3JkKCRkYXRhWyRwb3NdKSB8IChvcmQoJGRhdGFbJHBvcysxXSkgPDwgOCkgfCAob3JkKCRkYXRhWyRwb3MrMl0pIDw8IDE2KSB8ICRfb3JkXzI0OwogICAgfQoKICAgIHByaXZhdGUgZnVuY3Rpb24gcGFyc2VSaWNoVGV4dCgkaXMgPSAnJykKICAgIHsKICAgICAgICAkdmFsdWUgPSBuZXcgUEhQRXhjZWxfUmljaFRleHQoKTsKICAgICAgICAkdmFsdWUtPmNyZWF0ZVRleHQoJGlzKTsKCiAgICAgICAgcmV0dXJuICR2YWx1ZTsKICAgIH0KfQo=",
    "size": "292640"
}