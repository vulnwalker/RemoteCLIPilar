{
    "namaFile": "lib\/jpgraph\/gd_image.inc.php",
    "lastUpdate": "2013-12-16+17:17:15.00",
    "contentFile": "PD9waHAKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBGaWxlOiAgICAgICAgR0RfSU1BR0UuSU5DLlBIUAovLyBEZXNjcmlwdGlvbjogUEhQIEdyYXBoIFBsb3R0aW5nIGxpYnJhcnkuIExvdyBsZXZlbCBpbWFnZSBkcmF3aW5nIHJvdXRpbmVzCi8vIENyZWF0ZWQ6ICAgICAyMDAxLTAxLTA4LCByZWZhY3RvcmVkIDIwMDgtMDMtMjkKLy8gVmVyOiAgICAgICAgICRJZDogZ2RfaW1hZ2UuaW5jLnBocCAxOTIyIDIwMTAtMDEtMTEgMTE6NDI6NTBaIGxqcCAkCi8vCi8vIENvcHlyaWdodCAoYykgQXNpYWwgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpyZXF1aXJlX29uY2UgJ2pwZ3JhcGhfcmdiLmluYy5waHAnOwpyZXF1aXJlX29uY2UgJ2pwZ3JhcGhfdHRmLmluYy5waHAnOwpyZXF1aXJlX29uY2UgJ2ltYWdlU21vb3RoQXJjLnBocCc7CgovLyBMaW5lIHN0eWxlcwpkZWZpbmUoJ0xJTkVTVFlMRV9TT0xJRCcsMSk7CmRlZmluZSgnTElORVNUWUxFX0RPVFRFRCcsMik7CmRlZmluZSgnTElORVNUWUxFX0RBU0hFRCcsMyk7CmRlZmluZSgnTElORVNUWUxFX0xPTkdEQVNIJyw0KTsKCi8vIFRoZSBERUZBVUxUX0dGT1JNQVQgc2V0cyB0aGUgZGVmYXVsdCBncmFwaGljIGVuY29kaW5nIGZvcm1hdCwgaS5lLgovLyBQTkcsIEpQRyBvciBHSUYgZGVwZW5kaW5nIG9uIHdoYXQgaXMgaW5zdGFsbGVkIG9uIHRoZSB0YXJnZXQgc3lzdGVtCi8vIGluIHRoYXQgb3JkZXIuCmlmKCAhREVGSU5FRCgiREVGQVVMVF9HRk9STUFUIikgKSB7CiAgICBkZWZpbmUoIkRFRkFVTFRfR0ZPUk1BVCIsImF1dG8iKTsKfQoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ0xBU1MgSW1hZ2UKLy8gRGVzY3JpcHRpb246IFRoZSB2ZXJ5IGNvb3IgaW1hZ2UgZHJhd2luZyBjbGFzcyB0aGF0IGVuY2Fwc3VsYXRlcyBhbGwKLy8gICAgICAgICAgICAgIGNhbGxzIHRvIHRoZSBHRCBsaWJyYXJ5Ci8vICAgICAgICAgICAgICBOb3RlOiBUaGUgY2xhc3MgdXNlZCBieSB0aGUgbGlicmFyeSBpcyB0aGUgZGVjZW5kYW50Ci8vICAgICAgICAgICAgICBjbGFzcyBSb3RJbWFnZSB3aGljaCBleHRlbmRzIHRoZSBJbWFnZSBjbGFzcyB3aXRoIHRyYW5zcGFyZW50Ci8vICAgICAgICAgICAgICByb3RhdGlvbi4KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIEltYWdlIHsKICAgIHB1YmxpYyAkaW1nPW51bGw7CiAgICBwdWJsaWMgJHJnYj1udWxsOwogICAgcHVibGljICRpbWdfZm9ybWF0OwogICAgcHVibGljICR0dGY9bnVsbDsKICAgIHB1YmxpYyAkbGluZV9zdHlsZT1MSU5FU1RZTEVfU09MSUQ7CiAgICBwdWJsaWMgJGN1cnJlbnRfY29sb3IsJGN1cnJlbnRfY29sb3JfbmFtZTsKICAgIHB1YmxpYyAkb3JpZ2luYWxfd2lkdGg9MCwgJG9yaWdpbmFsX2hlaWdodD0wOwogICAgcHVibGljICRwbG90d2lkdGg9MCwkcGxvdGhlaWdodD0wOwoKICAgIC8vIGZvciBfX2dldCwgX19zZXQKICAgIHByaXZhdGUgJF9sZWZ0X21hcmdpbj0zMCwkX3JpZ2h0X21hcmdpbj0zMCwkX3RvcF9tYXJnaW49MjAsJF9ib3R0b21fbWFyZ2luPTMwOwogICAgLy9wcml2YXRlICRfcGxvdHdpZHRoPTAsJF9wbG90aGVpZ2h0PTA7CiAgICBwcml2YXRlICRfd2lkdGg9MCwgJF9oZWlnaHQ9MDsKICAgIHByaXZhdGUgJF9saW5lX3dlaWdodD0xOwoKICAgIHByb3RlY3RlZCAkZXhwaXJlZD10cnVlOwogICAgcHJvdGVjdGVkICRsYXN0eD0wLCAkbGFzdHk9MDsKICAgIHByb3RlY3RlZCAkb2JzX2xpc3Q9YXJyYXkoKTsKICAgIHByb3RlY3RlZCAkZm9udF9zaXplPTEyLCRmb250X2ZhbWlseT1GRl9ERUZBVUxULCAkZm9udF9zdHlsZT1GU19OT1JNQUw7CiAgICBwcm90ZWN0ZWQgJGZvbnRfZmlsZT0nJzsKICAgIHByb3RlY3RlZCAkdGV4dF9oYWxpZ249ImxlZnQiLCR0ZXh0X3ZhbGlnbj0iYm90dG9tIjsKICAgIHByb3RlY3RlZCAkdXNlX2FudGlfYWxpYXNpbmc9ZmFsc2U7CiAgICBwcm90ZWN0ZWQgJHF1YWxpdHk9bnVsbDsKICAgIHByb3RlY3RlZCAkY29sb3JzdGFjaz1hcnJheSgpLCRjb2xvcnN0YWNraWR4PTA7CiAgICBwcm90ZWN0ZWQgJGNhbnZhc2NvbG9yID0gJ3doaXRlJyA7CiAgICBwcm90ZWN0ZWQgJGxhbmdjb252ID0gbnVsbCA7CiAgICBwcm90ZWN0ZWQgJGlJbnRlcmxhY2U9ZmFsc2U7CiAgICBwcm90ZWN0ZWQgJGJib3hfY2FjaGUgPSBhcnJheSgpOyAvLyBTVG9yZSB0aGUgbGFzdCBmb3VuZCB0ZXR4IGJvdW5kaW5nIGJveAogICAgcHJvdGVjdGVkICRmZl9mb250MDsKICAgIHByb3RlY3RlZCAkZmZfZm9udDBfYm9sZDsKICAgIHByb3RlY3RlZCAkZmZfZm9udDE7CiAgICBwcm90ZWN0ZWQgJGZmX2ZvbnQxX2JvbGQ7CiAgICBwcm90ZWN0ZWQgJGZmX2ZvbnQyOwogICAgcHJvdGVjdGVkICRmZl9mb250Ml9ib2xkOwoKCiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ09OU1RSVUNUT1IKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRhV2lkdGg9MCwkYUhlaWdodD0wLCRhRm9ybWF0PURFRkFVTFRfR0ZPUk1BVCwkYVNldEF1dG9NYXJnaW49dHJ1ZSkgewoKICAgICAgICAkdGhpcy0+b3JpZ2luYWxfd2lkdGggID0gJGFXaWR0aDsKICAgICAgICAkdGhpcy0+b3JpZ2luYWxfaGVpZ2h0ID0gJGFIZWlnaHQ7CiAgICAgICAgJHRoaXMtPkNyZWF0ZUltZ0NhbnZhcygkYVdpZHRoLCAkYUhlaWdodCk7CgogICAgICAgIGlmKCAkYVNldEF1dG9NYXJnaW4gKSB7CiAgICAgICAgICAgICR0aGlzLT5TZXRBdXRvTWFyZ2luKCk7CiAgICAgICAgfQoKICAgICAgICBpZiggISR0aGlzLT5TZXRJbWdGb3JtYXQoJGFGb3JtYXQpICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA4MSwkYUZvcm1hdCk7Ly8oIkpwR3JhcGg6IFNlbGVjdGVkIGdyYXBoaWMgZm9ybWF0IGlzIGVpdGhlciBub3Qgc3VwcG9ydGVkIG9yIHVua25vd24gWyRhRm9ybWF0XSIpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+dHRmID0gbmV3IFRURigpOwogICAgICAgICR0aGlzLT5sYW5nY29udiA9IG5ldyBMYW5ndWFnZUNvbnYoKTsKCiAgICAgICAgJHRoaXMtPmZmX2ZvbnQwID0gIGltYWdlbG9hZGZvbnQoZGlybmFtZShfX0ZJTEVfXykgLiAiL2ZvbnRzL0ZGX0ZPTlQwLmdkZiIpOwogICAgICAgICR0aGlzLT5mZl9mb250MSA9ICBpbWFnZWxvYWRmb250KGRpcm5hbWUoX19GSUxFX18pIC4gIi9mb250cy9GRl9GT05UMS5nZGYiKTsKICAgICAgICAkdGhpcy0+ZmZfZm9udDIgPSAgaW1hZ2Vsb2FkZm9udChkaXJuYW1lKF9fRklMRV9fKSAuICIvZm9udHMvRkZfRk9OVDIuZ2RmIik7CiAgICAgICAgJHRoaXMtPmZmX2ZvbnQxX2JvbGQgPSAgaW1hZ2Vsb2FkZm9udChkaXJuYW1lKF9fRklMRV9fKSAuICIvZm9udHMvRkZfRk9OVDEtQm9sZC5nZGYiKTsKICAgICAgICAkdGhpcy0+ZmZfZm9udDJfYm9sZCA9ICBpbWFnZWxvYWRmb250KGRpcm5hbWUoX19GSUxFX18pIC4gIi9mb250cy9GRl9GT05UMi1Cb2xkLmdkZiIpOwogICAgfQoKICAgIC8vIEVuYWJsZSBpbnRlcmxhY2luZyBpbiBpbWFnZXMKICAgIGZ1bmN0aW9uIFNldEludGVybGFjZSgkYUZsZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmlJbnRlcmxhY2U9JGFGbGc7CiAgICB9CgogICAgLy8gU2hvdWxkIHdlIHVzZSBhbnRpLWFsaWFzaW5nLiBOb3RlOiBUaGlzIHJlYWxseSBzbG93cyBkb3duIGdyYXBoaWNzIQogICAgZnVuY3Rpb24gU2V0QW50aUFsaWFzaW5nKCRhRmxnPXRydWUpIHsKICAgICAgICAkdGhpcy0+dXNlX2FudGlfYWxpYXNpbmcgPSAkYUZsZzsKICAgICAgICBpZiggZnVuY3Rpb25fZXhpc3RzKCdpbWFnZWFudGlhbGlhcycpICkgewogICAgICAgICAgICBpbWFnZWFudGlhbGlhcygkdGhpcy0+aW1nLCRhRmxnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTI4KTsvLygnVGhlIGZ1bmN0aW9uIGltYWdlYW50aWFsaWFzKCkgaXMgbm90IGF2YWlsYWJsZSBpbiB5b3VyIFBIUCBpbnN0YWxsYXRpb24uIFVzZSB0aGUgR0QgdmVyc2lvbiB0aGF0IGNvbWVzIHdpdGggUEhQIGFuZCBub3QgdGhlIHN0YW5kYWxvbmUgdmVyc2lvbi4nKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBHZXRBbnRpQWxpYXNpbmcoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT51c2VfYW50aV9hbGlhc2luZyA7CiAgICB9CgogICAgZnVuY3Rpb24gQ3JlYXRlUmF3Q2FudmFzKCRhV2lkdGg9MCwkYUhlaWdodD0wKSB7CgogICAgICAgICRhV2lkdGggICo9IFNVUEVSU0FNUExJTkdfU0NBTEU7CiAgICAgICAgJGFIZWlnaHQgKj0gU1VQRVJTQU1QTElOR19TQ0FMRTsKCiAgICAgICAgaWYoICRhV2lkdGggPD0gMSB8fCAkYUhlaWdodCA8PSAxICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA4MiwkYVdpZHRoLCRhSGVpZ2h0KTsvLygiSWxsZWdhbCBzaXplcyBzcGVjaWZpZWQgZm9yIHdpZHRoIG9yIGhlaWdodCB3aGVuIGNyZWF0aW5nIGFuIGltYWdlLCAod2lkdGg9JGFXaWR0aCwgaGVpZ2h0PSRhSGVpZ2h0KSIpOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmltZyA9IEBpbWFnZWNyZWF0ZXRydWVjb2xvcigkYVdpZHRoLCAkYUhlaWdodCk7CiAgICAgICAgaWYoICR0aGlzLT5pbWcgPCAxICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEyNik7CiAgICAgICAgICAgIC8vZGllKCJDYW4ndCBjcmVhdGUgdHJ1ZWNvbG9yIGltYWdlLiBDaGVjayB0aGF0IHlvdSByZWFsbHkgaGF2ZSBHRDIgbGlicmFyeSBpbnN0YWxsZWQuIik7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5TZXRBbHBoYUJsZW5kaW5nKCk7CgogICAgICAgIGlmKCAkdGhpcy0+aUludGVybGFjZSApIHsKICAgICAgICAgICAgaW1hZ2VpbnRlcmxhY2UoJHRoaXMtPmltZywxKTsKICAgICAgICB9CiAgICAgICAgaWYoICR0aGlzLT5yZ2IgIT0gbnVsbCApIHsKICAgICAgICAgICAgJHRoaXMtPnJnYi0+aW1nID0gJHRoaXMtPmltZyA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+cmdiID0gbmV3IFJHQigkdGhpcy0+aW1nKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQ2xvbmVDYW52YXNIKCkgewogICAgICAgICRvbGRpbWFnZSA9ICR0aGlzLT5pbWc7CiAgICAgICAgJHRoaXMtPkNyZWF0ZVJhd0NhbnZhcygkdGhpcy0+d2lkdGgsJHRoaXMtPmhlaWdodCk7CiAgICAgICAgaW1hZ2Vjb3B5KCR0aGlzLT5pbWcsJG9sZGltYWdlLDAsMCwwLDAsJHRoaXMtPndpZHRoLCR0aGlzLT5oZWlnaHQpOwogICAgICAgIHJldHVybiAkb2xkaW1hZ2U7CiAgICB9CgogICAgZnVuY3Rpb24gQ3JlYXRlSW1nQ2FudmFzKCRhV2lkdGg9MCwkYUhlaWdodD0wKSB7CgogICAgICAgICRvbGQgPSBhcnJheSgkdGhpcy0+aW1nLCR0aGlzLT53aWR0aCwkdGhpcy0+aGVpZ2h0KTsKCiAgICAgICAgJGFXaWR0aCA9IHJvdW5kKCRhV2lkdGgpOwogICAgICAgICRhSGVpZ2h0ID0gcm91bmQoJGFIZWlnaHQpOwoKICAgICAgICAkdGhpcy0+d2lkdGg9JGFXaWR0aDsKICAgICAgICAkdGhpcy0+aGVpZ2h0PSRhSGVpZ2h0OwoKCiAgICAgICAgaWYoICRhV2lkdGg9PTAgfHwgJGFIZWlnaHQ9PTAgKSB7CiAgICAgICAgICAgIC8vIFdlIHdpbGwgc2V0IHRoZSBmaW5hbCBzaXplIGxhdGVyLgogICAgICAgICAgICAvLyBOb3RlOiBUaGUgc2l6ZSBtdXN0IGJlIHNwZWNpZmllZCBiZWZvcmUgYW55IG90aGVyCiAgICAgICAgICAgIC8vIGltZyByb3V0aW5lcyB0aGF0IHN0cm9rZSBhbnl0aGluZyBhcmUgY2FsbGVkLgogICAgICAgICAgICAkdGhpcy0+aW1nID0gbnVsbDsKICAgICAgICAgICAgJHRoaXMtPnJnYiA9IG51bGw7CiAgICAgICAgICAgIHJldHVybiAkb2xkOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPkNyZWF0ZVJhd0NhbnZhcygkYVdpZHRoLCRhSGVpZ2h0KTsKICAgICAgICAvLyBTZXQgY2FudmFzIGNvbG9yICh3aWxsIGFsc28gYmUgdGhlIGJhY2tncm91bmQgY29sb3IgZm9yIGEKICAgICAgICAvLyBhIHBhbGxldHQgaW1hZ2UKICAgICAgICAkdGhpcy0+U2V0Q29sb3IoJHRoaXMtPmNhbnZhc2NvbG9yKTsKICAgICAgICAkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKDAsMCwkdGhpcy0+d2lkdGgtMSwkdGhpcy0+aGVpZ2h0LTEpOwoKICAgICAgICByZXR1cm4gJG9sZCA7CiAgICB9CgogICAgZnVuY3Rpb24gQ29weUNhbnZhc0goJGFUb0hkbCwkYUZyb21IZGwsJGFUb1gsJGFUb1ksJGFGcm9tWCwkYUZyb21ZLCRhV2lkdGgsJGFIZWlnaHQsJGF3PS0xLCRhaD0tMSkgewogICAgICAgIGlmKCAkYXcgPT09IC0xICkgewogICAgICAgICAgICAkYXcgPSAkYVdpZHRoOwogICAgICAgICAgICAkYWggPSAkYUhlaWdodDsKICAgICAgICAgICAgJGYgPSAnaW1hZ2Vjb3B5cmVzaXplZCc7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkZiA9ICdpbWFnZWNvcHlyZXNhbXBsZWQnOwogICAgICAgIH0KICAgICAgICAkZigkYVRvSGRsLCRhRnJvbUhkbCwkYVRvWCwkYVRvWSwkYUZyb21YLCRhRnJvbVksICRhV2lkdGgsJGFIZWlnaHQsJGF3LCRhaCk7CiAgICB9CgogICAgZnVuY3Rpb24gQ29weSgkZnJvbUltZywkdG9YLCR0b1ksJGZyb21YLCRmcm9tWSwkdG9XaWR0aCwkdG9IZWlnaHQsJGZyb21XaWR0aD0tMSwkZnJvbUhlaWdodD0tMSkgewogICAgICAgICR0aGlzLT5Db3B5Q2FudmFzSCgkdGhpcy0+aW1nLCRmcm9tSW1nLCR0b1gsJHRvWSwkZnJvbVgsJGZyb21ZLCR0b1dpZHRoLCR0b0hlaWdodCwkZnJvbVdpZHRoLCRmcm9tSGVpZ2h0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBDb3B5TWVyZ2UoJGZyb21JbWcsJHRvWCwkdG9ZLCRmcm9tWCwkZnJvbVksJHRvV2lkdGgsJHRvSGVpZ2h0LCRmcm9tV2lkdGg9LTEsJGZyb21IZWlnaHQ9LTEsJGFNaXg9MTAwKSB7CiAgICAgICAgaWYoICRhTWl4ID09IDEwMCApIHsKICAgICAgICAgICAgJHRoaXMtPkNvcHlDYW52YXNIKCR0aGlzLT5pbWcsJGZyb21JbWcsCiAgICAgICAgICAgICR0b1gsJHRvWSwkZnJvbVgsJGZyb21ZLCR0b1dpZHRoLCR0b0hlaWdodCwkZnJvbVdpZHRoLCRmcm9tSGVpZ2h0KTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCAoJGZyb21XaWR0aCAgIT0gLTEgJiYgKCRmcm9tV2lkdGggIT0gJHRvV2lkdGgpKSB8fCAoJGZyb21IZWlnaHQgIT0gLTEgJiYgKCRmcm9tSGVpZ2h0ICE9ICRmcm9tSGVpZ2h0KSkgKSB7CiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBuZXcgY2FudmFzIHRoYXQgd2lsbCBob2xkIHRoZSByZS1zY2FsZWQgb3JpZ2luYWwgZnJvbSBpbWFnZQogICAgICAgICAgICAgICAgaWYoICR0b1dpZHRoIDw9IDEgfHwgJHRvSGVpZ2h0IDw9IDEgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwODMpOy8vKCdJbGxlZ2FsIGltYWdlIHNpemUgd2hlbiBjb3B5aW5nIGltYWdlLiBTaXplIGZvciBjb3BpZWQgdG8gaW1hZ2UgaXMgMSBwaXhlbCBvciBsZXNzLicpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR0bXBpbWcgPSBAaW1hZ2VjcmVhdGV0cnVlY29sb3IoJHRvV2lkdGgsICR0b0hlaWdodCk7CgogICAgICAgICAgICAgICAgaWYoICR0bXBpbWcgPCAxICkgewogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDg0KTsvLygnRmFpbGVkIHRvIGNyZWF0ZSB0ZW1wb3JhcnkgR0QgY2FudmFzLiBPdXQgb2YgbWVtb3J5ID8nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5Db3B5Q2FudmFzSCgkdG1waW1nLCRmcm9tSW1nLDAsMCwwLDAsCiAgICAgICAgICAgICAgICAkdG9XaWR0aCwkdG9IZWlnaHQsJGZyb21XaWR0aCwkZnJvbUhlaWdodCk7CiAgICAgICAgICAgICAgICAkZnJvbUltZyA9ICR0bXBpbWc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW1hZ2Vjb3B5bWVyZ2UoJHRoaXMtPmltZywkZnJvbUltZywkdG9YLCR0b1ksJGZyb21YLCRmcm9tWSwkdG9XaWR0aCwkdG9IZWlnaHQsJGFNaXgpOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgZnVuY3Rpb24gR2V0V2lkdGgoJGFJbWc9bnVsbCkgewogICAgICAgIGlmKCAkYUltZyA9PT0gbnVsbCApIHsKICAgICAgICAgICAgJGFJbWcgPSAkdGhpcy0+aW1nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW1hZ2VzeCgkYUltZyk7CiAgICB9CgogICAgc3RhdGljIGZ1bmN0aW9uIEdldEhlaWdodCgkYUltZz1udWxsKSB7CiAgICAgICAgaWYoICRhSW1nID09PSBudWxsICkgewogICAgICAgICAgICAkYUltZyA9ICR0aGlzLT5pbWc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbWFnZXN5KCRhSW1nKTsKICAgIH0KCiAgICBzdGF0aWMgZnVuY3Rpb24gQ3JlYXRlRnJvbVN0cmluZygkYVN0cikgewogICAgICAgICRpbWcgPSBpbWFnZWNyZWF0ZWZyb21zdHJpbmcoJGFTdHIpOwogICAgICAgIGlmKCAkaW1nID09PSBmYWxzZSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwODUpOwogICAgICAgICAgICAvLygnQW4gaW1hZ2UgY2FuIG5vdCBiZSBjcmVhdGVkIGZyb20gdGhlIHN1cHBsaWVkIHN0cmluZy4gSXQgaXMgZWl0aGVyIGluIGEgZm9ybWF0IG5vdCBzdXBwb3J0ZWQgb3IgdGhlIHN0cmluZyBpcyByZXByZXNlbnRpbmcgYW4gY29ycnVwdCBpbWFnZS4nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRpbWc7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Q2FudmFzSCgkYUhkbCkgewogICAgICAgICR0aGlzLT5pbWcgPSAkYUhkbDsKICAgICAgICAkdGhpcy0+cmdiLT5pbWcgPSAkYUhkbDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDYW52YXNDb2xvcigkYUNvbG9yKSB7CiAgICAgICAgJHRoaXMtPmNhbnZhc2NvbG9yID0gJGFDb2xvciA7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0QWxwaGFCbGVuZGluZygkYUZsZz10cnVlKSB7CiAgICAgICAgSW1hZ2VBbHBoYUJsZW5kaW5nKCR0aGlzLT5pbWcsJGFGbGcpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEF1dG9NYXJnaW4oKSB7CiAgICAgICAgJG1pbl9ibT01OwogICAgICAgICRsbSA9IG1pbig0MCwkdGhpcy0+d2lkdGgvNyk7CiAgICAgICAgJHJtID0gbWluKDIwLCR0aGlzLT53aWR0aC8xMCk7CiAgICAgICAgJHRtID0gbWF4KDUsJHRoaXMtPmhlaWdodC83KTsKICAgICAgICAkYm0gPSBtYXgoJG1pbl9ibSwkdGhpcy0+aGVpZ2h0LzYpOwogICAgICAgICR0aGlzLT5TZXRNYXJnaW4oJGxtLCRybSwkdG0sJGJtKTsKICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBTZXRGb250KCRmYW1pbHksJHN0eWxlPUZTX05PUk1BTCwkc2l6ZT0xMCkgewogICAgICAgICR0aGlzLT5mb250X2ZhbWlseT0kZmFtaWx5OwogICAgICAgICR0aGlzLT5mb250X3N0eWxlPSRzdHlsZTsKICAgICAgICAkdGhpcy0+Zm9udF9zaXplPSRzaXplKlNVUEVSU0FNUExJTkdfU0NBTEU7CiAgICAgICAgJHRoaXMtPmZvbnRfZmlsZT0nJzsKICAgICAgICBpZiggKCR0aGlzLT5mb250X2ZhbWlseT09RkZfRk9OVDEgfHwgJHRoaXMtPmZvbnRfZmFtaWx5PT1GRl9GT05UMikgJiYgJHRoaXMtPmZvbnRfc3R5bGU9PUZTX0JPTEQgKXsKICAgICAgICAgICAgKyskdGhpcy0+Zm9udF9mYW1pbHk7CiAgICAgICAgfQogICAgICAgIGlmKCAkdGhpcy0+Zm9udF9mYW1pbHkgPiBGRl9GT05UMisxICkgeyAvLyBBIFRURiBmb250IHNvIGdldCB0aGUgZm9udCBmaWxlCgogICAgICAgICAgICAvLyBDaGVjayB0aGF0IHRoaXMgUEhQIGhhcyBzdXBwb3J0IGZvciBUVEYgZm9udHMKICAgICAgICAgICAgaWYoICFmdW5jdGlvbl9leGlzdHMoJ2ltYWdldHRmYmJveCcpICkgewogICAgICAgICAgICAgICAgLy8gdXNlIGludGVybmFsIGZvbnQgd2hlbiBwaHAgaXMgY29uZmlndXJlZCB3aXRob3V0ICctLXdpdGgtdHRmJwogICAgICAgICAgICAgICAgJHRoaXMtPmZvbnRfZmFtaWx5ID0gRkZfRk9OVDE7Ci8vICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDg3KTsvLygnVGhpcyBQSFAgYnVpbGQgaGFzIG5vdCBiZWVuIGNvbmZpZ3VyZWQgd2l0aCBUVEYgc3VwcG9ydC4gWW91IG5lZWQgdG8gcmVjb21waWxlIHlvdXIgUEhQIGluc3RhbGxhdGlvbiB3aXRoIEZyZWVUeXBlIHN1cHBvcnQuJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+Zm9udF9maWxlID0gJHRoaXMtPnR0Zi0+RmlsZSgkdGhpcy0+Zm9udF9mYW1pbHksJHRoaXMtPmZvbnRfc3R5bGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIEdldCB0aGUgc3BlY2lmaWMgaGVpZ2h0IGZvciBhIHRleHQgc3RyaW5nCiAgICBmdW5jdGlvbiBHZXRUZXh0SGVpZ2h0KCR0eHQ9IiIsJGFuZ2xlPTApIHsKICAgICAgICAkdG1wID0gcHJlZ19zcGxpdCgnL1xuLycsJHR4dCk7CiAgICAgICAgJG4gPSBjb3VudCgkdG1wKTsKICAgICAgICAkbT0wOwogICAgICAgIGZvcigkaT0wOyAkaTwgJG47ICsrJGkpIHsKICAgICAgICAgICAgJG0gPSBtYXgoJG0sc3RybGVuKCR0bXBbJGldKSk7CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPmZvbnRfZmFtaWx5IDw9IEZGX0ZPTlQyKzEgKSB7CiAgICAgICAgICAgIGlmKCAkYW5nbGU9PTAgKSB7CiAgICAgICAgICAgICAgICAkaCA9IGltYWdlZm9udGhlaWdodCgkdGhpcy0+Zm9udF9mYW1pbHkpOwogICAgICAgICAgICAgICAgaWYoICRoID09PSBmYWxzZSApIHsKICAgICAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA4OCk7Ly8oJ1lvdSBoYXZlIGEgbWlzY29uZmlndXJlZCBHRCBmb250IHN1cHBvcnQuIFRoZSBjYWxsIHRvIGltYWdlZm9udHdpZHRoKCkgZmFpbHMuJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuICRuKiRoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHcgPSBAaW1hZ2Vmb250d2lkdGgoJHRoaXMtPmZvbnRfZmFtaWx5KTsKICAgICAgICAgICAgICAgIGlmKCAkdyA9PT0gZmFsc2UgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwODgpOy8vKCdZb3UgaGF2ZSBhIG1pc2NvbmZpZ3VyZWQgR0QgZm9udCBzdXBwb3J0LiBUaGUgY2FsbCB0byBpbWFnZWZvbnR3aWR0aCgpIGZhaWxzLicpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiAkbSokdzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJGJib3ggPSAkdGhpcy0+R2V0VFRGQkJveCgkdHh0LCRhbmdsZSk7CiAgICAgICAgICAgIHJldHVybiAkYmJveFsxXS0kYmJveFs1XSsxOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBFc3RpbWF0ZSBmb250IGhlaWdodAogICAgZnVuY3Rpb24gR2V0Rm9udEhlaWdodCgkYW5nbGU9MCkgewogICAgICAgICR0eHQgPSAiWE9NZyI7CiAgICAgICAgcmV0dXJuICR0aGlzLT5HZXRUZXh0SGVpZ2h0KCR0eHQsJGFuZ2xlKTsKICAgIH0KCiAgICAvLyBBcHByb3hpbWF0ZSBmb250IHdpZHRoIHdpdGggd2lkdGggb2YgbGV0dGVyICJPIgogICAgZnVuY3Rpb24gR2V0Rm9udFdpZHRoKCRhbmdsZT0wKSB7CiAgICAgICAgJHR4dCA9ICdPJzsKICAgICAgICByZXR1cm4gJHRoaXMtPkdldFRleHRXaWR0aCgkdHh0LCRhbmdsZSk7CiAgICB9CgogICAgLy8gR2V0IGFjdHVhbCB3aWR0aCBvZiB0ZXh0IGluIGFic29sdXRlIHBpeGVscy4gTm90ZSB0aGF0IHRoZSB3aWR0aCBpcyB0aGUKICAgIC8vIHRleHRzIHByb2plY3RlZCB3aXRoIG9udG8gdGhlIHgtYXhpcy4gQ2FsbCB3aXRoIGFuZ2xlPTAgdG8gZ2V0IHRoZSB0cnVlCiAgICAvLyBldHh0IHdpZHRoLgogICAgZnVuY3Rpb24gR2V0VGV4dFdpZHRoKCR0eHQsJGFuZ2xlPTApIHsKCiAgICAgICAgJHRtcCA9IHByZWdfc3BsaXQoJy9cbi8nLCR0eHQpOwogICAgICAgICRuID0gY291bnQoJHRtcCk7CiAgICAgICAgaWYoICR0aGlzLT5mb250X2ZhbWlseSA8PSBGRl9GT05UMisxICkgewoKICAgICAgICAgICAgJG09MDsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG47ICsrJGkpIHsKICAgICAgICAgICAgICAgICRsPXN0cmxlbigkdG1wWyRpXSk7CiAgICAgICAgICAgICAgICBpZiggJGwgPiAkbSApIHsKICAgICAgICAgICAgICAgICAgICAkbSA9ICRsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiggJGFuZ2xlPT0wICkgewogICAgICAgICAgICAgICAgJHcgPSBAaW1hZ2Vmb250d2lkdGgoJHRoaXMtPmZvbnRfZmFtaWx5KTsKICAgICAgICAgICAgICAgIGlmKCAkdyA9PT0gZmFsc2UgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwODgpOy8vKCdZb3UgaGF2ZSBhIG1pc2NvbmZpZ3VyZWQgR0QgZm9udCBzdXBwb3J0LiBUaGUgY2FsbCB0byBpbWFnZWZvbnR3aWR0aCgpIGZhaWxzLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICRtKiR3OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gOTAgZGVncmVlcyBpbnRlcm5hbCBzbyBoZWlnaHQgYmVjb21lcyB3aWR0aAogICAgICAgICAgICAgICAgJGggPSBAaW1hZ2Vmb250aGVpZ2h0KCR0aGlzLT5mb250X2ZhbWlseSk7CiAgICAgICAgICAgICAgICBpZiggJGggPT09IGZhbHNlICkgewogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDg5KTsvLygnWW91IGhhdmUgYSBtaXNjb25maWd1cmVkIEdEIGZvbnQgc3VwcG9ydC4gVGhlIGNhbGwgdG8gaW1hZ2Vmb250aGVpZ2h0KCkgZmFpbHMuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJG4qJGg7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIEZvciBUVEYgZm9udHMgd2UgbXVzdCB3YWxrIHRocm91Z2ggYSBsaW5lcyBhbmQgZmluZCB0aGUKICAgICAgICAgICAgLy8gd2lkZXN0IG9uZSB3aGljaCB3ZSB1c2UgYXMgdGhlIHdpZHRoIG9mIHRoZSBtdWx0aS1saW5lCiAgICAgICAgICAgIC8vIHBhcmFncmFwaAogICAgICAgICAgICAkbT0wOwogICAgICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAkYmJveCA9ICR0aGlzLT5HZXRUVEZCQm94KCR0bXBbJGldLCRhbmdsZSk7CiAgICAgICAgICAgICAgICAkbW0gPSAgJGJib3hbMl0gLSAkYmJveFswXTsKICAgICAgICAgICAgICAgIGlmKCAkbW0gPiAkbSApCiAgICAgICAgICAgICAgICAgICAgJG0gPSAkbW07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRtOwogICAgICAgIH0KICAgIH0KCgogICAgLy8gRHJhdyB0ZXh0IHdpdGggYSBib3ggYXJvdW5kIGl0CiAgICBmdW5jdGlvbiBTdHJva2VCb3hlZFRleHQoJHgsJHksJHR4dCwkZGlyPTAsJGZjb2xvcj0id2hpdGUiLCRiY29sb3I9ImJsYWNrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhZG93Y29sb3I9ZmFsc2UsJHBhcmFncmFwaF9hbGlnbj0ibGVmdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHhtYXJnPTYsJHltYXJnPTQsJGNvcm5lcnJhZGl1cz0wLCRkcm9wd2lkdGg9MykgewoKCQkkb2xkeCA9ICR0aGlzLT5sYXN0eDsKCQkkb2xkeSA9ICR0aGlzLT5sYXN0eTsKCiAgICAgICAgaWYoICFpc19udW1lcmljKCRkaXIpICkgewogICAgICAgICAgICBpZiggJGRpcj09ImgiICkgJGRpcj0wOwogICAgICAgICAgICBlbHNlaWYoICRkaXI9PSJ2IiApICRkaXI9OTA7CiAgICAgICAgICAgIGVsc2UgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwOTAsJGRpcik7Ly8oIiBVbmtub3duIGRpcmVjdGlvbiBzcGVjaWZpZWQgaW4gY2FsbCB0byBTdHJva2VCb3hlZFRleHQoKSBbJGRpcl0iKTsKICAgICAgICB9CgogICAgICAgIGlmKCAkdGhpcy0+Zm9udF9mYW1pbHkgPj0gRkZfRk9OVDAgJiYgJHRoaXMtPmZvbnRfZmFtaWx5IDw9IEZGX0ZPTlQyKzEpIHsKICAgICAgICAgICAgJHdpZHRoPSR0aGlzLT5HZXRUZXh0V2lkdGgoJHR4dCwkZGlyKSA7CiAgICAgICAgICAgICRoZWlnaHQ9JHRoaXMtPkdldFRleHRIZWlnaHQoJHR4dCwkZGlyKSA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkd2lkdGg9JHRoaXMtPkdldEJCb3hXaWR0aCgkdHh0LCRkaXIpIDsKICAgICAgICAgICAgJGhlaWdodD0kdGhpcy0+R2V0QkJveEhlaWdodCgkdHh0LCRkaXIpIDsKICAgICAgICB9CgogICAgICAgICRoZWlnaHQgKz0gMiokeW1hcmc7CiAgICAgICAgJHdpZHRoICArPSAyKiR4bWFyZzsKCiAgICAgICAgaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09InJpZ2h0IiApICAgICAgJHggLT0gJHdpZHRoOwogICAgICAgIGVsc2VpZiggJHRoaXMtPnRleHRfaGFsaWduPT0iY2VudGVyIiApICR4IC09ICR3aWR0aC8yOwoKICAgICAgICBpZiggJHRoaXMtPnRleHRfdmFsaWduPT0iYm90dG9tIiApICAgICAkeSAtPSAkaGVpZ2h0OwogICAgICAgIGVsc2VpZiggJHRoaXMtPnRleHRfdmFsaWduPT0iY2VudGVyIiApICR5IC09ICRoZWlnaHQvMjsKCiAgICAgICAgJG9sZGEgPSAkdGhpcy0+U2V0QW5nbGUoMCk7CgogICAgICAgIGlmKCAkc2hhZG93Y29sb3IgKSB7CiAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJHNoYWRvd2NvbG9yKTsKICAgICAgICAgICAgJHRoaXMtPkZpbGxlZFJvdW5kZWRSZWN0YW5nbGUoJHgtJHhtYXJnKyRkcm9wd2lkdGgsJHktJHltYXJnKyRkcm9wd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR4KyR3aWR0aCskZHJvcHdpZHRoLCR5KyRoZWlnaHQtJHltYXJnKyRkcm9wd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb3JuZXJyYWRpdXMpOwogICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgJHRoaXMtPlB1c2hDb2xvcigkZmNvbG9yKTsKICAgICAgICAgICAgJHRoaXMtPkZpbGxlZFJvdW5kZWRSZWN0YW5nbGUoJHgtJHhtYXJnLCR5LSR5bWFyZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHgrJHdpZHRoLCR5KyRoZWlnaHQtJHltYXJnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29ybmVycmFkaXVzKTsKICAgICAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CiAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJGJjb2xvcik7CiAgICAgICAgICAgICR0aGlzLT5Sb3VuZGVkUmVjdGFuZ2xlKCR4LSR4bWFyZywkeS0keW1hcmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR4KyR3aWR0aCwkeSskaGVpZ2h0LSR5bWFyZywkY29ybmVycmFkaXVzKTsKICAgICAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiggJGZjb2xvciApIHsKICAgICAgICAgICAgICAgICRvYz0kdGhpcy0+Y3VycmVudF9jb2xvcjsKICAgICAgICAgICAgICAgICR0aGlzLT5TZXRDb2xvcigkZmNvbG9yKTsKICAgICAgICAgICAgICAgICR0aGlzLT5GaWxsZWRSb3VuZGVkUmVjdGFuZ2xlKCR4LSR4bWFyZywkeS0keW1hcmcsJHgrJHdpZHRoLCR5KyRoZWlnaHQtJHltYXJnLCRjb3JuZXJyYWRpdXMpOwogICAgICAgICAgICAgICAgJHRoaXMtPmN1cnJlbnRfY29sb3I9JG9jOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAkYmNvbG9yICkgewogICAgICAgICAgICAgICAgJG9jPSR0aGlzLT5jdXJyZW50X2NvbG9yOwogICAgICAgICAgICAgICAgJHRoaXMtPlNldENvbG9yKCRiY29sb3IpOwogICAgICAgICAgICAgICAgJHRoaXMtPlJvdW5kZWRSZWN0YW5nbGUoJHgtJHhtYXJnLCR5LSR5bWFyZywkeCskd2lkdGgsJHkrJGhlaWdodC0keW1hcmcsJGNvcm5lcnJhZGl1cyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+Y3VycmVudF9jb2xvcj0kb2M7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRoPSR0aGlzLT50ZXh0X2hhbGlnbjsKICAgICAgICAkdj0kdGhpcy0+dGV4dF92YWxpZ247CiAgICAgICAgJHRoaXMtPlNldFRleHRBbGlnbigibGVmdCIsInRvcCIpOwoKICAgICAgICAkZGVidWc9ZmFsc2U7CiAgICAgICAgJHRoaXMtPlN0cm9rZVRleHQoJHgsICR5LCAkdHh0LCAkZGlyLCAkcGFyYWdyYXBoX2FsaWduLCRkZWJ1Zyk7CgogICAgICAgICRiYiA9IGFycmF5KCR4LSR4bWFyZywkeSskaGVpZ2h0LSR5bWFyZywkeCskd2lkdGgsJHkrJGhlaWdodC0keW1hcmcsCiAgICAgICAgICAgICAgICAgICAgJHgrJHdpZHRoLCR5LSR5bWFyZywkeC0keG1hcmcsJHktJHltYXJnKTsKICAgICAgICAkdGhpcy0+U2V0VGV4dEFsaWduKCRoLCR2KTsKCiAgICAgICAgJHRoaXMtPlNldEFuZ2xlKCRvbGRhKTsKCQkkdGhpcy0+bGFzdHggPSAkb2xkeDsKCQkkdGhpcy0+bGFzdHkgPSAkb2xkeTsKCiAgICAgICAgcmV0dXJuICRiYjsKICAgIH0KCiAgICAvLyBEcmF3IHRleHQgd2l0aCBhIGJveCBhcm91bmQgaXQuIFRoaXMgdGltZSB0aGUgYm94IHdpbGwgYmUgcm90YXRlZAogICAgLy8gd2l0aCB0aGUgdGV4dC4gVGhlIHByZXZpb3VzIG1ldGhvZCB3aWxsIGp1c3QgbWFrZSBhIGxhcmdlciBlbm91Z2ggbm9uLXJvdGF0ZWQKICAgIC8vIGJveCB0byBob2xkIHRoZSB0ZXh0IGluc2lkZS4KICAgIGZ1bmN0aW9uIFN0cm9rZUJveGVkVGV4dDIoJHgsJHksJHR4dCwkZGlyPTAsJGZjb2xvcj0id2hpdGUiLCRiY29sb3I9ImJsYWNrIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhZG93Y29sb3I9ZmFsc2UsJHBhcmFncmFwaF9hbGlnbj0ibGVmdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHhtYXJnPTYsJHltYXJnPTQsJGNvcm5lcnJhZGl1cz0wLCRkcm9wd2lkdGg9MykgewoKICAgICAgIC8vIFRoaXMgdmVyc2lvbiBvZiBib3hlZCB0ZXh0IHdpbGwgc3Ryb2tlIGEgcm90YXRlZCBib3ggcm91bmQgdGhlIHRleHQKICAgICAgIC8vIHRodGEgd2lsbCBmb2xsb3cgdGhlIGFuZ2xlIG9mIHRoZSB0ZXh0LgogICAgICAgLy8gVGhpcyBoYXMgdHdvIGltcGxpY2F0aW9uczoKICAgICAgIC8vIDEpIFRoaXMgbWV0aG9zIHdpbGwgb25seSBzdXBwb3J0IFRURiBmb250cwogICAgICAgLy8gMikgVGhlIG9ubHkgdHdvIGFsaWdubWVudCB0aGF0IG1ha2VzIHNlbnNlIGFyZSBjZW50ZXJlZCBvciBiYXNlbGluZWQKCiAgICAgICBpZiggJHRoaXMtPmZvbnRfZmFtaWx5IDw9IEZGX0ZPTlQyKzEgKSB7CiAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMzEpOy8vU3Ryb2tlQm94ZWRUZXh0MigpIE9ubHkgc3VwcG9ydCBUVEYgZm9udHMgYW5kIG5vdCBidWlsdCBpbiBiaXRtYXAgZm9udHMKICAgICAgIH0KCgkJJG9sZHggPSAkdGhpcy0+bGFzdHg7CgkJJG9sZHkgPSAkdGhpcy0+bGFzdHk7CiAgICAgICAgJGRpciA9ICR0aGlzLT5Ob3JtQW5nbGUoJGRpcik7CgogICAgICAgIGlmKCAhaXNfbnVtZXJpYygkZGlyKSApIHsKICAgICAgICAgICAgaWYoICRkaXI9PSJoIiApICRkaXI9MDsKICAgICAgICAgICAgZWxzZWlmKCAkZGlyPT0idiIgKSAkZGlyPTkwOwogICAgICAgICAgICBlbHNlIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDkwLCRkaXIpOy8vKCIgVW5rbm93biBkaXJlY3Rpb24gc3BlY2lmaWVkIGluIGNhbGwgdG8gU3Ryb2tlQm94ZWRUZXh0KCkgWyRkaXJdIik7CiAgICAgICAgfQoKICAgICAgICAkd2lkdGg9JHRoaXMtPkdldFRleHRXaWR0aCgkdHh0LDApICsgMiokeG1hcmc7CiAgICAgICAgJGhlaWdodD0kdGhpcy0+R2V0VGV4dEhlaWdodCgkdHh0LDApICsgMiokeW1hcmcgOwogICAgICAgICRyZWN0X3dpZHRoPSR0aGlzLT5HZXRCQm94V2lkdGgoJHR4dCwkZGlyKSA7CiAgICAgICAgJHJlY3RfaGVpZ2h0PSR0aGlzLT5HZXRCQm94SGVpZ2h0KCR0eHQsJGRpcikgOwoKICAgICAgICAkYmFzZWxpbmVfb2Zmc2V0ID0gJHRoaXMtPmJib3hfY2FjaGVbMV0tMTsKCiAgICAgICAgaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09ImNlbnRlciIgKSB7CiAgICAgICAgICAgIGlmKCAkZGlyID49IDAgJiYgJGRpciA8PSA5MCApIHsKCiAgICAgICAgICAgICAgICAkeCAtPSAkcmVjdF93aWR0aC8yOwogICAgICAgICAgICAgICAgJHggKz0gc2luKCRkaXIqTV9QSS8xODApKiRoZWlnaHQ7CiAgICAgICAgICAgICAgICAkeSArPSAkcmVjdF9oZWlnaHQvMjsgICAgICAgICAgICAgICAgCgogICAgICAgICAgICB9IGVsc2VpZiggJGRpciA+PSAyNzAgJiYgJGRpciA8PSAzNjAgKSB7CgogICAgICAgICAgICAgICAgJHggLT0gJHJlY3Rfd2lkdGgvMjsKICAgICAgICAgICAgICAgICR5IC09ICRyZWN0X2hlaWdodC8yOwogICAgICAgICAgICAgICAgJHkgKz0gY29zKCRkaXIqTV9QSS8xODApKiRoZWlnaHQ7CgogICAgICAgICAgICB9IGVsc2VpZiggJGRpciA+PSA5MCAmJiAkZGlyIDw9IDE4MCApIHsKCiAgICAgICAgICAgICAgICAkeCArPSAkcmVjdF93aWR0aC8yOwogICAgICAgICAgICAgICAgJHkgKz0gJHJlY3RfaGVpZ2h0LzI7CiAgICAgICAgICAgICAgICAkeSArPSBjb3MoJGRpcipNX1BJLzE4MCkqJGhlaWdodDsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAkZGlyID4gMTgwICYmICAkZGlyIDwgMjcwCiAgICAgICAgICAgICAgICAkeCArPSAkcmVjdF93aWR0aC8yOwogICAgICAgICAgICAgICAgJHggKz0gc2luKCRkaXIqTV9QSS8xODApKiRoZWlnaHQ7CiAgICAgICAgICAgICAgICAkeSAtPSAkcmVjdF9oZWlnaHQvMjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUm90YXRlIHRoZSBib3ggYXJvdW5kIHRoaXMgcG9pbnQKICAgICAgICAkdGhpcy0+U2V0Q2VudGVyKCR4LCR5KTsKICAgICAgICAkb2xkYSA9ICR0aGlzLT5TZXRBbmdsZSgtJGRpcik7CgogICAgICAgIC8vIFdlIG5lZWQgdG8gdXNlIGFkanVzdGVkIGNvb3JkaW5hdHMgZm9yIHRoZSBib3ggdG8gYmUgYWJsZQogICAgICAgIC8vIHRvIGRyYXcgdGhlIGJveCBiZWxvdyB0aGUgYmFzZWxpbmUuIFRoaXMgY2Fubm90IGJlIGRvbmUgYmVmb3JlIHNpbmNlCiAgICAgICAgLy8gdGhlIHJvdGF0aW5nIHBvaW50IG11c3QgYmUgdGhlIG9yaWdpbmFsIHgseSBzaW5jZSB0aGF0IGlzIGFyb3VuYmYgdGhlCiAgICAgICAgLy8gcG9pbnQgd2hlcmUgdGhlIHRleHQgd2lsbCByb3RhdGUgYW5kIHdlIGNhbm5vdCBjaGFuZ2UgdGhpcyBzaW5jZQogICAgICAgIC8vIHRoYXQgaXMgd2hlcmUgdGhlIEdEL0dyZWVUeXBlIHdpbGwgcm90YXRlIHRoZSB0ZXh0CgoKICAgICAgICAvLyBGb3Igc21hbGxlciA8MTRwdCBmb250IHdlIG5lZWQgdG8gZG8gc29tZSBhZGRpdGlvbmFsCiAgICAgICAgLy8gYWRqdXN0bWVudHMgdG8gbWFrZSBpdCBsb29rIGdvb2QKICAgICAgICBpZiggJHRoaXMtPmZvbnRfc2l6ZSA8IDE0ICkgewogICAgICAgICAgICAkeCAtPSAyOwogICAgICAgICAgICAkeSArPSAyOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIC8vICAkeSArPSAkYmFzZWxpbmVfb2Zmc2V0OwogICAgICAgIH0KCiAgICAgICAgaWYoICRzaGFkb3djb2xvciApIHsKICAgICAgICAgICAgJHRoaXMtPlB1c2hDb2xvcigkc2hhZG93Y29sb3IpOwogICAgICAgICAgICAkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4LSR4bWFyZyskZHJvcHdpZHRoLCR5KyR5bWFyZyskZHJvcHdpZHRoLSRoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR4KyR3aWR0aCskZHJvcHdpZHRoLCR5KyR5bWFyZyskZHJvcHdpZHRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kY29ybmVycmFkaXVzKTsKICAgICAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CiAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJGZjb2xvcik7CiAgICAgICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHgtJHhtYXJnLCAkeSskeW1hcmctJGhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHgrJHdpZHRoLCAkeSskeW1hcmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRjb3JuZXJyYWRpdXMpOwogICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgJHRoaXMtPlB1c2hDb2xvcigkYmNvbG9yKTsKICAgICAgICAgICAgJHRoaXMtPlJlY3RhbmdsZSgkeC0keG1hcmcsJHkrJHltYXJnLSRoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR4KyR3aWR0aCwkeSskeW1hcmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRjb3JuZXJyYWRpdXMpOwogICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCAkZmNvbG9yICkgewogICAgICAgICAgICAgICAgJG9jPSR0aGlzLT5jdXJyZW50X2NvbG9yOwogICAgICAgICAgICAgICAgJHRoaXMtPlNldENvbG9yKCRmY29sb3IpOwogICAgICAgICAgICAgICAgJHRoaXMtPkZpbGxlZFJlY3RhbmdsZSgkeC0keG1hcmcsJHkrJHltYXJnLSRoZWlnaHQsJHgrJHdpZHRoLCR5KyR5bWFyZyk7Ly8sJGNvcm5lcnJhZGl1cyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+Y3VycmVudF9jb2xvcj0kb2M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoICRiY29sb3IgKSB7CiAgICAgICAgICAgICAgICAkb2M9JHRoaXMtPmN1cnJlbnRfY29sb3I7CiAgICAgICAgICAgICAgICAkdGhpcy0+U2V0Q29sb3IoJGJjb2xvcik7CiAgICAgICAgICAgICAgICAkdGhpcy0+UmVjdGFuZ2xlKCR4LSR4bWFyZywkeSskeW1hcmctJGhlaWdodCwkeCskd2lkdGgsJHkrJHltYXJnKTsvLywkY29ybmVycmFkaXVzKTsKICAgICAgICAgICAgICAgICR0aGlzLT5jdXJyZW50X2NvbG9yPSRvYzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT5mb250X3NpemUgPCAxNCApIHsKICAgICAgICAgICAgJHggKz0gMjsKICAgICAgICAgICAgJHkgLT0gMjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAvLyBSZXN0b3JlIHRoZSBvcmlnaW5hbCB5IGJlZm9yZSB3ZSBzdHJva2UgdGhlIHRleHQKICAgICAgICAgICAvLyAkeSAtPSAkYmFzZWxpbmVfb2Zmc2V0OwoKICAgICAgICB9CgogICAgICAgICR0aGlzLT5TZXRDZW50ZXIoMCwwKTsKICAgICAgICAkdGhpcy0+U2V0QW5nbGUoJG9sZGEpOwoKICAgICAgICAkaD0kdGhpcy0+dGV4dF9oYWxpZ247CiAgICAgICAgJHY9JHRoaXMtPnRleHRfdmFsaWduOwogICAgICAgIGlmKCAkdGhpcy0+dGV4dF9oYWxpZ24gPT0gJ2NlbnRlcicpIHsKICAgICAgICAgICAgJHRoaXMtPlNldFRleHRBbGlnbignY2VudGVyJywnYmFzZXBvaW50Jyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+U2V0VGV4dEFsaWduKCdiYXNlcG9pbnQnLCdiYXNlcG9pbnQnKTsKICAgICAgICB9CgogICAgICAgICRkZWJ1Zz1mYWxzZTsKICAgICAgICAkdGhpcy0+U3Ryb2tlVGV4dCgkeCwgJHksICR0eHQsICRkaXIsICRwYXJhZ3JhcGhfYWxpZ24sJGRlYnVnKTsKCiAgICAgICAgJGJiID0gYXJyYXkoJHgtJHhtYXJnLCAkeSskaGVpZ2h0LSR5bWFyZywKICAgICAgICAgICAgICAgICAgICAkeCskd2lkdGgsICR5KyRoZWlnaHQtJHltYXJnLAogICAgICAgICAgICAgICAgICAgICR4KyR3aWR0aCwgJHktJHltYXJnLAogICAgICAgICAgICAgICAgICAgICR4LSR4bWFyZywgJHktJHltYXJnKTsKCiAgICAgICAgJHRoaXMtPlNldFRleHRBbGlnbigkaCwkdik7CiAgICAgICAgJHRoaXMtPlNldEFuZ2xlKCRvbGRhKTsKCgkJJHRoaXMtPmxhc3R4ID0gJG9sZHg7CgkJJHRoaXMtPmxhc3R5ID0gJG9sZHk7CgogICAgICAgIHJldHVybiAkYmI7CiAgICB9CgogICAgLy8gU2V0IHRleHQgYWxpZ25tZW50CiAgICBmdW5jdGlvbiBTZXRUZXh0QWxpZ24oJGhhbGlnbiwkdmFsaWduPSJib3R0b20iKSB7CiAgICAgICAgJHRoaXMtPnRleHRfaGFsaWduPSRoYWxpZ247CiAgICAgICAgJHRoaXMtPnRleHRfdmFsaWduPSR2YWxpZ247CiAgICB9CgogICAgZnVuY3Rpb24gX1N0cm9rZUJ1aWx0aW5Gb250KCR4LCR5LCR0eHQsJGRpciwkcGFyYWdyYXBoX2FsaWduLCYkYUJvdW5kaW5nQm94LCRhRGVidWc9ZmFsc2UpIHsKCiAgICAgICAgaWYoIGlzX251bWVyaWMoJGRpcikgJiYgJGRpciE9OTAgJiYgJGRpciE9MCkKICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5MSk7Ly8oIiBJbnRlcm5hbCBmb250IGRvZXMgbm90IHN1cHBvcnQgZHJhd2luZyB0ZXh0IGF0IGFyYml0cmFyeSBhbmdsZS4gVXNlIFRURiBmb250cyBpbnN0ZWFkLiIpOwoKICAgICAgICAkaD0kdGhpcy0+R2V0VGV4dEhlaWdodCgkdHh0KTsKICAgICAgICAkZmg9JHRoaXMtPkdldEZvbnRIZWlnaHQoKTsKICAgICAgICAkdz0kdGhpcy0+R2V0VGV4dFdpZHRoKCR0eHQpOwoKICAgICAgICBpZiggJHRoaXMtPnRleHRfaGFsaWduPT0icmlnaHQiKSB7CiAgICAgICAgICAgICR4IC09ICRkaXI9PTAgPyAkdyA6ICRoOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09ImNlbnRlciIgKSB7CiAgICAgICAgICAgIC8vIEZvciBjZW50ZXIgd2Ugc3VidHJhY3QgMSBwaXhlbCBzaW5jZSB0aGlzIG1ha2VzIHRoZSBtaWRkbGUKICAgICAgICAgICAgLy8gYmUgcHJlZmVjdGx5IGluIHRoZSBtaWRkbGUKICAgICAgICAgICAgJHggLT0gJGRpcj09MCA\/ICR3LzItMSA6ICRoLzI7CiAgICAgICAgfQogICAgICAgIGlmKCAkdGhpcy0+dGV4dF92YWxpZ249PSJ0b3AiICkgewogICAgICAgICAgICAkeSArPSAkZGlyPT0wID8gJGggOiAkdzsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkdGhpcy0+dGV4dF92YWxpZ249PSJjZW50ZXIiICkgewogICAgICAgICAgICAkeSArPSAkZGlyPT0wID8gJGgvMiA6ICR3LzI7CiAgICAgICAgfQoKICAgICAgICAkdXNlX2ZvbnQgPSAkdGhpcy0+Zm9udF9mYW1pbHk7CgogICAgICAgIGlmKCAkZGlyPT05MCApIHsKICAgICAgICAgICAgaW1hZ2VzdHJpbmd1cCgkdGhpcy0+aW1nLCR1c2VfZm9udCwkeCwkeSwkdHh0LCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKICAgICAgICAgICAgJGFCb3VuZGluZ0JveCA9IGFycmF5KHJvdW5kKCR4KSxyb3VuZCgkeSkscm91bmQoJHgpLHJvdW5kKCR5LSR3KSxyb3VuZCgkeCskaCkscm91bmQoJHktJHcpLHJvdW5kKCR4KyRoKSxyb3VuZCgkeSkpOwogICAgICAgICAgICBpZiggJGFEZWJ1ZyApIHsKICAgICAgICAgICAgICAgIC8vIERyYXcgYm91bmRpbmcgYm94CiAgICAgICAgICAgICAgICAkdGhpcy0+UHVzaENvbG9yKCdncmVlbicpOwogICAgICAgICAgICAgICAgJHRoaXMtPlBvbHlnb24oJGFCb3VuZGluZ0JveCx0cnVlKTsKICAgICAgICAgICAgICAgICR0aGlzLT5Qb3BDb2xvcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiggcHJlZ19tYXRjaCgnL1xuLycsJHR4dCkgKSB7CiAgICAgICAgICAgICAgICAkdG1wID0gcHJlZ19zcGxpdCgnL1xuLycsJHR4dCk7CiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkdG1wKTsgKyskaSkgewogICAgICAgICAgICAgICAgICAgICR3MSA9ICR0aGlzLT5HZXRUZXh0V2lkdGgoJHRtcFskaV0pOwogICAgICAgICAgICAgICAgICAgIGlmKCAkcGFyYWdyYXBoX2FsaWduPT0ibGVmdCIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlc3RyaW5nKCR0aGlzLT5pbWcsJHVzZV9mb250LCR4LCR5LSRoKzErJGkqJGZoLCR0bXBbJGldLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZWlmKCAkcGFyYWdyYXBoX2FsaWduPT0icmlnaHQiICkgewogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZXN0cmluZygkdGhpcy0+aW1nLCR1c2VfZm9udCwkeCsoJHctJHcxKSwkeS0kaCsxKyRpKiRmaCwkdG1wWyRpXSwkdGhpcy0+Y3VycmVudF9jb2xvcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZXN0cmluZygkdGhpcy0+aW1nLCR1c2VfZm9udCwkeCskdy8yLSR3MS8yLCR5LSRoKzErJGkqJGZoLCR0bXBbJGldLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvL1B1dCB0aGUgdGV4dAogICAgICAgICAgICAgICAgaW1hZ2VzdHJpbmcoJHRoaXMtPmltZywkdXNlX2ZvbnQsJHgsJHktJGgrMSwkdHh0LCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggJGFEZWJ1ZyApIHsKICAgICAgICAgICAgICAgIC8vIERyYXcgdGhlIGJvdW5kaW5nIHJlY3RhbmdsZSBhbmQgdGhlIGJvdW5kaW5nIGJveAogICAgICAgICAgICAgICAgJHAxID0gYXJyYXkocm91bmQoJHgpLHJvdW5kKCR5KSxyb3VuZCgkeCkscm91bmQoJHktJGgpLHJvdW5kKCR4KyR3KSxyb3VuZCgkeS0kaCkscm91bmQoJHgrJHcpLHJvdW5kKCR5KSk7CgogICAgICAgICAgICAgICAgLy8gRHJhdyBib3VuZGluZyBib3gKICAgICAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJ2dyZWVuJyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+UG9seWdvbigkcDEsdHJ1ZSk7CiAgICAgICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGFCb3VuZGluZ0JveD1hcnJheShyb3VuZCgkeCkscm91bmQoJHkpLHJvdW5kKCR4KSxyb3VuZCgkeS0kaCkscm91bmQoJHgrJHcpLHJvdW5kKCR5LSRoKSxyb3VuZCgkeCskdykscm91bmQoJHkpKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQWRkVHh0Q1IoJGFUeHQpIHsKICAgICAgICAvLyBJZiB0aGUgdXNlciBoYXMganVzdCBzcGVjaWZpZWQgYSAnXG4nCiAgICAgICAgLy8gaW5zdGVhZCBvZiAnXG5cdCcgd2UgaGF2ZSB0byBhZGQgJ1xyJyBzaW5jZQogICAgICAgIC8vIHRoZSB3aWR0aCB3aWxsIGJlIHRvbyBtdWNoeSBvdGhlcndpc2Ugc2luY2Ugd2hlbgogICAgICAgIC8vIHdlIHByaW50IHdlIHN0cm9rZSB0aGUgaW5kaXZpZHVhbGx5IGxpbmVzIGJ5IGhhbmQuCiAgICAgICAgJGUgPSBleHBsb2RlKCJcbiIsJGFUeHQpOwogICAgICAgICRuID0gY291bnQoJGUpOwogICAgICAgIGZvcigkaT0wOyAkaTwkbjsgKyskaSkgewogICAgICAgICAgICAkZVskaV09c3RyX3JlcGxhY2UoIlxyIiwiIiwkZVskaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW1wbG9kZSgiXG5cciIsJGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIE5vcm1BbmdsZSgkYSkgewogICAgICAgIC8vIE5vcm1hbGl6ZSBhbmdsZSBpbiBkZWdyZWVzCiAgICAgICAgLy8gTm9ybWFsaXplIGFuZ2xlIHRvIGJlIGJldHdlZW4gMC0zNjAKICAgICAgICB3aGlsZSggJGEgPiAzNjAgKQogICAgICAgICAgICAkYSAtPSAzNjA7CiAgICAgICAgd2hpbGUoICRhIDwgLTM2MCApCiAgICAgICAgICAgICRhICs9IDM2MDsKICAgICAgICBpZiggJGEgPCAwICkKICAgICAgICAgICAgJGEgPSAzNjAgKyAkYTsKICAgICAgICByZXR1cm4gJGE7CiAgICB9CgogICAgZnVuY3Rpb24gaW1hZ2V0dGZiYm94X2ZpeGVkKCRzaXplLCAkYW5nbGUsICRmb250ZmlsZSwgJHRleHQpIHsKCgogICAgICAgIGlmKCAhIFVTRV9MSUJSQVJZX0lNQUdFVFRGQkJPWCApIHsKCiAgICAgICAgICAgICRiYm94ID0gQGltYWdldHRmYmJveCgkc2l6ZSwgJGFuZ2xlLCAkZm9udGZpbGUsICR0ZXh0KTsKICAgICAgICAgICAgaWYoICRiYm94ID09PSBmYWxzZSApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDkyLCR0aGlzLT5mb250X2ZpbGUpOwogICAgICAgICAgICAgICAgLy8oIlRoZXJlIGlzIGVpdGhlciBhIGNvbmZpZ3VyYXRpb24gcHJvYmxlbSB3aXRoIFRydWVUeXBlIG9yIGEgcHJvYmxlbSByZWFkaW5nIGZvbnQgZmlsZSAoIi4kdGhpcy0+Zm9udF9maWxlLiIpLiBNYWtlIHN1cmUgZmlsZSBleGlzdHMgYW5kIGlzIGluIGEgcmVhZGFibGUgcGxhY2UgZm9yIHRoZSBIVFRQIHByb2Nlc3MuIChJZiAnYmFzZWRpcicgcmVzdHJpY3Rpb24gaXMgZW5hYmxlZCBpbiBQSFAgdGhlbiB0aGUgZm9udCBmaWxlIG11c3QgYmUgbG9jYXRlZCBpbiB0aGUgZG9jdW1lbnQgcm9vdC4pLiBJdCBtaWdodCBhbHNvIGJlIGEgd3JvbmdseSBpbnN0YWxsZWQgRnJlZVR5cGUgbGlicmFyeS4gVHJ5IHVwcGdyYWRpbmcgdG8gYXQgbGVhc3QgRnJlZVR5cGUgMi4xLjEzIGFuZCByZWNvbXBpbGUgR0Qgd2l0aCB0aGUgY29ycmVjdCBzZXR1cCBzbyBpdCBjYW4gZmluZCB0aGUgbmV3IEZUIGxpYnJhcnkuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPmJib3hfY2FjaGUgPSAkYmJveDsKICAgICAgICAgICAgcmV0dXJuICRiYm94OwogICAgICAgIH0KCiAgICAgICAgLy8gVGhlIGJ1aWx0IGluIGltYWdldHRmYmJveCBpcyBidWdneSBmb3IgYW5nbGVzICE9IDAgc28KICAgICAgICAvLyB3ZSBjYWxjdWxhdGUgdGhpcyBtYW51YWxseSBieSBnZXR0aW5nIHRoZSBib3VuZGluZyBib3ggYXQKICAgICAgICAvLyBhbmdsZSA9IDAgYW5kIHRoZW4gcm90YXRlIHRoZSBib3VuZGluZyBib3ggbWFudWFsbHkKICAgICAgICAkYmJveCA9IEBpbWFnZXR0ZmJib3goJHNpemUsIDAsICRmb250ZmlsZSwgJHRleHQpOwogICAgICAgIGlmKCAkYmJveCA9PT0gZmFsc2UgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDkyLCR0aGlzLT5mb250X2ZpbGUpOwogICAgICAgICAgICAvLygiVGhlcmUgaXMgZWl0aGVyIGEgY29uZmlndXJhdGlvbiBwcm9ibGVtIHdpdGggVHJ1ZVR5cGUgb3IgYSBwcm9ibGVtIHJlYWRpbmcgZm9udCBmaWxlICgiLiR0aGlzLT5mb250X2ZpbGUuIikuIE1ha2Ugc3VyZSBmaWxlIGV4aXN0cyBhbmQgaXMgaW4gYSByZWFkYWJsZSBwbGFjZSBmb3IgdGhlIEhUVFAgcHJvY2Vzcy4gKElmICdiYXNlZGlyJyByZXN0cmljdGlvbiBpcyBlbmFibGVkIGluIFBIUCB0aGVuIHRoZSBmb250IGZpbGUgbXVzdCBiZSBsb2NhdGVkIGluIHRoZSBkb2N1bWVudCByb290LikuIEl0IG1pZ2h0IGFsc28gYmUgYSB3cm9uZ2x5IGluc3RhbGxlZCBGcmVlVHlwZSBsaWJyYXJ5LiBUcnkgdXBwZ3JhZGluZyB0byBhdCBsZWFzdCBGcmVlVHlwZSAyLjEuMTMgYW5kIHJlY29tcGlsZSBHRCB3aXRoIHRoZSBjb3JyZWN0IHNldHVwIHNvIGl0IGNhbiBmaW5kIHRoZSBuZXcgRlQgbGlicmFyeS4iKTsKICAgICAgICB9CgogICAgICAgICRhbmdsZSA9ICR0aGlzLT5Ob3JtQW5nbGUoJGFuZ2xlKTsKCiAgICAgICAgJGEgPSAkYW5nbGUqTV9QSS8xODA7CiAgICAgICAgJGNhID0gY29zKCRhKTsKICAgICAgICAkc2EgPSBzaW4oJGEpOwogICAgICAgICRyZXQgPSBhcnJheSgpOwoKICAgICAgICAvLyBXZSBhbHdheXMgYWRkIDEgcGl4ZWwgdG8gdGhlIGxlZnQgc2luY2UgdGhlIGxlZnQgZWRnZSBvZiB0aGUgYm91bmRpbmcKICAgICAgICAvLyBib3ggaXMgc29tZXRpbWVzIGNvaW5jaWRpbmcgd2l0aCB0aGUgZmlyc3QgcGl4ZWwgb2YgdGhlIHRleHQKICAgICAgICAvLyRiYm94WzBdIC09IDE7CiAgICAgICAgLy8kYmJveFs2XSAtPSAxOwogICAgICAgIAogICAgICAgIC8vIEZvciByb2F0YXRlZCB0ZXh0IHdlIG5lZWQgdG8gYWRkIGV4dHJhIHdpZHRoIGZvciByb3RhdGVkCiAgICAgICAgLy8gdGV4dCBzaW5jZSB0aGUga2VybmluZyBhbmQgc3Ryb2tpbmcgb2YgdGhlIFRURiBpcyBub3QgdGhlIHNhbWUgYXMgZm9yCiAgICAgICAgLy8gdGV4dCBhdCBhIDAgZGVncmVlIGFuZ2xlCgogICAgICAgIGlmKCAkYW5nbGUgPiAwLjAwMSAmJiBhYnMoJGFuZ2xlLTM2MCkgPiAwLjAwMSApIHsKICAgICAgICAgICAgJGggPSBhYnMoJGJib3hbN10tJGJib3hbMV0pOwogICAgICAgICAgICAkdyA9IGFicygkYmJveFsyXS0kYmJveFswXSk7CgogICAgICAgICAgICAkYmJveFswXSAtPSAyOwogICAgICAgICAgICAkYmJveFs2XSAtPSAyOwogICAgICAgICAgICAvLyBUaGUgd2lkdGggaXMgdW5kZXJlc3RpbWF0ZWQgc28gY29tcGVuc2F0ZSBmb3IgdGhhdAogICAgICAgICAgICAkYmJveFsyXSArPSByb3VuZCgkdyowLjA2KTsKICAgICAgICAgICAgJGJib3hbNF0gKz0gcm91bmQoJHcqMC4wNik7CgogICAgICAgICAgICAvLyBhbmQgd2UgYWxzbyBuZWVkIHRvIGNvbXBlbnNhdGUgd2l0aCBpbmNyZWFzZWQgaGVpZ2h0CiAgICAgICAgICAgICRiYm94WzVdIC09IHJvdW5kKCRoKjAuMSk7CiAgICAgICAgICAgICRiYm94WzddIC09IHJvdW5kKCRoKjAuMSk7CgogICAgICAgICAgICBpZiggJGFuZ2xlID4gOTAgKSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgYW5nbGVzID4gOTAgd2UgYWxzbyBuZWVkIHRvIGV4dGVuZCB0aGUgaGVpZ2h0IGZ1cnRoZXIgZG93bgogICAgICAgICAgICAgICAgLy8gYnkgdGhlIGJhc2VsaW5lIHNpbmNlIHRoYXQgaXMgYWxzbyBvbmUgbW9yZSBwcm9ibGVtCiAgICAgICAgICAgICAgICAkYmJveFsxXSArPSByb3VuZCgkaCowLjE1KTsKICAgICAgICAgICAgICAgICRiYm94WzNdICs9IHJvdW5kKCRoKjAuMTUpOwoKICAgICAgICAgICAgICAgIC8vIGFuZCBhbHNvIG1ha2UgaXQgc2xpZ2h0eSBsZXNzIGhlaWdodAogICAgICAgICAgICAgICAgJGJib3hbN10gKz0gcm91bmQoJGgqMC4wNSk7CiAgICAgICAgICAgICAgICAkYmJveFs1XSArPSByb3VuZCgkaCowLjA1KTsKCiAgICAgICAgICAgICAgICAvLyBBbmQgd2UgbmVlZCB0byBtb3ZlIHRoZSBib3ggc2xpZ2h0bHkgdG9wIHRoZSBycmlnaHQgKGZyb20gYSB0ZXR4IHBlcnNwZWN0aXZlKQogICAgICAgICAgICAgICAgJGJib3hbMF0gKz0gcm91bmQoJHcqMC4wMik7CiAgICAgICAgICAgICAgICAkYmJveFs2XSArPSByb3VuZCgkdyowLjAyKTsKCiAgICAgICAgICAgICAgICBpZiggJGFuZ2xlID4gMTgwICkgewogICAgICAgICAgICAgICAgICAgIC8vIEFuZCB3ZSBuZWVkIHRvIG1vdmUgdGhlIGJveCBzbGlnaHRseSB0byB0aGUgbGVmdCAoZnJvbSBhIHRleHQgcGVyc3BlY3RpdmUpCiAgICAgICAgICAgICAgICAgICAgJGJib3hbMF0gLT0gcm91bmQoJHcqMC4wMik7CiAgICAgICAgICAgICAgICAgICAgJGJib3hbNl0gLT0gcm91bmQoJHcqMC4wMik7CiAgICAgICAgICAgICAgICAgICAgJGJib3hbMl0gLT0gcm91bmQoJHcqMC4wMik7CiAgICAgICAgICAgICAgICAgICAgJGJib3hbNF0gLT0gcm91bmQoJHcqMC4wMik7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IoJGkgPSAwOyAkaSA8IDc7ICRpICs9IDIpIHsKICAgICAgICAgICAgICAgICRyZXRbJGldID0gcm91bmQoJGJib3hbJGldICogJGNhICsgJGJib3hbJGkrMV0gKiAkc2EpOwogICAgICAgICAgICAgICAgJHJldFskaSsxXSA9IHJvdW5kKCRiYm94WyRpKzFdICogJGNhIC0gJGJib3hbJGldICogJHNhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+YmJveF9jYWNoZSA9ICRyZXQ7CiAgICAgICAgICAgIHJldHVybiAkcmV0OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmJib3hfY2FjaGUgPSAkYmJveDsKICAgICAgICAgICAgcmV0dXJuICRiYm94OwogICAgICAgIH0KICAgIH0KCiAgICAvLyBEZXByZWNhdGVkCiAgICBmdW5jdGlvbiBHZXRUVEZCQm94KCRhVHh0LCRhQW5nbGU9MCkgewogICAgICAgICRiYm94ID0gJHRoaXMtPmltYWdldHRmYmJveF9maXhlZCgkdGhpcy0+Zm9udF9zaXplLCRhQW5nbGUsJHRoaXMtPmZvbnRfZmlsZSwkYVR4dCk7CiAgICAgICAgIHJldHVybiAkYmJveDsKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRCQm94VFRGKCRhVHh0LCRhQW5nbGU9MCkgewogICAgICAgIC8vIE5vcm1hbGl6ZSB0aGUgYm91bmRpbmcgYm94IHRvIGJlY29tZSBhIG1pbmltdW0KICAgICAgICAvLyBlbnNjcmliaW5nIHJlY3RhbmdsZQoKICAgICAgICAkYVR4dCA9ICR0aGlzLT5BZGRUeHRDUigkYVR4dCk7CgogICAgICAgIGlmKCAhaXNfcmVhZGFibGUoJHRoaXMtPmZvbnRfZmlsZSkgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDkzLCR0aGlzLT5mb250X2ZpbGUpOwogICAgICAgICAgICAvLygnQ2FuIG5vdCByZWFkIGZvbnQgZmlsZSAoJy4kdGhpcy0+Zm9udF9maWxlLicpIGluIGNhbGwgdG8gSW1hZ2U6OkdldEJCb3hUVEYuIFBsZWFzZSBtYWtlIHN1cmUgdGhhdCB5b3UgaGF2ZSBzZXQgYSBmb250IGJlZm9yZSBjYWxsaW5nIHRoaXMgbWV0aG9kIGFuZCB0aGF0IHRoZSBmb250IGlzIGluc3RhbGxlZCBpbiB0aGUgVFRGIGRpcmVjdG9yeS4nKTsKICAgICAgICB9CiAgICAgICAgJGJib3ggPSAkdGhpcy0+aW1hZ2V0dGZiYm94X2ZpeGVkKCR0aGlzLT5mb250X3NpemUsJGFBbmdsZSwkdGhpcy0+Zm9udF9maWxlLCRhVHh0KTsKCiAgICAgICAgaWYoICRhQW5nbGU9PTAgKSByZXR1cm4gJGJib3g7CgogICAgICAgIGlmKCAkYUFuZ2xlID49IDAgKSB7CiAgICAgICAgICAgIGlmKCAgJGFBbmdsZSA8PSA5MCApIHsgLy88PTAKICAgICAgICAgICAgICAgICRiYm94ID0gYXJyYXkoJGJib3hbNl0sJGJib3hbMV0sJGJib3hbMl0sJGJib3hbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYm94WzJdLCRiYm94WzVdLCRiYm94WzZdLCRiYm94WzVdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICAkYUFuZ2xlIDw9IDE4MCApIHsgLy88PSAyCiAgICAgICAgICAgICAgICAkYmJveCA9IGFycmF5KCRiYm94WzRdLCRiYm94WzddLCRiYm94WzBdLCRiYm94WzddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYmJveFswXSwkYmJveFszXSwkYmJveFs0XSwkYmJveFszXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCAgJGFBbmdsZSA8PSAyNzAgKSAgeyAvLzw9IDMKICAgICAgICAgICAgICAgICRiYm94ID0gYXJyYXkoJGJib3hbMl0sJGJib3hbNV0sJGJib3hbNl0sJGJib3hbNV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYm94WzZdLCRiYm94WzFdLCRiYm94WzJdLCRiYm94WzFdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRiYm94ID0gYXJyYXkoJGJib3hbMF0sJGJib3hbM10sJGJib3hbNF0sJGJib3hbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYm94WzRdLCRiYm94WzddLCRiYm94WzBdLCRiYm94WzddKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoICAkYUFuZ2xlIDwgMCApIHsKICAgICAgICAgICAgaWYoICRhQW5nbGUgPD0gLTI3MCApIHsgLy8gPD0gLTMKICAgICAgICAgICAgICAgICRiYm94ID0gYXJyYXkoJGJib3hbNl0sJGJib3hbMV0sJGJib3hbMl0sJGJib3hbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYm94WzJdLCRiYm94WzVdLCRiYm94WzZdLCRiYm94WzVdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICRhQW5nbGUgPD0gLTE4MCApIHsgLy8gPD0gLTIKICAgICAgICAgICAgICAgICRiYm94ID0gYXJyYXkoJGJib3hbMF0sJGJib3hbM10sJGJib3hbNF0sJGJib3hbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYm94WzRdLCRiYm94WzddLCRiYm94WzBdLCRiYm94WzddKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICRhQW5nbGUgPD0gLTkwICkgeyAvLyA8PSAtMQogICAgICAgICAgICAgICAgJGJib3ggPSBhcnJheSgkYmJveFsyXSwkYmJveFs1XSwkYmJveFs2XSwkYmJveFs1XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJib3hbNl0sJGJib3hbMV0sJGJib3hbMl0sJGJib3hbMV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGJib3ggPSBhcnJheSgkYmJveFswXSwkYmJveFszXSwkYmJveFs0XSwkYmJveFszXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJib3hbNF0sJGJib3hbN10sJGJib3hbMF0sJGJib3hbN10pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYmJveDsKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRCQm94SGVpZ2h0KCRhVHh0LCRhQW5nbGU9MCkgewogICAgICAgICRib3ggPSAkdGhpcy0+R2V0QkJveFRURigkYVR4dCwkYUFuZ2xlKTsKICAgICAgICByZXR1cm4gYWJzKCRib3hbN10tJGJveFsxXSk7CiAgICB9CgogICAgZnVuY3Rpb24gR2V0QkJveFdpZHRoKCRhVHh0LCRhQW5nbGU9MCkgewogICAgICAgICRib3ggPSAkdGhpcy0+R2V0QkJveFRURigkYVR4dCwkYUFuZ2xlKTsKICAgICAgICByZXR1cm4gJGJveFsyXS0kYm94WzBdKzE7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9TdHJva2VUVEYoJHgsJHksJHR4dCwkZGlyLCRwYXJhZ3JhcGhfYWxpZ24sJiRhQm91bmRpbmdCb3gsJGRlYnVnPWZhbHNlKSB7CgogICAgICAgIC8vIFNldHVwIGRlZmF1bHQgaW50ZXIgbGluZSBtYXJnaW4gZm9yIHBhcmFncmFwaHMgdG8gYmUKICAgICAgICAvLyAzJSBvZiB0aGUgZm9udCBoZWlnaHQuCiAgICAgICAgJENvbnN0TGluZVNwYWNpbmcgPSAwLjAzIDsKCiAgICAgICAgLy8gUmVtZW1iZXIgdGhlIGFuY2hvciBwb2ludCBiZWZvcmUgYWRqdXN0bWVudAogICAgICAgIGlmKCAkZGVidWcgKSB7CiAgICAgICAgICAgICRveD0keDsKICAgICAgICAgICAgJG95PSR5OwogICAgICAgIH0KCiAgICAgICAgaWYoICFwcmVnX21hdGNoKCcvXG4vJywkdHh0KSB8fCAoJGRpcj4wICYmIHByZWdfbWF0Y2goJy9cbi8nLCR0eHQpKSApIHsKICAgICAgICAgICAgLy8gRm9ybWF0IGEgc2luZ2xlIGxpbmUKCiAgICAgICAgICAgICR0eHQgPSAkdGhpcy0+QWRkVHh0Q1IoJHR4dCk7CiAgICAgICAgICAgICRiYm94PSR0aGlzLT5HZXRCQm94VFRGKCR0eHQsJGRpcik7CiAgICAgICAgICAgICR3aWR0aCAgPSAkdGhpcy0+R2V0QkJveFdpZHRoKCR0eHQsJGRpcik7CiAgICAgICAgICAgICRoZWlnaHQgPSAkdGhpcy0+R2V0QkJveEhlaWdodCgkdHh0LCRkaXIpOwoKICAgICAgICAgICAgLy8gVGhlIHNwZWNpYWwgYWxpZ25tZW50ICJiYXNlcG9pbnQiIGlzIG1vc3RseSB1c2VkIGludGVybmFsbHkKICAgICAgICAgICAgLy8gaW4gdGhlIGxpYnJhcnkuIFRoaXMgd2lsbCBwdXQgdGhlIGFuY2hvciBwb3NpdGlvbiBhdCB0aGUgbGVmdAogICAgICAgICAgICAvLyBiYXNlcG9pbnQgb2YgdGhlIHRldHguIFRoaXMgaXMgdGhlIGRlZmF1bHQgYW5jaG9yIHBvaW50IGZvcgogICAgICAgICAgICAvLyBUVEYgdGV4dC4KCiAgICAgICAgICAgIGlmKCAkdGhpcy0+dGV4dF92YWxpZ24gIT0gJ2Jhc2Vwb2ludCcgKSB7CiAgICAgICAgICAgICAgICAvLyBBbGlnbiB4LHkgb3QgbG93ZXIgbGVmdCBjb3JuZXIgb2YgYmJveAogICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09J3JpZ2h0JyApIHsKICAgICAgICAgICAgICAgICAgICAkeCAtPSAkd2lkdGg7CiAgICAgICAgICAgICAgICAgICAgJHggLT0gJGJib3hbMF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09J2NlbnRlcicgKSB7CiAgICAgICAgICAgICAgICAgICAgJHggLT0gJHdpZHRoLzI7CiAgICAgICAgICAgICAgICAgICAgJHggLT0gJGJib3hbMF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09J2Jhc2VsaW5lJyApIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIG9ubHkgc3VwcG9ydCBmb3IgdGV4dCBhdCA5MCBkZWdyZWUgISEKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nIHRoZSB0ZXh0IGlzIGRyYXduIGF0IGJhc2VsaW5lIGJ5IGRlZmF1bHQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnRleHRfdmFsaWduPT0ndG9wJyApIHsKICAgICAgICAgICAgICAgICAgICAkeSAtPSAkYmJveFsxXTsgLy8gQWRqdXN0IHRvIGJvdHRvbSBvZiB0ZXh0CiAgICAgICAgICAgICAgICAgICAgJHkgKz0gJGhlaWdodDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnRleHRfdmFsaWduPT0nY2VudGVyJyApIHsKICAgICAgICAgICAgICAgICAgICAkeSAtPSAkYmJveFsxXTsgLy8gQWRqdXN0IHRvIGJvdHRvbSBvZiB0ZXh0CiAgICAgICAgICAgICAgICAgICAgJHkgKz0gJGhlaWdodC8yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmKCAkdGhpcy0+dGV4dF92YWxpZ249PSdiYXNlbGluZScgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBvbmx5IHN1cHBvcnQgZm9yIHRleHQgYXQgMCBkZWdyZWUgISEKICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5nIHRoZSB0ZXh0IGlzIGRyYXduIGF0IGJhc2VsaW5lIGJ5IGRlZmF1bHQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAKICAgICAgICAgICAgSW1hZ2VUVEZUZXh0ICgkdGhpcy0+aW1nLCAkdGhpcy0+Zm9udF9zaXplLCAkZGlyLCAkeCwgJHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmN1cnJlbnRfY29sb3IsJHRoaXMtPmZvbnRfZmlsZSwkdHh0KTsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBhbmQgcmV0dXJuIHRoZSBjby1vcmRpbmF0ZXMgZm9yIHRoZSBib3VuZGluZyBib3gKICAgICAgICAgICAgJGJveCA9ICR0aGlzLT5pbWFnZXR0ZmJib3hfZml4ZWQoJHRoaXMtPmZvbnRfc2l6ZSwkZGlyLCR0aGlzLT5mb250X2ZpbGUsJHR4dCk7CiAgICAgICAgICAgICRwMSA9IGFycmF5KCk7CgogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCA0OyArKyRpKSB7CiAgICAgICAgICAgICAgICAkcDFbXSA9IHJvdW5kKCRib3hbJGkqMl0rJHgpOwogICAgICAgICAgICAgICAgJHAxW10gPSByb3VuZCgkYm94WyRpKjIrMV0rJHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRhQm91bmRpbmdCb3ggPSAkcDE7CgogICAgICAgICAgICAvLyBEZWJ1Z2dpbmcgY29kZSB0byBoaWdobGlnaHQgdGhlIGJvbmRpbmcgYm94IGFuZCBib3VuZGluZyByZWN0YW5nbGUKICAgICAgICAgICAgLy8gRm9yIHRleHQgYXQgMCBkZWdyZWVzIHRoZSBib3VuZGluZyBib3ggYW5kIGJvdW5kaW5nIHJlY3RhbmdsZSBhcmUgdGhlCiAgICAgICAgICAgIC8vIHNhbWUKICAgICAgICAgICAgaWYoICRkZWJ1ZyApIHsKICAgICAgICAgICAgLy8gRHJhdyB0aGUgYm91bmRpbmcgcmVjdGFuZ2xlIGFuZCB0aGUgYm91bmRpbmcgYm94CgogICAgICAgICAgICAgICAgJHAgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgJHAxID0gYXJyYXkoKTsKCiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCA0OyArKyRpKSB7CiAgICAgICAgICAgICAgICAgICAgJHBbXSA9ICAkYmJveFskaSoyXSskeCA7CiAgICAgICAgICAgICAgICAgICAgJHBbXSA9ICAkYmJveFskaSoyKzFdKyR5OwogICAgICAgICAgICAgICAgICAgICRwMVtdID0gJGJveFskaSoyXSskeCA7CiAgICAgICAgICAgICAgICAgICAgJHAxW10gPSAkYm94WyRpKjIrMV0rJHkgOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIERyYXcgYm91bmRpbmcgYm94CiAgICAgICAgICAgICAgICAkdGhpcy0+UHVzaENvbG9yKCdncmVlbicpOwogICAgICAgICAgICAgICAgJHRoaXMtPlBvbHlnb24oJHAxLHRydWUpOwogICAgICAgICAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CgogICAgICAgICAgICAgICAgLy8gRHJhdyBib3VuZGluZyByZWN0YW5nbGUKICAgICAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJ2RhcmtncmVlbicpOwogICAgICAgICAgICAgICAgJHRoaXMtPlBvbHlnb24oJHAsdHJ1ZSk7CiAgICAgICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKCiAgICAgICAgICAgICAgICAvLyBEcmF3IGEgY3Jvc3MgYXQgdGhlIGFuY2hvciBwb2ludAogICAgICAgICAgICAgICAgJHRoaXMtPlB1c2hDb2xvcigncmVkJyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+TGluZSgkb3gtMTUsJG95LCRveCsxNSwkb3kpOwogICAgICAgICAgICAgICAgJHRoaXMtPkxpbmUoJG94LCRveS0xNSwkb3gsJG95KzE1KTsKICAgICAgICAgICAgICAgICR0aGlzLT5Qb3BDb2xvcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBGb3JtYXQgYSB0ZXh0IHBhcmFncmFwaAogICAgICAgICAgICAkZmg9JHRoaXMtPkdldEZvbnRIZWlnaHQoKTsKCiAgICAgICAgICAgIC8vIExpbmUgbWFyZ2luIGlzIDI1JSBvZiBmb250IGhlaWdodAogICAgICAgICAgICAkbGluZW1hcmdpbj1yb3VuZCgkZmgqJENvbnN0TGluZVNwYWNpbmcpOwogICAgICAgICAgICAkZmggKz0gJGxpbmVtYXJnaW47CiAgICAgICAgICAgICR3PSR0aGlzLT5HZXRUZXh0V2lkdGgoJHR4dCk7CgogICAgICAgICAgICAkeSAtPSAkbGluZW1hcmdpbi8yOwogICAgICAgICAgICAkdG1wID0gcHJlZ19zcGxpdCgnL1xuLycsJHR4dCk7CiAgICAgICAgICAgICRubCA9IGNvdW50KCR0bXApOwogICAgICAgICAgICAkaCA9ICRubCAqICRmaDsKCiAgICAgICAgICAgIGlmKCAkdGhpcy0+dGV4dF9oYWxpZ249PSdyaWdodCcpIHsKICAgICAgICAgICAgICAgICR4IC09ICRkaXI9PTAgPyAkdyA6ICRoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnRleHRfaGFsaWduPT0nY2VudGVyJyApIHsKICAgICAgICAgICAgICAgICR4IC09ICRkaXI9PTAgPyAkdy8yIDogJGgvMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoICR0aGlzLT50ZXh0X3ZhbGlnbj09J3RvcCcgKSB7CiAgICAgICAgICAgICAgICAkeSArPSAkZGlyPT0wID8gJGggOiAkdzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICR0aGlzLT50ZXh0X3ZhbGlnbj09J2NlbnRlcicgKSB7CiAgICAgICAgICAgICAgICAkeSArPSAkZGlyPT0wID8gJGgvMiA6ICR3LzI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEhlcmUgY29tZXMgYSB0cmlja3kgYml0LgogICAgICAgICAgICAvLyBTaW5jZSB3ZSBoYXZlIHRvIGdpdmUgdGhlIHBvc2l0aW9uIGZvciB0aGUgc3RyaW5nIGF0IHRoZQogICAgICAgICAgICAvLyBiYXNlbGluZSB0aGlzIG1lYW5zIHRoYWh0IHRleHQgd2lsbCBtb3ZlIHNsaWdodGx5IHVwCiAgICAgICAgICAgIC8vIGFuZCBkb3duIGRlcGVuZGluZyBvbiBhbnkgb2YgaXQncyBjaGFyYWN0ZXIgZGVzY2VuZCBiZWxvdwogICAgICAgICAgICAvLyB0aGUgYmFzZWxpbmUsIGZvciBleGFtcGxlIGEgJ2cnLiBUbyBhZGp1c3QgdGhlIFktcG9zaXRpb24KICAgICAgICAgICAgLy8gd2UgdGhlcmVmb3JlIGFkanVzdCB0aGUgdGV4dCB3aXRoIHRoZSBiYXNlbGluZSBZLW9mZnNldAogICAgICAgICAgICAvLyBhcyB1c2VkIGZvciB0aGUgY3VycmVudCBmb250IGFuZCBzaXplLiBUaGlzIHdpbGwga2VlcCB0aGUKICAgICAgICAgICAgLy8gYmFzZWxpbmUgYXQgYSBmaXhlZCBwb3NpdG9uZWQgZGlzcmVnYXJkaW5nIHRoZSBhY3R1YWwKICAgICAgICAgICAgLy8gY2hhcmFjdGVycyBpbiB0aGUgc3RyaW5nLgogICAgICAgICAgICAkc3RhbmRhcmRib3ggPSAkdGhpcy0+R2V0VFRGQkJveCgnR2cnLCRkaXIpOwogICAgICAgICAgICAkeWFkaiA9ICRzdGFuZGFyZGJveFsxXTsKICAgICAgICAgICAgJHhhZGogPSAkc3RhbmRhcmRib3hbMF07CiAgICAgICAgICAgICRhQm91bmRpbmdCb3ggPSBhcnJheSgpOwogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbmw7ICsrJGkpIHsKICAgICAgICAgICAgICAgICR3bCA9ICR0aGlzLT5HZXRUZXh0V2lkdGgoJHRtcFskaV0pOwogICAgICAgICAgICAgICAgJGJib3ggPSAkdGhpcy0+R2V0VFRGQkJveCgkdG1wWyRpXSwkZGlyKTsKICAgICAgICAgICAgICAgIGlmKCAkcGFyYWdyYXBoX2FsaWduPT0nbGVmdCcgKSB7CiAgICAgICAgICAgICAgICAgICAgJHhsID0gJHg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoICRwYXJhZ3JhcGhfYWxpZ249PSdyaWdodCcgKSB7CiAgICAgICAgICAgICAgICAgICAgJHhsID0gJHggKyAoJHctJHdsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIENlbnRlcgogICAgICAgICAgICAgICAgICAgICR4bCA9ICR4ICsgJHcvMiAtICR3bC8yIDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBJbiB0aGVvcnkgd2Ugc2hvdWxkIGFkanVzdCB3aXRoIGZ1bGwgcHJlLWxlYWQgdG8gZ2V0IHRoZSBsaW5lcwogICAgICAgICAgICAgICAgLy8gbGluZWQgdXAgYnV0IHRoaXMgZG9lc24ndCBsb29rIGdvb2Qgc28gdGhlcmZvcmUgd2Ugb25seSBhZGp1c3Qgd2l0aAogICAgICAgICAgICAgICAgLy8gaGFsZiB0aCBwcmUtbGVhZAogICAgICAgICAgICAgICAgJHhsIC09ICRiYm94WzBdLzI7CiAgICAgICAgICAgICAgICAkeWwgPSAkeSAtICR5YWRqOwogICAgICAgICAgICAgICAgLy8keGwgPSAkeGwtICR4YWRqOwogICAgICAgICAgICAgICAgSW1hZ2VUVEZUZXh0KCR0aGlzLT5pbWcsICR0aGlzLT5mb250X3NpemUsICRkaXIsICR4bCwgJHlsLSgkaC0kZmgpKyRmaCokaSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y3VycmVudF9jb2xvciwkdGhpcy0+Zm9udF9maWxlLCR0bXBbJGldKTsKCiAgICAgICAgICAgICAgIC8vIGVjaG8gInhsPSR4bCwiLiR0bXBbJGldLiIgPGJyPiI7CiAgICAgICAgICAgICAgICBpZiggJGRlYnVnICApIHsKICAgICAgICAgICAgICAgICAgICAvLyBEcmF3IHRoZSBib3VuZGluZyByZWN0YW5nbGUgYXJvdW5kIGVhY2ggbGluZQogICAgICAgICAgICAgICAgICAgICRib3g9QEltYWdlVFRGQkJveCgkdGhpcy0+Zm9udF9zaXplLCRkaXIsJHRoaXMtPmZvbnRfZmlsZSwkdG1wWyRpXSk7CiAgICAgICAgICAgICAgICAgICAgJHAgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgIGZvcigkaj0wOyAkaiA8IDQ7ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHBbXSA9ICRiYm94WyRqKjJdKyR4bDsKICAgICAgICAgICAgICAgICAgICAgICAgJHBbXSA9ICRiYm94WyRqKjIrMV0rJHlsLSgkaC0kZmgpKyRmaCokaTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIERyYXcgYm91bmRpbmcgcmVjdGFuZ2xlCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlB1c2hDb2xvcignZGFya2dyZWVuJyk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlBvbHlnb24oJHAsdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEdldCB0aGUgYm91bmRpbmcgYm94CiAgICAgICAgICAgICRiYm94ID0gJHRoaXMtPkdldEJCb3hUVEYoJHR4dCwkZGlyKTsKICAgICAgICAgICAgZm9yKCRqPTA7ICRqIDwgNDsgKyskaikgewogICAgICAgICAgICAgICAgJGJib3hbJGoqMl0rPSByb3VuZCgkeCk7CiAgICAgICAgICAgICAgICAkYmJveFskaioyKzFdKz0gcm91bmQoJHkgLSAoJGgtJGZoKSAtICR5YWRqKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkYUJvdW5kaW5nQm94ID0gJGJib3g7CgogICAgICAgICAgICBpZiggJGRlYnVnICkgewogICAgICAgICAgICAgICAgLy8gRHJhdyBhIGNyb3NzIGF0IHRoZSBhbmNob3IgcG9pbnQKICAgICAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJ3JlZCcpOwogICAgICAgICAgICAgICAgJHRoaXMtPkxpbmUoJG94LTI1LCRveSwkb3grMjUsJG95KTsKICAgICAgICAgICAgICAgICR0aGlzLT5MaW5lKCRveCwkb3ktMjUsJG94LCRveSsyNSk7CiAgICAgICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlVGV4dCgkeCwkeSwkdHh0LCRkaXI9MCwkcGFyYWdyYXBoX2FsaWduPSJsZWZ0IiwkZGVidWc9ZmFsc2UpIHsKCiAgICAgICAgJHggPSByb3VuZCgkeCk7CiAgICAgICAgJHkgPSByb3VuZCgkeSk7CgogICAgICAgIC8vIERvIHNwZWNpYWwgbGFuZ3VhZ2UgZW5jb2RpbmcKICAgICAgICAkdHh0ID0gJHRoaXMtPmxhbmdjb252LT5Db252ZXJ0KCR0eHQsJHRoaXMtPmZvbnRfZmFtaWx5KTsKCiAgICAgICAgaWYoICFpc19udW1lcmljKCRkaXIpICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5NCk7Ly8oIiBEaXJlY3Rpb24gZm9yIHRleHQgbW9zdCBiZSBnaXZlbiBhcyBhbiBhbmdsZSBiZXR3ZWVuIDAgYW5kIDkwLiIpOwogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT5mb250X2ZhbWlseSA+PSBGRl9GT05UMCAmJiAkdGhpcy0+Zm9udF9mYW1pbHkgPD0gRkZfRk9OVDIrMSkgewogICAgICAgICAgICAkdGhpcy0+X1N0cm9rZUJ1aWx0aW5Gb250KCR4LCR5LCR0eHQsJGRpciwkcGFyYWdyYXBoX2FsaWduLCRib3VuZGluZ2JveCwkZGVidWcpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT5mb250X2ZhbWlseSA+PSBfRklSU1RfRk9OVCAmJiAkdGhpcy0+Zm9udF9mYW1pbHkgPD0gX0xBU1RfRk9OVCkgIHsKICAgICAgICAgICAgJHRoaXMtPl9TdHJva2VUVEYoJHgsJHksJHR4dCwkZGlyLCRwYXJhZ3JhcGhfYWxpZ24sJGJvdW5kaW5nYm94LCRkZWJ1Zyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5NSk7Ly8oIiBVbmtub3duIGZvbnQgZm9udCBmYW1pbHkgc3BlY2lmaWNhdGlvbi4gIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkYm91bmRpbmdib3g7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TWFyZ2luKCRsbSwkcm0sJHRtLCRibSkgewoKICAgICAgICAkdGhpcy0+bGVmdF9tYXJnaW49JGxtOwogICAgICAgICR0aGlzLT5yaWdodF9tYXJnaW49JHJtOwogICAgICAgICR0aGlzLT50b3BfbWFyZ2luPSR0bTsKICAgICAgICAkdGhpcy0+Ym90dG9tX21hcmdpbj0kYm07CgogICAgICAgICR0aGlzLT5wbG90d2lkdGggID0gJHRoaXMtPndpZHRoICAtICR0aGlzLT5sZWZ0X21hcmdpbiAtICR0aGlzLT5yaWdodF9tYXJnaW47CiAgICAgICAgJHRoaXMtPnBsb3RoZWlnaHQgPSAkdGhpcy0+aGVpZ2h0IC0gJHRoaXMtPnRvcF9tYXJnaW4gIC0gJHRoaXMtPmJvdHRvbV9tYXJnaW47CgogICAgICAgIGlmKCAkdGhpcy0+d2lkdGggID4gMCAmJiAkdGhpcy0+aGVpZ2h0ID4gMCApIHsKICAgICAgICAgICAgaWYoICR0aGlzLT5wbG90d2lkdGggPCAwICB8fCAkdGhpcy0+cGxvdGhlaWdodCA8IDAgKSB7CiAgICAgICAgICAgIAlKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEzMCwgJHRoaXMtPnBsb3R3aWR0aCwgJHRoaXMtPnBsb3RoZWlnaHQpOwogICAgICAgICAgICAgICAgLy9KcEdyYXBoRXJyb3I6OnJhaXNlKCJUbyBzbWFsbCBwbG90IGFyZWEuICgkbG0sJHJtLCR0bSwkYm0gOiAkdGhpcy0+cGxvdHdpZHRoIHggJHRoaXMtPnBsb3RoZWlnaHQpLiBXaXRoIHRoZSBnaXZlbiBpbWFnZSBzaXplIGFuZCBtYXJnaW5zIHRoZXJlIGlzIHRvIGxpdHRsZSBzcGFjZSBsZWZ0IGZvciB0aGUgcGxvdC4gSW5jcmVhc2UgdGhlIHBsb3Qgc2l6ZSBvciByZWR1Y2UgdGhlIG1hcmdpbnMuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU2V0VHJhbnNwYXJlbnQoJGNvbG9yKSB7CiAgICAgICAgaW1hZ2Vjb2xvcnRyYW5zcGFyZW50ICgkdGhpcy0+aW1nLCR0aGlzLT5yZ2ItPmFsbG9jYXRlKCRjb2xvcikpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENvbG9yKCRjb2xvciwkYUFscGhhPTApIHsKICAgICAgICAkdGhpcy0+Y3VycmVudF9jb2xvcl9uYW1lID0gJGNvbG9yOwogICAgICAgICR0aGlzLT5jdXJyZW50X2NvbG9yPSR0aGlzLT5yZ2ItPmFsbG9jYXRlKCRjb2xvciwkYUFscGhhKTsKICAgICAgICBpZiggJHRoaXMtPmN1cnJlbnRfY29sb3IgPT0gLTEgKSB7CiAgICAgICAgICAgICR0Yz1pbWFnZWNvbG9yc3RvdGFsKCR0aGlzLT5pbWcpOwogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5Nik7CiAgICAgICAgICAgIC8vKCJDYW4ndCBhbGxvY2F0ZSBhbnkgbW9yZSBjb2xvcnMuIEltYWdlIGhhcyBhbHJlYWR5IGFsbG9jYXRlZCBtYXhpbXVtIG9mIDxiPiR0YyBjb2xvcnM8L2I+LiBUaGlzIG1pZ2h0IGhhcHBlbiBpZiB5b3UgaGF2ZSBhbnRpLWFsaWFzaW5nIHR1cm5lZCBvbiB0b2dldGhlciB3aXRoIGEgYmFja2dyb3VuZCBpbWFnZSBvciBwZXJoYXBzIGdyYWRpZW50IGZpbGwgc2luY2UgdGhpcyByZXF1aXJlcyBtYW55LCBtYW55IGNvbG9ycy4gVHJ5IHRvIHR1cm4gb2ZmIGFudGktYWxpYXNpbmcuIElmIHRoZXJlIGlzIHN0aWxsIGEgcHJvYmxlbSB0cnkgZG93bmdyYWRpbmcgdGhlIHF1YWxpdHkgb2YgdGhlIGJhY2tncm91bmQgaW1hZ2UgdG8gdXNlIGEgc21hbGxlciBwYWxsZXRlIHRvIGxlYXZlIHNvbWUgZW50cmllcyBmb3IgeW91ciBncmFwaHMuIFlvdSBzaG91bGQgdHJ5IHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgY29sb3JzIGluIHlvdXIgYmFja2dyb3VuZCBpbWFnZSB0byA2NC4gSWYgdGhlcmUgaXMgc3RpbGwgcHJvYmxlbSBzZXQgdGhlIGNvbnN0YW50IERFRklORShcIlVTRV9BUFBST1hfQ09MT1JTXCIsdHJ1ZSk7IGluIGpwZ3JhcGgucGhwIFRoaXMgd2lsbCB1c2UgYXBwcm94aW1hdGl2ZSBjb2xvcnMgd2hlbiB0aGUgcGFsZXR0ZSBpcyBmdWxsLiBVbmZvcnR1bmF0ZWx5IHRoZXJlIGlzIG5vdCBtdWNoIEpwR3JhcGggY2FuIGRvIGFib3V0IHRoaXMgc2luY2UgdGhlIHBhbGV0dGUgc2l6ZSBpcyBhIGxpbWl0YXRpb24gb2YgY3VycmVudCBncmFwaGljIGZvcm1hdCBhbmQgd2hhdCB0aGUgdW5kZXJseWluZyBHRCBsaWJyYXJ5IHN1cHBwb3J0cy4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5jdXJyZW50X2NvbG9yOwogICAgfQoKICAgIGZ1bmN0aW9uIFB1c2hDb2xvcigkY29sb3IpIHsKICAgICAgICBpZiggJGNvbG9yICE9ICIiICkgewogICAgICAgICAgICAkdGhpcy0+Y29sb3JzdGFja1skdGhpcy0+Y29sb3JzdGFja2lkeF09JHRoaXMtPmN1cnJlbnRfY29sb3JfbmFtZTsKICAgICAgICAgICAgJHRoaXMtPmNvbG9yc3RhY2tbJHRoaXMtPmNvbG9yc3RhY2tpZHgrMV09JHRoaXMtPmN1cnJlbnRfY29sb3I7CiAgICAgICAgICAgICR0aGlzLT5jb2xvcnN0YWNraWR4Kz0yOwogICAgICAgICAgICAkdGhpcy0+U2V0Q29sb3IoJGNvbG9yKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDk3KTsvLygiQ29sb3Igc3BlY2lmaWVkIGFzIGVtcHR5IHN0cmluZyBpbiBQdXNoQ29sb3IoKS4iKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gUG9wQ29sb3IoKSB7CiAgICAgICAgaWYoICR0aGlzLT5jb2xvcnN0YWNraWR4IDwgMSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwOTgpOy8vKCIgTmVnYXRpdmUgQ29sb3Igc3RhY2sgaW5kZXguIFVubWF0Y2hlZCBjYWxsIHRvIFBvcENvbG9yKCkiKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmN1cnJlbnRfY29sb3I9JHRoaXMtPmNvbG9yc3RhY2tbLS0kdGhpcy0+Y29sb3JzdGFja2lkeF07CiAgICAgICAgJHRoaXMtPmN1cnJlbnRfY29sb3JfbmFtZT0kdGhpcy0+Y29sb3JzdGFja1stLSR0aGlzLT5jb2xvcnN0YWNraWR4XTsKICAgIH0KCgogICAgZnVuY3Rpb24gU2V0TGluZVdlaWdodCgkd2VpZ2h0KSB7CiAgICAgICAgJG9sZCA9ICR0aGlzLT5saW5lX3dlaWdodDsKICAgICAgICBpbWFnZXNldHRoaWNrbmVzcygkdGhpcy0+aW1nLCR3ZWlnaHQpOwogICAgICAgICR0aGlzLT5saW5lX3dlaWdodCA9ICR3ZWlnaHQ7CiAgICAgICAgcmV0dXJuICRvbGQ7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0U3RhcnRQb2ludCgkeCwkeSkgewogICAgICAgICR0aGlzLT5sYXN0eD1yb3VuZCgkeCk7CiAgICAgICAgJHRoaXMtPmxhc3R5PXJvdW5kKCR5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBBcmMoJGN4LCRjeSwkdywkaCwkcywkZSkgewogICAgICAgIC8vIEdEIEFyYyBkb2Vzbid0IGxpa2UgbmVnYXRpdmUgYW5nbGVzCiAgICAgICAgd2hpbGUoICRzIDwgMCkgJHMgKz0gMzYwOwogICAgICAgIHdoaWxlKCAkZSA8IDApICRlICs9IDM2MDsKICAgICAgICBpbWFnZWFyYygkdGhpcy0+aW1nLHJvdW5kKCRjeCkscm91bmQoJGN5KSxyb3VuZCgkdykscm91bmQoJGgpLCRzLCRlLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKICAgIH0KCiAgICBmdW5jdGlvbiBGaWxsZWRBcmMoJHhjLCR5YywkdywkaCwkcywkZSwkc3R5bGU9JycpIHsKICAgICAgICAkcyA9IHJvdW5kKCRzKTsKICAgICAgICAkZSA9IHJvdW5kKCRlKTsKICAgICAgICB3aGlsZSggJHMgPCAwICkgJHMgKz0gMzYwOwogICAgICAgIHdoaWxlKCAkZSA8IDAgKSAkZSArPSAzNjA7CiAgICAgICAgaWYoICRzdHlsZT09JycgKQogICAgICAgICRzdHlsZT1JTUdfQVJDX1BJRTsKICAgICAgICBpZiggYWJzKCRzLSRlKSA+IDAgKSB7CiAgICAgICAgICAgIGltYWdlZmlsbGVkYXJjKCR0aGlzLT5pbWcscm91bmQoJHhjKSxyb3VuZCgkeWMpLHJvdW5kKCR3KSxyb3VuZCgkaCksJHMsJGUsJHRoaXMtPmN1cnJlbnRfY29sb3IsJHN0eWxlKTsKLy8gICAgICAgICAgICAkdGhpcy0+RHJhd0ltYWdlU21vb3RoQXJjKCR0aGlzLT5pbWcscm91bmQoJHhjKSxyb3VuZCgkeWMpLHJvdW5kKCR3KSxyb3VuZCgkaCksJHMsJGUsJHRoaXMtPmN1cnJlbnRfY29sb3IsJHN0eWxlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gRmlsbGVkQ2FrZVNsaWNlKCRjeCwkY3ksJHcsJGgsJHMsJGUpIHsKICAgICAgICAkdGhpcy0+Q2FrZVNsaWNlKCRjeCwkY3ksJHcsJGgsJHMsJGUsJHRoaXMtPmN1cnJlbnRfY29sb3JfbmFtZSk7CiAgICB9CgogICAgZnVuY3Rpb24gQ2FrZVNsaWNlKCR4YywkeWMsJHcsJGgsJHMsJGUsJGZpbGxjb2xvcj0iIiwkYXJjY29sb3I9IiIpIHsKICAgICAgICAkcyA9IHJvdW5kKCRzKTsgJGUgPSByb3VuZCgkZSk7CiAgICAgICAgJHcgPSByb3VuZCgkdyk7ICRoID0gcm91bmQoJGgpOwogICAgICAgICR4YyA9IHJvdW5kKCR4Yyk7ICR5YyA9IHJvdW5kKCR5Yyk7CiAgICAgICAgaWYoICRzID09ICRlICkgewogICAgICAgICAgICAvLyBBIGZ1bGwgY2lyY2xlLiBXZSBkcmF3IHRoaXMgYSBwbGFpbiBjaXJjbGUKICAgICAgICAgICAgJHRoaXMtPlB1c2hDb2xvcigkZmlsbGNvbG9yKTsKICAgICAgICAgICAgaW1hZ2VmaWxsZWRlbGxpcHNlKCR0aGlzLT5pbWcsJHhjLCR5YywyKiR3LDIqJGgsJHRoaXMtPmN1cnJlbnRfY29sb3IpOwoKICAgICAgICAgICAgLy8gSWYgYW50aWFsaWFzaW5nIGlzIHVzZWQgdGhlbiB3ZSBvZnRlbiBkb24ndCBoYXZlIGFueSBjb2xvciBubyB0aGUgc3Vycm91bmRpbmcKICAgICAgICAgICAgLy8gYXJjLiBTbywgd2UgbmVlZCB0byBjaGVjayBmb3IgdGhpcyBzcGVjaWFsIGNhc2Ugc28gd2UgZG9uJ3Qgc2VuZCBhbiBlbXB0eQogICAgICAgICAgICAvLyBjb2xvciB0byB0aGUgcHVzaCBmdW5jdGlvbi4gSW4gdGhpcyBjYXNlIHdlIHVzZSB0aGUgZmlsbCBjb2xvciBmb3IgdGhlIGFyYyBhcyB3ZWxsCiAgICAgICAgICAgIGlmKCAkYXJjY29sb3IgIT0gJycgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJGFyY2NvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbWFnZWVsbGlwc2UoJHRoaXMtPmltZywkeGMsJHljLDIqJHcsMiokaCwkdGhpcy0+Y3VycmVudF9jb2xvcik7CiAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4YywkeWMsY29zKCRzKk1fUEkvMTgwKSokdyskeGMsJHljK3NpbigkcypNX1BJLzE4MCkqJGgpOwogICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJGZpbGxjb2xvcik7CiAgICAgICAgICAgICR0aGlzLT5GaWxsZWRBcmMoJHhjLCR5YywyKiR3LDIqJGgsJHMsJGUpOwogICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgaWYoICRhcmNjb2xvciAhPSAiIiApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJGFyY2NvbG9yKTsKICAgICAgICAgICAgICAgIC8vIFdlIGFkZCAyIHBpeGVscyB0byBtYWtlIHRoZSBBcmMoKSBiZXR0ZXIgYWxpZ25lZCB3aXRoCiAgICAgICAgICAgICAgICAvLyB0aGUgZmlsbGVkIGFyYy4KICAgICAgICAgICAgICAgIGltYWdlZmlsbGVkYXJjKCR0aGlzLT5pbWcsJHhjLCR5YywyKiR3LDIqJGgsJHMsJGUsJHRoaXMtPmN1cnJlbnRfY29sb3IsSU1HX0FSQ19OT0ZJTEwgfCBJTUdfQVJDX0VER0VEICkgOwogICAgICAgICAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gRWxsaXBzZSgkeGMsJHljLCR3LCRoKSB7CiAgICAgICAgJHRoaXMtPkFyYygkeGMsJHljLCR3LCRoLDAsMzYwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBDaXJjbGUoJHhjLCR5YywkcikgewogICAgICAgIGltYWdlZWxsaXBzZSgkdGhpcy0+aW1nLHJvdW5kKCR4Yykscm91bmQoJHljKSwkcioyLCRyKjIsJHRoaXMtPmN1cnJlbnRfY29sb3IpOwovLyAgICAgICAgJHRoaXMtPkRyYXdJbWFnZVNtb290aEFyYygkdGhpcy0+aW1nLHJvdW5kKCR4Yykscm91bmQoJHljKSwkcioyKzEsJHIqMisxLDAsMzYwLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKLy8gICAgICAgICR0aGlzLT5pbWFnZVNtb290aENpcmNsZSgkdGhpcy0+aW1nLCByb3VuZCgkeGMpLHJvdW5kKCR5YyksICRyKjIrMSwgJHRoaXMtPmN1cnJlbnRfY29sb3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIEZpbGxlZENpcmNsZSgkeGMsJHljLCRyKSB7CiAgICAgICAgaW1hZ2VmaWxsZWRlbGxpcHNlKCR0aGlzLT5pbWcscm91bmQoJHhjKSxyb3VuZCgkeWMpLDIqJHIsMiokciwkdGhpcy0+Y3VycmVudF9jb2xvcik7Ci8vICAgICAgICAkdGhpcy0+RHJhd0ltYWdlU21vb3RoQXJjKCR0aGlzLT5pbWcsIHJvdW5kKCR4YyksIHJvdW5kKCR5YyksIDIqJHIsIDIqJHIsIDAsIDM2MCwgJHRoaXMtPmN1cnJlbnRfY29sb3IpOwogICAgfQoKICAgIC8vIExpbmVhciBDb2xvciBJbnRlclBvbGF0aW9uCiAgICBmdW5jdGlvbiBsaXAoJGYsJHQsJHApIHsKICAgICAgICAkcCA9IHJvdW5kKCRwLDEpOwogICAgICAgICRyID0gJGZbMF0gKyAoJHRbMF0tJGZbMF0pKiRwOwogICAgICAgICRnID0gJGZbMV0gKyAoJHRbMV0tJGZbMV0pKiRwOwogICAgICAgICRiID0gJGZbMl0gKyAoJHRbMl0tJGZbMl0pKiRwOwogICAgICAgIHJldHVybiBhcnJheSgkciwkZywkYik7CiAgICB9CgogICAgLy8gU2V0IGxpbmUgc3R5bGUgZGFzaGVkLCBkb3R0ZWQgZXRjCiAgICBmdW5jdGlvbiBTZXRMaW5lU3R5bGUoJHMpIHsKICAgICAgICBpZiggaXNfbnVtZXJpYygkcykgKSB7CiAgICAgICAgICAgIGlmKCAkczwxIHx8ICRzPjQgKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEwMSwkcyk7Ly8oIiBJbGxlZ2FsIG51bWVyaWMgYXJndW1lbnQgdG8gU2V0TGluZVN0eWxlKCk6ICgkcykiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoIGlzX3N0cmluZygkcykgKSB7CiAgICAgICAgICAgIGlmKCAkcyA9PSAic29saWQiICkgJHM9MTsKICAgICAgICAgICAgZWxzZWlmKCAkcyA9PSAiZG90dGVkIiApICRzPTI7CiAgICAgICAgICAgIGVsc2VpZiggJHMgPT0gImRhc2hlZCIgKSAkcz0zOwogICAgICAgICAgICBlbHNlaWYoICRzID09ICJsb25nZGFzaGVkIiApICRzPTQ7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMDIsJHMpOy8vKCIgSWxsZWdhbCBzdHJpbmcgYXJndW1lbnQgdG8gU2V0TGluZVN0eWxlKCk6ICRzIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTAzLCRzKTsvLygiIElsbGVnYWwgYXJndW1lbnQgdG8gU2V0TGluZVN0eWxlICRzIik7CiAgICAgICAgfQogICAgICAgICRvbGQgPSAkdGhpcy0+bGluZV9zdHlsZTsKICAgICAgICAkdGhpcy0+bGluZV9zdHlsZT0kczsKICAgICAgICByZXR1cm4gJG9sZDsKICAgIH0KCiAgICAvLyBTYW1lIGFzIExpbmUgYnV0IHRha2UgdGhlIGxpbmVfc3R5bGUgaW50byBhY2NvdW50CiAgICBmdW5jdGlvbiBTdHlsZUxpbmUoJHgxLCR5MSwkeDIsJHkyLCRhU3R5bGU9JycsICRmcm9tX2dyaWRfY2xhc3MgPSBmYWxzZSkgewogICAgICAgIGlmKCAkdGhpcy0+bGluZV93ZWlnaHQgPD0gMCApIHJldHVybjsKCiAgICAgICAgaWYoICRhU3R5bGUgPT09ICcnICkgewogICAgICAgICAgICAkYVN0eWxlID0gJHRoaXMtPmxpbmVfc3R5bGU7CiAgICAgICAgfQoKICAgICAgICAkZGFzaGVkX2xpbmVfbWV0aG9kID0gJ0Rhc2hlZExpbmUnOwogICAgICAgIGlmICgkZnJvbV9ncmlkX2NsYXNzKSB7CiAgICAgICAgICAgICRkYXNoZWRfbGluZV9tZXRob2QgPSAnRGFzaGVkTGluZUZvckdyaWQnOwogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIGVycm9yIGNoZWNrIHNpbmNlIGRhc2hlZCBsaW5lIHdpbGwgb25seSB3b3JrIGlmIGFudGktYWxpYXMgaXMgZGlzYWJsZWQKICAgICAgICAvLyB0aGlzIGlzIGEgbGltaXRhdGlvbiBpbiBHRAoKICAgICAgICBpZiggJGFTdHlsZSA9PSAxICkgewogICAgICAgICAgICAvLyBTb2xpZCBzdHlsZS4gV2UgY2FuIGhhbmRsZSBhbnRpLWFsaWFzaW5nIGZvciB0aGlzCiAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4MSwkeTEsJHgyLCR5Mik7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBTaW5jZSB0aGUgR0Qgcm91dGluZXMgZG9lc24ndCBoYW5kbGUgQUEgZm9yIHN0eWxlZCBsaW5lCiAgICAgICAgICAgIC8vIHdlIGhhdmUgbm8gb3B0aW9uIHRoYW4gdG8gdHVybiBpdCBvZmYgdG8gZ2V0IGFueSBsaW5lcyBhdAogICAgICAgICAgICAvLyBhbGwgaWYgdGhlIHdlaWdodCA+IDEKICAgICAgICAgICAgJG9sZGFhID0gJHRoaXMtPkdldEFudGlBbGlhc2luZygpOwogICAgICAgICAgICBpZiggJG9sZGFhICYmICR0aGlzLT5saW5lX3dlaWdodCA+IDEgKSB7CiAgICAgICAgICAgICAgICAgJHRoaXMtPlNldEFudGlBbGlhc2luZyhmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCggJGFTdHlsZSApIHsKICAgICAgICAgICAgICAgIGNhc2UgMjogLy8gRG90dGVkCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPiRkYXNoZWRfbGluZV9tZXRob2QoJHgxLCR5MSwkeDIsJHkyLDIsNik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6IC8vIERhc2hlZAogICAgICAgICAgICAgICAgICAgICR0aGlzLT4kZGFzaGVkX2xpbmVfbWV0aG9kKCR4MSwkeTEsJHgyLCR5Miw1LDkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA0OiAvLyBMb25nZGFzaGVzCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPiRkYXNoZWRfbGluZV9tZXRob2QoJHgxLCR5MSwkeDIsJHkyLDksMTMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEwNCwkdGhpcy0+bGluZV9zdHlsZSk7Ly8oIiBVbmtub3duIGxpbmUgc3R5bGU6ICR0aGlzLT5saW5lX3N0eWxlICIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAkb2xkYWEgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+U2V0QW50aUFsaWFzaW5nKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIERhc2hlZExpbmUoJHgxLCR5MSwkeDIsJHkyLCRkYXNoX2xlbmd0aD0xLCRkYXNoX3NwYWNlPTQpIHsKCiAgICAgICAgaWYoICR0aGlzLT5saW5lX3dlaWdodCA8PSAwICkgcmV0dXJuOwoKICAgICAgICAvLyBBZGQgZXJyb3IgY2hlY2sgdG8gbWFrZSBzdXJlIGFudGktYWxpYXMgaXMgbm90IGVuYWJsZWQuCiAgICAgICAgLy8gRGFzaGVkIGxpbmUgZG9lcyBub3Qgd29yayB3aXRoIGFudGktYWxpYXMgZW5hYmxlZC4gVGhpcwogICAgICAgIC8vIGlzIGEgbGltaXRhdGlvbiBpbiBHRC4KICAgICAgICBpZiggJHRoaXMtPnVzZV9hbnRpX2FsaWFzaW5nICkgewovLyAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTI5KTsgLy8gQW50aS1hbGlhcyBjYW4gbm90IGJlIHVzZWQgd2l0aCBkYXNoZWQgbGluZXMuIFBsZWFzZSBkaXNhYmxlIGFudGktYWxpYXMgb3IgdXNlIHNvbGlkIGxpbmVzLgogICAgICAgIH0KICAgICAgICAKICAgICAgICAkeDEgPSByb3VuZCgkeDEpOwogICAgICAgICR4MiA9IHJvdW5kKCR4Mik7CiAgICAgICAgJHkxID0gcm91bmQoJHkxKTsKICAgICAgICAkeTIgPSByb3VuZCgkeTIpOwoKICAgICAgICAkZGFzaF9sZW5ndGggKj0gU1VQRVJTQU1QTElOR19TQ0FMRTsKICAgICAgICAkZGFzaF9zcGFjZSAgKj0gU1VQRVJTQU1QTElOR19TQ0FMRTsKCiAgICAgICAgJHN0eWxlID0gYXJyYXlfZmlsbCgwLCRkYXNoX2xlbmd0aCwkdGhpcy0+Y3VycmVudF9jb2xvcik7CiAgICAgICAgJHN0eWxlID0gYXJyYXlfcGFkKCRzdHlsZSwkZGFzaF9zcGFjZSxJTUdfQ09MT1JfVFJBTlNQQVJFTlQpOwogICAgICAgIGltYWdlc2V0c3R5bGUoJHRoaXMtPmltZywgJHN0eWxlKTsKICAgICAgICBpbWFnZWxpbmUoJHRoaXMtPmltZywgJHgxLCAkeTEsICR4MiwgJHkyLCBJTUdfQ09MT1JfU1RZTEVEKTsKCiAgICAgICAgJHRoaXMtPmxhc3R4ID0gJHgyOwogICAgICAgICR0aGlzLT5sYXN0eSA9ICR5MjsKICAgIH0KCiAgICBmdW5jdGlvbiBEYXNoZWRMaW5lRm9yR3JpZCgkeDEsJHkxLCR4MiwkeTIsJGRhc2hfbGVuZ3RoPTEsJGRhc2hfc3BhY2U9NCkgewoKICAgICAgICBpZiggJHRoaXMtPmxpbmVfd2VpZ2h0IDw9IDAgKSByZXR1cm47CgogICAgICAgIC8vIEFkZCBlcnJvciBjaGVjayB0byBtYWtlIHN1cmUgYW50aS1hbGlhcyBpcyBub3QgZW5hYmxlZC4KICAgICAgICAvLyBEYXNoZWQgbGluZSBkb2VzIG5vdCB3b3JrIHdpdGggYW50aS1hbGlhcyBlbmFibGVkLiBUaGlzCiAgICAgICAgLy8gaXMgYSBsaW1pdGF0aW9uIGluIEdELgogICAgICAgIGlmKCAkdGhpcy0+dXNlX2FudGlfYWxpYXNpbmcgKSB7Ci8vICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMjkpOyAvLyBBbnRpLWFsaWFzIGNhbiBub3QgYmUgdXNlZCB3aXRoIGRhc2hlZCBsaW5lcy4gUGxlYXNlIGRpc2FibGUgYW50aS1hbGlhcyBvciB1c2Ugc29saWQgbGluZXMuCiAgICAgICAgfQogICAgICAgIAogICAgICAgICR4MSA9IHJvdW5kKCR4MSk7CiAgICAgICAgJHgyID0gcm91bmQoJHgyKTsKICAgICAgICAkeTEgPSByb3VuZCgkeTEpOwogICAgICAgICR5MiA9IHJvdW5kKCR5Mik7CiAgICAgICAgCiAgICAgICAgLyoKICAgICAgICAkZGFzaF9sZW5ndGggKj0gJHRoaXMtPnNjYWxlOwogICAgICAgICRkYXNoX3NwYWNlICAqPSAkdGhpcy0+c2NhbGU7CiAgICAgICAgKi8KCiAgICAgICAgJGRhc2hfbGVuZ3RoID0gMjsKICAgICAgICAkZGFzaF9sZW5ndGggPSA0OwogICAgICAgIGltYWdlc2V0dGhpY2tuZXNzKCR0aGlzLT5pbWcsIDEpOwogICAgICAgICRzdHlsZSA9IGFycmF5X2ZpbGwoMCwkZGFzaF9sZW5ndGgsICR0aGlzLT5jdXJyZW50X2NvbG9yKTsgLy9oZXhkZWMoJ0NDQ0NDQycpKTsKICAgICAgICAkc3R5bGUgPSBhcnJheV9wYWQoJHN0eWxlLCRkYXNoX3NwYWNlLElNR19DT0xPUl9UUkFOU1BBUkVOVCk7CiAgICAgICAgaW1hZ2VzZXRzdHlsZSgkdGhpcy0+aW1nLCAkc3R5bGUpOwogICAgICAgIGltYWdlbGluZSgkdGhpcy0+aW1nLCAkeDEsICR5MSwgJHgyLCAkeTIsIElNR19DT0xPUl9TVFlMRUQpOwoKICAgICAgICAkdGhpcy0+bGFzdHggPSAkeDI7CiAgICAgICAgJHRoaXMtPmxhc3R5ID0gJHkyOwogICAgfQoKICAgIGZ1bmN0aW9uIExpbmUoJHgxLCR5MSwkeDIsJHkyKSB7CgogICAgICAgIGlmKCAkdGhpcy0+bGluZV93ZWlnaHQgPD0gMCApIHJldHVybjsKCiAgICAgICAgJHgxID0gcm91bmQoJHgxKTsKICAgICAgICAkeDIgPSByb3VuZCgkeDIpOwogICAgICAgICR5MSA9IHJvdW5kKCR5MSk7CiAgICAgICAgJHkyID0gcm91bmQoJHkyKTsKCiAgICAgICAgaW1hZ2VsaW5lKCR0aGlzLT5pbWcsJHgxLCR5MSwkeDIsJHkyLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKLy8gICAgICAgICR0aGlzLT5EcmF3TGluZSgkdGhpcy0+aW1nLCAkeDEsICR5MSwgJHgyLCAkeTIsICR0aGlzLT5saW5lX3dlaWdodCwgJHRoaXMtPmN1cnJlbnRfY29sb3IpOwogICAgICAgICR0aGlzLT5sYXN0eD0keDI7CiAgICAgICAgJHRoaXMtPmxhc3R5PSR5MjsKICAgIH0KCiAgICBmdW5jdGlvbiBQb2x5Z29uKCRwLCRjbG9zZWQ9RkFMU0UsJGZhc3Q9RkFMU0UpIHsKCiAgICAgICAgaWYoICR0aGlzLT5saW5lX3dlaWdodCA8PSAwICkgcmV0dXJuOwoKICAgICAgICAkbj1jb3VudCgkcCk7CiAgICAgICAgJG9sZHggPSAkcFswXTsKICAgICAgICAkb2xkeSA9ICRwWzFdOwogICAgICAgIGlmKCAkZmFzdCApIHsKICAgICAgICAgICAgZm9yKCAkaT0yOyAkaSA8ICRuOyAkaSs9MiApIHsKICAgICAgICAgICAgICAgIGltYWdlbGluZSgkdGhpcy0+aW1nLCRvbGR4LCRvbGR5LCRwWyRpXSwkcFskaSsxXSwkdGhpcy0+Y3VycmVudF9jb2xvcik7CiAgICAgICAgICAgICAgICAkb2xkeCA9ICRwWyRpXTsKICAgICAgICAgICAgICAgICRvbGR5ID0gJHBbJGkrMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoICRjbG9zZWQgKSB7CiAgICAgICAgICAgICAgICBpbWFnZWxpbmUoJHRoaXMtPmltZywkcFskbioyLTJdLCRwWyRuKjItMV0sJHBbMF0sJHBbMV0sJHRoaXMtPmN1cnJlbnRfY29sb3IpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBmb3IoICRpPTI7ICRpIDwgJG47ICRpKz0yICkgewogICAgICAgICAgICAgICAgJHRoaXMtPlN0eWxlTGluZSgkb2xkeCwkb2xkeSwkcFskaV0sJHBbJGkrMV0pOwogICAgICAgICAgICAgICAgJG9sZHggPSAkcFskaV07CiAgICAgICAgICAgICAgICAkb2xkeSA9ICRwWyRpKzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAkY2xvc2VkICkgewogICAgICAgICAgICAgICAgJHRoaXMtPlN0eWxlTGluZSgkb2xkeCwkb2xkeSwkcFswXSwkcFsxXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gRmlsbGVkUG9seWdvbigkcHRzKSB7CiAgICAgICAgJG49Y291bnQoJHB0cyk7CiAgICAgICAgaWYoICRuID09IDAgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTA1KTsvLygnTlVMTCBkYXRhIHNwZWNpZmllZCBmb3IgYSBmaWxsZWQgcG9seWdvbi4gQ2hlY2sgdGhhdCB5b3VyIGRhdGEgaXMgbm90IE5VTEwuJyk7CiAgICAgICAgfQogICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpKSB7CiAgICAgICAgICAgICRwdHNbJGldID0gcm91bmQoJHB0c1skaV0pOwogICAgICAgIH0KICAgICAgICAkb2xkID0gJHRoaXMtPmxpbmVfd2VpZ2h0OwogICAgICAgIGltYWdlc2V0dGhpY2tuZXNzKCR0aGlzLT5pbWcsMSk7CiAgICAgICAgaW1hZ2VmaWxsZWRwb2x5Z29uKCR0aGlzLT5pbWcsJHB0cyxjb3VudCgkcHRzKS8yLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKICAgICAgICAkdGhpcy0+bGluZV93ZWlnaHQgPSAkb2xkOwogICAgICAgIGltYWdlc2V0dGhpY2tuZXNzKCR0aGlzLT5pbWcsJG9sZCk7CiAgICB9CgogICAgZnVuY3Rpb24gUmVjdGFuZ2xlKCR4bCwkeXUsJHhyLCR5bCkgewogICAgICAgICR0aGlzLT5Qb2x5Z29uKGFycmF5KCR4bCwkeXUsJHhyLCR5dSwkeHIsJHlsLCR4bCwkeWwsJHhsLCR5dSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIEZpbGxlZFJlY3RhbmdsZSgkeGwsJHl1LCR4ciwkeWwpIHsKICAgICAgICAkdGhpcy0+RmlsbGVkUG9seWdvbihhcnJheSgkeGwsJHl1LCR4ciwkeXUsJHhyLCR5bCwkeGwsJHlsKSk7CiAgICB9CgogICAgZnVuY3Rpb24gRmlsbGVkUmVjdGFuZ2xlMigkeGwsJHl1LCR4ciwkeWwsJGNvbG9yMSwkY29sb3IyLCRzdHlsZT0xKSB7CiAgICAgICAgLy8gRmlsbCBhIHJlY3RhbmdsZSB3aXRoIGxpbmVzIG9mIHR3byBjb2xvcnMKICAgICAgICBpZiggJHN0eWxlPT09MSApIHsKICAgICAgICAgICAgLy8gSG9yaXpvbnRhbCBzdHJpcGUKICAgICAgICAgICAgaWYoICR5bCA8ICR5dSApIHsKICAgICAgICAgICAgICAgICR0ID0gJHlsOyAkeWw9JHl1OyAkeXU9JHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKCAkeT0keXU7ICR5IDw9ICR5bDsgKyskeSkgewogICAgICAgICAgICAgICAgJHRoaXMtPlNldENvbG9yKCRjb2xvcjEpOwogICAgICAgICAgICAgICAgJHRoaXMtPkxpbmUoJHhsLCR5LCR4ciwkeSk7CiAgICAgICAgICAgICAgICArKyR5OwogICAgICAgICAgICAgICAgJHRoaXMtPlNldENvbG9yKCRjb2xvcjIpOwogICAgICAgICAgICAgICAgJHRoaXMtPkxpbmUoJHhsLCR5LCR4ciwkeSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCAkeGwgPCAkeGwgKSB7CiAgICAgICAgICAgICAgICAkdCA9ICR4bDsgJHhsPSR4cjsgJHhyPSR0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciggJHg9JHhsOyAkeCA8PSAkeHI7ICsrJHgpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5TZXRDb2xvcigkY29sb3IxKTsKICAgICAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4LCR5dSwkeCwkeWwpOwogICAgICAgICAgICAgICAgKyskeDsKICAgICAgICAgICAgICAgICR0aGlzLT5TZXRDb2xvcigkY29sb3IyKTsKICAgICAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4LCR5dSwkeCwkeWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFNoYWRvd1JlY3RhbmdsZSgkeGwsJHl1LCR4ciwkeWwsJGZjb2xvcj1mYWxzZSwkc2hhZG93X3dpZHRoPTQsJHNoYWRvd19jb2xvcj0nZGFya2dyYXknLCR1c2VBbHBoYT10cnVlKSB7CiAgICAgICAgLy8gVGhpcyBpcyBjb21wbGljYXRlZCBieSB0aGUgZmFjdCB0aGF0IHdlIG11c3QgYWxzbyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUKICAgICAgICAvLyB0aGUgcmVhY3RhbmdsZSBoYXMgbm8gZmlsbCBjb2xvcgogICAgICAgICR4bCA9IGZsb29yKCR4bCk7CiAgICAgICAgJHl1ID0gZmxvb3IoJHl1KTsKICAgICAgICAkeHIgPSBmbG9vcigkeHIpOwogICAgICAgICR5bCA9IGZsb29yKCR5bCk7CiAgICAgICAgJHRoaXMtPlB1c2hDb2xvcigkc2hhZG93X2NvbG9yKTsKICAgICAgICAkc2hhZG93QWxwaGE9MDsKICAgICAgICAkdGhpcy0+U2V0TGluZVdlaWdodCgxKTsKICAgICAgICAkdGhpcy0+U2V0TGluZVN0eWxlKCdzb2xpZCcpOwogICAgICAgICRiYXNlY29sb3IgPSAkdGhpcy0+cmdiLT5Db2xvcigkc2hhZG93X2NvbG9yKTsKICAgICAgICAkc2hhZG93X2NvbG9yID0gYXJyYXkoJGJhc2Vjb2xvclswXSwkYmFzZWNvbG9yWzFdLCRiYXNlY29sb3JbMl0sKTsKICAgICAgICBmb3IoICRpPTA7ICRpIDwgJHNoYWRvd193aWR0aDsgKyskaSApIHsKICAgICAgICAgICAgJHRoaXMtPlNldENvbG9yKCRzaGFkb3dfY29sb3IsJHNoYWRvd0FscGhhKTsKICAgICAgICAgICAgJHRoaXMtPkxpbmUoJHhyLSRzaGFkb3dfd2lkdGgrJGksICAgJHl1KyRzaGFkb3dfd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICR4ci0kc2hhZG93X3dpZHRoKyRpLCAgICR5bC0kc2hhZG93X3dpZHRoLTErJGkpOwogICAgICAgICAgICAkdGhpcy0+TGluZSgkeGwrJHNoYWRvd193aWR0aCwgICAkeWwtJHNoYWRvd193aWR0aCskaSwKICAgICAgICAgICAgICAgICAgICAgICAgJHhyLSRzaGFkb3dfd2lkdGgrJGksICAgJHlsLSRzaGFkb3dfd2lkdGgrJGkpOwogICAgICAgICAgICBpZiggJHVzZUFscGhhICkgJHNoYWRvd0FscGhhICs9IDEuMC8kc2hhZG93X3dpZHRoOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CiAgICAgICAgaWYoICRmY29sb3I9PWZhbHNlICkgewogICAgICAgICAgICAkdGhpcy0+UmVjdGFuZ2xlKCR4bCwkeXUsJHhyLSRzaGFkb3dfd2lkdGgtMSwkeWwtJHNoYWRvd193aWR0aC0xKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5QdXNoQ29sb3IoJGZjb2xvcik7CiAgICAgICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHhsLCR5dSwkeHItJHNoYWRvd193aWR0aC0xLCR5bC0kc2hhZG93X3dpZHRoLTEpOwogICAgICAgICAgICAkdGhpcy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgJHRoaXMtPlJlY3RhbmdsZSgkeGwsJHl1LCR4ci0kc2hhZG93X3dpZHRoLTEsJHlsLSRzaGFkb3dfd2lkdGgtMSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEZpbGxlZFJvdW5kZWRSZWN0YW5nbGUoJHh0LCR5dCwkeHIsJHlsLCRyPTUpIHsKICAgICAgICBpZiggJHI9PTAgKSB7CiAgICAgICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHh0LCR5dCwkeHIsJHlsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gVG8gYXZvaWQgb3ZlcmxhcHBpbmcgZmlsbGluZ3MgKHdoaWNoIHdpbGwgbG9vayBzdHJhbmdlCiAgICAgICAgLy8gd2hlbiBhbHBoYWJsZW5kaW5nIGlzIGVuYWJsZWQpIHdlIGhhdmUgbm8gY2hvaWNlIGJ1dAogICAgICAgIC8vIHRvIGZpbGwgdGhlIGZpdmUgZGlzdGluY3QgYXJlYXMgb25lIGJ5IG9uZS4KCiAgICAgICAgLy8gQ2VudGVyIHNxdWFyZQogICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHh0KyRyLCR5dCskciwkeHItJHIsJHlsLSRyKTsKICAgICAgICAvLyBUb3AgYmFuZAogICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHh0KyRyLCR5dCwkeHItJHIsJHl0KyRyKTsKICAgICAgICAvLyBCb3R0b20gYmFuZAogICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHh0KyRyLCR5bC0kciwkeHItJHIsJHlsKTsKICAgICAgICAvLyBMZWZ0IGJhbmQKICAgICAgICAkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4dCwkeXQrJHIsJHh0KyRyLCR5bC0kcik7CiAgICAgICAgLy8gUmlnaHQgYmFuZAogICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHhyLSRyLCR5dCskciwkeHIsJHlsLSRyKTsKCiAgICAgICAgLy8gVG9wbGVmdCAmIFRvcHJpZ2h0IGFyYwogICAgICAgICR0aGlzLT5GaWxsZWRBcmMoJHh0KyRyLCR5dCskciwkcioyLCRyKjIsMTgwLDI3MCk7CiAgICAgICAgJHRoaXMtPkZpbGxlZEFyYygkeHItJHIsJHl0KyRyLCRyKjIsJHIqMiwyNzAsMzYwKTsKCiAgICAgICAgLy8gQm90dG9tbGVmdCAmIEJvdHRvbSByaWdodCBhcmMKICAgICAgICAkdGhpcy0+RmlsbGVkQXJjKCR4dCskciwkeWwtJHIsJHIqMiwkcioyLDkwLDE4MCk7CiAgICAgICAgJHRoaXMtPkZpbGxlZEFyYygkeHItJHIsJHlsLSRyLCRyKjIsJHIqMiwwLDkwKTsKCiAgICB9CgogICAgZnVuY3Rpb24gUm91bmRlZFJlY3RhbmdsZSgkeHQsJHl0LCR4ciwkeWwsJHI9NSkgewoKICAgICAgICBpZiggJHI9PTAgKSB7CiAgICAgICAgICAgICR0aGlzLT5SZWN0YW5nbGUoJHh0LCR5dCwkeHIsJHlsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gVG9wICYgQm90dG9tIGxpbmUKICAgICAgICAkdGhpcy0+TGluZSgkeHQrJHIsJHl0LCR4ci0kciwkeXQpOwogICAgICAgICR0aGlzLT5MaW5lKCR4dCskciwkeWwsJHhyLSRyLCR5bCk7CgogICAgICAgIC8vIExlZnQgJiBSaWdodCBsaW5lCiAgICAgICAgJHRoaXMtPkxpbmUoJHh0LCR5dCskciwkeHQsJHlsLSRyKTsKICAgICAgICAkdGhpcy0+TGluZSgkeHIsJHl0KyRyLCR4ciwkeWwtJHIpOwoKICAgICAgICAvLyBUb3BsZWZ0ICYgVG9wcmlnaHQgYXJjCiAgICAgICAgJHRoaXMtPkFyYygkeHQrJHIsJHl0KyRyLCRyKjIsJHIqMiwxODAsMjcwKTsKICAgICAgICAkdGhpcy0+QXJjKCR4ci0kciwkeXQrJHIsJHIqMiwkcioyLDI3MCwzNjApOwoKICAgICAgICAvLyBCb3R0b21sZWZ0ICYgQm90dG9tcmlnaHQgYXJjCiAgICAgICAgJHRoaXMtPkFyYygkeHQrJHIsJHlsLSRyLCRyKjIsJHIqMiw5MCwxODApOwogICAgICAgICR0aGlzLT5BcmMoJHhyLSRyLCR5bC0kciwkcioyLCRyKjIsMCw5MCk7CiAgICB9CgogICAgZnVuY3Rpb24gRmlsbGVkQmV2ZWwoJHgxLCR5MSwkeDIsJHkyLCRkZXB0aD0yLCRjb2xvcjE9J3doaXRlQDAuNCcsJGNvbG9yMj0nZGFya2dyYXlAMC40JykgewogICAgICAgICR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHgxLCR5MSwkeDIsJHkyKTsKICAgICAgICAkdGhpcy0+QmV2ZWwoJHgxLCR5MSwkeDIsJHkyLCRkZXB0aCwkY29sb3IxLCRjb2xvcjIpOwogICAgfQoKICAgIGZ1bmN0aW9uIEJldmVsKCR4MSwkeTEsJHgyLCR5MiwkZGVwdGg9MiwkY29sb3IxPSd3aGl0ZUAwLjQnLCRjb2xvcjI9J2JsYWNrQDAuNScpIHsKICAgICAgICAkdGhpcy0+UHVzaENvbG9yKCRjb2xvcjEpOwogICAgICAgIGZvciggJGk9MDsgJGkgPCAkZGVwdGg7ICsrJGkgKSB7CiAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4MSskaSwkeTErJGksJHgxKyRpLCR5Mi0kaSk7CiAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4MSskaSwkeTErJGksJHgyLSRpLCR5MSskaSk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5Qb3BDb2xvcigpOwoKICAgICAgICAkdGhpcy0+UHVzaENvbG9yKCRjb2xvcjIpOwogICAgICAgIGZvciggJGk9MDsgJGkgPCAkZGVwdGg7ICsrJGkgKSB7CiAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4MSskaSwkeTItJGksJHgyLSRpLCR5Mi0kaSk7CiAgICAgICAgICAgICR0aGlzLT5MaW5lKCR4Mi0kaSwkeTErJGksJHgyLSRpLCR5Mi0kaS0xKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPlBvcENvbG9yKCk7CiAgICB9CgogICAgZnVuY3Rpb24gU3R5bGVMaW5lVG8oJHgsJHkpIHsKICAgICAgICAkdGhpcy0+U3R5bGVMaW5lKCR0aGlzLT5sYXN0eCwkdGhpcy0+bGFzdHksJHgsJHkpOwogICAgICAgICR0aGlzLT5sYXN0eD0keDsKICAgICAgICAkdGhpcy0+bGFzdHk9JHk7CiAgICB9CgogICAgZnVuY3Rpb24gTGluZVRvKCR4LCR5KSB7CiAgICAgICAgJHRoaXMtPkxpbmUoJHRoaXMtPmxhc3R4LCR0aGlzLT5sYXN0eSwkeCwkeSk7CiAgICAgICAgJHRoaXMtPmxhc3R4PSR4OwogICAgICAgICR0aGlzLT5sYXN0eT0keTsKICAgIH0KCiAgICBmdW5jdGlvbiBQb2ludCgkeCwkeSkgewogICAgICAgIGltYWdlc2V0cGl4ZWwoJHRoaXMtPmltZyxyb3VuZCgkeCkscm91bmQoJHkpLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsKICAgIH0KCiAgICBmdW5jdGlvbiBGaWxsKCR4LCR5KSB7CiAgICAgICAgaW1hZ2VmaWxsKCR0aGlzLT5pbWcscm91bmQoJHgpLHJvdW5kKCR5KSwkdGhpcy0+Y3VycmVudF9jb2xvcik7CiAgICB9CgogICAgZnVuY3Rpb24gRmlsbFRvQm9yZGVyKCR4LCR5LCRhQm9yZENvbG9yKSB7CiAgICAgICAgJGJjID0gJHRoaXMtPnJnYi0+YWxsb2NhdGUoJGFCb3JkQ29sb3IpOwogICAgICAgIGlmKCAkYmMgPT0gLTEgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTA2KTsvLygnSW1hZ2U6OkZpbGxUb0JvcmRlciA6IENhbiBub3QgYWxsb2NhdGUgbW9yZSBjb2xvcnMnKTsKICAgICAgICB9CiAgICAgICAgaW1hZ2VmaWxsdG9ib3JkZXIoJHRoaXMtPmltZyxyb3VuZCgkeCkscm91bmQoJHkpLCRiYywkdGhpcy0+Y3VycmVudF9jb2xvcik7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0RXhwaXJlZCgkYUZsZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmV4cGlyZWQgPSAkYUZsZzsKICAgIH0KCiAgICAvLyBHZW5lcmF0ZSBpbWFnZSBoZWFkZXIKICAgIGZ1bmN0aW9uIEhlYWRlcnMoKSB7CgogICAgICAgIC8vIEluIGNhc2Ugd2UgYXJlIHJ1bm5pbmcgZnJvbSB0aGUgY29tbWFuZCBsaW5lIHdpdGggdGhlIGNsaWVudCB2ZXJzaW9uIG9mCiAgICAgICAgLy8gUEhQIHdlIGNhbid0IHNlbmQgYW55IGhlYWRlcnMuCiAgICAgICAgJHNhcGkgPSBwaHBfc2FwaV9uYW1lKCk7CiAgICAgICAgaWYoICRzYXBpID09ICdjbGknICkgcmV0dXJuOwoKICAgICAgICAvLyBUaGVzZSBwYXJhbWV0ZXJzIGFyZSBzZXQgYnkgaGVhZGVyc19zZW50KCkgYnV0IHRoZXkgbWlnaHQgY2F1c2UKICAgICAgICAvLyBhbiB1bmRlZmluZWQgdmFyaWFibGUgZXJyb3IgdW5sZXNzIHRoZXkgYXJlIGluaXRpbGl6ZWQKICAgICAgICAkZmlsZT0nJzsKICAgICAgICAkbGluZW5vPScnOwogICAgICAgIGlmKCBoZWFkZXJzX3NlbnQoJGZpbGUsJGxpbmVubykgKSB7CiAgICAgICAgICAgICRmaWxlPWJhc2VuYW1lKCRmaWxlKTsKICAgICAgICAgICAgJHQgPSBuZXcgRXJyTXNnVGV4dCgpOwogICAgICAgICAgICAkbXNnID0gJHQtPkdldCgxMCwkZmlsZSwkbGluZW5vKTsKICAgICAgICAgICAgZGllKCRtc2cpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5leHBpcmVkKSB7CiAgICAgICAgICAgIGhlYWRlcigiRXhwaXJlczogTW9uLCAyNiBKdWwgMTk5NyAwNTowMDowMCBHTVQiKTsKICAgICAgICAgICAgaGVhZGVyKCJMYXN0LU1vZGlmaWVkOiAiIC4gZ21kYXRlKCJELCBkIE0gWSBIOmk6cyIpIC4gIkdNVCIpOwogICAgICAgICAgICBoZWFkZXIoIkNhY2hlLUNvbnRyb2w6IG5vLWNhY2hlLCBtdXN0LXJldmFsaWRhdGUiKTsKICAgICAgICAgICAgaGVhZGVyKCJQcmFnbWE6IG5vLWNhY2hlIik7CiAgICAgICAgfQogICAgICAgIGhlYWRlcigiQ29udGVudC10eXBlOiBpbWFnZS8kdGhpcy0+aW1nX2Zvcm1hdCIpOwogICAgfQoKICAgIC8vIEFkanVzdCBpbWFnZSBxdWFsaXR5IGZvciBmb3JtYXRzIHRoYXQgYWxsb3cgdGhpcwogICAgZnVuY3Rpb24gU2V0UXVhbGl0eSgkcSkgewogICAgICAgICR0aGlzLT5xdWFsaXR5ID0gJHE7CiAgICB9CgogICAgLy8gU3RyZWFtIGltYWdlIHRvIGJyb3dzZXIgb3IgdG8gZmlsZQogICAgZnVuY3Rpb24gU3RyZWFtKCRhRmlsZT0iIikgewogICAgICAgICR0aGlzLT5Eb1N1cGVyc2FtcGxpbmcoKTsKCiAgICAgICAgJGZ1bmM9ImltYWdlIi4kdGhpcy0+aW1nX2Zvcm1hdDsKICAgICAgICBpZiggJHRoaXMtPmltZ19mb3JtYXQ9PSJqcGVnIiAmJiAkdGhpcy0+cXVhbGl0eSAhPSBudWxsICkgewogICAgICAgICAgICAkcmVzID0gQCRmdW5jKCR0aGlzLT5pbWcsJGFGaWxlLCR0aGlzLT5xdWFsaXR5KTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCAkYUZpbGUgIT0gIiIgKSB7CiAgICAgICAgICAgICAgICAkcmVzID0gQCRmdW5jKCR0aGlzLT5pbWcsJGFGaWxlKTsKICAgICAgICAgICAgICAgIGlmKCAhJHJlcyApIHsKICAgICAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEwNywkYUZpbGUpOy8vKCJDYW4ndCB3cml0ZSB0byBmaWxlICckYUZpbGUnLiBDaGVjayB0aGF0IHRoZSBwcm9jZXNzIHJ1bm5pbmcgUEhQIGhhcyBlbm91Z2ggcGVybWlzc2lvbi4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRyZXMgPSBAJGZ1bmMoJHRoaXMtPmltZyk7CiAgICAgICAgICAgICAgICBpZiggISRyZXMgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMDgpOy8vKCJDYW4ndCBzdHJlYW0gaW1hZ2UuIFRoaXMgaXMgbW9zdCBsaWtlbHkgZHVlIHRvIGEgZmF1bHR5IFBIUC9HRCBzZXR1cC4gVHJ5IHRvIHJlY29tcGlsZSBQSFAgYW5kIHVzZSB0aGUgYnVpbHQtaW4gR0QgbGlicmFyeSB0aGF0IGNvbWVzIHdpdGggUEhQLiIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBEbyBTdXBlclNhbXBsaW5nIHVzaW5nICRzY2FsZQogICAgZnVuY3Rpb24gRG9TdXBlcnNhbXBsaW5nKCkgewogICAgICAgIGlmIChTVVBFUlNBTVBMSU5HX1NDQUxFIDw9IDEpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5pbWc7CiAgICAgICAgfQoKICAgICAgICAkZHN0X2ltZyA9IEBpbWFnZWNyZWF0ZXRydWVjb2xvcigkdGhpcy0+b3JpZ2luYWxfd2lkdGgsICR0aGlzLT5vcmlnaW5hbF9oZWlnaHQpOwogICAgICAgIGltYWdlY29weXJlc2FtcGxlZCgkZHN0X2ltZywgJHRoaXMtPmltZywgMCwgMCwgMCwgMCwgJHRoaXMtPm9yaWdpbmFsX3dpZHRoLCAkdGhpcy0+b3JpZ2luYWxfaGVpZ2h0LCAkdGhpcy0+d2lkdGgsICR0aGlzLT5oZWlnaHQpOwogICAgICAgICR0aGlzLT5EZXN0cm95KCk7CiAgICAgICAgcmV0dXJuICR0aGlzLT5pbWcgPSAkZHN0X2ltZzsKICAgIH0KCiAgICAvLyBDbGVhciByZXNvdXJjZXMgdXNlZCBieSBpbWFnZSAodGhpcyBpcyBub3JtYWxseSBub3QgdXNlZCBzaW5jZSBhbGwgcmVzb3VyY2VzIGFyZS9zaG91bGQgYmUKICAgIC8vIHJldHVybmVkIHdoZW4gdGhlIHNjcmlwdCB0ZXJtaW5hdGVzCiAgICBmdW5jdGlvbiBEZXN0cm95KCkgewogICAgICAgIGltYWdlZGVzdHJveSgkdGhpcy0+aW1nKTsKICAgIH0KCiAgICAvLyBTcGVjaWZ5IGltYWdlIGZvcm1hdC4gTm90ZSBkZXBlbmRpbmcgb24geW91ciBpbnN0YWxsYXRpb24KICAgIC8vIG9mIFBIUCBub3QgYWxsIGZvcm1hdHMgbWF5IGJlIHN1cHBvcnRlZC4KICAgIGZ1bmN0aW9uIFNldEltZ0Zvcm1hdCgkYUZvcm1hdCwkYVF1YWxpdHk9NzUpIHsKICAgICAgICAkdGhpcy0+cXVhbGl0eSA9ICRhUXVhbGl0eTsKICAgICAgICAkYUZvcm1hdCA9IHN0cnRvbG93ZXIoJGFGb3JtYXQpOwogICAgICAgICR0c3QgPSB0cnVlOwogICAgICAgICRzdXBwb3J0ZWQgPSBpbWFnZXR5cGVzKCk7CiAgICAgICAgaWYoICRhRm9ybWF0PT0iYXV0byIgKSB7CiAgICAgICAgICAgIGlmKCAkc3VwcG9ydGVkICYgSU1HX1BORyApICAgICAgJHRoaXMtPmltZ19mb3JtYXQ9InBuZyI7CiAgICAgICAgICAgIGVsc2VpZiggJHN1cHBvcnRlZCAmIElNR19KUEcgKSAgJHRoaXMtPmltZ19mb3JtYXQ9ImpwZWciOwogICAgICAgICAgICBlbHNlaWYoICRzdXBwb3J0ZWQgJiBJTUdfR0lGICkgICR0aGlzLT5pbWdfZm9ybWF0PSJnaWYiOwogICAgICAgICAgICBlbHNlaWYoICRzdXBwb3J0ZWQgJiBJTUdfV0JNUCApICR0aGlzLT5pbWdfZm9ybWF0PSJ3Ym1wIjsKICAgICAgICAgICAgZWxzZWlmKCAkc3VwcG9ydGVkICYgSU1HX1hQTSApICAkdGhpcy0+aW1nX2Zvcm1hdD0ieHBtIjsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEwOSk7Ly8oIllvdXIgUEhQIChhbmQgR0QtbGliKSBpbnN0YWxsYXRpb24gZG9lcyBub3QgYXBwZWFyIHRvIHN1cHBvcnQgYW55IGtub3duIGdyYXBoaWMgZm9ybWF0cy4gWW91IG5lZWQgdG8gZmlyc3QgbWFrZSBzdXJlIEdEIGlzIGNvbXBpbGVkIGFzIGEgbW9kdWxlIHRvIFBIUC4gSWYgeW91IGFsc28gd2FudCB0byB1c2UgSlBFRyBpbWFnZXMgeW91IG11c3QgZ2V0IHRoZSBKUEVHIGxpYnJhcnkuIFBsZWFzZSBzZWUgdGhlIFBIUCBkb2NzIGZvciBkZXRhaWxzLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoICRhRm9ybWF0PT0ianBlZyIgfHwgJGFGb3JtYXQ9PSJwbmciIHx8ICRhRm9ybWF0PT0iZ2lmIiApIHsKICAgICAgICAgICAgICAgIGlmKCAkYUZvcm1hdD09ImpwZWciICYmICEoJHN1cHBvcnRlZCAmIElNR19KUEcpICkgICAgICAgJHRzdD1mYWxzZTsKICAgICAgICAgICAgICAgIGVsc2VpZiggJGFGb3JtYXQ9PSJwbmciICYmICEoJHN1cHBvcnRlZCAmIElNR19QTkcpICkgICAgJHRzdD1mYWxzZTsKICAgICAgICAgICAgICAgIGVsc2VpZiggJGFGb3JtYXQ9PSJnaWYiICYmICEoJHN1cHBvcnRlZCAmIElNR19HSUYpICkgICAgJHRzdD1mYWxzZTsKICAgICAgICAgICAgICAgIGVsc2VpZiggJGFGb3JtYXQ9PSJ3Ym1wIiAmJiAhKCRzdXBwb3J0ZWQgJiBJTUdfV0JNUCkgKSAgJHRzdD1mYWxzZTsKICAgICAgICAgICAgICAgIGVsc2VpZiggJGFGb3JtYXQ9PSJ4cG0iICYmICEoJHN1cHBvcnRlZCAmIElNR19YUE0pICkgICAgJHRzdD1mYWxzZTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWdfZm9ybWF0PSRhRm9ybWF0OwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHRzdD1mYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggISR0c3QgKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTExMCwkYUZvcm1hdCk7Ly8oIiBZb3VyIFBIUCBpbnN0YWxsYXRpb24gZG9lcyBub3Qgc3VwcG9ydCB0aGUgY2hvc2VuIGdyYXBoaWMgZm9ybWF0OiAkYUZvcm1hdCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBEcmF3IExpbmUKICAgICovCiAgICBmdW5jdGlvbiBEcmF3TGluZSgkaW0sICR4MSwgJHkxLCAkeDIsICR5MiwgJHdlaWdodCwgJGNvbG9yKSB7CiAgICAgICAgaWYgKCR3ZWlnaHQgPT0gMSkgewogICAgICAgICAgICByZXR1cm4gaW1hZ2VsaW5lKCRpbSwkeDEsJHkxLCR4MiwkeTIsJGNvbG9yKTsKICAgICAgICB9CgogICAgICAgICRhbmdsZT0oYXRhbjIoKCR5MSAtICR5MiksICgkeDIgLSAkeDEpKSk7IAoKICAgICAgICAkZGlzdF94ID0gJHdlaWdodCAqIChzaW4oJGFuZ2xlKSkgLyAyOwogICAgICAgICRkaXN0X3kgPSAkd2VpZ2h0ICogKGNvcygkYW5nbGUpKSAvIDI7CiAgICAgICAgCiAgICAgICAgJHAxeD1jZWlsKCgkeDEgKyAkZGlzdF94KSk7CiAgICAgICAgJHAxeT1jZWlsKCgkeTEgKyAkZGlzdF95KSk7CiAgICAgICAgJHAyeD1jZWlsKCgkeDIgKyAkZGlzdF94KSk7CiAgICAgICAgJHAyeT1jZWlsKCgkeTIgKyAkZGlzdF95KSk7CiAgICAgICAgJHAzeD1jZWlsKCgkeDIgLSAkZGlzdF94KSk7CiAgICAgICAgJHAzeT1jZWlsKCgkeTIgLSAkZGlzdF95KSk7CiAgICAgICAgJHA0eD1jZWlsKCgkeDEgLSAkZGlzdF94KSk7CiAgICAgICAgJHA0eT1jZWlsKCgkeTEgLSAkZGlzdF95KSk7CgogICAgICAgICRhcnJheT1hcnJheSgkcDF4LCRwMXksJHAyeCwkcDJ5LCRwM3gsJHAzeSwkcDR4LCRwNHkpOwogICAgICAgIGltYWdlZmlsbGVkcG9seWdvbiAoICRpbSwgJGFycmF5LCAoY291bnQoJGFycmF5KS8yKSwgJGNvbG9yICk7CgogICAgICAgIC8vIGZvciBhbnRpYWxpYXMKICAgICAgICBpbWFnZWxpbmUoJGltLCAkcDF4LCAkcDF5LCAkcDJ4LCAkcDJ5LCAkY29sb3IpOwogICAgICAgIGltYWdlbGluZSgkaW0sICRwM3gsICRwM3ksICRwNHgsICRwNHksICRjb2xvcik7CiAgICAgICAgcmV0dXJuOwoKCgogICAgICAgICAgcmV0dXJuIGltYWdlbGluZSgkdGhpcy0+aW1nLCR4MSwkeTEsJHgyLCR5MiwkdGhpcy0+Y3VycmVudF9jb2xvcik7CiAgICAgICR3ZWlnaHQgPSA4OwogICAgICAgIGlmICgkd2VpZ2h0IDw9IDEpIHsKICAgICAgICAgIHJldHVybiBpbWFnZWxpbmUoJHRoaXMtPmltZywkeDEsJHkxLCR4MiwkeTIsJHRoaXMtPmN1cnJlbnRfY29sb3IpOwogICAgICAgIH0KCiAgICAgICAgJHB0cyA9IGFycmF5KCk7CgogICAgICAgICR3ZWlnaHQgLz0gMjsKCiAgICAgICAgaWYgKCR5MiAtICR5MSA9PSAwKSB7CiAgICAgICAgICAgIC8vIHggbGluZQogICAgICAgICAgICAkcHRzID0gYXJyYXkoKTsKICAgICAgICAgICAgJHB0c1tdID0gJHgxOyAkcHRzW10gPSAkeTEgLSAkd2VpZ2h0OwogICAgICAgICAgICAkcHRzW10gPSAkeDE7ICRwdHNbXSA9ICR5MSArICR3ZWlnaHQ7CiAgICAgICAgICAgICRwdHNbXSA9ICR4MjsgJHB0c1tdID0gJHkyICsgJHdlaWdodDsKICAgICAgICAgICAgJHB0c1tdID0gJHgyOyAkcHRzW10gPSAkeTIgLSAkd2VpZ2h0OwoKICAgICAgICB9IGVsc2VpZiAoJHgyIC0gJHgxID09IDApIHsKICAgICAgICAgICAgLy8geSBsaW5lCiAgICAgICAgICAgICRwdHMgPSBhcnJheSgpOwogICAgICAgICAgICAkcHRzW10gPSAkeDEgLSAkd2VpZ2h0OyAkcHRzW10gPSAkeTE7CiAgICAgICAgICAgICRwdHNbXSA9ICR4MSArICR3ZWlnaHQ7ICRwdHNbXSA9ICR5MTsKICAgICAgICAgICAgJHB0c1tdID0gJHgyICsgJHdlaWdodDsgJHB0c1tdID0gJHkyOwogICAgICAgICAgICAkcHRzW10gPSAkeDIgLSAkd2VpZ2h0OyAkcHRzW10gPSAkeTI7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXJfZHVtcCgkeDEsICR4MiwgJHkxLCAkeTIpOwogICAgICAgICAgICAkbGVuZ3RoID0gc3FydChwb3coJHgyIC0gJHgxLCAyKSArIHBvdygkeTIgLSAkeTEsIDIpKTsKICAgICAgICAgICAgdmFyX2R1bXAoJGxlbmd0aCk7ZXhpdDsKICAgICAgICAgICAgZXhpdDsKICAKLyoKICAgICAgICAgICAgJGxlYW4gPSAoJHkyIC0gJHkxKSAvICgkeDIgLSAkeDEpOwogICAgICAgICAgICAkbGVhbjIgPSAtMSAvICRsZWFuOwogICAgICAgICAgICAkc2luID0gJGxlYW4gLyAoJHkyIC0gJHkxKTsKICAgICAgICAgICAgJGNvcyA9ICRsZWFuIC8gKCR4MiAtICR4MSk7CgogICAgICAgICAgICAkcHRzW10gPSAkeDEgKyAoLSR3ZWlnaHQgKiAkc2luKTsgJHB0c1tdID0gJHkxICsgKC0kd2VpZ2h0ICogJGNvcyk7CiAgICAgICAgICAgICRwdHNbXSA9ICR4MSArICgrJHdlaWdodCAqICRzaW4pOyAkcHRzW10gPSAkeTEgKyAoKyR3ZWlnaHQgKiAkY29zKTsKICAgICAgICAgICAgJHB0c1tdID0gJHgyICsgKCskd2VpZ2h0ICogJHNpbik7ICRwdHNbXSA9ICR5MiArICgrJHdlaWdodCAqICRjb3MpOwogICAgICAgICAgICAkcHRzW10gPSAkeDIgKyAoLSR3ZWlnaHQgKiAkc2luKTsgJHB0c1tdID0gJHkyICsgKC0kd2VpZ2h0ICogJGNvcyk7CiovCiAgICAgICAgfQoKLy9wcmludF9yKCRwdHMpO2V4aXQ7CiAgICAgICAgaWYgKGNvdW50KCRwdHMpLzIgPCAzKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IAoKICAgICAgICBpbWFnZXNldHRoaWNrbmVzcygkaW0sIDEpOwogICAgICAgIGltYWdlZmlsbGVkcG9seWdvbigkaW0sICRwdHMsY291bnQoJHB0cykvMiwgJGNvbG9yKTsKCgogICAgICAgICR3ZWlnaHQgKj0gMjsKCi8vICAgICAgICAkdGhpcy0+RHJhd0ltYWdlU21vb3RoQXJjKCRpbSwgJHgxLCAkeTEsICR3ZWlnaHQsICR3ZWlnaHQsIDAsIDM2MCwgJGNvbG9yKTsKLy8gICAgICAgICR0aGlzLT5EcmF3SW1hZ2VTbW9vdGhBcmMoJGltLCAkeDIsICR5MiwgJHdlaWdodCwgJHdlaWdodCwgMCwgMzYwLCAkY29sb3IpOwogICAgfQoKCiAgICBmdW5jdGlvbiBEcmF3SW1hZ2VTbW9vdGhBcmMoJGltLCAkeGMsICR5YywgJHcsICRoLCAkcywgJGUsICRjb2xvciwgJHN0eWxlID0gbnVsbCkgewogICAgICAgICR0bXAgPSAkczsKICAgICAgICAkcyA9ICgzNjAgLSAkZSkgLyAxODAgKiBNX1BJOwogICAgICAgICRlID0gKDM2MCAtICR0bXApIC8gMTgwICogTV9QSTsKICAgICAgICByZXR1cm4gaW1hZ2VTbW9vdGhBcmMoJGltLCByb3VuZCgkeGMpLCByb3VuZCgkeWMpLCByb3VuZCgkdyksIHJvdW5kKCRoKSwgJHRoaXMtPkNyZWF0ZUNvbG9yRm9ySW1hZ2VTbW9vdGhBcmMoJGNvbG9yKSwgJHMsICRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBDcmVhdGVDb2xvckZvckltYWdlU21vb3RoQXJjKCRjb2xvcikgewogICAgICAgICRhbHBoYSA9ICRjb2xvciA+PiAyNCAmIDB4RkY7IAogICAgICAgICRyZWQgICA9ICRjb2xvciA+PiAxNiAmIDB4RkY7CiAgICAgICAgJGdyZWVuID0gJGNvbG9yID4+IDggJiAweEZGOwogICAgICAgICRibHVlICA9ICRjb2xvciAmIDB4RkY7CgovL3Zhcl9kdW1wKCRhbHBoYSwgJHJlZCwgJGdyZWVuLCAkYmx1ZSk7ZXhpdDsKCiAgICAgICAgcmV0dXJuIGFycmF5KCRyZWQsICRncmVlbiwgJGJsdWUsICRhbHBoYSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW1hZ2VTbW9vdGhDaXJjbGUoICYkaW1nLCAkY3gsICRjeSwgJGNyLCAkY29sb3IgKSB7CiAgICAgICAgJGlyID0gJGNyOwogICAgICAgICRpeCA9IDA7CiAgICAgICAgJGl5ID0gJGlyOwogICAgICAgICRpZyA9IDIgKiAkaXIgLSAzOwogICAgICAgICRpZGdyID0gLTY7CiAgICAgICAgJGlkZ2QgPSA0ICogJGlyIC0gMTA7CiAgICAgICAgJGZpbGwgPSBpbWFnZUNvbG9yRXhhY3RBbHBoYSggJGltZywgJGNvbG9yWyAnUicgXSwgJGNvbG9yWyAnRycgXSwgJGNvbG9yWyAnQicgXSwgMCApOwogICAgICAgIGltYWdlTGluZSggJGltZywgJGN4ICsgJGNyIC0gMSwgJGN5LCAkY3gsICRjeSwgJGZpbGwgKTsKICAgICAgICBpbWFnZUxpbmUoICRpbWcsICRjeCAtICRjciArIDEsICRjeSwgJGN4IC0gMSwgJGN5LCAkZmlsbCApOwogICAgICAgIGltYWdlTGluZSggJGltZywgJGN4LCAkY3kgKyAkY3IgLSAxLCAkY3gsICRjeSArIDEsICRmaWxsICk7CiAgICAgICAgaW1hZ2VMaW5lKCAkaW1nLCAkY3gsICRjeSAtICRjciArIDEsICRjeCwgJGN5IC0gMSwgJGZpbGwgKTsKICAgICAgICAkZHJhdyA9IGltYWdlQ29sb3JFeGFjdEFscGhhKCAkaW1nLCAkY29sb3JbICdSJyBdLCAkY29sb3JbICdHJyBdLCAkY29sb3JbICdCJyBdLCA0MiApOwogICAgICAgIGltYWdlU2V0UGl4ZWwoICRpbWcsICRjeCArICRjciwgJGN5LCAkZHJhdyApOwogICAgICAgIGltYWdlU2V0UGl4ZWwoICRpbWcsICRjeCAtICRjciwgJGN5LCAkZHJhdyApOwogICAgICAgIGltYWdlU2V0UGl4ZWwoICRpbWcsICRjeCwgJGN5ICsgJGNyLCAkZHJhdyApOwogICAgICAgIGltYWdlU2V0UGl4ZWwoICRpbWcsICRjeCwgJGN5IC0gJGNyLCAkZHJhdyApOwogICAgICAgIHdoaWxlICggJGl4IDw9ICRpeSAtIDIgKSB7CiAgICAgICAgICAgIGlmICggJGlnIDwgMCApIHsKICAgICAgICAgICAgICAgICRpZyArPSAkaWRnZDsKICAgICAgICAgICAgICAgICRpZGdkIC09IDg7CiAgICAgICAgICAgICAgICAkaXktLTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRpZyArPSAkaWRncjsKICAgICAgICAgICAgICAgICRpZGdkIC09IDQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGlkZ3IgLT0gNDsKICAgICAgICAgICAgJGl4Kys7CiAgICAgICAgICAgIGltYWdlTGluZSggJGltZywgJGN4ICsgJGl4LCAkY3kgKyAkaXkgLSAxLCAkY3ggKyAkaXgsICRjeSArICRpeCwgJGZpbGwgKTsKICAgICAgICAgICAgaW1hZ2VMaW5lKCAkaW1nLCAkY3ggKyAkaXgsICRjeSAtICRpeSArIDEsICRjeCArICRpeCwgJGN5IC0gJGl4LCAkZmlsbCApOwogICAgICAgICAgICBpbWFnZUxpbmUoICRpbWcsICRjeCAtICRpeCwgJGN5ICsgJGl5IC0gMSwgJGN4IC0gJGl4LCAkY3kgKyAkaXgsICRmaWxsICk7CiAgICAgICAgICAgIGltYWdlTGluZSggJGltZywgJGN4IC0gJGl4LCAkY3kgLSAkaXkgKyAxLCAkY3ggLSAkaXgsICRjeSAtICRpeCwgJGZpbGwgKTsKICAgICAgICAgICAgaW1hZ2VMaW5lKCAkaW1nLCAkY3ggKyAkaXkgLSAxLCAkY3kgKyAkaXgsICRjeCArICRpeCwgJGN5ICsgJGl4LCAkZmlsbCApOwogICAgICAgICAgICBpbWFnZUxpbmUoICRpbWcsICRjeCArICRpeSAtIDEsICRjeSAtICRpeCwgJGN4ICsgJGl4LCAkY3kgLSAkaXgsICRmaWxsICk7CiAgICAgICAgICAgIGltYWdlTGluZSggJGltZywgJGN4IC0gJGl5ICsgMSwgJGN5ICsgJGl4LCAkY3ggLSAkaXgsICRjeSArICRpeCwgJGZpbGwgKTsKICAgICAgICAgICAgaW1hZ2VMaW5lKCAkaW1nLCAkY3ggLSAkaXkgKyAxLCAkY3kgLSAkaXgsICRjeCAtICRpeCwgJGN5IC0gJGl4LCAkZmlsbCApOwogICAgICAgICAgICAkZmlsbGVkID0gMDsKICAgICAgICAgICAgZm9yICggJHh4ID0gJGl4IC0gMC40NTsgJHh4IDwgJGl4ICsgMC41OyAkeHggKz0gMC4yICkgewogICAgICAgICAgICAgICAgZm9yICggJHl5ID0gJGl5IC0gMC40NTsgJHl5IDwgJGl5ICsgMC41OyAkeXkgKz0gMC4yICkgewogICAgICAgICAgICAgICAgICAgIGlmICggc3FydCggcG93KCAkeHgsIDIgKSArIHBvdyggJHl5LCAyICkgKSA8ICRjciApICRmaWxsZWQgKz0gNDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkZHJhdyA9IGltYWdlQ29sb3JFeGFjdEFscGhhKCAkaW1nLCAkY29sb3JbICdSJyBdLCAkY29sb3JbICdHJyBdLCAkY29sb3JbICdCJyBdLCAoIDEwMCAtICRmaWxsZWQgKSApOwogICAgICAgICAgICBpbWFnZVNldFBpeGVsKCAkaW1nLCAkY3ggKyAkaXgsICRjeSArICRpeSwgJGRyYXcgKTsKICAgICAgICAgICAgaW1hZ2VTZXRQaXhlbCggJGltZywgJGN4ICsgJGl4LCAkY3kgLSAkaXksICRkcmF3ICk7CiAgICAgICAgICAgIGltYWdlU2V0UGl4ZWwoICRpbWcsICRjeCAtICRpeCwgJGN5ICsgJGl5LCAkZHJhdyApOwogICAgICAgICAgICBpbWFnZVNldFBpeGVsKCAkaW1nLCAkY3ggLSAkaXgsICRjeSAtICRpeSwgJGRyYXcgKTsKICAgICAgICAgICAgaW1hZ2VTZXRQaXhlbCggJGltZywgJGN4ICsgJGl5LCAkY3kgKyAkaXgsICRkcmF3ICk7CiAgICAgICAgICAgIGltYWdlU2V0UGl4ZWwoICRpbWcsICRjeCArICRpeSwgJGN5IC0gJGl4LCAkZHJhdyApOwogICAgICAgICAgICBpbWFnZVNldFBpeGVsKCAkaW1nLCAkY3ggLSAkaXksICRjeSArICRpeCwgJGRyYXcgKTsKICAgICAgICAgICAgaW1hZ2VTZXRQaXhlbCggJGltZywgJGN4IC0gJGl5LCAkY3kgLSAkaXgsICRkcmF3ICk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9fZ2V0KCRuYW1lKSB7CgogICAgICAgIGlmIChzdHJwb3MoJG5hbWUsICdyYXdfJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIC8vIGlmICRuYW1lID09ICdyYXdfbGVmdF9tYXJnaW4nICwgcmV0dXJuICR0aGlzLT5fbGVmdF9tYXJnaW47CiAgICAgICAgICAgICR2YXJpYWJsZV9uYW1lID0gJ18nIC4gc3RyX3JlcGxhY2UoJ3Jhd18nLCAnJywgJG5hbWUpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPiR2YXJpYWJsZV9uYW1lOwogICAgICAgIH0KCiAgICAgICAgJHZhcmlhYmxlX25hbWUgPSAnXycgLiAkbmFtZTsgCgogICAgICAgIGlmIChpc3NldCgkdGhpcy0+JHZhcmlhYmxlX25hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+JHZhcmlhYmxlX25hbWUgKiBTVVBFUlNBTVBMSU5HX1NDQUxFOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKCcyNTEzMicsICRuYW1lKTsKICAgICAgICB9IAogICAgfQoKICAgIGZ1bmN0aW9uIF9fc2V0KCRuYW1lLCAkdmFsdWUpIHsKICAgICAgICAkdGhpcy0+eydfJy4kbmFtZX0gPSAkdmFsdWU7CiAgICB9Cgp9IC8vIENMQVNTCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBSb3RJbWFnZQovLyBEZXNjcmlwdGlvbjogRXhhY3RseSBhcyBJbWFnZSBidXQgZHJhd3MgdGhlIGltYWdlIGF0Ci8vIGEgc3BlY2lmaWVkIGFuZ2xlIGFyb3VuZCBhIHNwZWNpZmllZCByb3RhdGlvbiBwb2ludC4KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgUm90SW1hZ2UgZXh0ZW5kcyBJbWFnZSB7CiAgICBwdWJsaWMgJGE9MDsKICAgIHB1YmxpYyAkZHg9MCwkZHk9MCwkdHJhbnN4PTAsJHRyYW5zeT0wOwogICAgcHJpdmF0ZSAkbT1hcnJheSgpOwoKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRhV2lkdGgsJGFIZWlnaHQsJGE9MCwkYUZvcm1hdD1ERUZBVUxUX0dGT1JNQVQsJGFTZXRBdXRvTWFyZ2luPXRydWUpIHsKICAgICAgICBwYXJlbnQ6Ol9fY29uc3RydWN0KCRhV2lkdGgsJGFIZWlnaHQsJGFGb3JtYXQsJGFTZXRBdXRvTWFyZ2luKTsKICAgICAgICAkdGhpcy0+ZHg9JHRoaXMtPmxlZnRfbWFyZ2luKyR0aGlzLT5wbG90d2lkdGgvMjsKICAgICAgICAkdGhpcy0+ZHk9JHRoaXMtPnRvcF9tYXJnaW4rJHRoaXMtPnBsb3RoZWlnaHQvMjsKICAgICAgICAkdGhpcy0+U2V0QW5nbGUoJGEpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENlbnRlcigkZHgsJGR5KSB7CiAgICAgICAgJG9sZF9keCA9ICR0aGlzLT5keDsKICAgICAgICAkb2xkX2R5ID0gJHRoaXMtPmR5OwogICAgICAgICR0aGlzLT5keD0kZHg7CiAgICAgICAgJHRoaXMtPmR5PSRkeTsKICAgICAgICAkdGhpcy0+U2V0QW5nbGUoJHRoaXMtPmEpOwogICAgICAgIHJldHVybiBhcnJheSgkb2xkX2R4LCRvbGRfZHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFRyYW5zbGF0aW9uKCRkeCwkZHkpIHsKICAgICAgICAkb2xkID0gYXJyYXkoJHRoaXMtPnRyYW5zeCwkdGhpcy0+dHJhbnN5KTsKICAgICAgICAkdGhpcy0+dHJhbnN4ID0gJGR4OwogICAgICAgICR0aGlzLT50cmFuc3kgPSAkZHk7CiAgICAgICAgcmV0dXJuICRvbGQ7CiAgICB9CgogICAgZnVuY3Rpb24gVXBkYXRlUm90TWF0cmljZSgpICB7CiAgICAgICAgJGEgPSAkdGhpcy0+YTsKICAgICAgICAkYSAqPSBNX1BJLzE4MDsKICAgICAgICAkc2E9c2luKCRhKTsgJGNhPWNvcygkYSk7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSByb3RhdGlvbiBtYXRyaXgKICAgICAgICAkdGhpcy0+bVswXVswXSA9ICRjYTsKICAgICAgICAkdGhpcy0+bVswXVsxXSA9IC0kc2E7CiAgICAgICAgJHRoaXMtPm1bMF1bMl0gPSAkdGhpcy0+ZHgqKDEtJGNhKSArICRzYSokdGhpcy0+ZHkgOwogICAgICAgICR0aGlzLT5tWzFdWzBdID0gJHNhOwogICAgICAgICR0aGlzLT5tWzFdWzFdID0gJGNhOwogICAgICAgICR0aGlzLT5tWzFdWzJdID0gJHRoaXMtPmR5KigxLSRjYSkgLSAkc2EqJHRoaXMtPmR4IDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRBbmdsZSgkYSkgewogICAgICAgICR0bXAgPSAkdGhpcy0+YTsKICAgICAgICAkdGhpcy0+YSA9ICRhOwogICAgICAgICR0aGlzLT5VcGRhdGVSb3RNYXRyaWNlKCk7CiAgICAgICAgcmV0dXJuICR0bXA7CiAgICB9CgogICAgZnVuY3Rpb24gQ2lyY2xlKCR4YywkeWMsJHIpIHsKICAgICAgICBsaXN0KCR4YywkeWMpID0gJHRoaXMtPlJvdGF0ZSgkeGMsJHljKTsKICAgICAgICBwYXJlbnQ6OkNpcmNsZSgkeGMsJHljLCRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBGaWxsZWRDaXJjbGUoJHhjLCR5YywkcikgewogICAgICAgIGxpc3QoJHhjLCR5YykgPSAkdGhpcy0+Um90YXRlKCR4YywkeWMpOwogICAgICAgIHBhcmVudDo6RmlsbGVkQ2lyY2xlKCR4YywkeWMsJHIpOwogICAgfQoKCiAgICBmdW5jdGlvbiBBcmMoJHhjLCR5YywkdywkaCwkcywkZSkgewogICAgICAgIGxpc3QoJHhjLCR5YykgPSAkdGhpcy0+Um90YXRlKCR4YywkeWMpOwogICAgICAgICRzICs9ICR0aGlzLT5hOwogICAgICAgICRlICs9ICR0aGlzLT5hOwogICAgICAgIHBhcmVudDo6QXJjKCR4YywkeWMsJHcsJGgsJHMsJGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIEZpbGxlZEFyYygkeGMsJHljLCR3LCRoLCRzLCRlLCRzdHlsZT0nJykgewogICAgICAgIGxpc3QoJHhjLCR5YykgPSAkdGhpcy0+Um90YXRlKCR4YywkeWMpOwogICAgICAgICRzICs9ICR0aGlzLT5hOwogICAgICAgICRlICs9ICR0aGlzLT5hOwogICAgICAgIHBhcmVudDo6RmlsbGVkQXJjKCR4YywkeWMsJHcsJGgsJHMsJGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldE1hcmdpbigkbG0sJHJtLCR0bSwkYm0pIHsKICAgICAgICBwYXJlbnQ6OlNldE1hcmdpbigkbG0sJHJtLCR0bSwkYm0pOwogICAgICAgICR0aGlzLT5keD0kdGhpcy0+bGVmdF9tYXJnaW4rJHRoaXMtPnBsb3R3aWR0aC8yOwogICAgICAgICR0aGlzLT5keT0kdGhpcy0+dG9wX21hcmdpbiskdGhpcy0+cGxvdGhlaWdodC8yOwogICAgICAgICR0aGlzLT5VcGRhdGVSb3RNYXRyaWNlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gUm90YXRlKCR4LCR5KSB7CiAgICAgICAgLy8gT3B0aW1pemF0aW9uLiBJZ25vcmUgcm90YXRpb24gaWYgQW5nbGU9PTAgfHwgQW5nbGU9PTM2MAogICAgICAgIGlmKCAkdGhpcy0+YSA9PSAwIHx8ICR0aGlzLT5hID09IDM2MCApIHsKICAgICAgICAgICAgcmV0dXJuIGFycmF5KCR4ICsgJHRoaXMtPnRyYW5zeCwgJHkgKyAkdGhpcy0+dHJhbnN5ICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkeDE9cm91bmQoJHRoaXMtPm1bMF1bMF0qJHggKyAkdGhpcy0+bVswXVsxXSokeSwxKSArICR0aGlzLT5tWzBdWzJdICsgJHRoaXMtPnRyYW5zeDsKICAgICAgICAgICAgJHkxPXJvdW5kKCR0aGlzLT5tWzFdWzBdKiR4ICsgJHRoaXMtPm1bMV1bMV0qJHksMSkgKyAkdGhpcy0+bVsxXVsyXSArICR0aGlzLT50cmFuc3k7CiAgICAgICAgICAgIHJldHVybiBhcnJheSgkeDEsJHkxKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQ29weU1lcmdlKCRmcm9tSW1nLCR0b1gsJHRvWSwkZnJvbVgsJGZyb21ZLCR0b1dpZHRoLCR0b0hlaWdodCwkZnJvbVdpZHRoPS0xLCRmcm9tSGVpZ2h0PS0xLCRhTWl4PTEwMCkgewogICAgICAgIGxpc3QoJHRvWCwkdG9ZKSA9ICR0aGlzLT5Sb3RhdGUoJHRvWCwkdG9ZKTsKICAgICAgICBwYXJlbnQ6OkNvcHlNZXJnZSgkZnJvbUltZywkdG9YLCR0b1ksJGZyb21YLCRmcm9tWSwkdG9XaWR0aCwkdG9IZWlnaHQsJGZyb21XaWR0aCwkZnJvbUhlaWdodCwkYU1peCk7CgogICAgfQoKICAgIGZ1bmN0aW9uIEFyclJvdGF0ZSgkcG50cykgewogICAgICAgICRuID0gY291bnQoJHBudHMpLTE7CiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG47ICRpKz0yKSB7CiAgICAgICAgICAgIGxpc3QgKCR4LCR5KSA9ICR0aGlzLT5Sb3RhdGUoJHBudHNbJGldLCRwbnRzWyRpKzFdKTsKICAgICAgICAgICAgJHBudHNbJGldID0gJHg7ICRwbnRzWyRpKzFdID0gJHk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcG50czsKICAgIH0KCiAgICBmdW5jdGlvbiBEYXNoZWRMaW5lKCR4MSwkeTEsJHgyLCR5MiwkZGFzaF9sZW5ndGg9MSwkZGFzaF9zcGFjZT00KSB7CiAgICAgICAgbGlzdCgkeDEsJHkxKSA9ICR0aGlzLT5Sb3RhdGUoJHgxLCR5MSk7CiAgICAgICAgbGlzdCgkeDIsJHkyKSA9ICR0aGlzLT5Sb3RhdGUoJHgyLCR5Mik7CiAgICAgICAgcGFyZW50OjpEYXNoZWRMaW5lKCR4MSwkeTEsJHgyLCR5MiwkZGFzaF9sZW5ndGgsJGRhc2hfc3BhY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIExpbmUoJHgxLCR5MSwkeDIsJHkyKSB7CiAgICAgICAgbGlzdCgkeDEsJHkxKSA9ICR0aGlzLT5Sb3RhdGUoJHgxLCR5MSk7CiAgICAgICAgbGlzdCgkeDIsJHkyKSA9ICR0aGlzLT5Sb3RhdGUoJHgyLCR5Mik7CiAgICAgICAgcGFyZW50OjpMaW5lKCR4MSwkeTEsJHgyLCR5Mik7CiAgICB9CgogICAgZnVuY3Rpb24gUmVjdGFuZ2xlKCR4MSwkeTEsJHgyLCR5MikgewogICAgICAgIC8vIFJlY3RhbmdsZSB1c2VzIExpbmUoKSBzbyBpdCB3aWxsIGJlIHJvdGF0ZWQgdGhyb3VnaCB0aGF0IGNhbGwKICAgICAgICBwYXJlbnQ6OlJlY3RhbmdsZSgkeDEsJHkxLCR4MiwkeTIpOwogICAgfQoKICAgIGZ1bmN0aW9uIEZpbGxlZFJlY3RhbmdsZSgkeDEsJHkxLCR4MiwkeTIpIHsKICAgICAgICBpZiggJHkxPT0keTIgfHwgJHgxPT0keDIgKQogICAgICAgICR0aGlzLT5MaW5lKCR4MSwkeTEsJHgyLCR5Mik7CiAgICAgICAgZWxzZQogICAgICAgICR0aGlzLT5GaWxsZWRQb2x5Z29uKGFycmF5KCR4MSwkeTEsJHgyLCR5MSwkeDIsJHkyLCR4MSwkeTIpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBQb2x5Z29uKCRwbnRzLCRjbG9zZWQ9RkFMU0UsJGZhc3Q9RkFMU0UpIHsKICAgICAgICAvLyBQb2x5Z29uIHVzZXMgTGluZSgpIHNvIGl0IHdpbGwgYmUgcm90YXRlZCB0aHJvdWdoIHRoYXQgY2FsbCB1bmxlc3MKICAgICAgICAvLyBmYXN0IGRyYXdpbmcgcm91dGluZXMgYXJlIHVzZWQgaW4gd2hpY2ggY2FzZSBhIHJvdGF0ZSBpcyBuZWVkZWQKICAgICAgICBpZiggJGZhc3QgKSB7CiAgICAgICAgICAgIHBhcmVudDo6UG9seWdvbigkdGhpcy0+QXJyUm90YXRlKCRwbnRzKSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBwYXJlbnQ6OlBvbHlnb24oJHBudHMsJGNsb3NlZCwkZmFzdCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEZpbGxlZFBvbHlnb24oJHBudHMpIHsKICAgICAgICBwYXJlbnQ6OkZpbGxlZFBvbHlnb24oJHRoaXMtPkFyclJvdGF0ZSgkcG50cykpOwogICAgfQoKICAgIGZ1bmN0aW9uIFBvaW50KCR4LCR5KSB7CiAgICAgICAgbGlzdCgkeHAsJHlwKSA9ICR0aGlzLT5Sb3RhdGUoJHgsJHkpOwogICAgICAgIHBhcmVudDo6UG9pbnQoJHhwLCR5cCk7CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlVGV4dCgkeCwkeSwkdHh0LCRkaXI9MCwkcGFyYWdyYXBoX2FsaWduPSJsZWZ0IiwkZGVidWc9ZmFsc2UpIHsKICAgICAgICBsaXN0KCR4cCwkeXApID0gJHRoaXMtPlJvdGF0ZSgkeCwkeSk7CiAgICAgICAgcmV0dXJuIHBhcmVudDo6U3Ryb2tlVGV4dCgkeHAsJHlwLCR0eHQsJGRpciwkcGFyYWdyYXBoX2FsaWduLCRkZWJ1Zyk7CiAgICB9Cn0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ0xBU1MgSW1nU3RyZWFtQ2FjaGUKLy8gRGVzY3JpcHRpb246IEhhbmRsZSBjYWNoaW5nIG9mIGdyYXBocyB0byBmaWxlcy4gQWxsIGltYWdlIG91dHB1dCBnb2VzCi8vICAgICAgICAgICAgICB0aHJvdWdoIHRoaXMgY2xhc3MKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjbGFzcyBJbWdTdHJlYW1DYWNoZSB7CiAgICBwcml2YXRlICRjYWNoZV9kaXIsICR0aW1lb3V0PTA7ICAvLyBJbmZpbml0ZSB0aW1lb3V0CiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ09OU1RSVUNUT1IKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRhQ2FjaGVEaXI9Q0FDSEVfRElSKSB7CiAgICAgICAgJHRoaXMtPmNhY2hlX2RpciA9ICRhQ2FjaGVEaXI7CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgLy8gU3BlY2lmeSBhIHRpbWVvdXQgKGluIG1pbnV0ZXMpIGZvciB0aGUgZmlsZS4gSWYgdGhlIGZpbGUgaXMgb2xkZXIgdGhlbiB0aGUKICAgIC8vIHRpbWVvdXQgdmFsdWUgaXQgd2lsbCBiZSBvdmVyd3JpdHRlbiB3aXRoIGEgbmV3ZXIgdmVyc2lvbi4KICAgIC8vIElmIHRpbWVvdXQgaXMgc2V0IHRvIDAgdGhpcyBpcyB0aGUgc2FtZSBhcyBpbmZpbml0ZSBsYXJnZSB0aW1lb3V0IGFuZCBpZgogICAgLy8gdGltZW91dCBpcyBzZXQgdG8gLTEgdGhpcyBpcyB0aGUgc2FtZSBhcyBpbmZpbml0ZSBzbWFsbCB0aW1lb3V0CiAgICBmdW5jdGlvbiBTZXRUaW1lb3V0KCRhVGltZW91dCkgewogICAgICAgICR0aGlzLT50aW1lb3V0PSRhVGltZW91dDsKICAgIH0KCiAgICAvLyBPdXRwdXQgaW1hZ2UgdG8gYnJvd3NlciBhbmQgYWxzbyB3cml0ZSBpdCB0byB0aGUgY2FjaGUKICAgIGZ1bmN0aW9uIFB1dEFuZFN0cmVhbSgkYUltYWdlLCRhQ2FjaGVGaWxlTmFtZSwkYUlubGluZSwkYVN0cm9rZUZpbGVOYW1lKSB7CgogICAgICAgIC8vIENoZWNrIGlmIHdlIHNob3VsZCBhbHdheXMgc3Ryb2tlIHRoZSBpbWFnZSB0byBhIGZpbGUKICAgICAgICBpZiggX0ZPUkNFX0lNR1RPRklMRSApIHsKICAgICAgICAgICAgJGFTdHJva2VGaWxlTmFtZSA9IF9GT1JDRV9JTUdESVIuR2VuSW1nTmFtZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYoICRhU3Ryb2tlRmlsZU5hbWUgIT0gJycgKSB7CgogICAgICAgICAgICBpZiggJGFTdHJva2VGaWxlTmFtZSA9PSAnYXV0bycgKSB7CiAgICAgICAgICAgICAgICAkYVN0cm9rZUZpbGVOYW1lID0gR2VuSW1nTmFtZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiggZmlsZV9leGlzdHMoJGFTdHJva2VGaWxlTmFtZSkgKSB7CgogICAgICAgICAgICAgICAgLy8gV2FpdCBmb3IgbG9jayAodG8gbWFrZSBzdXJlIG5vIHJlYWRlcnMgYXJlIHRyeWluZyB0byBhY2Nlc3MgdGhlIGltYWdlKQogICAgICAgICAgICAgICAgJGZkID0gZm9wZW4oJGFTdHJva2VGaWxlTmFtZSwndycpOwogICAgICAgICAgICAgICAgJGxvY2sgPSBmbG9jaygkZmQsIExPQ0tfRVgpOwoKICAgICAgICAgICAgICAgIC8vIFNpbmNlIHRoZSBpbWFnZSB3cml0ZSByb3V0aW5lcyBvbmx5IGFjY2VwdHMgYSBmaWxlbmFtZSB3aGljaCBtdXN0IG5vdAogICAgICAgICAgICAgICAgLy8gZXhpc3Qgd2UgbmVlZCB0byBkZWxldGUgdGhlIG9sZCBmaWxlIGZpcnN0CiAgICAgICAgICAgICAgICBpZiggIUB1bmxpbmsoJGFTdHJva2VGaWxlTmFtZSkgKSB7CiAgICAgICAgICAgICAgICAgICAgJGxvY2sgPSBmbG9jaygkZmQsIExPQ0tfVU4pOwogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTExLCRhU3Ryb2tlRmlsZU5hbWUpOwogICAgICAgICAgICAgICAgICAgIC8vKCIgQ2FuJ3QgZGVsZXRlIGNhY2hlZCBpbWFnZSAkYVN0cm9rZUZpbGVOYW1lLiBQZXJtaXNzaW9uIHByb2JsZW0\/Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYUltYWdlLT5TdHJlYW0oJGFTdHJva2VGaWxlTmFtZSk7CiAgICAgICAgICAgICAgICAkbG9jayA9IGZsb2NrKCRmZCwgTE9DS19VTik7CiAgICAgICAgICAgICAgICBmY2xvc2UoJGZkKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkYUltYWdlLT5TdHJlYW0oJGFTdHJva2VGaWxlTmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmKCAkYUNhY2hlRmlsZU5hbWUgIT0gJycgJiYgVVNFX0NBQ0hFKSB7CgogICAgICAgICAgICAkYUNhY2hlRmlsZU5hbWUgPSAkdGhpcy0+Y2FjaGVfZGlyIC4gJGFDYWNoZUZpbGVOYW1lOwogICAgICAgICAgICBpZiggZmlsZV9leGlzdHMoJGFDYWNoZUZpbGVOYW1lKSApIHsKICAgICAgICAgICAgICAgIGlmKCAhJGFJbmxpbmUgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgYXJlIGdlbmVyYXRpbmcgaW1hZ2Ugb2ZmLWxpbmUgKGp1c3Qgd3JpdGluZyB0byB0aGUgY2FjaGUpCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRoZSBmaWxlIGV4aXN0cyBhbmQgaXMgc3RpbGwgdmFsaWQgKG5vIHRpbWVvdXQpCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlbiBkbyBub3RoaW5nLCBqdXN0IHJldHVybi4KICAgICAgICAgICAgICAgICAgICAkZGlmZj10aW1lKCktZmlsZW10aW1lKCRhQ2FjaGVGaWxlTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgaWYoICRkaWZmIDwgMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTIsJGFDYWNoZUZpbGVOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8oIiBDYWNoZWQgaW1hZ2VmaWxlICgkYUNhY2hlRmlsZU5hbWUpIGhhcyBmaWxlIGRhdGUgaW4gdGhlIGZ1dHVyZSEhIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+dGltZW91dD4wICYmICgkZGlmZiA8PSAkdGhpcy0+dGltZW91dCo2MCkgKSByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gV2FpdCBmb3IgbG9jayAodG8gbWFrZSBzdXJlIG5vIHJlYWRlcnMgYXJlIHRyeWluZyB0byBhY2Nlc3MgdGhlIGltYWdlKQogICAgICAgICAgICAgICAgJGZkID0gZm9wZW4oJGFDYWNoZUZpbGVOYW1lLCd3Jyk7CiAgICAgICAgICAgICAgICAkbG9jayA9IGZsb2NrKCRmZCwgTE9DS19FWCk7CgogICAgICAgICAgICAgICAgaWYoICFAdW5saW5rKCRhQ2FjaGVGaWxlTmFtZSkgKSB7CiAgICAgICAgICAgICAgICAgICAgJGxvY2sgPSBmbG9jaygkZmQsIExPQ0tfVU4pOwogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTEzLCRhU3Ryb2tlRmlsZU5hbWUpOwogICAgICAgICAgICAgICAgICAgIC8vKCIgQ2FuJ3QgZGVsZXRlIGNhY2hlZCBpbWFnZSAkYVN0cm9rZUZpbGVOYW1lLiBQZXJtaXNzaW9uIHByb2JsZW0\/Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYUltYWdlLT5TdHJlYW0oJGFDYWNoZUZpbGVOYW1lKTsKICAgICAgICAgICAgICAgICRsb2NrID0gZmxvY2soJGZkLCBMT0NLX1VOKTsKICAgICAgICAgICAgICAgIGZjbG9zZSgkZmQpOwoKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICR0aGlzLT5NYWtlRGlycyhkaXJuYW1lKCRhQ2FjaGVGaWxlTmFtZSkpOwogICAgICAgICAgICAgICAgaWYoICFpc193cml0ZWFibGUoZGlybmFtZSgkYUNhY2hlRmlsZU5hbWUpKSApIHsKICAgICAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTExNCwkYUNhY2hlRmlsZU5hbWUpOwogICAgICAgICAgICAgICAgICAgIC8vKCdQSFAgaGFzIG5vdCBlbm91Z2ggcGVybWlzc2lvbnMgdG8gd3JpdGUgdG8gdGhlIGNhY2hlIGZpbGUgJy4kYUNhY2hlRmlsZU5hbWUuJy4gUGxlYXNlIG1ha2Ugc3VyZSB0aGF0IHRoZSB1c2VyIHJ1bm5pbmcgUEhQIGhhcyB3cml0ZSBwZXJtaXNzaW9uIGZvciB0aGlzIGZpbGUgaWYgeW91IHdhbiB0byB1c2UgdGhlIGNhY2hlIHN5c3RlbSB3aXRoIEpwR3JhcGguJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYUltYWdlLT5TdHJlYW0oJGFDYWNoZUZpbGVOYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHJlcz10cnVlOwogICAgICAgICAgICAvLyBTZXQgZ3JvdXAgdG8gc3BlY2lmaWVkCiAgICAgICAgICAgIGlmKCBDQUNIRV9GSUxFX0dST1VQICE9ICcnICkgewogICAgICAgICAgICAgICAgJHJlcyA9IEBjaGdycCgkYUNhY2hlRmlsZU5hbWUsQ0FDSEVfRklMRV9HUk9VUCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIENBQ0hFX0ZJTEVfTU9EICE9ICcnICkgewogICAgICAgICAgICAgICAgJHJlcyA9IEBjaG1vZCgkYUNhY2hlRmlsZU5hbWUsQ0FDSEVfRklMRV9NT0QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAhJHJlcyApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTE1LCRhU3Ryb2tlRmlsZU5hbWUpOwogICAgICAgICAgICAgICAgLy8oIiBDYW4ndCBzZXQgcGVybWlzc2lvbiBmb3IgY2FjaGVkIGltYWdlICRhU3Ryb2tlRmlsZU5hbWUuIFBlcm1pc3Npb24gcHJvYmxlbT8iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGFJbWFnZS0+RGVzdHJveSgpOwogICAgICAgICAgICBpZiggJGFJbmxpbmUgKSB7CiAgICAgICAgICAgICAgICBpZiAoJGZoID0gQGZvcGVuKCRhQ2FjaGVGaWxlTmFtZSwgInJiIikgKSB7CiAgICAgICAgICAgICAgICAgICAgJGFJbWFnZS0+SGVhZGVycygpOwogICAgICAgICAgICAgICAgICAgIGZwYXNzdGhydSgkZmgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTE2LCRhRmlsZSk7Ly8oIiBDYW50IG9wZW4gZmlsZSBmcm9tIGNhY2hlIFskYUZpbGVdIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkYUlubGluZSApIHsKICAgICAgICAgICAgJGFJbWFnZS0+SGVhZGVycygpOwogICAgICAgICAgICAkYUltYWdlLT5TdHJlYW0oKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBJc1ZhbGlkKCRhQ2FjaGVGaWxlTmFtZSkgewogICAgICAgICRhQ2FjaGVGaWxlTmFtZSA9ICR0aGlzLT5jYWNoZV9kaXIuJGFDYWNoZUZpbGVOYW1lOwogICAgICAgIGlmICggVVNFX0NBQ0hFICYmIGZpbGVfZXhpc3RzKCRhQ2FjaGVGaWxlTmFtZSkgKSB7CiAgICAgICAgICAgICRkaWZmPXRpbWUoKS1maWxlbXRpbWUoJGFDYWNoZUZpbGVOYW1lKTsKICAgICAgICAgICAgaWYoICR0aGlzLT50aW1lb3V0PjAgJiYgKCRkaWZmID4gJHRoaXMtPnRpbWVvdXQqNjApICkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU3RyZWFtSW1nRmlsZSgkYUltYWdlLCRhQ2FjaGVGaWxlTmFtZSkgewogICAgICAgICRhQ2FjaGVGaWxlTmFtZSA9ICR0aGlzLT5jYWNoZV9kaXIuJGFDYWNoZUZpbGVOYW1lOwogICAgICAgIGlmICggJGZoID0gQGZvcGVuKCRhQ2FjaGVGaWxlTmFtZSwgJ3JiJykgKSB7CiAgICAgICAgICAgICRsb2NrID0gZmxvY2soJGZoLCBMT0NLX1NIKTsKICAgICAgICAgICAgJGFJbWFnZS0+SGVhZGVycygpOwogICAgICAgICAgICBmcGFzc3RocnUoJGZoKTsKICAgICAgICAgICAgJGxvY2sgPSBmbG9jaygkZmgsIExPQ0tfVU4pOwogICAgICAgICAgICBmY2xvc2UoJGZoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTExNywkYUNhY2hlRmlsZU5hbWUpOy8vKCIgQ2FuJ3Qgb3BlbiBjYWNoZWQgaW1hZ2UgXCIkYUNhY2hlRmlsZU5hbWVcIiBmb3IgcmVhZGluZy4iKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQ2hlY2sgaWYgYSBnaXZlbiBpbWFnZSBpcyBpbiBjYWNoZSBhbmQgaW4gdGhhdCBjYXNlCiAgICAvLyBwYXNzIGl0IGRpcmVjdGx5IG9uIHRvIHdlYiBicm93c2VyLiBSZXR1cm4gZmFsc2UgaWYgdGhlCiAgICAvLyBpbWFnZSBmaWxlIGRvZXNuJ3QgZXhpc3Qgb3IgZXhpc3RzIGJ1dCBpcyB0byBvbGQKICAgIGZ1bmN0aW9uIEdldEFuZFN0cmVhbSgkYUltYWdlLCRhQ2FjaGVGaWxlTmFtZSkgewogICAgICAgIGlmKCAkdGhpcy0+SXN2YWxpZCgkYUNhY2hlRmlsZU5hbWUpICkgewogICAgICAgICAgICAkdGhpcy0+U3RyZWFtSW1nRmlsZSgkYUltYWdlLCRhQ2FjaGVGaWxlTmFtZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBQUklWQVRFIE1FVEhPRFMKICAgIC8vIENyZWF0ZSBhbGwgbmVjZXNzYXJ5IGRpcmVjdG9yaWVzIGluIGEgcGF0aAogICAgZnVuY3Rpb24gTWFrZURpcnMoJGFGaWxlKSB7CiAgICAgICAgJGRpcnMgPSBhcnJheSgpOwogICAgICAgIC8vIEluIG9yZGVyIHRvIGJldHRlciB3b3JrIHdoZW4gb3Blbl9iYXNlZGlyIGlzIGVuYWJsZWQKICAgICAgICAvLyB3ZSBkbyBub3QgY3JlYXRlIGRpcmVjdG9yaWVzIGluIHRoZSByb290IHBhdGgKICAgICAgICB3aGlsZSAoICRhRmlsZSAhPSAnLycgJiYgIShmaWxlX2V4aXN0cygkYUZpbGUpKSApIHsKICAgICAgICAgICAgJGRpcnNbXSA9ICRhRmlsZS4nLyc7CiAgICAgICAgICAgICRhRmlsZSA9IGRpcm5hbWUoJGFGaWxlKTsKICAgICAgICB9CiAgICAgICAgZm9yICgkaSA9IHNpemVvZigkZGlycyktMTsgJGk+PTA7ICRpLS0pIHsKICAgICAgICAgICAgaWYoISBAbWtkaXIoJGRpcnNbJGldLDA3NzcpICkgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTgsJGFGaWxlKTsvLygiIENhbid0IGNyZWF0ZSBkaXJlY3RvcnkgJGFGaWxlLiBNYWtlIHN1cmUgUEhQIGhhcyB3cml0ZSBwZXJtaXNzaW9uIHRvIHRoaXMgZGlyZWN0b3J5LiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFdlIGFsc28gc3BlY2lmeSBtb2RlIGhlcmUgYWZ0ZXIgd2UgaGF2ZSBjaGFuZ2VkIGdyb3VwLgogICAgICAgICAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSBpZiBBcGFjaGUgdXNlciBkb2Vzbid0IGJlbG9uZyB0aGUKICAgICAgICAgICAgLy8gZGVmYXVsdCBncm91cCBhbmQgaGVuY2UgY2FuJ3Qgc3BlY2lmeSBncm91cCBwZXJtaXNzaW9uCiAgICAgICAgICAgIC8vIGluIHRoZSBwcmV2aW91cyBta2RpcigpIGNhbGwKICAgICAgICAgICAgaWYoIENBQ0hFX0ZJTEVfR1JPVVAgIT0gIiIgKSB7CiAgICAgICAgICAgICAgICAkcmVzPXRydWU7CiAgICAgICAgICAgICAgICAkcmVzID1AY2hncnAoJGRpcnNbJGldLENBQ0hFX0ZJTEVfR1JPVVApOwogICAgICAgICAgICAgICAgJHJlcyA9IEBjaG1vZCgkZGlyc1skaV0sMDc3Nyk7CiAgICAgICAgICAgICAgICBpZiggISRyZXMgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTksJGFGaWxlKTsvLygiIENhbid0IHNldCBwZXJtaXNzaW9ucyBmb3IgJGFGaWxlLiBQZXJtaXNzaW9uIHByb2JsZW1zPyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9IC8vIENMQVNTIENhY2hlCgo\/Pgo=",
    "size": "84881"
}