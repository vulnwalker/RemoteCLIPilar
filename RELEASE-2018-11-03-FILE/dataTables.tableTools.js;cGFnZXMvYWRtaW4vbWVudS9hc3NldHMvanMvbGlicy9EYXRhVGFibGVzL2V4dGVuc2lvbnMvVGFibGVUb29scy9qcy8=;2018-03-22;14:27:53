{
    "namaFile": "pages\/admin\/menu\/assets\/js\/libs\/DataTables\/extensions\/TableTools\/js\/dataTables.tableTools.js",
    "lastUpdate": "2018-03-22+14:27:53.48",
    "contentFile": "LyohIFRhYmxlVG9vbHMgMi4yLjIKICogMjAwOS0yMDE0IFNwcnlNZWRpYSBMdGQgLSBkYXRhdGFibGVzLm5ldC9saWNlbnNlCiAqCiAqIFplcm9DbGlwYm9hcmQgMS4wLjQKICogQXV0aG9yOiBKb3NlcGggSHVja2FieSAtIE1JVCBsaWNlbnNlZAogKi8KCi8qKgogKiBAc3VtbWFyeSAgICAgVGFibGVUb29scwogKiBAZGVzY3JpcHRpb24gVG9vbHMgYW5kIGJ1dHRvbnMgZm9yIERhdGFUYWJsZXMKICogQHZlcnNpb24gICAgIDIuMi4yCiAqIEBmaWxlICAgICAgICBkYXRhVGFibGVzLnRhYmxlVG9vbHMuanMKICogQGF1dGhvciAgICAgIFNwcnlNZWRpYSBMdGQgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICogQGNvcHlyaWdodCAgIENvcHlyaWdodCAyMDA5LTIwMTQgU3ByeU1lZGlhIEx0ZC4KICoKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBmcmVlIHNvZnR3YXJlLCBhdmFpbGFibGUgdW5kZXIgdGhlIGZvbGxvd2luZyBsaWNlbnNlOgogKiAgIE1JVCBsaWNlbnNlIC0gaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2UvbWl0CiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0CiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZCiAqIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIGxpY2Vuc2UgZmlsZXMgZm9yIGRldGFpbHMuCiAqCiAqIEZvciBkZXRhaWxzIHBsZWFzZSByZWZlciB0bzogaHR0cDovL3d3dy5kYXRhdGFibGVzLm5ldAogKi8KCgovKiBHbG9iYWwgc2NvcGUgZm9yIFRhYmxlVG9vbHMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LgogKiBXaWxsIGJlIHJlbW92ZWQgaW4gMi4zCiAqLwp2YXIgVGFibGVUb29sczsKCihmdW5jdGlvbih3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHsKCgp2YXIgZmFjdG9yeSA9IGZ1bmN0aW9uKCAkLCBEYXRhVGFibGUgKSB7CiJ1c2Ugc3RyaWN0IjsKCgovL2luY2x1ZGUgWmVyb0NsaXBib2FyZC5qcwovKiBaZXJvQ2xpcGJvYXJkIDEuMC40CiAqIEF1dGhvcjogSm9zZXBoIEh1Y2thYnkKICovCgp2YXIgWmVyb0NsaXBib2FyZF9UYWJsZVRvb2xzID0gewoKCXZlcnNpb246ICIxLjAuNC1UYWJsZVRvb2xzMiIsCgljbGllbnRzOiB7fSwgLy8gcmVnaXN0ZXJlZCB1cGxvYWQgY2xpZW50cyBvbiBwYWdlLCBpbmRleGVkIGJ5IGlkCgltb3ZpZVBhdGg6ICcnLCAvLyBVUkwgdG8gbW92aWUKCW5leHRJZDogMSwgLy8gSUQgb2YgbmV4dCBtb3ZpZQoKCSQ6IGZ1bmN0aW9uKHRoaW5neSkgewoJCS8vIHNpbXBsZSBET00gbG9va3VwIHV0aWxpdHkgZnVuY3Rpb24KCQlpZiAodHlwZW9mKHRoaW5neSkgPT0gJ3N0cmluZycpIHsKCQkJdGhpbmd5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpbmd5KTsKCQl9CgkJaWYgKCF0aGluZ3kuYWRkQ2xhc3MpIHsKCQkJLy8gZXh0ZW5kIGVsZW1lbnQgd2l0aCBhIGZldyB1c2VmdWwgbWV0aG9kcwoJCQl0aGluZ3kuaGlkZSA9IGZ1bmN0aW9uKCkgeyB0aGlzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH07CgkJCXRoaW5neS5zaG93ID0gZnVuY3Rpb24oKSB7IHRoaXMuc3R5bGUuZGlzcGxheSA9ICcnOyB9OwoJCQl0aGluZ3kuYWRkQ2xhc3MgPSBmdW5jdGlvbihuYW1lKSB7IHRoaXMucmVtb3ZlQ2xhc3MobmFtZSk7IHRoaXMuY2xhc3NOYW1lICs9ICcgJyArIG5hbWU7IH07CgkJCXRoaW5neS5yZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKG5hbWUpIHsKCQkJCXRoaXMuY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWUucmVwbGFjZSggbmV3IFJlZ0V4cCgiXFxzKiIgKyBuYW1lICsgIlxccyoiKSwgIiAiKS5yZXBsYWNlKC9eXHMrLywgJycpLnJlcGxhY2UoL1xzKyQvLCAnJyk7CgkJCX07CgkJCXRoaW5neS5oYXNDbGFzcyA9IGZ1bmN0aW9uKG5hbWUpIHsKCQkJCXJldHVybiAhIXRoaXMuY2xhc3NOYW1lLm1hdGNoKCBuZXcgUmVnRXhwKCJcXHMqIiArIG5hbWUgKyAiXFxzKiIpICk7CgkJCX07CgkJfQoJCXJldHVybiB0aGluZ3k7Cgl9LAoKCXNldE1vdmllUGF0aDogZnVuY3Rpb24ocGF0aCkgewoJCS8vIHNldCBwYXRoIHRvIFplcm9DbGlwYm9hcmQuc3dmCgkJdGhpcy5tb3ZpZVBhdGggPSBwYXRoOwoJfSwKCglkaXNwYXRjaDogZnVuY3Rpb24oaWQsIGV2ZW50TmFtZSwgYXJncykgewoJCS8vIHJlY2VpdmUgZXZlbnQgZnJvbSBmbGFzaCBtb3ZpZSwgc2VuZCB0byBjbGllbnQKCQl2YXIgY2xpZW50ID0gdGhpcy5jbGllbnRzW2lkXTsKCQlpZiAoY2xpZW50KSB7CgkJCWNsaWVudC5yZWNlaXZlRXZlbnQoZXZlbnROYW1lLCBhcmdzKTsKCQl9Cgl9LAoKCXJlZ2lzdGVyOiBmdW5jdGlvbihpZCwgY2xpZW50KSB7CgkJLy8gcmVnaXN0ZXIgbmV3IGNsaWVudCB0byByZWNlaXZlIGV2ZW50cwoJCXRoaXMuY2xpZW50c1tpZF0gPSBjbGllbnQ7Cgl9LAoKCWdldERPTU9iamVjdFBvc2l0aW9uOiBmdW5jdGlvbihvYmopIHsKCQkvLyBnZXQgYWJzb2x1dGUgY29vcmRpbmF0ZXMgZm9yIGRvbSBlbGVtZW50CgkJdmFyIGluZm8gPSB7CgkJCWxlZnQ6IDAsCgkJCXRvcDogMCwKCQkJd2lkdGg6IG9iai53aWR0aCA\/IG9iai53aWR0aCA6IG9iai5vZmZzZXRXaWR0aCwKCQkJaGVpZ2h0OiBvYmouaGVpZ2h0ID8gb2JqLmhlaWdodCA6IG9iai5vZmZzZXRIZWlnaHQKCQl9OwoKCQlpZiAoIG9iai5zdHlsZS53aWR0aCAhPT0gIiIgKSB7CgkJCWluZm8ud2lkdGggPSBvYmouc3R5bGUud2lkdGgucmVwbGFjZSgicHgiLCIiKTsKCQl9CgoJCWlmICggb2JqLnN0eWxlLmhlaWdodCAhPT0gIiIgKSB7CgkJCWluZm8uaGVpZ2h0ID0gb2JqLnN0eWxlLmhlaWdodC5yZXBsYWNlKCJweCIsIiIpOwoJCX0KCgkJd2hpbGUgKG9iaikgewoJCQlpbmZvLmxlZnQgKz0gb2JqLm9mZnNldExlZnQ7CgkJCWluZm8udG9wICs9IG9iai5vZmZzZXRUb3A7CgkJCW9iaiA9IG9iai5vZmZzZXRQYXJlbnQ7CgkJfQoKCQlyZXR1cm4gaW5mbzsKCX0sCgoJQ2xpZW50OiBmdW5jdGlvbihlbGVtKSB7CgkJLy8gY29uc3RydWN0b3IgZm9yIG5ldyBzaW1wbGUgdXBsb2FkIGNsaWVudAoJCXRoaXMuaGFuZGxlcnMgPSB7fTsKCgkJLy8gdW5pcXVlIElECgkJdGhpcy5pZCA9IFplcm9DbGlwYm9hcmRfVGFibGVUb29scy5uZXh0SWQrKzsKCQl0aGlzLm1vdmllSWQgPSAnWmVyb0NsaXBib2FyZF9UYWJsZVRvb2xzTW92aWVfJyArIHRoaXMuaWQ7CgoJCS8vIHJlZ2lzdGVyIGNsaWVudCB3aXRoIHNpbmdsZXRvbiB0byByZWNlaXZlIGZsYXNoIGV2ZW50cwoJCVplcm9DbGlwYm9hcmRfVGFibGVUb29scy5yZWdpc3Rlcih0aGlzLmlkLCB0aGlzKTsKCgkJLy8gY3JlYXRlIG1vdmllCgkJaWYgKGVsZW0pIHsKCQkJdGhpcy5nbHVlKGVsZW0pOwoJCX0KCX0KfTsKClplcm9DbGlwYm9hcmRfVGFibGVUb29scy5DbGllbnQucHJvdG90eXBlID0gewoKCWlkOiAwLCAvLyB1bmlxdWUgSUQgZm9yIHVzCglyZWFkeTogZmFsc2UsIC8vIHdoZXRoZXIgbW92aWUgaXMgcmVhZHkgdG8gcmVjZWl2ZSBldmVudHMgb3Igbm90Cgltb3ZpZTogbnVsbCwgLy8gcmVmZXJlbmNlIHRvIG1vdmllIG9iamVjdAoJY2xpcFRleHQ6ICcnLCAvLyB0ZXh0IHRvIGNvcHkgdG8gY2xpcGJvYXJkCglmaWxlTmFtZTogJycsIC8vIGRlZmF1bHQgZmlsZSBzYXZlIG5hbWUKCWFjdGlvbjogJ2NvcHknLCAvLyBhY3Rpb24gdG8gcGVyZm9ybQoJaGFuZEN1cnNvckVuYWJsZWQ6IHRydWUsIC8vIHdoZXRoZXIgdG8gc2hvdyBoYW5kIGN1cnNvciwgb3IgZGVmYXVsdCBwb2ludGVyIGN1cnNvcgoJY3NzRWZmZWN0czogdHJ1ZSwgLy8gZW5hYmxlIENTUyBtb3VzZSBlZmZlY3RzIG9uIGRvbSBjb250YWluZXIKCWhhbmRsZXJzOiBudWxsLCAvLyB1c2VyIGV2ZW50IGhhbmRsZXJzCglzaXplZDogZmFsc2UsCgoJZ2x1ZTogZnVuY3Rpb24oZWxlbSwgdGl0bGUpIHsKCQkvLyBnbHVlIHRvIERPTSBlbGVtZW50CgkJLy8gZWxlbSBjYW4gYmUgSUQgb3IgYWN0dWFsIERPTSBlbGVtZW50IG9iamVjdAoJCXRoaXMuZG9tRWxlbWVudCA9IFplcm9DbGlwYm9hcmRfVGFibGVUb29scy4kKGVsZW0pOwoKCQkvLyBmbG9hdCBqdXN0IGFib3ZlIG9iamVjdCwgb3IgekluZGV4IDk5IGlmIGRvbSBlbGVtZW50IGlzbid0IHNldAoJCXZhciB6SW5kZXggPSA5OTsKCQlpZiAodGhpcy5kb21FbGVtZW50LnN0eWxlLnpJbmRleCkgewoJCQl6SW5kZXggPSBwYXJzZUludCh0aGlzLmRvbUVsZW1lbnQuc3R5bGUuekluZGV4LCAxMCkgKyAxOwoJCX0KCgkJLy8gZmluZCBYL1kgcG9zaXRpb24gb2YgZG9tRWxlbWVudAoJCXZhciBib3ggPSBaZXJvQ2xpcGJvYXJkX1RhYmxlVG9vbHMuZ2V0RE9NT2JqZWN0UG9zaXRpb24odGhpcy5kb21FbGVtZW50KTsKCgkJLy8gY3JlYXRlIGZsb2F0aW5nIERJViBhYm92ZSBlbGVtZW50CgkJdGhpcy5kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQl2YXIgc3R5bGUgPSB0aGlzLmRpdi5zdHlsZTsKCQlzdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CgkJc3R5bGUubGVmdCA9ICcwcHgnOwoJCXN0eWxlLnRvcCA9ICcwcHgnOwoJCXN0eWxlLndpZHRoID0gKGJveC53aWR0aCkgKyAncHgnOwoJCXN0eWxlLmhlaWdodCA9IGJveC5oZWlnaHQgKyAncHgnOwoJCXN0eWxlLnpJbmRleCA9IHpJbmRleDsKCgkJaWYgKCB0eXBlb2YgdGl0bGUgIT0gInVuZGVmaW5lZCIgJiYgdGl0bGUgIT09ICIiICkgewoJCQl0aGlzLmRpdi50aXRsZSA9IHRpdGxlOwoJCX0KCQlpZiAoIGJveC53aWR0aCAhPT0gMCAmJiBib3guaGVpZ2h0ICE9PSAwICkgewoJCQl0aGlzLnNpemVkID0gdHJ1ZTsKCQl9CgoJCS8vIHN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZjAwJzsgLy8gZGVidWcKCQlpZiAoIHRoaXMuZG9tRWxlbWVudCApIHsKCQkJdGhpcy5kb21FbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZGl2KTsKCQkJdGhpcy5kaXYuaW5uZXJIVE1MID0gdGhpcy5nZXRIVE1MKCBib3gud2lkdGgsIGJveC5oZWlnaHQgKS5yZXBsYWNlKC8mL2csICcmYW1wOycpOwoJCX0KCX0sCgoJcG9zaXRpb25FbGVtZW50OiBmdW5jdGlvbigpIHsKCQl2YXIgYm94ID0gWmVyb0NsaXBib2FyZF9UYWJsZVRvb2xzLmdldERPTU9iamVjdFBvc2l0aW9uKHRoaXMuZG9tRWxlbWVudCk7CgkJdmFyIHN0eWxlID0gdGhpcy5kaXYuc3R5bGU7CgoJCXN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKCQkvL3N0eWxlLmxlZnQgPSAodGhpcy5kb21FbGVtZW50Lm9mZnNldExlZnQpKydweCc7CgkJLy9zdHlsZS50b3AgPSB0aGlzLmRvbUVsZW1lbnQub2Zmc2V0VG9wKydweCc7CgkJc3R5bGUud2lkdGggPSBib3gud2lkdGggKyAncHgnOwoJCXN0eWxlLmhlaWdodCA9IGJveC5oZWlnaHQgKyAncHgnOwoKCQlpZiAoIGJveC53aWR0aCAhPT0gMCAmJiBib3guaGVpZ2h0ICE9PSAwICkgewoJCQl0aGlzLnNpemVkID0gdHJ1ZTsKCQl9IGVsc2UgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgZmxhc2ggPSB0aGlzLmRpdi5jaGlsZE5vZGVzWzBdOwoJCWZsYXNoLndpZHRoID0gYm94LndpZHRoOwoJCWZsYXNoLmhlaWdodCA9IGJveC5oZWlnaHQ7Cgl9LAoKCWdldEhUTUw6IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKCQkvLyByZXR1cm4gSFRNTCBmb3IgbW92aWUKCQl2YXIgaHRtbCA9ICcnOwoJCXZhciBmbGFzaHZhcnMgPSAnaWQ9JyArIHRoaXMuaWQgKwoJCQknJndpZHRoPScgKyB3aWR0aCArCgkJCScmaGVpZ2h0PScgKyBoZWlnaHQ7CgoJCWlmIChuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9NU0lFLykpIHsKCQkJLy8gSUUgZ2V0cyBhbiBPQkpFQ1QgdGFnCgkJCXZhciBwcm90b2NvbCA9IGxvY2F0aW9uLmhyZWYubWF0Y2goL15odHRwcy9pKSA\/ICdodHRwczovLycgOiAnaHR0cDovLyc7CgkJCWh0bWwgKz0gJzxvYmplY3QgY2xhc3NpZD0iY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIiBjb2RlYmFzZT0iJytwcm90b2NvbCsnZG93bmxvYWQubWFjcm9tZWRpYS5jb20vcHViL3Nob2Nrd2F2ZS9jYWJzL2ZsYXNoL3N3Zmxhc2guY2FiI3ZlcnNpb249MTAsMCwwLDAiIHdpZHRoPSInK3dpZHRoKyciIGhlaWdodD0iJytoZWlnaHQrJyIgaWQ9IicrdGhpcy5tb3ZpZUlkKyciIGFsaWduPSJtaWRkbGUiPjxwYXJhbSBuYW1lPSJhbGxvd1NjcmlwdEFjY2VzcyIgdmFsdWU9ImFsd2F5cyIgLz48cGFyYW0gbmFtZT0iYWxsb3dGdWxsU2NyZWVuIiB2YWx1ZT0iZmFsc2UiIC8+PHBhcmFtIG5hbWU9Im1vdmllIiB2YWx1ZT0iJytaZXJvQ2xpcGJvYXJkX1RhYmxlVG9vbHMubW92aWVQYXRoKyciIC8+PHBhcmFtIG5hbWU9Imxvb3AiIHZhbHVlPSJmYWxzZSIgLz48cGFyYW0gbmFtZT0ibWVudSIgdmFsdWU9ImZhbHNlIiAvPjxwYXJhbSBuYW1lPSJxdWFsaXR5IiB2YWx1ZT0iYmVzdCIgLz48cGFyYW0gbmFtZT0iYmdjb2xvciIgdmFsdWU9IiNmZmZmZmYiIC8+PHBhcmFtIG5hbWU9ImZsYXNodmFycyIgdmFsdWU9IicrZmxhc2h2YXJzKyciLz48cGFyYW0gbmFtZT0id21vZGUiIHZhbHVlPSJ0cmFuc3BhcmVudCIvPjwvb2JqZWN0Pic7CgkJfQoJCWVsc2UgewoJCQkvLyBhbGwgb3RoZXIgYnJvd3NlcnMgZ2V0IGFuIEVNQkVEIHRhZwoJCQlodG1sICs9ICc8ZW1iZWQgaWQ9IicrdGhpcy5tb3ZpZUlkKyciIHNyYz0iJytaZXJvQ2xpcGJvYXJkX1RhYmxlVG9vbHMubW92aWVQYXRoKyciIGxvb3A9ImZhbHNlIiBtZW51PSJmYWxzZSIgcXVhbGl0eT0iYmVzdCIgYmdjb2xvcj0iI2ZmZmZmZiIgd2lkdGg9Iicrd2lkdGgrJyIgaGVpZ2h0PSInK2hlaWdodCsnIiBuYW1lPSInK3RoaXMubW92aWVJZCsnIiBhbGlnbj0ibWlkZGxlIiBhbGxvd1NjcmlwdEFjY2Vzcz0iYWx3YXlzIiBhbGxvd0Z1bGxTY3JlZW49ImZhbHNlIiB0eXBlPSJhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCIgcGx1Z2luc3BhZ2U9Imh0dHA6Ly93d3cubWFjcm9tZWRpYS5jb20vZ28vZ2V0Zmxhc2hwbGF5ZXIiIGZsYXNodmFycz0iJytmbGFzaHZhcnMrJyIgd21vZGU9InRyYW5zcGFyZW50IiAvPic7CgkJfQoJCXJldHVybiBodG1sOwoJfSwKCgloaWRlOiBmdW5jdGlvbigpIHsKCQkvLyB0ZW1wb3JhcmlseSBoaWRlIGZsb2F0ZXIgb2Zmc2NyZWVuCgkJaWYgKHRoaXMuZGl2KSB7CgkJCXRoaXMuZGl2LnN0eWxlLmxlZnQgPSAnLTIwMDBweCc7CgkJfQoJfSwKCglzaG93OiBmdW5jdGlvbigpIHsKCQkvLyBzaG93IG91cnNlbHZlcyBhZnRlciBhIGNhbGwgdG8gaGlkZSgpCgkJdGhpcy5yZXBvc2l0aW9uKCk7Cgl9LAoKCWRlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCS8vIGRlc3Ryb3kgY29udHJvbCBhbmQgZmxvYXRlcgoJCWlmICh0aGlzLmRvbUVsZW1lbnQgJiYgdGhpcy5kaXYpIHsKCQkJdGhpcy5oaWRlKCk7CgkJCXRoaXMuZGl2LmlubmVySFRNTCA9ICcnOwoKCQkJdmFyIGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdOwoJCQl0cnkgeyBib2R5LnJlbW92ZUNoaWxkKCB0aGlzLmRpdiApOyB9IGNhdGNoKGUpIHt9CgoJCQl0aGlzLmRvbUVsZW1lbnQgPSBudWxsOwoJCQl0aGlzLmRpdiA9IG51bGw7CgkJfQoJfSwKCglyZXBvc2l0aW9uOiBmdW5jdGlvbihlbGVtKSB7CgkJLy8gcmVwb3NpdGlvbiBvdXIgZmxvYXRpbmcgZGl2LCBvcHRpb25hbGx5IHRvIG5ldyBjb250YWluZXIKCQkvLyB3YXJuaW5nOiBjb250YWluZXIgQ0FOTk9UIGNoYW5nZSBzaXplLCBvbmx5IHBvc2l0aW9uCgkJaWYgKGVsZW0pIHsKCQkJdGhpcy5kb21FbGVtZW50ID0gWmVyb0NsaXBib2FyZF9UYWJsZVRvb2xzLiQoZWxlbSk7CgkJCWlmICghdGhpcy5kb21FbGVtZW50KSB7CgkJCQl0aGlzLmhpZGUoKTsKCQkJfQoJCX0KCgkJaWYgKHRoaXMuZG9tRWxlbWVudCAmJiB0aGlzLmRpdikgewoJCQl2YXIgYm94ID0gWmVyb0NsaXBib2FyZF9UYWJsZVRvb2xzLmdldERPTU9iamVjdFBvc2l0aW9uKHRoaXMuZG9tRWxlbWVudCk7CgkJCXZhciBzdHlsZSA9IHRoaXMuZGl2LnN0eWxlOwoJCQlzdHlsZS5sZWZ0ID0gJycgKyBib3gubGVmdCArICdweCc7CgkJCXN0eWxlLnRvcCA9ICcnICsgYm94LnRvcCArICdweCc7CgkJfQoJfSwKCgljbGVhclRleHQ6IGZ1bmN0aW9uKCkgewoJCS8vIGNsZWFyIHRoZSB0ZXh0IHRvIGJlIGNvcHkgLyBzYXZlZAoJCXRoaXMuY2xpcFRleHQgPSAnJzsKCQlpZiAodGhpcy5yZWFkeSkgewoJCQl0aGlzLm1vdmllLmNsZWFyVGV4dCgpOwoJCX0KCX0sCgoJYXBwZW5kVGV4dDogZnVuY3Rpb24obmV3VGV4dCkgewoJCS8vIGFwcGVuZCB0ZXh0IHRvIHRoYXQgd2hpY2ggaXMgdG8gYmUgY29waWVkIC8gc2F2ZWQKCQl0aGlzLmNsaXBUZXh0ICs9IG5ld1RleHQ7CgkJaWYgKHRoaXMucmVhZHkpIHsgdGhpcy5tb3ZpZS5hcHBlbmRUZXh0KG5ld1RleHQpIDt9Cgl9LAoKCXNldFRleHQ6IGZ1bmN0aW9uKG5ld1RleHQpIHsKCQkvLyBzZXQgdGV4dCB0byBiZSBjb3BpZWQgdG8gYmUgY29waWVkIC8gc2F2ZWQKCQl0aGlzLmNsaXBUZXh0ID0gbmV3VGV4dDsKCQlpZiAodGhpcy5yZWFkeSkgeyB0aGlzLm1vdmllLnNldFRleHQobmV3VGV4dCkgO30KCX0sCgoJc2V0Q2hhclNldDogZnVuY3Rpb24oY2hhclNldCkgewoJCS8vIHNldCB0aGUgY2hhcmFjdGVyIHNldCAoVVRGMTZMRSBvciBVVEY4KQoJCXRoaXMuY2hhclNldCA9IGNoYXJTZXQ7CgkJaWYgKHRoaXMucmVhZHkpIHsgdGhpcy5tb3ZpZS5zZXRDaGFyU2V0KGNoYXJTZXQpIDt9Cgl9LAoKCXNldEJvbUluYzogZnVuY3Rpb24oYm9tSW5jKSB7CgkJLy8gc2V0IGlmIHRoZSBCT00gc2hvdWxkIGJlIGluY2x1ZGVkIG9yIG5vdAoJCXRoaXMuaW5jQm9tID0gYm9tSW5jOwoJCWlmICh0aGlzLnJlYWR5KSB7IHRoaXMubW92aWUuc2V0Qm9tSW5jKGJvbUluYykgO30KCX0sCgoJc2V0RmlsZU5hbWU6IGZ1bmN0aW9uKG5ld1RleHQpIHsKCQkvLyBzZXQgdGhlIGZpbGUgbmFtZQoJCXRoaXMuZmlsZU5hbWUgPSBuZXdUZXh0OwoJCWlmICh0aGlzLnJlYWR5KSB7CgkJCXRoaXMubW92aWUuc2V0RmlsZU5hbWUobmV3VGV4dCk7CgkJfQoJfSwKCglzZXRBY3Rpb246IGZ1bmN0aW9uKG5ld1RleHQpIHsKCQkvLyBzZXQgYWN0aW9uIChzYXZlIG9yIGNvcHkpCgkJdGhpcy5hY3Rpb24gPSBuZXdUZXh0OwoJCWlmICh0aGlzLnJlYWR5KSB7CgkJCXRoaXMubW92aWUuc2V0QWN0aW9uKG5ld1RleHQpOwoJCX0KCX0sCgoJYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24oZXZlbnROYW1lLCBmdW5jKSB7CgkJLy8gYWRkIHVzZXIgZXZlbnQgbGlzdGVuZXIgZm9yIGV2ZW50CgkJLy8gZXZlbnQgdHlwZXM6IGxvYWQsIHF1ZXVlU3RhcnQsIGZpbGVTdGFydCwgZmlsZUNvbXBsZXRlLCBxdWV1ZUNvbXBsZXRlLCBwcm9ncmVzcywgZXJyb3IsIGNhbmNlbAoJCWV2ZW50TmFtZSA9IGV2ZW50TmFtZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXm9uLywgJycpOwoJCWlmICghdGhpcy5oYW5kbGVyc1tldmVudE5hbWVdKSB7CgkJCXRoaXMuaGFuZGxlcnNbZXZlbnROYW1lXSA9IFtdOwoJCX0KCQl0aGlzLmhhbmRsZXJzW2V2ZW50TmFtZV0ucHVzaChmdW5jKTsKCX0sCgoJc2V0SGFuZEN1cnNvcjogZnVuY3Rpb24oZW5hYmxlZCkgewoJCS8vIGVuYWJsZSBoYW5kIGN1cnNvciAodHJ1ZSksIG9yIGRlZmF1bHQgYXJyb3cgY3Vyc29yIChmYWxzZSkKCQl0aGlzLmhhbmRDdXJzb3JFbmFibGVkID0gZW5hYmxlZDsKCQlpZiAodGhpcy5yZWFkeSkgewoJCQl0aGlzLm1vdmllLnNldEhhbmRDdXJzb3IoZW5hYmxlZCk7CgkJfQoJfSwKCglzZXRDU1NFZmZlY3RzOiBmdW5jdGlvbihlbmFibGVkKSB7CgkJLy8gZW5hYmxlIG9yIGRpc2FibGUgQ1NTIGVmZmVjdHMgb24gRE9NIGNvbnRhaW5lcgoJCXRoaXMuY3NzRWZmZWN0cyA9ICEhZW5hYmxlZDsKCX0sCgoJcmVjZWl2ZUV2ZW50OiBmdW5jdGlvbihldmVudE5hbWUsIGFyZ3MpIHsKCQl2YXIgc2VsZjsKCgkJLy8gcmVjZWl2ZSBldmVudCBmcm9tIGZsYXNoCgkJZXZlbnROYW1lID0gZXZlbnROYW1lLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9eb24vLCAnJyk7CgoJCS8vIHNwZWNpYWwgYmVoYXZpb3IgZm9yIGNlcnRhaW4gZXZlbnRzCgkJc3dpdGNoIChldmVudE5hbWUpIHsKCQkJY2FzZSAnbG9hZCc6CgkJCQkvLyBtb3ZpZSBjbGFpbXMgaXQgaXMgcmVhZHksIGJ1dCBpbiBJRSB0aGlzIGlzbid0IGFsd2F5cyB0aGUgY2FzZS4uLgoJCQkJLy8gYnVnIGZpeDogQ2Fubm90IGV4dGVuZCBFTUJFRCBET00gZWxlbWVudHMgaW4gRmlyZWZveCwgbXVzdCB1c2UgdHJhZGl0aW9uYWwgZnVuY3Rpb24KCQkJCXRoaXMubW92aWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm1vdmllSWQpOwoJCQkJaWYgKCF0aGlzLm1vdmllKSB7CgkJCQkJc2VsZiA9IHRoaXM7CgkJCQkJc2V0VGltZW91dCggZnVuY3Rpb24oKSB7IHNlbGYucmVjZWl2ZUV2ZW50KCdsb2FkJywgbnVsbCk7IH0sIDEgKTsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJLy8gZmlyZWZveCBvbiBwYyBuZWVkcyBhICJraWNrIiBpbiBvcmRlciB0byBzZXQgdGhlc2UgaW4gY2VydGFpbiBjYXNlcwoJCQkJaWYgKCF0aGlzLnJlYWR5ICYmIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0ZpcmVmb3gvKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9XaW5kb3dzLykpIHsKCQkJCQlzZWxmID0gdGhpczsKCQkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHsgc2VsZi5yZWNlaXZlRXZlbnQoJ2xvYWQnLCBudWxsKTsgfSwgMTAwICk7CgkJCQkJdGhpcy5yZWFkeSA9IHRydWU7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCXRoaXMucmVhZHkgPSB0cnVlOwoJCQkJdGhpcy5tb3ZpZS5jbGVhclRleHQoKTsKCQkJCXRoaXMubW92aWUuYXBwZW5kVGV4dCggdGhpcy5jbGlwVGV4dCApOwoJCQkJdGhpcy5tb3ZpZS5zZXRGaWxlTmFtZSggdGhpcy5maWxlTmFtZSApOwoJCQkJdGhpcy5tb3ZpZS5zZXRBY3Rpb24oIHRoaXMuYWN0aW9uICk7CgkJCQl0aGlzLm1vdmllLnNldENoYXJTZXQoIHRoaXMuY2hhclNldCApOwoJCQkJdGhpcy5tb3ZpZS5zZXRCb21JbmMoIHRoaXMuaW5jQm9tICk7CgkJCQl0aGlzLm1vdmllLnNldEhhbmRDdXJzb3IoIHRoaXMuaGFuZEN1cnNvckVuYWJsZWQgKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnbW91c2VvdmVyJzoKCQkJCWlmICh0aGlzLmRvbUVsZW1lbnQgJiYgdGhpcy5jc3NFZmZlY3RzKSB7CgkJCQkJLy90aGlzLmRvbUVsZW1lbnQuYWRkQ2xhc3MoJ2hvdmVyJyk7CgkJCQkJaWYgKHRoaXMucmVjb3ZlckFjdGl2ZSkgewoJCQkJCQl0aGlzLmRvbUVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpOwoJCQkJCX0KCQkJCX0KCQkJCWJyZWFrOwoKCQkJY2FzZSAnbW91c2VvdXQnOgoJCQkJaWYgKHRoaXMuZG9tRWxlbWVudCAmJiB0aGlzLmNzc0VmZmVjdHMpIHsKCQkJCQl0aGlzLnJlY292ZXJBY3RpdmUgPSBmYWxzZTsKCQkJCQlpZiAodGhpcy5kb21FbGVtZW50Lmhhc0NsYXNzKCdhY3RpdmUnKSkgewoJCQkJCQl0aGlzLmRvbUVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwoJCQkJCQl0aGlzLnJlY292ZXJBY3RpdmUgPSB0cnVlOwoJCQkJCX0KCQkJCQkvL3RoaXMuZG9tRWxlbWVudC5yZW1vdmVDbGFzcygnaG92ZXInKTsKCQkJCX0KCQkJCWJyZWFrOwoKCQkJY2FzZSAnbW91c2Vkb3duJzoKCQkJCWlmICh0aGlzLmRvbUVsZW1lbnQgJiYgdGhpcy5jc3NFZmZlY3RzKSB7CgkJCQkJdGhpcy5kb21FbGVtZW50LmFkZENsYXNzKCdhY3RpdmUnKTsKCQkJCX0KCQkJCWJyZWFrOwoKCQkJY2FzZSAnbW91c2V1cCc6CgkJCQlpZiAodGhpcy5kb21FbGVtZW50ICYmIHRoaXMuY3NzRWZmZWN0cykgewoJCQkJCXRoaXMuZG9tRWxlbWVudC5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CgkJCQkJdGhpcy5yZWNvdmVyQWN0aXZlID0gZmFsc2U7CgkJCQl9CgkJCQlicmVhazsKCQl9IC8vIHN3aXRjaCBldmVudE5hbWUKCgkJaWYgKHRoaXMuaGFuZGxlcnNbZXZlbnROYW1lXSkgewoJCQlmb3IgKHZhciBpZHggPSAwLCBsZW4gPSB0aGlzLmhhbmRsZXJzW2V2ZW50TmFtZV0ubGVuZ3RoOyBpZHggPCBsZW47IGlkeCsrKSB7CgkJCQl2YXIgZnVuYyA9IHRoaXMuaGFuZGxlcnNbZXZlbnROYW1lXVtpZHhdOwoKCQkJCWlmICh0eXBlb2YoZnVuYykgPT0gJ2Z1bmN0aW9uJykgewoJCQkJCS8vIGFjdHVhbCBmdW5jdGlvbiByZWZlcmVuY2UKCQkJCQlmdW5jKHRoaXMsIGFyZ3MpOwoJCQkJfQoJCQkJZWxzZSBpZiAoKHR5cGVvZihmdW5jKSA9PSAnb2JqZWN0JykgJiYgKGZ1bmMubGVuZ3RoID09IDIpKSB7CgkJCQkJLy8gUEhQIHN0eWxlIG9iamVjdCArIG1ldGhvZCwgaS5lLiBbbXlPYmplY3QsICdteU1ldGhvZCddCgkJCQkJZnVuY1swXVsgZnVuY1sxXSBdKHRoaXMsIGFyZ3MpOwoJCQkJfQoJCQkJZWxzZSBpZiAodHlwZW9mKGZ1bmMpID09ICdzdHJpbmcnKSB7CgkJCQkJLy8gbmFtZSBvZiBmdW5jdGlvbgoJCQkJCXdpbmRvd1tmdW5jXSh0aGlzLCBhcmdzKTsKCQkJCX0KCQkJfSAvLyBmb3JlYWNoIGV2ZW50IGhhbmRsZXIgZGVmaW5lZAoJCX0gLy8gdXNlciBkZWZpbmVkIGhhbmRsZXIgZm9yIGV2ZW50Cgl9Cgp9OwoKLy8gRm9yIHRoZSBGbGFzaCBiaW5kaW5nIHRvIHdvcmssIFplcm9DbGlwYm9hcmRfVGFibGVUb29scyBtdXN0IGJlIG9uIHRoZSBnbG9iYWwKLy8gb2JqZWN0IGxpc3QKd2luZG93Llplcm9DbGlwYm9hcmRfVGFibGVUb29scyA9IFplcm9DbGlwYm9hcmRfVGFibGVUb29sczsKLy9pbmNsdWRlIFRhYmxlVG9vbHMuanMKLyogVGFibGVUb29scwogKiAyMDA5LTIwMTQgU3ByeU1lZGlhIEx0ZCAtIGRhdGF0YWJsZXMubmV0L2xpY2Vuc2UKICovCgovKmdsb2JhbHMgVGFibGVUb29scyxaZXJvQ2xpcGJvYXJkX1RhYmxlVG9vbHMqLwoKCihmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50KSB7CgovKiogCiAqIFRhYmxlVG9vbHMgcHJvdmlkZXMgZmxleGlibGUgYnV0dG9ucyBhbmQgb3RoZXIgdG9vbHMgZm9yIGEgRGF0YVRhYmxlcyBlbmhhbmNlZCB0YWJsZQogKiBAY2xhc3MgVGFibGVUb29scwogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtPYmplY3R9IG9EVCBEYXRhVGFibGVzIGluc3RhbmNlLiBXaGVuIHVzaW5nIERhdGFUYWJsZXMgMS4xMCB0aGlzIGNhbgogKiAgIGFsc28gYmUgYSBqUXVlcnkgY29sbGVjdGlvbiwgalF1ZXJ5IHNlbGVjdG9yLCB0YWJsZSBub2RlLCBEYXRhVGFibGVzIEFQSQogKiAgIGluc3RhbmNlIG9yIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0LgogKiBAcGFyYW0ge09iamVjdH0gb09wdHMgVGFibGVUb29scyBvcHRpb25zCiAqIEBwYXJhbSB7U3RyaW5nfSBvT3B0cy5zU3dmUGF0aCBaZXJvQ2xpcGJvYXJkIFNXRiBwYXRoCiAqIEBwYXJhbSB7U3RyaW5nfSBvT3B0cy5zUm93U2VsZWN0IFJvdyBzZWxlY3Rpb24gb3B0aW9ucyAtICdub25lJywgJ3NpbmdsZScsICdtdWx0aScgb3IgJ29zJwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBvT3B0cy5mblByZVJvd1NlbGVjdCBDYWxsYmFjayBmdW5jdGlvbiBqdXN0IHByaW9yIHRvIHJvdyBzZWxlY3Rpb24KICogQHBhcmFtIHtGdW5jdGlvbn0gb09wdHMuZm5Sb3dTZWxlY3RlZCBDYWxsYmFjayBmdW5jdGlvbiBqdXN0IGFmdGVyIHJvdyBzZWxlY3Rpb24KICogQHBhcmFtIHtGdW5jdGlvbn0gb09wdHMuZm5Sb3dEZXNlbGVjdGVkIENhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gcm93IGlzIGRlc2VsZWN0ZWQKICogQHBhcmFtIHtBcnJheX0gb09wdHMuYUJ1dHRvbnMgTGlzdCBvZiBidXR0b25zIHRvIGJlIHVzZWQKICovClRhYmxlVG9vbHMgPSBmdW5jdGlvbiggb0RULCBvT3B0cyApCnsKCS8qIFNhbnRpeSBjaGVjayB0aGF0IHdlIGFyZSBhIG5ldyBpbnN0YW5jZSAqLwoJaWYgKCAhIHRoaXMgaW5zdGFuY2VvZiBUYWJsZVRvb2xzICkKCXsKCQlhbGVydCggIldhcm5pbmc6IFRhYmxlVG9vbHMgbXVzdCBiZSBpbml0aWFsaXNlZCB3aXRoIHRoZSBrZXl3b3JkICduZXcnIiApOwoJfQoKCS8vIEluIDEuMTAgd2UgY2FuIHVzZSB0aGUgQVBJIHRvIGdldCB0aGUgc2V0dGluZ3Mgb2JqZWN0IGZyb20gYSBudW1iZXIgb2YKCS8vIHNvdXJjZXMKCXZhciBkdFNldHRpbmdzID0gJC5mbi5kYXRhVGFibGUuQXBpID8KCQluZXcgJC5mbi5kYXRhVGFibGUuQXBpKCBvRFQgKS5zZXR0aW5ncygpWzBdIDoKCQlvRFQuZm5TZXR0aW5ncygpOwoKCgkvKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqCgkgKiBQdWJsaWMgY2xhc3MgdmFyaWFibGVzCgkgKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqLwoKCS8qKgoJICogQG5hbWVzcGFjZSBTZXR0aW5ncyBvYmplY3Qgd2hpY2ggY29udGFpbnMgY3VzdG9taXNhYmxlIGluZm9ybWF0aW9uIGZvciBUYWJsZVRvb2xzIGluc3RhbmNlCgkgKi8KCXRoaXMucyA9IHsKCQkvKioKCQkgKiBTdG9yZSAndGhpcycgc28gdGhlIGluc3RhbmNlIGNhbiBiZSByZXRyaWV2ZWQgZnJvbSB0aGUgc2V0dGluZ3Mgb2JqZWN0CgkJICogQHByb3BlcnR5IHRoYXQKCQkgKiBAdHlwZQkgb2JqZWN0CgkJICogQGRlZmF1bHQgIHRoaXMKCQkgKi8KCQkidGhhdCI6IHRoaXMsCgoJCS8qKiAKCQkgKiBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdHMKCQkgKiBAcHJvcGVydHkgZHQKCQkgKiBAdHlwZQkgb2JqZWN0CgkJICogQGRlZmF1bHQgIDxpPkZyb20gdGhlIG9EVCBpbml0IG9wdGlvbjwvaT4KCQkgKi8KCQkiZHQiOiBkdFNldHRpbmdzLAoKCQkvKioKCQkgKiBAbmFtZXNwYWNlIFByaW50IHNwZWNpZmljIGluZm9ybWF0aW9uCgkJICovCgkJInByaW50IjogewoJCQkvKiogCgkJCSAqIERhdGFUYWJsZXMgZHJhdyAnc3RhcnQnIHBvaW50IGJlZm9yZSB0aGUgcHJpbnRpbmcgZGlzcGxheSB3YXMgc2hvd24KCQkJICogIEBwcm9wZXJ0eSBzYXZlU3RhcnQKCQkJICogIEB0eXBlCSBpbnQKCQkJICogIEBkZWZhdWx0ICAtMQoJCQkgKi8KCQkJInNhdmVTdGFydCI6IC0xLAoKCQkJLyoqIAoJCQkgKiBEYXRhVGFibGVzIGRyYXcgJ2xlbmd0aCcgcG9pbnQgYmVmb3JlIHRoZSBwcmludGluZyBkaXNwbGF5IHdhcyBzaG93bgoJCQkgKiAgQHByb3BlcnR5IHNhdmVMZW5ndGgKCQkJICogIEB0eXBlCSBpbnQKCQkJICogIEBkZWZhdWx0ICAtMQoJCQkgKi8KCQkJInNhdmVMZW5ndGgiOiAtMSwKCgkJCS8qKiAKCQkJICogUGFnZSBzY3JvbGxpbmcgcG9pbnQgYmVmb3JlIHRoZSBwcmludGluZyBkaXNwbGF5IHdhcyBzaG93biBzbyBpdCBjYW4gYmUgcmVzdG9yZWQKCQkJICogIEBwcm9wZXJ0eSBzYXZlU2Nyb2xsCgkJCSAqICBAdHlwZQkgaW50CgkJCSAqICBAZGVmYXVsdCAgLTEKCQkJICovCgkJCSJzYXZlU2Nyb2xsIjogLTEsCgoJCQkvKiogCgkJCSAqIFdyYXBwZWQgZnVuY3Rpb24gdG8gZW5kIHRoZSBwcmludCBkaXNwbGF5ICh0byBtYWludGFpbiBzY29wZSkKCQkJICogIEBwcm9wZXJ0eSBmdW5jRW5kCgkJCSAqICBAdHlwZQkgRnVuY3Rpb24KCQkJICogIEBkZWZhdWx0ICBmdW5jdGlvbiAoKSB7fQoJCQkgKi8KCQkJImZ1bmNFbmQiOiBmdW5jdGlvbiAoKSB7fQoJCX0sCgoJCS8qKgoJCSAqIEEgdW5pcXVlIElEIGlzIGFzc2lnbmVkIHRvIGVhY2ggYnV0dG9uIGluIGVhY2ggaW5zdGFuY2UKCQkgKiBAcHJvcGVydHkgYnV0dG9uQ291bnRlcgoJCSAqICBAdHlwZQkgaW50CgkJICogQGRlZmF1bHQgIDAKCQkgKi8KCQkiYnV0dG9uQ291bnRlciI6IDAsCgoJCS8qKgoJCSAqIEBuYW1lc3BhY2UgU2VsZWN0IHJvd3Mgc3BlY2lmaWMgaW5mb3JtYXRpb24KCQkgKi8KCQkic2VsZWN0IjogewoJCQkvKioKCQkJICogU2VsZWN0IHR5cGUgLSBjYW4gYmUgJ25vbmUnLCAnc2luZ2xlJyBvciAnbXVsdGknCgkJCSAqIEBwcm9wZXJ0eSB0eXBlCgkJCSAqICBAdHlwZQkgc3RyaW5nCgkJCSAqIEBkZWZhdWx0ICAiIgoJCQkgKi8KCQkJInR5cGUiOiAiIiwKCgkJCS8qKgoJCQkgKiBBcnJheSBvZiBub2RlcyB3aGljaCBhcmUgY3VycmVudGx5IHNlbGVjdGVkCgkJCSAqICBAcHJvcGVydHkgc2VsZWN0ZWQKCQkJICogIEB0eXBlCSBhcnJheQoJCQkgKiAgQGRlZmF1bHQgIFtdCgkJCSAqLwoJCQkic2VsZWN0ZWQiOiBbXSwKCgkJCS8qKgoJCQkgKiBGdW5jdGlvbiB0byBydW4gYmVmb3JlIHRoZSBzZWxlY3Rpb24gY2FuIHRha2UgcGxhY2UuIFdpbGwgY2FuY2VsIHRoZSBzZWxlY3QgaWYgdGhlCgkJCSAqIGZ1bmN0aW9uIHJldHVybnMgZmFsc2UKCQkJICogIEBwcm9wZXJ0eSBwcmVSb3dTZWxlY3QKCQkJICogIEB0eXBlCSBGdW5jdGlvbgoJCQkgKiAgQGRlZmF1bHQgIG51bGwKCQkJICovCgkJCSJwcmVSb3dTZWxlY3QiOiBudWxsLAoKCQkJLyoqCgkJCSAqIEZ1bmN0aW9uIHRvIHJ1biB3aGVuIGEgcm93IGlzIHNlbGVjdGVkCgkJCSAqICBAcHJvcGVydHkgcG9zdFNlbGVjdGVkCgkJCSAqICBAdHlwZQkgRnVuY3Rpb24KCQkJICogIEBkZWZhdWx0ICBudWxsCgkJCSAqLwoJCQkicG9zdFNlbGVjdGVkIjogbnVsbCwKCgkJCS8qKgoJCQkgKiBGdW5jdGlvbiB0byBydW4gd2hlbiBhIHJvdyBpcyBkZXNlbGVjdGVkCgkJCSAqICBAcHJvcGVydHkgcG9zdERlc2VsZWN0ZWQKCQkJICogIEB0eXBlCSBGdW5jdGlvbgoJCQkgKiAgQGRlZmF1bHQgIG51bGwKCQkJICovCgkJCSJwb3N0RGVzZWxlY3RlZCI6IG51bGwsCgoJCQkvKioKCQkJICogSW5kaWNhdGUgaWYgYWxsIHJvd3MgYXJlIHNlbGVjdGVkIChuZWVkZWQgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcpCgkJCSAqICBAcHJvcGVydHkgYWxsCgkJCSAqICBAdHlwZQkgYm9vbGVhbgoJCQkgKiAgQGRlZmF1bHQgIGZhbHNlCgkJCSAqLwoJCQkiYWxsIjogZmFsc2UsCgoJCQkvKioKCQkJICogQ2xhc3MgbmFtZSB0byBhZGQgdG8gc2VsZWN0ZWQgVFIgbm9kZXMKCQkJICogIEBwcm9wZXJ0eSBzZWxlY3RlZENsYXNzCgkJCSAqICBAdHlwZQkgU3RyaW5nCgkJCSAqICBAZGVmYXVsdCAgIiIKCQkJICovCgkJCSJzZWxlY3RlZENsYXNzIjogIiIKCQl9LAoKCQkvKioKCQkgKiBTdG9yZSBvZiB0aGUgdXNlciBpbnB1dCBjdXN0b21pc2F0aW9uIG9iamVjdAoJCSAqICBAcHJvcGVydHkgY3VzdG9tCgkJICogIEB0eXBlCSBvYmplY3QKCQkgKiAgQGRlZmF1bHQgIHt9CgkJICovCgkJImN1c3RvbSI6IHt9LAoKCQkvKioKCQkgKiBTV0YgbW92aWUgcGF0aAoJCSAqICBAcHJvcGVydHkgc3dmUGF0aAoJCSAqICBAdHlwZQkgc3RyaW5nCgkJICogIEBkZWZhdWx0ICAiIgoJCSAqLwoJCSJzd2ZQYXRoIjogIiIsCgoJCS8qKgoJCSAqIERlZmF1bHQgYnV0dG9uIHNldAoJCSAqICBAcHJvcGVydHkgYnV0dG9uU2V0CgkJICogIEB0eXBlCSBhcnJheQoJCSAqICBAZGVmYXVsdCAgW10KCQkgKi8KCQkiYnV0dG9uU2V0IjogW10sCgoJCS8qKgoJCSAqIFdoZW4gdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBUYWJsZVRvb2xzIGluc3RhbmNlIGZvciBhIERhdGFUYWJsZSwgdGhlcmUgbXVzdCBiZSBhIAoJCSAqIG1hc3RlciB3aGljaCBjb250cm9scyBldmVudHMgKHJvdyBzZWxlY3Rpb24gZXRjKQoJCSAqICBAcHJvcGVydHkgbWFzdGVyCgkJICogIEB0eXBlCSBib29sZWFuCgkJICogIEBkZWZhdWx0ICBmYWxzZQoJCSAqLwoJCSJtYXN0ZXIiOiBmYWxzZSwKCgkJLyoqCgkJICogVGFnIG5hbWVzIHRoYXQgYXJlIHVzZWQgZm9yIGNyZWF0aW5nIGNvbGxlY3Rpb25zIGFuZCBidXR0b25zCgkJICogIEBuYW1lc2FwY2UKCQkgKi8KCQkidGFncyI6IHt9Cgl9OwoKCgkvKioKCSAqIEBuYW1lc3BhY2UgQ29tbW9uIGFuZCB1c2VmdWwgRE9NIGVsZW1lbnRzIGZvciB0aGUgY2xhc3MgaW5zdGFuY2UKCSAqLwoJdGhpcy5kb20gPSB7CgkJLyoqCgkJICogRElWIGVsZW1lbnQgdGhhdCBpcyBjcmVhdGUgYW5kIGFsbCBUYWJsZVRvb2xzIGJ1dHRvbnMgKGFuZCB0aGVpciBjaGlsZHJlbikgcHV0IGludG8KCQkgKiAgQHByb3BlcnR5IGNvbnRhaW5lcgoJCSAqICBAdHlwZQkgbm9kZQoJCSAqICBAZGVmYXVsdCAgbnVsbAoJCSAqLwoJCSJjb250YWluZXIiOiBudWxsLAoKCQkvKioKCQkgKiBUaGUgdGFibGUgbm9kZSB0byB3aGljaCBUYWJsZVRvb2xzIHdpbGwgYmUgYXBwbGllZAoJCSAqICBAcHJvcGVydHkgdGFibGUKCQkgKiAgQHR5cGUJIG5vZGUKCQkgKiAgQGRlZmF1bHQgIG51bGwKCQkgKi8KCQkidGFibGUiOiBudWxsLAoKCQkvKioKCQkgKiBAbmFtZXNwYWNlIE5vZGVzIHVzZWQgZm9yIHRoZSBwcmludCBkaXNwbGF5CgkJICovCgkJInByaW50IjogewoJCQkvKioKCQkJICogTm9kZXMgd2hpY2ggaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgZGlzcGxheSBieSBzZXR0aW5nIHRoZW0gdG8gZGlzcGxheSBub25lCgkJCSAqICBAcHJvcGVydHkgaGlkZGVuCgkJCSAqICBAdHlwZQkgYXJyYXkKCQkJICogIEBkZWZhdWx0ICBbXQoJCQkgKi8KCQkJImhpZGRlbiI6IFtdLAoKCQkJLyoqCgkJCSAqIFRoZSBpbmZvcm1hdGlvbiBkaXNwbGF5IHNheWluZyB0ZWxsaW5nIHRoZSB1c2VyIGFib3V0IHRoZSBwcmludCBkaXNwbGF5CgkJCSAqICBAcHJvcGVydHkgbWVzc2FnZQoJCQkgKiAgQHR5cGUJIG5vZGUKCQkJICogIEBkZWZhdWx0ICBudWxsCgkJCSAqLwoJCQkibWVzc2FnZSI6IG51bGwKCSAgfSwKCgkJLyoqCgkJICogQG5hbWVzcGFjZSBOb2RlcyB1c2VkIGZvciBhIGNvbGxlY3Rpb24gZGlzcGxheS4gVGhpcyBjb250YWlucyB0aGUgY3VycmVudGx5IHVzZWQgY29sbGVjdGlvbgoJCSAqLwoJCSJjb2xsZWN0aW9uIjogewoJCQkvKioKCQkJICogVGhlIGRpdiB3cmFwcGVyIGNvbnRhaW5pbmcgdGhlIGJ1dHRvbnMgaW4gdGhlIGNvbGxlY3Rpb24gKGkuZS4gdGhlIG1lbnUpCgkJCSAqICBAcHJvcGVydHkgY29sbGVjdGlvbgoJCQkgKiAgQHR5cGUJIG5vZGUKCQkJICogIEBkZWZhdWx0ICBudWxsCgkJCSAqLwoJCQkiY29sbGVjdGlvbiI6IG51bGwsCgoJCQkvKioKCQkJICogQmFja2dyb3VuZCBkaXNwbGF5IHRvIHByb3ZpZGUgZm9jdXMgYW5kIGNhcHR1cmUgZXZlbnRzCgkJCSAqICBAcHJvcGVydHkgYmFja2dyb3VuZAoJCQkgKiAgQHR5cGUJIG5vZGUKCQkJICogIEBkZWZhdWx0ICBudWxsCgkJCSAqLwoJCQkiYmFja2dyb3VuZCI6IG51bGwKCQl9Cgl9OwoKCS8qKgoJICogQG5hbWVzcGFjZSBOYW1lIHNwYWNlIGZvciB0aGUgY2xhc3NlcyB0aGF0IHRoaXMgVGFibGVUb29scyBpbnN0YW5jZSB3aWxsIHVzZQoJICogQGV4dGVuZHMgVGFibGVUb29scy5jbGFzc2VzCgkgKi8KCXRoaXMuY2xhc3NlcyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgVGFibGVUb29scy5jbGFzc2VzICk7CglpZiAoIHRoaXMucy5kdC5iSlVJICkKCXsKCQkkLmV4dGVuZCggdHJ1ZSwgdGhpcy5jbGFzc2VzLCBUYWJsZVRvb2xzLmNsYXNzZXNfdGhlbWVyb2xsZXIgKTsKCX0KCgoJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKgoJICogUHVibGljIGNsYXNzIG1ldGhvZHMKCSAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovCgoJLyoqCgkgKiBSZXRyZWlldmUgdGhlIHNldHRpbmdzIG9iamVjdCBmcm9tIGFuIGluc3RhbmNlCgkgKiAgQG1ldGhvZCBmblNldHRpbmdzCgkgKiAgQHJldHVybnMge29iamVjdH0gVGFibGVUb29scyBzZXR0aW5ncyBvYmplY3QKCSAqLwoJdGhpcy5mblNldHRpbmdzID0gZnVuY3Rpb24gKCkgewoJCXJldHVybiB0aGlzLnM7Cgl9OwoKCgkvKiBDb25zdHJ1Y3RvciBsb2dpYyAqLwoJaWYgKCB0eXBlb2Ygb09wdHMgPT0gJ3VuZGVmaW5lZCcgKQoJewoJCW9PcHRzID0ge307Cgl9CgoKCVRhYmxlVG9vbHMuX2FJbnN0YW5jZXMucHVzaCggdGhpcyApOwoJdGhpcy5fZm5Db25zdHJ1Y3QoIG9PcHRzICk7CgoJcmV0dXJuIHRoaXM7Cn07CgoKClRhYmxlVG9vbHMucHJvdG90eXBlID0gewoJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKgoJICogUHVibGljIG1ldGhvZHMKCSAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovCgoJLyoqCgkgKiBSZXRyZWlldmUgdGhlIHNldHRpbmdzIG9iamVjdCBmcm9tIGFuIGluc3RhbmNlCgkgKiAgQHJldHVybnMge2FycmF5fSBMaXN0IG9mIFRSIG5vZGVzIHdoaWNoIGFyZSBjdXJyZW50bHkgc2VsZWN0ZWQKCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtmaWx0ZXJlZD1mYWxzZV0gR2V0IG9ubHkgc2VsZWN0ZWQgcm93cyB3aGljaCBhcmUgIAoJICogICAgYXZhaWxhYmxlIGdpdmVuIHRoZSBmaWx0ZXJpbmcgYXBwbGllZCB0byB0aGUgdGFibGUuIEJ5IGRlZmF1bHQKCSAqICAgIHRoaXMgaXMgZmFsc2UgLSAgaS5lLiBhbGwgcm93cywgcmVnYXJkbGVzcyBvZiBmaWx0ZXJpbmcgYXJlIAoJICAgICAgc2VsZWN0ZWQuCgkgKi8KCSJmbkdldFNlbGVjdGVkIjogZnVuY3Rpb24gKCBmaWx0ZXJlZCApCgl7CgkJdmFyCgkJCW91dCA9IFtdLAoJCQlkYXRhID0gdGhpcy5zLmR0LmFvRGF0YSwKCQkJZGlzcGxheWVkID0gdGhpcy5zLmR0LmFpRGlzcGxheSwKCQkJaSwgaUxlbjsKCgkJaWYgKCBmaWx0ZXJlZCApCgkJewoJCQkvLyBPbmx5IGNvbnNpZGVyIGZpbHRlcmVkIHJvd3MKCQkJZm9yICggaT0wLCBpTGVuPWRpc3BsYXllZC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGRhdGFbIGRpc3BsYXllZFtpXSBdLl9EVFRUX3NlbGVjdGVkICkKCQkJCXsKCQkJCQlvdXQucHVzaCggZGF0YVsgZGlzcGxheWVkW2ldIF0ublRyICk7CgkJCQl9CgkJCX0KCQl9CgkJZWxzZQoJCXsKCQkJLy8gVXNlIGFsbCByb3dzCgkJCWZvciAoIGk9MCwgaUxlbj1kYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggZGF0YVtpXS5fRFRUVF9zZWxlY3RlZCApCgkJCQl7CgkJCQkJb3V0LnB1c2goIGRhdGFbaV0ublRyICk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBvdXQ7Cgl9LAoKCgkvKioKCSAqIEdldCB0aGUgZGF0YSBzb3VyY2Ugb2JqZWN0cy9hcnJheXMgZnJvbSBEYXRhVGFibGVzIGZvciB0aGUgc2VsZWN0ZWQgcm93cyAoc2FtZSBhcwoJICogZm5HZXRTZWxlY3RlZCBmb2xsb3dlZCBieSBmbkdldERhdGEgb24gZWFjaCByb3cgZnJvbSB0aGUgdGFibGUpCgkgKiAgQHJldHVybnMge2FycmF5fSBEYXRhIGZyb20gdGhlIFRSIG5vZGVzIHdoaWNoIGFyZSBjdXJyZW50bHkgc2VsZWN0ZWQKCSAqLwoJImZuR2V0U2VsZWN0ZWREYXRhIjogZnVuY3Rpb24gKCkKCXsKCQl2YXIgb3V0ID0gW107CgkJdmFyIGRhdGE9dGhpcy5zLmR0LmFvRGF0YTsKCQl2YXIgaSwgaUxlbjsKCgkJZm9yICggaT0wLCBpTGVuPWRhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQl7CgkJCWlmICggZGF0YVtpXS5fRFRUVF9zZWxlY3RlZCApCgkJCXsKCQkJCW91dC5wdXNoKCB0aGlzLnMuZHQub0luc3RhbmNlLmZuR2V0RGF0YShpKSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gb3V0OwoJfSwKCgoJLyoqCgkgKiBHZXQgdGhlIGluZGV4ZXMgb2YgdGhlIHNlbGVjdGVkIHJvd3MKCSAqICBAcmV0dXJucyB7YXJyYXl9IExpc3Qgb2Ygcm93IGluZGV4ZXMKCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtmaWx0ZXJlZD1mYWxzZV0gR2V0IG9ubHkgc2VsZWN0ZWQgcm93cyB3aGljaCBhcmUgIAoJICogICAgYXZhaWxhYmxlIGdpdmVuIHRoZSBmaWx0ZXJpbmcgYXBwbGllZCB0byB0aGUgdGFibGUuIEJ5IGRlZmF1bHQKCSAqICAgIHRoaXMgaXMgZmFsc2UgLSAgaS5lLiBhbGwgcm93cywgcmVnYXJkbGVzcyBvZiBmaWx0ZXJpbmcgYXJlIAoJICAgICAgc2VsZWN0ZWQuCgkgKi8KCSJmbkdldFNlbGVjdGVkSW5kZXhlcyI6IGZ1bmN0aW9uICggZmlsdGVyZWQgKQoJewoJCXZhcgoJCQlvdXQgPSBbXSwKCQkJZGF0YSA9IHRoaXMucy5kdC5hb0RhdGEsCgkJCWRpc3BsYXllZCA9IHRoaXMucy5kdC5haURpc3BsYXksCgkJCWksIGlMZW47CgoJCWlmICggZmlsdGVyZWQgKQoJCXsKCQkJLy8gT25seSBjb25zaWRlciBmaWx0ZXJlZCByb3dzCgkJCWZvciAoIGk9MCwgaUxlbj1kaXNwbGF5ZWQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBkYXRhWyBkaXNwbGF5ZWRbaV0gXS5fRFRUVF9zZWxlY3RlZCApCgkJCQl7CgkJCQkJb3V0LnB1c2goIGRpc3BsYXllZFtpXSApOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UKCQl7CgkJCS8vIFVzZSBhbGwgcm93cwoJCQlmb3IgKCBpPTAsIGlMZW49ZGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGRhdGFbaV0uX0RUVFRfc2VsZWN0ZWQgKQoJCQkJewoJCQkJCW91dC5wdXNoKCBpICk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBvdXQ7Cgl9LAoKCgkvKioKCSAqIENoZWNrIHRvIHNlZSBpZiBhIGN1cnJlbnQgcm93IGlzIHNlbGVjdGVkIG9yIG5vdAoJICogIEBwYXJhbSB7Tm9kZX0gbiBUUiBub2RlIHRvIGNoZWNrIGlmIGl0IGlzIGN1cnJlbnRseSBzZWxlY3RlZCBvciBub3QKCSAqICBAcmV0dXJucyB7Qm9vbGVhbn0gdHJ1ZSBpZiBzZWxlY3QsIGZhbHNlIG90aGVyd2lzZQoJICovCgkiZm5Jc1NlbGVjdGVkIjogZnVuY3Rpb24gKCBuICkKCXsKCQl2YXIgcG9zID0gdGhpcy5zLmR0Lm9JbnN0YW5jZS5mbkdldFBvc2l0aW9uKCBuICk7CgkJcmV0dXJuICh0aGlzLnMuZHQuYW9EYXRhW3Bvc10uX0RUVFRfc2VsZWN0ZWQ9PT10cnVlKSA\/IHRydWUgOiBmYWxzZTsKCX0sCgoKCS8qKgoJICogU2VsZWN0IGFsbCByb3dzIGluIHRoZSB0YWJsZQoJICogIEBwYXJhbSB7Ym9vbGVhbn0gW2ZpbHRlcmVkPWZhbHNlXSBTZWxlY3Qgb25seSByb3dzIHdoaWNoIGFyZSBhdmFpbGFibGUgCgkgKiAgICBnaXZlbiB0aGUgZmlsdGVyaW5nIGFwcGxpZWQgdG8gdGhlIHRhYmxlLiBCeSBkZWZhdWx0IHRoaXMgaXMgZmFsc2UgLSAKCSAqICAgIGkuZS4gYWxsIHJvd3MsIHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nIGFyZSBzZWxlY3RlZC4KCSAqLwoJImZuU2VsZWN0QWxsIjogZnVuY3Rpb24gKCBmaWx0ZXJlZCApCgl7CgkJdGhpcy5fZm5Sb3dTZWxlY3QoIGZpbHRlcmVkID8KCQkJdGhpcy5zLmR0LmFpRGlzcGxheSA6CgkJCXRoaXMucy5kdC5hb0RhdGEKCQkpOwoJfSwKCgoJLyoqCgkgKiBEZXNlbGVjdCBhbGwgcm93cyBpbiB0aGUgdGFibGUKCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtmaWx0ZXJlZD1mYWxzZV0gRGVzZWxlY3Qgb25seSByb3dzIHdoaWNoIGFyZSBhdmFpbGFibGUgCgkgKiAgICBnaXZlbiB0aGUgZmlsdGVyaW5nIGFwcGxpZWQgdG8gdGhlIHRhYmxlLiBCeSBkZWZhdWx0IHRoaXMgaXMgZmFsc2UgLSAKCSAqICAgIGkuZS4gYWxsIHJvd3MsIHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nIGFyZSBkZXNlbGVjdGVkLgoJICovCgkiZm5TZWxlY3ROb25lIjogZnVuY3Rpb24gKCBmaWx0ZXJlZCApCgl7CgkJdGhpcy5fZm5Sb3dEZXNlbGVjdCggdGhpcy5mbkdldFNlbGVjdGVkSW5kZXhlcyhmaWx0ZXJlZCkgKTsKCX0sCgoKCS8qKgoJICogU2VsZWN0IHJvdyhzKQoJICogIEBwYXJhbSB7bm9kZXxvYmplY3R8YXJyYXl9IG4gVGhlIHJvdyhzKSB0byBzZWxlY3QuIENhbiBiZSBhIHNpbmdsZSBET00KCSAqICAgIFRSIG5vZGUsIGFuIGFycmF5IG9mIFRSIG5vZGVzIG9yIGEgalF1ZXJ5IG9iamVjdC4KCSAqLwoJImZuU2VsZWN0IjogZnVuY3Rpb24gKCBuICkKCXsKCQlpZiAoIHRoaXMucy5zZWxlY3QudHlwZSA9PSAic2luZ2xlIiApCgkJewoJCQl0aGlzLmZuU2VsZWN0Tm9uZSgpOwoJCQl0aGlzLl9mblJvd1NlbGVjdCggbiApOwoJCX0KCQllbHNlCgkJewoJCQl0aGlzLl9mblJvd1NlbGVjdCggbiApOwoJCX0KCX0sCgoKCS8qKgoJICogRGVzZWxlY3Qgcm93KHMpCgkgKiAgQHBhcmFtIHtub2RlfG9iamVjdHxhcnJheX0gbiBUaGUgcm93KHMpIHRvIGRlc2VsZWN0LiBDYW4gYmUgYSBzaW5nbGUgRE9NCgkgKiAgICBUUiBub2RlLCBhbiBhcnJheSBvZiBUUiBub2RlcyBvciBhIGpRdWVyeSBvYmplY3QuCgkgKi8KCSJmbkRlc2VsZWN0IjogZnVuY3Rpb24gKCBuICkKCXsKCQl0aGlzLl9mblJvd0Rlc2VsZWN0KCBuICk7Cgl9LAoKCgkvKioKCSAqIEdldCB0aGUgdGl0bGUgb2YgdGhlIGRvY3VtZW50IC0gdXNlZnVsIGZvciBmaWxlIG5hbWVzLiBUaGUgdGl0bGUgaXMgcmV0cmlldmVkIGZyb20gZWl0aGVyCgkgKiB0aGUgY29uZmlndXJhdGlvbiBvYmplY3QncyAndGl0bGUnIHBhcmFtZXRlciwgb3IgdGhlIEhUTUwgZG9jdW1lbnQgdGl0bGUKCSAqICBAcGFyYW0gICB7T2JqZWN0fSBvQ29uZmlnIEJ1dHRvbiBjb25maWd1cmF0aW9uIG9iamVjdAoJICogIEByZXR1cm5zIHtTdHJpbmd9IEJ1dHRvbiB0aXRsZQoJICovCgkiZm5HZXRUaXRsZSI6IGZ1bmN0aW9uKCBvQ29uZmlnICkKCXsKCQl2YXIgc1RpdGxlID0gIiI7CgkJaWYgKCB0eXBlb2Ygb0NvbmZpZy5zVGl0bGUgIT0gJ3VuZGVmaW5lZCcgJiYgb0NvbmZpZy5zVGl0bGUgIT09ICIiICkgewoJCQlzVGl0bGUgPSBvQ29uZmlnLnNUaXRsZTsKCQl9IGVsc2UgewoJCQl2YXIgYW5UaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aXRsZScpOwoJCQlpZiAoIGFuVGl0bGUubGVuZ3RoID4gMCApCgkJCXsKCQkJCXNUaXRsZSA9IGFuVGl0bGVbMF0uaW5uZXJIVE1MOwoJCQl9CgkJfQoKCQkvKiBTdHJpcCBjaGFyYWN0ZXJzIHdoaWNoIHRoZSBPUyB3aWxsIG9iamVjdCB0byAtIGNoZWNraW5nIGZvciBVVEY4IHN1cHBvcnQgaW4gdGhlIHNjcmlwdGluZwoJCSAqIGVuZ2luZQoJCSAqLwoJCWlmICggIlx1MDBBMSIudG9TdHJpbmcoKS5sZW5ndGggPCA0ICkgewoJCQlyZXR1cm4gc1RpdGxlLnJlcGxhY2UoL1teYS16QS1aMC05X1x1MDBBMS1cdUZGRkZcLixcLV8gIVwoXCldL2csICIiKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gc1RpdGxlLnJlcGxhY2UoL1teYS16QS1aMC05X1wuLFwtXyAhXChcKV0vZywgIiIpOwoJCX0KCX0sCgoKCS8qKgoJICogQ2FsY3VsYXRlIGEgdW5pdHkgYXJyYXkgd2l0aCB0aGUgY29sdW1uIHdpZHRoIGJ5IHByb3BvcnRpb24gZm9yIGEgc2V0IG9mIGNvbHVtbnMgdG8gYmUKCSAqIGluY2x1ZGVkIGZvciBhIGJ1dHRvbi4gVGhpcyBpcyBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBQREYgY3JlYXRpb24sIHdoZXJlIHdlIGNhbiB1c2UgdGhlCgkgKiBjb2x1bW4gd2lkdGhzIGNhbGN1bGF0ZWQgYnkgdGhlIGJyb3dzZXIgdG8gc2l6ZSB0aGUgY29sdW1ucyBpbiB0aGUgUERGLgoJICogIEBwYXJhbSAgIHtPYmplY3R9IG9Db25maWcgQnV0dG9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0CgkgKiAgQHJldHVybnMge0FycmF5fSBVbml0eSBhcnJheSBvZiBjb2x1bW4gcmF0aW9zCgkgKi8KCSJmbkNhbGNDb2xSYXRpb3MiOiBmdW5jdGlvbiAoIG9Db25maWcgKQoJewoJCXZhcgoJCQlhb0NvbHMgPSB0aGlzLnMuZHQuYW9Db2x1bW5zLAoJCQlhQ29sdW1uc0luYyA9IHRoaXMuX2ZuQ29sdW1uVGFyZ2V0cyggb0NvbmZpZy5tQ29sdW1ucyApLAoJCQlhQ29sV2lkdGhzID0gW10sCgkJCWlXaWR0aCA9IDAsIGlUb3RhbCA9IDAsIGksIGlMZW47CgoJCWZvciAoIGk9MCwgaUxlbj1hQ29sdW1uc0luYy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCXsKCQkJaWYgKCBhQ29sdW1uc0luY1tpXSApCgkJCXsKCQkJCWlXaWR0aCA9IGFvQ29sc1tpXS5uVGgub2Zmc2V0V2lkdGg7CgkJCQlpVG90YWwgKz0gaVdpZHRoOwoJCQkJYUNvbFdpZHRocy5wdXNoKCBpV2lkdGggKTsKCQkJfQoJCX0KCgkJZm9yICggaT0wLCBpTGVuPWFDb2xXaWR0aHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQl7CgkJCWFDb2xXaWR0aHNbaV0gPSBhQ29sV2lkdGhzW2ldIC8gaVRvdGFsOwoJCX0KCgkJcmV0dXJuIGFDb2xXaWR0aHMuam9pbignXHQnKTsKCX0sCgoKCS8qKgoJICogR2V0IHRoZSBpbmZvcm1hdGlvbiBjb250YWluZWQgaW4gYSB0YWJsZSBhcyBhIHN0cmluZwoJICogIEBwYXJhbSAgIHtPYmplY3R9IG9Db25maWcgQnV0dG9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0CgkgKiAgQHJldHVybnMge1N0cmluZ30gVGFibGUgZGF0YSBhcyBhIHN0cmluZwoJICovCgkiZm5HZXRUYWJsZURhdGEiOiBmdW5jdGlvbiAoIG9Db25maWcgKQoJewoJCS8qIEluIGZ1dHVyZSB0aGlzIGNvdWxkIGJlIHVzZWQgdG8gZ2V0IGRhdGEgZnJvbSBhIHBsYWluIEhUTUwgc291cmNlIGFzIHdlbGwgYXMgRGF0YVRhYmxlcyAqLwoJCWlmICggdGhpcy5zLmR0ICkKCQl7CgkJCXJldHVybiB0aGlzLl9mbkdldERhdGFUYWJsZXNEYXRhKCBvQ29uZmlnICk7CgkJfQoJfSwKCgoJLyoqCgkgKiBQYXNzIHRleHQgdG8gYSBmbGFzaCBidXR0b24gaW5zdGFuY2UsIHdoaWNoIHdpbGwgYmUgdXNlZCBvbiB0aGUgYnV0dG9uJ3MgY2xpY2sgaGFuZGxlcgoJICogIEBwYXJhbSAgIHtPYmplY3R9IGNsaXAgRmxhc2ggYnV0dG9uIG9iamVjdAoJICogIEBwYXJhbSAgIHtTdHJpbmd9IHRleHQgVGV4dCB0byBzZXQKCSAqLwoJImZuU2V0VGV4dCI6IGZ1bmN0aW9uICggY2xpcCwgdGV4dCApCgl7CgkJdGhpcy5fZm5GbGFzaFNldFRleHQoIGNsaXAsIHRleHQgKTsKCX0sCgoKCS8qKgoJICogUmVzaXplIHRoZSBmbGFzaCBlbGVtZW50cyBvZiB0aGUgYnV0dG9ucyBhdHRhY2hlZCB0byB0aGlzIFRhYmxlVG9vbHMgaW5zdGFuY2UgLSB0aGlzIGlzCgkgKiB1c2VmdWwgZm9yIHdoZW4gaW5pdGlhbGlzaW5nIFRhYmxlVG9vbHMgd2hlbiBpdCBpcyBoaWRkZW4gKGRpc3BsYXk6bm9uZSkgc2luY2Ugc2l6ZXMgY2FuJ3QKCSAqIGJlIGNhbGN1bGF0ZWQgYXQgdGhhdCB0aW1lLgoJICovCgkiZm5SZXNpemVCdXR0b25zIjogZnVuY3Rpb24gKCkKCXsKCQlmb3IgKCB2YXIgY2xpIGluIFplcm9DbGlwYm9hcmRfVGFibGVUb29scy5jbGllbnRzICkKCQl7CgkJCWlmICggY2xpICkKCQkJewoJCQkJdmFyIGNsaWVudCA9IFplcm9DbGlwYm9hcmRfVGFibGVUb29scy5jbGllbnRzW2NsaV07CgkJCQlpZiAoIHR5cGVvZiBjbGllbnQuZG9tRWxlbWVudCAhPSAndW5kZWZpbmVkJyAmJgoJCQkJCSBjbGllbnQuZG9tRWxlbWVudC5wYXJlbnROb2RlICkKCQkJCXsKCQkJCQljbGllbnQucG9zaXRpb25FbGVtZW50KCk7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCgkvKioKCSAqIENoZWNrIHRvIHNlZSBpZiBhbnkgb2YgdGhlIFplcm9DbGlwYm9hcmQgY2xpZW50J3MgYXR0YWNoZWQgbmVlZCB0byBiZSByZXNpemVkCgkgKi8KCSJmblJlc2l6ZVJlcXVpcmVkIjogZnVuY3Rpb24gKCkKCXsKCQlmb3IgKCB2YXIgY2xpIGluIFplcm9DbGlwYm9hcmRfVGFibGVUb29scy5jbGllbnRzICkKCQl7CgkJCWlmICggY2xpICkKCQkJewoJCQkJdmFyIGNsaWVudCA9IFplcm9DbGlwYm9hcmRfVGFibGVUb29scy5jbGllbnRzW2NsaV07CgkJCQlpZiAoIHR5cGVvZiBjbGllbnQuZG9tRWxlbWVudCAhPSAndW5kZWZpbmVkJyAmJgoJCQkJCSBjbGllbnQuZG9tRWxlbWVudC5wYXJlbnROb2RlID09IHRoaXMuZG9tLmNvbnRhaW5lciAmJgoJCQkJCSBjbGllbnQuc2l6ZWQgPT09IGZhbHNlICkKCQkJCXsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCgkvKioKCSAqIFByb2dyYW1tYXRpY2FsbHkgZW5hYmxlIG9yIGRpc2FibGUgdGhlIHByaW50IHZpZXcKCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiVmlldz10cnVlXSBTaG93IHRoZSBwcmludCB2aWV3IGlmIHRydWUgb3Igbm90IGdpdmVuLiBJZiBmYWxzZSwgdGhlbgoJICogICAgdGVybWluYXRlIHRoZSBwcmludCB2aWV3IGFuZCByZXR1cm4gdG8gbm9ybWFsLgoJICogIEBwYXJhbSB7b2JqZWN0fSBbb0NvbmZpZz17fV0gQ29uZmlndXJhdGlvbiBmb3IgdGhlIHByaW50IHZpZXcKCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtvQ29uZmlnLmJTaG93QWxsPWZhbHNlXSBTaG93IGFsbCByb3dzIGluIHRoZSB0YWJsZSBpZiB0cnVlCgkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvQ29uZmlnLnNJbmZvXSBJbmZvcm1hdGlvbiBtZXNzYWdlLCBkaXNwbGF5ZWQgYXMgYW4gb3ZlcmxheSB0byB0aGUKCSAqICAgIHVzZXIgdG8gbGV0IHRoZW0ga25vdyB3aGF0IHRoZSBwcmludCB2aWV3IGlzLgoJICogIEBwYXJhbSB7c3RyaW5nfSBbb0NvbmZpZy5zTWVzc2FnZV0gSFRNTCBzdHJpbmcgdG8gc2hvdyBhdCB0aGUgdG9wIG9mIHRoZSBkb2N1bWVudCAtIHdpbGwKCSAqICAgIGJlIGluY2x1ZGVkIGluIHRoZSBwcmludGVkIGRvY3VtZW50LgoJICovCgkiZm5QcmludCI6IGZ1bmN0aW9uICggYlZpZXcsIG9Db25maWcgKQoJewoJCWlmICggb0NvbmZpZyA9PT0gdW5kZWZpbmVkICkKCQl7CgkJCW9Db25maWcgPSB7fTsKCQl9CgoJCWlmICggYlZpZXcgPT09IHVuZGVmaW5lZCB8fCBiVmlldyApCgkJewoJCQl0aGlzLl9mblByaW50U3RhcnQoIG9Db25maWcgKTsKCQl9CgkJZWxzZQoJCXsKCQkJdGhpcy5fZm5QcmludEVuZCgpOwoJCX0KCX0sCgoKCS8qKgoJICogU2hvdyBhIG1lc3NhZ2UgdG8gdGhlIGVuZCB1c2VyIHdoaWNoIGlzIG5pY2VseSBzdHlsZWQKCSAqICBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSBUaGUgSFRNTCBzdHJpbmcgdG8gc2hvdyB0byB0aGUgdXNlcgoJICogIEBwYXJhbSB7aW50fSB0aW1lIFRoZSBkdXJhdGlvbiB0aGUgbWVzc2FnZSBpcyB0byBiZSBzaG93biBvbiBzY3JlZW4gZm9yIChtUykKCSAqLwoJImZuSW5mbyI6IGZ1bmN0aW9uICggbWVzc2FnZSwgdGltZSApIHsKCQl2YXIgaW5mbyA9ICQoJzxkaXYvPicpCgkJCS5hZGRDbGFzcyggdGhpcy5jbGFzc2VzLnByaW50LmluZm8gKQoJCQkuaHRtbCggbWVzc2FnZSApCgkJCS5hcHBlbmRUbyggJ2JvZHknICk7CgoJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgewoJCQlpbmZvLmZhZGVPdXQoICJub3JtYWwiLCBmdW5jdGlvbigpIHsKCQkJCWluZm8ucmVtb3ZlKCk7CgkJCX0gKTsKCQl9LCB0aW1lICk7Cgl9LAoKCgoJLyoqCgkgKiBHZXQgdGhlIGNvbnRhaW5lciBlbGVtZW50IG9mIHRoZSBpbnN0YW5jZSBmb3IgYXR0YWNoaW5nIHRvIHRoZSBET00KCSAqICAgQHJldHVybnMge25vZGV9IERPTSBub2RlCgkgKi8KCSJmbkNvbnRhaW5lciI6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gdGhpcy5kb20uY29udGFpbmVyOwoJfSwKCgoKCS8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCSAqIFByaXZhdGUgbWV0aG9kcyAodGhleSBhcmUgb2YgY291cnNlIHB1YmxpYyBpbiBKUywgYnV0IHJlY29tbWVuZGVkIGFzIHByaXZhdGUpCgkgKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqLwoKCS8qKgoJICogQ29uc3RydWN0b3IgbG9naWMKCSAqICBAbWV0aG9kICBfZm5Db25zdHJ1Y3QKCSAqICBAcGFyYW0gICB7T2JqZWN0fSBvT3B0cyBTYW1lIGFzIFRhYmxlVG9vbHMgY29uc3RydWN0b3IKCSAqICBAcmV0dXJucyB2b2lkCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5Db25zdHJ1Y3QiOiBmdW5jdGlvbiAoIG9PcHRzICkKCXsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCXRoaXMuX2ZuQ3VzdG9taXNlU2V0dGluZ3MoIG9PcHRzICk7CgoJCS8qIENvbnRhaW5lciBlbGVtZW50ICovCgkJdGhpcy5kb20uY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggdGhpcy5zLnRhZ3MuY29udGFpbmVyICk7CgkJdGhpcy5kb20uY29udGFpbmVyLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3Nlcy5jb250YWluZXI7CgoJCS8qIFJvdyBzZWxlY3Rpb24gY29uZmlnICovCgkJaWYgKCB0aGlzLnMuc2VsZWN0LnR5cGUgIT0gJ25vbmUnICkKCQl7CgkJCXRoaXMuX2ZuUm93U2VsZWN0Q29uZmlnKCk7CgkJfQoKCQkvKiBCdXR0b25zICovCgkJdGhpcy5fZm5CdXR0b25EZWZpbmF0aW9ucyggdGhpcy5zLmJ1dHRvblNldCwgdGhpcy5kb20uY29udGFpbmVyICk7CgoJCS8qIERlc3RydWN0b3IgKi8KCQl0aGlzLnMuZHQuYW9EZXN0cm95Q2FsbGJhY2sucHVzaCggewoJCQkic05hbWUiOiAiVGFibGVUb29scyIsCgkJCSJmbiI6IGZ1bmN0aW9uICgpIHsKCQkJCSQodGhhdC5zLmR0Lm5UQm9keSkub2ZmKCAnY2xpY2suRFRUVF9TZWxlY3QnLCAndHInICk7CgkJCQkkKHRoYXQuZG9tLmNvbnRhaW5lcikuZW1wdHkoKTsKCgkJCQkvLyBSZW1vdmUgdGhlIGluc3RhbmNlCgkJCQl2YXIgaWR4ID0gJC5pbkFycmF5KCB0aGF0LCBUYWJsZVRvb2xzLl9hSW5zdGFuY2VzICk7CgkJCQlpZiAoIGlkeCAhPT0gLTEgKSB7CgkJCQkJVGFibGVUb29scy5fYUluc3RhbmNlcy5zcGxpY2UoIGlkeCwgMSApOwoJCQkJfQoJCQl9CgkJfSApOwoJfSwKCgoJLyoqCgkgKiBUYWtlIHRoZSB1c2VyIGRlZmluZWQgc2V0dGluZ3MgYW5kIHRoZSBkZWZhdWx0IHNldHRpbmdzIGFuZCBjb21iaW5lIHRoZW0uCgkgKiAgQG1ldGhvZCAgX2ZuQ3VzdG9taXNlU2V0dGluZ3MKCSAqICBAcGFyYW0gICB7T2JqZWN0fSBvT3B0cyBTYW1lIGFzIFRhYmxlVG9vbHMgY29uc3RydWN0b3IKCSAqICBAcmV0dXJucyB2b2lkCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5DdXN0b21pc2VTZXR0aW5ncyI6IGZ1bmN0aW9uICggb09wdHMgKQoJewoJCS8qIElzIHRoaXMgdGhlIG1hc3RlciBjb250cm9sIGluc3RhbmNlIG9yIG5vdD8gKi8KCQlpZiAoIHR5cGVvZiB0aGlzLnMuZHQuX1RhYmxlVG9vbHNJbml0ID09ICd1bmRlZmluZWQnICkKCQl7CgkJCXRoaXMucy5tYXN0ZXIgPSB0cnVlOwoJCQl0aGlzLnMuZHQuX1RhYmxlVG9vbHNJbml0ID0gdHJ1ZTsKCQl9CgoJCS8qIFdlIGNhbiB1c2UgdGhlIHRhYmxlIG5vZGUgZnJvbSBjb21wYXJpc29ucyB0byBncm91cCBjb250cm9scyAqLwoJCXRoaXMuZG9tLnRhYmxlID0gdGhpcy5zLmR0Lm5UYWJsZTsKCgkJLyogQ2xvbmUgdGhlIGRlZmF1bHRzIGFuZCB0aGVuIHRoZSB1c2VyIG9wdGlvbnMgKi8KCQl0aGlzLnMuY3VzdG9tID0gJC5leHRlbmQoIHt9LCBUYWJsZVRvb2xzLkRFRkFVTFRTLCBvT3B0cyApOwoKCQkvKiBGbGFzaCBmaWxlIGxvY2F0aW9uICovCgkJdGhpcy5zLnN3ZlBhdGggPSB0aGlzLnMuY3VzdG9tLnNTd2ZQYXRoOwoJCWlmICggdHlwZW9mIFplcm9DbGlwYm9hcmRfVGFibGVUb29scyAhPSAndW5kZWZpbmVkJyApCgkJewoJCQlaZXJvQ2xpcGJvYXJkX1RhYmxlVG9vbHMubW92aWVQYXRoID0gdGhpcy5zLnN3ZlBhdGg7CgkJfQoKCQkvKiBUYWJsZSByb3cgc2VsZWN0aW5nICovCgkJdGhpcy5zLnNlbGVjdC50eXBlID0gdGhpcy5zLmN1c3RvbS5zUm93U2VsZWN0OwoJCXRoaXMucy5zZWxlY3QucHJlUm93U2VsZWN0ID0gdGhpcy5zLmN1c3RvbS5mblByZVJvd1NlbGVjdDsKCQl0aGlzLnMuc2VsZWN0LnBvc3RTZWxlY3RlZCA9IHRoaXMucy5jdXN0b20uZm5Sb3dTZWxlY3RlZDsKCQl0aGlzLnMuc2VsZWN0LnBvc3REZXNlbGVjdGVkID0gdGhpcy5zLmN1c3RvbS5mblJvd0Rlc2VsZWN0ZWQ7CgoJCS8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IC0gYWxsb3cgdGhlIHVzZXIgdG8gc3BlY2lmeSBhIGN1c3RvbSBjbGFzcyBpbiB0aGUgaW5pdGlhbGlzZXIKCQlpZiAoIHRoaXMucy5jdXN0b20uc1NlbGVjdGVkQ2xhc3MgKQoJCXsKCQkJdGhpcy5jbGFzc2VzLnNlbGVjdC5yb3cgPSB0aGlzLnMuY3VzdG9tLnNTZWxlY3RlZENsYXNzOwoJCX0KCgkJdGhpcy5zLnRhZ3MgPSB0aGlzLnMuY3VzdG9tLm9UYWdzOwoKCQkvKiBCdXR0b24gc2V0ICovCgkJdGhpcy5zLmJ1dHRvblNldCA9IHRoaXMucy5jdXN0b20uYUJ1dHRvbnM7Cgl9LAoKCgkvKioKCSAqIFRha2UgdGhlIHVzZXIgaW5wdXQgYXJyYXlzIGFuZCBleHBhbmQgdGhlbSB0byBiZSBmdWxseSBkZWZpbmVkLCBhbmQgdGhlbiBhZGQgdGhlbSB0byBhIGdpdmVuCgkgKiBET00gZWxlbWVudAoJICogIEBtZXRob2QgIF9mbkJ1dHRvbkRlZmluYXRpb25zCgkgKiAgQHBhcmFtIHthcnJheX0gYnV0dG9uU2V0IFNldCBvZiB1c2VyIGRlZmluZWQgYnV0dG9ucwoJICogIEBwYXJhbSB7bm9kZX0gd3JhcHBlciBOb2RlIHRvIGFkZCB0aGUgY3JlYXRlZCBidXR0b25zIHRvCgkgKiAgQHJldHVybnMgdm9pZAoJICogIEBwcml2YXRlIAoJICovCgkiX2ZuQnV0dG9uRGVmaW5hdGlvbnMiOiBmdW5jdGlvbiAoIGJ1dHRvblNldCwgd3JhcHBlciApCgl7CgkJdmFyIGJ1dHRvbkRlZjsKCgkJZm9yICggdmFyIGk9MCwgaUxlbj1idXR0b25TZXQubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQl7CgkJCWlmICggdHlwZW9mIGJ1dHRvblNldFtpXSA9PSAic3RyaW5nIiApCgkJCXsKCQkJCWlmICggdHlwZW9mIFRhYmxlVG9vbHMuQlVUVE9OU1sgYnV0dG9uU2V0W2ldIF0gPT0gJ3VuZGVmaW5lZCcgKQoJCQkJewoJCQkJCWFsZXJ0KCAiVGFibGVUb29sczogV2FybmluZyAtIHVua25vd24gYnV0dG9uIHR5cGU6ICIrYnV0dG9uU2V0W2ldICk7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCQlidXR0b25EZWYgPSAkLmV4dGVuZCgge30sIFRhYmxlVG9vbHMuQlVUVE9OU1sgYnV0dG9uU2V0W2ldIF0sIHRydWUgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWlmICggdHlwZW9mIFRhYmxlVG9vbHMuQlVUVE9OU1sgYnV0dG9uU2V0W2ldLnNFeHRlbmRzIF0gPT0gJ3VuZGVmaW5lZCcgKQoJCQkJewoJCQkJCWFsZXJ0KCAiVGFibGVUb29sczogV2FybmluZyAtIHVua25vd24gYnV0dG9uIHR5cGU6ICIrYnV0dG9uU2V0W2ldLnNFeHRlbmRzICk7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCQl2YXIgbyA9ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5CVVRUT05TWyBidXR0b25TZXRbaV0uc0V4dGVuZHMgXSwgdHJ1ZSApOwoJCQkJYnV0dG9uRGVmID0gJC5leHRlbmQoIG8sIGJ1dHRvblNldFtpXSwgdHJ1ZSApOwoJCQl9CgoJCQl2YXIgYnV0dG9uID0gdGhpcy5fZm5DcmVhdGVCdXR0b24oCgkJCQlidXR0b25EZWYsCgkJCQkkKHdyYXBwZXIpLmhhc0NsYXNzKHRoaXMuY2xhc3Nlcy5jb2xsZWN0aW9uLmNvbnRhaW5lcikKCQkJKTsKCgkJCWlmICggYnV0dG9uICkgewoJCQkJd3JhcHBlci5hcHBlbmRDaGlsZCggYnV0dG9uICk7CgkJCX0KCQl9Cgl9LAoKCgkvKioKCSAqIENyZWF0ZSBhbmQgY29uZmlndXJlIGEgVGFibGVUb29scyBidXR0b24KCSAqICBAbWV0aG9kICBfZm5DcmVhdGVCdXR0b24KCSAqICBAcGFyYW0gICB7T2JqZWN0fSBvQ29uZmlnIEJ1dHRvbiBjb25maWd1cmF0aW9uIG9iamVjdAoJICogIEByZXR1cm5zIHtOb2RlfSBCdXR0b24gZWxlbWVudAoJICogIEBwcml2YXRlIAoJICovCgkiX2ZuQ3JlYXRlQnV0dG9uIjogZnVuY3Rpb24gKCBvQ29uZmlnLCBiQ29sbGVjdGlvbkJ1dHRvbiApCgl7CgkgIHZhciBuQnV0dG9uID0gdGhpcy5fZm5CdXR0b25CYXNlKCBvQ29uZmlnLCBiQ29sbGVjdGlvbkJ1dHRvbiApOwoKCQlpZiAoIG9Db25maWcuc0FjdGlvbi5tYXRjaCgvZmxhc2gvKSApCgkJewoJCQlpZiAoICEgdGhpcy5fZm5IYXNGbGFzaCgpICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgoJCQl0aGlzLl9mbkZsYXNoQ29uZmlnKCBuQnV0dG9uLCBvQ29uZmlnICk7CgkJfQoJCWVsc2UgaWYgKCBvQ29uZmlnLnNBY3Rpb24gPT0gInRleHQiICkKCQl7CgkJCXRoaXMuX2ZuVGV4dENvbmZpZyggbkJ1dHRvbiwgb0NvbmZpZyApOwoJCX0KCQllbHNlIGlmICggb0NvbmZpZy5zQWN0aW9uID09ICJkaXYiICkKCQl7CgkJCXRoaXMuX2ZuVGV4dENvbmZpZyggbkJ1dHRvbiwgb0NvbmZpZyApOwoJCX0KCQllbHNlIGlmICggb0NvbmZpZy5zQWN0aW9uID09ICJjb2xsZWN0aW9uIiApCgkJewoJCQl0aGlzLl9mblRleHRDb25maWcoIG5CdXR0b24sIG9Db25maWcgKTsKCQkJdGhpcy5fZm5Db2xsZWN0aW9uQ29uZmlnKCBuQnV0dG9uLCBvQ29uZmlnICk7CgkJfQoKCQlyZXR1cm4gbkJ1dHRvbjsKCX0sCgoKCS8qKgoJICogQ3JlYXRlIHRoZSBET00gbmVlZGVkIGZvciB0aGUgYnV0dG9uIGFuZCBhcHBseSBzb21lIGJhc2UgcHJvcGVydGllcy4gQWxsIGJ1dHRvbnMgc3RhcnQgaGVyZQoJICogIEBtZXRob2QgIF9mbkJ1dHRvbkJhc2UKCSAqICBAcGFyYW0gICB7b30gb0NvbmZpZyBCdXR0b24gY29uZmlndXJhdGlvbiBvYmplY3QKCSAqICBAcmV0dXJucyB7Tm9kZX0gRElWIGVsZW1lbnQgZm9yIHRoZSBidXR0b24KCSAqICBAcHJpdmF0ZQoJICovCgkiX2ZuQnV0dG9uQmFzZSI6IGZ1bmN0aW9uICggbywgYkNvbGxlY3Rpb25CdXR0b24gKQoJewoJCXZhciBzVGFnLCBzTGluZXIsIHNDbGFzczsKCgkJaWYgKCBiQ29sbGVjdGlvbkJ1dHRvbiApCgkJewoJCQlzVGFnID0gby5zVGFnICYmIG8uc1RhZyAhPT0gImRlZmF1bHQiID8gby5zVGFnIDogdGhpcy5zLnRhZ3MuY29sbGVjdGlvbi5idXR0b247CgkJCXNMaW5lciA9IG8uc0xpbmVyVGFnICYmIG8uc0xpbmVyVGFnICE9PSAiZGVmYXVsdCIgPyBvLnNMaW5lciA6IHRoaXMucy50YWdzLmNvbGxlY3Rpb24ubGluZXI7CgkJCXNDbGFzcyA9IHRoaXMuY2xhc3Nlcy5jb2xsZWN0aW9uLmJ1dHRvbnMubm9ybWFsOwoJCX0KCQllbHNlCgkJewoJCQlzVGFnID0gby5zVGFnICYmIG8uc1RhZyAhPT0gImRlZmF1bHQiID8gby5zVGFnIDogdGhpcy5zLnRhZ3MuYnV0dG9uOwoJCQlzTGluZXIgPSBvLnNMaW5lclRhZyAmJiBvLnNMaW5lclRhZyAhPT0gImRlZmF1bHQiID8gby5zTGluZXIgOiB0aGlzLnMudGFncy5saW5lcjsKCQkJc0NsYXNzID0gdGhpcy5jbGFzc2VzLmJ1dHRvbnMubm9ybWFsOwoJCX0KCgkJdmFyCgkJICBuQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggc1RhZyApLAoJCSAgblNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBzTGluZXIgKSwKCQkgIG1hc3RlclMgPSB0aGlzLl9mbkdldE1hc3RlclNldHRpbmdzKCk7CgoJCW5CdXR0b24uY2xhc3NOYW1lID0gc0NsYXNzKyIgIitvLnNCdXR0b25DbGFzczsKCQluQnV0dG9uLnNldEF0dHJpYnV0ZSgnaWQnLCAiVG9vbFRhYmxlc18iK3RoaXMucy5kdC5zSW5zdGFuY2UrIl8iK21hc3RlclMuYnV0dG9uQ291bnRlciApOwoJCW5CdXR0b24uYXBwZW5kQ2hpbGQoIG5TcGFuICk7CgkJblNwYW4uaW5uZXJIVE1MID0gby5zQnV0dG9uVGV4dDsKCgkJbWFzdGVyUy5idXR0b25Db3VudGVyKys7CgoJCXJldHVybiBuQnV0dG9uOwoJfSwKCgoJLyoqCgkgKiBHZXQgdGhlIHNldHRpbmdzIG9iamVjdCBmb3IgdGhlIG1hc3RlciBpbnN0YW5jZS4gV2hlbiBtb3JlIHRoYW4gb25lIFRhYmxlVG9vbHMgaW5zdGFuY2UgaXMKCSAqIGFzc2lnbmVkIHRvIGEgRGF0YVRhYmxlLCBvbmx5IG9uZSBvZiB0aGVtIGNhbiBiZSB0aGUgJ21hc3RlcicgKGZvciB0aGUgc2VsZWN0IHJvd3MpLiBBcyBzdWNoLAoJICogd2Ugd2lsbCB0eXBpY2FsbHkgd2FudCB0byBpbnRlcmFjdCB3aXRoIHRoYXQgbWFzdGVyIGZvciBnbG9iYWwgcHJvcGVydGllcy4KCSAqICBAbWV0aG9kICBfZm5HZXRNYXN0ZXJTZXR0aW5ncwoJICogIEByZXR1cm5zIHtPYmplY3R9IFRhYmxlVG9vbHMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5HZXRNYXN0ZXJTZXR0aW5ncyI6IGZ1bmN0aW9uICgpCgl7CgkJaWYgKCB0aGlzLnMubWFzdGVyICkKCQl7CgkJCXJldHVybiB0aGlzLnM7CgkJfQoJCWVsc2UKCQl7CgkJCS8qIExvb2sgZm9yIHRoZSBtYXN0ZXIgd2hpY2ggaGFzIHRoZSBzYW1lIERUIGFzIHRoaXMgb25lICovCgkJCXZhciBpbnN0YW5jZXMgPSBUYWJsZVRvb2xzLl9hSW5zdGFuY2VzOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWluc3RhbmNlcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIHRoaXMuZG9tLnRhYmxlID09IGluc3RhbmNlc1tpXS5zLmR0Lm5UYWJsZSApCgkJCQl7CgkJCQkJcmV0dXJuIGluc3RhbmNlc1tpXS5zOwoJCQkJfQoJCQl9CgkJfQoJfSwKCgoKCS8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCSAqIEJ1dHRvbiBjb2xsZWN0aW9uIGZ1bmN0aW9ucwoJICovCgoJLyoqCgkgKiBDcmVhdGUgYSBjb2xsZWN0aW9uIGJ1dHRvbiwgd2hlbiBhY3RpdmF0ZWQgd2lsbCBwcmVzZW50IGEgZHJvcCBkb3duIGxpc3Qgb2Ygb3RoZXIgYnV0dG9ucwoJICogIEBwYXJhbSAgIHtOb2RlfSBuQnV0dG9uIEJ1dHRvbiB0byB1c2UgZm9yIHRoZSBjb2xsZWN0aW9uIGFjdGl2YXRpb24KCSAqICBAcGFyYW0gICB7T2JqZWN0fSBvQ29uZmlnIEJ1dHRvbiBjb25maWd1cmF0aW9uIG9iamVjdAoJICogIEByZXR1cm5zIHZvaWQKCSAqICBAcHJpdmF0ZQoJICovCgkiX2ZuQ29sbGVjdGlvbkNvbmZpZyI6IGZ1bmN0aW9uICggbkJ1dHRvbiwgb0NvbmZpZyApCgl7CgkJdmFyIG5IaWRkZW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCB0aGlzLnMudGFncy5jb2xsZWN0aW9uLmNvbnRhaW5lciApOwoJCW5IaWRkZW4uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQluSGlkZGVuLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3Nlcy5jb2xsZWN0aW9uLmNvbnRhaW5lcjsKCQlvQ29uZmlnLl9jb2xsZWN0aW9uID0gbkhpZGRlbjsKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBuSGlkZGVuICk7CgoJCXRoaXMuX2ZuQnV0dG9uRGVmaW5hdGlvbnMoIG9Db25maWcuYUJ1dHRvbnMsIG5IaWRkZW4gKTsKCX0sCgoKCS8qKgoJICogU2hvdyBhIGJ1dHRvbiBjb2xsZWN0aW9uCgkgKiAgQHBhcmFtICAge05vZGV9IG5CdXR0b24gQnV0dG9uIHRvIHVzZSBmb3IgdGhlIGNvbGxlY3Rpb24KCSAqICBAcGFyYW0gICB7T2JqZWN0fSBvQ29uZmlnIEJ1dHRvbiBjb25maWd1cmF0aW9uIG9iamVjdAoJICogIEByZXR1cm5zIHZvaWQKCSAqICBAcHJpdmF0ZQoJICovCgkiX2ZuQ29sbGVjdGlvblNob3ciOiBmdW5jdGlvbiAoIG5CdXR0b24sIG9Db25maWcgKQoJewoJCXZhcgoJCQl0aGF0ID0gdGhpcywKCQkJb1BvcyA9ICQobkJ1dHRvbikub2Zmc2V0KCksCgkJCW5IaWRkZW4gPSBvQ29uZmlnLl9jb2xsZWN0aW9uLAoJCQlpRGl2WCA9IG9Qb3MubGVmdCwKCQkJaURpdlkgPSBvUG9zLnRvcCArICQobkJ1dHRvbikub3V0ZXJIZWlnaHQoKSwKCQkJaVdpbkhlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKSwgaURvY0hlaWdodCA9ICQoZG9jdW1lbnQpLmhlaWdodCgpLAoJCQlpV2luV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKSwgaURvY1dpZHRoID0gJChkb2N1bWVudCkud2lkdGgoKTsKCgkJbkhpZGRlbi5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CgkJbkhpZGRlbi5zdHlsZS5sZWZ0ID0gaURpdlgrInB4IjsKCQluSGlkZGVuLnN0eWxlLnRvcCA9IGlEaXZZKyJweCI7CgkJbkhpZGRlbi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkkKG5IaWRkZW4pLmNzcygnb3BhY2l0eScsMCk7CgoJCXZhciBuQmFja2dyb3VuZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCW5CYWNrZ3JvdW5kLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKCQluQmFja2dyb3VuZC5zdHlsZS5sZWZ0ID0gIjBweCI7CgkJbkJhY2tncm91bmQuc3R5bGUudG9wID0gIjBweCI7CgkJbkJhY2tncm91bmQuc3R5bGUuaGVpZ2h0ID0gKChpV2luSGVpZ2h0PmlEb2NIZWlnaHQpPyBpV2luSGVpZ2h0IDogaURvY0hlaWdodCkgKyJweCI7CgkJbkJhY2tncm91bmQuc3R5bGUud2lkdGggPSAoKGlXaW5XaWR0aD5pRG9jV2lkdGgpPyBpV2luV2lkdGggOiBpRG9jV2lkdGgpICsicHgiOwoJCW5CYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3Nlcy5jb2xsZWN0aW9uLmJhY2tncm91bmQ7CgkJJChuQmFja2dyb3VuZCkuY3NzKCdvcGFjaXR5JywwKTsKCgkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggbkJhY2tncm91bmQgKTsKCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBuSGlkZGVuICk7CgoJCS8qIFZpc3VhbCBjb3JyZWN0aW9ucyB0byB0cnkgYW5kIGtlZXAgdGhlIGNvbGxlY3Rpb24gdmlzaWJsZSAqLwoJCXZhciBpRGl2V2lkdGggPSAkKG5IaWRkZW4pLm91dGVyV2lkdGgoKTsKCQl2YXIgaURpdkhlaWdodCA9ICQobkhpZGRlbikub3V0ZXJIZWlnaHQoKTsKCgkJaWYgKCBpRGl2WCArIGlEaXZXaWR0aCA+IGlEb2NXaWR0aCApCgkJewoJCQluSGlkZGVuLnN0eWxlLmxlZnQgPSAoaURvY1dpZHRoLWlEaXZXaWR0aCkrInB4IjsKCQl9CgoJCWlmICggaURpdlkgKyBpRGl2SGVpZ2h0ID4gaURvY0hlaWdodCApCgkJewoJCQluSGlkZGVuLnN0eWxlLnRvcCA9IChpRGl2WS1pRGl2SGVpZ2h0LSQobkJ1dHRvbikub3V0ZXJIZWlnaHQoKSkrInB4IjsKCQl9CgoJCXRoaXMuZG9tLmNvbGxlY3Rpb24uY29sbGVjdGlvbiA9IG5IaWRkZW47CgkJdGhpcy5kb20uY29sbGVjdGlvbi5iYWNrZ3JvdW5kID0gbkJhY2tncm91bmQ7CgoJCS8qIFRoaXMgcmVzdWx0cyBpbiBhIHZlcnkgc21hbGwgZGVsYXkgZm9yIHRoZSBlbmQgdXNlciBidXQgaXQgYWxsb3dzIHRoZSBhbmltYXRpb24gdG8gYmUKCQkgKiBtdWNoIHNtb290aGVyLiBJZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYW5pbWF0aW9uLCB0aGVuIHRoZSBzZXRUaW1lb3V0IGNhbiBiZSByZW1vdmVkCgkJICovCgkJc2V0VGltZW91dCggZnVuY3Rpb24gKCkgewoJCQkkKG5IaWRkZW4pLmFuaW1hdGUoeyJvcGFjaXR5IjogMX0sIDUwMCk7CgkJCSQobkJhY2tncm91bmQpLmFuaW1hdGUoeyJvcGFjaXR5IjogMC4yNX0sIDUwMCk7CgkJfSwgMTAgKTsKCgkJLyogUmVzaXplIHRoZSBidXR0b25zIHRvIHRoZSBGbGFzaCBjb250ZW50cyBmaXQgKi8KCQl0aGlzLmZuUmVzaXplQnV0dG9ucygpOwoKCQkvKiBFdmVudCBoYW5kbGVyIHRvIHJlbW92ZSB0aGUgY29sbGVjdGlvbiBkaXNwbGF5ICovCgkJJChuQmFja2dyb3VuZCkuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkJdGhhdC5fZm5Db2xsZWN0aW9uSGlkZS5jYWxsKCB0aGF0LCBudWxsLCBudWxsICk7CgkJfSApOwoJfSwKCgoJLyoqCgkgKiBIaWRlIGEgYnV0dG9uIGNvbGxlY3Rpb24KCSAqICBAcGFyYW0gICB7Tm9kZX0gbkJ1dHRvbiBCdXR0b24gdG8gdXNlIGZvciB0aGUgY29sbGVjdGlvbgoJICogIEBwYXJhbSAgIHtPYmplY3R9IG9Db25maWcgQnV0dG9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0CgkgKiAgQHJldHVybnMgdm9pZAoJICogIEBwcml2YXRlCgkgKi8KCSJfZm5Db2xsZWN0aW9uSGlkZSI6IGZ1bmN0aW9uICggbkJ1dHRvbiwgb0NvbmZpZyApCgl7CgkJaWYgKCBvQ29uZmlnICE9PSBudWxsICYmIG9Db25maWcuc0V4dGVuZHMgPT0gJ2NvbGxlY3Rpb24nICkKCQl7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdGhpcy5kb20uY29sbGVjdGlvbi5jb2xsZWN0aW9uICE9PSBudWxsICkKCQl7CgkJCSQodGhpcy5kb20uY29sbGVjdGlvbi5jb2xsZWN0aW9uKS5hbmltYXRlKHsib3BhY2l0eSI6IDB9LCA1MDAsIGZ1bmN0aW9uIChlKSB7CgkJCQl0aGlzLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCX0gKTsKCgkJCSQodGhpcy5kb20uY29sbGVjdGlvbi5iYWNrZ3JvdW5kKS5hbmltYXRlKHsib3BhY2l0eSI6IDB9LCA1MDAsIGZ1bmN0aW9uIChlKSB7CgkJCQl0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIHRoaXMgKTsKCQkJfSApOwoKCQkJdGhpcy5kb20uY29sbGVjdGlvbi5jb2xsZWN0aW9uID0gbnVsbDsKCQkJdGhpcy5kb20uY29sbGVjdGlvbi5iYWNrZ3JvdW5kID0gbnVsbDsKCQl9Cgl9LAoKCgoJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKgoJICogUm93IHNlbGVjdGlvbiBmdW5jdGlvbnMKCSAqLwoKCS8qKgoJICogQWRkIGV2ZW50IGhhbmRsZXJzIHRvIGEgdGFibGUgdG8gYWxsb3cgZm9yIHJvdyBzZWxlY3Rpb24KCSAqICBAbWV0aG9kICBfZm5Sb3dTZWxlY3RDb25maWcKCSAqICBAcmV0dXJucyB2b2lkCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5Sb3dTZWxlY3RDb25maWciOiBmdW5jdGlvbiAoKQoJewoJCWlmICggdGhpcy5zLm1hc3RlciApCgkJewoJCQl2YXIKCQkJCXRoYXQgPSB0aGlzLAoJCQkJaSwgaUxlbiwKCQkJCWR0ID0gdGhpcy5zLmR0LAoJCQkJYW9PcGVuUm93cyA9IHRoaXMucy5kdC5hb09wZW5Sb3dzOwoKCQkJJChkdC5uVGFibGUpLmFkZENsYXNzKCB0aGlzLmNsYXNzZXMuc2VsZWN0LnRhYmxlICk7CgoJCQkvLyBXaGVuIHVzaW5nIE9TIHN0eWxlIHNlbGVjdGlvbiwgd2Ugd2FudCB0byBjYW5jZWwgdGhlIHNoaWZ0IHRleHQKCQkJLy8gc2VsZWN0aW9uLCBidXQgb25seSB3aGVuIHRoZSBzaGlmdCBrZXkgaXMgdXNlZCAoc28geW91IGNhbgoJCQkvLyBhY3R1YWxseSBzdGlsbCBzZWxlY3QgdGV4dCBpbiB0aGUgdGFibGUpCgkJCWlmICggdGhpcy5zLnNlbGVjdC50eXBlID09PSAnb3MnICkgewoJCQkJJChkdC5uVEJvZHkpLm9uKCAnbW91c2Vkb3duLkRUVFRfU2VsZWN0JywgJ3RyJywgZnVuY3Rpb24oZSkgewoJCQkJCWlmICggZS5zaGlmdEtleSApIHsKCgkJCQkJCSQoZHQublRCb2R5KQoJCQkJCQkJLmNzcyggJy1tb3otdXNlci1zZWxlY3QnLCAnbm9uZScgKQoJCQkJCQkJLm9uZSgnc2VsZWN0c3RhcnQuRFRUVF9TZWxlY3QnLCAndHInLCBmdW5jdGlvbiAoKSB7CgkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJfSApOwoJCQkJCX0KCQkJCX0gKTsKCgkJCQkkKGR0Lm5UQm9keSkub24oICdtb3VzZXVwLkRUVFRfU2VsZWN0JywgJ3RyJywgZnVuY3Rpb24oZSkgewoJCQkJCSQoZHQublRCb2R5KS5jc3MoICctbW96LXVzZXItc2VsZWN0JywgJycgKTsKCQkJCX0gKTsKCQkJfQoKCQkJLy8gUm93IHNlbGVjdGlvbgoJCQkkKGR0Lm5UQm9keSkub24oICdjbGljay5EVFRUX1NlbGVjdCcsIHRoaXMucy5jdXN0b20uc1Jvd1NlbGVjdG9yLCBmdW5jdGlvbihlKSB7CgkJCQl2YXIgcm93ID0gdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAndHInID8KCQkJCQl0aGlzIDoKCQkJCQkkKHRoaXMpLnBhcmVudHMoJ3RyJylbMF07CgoJCQkJdmFyIHNlbGVjdCA9IHRoYXQucy5zZWxlY3Q7CgkJCQl2YXIgcG9zID0gdGhhdC5zLmR0Lm9JbnN0YW5jZS5mbkdldFBvc2l0aW9uKCByb3cgKTsKCgkJCQkvKiBTdWItdGFibGUgbXVzdCBiZSBpZ25vcmVkIChvZGQgdGhhdCB0aGUgc2VsZWN0b3Igd29uJ3QgZG8gdGhpcyB3aXRoID4pICovCgkJCQlpZiAoIHJvdy5wYXJlbnROb2RlICE9IGR0Lm5UQm9keSApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJLyogQ2hlY2sgdGhhdCB3ZSBhcmUgYWN0dWFsbHkgd29ya2luZyB3aXRoIGEgRGF0YVRhYmxlcyBjb250cm9sbGVkIHJvdyAqLwoJCQkJaWYgKCBkdC5vSW5zdGFuY2UuZm5HZXREYXRhKHJvdykgPT09IG51bGwgKSB7CgkJCQkgICAgcmV0dXJuOwoJCQkJfQoKCQkJCS8vIFNoaWZ0IGNsaWNrLCBjdHJsIGNsaWNrIGFuZCBzaW1wbGUgY2xpY2sgaGFuZGxpbmcgdG8gbWFrZQoJCQkJLy8gcm93IHNlbGVjdGlvbiBhIGxvdCBsaWtlIGEgZmlsZSBzeXN0ZW0gaW4gZGVza3RvcCBPU3MKCQkJCWlmICggc2VsZWN0LnR5cGUgPT0gJ29zJyApIHsKCQkJCQlpZiAoIGUuY3RybEtleSB8fCBlLm1ldGFLZXkgKSB7CgkJCQkJCS8vIEFkZCBvciByZW1vdmUgZnJvbSB0aGUgc2VsZWN0aW9uCgkJCQkJCWlmICggdGhhdC5mbklzU2VsZWN0ZWQoIHJvdyApICkgewoJCQkJCQkJdGhhdC5fZm5Sb3dEZXNlbGVjdCggcm93LCBlICk7CgkJCQkJCX0KCQkJCQkJZWxzZSB7CgkJCQkJCQl0aGF0Ll9mblJvd1NlbGVjdCggcm93LCBlICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZSBpZiAoIGUuc2hpZnRLZXkgKSB7CgkJCQkJCS8vIEFkZCBhIHJhbmdlIG9mIHJvd3MsIGZyb20gdGhlIGxhc3Qgc2VsZWN0ZWQgcm93IHRvCgkJCQkJCS8vIHRoaXMgb25lCgkJCQkJCXZhciByb3dJZHhzID0gdGhhdC5zLmR0LmFpRGlzcGxheS5zbGljZSgpOyAvLyB2aXNpYmxlIHJvd3MKCQkJCQkJdmFyIGlkeDEgPSAkLmluQXJyYXkoIHNlbGVjdC5sYXN0Um93LCByb3dJZHhzICk7CgkJCQkJCXZhciBpZHgyID0gJC5pbkFycmF5KCBwb3MsIHJvd0lkeHMgKTsKCgkJCQkJCWlmICggdGhhdC5mbkdldFNlbGVjdGVkKCkubGVuZ3RoID09PSAwIHx8IGlkeDEgPT09IC0xICkgewoJCQkJCQkJLy8gc2VsZWN0IGZyb20gdG9wIHRvIGhlcmUgLSBzbGlnaHRseSBvZGQsIGJ1dCBib3RoCgkJCQkJCQkvLyBXaW5kb3dzIGFuZCBNYWMgT1MgZG8gdGhpcwoJCQkJCQkJcm93SWR4cy5zcGxpY2UoICQuaW5BcnJheSggcG9zLCByb3dJZHhzICkrMSwgcm93SWR4cy5sZW5ndGggKTsKCQkJCQkJfQoJCQkJCQllbHNlIHsKCQkJCQkJCS8vIHJldmVyc2Ugc28gd2UgY2FuIHNoaWZ0IGNsaWNrICd1cCcgYXMgd2VsbCBhcyBkb3duCgkJCQkJCQlpZiAoIGlkeDEgPiBpZHgyICkgewoJCQkJCQkJCXZhciB0bXAgPSBpZHgyOwoJCQkJCQkJCWlkeDIgPSBpZHgxOwoJCQkJCQkJCWlkeDEgPSB0bXA7CgkJCQkJCQl9CgoJCQkJCQkJcm93SWR4cy5zcGxpY2UoIGlkeDIrMSwgcm93SWR4cy5sZW5ndGggKTsKCQkJCQkJCXJvd0lkeHMuc3BsaWNlKCAwLCBpZHgxICk7CgkJCQkJCX0KCgkJCQkJCWlmICggISB0aGF0LmZuSXNTZWxlY3RlZCggcm93ICkgKSB7CgkJCQkJCQkvLyBTZWxlY3QgcmFuZ2UKCQkJCQkJCXRoYXQuX2ZuUm93U2VsZWN0KCByb3dJZHhzLCBlICk7CgkJCQkJCX0KCQkJCQkJZWxzZSB7CgkJCQkJCQkvLyBEZXNlbGVjdCByYW5nZSAtIG5lZWQgdG8ga2VlcCB0aGUgY2xpY2tlZCBvbiByb3cgc2VsZWN0ZWQKCQkJCQkJCXJvd0lkeHMuc3BsaWNlKCAkLmluQXJyYXkoIHBvcywgcm93SWR4cyApLCAxICk7CgkJCQkJCQl0aGF0Ll9mblJvd0Rlc2VsZWN0KCByb3dJZHhzLCBlICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxzZSB7CgkJCQkJCS8vIE5vIGNtZCBvciBzaGlmdCBjbGljay4gRGVzZWxlY3QgY3VycmVudCBpZiBzZWxlY3RlZCwKCQkJCQkJLy8gb3Igc2VsZWN0IHRoaXMgcm93IG9ubHkKCQkJCQkJaWYgKCB0aGF0LmZuSXNTZWxlY3RlZCggcm93ICkgJiYgdGhhdC5mbkdldFNlbGVjdGVkKCkubGVuZ3RoID09PSAxICkgewoJCQkJCQkJdGhhdC5fZm5Sb3dEZXNlbGVjdCggcm93LCBlICk7CgkJCQkJCX0KCQkJCQkJZWxzZSB7CgkJCQkJCQl0aGF0LmZuU2VsZWN0Tm9uZSgpOwoJCQkJCQkJdGhhdC5fZm5Sb3dTZWxlY3QoIHJvdywgZSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJZWxzZSBpZiAoIHRoYXQuZm5Jc1NlbGVjdGVkKCByb3cgKSApIHsKCQkJCQl0aGF0Ll9mblJvd0Rlc2VsZWN0KCByb3csIGUgKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBzZWxlY3QudHlwZSA9PSAic2luZ2xlIiApIHsKCQkJCQl0aGF0LmZuU2VsZWN0Tm9uZSgpOwoJCQkJCXRoYXQuX2ZuUm93U2VsZWN0KCByb3csIGUgKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBzZWxlY3QudHlwZSA9PSAibXVsdGkiICkgewoJCQkJCXRoYXQuX2ZuUm93U2VsZWN0KCByb3csIGUgKTsKCQkJCX0KCgkJCQlzZWxlY3QubGFzdFJvdyA9IHBvczsKCQkJfSApOy8vLm9uKCdzZWxlY3RzdGFydCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9ICk7CgoJCQkvLyBCaW5kIGEgbGlzdGVuZXIgdG8gdGhlIERhdGFUYWJsZSBmb3Igd2hlbiBuZXcgcm93cyBhcmUgY3JlYXRlZC4KCQkJLy8gVGhpcyBhbGxvd3Mgcm93cyB0byBiZSB2aXN1YWxseSBzZWxlY3RlZCB3aGVuIHRoZXkgc2hvdWxkIGJlIGFuZAoJCQkvLyBkZWZlcnJlZCByZW5kZXJpbmcgaXMgdXNlZC4KCQkJZHQub0FwaS5fZm5DYWxsYmFja1JlZyggZHQsICdhb1Jvd0NyZWF0ZWRDYWxsYmFjaycsIGZ1bmN0aW9uICh0ciwgZGF0YSwgaW5kZXgpIHsKCQkJCWlmICggZHQuYW9EYXRhW2luZGV4XS5fRFRUVF9zZWxlY3RlZCApIHsKCQkJCQkkKHRyKS5hZGRDbGFzcyggdGhhdC5jbGFzc2VzLnNlbGVjdC5yb3cgKTsKCQkJCX0KCQkJfSwgJ1RhYmxlVG9vbHMtU2VsZWN0QWxsJyApOwoJCX0KCX0sCgoJLyoqCgkgKiBTZWxlY3Qgcm93cwoJICogIEBwYXJhbSAgIHsqfSBzcmMgUm93cyB0byBzZWxlY3QgLSBzZWUgX2ZuU2VsZWN0RGF0YSBmb3IgYSBkZXNjcmlwdGlvbiBvZiB2YWxpZCBpbnB1dHMKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mblJvd1NlbGVjdCI6IGZ1bmN0aW9uICggc3JjLCBlICkKCXsKCQl2YXIKCQkJdGhhdCA9IHRoaXMsCgkJCWRhdGEgPSB0aGlzLl9mblNlbGVjdERhdGEoIHNyYyApLAoJCQlmaXJzdFRyID0gZGF0YS5sZW5ndGg9PT0wID8gbnVsbCA6IGRhdGFbMF0ublRyLAoJCQlhblNlbGVjdGVkID0gW10sCgkJCWksIGxlbjsKCgkJLy8gR2V0IGFsbCB0aGUgcm93cyB0aGF0IHdpbGwgYmUgc2VsZWN0ZWQKCQlmb3IgKCBpPTAsIGxlbj1kYXRhLmxlbmd0aCA7IGk8bGVuIDsgaSsrICkKCQl7CgkJCWlmICggZGF0YVtpXS5uVHIgKQoJCQl7CgkJCQlhblNlbGVjdGVkLnB1c2goIGRhdGFbaV0ublRyICk7CgkJCX0KCQl9CgoJCS8vIFVzZXIgZGVmaW5lZCBwcmUtc2VsZWN0aW9uIGZ1bmN0aW9uCgkJaWYgKCB0aGlzLnMuc2VsZWN0LnByZVJvd1NlbGVjdCAhPT0gbnVsbCAmJiAhdGhpcy5zLnNlbGVjdC5wcmVSb3dTZWxlY3QuY2FsbCh0aGlzLCBlLCBhblNlbGVjdGVkLCB0cnVlKSApCgkJewoJCQlyZXR1cm47CgkJfQoKCQkvLyBNYXJrIHRoZW0gYXMgc2VsZWN0ZWQKCQlmb3IgKCBpPTAsIGxlbj1kYXRhLmxlbmd0aCA7IGk8bGVuIDsgaSsrICkKCQl7CgkJCWRhdGFbaV0uX0RUVFRfc2VsZWN0ZWQgPSB0cnVlOwoKCQkJaWYgKCBkYXRhW2ldLm5UciApCgkJCXsKCQkJCSQoZGF0YVtpXS5uVHIpLmFkZENsYXNzKCB0aGF0LmNsYXNzZXMuc2VsZWN0LnJvdyApOwoJCQl9CgkJfQoKCQkvLyBQb3N0LXNlbGVjdGlvbiBmdW5jdGlvbgoJCWlmICggdGhpcy5zLnNlbGVjdC5wb3N0U2VsZWN0ZWQgIT09IG51bGwgKQoJCXsKCQkJdGhpcy5zLnNlbGVjdC5wb3N0U2VsZWN0ZWQuY2FsbCggdGhpcywgYW5TZWxlY3RlZCApOwoJCX0KCgkJVGFibGVUb29scy5fZm5FdmVudERpc3BhdGNoKCB0aGlzLCAnc2VsZWN0JywgYW5TZWxlY3RlZCwgdHJ1ZSApOwoJfSwKCgkvKioKCSAqIERlc2VsZWN0IHJvd3MKCSAqICBAcGFyYW0gICB7Kn0gc3JjIFJvd3MgdG8gZGVzZWxlY3QgLSBzZWUgX2ZuU2VsZWN0RGF0YSBmb3IgYSBkZXNjcmlwdGlvbiBvZiB2YWxpZCBpbnB1dHMKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mblJvd0Rlc2VsZWN0IjogZnVuY3Rpb24gKCBzcmMsIGUgKQoJewoJCXZhcgoJCQl0aGF0ID0gdGhpcywKCQkJZGF0YSA9IHRoaXMuX2ZuU2VsZWN0RGF0YSggc3JjICksCgkJCWZpcnN0VHIgPSBkYXRhLmxlbmd0aD09PTAgPyBudWxsIDogZGF0YVswXS5uVHIsCgkJCWFuRGVzZWxlY3RlZFRycyA9IFtdLAoJCQlpLCBsZW47CgoJCS8vIEdldCBhbGwgdGhlIHJvd3MgdGhhdCB3aWxsIGJlIGRlc2VsZWN0ZWQKCQlmb3IgKCBpPTAsIGxlbj1kYXRhLmxlbmd0aCA7IGk8bGVuIDsgaSsrICkKCQl7CgkJCWlmICggZGF0YVtpXS5uVHIgKQoJCQl7CgkJCQlhbkRlc2VsZWN0ZWRUcnMucHVzaCggZGF0YVtpXS5uVHIgKTsKCQkJfQoJCX0KCgkJLy8gVXNlciBkZWZpbmVkIHByZS1zZWxlY3Rpb24gZnVuY3Rpb24KCQlpZiAoIHRoaXMucy5zZWxlY3QucHJlUm93U2VsZWN0ICE9PSBudWxsICYmICF0aGlzLnMuc2VsZWN0LnByZVJvd1NlbGVjdC5jYWxsKHRoaXMsIGUsIGFuRGVzZWxlY3RlZFRycywgZmFsc2UpICkKCQl7CgkJCXJldHVybjsKCQl9CgoJCS8vIE1hcmsgdGhlbSBhcyBkZXNlbGVjdGVkCgkJZm9yICggaT0wLCBsZW49ZGF0YS5sZW5ndGggOyBpPGxlbiA7IGkrKyApCgkJewoJCQlkYXRhW2ldLl9EVFRUX3NlbGVjdGVkID0gZmFsc2U7CgoJCQlpZiAoIGRhdGFbaV0ublRyICkKCQkJewoJCQkJJChkYXRhW2ldLm5UcikucmVtb3ZlQ2xhc3MoIHRoYXQuY2xhc3Nlcy5zZWxlY3Qucm93ICk7CgkJCX0KCQl9CgoJCS8vIFBvc3QtZGVzZWxlY3Rpb24gZnVuY3Rpb24KCQlpZiAoIHRoaXMucy5zZWxlY3QucG9zdERlc2VsZWN0ZWQgIT09IG51bGwgKQoJCXsKCQkJdGhpcy5zLnNlbGVjdC5wb3N0RGVzZWxlY3RlZC5jYWxsKCB0aGlzLCBhbkRlc2VsZWN0ZWRUcnMgKTsKCQl9CgoJCVRhYmxlVG9vbHMuX2ZuRXZlbnREaXNwYXRjaCggdGhpcywgJ3NlbGVjdCcsIGFuRGVzZWxlY3RlZFRycywgZmFsc2UgKTsKCX0sCgoJLyoqCgkgKiBUYWtlIGEgZGF0YSBzb3VyY2UgZm9yIHJvdyBzZWxlY3Rpb24gYW5kIGNvbnZlcnQgaXQgaW50byBhb0RhdGEgcG9pbnRzIGZvciB0aGUgRFQKCSAqICAgQHBhcmFtIHsqfSBzcmMgQ2FuIGJlIGEgc2luZ2xlIERPTSBUUiBub2RlLCBhbiBhcnJheSBvZiBUUiBub2RlcyAoaW5jbHVkaW5nIGEKCSAqICAgICBhIGpRdWVyeSBvYmplY3QpLCBhIHNpbmdsZSBhb0RhdGEgcG9pbnQgZnJvbSBEYXRhVGFibGVzLCBhbiBhcnJheSBvZiBhb0RhdGEKCSAqICAgICBwb2ludHMgb3IgYW4gYXJyYXkgb2YgYW9EYXRhIGluZGV4ZXMKCSAqICAgQHJldHVybnMge2FycmF5fSBBbiBhcnJheSBvZiBhb0RhdGEgcG9pbnRzCgkgKi8KCSJfZm5TZWxlY3REYXRhIjogZnVuY3Rpb24gKCBzcmMgKQoJewoJCXZhciBvdXQgPSBbXSwgcG9zLCBpLCBpTGVuOwoKCQlpZiAoIHNyYy5ub2RlTmFtZSApCgkJewoJCQkvLyBTaW5nbGUgbm9kZQoJCQlwb3MgPSB0aGlzLnMuZHQub0luc3RhbmNlLmZuR2V0UG9zaXRpb24oIHNyYyApOwoJCQlvdXQucHVzaCggdGhpcy5zLmR0LmFvRGF0YVtwb3NdICk7CgkJfQoJCWVsc2UgaWYgKCB0eXBlb2Ygc3JjLmxlbmd0aCAhPT0gJ3VuZGVmaW5lZCcgKQoJCXsKCQkJLy8galF1ZXJ5IG9iamVjdCBvciBhbiBhcnJheSBvZiBub2Rlcywgb3IgYW9EYXRhIHBvaW50cwoJCQlmb3IgKCBpPTAsIGlMZW49c3JjLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggc3JjW2ldLm5vZGVOYW1lICkKCQkJCXsKCQkJCQlwb3MgPSB0aGlzLnMuZHQub0luc3RhbmNlLmZuR2V0UG9zaXRpb24oIHNyY1tpXSApOwoJCQkJCW91dC5wdXNoKCB0aGlzLnMuZHQuYW9EYXRhW3Bvc10gKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCB0eXBlb2Ygc3JjW2ldID09PSAnbnVtYmVyJyApCgkJCQl7CgkJCQkJb3V0LnB1c2goIHRoaXMucy5kdC5hb0RhdGFbIHNyY1tpXSBdICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb3V0LnB1c2goIHNyY1tpXSApOwoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gb3V0OwoJCX0KCQllbHNlCgkJewoJCQkvLyBBIHNpbmdsZSBhb0RhdGEgcG9pbnQKCQkJb3V0LnB1c2goIHNyYyApOwoJCX0KCgkJcmV0dXJuIG91dDsKCX0sCgoKCS8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCSAqIFRleHQgYnV0dG9uIGZ1bmN0aW9ucwoJICovCgoJLyoqCgkgKiBDb25maWd1cmUgYSB0ZXh0IGJhc2VkIGJ1dHRvbiBmb3IgaW50ZXJhY3Rpb24gZXZlbnRzCgkgKiAgQG1ldGhvZCAgX2ZuVGV4dENvbmZpZwoJICogIEBwYXJhbSAgIHtOb2RlfSBuQnV0dG9uIEJ1dHRvbiBlbGVtZW50IHdoaWNoIGlzIGJlaW5nIGNvbnNpZGVyZWQKCSAqICBAcGFyYW0gICB7T2JqZWN0fSBvQ29uZmlnIEJ1dHRvbiBjb25maWd1cmF0aW9uIG9iamVjdAoJICogIEByZXR1cm5zIHZvaWQKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mblRleHRDb25maWciOiBmdW5jdGlvbiAoIG5CdXR0b24sIG9Db25maWcgKQoJewoJCXZhciB0aGF0ID0gdGhpczsKCgkJaWYgKCBvQ29uZmlnLmZuSW5pdCAhPT0gbnVsbCApCgkJewoJCQlvQ29uZmlnLmZuSW5pdC5jYWxsKCB0aGlzLCBuQnV0dG9uLCBvQ29uZmlnICk7CgkJfQoKCQlpZiAoIG9Db25maWcuc1Rvb2xUaXAgIT09ICIiICkKCQl7CgkJCW5CdXR0b24udGl0bGUgPSBvQ29uZmlnLnNUb29sVGlwOwoJCX0KCgkJJChuQnV0dG9uKS5ob3ZlciggZnVuY3Rpb24gKCkgewoJCQlpZiAoIG9Db25maWcuZm5Nb3VzZW92ZXIgIT09IG51bGwgKQoJCQl7CgkJCQlvQ29uZmlnLmZuTW91c2VvdmVyLmNhbGwoIHRoaXMsIG5CdXR0b24sIG9Db25maWcsIG51bGwgKTsKCQkJfQoJCX0sIGZ1bmN0aW9uICgpIHsKCQkJaWYgKCBvQ29uZmlnLmZuTW91c2VvdXQgIT09IG51bGwgKQoJCQl7CgkJCQlvQ29uZmlnLmZuTW91c2VvdXQuY2FsbCggdGhpcywgbkJ1dHRvbiwgb0NvbmZpZywgbnVsbCApOwoJCQl9CgkJfSApOwoKCQlpZiAoIG9Db25maWcuZm5TZWxlY3QgIT09IG51bGwgKQoJCXsKCQkJVGFibGVUb29scy5fZm5FdmVudExpc3RlbiggdGhpcywgJ3NlbGVjdCcsIGZ1bmN0aW9uIChuKSB7CgkJCQlvQ29uZmlnLmZuU2VsZWN0LmNhbGwoIHRoYXQsIG5CdXR0b24sIG9Db25maWcsIG4gKTsKCQkJfSApOwoJCX0KCgkJJChuQnV0dG9uKS5jbGljayggZnVuY3Rpb24gKGUpIHsKCQkJLy9lLnByZXZlbnREZWZhdWx0KCk7CgoJCQlpZiAoIG9Db25maWcuZm5DbGljayAhPT0gbnVsbCApCgkJCXsKCQkJCW9Db25maWcuZm5DbGljay5jYWxsKCB0aGF0LCBuQnV0dG9uLCBvQ29uZmlnLCBudWxsLCBlICk7CgkJCX0KCgkJCS8qIFByb3ZpZGUgYSBjb21wbGV0ZSBmdW5jdGlvbiB0byBtYXRjaCB0aGUgYmVoYXZpb3VyIG9mIHRoZSBmbGFzaCBlbGVtZW50cyAqLwoJCQlpZiAoIG9Db25maWcuZm5Db21wbGV0ZSAhPT0gbnVsbCApCgkJCXsKCQkJCW9Db25maWcuZm5Db21wbGV0ZS5jYWxsKCB0aGF0LCBuQnV0dG9uLCBvQ29uZmlnLCBudWxsLCBudWxsICk7CgkJCX0KCgkJCXRoYXQuX2ZuQ29sbGVjdGlvbkhpZGUoIG5CdXR0b24sIG9Db25maWcgKTsKCQl9ICk7Cgl9LAoKCgoJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKgoJICogRmxhc2ggYnV0dG9uIGZ1bmN0aW9ucwoJICovCgkKCS8qKgoJICogQ2hlY2sgaWYgdGhlIEZsYXNoIHBsdWctaW4gaXMgYXZhaWxhYmxlCgkgKiAgQG1ldGhvZCAgX2ZuSGFzRmxhc2gKCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIEZsYXNoIGF2YWlsYWJsZSwgYGZhbHNlYCBvdGhlcndpc2UKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mbkhhc0ZsYXNoIjogZnVuY3Rpb24gKCkKCXsKCQl0cnkgewoJCQl2YXIgZm8gPSBuZXcgQWN0aXZlWE9iamVjdCgnU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2gnKTsKCQkJaWYgKGZvKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQljYXRjaCAoZSkgewoJCQlpZiAoCgkJCQluYXZpZ2F0b3IubWltZVR5cGVzICYmCgkJCQluYXZpZ2F0b3IubWltZVR5cGVzWydhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCddICE9PSB1bmRlZmluZWQgJiYKCQkJCW5hdmlnYXRvci5taW1lVHlwZXNbJ2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJ10uZW5hYmxlZFBsdWdpbgoJCQkpIHsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCgkvKioKCSAqIENvbmZpZ3VyZSBhIGZsYXNoIGJhc2VkIGJ1dHRvbiBmb3IgaW50ZXJhY3Rpb24gZXZlbnRzCgkgKiAgQG1ldGhvZCAgX2ZuRmxhc2hDb25maWcKCSAqICBAcGFyYW0gICB7Tm9kZX0gbkJ1dHRvbiBCdXR0b24gZWxlbWVudCB3aGljaCBpcyBiZWluZyBjb25zaWRlcmVkCgkgKiAgQHBhcmFtICAge299IG9Db25maWcgQnV0dG9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0CgkgKiAgQHJldHVybnMgdm9pZAoJICogIEBwcml2YXRlIAoJICovCgkiX2ZuRmxhc2hDb25maWciOiBmdW5jdGlvbiAoIG5CdXR0b24sIG9Db25maWcgKQoJewoJCXZhciB0aGF0ID0gdGhpczsKCQl2YXIgZmxhc2ggPSBuZXcgWmVyb0NsaXBib2FyZF9UYWJsZVRvb2xzLkNsaWVudCgpOwoKCQlpZiAoIG9Db25maWcuZm5Jbml0ICE9PSBudWxsICkKCQl7CgkJCW9Db25maWcuZm5Jbml0LmNhbGwoIHRoaXMsIG5CdXR0b24sIG9Db25maWcgKTsKCQl9CgoJCWZsYXNoLnNldEhhbmRDdXJzb3IoIHRydWUgKTsKCgkJaWYgKCBvQ29uZmlnLnNBY3Rpb24gPT0gImZsYXNoX3NhdmUiICkKCQl7CgkJCWZsYXNoLnNldEFjdGlvbiggJ3NhdmUnICk7CgkJCWZsYXNoLnNldENoYXJTZXQoIChvQ29uZmlnLnNDaGFyU2V0PT0idXRmMTZsZSIpID8gJ1VURjE2TEUnIDogJ1VURjgnICk7CgkJCWZsYXNoLnNldEJvbUluYyggb0NvbmZpZy5iQm9tSW5jICk7CgkJCWZsYXNoLnNldEZpbGVOYW1lKCBvQ29uZmlnLnNGaWxlTmFtZS5yZXBsYWNlKCcqJywgdGhpcy5mbkdldFRpdGxlKG9Db25maWcpKSApOwoJCX0KCQllbHNlIGlmICggb0NvbmZpZy5zQWN0aW9uID09ICJmbGFzaF9wZGYiICkKCQl7CgkJCWZsYXNoLnNldEFjdGlvbiggJ3BkZicgKTsKCQkJZmxhc2guc2V0RmlsZU5hbWUoIG9Db25maWcuc0ZpbGVOYW1lLnJlcGxhY2UoJyonLCB0aGlzLmZuR2V0VGl0bGUob0NvbmZpZykpICk7CgkJfQoJCWVsc2UKCQl7CgkJCWZsYXNoLnNldEFjdGlvbiggJ2NvcHknICk7CgkJfQoKCQlmbGFzaC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZU92ZXInLCBmdW5jdGlvbihjbGllbnQpIHsKCQkJaWYgKCBvQ29uZmlnLmZuTW91c2VvdmVyICE9PSBudWxsICkKCQkJewoJCQkJb0NvbmZpZy5mbk1vdXNlb3Zlci5jYWxsKCB0aGF0LCBuQnV0dG9uLCBvQ29uZmlnLCBmbGFzaCApOwoJCQl9CgkJfSApOwoKCQlmbGFzaC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZU91dCcsIGZ1bmN0aW9uKGNsaWVudCkgewoJCQlpZiAoIG9Db25maWcuZm5Nb3VzZW91dCAhPT0gbnVsbCApCgkJCXsKCQkJCW9Db25maWcuZm5Nb3VzZW91dC5jYWxsKCB0aGF0LCBuQnV0dG9uLCBvQ29uZmlnLCBmbGFzaCApOwoJCQl9CgkJfSApOwoKCQlmbGFzaC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZURvd24nLCBmdW5jdGlvbihjbGllbnQpIHsKCQkJaWYgKCBvQ29uZmlnLmZuQ2xpY2sgIT09IG51bGwgKQoJCQl7CgkJCQlvQ29uZmlnLmZuQ2xpY2suY2FsbCggdGhhdCwgbkJ1dHRvbiwgb0NvbmZpZywgZmxhc2ggKTsKCQkJfQoJCX0gKTsKCgkJZmxhc2guYWRkRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBmdW5jdGlvbiAoY2xpZW50LCB0ZXh0KSB7CgkJCWlmICggb0NvbmZpZy5mbkNvbXBsZXRlICE9PSBudWxsICkKCQkJewoJCQkJb0NvbmZpZy5mbkNvbXBsZXRlLmNhbGwoIHRoYXQsIG5CdXR0b24sIG9Db25maWcsIGZsYXNoLCB0ZXh0ICk7CgkJCX0KCQkJdGhhdC5fZm5Db2xsZWN0aW9uSGlkZSggbkJ1dHRvbiwgb0NvbmZpZyApOwoJCX0gKTsKCgkJdGhpcy5fZm5GbGFzaEdsdWUoIGZsYXNoLCBuQnV0dG9uLCBvQ29uZmlnLnNUb29sVGlwICk7Cgl9LAoKCgkvKioKCSAqIFdhaXQgdW50aWwgdGhlIGlkIGlzIGluIHRoZSBET00gYmVmb3JlIHdlICJnbHVlIiB0aGUgc3dmLiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiB3aWxsIGNhbGwKCSAqIGl0c2VsZiAodXNpbmcgc2V0VGltZW91dCkgdW50aWwgaXQgY29tcGxldGVzIHN1Y2Nlc3NmdWxseQoJICogIEBtZXRob2QgIF9mbkZsYXNoR2x1ZQoJICogIEBwYXJhbSAgIHtPYmplY3R9IGNsaXAgWmVybyBjbGlwYm9hcmQgb2JqZWN0CgkgKiAgQHBhcmFtICAge05vZGV9IG5vZGUgbm9kZSB0byBnbHVlIHN3ZiB0bwoJICogIEBwYXJhbSAgIHtTdHJpbmd9IHRleHQgdGl0bGUgb2YgdGhlIGZsYXNoIG1vdmllCgkgKiAgQHJldHVybnMgdm9pZAoJICogIEBwcml2YXRlIAoJICovCgkiX2ZuRmxhc2hHbHVlIjogZnVuY3Rpb24gKCBmbGFzaCwgbm9kZSwgdGV4dCApCgl7CgkJdmFyIHRoYXQgPSB0aGlzOwoJCXZhciBpZCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdpZCcpOwoKCQlpZiAoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSApCgkJewoJCQlmbGFzaC5nbHVlKCBub2RlLCB0ZXh0ICk7CgkJfQoJCWVsc2UKCQl7CgkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHsKCQkJCXRoYXQuX2ZuRmxhc2hHbHVlKCBmbGFzaCwgbm9kZSwgdGV4dCApOwoJCQl9LCAxMDAgKTsKCQl9Cgl9LAoKCgkvKioKCSAqIFNldCB0aGUgdGV4dCBmb3IgdGhlIGZsYXNoIGNsaXAgdG8gZGVhbCB3aXRoCgkgKiAKCSAqIFRoaXMgZnVuY3Rpb24gaXMgcmVxdWlyZWQgZm9yIGxhcmdlIGluZm9ybWF0aW9uIHNldHMuIFRoZXJlIGlzIGEgbGltaXQgb24gdGhlIAoJICogYW1vdW50IG9mIGRhdGEgdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgYmV0d2VlbiBKYXZhc2NyaXB0IGFuZCBGbGFzaCBpbiBhIHNpbmdsZSBjYWxsLCBzbwoJICogd2UgdXNlIHRoaXMgbWV0aG9kIHRvIGJ1aWxkIHVwIHRoZSB0ZXh0IGluIEZsYXNoIGJ5IHNlbmRpbmcgb3ZlciBjaHVua3MuIEl0IGlzIGVzdGltYXRlZAoJICogdGhhdCB0aGUgZGF0YSBsaW1pdCBpcyBhcm91bmQgNjRrLCBhbHRob3VnaCBpdCBpcyB1bmRvY3VtZW50ZWQsIGFuZCBhcHBlYXJzIHRvIGJlIGRpZmZlcmVudAoJICogYmV0d2VlbiBkaWZmZXJlbnQgZmxhc2ggdmVyc2lvbnMuIFdlIGNodW5rIGF0IDhLaUIuCgkgKiAgQG1ldGhvZCAgX2ZuRmxhc2hTZXRUZXh0CgkgKiAgQHBhcmFtICAge09iamVjdH0gY2xpcCB0aGUgWmVyb0NsaXBib2FyZCBvYmplY3QKCSAqICBAcGFyYW0gICB7U3RyaW5nfSBzRGF0YSB0aGUgZGF0YSB0byBiZSBzZXQKCSAqICBAcmV0dXJucyB2b2lkCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5GbGFzaFNldFRleHQiOiBmdW5jdGlvbiAoIGNsaXAsIHNEYXRhICkKCXsKCQl2YXIgYXNEYXRhID0gdGhpcy5fZm5DaHVua0RhdGEoIHNEYXRhLCA4MTkyICk7CgoJCWNsaXAuY2xlYXJUZXh0KCk7CgkJZm9yICggdmFyIGk9MCwgaUxlbj1hc0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQl7CgkJCWNsaXAuYXBwZW5kVGV4dCggYXNEYXRhW2ldICk7CgkJfQoJfSwKCgoKCS8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCSAqIERhdGEgcmV0cmlldmFsIGZ1bmN0aW9ucwoJICovCgoJLyoqCgkgKiBDb252ZXJ0IHRoZSBtaXhlZCBjb2x1bW5zIHZhcmlhYmxlIGludG8gYSBib29sZWFuIGFycmF5IHRoZSBzYW1lIHNpemUgYXMgdGhlIGNvbHVtbnMsIHdoaWNoCgkgKiBpbmRpY2F0ZXMgd2hpY2ggY29sdW1ucyB3ZSB3YW50IHRvIGluY2x1ZGUKCSAqICBAbWV0aG9kICBfZm5Db2x1bW5UYXJnZXRzCgkgKiAgQHBhcmFtICAge1N0cmluZ3xBcnJheX0gbUNvbHVtbnMgVGhlIGNvbHVtbnMgdG8gYmUgaW5jbHVkZWQgaW4gZGF0YSByZXRyaWV2YWwuIElmIGEgc3RyaW5nCgkgKgkJCSB0aGVuIGl0IGNhbiB0YWtlIHRoZSB2YWx1ZSBvZiAidmlzaWJsZSIgb3IgImhpZGRlbiIgKHRvIGluY2x1ZGUgYWxsIHZpc2libGUgb3IKCSAqCQkJIGhpZGRlbiBjb2x1bW5zIHJlc3BlY3RpdmVseSkuIE9yIGFuIGFycmF5IG9mIGNvbHVtbiBpbmRleGVzCgkgKiAgQHJldHVybnMge0FycmF5fSBBIGJvb2xlYW4gYXJyYXkgdGhlIGxlbmd0aCBvZiB0aGUgY29sdW1ucyBvZiB0aGUgdGFibGUsIHdoaWNoIGVhY2ggdmFsdWUKCSAqCQkJIGluZGljYXRpbmcgaWYgdGhlIGNvbHVtbiBpcyB0byBiZSBpbmNsdWRlZCBvciBub3QKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mbkNvbHVtblRhcmdldHMiOiBmdW5jdGlvbiAoIG1Db2x1bW5zICkKCXsKCQl2YXIgYUNvbHVtbnMgPSBbXTsKCQl2YXIgZHQgPSB0aGlzLnMuZHQ7CgkJdmFyIGksIGlMZW47CgoJCWlmICggdHlwZW9mIG1Db2x1bW5zID09ICJvYmplY3QiICkKCQl7CgkJCWZvciAoIGk9MCwgaUxlbj1kdC5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYUNvbHVtbnMucHVzaCggZmFsc2UgKTsKCQkJfQoKCQkJZm9yICggaT0wLCBpTGVuPW1Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWFDb2x1bW5zWyBtQ29sdW1uc1tpXSBdID0gdHJ1ZTsKCQkJfQoJCX0KCQllbHNlIGlmICggbUNvbHVtbnMgPT0gInZpc2libGUiICkKCQl7CgkJCWZvciAoIGk9MCwgaUxlbj1kdC5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYUNvbHVtbnMucHVzaCggZHQuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID8gdHJ1ZSA6IGZhbHNlICk7CgkJCX0KCQl9CgkJZWxzZSBpZiAoIG1Db2x1bW5zID09ICJoaWRkZW4iICkKCQl7CgkJCWZvciAoIGk9MCwgaUxlbj1kdC5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYUNvbHVtbnMucHVzaCggZHQuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID8gZmFsc2UgOiB0cnVlICk7CgkJCX0KCQl9CgkJZWxzZSBpZiAoIG1Db2x1bW5zID09ICJzb3J0YWJsZSIgKQoJCXsKCQkJZm9yICggaT0wLCBpTGVuPWR0LmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhQ29sdW1ucy5wdXNoKCBkdC5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlID8gdHJ1ZSA6IGZhbHNlICk7CgkJCX0KCQl9CgkJZWxzZSAvKiBhbGwgKi8KCQl7CgkJCWZvciAoIGk9MCwgaUxlbj1kdC5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJYUNvbHVtbnMucHVzaCggdHJ1ZSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gYUNvbHVtbnM7Cgl9LAoKCgkvKioKCSAqIE5ldyBsaW5lIGNoYXJhY3RlcihzKSBkZXBlbmQgb24gdGhlIHBsYXRmb3JtcwoJICogIEBtZXRob2QgIG1ldGhvZAoJICogIEBwYXJhbSAgIHtPYmplY3R9IG9Db25maWcgQnV0dG9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0IC0gb25seSBpbnRlcmVzdGVkIGluIG9Db25maWcuc05ld0xpbmUKCSAqICBAcmV0dXJucyB7U3RyaW5nfSBOZXdsaW5lIGNoYXJhY3RlcgoJICovCgkiX2ZuTmV3bGluZSI6IGZ1bmN0aW9uICggb0NvbmZpZyApCgl7CgkJaWYgKCBvQ29uZmlnLnNOZXdMaW5lID09ICJhdXRvIiApCgkJewoJCQlyZXR1cm4gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvV2luZG93cy8pID8gIlxyXG4iIDogIlxuIjsKCQl9CgkJZWxzZQoJCXsKCQkJcmV0dXJuIG9Db25maWcuc05ld0xpbmU7CgkJfQoJfSwKCgoJLyoqCgkgKiBHZXQgZGF0YSBmcm9tIERhdGFUYWJsZXMnIGludGVybmFscyBhbmQgZm9ybWF0IGl0IGZvciBvdXRwdXQKCSAqICBAbWV0aG9kICBfZm5HZXREYXRhVGFibGVzRGF0YQoJICogIEBwYXJhbSAgIHtPYmplY3R9IG9Db25maWcgQnV0dG9uIGNvbmZpZ3VyYXRpb24gb2JqZWN0CgkgKiAgQHBhcmFtICAge1N0cmluZ30gb0NvbmZpZy5zRmllbGRCb3VuZGFyeSBGaWVsZCBib3VuZGFyeSBmb3IgdGhlIGRhdGEgY2VsbHMgaW4gdGhlIHN0cmluZwoJICogIEBwYXJhbSAgIHtTdHJpbmd9IG9Db25maWcuc0ZpZWxkU2VwZXJhdG9yIEZpZWxkIHNlcGFyYXRvciBmb3IgdGhlIGRhdGEgY2VsbHMKCSAqICBAcGFyYW0gICB7U3RyaW5nfSBvQ29uZmlnLnNOZXdsaW5lIE5ldyBsaW5lIG9wdGlvbnMKCSAqICBAcGFyYW0gICB7TWl4ZWR9IG9Db25maWcubUNvbHVtbnMgV2hpY2ggY29sdW1ucyBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIG91dHB1dAoJICogIEBwYXJhbSAgIHtCb29sZWFufSBvQ29uZmlnLmJIZWFkZXIgSW5jbHVkZSB0aGUgaGVhZGVyCgkgKiAgQHBhcmFtICAge0Jvb2xlYW59IG9Db25maWcuYkZvb3RlciBJbmNsdWRlIHRoZSBmb290ZXIKCSAqICBAcGFyYW0gICB7Qm9vbGVhbn0gb0NvbmZpZy5iU2VsZWN0ZWRPbmx5IEluY2x1ZGUgb25seSB0aGUgc2VsZWN0ZWQgcm93cyBpbiB0aGUgb3V0cHV0CgkgKiAgQHJldHVybnMge1N0cmluZ30gQ29uY2F0ZW5hdGVkIHN0cmluZyBvZiBkYXRhCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5HZXREYXRhVGFibGVzRGF0YSI6IGZ1bmN0aW9uICggb0NvbmZpZyApCgl7CgkJdmFyIGksIGlMZW4sIGosIGpMZW47CgkJdmFyIGFSb3csIGFEYXRhPVtdLCBzTG9vcERhdGE9JycsIGFycjsKCQl2YXIgZHQgPSB0aGlzLnMuZHQsIHRyLCBjaGlsZDsKCQl2YXIgcmVnZXggPSBuZXcgUmVnRXhwKG9Db25maWcuc0ZpZWxkQm91bmRhcnksICJnIik7IC8qIERvIGl0IGhlcmUgZm9yIHNwZWVkICovCgkJdmFyIGFDb2x1bW5zSW5jID0gdGhpcy5fZm5Db2x1bW5UYXJnZXRzKCBvQ29uZmlnLm1Db2x1bW5zICk7CgkJdmFyIGJTZWxlY3RlZE9ubHkgPSAodHlwZW9mIG9Db25maWcuYlNlbGVjdGVkT25seSAhPSAndW5kZWZpbmVkJykgPyBvQ29uZmlnLmJTZWxlY3RlZE9ubHkgOiBmYWxzZTsKCgkJLyoKCQkgKiBIZWFkZXIKCQkgKi8KCQlpZiAoIG9Db25maWcuYkhlYWRlciApCgkJewoJCQlhUm93ID0gW107CgoJCQlmb3IgKCBpPTAsIGlMZW49ZHQuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYUNvbHVtbnNJbmNbaV0gKQoJCQkJewoJCQkJCXNMb29wRGF0YSA9IGR0LmFvQ29sdW1uc1tpXS5zVGl0bGUucmVwbGFjZSgvXG4vZywiICIpLnJlcGxhY2UoIC88Lio\/Pi9nLCAiIiApLnJlcGxhY2UoL15ccyt8XHMrJC9nLCIiKTsKCQkJCQlzTG9vcERhdGEgPSB0aGlzLl9mbkh0bWxEZWNvZGUoIHNMb29wRGF0YSApOwoKCQkJCQlhUm93LnB1c2goIHRoaXMuX2ZuQm91bmREYXRhKCBzTG9vcERhdGEsIG9Db25maWcuc0ZpZWxkQm91bmRhcnksIHJlZ2V4ICkgKTsKCQkJCX0KCQkJfQoKCQkJYURhdGEucHVzaCggYVJvdy5qb2luKG9Db25maWcuc0ZpZWxkU2VwZXJhdG9yKSApOwoJCX0KCgkJLyoKCQkgKiBCb2R5CgkJICovCgkJdmFyIGFTZWxlY3RlZCA9IHRoaXMuZm5HZXRTZWxlY3RlZCgpOwoJCWJTZWxlY3RlZE9ubHkgPSB0aGlzLnMuc2VsZWN0LnR5cGUgIT09ICJub25lIiAmJiBiU2VsZWN0ZWRPbmx5ICYmIGFTZWxlY3RlZC5sZW5ndGggIT09IDA7CgoJCXZhciBhcGkgPSAkLmZuLmRhdGFUYWJsZS5BcGk7CgkJdmFyIGFEYXRhSW5kZXggPSBhcGkgPwoJCQluZXcgYXBpKCBkdCApLnJvd3MoIG9Db25maWcub1NlbGVjdG9yT3B0cyApLmluZGV4ZXMoKS5mbGF0dGVuKCkudG9BcnJheSgpIDoKCQkJZHQub0luc3RhbmNlCgkJCQkuJCgndHInLCBvQ29uZmlnLm9TZWxlY3Rvck9wdHMpCgkJCQkubWFwKCBmdW5jdGlvbiAoaWQsIHJvdykgewoJCQkJCS8vIElmICJzZWxlY3RlZCBvbmx5IiwgdGhlbiBlbnN1cmUgdGhhdCB0aGUgcm93IGlzIGluIHRoZSBzZWxlY3RlZCBsaXN0CgkJCQkJcmV0dXJuIGJTZWxlY3RlZE9ubHkgJiYgJC5pbkFycmF5KCByb3csIGFTZWxlY3RlZCApID09PSAtMSA\/CgkJCQkJCW51bGwgOgoJCQkJCQlkdC5vSW5zdGFuY2UuZm5HZXRQb3NpdGlvbiggcm93ICk7CgkJCQl9ICkKCQkJCS5nZXQoKTsKCgkJZm9yICggaj0wLCBqTGVuPWFEYXRhSW5kZXgubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQl7CgkJCXRyID0gZHQuYW9EYXRhWyBhRGF0YUluZGV4W2pdIF0ublRyOwoJCQlhUm93ID0gW107CgoJCQkvKiBDb2x1bW5zICovCgkJCWZvciAoIGk9MCwgaUxlbj1kdC5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhQ29sdW1uc0luY1tpXSApCgkJCQl7CgkJCQkJLyogQ29udmVydCB0byBzdHJpbmdzICh3aXRoIHNtYWxsIG9wdGltaXNhdGlvbikgKi8KCQkJCQl2YXIgbVR5cGVEYXRhID0gZHQub0FwaS5fZm5HZXRDZWxsRGF0YSggZHQsIGFEYXRhSW5kZXhbal0sIGksICdkaXNwbGF5JyApOwoJCQkJCWlmICggb0NvbmZpZy5mbkNlbGxSZW5kZXIgKQoJCQkJCXsKCQkJCQkJc0xvb3BEYXRhID0gb0NvbmZpZy5mbkNlbGxSZW5kZXIoIG1UeXBlRGF0YSwgaSwgdHIsIGFEYXRhSW5kZXhbal0gKSsiIjsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIHR5cGVvZiBtVHlwZURhdGEgPT0gInN0cmluZyIgKQoJCQkJCXsKCQkJCQkJLyogU3RyaXAgbmV3bGluZXMsIHJlcGxhY2UgaW1nIHRhZ3Mgd2l0aCBhbHQgYXR0ci4gYW5kIGZpbmFsbHkgc3RyaXAgaHRtbC4uLiAqLwoJCQkJCQlzTG9vcERhdGEgPSBtVHlwZURhdGEucmVwbGFjZSgvXG4vZywiICIpOwoJCQkJCQlzTG9vcERhdGEgPQoJCQkJCQkgICAgc0xvb3BEYXRhLnJlcGxhY2UoLzxpbWcuKj9ccythbHRccyo9XHMqKD86IihbXiJdKykifCcoW14nXSspJ3woW15ccz5dKykpLio\/Pi9naSwKCQkJCQkJICAgICAgICAnJDEkMiQzJyk7CgkJCQkJCXNMb29wRGF0YSA9IHNMb29wRGF0YS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJc0xvb3BEYXRhID0gbVR5cGVEYXRhKyIiOwoJCQkJCX0KCgkJCQkJLyogVHJpbSBhbmQgY2xlYW4gdGhlIGRhdGEgKi8KCQkJCQlzTG9vcERhdGEgPSBzTG9vcERhdGEucmVwbGFjZSgvXlxzKy8sICcnKS5yZXBsYWNlKC9ccyskLywgJycpOwoJCQkJCXNMb29wRGF0YSA9IHRoaXMuX2ZuSHRtbERlY29kZSggc0xvb3BEYXRhICk7CgoJCQkJCS8qIEJvdW5kIGl0IGFuZCBhZGQgaXQgdG8gdGhlIHRvdGFsIGRhdGEgKi8KCQkJCQlhUm93LnB1c2goIHRoaXMuX2ZuQm91bmREYXRhKCBzTG9vcERhdGEsIG9Db25maWcuc0ZpZWxkQm91bmRhcnksIHJlZ2V4ICkgKTsKCQkJCX0KCQkJfQoKCQkJYURhdGEucHVzaCggYVJvdy5qb2luKG9Db25maWcuc0ZpZWxkU2VwZXJhdG9yKSApOwoKCQkJLyogRGV0YWlscyByb3dzIGZyb20gZm5PcGVuICovCgkJCWlmICggb0NvbmZpZy5iT3BlblJvd3MgKQoJCQl7CgkJCQlhcnIgPSAkLmdyZXAoZHQuYW9PcGVuUm93cywgZnVuY3Rpb24obykgeyByZXR1cm4gby5uUGFyZW50ID09PSB0cjsgfSk7CgoJCQkJaWYgKCBhcnIubGVuZ3RoID09PSAxICkKCQkJCXsKCQkJCQlzTG9vcERhdGEgPSB0aGlzLl9mbkJvdW5kRGF0YSggJCgndGQnLCBhcnJbMF0ublRyKS5odG1sKCksIG9Db25maWcuc0ZpZWxkQm91bmRhcnksIHJlZ2V4ICk7CgkJCQkJYURhdGEucHVzaCggc0xvb3BEYXRhICk7CgkJCQl9CgkJCX0KCQl9CgoJCS8qCgkJICogRm9vdGVyCgkJICovCgkJaWYgKCBvQ29uZmlnLmJGb290ZXIgJiYgZHQublRGb290ICE9PSBudWxsICkKCQl7CgkJCWFSb3cgPSBbXTsKCgkJCWZvciAoIGk9MCwgaUxlbj1kdC5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhQ29sdW1uc0luY1tpXSAmJiBkdC5hb0NvbHVtbnNbaV0ublRmICE9PSBudWxsICkKCQkJCXsKCQkJCQlzTG9vcERhdGEgPSBkdC5hb0NvbHVtbnNbaV0ublRmLmlubmVySFRNTC5yZXBsYWNlKC9cbi9nLCIgIikucmVwbGFjZSggLzwuKj8+L2csICIiICk7CgkJCQkJc0xvb3BEYXRhID0gdGhpcy5fZm5IdG1sRGVjb2RlKCBzTG9vcERhdGEgKTsKCgkJCQkJYVJvdy5wdXNoKCB0aGlzLl9mbkJvdW5kRGF0YSggc0xvb3BEYXRhLCBvQ29uZmlnLnNGaWVsZEJvdW5kYXJ5LCByZWdleCApICk7CgkJCQl9CgkJCX0KCgkJCWFEYXRhLnB1c2goIGFSb3cuam9pbihvQ29uZmlnLnNGaWVsZFNlcGVyYXRvcikgKTsKCQl9CgoJCXZhciBfc0xhc3REYXRhID0gYURhdGEuam9pbiggdGhpcy5fZm5OZXdsaW5lKG9Db25maWcpICk7CgkJcmV0dXJuIF9zTGFzdERhdGE7Cgl9LAoKCgkvKioKCSAqIFdyYXAgZGF0YSB1cCB3aXRoIGEgYm91bmRhcnkgc3RyaW5nCgkgKiAgQG1ldGhvZCAgX2ZuQm91bmREYXRhCgkgKiAgQHBhcmFtICAge1N0cmluZ30gc0RhdGEgZGF0YSB0byBib3VuZAoJICogIEBwYXJhbSAgIHtTdHJpbmd9IHNCb3VuZGFyeSBib3VuZGluZyBjaGFyKHMpCgkgKiAgQHBhcmFtICAge1JlZ0V4cH0gcmVnZXggc2VhcmNoIGZvciB0aGUgYm91bmRpbmcgY2hhcnMgLSBjb25zdHJ1Y3RlZCBvdXRzaWRlIGZvciBlZmZpY2llbmN5CgkgKgkJCSBpbiB0aGUgbG9vcAoJICogIEByZXR1cm5zIHtTdHJpbmd9IGJvdW5kIGRhdGEKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mbkJvdW5kRGF0YSI6IGZ1bmN0aW9uICggc0RhdGEsIHNCb3VuZGFyeSwgcmVnZXggKQoJewoJCWlmICggc0JvdW5kYXJ5ID09PSAiIiApCgkJewoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCWVsc2UKCQl7CgkJCXJldHVybiBzQm91bmRhcnkgKyBzRGF0YS5yZXBsYWNlKHJlZ2V4LCBzQm91bmRhcnkrc0JvdW5kYXJ5KSArIHNCb3VuZGFyeTsKCQl9Cgl9LAoKCgkvKioKCSAqIEJyZWFrIGEgc3RyaW5nIHVwIGludG8gYW4gYXJyYXkgb2Ygc21hbGxlciBzdHJpbmdzCgkgKiAgQG1ldGhvZCAgX2ZuQ2h1bmtEYXRhCgkgKiAgQHBhcmFtICAge1N0cmluZ30gc0RhdGEgZGF0YSB0byBiZSBicm9rZW4gdXAKCSAqICBAcGFyYW0gICB7SW50fSBpU2l6ZSBjaHVuayBzaXplCgkgKiAgQHJldHVybnMge0FycmF5fSBTdHJpbmcgYXJyYXkgb2YgYnJva2VuIHVwIHRleHQKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mbkNodW5rRGF0YSI6IGZ1bmN0aW9uICggc0RhdGEsIGlTaXplICkKCXsKCQl2YXIgYXNSZXR1cm4gPSBbXTsKCQl2YXIgaVN0cmxlbiA9IHNEYXRhLmxlbmd0aDsKCgkJZm9yICggdmFyIGk9MCA7IGk8aVN0cmxlbiA7IGkrPWlTaXplICkKCQl7CgkJCWlmICggaStpU2l6ZSA8IGlTdHJsZW4gKQoJCQl7CgkJCQlhc1JldHVybi5wdXNoKCBzRGF0YS5zdWJzdHJpbmcoIGksIGkraVNpemUgKSApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJYXNSZXR1cm4ucHVzaCggc0RhdGEuc3Vic3RyaW5nKCBpLCBpU3RybGVuICkgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIGFzUmV0dXJuOwoJfSwKCgoJLyoqCgkgKiBEZWNvZGUgSFRNTCBlbnRpdGllcwoJICogIEBtZXRob2QgIF9mbkh0bWxEZWNvZGUKCSAqICBAcGFyYW0gICB7U3RyaW5nfSBzRGF0YSBlbmNvZGVkIHN0cmluZwoJICogIEByZXR1cm5zIHtTdHJpbmd9IGRlY29kZWQgc3RyaW5nCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5IdG1sRGVjb2RlIjogZnVuY3Rpb24gKCBzRGF0YSApCgl7CgkJaWYgKCBzRGF0YS5pbmRleE9mKCcmJykgPT09IC0xICkKCQl7CgkJCXJldHVybiBzRGF0YTsKCQl9CgoJCXZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgoJCXJldHVybiBzRGF0YS5yZXBsYWNlKCAvJihbXlxzXSo\/KTsvZywgZnVuY3Rpb24oIG1hdGNoLCBtYXRjaDIgKSB7CgkJCWlmICggbWF0Y2guc3Vic3RyKDEsIDEpID09PSAnIycgKQoJCQl7CgkJCQlyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSggTnVtYmVyKG1hdGNoMi5zdWJzdHIoMSkpICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQluLmlubmVySFRNTCA9IG1hdGNoOwoJCQkJcmV0dXJuIG4uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWU7CgkJCX0KCQl9ICk7Cgl9LAoKCgoJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKgoJICogUHJpbnRpbmcgZnVuY3Rpb25zCgkgKi8KCgkvKioKCSAqIFNob3cgcHJpbnQgZGlzcGxheQoJICogIEBtZXRob2QgIF9mblByaW50U3RhcnQKCSAqICBAcGFyYW0gICB7RXZlbnR9IGUgRXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtICAge09iamVjdH0gb0NvbmZpZyBCdXR0b24gY29uZmlndXJhdGlvbiBvYmplY3QKCSAqICBAcmV0dXJucyB2b2lkCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5QcmludFN0YXJ0IjogZnVuY3Rpb24gKCBvQ29uZmlnICkKCXsKCSAgdmFyIHRoYXQgPSB0aGlzOwoJICB2YXIgb1NldERUID0gdGhpcy5zLmR0OwoKCQkvKiBQYXJzZSB0aHJvdWdoIHRoZSBET00gaGlkaW5nIGV2ZXJ5dGhpbmcgdGhhdCBpc24ndCBuZWVkZWQgZm9yIHRoZSB0YWJsZSAqLwoJCXRoaXMuX2ZuUHJpbnRIaWRlTm9kZXMoIG9TZXREVC5uVGFibGUgKTsKCgkJLyogU2hvdyB0aGUgd2hvbGUgdGFibGUgKi8KCQl0aGlzLnMucHJpbnQuc2F2ZVN0YXJ0ID0gb1NldERULl9pRGlzcGxheVN0YXJ0OwoJCXRoaXMucy5wcmludC5zYXZlTGVuZ3RoID0gb1NldERULl9pRGlzcGxheUxlbmd0aDsKCgkJaWYgKCBvQ29uZmlnLmJTaG93QWxsICkKCQl7CgkJCW9TZXREVC5faURpc3BsYXlTdGFydCA9IDA7CgkJCW9TZXREVC5faURpc3BsYXlMZW5ndGggPSAtMTsKCQkJaWYgKCBvU2V0RFQub0FwaS5fZm5DYWxjdWxhdGVFbmQgKSB7CgkJCQlvU2V0RFQub0FwaS5fZm5DYWxjdWxhdGVFbmQoIG9TZXREVCApOwoJCQl9CgkJCW9TZXREVC5vQXBpLl9mbkRyYXcoIG9TZXREVCApOwoJCX0KCgkJLyogQWRqdXN0IHRoZSBkaXNwbGF5IGZvciBzY3JvbGxpbmcgd2hpY2ggbWlnaHQgYmUgZG9uZSBieSBEYXRhVGFibGVzICovCgkJaWYgKCBvU2V0RFQub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldERULm9TY3JvbGwuc1kgIT09ICIiICkKCQl7CgkJCXRoaXMuX2ZuUHJpbnRTY3JvbGxTdGFydCggb1NldERUICk7CgoJCQkvLyBJZiB0aGUgdGFibGUgcmVkcmF3cyB3aGlsZSBpbiBwcmludCB2aWV3LCB0aGUgRGF0YVRhYmxlcyBzY3JvbGxpbmcKCQkJLy8gc2V0dXAgd291bGQgaGlkZSB0aGUgaGVhZGVyLCBzbyB3ZSBuZWVkIHRvIHJlYWRkIGl0IG9uIGRyYXcKCQkJJCh0aGlzLnMuZHQublRhYmxlKS5iaW5kKCdkcmF3LkRUVFRfUHJpbnQnLCBmdW5jdGlvbiAoKSB7CgkJCQl0aGF0Ll9mblByaW50U2Nyb2xsU3RhcnQoIG9TZXREVCApOwoJCQl9ICk7CgkJfQoKCQkvKiBSZW1vdmUgdGhlIG90aGVyIERhdGFUYWJsZXMgZmVhdHVyZSBub2RlcyAtIGJ1dCBsZWF2ZSB0aGUgdGFibGUhIGFuZCBpbmZvIGRpdiAqLwoJCXZhciBhbkZlYXR1cmUgPSBvU2V0RFQuYWFuRmVhdHVyZXM7CgkJZm9yICggdmFyIGNGZWF0dXJlIGluIGFuRmVhdHVyZSApCgkJewoJCQlpZiAoIGNGZWF0dXJlICE9ICdpJyAmJiBjRmVhdHVyZSAhPSAndCcgJiYgY0ZlYXR1cmUubGVuZ3RoID09IDEgKQoJCQl7CgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFuRmVhdHVyZVtjRmVhdHVyZV0ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmRvbS5wcmludC5oaWRkZW4ucHVzaCggewoJCQkJCQkibm9kZSI6IGFuRmVhdHVyZVtjRmVhdHVyZV1baV0sCgkJCQkJCSJkaXNwbGF5IjogImJsb2NrIgoJCQkJCX0gKTsKCQkJCQlhbkZlYXR1cmVbY0ZlYXR1cmVdW2ldLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgkJCQl9CgkJCX0KCQl9CgoJCS8qIFByaW50IGNsYXNzIGNhbiBiZSB1c2VkIGZvciBzdHlsaW5nICovCgkJJChkb2N1bWVudC5ib2R5KS5hZGRDbGFzcyggdGhpcy5jbGFzc2VzLnByaW50LmJvZHkgKTsKCgkJLyogU2hvdyBpbmZvcm1hdGlvbiBtZXNzYWdlIHRvIGxldCB0aGUgdXNlciBrbm93IHdoYXQgaXMgaGFwcGVuaW5nICovCgkJaWYgKCBvQ29uZmlnLnNJbmZvICE9PSAiIiApCgkJewoJCQl0aGlzLmZuSW5mbyggb0NvbmZpZy5zSW5mbywgMzAwMCApOwoJCX0KCgkJLyogQWRkIGEgbWVzc2FnZSBhdCB0aGUgdG9wIG9mIHRoZSBwYWdlICovCgkJaWYgKCBvQ29uZmlnLnNNZXNzYWdlICkKCQl7CgkJCSQoJzxkaXYvPicpCgkJCQkuYWRkQ2xhc3MoIHRoaXMuY2xhc3Nlcy5wcmludC5tZXNzYWdlICkKCQkJCS5odG1sKCBvQ29uZmlnLnNNZXNzYWdlICkKCQkJCS5wcmVwZW5kVG8oICdib2R5JyApOwoJCX0KCgkJLyogQ2FjaGUgdGhlIHNjcm9sbGluZyBhbmQgdGhlIGp1bXAgdG8gdGhlIHRvcCBvZiB0aGUgcGFnZSAqLwoJCXRoaXMucy5wcmludC5zYXZlU2Nyb2xsID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpOwoJCXdpbmRvdy5zY3JvbGxUbyggMCwgMCApOwoKCQkvKiBCaW5kIGEga2V5IGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBkb2N1bWVudCBmb3IgdGhlIGVzY2FwZSBrZXkgLQoJCSAqIGl0IGlzIHJlbW92ZWQgaW4gdGhlIGNhbGxiYWNrCgkJICovCgkJJChkb2N1bWVudCkuYmluZCggImtleWRvd24uRFRUVCIsIGZ1bmN0aW9uKGUpIHsKCQkJLyogT25seSBpbnRlcmVzdGVkIGluIHRoZSBlc2NhcGUga2V5ICovCgkJCWlmICggZS5rZXlDb2RlID09IDI3ICkKCQkJewoJCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJdGhhdC5fZm5QcmludEVuZC5jYWxsKCB0aGF0LCBlICk7CgkJCX0KCQl9ICk7Cgl9LAoKCgkvKioKCSAqIFByaW50aW5nIGlzIGZpbmlzaGVkLCByZXN1bWUgbm9ybWFsIGRpc3BsYXkKCSAqICBAbWV0aG9kICBfZm5QcmludEVuZAoJICogIEBwYXJhbSAgIHtFdmVudH0gZSBFdmVudCBvYmplY3QKCSAqICBAcmV0dXJucyB2b2lkCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5QcmludEVuZCI6IGZ1bmN0aW9uICggZSApCgl7CgkJdmFyIHRoYXQgPSB0aGlzOwoJCXZhciBvU2V0RFQgPSB0aGlzLnMuZHQ7CgkJdmFyIG9TZXRQcmludCA9IHRoaXMucy5wcmludDsKCQl2YXIgb0RvbVByaW50ID0gdGhpcy5kb20ucHJpbnQ7CgoJCS8qIFNob3cgYWxsIGhpZGRlbiBub2RlcyAqLwoJCXRoaXMuX2ZuUHJpbnRTaG93Tm9kZXMoKTsKCgkJLyogUmVzdG9yZSBEYXRhVGFibGVzJyBzY3JvbGxpbmcgKi8KCQlpZiAoIG9TZXREVC5vU2Nyb2xsLnNYICE9PSAiIiB8fCBvU2V0RFQub1Njcm9sbC5zWSAhPT0gIiIgKQoJCXsKCQkJJCh0aGlzLnMuZHQublRhYmxlKS51bmJpbmQoJ2RyYXcuRFRUVF9QcmludCcpOwoKCQkJdGhpcy5fZm5QcmludFNjcm9sbEVuZCgpOwoJCX0KCgkJLyogUmVzdG9yZSB0aGUgc2Nyb2xsICovCgkJd2luZG93LnNjcm9sbFRvKCAwLCBvU2V0UHJpbnQuc2F2ZVNjcm9sbCApOwoKCQkvKiBEcm9wIHRoZSBwcmludCBtZXNzYWdlICovCgkJJCgnZGl2LicrdGhpcy5jbGFzc2VzLnByaW50Lm1lc3NhZ2UpLnJlbW92ZSgpOwoKCQkvKiBTdHlsaW5nIGNsYXNzICovCgkJJChkb2N1bWVudC5ib2R5KS5yZW1vdmVDbGFzcyggJ0RUVFRfUHJpbnQnICk7CgoJCS8qIFJlc3RvcmUgdGhlIHRhYmxlIGxlbmd0aCAqLwoJCW9TZXREVC5faURpc3BsYXlTdGFydCA9IG9TZXRQcmludC5zYXZlU3RhcnQ7CgkJb1NldERULl9pRGlzcGxheUxlbmd0aCA9IG9TZXRQcmludC5zYXZlTGVuZ3RoOwoJCWlmICggb1NldERULm9BcGkuX2ZuQ2FsY3VsYXRlRW5kICkgewoJCQlvU2V0RFQub0FwaS5fZm5DYWxjdWxhdGVFbmQoIG9TZXREVCApOwoJCX0KCQlvU2V0RFQub0FwaS5fZm5EcmF3KCBvU2V0RFQgKTsKCgkJJChkb2N1bWVudCkudW5iaW5kKCAia2V5ZG93bi5EVFRUIiApOwoJfSwKCgoJLyoqCgkgKiBUYWtlIGFjY291bnQgb2Ygc2Nyb2xsaW5nIGluIERhdGFUYWJsZXMgYnkgc2hvd2luZyB0aGUgZnVsbCB0YWJsZQoJICogIEByZXR1cm5zIHZvaWQKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mblByaW50U2Nyb2xsU3RhcnQiOiBmdW5jdGlvbiAoKQoJewoJCXZhcgoJCQlvU2V0RFQgPSB0aGlzLnMuZHQsCgkJCW5TY3JvbGxIZWFkSW5uZXIgPSBvU2V0RFQublNjcm9sbEhlYWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2RpdicpWzBdLAoJCQluU2Nyb2xsSGVhZFRhYmxlID0gblNjcm9sbEhlYWRJbm5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGFibGUnKVswXSwKCQkJblNjcm9sbEJvZHkgPSBvU2V0RFQublRhYmxlLnBhcmVudE5vZGUsCgkJCW5UaGVhZFNpemUsIG5UZm9vdFNpemU7CgoJCS8qIENvcHkgdGhlIGhlYWRlciBpbiB0aGUgdGhlYWQgaW4gdGhlIGJvZHkgdGFibGUsIHRoaXMgd2F5IHdlIHNob3cgb25lIHNpbmdsZSB0YWJsZSB3aGVuCgkJICogaW4gcHJpbnQgdmlldy4gTm90ZSB0aGF0IHRoaXMgc2VjdGlvbiBvZiBjb2RlIGlzIG1vcmUgb3IgbGVzcyB2ZXJiYXRpbSBmcm9tIERUIDEuNy4wCgkJICovCgkJblRoZWFkU2l6ZSA9IG9TZXREVC5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoZWFkJyk7CgkJaWYgKCBuVGhlYWRTaXplLmxlbmd0aCA+IDAgKQoJCXsKCQkJb1NldERULm5UYWJsZS5yZW1vdmVDaGlsZCggblRoZWFkU2l6ZVswXSApOwoJCX0KCgkJaWYgKCBvU2V0RFQublRGb290ICE9PSBudWxsICkKCQl7CgkJCW5UZm9vdFNpemUgPSBvU2V0RFQublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0Zm9vdCcpOwoJCQlpZiAoIG5UZm9vdFNpemUubGVuZ3RoID4gMCApCgkJCXsKCQkJCW9TZXREVC5uVGFibGUucmVtb3ZlQ2hpbGQoIG5UZm9vdFNpemVbMF0gKTsKCQkJfQoJCX0KCgkJblRoZWFkU2l6ZSA9IG9TZXREVC5uVEhlYWQuY2xvbmVOb2RlKHRydWUpOwoJCW9TZXREVC5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGhlYWRTaXplLCBvU2V0RFQublRhYmxlLmNoaWxkTm9kZXNbMF0gKTsKCgkJaWYgKCBvU2V0RFQublRGb290ICE9PSBudWxsICkKCQl7CgkJCW5UZm9vdFNpemUgPSBvU2V0RFQublRGb290LmNsb25lTm9kZSh0cnVlKTsKCQkJb1NldERULm5UYWJsZS5pbnNlcnRCZWZvcmUoIG5UZm9vdFNpemUsIG9TZXREVC5uVGFibGUuY2hpbGROb2Rlc1sxXSApOwoJCX0KCgkJLyogTm93IGFkanVzdCB0aGUgdGFibGUncyB2aWV3cG9ydCBzbyB3ZSBjYW4gYWN0dWFsbHkgc2VlIGl0ICovCgkJaWYgKCBvU2V0RFQub1Njcm9sbC5zWCAhPT0gIiIgKQoJCXsKCQkJb1NldERULm5UYWJsZS5zdHlsZS53aWR0aCA9ICQob1NldERULm5UYWJsZSkub3V0ZXJXaWR0aCgpKyJweCI7CgkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gJChvU2V0RFQublRhYmxlKS5vdXRlcldpZHRoKCkrInB4IjsKCQkJblNjcm9sbEJvZHkuc3R5bGUub3ZlcmZsb3cgPSAidmlzaWJsZSI7CgkJfQoKCQlpZiAoIG9TZXREVC5vU2Nyb2xsLnNZICE9PSAiIiApCgkJewoJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSAkKG9TZXREVC5uVGFibGUpLm91dGVySGVpZ2h0KCkrInB4IjsKCQkJblNjcm9sbEJvZHkuc3R5bGUub3ZlcmZsb3cgPSAidmlzaWJsZSI7CgkJfQoJfSwKCgoJLyoqCgkgKiBUYWtlIGFjY291bnQgb2Ygc2Nyb2xsaW5nIGluIERhdGFUYWJsZXMgYnkgc2hvd2luZyB0aGUgZnVsbCB0YWJsZS4gTm90ZSB0aGF0IHRoZSByZWRyYXcgb2YKCSAqIHRoZSBEYXRhVGFibGUgdGhhdCB3ZSBkbyB3aWxsIGFjdHVhbGx5IGRlYWwgd2l0aCB0aGUgbWFqb3JpdHkgb2YgdGhlIGhhcmQgd29yayBoZXJlCgkgKiAgQHJldHVybnMgdm9pZAoJICogIEBwcml2YXRlIAoJICovCgkiX2ZuUHJpbnRTY3JvbGxFbmQiOiBmdW5jdGlvbiAoKQoJewoJCXZhcgoJCQlvU2V0RFQgPSB0aGlzLnMuZHQsCgkJCW5TY3JvbGxCb2R5ID0gb1NldERULm5UYWJsZS5wYXJlbnROb2RlOwoKCQlpZiAoIG9TZXREVC5vU2Nyb2xsLnNYICE9PSAiIiApCgkJewoJCQluU2Nyb2xsQm9keS5zdHlsZS53aWR0aCA9IG9TZXREVC5vQXBpLl9mblN0cmluZ1RvQ3NzKCBvU2V0RFQub1Njcm9sbC5zWCApOwoJCQluU2Nyb2xsQm9keS5zdHlsZS5vdmVyZmxvdyA9ICJhdXRvIjsKCQl9CgoJCWlmICggb1NldERULm9TY3JvbGwuc1kgIT09ICIiICkKCQl7CgkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IG9TZXREVC5vQXBpLl9mblN0cmluZ1RvQ3NzKCBvU2V0RFQub1Njcm9sbC5zWSApOwoJCQluU2Nyb2xsQm9keS5zdHlsZS5vdmVyZmxvdyA9ICJhdXRvIjsKCQl9Cgl9LAoKCgkvKioKCSAqIFJlc3VtZSB0aGUgZGlzcGxheSBvZiBhbGwgVGFibGVUb29scyBoaWRkZW4gbm9kZXMKCSAqICBAbWV0aG9kICBfZm5QcmludFNob3dOb2RlcwoJICogIEByZXR1cm5zIHZvaWQKCSAqICBAcHJpdmF0ZSAKCSAqLwoJIl9mblByaW50U2hvd05vZGVzIjogZnVuY3Rpb24gKCApCgl7CgkgIHZhciBhbkhpZGRlbiA9IHRoaXMuZG9tLnByaW50LmhpZGRlbjsKCgkJZm9yICggdmFyIGk9MCwgaUxlbj1hbkhpZGRlbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCXsKCQkJYW5IaWRkZW5baV0ubm9kZS5zdHlsZS5kaXNwbGF5ID0gYW5IaWRkZW5baV0uZGlzcGxheTsKCQl9CgkJYW5IaWRkZW4uc3BsaWNlKCAwLCBhbkhpZGRlbi5sZW5ndGggKTsKCX0sCgoKCS8qKgoJICogSGlkZSBub2RlcyB3aGljaCBhcmUgbm90IG5lZWRlZCBpbiBvcmRlciB0byBkaXNwbGF5IHRoZSB0YWJsZS4gTm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMKCSAqIHJlY3Vyc2l2ZQoJICogIEBtZXRob2QgIF9mblByaW50SGlkZU5vZGVzCgkgKiAgQHBhcmFtICAge05vZGV9IG5Ob2RlIEVsZW1lbnQgd2hpY2ggc2hvdWxkIGJlIHNob3dpbmcgaW4gYSAncHJpbnQnIGRpc3BsYXkKCSAqICBAcmV0dXJucyB2b2lkCgkgKiAgQHByaXZhdGUgCgkgKi8KCSJfZm5QcmludEhpZGVOb2RlcyI6IGZ1bmN0aW9uICggbk5vZGUgKQoJewoJCXZhciBhbkhpZGRlbiA9IHRoaXMuZG9tLnByaW50LmhpZGRlbjsKCgkJdmFyIG5QYXJlbnQgPSBuTm9kZS5wYXJlbnROb2RlOwoJCXZhciBuQ2hpbGRyZW4gPSBuUGFyZW50LmNoaWxkTm9kZXM7CgkJZm9yICggdmFyIGk9MCwgaUxlbj1uQ2hpbGRyZW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQl7CgkJCWlmICggbkNoaWxkcmVuW2ldICE9IG5Ob2RlICYmIG5DaGlsZHJlbltpXS5ub2RlVHlwZSA9PSAxICkKCQkJewoJCQkJLyogSWYgb3VyIG5vZGUgaXMgc2hvd24gKGRvbid0IHdhbnQgdG8gc2hvdyBub2RlcyB3aGljaCB3ZXJlIHByZXZpb3VzbHkgaGlkZGVuKSAqLwoJCQkJdmFyIHNEaXNwbGF5ID0gJChuQ2hpbGRyZW5baV0pLmNzcygiZGlzcGxheSIpOwoJCQkJaWYgKCBzRGlzcGxheSAhPSAibm9uZSIgKQoJCQkJewoJCQkJCS8qIENhY2hlIHRoZSBub2RlIGFuZCBpdCdzIHByZXZpb3VzIHN0YXRlIHNvIHdlIGNhbiByZXN0b3JlIGl0ICovCgkJCQkJYW5IaWRkZW4ucHVzaCggewoJCQkJCQkibm9kZSI6IG5DaGlsZHJlbltpXSwKCQkJCQkJImRpc3BsYXkiOiBzRGlzcGxheQoJCQkJCX0gKTsKCQkJCQluQ2hpbGRyZW5baV0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKCQkJCX0KCQkJfQoJCX0KCgkJaWYgKCBuUGFyZW50Lm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgIT0gIkJPRFkiICkKCQl7CgkJCXRoaXMuX2ZuUHJpbnRIaWRlTm9kZXMoIG5QYXJlbnQgKTsKCQl9Cgl9Cn07CgoKCi8qICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKgogKiBTdGF0aWMgdmFyaWFibGVzCiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKi8KCi8qKgogKiBTdG9yZSBvZiBhbGwgaW5zdGFuY2VzIHRoYXQgaGF2ZSBiZWVuIGNyZWF0ZWQgb2YgVGFibGVUb29scywgc28gb25lIGNhbiBsb29rIHVwIG90aGVyICh3aGVuCiAqIHRoZXJlIGlzIG5lZWQgb2YgYSBtYXN0ZXIpCiAqICBAcHJvcGVydHkgX2FJbnN0YW5jZXMKICogIEB0eXBlCSBBcnJheQogKiAgQGRlZmF1bHQgIFtdCiAqICBAcHJpdmF0ZQogKi8KVGFibGVUb29scy5fYUluc3RhbmNlcyA9IFtdOwoKCi8qKgogKiBTdG9yZSBvZiBhbGwgbGlzdGVuZXJzIGFuZCB0aGVpciBjYWxsYmFjayBmdW5jdGlvbnMKICogIEBwcm9wZXJ0eSBfYUxpc3RlbmVycwogKiAgQHR5cGUJIEFycmF5CiAqICBAZGVmYXVsdCAgW10KICovClRhYmxlVG9vbHMuX2FMaXN0ZW5lcnMgPSBbXTsKCgoKLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqCiAqIFN0YXRpYyBtZXRob2RzCiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKi8KCi8qKgogKiBHZXQgYW4gYXJyYXkgb2YgYWxsIHRoZSBtYXN0ZXIgaW5zdGFuY2VzCiAqICBAbWV0aG9kICBmbkdldE1hc3RlcnMKICogIEByZXR1cm5zIHtBcnJheX0gTGlzdCBvZiBtYXN0ZXIgVGFibGVUb29scyBpbnN0YW5jZXMKICogIEBzdGF0aWMKICovClRhYmxlVG9vbHMuZm5HZXRNYXN0ZXJzID0gZnVuY3Rpb24gKCkKewoJdmFyIGEgPSBbXTsKCWZvciAoIHZhciBpPTAsIGlMZW49VGFibGVUb29scy5fYUluc3RhbmNlcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJewoJCWlmICggVGFibGVUb29scy5fYUluc3RhbmNlc1tpXS5zLm1hc3RlciApCgkJewoJCQlhLnB1c2goIFRhYmxlVG9vbHMuX2FJbnN0YW5jZXNbaV0gKTsKCQl9Cgl9CglyZXR1cm4gYTsKfTsKCi8qKgogKiBHZXQgdGhlIG1hc3RlciBpbnN0YW5jZSBmb3IgYSB0YWJsZSBub2RlIChvciBpZCBpZiBhIHN0cmluZyBpcyBnaXZlbikKICogIEBtZXRob2QgIGZuR2V0SW5zdGFuY2UKICogIEByZXR1cm5zIHtPYmplY3R9IElEIG9mIHRhYmxlIE9SIHRhYmxlIG5vZGUsIGZvciB3aGljaCB3ZSB3YW50IHRoZSBUYWJsZVRvb2xzIGluc3RhbmNlCiAqICBAc3RhdGljCiAqLwpUYWJsZVRvb2xzLmZuR2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoIG5vZGUgKQp7CglpZiAoIHR5cGVvZiBub2RlICE9ICdvYmplY3QnICkKCXsKCQlub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobm9kZSk7Cgl9CgoJZm9yICggdmFyIGk9MCwgaUxlbj1UYWJsZVRvb2xzLl9hSW5zdGFuY2VzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgl7CgkJaWYgKCBUYWJsZVRvb2xzLl9hSW5zdGFuY2VzW2ldLnMubWFzdGVyICYmIFRhYmxlVG9vbHMuX2FJbnN0YW5jZXNbaV0uZG9tLnRhYmxlID09IG5vZGUgKQoJCXsKCQkJcmV0dXJuIFRhYmxlVG9vbHMuX2FJbnN0YW5jZXNbaV07CgkJfQoJfQoJcmV0dXJuIG51bGw7Cn07CgoKLyoqCiAqIEFkZCBhIGxpc3RlbmVyIGZvciBhIHNwZWNpZmljIGV2ZW50CiAqICBAbWV0aG9kICBfZm5FdmVudExpc3RlbgogKiAgQHBhcmFtICAge09iamVjdH0gdGhhdCBTY29wZSBvZiB0aGUgbGlzdGVuaW5nIGZ1bmN0aW9uIChpLmUuICd0aGlzJyBpbiB0aGUgY2FsbGVyKQogKiAgQHBhcmFtICAge1N0cmluZ30gdHlwZSBFdmVudCB0eXBlCiAqICBAcGFyYW0gICB7RnVuY3Rpb259IGZuIEZ1bmN0aW9uCiAqICBAcmV0dXJucyB2b2lkCiAqICBAcHJpdmF0ZQogKiAgQHN0YXRpYwogKi8KVGFibGVUb29scy5fZm5FdmVudExpc3RlbiA9IGZ1bmN0aW9uICggdGhhdCwgdHlwZSwgZm4gKQp7CglUYWJsZVRvb2xzLl9hTGlzdGVuZXJzLnB1c2goIHsKCQkidGhhdCI6IHRoYXQsCgkJInR5cGUiOiB0eXBlLAoJCSJmbiI6IGZuCgl9ICk7Cn07CgoKLyoqCiAqIEFuIGV2ZW50IGhhcyBvY2N1cnJlZCAtIGxvb2sgdXAgZXZlcnkgbGlzdGVuZXIgYW5kIGZpcmUgaXQgb2ZmLiBXZSBjaGVjayB0aGF0IHRoZSBldmVudCB3ZSBhcmUKICogZ29pbmcgdG8gZmlyZSBpcyBhdHRhY2hlZCB0byB0aGUgc2FtZSB0YWJsZSAodXNpbmcgdGhlIHRhYmxlIG5vZGUgYXMgcmVmZXJlbmNlKSBiZWZvcmUgZmlyaW5nCiAqICBAbWV0aG9kICBfZm5FdmVudERpc3BhdGNoCiAqICBAcGFyYW0gICB7T2JqZWN0fSB0aGF0IFNjb3BlIG9mIHRoZSBsaXN0ZW5pbmcgZnVuY3Rpb24gKGkuZS4gJ3RoaXMnIGluIHRoZSBjYWxsZXIpCiAqICBAcGFyYW0gICB7U3RyaW5nfSB0eXBlIEV2ZW50IHR5cGUKICogIEBwYXJhbSAgIHtOb2RlfSBub2RlIEVsZW1lbnQgdGhhdCB0aGUgZXZlbnQgb2NjdXJyZWQgb24gKG1heSBiZSBudWxsKQogKiAgQHBhcmFtICAge2Jvb2xlYW59IFtzZWxlY3RlZF0gSW5kaWNhdGUgaWYgdGhlIG5vZGUgd2FzIHNlbGVjdGVkICh0cnVlKSBvciBkZXNlbGVjdGVkIChmYWxzZSkKICogIEByZXR1cm5zIHZvaWQKICogIEBwcml2YXRlCiAqICBAc3RhdGljCiAqLwpUYWJsZVRvb2xzLl9mbkV2ZW50RGlzcGF0Y2ggPSBmdW5jdGlvbiAoIHRoYXQsIHR5cGUsIG5vZGUsIHNlbGVjdGVkICkKewoJdmFyIGxpc3RlbmVycyA9IFRhYmxlVG9vbHMuX2FMaXN0ZW5lcnM7Cglmb3IgKCB2YXIgaT0wLCBpTGVuPWxpc3RlbmVycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJewoJCWlmICggdGhhdC5kb20udGFibGUgPT0gbGlzdGVuZXJzW2ldLnRoYXQuZG9tLnRhYmxlICYmIGxpc3RlbmVyc1tpXS50eXBlID09IHR5cGUgKQoJCXsKCQkJbGlzdGVuZXJzW2ldLmZuKCBub2RlLCBzZWxlY3RlZCApOwoJCX0KCX0KfTsKCgoKCgoKLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqCiAqIENvbnN0YW50cwogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICovCgoKClRhYmxlVG9vbHMuYnV0dG9uQmFzZSA9IHsKCS8vIEJ1dHRvbiBiYXNlCgkic0FjdGlvbiI6ICJ0ZXh0IiwKCSJzVGFnIjogImRlZmF1bHQiLAoJInNMaW5lclRhZyI6ICJkZWZhdWx0IiwKCSJzQnV0dG9uQ2xhc3MiOiAiRFRUVF9idXR0b25fdGV4dCIsCgkic0J1dHRvblRleHQiOiAiQnV0dG9uIHRleHQiLAoJInNUaXRsZSI6ICIiLAoJInNUb29sVGlwIjogIiIsCgoJLy8gQ29tbW9uIGJ1dHRvbiBzcGVjaWZpYyBvcHRpb25zCgkic0NoYXJTZXQiOiAidXRmOCIsCgkiYkJvbUluYyI6IGZhbHNlLAoJInNGaWxlTmFtZSI6ICIqLmNzdiIsCgkic0ZpZWxkQm91bmRhcnkiOiAiIiwKCSJzRmllbGRTZXBlcmF0b3IiOiAiXHQiLAoJInNOZXdMaW5lIjogImF1dG8iLAoJIm1Db2x1bW5zIjogImFsbCIsIC8qICJhbGwiLCAidmlzaWJsZSIsICJoaWRkZW4iIG9yIGFycmF5IG9mIGNvbHVtbiBpbnRlZ2VycyAqLwoJImJIZWFkZXIiOiB0cnVlLAoJImJGb290ZXIiOiB0cnVlLAoJImJPcGVuUm93cyI6IGZhbHNlLAoJImJTZWxlY3RlZE9ubHkiOiBmYWxzZSwKCSJvU2VsZWN0b3JPcHRzIjogdW5kZWZpbmVkLCAvLyBTZWUgaHR0cDovL2RhdGF0YWJsZXMubmV0L2RvY3MvRGF0YVRhYmxlcy8xLjkuNC8jJCBmb3IgZnVsbCBvcHRpb25zCgoJLy8gQ2FsbGJhY2tzCgkiZm5Nb3VzZW92ZXIiOiBudWxsLAoJImZuTW91c2VvdXQiOiBudWxsLAoJImZuQ2xpY2siOiBudWxsLAoJImZuU2VsZWN0IjogbnVsbCwKCSJmbkNvbXBsZXRlIjogbnVsbCwKCSJmbkluaXQiOiBudWxsLAoJImZuQ2VsbFJlbmRlciI6IG51bGwKfTsKCgovKioKICogQG5hbWVzcGFjZSBEZWZhdWx0IGJ1dHRvbiBjb25maWd1cmF0aW9ucwogKi8KVGFibGVUb29scy5CVVRUT05TID0gewoJImNzdiI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNBY3Rpb24iOiAiZmxhc2hfc2F2ZSIsCgkJInNCdXR0b25DbGFzcyI6ICJEVFRUX2J1dHRvbl9jc3YiLAoJCSJzQnV0dG9uVGV4dCI6ICJDU1YiLAoJCSJzRmllbGRCb3VuZGFyeSI6ICciJywKCQkic0ZpZWxkU2VwZXJhdG9yIjogIiwiLAoJCSJmbkNsaWNrIjogZnVuY3Rpb24oIG5CdXR0b24sIG9Db25maWcsIGZsYXNoICkgewoJCQl0aGlzLmZuU2V0VGV4dCggZmxhc2gsIHRoaXMuZm5HZXRUYWJsZURhdGEob0NvbmZpZykgKTsKCQl9Cgl9ICksCgoJInhscyI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNBY3Rpb24iOiAiZmxhc2hfc2F2ZSIsCgkJInNDaGFyU2V0IjogInV0ZjE2bGUiLAoJCSJiQm9tSW5jIjogdHJ1ZSwKCQkic0J1dHRvbkNsYXNzIjogIkRUVFRfYnV0dG9uX3hscyIsCgkJInNCdXR0b25UZXh0IjogIkV4Y2VsIiwKCQkiZm5DbGljayI6IGZ1bmN0aW9uKCBuQnV0dG9uLCBvQ29uZmlnLCBmbGFzaCApIHsKCQkJdGhpcy5mblNldFRleHQoIGZsYXNoLCB0aGlzLmZuR2V0VGFibGVEYXRhKG9Db25maWcpICk7CgkJfQoJfSApLAoKCSJjb3B5IjogJC5leHRlbmQoIHt9LCBUYWJsZVRvb2xzLmJ1dHRvbkJhc2UsIHsKCQkic0FjdGlvbiI6ICJmbGFzaF9jb3B5IiwKCQkic0J1dHRvbkNsYXNzIjogIkRUVFRfYnV0dG9uX2NvcHkiLAoJCSJzQnV0dG9uVGV4dCI6ICJDb3B5IiwKCQkiZm5DbGljayI6IGZ1bmN0aW9uKCBuQnV0dG9uLCBvQ29uZmlnLCBmbGFzaCApIHsKCQkJdGhpcy5mblNldFRleHQoIGZsYXNoLCB0aGlzLmZuR2V0VGFibGVEYXRhKG9Db25maWcpICk7CgkJfSwKCQkiZm5Db21wbGV0ZSI6IGZ1bmN0aW9uKG5CdXR0b24sIG9Db25maWcsIGZsYXNoLCB0ZXh0KSB7CgkJCXZhciBsaW5lcyA9IHRleHQuc3BsaXQoJ1xuJykubGVuZ3RoOwogICAgICAgICAgICBpZiAob0NvbmZpZy5iSGVhZGVyKSBsaW5lcy0tOwogICAgICAgICAgICBpZiAodGhpcy5zLmR0Lm5URm9vdCAhPT0gbnVsbCAmJiBvQ29uZmlnLmJGb290ZXIpIGxpbmVzLS07CgkJCXZhciBwbHVyYWwgPSAobGluZXM9PTEpID8gIiIgOiAicyI7CgkJCXRoaXMuZm5JbmZvKCAnPGg2PlRhYmxlIGNvcGllZDwvaDY+JysKCQkJCSc8cD5Db3BpZWQgJytsaW5lcysnIHJvdycrcGx1cmFsKycgdG8gdGhlIGNsaXBib2FyZC48L3A+JywKCQkJCTE1MDAKCQkJKTsKCQl9Cgl9ICksCgoJInBkZiI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNBY3Rpb24iOiAiZmxhc2hfcGRmIiwKCQkic05ld0xpbmUiOiAiXG4iLAoJCSJzRmlsZU5hbWUiOiAiKi5wZGYiLAoJCSJzQnV0dG9uQ2xhc3MiOiAiRFRUVF9idXR0b25fcGRmIiwKCQkic0J1dHRvblRleHQiOiAiUERGIiwKCQkic1BkZk9yaWVudGF0aW9uIjogInBvcnRyYWl0IiwKCQkic1BkZlNpemUiOiAiQTQiLAoJCSJzUGRmTWVzc2FnZSI6ICIiLAoJCSJmbkNsaWNrIjogZnVuY3Rpb24oIG5CdXR0b24sIG9Db25maWcsIGZsYXNoICkgewoJCQl0aGlzLmZuU2V0VGV4dCggZmxhc2gsCgkJCQkidGl0bGU6IisgdGhpcy5mbkdldFRpdGxlKG9Db25maWcpICsiXG4iKwoJCQkJIm1lc3NhZ2U6Iisgb0NvbmZpZy5zUGRmTWVzc2FnZSArIlxuIisKCQkJCSJjb2xXaWR0aDoiKyB0aGlzLmZuQ2FsY0NvbFJhdGlvcyhvQ29uZmlnKSArIlxuIisKCQkJCSJvcmllbnRhdGlvbjoiKyBvQ29uZmlnLnNQZGZPcmllbnRhdGlvbiArIlxuIisKCQkJCSJzaXplOiIrIG9Db25maWcuc1BkZlNpemUgKyJcbiIrCgkJCQkiLS0vVGFibGVUb29sc09wdHMtLVxuIiArCgkJCQl0aGlzLmZuR2V0VGFibGVEYXRhKG9Db25maWcpCgkJCSk7CgkJfQoJfSApLAoKCSJwcmludCI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNJbmZvIjogIjxoNj5QcmludCB2aWV3PC9oNj48cD5QbGVhc2UgdXNlIHlvdXIgYnJvd3NlcidzIHByaW50IGZ1bmN0aW9uIHRvICIrCgkJICAicHJpbnQgdGhpcyB0YWJsZS4gUHJlc3MgZXNjYXBlIHdoZW4gZmluaXNoZWQuPC9wPiIsCgkJInNNZXNzYWdlIjogbnVsbCwKCQkiYlNob3dBbGwiOiB0cnVlLAoJCSJzVG9vbFRpcCI6ICJWaWV3IHByaW50IHZpZXciLAoJCSJzQnV0dG9uQ2xhc3MiOiAiRFRUVF9idXR0b25fcHJpbnQiLAoJCSJzQnV0dG9uVGV4dCI6ICJQcmludCIsCgkJImZuQ2xpY2siOiBmdW5jdGlvbiAoIG5CdXR0b24sIG9Db25maWcgKSB7CgkJCXRoaXMuZm5QcmludCggdHJ1ZSwgb0NvbmZpZyApOwoJCX0KCX0gKSwKCgkidGV4dCI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlICksCgoJInNlbGVjdCI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNCdXR0b25UZXh0IjogIlNlbGVjdCBidXR0b24iLAoJCSJmblNlbGVjdCI6IGZ1bmN0aW9uKCBuQnV0dG9uLCBvQ29uZmlnICkgewoJCQlpZiAoIHRoaXMuZm5HZXRTZWxlY3RlZCgpLmxlbmd0aCAhPT0gMCApIHsKCQkJCSQobkJ1dHRvbikucmVtb3ZlQ2xhc3MoIHRoaXMuY2xhc3Nlcy5idXR0b25zLmRpc2FibGVkICk7CgkJCX0gZWxzZSB7CgkJCQkkKG5CdXR0b24pLmFkZENsYXNzKCB0aGlzLmNsYXNzZXMuYnV0dG9ucy5kaXNhYmxlZCApOwoJCQl9CgkJfSwKCQkiZm5Jbml0IjogZnVuY3Rpb24oIG5CdXR0b24sIG9Db25maWcgKSB7CgkJCSQobkJ1dHRvbikuYWRkQ2xhc3MoIHRoaXMuY2xhc3Nlcy5idXR0b25zLmRpc2FibGVkICk7CgkJfQoJfSApLAoKCSJzZWxlY3Rfc2luZ2xlIjogJC5leHRlbmQoIHt9LCBUYWJsZVRvb2xzLmJ1dHRvbkJhc2UsIHsKCQkic0J1dHRvblRleHQiOiAiU2VsZWN0IGJ1dHRvbiIsCgkJImZuU2VsZWN0IjogZnVuY3Rpb24oIG5CdXR0b24sIG9Db25maWcgKSB7CgkJCXZhciBpU2VsZWN0ZWQgPSB0aGlzLmZuR2V0U2VsZWN0ZWQoKS5sZW5ndGg7CgkJCWlmICggaVNlbGVjdGVkID09IDEgKSB7CgkJCQkkKG5CdXR0b24pLnJlbW92ZUNsYXNzKCB0aGlzLmNsYXNzZXMuYnV0dG9ucy5kaXNhYmxlZCApOwoJCQl9IGVsc2UgewoJCQkJJChuQnV0dG9uKS5hZGRDbGFzcyggdGhpcy5jbGFzc2VzLmJ1dHRvbnMuZGlzYWJsZWQgKTsKCQkJfQoJCX0sCgkJImZuSW5pdCI6IGZ1bmN0aW9uKCBuQnV0dG9uLCBvQ29uZmlnICkgewoJCQkkKG5CdXR0b24pLmFkZENsYXNzKCB0aGlzLmNsYXNzZXMuYnV0dG9ucy5kaXNhYmxlZCApOwoJCX0KCX0gKSwKCgkic2VsZWN0X2FsbCI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNCdXR0b25UZXh0IjogIlNlbGVjdCBhbGwiLAoJCSJmbkNsaWNrIjogZnVuY3Rpb24oIG5CdXR0b24sIG9Db25maWcgKSB7CgkJCXRoaXMuZm5TZWxlY3RBbGwoKTsKCQl9LAoJCSJmblNlbGVjdCI6IGZ1bmN0aW9uKCBuQnV0dG9uLCBvQ29uZmlnICkgewoJCQlpZiAoIHRoaXMuZm5HZXRTZWxlY3RlZCgpLmxlbmd0aCA9PSB0aGlzLnMuZHQuZm5SZWNvcmRzRGlzcGxheSgpICkgewoJCQkJJChuQnV0dG9uKS5hZGRDbGFzcyggdGhpcy5jbGFzc2VzLmJ1dHRvbnMuZGlzYWJsZWQgKTsKCQkJfSBlbHNlIHsKCQkJCSQobkJ1dHRvbikucmVtb3ZlQ2xhc3MoIHRoaXMuY2xhc3Nlcy5idXR0b25zLmRpc2FibGVkICk7CgkJCX0KCQl9Cgl9ICksCgoJInNlbGVjdF9ub25lIjogJC5leHRlbmQoIHt9LCBUYWJsZVRvb2xzLmJ1dHRvbkJhc2UsIHsKCQkic0J1dHRvblRleHQiOiAiRGVzZWxlY3QgYWxsIiwKCQkiZm5DbGljayI6IGZ1bmN0aW9uKCBuQnV0dG9uLCBvQ29uZmlnICkgewoJCQl0aGlzLmZuU2VsZWN0Tm9uZSgpOwoJCX0sCgkJImZuU2VsZWN0IjogZnVuY3Rpb24oIG5CdXR0b24sIG9Db25maWcgKSB7CgkJCWlmICggdGhpcy5mbkdldFNlbGVjdGVkKCkubGVuZ3RoICE9PSAwICkgewoJCQkJJChuQnV0dG9uKS5yZW1vdmVDbGFzcyggdGhpcy5jbGFzc2VzLmJ1dHRvbnMuZGlzYWJsZWQgKTsKCQkJfSBlbHNlIHsKCQkJCSQobkJ1dHRvbikuYWRkQ2xhc3MoIHRoaXMuY2xhc3Nlcy5idXR0b25zLmRpc2FibGVkICk7CgkJCX0KCQl9LAoJCSJmbkluaXQiOiBmdW5jdGlvbiggbkJ1dHRvbiwgb0NvbmZpZyApIHsKCQkJJChuQnV0dG9uKS5hZGRDbGFzcyggdGhpcy5jbGFzc2VzLmJ1dHRvbnMuZGlzYWJsZWQgKTsKCQl9Cgl9ICksCgoJImFqYXgiOiAkLmV4dGVuZCgge30sIFRhYmxlVG9vbHMuYnV0dG9uQmFzZSwgewoJCSJzQWpheFVybCI6ICIveGhyLnBocCIsCgkJInNCdXR0b25UZXh0IjogIkFqYXggYnV0dG9uIiwKCQkiZm5DbGljayI6IGZ1bmN0aW9uKCBuQnV0dG9uLCBvQ29uZmlnICkgewoJCQl2YXIgc0RhdGEgPSB0aGlzLmZuR2V0VGFibGVEYXRhKG9Db25maWcpOwoJCQkkLmFqYXgoIHsKCQkJCSJ1cmwiOiBvQ29uZmlnLnNBamF4VXJsLAoJCQkJImRhdGEiOiBbCgkJCQkJeyAibmFtZSI6ICJ0YWJsZURhdGEiLCAidmFsdWUiOiBzRGF0YSB9CgkJCQldLAoJCQkJInN1Y2Nlc3MiOiBvQ29uZmlnLmZuQWpheENvbXBsZXRlLAoJCQkJImRhdGFUeXBlIjogImpzb24iLAoJCQkJInR5cGUiOiAiUE9TVCIsCgkJCQkiY2FjaGUiOiBmYWxzZSwKCQkJCSJlcnJvciI6IGZ1bmN0aW9uICgpIHsKCQkJCQlhbGVydCggIkVycm9yIGRldGVjdGVkIHdoZW4gc2VuZGluZyB0YWJsZSBkYXRhIHRvIHNlcnZlciIgKTsKCQkJCX0KCQkJfSApOwoJCX0sCgkJImZuQWpheENvbXBsZXRlIjogZnVuY3Rpb24oIGpzb24gKSB7CgkJCWFsZXJ0KCAnQWpheCBjb21wbGV0ZScgKTsKCQl9Cgl9ICksCgoJImRpdiI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNBY3Rpb24iOiAiZGl2IiwKCQkic1RhZyI6ICJkaXYiLAoJCSJzQnV0dG9uQ2xhc3MiOiAiRFRUVF9ub25idXR0b24iLAoJCSJzQnV0dG9uVGV4dCI6ICJUZXh0IGJ1dHRvbiIKCX0gKSwKCgkiY29sbGVjdGlvbiI6ICQuZXh0ZW5kKCB7fSwgVGFibGVUb29scy5idXR0b25CYXNlLCB7CgkJInNBY3Rpb24iOiAiY29sbGVjdGlvbiIsCgkJInNCdXR0b25DbGFzcyI6ICJEVFRUX2J1dHRvbl9jb2xsZWN0aW9uIiwKCQkic0J1dHRvblRleHQiOiAiQ29sbGVjdGlvbiIsCgkJImZuQ2xpY2siOiBmdW5jdGlvbiggbkJ1dHRvbiwgb0NvbmZpZyApIHsKCQkJdGhpcy5fZm5Db2xsZWN0aW9uU2hvdyhuQnV0dG9uLCBvQ29uZmlnKTsKCQl9Cgl9ICkKfTsKLyoKICogIG9uKiBjYWxsYmFjayBwYXJhbWV0ZXJzOgogKiAgICAgMS4gbm9kZSAtIGJ1dHRvbiBlbGVtZW50CiAqICAgICAyLiBvYmplY3QgLSBjb25maWd1cmF0aW9uIG9iamVjdCBmb3IgdGhpcyBidXR0b24KICogICAgIDMuIG9iamVjdCAtIFplcm9DbGlwYm9hcmQgcmVmZXJlbmNlIChmbGFzaCBidXR0b24gb25seSkKICogICAgIDQuIHN0cmluZyAtIFJldHVybmVkIHN0cmluZyBmcm9tIEZsYXNoIChmbGFzaCBidXR0b24gb25seSAtIGFuZCBvbmx5IG9uICdjb21wbGV0ZScpCiAqLwoKLy8gQWxpYXMgdG8gbWF0Y2ggdGhlIG90aGVyIHBsdWctaW5zIHN0eWxpbmcKVGFibGVUb29scy5idXR0b25zID0gVGFibGVUb29scy5CVVRUT05TOwoKCi8qKgogKiBAbmFtZXNwYWNlIENsYXNzZXMgdXNlZCBieSBUYWJsZVRvb2xzIC0gYWxsb3dzIHRoZSBzdHlsZXMgdG8gYmUgb3ZlcnJpZGUgZWFzaWx5LgogKiAgIE5vdGUgdGhhdCB3aGVuIFRhYmxlVG9vbHMgaW5pdGlhbGlzZXMgaXQgd2lsbCB0YWtlIGEgY29weSBvZiB0aGUgY2xhc3NlcyBvYmplY3QKICogICBhbmQgd2lsbCB1c2UgaXRzIGludGVybmFsIGNvcHkgZm9yIHRoZSByZW1haW5kZXIgb2YgaXRzIHJ1biB0aW1lLgogKi8KVGFibGVUb29scy5jbGFzc2VzID0gewoJImNvbnRhaW5lciI6ICJEVFRUX2NvbnRhaW5lciIsCgkiYnV0dG9ucyI6IHsKCQkibm9ybWFsIjogIkRUVFRfYnV0dG9uIiwKCQkiZGlzYWJsZWQiOiAiRFRUVF9kaXNhYmxlZCIKCX0sCgkiY29sbGVjdGlvbiI6IHsKCQkiY29udGFpbmVyIjogIkRUVFRfY29sbGVjdGlvbiIsCgkJImJhY2tncm91bmQiOiAiRFRUVF9jb2xsZWN0aW9uX2JhY2tncm91bmQiLAoJCSJidXR0b25zIjogewoJCQkibm9ybWFsIjogIkRUVFRfYnV0dG9uIiwKCQkJImRpc2FibGVkIjogIkRUVFRfZGlzYWJsZWQiCgkJfQoJfSwKCSJzZWxlY3QiOiB7CgkJInRhYmxlIjogIkRUVFRfc2VsZWN0YWJsZSIsCgkJInJvdyI6ICJEVFRUX3NlbGVjdGVkIHNlbGVjdGVkIgoJfSwKCSJwcmludCI6IHsKCQkiYm9keSI6ICJEVFRUX1ByaW50IiwKCQkiaW5mbyI6ICJEVFRUX3ByaW50X2luZm8iLAoJCSJtZXNzYWdlIjogIkRUVFRfUHJpbnRNZXNzYWdlIgoJfQp9OwoKCi8qKgogKiBAbmFtZXNwYWNlIFRoZW1lUm9sbGVyIGNsYXNzZXMgLSBidWlsdCBpbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIERhdGFUYWJsZXMnIAogKiAgIGJKUXVlcnlVSSBvcHRpb24uCiAqLwpUYWJsZVRvb2xzLmNsYXNzZXNfdGhlbWVyb2xsZXIgPSB7CgkiY29udGFpbmVyIjogIkRUVFRfY29udGFpbmVyIHVpLWJ1dHRvbnNldCB1aS1idXR0b25zZXQtbXVsdGkiLAoJImJ1dHRvbnMiOiB7CgkJIm5vcm1hbCI6ICJEVFRUX2J1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCIKCX0sCgkiY29sbGVjdGlvbiI6IHsKCQkiY29udGFpbmVyIjogIkRUVFRfY29sbGVjdGlvbiB1aS1idXR0b25zZXQgdWktYnV0dG9uc2V0LW11bHRpIgoJfQp9OwoKCi8qKgogKiBAbmFtZXNwYWNlIFRhYmxlVG9vbHMgZGVmYXVsdCBzZXR0aW5ncyBmb3IgaW5pdGlhbGlzYXRpb24KICovClRhYmxlVG9vbHMuREVGQVVMVFMgPSB7Cgkic1N3ZlBhdGgiOiAgICAgICAgIi4uL3N3Zi9jb3B5X2Nzdl94bHNfcGRmLnN3ZiIsCgkic1Jvd1NlbGVjdCI6ICAgICAgIm5vbmUiLAoJInNSb3dTZWxlY3RvciI6ICAgICJ0ciIsCgkic1NlbGVjdGVkQ2xhc3MiOiAgbnVsbCwKCSJmblByZVJvd1NlbGVjdCI6ICBudWxsLAoJImZuUm93U2VsZWN0ZWQiOiAgIG51bGwsCgkiZm5Sb3dEZXNlbGVjdGVkIjogbnVsbCwKCSJhQnV0dG9ucyI6ICAgICAgICBbICJjb3B5IiwgImNzdiIsICJ4bHMiLCAicGRmIiwgInByaW50IiBdLAoJIm9UYWdzIjogewoJCSJjb250YWluZXIiOiAiZGl2IiwKCQkiYnV0dG9uIjogImEiLCAvLyBXZSByZWFsbHkgd2FudCB0byB1c2UgYnV0dG9ucyBoZXJlLCBidXQgRmlyZWZveCBhbmQgSUUgaWdub3JlIHRoZQoJCSAgICAgICAgICAgICAgICAgLy8gY2xpY2sgb24gdGhlIEZsYXNoIGVsZW1lbnQgaW4gdGhlIGJ1dHRvbiAoYnV0IG5vdCBtb3VzZVtpbnxvdXRdKS4KCQkibGluZXIiOiAic3BhbiIsCgkJImNvbGxlY3Rpb24iOiB7CgkJCSJjb250YWluZXIiOiAiZGl2IiwKCQkJImJ1dHRvbiI6ICJhIiwKCQkJImxpbmVyIjogInNwYW4iCgkJfQoJfQp9OwoKLy8gQWxpYXMgdG8gbWF0Y2ggdGhlIG90aGVyIHBsdWctaW5zClRhYmxlVG9vbHMuZGVmYXVsdHMgPSBUYWJsZVRvb2xzLkRFRkFVTFRTOwoKCi8qKgogKiBOYW1lIG9mIHRoaXMgY2xhc3MKICogIEBjb25zdGFudCBDTEFTUwogKiAgQHR5cGUJIFN0cmluZwogKiAgQGRlZmF1bHQgIFRhYmxlVG9vbHMKICovClRhYmxlVG9vbHMucHJvdG90eXBlLkNMQVNTID0gIlRhYmxlVG9vbHMiOwoKCi8qKgogKiBUYWJsZVRvb2xzIHZlcnNpb24KICogIEBjb25zdGFudCAgVkVSU0lPTgogKiAgQHR5cGUJICBTdHJpbmcKICogIEBkZWZhdWx0ICAgU2VlIGNvZGUKICovClRhYmxlVG9vbHMudmVyc2lvbiA9ICIyLjIuMiI7CgoKCi8vIERhdGFUYWJsZXMgMS4xMCBBUEkKLy8gCi8vIFRoaXMgd2lsbCBiZSBleHRlbmRlZCBpbiBhIGJpZyB3YXkgaW4gaW4gVGFibGVUb29scyAzIHRvIHByb3ZpZGUgQVBJIG1ldGhvZHMKLy8gc3VjaCBhcyByb3dzKCkuc2VsZWN0KCkgYW5kIHJvd3Muc2VsZWN0ZWQoKSBldGMsIGJ1dCBmb3IgdGhlIG1vbWVudCB0aGUKLy8gdGFibGV0b29scygpIG1ldGhvZCBzaW1wbHkgcmV0dXJucyB0aGUgaW5zdGFuY2UuCgppZiAoICQuZm4uZGF0YVRhYmxlLkFwaSApIHsKCSQuZm4uZGF0YVRhYmxlLkFwaS5yZWdpc3RlciggJ3RhYmxldG9vbHMoKScsIGZ1bmN0aW9uICgpIHsKCQl2YXIgdHQgPSBudWxsOwoKCQlpZiAoIHRoaXMuY29udGV4dC5sZW5ndGggPiAwICkgewoJCQl0dCA9IFRhYmxlVG9vbHMuZm5HZXRJbnN0YW5jZSggdGhpcy5jb250ZXh0WzBdLm5UYWJsZSApOwoJCX0KCgkJcmV0dXJuIHR0OwoJfSApOwp9CgoKCgovKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKICogSW5pdGlhbGlzYXRpb24KICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqLwoKLyoKICogUmVnaXN0ZXIgYSBuZXcgZmVhdHVyZSB3aXRoIERhdGFUYWJsZXMKICovCmlmICggdHlwZW9mICQuZm4uZGF0YVRhYmxlID09ICJmdW5jdGlvbiIgJiYKCSB0eXBlb2YgJC5mbi5kYXRhVGFibGVFeHQuZm5WZXJzaW9uQ2hlY2sgPT0gImZ1bmN0aW9uIiAmJgoJICQuZm4uZGF0YVRhYmxlRXh0LmZuVmVyc2lvbkNoZWNrKCcxLjkuMCcpICkKewoJJC5mbi5kYXRhVGFibGVFeHQuYW9GZWF0dXJlcy5wdXNoKCB7CgkJImZuSW5pdCI6IGZ1bmN0aW9uKCBvRFRTZXR0aW5ncyApIHsKCQkJdmFyIGluaXQgPSBvRFRTZXR0aW5ncy5vSW5pdDsKCQkJdmFyIG9wdHMgPSBpbml0ID8KCQkJCWluaXQudGFibGVUb29scyB8fCBpbml0Lm9UYWJsZVRvb2xzIHx8IHt9IDoKCQkJCXt9OwoKCQkJcmV0dXJuIG5ldyBUYWJsZVRvb2xzKCBvRFRTZXR0aW5ncy5vSW5zdGFuY2UsIG9wdHMgKS5kb20uY29udGFpbmVyOwoJCX0sCgkJImNGZWF0dXJlIjogIlQiLAoJCSJzRmVhdHVyZSI6ICJUYWJsZVRvb2xzIgoJfSApOwp9CmVsc2UKewoJYWxlcnQoICJXYXJuaW5nOiBUYWJsZVRvb2xzIHJlcXVpcmVzIERhdGFUYWJsZXMgMS45LjAgb3IgbmV3ZXIgLSB3d3cuZGF0YXRhYmxlcy5uZXQvZG93bmxvYWQiKTsKfQoKJC5mbi5EYXRhVGFibGUuVGFibGVUb29scyA9IFRhYmxlVG9vbHM7Cgp9KShqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQpOwoKLyoKICogUmVnaXN0ZXIgYSBuZXcgZmVhdHVyZSB3aXRoIERhdGFUYWJsZXMKICovCmlmICggdHlwZW9mICQuZm4uZGF0YVRhYmxlID09ICJmdW5jdGlvbiIgJiYKCSB0eXBlb2YgJC5mbi5kYXRhVGFibGVFeHQuZm5WZXJzaW9uQ2hlY2sgPT0gImZ1bmN0aW9uIiAmJgoJICQuZm4uZGF0YVRhYmxlRXh0LmZuVmVyc2lvbkNoZWNrKCcxLjkuMCcpICkKewoJJC5mbi5kYXRhVGFibGVFeHQuYW9GZWF0dXJlcy5wdXNoKCB7CgkJImZuSW5pdCI6IGZ1bmN0aW9uKCBvRFRTZXR0aW5ncyApIHsKCQkJdmFyIG9PcHRzID0gdHlwZW9mIG9EVFNldHRpbmdzLm9Jbml0Lm9UYWJsZVRvb2xzICE9ICd1bmRlZmluZWQnID8KCQkJCW9EVFNldHRpbmdzLm9Jbml0Lm9UYWJsZVRvb2xzIDoge307CgoJCQl2YXIgb1RUID0gbmV3IFRhYmxlVG9vbHMoIG9EVFNldHRpbmdzLm9JbnN0YW5jZSwgb09wdHMgKTsKCQkJVGFibGVUb29scy5fYUluc3RhbmNlcy5wdXNoKCBvVFQgKTsKCgkJCXJldHVybiBvVFQuZG9tLmNvbnRhaW5lcjsKCQl9LAoJCSJjRmVhdHVyZSI6ICJUIiwKCQkic0ZlYXR1cmUiOiAiVGFibGVUb29scyIKCX0gKTsKfQplbHNlCnsKCWFsZXJ0KCAiV2FybmluZzogVGFibGVUb29scyAyIHJlcXVpcmVzIERhdGFUYWJsZXMgMS45LjAgb3IgbmV3ZXIgLSB3d3cuZGF0YXRhYmxlcy5uZXQvZG93bmxvYWQiKTsKfQoKCiQuZm4uZGF0YVRhYmxlLlRhYmxlVG9vbHMgPSBUYWJsZVRvb2xzOwokLmZuLkRhdGFUYWJsZS5UYWJsZVRvb2xzID0gVGFibGVUb29sczsKCgpyZXR1cm4gVGFibGVUb29sczsKfTsgLy8gL2ZhY3RvcnkKCgovLyBEZWZpbmUgYXMgYW4gQU1EIG1vZHVsZSBpZiBwb3NzaWJsZQppZiAoIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCApIHsKCWRlZmluZSggWydqcXVlcnknLCAnZGF0YXRhYmxlcyddLCBmYWN0b3J5ICk7Cn0KZWxzZSBpZiAoIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyApIHsKICAgIC8vIE5vZGUvQ29tbW9uSlMKICAgIGZhY3RvcnkoIHJlcXVpcmUoJ2pxdWVyeScpLCByZXF1aXJlKCdkYXRhdGFibGVzJykgKTsKfQplbHNlIGlmICggalF1ZXJ5ICYmICFqUXVlcnkuZm4uZGF0YVRhYmxlLlRhYmxlVG9vbHMgKSB7CgkvLyBPdGhlcndpc2Ugc2ltcGx5IGluaXRpYWxpc2UgYXMgbm9ybWFsLCBzdG9wcGluZyBtdWx0aXBsZSBldmFsdWF0aW9uCglmYWN0b3J5KCBqUXVlcnksIGpRdWVyeS5mbi5kYXRhVGFibGUgKTsKfQoKCn0pKHdpbmRvdywgZG9jdW1lbnQpOwoK",
    "size": "82983"
}