{
    "namaFile": "pages\/admin\/menu\/assets\/js\/libs\/morris.js\/morris.js",
    "lastUpdate": "2018-03-22+14:23:40.87",
    "contentFile": "LyogQGxpY2Vuc2UKbW9ycmlzLmpzIHYwLjUuMApDb3B5cmlnaHQgMjAxNCBPbGx5IFNtaXRoIEFsbCByaWdodHMgcmVzZXJ2ZWQuCkxpY2Vuc2VkIHVuZGVyIHRoZSBCU0QtMi1DbGF1c2UgTGljZW5zZS4KKi8KCgooZnVuY3Rpb24oKSB7CiAgdmFyICQsIE1vcnJpcywgbWludXRlc1NwZWNIZWxwZXIsIHNlY29uZHNTcGVjSGVscGVyLAogICAgX19zbGljZSA9IFtdLnNsaWNlLAogICAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSwKICAgIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogICAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH0sCiAgICBfX2luZGV4T2YgPSBbXS5pbmRleE9mIHx8IGZ1bmN0aW9uKGl0ZW0pIHsgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgeyBpZiAoaSBpbiB0aGlzICYmIHRoaXNbaV0gPT09IGl0ZW0pIHJldHVybiBpOyB9IHJldHVybiAtMTsgfTsKCiAgTW9ycmlzID0gd2luZG93Lk1vcnJpcyA9IHt9OwoKICAkID0galF1ZXJ5OwoKICBNb3JyaXMuRXZlbnRFbWl0dGVyID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge30KCiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24obmFtZSwgaGFuZGxlcikgewogICAgICBpZiAodGhpcy5oYW5kbGVycyA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5oYW5kbGVycyA9IHt9OwogICAgICB9CiAgICAgIGlmICh0aGlzLmhhbmRsZXJzW25hbWVdID09IG51bGwpIHsKICAgICAgICB0aGlzLmhhbmRsZXJzW25hbWVdID0gW107CiAgICAgIH0KICAgICAgdGhpcy5oYW5kbGVyc1tuYW1lXS5wdXNoKGhhbmRsZXIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5maXJlID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzLCBoYW5kbGVyLCBuYW1lLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIG5hbWUgPSBhcmd1bWVudHNbMF0sIGFyZ3MgPSAyIDw9IGFyZ3VtZW50cy5sZW5ndGggPyBfX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSA6IFtdOwogICAgICBpZiAoKHRoaXMuaGFuZGxlcnMgIT0gbnVsbCkgJiYgKHRoaXMuaGFuZGxlcnNbbmFtZV0gIT0gbnVsbCkpIHsKICAgICAgICBfcmVmID0gdGhpcy5oYW5kbGVyc1tuYW1lXTsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgaGFuZGxlciA9IF9yZWZbX2ldOwogICAgICAgICAgX3Jlc3VsdHMucHVzaChoYW5kbGVyLmFwcGx5KG51bGwsIGFyZ3MpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBFdmVudEVtaXR0ZXI7CgogIH0pKCk7CgogIE1vcnJpcy5jb21tYXMgPSBmdW5jdGlvbihudW0pIHsKICAgIHZhciBhYnNudW0sIGludG51bSwgcmV0LCBzdHJhYnNudW07CiAgICBpZiAobnVtICE9IG51bGwpIHsKICAgICAgcmV0ID0gbnVtIDwgMCA\/ICItIiA6ICIiOwogICAgICBhYnNudW0gPSBNYXRoLmFicyhudW0pOwogICAgICBpbnRudW0gPSBNYXRoLmZsb29yKGFic251bSkudG9GaXhlZCgwKTsKICAgICAgcmV0ICs9IGludG51bS5yZXBsYWNlKC8oPz0oPzpcZHszfSkrJCkoPyFeKS9nLCAnLCcpOwogICAgICBzdHJhYnNudW0gPSBhYnNudW0udG9TdHJpbmcoKTsKICAgICAgaWYgKHN0cmFic251bS5sZW5ndGggPiBpbnRudW0ubGVuZ3RoKSB7CiAgICAgICAgcmV0ICs9IHN0cmFic251bS5zbGljZShpbnRudW0ubGVuZ3RoKTsKICAgICAgfQogICAgICByZXR1cm4gcmV0OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICctJzsKICAgIH0KICB9OwoKICBNb3JyaXMucGFkMiA9IGZ1bmN0aW9uKG51bWJlcikgewogICAgcmV0dXJuIChudW1iZXIgPCAxMCA\/ICcwJyA6ICcnKSArIG51bWJlcjsKICB9OwoKICBNb3JyaXMuR3JpZCA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhHcmlkLCBfc3VwZXIpOwoKICAgIGZ1bmN0aW9uIEdyaWQob3B0aW9ucykgewogICAgICB0aGlzLnJlc2l6ZUhhbmRsZXIgPSBfX2JpbmQodGhpcy5yZXNpemVIYW5kbGVyLCB0aGlzKTsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmVsZW1lbnQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdGhpcy5lbCA9ICQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9ucy5lbGVtZW50KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lbCA9ICQob3B0aW9ucy5lbGVtZW50KTsKICAgICAgfQogICAgICBpZiAoKHRoaXMuZWwgPT0gbnVsbCkgfHwgdGhpcy5lbC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkdyYXBoIGNvbnRhaW5lciBlbGVtZW50IG5vdCBmb3VuZCIpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmVsLmNzcygncG9zaXRpb24nKSA9PT0gJ3N0YXRpYycpIHsKICAgICAgICB0aGlzLmVsLmNzcygncG9zaXRpb24nLCAncmVsYXRpdmUnKTsKICAgICAgfQogICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgdGhpcy5ncmlkRGVmYXVsdHMsIHRoaXMuZGVmYXVsdHMgfHwge30sIG9wdGlvbnMpOwogICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy51bml0cyA9PT0gJ3N0cmluZycpIHsKICAgICAgICB0aGlzLm9wdGlvbnMucG9zdFVuaXRzID0gb3B0aW9ucy51bml0czsKICAgICAgfQogICAgICB0aGlzLnJhcGhhZWwgPSBuZXcgUmFwaGFlbCh0aGlzLmVsWzBdKTsKICAgICAgdGhpcy5lbGVtZW50V2lkdGggPSBudWxsOwogICAgICB0aGlzLmVsZW1lbnRIZWlnaHQgPSBudWxsOwogICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIHRoaXMuc2VsZWN0RnJvbSA9IG51bGw7CiAgICAgIGlmICh0aGlzLmluaXQpIHsKICAgICAgICB0aGlzLmluaXQoKTsKICAgICAgfQogICAgICB0aGlzLnNldERhdGEodGhpcy5vcHRpb25zLmRhdGEpOwogICAgICB0aGlzLmVsLmJpbmQoJ21vdXNlbW92ZScsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgIHZhciBsZWZ0LCBvZmZzZXQsIHJpZ2h0LCB3aWR0aCwgeDsKICAgICAgICBvZmZzZXQgPSBfdGhpcy5lbC5vZmZzZXQoKTsKICAgICAgICB4ID0gZXZ0LnBhZ2VYIC0gb2Zmc2V0LmxlZnQ7CiAgICAgICAgaWYgKF90aGlzLnNlbGVjdEZyb20pIHsKICAgICAgICAgIGxlZnQgPSBfdGhpcy5kYXRhW190aGlzLmhpdFRlc3QoTWF0aC5taW4oeCwgX3RoaXMuc2VsZWN0RnJvbSkpXS5feDsKICAgICAgICAgIHJpZ2h0ID0gX3RoaXMuZGF0YVtfdGhpcy5oaXRUZXN0KE1hdGgubWF4KHgsIF90aGlzLnNlbGVjdEZyb20pKV0uX3g7CiAgICAgICAgICB3aWR0aCA9IHJpZ2h0IC0gbGVmdDsKICAgICAgICAgIHJldHVybiBfdGhpcy5zZWxlY3Rpb25SZWN0LmF0dHIoewogICAgICAgICAgICB4OiBsZWZ0LAogICAgICAgICAgICB3aWR0aDogd2lkdGgKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMuZmlyZSgnaG92ZXJtb3ZlJywgeCwgZXZ0LnBhZ2VZIC0gb2Zmc2V0LnRvcCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5lbC5iaW5kKCdtb3VzZWxlYXZlJywgZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgaWYgKF90aGlzLnNlbGVjdEZyb20pIHsKICAgICAgICAgIF90aGlzLnNlbGVjdGlvblJlY3QuaGlkZSgpOwogICAgICAgICAgX3RoaXMuc2VsZWN0RnJvbSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfdGhpcy5maXJlKCdob3Zlcm91dCcpOwogICAgICB9KTsKICAgICAgdGhpcy5lbC5iaW5kKCd0b3VjaHN0YXJ0IHRvdWNobW92ZSB0b3VjaGVuZCcsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgIHZhciBvZmZzZXQsIHRvdWNoOwogICAgICAgIHRvdWNoID0gZXZ0Lm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXSB8fCBldnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXTsKICAgICAgICBvZmZzZXQgPSBfdGhpcy5lbC5vZmZzZXQoKTsKICAgICAgICByZXR1cm4gX3RoaXMuZmlyZSgnaG92ZXJtb3ZlJywgdG91Y2gucGFnZVggLSBvZmZzZXQubGVmdCwgdG91Y2gucGFnZVkgLSBvZmZzZXQudG9wKTsKICAgICAgfSk7CiAgICAgIHRoaXMuZWwuYmluZCgnY2xpY2snLCBmdW5jdGlvbihldnQpIHsKICAgICAgICB2YXIgb2Zmc2V0OwogICAgICAgIG9mZnNldCA9IF90aGlzLmVsLm9mZnNldCgpOwogICAgICAgIHJldHVybiBfdGhpcy5maXJlKCdncmlkY2xpY2snLCBldnQucGFnZVggLSBvZmZzZXQubGVmdCwgZXZ0LnBhZ2VZIC0gb2Zmc2V0LnRvcCk7CiAgICAgIH0pOwogICAgICBpZiAodGhpcy5vcHRpb25zLnJhbmdlU2VsZWN0KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25SZWN0ID0gdGhpcy5yYXBoYWVsLnJlY3QoMCwgMCwgMCwgdGhpcy5lbC5pbm5lckhlaWdodCgpKS5hdHRyKHsKICAgICAgICAgIGZpbGw6IHRoaXMub3B0aW9ucy5yYW5nZVNlbGVjdENvbG9yLAogICAgICAgICAgc3Ryb2tlOiBmYWxzZQogICAgICAgIH0pLnRvQmFjaygpLmhpZGUoKTsKICAgICAgICB0aGlzLmVsLmJpbmQoJ21vdXNlZG93bicsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgdmFyIG9mZnNldDsKICAgICAgICAgIG9mZnNldCA9IF90aGlzLmVsLm9mZnNldCgpOwogICAgICAgICAgcmV0dXJuIF90aGlzLnN0YXJ0UmFuZ2UoZXZ0LnBhZ2VYIC0gb2Zmc2V0LmxlZnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuZWwuYmluZCgnbW91c2V1cCcsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgdmFyIG9mZnNldDsKICAgICAgICAgIG9mZnNldCA9IF90aGlzLmVsLm9mZnNldCgpOwogICAgICAgICAgX3RoaXMuZW5kUmFuZ2UoZXZ0LnBhZ2VYIC0gb2Zmc2V0LmxlZnQpOwogICAgICAgICAgcmV0dXJuIF90aGlzLmZpcmUoJ2hvdmVybW92ZScsIGV2dC5wYWdlWCAtIG9mZnNldC5sZWZ0LCBldnQucGFnZVkgLSBvZmZzZXQudG9wKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAodGhpcy5vcHRpb25zLnJlc2l6ZSkgewogICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbihldnQpIHsKICAgICAgICAgIGlmIChfdGhpcy50aW1lb3V0SWQgIT0gbnVsbCkgewogICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KF90aGlzLnRpbWVvdXRJZCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX3RoaXMudGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoX3RoaXMucmVzaXplSGFuZGxlciwgMTAwKTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLmVsLmNzcygnLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yJywgJ3JnYmEoMCwwLDAsMCknKTsKICAgICAgaWYgKHRoaXMucG9zdEluaXQpIHsKICAgICAgICB0aGlzLnBvc3RJbml0KCk7CiAgICAgIH0KICAgIH0KCiAgICBHcmlkLnByb3RvdHlwZS5ncmlkRGVmYXVsdHMgPSB7CiAgICAgIGRhdGVGb3JtYXQ6IG51bGwsCiAgICAgIGF4ZXM6IHRydWUsCiAgICAgIGdyaWQ6IHRydWUsCiAgICAgIGdyaWRMaW5lQ29sb3I6ICcjYWFhJywKICAgICAgZ3JpZFN0cm9rZVdpZHRoOiAwLjUsCiAgICAgIGdyaWRUZXh0Q29sb3I6ICcjODg4JywKICAgICAgZ3JpZFRleHRTaXplOiAxMiwKICAgICAgZ3JpZFRleHRGYW1pbHk6ICdzYW5zLXNlcmlmJywKICAgICAgZ3JpZFRleHRXZWlnaHQ6ICdub3JtYWwnLAogICAgICBoaWRlSG92ZXI6IGZhbHNlLAogICAgICB5TGFiZWxGb3JtYXQ6IG51bGwsCiAgICAgIHhMYWJlbEFuZ2xlOiAwLAogICAgICBudW1MaW5lczogNSwKICAgICAgcGFkZGluZzogMjUsCiAgICAgIHBhcnNlVGltZTogdHJ1ZSwKICAgICAgcG9zdFVuaXRzOiAnJywKICAgICAgcHJlVW5pdHM6ICcnLAogICAgICB5bWF4OiAnYXV0bycsCiAgICAgIHltaW46ICdhdXRvIDAnLAogICAgICBnb2FsczogW10sCiAgICAgIGdvYWxTdHJva2VXaWR0aDogMS4wLAogICAgICBnb2FsTGluZUNvbG9yczogWycjNjY2NjMzJywgJyM5OTk5NjYnLCAnI2NjNjY2NicsICcjNjYzMzMzJ10sCiAgICAgIGV2ZW50czogW10sCiAgICAgIGV2ZW50U3Ryb2tlV2lkdGg6IDEuMCwKICAgICAgZXZlbnRMaW5lQ29sb3JzOiBbJyMwMDVhMDQnLCAnI2NjZmZiYicsICcjM2E1ZjBiJywgJyMwMDU1MDInXSwKICAgICAgcmFuZ2VTZWxlY3Q6IG51bGwsCiAgICAgIHJhbmdlU2VsZWN0Q29sb3I6ICcjZWVmJywKICAgICAgcmVzaXplOiBmYWxzZQogICAgfTsKCiAgICBHcmlkLnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24oZGF0YSwgcmVkcmF3KSB7CiAgICAgIHZhciBlLCBpZHgsIGluZGV4LCBtYXhHb2FsLCBtaW5Hb2FsLCByZXQsIHJvdywgc3RlcCwgdG90YWwsIHksIHlrZXksIHltYXgsIHltaW4sIHl2YWwsIF9yZWY7CiAgICAgIGlmIChyZWRyYXcgPT0gbnVsbCkgewogICAgICAgIHJlZHJhdyA9IHRydWU7CiAgICAgIH0KICAgICAgdGhpcy5vcHRpb25zLmRhdGEgPSBkYXRhOwogICAgICBpZiAoKGRhdGEgPT0gbnVsbCkgfHwgZGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgICB0aGlzLnJhcGhhZWwuY2xlYXIoKTsKICAgICAgICBpZiAodGhpcy5ob3ZlciAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLmhvdmVyLmhpZGUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHltYXggPSB0aGlzLmN1bXVsYXRpdmUgPyAwIDogbnVsbDsKICAgICAgeW1pbiA9IHRoaXMuY3VtdWxhdGl2ZSA\/IDAgOiBudWxsOwogICAgICBpZiAodGhpcy5vcHRpb25zLmdvYWxzLmxlbmd0aCA+IDApIHsKICAgICAgICBtaW5Hb2FsID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgdGhpcy5vcHRpb25zLmdvYWxzKTsKICAgICAgICBtYXhHb2FsID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgdGhpcy5vcHRpb25zLmdvYWxzKTsKICAgICAgICB5bWluID0geW1pbiAhPSBudWxsID8gTWF0aC5taW4oeW1pbiwgbWluR29hbCkgOiBtaW5Hb2FsOwogICAgICAgIHltYXggPSB5bWF4ICE9IG51bGwgPyBNYXRoLm1heCh5bWF4LCBtYXhHb2FsKSA6IG1heEdvYWw7CiAgICAgIH0KICAgICAgdGhpcy5kYXRhID0gKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfaSwgX2xlbiwgX3Jlc3VsdHM7CiAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICBmb3IgKGluZGV4ID0gX2kgPSAwLCBfbGVuID0gZGF0YS5sZW5ndGg7IF9pIDwgX2xlbjsgaW5kZXggPSArK19pKSB7CiAgICAgICAgICByb3cgPSBkYXRhW2luZGV4XTsKICAgICAgICAgIHJldCA9IHsKICAgICAgICAgICAgc3JjOiByb3cKICAgICAgICAgIH07CiAgICAgICAgICByZXQubGFiZWwgPSByb3dbdGhpcy5vcHRpb25zLnhrZXldOwogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5wYXJzZVRpbWUpIHsKICAgICAgICAgICAgcmV0LnggPSBNb3JyaXMucGFyc2VEYXRlKHJldC5sYWJlbCk7CiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGF0ZUZvcm1hdCkgewogICAgICAgICAgICAgIHJldC5sYWJlbCA9IHRoaXMub3B0aW9ucy5kYXRlRm9ybWF0KHJldC54KTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmV0LmxhYmVsID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgIHJldC5sYWJlbCA9IG5ldyBEYXRlKHJldC5sYWJlbCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0LnggPSBpbmRleDsKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy54TGFiZWxGb3JtYXQpIHsKICAgICAgICAgICAgICByZXQubGFiZWwgPSB0aGlzLm9wdGlvbnMueExhYmVsRm9ybWF0KHJldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRvdGFsID0gMDsKICAgICAgICAgIHJldC55ID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgX2osIF9sZW4xLCBfcmVmLCBfcmVzdWx0czE7CiAgICAgICAgICAgIF9yZWYgPSB0aGlzLm9wdGlvbnMueWtleXM7CiAgICAgICAgICAgIF9yZXN1bHRzMSA9IFtdOwogICAgICAgICAgICBmb3IgKGlkeCA9IF9qID0gMCwgX2xlbjEgPSBfcmVmLmxlbmd0aDsgX2ogPCBfbGVuMTsgaWR4ID0gKytfaikgewogICAgICAgICAgICAgIHlrZXkgPSBfcmVmW2lkeF07CiAgICAgICAgICAgICAgeXZhbCA9IHJvd1t5a2V5XTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHl2YWwgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICB5dmFsID0gcGFyc2VGbG9hdCh5dmFsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCh5dmFsICE9IG51bGwpICYmIHR5cGVvZiB5dmFsICE9PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgeXZhbCA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh5dmFsICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1bXVsYXRpdmUpIHsKICAgICAgICAgICAgICAgICAgdG90YWwgKz0geXZhbDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGlmICh5bWF4ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB5bWF4ID0gTWF0aC5tYXgoeXZhbCwgeW1heCk7CiAgICAgICAgICAgICAgICAgICAgeW1pbiA9IE1hdGgubWluKHl2YWwsIHltaW4pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHltYXggPSB5bWluID0geXZhbDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5jdW11bGF0aXZlICYmICh0b3RhbCAhPSBudWxsKSkgewogICAgICAgICAgICAgICAgeW1heCA9IE1hdGgubWF4KHRvdGFsLCB5bWF4KTsKICAgICAgICAgICAgICAgIHltaW4gPSBNYXRoLm1pbih0b3RhbCwgeW1pbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKHl2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7CiAgICAgICAgICB9KS5jYWxsKHRoaXMpOwogICAgICAgICAgX3Jlc3VsdHMucHVzaChyZXQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICAgIH0pLmNhbGwodGhpcyk7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMucGFyc2VUaW1lKSB7CiAgICAgICAgdGhpcy5kYXRhID0gdGhpcy5kYXRhLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgcmV0dXJuIChhLnggPiBiLngpIC0gKGIueCA+IGEueCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy54bWluID0gdGhpcy5kYXRhWzBdLng7CiAgICAgIHRoaXMueG1heCA9IHRoaXMuZGF0YVt0aGlzLmRhdGEubGVuZ3RoIC0gMV0ueDsKICAgICAgdGhpcy5ldmVudHMgPSBbXTsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5ldmVudHMubGVuZ3RoID4gMCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMucGFyc2VUaW1lKSB7CiAgICAgICAgICB0aGlzLmV2ZW50cyA9IChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0czsKICAgICAgICAgICAgX3JlZiA9IHRoaXMub3B0aW9ucy5ldmVudHM7CiAgICAgICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgICAgIGUgPSBfcmVmW19pXTsKICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKE1vcnJpcy5wYXJzZURhdGUoZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICAgIH0pLmNhbGwodGhpcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZXZlbnRzID0gdGhpcy5vcHRpb25zLmV2ZW50czsKICAgICAgICB9CiAgICAgICAgdGhpcy54bWF4ID0gTWF0aC5tYXgodGhpcy54bWF4LCBNYXRoLm1heC5hcHBseShNYXRoLCB0aGlzLmV2ZW50cykpOwogICAgICAgIHRoaXMueG1pbiA9IE1hdGgubWluKHRoaXMueG1pbiwgTWF0aC5taW4uYXBwbHkoTWF0aCwgdGhpcy5ldmVudHMpKTsKICAgICAgfQogICAgICBpZiAodGhpcy54bWluID09PSB0aGlzLnhtYXgpIHsKICAgICAgICB0aGlzLnhtaW4gLT0gMTsKICAgICAgICB0aGlzLnhtYXggKz0gMTsKICAgICAgfQogICAgICB0aGlzLnltaW4gPSB0aGlzLnlib3VuZGFyeSgnbWluJywgeW1pbik7CiAgICAgIHRoaXMueW1heCA9IHRoaXMueWJvdW5kYXJ5KCdtYXgnLCB5bWF4KTsKICAgICAgaWYgKHRoaXMueW1pbiA9PT0gdGhpcy55bWF4KSB7CiAgICAgICAgaWYgKHltaW4pIHsKICAgICAgICAgIHRoaXMueW1pbiAtPSAxOwogICAgICAgIH0KICAgICAgICB0aGlzLnltYXggKz0gMTsKICAgICAgfQogICAgICBpZiAoKChfcmVmID0gdGhpcy5vcHRpb25zLmF4ZXMpID09PSB0cnVlIHx8IF9yZWYgPT09ICdib3RoJyB8fCBfcmVmID09PSAneScpIHx8IHRoaXMub3B0aW9ucy5ncmlkID09PSB0cnVlKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy55bWF4ID09PSB0aGlzLmdyaWREZWZhdWx0cy55bWF4ICYmIHRoaXMub3B0aW9ucy55bWluID09PSB0aGlzLmdyaWREZWZhdWx0cy55bWluKSB7CiAgICAgICAgICB0aGlzLmdyaWQgPSB0aGlzLmF1dG9HcmlkTGluZXModGhpcy55bWluLCB0aGlzLnltYXgsIHRoaXMub3B0aW9ucy5udW1MaW5lcyk7CiAgICAgICAgICB0aGlzLnltaW4gPSBNYXRoLm1pbih0aGlzLnltaW4sIHRoaXMuZ3JpZFswXSk7CiAgICAgICAgICB0aGlzLnltYXggPSBNYXRoLm1heCh0aGlzLnltYXgsIHRoaXMuZ3JpZFt0aGlzLmdyaWQubGVuZ3RoIC0gMV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdGVwID0gKHRoaXMueW1heCAtIHRoaXMueW1pbikgLyAodGhpcy5vcHRpb25zLm51bUxpbmVzIC0gMSk7CiAgICAgICAgICB0aGlzLmdyaWQgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfaSwgX3JlZjEsIF9yZWYyLCBfcmVzdWx0czsKICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgZm9yICh5ID0gX2kgPSBfcmVmMSA9IHRoaXMueW1pbiwgX3JlZjIgPSB0aGlzLnltYXg7IHN0ZXAgPiAwID8gX2kgPD0gX3JlZjIgOiBfaSA+PSBfcmVmMjsgeSA9IF9pICs9IHN0ZXApIHsKICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICAgIH0pLmNhbGwodGhpcyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgICBpZiAocmVkcmF3KSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVkcmF3KCk7CiAgICAgIH0KICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUueWJvdW5kYXJ5ID0gZnVuY3Rpb24oYm91bmRhcnlUeXBlLCBjdXJyZW50VmFsdWUpIHsKICAgICAgdmFyIGJvdW5kYXJ5T3B0aW9uLCBzdWdnZXN0ZWRWYWx1ZTsKICAgICAgYm91bmRhcnlPcHRpb24gPSB0aGlzLm9wdGlvbnNbInkiICsgYm91bmRhcnlUeXBlXTsKICAgICAgaWYgKHR5cGVvZiBib3VuZGFyeU9wdGlvbiA9PT0gJ3N0cmluZycpIHsKICAgICAgICBpZiAoYm91bmRhcnlPcHRpb24uc2xpY2UoMCwgNCkgPT09ICdhdXRvJykgewogICAgICAgICAgaWYgKGJvdW5kYXJ5T3B0aW9uLmxlbmd0aCA+IDUpIHsKICAgICAgICAgICAgc3VnZ2VzdGVkVmFsdWUgPSBwYXJzZUludChib3VuZGFyeU9wdGlvbi5zbGljZSg1KSwgMTApOwogICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gc3VnZ2VzdGVkVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIE1hdGhbYm91bmRhcnlUeXBlXShjdXJyZW50VmFsdWUsIHN1Z2dlc3RlZFZhbHVlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBjdXJyZW50VmFsdWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGJvdW5kYXJ5T3B0aW9uLCAxMCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBib3VuZGFyeU9wdGlvbjsKICAgICAgfQogICAgfTsKCiAgICBHcmlkLnByb3RvdHlwZS5hdXRvR3JpZExpbmVzID0gZnVuY3Rpb24oeW1pbiwgeW1heCwgbmxpbmVzKSB7CiAgICAgIHZhciBnbWF4LCBnbWluLCBncmlkLCBzbWFnLCBzcGFuLCBzdGVwLCB1bml0LCB5LCB5bWFnOwogICAgICBzcGFuID0geW1heCAtIHltaW47CiAgICAgIHltYWcgPSBNYXRoLmZsb29yKE1hdGgubG9nKHNwYW4pIC8gTWF0aC5sb2coMTApKTsKICAgICAgdW5pdCA9IE1hdGgucG93KDEwLCB5bWFnKTsKICAgICAgZ21pbiA9IE1hdGguZmxvb3IoeW1pbiAvIHVuaXQpICogdW5pdDsKICAgICAgZ21heCA9IE1hdGguY2VpbCh5bWF4IC8gdW5pdCkgKiB1bml0OwogICAgICBzdGVwID0gKGdtYXggLSBnbWluKSAvIChubGluZXMgLSAxKTsKICAgICAgaWYgKHVuaXQgPT09IDEgJiYgc3RlcCA+IDEgJiYgTWF0aC5jZWlsKHN0ZXApICE9PSBzdGVwKSB7CiAgICAgICAgc3RlcCA9IE1hdGguY2VpbChzdGVwKTsKICAgICAgICBnbWF4ID0gZ21pbiArIHN0ZXAgKiAobmxpbmVzIC0gMSk7CiAgICAgIH0KICAgICAgaWYgKGdtaW4gPCAwICYmIGdtYXggPiAwKSB7CiAgICAgICAgZ21pbiA9IE1hdGguZmxvb3IoeW1pbiAvIHN0ZXApICogc3RlcDsKICAgICAgICBnbWF4ID0gTWF0aC5jZWlsKHltYXggLyBzdGVwKSAqIHN0ZXA7CiAgICAgIH0KICAgICAgaWYgKHN0ZXAgPCAxKSB7CiAgICAgICAgc21hZyA9IE1hdGguZmxvb3IoTWF0aC5sb2coc3RlcCkgLyBNYXRoLmxvZygxMCkpOwogICAgICAgIGdyaWQgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2ksIF9yZXN1bHRzOwogICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgIGZvciAoeSA9IF9pID0gZ21pbjsgc3RlcCA+IDAgPyBfaSA8PSBnbWF4IDogX2kgPj0gZ21heDsgeSA9IF9pICs9IHN0ZXApIHsKICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChwYXJzZUZsb2F0KHkudG9GaXhlZCgxIC0gc21hZykpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICB9KSgpOwogICAgICB9IGVsc2UgewogICAgICAgIGdyaWQgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2ksIF9yZXN1bHRzOwogICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgIGZvciAoeSA9IF9pID0gZ21pbjsgc3RlcCA+IDAgPyBfaSA8PSBnbWF4IDogX2kgPj0gZ21heDsgeSA9IF9pICs9IHN0ZXApIHsKICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh5KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICB9KSgpOwogICAgICB9CiAgICAgIHJldHVybiBncmlkOwogICAgfTsKCiAgICBHcmlkLnByb3RvdHlwZS5fY2FsYyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYm90dG9tT2Zmc2V0cywgZ3JpZExpbmUsIGgsIGksIHcsIHlMYWJlbFdpZHRocywgX3JlZiwgX3JlZjE7CiAgICAgIHcgPSB0aGlzLmVsLndpZHRoKCk7CiAgICAgIGggPSB0aGlzLmVsLmhlaWdodCgpOwogICAgICBpZiAodGhpcy5lbGVtZW50V2lkdGggIT09IHcgfHwgdGhpcy5lbGVtZW50SGVpZ2h0ICE9PSBoIHx8IHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLmVsZW1lbnRXaWR0aCA9IHc7CiAgICAgICAgdGhpcy5lbGVtZW50SGVpZ2h0ID0gaDsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgICAgdGhpcy5sZWZ0ID0gdGhpcy5vcHRpb25zLnBhZGRpbmc7CiAgICAgICAgdGhpcy5yaWdodCA9IHRoaXMuZWxlbWVudFdpZHRoIC0gdGhpcy5vcHRpb25zLnBhZGRpbmc7CiAgICAgICAgdGhpcy50b3AgPSB0aGlzLm9wdGlvbnMucGFkZGluZzsKICAgICAgICB0aGlzLmJvdHRvbSA9IHRoaXMuZWxlbWVudEhlaWdodCAtIHRoaXMub3B0aW9ucy5wYWRkaW5nOwogICAgICAgIGlmICgoX3JlZiA9IHRoaXMub3B0aW9ucy5heGVzKSA9PT0gdHJ1ZSB8fCBfcmVmID09PSAnYm90aCcgfHwgX3JlZiA9PT0gJ3knKSB7CiAgICAgICAgICB5TGFiZWxXaWR0aHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZjEsIF9yZXN1bHRzOwogICAgICAgICAgICBfcmVmMSA9IHRoaXMuZ3JpZDsKICAgICAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmMS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgICAgIGdyaWRMaW5lID0gX3JlZjFbX2ldOwogICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5tZWFzdXJlVGV4dCh0aGlzLnlBeGlzRm9ybWF0KGdyaWRMaW5lKSkud2lkdGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICAgIH0pLmNhbGwodGhpcyk7CiAgICAgICAgICB0aGlzLmxlZnQgKz0gTWF0aC5tYXguYXBwbHkoTWF0aCwgeUxhYmVsV2lkdGhzKTsKICAgICAgICB9CiAgICAgICAgaWYgKChfcmVmMSA9IHRoaXMub3B0aW9ucy5heGVzKSA9PT0gdHJ1ZSB8fCBfcmVmMSA9PT0gJ2JvdGgnIHx8IF9yZWYxID09PSAneCcpIHsKICAgICAgICAgIGJvdHRvbU9mZnNldHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfaSwgX3JlZjIsIF9yZXN1bHRzOwogICAgICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgICAgICBmb3IgKGkgPSBfaSA9IDAsIF9yZWYyID0gdGhpcy5kYXRhLmxlbmd0aDsgMCA8PSBfcmVmMiA\/IF9pIDwgX3JlZjIgOiBfaSA+IF9yZWYyOyBpID0gMCA8PSBfcmVmMiA\/ICsrX2kgOiAtLV9pKSB7CiAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLm1lYXN1cmVUZXh0KHRoaXMuZGF0YVtpXS50ZXh0LCAtdGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlKS5oZWlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICAgIH0pLmNhbGwodGhpcyk7CiAgICAgICAgICB0aGlzLmJvdHRvbSAtPSBNYXRoLm1heC5hcHBseShNYXRoLCBib3R0b21PZmZzZXRzKTsKICAgICAgICB9CiAgICAgICAgdGhpcy53aWR0aCA9IE1hdGgubWF4KDEsIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQpOwogICAgICAgIHRoaXMuaGVpZ2h0ID0gTWF0aC5tYXgoMSwgdGhpcy5ib3R0b20gLSB0aGlzLnRvcCk7CiAgICAgICAgdGhpcy5keCA9IHRoaXMud2lkdGggLyAodGhpcy54bWF4IC0gdGhpcy54bWluKTsKICAgICAgICB0aGlzLmR5ID0gdGhpcy5oZWlnaHQgLyAodGhpcy55bWF4IC0gdGhpcy55bWluKTsKICAgICAgICBpZiAodGhpcy5jYWxjKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jYWxjKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIEdyaWQucHJvdG90eXBlLnRyYW5zWSA9IGZ1bmN0aW9uKHkpIHsKICAgICAgcmV0dXJuIHRoaXMuYm90dG9tIC0gKHkgLSB0aGlzLnltaW4pICogdGhpcy5keTsKICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUudHJhbnNYID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAodGhpcy5kYXRhLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHJldHVybiAodGhpcy5sZWZ0ICsgdGhpcy5yaWdodCkgLyAyOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLmxlZnQgKyAoeCAtIHRoaXMueG1pbikgKiB0aGlzLmR4OwogICAgICB9CiAgICB9OwoKICAgIEdyaWQucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnJhcGhhZWwuY2xlYXIoKTsKICAgICAgdGhpcy5fY2FsYygpOwogICAgICB0aGlzLmRyYXdHcmlkKCk7CiAgICAgIHRoaXMuZHJhd0dvYWxzKCk7CiAgICAgIHRoaXMuZHJhd0V2ZW50cygpOwogICAgICBpZiAodGhpcy5kcmF3KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZHJhdygpOwogICAgICB9CiAgICB9OwoKICAgIEdyaWQucHJvdG90eXBlLm1lYXN1cmVUZXh0ID0gZnVuY3Rpb24odGV4dCwgYW5nbGUpIHsKICAgICAgdmFyIHJldCwgdHQ7CiAgICAgIGlmIChhbmdsZSA9PSBudWxsKSB7CiAgICAgICAgYW5nbGUgPSAwOwogICAgICB9CiAgICAgIHR0ID0gdGhpcy5yYXBoYWVsLnRleHQoMTAwLCAxMDAsIHRleHQpLmF0dHIoJ2ZvbnQtc2l6ZScsIHRoaXMub3B0aW9ucy5ncmlkVGV4dFNpemUpLmF0dHIoJ2ZvbnQtZmFtaWx5JywgdGhpcy5vcHRpb25zLmdyaWRUZXh0RmFtaWx5KS5hdHRyKCdmb250LXdlaWdodCcsIHRoaXMub3B0aW9ucy5ncmlkVGV4dFdlaWdodCkucm90YXRlKGFuZ2xlKTsKICAgICAgcmV0ID0gdHQuZ2V0QkJveCgpOwogICAgICB0dC5yZW1vdmUoKTsKICAgICAgcmV0dXJuIHJldDsKICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUueUF4aXNGb3JtYXQgPSBmdW5jdGlvbihsYWJlbCkgewogICAgICByZXR1cm4gdGhpcy55TGFiZWxGb3JtYXQobGFiZWwpOwogICAgfTsKCiAgICBHcmlkLnByb3RvdHlwZS55TGFiZWxGb3JtYXQgPSBmdW5jdGlvbihsYWJlbCkgewogICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy55TGFiZWxGb3JtYXQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnlMYWJlbEZvcm1hdChsYWJlbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiICsgdGhpcy5vcHRpb25zLnByZVVuaXRzICsgKE1vcnJpcy5jb21tYXMobGFiZWwpKSArIHRoaXMub3B0aW9ucy5wb3N0VW5pdHM7CiAgICAgIH0KICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUuZHJhd0dyaWQgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGxpbmVZLCB5LCBfaSwgX2xlbiwgX3JlZiwgX3JlZjEsIF9yZWYyLCBfcmVzdWx0czsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5ncmlkID09PSBmYWxzZSAmJiAoKF9yZWYgPSB0aGlzLm9wdGlvbnMuYXhlcykgIT09IHRydWUgJiYgX3JlZiAhPT0gJ2JvdGgnICYmIF9yZWYgIT09ICd5JykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgX3JlZjEgPSB0aGlzLmdyaWQ7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZjEubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBsaW5lWSA9IF9yZWYxW19pXTsKICAgICAgICB5ID0gdGhpcy50cmFuc1kobGluZVkpOwogICAgICAgIGlmICgoX3JlZjIgPSB0aGlzLm9wdGlvbnMuYXhlcykgPT09IHRydWUgfHwgX3JlZjIgPT09ICdib3RoJyB8fCBfcmVmMiA9PT0gJ3knKSB7CiAgICAgICAgICB0aGlzLmRyYXdZQXhpc0xhYmVsKHRoaXMubGVmdCAtIHRoaXMub3B0aW9ucy5wYWRkaW5nIC8gMiwgeSwgdGhpcy55QXhpc0Zvcm1hdChsaW5lWSkpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5vcHRpb25zLmdyaWQpIHsKICAgICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5kcmF3R3JpZExpbmUoIk0iICsgdGhpcy5sZWZ0ICsgIiwiICsgeSArICJIIiArICh0aGlzLmxlZnQgKyB0aGlzLndpZHRoKSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBfcmVzdWx0czsKICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUuZHJhd0dvYWxzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjb2xvciwgZ29hbCwgaSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzOwogICAgICBfcmVmID0gdGhpcy5vcHRpb25zLmdvYWxzOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkgewogICAgICAgIGdvYWwgPSBfcmVmW2ldOwogICAgICAgIGNvbG9yID0gdGhpcy5vcHRpb25zLmdvYWxMaW5lQ29sb3JzW2kgJSB0aGlzLm9wdGlvbnMuZ29hbExpbmVDb2xvcnMubGVuZ3RoXTsKICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuZHJhd0dvYWwoZ29hbCwgY29sb3IpKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIEdyaWQucHJvdG90eXBlLmRyYXdFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNvbG9yLCBldmVudCwgaSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzOwogICAgICBfcmVmID0gdGhpcy5ldmVudHM7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoaSA9IF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IGkgPSArK19pKSB7CiAgICAgICAgZXZlbnQgPSBfcmVmW2ldOwogICAgICAgIGNvbG9yID0gdGhpcy5vcHRpb25zLmV2ZW50TGluZUNvbG9yc1tpICUgdGhpcy5vcHRpb25zLmV2ZW50TGluZUNvbG9ycy5sZW5ndGhdOwogICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy5kcmF3RXZlbnQoZXZlbnQsIGNvbG9yKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBHcmlkLnByb3RvdHlwZS5kcmF3R29hbCA9IGZ1bmN0aW9uKGdvYWwsIGNvbG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnJhcGhhZWwucGF0aCgiTSIgKyB0aGlzLmxlZnQgKyAiLCIgKyAodGhpcy50cmFuc1koZ29hbCkpICsgIkgiICsgdGhpcy5yaWdodCkuYXR0cignc3Ryb2tlJywgY29sb3IpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIHRoaXMub3B0aW9ucy5nb2FsU3Ryb2tlV2lkdGgpOwogICAgfTsKCiAgICBHcmlkLnByb3RvdHlwZS5kcmF3RXZlbnQgPSBmdW5jdGlvbihldmVudCwgY29sb3IpIHsKICAgICAgcmV0dXJuIHRoaXMucmFwaGFlbC5wYXRoKCJNIiArICh0aGlzLnRyYW5zWChldmVudCkpICsgIiwiICsgdGhpcy5ib3R0b20gKyAiViIgKyB0aGlzLnRvcCkuYXR0cignc3Ryb2tlJywgY29sb3IpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIHRoaXMub3B0aW9ucy5ldmVudFN0cm9rZVdpZHRoKTsKICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUuZHJhd1lBeGlzTGFiZWwgPSBmdW5jdGlvbih4UG9zLCB5UG9zLCB0ZXh0KSB7CiAgICAgIHJldHVybiB0aGlzLnJhcGhhZWwudGV4dCh4UG9zLCB5UG9zLCB0ZXh0KS5hdHRyKCdmb250LXNpemUnLCB0aGlzLm9wdGlvbnMuZ3JpZFRleHRTaXplKS5hdHRyKCdmb250LWZhbWlseScsIHRoaXMub3B0aW9ucy5ncmlkVGV4dEZhbWlseSkuYXR0cignZm9udC13ZWlnaHQnLCB0aGlzLm9wdGlvbnMuZ3JpZFRleHRXZWlnaHQpLmF0dHIoJ2ZpbGwnLCB0aGlzLm9wdGlvbnMuZ3JpZFRleHRDb2xvcikuYXR0cigndGV4dC1hbmNob3InLCAnZW5kJyk7CiAgICB9OwoKICAgIEdyaWQucHJvdG90eXBlLmRyYXdHcmlkTGluZSA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgcmV0dXJuIHRoaXMucmFwaGFlbC5wYXRoKHBhdGgpLmF0dHIoJ3N0cm9rZScsIHRoaXMub3B0aW9ucy5ncmlkTGluZUNvbG9yKS5hdHRyKCdzdHJva2Utd2lkdGgnLCB0aGlzLm9wdGlvbnMuZ3JpZFN0cm9rZVdpZHRoKTsKICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUuc3RhcnRSYW5nZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgdGhpcy5ob3Zlci5oaWRlKCk7CiAgICAgIHRoaXMuc2VsZWN0RnJvbSA9IHg7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblJlY3QuYXR0cih7CiAgICAgICAgeDogeCwKICAgICAgICB3aWR0aDogMAogICAgICB9KS5zaG93KCk7CiAgICB9OwoKICAgIEdyaWQucHJvdG90eXBlLmVuZFJhbmdlID0gZnVuY3Rpb24oeCkgewogICAgICB2YXIgZW5kLCBzdGFydDsKICAgICAgaWYgKHRoaXMuc2VsZWN0RnJvbSkgewogICAgICAgIHN0YXJ0ID0gTWF0aC5taW4odGhpcy5zZWxlY3RGcm9tLCB4KTsKICAgICAgICBlbmQgPSBNYXRoLm1heCh0aGlzLnNlbGVjdEZyb20sIHgpOwogICAgICAgIHRoaXMub3B0aW9ucy5yYW5nZVNlbGVjdC5jYWxsKHRoaXMuZWwsIHsKICAgICAgICAgIHN0YXJ0OiB0aGlzLmRhdGFbdGhpcy5oaXRUZXN0KHN0YXJ0KV0ueCwKICAgICAgICAgIGVuZDogdGhpcy5kYXRhW3RoaXMuaGl0VGVzdChlbmQpXS54CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0RnJvbSA9IG51bGw7CiAgICAgIH0KICAgIH07CgogICAgR3JpZC5wcm90b3R5cGUucmVzaXplSGFuZGxlciA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRpbWVvdXRJZCA9IG51bGw7CiAgICAgIHRoaXMucmFwaGFlbC5zZXRTaXplKHRoaXMuZWwud2lkdGgoKSwgdGhpcy5lbC5oZWlnaHQoKSk7CiAgICAgIHJldHVybiB0aGlzLnJlZHJhdygpOwogICAgfTsKCiAgICByZXR1cm4gR3JpZDsKCiAgfSkoTW9ycmlzLkV2ZW50RW1pdHRlcik7CgogIE1vcnJpcy5wYXJzZURhdGUgPSBmdW5jdGlvbihkYXRlKSB7CiAgICB2YXIgaXNlY3MsIG0sIG1zZWNzLCBuLCBvLCBvZmZzZXRtaW5zLCBwLCBxLCByLCByZXQsIHNlY3M7CiAgICBpZiAodHlwZW9mIGRhdGUgPT09ICdudW1iZXInKSB7CiAgICAgIHJldHVybiBkYXRlOwogICAgfQogICAgbSA9IGRhdGUubWF0Y2goL14oXGQrKSBRKFxkKSQvKTsKICAgIG4gPSBkYXRlLm1hdGNoKC9eKFxkKyktKFxkKykkLyk7CiAgICBvID0gZGF0ZS5tYXRjaCgvXihcZCspLShcZCspLShcZCspJC8pOwogICAgcCA9IGRhdGUubWF0Y2goL14oXGQrKSBXKFxkKykkLyk7CiAgICBxID0gZGF0ZS5tYXRjaCgvXihcZCspLShcZCspLShcZCspWyBUXShcZCspOihcZCspKFp8KFsrLV0pKFxkXGQpOj8oXGRcZCkpPyQvKTsKICAgIHIgPSBkYXRlLm1hdGNoKC9eKFxkKyktKFxkKyktKFxkKylbIFRdKFxkKyk6KFxkKyk6KFxkKyhcLlxkKyk\/KShafChbKy1dKShcZFxkKTo\/KFxkXGQpKT8kLyk7CiAgICBpZiAobSkgewogICAgICByZXR1cm4gbmV3IERhdGUocGFyc2VJbnQobVsxXSwgMTApLCBwYXJzZUludChtWzJdLCAxMCkgKiAzIC0gMSwgMSkuZ2V0VGltZSgpOwogICAgfSBlbHNlIGlmIChuKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShwYXJzZUludChuWzFdLCAxMCksIHBhcnNlSW50KG5bMl0sIDEwKSAtIDEsIDEpLmdldFRpbWUoKTsKICAgIH0gZWxzZSBpZiAobykgewogICAgICByZXR1cm4gbmV3IERhdGUocGFyc2VJbnQob1sxXSwgMTApLCBwYXJzZUludChvWzJdLCAxMCkgLSAxLCBwYXJzZUludChvWzNdLCAxMCkpLmdldFRpbWUoKTsKICAgIH0gZWxzZSBpZiAocCkgewogICAgICByZXQgPSBuZXcgRGF0ZShwYXJzZUludChwWzFdLCAxMCksIDAsIDEpOwogICAgICBpZiAocmV0LmdldERheSgpICE9PSA0KSB7CiAgICAgICAgcmV0LnNldE1vbnRoKDAsIDEgKyAoKDQgLSByZXQuZ2V0RGF5KCkpICsgNykgJSA3KTsKICAgICAgfQogICAgICByZXR1cm4gcmV0LmdldFRpbWUoKSArIHBhcnNlSW50KHBbMl0sIDEwKSAqIDYwNDgwMDAwMDsKICAgIH0gZWxzZSBpZiAocSkgewogICAgICBpZiAoIXFbNl0pIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUocGFyc2VJbnQocVsxXSwgMTApLCBwYXJzZUludChxWzJdLCAxMCkgLSAxLCBwYXJzZUludChxWzNdLCAxMCksIHBhcnNlSW50KHFbNF0sIDEwKSwgcGFyc2VJbnQocVs1XSwgMTApKS5nZXRUaW1lKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2Zmc2V0bWlucyA9IDA7CiAgICAgICAgaWYgKHFbNl0gIT09ICdaJykgewogICAgICAgICAgb2Zmc2V0bWlucyA9IHBhcnNlSW50KHFbOF0sIDEwKSAqIDYwICsgcGFyc2VJbnQocVs5XSwgMTApOwogICAgICAgICAgaWYgKHFbN10gPT09ICcrJykgewogICAgICAgICAgICBvZmZzZXRtaW5zID0gMCAtIG9mZnNldG1pbnM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBEYXRlLlVUQyhwYXJzZUludChxWzFdLCAxMCksIHBhcnNlSW50KHFbMl0sIDEwKSAtIDEsIHBhcnNlSW50KHFbM10sIDEwKSwgcGFyc2VJbnQocVs0XSwgMTApLCBwYXJzZUludChxWzVdLCAxMCkgKyBvZmZzZXRtaW5zKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChyKSB7CiAgICAgIHNlY3MgPSBwYXJzZUZsb2F0KHJbNl0pOwogICAgICBpc2VjcyA9IE1hdGguZmxvb3Ioc2Vjcyk7CiAgICAgIG1zZWNzID0gTWF0aC5yb3VuZCgoc2VjcyAtIGlzZWNzKSAqIDEwMDApOwogICAgICBpZiAoIXJbOF0pIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUocGFyc2VJbnQoclsxXSwgMTApLCBwYXJzZUludChyWzJdLCAxMCkgLSAxLCBwYXJzZUludChyWzNdLCAxMCksIHBhcnNlSW50KHJbNF0sIDEwKSwgcGFyc2VJbnQocls1XSwgMTApLCBpc2VjcywgbXNlY3MpLmdldFRpbWUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvZmZzZXRtaW5zID0gMDsKICAgICAgICBpZiAocls4XSAhPT0gJ1onKSB7CiAgICAgICAgICBvZmZzZXRtaW5zID0gcGFyc2VJbnQoclsxMF0sIDEwKSAqIDYwICsgcGFyc2VJbnQoclsxMV0sIDEwKTsKICAgICAgICAgIGlmIChyWzldID09PSAnKycpIHsKICAgICAgICAgICAgb2Zmc2V0bWlucyA9IDAgLSBvZmZzZXRtaW5zOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gRGF0ZS5VVEMocGFyc2VJbnQoclsxXSwgMTApLCBwYXJzZUludChyWzJdLCAxMCkgLSAxLCBwYXJzZUludChyWzNdLCAxMCksIHBhcnNlSW50KHJbNF0sIDEwKSwgcGFyc2VJbnQocls1XSwgMTApICsgb2Zmc2V0bWlucywgaXNlY3MsIG1zZWNzKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKHBhcnNlSW50KGRhdGUsIDEwKSwgMCwgMSkuZ2V0VGltZSgpOwogICAgfQogIH07CgogIE1vcnJpcy5Ib3ZlciA9IChmdW5jdGlvbigpIHsKICAgIEhvdmVyLmRlZmF1bHRzID0gewogICAgICAiY2xhc3MiOiAnbW9ycmlzLWhvdmVyIG1vcnJpcy1kZWZhdWx0LXN0eWxlJwogICAgfTsKCiAgICBmdW5jdGlvbiBIb3ZlcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09IG51bGwpIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIE1vcnJpcy5Ib3Zlci5kZWZhdWx0cywgb3B0aW9ucyk7CiAgICAgIHRoaXMuZWwgPSAkKCI8ZGl2IGNsYXNzPSciICsgdGhpcy5vcHRpb25zWyJjbGFzcyJdICsgIic+PC9kaXY+Iik7CiAgICAgIHRoaXMuZWwuaGlkZSgpOwogICAgICB0aGlzLm9wdGlvbnMucGFyZW50LmFwcGVuZCh0aGlzLmVsKTsKICAgIH0KCiAgICBIb3Zlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oaHRtbCwgeCwgeSkgewogICAgICBpZiAoIWh0bWwpIHsKICAgICAgICByZXR1cm4gdGhpcy5oaWRlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5odG1sKGh0bWwpOwogICAgICAgIHRoaXMuc2hvdygpOwogICAgICAgIHJldHVybiB0aGlzLm1vdmVUbyh4LCB5KTsKICAgICAgfQogICAgfTsKCiAgICBIb3Zlci5wcm90b3R5cGUuaHRtbCA9IGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgcmV0dXJuIHRoaXMuZWwuaHRtbChjb250ZW50KTsKICAgIH07CgogICAgSG92ZXIucHJvdG90eXBlLm1vdmVUbyA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgdmFyIGhvdmVySGVpZ2h0LCBob3ZlcldpZHRoLCBsZWZ0LCBwYXJlbnRIZWlnaHQsIHBhcmVudFdpZHRoLCB0b3A7CiAgICAgIHBhcmVudFdpZHRoID0gdGhpcy5vcHRpb25zLnBhcmVudC5pbm5lcldpZHRoKCk7CiAgICAgIHBhcmVudEhlaWdodCA9IHRoaXMub3B0aW9ucy5wYXJlbnQuaW5uZXJIZWlnaHQoKTsKICAgICAgaG92ZXJXaWR0aCA9IHRoaXMuZWwub3V0ZXJXaWR0aCgpOwogICAgICBob3ZlckhlaWdodCA9IHRoaXMuZWwub3V0ZXJIZWlnaHQoKTsKICAgICAgbGVmdCA9IE1hdGgubWluKE1hdGgubWF4KDAsIHggLSBob3ZlcldpZHRoIC8gMiksIHBhcmVudFdpZHRoIC0gaG92ZXJXaWR0aCk7CiAgICAgIGlmICh5ICE9IG51bGwpIHsKICAgICAgICB0b3AgPSB5IC0gaG92ZXJIZWlnaHQgLSAxMDsKICAgICAgICBpZiAodG9wIDwgMCkgewogICAgICAgICAgdG9wID0geSArIDEwOwogICAgICAgICAgaWYgKHRvcCArIGhvdmVySGVpZ2h0ID4gcGFyZW50SGVpZ2h0KSB7CiAgICAgICAgICAgIHRvcCA9IHBhcmVudEhlaWdodCAvIDIgLSBob3ZlckhlaWdodCAvIDI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRvcCA9IHBhcmVudEhlaWdodCAvIDIgLSBob3ZlckhlaWdodCAvIDI7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZWwuY3NzKHsKICAgICAgICBsZWZ0OiBsZWZ0ICsgInB4IiwKICAgICAgICB0b3A6IHBhcnNlSW50KHRvcCkgKyAicHgiCiAgICAgIH0pOwogICAgfTsKCiAgICBIb3Zlci5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5lbC5zaG93KCk7CiAgICB9OwoKICAgIEhvdmVyLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmVsLmhpZGUoKTsKICAgIH07CgogICAgcmV0dXJuIEhvdmVyOwoKICB9KSgpOwoKICBNb3JyaXMuTGluZSA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhMaW5lLCBfc3VwZXIpOwoKICAgIGZ1bmN0aW9uIExpbmUob3B0aW9ucykgewogICAgICB0aGlzLmhpbGlnaHQgPSBfX2JpbmQodGhpcy5oaWxpZ2h0LCB0aGlzKTsKICAgICAgdGhpcy5vbkhvdmVyT3V0ID0gX19iaW5kKHRoaXMub25Ib3Zlck91dCwgdGhpcyk7CiAgICAgIHRoaXMub25Ib3Zlck1vdmUgPSBfX2JpbmQodGhpcy5vbkhvdmVyTW92ZSwgdGhpcyk7CiAgICAgIHRoaXMub25HcmlkQ2xpY2sgPSBfX2JpbmQodGhpcy5vbkdyaWRDbGljaywgdGhpcyk7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBNb3JyaXMuTGluZSkpIHsKICAgICAgICByZXR1cm4gbmV3IE1vcnJpcy5MaW5lKG9wdGlvbnMpOwogICAgICB9CiAgICAgIExpbmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgb3B0aW9ucyk7CiAgICB9CgogICAgTGluZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5vcHRpb25zLmhpZGVIb3ZlciAhPT0gJ2Fsd2F5cycpIHsKICAgICAgICB0aGlzLmhvdmVyID0gbmV3IE1vcnJpcy5Ib3Zlcih7CiAgICAgICAgICBwYXJlbnQ6IHRoaXMuZWwKICAgICAgICB9KTsKICAgICAgICB0aGlzLm9uKCdob3Zlcm1vdmUnLCB0aGlzLm9uSG92ZXJNb3ZlKTsKICAgICAgICB0aGlzLm9uKCdob3Zlcm91dCcsIHRoaXMub25Ib3Zlck91dCk7CiAgICAgICAgcmV0dXJuIHRoaXMub24oJ2dyaWRjbGljaycsIHRoaXMub25HcmlkQ2xpY2spOwogICAgICB9CiAgICB9OwoKICAgIExpbmUucHJvdG90eXBlLmRlZmF1bHRzID0gewogICAgICBsaW5lV2lkdGg6IDMsCiAgICAgIHBvaW50U2l6ZTogNCwKICAgICAgbGluZUNvbG9yczogWycjMGI2MmE0JywgJyM3QTkyQTMnLCAnIzRkYTc0ZCcsICcjYWZkOGY4JywgJyNlZGMyNDAnLCAnI2NiNGI0YicsICcjOTQ0MGVkJ10sCiAgICAgIHBvaW50U3Ryb2tlV2lkdGhzOiBbMV0sCiAgICAgIHBvaW50U3Ryb2tlQ29sb3JzOiBbJyNmZmZmZmYnXSwKICAgICAgcG9pbnRGaWxsQ29sb3JzOiBbXSwKICAgICAgc21vb3RoOiB0cnVlLAogICAgICB4TGFiZWxzOiAnYXV0bycsCiAgICAgIHhMYWJlbEZvcm1hdDogbnVsbCwKICAgICAgeExhYmVsTWFyZ2luOiAyNCwKICAgICAgaGlkZUhvdmVyOiBmYWxzZQogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5jYWxjID0gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuY2FsY1BvaW50cygpOwogICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZVBhdGhzKCk7CiAgICB9OwoKICAgIExpbmUucHJvdG90eXBlLmNhbGNQb2ludHMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHJvdywgeSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzOwogICAgICBfcmVmID0gdGhpcy5kYXRhOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICByb3cgPSBfcmVmW19pXTsKICAgICAgICByb3cuX3ggPSB0aGlzLnRyYW5zWChyb3cueCk7CiAgICAgICAgcm93Ll95ID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9qLCBfbGVuMSwgX3JlZjEsIF9yZXN1bHRzMTsKICAgICAgICAgIF9yZWYxID0gcm93Lnk7CiAgICAgICAgICBfcmVzdWx0czEgPSBbXTsKICAgICAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IF9yZWYxLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykgewogICAgICAgICAgICB5ID0gX3JlZjFbX2pdOwogICAgICAgICAgICBpZiAoeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2godGhpcy50cmFuc1koeSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKHkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHMxOwogICAgICAgIH0pLmNhbGwodGhpcyk7CiAgICAgICAgX3Jlc3VsdHMucHVzaChyb3cuX3ltYXggPSBNYXRoLm1pbi5hcHBseShNYXRoLCBbdGhpcy5ib3R0b21dLmNvbmNhdCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2osIF9sZW4xLCBfcmVmMSwgX3Jlc3VsdHMxOwogICAgICAgICAgX3JlZjEgPSByb3cuX3k7CiAgICAgICAgICBfcmVzdWx0czEgPSBbXTsKICAgICAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IF9yZWYxLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykgewogICAgICAgICAgICB5ID0gX3JlZjFbX2pdOwogICAgICAgICAgICBpZiAoeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2goeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7CiAgICAgICAgfSkoKSkpKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIExpbmUucHJvdG90eXBlLmhpdFRlc3QgPSBmdW5jdGlvbih4KSB7CiAgICAgIHZhciBpbmRleCwgciwgX2ksIF9sZW4sIF9yZWY7CiAgICAgIGlmICh0aGlzLmRhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgX3JlZiA9IHRoaXMuZGF0YS5zbGljZSgxKTsKICAgICAgZm9yIChpbmRleCA9IF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IGluZGV4ID0gKytfaSkgewogICAgICAgIHIgPSBfcmVmW2luZGV4XTsKICAgICAgICBpZiAoeCA8IChyLl94ICsgdGhpcy5kYXRhW2luZGV4XS5feCkgLyAyKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGluZGV4OwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5vbkdyaWRDbGljayA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgdmFyIGluZGV4OwogICAgICBpbmRleCA9IHRoaXMuaGl0VGVzdCh4KTsKICAgICAgcmV0dXJuIHRoaXMuZmlyZSgnY2xpY2snLCBpbmRleCwgdGhpcy5kYXRhW2luZGV4XS5zcmMsIHgsIHkpOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5vbkhvdmVyTW92ZSA9IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgdmFyIGluZGV4OwogICAgICBpbmRleCA9IHRoaXMuaGl0VGVzdCh4KTsKICAgICAgcmV0dXJuIHRoaXMuZGlzcGxheUhvdmVyRm9yUm93KGluZGV4KTsKICAgIH07CgogICAgTGluZS5wcm90b3R5cGUub25Ib3Zlck91dCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5vcHRpb25zLmhpZGVIb3ZlciAhPT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gdGhpcy5kaXNwbGF5SG92ZXJGb3JSb3cobnVsbCk7CiAgICAgIH0KICAgIH07CgogICAgTGluZS5wcm90b3R5cGUuZGlzcGxheUhvdmVyRm9yUm93ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIF9yZWY7CiAgICAgIGlmIChpbmRleCAhPSBudWxsKSB7CiAgICAgICAgKF9yZWYgPSB0aGlzLmhvdmVyKS51cGRhdGUuYXBwbHkoX3JlZiwgdGhpcy5ob3ZlckNvbnRlbnRGb3JSb3coaW5kZXgpKTsKICAgICAgICByZXR1cm4gdGhpcy5oaWxpZ2h0KGluZGV4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmhvdmVyLmhpZGUoKTsKICAgICAgICByZXR1cm4gdGhpcy5oaWxpZ2h0KCk7CiAgICAgIH0KICAgIH07CgogICAgTGluZS5wcm90b3R5cGUuaG92ZXJDb250ZW50Rm9yUm93ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIGNvbnRlbnQsIGosIHJvdywgeSwgX2ksIF9sZW4sIF9yZWY7CiAgICAgIHJvdyA9IHRoaXMuZGF0YVtpbmRleF07CiAgICAgIGNvbnRlbnQgPSAiPGRpdiBjbGFzcz0nbW9ycmlzLWhvdmVyLXJvdy1sYWJlbCc+IiArIHJvdy5sYWJlbCArICI8L2Rpdj4iOwogICAgICBfcmVmID0gcm93Lnk7CiAgICAgIGZvciAoaiA9IF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IGogPSArK19pKSB7CiAgICAgICAgeSA9IF9yZWZbal07CiAgICAgICAgY29udGVudCArPSAiPGRpdiBjbGFzcz0nbW9ycmlzLWhvdmVyLXBvaW50JyBzdHlsZT0nY29sb3I6ICIgKyAodGhpcy5jb2xvckZvcihyb3csIGosICdsYWJlbCcpKSArICInPlxuICAiICsgdGhpcy5vcHRpb25zLmxhYmVsc1tqXSArICI6XG4gICIgKyAodGhpcy55TGFiZWxGb3JtYXQoeSkpICsgIlxuPC9kaXY+IjsKICAgICAgfQogICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5ob3ZlckNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgY29udGVudCA9IHRoaXMub3B0aW9ucy5ob3ZlckNhbGxiYWNrKGluZGV4LCB0aGlzLm9wdGlvbnMsIGNvbnRlbnQsIHJvdy5zcmMpOwogICAgICB9CiAgICAgIHJldHVybiBbY29udGVudCwgcm93Ll94LCByb3cuX3ltYXhdOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5nZW5lcmF0ZVBhdGhzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjb29yZHMsIGksIHIsIHNtb290aDsKICAgICAgcmV0dXJuIHRoaXMucGF0aHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9pLCBfcmVmLCBfcmVmMSwgX3Jlc3VsdHM7CiAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICBmb3IgKGkgPSBfaSA9IDAsIF9yZWYgPSB0aGlzLm9wdGlvbnMueWtleXMubGVuZ3RoOyAwIDw9IF9yZWYgPyBfaSA8IF9yZWYgOiBfaSA+IF9yZWY7IGkgPSAwIDw9IF9yZWYgPyArK19pIDogLS1faSkgewogICAgICAgICAgc21vb3RoID0gdHlwZW9mIHRoaXMub3B0aW9ucy5zbW9vdGggPT09ICJib29sZWFuIiA\/IHRoaXMub3B0aW9ucy5zbW9vdGggOiAoX3JlZjEgPSB0aGlzLm9wdGlvbnMueWtleXNbaV0sIF9faW5kZXhPZi5jYWxsKHRoaXMub3B0aW9ucy5zbW9vdGgsIF9yZWYxKSA+PSAwKTsKICAgICAgICAgIGNvb3JkcyA9IChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIF9qLCBfbGVuLCBfcmVmMiwgX3Jlc3VsdHMxOwogICAgICAgICAgICBfcmVmMiA9IHRoaXMuZGF0YTsKICAgICAgICAgICAgX3Jlc3VsdHMxID0gW107CiAgICAgICAgICAgIGZvciAoX2ogPSAwLCBfbGVuID0gX3JlZjIubGVuZ3RoOyBfaiA8IF9sZW47IF9qKyspIHsKICAgICAgICAgICAgICByID0gX3JlZjJbX2pdOwogICAgICAgICAgICAgIGlmIChyLl95W2ldICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKHsKICAgICAgICAgICAgICAgICAgeDogci5feCwKICAgICAgICAgICAgICAgICAgeTogci5feVtpXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7CiAgICAgICAgICB9KS5jYWxsKHRoaXMpOwogICAgICAgICAgaWYgKGNvb3Jkcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goTW9ycmlzLkxpbmUuY3JlYXRlUGF0aChjb29yZHMsIHNtb290aCwgdGhpcy5ib3R0b20pKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2gobnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSkuY2FsbCh0aGlzKTsKICAgIH07CgogICAgTGluZS5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX3JlZjsKICAgICAgaWYgKChfcmVmID0gdGhpcy5vcHRpb25zLmF4ZXMpID09PSB0cnVlIHx8IF9yZWYgPT09ICdib3RoJyB8fCBfcmVmID09PSAneCcpIHsKICAgICAgICB0aGlzLmRyYXdYQXhpcygpOwogICAgICB9CiAgICAgIHRoaXMuZHJhd1NlcmllcygpOwogICAgICBpZiAodGhpcy5vcHRpb25zLmhpZGVIb3ZlciA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gdGhpcy5kaXNwbGF5SG92ZXJGb3JSb3codGhpcy5kYXRhLmxlbmd0aCAtIDEpOwogICAgICB9CiAgICB9OwoKICAgIExpbmUucHJvdG90eXBlLmRyYXdYQXhpcyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgZHJhd0xhYmVsLCBsLCBsYWJlbHMsIHByZXZBbmdsZU1hcmdpbiwgcHJldkxhYmVsTWFyZ2luLCByb3csIHlwb3MsIF9pLCBfbGVuLCBfcmVzdWx0cywKICAgICAgICBfdGhpcyA9IHRoaXM7CiAgICAgIHlwb3MgPSB0aGlzLmJvdHRvbSArIHRoaXMub3B0aW9ucy5wYWRkaW5nIC8gMjsKICAgICAgcHJldkxhYmVsTWFyZ2luID0gbnVsbDsKICAgICAgcHJldkFuZ2xlTWFyZ2luID0gbnVsbDsKICAgICAgZHJhd0xhYmVsID0gZnVuY3Rpb24obGFiZWxUZXh0LCB4cG9zKSB7CiAgICAgICAgdmFyIGxhYmVsLCBsYWJlbEJveCwgbWFyZ2luLCBvZmZzZXQsIHRleHRCb3g7CiAgICAgICAgbGFiZWwgPSBfdGhpcy5kcmF3WEF4aXNMYWJlbChfdGhpcy50cmFuc1goeHBvcyksIHlwb3MsIGxhYmVsVGV4dCk7CiAgICAgICAgdGV4dEJveCA9IGxhYmVsLmdldEJCb3goKTsKICAgICAgICBsYWJlbC50cmFuc2Zvcm0oInIiICsgKC1fdGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlKSk7CiAgICAgICAgbGFiZWxCb3ggPSBsYWJlbC5nZXRCQm94KCk7CiAgICAgICAgbGFiZWwudHJhbnNmb3JtKCJ0MCwiICsgKGxhYmVsQm94LmhlaWdodCAvIDIpICsgIi4uLiIpOwogICAgICAgIGlmIChfdGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlICE9PSAwKSB7CiAgICAgICAgICBvZmZzZXQgPSAtMC41ICogdGV4dEJveC53aWR0aCAqIE1hdGguY29zKF90aGlzLm9wdGlvbnMueExhYmVsQW5nbGUgKiBNYXRoLlBJIC8gMTgwLjApOwogICAgICAgICAgbGFiZWwudHJhbnNmb3JtKCJ0IiArIG9mZnNldCArICIsMC4uLiIpOwogICAgICAgIH0KICAgICAgICBsYWJlbEJveCA9IGxhYmVsLmdldEJCb3goKTsKICAgICAgICBpZiAoKChwcmV2TGFiZWxNYXJnaW4gPT0gbnVsbCkgfHwgcHJldkxhYmVsTWFyZ2luID49IGxhYmVsQm94LnggKyBsYWJlbEJveC53aWR0aCB8fCAocHJldkFuZ2xlTWFyZ2luICE9IG51bGwpICYmIHByZXZBbmdsZU1hcmdpbiA+PSBsYWJlbEJveC54KSAmJiBsYWJlbEJveC54ID49IDAgJiYgKGxhYmVsQm94LnggKyBsYWJlbEJveC53aWR0aCkgPCBfdGhpcy5lbC53aWR0aCgpKSB7CiAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy54TGFiZWxBbmdsZSAhPT0gMCkgewogICAgICAgICAgICBtYXJnaW4gPSAxLjI1ICogX3RoaXMub3B0aW9ucy5ncmlkVGV4dFNpemUgLyBNYXRoLnNpbihfdGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlICogTWF0aC5QSSAvIDE4MC4wKTsKICAgICAgICAgICAgcHJldkFuZ2xlTWFyZ2luID0gbGFiZWxCb3gueCAtIG1hcmdpbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwcmV2TGFiZWxNYXJnaW4gPSBsYWJlbEJveC54IC0gX3RoaXMub3B0aW9ucy54TGFiZWxNYXJnaW47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBsYWJlbC5yZW1vdmUoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGlmICh0aGlzLm9wdGlvbnMucGFyc2VUaW1lKSB7CiAgICAgICAgaWYgKHRoaXMuZGF0YS5sZW5ndGggPT09IDEgJiYgdGhpcy5vcHRpb25zLnhMYWJlbHMgPT09ICdhdXRvJykgewogICAgICAgICAgbGFiZWxzID0gW1t0aGlzLmRhdGFbMF0ubGFiZWwsIHRoaXMuZGF0YVswXS54XV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxhYmVscyA9IE1vcnJpcy5sYWJlbFNlcmllcyh0aGlzLnhtaW4sIHRoaXMueG1heCwgdGhpcy53aWR0aCwgdGhpcy5vcHRpb25zLnhMYWJlbHMsIHRoaXMub3B0aW9ucy54TGFiZWxGb3JtYXQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBsYWJlbHMgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzOwogICAgICAgICAgX3JlZiA9IHRoaXMuZGF0YTsKICAgICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgICAgcm93ID0gX3JlZltfaV07CiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goW3Jvdy5sYWJlbCwgcm93LnhdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICB9KS5jYWxsKHRoaXMpOwogICAgICB9CiAgICAgIGxhYmVscy5yZXZlcnNlKCk7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gbGFiZWxzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgbCA9IGxhYmVsc1tfaV07CiAgICAgICAgX3Jlc3VsdHMucHVzaChkcmF3TGFiZWwobFswXSwgbFsxXSkpOwogICAgICB9CiAgICAgIHJldHVybiBfcmVzdWx0czsKICAgIH07CgogICAgTGluZS5wcm90b3R5cGUuZHJhd1NlcmllcyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaSwgX2ksIF9qLCBfcmVmLCBfcmVmMSwgX3Jlc3VsdHM7CiAgICAgIHRoaXMuc2VyaWVzUG9pbnRzID0gW107CiAgICAgIGZvciAoaSA9IF9pID0gX3JlZiA9IHRoaXMub3B0aW9ucy55a2V5cy5sZW5ndGggLSAxOyBfcmVmIDw9IDAgPyBfaSA8PSAwIDogX2kgPj0gMDsgaSA9IF9yZWYgPD0gMCA\/ICsrX2kgOiAtLV9pKSB7CiAgICAgICAgdGhpcy5fZHJhd0xpbmVGb3IoaSk7CiAgICAgIH0KICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChpID0gX2ogPSBfcmVmMSA9IHRoaXMub3B0aW9ucy55a2V5cy5sZW5ndGggLSAxOyBfcmVmMSA8PSAwID8gX2ogPD0gMCA6IF9qID49IDA7IGkgPSBfcmVmMSA8PSAwID8gKytfaiA6IC0tX2opIHsKICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMuX2RyYXdQb2ludEZvcihpKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5fZHJhd1BvaW50Rm9yID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIGNpcmNsZSwgcm93LCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIHRoaXMuc2VyaWVzUG9pbnRzW2luZGV4XSA9IFtdOwogICAgICBfcmVmID0gdGhpcy5kYXRhOwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICByb3cgPSBfcmVmW19pXTsKICAgICAgICBjaXJjbGUgPSBudWxsOwogICAgICAgIGlmIChyb3cuX3lbaW5kZXhdICE9IG51bGwpIHsKICAgICAgICAgIGNpcmNsZSA9IHRoaXMuZHJhd0xpbmVQb2ludChyb3cuX3gsIHJvdy5feVtpbmRleF0sIHRoaXMuY29sb3JGb3Iocm93LCBpbmRleCwgJ3BvaW50JyksIGluZGV4KTsKICAgICAgICB9CiAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLnNlcmllc1BvaW50c1tpbmRleF0ucHVzaChjaXJjbGUpKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9OwoKICAgIExpbmUucHJvdG90eXBlLl9kcmF3TGluZUZvciA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHZhciBwYXRoOwogICAgICBwYXRoID0gdGhpcy5wYXRoc1tpbmRleF07CiAgICAgIGlmIChwYXRoICE9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZHJhd0xpbmVQYXRoKHBhdGgsIHRoaXMuY29sb3JGb3IobnVsbCwgaW5kZXgsICdsaW5lJyksIGluZGV4KTsKICAgICAgfQogICAgfTsKCiAgICBMaW5lLmNyZWF0ZVBhdGggPSBmdW5jdGlvbihjb29yZHMsIHNtb290aCwgYm90dG9tKSB7CiAgICAgIHZhciBjb29yZCwgZywgZ3JhZHMsIGksIGl4LCBsZywgcGF0aCwgcHJldkNvb3JkLCB4MSwgeDIsIHkxLCB5MiwgX2ksIF9sZW47CiAgICAgIHBhdGggPSAiIjsKICAgICAgaWYgKHNtb290aCkgewogICAgICAgIGdyYWRzID0gTW9ycmlzLkxpbmUuZ3JhZGllbnRzKGNvb3Jkcyk7CiAgICAgIH0KICAgICAgcHJldkNvb3JkID0gewogICAgICAgIHk6IG51bGwKICAgICAgfTsKICAgICAgZm9yIChpID0gX2kgPSAwLCBfbGVuID0gY29vcmRzLmxlbmd0aDsgX2kgPCBfbGVuOyBpID0gKytfaSkgewogICAgICAgIGNvb3JkID0gY29vcmRzW2ldOwogICAgICAgIGlmIChjb29yZC55ICE9IG51bGwpIHsKICAgICAgICAgIGlmIChwcmV2Q29vcmQueSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmIChzbW9vdGgpIHsKICAgICAgICAgICAgICBnID0gZ3JhZHNbaV07CiAgICAgICAgICAgICAgbGcgPSBncmFkc1tpIC0gMV07CiAgICAgICAgICAgICAgaXggPSAoY29vcmQueCAtIHByZXZDb29yZC54KSAvIDQ7CiAgICAgICAgICAgICAgeDEgPSBwcmV2Q29vcmQueCArIGl4OwogICAgICAgICAgICAgIHkxID0gTWF0aC5taW4oYm90dG9tLCBwcmV2Q29vcmQueSArIGl4ICogbGcpOwogICAgICAgICAgICAgIHgyID0gY29vcmQueCAtIGl4OwogICAgICAgICAgICAgIHkyID0gTWF0aC5taW4oYm90dG9tLCBjb29yZC55IC0gaXggKiBnKTsKICAgICAgICAgICAgICBwYXRoICs9ICJDIiArIHgxICsgIiwiICsgeTEgKyAiLCIgKyB4MiArICIsIiArIHkyICsgIiwiICsgY29vcmQueCArICIsIiArIGNvb3JkLnk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcGF0aCArPSAiTCIgKyBjb29yZC54ICsgIiwiICsgY29vcmQueTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFzbW9vdGggfHwgKGdyYWRzW2ldICE9IG51bGwpKSB7CiAgICAgICAgICAgICAgcGF0aCArPSAiTSIgKyBjb29yZC54ICsgIiwiICsgY29vcmQueTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwcmV2Q29vcmQgPSBjb29yZDsKICAgICAgfQogICAgICByZXR1cm4gcGF0aDsKICAgIH07CgogICAgTGluZS5ncmFkaWVudHMgPSBmdW5jdGlvbihjb29yZHMpIHsKICAgICAgdmFyIGNvb3JkLCBncmFkLCBpLCBuZXh0Q29vcmQsIHByZXZDb29yZCwgX2ksIF9sZW4sIF9yZXN1bHRzOwogICAgICBncmFkID0gZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiAoYS55IC0gYi55KSAvIChhLnggLSBiLngpOwogICAgICB9OwogICAgICBfcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKGkgPSBfaSA9IDAsIF9sZW4gPSBjb29yZHMubGVuZ3RoOyBfaSA8IF9sZW47IGkgPSArK19pKSB7CiAgICAgICAgY29vcmQgPSBjb29yZHNbaV07CiAgICAgICAgaWYgKGNvb3JkLnkgIT0gbnVsbCkgewogICAgICAgICAgbmV4dENvb3JkID0gY29vcmRzW2kgKyAxXSB8fCB7CiAgICAgICAgICAgIHk6IG51bGwKICAgICAgICAgIH07CiAgICAgICAgICBwcmV2Q29vcmQgPSBjb29yZHNbaSAtIDFdIHx8IHsKICAgICAgICAgICAgeTogbnVsbAogICAgICAgICAgfTsKICAgICAgICAgIGlmICgocHJldkNvb3JkLnkgIT0gbnVsbCkgJiYgKG5leHRDb29yZC55ICE9IG51bGwpKSB7CiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goZ3JhZChwcmV2Q29vcmQsIG5leHRDb29yZCkpOwogICAgICAgICAgfSBlbHNlIGlmIChwcmV2Q29vcmQueSAhPSBudWxsKSB7CiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2goZ3JhZChwcmV2Q29vcmQsIGNvb3JkKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKG5leHRDb29yZC55ICE9IG51bGwpIHsKICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChncmFkKGNvb3JkLCBuZXh0Q29vcmQpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2gobnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF9yZXN1bHRzLnB1c2gobnVsbCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBfcmVzdWx0czsKICAgIH07CgogICAgTGluZS5wcm90b3R5cGUuaGlsaWdodCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHZhciBpLCBfaSwgX2osIF9yZWYsIF9yZWYxOwogICAgICBpZiAodGhpcy5wcmV2SGlsaWdodCAhPT0gbnVsbCAmJiB0aGlzLnByZXZIaWxpZ2h0ICE9PSBpbmRleCkgewogICAgICAgIGZvciAoaSA9IF9pID0gMCwgX3JlZiA9IHRoaXMuc2VyaWVzUG9pbnRzLmxlbmd0aCAtIDE7IDAgPD0gX3JlZiA\/IF9pIDw9IF9yZWYgOiBfaSA+PSBfcmVmOyBpID0gMCA8PSBfcmVmID8gKytfaSA6IC0tX2kpIHsKICAgICAgICAgIGlmICh0aGlzLnNlcmllc1BvaW50c1tpXVt0aGlzLnByZXZIaWxpZ2h0XSkgewogICAgICAgICAgICB0aGlzLnNlcmllc1BvaW50c1tpXVt0aGlzLnByZXZIaWxpZ2h0XS5hbmltYXRlKHRoaXMucG9pbnRTaHJpbmtTZXJpZXMoaSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaW5kZXggIT09IG51bGwgJiYgdGhpcy5wcmV2SGlsaWdodCAhPT0gaW5kZXgpIHsKICAgICAgICBmb3IgKGkgPSBfaiA9IDAsIF9yZWYxID0gdGhpcy5zZXJpZXNQb2ludHMubGVuZ3RoIC0gMTsgMCA8PSBfcmVmMSA\/IF9qIDw9IF9yZWYxIDogX2ogPj0gX3JlZjE7IGkgPSAwIDw9IF9yZWYxID8gKytfaiA6IC0tX2opIHsKICAgICAgICAgIGlmICh0aGlzLnNlcmllc1BvaW50c1tpXVtpbmRleF0pIHsKICAgICAgICAgICAgdGhpcy5zZXJpZXNQb2ludHNbaV1baW5kZXhdLmFuaW1hdGUodGhpcy5wb2ludEdyb3dTZXJpZXMoaSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGhpcy5wcmV2SGlsaWdodCA9IGluZGV4OwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5jb2xvckZvciA9IGZ1bmN0aW9uKHJvdywgc2lkeCwgdHlwZSkgewogICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5saW5lQ29sb3JzID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5saW5lQ29sb3JzLmNhbGwodGhpcywgcm93LCBzaWR4LCB0eXBlKTsKICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAncG9pbnQnKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5wb2ludEZpbGxDb2xvcnNbc2lkeCAlIHRoaXMub3B0aW9ucy5wb2ludEZpbGxDb2xvcnMubGVuZ3RoXSB8fCB0aGlzLm9wdGlvbnMubGluZUNvbG9yc1tzaWR4ICUgdGhpcy5vcHRpb25zLmxpbmVDb2xvcnMubGVuZ3RoXTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmxpbmVDb2xvcnNbc2lkeCAlIHRoaXMub3B0aW9ucy5saW5lQ29sb3JzLmxlbmd0aF07CiAgICAgIH0KICAgIH07CgogICAgTGluZS5wcm90b3R5cGUuZHJhd1hBeGlzTGFiZWwgPSBmdW5jdGlvbih4UG9zLCB5UG9zLCB0ZXh0KSB7CiAgICAgIHJldHVybiB0aGlzLnJhcGhhZWwudGV4dCh4UG9zLCB5UG9zLCB0ZXh0KS5hdHRyKCdmb250LXNpemUnLCB0aGlzLm9wdGlvbnMuZ3JpZFRleHRTaXplKS5hdHRyKCdmb250LWZhbWlseScsIHRoaXMub3B0aW9ucy5ncmlkVGV4dEZhbWlseSkuYXR0cignZm9udC13ZWlnaHQnLCB0aGlzLm9wdGlvbnMuZ3JpZFRleHRXZWlnaHQpLmF0dHIoJ2ZpbGwnLCB0aGlzLm9wdGlvbnMuZ3JpZFRleHRDb2xvcik7CiAgICB9OwoKICAgIExpbmUucHJvdG90eXBlLmRyYXdMaW5lUGF0aCA9IGZ1bmN0aW9uKHBhdGgsIGxpbmVDb2xvciwgbGluZUluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLnJhcGhhZWwucGF0aChwYXRoKS5hdHRyKCdzdHJva2UnLCBsaW5lQ29sb3IpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIHRoaXMubGluZVdpZHRoRm9yU2VyaWVzKGxpbmVJbmRleCkpOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5kcmF3TGluZVBvaW50ID0gZnVuY3Rpb24oeFBvcywgeVBvcywgcG9pbnRDb2xvciwgbGluZUluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLnJhcGhhZWwuY2lyY2xlKHhQb3MsIHlQb3MsIHRoaXMucG9pbnRTaXplRm9yU2VyaWVzKGxpbmVJbmRleCkpLmF0dHIoJ2ZpbGwnLCBwb2ludENvbG9yKS5hdHRyKCdzdHJva2Utd2lkdGgnLCB0aGlzLnBvaW50U3Ryb2tlV2lkdGhGb3JTZXJpZXMobGluZUluZGV4KSkuYXR0cignc3Ryb2tlJywgdGhpcy5wb2ludFN0cm9rZUNvbG9yRm9yU2VyaWVzKGxpbmVJbmRleCkpOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5wb2ludFN0cm9rZVdpZHRoRm9yU2VyaWVzID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5wb2ludFN0cm9rZVdpZHRoc1tpbmRleCAlIHRoaXMub3B0aW9ucy5wb2ludFN0cm9rZVdpZHRocy5sZW5ndGhdOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5wb2ludFN0cm9rZUNvbG9yRm9yU2VyaWVzID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5wb2ludFN0cm9rZUNvbG9yc1tpbmRleCAlIHRoaXMub3B0aW9ucy5wb2ludFN0cm9rZUNvbG9ycy5sZW5ndGhdOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5saW5lV2lkdGhGb3JTZXJpZXMgPSBmdW5jdGlvbihpbmRleCkgewogICAgICBpZiAodGhpcy5vcHRpb25zLmxpbmVXaWR0aCBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5saW5lV2lkdGhbaW5kZXggJSB0aGlzLm9wdGlvbnMubGluZVdpZHRoLmxlbmd0aF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5saW5lV2lkdGg7CiAgICAgIH0KICAgIH07CgogICAgTGluZS5wcm90b3R5cGUucG9pbnRTaXplRm9yU2VyaWVzID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5wb2ludFNpemUgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucG9pbnRTaXplW2luZGV4ICUgdGhpcy5vcHRpb25zLnBvaW50U2l6ZS5sZW5ndGhdOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucG9pbnRTaXplOwogICAgICB9CiAgICB9OwoKICAgIExpbmUucHJvdG90eXBlLnBvaW50R3Jvd1NlcmllcyA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHJldHVybiBSYXBoYWVsLmFuaW1hdGlvbih7CiAgICAgICAgcjogdGhpcy5wb2ludFNpemVGb3JTZXJpZXMoaW5kZXgpICsgMwogICAgICB9LCAyNSwgJ2xpbmVhcicpOwogICAgfTsKCiAgICBMaW5lLnByb3RvdHlwZS5wb2ludFNocmlua1NlcmllcyA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHJldHVybiBSYXBoYWVsLmFuaW1hdGlvbih7CiAgICAgICAgcjogdGhpcy5wb2ludFNpemVGb3JTZXJpZXMoaW5kZXgpCiAgICAgIH0sIDI1LCAnbGluZWFyJyk7CiAgICB9OwoKICAgIHJldHVybiBMaW5lOwoKICB9KShNb3JyaXMuR3JpZCk7CgogIE1vcnJpcy5sYWJlbFNlcmllcyA9IGZ1bmN0aW9uKGRtaW4sIGRtYXgsIHB4d2lkdGgsIHNwZWNOYW1lLCB4TGFiZWxGb3JtYXQpIHsKICAgIHZhciBkLCBkMCwgZGRlbnNpdHksIG5hbWUsIHJldCwgcywgc3BlYywgdCwgX2ksIF9sZW4sIF9yZWY7CiAgICBkZGVuc2l0eSA9IDIwMCAqIChkbWF4IC0gZG1pbikgLyBweHdpZHRoOwogICAgZDAgPSBuZXcgRGF0ZShkbWluKTsKICAgIHNwZWMgPSBNb3JyaXMuTEFCRUxfU1BFQ1Nbc3BlY05hbWVdOwogICAgaWYgKHNwZWMgPT09IHZvaWQgMCkgewogICAgICBfcmVmID0gTW9ycmlzLkFVVE9fTEFCRUxfT1JERVI7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIG5hbWUgPSBfcmVmW19pXTsKICAgICAgICBzID0gTW9ycmlzLkxBQkVMX1NQRUNTW25hbWVdOwogICAgICAgIGlmIChkZGVuc2l0eSA+PSBzLnNwYW4pIHsKICAgICAgICAgIHNwZWMgPSBzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoc3BlYyA9PT0gdm9pZCAwKSB7CiAgICAgIHNwZWMgPSBNb3JyaXMuTEFCRUxfU1BFQ1NbInNlY29uZCJdOwogICAgfQogICAgaWYgKHhMYWJlbEZvcm1hdCkgewogICAgICBzcGVjID0gJC5leHRlbmQoe30sIHNwZWMsIHsKICAgICAgICBmbXQ6IHhMYWJlbEZvcm1hdAogICAgICB9KTsKICAgIH0KICAgIGQgPSBzcGVjLnN0YXJ0KGQwKTsKICAgIHJldCA9IFtdOwogICAgd2hpbGUgKCh0ID0gZC5nZXRUaW1lKCkpIDw9IGRtYXgpIHsKICAgICAgaWYgKHQgPj0gZG1pbikgewogICAgICAgIHJldC5wdXNoKFtzcGVjLmZtdChkKSwgdF0pOwogICAgICB9CiAgICAgIHNwZWMuaW5jcihkKTsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfTsKCiAgbWludXRlc1NwZWNIZWxwZXIgPSBmdW5jdGlvbihpbnRlcnZhbCkgewogICAgcmV0dXJuIHsKICAgICAgc3BhbjogaW50ZXJ2YWwgKiA2MCAqIDEwMDAsCiAgICAgIHN0YXJ0OiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSwgZC5nZXRIb3VycygpKTsKICAgICAgfSwKICAgICAgZm10OiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuICIiICsgKE1vcnJpcy5wYWQyKGQuZ2V0SG91cnMoKSkpICsgIjoiICsgKE1vcnJpcy5wYWQyKGQuZ2V0TWludXRlcygpKSk7CiAgICAgIH0sCiAgICAgIGluY3I6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gZC5zZXRVVENNaW51dGVzKGQuZ2V0VVRDTWludXRlcygpICsgaW50ZXJ2YWwpOwogICAgICB9CiAgICB9OwogIH07CgogIHNlY29uZHNTcGVjSGVscGVyID0gZnVuY3Rpb24oaW50ZXJ2YWwpIHsKICAgIHJldHVybiB7CiAgICAgIHNwYW46IGludGVydmFsICogMTAwMCwKICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpLCBkLmdldEhvdXJzKCksIGQuZ2V0TWludXRlcygpKTsKICAgICAgfSwKICAgICAgZm10OiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuICIiICsgKE1vcnJpcy5wYWQyKGQuZ2V0SG91cnMoKSkpICsgIjoiICsgKE1vcnJpcy5wYWQyKGQuZ2V0TWludXRlcygpKSkgKyAiOiIgKyAoTW9ycmlzLnBhZDIoZC5nZXRTZWNvbmRzKCkpKTsKICAgICAgfSwKICAgICAgaW5jcjogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkLnNldFVUQ1NlY29uZHMoZC5nZXRVVENTZWNvbmRzKCkgKyBpbnRlcnZhbCk7CiAgICAgIH0KICAgIH07CiAgfTsKCiAgTW9ycmlzLkxBQkVMX1NQRUNTID0gewogICAgImRlY2FkZSI6IHsKICAgICAgc3BhbjogMTcyODAwMDAwMDAwLAogICAgICBzdGFydDogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCkgLSBkLmdldEZ1bGxZZWFyKCkgJSAxMCwgMCwgMSk7CiAgICAgIH0sCiAgICAgIGZtdDogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiAiIiArIChkLmdldEZ1bGxZZWFyKCkpOwogICAgICB9LAogICAgICBpbmNyOiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIGQuc2V0RnVsbFllYXIoZC5nZXRGdWxsWWVhcigpICsgMTApOwogICAgICB9CiAgICB9LAogICAgInllYXIiOiB7CiAgICAgIHNwYW46IDE3MjgwMDAwMDAwLAogICAgICBzdGFydDogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIDAsIDEpOwogICAgICB9LAogICAgICBmbXQ6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gIiIgKyAoZC5nZXRGdWxsWWVhcigpKTsKICAgICAgfSwKICAgICAgaW5jcjogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkLnNldEZ1bGxZZWFyKGQuZ2V0RnVsbFllYXIoKSArIDEpOwogICAgICB9CiAgICB9LAogICAgIm1vbnRoIjogewogICAgICBzcGFuOiAyNDE5MjAwMDAwLAogICAgICBzdGFydDogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgMSk7CiAgICAgIH0sCiAgICAgIGZtdDogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiAiIiArIChkLmdldEZ1bGxZZWFyKCkpICsgIi0iICsgKE1vcnJpcy5wYWQyKGQuZ2V0TW9udGgoKSArIDEpKTsKICAgICAgfSwKICAgICAgaW5jcjogZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkLnNldE1vbnRoKGQuZ2V0TW9udGgoKSArIDEpOwogICAgICB9CiAgICB9LAogICAgIndlZWsiOiB7CiAgICAgIHNwYW46IDYwNDgwMDAwMCwKICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKTsKICAgICAgfSwKICAgICAgZm10OiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuICIiICsgKGQuZ2V0RnVsbFllYXIoKSkgKyAiLSIgKyAoTW9ycmlzLnBhZDIoZC5nZXRNb250aCgpICsgMSkpICsgIi0iICsgKE1vcnJpcy5wYWQyKGQuZ2V0RGF0ZSgpKSk7CiAgICAgIH0sCiAgICAgIGluY3I6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gZC5zZXREYXRlKGQuZ2V0RGF0ZSgpICsgNyk7CiAgICAgIH0KICAgIH0sCiAgICAiZGF5IjogewogICAgICBzcGFuOiA4NjQwMDAwMCwKICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpKTsKICAgICAgfSwKICAgICAgZm10OiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuICIiICsgKGQuZ2V0RnVsbFllYXIoKSkgKyAiLSIgKyAoTW9ycmlzLnBhZDIoZC5nZXRNb250aCgpICsgMSkpICsgIi0iICsgKE1vcnJpcy5wYWQyKGQuZ2V0RGF0ZSgpKSk7CiAgICAgIH0sCiAgICAgIGluY3I6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gZC5zZXREYXRlKGQuZ2V0RGF0ZSgpICsgMSk7CiAgICAgIH0KICAgIH0sCiAgICAiaG91ciI6IG1pbnV0ZXNTcGVjSGVscGVyKDYwKSwKICAgICIzMG1pbiI6IG1pbnV0ZXNTcGVjSGVscGVyKDMwKSwKICAgICIxNW1pbiI6IG1pbnV0ZXNTcGVjSGVscGVyKDE1KSwKICAgICIxMG1pbiI6IG1pbnV0ZXNTcGVjSGVscGVyKDEwKSwKICAgICI1bWluIjogbWludXRlc1NwZWNIZWxwZXIoNSksCiAgICAibWludXRlIjogbWludXRlc1NwZWNIZWxwZXIoMSksCiAgICAiMzBzZWMiOiBzZWNvbmRzU3BlY0hlbHBlcigzMCksCiAgICAiMTVzZWMiOiBzZWNvbmRzU3BlY0hlbHBlcigxNSksCiAgICAiMTBzZWMiOiBzZWNvbmRzU3BlY0hlbHBlcigxMCksCiAgICAiNXNlYyI6IHNlY29uZHNTcGVjSGVscGVyKDUpLAogICAgInNlY29uZCI6IHNlY29uZHNTcGVjSGVscGVyKDEpCiAgfTsKCiAgTW9ycmlzLkFVVE9fTEFCRUxfT1JERVIgPSBbImRlY2FkZSIsICJ5ZWFyIiwgIm1vbnRoIiwgIndlZWsiLCAiZGF5IiwgImhvdXIiLCAiMzBtaW4iLCAiMTVtaW4iLCAiMTBtaW4iLCAiNW1pbiIsICJtaW51dGUiLCAiMzBzZWMiLCAiMTVzZWMiLCAiMTBzZWMiLCAiNXNlYyIsICJzZWNvbmQiXTsKCiAgTW9ycmlzLkFyZWEgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgICB2YXIgYXJlYURlZmF1bHRzOwoKICAgIF9fZXh0ZW5kcyhBcmVhLCBfc3VwZXIpOwoKICAgIGFyZWFEZWZhdWx0cyA9IHsKICAgICAgZmlsbE9wYWNpdHk6ICdhdXRvJywKICAgICAgYmVoYXZlTGlrZUxpbmU6IGZhbHNlCiAgICB9OwoKICAgIGZ1bmN0aW9uIEFyZWEob3B0aW9ucykgewogICAgICB2YXIgYXJlYU9wdGlvbnM7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBNb3JyaXMuQXJlYSkpIHsKICAgICAgICByZXR1cm4gbmV3IE1vcnJpcy5BcmVhKG9wdGlvbnMpOwogICAgICB9CiAgICAgIGFyZWFPcHRpb25zID0gJC5leHRlbmQoe30sIGFyZWFEZWZhdWx0cywgb3B0aW9ucyk7CiAgICAgIHRoaXMuY3VtdWxhdGl2ZSA9ICFhcmVhT3B0aW9ucy5iZWhhdmVMaWtlTGluZTsKICAgICAgaWYgKGFyZWFPcHRpb25zLmZpbGxPcGFjaXR5ID09PSAnYXV0bycpIHsKICAgICAgICBhcmVhT3B0aW9ucy5maWxsT3BhY2l0eSA9IGFyZWFPcHRpb25zLmJlaGF2ZUxpa2VMaW5lID8gLjggOiAxOwogICAgICB9CiAgICAgIEFyZWEuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgYXJlYU9wdGlvbnMpOwogICAgfQoKICAgIEFyZWEucHJvdG90eXBlLmNhbGNQb2ludHMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHJvdywgdG90YWwsIHksIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0czsKICAgICAgX3JlZiA9IHRoaXMuZGF0YTsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgcm93ID0gX3JlZltfaV07CiAgICAgICAgcm93Ll94ID0gdGhpcy50cmFuc1gocm93LngpOwogICAgICAgIHRvdGFsID0gMDsKICAgICAgICByb3cuX3kgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2osIF9sZW4xLCBfcmVmMSwgX3Jlc3VsdHMxOwogICAgICAgICAgX3JlZjEgPSByb3cueTsKICAgICAgICAgIF9yZXN1bHRzMSA9IFtdOwogICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gX3JlZjEubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgICAgIHkgPSBfcmVmMVtfal07CiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYmVoYXZlTGlrZUxpbmUpIHsKICAgICAgICAgICAgICBfcmVzdWx0czEucHVzaCh0aGlzLnRyYW5zWSh5KSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG90YWwgKz0geSB8fCAwOwogICAgICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKHRoaXMudHJhbnNZKHRvdGFsKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7CiAgICAgICAgfSkuY2FsbCh0aGlzKTsKICAgICAgICBfcmVzdWx0cy5wdXNoKHJvdy5feW1heCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHJvdy5feSkpOwogICAgICB9CiAgICAgIHJldHVybiBfcmVzdWx0czsKICAgIH07CgogICAgQXJlYS5wcm90b3R5cGUuZHJhd1NlcmllcyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaSwgcmFuZ2UsIF9pLCBfaiwgX2ssIF9sZW4sIF9yZWYsIF9yZWYxLCBfcmVzdWx0cywgX3Jlc3VsdHMxLCBfcmVzdWx0czI7CiAgICAgIHRoaXMuc2VyaWVzUG9pbnRzID0gW107CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYmVoYXZlTGlrZUxpbmUpIHsKICAgICAgICByYW5nZSA9IChmdW5jdGlvbigpIHsKICAgICAgICAgIF9yZXN1bHRzID0gW107CiAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9yZWYgPSB0aGlzLm9wdGlvbnMueWtleXMubGVuZ3RoIC0gMTsgMCA8PSBfcmVmID8gX2kgPD0gX3JlZiA6IF9pID49IF9yZWY7IDAgPD0gX3JlZiA\/IF9pKysgOiBfaS0tKXsgX3Jlc3VsdHMucHVzaChfaSk7IH0KICAgICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgICB9KS5hcHBseSh0aGlzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByYW5nZSA9IChmdW5jdGlvbigpIHsKICAgICAgICAgIF9yZXN1bHRzMSA9IFtdOwogICAgICAgICAgZm9yICh2YXIgX2ogPSBfcmVmMSA9IHRoaXMub3B0aW9ucy55a2V5cy5sZW5ndGggLSAxOyBfcmVmMSA8PSAwID8gX2ogPD0gMCA6IF9qID49IDA7IF9yZWYxIDw9IDAgPyBfaisrIDogX2otLSl7IF9yZXN1bHRzMS5wdXNoKF9qKTsgfQogICAgICAgICAgcmV0dXJuIF9yZXN1bHRzMTsKICAgICAgICB9KS5hcHBseSh0aGlzKTsKICAgICAgfQogICAgICBfcmVzdWx0czIgPSBbXTsKICAgICAgZm9yIChfayA9IDAsIF9sZW4gPSByYW5nZS5sZW5ndGg7IF9rIDwgX2xlbjsgX2srKykgewogICAgICAgIGkgPSByYW5nZVtfa107CiAgICAgICAgdGhpcy5fZHJhd0ZpbGxGb3IoaSk7CiAgICAgICAgdGhpcy5fZHJhd0xpbmVGb3IoaSk7CiAgICAgICAgX3Jlc3VsdHMyLnB1c2godGhpcy5fZHJhd1BvaW50Rm9yKGkpKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHMyOwogICAgfTsKCiAgICBBcmVhLnByb3RvdHlwZS5fZHJhd0ZpbGxGb3IgPSBmdW5jdGlvbihpbmRleCkgewogICAgICB2YXIgcGF0aDsKICAgICAgcGF0aCA9IHRoaXMucGF0aHNbaW5kZXhdOwogICAgICBpZiAocGF0aCAhPT0gbnVsbCkgewogICAgICAgIHBhdGggPSBwYXRoICsgKCJMIiArICh0aGlzLnRyYW5zWCh0aGlzLnhtYXgpKSArICIsIiArIHRoaXMuYm90dG9tICsgIkwiICsgKHRoaXMudHJhbnNYKHRoaXMueG1pbikpICsgIiwiICsgdGhpcy5ib3R0b20gKyAiWiIpOwogICAgICAgIHJldHVybiB0aGlzLmRyYXdGaWxsZWRQYXRoKHBhdGgsIHRoaXMuZmlsbEZvclNlcmllcyhpbmRleCkpOwogICAgICB9CiAgICB9OwoKICAgIEFyZWEucHJvdG90eXBlLmZpbGxGb3JTZXJpZXMgPSBmdW5jdGlvbihpKSB7CiAgICAgIHZhciBjb2xvcjsKICAgICAgY29sb3IgPSBSYXBoYWVsLnJnYjJoc2wodGhpcy5jb2xvckZvcih0aGlzLmRhdGFbaV0sIGksICdsaW5lJykpOwogICAgICByZXR1cm4gUmFwaGFlbC5oc2woY29sb3IuaCwgdGhpcy5vcHRpb25zLmJlaGF2ZUxpa2VMaW5lID8gY29sb3IucyAqIDAuOSA6IGNvbG9yLnMgKiAwLjc1LCBNYXRoLm1pbigwLjk4LCB0aGlzLm9wdGlvbnMuYmVoYXZlTGlrZUxpbmUgPyBjb2xvci5sICogMS4yIDogY29sb3IubCAqIDEuMjUpKTsKICAgIH07CgogICAgQXJlYS5wcm90b3R5cGUuZHJhd0ZpbGxlZFBhdGggPSBmdW5jdGlvbihwYXRoLCBmaWxsKSB7CiAgICAgIHJldHVybiB0aGlzLnJhcGhhZWwucGF0aChwYXRoKS5hdHRyKCdmaWxsJywgZmlsbCkuYXR0cignZmlsbC1vcGFjaXR5JywgdGhpcy5vcHRpb25zLmZpbGxPcGFjaXR5KS5hdHRyKCdzdHJva2UnLCAnbm9uZScpOwogICAgfTsKCiAgICByZXR1cm4gQXJlYTsKCiAgfSkoTW9ycmlzLkxpbmUpOwoKICBNb3JyaXMuQmFyID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKEJhciwgX3N1cGVyKTsKCiAgICBmdW5jdGlvbiBCYXIob3B0aW9ucykgewogICAgICB0aGlzLm9uSG92ZXJPdXQgPSBfX2JpbmQodGhpcy5vbkhvdmVyT3V0LCB0aGlzKTsKICAgICAgdGhpcy5vbkhvdmVyTW92ZSA9IF9fYmluZCh0aGlzLm9uSG92ZXJNb3ZlLCB0aGlzKTsKICAgICAgdGhpcy5vbkdyaWRDbGljayA9IF9fYmluZCh0aGlzLm9uR3JpZENsaWNrLCB0aGlzKTsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIE1vcnJpcy5CYXIpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNb3JyaXMuQmFyKG9wdGlvbnMpOwogICAgICB9CiAgICAgIEJhci5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCAkLmV4dGVuZCh7fSwgb3B0aW9ucywgewogICAgICAgIHBhcnNlVGltZTogZmFsc2UKICAgICAgfSkpOwogICAgfQoKICAgIEJhci5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmN1bXVsYXRpdmUgPSB0aGlzLm9wdGlvbnMuc3RhY2tlZDsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWRlSG92ZXIgIT09ICdhbHdheXMnKSB7CiAgICAgICAgdGhpcy5ob3ZlciA9IG5ldyBNb3JyaXMuSG92ZXIoewogICAgICAgICAgcGFyZW50OiB0aGlzLmVsCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5vbignaG92ZXJtb3ZlJywgdGhpcy5vbkhvdmVyTW92ZSk7CiAgICAgICAgdGhpcy5vbignaG92ZXJvdXQnLCB0aGlzLm9uSG92ZXJPdXQpOwogICAgICAgIHJldHVybiB0aGlzLm9uKCdncmlkY2xpY2snLCB0aGlzLm9uR3JpZENsaWNrKTsKICAgICAgfQogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLmRlZmF1bHRzID0gewogICAgICBiYXJTaXplUmF0aW86IDAuNzUsCiAgICAgIGJhckdhcDogMywKICAgICAgYmFyQ29sb3JzOiBbJyMwYjYyYTQnLCAnIzdhOTJhMycsICcjNGRhNzRkJywgJyNhZmQ4ZjgnLCAnI2VkYzI0MCcsICcjY2I0YjRiJywgJyM5NDQwZWQnXSwKICAgICAgYmFyT3BhY2l0eTogMS4wLAogICAgICBiYXJSYWRpdXM6IFswLCAwLCAwLCAwXSwKICAgICAgeExhYmVsTWFyZ2luOiA1MAogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLmNhbGMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWY7CiAgICAgIHRoaXMuY2FsY0JhcnMoKTsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWRlSG92ZXIgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuIChfcmVmID0gdGhpcy5ob3ZlcikudXBkYXRlLmFwcGx5KF9yZWYsIHRoaXMuaG92ZXJDb250ZW50Rm9yUm93KHRoaXMuZGF0YS5sZW5ndGggLSAxKSk7CiAgICAgIH0KICAgIH07CgogICAgQmFyLnByb3RvdHlwZS5jYWxjQmFycyA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgaWR4LCByb3csIHksIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0czsKICAgICAgX3JlZiA9IHRoaXMuZGF0YTsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChpZHggPSBfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBpZHggPSArK19pKSB7CiAgICAgICAgcm93ID0gX3JlZltpZHhdOwogICAgICAgIHJvdy5feCA9IHRoaXMubGVmdCArIHRoaXMud2lkdGggKiAoaWR4ICsgMC41KSAvIHRoaXMuZGF0YS5sZW5ndGg7CiAgICAgICAgX3Jlc3VsdHMucHVzaChyb3cuX3kgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2osIF9sZW4xLCBfcmVmMSwgX3Jlc3VsdHMxOwogICAgICAgICAgX3JlZjEgPSByb3cueTsKICAgICAgICAgIF9yZXN1bHRzMSA9IFtdOwogICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gX3JlZjEubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgICAgIHkgPSBfcmVmMVtfal07CiAgICAgICAgICAgIGlmICh5ICE9IG51bGwpIHsKICAgICAgICAgICAgICBfcmVzdWx0czEucHVzaCh0aGlzLnRyYW5zWSh5KSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2gobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7CiAgICAgICAgfSkuY2FsbCh0aGlzKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWY7CiAgICAgIGlmICgoX3JlZiA9IHRoaXMub3B0aW9ucy5heGVzKSA9PT0gdHJ1ZSB8fCBfcmVmID09PSAnYm90aCcgfHwgX3JlZiA9PT0gJ3gnKSB7CiAgICAgICAgdGhpcy5kcmF3WEF4aXMoKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5kcmF3U2VyaWVzKCk7CiAgICB9OwoKICAgIEJhci5wcm90b3R5cGUuZHJhd1hBeGlzID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpLCBsYWJlbCwgbGFiZWxCb3gsIG1hcmdpbiwgb2Zmc2V0LCBwcmV2QW5nbGVNYXJnaW4sIHByZXZMYWJlbE1hcmdpbiwgcm93LCB0ZXh0Qm94LCB5cG9zLCBfaSwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgIHlwb3MgPSB0aGlzLmJvdHRvbSArICh0aGlzLm9wdGlvbnMueEF4aXNMYWJlbFRvcFBhZGRpbmcgfHwgdGhpcy5vcHRpb25zLnBhZGRpbmcgLyAyKTsKICAgICAgcHJldkxhYmVsTWFyZ2luID0gbnVsbDsKICAgICAgcHJldkFuZ2xlTWFyZ2luID0gbnVsbDsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChpID0gX2kgPSAwLCBfcmVmID0gdGhpcy5kYXRhLmxlbmd0aDsgMCA8PSBfcmVmID8gX2kgPCBfcmVmIDogX2kgPiBfcmVmOyBpID0gMCA8PSBfcmVmID8gKytfaSA6IC0tX2kpIHsKICAgICAgICByb3cgPSB0aGlzLmRhdGFbdGhpcy5kYXRhLmxlbmd0aCAtIDEgLSBpXTsKICAgICAgICBsYWJlbCA9IHRoaXMuZHJhd1hBeGlzTGFiZWwocm93Ll94LCB5cG9zLCByb3cubGFiZWwpOwogICAgICAgIHRleHRCb3ggPSBsYWJlbC5nZXRCQm94KCk7CiAgICAgICAgbGFiZWwudHJhbnNmb3JtKCJyIiArICgtdGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlKSk7CiAgICAgICAgbGFiZWxCb3ggPSBsYWJlbC5nZXRCQm94KCk7CiAgICAgICAgbGFiZWwudHJhbnNmb3JtKCJ0MCwiICsgKGxhYmVsQm94LmhlaWdodCAvIDIpICsgIi4uLiIpOwogICAgICAgIGlmICh0aGlzLm9wdGlvbnMueExhYmVsQW5nbGUgIT09IDApIHsKICAgICAgICAgIG9mZnNldCA9IC0wLjUgKiB0ZXh0Qm94LndpZHRoICogTWF0aC5jb3ModGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlICogTWF0aC5QSSAvIDE4MC4wKTsKICAgICAgICAgIGxhYmVsLnRyYW5zZm9ybSgidCIgKyBvZmZzZXQgKyAiLDAuLi4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKCgocHJldkxhYmVsTWFyZ2luID09IG51bGwpIHx8IHByZXZMYWJlbE1hcmdpbiA+PSBsYWJlbEJveC54ICsgbGFiZWxCb3gud2lkdGggfHwgKHByZXZBbmdsZU1hcmdpbiAhPSBudWxsKSAmJiBwcmV2QW5nbGVNYXJnaW4gPj0gbGFiZWxCb3gueCkgJiYgbGFiZWxCb3gueCA+PSAwICYmIChsYWJlbEJveC54ICsgbGFiZWxCb3gud2lkdGgpIDwgdGhpcy5lbC53aWR0aCgpKSB7CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlICE9PSAwKSB7CiAgICAgICAgICAgIG1hcmdpbiA9IDEuMjUgKiB0aGlzLm9wdGlvbnMuZ3JpZFRleHRTaXplIC8gTWF0aC5zaW4odGhpcy5vcHRpb25zLnhMYWJlbEFuZ2xlICogTWF0aC5QSSAvIDE4MC4wKTsKICAgICAgICAgICAgcHJldkFuZ2xlTWFyZ2luID0gbGFiZWxCb3gueCAtIG1hcmdpbjsKICAgICAgICAgIH0KICAgICAgICAgIF9yZXN1bHRzLnB1c2gocHJldkxhYmVsTWFyZ2luID0gbGFiZWxCb3gueCAtIHRoaXMub3B0aW9ucy54TGFiZWxNYXJnaW4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGxhYmVsLnJlbW92ZSgpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLmRyYXdTZXJpZXMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGJhcldpZHRoLCBib3R0b20sIGdyb3VwV2lkdGgsIGlkeCwgbGFzdFRvcCwgbGVmdCwgbGVmdFBhZGRpbmcsIG51bUJhcnMsIHJvdywgc2lkeCwgc2l6ZSwgc3BhY2VMZWZ0LCB0b3AsIHlwb3MsIHplcm9Qb3M7CiAgICAgIGdyb3VwV2lkdGggPSB0aGlzLndpZHRoIC8gdGhpcy5vcHRpb25zLmRhdGEubGVuZ3RoOwogICAgICBudW1CYXJzID0gdGhpcy5vcHRpb25zLnN0YWNrZWQgPyAxIDogdGhpcy5vcHRpb25zLnlrZXlzLmxlbmd0aDsKICAgICAgYmFyV2lkdGggPSAoZ3JvdXBXaWR0aCAqIHRoaXMub3B0aW9ucy5iYXJTaXplUmF0aW8gLSB0aGlzLm9wdGlvbnMuYmFyR2FwICogKG51bUJhcnMgLSAxKSkgLyBudW1CYXJzOwogICAgICBpZiAodGhpcy5vcHRpb25zLmJhclNpemUpIHsKICAgICAgICBiYXJXaWR0aCA9IE1hdGgubWluKGJhcldpZHRoLCB0aGlzLm9wdGlvbnMuYmFyU2l6ZSk7CiAgICAgIH0KICAgICAgc3BhY2VMZWZ0ID0gZ3JvdXBXaWR0aCAtIGJhcldpZHRoICogbnVtQmFycyAtIHRoaXMub3B0aW9ucy5iYXJHYXAgKiAobnVtQmFycyAtIDEpOwogICAgICBsZWZ0UGFkZGluZyA9IHNwYWNlTGVmdCAvIDI7CiAgICAgIHplcm9Qb3MgPSB0aGlzLnltaW4gPD0gMCAmJiB0aGlzLnltYXggPj0gMCA\/IHRoaXMudHJhbnNZKDApIDogbnVsbDsKICAgICAgcmV0dXJuIHRoaXMuYmFycyA9IChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzOwogICAgICAgIF9yZWYgPSB0aGlzLmRhdGE7CiAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICBmb3IgKGlkeCA9IF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IGlkeCA9ICsrX2kpIHsKICAgICAgICAgIHJvdyA9IF9yZWZbaWR4XTsKICAgICAgICAgIGxhc3RUb3AgPSAwOwogICAgICAgICAgX3Jlc3VsdHMucHVzaCgoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBfaiwgX2xlbjEsIF9yZWYxLCBfcmVzdWx0czE7CiAgICAgICAgICAgIF9yZWYxID0gcm93Ll95OwogICAgICAgICAgICBfcmVzdWx0czEgPSBbXTsKICAgICAgICAgICAgZm9yIChzaWR4ID0gX2ogPSAwLCBfbGVuMSA9IF9yZWYxLmxlbmd0aDsgX2ogPCBfbGVuMTsgc2lkeCA9ICsrX2opIHsKICAgICAgICAgICAgICB5cG9zID0gX3JlZjFbc2lkeF07CiAgICAgICAgICAgICAgaWYgKHlwb3MgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICh6ZXJvUG9zKSB7CiAgICAgICAgICAgICAgICAgIHRvcCA9IE1hdGgubWluKHlwb3MsIHplcm9Qb3MpOwogICAgICAgICAgICAgICAgICBib3R0b20gPSBNYXRoLm1heCh5cG9zLCB6ZXJvUG9zKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRvcCA9IHlwb3M7CiAgICAgICAgICAgICAgICAgIGJvdHRvbSA9IHRoaXMuYm90dG9tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGVmdCA9IHRoaXMubGVmdCArIGlkeCAqIGdyb3VwV2lkdGggKyBsZWZ0UGFkZGluZzsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnN0YWNrZWQpIHsKICAgICAgICAgICAgICAgICAgbGVmdCArPSBzaWR4ICogKGJhcldpZHRoICsgdGhpcy5vcHRpb25zLmJhckdhcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaXplID0gYm90dG9tIC0gdG9wOwogICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52ZXJ0aWNhbEdyaWRDb25kaXRpb24gJiYgdGhpcy5vcHRpb25zLnZlcnRpY2FsR3JpZENvbmRpdGlvbihyb3cueCkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QmFyKHRoaXMubGVmdCArIGlkeCAqIGdyb3VwV2lkdGgsIHRoaXMudG9wLCBncm91cFdpZHRoLCBNYXRoLmFicyh0aGlzLnRvcCAtIHRoaXMuYm90dG9tKSwgdGhpcy5vcHRpb25zLnZlcnRpY2FsR3JpZENvbG9yLCB0aGlzLm9wdGlvbnMudmVydGljYWxHcmlkT3BhY2l0eSwgdGhpcy5vcHRpb25zLmJhclJhZGl1cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnN0YWNrZWQpIHsKICAgICAgICAgICAgICAgICAgdG9wIC09IGxhc3RUb3A7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmRyYXdCYXIobGVmdCwgdG9wLCBiYXJXaWR0aCwgc2l6ZSwgdGhpcy5jb2xvckZvcihyb3csIHNpZHgsICdiYXInKSwgdGhpcy5vcHRpb25zLmJhck9wYWNpdHksIHRoaXMub3B0aW9ucy5iYXJSYWRpdXMpOwogICAgICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2gobGFzdFRvcCArPSBzaXplKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3Jlc3VsdHMxLnB1c2gobnVsbCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfcmVzdWx0czE7CiAgICAgICAgICB9KS5jYWxsKHRoaXMpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICB9KS5jYWxsKHRoaXMpOwogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLmNvbG9yRm9yID0gZnVuY3Rpb24ocm93LCBzaWR4LCB0eXBlKSB7CiAgICAgIHZhciByLCBzOwogICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5iYXJDb2xvcnMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICByID0gewogICAgICAgICAgeDogcm93LngsCiAgICAgICAgICB5OiByb3cueVtzaWR4XSwKICAgICAgICAgIGxhYmVsOiByb3cubGFiZWwKICAgICAgICB9OwogICAgICAgIHMgPSB7CiAgICAgICAgICBpbmRleDogc2lkeCwKICAgICAgICAgIGtleTogdGhpcy5vcHRpb25zLnlrZXlzW3NpZHhdLAogICAgICAgICAgbGFiZWw6IHRoaXMub3B0aW9ucy5sYWJlbHNbc2lkeF0KICAgICAgICB9OwogICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYmFyQ29sb3JzLmNhbGwodGhpcywgciwgcywgdHlwZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5iYXJDb2xvcnNbc2lkeCAlIHRoaXMub3B0aW9ucy5iYXJDb2xvcnMubGVuZ3RoXTsKICAgICAgfQogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLmhpdFRlc3QgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICh0aGlzLmRhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgeCA9IE1hdGgubWF4KE1hdGgubWluKHgsIHRoaXMucmlnaHQpLCB0aGlzLmxlZnQpOwogICAgICByZXR1cm4gTWF0aC5taW4odGhpcy5kYXRhLmxlbmd0aCAtIDEsIE1hdGguZmxvb3IoKHggLSB0aGlzLmxlZnQpIC8gKHRoaXMud2lkdGggLyB0aGlzLmRhdGEubGVuZ3RoKSkpOwogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLm9uR3JpZENsaWNrID0gZnVuY3Rpb24oeCwgeSkgewogICAgICB2YXIgaW5kZXg7CiAgICAgIGluZGV4ID0gdGhpcy5oaXRUZXN0KHgpOwogICAgICByZXR1cm4gdGhpcy5maXJlKCdjbGljaycsIGluZGV4LCB0aGlzLmRhdGFbaW5kZXhdLnNyYywgeCwgeSk7CiAgICB9OwoKICAgIEJhci5wcm90b3R5cGUub25Ib3Zlck1vdmUgPSBmdW5jdGlvbih4LCB5KSB7CiAgICAgIHZhciBpbmRleCwgX3JlZjsKICAgICAgaW5kZXggPSB0aGlzLmhpdFRlc3QoeCk7CiAgICAgIHJldHVybiAoX3JlZiA9IHRoaXMuaG92ZXIpLnVwZGF0ZS5hcHBseShfcmVmLCB0aGlzLmhvdmVyQ29udGVudEZvclJvdyhpbmRleCkpOwogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLm9uSG92ZXJPdXQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWRlSG92ZXIgIT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaG92ZXIuaGlkZSgpOwogICAgICB9CiAgICB9OwoKICAgIEJhci5wcm90b3R5cGUuaG92ZXJDb250ZW50Rm9yUm93ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIGNvbnRlbnQsIGosIHJvdywgeCwgeSwgX2ksIF9sZW4sIF9yZWY7CiAgICAgIHJvdyA9IHRoaXMuZGF0YVtpbmRleF07CiAgICAgIGNvbnRlbnQgPSAiPGRpdiBjbGFzcz0nbW9ycmlzLWhvdmVyLXJvdy1sYWJlbCc+IiArIHJvdy5sYWJlbCArICI8L2Rpdj4iOwogICAgICBfcmVmID0gcm93Lnk7CiAgICAgIGZvciAoaiA9IF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IGogPSArK19pKSB7CiAgICAgICAgeSA9IF9yZWZbal07CiAgICAgICAgY29udGVudCArPSAiPGRpdiBjbGFzcz0nbW9ycmlzLWhvdmVyLXBvaW50JyBzdHlsZT0nY29sb3I6ICIgKyAodGhpcy5jb2xvckZvcihyb3csIGosICdsYWJlbCcpKSArICInPlxuICAiICsgdGhpcy5vcHRpb25zLmxhYmVsc1tqXSArICI6XG4gICIgKyAodGhpcy55TGFiZWxGb3JtYXQoeSkpICsgIlxuPC9kaXY+IjsKICAgICAgfQogICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5ob3ZlckNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgY29udGVudCA9IHRoaXMub3B0aW9ucy5ob3ZlckNhbGxiYWNrKGluZGV4LCB0aGlzLm9wdGlvbnMsIGNvbnRlbnQsIHJvdy5zcmMpOwogICAgICB9CiAgICAgIHggPSB0aGlzLmxlZnQgKyAoaW5kZXggKyAwLjUpICogdGhpcy53aWR0aCAvIHRoaXMuZGF0YS5sZW5ndGg7CiAgICAgIHJldHVybiBbY29udGVudCwgeF07CiAgICB9OwoKICAgIEJhci5wcm90b3R5cGUuZHJhd1hBeGlzTGFiZWwgPSBmdW5jdGlvbih4UG9zLCB5UG9zLCB0ZXh0KSB7CiAgICAgIHZhciBsYWJlbDsKICAgICAgcmV0dXJuIGxhYmVsID0gdGhpcy5yYXBoYWVsLnRleHQoeFBvcywgeVBvcywgdGV4dCkuYXR0cignZm9udC1zaXplJywgdGhpcy5vcHRpb25zLmdyaWRUZXh0U2l6ZSkuYXR0cignZm9udC1mYW1pbHknLCB0aGlzLm9wdGlvbnMuZ3JpZFRleHRGYW1pbHkpLmF0dHIoJ2ZvbnQtd2VpZ2h0JywgdGhpcy5vcHRpb25zLmdyaWRUZXh0V2VpZ2h0KS5hdHRyKCdmaWxsJywgdGhpcy5vcHRpb25zLmdyaWRUZXh0Q29sb3IpOwogICAgfTsKCiAgICBCYXIucHJvdG90eXBlLmRyYXdCYXIgPSBmdW5jdGlvbih4UG9zLCB5UG9zLCB3aWR0aCwgaGVpZ2h0LCBiYXJDb2xvciwgb3BhY2l0eSwgcmFkaXVzQXJyYXkpIHsKICAgICAgdmFyIG1heFJhZGl1cywgcGF0aDsKICAgICAgbWF4UmFkaXVzID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgcmFkaXVzQXJyYXkpOwogICAgICBpZiAobWF4UmFkaXVzID09PSAwIHx8IG1heFJhZGl1cyA+IGhlaWdodCkgewogICAgICAgIHBhdGggPSB0aGlzLnJhcGhhZWwucmVjdCh4UG9zLCB5UG9zLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwYXRoID0gdGhpcy5yYXBoYWVsLnBhdGgodGhpcy5yb3VuZGVkUmVjdCh4UG9zLCB5UG9zLCB3aWR0aCwgaGVpZ2h0LCByYWRpdXNBcnJheSkpOwogICAgICB9CiAgICAgIHJldHVybiBwYXRoLmF0dHIoJ2ZpbGwnLCBiYXJDb2xvcikuYXR0cignZmlsbC1vcGFjaXR5Jywgb3BhY2l0eSkuYXR0cignc3Ryb2tlJywgJ25vbmUnKTsKICAgIH07CgogICAgQmFyLnByb3RvdHlwZS5yb3VuZGVkUmVjdCA9IGZ1bmN0aW9uKHgsIHksIHcsIGgsIHIpIHsKICAgICAgaWYgKHIgPT0gbnVsbCkgewogICAgICAgIHIgPSBbMCwgMCwgMCwgMF07CiAgICAgIH0KICAgICAgcmV0dXJuIFsiTSIsIHgsIHJbMF0gKyB5LCAiUSIsIHgsIHksIHggKyByWzBdLCB5LCAiTCIsIHggKyB3IC0gclsxXSwgeSwgIlEiLCB4ICsgdywgeSwgeCArIHcsIHkgKyByWzFdLCAiTCIsIHggKyB3LCB5ICsgaCAtIHJbMl0sICJRIiwgeCArIHcsIHkgKyBoLCB4ICsgdyAtIHJbMl0sIHkgKyBoLCAiTCIsIHggKyByWzNdLCB5ICsgaCwgIlEiLCB4LCB5ICsgaCwgeCwgeSArIGggLSByWzNdLCAiWiJdOwogICAgfTsKCiAgICByZXR1cm4gQmFyOwoKICB9KShNb3JyaXMuR3JpZCk7CgogIE1vcnJpcy5Eb251dCA9IChmdW5jdGlvbihfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhEb251dCwgX3N1cGVyKTsKCiAgICBEb251dC5wcm90b3R5cGUuZGVmYXVsdHMgPSB7CiAgICAgIGNvbG9yczogWycjMEI2MkE0JywgJyMzOTgwQjUnLCAnIzY3OURDNicsICcjOTVCQkQ3JywgJyNCMENDRTEnLCAnIzA5NTc5MScsICcjMDk1MDg1JywgJyMwODNFNjcnLCAnIzA1MkM0OCcsICcjMDQyMTM1J10sCiAgICAgIGJhY2tncm91bmRDb2xvcjogJyNGRkZGRkYnLAogICAgICBsYWJlbENvbG9yOiAnIzAwMDAwMCcsCiAgICAgIGZvcm1hdHRlcjogTW9ycmlzLmNvbW1hcywKICAgICAgcmVzaXplOiBmYWxzZQogICAgfTsKCiAgICBmdW5jdGlvbiBEb251dChvcHRpb25zKSB7CiAgICAgIHRoaXMucmVzaXplSGFuZGxlciA9IF9fYmluZCh0aGlzLnJlc2l6ZUhhbmRsZXIsIHRoaXMpOwogICAgICB0aGlzLnNlbGVjdCA9IF9fYmluZCh0aGlzLnNlbGVjdCwgdGhpcyk7CiAgICAgIHRoaXMuY2xpY2sgPSBfX2JpbmQodGhpcy5jbGljaywgdGhpcyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBNb3JyaXMuRG9udXQpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNb3JyaXMuRG9udXQob3B0aW9ucyk7CiAgICAgIH0KICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIHRoaXMuZGVmYXVsdHMsIG9wdGlvbnMpOwogICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZWxlbWVudCA9PT0gJ3N0cmluZycpIHsKICAgICAgICB0aGlzLmVsID0gJChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmVsZW1lbnQpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVsID0gJChvcHRpb25zLmVsZW1lbnQpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmVsID09PSBudWxsIHx8IHRoaXMuZWwubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJHcmFwaCBwbGFjZWhvbGRlciBub3QgZm91bmQuIik7CiAgICAgIH0KICAgICAgaWYgKG9wdGlvbnMuZGF0YSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuZGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5yYXBoYWVsID0gbmV3IFJhcGhhZWwodGhpcy5lbFswXSk7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVzaXplKSB7CiAgICAgICAgJCh3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgaWYgKF90aGlzLnRpbWVvdXRJZCAhPSBudWxsKSB7CiAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoX3RoaXMudGltZW91dElkKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfdGhpcy50aW1lb3V0SWQgPSB3aW5kb3cuc2V0VGltZW91dChfdGhpcy5yZXNpemVIYW5kbGVyLCAxMDApOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuc2V0RGF0YShvcHRpb25zLmRhdGEpOwogICAgfQoKICAgIERvbnV0LnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIEMsIGN4LCBjeSwgaSwgaWR4LCBsYXN0LCBtYXhfdmFsdWUsIG1pbiwgbmV4dCwgc2VnLCB0b3RhbCwgdmFsdWUsIHcsIF9pLCBfaiwgX2ssIF9sZW4sIF9sZW4xLCBfbGVuMiwgX3JlZiwgX3JlZjEsIF9yZWYyLCBfcmVzdWx0czsKICAgICAgdGhpcy5yYXBoYWVsLmNsZWFyKCk7CiAgICAgIGN4ID0gdGhpcy5lbC53aWR0aCgpIC8gMjsKICAgICAgY3kgPSB0aGlzLmVsLmhlaWdodCgpIC8gMjsKICAgICAgdyA9IChNYXRoLm1pbihjeCwgY3kpIC0gMTApIC8gMzsKICAgICAgdG90YWwgPSAwOwogICAgICBfcmVmID0gdGhpcy52YWx1ZXM7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIHZhbHVlID0gX3JlZltfaV07CiAgICAgICAgdG90YWwgKz0gdmFsdWU7CiAgICAgIH0KICAgICAgbWluID0gNSAvICgyICogdyk7CiAgICAgIEMgPSAxLjk5OTkgKiBNYXRoLlBJIC0gbWluICogdGhpcy5kYXRhLmxlbmd0aDsKICAgICAgbGFzdCA9IDA7CiAgICAgIGlkeCA9IDA7CiAgICAgIHRoaXMuc2VnbWVudHMgPSBbXTsKICAgICAgX3JlZjEgPSB0aGlzLnZhbHVlczsKICAgICAgZm9yIChpID0gX2ogPSAwLCBfbGVuMSA9IF9yZWYxLmxlbmd0aDsgX2ogPCBfbGVuMTsgaSA9ICsrX2opIHsKICAgICAgICB2YWx1ZSA9IF9yZWYxW2ldOwogICAgICAgIG5leHQgPSBsYXN0ICsgbWluICsgQyAqICh2YWx1ZSAvIHRvdGFsKTsKICAgICAgICBzZWcgPSBuZXcgTW9ycmlzLkRvbnV0U2VnbWVudChjeCwgY3ksIHcgKiAyLCB3LCBsYXN0LCBuZXh0LCB0aGlzLmRhdGFbaV0uY29sb3IgfHwgdGhpcy5vcHRpb25zLmNvbG9yc1tpZHggJSB0aGlzLm9wdGlvbnMuY29sb3JzLmxlbmd0aF0sIHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IsIGlkeCwgdGhpcy5yYXBoYWVsKTsKICAgICAgICBzZWcucmVuZGVyKCk7CiAgICAgICAgdGhpcy5zZWdtZW50cy5wdXNoKHNlZyk7CiAgICAgICAgc2VnLm9uKCdob3ZlcicsIHRoaXMuc2VsZWN0KTsKICAgICAgICBzZWcub24oJ2NsaWNrJywgdGhpcy5jbGljayk7CiAgICAgICAgbGFzdCA9IG5leHQ7CiAgICAgICAgaWR4ICs9IDE7CiAgICAgIH0KICAgICAgdGhpcy50ZXh0MSA9IHRoaXMuZHJhd0VtcHR5RG9udXRMYWJlbChjeCwgY3kgLSAxMCwgdGhpcy5vcHRpb25zLmxhYmVsQ29sb3IsIDE1LCA4MDApOwogICAgICB0aGlzLnRleHQyID0gdGhpcy5kcmF3RW1wdHlEb251dExhYmVsKGN4LCBjeSArIDEwLCB0aGlzLm9wdGlvbnMubGFiZWxDb2xvciwgMTQpOwogICAgICBtYXhfdmFsdWUgPSBNYXRoLm1heC5hcHBseShNYXRoLCB0aGlzLnZhbHVlcyk7CiAgICAgIGlkeCA9IDA7CiAgICAgIF9yZWYyID0gdGhpcy52YWx1ZXM7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2sgPSAwLCBfbGVuMiA9IF9yZWYyLmxlbmd0aDsgX2sgPCBfbGVuMjsgX2srKykgewogICAgICAgIHZhbHVlID0gX3JlZjJbX2tdOwogICAgICAgIGlmICh2YWx1ZSA9PT0gbWF4X3ZhbHVlKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdChpZHgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIF9yZXN1bHRzLnB1c2goaWR4ICs9IDEpOwogICAgICB9CiAgICAgIHJldHVybiBfcmVzdWx0czsKICAgIH07CgogICAgRG9udXQucHJvdG90eXBlLnNldERhdGEgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHZhciByb3c7CiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgIHRoaXMudmFsdWVzID0gKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7CiAgICAgICAgX3JlZiA9IHRoaXMuZGF0YTsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgcm93ID0gX3JlZltfaV07CiAgICAgICAgICBfcmVzdWx0cy5wdXNoKHBhcnNlRmxvYXQocm93LnZhbHVlKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfSkuY2FsbCh0aGlzKTsKICAgICAgcmV0dXJuIHRoaXMucmVkcmF3KCk7CiAgICB9OwoKICAgIERvbnV0LnByb3RvdHlwZS5jbGljayA9IGZ1bmN0aW9uKGlkeCkgewogICAgICByZXR1cm4gdGhpcy5maXJlKCdjbGljaycsIGlkeCwgdGhpcy5kYXRhW2lkeF0pOwogICAgfTsKCiAgICBEb251dC5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oaWR4KSB7CiAgICAgIHZhciByb3csIHMsIHNlZ21lbnQsIF9pLCBfbGVuLCBfcmVmOwogICAgICBfcmVmID0gdGhpcy5zZWdtZW50czsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgcyA9IF9yZWZbX2ldOwogICAgICAgIHMuZGVzZWxlY3QoKTsKICAgICAgfQogICAgICBzZWdtZW50ID0gdGhpcy5zZWdtZW50c1tpZHhdOwogICAgICBzZWdtZW50LnNlbGVjdCgpOwogICAgICByb3cgPSB0aGlzLmRhdGFbaWR4XTsKICAgICAgcmV0dXJuIHRoaXMuc2V0TGFiZWxzKHJvdy5sYWJlbCwgdGhpcy5vcHRpb25zLmZvcm1hdHRlcihyb3cudmFsdWUsIHJvdykpOwogICAgfTsKCiAgICBEb251dC5wcm90b3R5cGUuc2V0TGFiZWxzID0gZnVuY3Rpb24obGFiZWwxLCBsYWJlbDIpIHsKICAgICAgdmFyIGlubmVyLCBtYXhIZWlnaHRCb3R0b20sIG1heEhlaWdodFRvcCwgbWF4V2lkdGgsIHRleHQxYmJveCwgdGV4dDFzY2FsZSwgdGV4dDJiYm94LCB0ZXh0MnNjYWxlOwogICAgICBpbm5lciA9IChNYXRoLm1pbih0aGlzLmVsLndpZHRoKCkgLyAyLCB0aGlzLmVsLmhlaWdodCgpIC8gMikgLSAxMCkgKiAyIC8gMzsKICAgICAgbWF4V2lkdGggPSAxLjggKiBpbm5lcjsKICAgICAgbWF4SGVpZ2h0VG9wID0gaW5uZXIgLyAyOwogICAgICBtYXhIZWlnaHRCb3R0b20gPSBpbm5lciAvIDM7CiAgICAgIHRoaXMudGV4dDEuYXR0cih7CiAgICAgICAgdGV4dDogbGFiZWwxLAogICAgICAgIHRyYW5zZm9ybTogJycKICAgICAgfSk7CiAgICAgIHRleHQxYmJveCA9IHRoaXMudGV4dDEuZ2V0QkJveCgpOwogICAgICB0ZXh0MXNjYWxlID0gTWF0aC5taW4obWF4V2lkdGggLyB0ZXh0MWJib3gud2lkdGgsIG1heEhlaWdodFRvcCAvIHRleHQxYmJveC5oZWlnaHQpOwogICAgICB0aGlzLnRleHQxLmF0dHIoewogICAgICAgIHRyYW5zZm9ybTogIlMiICsgdGV4dDFzY2FsZSArICIsIiArIHRleHQxc2NhbGUgKyAiLCIgKyAodGV4dDFiYm94LnggKyB0ZXh0MWJib3gud2lkdGggLyAyKSArICIsIiArICh0ZXh0MWJib3gueSArIHRleHQxYmJveC5oZWlnaHQpCiAgICAgIH0pOwogICAgICB0aGlzLnRleHQyLmF0dHIoewogICAgICAgIHRleHQ6IGxhYmVsMiwKICAgICAgICB0cmFuc2Zvcm06ICcnCiAgICAgIH0pOwogICAgICB0ZXh0MmJib3ggPSB0aGlzLnRleHQyLmdldEJCb3goKTsKICAgICAgdGV4dDJzY2FsZSA9IE1hdGgubWluKG1heFdpZHRoIC8gdGV4dDJiYm94LndpZHRoLCBtYXhIZWlnaHRCb3R0b20gLyB0ZXh0MmJib3guaGVpZ2h0KTsKICAgICAgcmV0dXJuIHRoaXMudGV4dDIuYXR0cih7CiAgICAgICAgdHJhbnNmb3JtOiAiUyIgKyB0ZXh0MnNjYWxlICsgIiwiICsgdGV4dDJzY2FsZSArICIsIiArICh0ZXh0MmJib3gueCArIHRleHQyYmJveC53aWR0aCAvIDIpICsgIiwiICsgdGV4dDJiYm94LnkKICAgICAgfSk7CiAgICB9OwoKICAgIERvbnV0LnByb3RvdHlwZS5kcmF3RW1wdHlEb251dExhYmVsID0gZnVuY3Rpb24oeFBvcywgeVBvcywgY29sb3IsIGZvbnRTaXplLCBmb250V2VpZ2h0KSB7CiAgICAgIHZhciB0ZXh0OwogICAgICB0ZXh0ID0gdGhpcy5yYXBoYWVsLnRleHQoeFBvcywgeVBvcywgJycpLmF0dHIoJ2ZvbnQtc2l6ZScsIGZvbnRTaXplKS5hdHRyKCdmaWxsJywgY29sb3IpOwogICAgICBpZiAoZm9udFdlaWdodCAhPSBudWxsKSB7CiAgICAgICAgdGV4dC5hdHRyKCdmb250LXdlaWdodCcsIGZvbnRXZWlnaHQpOwogICAgICB9CiAgICAgIHJldHVybiB0ZXh0OwogICAgfTsKCiAgICBEb251dC5wcm90b3R5cGUucmVzaXplSGFuZGxlciA9IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnRpbWVvdXRJZCA9IG51bGw7CiAgICAgIHRoaXMucmFwaGFlbC5zZXRTaXplKHRoaXMuZWwud2lkdGgoKSwgdGhpcy5lbC5oZWlnaHQoKSk7CiAgICAgIHJldHVybiB0aGlzLnJlZHJhdygpOwogICAgfTsKCiAgICByZXR1cm4gRG9udXQ7CgogIH0pKE1vcnJpcy5FdmVudEVtaXR0ZXIpOwoKICBNb3JyaXMuRG9udXRTZWdtZW50ID0gKGZ1bmN0aW9uKF9zdXBlcikgewogICAgX19leHRlbmRzKERvbnV0U2VnbWVudCwgX3N1cGVyKTsKCiAgICBmdW5jdGlvbiBEb251dFNlZ21lbnQoY3gsIGN5LCBpbm5lciwgb3V0ZXIsIHAwLCBwMSwgY29sb3IsIGJhY2tncm91bmRDb2xvciwgaW5kZXgsIHJhcGhhZWwpIHsKICAgICAgdGhpcy5jeCA9IGN4OwogICAgICB0aGlzLmN5ID0gY3k7CiAgICAgIHRoaXMuaW5uZXIgPSBpbm5lcjsKICAgICAgdGhpcy5vdXRlciA9IG91dGVyOwogICAgICB0aGlzLmNvbG9yID0gY29sb3I7CiAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gYmFja2dyb3VuZENvbG9yOwogICAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMucmFwaGFlbCA9IHJhcGhhZWw7CiAgICAgIHRoaXMuZGVzZWxlY3QgPSBfX2JpbmQodGhpcy5kZXNlbGVjdCwgdGhpcyk7CiAgICAgIHRoaXMuc2VsZWN0ID0gX19iaW5kKHRoaXMuc2VsZWN0LCB0aGlzKTsKICAgICAgdGhpcy5zaW5fcDAgPSBNYXRoLnNpbihwMCk7CiAgICAgIHRoaXMuY29zX3AwID0gTWF0aC5jb3MocDApOwogICAgICB0aGlzLnNpbl9wMSA9IE1hdGguc2luKHAxKTsKICAgICAgdGhpcy5jb3NfcDEgPSBNYXRoLmNvcyhwMSk7CiAgICAgIHRoaXMuaXNfbG9uZyA9IChwMSAtIHAwKSA+IE1hdGguUEkgPyAxIDogMDsKICAgICAgdGhpcy5wYXRoID0gdGhpcy5jYWxjU2VnbWVudCh0aGlzLmlubmVyICsgMywgdGhpcy5pbm5lciArIHRoaXMub3V0ZXIgLSA1KTsKICAgICAgdGhpcy5zZWxlY3RlZFBhdGggPSB0aGlzLmNhbGNTZWdtZW50KHRoaXMuaW5uZXIgKyAzLCB0aGlzLmlubmVyICsgdGhpcy5vdXRlcik7CiAgICAgIHRoaXMuaGlsaWdodCA9IHRoaXMuY2FsY0FyYyh0aGlzLmlubmVyKTsKICAgIH0KCiAgICBEb251dFNlZ21lbnQucHJvdG90eXBlLmNhbGNBcmNQb2ludHMgPSBmdW5jdGlvbihyKSB7CiAgICAgIHJldHVybiBbdGhpcy5jeCArIHIgKiB0aGlzLnNpbl9wMCwgdGhpcy5jeSArIHIgKiB0aGlzLmNvc19wMCwgdGhpcy5jeCArIHIgKiB0aGlzLnNpbl9wMSwgdGhpcy5jeSArIHIgKiB0aGlzLmNvc19wMV07CiAgICB9OwoKICAgIERvbnV0U2VnbWVudC5wcm90b3R5cGUuY2FsY1NlZ21lbnQgPSBmdW5jdGlvbihyMSwgcjIpIHsKICAgICAgdmFyIGl4MCwgaXgxLCBpeTAsIGl5MSwgb3gwLCBveDEsIG95MCwgb3kxLCBfcmVmLCBfcmVmMTsKICAgICAgX3JlZiA9IHRoaXMuY2FsY0FyY1BvaW50cyhyMSksIGl4MCA9IF9yZWZbMF0sIGl5MCA9IF9yZWZbMV0sIGl4MSA9IF9yZWZbMl0sIGl5MSA9IF9yZWZbM107CiAgICAgIF9yZWYxID0gdGhpcy5jYWxjQXJjUG9pbnRzKHIyKSwgb3gwID0gX3JlZjFbMF0sIG95MCA9IF9yZWYxWzFdLCBveDEgPSBfcmVmMVsyXSwgb3kxID0gX3JlZjFbM107CiAgICAgIHJldHVybiAoIk0iICsgaXgwICsgIiwiICsgaXkwKSArICgiQSIgKyByMSArICIsIiArIHIxICsgIiwwLCIgKyB0aGlzLmlzX2xvbmcgKyAiLDAsIiArIGl4MSArICIsIiArIGl5MSkgKyAoIkwiICsgb3gxICsgIiwiICsgb3kxKSArICgiQSIgKyByMiArICIsIiArIHIyICsgIiwwLCIgKyB0aGlzLmlzX2xvbmcgKyAiLDEsIiArIG94MCArICIsIiArIG95MCkgKyAiWiI7CiAgICB9OwoKICAgIERvbnV0U2VnbWVudC5wcm90b3R5cGUuY2FsY0FyYyA9IGZ1bmN0aW9uKHIpIHsKICAgICAgdmFyIGl4MCwgaXgxLCBpeTAsIGl5MSwgX3JlZjsKICAgICAgX3JlZiA9IHRoaXMuY2FsY0FyY1BvaW50cyhyKSwgaXgwID0gX3JlZlswXSwgaXkwID0gX3JlZlsxXSwgaXgxID0gX3JlZlsyXSwgaXkxID0gX3JlZlszXTsKICAgICAgcmV0dXJuICgiTSIgKyBpeDAgKyAiLCIgKyBpeTApICsgKCJBIiArIHIgKyAiLCIgKyByICsgIiwwLCIgKyB0aGlzLmlzX2xvbmcgKyAiLDAsIiArIGl4MSArICIsIiArIGl5MSk7CiAgICB9OwoKICAgIERvbnV0U2VnbWVudC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHRoaXMuYXJjID0gdGhpcy5kcmF3RG9udXRBcmModGhpcy5oaWxpZ2h0LCB0aGlzLmNvbG9yKTsKICAgICAgcmV0dXJuIHRoaXMuc2VnID0gdGhpcy5kcmF3RG9udXRTZWdtZW50KHRoaXMucGF0aCwgdGhpcy5jb2xvciwgdGhpcy5iYWNrZ3JvdW5kQ29sb3IsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfdGhpcy5maXJlKCdob3ZlcicsIF90aGlzLmluZGV4KTsKICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIF90aGlzLmZpcmUoJ2NsaWNrJywgX3RoaXMuaW5kZXgpOwogICAgICB9KTsKICAgIH07CgogICAgRG9udXRTZWdtZW50LnByb3RvdHlwZS5kcmF3RG9udXRBcmMgPSBmdW5jdGlvbihwYXRoLCBjb2xvcikgewogICAgICByZXR1cm4gdGhpcy5yYXBoYWVsLnBhdGgocGF0aCkuYXR0cih7CiAgICAgICAgc3Ryb2tlOiBjb2xvciwKICAgICAgICAnc3Ryb2tlLXdpZHRoJzogMiwKICAgICAgICBvcGFjaXR5OiAwCiAgICAgIH0pOwogICAgfTsKCiAgICBEb251dFNlZ21lbnQucHJvdG90eXBlLmRyYXdEb251dFNlZ21lbnQgPSBmdW5jdGlvbihwYXRoLCBmaWxsQ29sb3IsIHN0cm9rZUNvbG9yLCBob3ZlckZ1bmN0aW9uLCBjbGlja0Z1bmN0aW9uKSB7CiAgICAgIHJldHVybiB0aGlzLnJhcGhhZWwucGF0aChwYXRoKS5hdHRyKHsKICAgICAgICBmaWxsOiBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlOiBzdHJva2VDb2xvciwKICAgICAgICAnc3Ryb2tlLXdpZHRoJzogMwogICAgICB9KS5ob3Zlcihob3ZlckZ1bmN0aW9uKS5jbGljayhjbGlja0Z1bmN0aW9uKTsKICAgIH07CgogICAgRG9udXRTZWdtZW50LnByb3RvdHlwZS5zZWxlY3QgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkKSB7CiAgICAgICAgdGhpcy5zZWcuYW5pbWF0ZSh7CiAgICAgICAgICBwYXRoOiB0aGlzLnNlbGVjdGVkUGF0aAogICAgICAgIH0sIDE1MCwgJzw+Jyk7CiAgICAgICAgdGhpcy5hcmMuYW5pbWF0ZSh7CiAgICAgICAgICBvcGFjaXR5OiAxCiAgICAgICAgfSwgMTUwLCAnPD4nKTsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZCA9IHRydWU7CiAgICAgIH0KICAgIH07CgogICAgRG9udXRTZWdtZW50LnByb3RvdHlwZS5kZXNlbGVjdCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodGhpcy5zZWxlY3RlZCkgewogICAgICAgIHRoaXMuc2VnLmFuaW1hdGUoewogICAgICAgICAgcGF0aDogdGhpcy5wYXRoCiAgICAgICAgfSwgMTUwLCAnPD4nKTsKICAgICAgICB0aGlzLmFyYy5hbmltYXRlKHsKICAgICAgICAgIG9wYWNpdHk6IDAKICAgICAgICB9LCAxNTAsICc8PicpOwogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIERvbnV0U2VnbWVudDsKCiAgfSkoTW9ycmlzLkV2ZW50RW1pdHRlcik7Cgp9KS5jYWxsKHRoaXMpOwo=",
    "size": "66047"
}