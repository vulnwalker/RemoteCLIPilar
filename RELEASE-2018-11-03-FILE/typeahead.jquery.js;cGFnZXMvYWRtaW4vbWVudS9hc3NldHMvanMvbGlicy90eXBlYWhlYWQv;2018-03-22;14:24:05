{
    "namaFile": "pages\/admin\/menu\/assets\/js\/libs\/typeahead\/typeahead.jquery.js",
    "lastUpdate": "2018-03-22+14:24:05.79",
    "contentFile": "LyohCiAqIHR5cGVhaGVhZC5qcyAwLjEwLjUKICogaHR0cHM6Ly9naXRodWIuY29tL3R3aXR0ZXIvdHlwZWFoZWFkLmpzCiAqIENvcHlyaWdodCAyMDEzLTIwMTQgVHdpdHRlciwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzOyBMaWNlbnNlZCBNSVQKICovCgooZnVuY3Rpb24oJCkgewogICAgdmFyIF8gPSBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaXNNc2llOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKG1zaWV8dHJpZGVudCkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpID8gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvKG1zaWUgfHJ2OikoXGQrKC5cZCspPykvaSlbMl0gOiBmYWxzZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNCbGFua1N0cmluZzogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIXN0ciB8fCAvXlxzKiQvLnRlc3Qoc3RyKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXNjYXBlUmVnRXhDaGFyczogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcLVxbXF1cL1x7XH1cKFwpXCpcK1w\/XC5cXFxeXCRcfF0vZywgIlxcJCYiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNTdHJpbmc6IGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJzdHJpbmciOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc051bWJlcjogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gIm51bWJlciI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzQXJyYXk6ICQuaXNBcnJheSwKICAgICAgICAgICAgaXNGdW5jdGlvbjogJC5pc0Z1bmN0aW9uLAogICAgICAgICAgICBpc09iamVjdDogJC5pc1BsYWluT2JqZWN0LAogICAgICAgICAgICBpc1VuZGVmaW5lZDogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gInVuZGVmaW5lZCI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvU3RyOiBmdW5jdGlvbiB0b1N0cihzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gXy5pc1VuZGVmaW5lZChzKSB8fCBzID09PSBudWxsID8gIiIgOiBzICsgIiI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJpbmQ6ICQucHJveHksCiAgICAgICAgICAgIGVhY2g6IGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGNiKSB7CiAgICAgICAgICAgICAgICAkLmVhY2goY29sbGVjdGlvbiwgcmV2ZXJzZUFyZ3MpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZUFyZ3MoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNiKHZhbHVlLCBpbmRleCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1hcDogJC5tYXAsCiAgICAgICAgICAgIGZpbHRlcjogJC5ncmVwLAogICAgICAgICAgICBldmVyeTogZnVuY3Rpb24ob2JqLCB0ZXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEocmVzdWx0ID0gdGVzdC5jYWxsKG51bGwsIHZhbCwga2V5LCBvYmopKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gISFyZXN1bHQ7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNvbWU6IGZ1bmN0aW9uKG9iaiwgdGVzdCkgewogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJC5lYWNoKG9iaiwgZnVuY3Rpb24oa2V5LCB2YWwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID0gdGVzdC5jYWxsKG51bGwsIHZhbCwga2V5LCBvYmopKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiAhIXJlc3VsdDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWl4aW46ICQuZXh0ZW5kLAogICAgICAgICAgICBnZXRVbmlxdWVJZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50ZXIrKzsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0oKSwKICAgICAgICAgICAgdGVtcGxhdGlmeTogZnVuY3Rpb24gdGVtcGxhdGlmeShvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiAkLmlzRnVuY3Rpb24ob2JqKSA\/IG9iaiA6IHRlbXBsYXRlOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdGVtcGxhdGUoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhvYmopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZlcjogZnVuY3Rpb24oZm4pIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZm4sIDApOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWJvdW5jZTogZnVuY3Rpb24oZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7CiAgICAgICAgICAgICAgICB2YXIgdGltZW91dCwgcmVzdWx0OwogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50cywgbGF0ZXIsIGNhbGxOb3c7CiAgICAgICAgICAgICAgICAgICAgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW1tZWRpYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRocm90dGxlOiBmdW5jdGlvbihmdW5jLCB3YWl0KSB7CiAgICAgICAgICAgICAgICB2YXIgY29udGV4dCwgYXJncywgdGltZW91dCwgcmVzdWx0LCBwcmV2aW91cywgbGF0ZXI7CiAgICAgICAgICAgICAgICBwcmV2aW91cyA9IDA7CiAgICAgICAgICAgICAgICBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKSwgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgICAgICAgICAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGltZW91dCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5vb3A6IGZ1bmN0aW9uKCkge30KICAgICAgICB9OwogICAgfSgpOwogICAgdmFyIGh0bWwgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB3cmFwcGVyOiAnPHNwYW4gY2xhc3M9InR3aXR0ZXItdHlwZWFoZWFkIj48L3NwYW4+JywKICAgICAgICAgICAgZHJvcGRvd246ICc8c3BhbiBjbGFzcz0idHQtZHJvcGRvd24tbWVudSI+PC9zcGFuPicsCiAgICAgICAgICAgIGRhdGFzZXQ6ICc8ZGl2IGNsYXNzPSJ0dC1kYXRhc2V0LSVDTEFTUyUiPjwvZGl2PicsCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zOiAnPHNwYW4gY2xhc3M9InR0LXN1Z2dlc3Rpb25zIj48L3NwYW4+JywKICAgICAgICAgICAgc3VnZ2VzdGlvbjogJzxkaXYgY2xhc3M9InR0LXN1Z2dlc3Rpb24iPjwvZGl2PicKICAgICAgICB9OwogICAgfSgpOwogICAgdmFyIGNzcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgY3NzID0gewogICAgICAgICAgICB3cmFwcGVyOiB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhpbnQ6IHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgdG9wOiAiMCIsCiAgICAgICAgICAgICAgICBsZWZ0OiAiMCIsCiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogInRyYW5zcGFyZW50IiwKICAgICAgICAgICAgICAgIGJveFNoYWRvdzogIm5vbmUiLAogICAgICAgICAgICAgICAgb3BhY2l0eTogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICJ0b3AiLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAidHJhbnNwYXJlbnQiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlucHV0V2l0aE5vSGludDogewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAidG9wIgogICAgICAgICAgICB9LAogICAgICAgICAgICBkcm9wZG93bjogewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICB0b3A6ICIxMDAlIiwKICAgICAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgICAgIHpJbmRleDogIjEwMCIsCiAgICAgICAgICAgICAgICBkaXNwbGF5OiAibm9uZSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VnZ2VzdGlvbnM6IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJibG9jayIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VnZ2VzdGlvbjogewogICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogIm5vd3JhcCIsCiAgICAgICAgICAgICAgICBjdXJzb3I6ICJwb2ludGVyIgogICAgICAgICAgICB9LAogICAgICAgICAgICBzdWdnZXN0aW9uQ2hpbGQ6IHsKICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3JtYWwiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGx0cjogewogICAgICAgICAgICAgICAgbGVmdDogIjAiLAogICAgICAgICAgICAgICAgcmlnaHQ6ICJhdXRvIgogICAgICAgICAgICB9LAogICAgICAgICAgICBydGw6IHsKICAgICAgICAgICAgICAgIGxlZnQ6ICJhdXRvIiwKICAgICAgICAgICAgICAgIHJpZ2h0OiAiIDAiCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGlmIChfLmlzTXNpZSgpKSB7CiAgICAgICAgICAgIF8ubWl4aW4oY3NzLmlucHV0LCB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICJ1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3KSIKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChfLmlzTXNpZSgpICYmIF8uaXNNc2llKCkgPD0gNykgewogICAgICAgICAgICBfLm1peGluKGNzcy5pbnB1dCwgewogICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAiLTFweCIKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjc3M7CiAgICB9KCk7CiAgICB2YXIgRXZlbnRCdXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIG5hbWVzcGFjZSA9ICJ0eXBlYWhlYWQ6IjsKICAgICAgICBmdW5jdGlvbiBFdmVudEJ1cyhvKSB7CiAgICAgICAgICAgIGlmICghbyB8fCAhby5lbCkgewogICAgICAgICAgICAgICAgJC5lcnJvcigiRXZlbnRCdXMgaW5pdGlhbGl6ZWQgd2l0aG91dCBlbCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJGVsID0gJChvLmVsKTsKICAgICAgICB9CiAgICAgICAgXy5taXhpbihFdmVudEJ1cy5wcm90b3R5cGUsIHsKICAgICAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24odHlwZSkgewogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKG5hbWVzcGFjZSArIHR5cGUsIGFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIEV2ZW50QnVzOwogICAgfSgpOwogICAgdmFyIEV2ZW50RW1pdHRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgc3BsaXR0ZXIgPSAvXHMrLywgbmV4dFRpY2sgPSBnZXROZXh0VGljaygpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIG9uU3luYzogb25TeW5jLAogICAgICAgICAgICBvbkFzeW5jOiBvbkFzeW5jLAogICAgICAgICAgICBvZmY6IG9mZiwKICAgICAgICAgICAgdHJpZ2dlcjogdHJpZ2dlcgogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gb24obWV0aG9kLCB0eXBlcywgY2IsIGNvbnRleHQpIHsKICAgICAgICAgICAgdmFyIHR5cGU7CiAgICAgICAgICAgIGlmICghY2IpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoc3BsaXR0ZXIpOwogICAgICAgICAgICBjYiA9IGNvbnRleHQgPyBiaW5kQ29udGV4dChjYiwgY29udGV4dCkgOiBjYjsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9OwogICAgICAgICAgICB3aGlsZSAodHlwZSA9IHR5cGVzLnNoaWZ0KCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrc1t0eXBlXSA9IHRoaXMuX2NhbGxiYWNrc1t0eXBlXSB8fCB7CiAgICAgICAgICAgICAgICAgICAgc3luYzogW10sCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IFtdCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzW3R5cGVdW21ldGhvZF0ucHVzaChjYik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9uQXN5bmModHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBvbi5jYWxsKHRoaXMsICJhc3luYyIsIHR5cGVzLCBjYiwgY29udGV4dCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9uU3luYyh0eXBlcywgY2IsIGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIG9uLmNhbGwodGhpcywgInN5bmMiLCB0eXBlcywgY2IsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvZmYodHlwZXMpIHsKICAgICAgICAgICAgdmFyIHR5cGU7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgd2hpbGUgKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fY2FsbGJhY2tzW3R5cGVdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyKHR5cGVzKSB7CiAgICAgICAgICAgIHZhciB0eXBlLCBjYWxsYmFja3MsIGFyZ3MsIHN5bmNGbHVzaCwgYXN5bmNGbHVzaDsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoc3BsaXR0ZXIpOwogICAgICAgICAgICBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgICAgICB3aGlsZSAoKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSAmJiAoY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzW3R5cGVdKSkgewogICAgICAgICAgICAgICAgc3luY0ZsdXNoID0gZ2V0Rmx1c2goY2FsbGJhY2tzLnN5bmMsIHRoaXMsIFsgdHlwZSBdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgICAgICAgICBhc3luY0ZsdXNoID0gZ2V0Rmx1c2goY2FsbGJhY2tzLmFzeW5jLCB0aGlzLCBbIHR5cGUgXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgICAgc3luY0ZsdXNoKCkgJiYgbmV4dFRpY2soYXN5bmNGbHVzaCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldEZsdXNoKGNhbGxiYWNrcywgY29udGV4dCwgYXJncykgewogICAgICAgICAgICByZXR1cm4gZmx1c2g7CiAgICAgICAgICAgIGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICAgICAgICAgICAgdmFyIGNhbmNlbGxlZDsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBjYWxsYmFja3MubGVuZ3RoOyAhY2FuY2VsbGVkICYmIGkgPCBsZW47IGkgKz0gMSkgewogICAgICAgICAgICAgICAgICAgIGNhbmNlbGxlZCA9IGNhbGxiYWNrc1tpXS5hcHBseShjb250ZXh0LCBhcmdzKSA9PT0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gIWNhbmNlbGxlZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXROZXh0VGljaygpIHsKICAgICAgICAgICAgdmFyIG5leHRUaWNrRm47CiAgICAgICAgICAgIGlmICh3aW5kb3cuc2V0SW1tZWRpYXRlKSB7CiAgICAgICAgICAgICAgICBuZXh0VGlja0ZuID0gZnVuY3Rpb24gbmV4dFRpY2tTZXRJbW1lZGlhdGUoZm4pIHsKICAgICAgICAgICAgICAgICAgICBzZXRJbW1lZGlhdGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZuKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmV4dFRpY2tGbiA9IGZ1bmN0aW9uIG5leHRUaWNrU2V0VGltZW91dChmbikgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZuKCk7CiAgICAgICAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXh0VGlja0ZuOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiaW5kQ29udGV4dChmbiwgY29udGV4dCkgewogICAgICAgICAgICByZXR1cm4gZm4uYmluZCA\/IGZuLmJpbmQoY29udGV4dCkgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGZuLmFwcGx5KGNvbnRleHQsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfSgpOwogICAgdmFyIGhpZ2hsaWdodCA9IGZ1bmN0aW9uKGRvYykgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgICAgIG5vZGU6IG51bGwsCiAgICAgICAgICAgIHBhdHRlcm46IG51bGwsCiAgICAgICAgICAgIHRhZ05hbWU6ICJzdHJvbmciLAogICAgICAgICAgICBjbGFzc05hbWU6IG51bGwsCiAgICAgICAgICAgIHdvcmRzT25seTogZmFsc2UsCiAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gaGlnaHRsaWdodChvKSB7CiAgICAgICAgICAgIHZhciByZWdleDsKICAgICAgICAgICAgbyA9IF8ubWl4aW4oe30sIGRlZmF1bHRzLCBvKTsKICAgICAgICAgICAgaWYgKCFvLm5vZGUgfHwgIW8ucGF0dGVybikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG8ucGF0dGVybiA9IF8uaXNBcnJheShvLnBhdHRlcm4pID8gby5wYXR0ZXJuIDogWyBvLnBhdHRlcm4gXTsKICAgICAgICAgICAgcmVnZXggPSBnZXRSZWdleChvLnBhdHRlcm4sIG8uY2FzZVNlbnNpdGl2ZSwgby53b3Jkc09ubHkpOwogICAgICAgICAgICB0cmF2ZXJzZShvLm5vZGUsIGhpZ2h0bGlnaHRUZXh0Tm9kZSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGhpZ2h0bGlnaHRUZXh0Tm9kZSh0ZXh0Tm9kZSkgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoLCBwYXR0ZXJuTm9kZSwgd3JhcHBlck5vZGU7CiAgICAgICAgICAgICAgICBpZiAobWF0Y2ggPSByZWdleC5leGVjKHRleHROb2RlLmRhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgd3JhcHBlck5vZGUgPSBkb2MuY3JlYXRlRWxlbWVudChvLnRhZ05hbWUpOwogICAgICAgICAgICAgICAgICAgIG8uY2xhc3NOYW1lICYmICh3cmFwcGVyTm9kZS5jbGFzc05hbWUgPSBvLmNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk5vZGUgPSB0ZXh0Tm9kZS5zcGxpdFRleHQobWF0Y2guaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Ob2RlLnNwbGl0VGV4dChtYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHdyYXBwZXJOb2RlLmFwcGVuZENoaWxkKHBhdHRlcm5Ob2RlLmNsb25lTm9kZSh0cnVlKSk7CiAgICAgICAgICAgICAgICAgICAgdGV4dE5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQod3JhcHBlck5vZGUsIHBhdHRlcm5Ob2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAhIW1hdGNoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlKGVsLCBoaWdodGxpZ2h0VGV4dE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBjaGlsZE5vZGUsIFRFWFRfTk9ERV9UWVBFID0gMzsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZSA9IGVsLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkTm9kZS5ub2RlVHlwZSA9PT0gVEVYVF9OT0RFX1RZUEUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaSArPSBoaWdodGxpZ2h0VGV4dE5vZGUoY2hpbGROb2RlKSA\/IDEgOiAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYXZlcnNlKGNoaWxkTm9kZSwgaGlnaHRsaWdodFRleHROb2RlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGdldFJlZ2V4KHBhdHRlcm5zLCBjYXNlU2Vuc2l0aXZlLCB3b3Jkc09ubHkpIHsKICAgICAgICAgICAgdmFyIGVzY2FwZWRQYXR0ZXJucyA9IFtdLCByZWdleFN0cjsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBhdHRlcm5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlc2NhcGVkUGF0dGVybnMucHVzaChfLmVzY2FwZVJlZ0V4Q2hhcnMocGF0dGVybnNbaV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWdleFN0ciA9IHdvcmRzT25seSA\/ICJcXGIoIiArIGVzY2FwZWRQYXR0ZXJucy5qb2luKCJ8IikgKyAiKVxcYiIgOiAiKCIgKyBlc2NhcGVkUGF0dGVybnMuam9pbigifCIpICsgIikiOwogICAgICAgICAgICByZXR1cm4gY2FzZVNlbnNpdGl2ZSA\/IG5ldyBSZWdFeHAocmVnZXhTdHIpIDogbmV3IFJlZ0V4cChyZWdleFN0ciwgImkiKTsKICAgICAgICB9CiAgICB9KHdpbmRvdy5kb2N1bWVudCk7CiAgICB2YXIgSW5wdXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIHNwZWNpYWxLZXlDb2RlTWFwOwogICAgICAgIHNwZWNpYWxLZXlDb2RlTWFwID0gewogICAgICAgICAgICA5OiAidGFiIiwKICAgICAgICAgICAgMjc6ICJlc2MiLAogICAgICAgICAgICAzNzogImxlZnQiLAogICAgICAgICAgICAzOTogInJpZ2h0IiwKICAgICAgICAgICAgMTM6ICJlbnRlciIsCiAgICAgICAgICAgIDM4OiAidXAiLAogICAgICAgICAgICA0MDogImRvd24iCiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBJbnB1dChvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25CbHVyLCBvbkZvY3VzLCBvbktleWRvd24sIG9uSW5wdXQ7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uaW5wdXQpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoImlucHV0IGlzIG1pc3NpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvbkJsdXIgPSBfLmJpbmQodGhpcy5fb25CbHVyLCB0aGlzKTsKICAgICAgICAgICAgb25Gb2N1cyA9IF8uYmluZCh0aGlzLl9vbkZvY3VzLCB0aGlzKTsKICAgICAgICAgICAgb25LZXlkb3duID0gXy5iaW5kKHRoaXMuX29uS2V5ZG93biwgdGhpcyk7CiAgICAgICAgICAgIG9uSW5wdXQgPSBfLmJpbmQodGhpcy5fb25JbnB1dCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuJGhpbnQgPSAkKG8uaGludCk7CiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gJChvLmlucHV0KS5vbigiYmx1ci50dCIsIG9uQmx1cikub24oImZvY3VzLnR0Iiwgb25Gb2N1cykub24oImtleWRvd24udHQiLCBvbktleWRvd24pOwogICAgICAgICAgICBpZiAodGhpcy4kaGludC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SGludCA9IHRoaXMuZ2V0SGludCA9IHRoaXMuY2xlYXJIaW50ID0gdGhpcy5jbGVhckhpbnRJZkludmFsaWQgPSBfLm5vb3A7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFfLmlzTXNpZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5vbigiaW5wdXQudHQiLCBvbklucHV0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCJrZXlkb3duLnR0IGtleXByZXNzLnR0IGN1dC50dCBwYXN0ZS50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWNpYWxLZXlDb2RlTWFwWyRlLndoaWNoIHx8ICRlLmtleUNvZGVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihfLmJpbmQodGhhdC5fb25JbnB1dCwgdGhhdCwgJGUpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucXVlcnkgPSB0aGlzLiRpbnB1dC52YWwoKTsKICAgICAgICAgICAgdGhpcy4kb3ZlcmZsb3dIZWxwZXIgPSBidWlsZE92ZXJmbG93SGVscGVyKHRoaXMuJGlucHV0KTsKICAgICAgICB9CiAgICAgICAgSW5wdXQubm9ybWFsaXplUXVlcnkgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIChzdHIgfHwgIiIpLnJlcGxhY2UoL15ccyovZywgIiIpLnJlcGxhY2UoL1xzezIsfS9nLCAiICIpOwogICAgICAgIH07CiAgICAgICAgXy5taXhpbihJbnB1dC5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJibHVycmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKCkgewogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJmb2N1c2VkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbktleWRvd246IGZ1bmN0aW9uIG9uS2V5ZG93bigkZSkgewogICAgICAgICAgICAgICAgdmFyIGtleU5hbWUgPSBzcGVjaWFsS2V5Q29kZU1hcFskZS53aGljaCB8fCAkZS5rZXlDb2RlXTsKICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZVByZXZlbnREZWZhdWx0KGtleU5hbWUsICRlKTsKICAgICAgICAgICAgICAgIGlmIChrZXlOYW1lICYmIHRoaXMuX3Nob3VsZFRyaWdnZXIoa2V5TmFtZSwgJGUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKGtleU5hbWUgKyAiS2V5ZWQiLCAkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbklucHV0OiBmdW5jdGlvbiBvbklucHV0KCkgewogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9tYW5hZ2VQcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gbWFuYWdlUHJldmVudERlZmF1bHQoa2V5TmFtZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCwgaGludFZhbHVlLCBpbnB1dFZhbHVlOwogICAgICAgICAgICAgICAgc3dpdGNoIChrZXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgInRhYiI6CiAgICAgICAgICAgICAgICAgICAgaGludFZhbHVlID0gdGhpcy5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ID0gaGludFZhbHVlICYmIGhpbnRWYWx1ZSAhPT0gaW5wdXRWYWx1ZSAmJiAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgInVwIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiZG93biI6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ICYmICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zaG91bGRUcmlnZ2VyOiBmdW5jdGlvbiBzaG91bGRUcmlnZ2VyKGtleU5hbWUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlcjsKICAgICAgICAgICAgICAgIHN3aXRjaCAoa2V5TmFtZSkgewogICAgICAgICAgICAgICAgICBjYXNlICJ0YWIiOgogICAgICAgICAgICAgICAgICAgIHRyaWdnZXIgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJpZ2dlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2NoZWNrSW5wdXRWYWx1ZTogZnVuY3Rpb24gY2hlY2tJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgdmFyIGlucHV0VmFsdWUsIGFyZUVxdWl2YWxlbnQsIGhhc0RpZmZlcmVudFdoaXRlc3BhY2U7CiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICBhcmVFcXVpdmFsZW50ID0gYXJlUXVlcmllc0VxdWl2YWxlbnQoaW5wdXRWYWx1ZSwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICBoYXNEaWZmZXJlbnRXaGl0ZXNwYWNlID0gYXJlRXF1aXZhbGVudCA\/IHRoaXMucXVlcnkubGVuZ3RoICE9PSBpbnB1dFZhbHVlLmxlbmd0aCA6IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IGlucHV0VmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoIWFyZUVxdWl2YWxlbnQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoInF1ZXJ5Q2hhbmdlZCIsIHRoaXMucXVlcnkpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNEaWZmZXJlbnRXaGl0ZXNwYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJ3aGl0ZXNwYWNlQ2hhbmdlZCIsIHRoaXMucXVlcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBmb2N1czogZnVuY3Rpb24gZm9jdXMoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5mb2N1cygpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBibHVyOiBmdW5jdGlvbiBibHVyKCkgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuYmx1cigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRRdWVyeTogZnVuY3Rpb24gZ2V0UXVlcnkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5xdWVyeTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0UXVlcnk6IGZ1bmN0aW9uIHNldFF1ZXJ5KHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uIGdldElucHV0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaW5wdXQudmFsKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldElucHV0VmFsdWU6IGZ1bmN0aW9uIHNldElucHV0VmFsdWUodmFsdWUsIHNpbGVudCkgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQudmFsKHZhbHVlKTsKICAgICAgICAgICAgICAgIHNpbGVudCA\/IHRoaXMuY2xlYXJIaW50KCkgOiB0aGlzLl9jaGVja0lucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVzZXRJbnB1dFZhbHVlOiBmdW5jdGlvbiByZXNldElucHV0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0VmFsdWUodGhpcy5xdWVyeSwgdHJ1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldEhpbnQ6IGZ1bmN0aW9uIGdldEhpbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaGludC52YWwoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0SGludDogZnVuY3Rpb24gc2V0SGludCh2YWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy4kaGludC52YWwodmFsdWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGVhckhpbnQ6IGZ1bmN0aW9uIGNsZWFySGludCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SGludCgiIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFySGludElmSW52YWxpZDogZnVuY3Rpb24gY2xlYXJIaW50SWZJbnZhbGlkKCkgewogICAgICAgICAgICAgICAgdmFyIHZhbCwgaGludCwgdmFsSXNQcmVmaXhPZkhpbnQsIGlzVmFsaWQ7CiAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLmdldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGhpbnQgPSB0aGlzLmdldEhpbnQoKTsKICAgICAgICAgICAgICAgIHZhbElzUHJlZml4T2ZIaW50ID0gdmFsICE9PSBoaW50ICYmIGhpbnQuaW5kZXhPZih2YWwpID09PSAwOwogICAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCAhPT0gIiIgJiYgdmFsSXNQcmVmaXhPZkhpbnQgJiYgIXRoaXMuaGFzT3ZlcmZsb3coKTsKICAgICAgICAgICAgICAgICFpc1ZhbGlkICYmIHRoaXMuY2xlYXJIaW50KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldExhbmd1YWdlRGlyZWN0aW9uOiBmdW5jdGlvbiBnZXRMYW5ndWFnZURpcmVjdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAodGhpcy4kaW5wdXQuY3NzKCJkaXJlY3Rpb24iKSB8fCAibHRyIikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGFzT3ZlcmZsb3c6IGZ1bmN0aW9uIGhhc092ZXJmbG93KCkgewogICAgICAgICAgICAgICAgdmFyIGNvbnN0cmFpbnQgPSB0aGlzLiRpbnB1dC53aWR0aCgpIC0gMjsKICAgICAgICAgICAgICAgIHRoaXMuJG92ZXJmbG93SGVscGVyLnRleHQodGhpcy5nZXRJbnB1dFZhbHVlKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG92ZXJmbG93SGVscGVyLndpZHRoKCkgPj0gY29uc3RyYWludDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNDdXJzb3JBdEVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWVMZW5ndGgsIHNlbGVjdGlvblN0YXJ0LCByYW5nZTsKICAgICAgICAgICAgICAgIHZhbHVlTGVuZ3RoID0gdGhpcy4kaW5wdXQudmFsKCkubGVuZ3RoOwogICAgICAgICAgICAgICAgc2VsZWN0aW9uU3RhcnQgPSB0aGlzLiRpbnB1dFswXS5zZWxlY3Rpb25TdGFydDsKICAgICAgICAgICAgICAgIGlmIChfLmlzTnVtYmVyKHNlbGVjdGlvblN0YXJ0KSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3Rpb25TdGFydCA9PT0gdmFsdWVMZW5ndGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewogICAgICAgICAgICAgICAgICAgIHJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2UubW92ZVN0YXJ0KCJjaGFyYWN0ZXIiLCAtdmFsdWVMZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZUxlbmd0aCA9PT0gcmFuZ2UudGV4dC5sZW5ndGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGhpbnQub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9mZigiLnR0Iik7CiAgICAgICAgICAgICAgICB0aGlzLiRoaW50ID0gdGhpcy4kaW5wdXQgPSB0aGlzLiRvdmVyZmxvd0hlbHBlciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gSW5wdXQ7CiAgICAgICAgZnVuY3Rpb24gYnVpbGRPdmVyZmxvd0hlbHBlcigkaW5wdXQpIHsKICAgICAgICAgICAgcmV0dXJuICQoJzxwcmUgYXJpYS1oaWRkZW49InRydWUiPjwvcHJlPicpLmNzcyh7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICJoaWRkZW4iLAogICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogInByZSIsCiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiAkaW5wdXQuY3NzKCJmb250LWZhbWlseSIpLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICRpbnB1dC5jc3MoImZvbnQtc2l6ZSIpLAogICAgICAgICAgICAgICAgZm9udFN0eWxlOiAkaW5wdXQuY3NzKCJmb250LXN0eWxlIiksCiAgICAgICAgICAgICAgICBmb250VmFyaWFudDogJGlucHV0LmNzcygiZm9udC12YXJpYW50IiksCiAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiAkaW5wdXQuY3NzKCJmb250LXdlaWdodCIpLAogICAgICAgICAgICAgICAgd29yZFNwYWNpbmc6ICRpbnB1dC5jc3MoIndvcmQtc3BhY2luZyIpLAogICAgICAgICAgICAgICAgbGV0dGVyU3BhY2luZzogJGlucHV0LmNzcygibGV0dGVyLXNwYWNpbmciKSwKICAgICAgICAgICAgICAgIHRleHRJbmRlbnQ6ICRpbnB1dC5jc3MoInRleHQtaW5kZW50IiksCiAgICAgICAgICAgICAgICB0ZXh0UmVuZGVyaW5nOiAkaW5wdXQuY3NzKCJ0ZXh0LXJlbmRlcmluZyIpLAogICAgICAgICAgICAgICAgdGV4dFRyYW5zZm9ybTogJGlucHV0LmNzcygidGV4dC10cmFuc2Zvcm0iKQogICAgICAgICAgICB9KS5pbnNlcnRBZnRlcigkaW5wdXQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhcmVRdWVyaWVzRXF1aXZhbGVudChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBJbnB1dC5ub3JtYWxpemVRdWVyeShhKSA9PT0gSW5wdXQubm9ybWFsaXplUXVlcnkoYik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdpdGhNb2RpZmllcigkZSkgewogICAgICAgICAgICByZXR1cm4gJGUuYWx0S2V5IHx8ICRlLmN0cmxLZXkgfHwgJGUubWV0YUtleSB8fCAkZS5zaGlmdEtleTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgRGF0YXNldCA9IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgZGF0YXNldEtleSA9ICJ0dERhdGFzZXQiLCB2YWx1ZUtleSA9ICJ0dFZhbHVlIiwgZGF0dW1LZXkgPSAidHREYXR1bSI7CiAgICAgICAgZnVuY3Rpb24gRGF0YXNldChvKSB7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBvLnRlbXBsYXRlcyA9IG8udGVtcGxhdGVzIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uc291cmNlKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtaXNzaW5nIHNvdXJjZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvLm5hbWUgJiYgIWlzVmFsaWROYW1lKG8ubmFtZSkpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoImludmFsaWQgZGF0YXNldCBuYW1lOiAiICsgby5uYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5oaWdobGlnaHQgPSAhIW8uaGlnaGxpZ2h0OwogICAgICAgICAgICB0aGlzLm5hbWUgPSBvLm5hbWUgfHwgXy5nZXRVbmlxdWVJZCgpOwogICAgICAgICAgICB0aGlzLnNvdXJjZSA9IG8uc291cmNlOwogICAgICAgICAgICB0aGlzLmRpc3BsYXlGbiA9IGdldERpc3BsYXlGbihvLmRpc3BsYXkgfHwgby5kaXNwbGF5S2V5KTsKICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZXMgPSBnZXRUZW1wbGF0ZXMoby50ZW1wbGF0ZXMsIHRoaXMuZGlzcGxheUZuKTsKICAgICAgICAgICAgdGhpcy4kZWwgPSAkKGh0bWwuZGF0YXNldC5yZXBsYWNlKCIlQ0xBU1MlIiwgdGhpcy5uYW1lKSk7CiAgICAgICAgfQogICAgICAgIERhdGFzZXQuZXh0cmFjdERhdGFzZXROYW1lID0gZnVuY3Rpb24gZXh0cmFjdERhdGFzZXROYW1lKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKGRhdGFzZXRLZXkpOwogICAgICAgIH07CiAgICAgICAgRGF0YXNldC5leHRyYWN0VmFsdWUgPSBmdW5jdGlvbiBleHRyYWN0RGF0dW0oZWwpIHsKICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEodmFsdWVLZXkpOwogICAgICAgIH07CiAgICAgICAgRGF0YXNldC5leHRyYWN0RGF0dW0gPSBmdW5jdGlvbiBleHRyYWN0RGF0dW0oZWwpIHsKICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoZGF0dW1LZXkpOwogICAgICAgIH07CiAgICAgICAgXy5taXhpbihEYXRhc2V0LnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9yZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihxdWVyeSwgc3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy4kZWwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGhhc1N1Z2dlc3Rpb25zOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZW1wdHkoKTsKICAgICAgICAgICAgICAgIGhhc1N1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnMgJiYgc3VnZ2VzdGlvbnMubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKCFoYXNTdWdnZXN0aW9ucyAmJiB0aGlzLnRlbXBsYXRlcy5lbXB0eSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoZ2V0RW1wdHlIdG1sKCkpLnByZXBlbmQodGhhdC50ZW1wbGF0ZXMuaGVhZGVyID8gZ2V0SGVhZGVySHRtbCgpIDogbnVsbCkuYXBwZW5kKHRoYXQudGVtcGxhdGVzLmZvb3RlciA\/IGdldEZvb3Rlckh0bWwoKSA6IG51bGwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNTdWdnZXN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoZ2V0U3VnZ2VzdGlvbnNIdG1sKCkpLnByZXBlbmQodGhhdC50ZW1wbGF0ZXMuaGVhZGVyID8gZ2V0SGVhZGVySHRtbCgpIDogbnVsbCkuYXBwZW5kKHRoYXQudGVtcGxhdGVzLmZvb3RlciA\/IGdldEZvb3Rlckh0bWwoKSA6IG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJyZW5kZXJlZCIpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RW1wdHlIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnRlbXBsYXRlcy5lbXB0eSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbnNIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkc3VnZ2VzdGlvbnMsIG5vZGVzOwogICAgICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucyA9ICQoaHRtbC5zdWdnZXN0aW9ucykuY3NzKGNzcy5zdWdnZXN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgbm9kZXMgPSBfLm1hcChzdWdnZXN0aW9ucywgZ2V0U3VnZ2VzdGlvbk5vZGUpOwogICAgICAgICAgICAgICAgICAgICRzdWdnZXN0aW9ucy5hcHBlbmQuYXBwbHkoJHN1Z2dlc3Rpb25zLCBub2Rlcyk7CiAgICAgICAgICAgICAgICAgICAgdGhhdC5oaWdobGlnaHQgJiYgaGlnaGxpZ2h0KHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAidHQtaGlnaGxpZ2h0IiwKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZTogJHN1Z2dlc3Rpb25zWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiBxdWVyeQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3VnZ2VzdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U3VnZ2VzdGlvbk5vZGUoc3VnZ2VzdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGVsOwogICAgICAgICAgICAgICAgICAgICAgICAkZWwgPSAkKGh0bWwuc3VnZ2VzdGlvbikuYXBwZW5kKHRoYXQudGVtcGxhdGVzLnN1Z2dlc3Rpb24oc3VnZ2VzdGlvbikpLmRhdGEoZGF0YXNldEtleSwgdGhhdC5uYW1lKS5kYXRhKHZhbHVlS2V5LCB0aGF0LmRpc3BsYXlGbihzdWdnZXN0aW9uKSkuZGF0YShkYXR1bUtleSwgc3VnZ2VzdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICRlbC5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhjc3Muc3VnZ2VzdGlvbkNoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZWw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0SGVhZGVySHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC50ZW1wbGF0ZXMuaGVhZGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICBpc0VtcHR5OiAhaGFzU3VnZ2VzdGlvbnMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZvb3Rlckh0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudGVtcGxhdGVzLmZvb3Rlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogIWhhc1N1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFJvb3Q6IGZ1bmN0aW9uIGdldFJvb3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWw7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7CiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnNvdXJjZShxdWVyeSwgcmVuZGVyKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlcihzdWdnZXN0aW9ucykgewogICAgICAgICAgICAgICAgICAgIGlmICghdGhhdC5jYW5jZWxlZCAmJiBxdWVyeSA9PT0gdGhhdC5xdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9yZW5kZXIocXVlcnksIHN1Z2dlc3Rpb25zKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbmNlbDogZnVuY3Rpb24gY2FuY2VsKCkgewogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxlZCA9IHRydWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJyZW5kZXJlZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0VtcHR5OiBmdW5jdGlvbiBpc0VtcHR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsLmlzKCI6ZW1wdHkiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBEYXRhc2V0OwogICAgICAgIGZ1bmN0aW9uIGdldERpc3BsYXlGbihkaXNwbGF5KSB7CiAgICAgICAgICAgIGRpc3BsYXkgPSBkaXNwbGF5IHx8ICJ2YWx1ZSI7CiAgICAgICAgICAgIHJldHVybiBfLmlzRnVuY3Rpb24oZGlzcGxheSkgPyBkaXNwbGF5IDogZGlzcGxheUZuOwogICAgICAgICAgICBmdW5jdGlvbiBkaXNwbGF5Rm4ob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqW2Rpc3BsYXldOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldFRlbXBsYXRlcyh0ZW1wbGF0ZXMsIGRpc3BsYXlGbikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgZW1wdHk6IHRlbXBsYXRlcy5lbXB0eSAmJiBfLnRlbXBsYXRpZnkodGVtcGxhdGVzLmVtcHR5KSwKICAgICAgICAgICAgICAgIGhlYWRlcjogdGVtcGxhdGVzLmhlYWRlciAmJiBfLnRlbXBsYXRpZnkodGVtcGxhdGVzLmhlYWRlciksCiAgICAgICAgICAgICAgICBmb290ZXI6IHRlbXBsYXRlcy5mb290ZXIgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5mb290ZXIpLAogICAgICAgICAgICAgICAgc3VnZ2VzdGlvbjogdGVtcGxhdGVzLnN1Z2dlc3Rpb24gfHwgc3VnZ2VzdGlvblRlbXBsYXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGZ1bmN0aW9uIHN1Z2dlc3Rpb25UZW1wbGF0ZShjb250ZXh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIjxwPiIgKyBkaXNwbGF5Rm4oY29udGV4dCkgKyAiPC9wPiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZE5hbWUoc3RyKSB7CiAgICAgICAgICAgIHJldHVybiAvXltfYS16QS1aMC05LV0rJC8udGVzdChzdHIpOwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBEcm9wZG93biA9IGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICBmdW5jdGlvbiBEcm9wZG93bihvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25TdWdnZXN0aW9uQ2xpY2ssIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmU7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8ubWVudSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWVudSBpcyByZXF1aXJlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZGF0YXNldHMgPSBfLm1hcChvLmRhdGFzZXRzLCBpbml0aWFsaXplRGF0YXNldCk7CiAgICAgICAgICAgIG9uU3VnZ2VzdGlvbkNsaWNrID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbkNsaWNrLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VFbnRlciA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUVudGVyLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VMZWF2ZSA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUxlYXZlLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy4kbWVudSA9ICQoby5tZW51KS5vbigiY2xpY2sudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25DbGljaykub24oIm1vdXNlZW50ZXIudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyKS5vbigibW91c2VsZWF2ZS50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmUpOwogICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCkgewogICAgICAgICAgICAgICAgdGhhdC4kbWVudS5hcHBlbmQoZGF0YXNldC5nZXRSb290KCkpOwogICAgICAgICAgICAgICAgZGF0YXNldC5vblN5bmMoInJlbmRlcmVkIiwgdGhhdC5fb25SZW5kZXJlZCwgdGhhdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfLm1peGluKERyb3Bkb3duLnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25DbGljazogZnVuY3Rpb24gb25TdWdnZXN0aW9uQ2xpY2soJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigic3VnZ2VzdGlvbkNsaWNrZWQiLCAkKCRlLmN1cnJlbnRUYXJnZXQpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbk1vdXNlRW50ZXI6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIoJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCQoJGUuY3VycmVudFRhcmdldCksIHRydWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25TdWdnZXN0aW9uTW91c2VMZWF2ZTogZnVuY3Rpb24gb25TdWdnZXN0aW9uTW91c2VMZWF2ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25SZW5kZXJlZDogZnVuY3Rpb24gb25SZW5kZXJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IF8uZXZlcnkodGhpcy5kYXRhc2V0cywgaXNEYXRhc2V0RW1wdHkpOwogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID8gdGhpcy5faGlkZSgpIDogdGhpcy5pc09wZW4gJiYgdGhpcy5fc2hvdygpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJkYXRhc2V0UmVuZGVyZWQiKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGlzRGF0YXNldEVtcHR5KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldC5pc0VtcHR5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9oaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuaGlkZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51LmNzcygiZGlzcGxheSIsICJibG9jayIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfZ2V0U3VnZ2VzdGlvbnM6IGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LXN1Z2dlc3Rpb24iKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2dldEN1cnNvcjogZnVuY3Rpb24gZ2V0Q3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LWN1cnNvciIpLmZpcnN0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZXRDdXJzb3I6IGZ1bmN0aW9uIHNldEN1cnNvcigkZWwsIHNpbGVudCkgewogICAgICAgICAgICAgICAgJGVsLmZpcnN0KCkuYWRkQ2xhc3MoInR0LWN1cnNvciIpOwogICAgICAgICAgICAgICAgIXNpbGVudCAmJiB0aGlzLnRyaWdnZXIoImN1cnNvck1vdmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9yZW1vdmVDdXJzb3I6IGZ1bmN0aW9uIHJlbW92ZUN1cnNvcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2dldEN1cnNvcigpLnJlbW92ZUNsYXNzKCJ0dC1jdXJzb3IiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX21vdmVDdXJzb3I6IGZ1bmN0aW9uIG1vdmVDdXJzb3IoaW5jcmVtZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgJHN1Z2dlc3Rpb25zLCAkb2xkQ3Vyc29yLCBuZXdDdXJzb3JJbmRleCwgJG5ld0N1cnNvcjsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb2xkQ3Vyc29yID0gdGhpcy5fZ2V0Q3Vyc29yKCk7CiAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMgPSB0aGlzLl9nZXRTdWdnZXN0aW9ucygpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5pbmRleCgkb2xkQ3Vyc29yKSArIGluY3JlbWVudDsKICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gKG5ld0N1cnNvckluZGV4ICsgMSkgJSAoJHN1Z2dlc3Rpb25zLmxlbmd0aCArIDEpIC0gMTsKICAgICAgICAgICAgICAgIGlmIChuZXdDdXJzb3JJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImN1cnNvclJlbW92ZWQiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld0N1cnNvckluZGV4IDwgLTEpIHsKICAgICAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCRuZXdDdXJzb3IgPSAkc3VnZ2VzdGlvbnMuZXEobmV3Q3Vyc29ySW5kZXgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVZpc2libGUoJG5ld0N1cnNvcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9lbnN1cmVWaXNpYmxlOiBmdW5jdGlvbiBlbnN1cmVWaXNpYmxlKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGVsVG9wLCBlbEJvdHRvbSwgbWVudVNjcm9sbFRvcCwgbWVudUhlaWdodDsKICAgICAgICAgICAgICAgIGVsVG9wID0gJGVsLnBvc2l0aW9uKCkudG9wOwogICAgICAgICAgICAgICAgZWxCb3R0b20gPSBlbFRvcCArICRlbC5vdXRlckhlaWdodCh0cnVlKTsKICAgICAgICAgICAgICAgIG1lbnVTY3JvbGxUb3AgPSB0aGlzLiRtZW51LnNjcm9sbFRvcCgpOwogICAgICAgICAgICAgICAgbWVudUhlaWdodCA9IHRoaXMuJG1lbnUuaGVpZ2h0KCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ1RvcCIpLCAxMCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ0JvdHRvbSIpLCAxMCk7CiAgICAgICAgICAgICAgICBpZiAoZWxUb3AgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIGVsVG9wKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVudUhlaWdodCA8IGVsQm90dG9tKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIChlbEJvdHRvbSAtIG1lbnVIZWlnaHQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJjbG9zZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgIXRoaXMuaXNFbXB0eSAmJiB0aGlzLl9zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJvcGVuZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIHNldExhbmd1YWdlRGlyZWN0aW9uKGRpcikgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5jc3MoZGlyID09PSAibHRyIiA\/IGNzcy5sdHIgOiBjc3MucnRsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvclVwOiBmdW5jdGlvbiBtb3ZlQ3Vyc29yVXAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlQ3Vyc29yKC0xKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvckRvd246IGZ1bmN0aW9uIG1vdmVDdXJzb3JEb3duKCkgewogICAgICAgICAgICAgICAgdGhpcy5fbW92ZUN1cnNvcigrMSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdHVtRm9yU3VnZ2VzdGlvbjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICgkZWwubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhdzogRGF0YXNldC5leHRyYWN0RGF0dW0oJGVsKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IERhdGFzZXQuZXh0cmFjdFZhbHVlKCRlbCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXROYW1lOiBEYXRhc2V0LmV4dHJhY3REYXRhc2V0TmFtZSgkZWwpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkYXR1bTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RGF0dW1Gb3JDdXJzb3I6IGZ1bmN0aW9uIGdldERhdHVtRm9yQ3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKHRoaXMuX2dldEN1cnNvcigpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXR1bUZvclRvcFN1Z2dlc3Rpb246IGZ1bmN0aW9uIGdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERhdHVtRm9yU3VnZ2VzdGlvbih0aGlzLl9nZXRTdWdnZXN0aW9ucygpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShxdWVyeSkgewogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIHVwZGF0ZURhdGFzZXQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlRGF0YXNldChkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldC51cGRhdGUocXVlcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbXB0eTogZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgY2xlYXJEYXRhc2V0KTsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGVhckRhdGFzZXQoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFzZXQuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNWaXNpYmxlOiBmdW5jdGlvbiBpc1Zpc2libGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc09wZW4gJiYgIXRoaXMuaXNFbXB0eTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUgPSBudWxsOwogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIGRlc3Ryb3lEYXRhc2V0KTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lEYXRhc2V0KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBEcm9wZG93bjsKICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplRGF0YXNldChvRGF0YXNldCkgewogICAgICAgICAgICByZXR1cm4gbmV3IERhdGFzZXQob0RhdGFzZXQpOwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBUeXBlYWhlYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGF0dHJzS2V5ID0gInR0QXR0cnMiOwogICAgICAgIGZ1bmN0aW9uIFR5cGVhaGVhZChvKSB7CiAgICAgICAgICAgIHZhciAkbWVudSwgJGlucHV0LCAkaGludDsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIGlmICghby5pbnB1dCkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWlzc2luZyBpbnB1dCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNBY3RpdmF0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5hdXRvc2VsZWN0ID0gISFvLmF1dG9zZWxlY3Q7CiAgICAgICAgICAgIHRoaXMubWluTGVuZ3RoID0gXy5pc051bWJlcihvLm1pbkxlbmd0aCkgPyBvLm1pbkxlbmd0aCA6IDE7CiAgICAgICAgICAgIHRoaXMuJG5vZGUgPSBidWlsZERvbShvLmlucHV0LCBvLndpdGhIaW50KTsKICAgICAgICAgICAgJG1lbnUgPSB0aGlzLiRub2RlLmZpbmQoIi50dC1kcm9wZG93bi1tZW51Iik7CiAgICAgICAgICAgICRpbnB1dCA9IHRoaXMuJG5vZGUuZmluZCgiLnR0LWlucHV0Iik7CiAgICAgICAgICAgICRoaW50ID0gdGhpcy4kbm9kZS5maW5kKCIudHQtaGludCIpOwogICAgICAgICAgICAkaW5wdXQub24oImJsdXIudHQiLCBmdW5jdGlvbigkZSkgewogICAgICAgICAgICAgICAgdmFyIGFjdGl2ZSwgaXNBY3RpdmUsIGhhc0FjdGl2ZTsKICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CiAgICAgICAgICAgICAgICBpc0FjdGl2ZSA9ICRtZW51LmlzKGFjdGl2ZSk7CiAgICAgICAgICAgICAgICBoYXNBY3RpdmUgPSAkbWVudS5oYXMoYWN0aXZlKS5sZW5ndGggPiAwOwogICAgICAgICAgICAgICAgaWYgKF8uaXNNc2llKCkgJiYgKGlzQWN0aXZlIHx8IGhhc0FjdGl2ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJG1lbnUub24oIm1vdXNlZG93bi50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5ldmVudEJ1cyA9IG8uZXZlbnRCdXMgfHwgbmV3IEV2ZW50QnVzKHsKICAgICAgICAgICAgICAgIGVsOiAkaW5wdXQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24gPSBuZXcgRHJvcGRvd24oewogICAgICAgICAgICAgICAgbWVudTogJG1lbnUsCiAgICAgICAgICAgICAgICBkYXRhc2V0czogby5kYXRhc2V0cwogICAgICAgICAgICB9KS5vblN5bmMoInN1Z2dlc3Rpb25DbGlja2VkIiwgdGhpcy5fb25TdWdnZXN0aW9uQ2xpY2tlZCwgdGhpcykub25TeW5jKCJjdXJzb3JNb3ZlZCIsIHRoaXMuX29uQ3Vyc29yTW92ZWQsIHRoaXMpLm9uU3luYygiY3Vyc29yUmVtb3ZlZCIsIHRoaXMuX29uQ3Vyc29yUmVtb3ZlZCwgdGhpcykub25TeW5jKCJvcGVuZWQiLCB0aGlzLl9vbk9wZW5lZCwgdGhpcykub25TeW5jKCJjbG9zZWQiLCB0aGlzLl9vbkNsb3NlZCwgdGhpcykub25Bc3luYygiZGF0YXNldFJlbmRlcmVkIiwgdGhpcy5fb25EYXRhc2V0UmVuZGVyZWQsIHRoaXMpOwogICAgICAgICAgICB0aGlzLmlucHV0ID0gbmV3IElucHV0KHsKICAgICAgICAgICAgICAgIGlucHV0OiAkaW5wdXQsCiAgICAgICAgICAgICAgICBoaW50OiAkaGludAogICAgICAgICAgICB9KS5vblN5bmMoImZvY3VzZWQiLCB0aGlzLl9vbkZvY3VzZWQsIHRoaXMpLm9uU3luYygiYmx1cnJlZCIsIHRoaXMuX29uQmx1cnJlZCwgdGhpcykub25TeW5jKCJlbnRlcktleWVkIiwgdGhpcy5fb25FbnRlcktleWVkLCB0aGlzKS5vblN5bmMoInRhYktleWVkIiwgdGhpcy5fb25UYWJLZXllZCwgdGhpcykub25TeW5jKCJlc2NLZXllZCIsIHRoaXMuX29uRXNjS2V5ZWQsIHRoaXMpLm9uU3luYygidXBLZXllZCIsIHRoaXMuX29uVXBLZXllZCwgdGhpcykub25TeW5jKCJkb3duS2V5ZWQiLCB0aGlzLl9vbkRvd25LZXllZCwgdGhpcykub25TeW5jKCJsZWZ0S2V5ZWQiLCB0aGlzLl9vbkxlZnRLZXllZCwgdGhpcykub25TeW5jKCJyaWdodEtleWVkIiwgdGhpcy5fb25SaWdodEtleWVkLCB0aGlzKS5vblN5bmMoInF1ZXJ5Q2hhbmdlZCIsIHRoaXMuX29uUXVlcnlDaGFuZ2VkLCB0aGlzKS5vblN5bmMoIndoaXRlc3BhY2VDaGFuZ2VkIiwgdGhpcy5fb25XaGl0ZXNwYWNlQ2hhbmdlZCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgfQogICAgICAgIF8ubWl4aW4oVHlwZWFoZWFkLnByb3RvdHlwZSwgewogICAgICAgICAgICBfb25TdWdnZXN0aW9uQ2xpY2tlZDogZnVuY3Rpb24gb25TdWdnZXN0aW9uQ2xpY2tlZCh0eXBlLCAkZWwpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bTsKICAgICAgICAgICAgICAgIGlmIChkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKCRlbCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QoZGF0dW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25DdXJzb3JNb3ZlZDogZnVuY3Rpb24gb25DdXJzb3JNb3ZlZCgpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JDdXJzb3IoKTsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZShkYXR1bS52YWx1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoImN1cnNvcmNoYW5nZWQiLCBkYXR1bS5yYXcsIGRhdHVtLmRhdGFzZXROYW1lKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQ3Vyc29yUmVtb3ZlZDogZnVuY3Rpb24gb25DdXJzb3JSZW1vdmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5yZXNldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRGF0YXNldFJlbmRlcmVkOiBmdW5jdGlvbiBvbkRhdGFzZXRSZW5kZXJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uT3BlbmVkOiBmdW5jdGlvbiBvbk9wZW5lZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigib3BlbmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkNsb3NlZDogZnVuY3Rpb24gb25DbG9zZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJjbG9zZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRm9jdXNlZDogZnVuY3Rpb24gb25Gb2N1c2VkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pc0FjdGl2YXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQmx1cnJlZDogZnVuY3Rpb24gb25CbHVycmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pc0FjdGl2YXRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25FbnRlcktleWVkOiBmdW5jdGlvbiBvbkVudGVyS2V5ZWQodHlwZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBjdXJzb3JEYXR1bSwgdG9wU3VnZ2VzdGlvbkRhdHVtOwogICAgICAgICAgICAgICAgY3Vyc29yRGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICB0b3BTdWdnZXN0aW9uRGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGN1cnNvckRhdHVtKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KGN1cnNvckRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmF1dG9zZWxlY3QgJiYgdG9wU3VnZ2VzdGlvbkRhdHVtKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KHRvcFN1Z2dlc3Rpb25EYXR1bSk7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uVGFiS2V5ZWQ6IGZ1bmN0aW9uIG9uVGFiS2V5ZWQodHlwZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bTsKICAgICAgICAgICAgICAgIGlmIChkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JDdXJzb3IoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdChkYXR1bSk7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXV0b2NvbXBsZXRlKHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25Fc2NLZXllZDogZnVuY3Rpb24gb25Fc2NLZXllZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQucmVzZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblVwS2V5ZWQ6IGZ1bmN0aW9uIG9uVXBLZXllZCgpIHsKICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uaXNFbXB0eSAmJiBxdWVyeS5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyB0aGlzLmRyb3Bkb3duLnVwZGF0ZShxdWVyeSkgOiB0aGlzLmRyb3Bkb3duLm1vdmVDdXJzb3JVcCgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkRvd25LZXllZDogZnVuY3Rpb24gb25Eb3duS2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmlzRW1wdHkgJiYgcXVlcnkubGVuZ3RoID49IHRoaXMubWluTGVuZ3RoID8gdGhpcy5kcm9wZG93bi51cGRhdGUocXVlcnkpIDogdGhpcy5kcm9wZG93bi5tb3ZlQ3Vyc29yRG93bigpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkxlZnRLZXllZDogZnVuY3Rpb24gb25MZWZ0S2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRpciA9PT0gInJ0bCIgJiYgdGhpcy5fYXV0b2NvbXBsZXRlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblJpZ2h0S2V5ZWQ6IGZ1bmN0aW9uIG9uUmlnaHRLZXllZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlyID09PSAibHRyIiAmJiB0aGlzLl9hdXRvY29tcGxldGUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uUXVlcnlDaGFuZ2VkOiBmdW5jdGlvbiBvblF1ZXJ5Q2hhbmdlZChlLCBxdWVyeSkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jbGVhckhpbnRJZkludmFsaWQoKTsKICAgICAgICAgICAgICAgIHF1ZXJ5Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCA\/IHRoaXMuZHJvcGRvd24udXBkYXRlKHF1ZXJ5KSA6IHRoaXMuZHJvcGRvd24uZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uV2hpdGVzcGFjZUNoYW5nZWQ6IGZ1bmN0aW9uIG9uV2hpdGVzcGFjZUNoYW5nZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3NldExhbmd1YWdlRGlyZWN0aW9uOiBmdW5jdGlvbiBzZXRMYW5ndWFnZURpcmVjdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBkaXI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXIgIT09IChkaXIgPSB0aGlzLmlucHV0LmdldExhbmd1YWdlRGlyZWN0aW9uKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXIgPSBkaXI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbm9kZS5jc3MoImRpcmVjdGlvbiIsIGRpcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5zZXRMYW5ndWFnZURpcmVjdGlvbihkaXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfdXBkYXRlSGludDogZnVuY3Rpb24gdXBkYXRlSGludCgpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bSwgdmFsLCBxdWVyeSwgZXNjYXBlZFF1ZXJ5LCBmcm9udE1hdGNoUmVnRXgsIG1hdGNoOwogICAgICAgICAgICAgICAgZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtICYmIHRoaXMuZHJvcGRvd24uaXNWaXNpYmxlKCkgJiYgIXRoaXMuaW5wdXQuaGFzT3ZlcmZsb3coKSkgewogICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuaW5wdXQuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gSW5wdXQubm9ybWFsaXplUXVlcnkodmFsKTsKICAgICAgICAgICAgICAgICAgICBlc2NhcGVkUXVlcnkgPSBfLmVzY2FwZVJlZ0V4Q2hhcnMocXVlcnkpOwogICAgICAgICAgICAgICAgICAgIGZyb250TWF0Y2hSZWdFeCA9IG5ldyBSZWdFeHAoIl4oPzoiICsgZXNjYXBlZFF1ZXJ5ICsgIikoLiskKSIsICJpIik7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBmcm9udE1hdGNoUmVnRXguZXhlYyhkYXR1bS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPyB0aGlzLmlucHV0LnNldEhpbnQodmFsICsgbWF0Y2hbMV0pIDogdGhpcy5pbnB1dC5jbGVhckhpbnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jbGVhckhpbnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2F1dG9jb21wbGV0ZTogZnVuY3Rpb24gYXV0b2NvbXBsZXRlKGxheEN1cnNvcikgewogICAgICAgICAgICAgICAgdmFyIGhpbnQsIHF1ZXJ5LCBpc0N1cnNvckF0RW5kLCBkYXR1bTsKICAgICAgICAgICAgICAgIGhpbnQgPSB0aGlzLmlucHV0LmdldEhpbnQoKTsKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICAgICAgaXNDdXJzb3JBdEVuZCA9IGxheEN1cnNvciB8fCB0aGlzLmlucHV0LmlzQ3Vyc29yQXRFbmQoKTsKICAgICAgICAgICAgICAgIGlmIChoaW50ICYmIHF1ZXJ5ICE9PSBoaW50ICYmIGlzQ3Vyc29yQXRFbmQpIHsKICAgICAgICAgICAgICAgICAgICBkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gJiYgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoImF1dG9jb21wbGV0ZWQiLCBkYXR1bS5yYXcsIGRhdHVtLmRhdGFzZXROYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3NlbGVjdDogZnVuY3Rpb24gc2VsZWN0KGRhdHVtKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldFF1ZXJ5KGRhdHVtLnZhbHVlKTsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZShkYXR1bS52YWx1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJzZWxlY3RlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICAgICAgXy5kZWZlcihfLmJpbmQodGhpcy5kcm9wZG93bi5lbXB0eSwgdGhpcy5kcm9wZG93bikpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0VmFsOiBmdW5jdGlvbiBzZXRWYWwodmFsKSB7CiAgICAgICAgICAgICAgICB2YWwgPSBfLnRvU3RyKHZhbCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FjdGl2YXRlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZSh2YWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldFF1ZXJ5KHZhbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKHZhbCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRWYWw6IGZ1bmN0aW9uIGdldFZhbCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZGVzdHJveSgpOwogICAgICAgICAgICAgICAgZGVzdHJveURvbVN0cnVjdHVyZSh0aGlzLiRub2RlKTsKICAgICAgICAgICAgICAgIHRoaXMuJG5vZGUgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIFR5cGVhaGVhZDsKICAgICAgICBmdW5jdGlvbiBidWlsZERvbShpbnB1dCwgd2l0aEhpbnQpIHsKICAgICAgICAgICAgdmFyICRpbnB1dCwgJHdyYXBwZXIsICRkcm9wZG93biwgJGhpbnQ7CiAgICAgICAgICAgICRpbnB1dCA9ICQoaW5wdXQpOwogICAgICAgICAgICAkd3JhcHBlciA9ICQoaHRtbC53cmFwcGVyKS5jc3MoY3NzLndyYXBwZXIpOwogICAgICAgICAgICAkZHJvcGRvd24gPSAkKGh0bWwuZHJvcGRvd24pLmNzcyhjc3MuZHJvcGRvd24pOwogICAgICAgICAgICAkaGludCA9ICRpbnB1dC5jbG9uZSgpLmNzcyhjc3MuaGludCkuY3NzKGdldEJhY2tncm91bmRTdHlsZXMoJGlucHV0KSk7CiAgICAgICAgICAgICRoaW50LnZhbCgiIikucmVtb3ZlRGF0YSgpLmFkZENsYXNzKCJ0dC1oaW50IikucmVtb3ZlQXR0cigiaWQgbmFtZSBwbGFjZWhvbGRlciByZXF1aXJlZCIpLnByb3AoInJlYWRvbmx5IiwgdHJ1ZSkuYXR0cih7CiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6ICJvZmYiLAogICAgICAgICAgICAgICAgc3BlbGxjaGVjazogImZhbHNlIiwKICAgICAgICAgICAgICAgIHRhYmluZGV4OiAtMQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGlucHV0LmRhdGEoYXR0cnNLZXksIHsKICAgICAgICAgICAgICAgIGRpcjogJGlucHV0LmF0dHIoImRpciIpLAogICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAkaW5wdXQuYXR0cigiYXV0b2NvbXBsZXRlIiksCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiAkaW5wdXQuYXR0cigic3BlbGxjaGVjayIpLAogICAgICAgICAgICAgICAgc3R5bGU6ICRpbnB1dC5hdHRyKCJzdHlsZSIpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoInR0LWlucHV0IikuYXR0cih7CiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6ICJvZmYiLAogICAgICAgICAgICAgICAgc3BlbGxjaGVjazogZmFsc2UKICAgICAgICAgICAgfSkuY3NzKHdpdGhIaW50ID8gY3NzLmlucHV0IDogY3NzLmlucHV0V2l0aE5vSGludCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAhJGlucHV0LmF0dHIoImRpciIpICYmICRpbnB1dC5hdHRyKCJkaXIiLCAiYXV0byIpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICByZXR1cm4gJGlucHV0LndyYXAoJHdyYXBwZXIpLnBhcmVudCgpLnByZXBlbmQod2l0aEhpbnQgPyAkaGludCA6IG51bGwpLmFwcGVuZCgkZHJvcGRvd24pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRCYWNrZ3JvdW5kU3R5bGVzKCRlbCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgYmFja2dyb3VuZEF0dGFjaG1lbnQ6ICRlbC5jc3MoImJhY2tncm91bmQtYXR0YWNobWVudCIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENsaXA6ICRlbC5jc3MoImJhY2tncm91bmQtY2xpcCIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWNvbG9yIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICRlbC5jc3MoImJhY2tncm91bmQtaW1hZ2UiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRPcmlnaW46ICRlbC5jc3MoImJhY2tncm91bmQtb3JpZ2luIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246ICRlbC5jc3MoImJhY2tncm91bmQtcG9zaXRpb24iKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRSZXBlYXQ6ICRlbC5jc3MoImJhY2tncm91bmQtcmVwZWF0IiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJGVsLmNzcygiYmFja2dyb3VuZC1zaXplIikKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZGVzdHJveURvbVN0cnVjdHVyZSgkbm9kZSkgewogICAgICAgICAgICB2YXIgJGlucHV0ID0gJG5vZGUuZmluZCgiLnR0LWlucHV0Iik7CiAgICAgICAgICAgIF8uZWFjaCgkaW5wdXQuZGF0YShhdHRyc0tleSksIGZ1bmN0aW9uKHZhbCwga2V5KSB7CiAgICAgICAgICAgICAgICBfLmlzVW5kZWZpbmVkKHZhbCkgPyAkaW5wdXQucmVtb3ZlQXR0cihrZXkpIDogJGlucHV0LmF0dHIoa2V5LCB2YWwpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGlucHV0LmRldGFjaCgpLnJlbW92ZURhdGEoYXR0cnNLZXkpLnJlbW92ZUNsYXNzKCJ0dC1pbnB1dCIpLmluc2VydEFmdGVyKCRub2RlKTsKICAgICAgICAgICAgJG5vZGUucmVtb3ZlKCk7CiAgICAgICAgfQogICAgfSgpOwogICAgKGZ1bmN0aW9uKCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgICB2YXIgb2xkLCB0eXBlYWhlYWRLZXksIG1ldGhvZHM7CiAgICAgICAgb2xkID0gJC5mbi50eXBlYWhlYWQ7CiAgICAgICAgdHlwZWFoZWFkS2V5ID0gInR0VHlwZWFoZWFkIjsKICAgICAgICBtZXRob2RzID0gewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG8sIGRhdGFzZXRzKSB7CiAgICAgICAgICAgICAgICBkYXRhc2V0cyA9IF8uaXNBcnJheShkYXRhc2V0cykgPyBkYXRhc2V0cyA6IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChhdHRhY2gpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gYXR0YWNoKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCBldmVudEJ1cywgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChkYXRhc2V0cywgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgICAgICBkLmhpZ2hsaWdodCA9ICEhby5oaWdobGlnaHQ7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkID0gbmV3IFR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiAkaW5wdXQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50QnVzOiBldmVudEJ1cyA9IG5ldyBFdmVudEJ1cyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbDogJGlucHV0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICB3aXRoSGludDogXy5pc1VuZGVmaW5lZChvLmhpbnQpID8gdHJ1ZSA6ICEhby5oaW50LAogICAgICAgICAgICAgICAgICAgICAgICBtaW5MZW5ndGg6IG8ubWluTGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICBhdXRvc2VsZWN0OiBvLmF1dG9zZWxlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBkYXRhc2V0cwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSwgdHlwZWFoZWFkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2gob3BlblR5cGVhaGVhZCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBvcGVuVHlwZWFoZWFkKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLm9wZW4oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goY2xvc2VUeXBlYWhlYWQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VUeXBlYWhlYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhbDogZnVuY3Rpb24gdmFsKG5ld1ZhbCkgewogICAgICAgICAgICAgICAgcmV0dXJuICFhcmd1bWVudHMubGVuZ3RoID8gZ2V0VmFsKHRoaXMuZmlyc3QoKSkgOiB0aGlzLmVhY2goc2V0VmFsKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNldFZhbCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5zZXRWYWwobmV3VmFsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRWYWwoJGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVhaGVhZCwgcXVlcnk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSB0eXBlYWhlYWQuZ2V0VmFsKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2godW5hdHRhY2gpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdW5hdHRhY2goKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgICAgICAkaW5wdXQucmVtb3ZlRGF0YSh0eXBlYWhlYWRLZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgJC5mbi50eXBlYWhlYWQgPSBmdW5jdGlvbihtZXRob2QpIHsKICAgICAgICAgICAgdmFyIHR0czsKICAgICAgICAgICAgaWYgKG1ldGhvZHNbbWV0aG9kXSAmJiBtZXRob2QgIT09ICJpbml0aWFsaXplIikgewogICAgICAgICAgICAgICAgdHRzID0gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhJCh0aGlzKS5kYXRhKHR5cGVhaGVhZEtleSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodHRzLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAkLmZuLnR5cGVhaGVhZC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gbm9Db25mbGljdCgpIHsKICAgICAgICAgICAgJC5mbi50eXBlYWhlYWQgPSBvbGQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CiAgICB9KSgpOwp9KSh3aW5kb3cualF1ZXJ5KTs=",
    "size": "48446"
}