{
    "namaFile": "lib\/js\/calendar\/calendar.js",
    "lastUpdate": "2013-12-16+17:18:27.00",
    "contentFile": "LyogIENvcHlyaWdodCBNaWhhaSBCYXpvbiwgMjAwMiAgfCAgaHR0cDovL3N0dWRlbnRzLmluZm9pYXNpLnJvL35taXNob28NCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICoNCiAqIFRoZSBESFRNTCBDYWxlbmRhciwgdmVyc2lvbiAwLjkuMiAiVGhlIGFydCBvZiBkYXRlIHNlbGVjdGlvbiINCiAqDQogKiBEZXRhaWxzIGFuZCBsYXRlc3QgdmVyc2lvbiBhdDoNCiAqIGh0dHA6Ly9zdHVkZW50cy5pbmZvaWFzaS5yby9+bWlzaG9vL3NpdGUvY2FsZW5kYXIuZXBsDQogKg0KICogRmVlbCBmcmVlIHRvIHVzZSB0aGlzIHNjcmlwdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbA0KICogUHVibGljIExpY2Vuc2UsIGFzIGxvbmcgYXMgeW91IGRvIG5vdCByZW1vdmUgb3IgYWx0ZXIgdGhpcyBub3RpY2UuDQogKi8NCg0KLy8gJElkOiBjYWxlbmRhci5qcyA0OSAyMDA1LTA5LTE1IDAyOjU1OjI3WiByaHVrICQNCg0KLyoqIFRoZSBDYWxlbmRhciBvYmplY3QgY29uc3RydWN0b3IuICovDQpDYWxlbmRhciA9IGZ1bmN0aW9uIChtb25kYXlGaXJzdCwgZGF0ZVN0ciwgb25TZWxlY3RlZCwgb25DbG9zZSkgew0KCS8vIG1lbWJlciB2YXJpYWJsZXMNCgl0aGlzLmFjdGl2ZURpdiA9IG51bGw7DQoJdGhpcy5jdXJyZW50RGF0ZUVsID0gbnVsbDsNCgl0aGlzLmNoZWNrRGlzYWJsZWQgPSBudWxsOw0KCXRoaXMudGltZW91dCA9IG51bGw7DQoJdGhpcy5vblNlbGVjdGVkID0gb25TZWxlY3RlZCB8fCBudWxsOw0KCXRoaXMub25DbG9zZSA9IG9uQ2xvc2UgfHwgbnVsbDsNCgl0aGlzLmRyYWdnaW5nID0gZmFsc2U7DQoJdGhpcy5oaWRkZW4gPSBmYWxzZTsNCgl0aGlzLm1pblllYXIgPSAxOTcwOw0KCXRoaXMubWF4WWVhciA9IDIwNTA7DQoJdGhpcy5kYXRlRm9ybWF0ID0gQ2FsZW5kYXIuX1RUWyJERUZfREFURV9GT1JNQVQiXTsNCgl0aGlzLnR0RGF0ZUZvcm1hdCA9IENhbGVuZGFyLl9UVFsiVFRfREFURV9GT1JNQVQiXTsNCgl0aGlzLmlzUG9wdXAgPSB0cnVlOw0KCXRoaXMud2Vla051bWJlcnMgPSB0cnVlOw0KCXRoaXMubW9uZGF5Rmlyc3QgPSBtb25kYXlGaXJzdDsNCgl0aGlzLmRhdGVTdHIgPSBkYXRlU3RyOw0KCXRoaXMuYXJfZGF5cyA9IG51bGw7DQoJLy8gSFRNTCBlbGVtZW50cw0KCXRoaXMudGFibGUgPSBudWxsOw0KCXRoaXMuZWxlbWVudCA9IG51bGw7DQoJdGhpcy50Ym9keSA9IG51bGw7DQoJdGhpcy5maXJzdGRheW5hbWUgPSBudWxsOw0KCS8vIENvbWJvIGJveGVzDQoJdGhpcy5tb250aHNDb21ibyA9IG51bGw7DQoJdGhpcy55ZWFyc0NvbWJvID0gbnVsbDsNCgl0aGlzLmhpbGl0ZWRNb250aCA9IG51bGw7DQoJdGhpcy5hY3RpdmVNb250aCA9IG51bGw7DQoJdGhpcy5oaWxpdGVkWWVhciA9IG51bGw7DQoJdGhpcy5hY3RpdmVZZWFyID0gbnVsbDsNCg0KCS8vIG9uZS10aW1lIGluaXRpYWxpemF0aW9ucw0KCWlmICghQ2FsZW5kYXIuX0ROMykgew0KCQkvLyB0YWJsZSBvZiBzaG9ydCBkYXkgbmFtZXMNCgkJdmFyIGFyID0gbmV3IEFycmF5KCk7DQoJCWZvciAodmFyIGkgPSA4OyBpID4gMDspIHsNCgkJCWFyWy0taV0gPSBDYWxlbmRhci5fRE5baV0uc3Vic3RyKDAsIDMpOw0KCQl9DQoJCUNhbGVuZGFyLl9ETjMgPSBhcjsNCgkJLy8gdGFibGUgb2Ygc2hvcnQgbW9udGggbmFtZXMNCgkJYXIgPSBuZXcgQXJyYXkoKTsNCgkJZm9yICh2YXIgaSA9IDEyOyBpID4gMDspIHsNCgkJCWFyWy0taV0gPSBDYWxlbmRhci5fTU5baV0uc3Vic3RyKDAsIDMpOw0KCQl9DQoJCUNhbGVuZGFyLl9NTjMgPSBhcjsNCgl9DQp9Ow0KDQovLyAqKiBjb25zdGFudHMNCg0KLy8vICJzdGF0aWMiLCBuZWVkZWQgZm9yIGV2ZW50IGhhbmRsZXJzLg0KQ2FsZW5kYXIuX0MgPSBudWxsOw0KDQovLy8gZGV0ZWN0IGEgc3BlY2lhbCBjYXNlIG9mICJ3ZWIgYnJvd3NlciINCkNhbGVuZGFyLmlzX2llID0gKCAobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoIm1zaWUiKSAhPSAtMSkgJiYNCgkJICAgKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCJvcGVyYSIpID09IC0xKSApOw0KDQovLyBzaG9ydCBkYXkgbmFtZXMgYXJyYXkgKGluaXRpYWxpemVkIGF0IGZpcnN0IGNvbnN0cnVjdG9yIGNhbGwpDQpDYWxlbmRhci5fRE4zID0gbnVsbDsNCg0KLy8gc2hvcnQgbW9udGggbmFtZXMgYXJyYXkgKGluaXRpYWxpemVkIGF0IGZpcnN0IGNvbnN0cnVjdG9yIGNhbGwpDQpDYWxlbmRhci5fTU4zID0gbnVsbDsNCg0KLy8gQkVHSU46IFVUSUxJVFkgRlVOQ1RJT05TOyBiZXdhcmUgdGhhdCB0aGVzZSBtaWdodCBiZSBtb3ZlZCBpbnRvIGEgc2VwYXJhdGUNCi8vICAgICAgICBsaWJyYXJ5LCBhdCBzb21lIHBvaW50Lg0KDQpDYWxlbmRhci5nZXRBYnNvbHV0ZVBvcyA9IGZ1bmN0aW9uKGVsKSB7DQoJdmFyIHIgPSB7IHg6IGVsLm9mZnNldExlZnQsIHk6IGVsLm9mZnNldFRvcCB9Ow0KCWlmIChlbC5vZmZzZXRQYXJlbnQpIHsNCgkJdmFyIHRtcCA9IENhbGVuZGFyLmdldEFic29sdXRlUG9zKGVsLm9mZnNldFBhcmVudCk7DQoJCXIueCArPSB0bXAueDsNCgkJci55ICs9IHRtcC55Ow0KCX0NCglyZXR1cm4gcjsNCn07DQoNCkNhbGVuZGFyLmlzUmVsYXRlZCA9IGZ1bmN0aW9uIChlbCwgZXZ0KSB7DQoJdmFyIHJlbGF0ZWQgPSBldnQucmVsYXRlZFRhcmdldDsNCglpZiAoIXJlbGF0ZWQpIHsNCgkJdmFyIHR5cGUgPSBldnQudHlwZTsNCgkJaWYgKHR5cGUgPT0gIm1vdXNlb3ZlciIpIHsNCgkJCXJlbGF0ZWQgPSBldnQuZnJvbUVsZW1lbnQ7DQoJCX0gZWxzZSBpZiAodHlwZSA9PSAibW91c2VvdXQiKSB7DQoJCQlyZWxhdGVkID0gZXZ0LnRvRWxlbWVudDsNCgkJfQ0KCX0NCgl3aGlsZSAocmVsYXRlZCkgew0KCQlpZiAocmVsYXRlZCA9PSBlbCkgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJcmVsYXRlZCA9IHJlbGF0ZWQucGFyZW50Tm9kZTsNCgl9DQoJcmV0dXJuIGZhbHNlOw0KfTsNCg0KQ2FsZW5kYXIucmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbihlbCwgY2xhc3NOYW1lKSB7DQoJaWYgKCEoZWwgJiYgZWwuY2xhc3NOYW1lKSkgew0KCQlyZXR1cm47DQoJfQ0KCXZhciBjbHMgPSBlbC5jbGFzc05hbWUuc3BsaXQoIiAiKTsNCgl2YXIgYXIgPSBuZXcgQXJyYXkoKTsNCglmb3IgKHZhciBpID0gY2xzLmxlbmd0aDsgaSA+IDA7KSB7DQoJCWlmIChjbHNbLS1pXSAhPSBjbGFzc05hbWUpIHsNCgkJCWFyW2FyLmxlbmd0aF0gPSBjbHNbaV07DQoJCX0NCgl9DQoJZWwuY2xhc3NOYW1lID0gYXIuam9pbigiICIpOw0KfTsNCg0KQ2FsZW5kYXIuYWRkQ2xhc3MgPSBmdW5jdGlvbihlbCwgY2xhc3NOYW1lKSB7DQoJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsIGNsYXNzTmFtZSk7DQoJZWwuY2xhc3NOYW1lICs9ICIgIiArIGNsYXNzTmFtZTsNCn07DQoNCkNhbGVuZGFyLmdldEVsZW1lbnQgPSBmdW5jdGlvbihldikgew0KCWlmIChDYWxlbmRhci5pc19pZSkgew0KCQlyZXR1cm4gd2luZG93LmV2ZW50LnNyY0VsZW1lbnQ7DQoJfSBlbHNlIHsNCgkJcmV0dXJuIGV2LmN1cnJlbnRUYXJnZXQ7DQoJfQ0KfTsNCg0KQ2FsZW5kYXIuZ2V0VGFyZ2V0RWxlbWVudCA9IGZ1bmN0aW9uKGV2KSB7DQoJaWYgKENhbGVuZGFyLmlzX2llKSB7DQoJCXJldHVybiB3aW5kb3cuZXZlbnQuc3JjRWxlbWVudDsNCgl9IGVsc2Ugew0KCQlyZXR1cm4gZXYudGFyZ2V0Ow0KCX0NCn07DQoNCkNhbGVuZGFyLnN0b3BFdmVudCA9IGZ1bmN0aW9uKGV2KSB7DQoJaWYgKENhbGVuZGFyLmlzX2llKSB7DQoJCXdpbmRvdy5ldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlOw0KCQl3aW5kb3cuZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsNCgl9IGVsc2Ugew0KCQlldi5wcmV2ZW50RGVmYXVsdCgpOw0KCQlldi5zdG9wUHJvcGFnYXRpb24oKTsNCgl9DQp9Ow0KDQpDYWxlbmRhci5hZGRFdmVudCA9IGZ1bmN0aW9uKGVsLCBldm5hbWUsIGZ1bmMpIHsNCglpZiAoQ2FsZW5kYXIuaXNfaWUpIHsNCgkJZWwuYXR0YWNoRXZlbnQoIm9uIiArIGV2bmFtZSwgZnVuYyk7DQoJfSBlbHNlIHsNCgkJZWwuYWRkRXZlbnRMaXN0ZW5lcihldm5hbWUsIGZ1bmMsIHRydWUpOw0KCX0NCn07DQoNCkNhbGVuZGFyLnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oZWwsIGV2bmFtZSwgZnVuYykgew0KCWlmIChDYWxlbmRhci5pc19pZSkgew0KCQllbC5kZXRhY2hFdmVudCgib24iICsgZXZuYW1lLCBmdW5jKTsNCgl9IGVsc2Ugew0KCQllbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2bmFtZSwgZnVuYywgdHJ1ZSk7DQoJfQ0KfTsNCg0KQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uKHR5cGUsIHBhcmVudCkgew0KCXZhciBlbCA9IG51bGw7DQoJaWYgKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUykgew0KCQkvLyB1c2UgdGhlIFhIVE1MIG5hbWVzcGFjZTsgSUUgd29uJ3Qgbm9ybWFsbHkgZ2V0IGhlcmUgdW5sZXNzDQoJCS8vIF90aGV5XyAiZml4IiB0aGUgRE9NMiBpbXBsZW1lbnRhdGlvbi4NCgkJZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLCB0eXBlKTsNCgl9IGVsc2Ugew0KCQllbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7DQoJfQ0KCWlmICh0eXBlb2YgcGFyZW50ICE9ICJ1bmRlZmluZWQiKSB7DQoJCXBhcmVudC5hcHBlbmRDaGlsZChlbCk7DQoJfQ0KCXJldHVybiBlbDsNCn07DQoNCi8vIEVORDogVVRJTElUWSBGVU5DVElPTlMNCg0KLy8gQkVHSU46IENBTEVOREFSIFNUQVRJQyBGVU5DVElPTlMNCg0KLyoqIEludGVybmFsIC0tIGFkZHMgYSBzZXQgb2YgZXZlbnRzIHRvIG1ha2Ugc29tZSBlbGVtZW50IGJlaGF2ZSBsaWtlIGEgYnV0dG9uLiAqLw0KQ2FsZW5kYXIuX2FkZF9ldnMgPSBmdW5jdGlvbihlbCkgew0KCXdpdGggKENhbGVuZGFyKSB7DQoJCWFkZEV2ZW50KGVsLCAibW91c2VvdmVyIiwgZGF5TW91c2VPdmVyKTsNCgkJYWRkRXZlbnQoZWwsICJtb3VzZWRvd24iLCBkYXlNb3VzZURvd24pOw0KCQlhZGRFdmVudChlbCwgIm1vdXNlb3V0IiwgZGF5TW91c2VPdXQpOw0KCQlpZiAoaXNfaWUpIHsNCgkJCWFkZEV2ZW50KGVsLCAiZGJsY2xpY2siLCBkYXlNb3VzZURibENsaWNrKTsNCgkJCWVsLnNldEF0dHJpYnV0ZSgidW5zZWxlY3RhYmxlIiwgdHJ1ZSk7DQoJCX0NCgl9DQp9Ow0KDQpDYWxlbmRhci5maW5kTW9udGggPSBmdW5jdGlvbihlbCkgew0KCWlmICh0eXBlb2YgZWwubW9udGggIT0gInVuZGVmaW5lZCIpIHsNCgkJcmV0dXJuIGVsOw0KCX0gZWxzZSBpZiAodHlwZW9mIGVsLnBhcmVudE5vZGUubW9udGggIT0gInVuZGVmaW5lZCIpIHsNCgkJcmV0dXJuIGVsLnBhcmVudE5vZGU7DQoJfQ0KCXJldHVybiBudWxsOw0KfTsNCg0KQ2FsZW5kYXIuZmluZFllYXIgPSBmdW5jdGlvbihlbCkgew0KCWlmICh0eXBlb2YgZWwueWVhciAhPSAidW5kZWZpbmVkIikgew0KCQlyZXR1cm4gZWw7DQoJfSBlbHNlIGlmICh0eXBlb2YgZWwucGFyZW50Tm9kZS55ZWFyICE9ICJ1bmRlZmluZWQiKSB7DQoJCXJldHVybiBlbC5wYXJlbnROb2RlOw0KCX0NCglyZXR1cm4gbnVsbDsNCn07DQoNCkNhbGVuZGFyLnNob3dNb250aHNDb21ibyA9IGZ1bmN0aW9uICgpIHsNCgl2YXIgY2FsID0gQ2FsZW5kYXIuX0M7DQoJaWYgKCFjYWwpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgY2FsID0gY2FsOw0KCXZhciBjZCA9IGNhbC5hY3RpdmVEaXY7DQoJdmFyIG1jID0gY2FsLm1vbnRoc0NvbWJvOw0KCWlmIChjYWwuaGlsaXRlZE1vbnRoKSB7DQoJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5oaWxpdGVkTW9udGgsICJoaWxpdGUiKTsNCgl9DQoJaWYgKGNhbC5hY3RpdmVNb250aCkgew0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuYWN0aXZlTW9udGgsICJhY3RpdmUiKTsNCgl9DQoJdmFyIG1vbiA9IGNhbC5tb250aHNDb21iby5nZXRFbGVtZW50c0J5VGFnTmFtZSgiZGl2IilbY2FsLmRhdGUuZ2V0TW9udGgoKV07DQoJQ2FsZW5kYXIuYWRkQ2xhc3MobW9uLCAiYWN0aXZlIik7DQoJY2FsLmFjdGl2ZU1vbnRoID0gbW9uOw0KCW1jLnN0eWxlLmxlZnQgPSBjZC5vZmZzZXRMZWZ0ICsgInB4IjsNCgltYy5zdHlsZS50b3AgPSAoY2Qub2Zmc2V0VG9wICsgY2Qub2Zmc2V0SGVpZ2h0KSArICJweCI7DQoJbWMuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQp9Ow0KDQpDYWxlbmRhci5zaG93WWVhcnNDb21ibyA9IGZ1bmN0aW9uIChmd2QpIHsNCgl2YXIgY2FsID0gQ2FsZW5kYXIuX0M7DQoJaWYgKCFjYWwpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgY2FsID0gY2FsOw0KCXZhciBjZCA9IGNhbC5hY3RpdmVEaXY7DQoJdmFyIHljID0gY2FsLnllYXJzQ29tYm87DQoJaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZFllYXIsICJoaWxpdGUiKTsNCgl9DQoJaWYgKGNhbC5hY3RpdmVZZWFyKSB7DQoJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5hY3RpdmVZZWFyLCAiYWN0aXZlIik7DQoJfQ0KCWNhbC5hY3RpdmVZZWFyID0gbnVsbDsNCgl2YXIgWSA9IGNhbC5kYXRlLmdldEZ1bGxZZWFyKCkgKyAoZndkID8gMSA6IC0xKTsNCgl2YXIgeXIgPSB5Yy5maXJzdENoaWxkOw0KCXZhciBzaG93ID0gZmFsc2U7DQoJZm9yICh2YXIgaSA9IDEyOyBpID4gMDsgLS1pKSB7DQoJCWlmIChZID49IGNhbC5taW5ZZWFyICYmIFkgPD0gY2FsLm1heFllYXIpIHsNCgkJCXlyLmZpcnN0Q2hpbGQuZGF0YSA9IFk7DQoJCQl5ci55ZWFyID0gWTsNCgkJCXlyLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCQkJc2hvdyA9IHRydWU7DQoJCX0gZWxzZSB7DQoJCQl5ci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQl9DQoJCXlyID0geXIubmV4dFNpYmxpbmc7DQoJCVkgKz0gZndkID8gMiA6IC0yOw0KCX0NCglpZiAoc2hvdykgew0KCQl5Yy5zdHlsZS5sZWZ0ID0gY2Qub2Zmc2V0TGVmdCArICJweCI7DQoJCXljLnN0eWxlLnRvcCA9IChjZC5vZmZzZXRUb3AgKyBjZC5vZmZzZXRIZWlnaHQpICsgInB4IjsNCgkJeWMuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJfQ0KfTsNCg0KLy8gZXZlbnQgaGFuZGxlcnMNCg0KQ2FsZW5kYXIudGFibGVNb3VzZVVwID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgY2FsID0gQ2FsZW5kYXIuX0M7DQoJaWYgKCFjYWwpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCglpZiAoY2FsLnRpbWVvdXQpIHsNCgkJY2xlYXJUaW1lb3V0KGNhbC50aW1lb3V0KTsNCgl9DQoJdmFyIGVsID0gY2FsLmFjdGl2ZURpdjsNCglpZiAoIWVsKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJdmFyIHRhcmdldCA9IENhbGVuZGFyLmdldFRhcmdldEVsZW1lbnQoZXYpOw0KCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGVsLCAiYWN0aXZlIik7DQoJaWYgKHRhcmdldCA9PSBlbCB8fCB0YXJnZXQucGFyZW50Tm9kZSA9PSBlbCkgew0KCQlDYWxlbmRhci5jZWxsQ2xpY2soZWwpOw0KCX0NCgl2YXIgbW9uID0gQ2FsZW5kYXIuZmluZE1vbnRoKHRhcmdldCk7DQoJdmFyIGRhdGUgPSBudWxsOw0KCWlmIChtb24pIHsNCgkJZGF0ZSA9IG5ldyBEYXRlKGNhbC5kYXRlKTsNCgkJaWYgKG1vbi5tb250aCAhPSBkYXRlLmdldE1vbnRoKCkpIHsNCgkJCWRhdGUuc2V0TW9udGgobW9uLm1vbnRoKTsNCgkJCWNhbC5zZXREYXRlKGRhdGUpOw0KCQl9DQoJfSBlbHNlIHsNCgkJdmFyIHllYXIgPSBDYWxlbmRhci5maW5kWWVhcih0YXJnZXQpOw0KCQlpZiAoeWVhcikgew0KCQkJZGF0ZSA9IG5ldyBEYXRlKGNhbC5kYXRlKTsNCgkJCWlmICh5ZWFyLnllYXIgIT0gZGF0ZS5nZXRGdWxsWWVhcigpKSB7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyLnllYXIpOw0KCQkJCWNhbC5zZXREYXRlKGRhdGUpOw0KCQkJfQ0KCQl9DQoJfQ0KCXdpdGggKENhbGVuZGFyKSB7DQoJCXJlbW92ZUV2ZW50KGRvY3VtZW50LCAibW91c2V1cCIsIHRhYmxlTW91c2VVcCk7DQoJCXJlbW92ZUV2ZW50KGRvY3VtZW50LCAibW91c2VvdmVyIiwgdGFibGVNb3VzZU92ZXIpOw0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNlbW92ZSIsIHRhYmxlTW91c2VPdmVyKTsNCgkJY2FsLl9oaWRlQ29tYm9zKCk7DQoJCXN0b3BFdmVudChldik7DQoJCV9DID0gbnVsbDsNCgl9DQp9Ow0KDQpDYWxlbmRhci50YWJsZU1vdXNlT3ZlciA9IGZ1bmN0aW9uIChldikgew0KCXZhciBjYWwgPSBDYWxlbmRhci5fQzsNCglpZiAoIWNhbCkgew0KCQlyZXR1cm47DQoJfQ0KCXZhciBlbCA9IGNhbC5hY3RpdmVEaXY7DQoJdmFyIHRhcmdldCA9IENhbGVuZGFyLmdldFRhcmdldEVsZW1lbnQoZXYpOw0KCWlmICh0YXJnZXQgPT0gZWwgfHwgdGFyZ2V0LnBhcmVudE5vZGUgPT0gZWwpIHsNCgkJQ2FsZW5kYXIuYWRkQ2xhc3MoZWwsICJoaWxpdGUgYWN0aXZlIik7DQoJCUNhbGVuZGFyLmFkZENsYXNzKGVsLnBhcmVudE5vZGUsICJyb3doaWxpdGUiKTsNCgl9IGVsc2Ugew0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgImFjdGl2ZSIpOw0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgImhpbGl0ZSIpOw0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhlbC5wYXJlbnROb2RlLCAicm93aGlsaXRlIik7DQoJfQ0KCXZhciBtb24gPSBDYWxlbmRhci5maW5kTW9udGgodGFyZ2V0KTsNCglpZiAobW9uKSB7DQoJCWlmIChtb24ubW9udGggIT0gY2FsLmRhdGUuZ2V0TW9udGgoKSkgew0KCQkJaWYgKGNhbC5oaWxpdGVkTW9udGgpIHsNCgkJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZE1vbnRoLCAiaGlsaXRlIik7DQoJCQl9DQoJCQlDYWxlbmRhci5hZGRDbGFzcyhtb24sICJoaWxpdGUiKTsNCgkJCWNhbC5oaWxpdGVkTW9udGggPSBtb247DQoJCX0gZWxzZSBpZiAoY2FsLmhpbGl0ZWRNb250aCkgew0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmhpbGl0ZWRNb250aCwgImhpbGl0ZSIpOw0KCQl9DQoJfSBlbHNlIHsNCgkJdmFyIHllYXIgPSBDYWxlbmRhci5maW5kWWVhcih0YXJnZXQpOw0KCQlpZiAoeWVhcikgew0KCQkJaWYgKHllYXIueWVhciAhPSBjYWwuZGF0ZS5nZXRGdWxsWWVhcigpKSB7DQoJCQkJaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZFllYXIsICJoaWxpdGUiKTsNCgkJCQl9DQoJCQkJQ2FsZW5kYXIuYWRkQ2xhc3MoeWVhciwgImhpbGl0ZSIpOw0KCQkJCWNhbC5oaWxpdGVkWWVhciA9IHllYXI7DQoJCQl9IGVsc2UgaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5oaWxpdGVkWWVhciwgImhpbGl0ZSIpOw0KCQkJfQ0KCQl9DQoJfQ0KCUNhbGVuZGFyLnN0b3BFdmVudChldik7DQp9Ow0KDQpDYWxlbmRhci50YWJsZU1vdXNlRG93biA9IGZ1bmN0aW9uIChldikgew0KCWlmIChDYWxlbmRhci5nZXRUYXJnZXRFbGVtZW50KGV2KSA9PSBDYWxlbmRhci5nZXRFbGVtZW50KGV2KSkgew0KCQlDYWxlbmRhci5zdG9wRXZlbnQoZXYpOw0KCX0NCn07DQoNCkNhbGVuZGFyLmNhbERyYWdJdCA9IGZ1bmN0aW9uIChldikgew0KCXZhciBjYWwgPSBDYWxlbmRhci5fQzsNCglpZiAoIShjYWwgJiYgY2FsLmRyYWdnaW5nKSkgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCXZhciBwb3NYOw0KCXZhciBwb3NZOw0KCWlmIChDYWxlbmRhci5pc19pZSkgew0KCQlwb3NZID0gd2luZG93LmV2ZW50LmNsaWVudFkgKyBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsNCgkJcG9zWCA9IHdpbmRvdy5ldmVudC5jbGllbnRYICsgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0Ow0KCX0gZWxzZSB7DQoJCXBvc1ggPSBldi5wYWdlWDsNCgkJcG9zWSA9IGV2LnBhZ2VZOw0KCX0NCgljYWwuaGlkZVNob3dDb3ZlcmVkKCk7DQoJdmFyIHN0ID0gY2FsLmVsZW1lbnQuc3R5bGU7DQoJc3QubGVmdCA9IChwb3NYIC0gY2FsLnhPZmZzKSArICJweCI7DQoJc3QudG9wID0gKHBvc1kgLSBjYWwueU9mZnMpICsgInB4IjsNCglDYWxlbmRhci5zdG9wRXZlbnQoZXYpOw0KfTsNCg0KQ2FsZW5kYXIuY2FsRHJhZ0VuZCA9IGZ1bmN0aW9uIChldikgew0KCXZhciBjYWwgPSBDYWxlbmRhci5fQzsNCglpZiAoIWNhbCkgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCWNhbC5kcmFnZ2luZyA9IGZhbHNlOw0KCXdpdGggKENhbGVuZGFyKSB7DQoJCXJlbW92ZUV2ZW50KGRvY3VtZW50LCAibW91c2Vtb3ZlIiwgY2FsRHJhZ0l0KTsNCgkJcmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJtb3VzZW92ZXIiLCBzdG9wRXZlbnQpOw0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNldXAiLCBjYWxEcmFnRW5kKTsNCgkJdGFibGVNb3VzZVVwKGV2KTsNCgl9DQoJY2FsLmhpZGVTaG93Q292ZXJlZCgpOw0KfTsNCg0KQ2FsZW5kYXIuZGF5TW91c2VEb3duID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgZWwgPSBDYWxlbmRhci5nZXRFbGVtZW50KGV2KTsNCglpZiAoZWwuZGlzYWJsZWQpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgY2FsID0gZWwuY2FsZW5kYXI7DQoJY2FsLmFjdGl2ZURpdiA9IGVsOw0KCUNhbGVuZGFyLl9DID0gY2FsOw0KCWlmIChlbC5uYXZ0eXBlICE9IDMwMCkgd2l0aCAoQ2FsZW5kYXIpIHsNCgkJYWRkQ2xhc3MoZWwsICJoaWxpdGUgYWN0aXZlIik7DQoJCWFkZEV2ZW50KGRvY3VtZW50LCAibW91c2VvdmVyIiwgdGFibGVNb3VzZU92ZXIpOw0KCQlhZGRFdmVudChkb2N1bWVudCwgIm1vdXNlbW92ZSIsIHRhYmxlTW91c2VPdmVyKTsNCgkJYWRkRXZlbnQoZG9jdW1lbnQsICJtb3VzZXVwIiwgdGFibGVNb3VzZVVwKTsNCgl9IGVsc2UgaWYgKGNhbC5pc1BvcHVwKSB7DQoJCWNhbC5fZHJhZ1N0YXJ0KGV2KTsNCgl9DQoJQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCglpZiAoZWwubmF2dHlwZSA9PSAtMSB8fCBlbC5uYXZ0eXBlID09IDEpIHsNCgkJY2FsLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCJDYWxlbmRhci5zaG93TW9udGhzQ29tYm8oKSIsIDI1MCk7DQoJfSBlbHNlIGlmIChlbC5uYXZ0eXBlID09IC0yIHx8IGVsLm5hdnR5cGUgPT0gMikgew0KCQljYWwudGltZW91dCA9IHNldFRpbWVvdXQoKGVsLm5hdnR5cGUgPiAwKSA\/ICJDYWxlbmRhci5zaG93WWVhcnNDb21ibyh0cnVlKSIgOiAiQ2FsZW5kYXIuc2hvd1llYXJzQ29tYm8oZmFsc2UpIiwgMjUwKTsNCgl9IGVsc2Ugew0KCQljYWwudGltZW91dCA9IG51bGw7DQoJfQ0KfTsNCg0KQ2FsZW5kYXIuZGF5TW91c2VEYmxDbGljayA9IGZ1bmN0aW9uKGV2KSB7DQoJQ2FsZW5kYXIuY2VsbENsaWNrKENhbGVuZGFyLmdldEVsZW1lbnQoZXYpKTsNCglpZiAoQ2FsZW5kYXIuaXNfaWUpIHsNCgkJZG9jdW1lbnQuc2VsZWN0aW9uLmVtcHR5KCk7DQoJfQ0KfTsNCg0KQ2FsZW5kYXIuZGF5TW91c2VPdmVyID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgZWwgPSBDYWxlbmRhci5nZXRFbGVtZW50KGV2KTsNCglpZiAoQ2FsZW5kYXIuaXNSZWxhdGVkKGVsLCBldikgfHwgQ2FsZW5kYXIuX0MgfHwgZWwuZGlzYWJsZWQpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCglpZiAoZWwudHRpcCkgew0KCQlpZiAoZWwudHRpcC5zdWJzdHIoMCwgMSkgPT0gIl8iKSB7DQoJCQl2YXIgZGF0ZSA9IG51bGw7DQoJCQl3aXRoIChlbC5jYWxlbmRhci5kYXRlKSB7DQoJCQkJZGF0ZSA9IG5ldyBEYXRlKGdldEZ1bGxZZWFyKCksIGdldE1vbnRoKCksIGVsLmNhbGRhdGUpOw0KCQkJfQ0KCQkJZWwudHRpcCA9IGRhdGUucHJpbnQoZWwuY2FsZW5kYXIudHREYXRlRm9ybWF0KSArIGVsLnR0aXAuc3Vic3RyKDEpOw0KCQl9DQoJCWVsLmNhbGVuZGFyLnRvb2x0aXBzLmZpcnN0Q2hpbGQuZGF0YSA9IGVsLnR0aXA7DQoJfQ0KCWlmIChlbC5uYXZ0eXBlICE9IDMwMCkgew0KCQlDYWxlbmRhci5hZGRDbGFzcyhlbCwgImhpbGl0ZSIpOw0KCQlpZiAoZWwuY2FsZGF0ZSkgew0KCQkJQ2FsZW5kYXIuYWRkQ2xhc3MoZWwucGFyZW50Tm9kZSwgInJvd2hpbGl0ZSIpOw0KCQl9DQoJfQ0KCUNhbGVuZGFyLnN0b3BFdmVudChldik7DQp9Ow0KDQpDYWxlbmRhci5kYXlNb3VzZU91dCA9IGZ1bmN0aW9uKGV2KSB7DQoJd2l0aCAoQ2FsZW5kYXIpIHsNCgkJdmFyIGVsID0gZ2V0RWxlbWVudChldik7DQoJCWlmIChpc1JlbGF0ZWQoZWwsIGV2KSB8fCBfQyB8fCBlbC5kaXNhYmxlZCkgew0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJCXJlbW92ZUNsYXNzKGVsLCAiaGlsaXRlIik7DQoJCWlmIChlbC5jYWxkYXRlKSB7DQoJCQlyZW1vdmVDbGFzcyhlbC5wYXJlbnROb2RlLCAicm93aGlsaXRlIik7DQoJCX0NCgkJZWwuY2FsZW5kYXIudG9vbHRpcHMuZmlyc3RDaGlsZC5kYXRhID0gX1RUWyJTRUxfREFURSJdOw0KCQlzdG9wRXZlbnQoZXYpOw0KCX0NCn07DQoNCi8qKg0KICogIEEgZ2VuZXJpYyAiY2xpY2siIGhhbmRsZXIgOikgaGFuZGxlcyBhbGwgdHlwZXMgb2YgYnV0dG9ucyBkZWZpbmVkIGluIHRoaXMNCiAqICBjYWxlbmRhci4NCiAqLw0KQ2FsZW5kYXIuY2VsbENsaWNrID0gZnVuY3Rpb24oZWwpIHsNCgl2YXIgY2FsID0gZWwuY2FsZW5kYXI7DQoJdmFyIGNsb3NpbmcgPSBmYWxzZTsNCgl2YXIgbmV3ZGF0ZSA9IGZhbHNlOw0KCXZhciBkYXRlID0gbnVsbDsNCglpZiAodHlwZW9mIGVsLm5hdnR5cGUgPT0gInVuZGVmaW5lZCIpIHsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmN1cnJlbnREYXRlRWwsICJzZWxlY3RlZCIpOw0KCQlDYWxlbmRhci5hZGRDbGFzcyhlbCwgInNlbGVjdGVkIik7DQoJCWNsb3NpbmcgPSAoY2FsLmN1cnJlbnREYXRlRWwgPT0gZWwpOw0KCQlpZiAoIWNsb3NpbmcpIHsNCgkJCWNhbC5jdXJyZW50RGF0ZUVsID0gZWw7DQoJCX0NCgkJY2FsLmRhdGUuc2V0RGF0ZShlbC5jYWxkYXRlKTsNCgkJZGF0ZSA9IGNhbC5kYXRlOw0KCQluZXdkYXRlID0gdHJ1ZTsNCgl9IGVsc2Ugew0KCQlpZiAoZWwubmF2dHlwZSA9PSAyMDApIHsNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGVsLCAiaGlsaXRlIik7DQoJCQljYWwuY2FsbENsb3NlSGFuZGxlcigpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCWRhdGUgPSAoZWwubmF2dHlwZSA9PSAwKSA\/IG5ldyBEYXRlKCkgOiBuZXcgRGF0ZShjYWwuZGF0ZSk7DQoJCXZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOw0KCQl2YXIgbW9uID0gZGF0ZS5nZXRNb250aCgpOw0KCQlmdW5jdGlvbiBzZXRNb250aChtKSB7DQoJCQl2YXIgZGF5ID0gZGF0ZS5nZXREYXRlKCk7DQoJCQl2YXIgbWF4ID0gZGF0ZS5nZXRNb250aERheXMobSk7DQoJCQlpZiAoZGF5ID4gbWF4KSB7DQoJCQkJZGF0ZS5zZXREYXRlKG1heCk7DQoJCQl9DQoJCQlkYXRlLnNldE1vbnRoKG0pOw0KCQl9Ow0KCQlzd2l0Y2ggKGVsLm5hdnR5cGUpIHsNCgkJICAgIGNhc2UgLTI6DQoJCQlpZiAoeWVhciA+IGNhbC5taW5ZZWFyKSB7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyIC0gMSk7DQoJCQl9DQoJCQlicmVhazsNCgkJICAgIGNhc2UgLTE6DQoJCQlpZiAobW9uID4gMCkgew0KCQkJCXNldE1vbnRoKG1vbiAtIDEpOw0KCQkJfSBlbHNlIGlmICh5ZWFyLS0gPiBjYWwubWluWWVhcikgew0KCQkJCWRhdGUuc2V0RnVsbFllYXIoeWVhcik7DQoJCQkJc2V0TW9udGgoMTEpOw0KCQkJfQ0KCQkJYnJlYWs7DQoJCSAgICBjYXNlIDE6DQoJCQlpZiAobW9uIDwgMTEpIHsNCgkJCQlzZXRNb250aChtb24gKyAxKTsNCgkJCX0gZWxzZSBpZiAoeWVhciA8IGNhbC5tYXhZZWFyKSB7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyICsgMSk7DQoJCQkJc2V0TW9udGgoMCk7DQoJCQl9DQoJCQlicmVhazsNCgkJICAgIGNhc2UgMjoNCgkJCWlmICh5ZWFyIDwgY2FsLm1heFllYXIpIHsNCgkJCQlkYXRlLnNldEZ1bGxZZWFyKHllYXIgKyAxKTsNCgkJCX0NCgkJCWJyZWFrOw0KCQkgICAgY2FzZSAxMDA6DQoJCQljYWwuc2V0TW9uZGF5Rmlyc3QoIWNhbC5tb25kYXlGaXJzdCk7DQoJCQlyZXR1cm47DQoJCX0NCgkJaWYgKCFkYXRlLmVxdWFsc1RvKGNhbC5kYXRlKSkgew0KCQkJY2FsLnNldERhdGUoZGF0ZSk7DQoJCQluZXdkYXRlID0gZWwubmF2dHlwZSA9PSAwOw0KCQl9DQoJfQ0KCWlmIChuZXdkYXRlKSB7DQoJCWNhbC5jYWxsSGFuZGxlcigpOw0KCX0NCglpZiAoY2xvc2luZykgew0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgImhpbGl0ZSIpOw0KCQljYWwuY2FsbENsb3NlSGFuZGxlcigpOw0KCX0NCn07DQoNCi8vIEVORDogQ0FMRU5EQVIgU1RBVElDIEZVTkNUSU9OUw0KDQovLyBCRUdJTjogQ0FMRU5EQVIgT0JKRUNUIEZVTkNUSU9OUw0KDQovKioNCiAqICBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgdGhlIGNhbGVuZGFyIGluc2lkZSB0aGUgZ2l2ZW4gcGFyZW50LiAgSWYgX3BhciBpcw0KICogIG51bGwgdGhhbiBpdCBjcmVhdGVzIGEgcG9wdXAgY2FsZW5kYXIgaW5zaWRlIHRoZSBCT0RZIGVsZW1lbnQuICBJZiBfcGFyIGlzDQogKiAgYW4gZWxlbWVudCwgYmUgaXQgQk9EWSwgdGhlbiBpdCBjcmVhdGVzIGEgbm9uLXBvcHVwIGNhbGVuZGFyIChzdGlsbA0KICogIGhpZGRlbikuICBTb21lIHByb3BlcnRpZXMgbmVlZCB0byBiZSBzZXQgYmVmb3JlIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi4NCiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChfcGFyKSB7DQoJdmFyIHBhcmVudCA9IG51bGw7DQoJaWYgKCEgX3Bhcikgew0KCQkvLyBkZWZhdWx0IHBhcmVudCBpcyB0aGUgZG9jdW1lbnQgYm9keSwgaW4gd2hpY2ggY2FzZSB3ZSBjcmVhdGUNCgkJLy8gYSBwb3B1cCBjYWxlbmRhci4NCgkJcGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsNCgkJdGhpcy5pc1BvcHVwID0gdHJ1ZTsNCgl9IGVsc2Ugew0KCQlwYXJlbnQgPSBfcGFyOw0KCQl0aGlzLmlzUG9wdXAgPSBmYWxzZTsNCgl9DQoJdGhpcy5kYXRlID0gdGhpcy5kYXRlU3RyID8gbmV3IERhdGUodGhpcy5kYXRlU3RyKSA6IG5ldyBEYXRlKCk7DQoNCgl2YXIgdGFibGUgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpOw0KCXRoaXMudGFibGUgPSB0YWJsZTsNCgl0YWJsZS5jZWxsU3BhY2luZyA9IDA7DQoJdGFibGUuY2VsbFBhZGRpbmcgPSAwOw0KCXRhYmxlLmNhbGVuZGFyID0gdGhpczsNCglDYWxlbmRhci5hZGRFdmVudCh0YWJsZSwgIm1vdXNlZG93biIsIENhbGVuZGFyLnRhYmxlTW91c2VEb3duKTsNCg0KCXZhciBkaXYgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgl0aGlzLmVsZW1lbnQgPSBkaXY7DQoJZGl2LmNsYXNzTmFtZSA9ICJjYWxlbmRhciI7DQoJaWYgKHRoaXMuaXNQb3B1cCkgew0KCQlkaXYuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KCQlkaXYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgl9DQoJZGl2LmFwcGVuZENoaWxkKHRhYmxlKTsNCg0KCXZhciB0aGVhZCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRoZWFkIiwgdGFibGUpOw0KCXZhciBjZWxsID0gbnVsbDsNCgl2YXIgcm93ID0gbnVsbDsNCg0KCXZhciBjYWwgPSB0aGlzOw0KCXZhciBoaCA9IGZ1bmN0aW9uICh0ZXh0LCBjcywgbmF2dHlwZSkgew0KCQljZWxsID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidGQiLCByb3cpOw0KCQljZWxsLmNvbFNwYW4gPSBjczsNCgkJY2VsbC5jbGFzc05hbWUgPSAiYnV0dG9uIjsNCgkJQ2FsZW5kYXIuX2FkZF9ldnMoY2VsbCk7DQoJCWNlbGwuY2FsZW5kYXIgPSBjYWw7DQoJCWNlbGwubmF2dHlwZSA9IG5hdnR5cGU7DQoJCWlmICh0ZXh0LnN1YnN0cigwLCAxKSAhPSAiJiIpIHsNCgkJCWNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpOw0KCQl9DQoJCWVsc2Ugew0KCQkJLy8gRklYTUU6IGRpcnR5IGhhY2sgZm9yIGVudGl0aWVzDQoJCQljZWxsLmlubmVySFRNTCA9IHRleHQ7DQoJCX0NCgkJcmV0dXJuIGNlbGw7DQoJfTsNCg0KCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGhlYWQpOw0KCXZhciB0aXRsZV9sZW5ndGggPSA2Ow0KCSh0aGlzLmlzUG9wdXApICYmIC0tdGl0bGVfbGVuZ3RoOw0KCSh0aGlzLndlZWtOdW1iZXJzKSAmJiArK3RpdGxlX2xlbmd0aDsNCg0KCWhoKCItIiwgMSwgMTAwKS50dGlwID0gQ2FsZW5kYXIuX1RUWyJUT0dHTEUiXTsNCgl0aGlzLnRpdGxlID0gaGgoIiIsIHRpdGxlX2xlbmd0aCwgMzAwKTsNCgl0aGlzLnRpdGxlLmNsYXNzTmFtZSA9ICJ0aXRsZSI7DQoJaWYgKHRoaXMuaXNQb3B1cCkgew0KCQl0aGlzLnRpdGxlLnR0aXAgPSBDYWxlbmRhci5fVFRbIkRSQUdfVE9fTU9WRSJdOw0KCQl0aGlzLnRpdGxlLnN0eWxlLmN1cnNvciA9ICJtb3ZlIjsNCgkJaGgoIiYjeDAwZDc7IiwgMSwgMjAwKS50dGlwID0gQ2FsZW5kYXIuX1RUWyJDTE9TRSJdOw0KCX0NCg0KCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGhlYWQpOw0KCXJvdy5jbGFzc05hbWUgPSAiaGVhZHJvdyI7DQoNCgl0aGlzLl9uYXZfcHkgPSBoaCgiJiN4MDBhYjsiLCAxLCAtMik7DQoJdGhpcy5fbmF2X3B5LnR0aXAgPSBDYWxlbmRhci5fVFRbIlBSRVZfWUVBUiJdOw0KDQoJdGhpcy5fbmF2X3BtID0gaGgoIiYjeDIwMzk7IiwgMSwgLTEpOw0KCXRoaXMuX25hdl9wbS50dGlwID0gQ2FsZW5kYXIuX1RUWyJQUkVWX01PTlRIIl07DQoNCgl0aGlzLl9uYXZfbm93ID0gaGgoQ2FsZW5kYXIuX1RUWyJUT0RBWSJdLCB0aGlzLndlZWtOdW1iZXJzID8gNCA6IDMsIDApOw0KCXRoaXMuX25hdl9ub3cudHRpcCA9IENhbGVuZGFyLl9UVFsiR09fVE9EQVkiXTsNCg0KCXRoaXMuX25hdl9ubSA9IGhoKCImI3gyMDNhOyIsIDEsIDEpOw0KCXRoaXMuX25hdl9ubS50dGlwID0gQ2FsZW5kYXIuX1RUWyJORVhUX01PTlRIIl07DQoNCgl0aGlzLl9uYXZfbnkgPSBoaCgiJiN4MDBiYjsiLCAxLCAyKTsNCgl0aGlzLl9uYXZfbnkudHRpcCA9IENhbGVuZGFyLl9UVFsiTkVYVF9ZRUFSIl0NCg0KCS8vIGRheSBuYW1lcw0KCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGhlYWQpOw0KCXJvdy5jbGFzc05hbWUgPSAiZGF5bmFtZXMiOw0KCWlmICh0aGlzLndlZWtOdW1iZXJzKSB7DQoJCWNlbGwgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ZCIsIHJvdyk7DQoJCWNlbGwuY2xhc3NOYW1lID0gIm5hbWUgd24iOw0KCQljZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKENhbGVuZGFyLl9UVFsiV0siXSkpOw0KCX0NCglmb3IgKHZhciBpID0gNzsgaSA+IDA7IC0taSkgew0KCQljZWxsID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidGQiLCByb3cpOw0KCQljZWxsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKSk7DQoJCWlmICghaSkgew0KCQkJY2VsbC5uYXZ0eXBlID0gMTAwOw0KCQkJY2VsbC5jYWxlbmRhciA9IHRoaXM7DQoJCQlDYWxlbmRhci5fYWRkX2V2cyhjZWxsKTsNCgkJfQ0KCX0NCgl0aGlzLmZpcnN0ZGF5bmFtZSA9ICh0aGlzLndlZWtOdW1iZXJzKSA\/IHJvdy5maXJzdENoaWxkLm5leHRTaWJsaW5nIDogcm93LmZpcnN0Q2hpbGQ7DQoJdGhpcy5fZGlzcGxheVdlZWtkYXlzKCk7DQoNCgl2YXIgdGJvZHkgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0Ym9keSIsIHRhYmxlKTsNCgl0aGlzLnRib2R5ID0gdGJvZHk7DQoNCglmb3IgKGkgPSA2OyBpID4gMDsgLS1pKSB7DQoJCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGJvZHkpOw0KCQlpZiAodGhpcy53ZWVrTnVtYmVycykgew0KCQkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJCWNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpKTsNCgkJfQ0KCQlmb3IgKHZhciBqID0gNzsgaiA+IDA7IC0taikgew0KCQkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJCWNlbGwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpKTsNCgkJCWNlbGwuY2FsZW5kYXIgPSB0aGlzOw0KCQkJQ2FsZW5kYXIuX2FkZF9ldnMoY2VsbCk7DQoJCX0NCgl9DQoNCgl2YXIgdGZvb3QgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0Zm9vdCIsIHRhYmxlKTsNCg0KCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGZvb3QpOw0KCXJvdy5jbGFzc05hbWUgPSAiZm9vdHJvdyI7DQoNCgljZWxsID0gaGgoQ2FsZW5kYXIuX1RUWyJTRUxfREFURSJdLCB0aGlzLndlZWtOdW1iZXJzID8gOCA6IDcsIDMwMCk7DQoJY2VsbC5jbGFzc05hbWUgPSAidHRpcCI7DQoJaWYgKHRoaXMuaXNQb3B1cCkgew0KCQljZWxsLnR0aXAgPSBDYWxlbmRhci5fVFRbIkRSQUdfVE9fTU9WRSJdOw0KCQljZWxsLnN0eWxlLmN1cnNvciA9ICJtb3ZlIjsNCgl9DQoJdGhpcy50b29sdGlwcyA9IGNlbGw7DQoNCglkaXYgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiLCB0aGlzLmVsZW1lbnQpOw0KCXRoaXMubW9udGhzQ29tYm8gPSBkaXY7DQoJZGl2LmNsYXNzTmFtZSA9ICJjb21ibyI7DQoJZm9yIChpID0gMDsgaSA8IENhbGVuZGFyLl9NTi5sZW5ndGg7ICsraSkgew0KCQl2YXIgbW4gPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJbW4uY2xhc3NOYW1lID0gImxhYmVsIjsNCgkJbW4ubW9udGggPSBpOw0KCQltbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShDYWxlbmRhci5fTU4zW2ldKSk7DQoJCWRpdi5hcHBlbmRDaGlsZChtbik7DQoJfQ0KDQoJZGl2ID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgiZGl2IiwgdGhpcy5lbGVtZW50KTsNCgl0aGlzLnllYXJzQ29tYm8gPSBkaXY7DQoJZGl2LmNsYXNzTmFtZSA9ICJjb21ibyI7DQoJZm9yIChpID0gMTI7IGkgPiAwOyAtLWkpIHsNCgkJdmFyIHlyID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCXlyLmNsYXNzTmFtZSA9ICJsYWJlbCI7DQoJCXlyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKSk7DQoJCWRpdi5hcHBlbmRDaGlsZCh5cik7DQoJfQ0KDQoJdGhpcy5faW5pdCh0aGlzLm1vbmRheUZpcnN0LCB0aGlzLmRhdGUpOw0KCXBhcmVudC5hcHBlbmRDaGlsZCh0aGlzLmVsZW1lbnQpOw0KfTsNCg0KLyoqIGtleWJvYXJkIG5hdmlnYXRpb24sIG9ubHkgZm9yIHBvcHVwIGNhbGVuZGFycyAqLw0KQ2FsZW5kYXIuX2tleUV2ZW50ID0gZnVuY3Rpb24oZXYpIHsNCglpZiAoIXdpbmRvdy5jYWxlbmRhcikgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCShDYWxlbmRhci5pc19pZSkgJiYgKGV2ID0gd2luZG93LmV2ZW50KTsNCgl2YXIgY2FsID0gd2luZG93LmNhbGVuZGFyOw0KCXZhciBhY3QgPSAoQ2FsZW5kYXIuaXNfaWUgfHwgZXYudHlwZSA9PSAia2V5cHJlc3MiKTsNCglpZiAoZXYuY3RybEtleSkgew0KCQlzd2l0Y2ggKGV2LmtleUNvZGUpIHsNCgkJICAgIGNhc2UgMzc6IC8vIEtFWSBsZWZ0DQoJCQlhY3QgJiYgQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X3BtKTsNCgkJCWJyZWFrOw0KCQkgICAgY2FzZSAzODogLy8gS0VZIHVwDQoJCQlhY3QgJiYgQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X3B5KTsNCgkJCWJyZWFrOw0KCQkgICAgY2FzZSAzOTogLy8gS0VZIHJpZ2h0DQoJCQlhY3QgJiYgQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X25tKTsNCgkJCWJyZWFrOw0KCQkgICAgY2FzZSA0MDogLy8gS0VZIGRvd24NCgkJCWFjdCAmJiBDYWxlbmRhci5jZWxsQ2xpY2soY2FsLl9uYXZfbnkpOw0KCQkJYnJlYWs7DQoJCSAgICBkZWZhdWx0Og0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJfSBlbHNlIHN3aXRjaCAoZXYua2V5Q29kZSkgew0KCSAgICBjYXNlIDMyOiAvLyBLRVkgc3BhY2UgKG5vdykNCgkJQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X25vdyk7DQoJCWJyZWFrOw0KCSAgICBjYXNlIDI3OiAvLyBLRVkgZXNjDQoJCWFjdCAmJiBjYWwuaGlkZSgpOw0KCQlicmVhazsNCgkgICAgY2FzZSAzNzogLy8gS0VZIGxlZnQNCgkgICAgY2FzZSAzODogLy8gS0VZIHVwDQoJICAgIGNhc2UgMzk6IC8vIEtFWSByaWdodA0KCSAgICBjYXNlIDQwOiAvLyBLRVkgZG93bg0KCQlpZiAoYWN0KSB7DQoJCQl2YXIgZGF0ZSA9IGNhbC5kYXRlLmdldERhdGUoKSAtIDE7DQoJCQl2YXIgZWwgPSBjYWwuY3VycmVudERhdGVFbDsNCgkJCXZhciBuZSA9IG51bGw7DQoJCQl2YXIgcHJldiA9IChldi5rZXlDb2RlID09IDM3KSB8fCAoZXYua2V5Q29kZSA9PSAzOCk7DQoJCQlzd2l0Y2ggKGV2LmtleUNvZGUpIHsNCgkJCSAgICBjYXNlIDM3OiAvLyBLRVkgbGVmdA0KCQkJCSgtLWRhdGUgPj0gMCkgJiYgKG5lID0gY2FsLmFyX2RheXNbZGF0ZV0pOw0KCQkJCWJyZWFrOw0KCQkJICAgIGNhc2UgMzg6IC8vIEtFWSB1cA0KCQkJCWRhdGUgLT0gNzsNCgkJCQkoZGF0ZSA+PSAwKSAmJiAobmUgPSBjYWwuYXJfZGF5c1tkYXRlXSk7DQoJCQkJYnJlYWs7DQoJCQkgICAgY2FzZSAzOTogLy8gS0VZIHJpZ2h0DQoJCQkJKCsrZGF0ZSA8IGNhbC5hcl9kYXlzLmxlbmd0aCkgJiYgKG5lID0gY2FsLmFyX2RheXNbZGF0ZV0pOw0KCQkJCWJyZWFrOw0KCQkJICAgIGNhc2UgNDA6IC8vIEtFWSBkb3duDQoJCQkJZGF0ZSArPSA3Ow0KCQkJCShkYXRlIDwgY2FsLmFyX2RheXMubGVuZ3RoKSAmJiAobmUgPSBjYWwuYXJfZGF5c1tkYXRlXSk7DQoJCQkJYnJlYWs7DQoJCQl9DQoJCQlpZiAoIW5lKSB7DQoJCQkJaWYgKHByZXYpIHsNCgkJCQkJQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X3BtKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlDYWxlbmRhci5jZWxsQ2xpY2soY2FsLl9uYXZfbm0pOw0KCQkJCX0NCgkJCQlkYXRlID0gKHByZXYpID8gY2FsLmRhdGUuZ2V0TW9udGhEYXlzKCkgOiAxOw0KCQkJCWVsID0gY2FsLmN1cnJlbnREYXRlRWw7DQoJCQkJbmUgPSBjYWwuYXJfZGF5c1tkYXRlIC0gMV07DQoJCQl9DQoJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgInNlbGVjdGVkIik7DQoJCQlDYWxlbmRhci5hZGRDbGFzcyhuZSwgInNlbGVjdGVkIik7DQoJCQljYWwuZGF0ZS5zZXREYXRlKG5lLmNhbGRhdGUpOw0KCQkJY2FsLmN1cnJlbnREYXRlRWwgPSBuZTsNCgkJfQ0KCQlicmVhazsNCgkgICAgY2FzZSAxMzogLy8gS0VZIGVudGVyDQoJCWlmIChhY3QpIHsNCgkJCWNhbC5jYWxsSGFuZGxlcigpOw0KCQkJY2FsLmhpZGUoKTsNCgkJfQ0KCQlicmVhazsNCgkgICAgZGVmYXVsdDoNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCglDYWxlbmRhci5zdG9wRXZlbnQoZXYpOw0KfTsNCg0KLyoqDQogKiAgKFJFKUluaXRpYWxpemVzIHRoZSBjYWxlbmRhciB0byB0aGUgZ2l2ZW4gZGF0ZSBhbmQgc3R5bGUgKGlmIG1vbmRheUZpcnN0IGlzDQogKiAgdHJ1ZSBpdCBtYWtlcyBNb25kYXkgdGhlIGZpcnN0IGRheSBvZiB3ZWVrLCBvdGhlcndpc2UgdGhlIHdlZWtzIHN0YXJ0IG9uDQogKiAgU3VuZGF5Lg0KICovDQpDYWxlbmRhci5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbiAobW9uZGF5Rmlyc3QsIGRhdGUpIHsNCgl2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpOw0KCXZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOw0KCWlmICh5ZWFyIDwgdGhpcy5taW5ZZWFyKSB7DQoJCXllYXIgPSB0aGlzLm1pblllYXI7DQoJCWRhdGUuc2V0RnVsbFllYXIoeWVhcik7DQoJfSBlbHNlIGlmICh5ZWFyID4gdGhpcy5tYXhZZWFyKSB7DQoJCXllYXIgPSB0aGlzLm1heFllYXI7DQoJCWRhdGUuc2V0RnVsbFllYXIoeWVhcik7DQoJfQ0KCXRoaXMubW9uZGF5Rmlyc3QgPSBtb25kYXlGaXJzdDsNCgl0aGlzLmRhdGUgPSBuZXcgRGF0ZShkYXRlKTsNCgl2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7DQoJdmFyIG1kYXkgPSBkYXRlLmdldERhdGUoKTsNCgl2YXIgbm9fZGF5cyA9IGRhdGUuZ2V0TW9udGhEYXlzKCk7DQoJZGF0ZS5zZXREYXRlKDEpOw0KCXZhciB3ZGF5ID0gZGF0ZS5nZXREYXkoKTsNCgl2YXIgTU9OID0gbW9uZGF5Rmlyc3QgPyAxIDogMDsNCgl2YXIgU0FUID0gbW9uZGF5Rmlyc3QgPyA1IDogNjsNCgl2YXIgU1VOID0gbW9uZGF5Rmlyc3QgPyA2IDogMDsNCglpZiAobW9uZGF5Rmlyc3QpIHsNCgkJd2RheSA9ICh3ZGF5ID4gMCkgPyAod2RheSAtIDEpIDogNjsNCgl9DQoJdmFyIGlkYXkgPSAxOw0KCXZhciByb3cgPSB0aGlzLnRib2R5LmZpcnN0Q2hpbGQ7DQoJdmFyIE1OID0gQ2FsZW5kYXIuX01OM1ttb250aF07DQoJdmFyIGhhc1RvZGF5ID0gKCh0b2RheS5nZXRGdWxsWWVhcigpID09IHllYXIpICYmICh0b2RheS5nZXRNb250aCgpID09IG1vbnRoKSk7DQoJdmFyIHRvZGF5RGF0ZSA9IHRvZGF5LmdldERhdGUoKTsNCgl2YXIgd2Vla19udW1iZXIgPSBkYXRlLmdldFdlZWtOdW1iZXIoKTsNCgl2YXIgYXJfZGF5cyA9IG5ldyBBcnJheSgpOw0KCWZvciAodmFyIGkgPSAwOyBpIDwgNjsgKytpKSB7DQoJCWlmIChpZGF5ID4gbm9fZGF5cykgew0KCQkJcm93LmNsYXNzTmFtZSA9ICJlbXB0eXJvdyI7DQoJCQlyb3cgPSByb3cubmV4dFNpYmxpbmc7DQoJCQljb250aW51ZTsNCgkJfQ0KCQl2YXIgY2VsbCA9IHJvdy5maXJzdENoaWxkOw0KCQlpZiAodGhpcy53ZWVrTnVtYmVycykgew0KCQkJY2VsbC5jbGFzc05hbWUgPSAiZGF5IHduIjsNCgkJCWNlbGwuZmlyc3RDaGlsZC5kYXRhID0gd2Vla19udW1iZXI7DQoJCQljZWxsID0gY2VsbC5uZXh0U2libGluZzsNCgkJfQ0KCQkrK3dlZWtfbnVtYmVyOw0KCQlyb3cuY2xhc3NOYW1lID0gImRheXNyb3ciOw0KCQlmb3IgKHZhciBqID0gMDsgaiA8IDc7ICsraikgew0KCQkJY2VsbC5jbGFzc05hbWUgPSAiZGF5IjsNCgkJCWlmICgoIWkgJiYgaiA8IHdkYXkpIHx8IGlkYXkgPiBub19kYXlzKSB7DQoJCQkJLy8gY2VsbC5jbGFzc05hbWUgPSAiZW1wdHljZWxsIjsNCgkJCQljZWxsLmlubmVySFRNTCA9ICImbmJzcDsiOw0KCQkJCWNlbGwuZGlzYWJsZWQgPSB0cnVlOw0KCQkJCWNlbGwgPSBjZWxsLm5leHRTaWJsaW5nOw0KCQkJCWNvbnRpbnVlOw0KCQkJfQ0KCQkJY2VsbC5kaXNhYmxlZCA9IGZhbHNlOw0KCQkJY2VsbC5maXJzdENoaWxkLmRhdGEgPSBpZGF5Ow0KCQkJaWYgKHR5cGVvZiB0aGlzLmNoZWNrRGlzYWJsZWQgPT0gImZ1bmN0aW9uIikgew0KCQkJCWRhdGUuc2V0RGF0ZShpZGF5KTsNCgkJCQlpZiAodGhpcy5jaGVja0Rpc2FibGVkKGRhdGUpKSB7DQoJCQkJCWNlbGwuY2xhc3NOYW1lICs9ICIgZGlzYWJsZWQiOw0KCQkJCQljZWxsLmRpc2FibGVkID0gdHJ1ZTsNCgkJCQl9DQoJCQl9DQoJCQlpZiAoIWNlbGwuZGlzYWJsZWQpIHsNCgkJCQlhcl9kYXlzW2FyX2RheXMubGVuZ3RoXSA9IGNlbGw7DQoJCQkJY2VsbC5jYWxkYXRlID0gaWRheTsNCgkJCQljZWxsLnR0aXAgPSAiXyI7DQoJCQkJaWYgKGlkYXkgPT0gbWRheSkgew0KCQkJCQljZWxsLmNsYXNzTmFtZSArPSAiIHNlbGVjdGVkIjsNCgkJCQkJdGhpcy5jdXJyZW50RGF0ZUVsID0gY2VsbDsNCgkJCQl9DQoJCQkJaWYgKGhhc1RvZGF5ICYmIChpZGF5ID09IHRvZGF5RGF0ZSkpIHsNCgkJCQkJY2VsbC5jbGFzc05hbWUgKz0gIiB0b2RheSI7DQoJCQkJCWNlbGwudHRpcCArPSBDYWxlbmRhci5fVFRbIlBBUlRfVE9EQVkiXTsNCgkJCQl9DQoJCQkJaWYgKHdkYXkgPT0gU0FUIHx8IHdkYXkgPT0gU1VOKSB7DQoJCQkJCWNlbGwuY2xhc3NOYW1lICs9ICIgd2Vla2VuZCI7DQoJCQkJfQ0KCQkJfQ0KCQkJKytpZGF5Ow0KCQkJKCgrK3dkYXkpIF4gNykgfHwgKHdkYXkgPSAwKTsNCgkJCWNlbGwgPSBjZWxsLm5leHRTaWJsaW5nOw0KCQl9DQoJCXJvdyA9IHJvdy5uZXh0U2libGluZzsNCgl9DQoJdGhpcy5hcl9kYXlzID0gYXJfZGF5czsNCgl0aGlzLnRpdGxlLmZpcnN0Q2hpbGQuZGF0YSA9IENhbGVuZGFyLl9NTlttb250aF0gKyAiLCAiICsgeWVhcjsNCgkvLyBQUk9GSUxFDQoJLy8gdGhpcy50b29sdGlwcy5maXJzdENoaWxkLmRhdGEgPSAiR2VuZXJhdGVkIGluICIgKyAoKG5ldyBEYXRlKCkpIC0gdG9kYXkpICsgIiBtcyI7DQp9Ow0KDQovKioNCiAqICBDYWxscyBfaW5pdCBmdW5jdGlvbiBhYm92ZSBmb3IgZ29pbmcgdG8gYSBjZXJ0YWluIGRhdGUgKGJ1dCBvbmx5IGlmIHRoZQ0KICogIGRhdGUgaXMgZGlmZmVyZW50IHRoYW4gdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBvbmUpLg0KICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7DQoJaWYgKCFkYXRlLmVxdWFsc1RvKHRoaXMuZGF0ZSkpIHsNCgkJdGhpcy5faW5pdCh0aGlzLm1vbmRheUZpcnN0LCBkYXRlKTsNCgl9DQp9Ow0KDQovKiogTW9kaWZpZXMgdGhlICJtb25kYXlGaXJzdCIgcGFyYW1ldGVyIChFVS9VUyBzdHlsZSkuICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0TW9uZGF5Rmlyc3QgPSBmdW5jdGlvbiAobW9uZGF5Rmlyc3QpIHsNCgl0aGlzLl9pbml0KG1vbmRheUZpcnN0LCB0aGlzLmRhdGUpOw0KCXRoaXMuX2Rpc3BsYXlXZWVrZGF5cygpOw0KfTsNCg0KLyoqDQogKiAgQWxsb3dzIGN1c3RvbWl6YXRpb24gb2Ygd2hhdCBkYXRlcyBhcmUgZW5hYmxlZC4gIFRoZSAidW5hcnlGdW5jdGlvbiINCiAqICBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uIG9iamVjdCB0aGF0IHJlY2VpdmVzIHRoZSBkYXRlIChhcyBhIEpTIERhdGUNCiAqICBvYmplY3QpIGFuZCByZXR1cm5zIGEgYm9vbGVhbiB2YWx1ZS4gIElmIHRoZSByZXR1cm5lZCB2YWx1ZSBpcyB0cnVlIHRoZW4NCiAqICB0aGUgcGFzc2VkIGRhdGUgd2lsbCBiZSBtYXJrZWQgYXMgZGlzYWJsZWQuDQogKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zZXREaXNhYmxlZEhhbmRsZXIgPSBmdW5jdGlvbiAodW5hcnlGdW5jdGlvbikgew0KCXRoaXMuY2hlY2tEaXNhYmxlZCA9IHVuYXJ5RnVuY3Rpb247DQp9Ow0KDQovKiogQ3VzdG9taXphdGlvbiBvZiBhbGxvd2VkIHllYXIgcmFuZ2UgZm9yIHRoZSBjYWxlbmRhci4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zZXRSYW5nZSA9IGZ1bmN0aW9uIChhLCB6KSB7DQoJdGhpcy5taW5ZZWFyID0gYTsNCgl0aGlzLm1heFllYXIgPSB6Ow0KfTsNCg0KLyoqIENhbGxzIHRoZSBmaXJzdCB1c2VyIGhhbmRsZXIgKHNlbGVjdGVkSGFuZGxlcikuICovDQpDYWxlbmRhci5wcm90b3R5cGUuY2FsbEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7DQoJaWYgKHRoaXMub25TZWxlY3RlZCkgew0KCQl0aGlzLm9uU2VsZWN0ZWQodGhpcywgdGhpcy5kYXRlLnByaW50KHRoaXMuZGF0ZUZvcm1hdCkpOw0KCX0NCn07DQoNCi8qKiBDYWxscyB0aGUgc2Vjb25kIHVzZXIgaGFuZGxlciAoY2xvc2VIYW5kbGVyKS4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5jYWxsQ2xvc2VIYW5kbGVyID0gZnVuY3Rpb24gKCkgew0KCWlmICh0aGlzLm9uQ2xvc2UpIHsNCgkJdGhpcy5vbkNsb3NlKHRoaXMpOw0KCX0NCgl0aGlzLmhpZGVTaG93Q292ZXJlZCgpOw0KfTsNCg0KLyoqIFJlbW92ZXMgdGhlIGNhbGVuZGFyIG9iamVjdCBmcm9tIHRoZSBET00gdHJlZSBhbmQgZGVzdHJveXMgaXQuICovDQpDYWxlbmRhci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsNCgl2YXIgZWwgPSB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZTsNCgllbC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpOw0KCUNhbGVuZGFyLl9DID0gbnVsbDsNCglkZWxldGUgZWw7DQp9Ow0KDQovKioNCiAqICBNb3ZlcyB0aGUgY2FsZW5kYXIgZWxlbWVudCB0byBhIGRpZmZlcmVudCBzZWN0aW9uIGluIHRoZSBET00gdHJlZSAoY2hhbmdlcw0KICogIGl0cyBwYXJlbnQpLg0KICovDQpDYWxlbmRhci5wcm90b3R5cGUucmVwYXJlbnQgPSBmdW5jdGlvbiAobmV3X3BhcmVudCkgew0KCXZhciBlbCA9IHRoaXMuZWxlbWVudDsNCgllbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTsNCgluZXdfcGFyZW50LmFwcGVuZENoaWxkKGVsKTsNCn07DQoNCi8vIFRoaXMgZ2V0cyBjYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIGEgbW91c2UgYnV0dG9uIGFueXdoZXJlIGluIHRoZQ0KLy8gZG9jdW1lbnQsIGlmIHRoZSBjYWxlbmRhciBpcyBzaG93bi4gIElmIHRoZSBjbGljayB3YXMgb3V0c2lkZSB0aGUgb3Blbg0KLy8gY2FsZW5kYXIgdGhpcyBmdW5jdGlvbiBjbG9zZXMgaXQuDQpDYWxlbmRhci5fY2hlY2tDYWxlbmRhciA9IGZ1bmN0aW9uKGV2KSB7DQoJaWYgKCF3aW5kb3cuY2FsZW5kYXIpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgZWwgPSBDYWxlbmRhci5pc19pZSA\/IENhbGVuZGFyLmdldEVsZW1lbnQoZXYpIDogQ2FsZW5kYXIuZ2V0VGFyZ2V0RWxlbWVudChldik7DQoJZm9yICg7IGVsICE9IG51bGwgJiYgZWwgIT0gY2FsZW5kYXIuZWxlbWVudDsgZWwgPSBlbC5wYXJlbnROb2RlKTsNCglpZiAoZWwgPT0gbnVsbCkgew0KCQkvLyBjYWxscyBjbG9zZUhhbmRsZXIgd2hpY2ggc2hvdWxkIGhpZGUgdGhlIGNhbGVuZGFyLg0KCQl3aW5kb3cuY2FsZW5kYXIuY2FsbENsb3NlSGFuZGxlcigpOw0KCQlDYWxlbmRhci5zdG9wRXZlbnQoZXYpOw0KCX0NCn07DQoNCi8qKiBTaG93cyB0aGUgY2FsZW5kYXIuICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHsNCgl2YXIgcm93cyA9IHRoaXMudGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRyIik7DQoJZm9yICh2YXIgaSA9IHJvd3MubGVuZ3RoOyBpID4gMDspIHsNCgkJdmFyIHJvdyA9IHJvd3NbLS1pXTsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3Mocm93LCAicm93aGlsaXRlIik7DQoJCXZhciBjZWxscyA9IHJvdy5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGQiKTsNCgkJZm9yICh2YXIgaiA9IGNlbGxzLmxlbmd0aDsgaiA+IDA7KSB7DQoJCQl2YXIgY2VsbCA9IGNlbGxzWy0tal07DQoJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjZWxsLCAiaGlsaXRlIik7DQoJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjZWxsLCAiYWN0aXZlIik7DQoJCX0NCgl9DQoJdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCXRoaXMuaGlkZGVuID0gZmFsc2U7DQoJaWYgKHRoaXMuaXNQb3B1cCkgew0KCQl3aW5kb3cuY2FsZW5kYXIgPSB0aGlzOw0KCQlDYWxlbmRhci5hZGRFdmVudChkb2N1bWVudCwgImtleWRvd24iLCBDYWxlbmRhci5fa2V5RXZlbnQpOw0KCQlDYWxlbmRhci5hZGRFdmVudChkb2N1bWVudCwgImtleXByZXNzIiwgQ2FsZW5kYXIuX2tleUV2ZW50KTsNCgkJQ2FsZW5kYXIuYWRkRXZlbnQoZG9jdW1lbnQsICJtb3VzZWRvd24iLCBDYWxlbmRhci5fY2hlY2tDYWxlbmRhcik7DQoJfQ0KCXRoaXMuaGlkZVNob3dDb3ZlcmVkKCk7DQp9Ow0KDQovKioNCiAqICBIaWRlcyB0aGUgY2FsZW5kYXIuICBBbHNvIHJlbW92ZXMgYW55ICJoaWxpdGUiIGZyb20gdGhlIGNsYXNzIG9mIGFueSBURA0KICogIGVsZW1lbnQuDQogKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgew0KCWlmICh0aGlzLmlzUG9wdXApIHsNCgkJQ2FsZW5kYXIucmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJrZXlkb3duIiwgQ2FsZW5kYXIuX2tleUV2ZW50KTsNCgkJQ2FsZW5kYXIucmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJrZXlwcmVzcyIsIENhbGVuZGFyLl9rZXlFdmVudCk7DQoJCUNhbGVuZGFyLnJlbW92ZUV2ZW50KGRvY3VtZW50LCAibW91c2Vkb3duIiwgQ2FsZW5kYXIuX2NoZWNrQ2FsZW5kYXIpOw0KCX0NCgl0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgl0aGlzLmhpZGRlbiA9IHRydWU7DQoJdGhpcy5oaWRlU2hvd0NvdmVyZWQoKTsNCn07DQoNCi8qKg0KICogIFNob3dzIHRoZSBjYWxlbmRhciBhdCBhIGdpdmVuIGFic29sdXRlIHBvc2l0aW9uIChiZXdhcmUgdGhhdCwgZGVwZW5kaW5nIG9uDQogKiAgdGhlIGNhbGVuZGFyIGVsZW1lbnQgc3R5bGUgLS0gcG9zaXRpb24gcHJvcGVydHkgLS0gdGhpcyBtaWdodCBiZSByZWxhdGl2ZQ0KICogIHRvIHRoZSBwYXJlbnQncyBjb250YWluaW5nIHJlY3RhbmdsZSkuDQogKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zaG93QXQgPSBmdW5jdGlvbiAoeCwgeSkgew0KCXZhciBzID0gdGhpcy5lbGVtZW50LnN0eWxlOw0KCXMubGVmdCA9IHggKyAicHgiOw0KCXMudG9wID0geSArICJweCI7DQoJdGhpcy5zaG93KCk7DQp9Ow0KDQovKiogU2hvd3MgdGhlIGNhbGVuZGFyIG5lYXIgYSBnaXZlbiBlbGVtZW50LiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnNob3dBdEVsZW1lbnQgPSBmdW5jdGlvbiAoZWwpIHsNCgl2YXIgcCA9IENhbGVuZGFyLmdldEFic29sdXRlUG9zKGVsKTsNCgl0aGlzLnNob3dBdChwLngsIHAueSArIGVsLm9mZnNldEhlaWdodCk7DQp9Ow0KDQovKiogQ3VzdG9taXplcyB0aGUgZGF0ZSBmb3JtYXQuICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0RGF0ZUZvcm1hdCA9IGZ1bmN0aW9uIChzdHIpIHsNCgl0aGlzLmRhdGVGb3JtYXQgPSBzdHI7DQp9Ow0KDQovKiogQ3VzdG9taXplcyB0aGUgdG9vbHRpcCBkYXRlIGZvcm1hdC4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zZXRUdERhdGVGb3JtYXQgPSBmdW5jdGlvbiAoc3RyKSB7DQoJdGhpcy50dERhdGVGb3JtYXQgPSBzdHI7DQp9Ow0KDQovKioNCiAqICBUcmllcyB0byBpZGVudGlmeSB0aGUgZGF0ZSByZXByZXNlbnRlZCBpbiBhIHN0cmluZy4gIElmIHN1Y2Nlc3NmdWwgaXQgYWxzbw0KICogIGNhbGxzIHRoaXMuc2V0RGF0ZSB3aGljaCBtb3ZlcyB0aGUgY2FsZW5kYXIgdG8gdGhlIGdpdmVuIGRhdGUuDQogKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5wYXJzZURhdGUgPSBmdW5jdGlvbiAoc3RyLCBmbXQpIHsNCgl2YXIgeSA9IDA7DQoJdmFyIG0gPSAtMTsNCgl2YXIgZCA9IDA7DQoJdmFyIGEgPSBzdHIuc3BsaXQoL1xXKy8pOw0KCWlmICghZm10KSB7DQoJCWZtdCA9IHRoaXMuZGF0ZUZvcm1hdDsNCgl9DQoJdmFyIGIgPSBmbXQuc3BsaXQoL1xXKy8pOw0KCXZhciBpID0gMCwgaiA9IDA7DQoJZm9yIChpID0gMDsgaSA8IGEubGVuZ3RoOyArK2kpIHsNCgkJaWYgKGJbaV0gPT0gIkQiIHx8IGJbaV0gPT0gIkREIikgew0KCQkJY29udGludWU7DQoJCX0NCgkJaWYgKGJbaV0gPT0gImQiIHx8IGJbaV0gPT0gImRkIikgew0KCQkJZCA9IHBhcnNlSW50KGFbaV0sIDEwKTsNCgkJfQ0KCQlpZiAoYltpXSA9PSAibSIgfHwgYltpXSA9PSAibW0iKSB7DQoJCQltID0gcGFyc2VJbnQoYVtpXSwgMTApIC0gMTsNCgkJfQ0KCQlpZiAoYltpXSA9PSAieSIpIHsNCgkJCXkgPSBwYXJzZUludChhW2ldLCAxMCk7DQoJCX0NCgkJaWYgKGJbaV0gPT0gInl5Iikgew0KCQkJeSA9IHBhcnNlSW50KGFbaV0sIDEwKSArIDE5MDA7DQoJCX0NCgkJaWYgKGJbaV0gPT0gIk0iIHx8IGJbaV0gPT0gIk1NIikgew0KCQkJZm9yIChqID0gMDsgaiA8IDEyOyArK2opIHsNCgkJCQlpZiAoQ2FsZW5kYXIuX01OW2pdLnN1YnN0cigwLCBhW2ldLmxlbmd0aCkudG9Mb3dlckNhc2UoKSA9PSBhW2ldLnRvTG93ZXJDYXNlKCkpIHsgbSA9IGo7IGJyZWFrOyB9DQoJCQl9DQoJCX0NCgl9DQoJaWYgKHkgIT0gMCAmJiBtICE9IC0xICYmIGQgIT0gMCkgew0KCQl0aGlzLnNldERhdGUobmV3IERhdGUoeSwgbSwgZCkpOw0KCQlyZXR1cm47DQoJfQ0KCXkgPSAwOyBtID0gLTE7IGQgPSAwOw0KCWZvciAoaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKSB7DQoJCWlmIChhW2ldLnNlYXJjaCgvW2EtekEtWl0rLykgIT0gLTEpIHsNCgkJCXZhciB0ID0gLTE7DQoJCQlmb3IgKGogPSAwOyBqIDwgMTI7ICsraikgew0KCQkJCWlmIChDYWxlbmRhci5fTU5bal0uc3Vic3RyKDAsIGFbaV0ubGVuZ3RoKS50b0xvd2VyQ2FzZSgpID09IGFbaV0udG9Mb3dlckNhc2UoKSkgeyB0ID0gajsgYnJlYWs7IH0NCgkJCX0NCgkJCWlmICh0ICE9IC0xKSB7DQoJCQkJaWYgKG0gIT0gLTEpIHsNCgkJCQkJZCA9IG0rMTsNCgkJCQl9DQoJCQkJbSA9IHQ7DQoJCQl9DQoJCX0gZWxzZSBpZiAocGFyc2VJbnQoYVtpXSwgMTApIDw9IDEyICYmIG0gPT0gLTEpIHsNCgkJCW0gPSBhW2ldLTE7DQoJCX0gZWxzZSBpZiAocGFyc2VJbnQoYVtpXSwgMTApID4gMzEgJiYgeSA9PSAwKSB7DQoJCQl5ID0gYVtpXTsNCgkJfSBlbHNlIGlmIChkID09IDApIHsNCgkJCWQgPSBhW2ldOw0KCQl9DQoJfQ0KCWlmICh5ID09IDApIHsNCgkJdmFyIHRvZGF5ID0gbmV3IERhdGUoKTsNCgkJeSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7DQoJfQ0KCWlmIChtICE9IC0xICYmIGQgIT0gMCkgew0KCQl0aGlzLnNldERhdGUobmV3IERhdGUoeSwgbSwgZCkpOw0KCX0NCn07DQoNCkNhbGVuZGFyLnByb3RvdHlwZS5oaWRlU2hvd0NvdmVyZWQgPSBmdW5jdGlvbiAoKSB7DQoJdmFyIHRhZ3MgPSBuZXcgQXJyYXkoImFwcGxldCIsICJpZnJhbWUiLCAic2VsZWN0Iik7DQoJdmFyIGVsID0gdGhpcy5lbGVtZW50Ow0KDQoJdmFyIHAgPSBDYWxlbmRhci5nZXRBYnNvbHV0ZVBvcyhlbCk7DQoJdmFyIEVYMSA9IHAueDsNCgl2YXIgRVgyID0gZWwub2Zmc2V0V2lkdGggKyBFWDE7DQoJdmFyIEVZMSA9IHAueTsNCgl2YXIgRVkyID0gZWwub2Zmc2V0SGVpZ2h0ICsgRVkxOw0KDQoJZm9yICh2YXIgayA9IHRhZ3MubGVuZ3RoOyBrID4gMDsgKSB7DQoJCXZhciBhciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ3NbLS1rXSk7DQoJCXZhciBjYyA9IG51bGw7DQoNCgkJZm9yICh2YXIgaSA9IGFyLmxlbmd0aDsgaSA+IDA7KSB7DQoJCQljYyA9IGFyWy0taV07DQoNCgkJCXAgPSBDYWxlbmRhci5nZXRBYnNvbHV0ZVBvcyhjYyk7DQoJCQl2YXIgQ1gxID0gcC54Ow0KCQkJdmFyIENYMiA9IGNjLm9mZnNldFdpZHRoICsgQ1gxOw0KCQkJdmFyIENZMSA9IHAueTsNCgkJCXZhciBDWTIgPSBjYy5vZmZzZXRIZWlnaHQgKyBDWTE7DQoNCgkJCWlmICh0aGlzLmhpZGRlbiB8fCAoQ1gxID4gRVgyKSB8fCAoQ1gyIDwgRVgxKSB8fCAoQ1kxID4gRVkyKSB8fCAoQ1kyIDwgRVkxKSkgew0KCQkJCWNjLnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7DQoJCQl9IGVsc2Ugew0KCQkJCWNjLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsNCgkJCX0NCgkJfQ0KCX0NCn07DQoNCi8qKiBJbnRlcm5hbCBmdW5jdGlvbjsgaXQgZGlzcGxheXMgdGhlIGJhciB3aXRoIHRoZSBuYW1lcyBvZiB0aGUgd2Vla2RheS4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5fZGlzcGxheVdlZWtkYXlzID0gZnVuY3Rpb24gKCkgew0KCXZhciBNT04gPSB0aGlzLm1vbmRheUZpcnN0ID8gMCA6IDE7DQoJdmFyIFNVTiA9IHRoaXMubW9uZGF5Rmlyc3QgPyA2IDogMDsNCgl2YXIgU0FUID0gdGhpcy5tb25kYXlGaXJzdCA\/IDUgOiA2Ow0KCXZhciBjZWxsID0gdGhpcy5maXJzdGRheW5hbWU7DQoJZm9yICh2YXIgaSA9IDA7IGkgPCA3OyArK2kpIHsNCgkJY2VsbC5jbGFzc05hbWUgPSAiZGF5IG5hbWUiOw0KCQlpZiAoIWkpIHsNCgkJCWNlbGwudHRpcCA9IHRoaXMubW9uZGF5Rmlyc3QgPyBDYWxlbmRhci5fVFRbIlNVTl9GSVJTVCJdIDogQ2FsZW5kYXIuX1RUWyJNT05fRklSU1QiXTsNCgkJCWNlbGwubmF2dHlwZSA9IDEwMDsNCgkJCWNlbGwuY2FsZW5kYXIgPSB0aGlzOw0KCQkJQ2FsZW5kYXIuX2FkZF9ldnMoY2VsbCk7DQoJCX0NCgkJaWYgKGkgPT0gU1VOIHx8IGkgPT0gU0FUKSB7DQoJCQlDYWxlbmRhci5hZGRDbGFzcyhjZWxsLCAid2Vla2VuZCIpOw0KCQl9DQoJCWNlbGwuZmlyc3RDaGlsZC5kYXRhID0gQ2FsZW5kYXIuX0ROM1tpICsgMSAtIE1PTl07DQoJCWNlbGwgPSBjZWxsLm5leHRTaWJsaW5nOw0KCX0NCn07DQoNCi8qKiBJbnRlcm5hbCBmdW5jdGlvbi4gIEhpZGVzIGFsbCBjb21ibyBib3hlcyB0aGF0IG1pZ2h0IGJlIGRpc3BsYXllZC4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5faGlkZUNvbWJvcyA9IGZ1bmN0aW9uICgpIHsNCgl0aGlzLm1vbnRoc0NvbWJvLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJdGhpcy55ZWFyc0NvbWJvLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQp9Ow0KDQovKiogSW50ZXJuYWwgZnVuY3Rpb24uICBTdGFydHMgZHJhZ2dpbmcgdGhlIGVsZW1lbnQuICovDQpDYWxlbmRhci5wcm90b3R5cGUuX2RyYWdTdGFydCA9IGZ1bmN0aW9uIChldikgew0KCWlmICh0aGlzLmRyYWdnaW5nKSB7DQoJCXJldHVybjsNCgl9DQoJdGhpcy5kcmFnZ2luZyA9IHRydWU7DQoJdmFyIHBvc1g7DQoJdmFyIHBvc1k7DQoJaWYgKENhbGVuZGFyLmlzX2llKSB7DQoJCXBvc1kgPSB3aW5kb3cuZXZlbnQuY2xpZW50WSArIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOw0KCQlwb3NYID0gd2luZG93LmV2ZW50LmNsaWVudFggKyBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQ7DQoJfSBlbHNlIHsNCgkJcG9zWSA9IGV2LmNsaWVudFkgKyB3aW5kb3cuc2Nyb2xsWTsNCgkJcG9zWCA9IGV2LmNsaWVudFggKyB3aW5kb3cuc2Nyb2xsWDsNCgl9DQoJdmFyIHN0ID0gdGhpcy5lbGVtZW50LnN0eWxlOw0KCXRoaXMueE9mZnMgPSBwb3NYIC0gcGFyc2VJbnQoc3QubGVmdCk7DQoJdGhpcy55T2ZmcyA9IHBvc1kgLSBwYXJzZUludChzdC50b3ApOw0KCXdpdGggKENhbGVuZGFyKSB7DQoJCWFkZEV2ZW50KGRvY3VtZW50LCAibW91c2Vtb3ZlIiwgY2FsRHJhZ0l0KTsNCgkJYWRkRXZlbnQoZG9jdW1lbnQsICJtb3VzZW92ZXIiLCBzdG9wRXZlbnQpOw0KCQlhZGRFdmVudChkb2N1bWVudCwgIm1vdXNldXAiLCBjYWxEcmFnRW5kKTsNCgl9DQp9Ow0KDQovLyBCRUdJTjogREFURSBPQkpFQ1QgUEFUQ0hFUw0KDQovKiogQWRkcyB0aGUgbnVtYmVyIG9mIGRheXMgYXJyYXkgdG8gdGhlIERhdGUgb2JqZWN0LiAqLw0KRGF0ZS5fTUQgPSBuZXcgQXJyYXkoMzEsMjgsMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzEpOw0KDQovKiogQ29uc3RhbnRzIHVzZWQgZm9yIHRpbWUgY29tcHV0YXRpb25zICovDQpEYXRlLlNFQ09ORCA9IDEwMDAgLyogbWlsbGlzZWNvbmRzICovOw0KRGF0ZS5NSU5VVEUgPSA2MCAqIERhdGUuU0VDT05EOw0KRGF0ZS5IT1VSICAgPSA2MCAqIERhdGUuTUlOVVRFOw0KRGF0ZS5EQVkgICAgPSAyNCAqIERhdGUuSE9VUjsNCkRhdGUuV0VFSyAgID0gIDcgKiBEYXRlLkRBWTsNCg0KLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiBkYXlzIGluIHRoZSBjdXJyZW50IG1vbnRoICovDQpEYXRlLnByb3RvdHlwZS5nZXRNb250aERheXMgPSBmdW5jdGlvbihtb250aCkgew0KCXZhciB5ZWFyID0gdGhpcy5nZXRGdWxsWWVhcigpOw0KCWlmICh0eXBlb2YgbW9udGggPT0gInVuZGVmaW5lZCIpIHsNCgkJbW9udGggPSB0aGlzLmdldE1vbnRoKCk7DQoJfQ0KCWlmICgoKDAgPT0gKHllYXIlNCkpICYmICggKDAgIT0gKHllYXIlMTAwKSkgfHwgKDAgPT0gKHllYXIlNDAwKSkpKSAmJiBtb250aCA9PSAxKSB7DQoJCXJldHVybiAyOTsNCgl9IGVsc2Ugew0KCQlyZXR1cm4gRGF0ZS5fTURbbW9udGhdOw0KCX0NCn07DQoNCi8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGhlIHdlZWsuICBUaGUgYWxnb3JpdGhtIHdhcyAic3RvbGVuIiBmcm9tIFBQSydzDQogKiB3ZWJzaXRlLCBob3BlIGl0J3MgY29ycmVjdCA6KSBodHRwOi8vd3d3LnhzNGFsbC5ubC9+cHBrL2pzL3dlZWsuaHRtbCAqLw0KRGF0ZS5wcm90b3R5cGUuZ2V0V2Vla051bWJlciA9IGZ1bmN0aW9uKCkgew0KCXZhciBub3cgPSBuZXcgRGF0ZSh0aGlzLmdldEZ1bGxZZWFyKCksIHRoaXMuZ2V0TW9udGgoKSwgdGhpcy5nZXREYXRlKCksIDAsIDAsIDApOw0KCXZhciB0aGVuID0gbmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLCAwLCAxLCAwLCAwLCAwKTsNCgl2YXIgdGltZSA9IG5vdyAtIHRoZW47DQoJdmFyIGRheSA9IHRoZW4uZ2V0RGF5KCk7DQoJKGRheSA+IDMpICYmIChkYXkgLT0gNCkgfHwgKGRheSArPSAzKTsNCglyZXR1cm4gTWF0aC5yb3VuZCgoKHRpbWUgLyBEYXRlLkRBWSkgKyBkYXkpIC8gNyk7DQp9Ow0KDQovKiogQ2hlY2tzIGRhdGVzIGVxdWFsaXR5IChpZ25vcmVzIHRpbWUpICovDQpEYXRlLnByb3RvdHlwZS5lcXVhbHNUbyA9IGZ1bmN0aW9uKGRhdGUpIHsNCglyZXR1cm4gKCh0aGlzLmdldEZ1bGxZZWFyKCkgPT0gZGF0ZS5nZXRGdWxsWWVhcigpKSAmJg0KCQkodGhpcy5nZXRNb250aCgpID09IGRhdGUuZ2V0TW9udGgoKSkgJiYNCgkJKHRoaXMuZ2V0RGF0ZSgpID09IGRhdGUuZ2V0RGF0ZSgpKSk7DQp9Ow0KDQovKiogUHJpbnRzIHRoZSBkYXRlIGluIGEgc3RyaW5nIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gZm9ybWF0LiAqLw0KRGF0ZS5wcm90b3R5cGUucHJpbnQgPSBmdW5jdGlvbiAoZnJtKSB7DQoJdmFyIHN0ciA9IG5ldyBTdHJpbmcoZnJtKTsNCgl2YXIgbSA9IHRoaXMuZ2V0TW9udGgoKTsNCgl2YXIgZCA9IHRoaXMuZ2V0RGF0ZSgpOw0KCXZhciB5ID0gdGhpcy5nZXRGdWxsWWVhcigpOw0KCXZhciB3biA9IHRoaXMuZ2V0V2Vla051bWJlcigpOw0KCXZhciB3ID0gdGhpcy5nZXREYXkoKTsNCgl2YXIgcyA9IG5ldyBBcnJheSgpOw0KCXNbImQiXSA9IGQ7DQoJc1siZGQiXSA9IChkIDwgMTApID8gKCIwIiArIGQpIDogZDsNCglzWyJtIl0gPSAxK207DQoJc1sibW0iXSA9IChtIDwgOSkgPyAoIjAiICsgKDErbSkpIDogKDErbSk7DQoJc1sieSJdID0geTsNCglzWyJ5eSJdID0gbmV3IFN0cmluZyh5KS5zdWJzdHIoMiwgMik7DQoJc1sidyJdID0gd247DQoJc1sid3ciXSA9ICh3biA8IDEwKSA\/ICgiMCIgKyB3bikgOiB3bjsNCgl3aXRoIChDYWxlbmRhcikgew0KCQlzWyJEIl0gPSBfRE4zW3ddOw0KCQlzWyJERCJdID0gX0ROW3ddOw0KCQlzWyJNIl0gPSBfTU4zW21dOw0KCQlzWyJNTSJdID0gX01OW21dOw0KCX0NCgl2YXIgcmUgPSAvKC4qKShcV3xeKShkfGRkfG18bW18eXx5eXxNTXxNfEREfER8d3x3dykoXFd8JCkoLiopLzsNCgl3aGlsZSAocmUuZXhlYyhzdHIpICE9IG51bGwpIHsNCgkJc3RyID0gUmVnRXhwLiQxICsgUmVnRXhwLiQyICsgc1tSZWdFeHAuJDNdICsgUmVnRXhwLiQ0ICsgUmVnRXhwLiQ1Ow0KCX0NCglyZXR1cm4gc3RyOw0KfTsNCg0KLy8gRU5EOiBEQVRFIE9CSkVDVCBQQVRDSEVTDQoNCi8vIGdsb2JhbCBvYmplY3QgdGhhdCByZW1lbWJlcnMgdGhlIGNhbGVuZGFyDQp3aW5kb3cuY2FsZW5kYXIgPSBudWxsOw0K",
    "size": "34794"
}