{
    "namaFile": "vendor\/bootstrap\/js\/bootstrap.js",
    "lastUpdate": "2017-10-25+18:26:16.96",
    "contentFile": "LyohCiAqIEJvb3RzdHJhcCB2NC4wLjAtYmV0YSAoaHR0cHM6Ly9nZXRib290c3RyYXAuY29tKQogKiBDb3B5cmlnaHQgMjAxMS0yMDE3IFRoZSBCb290c3RyYXAgQXV0aG9ycyAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2dyYXBocy9jb250cmlidXRvcnMpCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqLwoKaWYgKHR5cGVvZiBqUXVlcnkgPT09ICd1bmRlZmluZWQnKSB7CiAgdGhyb3cgbmV3IEVycm9yKCdCb290c3RyYXBcJ3MgSmF2YVNjcmlwdCByZXF1aXJlcyBqUXVlcnkuIGpRdWVyeSBtdXN0IGJlIGluY2x1ZGVkIGJlZm9yZSBCb290c3RyYXBcJ3MgSmF2YVNjcmlwdC4nKQp9CgooZnVuY3Rpb24gKCQpIHsKICB2YXIgdmVyc2lvbiA9ICQuZm4uanF1ZXJ5LnNwbGl0KCcgJylbMF0uc3BsaXQoJy4nKQogIGlmICgodmVyc2lvblswXSA8IDIgJiYgdmVyc2lvblsxXSA8IDkpIHx8ICh2ZXJzaW9uWzBdID09IDEgJiYgdmVyc2lvblsxXSA9PSA5ICYmIHZlcnNpb25bMl0gPCAxKSB8fCAodmVyc2lvblswXSA+PSA0KSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdCb290c3RyYXBcJ3MgSmF2YVNjcmlwdCByZXF1aXJlcyBhdCBsZWFzdCBqUXVlcnkgdjEuOS4xIGJ1dCBsZXNzIHRoYW4gdjQuMC4wJykKICB9Cn0pKGpRdWVyeSk7CgooZnVuY3Rpb24gKCkgewp2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpID8gY2FsbCA6IHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA\/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCi8qKgogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiBCb290c3RyYXAgKHY0LjAuMC1iZXRhKTogdXRpbC5qcwogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKi8KCnZhciBVdGlsID0gZnVuY3Rpb24gKCQpIHsKCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICogUHJpdmF0ZSBUcmFuc2l0aW9uRW5kIEhlbHBlcnMKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgdmFyIHRyYW5zaXRpb24gPSBmYWxzZTsKCiAgdmFyIE1BWF9VSUQgPSAxMDAwMDAwOwoKICB2YXIgVHJhbnNpdGlvbkVuZEV2ZW50ID0gewogICAgV2Via2l0VHJhbnNpdGlvbjogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLAogICAgTW96VHJhbnNpdGlvbjogJ3RyYW5zaXRpb25lbmQnLAogICAgT1RyYW5zaXRpb246ICdvVHJhbnNpdGlvbkVuZCBvdHJhbnNpdGlvbmVuZCcsCiAgICB0cmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcKCiAgICAvLyBzaG91dG91dCBBbmd1c0Nyb2xsIChodHRwczovL2dvby5nbC9weHdRR3ApCiAgfTtmdW5jdGlvbiB0b1R5cGUob2JqKSB7CiAgICByZXR1cm4ge30udG9TdHJpbmcuY2FsbChvYmopLm1hdGNoKC9ccyhbYS16QS1aXSspLylbMV0udG9Mb3dlckNhc2UoKTsKICB9CgogIGZ1bmN0aW9uIGlzRWxlbWVudChvYmopIHsKICAgIHJldHVybiAob2JqWzBdIHx8IG9iaikubm9kZVR5cGU7CiAgfQoKICBmdW5jdGlvbiBnZXRTcGVjaWFsVHJhbnNpdGlvbkVuZEV2ZW50KCkgewogICAgcmV0dXJuIHsKICAgICAgYmluZFR5cGU6IHRyYW5zaXRpb24uZW5kLAogICAgICBkZWxlZ2F0ZVR5cGU6IHRyYW5zaXRpb24uZW5kLAogICAgICBoYW5kbGU6IGZ1bmN0aW9uIGhhbmRsZShldmVudCkgewogICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuaXModGhpcykpIHsKICAgICAgICAgIHJldHVybiBldmVudC5oYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByZWZlci1yZXN0LXBhcmFtcwogICAgICAgIH0KICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gdHJhbnNpdGlvbkVuZFRlc3QoKSB7CiAgICBpZiAod2luZG93LlFVbml0KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdib290c3RyYXAnKTsKCiAgICBmb3IgKHZhciBuYW1lIGluIFRyYW5zaXRpb25FbmRFdmVudCkgewogICAgICBpZiAoZWwuc3R5bGVbbmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBlbmQ6IFRyYW5zaXRpb25FbmRFdmVudFtuYW1lXQogICAgICAgIH07CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2l0aW9uRW5kRW11bGF0b3IoZHVyYXRpb24pIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdmFyIGNhbGxlZCA9IGZhbHNlOwoKICAgICQodGhpcykub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIGZ1bmN0aW9uICgpIHsKICAgICAgY2FsbGVkID0gdHJ1ZTsKICAgIH0pOwoKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBpZiAoIWNhbGxlZCkgewogICAgICAgIFV0aWwudHJpZ2dlclRyYW5zaXRpb25FbmQoX3RoaXMpOwogICAgICB9CiAgICB9LCBkdXJhdGlvbik7CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBzZXRUcmFuc2l0aW9uRW5kU3VwcG9ydCgpIHsKICAgIHRyYW5zaXRpb24gPSB0cmFuc2l0aW9uRW5kVGVzdCgpOwoKICAgICQuZm4uZW11bGF0ZVRyYW5zaXRpb25FbmQgPSB0cmFuc2l0aW9uRW5kRW11bGF0b3I7CgogICAgaWYgKFV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkpIHsKICAgICAgJC5ldmVudC5zcGVjaWFsW1V0aWwuVFJBTlNJVElPTl9FTkRdID0gZ2V0U3BlY2lhbFRyYW5zaXRpb25FbmRFdmVudCgpOwogICAgfQogIH0KCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBQdWJsaWMgVXRpbCBBcGkKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICB2YXIgVXRpbCA9IHsKCiAgICBUUkFOU0lUSU9OX0VORDogJ2JzVHJhbnNpdGlvbkVuZCcsCgogICAgZ2V0VUlEOiBmdW5jdGlvbiBnZXRVSUQocHJlZml4KSB7CiAgICAgIGRvIHsKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYml0d2lzZQogICAgICAgIHByZWZpeCArPSB+fihNYXRoLnJhbmRvbSgpICogTUFYX1VJRCk7IC8vICJ+fiIgYWN0cyBsaWtlIGEgZmFzdGVyIE1hdGguZmxvb3IoKSBoZXJlCiAgICAgIH0gd2hpbGUgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByZWZpeCkpOwogICAgICByZXR1cm4gcHJlZml4OwogICAgfSwKICAgIGdldFNlbGVjdG9yRnJvbUVsZW1lbnQ6IGZ1bmN0aW9uIGdldFNlbGVjdG9yRnJvbUVsZW1lbnQoZWxlbWVudCkgewogICAgICB2YXIgc2VsZWN0b3IgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQnKTsKICAgICAgaWYgKCFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gJyMnKSB7CiAgICAgICAgc2VsZWN0b3IgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnaHJlZicpIHx8ICcnOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIHZhciAkc2VsZWN0b3IgPSAkKHNlbGVjdG9yKTsKICAgICAgICByZXR1cm4gJHNlbGVjdG9yLmxlbmd0aCA+IDAgPyBzZWxlY3RvciA6IG51bGw7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0sCiAgICByZWZsb3c6IGZ1bmN0aW9uIHJlZmxvdyhlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50Lm9mZnNldEhlaWdodDsKICAgIH0sCiAgICB0cmlnZ2VyVHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gdHJpZ2dlclRyYW5zaXRpb25FbmQoZWxlbWVudCkgewogICAgICAkKGVsZW1lbnQpLnRyaWdnZXIodHJhbnNpdGlvbi5lbmQpOwogICAgfSwKICAgIHN1cHBvcnRzVHJhbnNpdGlvbkVuZDogZnVuY3Rpb24gc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgewogICAgICByZXR1cm4gQm9vbGVhbih0cmFuc2l0aW9uKTsKICAgIH0sCiAgICB0eXBlQ2hlY2tDb25maWc6IGZ1bmN0aW9uIHR5cGVDaGVja0NvbmZpZyhjb21wb25lbnROYW1lLCBjb25maWcsIGNvbmZpZ1R5cGVzKSB7CiAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIGNvbmZpZ1R5cGVzKSB7CiAgICAgICAgaWYgKGNvbmZpZ1R5cGVzLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkgewogICAgICAgICAgdmFyIGV4cGVjdGVkVHlwZXMgPSBjb25maWdUeXBlc1twcm9wZXJ0eV07CiAgICAgICAgICB2YXIgdmFsdWUgPSBjb25maWdbcHJvcGVydHldOwogICAgICAgICAgdmFyIHZhbHVlVHlwZSA9IHZhbHVlICYmIGlzRWxlbWVudCh2YWx1ZSkgPyAnZWxlbWVudCcgOiB0b1R5cGUodmFsdWUpOwoKICAgICAgICAgIGlmICghbmV3IFJlZ0V4cChleHBlY3RlZFR5cGVzKS50ZXN0KHZhbHVlVHlwZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGNvbXBvbmVudE5hbWUudG9VcHBlckNhc2UoKSArICc6ICcgKyAoJ09wdGlvbiAiJyArIHByb3BlcnR5ICsgJyIgcHJvdmlkZWQgdHlwZSAiJyArIHZhbHVlVHlwZSArICciICcpICsgKCdidXQgZXhwZWN0ZWQgdHlwZSAiJyArIGV4cGVjdGVkVHlwZXMgKyAnIi4nKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgc2V0VHJhbnNpdGlvbkVuZFN1cHBvcnQoKTsKCiAgcmV0dXJuIFV0aWw7Cn0oalF1ZXJ5KTsKCi8qKgogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiBCb290c3RyYXAgKHY0LjAuMC1iZXRhKTogYWxlcnQuanMKICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICovCgp2YXIgQWxlcnQgPSBmdW5jdGlvbiAoJCkgewoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBDb25zdGFudHMKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgdmFyIE5BTUUgPSAnYWxlcnQnOwogIHZhciBWRVJTSU9OID0gJzQuMC4wLWJldGEnOwogIHZhciBEQVRBX0tFWSA9ICdicy5hbGVydCc7CiAgdmFyIEVWRU5UX0tFWSA9ICcuJyArIERBVEFfS0VZOwogIHZhciBEQVRBX0FQSV9LRVkgPSAnLmRhdGEtYXBpJzsKICB2YXIgSlFVRVJZX05PX0NPTkZMSUNUID0gJC5mbltOQU1FXTsKICB2YXIgVFJBTlNJVElPTl9EVVJBVElPTiA9IDE1MDsKCiAgdmFyIFNlbGVjdG9yID0gewogICAgRElTTUlTUzogJ1tkYXRhLWRpc21pc3M9ImFsZXJ0Il0nCiAgfTsKCiAgdmFyIEV2ZW50ID0gewogICAgQ0xPU0U6ICdjbG9zZScgKyBFVkVOVF9LRVksCiAgICBDTE9TRUQ6ICdjbG9zZWQnICsgRVZFTlRfS0VZLAogICAgQ0xJQ0tfREFUQV9BUEk6ICdjbGljaycgKyBFVkVOVF9LRVkgKyBEQVRBX0FQSV9LRVkKICB9OwoKICB2YXIgQ2xhc3NOYW1lID0gewogICAgQUxFUlQ6ICdhbGVydCcsCiAgICBGQURFOiAnZmFkZScsCiAgICBTSE9XOiAnc2hvdycKCiAgICAvKioKICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICogQ2xhc3MgRGVmaW5pdGlvbgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKi8KCiAgfTsKICB2YXIgQWxlcnQgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBBbGVydChlbGVtZW50KSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBbGVydCk7CgogICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDsKICAgIH0KCiAgICAvLyBnZXR0ZXJzCgogICAgLy8gcHVibGljCgogICAgQWxlcnQucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gY2xvc2UoZWxlbWVudCkgewogICAgICBlbGVtZW50ID0gZWxlbWVudCB8fCB0aGlzLl9lbGVtZW50OwoKICAgICAgdmFyIHJvb3RFbGVtZW50ID0gdGhpcy5fZ2V0Um9vdEVsZW1lbnQoZWxlbWVudCk7CiAgICAgIHZhciBjdXN0b21FdmVudCA9IHRoaXMuX3RyaWdnZXJDbG9zZUV2ZW50KHJvb3RFbGVtZW50KTsKCiAgICAgIGlmIChjdXN0b21FdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5fcmVtb3ZlRWxlbWVudChyb290RWxlbWVudCk7CiAgICB9OwoKICAgIEFsZXJ0LnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgJC5yZW1vdmVEYXRhKHRoaXMuX2VsZW1lbnQsIERBVEFfS0VZKTsKICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7CiAgICB9OwoKICAgIC8vIHByaXZhdGUKCiAgICBBbGVydC5wcm90b3R5cGUuX2dldFJvb3RFbGVtZW50ID0gZnVuY3Rpb24gX2dldFJvb3RFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgdmFyIHNlbGVjdG9yID0gVXRpbC5nZXRTZWxlY3RvckZyb21FbGVtZW50KGVsZW1lbnQpOwogICAgICB2YXIgcGFyZW50ID0gZmFsc2U7CgogICAgICBpZiAoc2VsZWN0b3IpIHsKICAgICAgICBwYXJlbnQgPSAkKHNlbGVjdG9yKVswXTsKICAgICAgfQoKICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICBwYXJlbnQgPSAkKGVsZW1lbnQpLmNsb3Nlc3QoJy4nICsgQ2xhc3NOYW1lLkFMRVJUKVswXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBhcmVudDsKICAgIH07CgogICAgQWxlcnQucHJvdG90eXBlLl90cmlnZ2VyQ2xvc2VFdmVudCA9IGZ1bmN0aW9uIF90cmlnZ2VyQ2xvc2VFdmVudChlbGVtZW50KSB7CiAgICAgIHZhciBjbG9zZUV2ZW50ID0gJC5FdmVudChFdmVudC5DTE9TRSk7CgogICAgICAkKGVsZW1lbnQpLnRyaWdnZXIoY2xvc2VFdmVudCk7CiAgICAgIHJldHVybiBjbG9zZUV2ZW50OwogICAgfTsKCiAgICBBbGVydC5wcm90b3R5cGUuX3JlbW92ZUVsZW1lbnQgPSBmdW5jdGlvbiBfcmVtb3ZlRWxlbWVudChlbGVtZW50KSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgJChlbGVtZW50KS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuU0hPVyk7CgogICAgICBpZiAoIVV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgfHwgISQoZWxlbWVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLkZBREUpKSB7CiAgICAgICAgdGhpcy5fZGVzdHJveUVsZW1lbnQoZWxlbWVudCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAkKGVsZW1lbnQpLm9uZShVdGlsLlRSQU5TSVRJT05fRU5ELCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLl9kZXN0cm95RWxlbWVudChlbGVtZW50LCBldmVudCk7CiAgICAgIH0pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKFRSQU5TSVRJT05fRFVSQVRJT04pOwogICAgfTsKCiAgICBBbGVydC5wcm90b3R5cGUuX2Rlc3Ryb3lFbGVtZW50ID0gZnVuY3Rpb24gX2Rlc3Ryb3lFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgJChlbGVtZW50KS5kZXRhY2goKS50cmlnZ2VyKEV2ZW50LkNMT1NFRCkucmVtb3ZlKCk7CiAgICB9OwoKICAgIC8vIHN0YXRpYwoKICAgIEFsZXJ0Ll9qUXVlcnlJbnRlcmZhY2UgPSBmdW5jdGlvbiBfalF1ZXJ5SW50ZXJmYWNlKGNvbmZpZykgewogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKHRoaXMpOwogICAgICAgIHZhciBkYXRhID0gJGVsZW1lbnQuZGF0YShEQVRBX0tFWSk7CgogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgZGF0YSA9IG5ldyBBbGVydCh0aGlzKTsKICAgICAgICAgICRlbGVtZW50LmRhdGEoREFUQV9LRVksIGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvbmZpZyA9PT0gJ2Nsb3NlJykgewogICAgICAgICAgZGF0YVtjb25maWddKHRoaXMpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIEFsZXJ0Ll9oYW5kbGVEaXNtaXNzID0gZnVuY3Rpb24gX2hhbmRsZURpc21pc3MoYWxlcnRJbnN0YW5jZSkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KCiAgICAgICAgYWxlcnRJbnN0YW5jZS5jbG9zZSh0aGlzKTsKICAgICAgfTsKICAgIH07CgogICAgX2NyZWF0ZUNsYXNzKEFsZXJ0LCBudWxsLCBbewogICAgICBrZXk6ICdWRVJTSU9OJywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIFZFUlNJT047CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQWxlcnQ7CiAgfSgpOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBEYXRhIEFwaSBpbXBsZW1lbnRhdGlvbgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkKGRvY3VtZW50KS5vbihFdmVudC5DTElDS19EQVRBX0FQSSwgU2VsZWN0b3IuRElTTUlTUywgQWxlcnQuX2hhbmRsZURpc21pc3MobmV3IEFsZXJ0KCkpKTsKCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICogalF1ZXJ5CiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICovCgogICQuZm5bTkFNRV0gPSBBbGVydC5falF1ZXJ5SW50ZXJmYWNlOwogICQuZm5bTkFNRV0uQ29uc3RydWN0b3IgPSBBbGVydDsKICAkLmZuW05BTUVdLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuW05BTUVdID0gSlFVRVJZX05PX0NPTkZMSUNUOwogICAgcmV0dXJuIEFsZXJ0Ll9qUXVlcnlJbnRlcmZhY2U7CiAgfTsKCiAgcmV0dXJuIEFsZXJ0Owp9KGpRdWVyeSk7CgovKioKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogQm9vdHN0cmFwICh2NC4wLjAtYmV0YSk6IGJ1dHRvbi5qcwogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKi8KCnZhciBCdXR0b24gPSBmdW5jdGlvbiAoJCkgewoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBDb25zdGFudHMKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgdmFyIE5BTUUgPSAnYnV0dG9uJzsKICB2YXIgVkVSU0lPTiA9ICc0LjAuMC1iZXRhJzsKICB2YXIgREFUQV9LRVkgPSAnYnMuYnV0dG9uJzsKICB2YXIgRVZFTlRfS0VZID0gJy4nICsgREFUQV9LRVk7CiAgdmFyIERBVEFfQVBJX0tFWSA9ICcuZGF0YS1hcGknOwogIHZhciBKUVVFUllfTk9fQ09ORkxJQ1QgPSAkLmZuW05BTUVdOwoKICB2YXIgQ2xhc3NOYW1lID0gewogICAgQUNUSVZFOiAnYWN0aXZlJywKICAgIEJVVFRPTjogJ2J0bicsCiAgICBGT0NVUzogJ2ZvY3VzJwogIH07CgogIHZhciBTZWxlY3RvciA9IHsKICAgIERBVEFfVE9HR0xFX0NBUlJPVDogJ1tkYXRhLXRvZ2dsZV49ImJ1dHRvbiJdJywKICAgIERBVEFfVE9HR0xFOiAnW2RhdGEtdG9nZ2xlPSJidXR0b25zIl0nLAogICAgSU5QVVQ6ICdpbnB1dCcsCiAgICBBQ1RJVkU6ICcuYWN0aXZlJywKICAgIEJVVFRPTjogJy5idG4nCiAgfTsKCiAgdmFyIEV2ZW50ID0gewogICAgQ0xJQ0tfREFUQV9BUEk6ICdjbGljaycgKyBFVkVOVF9LRVkgKyBEQVRBX0FQSV9LRVksCiAgICBGT0NVU19CTFVSX0RBVEFfQVBJOiAnZm9jdXMnICsgRVZFTlRfS0VZICsgREFUQV9BUElfS0VZICsgJyAnICsgKCdibHVyJyArIEVWRU5UX0tFWSArIERBVEFfQVBJX0tFWSkKCiAgICAvKioKICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICogQ2xhc3MgRGVmaW5pdGlvbgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKi8KCiAgfTsKICB2YXIgQnV0dG9uID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQnV0dG9uKGVsZW1lbnQpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJ1dHRvbik7CgogICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDsKICAgIH0KCiAgICAvLyBnZXR0ZXJzCgogICAgLy8gcHVibGljCgogICAgQnV0dG9uLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiB0b2dnbGUoKSB7CiAgICAgIHZhciB0cmlnZ2VyQ2hhbmdlRXZlbnQgPSB0cnVlOwogICAgICB2YXIgYWRkQXJpYVByZXNzZWQgPSB0cnVlOwogICAgICB2YXIgcm9vdEVsZW1lbnQgPSAkKHRoaXMuX2VsZW1lbnQpLmNsb3Nlc3QoU2VsZWN0b3IuREFUQV9UT0dHTEUpWzBdOwoKICAgICAgaWYgKHJvb3RFbGVtZW50KSB7CiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzLl9lbGVtZW50KS5maW5kKFNlbGVjdG9yLklOUFVUKVswXTsKCiAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgICBpZiAoaW5wdXQudHlwZSA9PT0gJ3JhZGlvJykgewogICAgICAgICAgICBpZiAoaW5wdXQuY2hlY2tlZCAmJiAkKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5BQ1RJVkUpKSB7CiAgICAgICAgICAgICAgdHJpZ2dlckNoYW5nZUV2ZW50ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGFjdGl2ZUVsZW1lbnQgPSAkKHJvb3RFbGVtZW50KS5maW5kKFNlbGVjdG9yLkFDVElWRSlbMF07CgogICAgICAgICAgICAgIGlmIChhY3RpdmVFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAkKGFjdGl2ZUVsZW1lbnQpLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5BQ1RJVkUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0cmlnZ2VyQ2hhbmdlRXZlbnQpIHsKICAgICAgICAgICAgaWYgKGlucHV0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSB8fCByb290RWxlbWVudC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgfHwgaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlZCcpIHx8IHJvb3RFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnZGlzYWJsZWQnKSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gISQodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CiAgICAgICAgICAgICQoaW5wdXQpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgfQoKICAgICAgICAgIGlucHV0LmZvY3VzKCk7CiAgICAgICAgICBhZGRBcmlhUHJlc3NlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGFkZEFyaWFQcmVzc2VkKSB7CiAgICAgICAgdGhpcy5fZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtcHJlc3NlZCcsICEkKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5BQ1RJVkUpKTsKICAgICAgfQoKICAgICAgaWYgKHRyaWdnZXJDaGFuZ2VFdmVudCkgewogICAgICAgICQodGhpcy5fZWxlbWVudCkudG9nZ2xlQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CiAgICAgIH0KICAgIH07CgogICAgQnV0dG9uLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgJC5yZW1vdmVEYXRhKHRoaXMuX2VsZW1lbnQsIERBVEFfS0VZKTsKICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7CiAgICB9OwoKICAgIC8vIHN0YXRpYwoKICAgIEJ1dHRvbi5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoREFUQV9LRVkpOwoKICAgICAgICBpZiAoIWRhdGEpIHsKICAgICAgICAgIGRhdGEgPSBuZXcgQnV0dG9uKHRoaXMpOwogICAgICAgICAgJCh0aGlzKS5kYXRhKERBVEFfS0VZLCBkYXRhKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb25maWcgPT09ICd0b2dnbGUnKSB7CiAgICAgICAgICBkYXRhW2NvbmZpZ10oKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICBfY3JlYXRlQ2xhc3MoQnV0dG9uLCBudWxsLCBbewogICAgICBrZXk6ICdWRVJTSU9OJywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIFZFUlNJT047CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQnV0dG9uOwogIH0oKTsKCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICogRGF0YSBBcGkgaW1wbGVtZW50YXRpb24KICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgJChkb2N1bWVudCkub24oRXZlbnQuQ0xJQ0tfREFUQV9BUEksIFNlbGVjdG9yLkRBVEFfVE9HR0xFX0NBUlJPVCwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgIHZhciBidXR0b24gPSBldmVudC50YXJnZXQ7CgogICAgaWYgKCEkKGJ1dHRvbikuaGFzQ2xhc3MoQ2xhc3NOYW1lLkJVVFRPTikpIHsKICAgICAgYnV0dG9uID0gJChidXR0b24pLmNsb3Nlc3QoU2VsZWN0b3IuQlVUVE9OKTsKICAgIH0KCiAgICBCdXR0b24uX2pRdWVyeUludGVyZmFjZS5jYWxsKCQoYnV0dG9uKSwgJ3RvZ2dsZScpOwogIH0pLm9uKEV2ZW50LkZPQ1VTX0JMVVJfREFUQV9BUEksIFNlbGVjdG9yLkRBVEFfVE9HR0xFX0NBUlJPVCwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB2YXIgYnV0dG9uID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoU2VsZWN0b3IuQlVUVE9OKVswXTsKICAgICQoYnV0dG9uKS50b2dnbGVDbGFzcyhDbGFzc05hbWUuRk9DVVMsIC9eZm9jdXMoaW4pPyQvLnRlc3QoZXZlbnQudHlwZSkpOwogIH0pOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBqUXVlcnkKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgJC5mbltOQU1FXSA9IEJ1dHRvbi5falF1ZXJ5SW50ZXJmYWNlOwogICQuZm5bTkFNRV0uQ29uc3RydWN0b3IgPSBCdXR0b247CiAgJC5mbltOQU1FXS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbltOQU1FXSA9IEpRVUVSWV9OT19DT05GTElDVDsKICAgIHJldHVybiBCdXR0b24uX2pRdWVyeUludGVyZmFjZTsKICB9OwoKICByZXR1cm4gQnV0dG9uOwp9KGpRdWVyeSk7CgovKioKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogQm9vdHN0cmFwICh2NC4wLjAtYmV0YSk6IGNhcm91c2VsLmpzCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqLwoKdmFyIENhcm91c2VsID0gZnVuY3Rpb24gKCQpIHsKCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICogQ29uc3RhbnRzCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICovCgogIHZhciBOQU1FID0gJ2Nhcm91c2VsJzsKICB2YXIgVkVSU0lPTiA9ICc0LjAuMC1iZXRhJzsKICB2YXIgREFUQV9LRVkgPSAnYnMuY2Fyb3VzZWwnOwogIHZhciBFVkVOVF9LRVkgPSAnLicgKyBEQVRBX0tFWTsKICB2YXIgREFUQV9BUElfS0VZID0gJy5kYXRhLWFwaSc7CiAgdmFyIEpRVUVSWV9OT19DT05GTElDVCA9ICQuZm5bTkFNRV07CiAgdmFyIFRSQU5TSVRJT05fRFVSQVRJT04gPSA2MDA7CiAgdmFyIEFSUk9XX0xFRlRfS0VZQ09ERSA9IDM3OyAvLyBLZXlib2FyZEV2ZW50LndoaWNoIHZhbHVlIGZvciBsZWZ0IGFycm93IGtleQogIHZhciBBUlJPV19SSUdIVF9LRVlDT0RFID0gMzk7IC8vIEtleWJvYXJkRXZlbnQud2hpY2ggdmFsdWUgZm9yIHJpZ2h0IGFycm93IGtleQogIHZhciBUT1VDSEVWRU5UX0NPTVBBVF9XQUlUID0gNTAwOyAvLyBUaW1lIGZvciBtb3VzZSBjb21wYXQgZXZlbnRzIHRvIGZpcmUgYWZ0ZXIgdG91Y2gKCiAgdmFyIERlZmF1bHQgPSB7CiAgICBpbnRlcnZhbDogNTAwMCwKICAgIGtleWJvYXJkOiB0cnVlLAogICAgc2xpZGU6IGZhbHNlLAogICAgcGF1c2U6ICdob3ZlcicsCiAgICB3cmFwOiB0cnVlCiAgfTsKCiAgdmFyIERlZmF1bHRUeXBlID0gewogICAgaW50ZXJ2YWw6ICcobnVtYmVyfGJvb2xlYW4pJywKICAgIGtleWJvYXJkOiAnYm9vbGVhbicsCiAgICBzbGlkZTogJyhib29sZWFufHN0cmluZyknLAogICAgcGF1c2U6ICcoc3RyaW5nfGJvb2xlYW4pJywKICAgIHdyYXA6ICdib29sZWFuJwogIH07CgogIHZhciBEaXJlY3Rpb24gPSB7CiAgICBORVhUOiAnbmV4dCcsCiAgICBQUkVWOiAncHJldicsCiAgICBMRUZUOiAnbGVmdCcsCiAgICBSSUdIVDogJ3JpZ2h0JwogIH07CgogIHZhciBFdmVudCA9IHsKICAgIFNMSURFOiAnc2xpZGUnICsgRVZFTlRfS0VZLAogICAgU0xJRDogJ3NsaWQnICsgRVZFTlRfS0VZLAogICAgS0VZRE9XTjogJ2tleWRvd24nICsgRVZFTlRfS0VZLAogICAgTU9VU0VFTlRFUjogJ21vdXNlZW50ZXInICsgRVZFTlRfS0VZLAogICAgTU9VU0VMRUFWRTogJ21vdXNlbGVhdmUnICsgRVZFTlRfS0VZLAogICAgVE9VQ0hFTkQ6ICd0b3VjaGVuZCcgKyBFVkVOVF9LRVksCiAgICBMT0FEX0RBVEFfQVBJOiAnbG9hZCcgKyBFVkVOVF9LRVkgKyBEQVRBX0FQSV9LRVksCiAgICBDTElDS19EQVRBX0FQSTogJ2NsaWNrJyArIEVWRU5UX0tFWSArIERBVEFfQVBJX0tFWQogIH07CgogIHZhciBDbGFzc05hbWUgPSB7CiAgICBDQVJPVVNFTDogJ2Nhcm91c2VsJywKICAgIEFDVElWRTogJ2FjdGl2ZScsCiAgICBTTElERTogJ3NsaWRlJywKICAgIFJJR0hUOiAnY2Fyb3VzZWwtaXRlbS1yaWdodCcsCiAgICBMRUZUOiAnY2Fyb3VzZWwtaXRlbS1sZWZ0JywKICAgIE5FWFQ6ICdjYXJvdXNlbC1pdGVtLW5leHQnLAogICAgUFJFVjogJ2Nhcm91c2VsLWl0ZW0tcHJldicsCiAgICBJVEVNOiAnY2Fyb3VzZWwtaXRlbScKICB9OwoKICB2YXIgU2VsZWN0b3IgPSB7CiAgICBBQ1RJVkU6ICcuYWN0aXZlJywKICAgIEFDVElWRV9JVEVNOiAnLmFjdGl2ZS5jYXJvdXNlbC1pdGVtJywKICAgIElURU06ICcuY2Fyb3VzZWwtaXRlbScsCiAgICBORVhUX1BSRVY6ICcuY2Fyb3VzZWwtaXRlbS1uZXh0LCAuY2Fyb3VzZWwtaXRlbS1wcmV2JywKICAgIElORElDQVRPUlM6ICcuY2Fyb3VzZWwtaW5kaWNhdG9ycycsCiAgICBEQVRBX1NMSURFOiAnW2RhdGEtc2xpZGVdLCBbZGF0YS1zbGlkZS10b10nLAogICAgREFUQV9SSURFOiAnW2RhdGEtcmlkZT0iY2Fyb3VzZWwiXScKCiAgICAvKioKICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICogQ2xhc3MgRGVmaW5pdGlvbgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKi8KCiAgfTsKICB2YXIgQ2Fyb3VzZWwgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDYXJvdXNlbChlbGVtZW50LCBjb25maWcpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENhcm91c2VsKTsKCiAgICAgIHRoaXMuX2l0ZW1zID0gbnVsbDsKICAgICAgdGhpcy5faW50ZXJ2YWwgPSBudWxsOwogICAgICB0aGlzLl9hY3RpdmVFbGVtZW50ID0gbnVsbDsKCiAgICAgIHRoaXMuX2lzUGF1c2VkID0gZmFsc2U7CiAgICAgIHRoaXMuX2lzU2xpZGluZyA9IGZhbHNlOwoKICAgICAgdGhpcy50b3VjaFRpbWVvdXQgPSBudWxsOwoKICAgICAgdGhpcy5fY29uZmlnID0gdGhpcy5fZ2V0Q29uZmlnKGNvbmZpZyk7CiAgICAgIHRoaXMuX2VsZW1lbnQgPSAkKGVsZW1lbnQpWzBdOwogICAgICB0aGlzLl9pbmRpY2F0b3JzRWxlbWVudCA9ICQodGhpcy5fZWxlbWVudCkuZmluZChTZWxlY3Rvci5JTkRJQ0FUT1JTKVswXTsKCiAgICAgIHRoaXMuX2FkZEV2ZW50TGlzdGVuZXJzKCk7CiAgICB9CgogICAgLy8gZ2V0dGVycwoKICAgIC8vIHB1YmxpYwoKICAgIENhcm91c2VsLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgaWYgKCF0aGlzLl9pc1NsaWRpbmcpIHsKICAgICAgICB0aGlzLl9zbGlkZShEaXJlY3Rpb24uTkVYVCk7CiAgICAgIH0KICAgIH07CgogICAgQ2Fyb3VzZWwucHJvdG90eXBlLm5leHRXaGVuVmlzaWJsZSA9IGZ1bmN0aW9uIG5leHRXaGVuVmlzaWJsZSgpIHsKICAgICAgLy8gRG9uJ3QgY2FsbCBuZXh0IHdoZW4gdGhlIHBhZ2UgaXNuJ3QgdmlzaWJsZQogICAgICBpZiAoIWRvY3VtZW50LmhpZGRlbikgewogICAgICAgIHRoaXMubmV4dCgpOwogICAgICB9CiAgICB9OwoKICAgIENhcm91c2VsLnByb3RvdHlwZS5wcmV2ID0gZnVuY3Rpb24gcHJldigpIHsKICAgICAgaWYgKCF0aGlzLl9pc1NsaWRpbmcpIHsKICAgICAgICB0aGlzLl9zbGlkZShEaXJlY3Rpb24uUFJFVik7CiAgICAgIH0KICAgIH07CgogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gcGF1c2UoZXZlbnQpIHsKICAgICAgaWYgKCFldmVudCkgewogICAgICAgIHRoaXMuX2lzUGF1c2VkID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKCQodGhpcy5fZWxlbWVudCkuZmluZChTZWxlY3Rvci5ORVhUX1BSRVYpWzBdICYmIFV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkpIHsKICAgICAgICBVdGlsLnRyaWdnZXJUcmFuc2l0aW9uRW5kKHRoaXMuX2VsZW1lbnQpOwogICAgICAgIHRoaXMuY3ljbGUodHJ1ZSk7CiAgICAgIH0KCiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWwpOwogICAgICB0aGlzLl9pbnRlcnZhbCA9IG51bGw7CiAgICB9OwoKICAgIENhcm91c2VsLnByb3RvdHlwZS5jeWNsZSA9IGZ1bmN0aW9uIGN5Y2xlKGV2ZW50KSB7CiAgICAgIGlmICghZXZlbnQpIHsKICAgICAgICB0aGlzLl9pc1BhdXNlZCA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAodGhpcy5faW50ZXJ2YWwpIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsKTsKICAgICAgICB0aGlzLl9pbnRlcnZhbCA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9jb25maWcuaW50ZXJ2YWwgJiYgIXRoaXMuX2lzUGF1c2VkKSB7CiAgICAgICAgdGhpcy5faW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID8gdGhpcy5uZXh0V2hlblZpc2libGUgOiB0aGlzLm5leHQpLmJpbmQodGhpcyksIHRoaXMuX2NvbmZpZy5pbnRlcnZhbCk7CiAgICAgIH0KICAgIH07CgogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnRvID0gZnVuY3Rpb24gdG8oaW5kZXgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLl9hY3RpdmVFbGVtZW50ID0gJCh0aGlzLl9lbGVtZW50KS5maW5kKFNlbGVjdG9yLkFDVElWRV9JVEVNKVswXTsKCiAgICAgIHZhciBhY3RpdmVJbmRleCA9IHRoaXMuX2dldEl0ZW1JbmRleCh0aGlzLl9hY3RpdmVFbGVtZW50KTsKCiAgICAgIGlmIChpbmRleCA+IHRoaXMuX2l0ZW1zLmxlbmd0aCAtIDEgfHwgaW5kZXggPCAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5faXNTbGlkaW5nKSB7CiAgICAgICAgJCh0aGlzLl9lbGVtZW50KS5vbmUoRXZlbnQuU0xJRCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMy50byhpbmRleCk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoYWN0aXZlSW5kZXggPT09IGluZGV4KSB7CiAgICAgICAgdGhpcy5wYXVzZSgpOwogICAgICAgIHRoaXMuY3ljbGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkaXJlY3Rpb24gPSBpbmRleCA+IGFjdGl2ZUluZGV4ID8gRGlyZWN0aW9uLk5FWFQgOiBEaXJlY3Rpb24uUFJFVjsKCiAgICAgIHRoaXMuX3NsaWRlKGRpcmVjdGlvbiwgdGhpcy5faXRlbXNbaW5kZXhdKTsKICAgIH07CgogICAgQ2Fyb3VzZWwucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICAkKHRoaXMuX2VsZW1lbnQpLm9mZihFVkVOVF9LRVkpOwogICAgICAkLnJlbW92ZURhdGEodGhpcy5fZWxlbWVudCwgREFUQV9LRVkpOwoKICAgICAgdGhpcy5faXRlbXMgPSBudWxsOwogICAgICB0aGlzLl9jb25maWcgPSBudWxsOwogICAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDsKICAgICAgdGhpcy5faW50ZXJ2YWwgPSBudWxsOwogICAgICB0aGlzLl9pc1BhdXNlZCA9IG51bGw7CiAgICAgIHRoaXMuX2lzU2xpZGluZyA9IG51bGw7CiAgICAgIHRoaXMuX2FjdGl2ZUVsZW1lbnQgPSBudWxsOwogICAgICB0aGlzLl9pbmRpY2F0b3JzRWxlbWVudCA9IG51bGw7CiAgICB9OwoKICAgIC8vIHByaXZhdGUKCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuX2dldENvbmZpZyA9IGZ1bmN0aW9uIF9nZXRDb25maWcoY29uZmlnKSB7CiAgICAgIGNvbmZpZyA9ICQuZXh0ZW5kKHt9LCBEZWZhdWx0LCBjb25maWcpOwogICAgICBVdGlsLnR5cGVDaGVja0NvbmZpZyhOQU1FLCBjb25maWcsIERlZmF1bHRUeXBlKTsKICAgICAgcmV0dXJuIGNvbmZpZzsKICAgIH07CgogICAgQ2Fyb3VzZWwucHJvdG90eXBlLl9hZGRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uIF9hZGRFdmVudExpc3RlbmVycygpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5fY29uZmlnLmtleWJvYXJkKSB7CiAgICAgICAgJCh0aGlzLl9lbGVtZW50KS5vbihFdmVudC5LRVlET1dOLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBfdGhpczQuX2tleWRvd24oZXZlbnQpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodGhpcy5fY29uZmlnLnBhdXNlID09PSAnaG92ZXInKSB7CiAgICAgICAgJCh0aGlzLl9lbGVtZW50KS5vbihFdmVudC5NT1VTRUVOVEVSLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBfdGhpczQucGF1c2UoZXZlbnQpOwogICAgICAgIH0pLm9uKEV2ZW50Lk1PVVNFTEVBVkUsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgcmV0dXJuIF90aGlzNC5jeWNsZShldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgewogICAgICAgICAgLy8gaWYgaXQncyBhIHRvdWNoLWVuYWJsZWQgZGV2aWNlLCBtb3VzZWVudGVyL2xlYXZlIGFyZSBmaXJlZCBhcwogICAgICAgICAgLy8gcGFydCBvZiB0aGUgbW91c2UgY29tcGF0aWJpbGl0eSBldmVudHMgb24gZmlyc3QgdGFwIC0gdGhlIGNhcm91c2VsCiAgICAgICAgICAvLyB3b3VsZCBzdG9wIGN5Y2xpbmcgdW50aWwgdXNlciB0YXBwZWQgb3V0IG9mIGl0OwogICAgICAgICAgLy8gaGVyZSwgd2UgbGlzdGVuIGZvciB0b3VjaGVuZCwgZXhwbGljaXRseSBwYXVzZSB0aGUgY2Fyb3VzZWwKICAgICAgICAgIC8vIChhcyBpZiBpdCdzIHRoZSBzZWNvbmQgdGltZSB3ZSB0YXAgb24gaXQsIG1vdXNlZW50ZXIgY29tcGF0IGV2ZW50CiAgICAgICAgICAvLyBpcyBOT1QgZmlyZWQpIGFuZCBhZnRlciBhIHRpbWVvdXQgKHRvIGFsbG93IGZvciBtb3VzZSBjb21wYXRpYmlsaXR5CiAgICAgICAgICAvLyBldmVudHMgdG8gZmlyZSkgd2UgZXhwbGljaXRseSByZXN0YXJ0IGN5Y2xpbmcKICAgICAgICAgICQodGhpcy5fZWxlbWVudCkub24oRXZlbnQuVE9VQ0hFTkQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXM0LnBhdXNlKCk7CiAgICAgICAgICAgIGlmIChfdGhpczQudG91Y2hUaW1lb3V0KSB7CiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KF90aGlzNC50b3VjaFRpbWVvdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF90aGlzNC50b3VjaFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczQuY3ljbGUoZXZlbnQpOwogICAgICAgICAgICB9LCBUT1VDSEVWRU5UX0NPTVBBVF9XQUlUICsgX3RoaXM0Ll9jb25maWcuaW50ZXJ2YWwpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIENhcm91c2VsLnByb3RvdHlwZS5fa2V5ZG93biA9IGZ1bmN0aW9uIF9rZXlkb3duKGV2ZW50KSB7CiAgICAgIGlmICgvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KGV2ZW50LnRhcmdldC50YWdOYW1lKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgc3dpdGNoIChldmVudC53aGljaCkgewogICAgICAgIGNhc2UgQVJST1dfTEVGVF9LRVlDT0RFOgogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIHRoaXMucHJldigpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBBUlJPV19SSUdIVF9LRVlDT0RFOgogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybjsKICAgICAgfQogICAgfTsKCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuX2dldEl0ZW1JbmRleCA9IGZ1bmN0aW9uIF9nZXRJdGVtSW5kZXgoZWxlbWVudCkgewogICAgICB0aGlzLl9pdGVtcyA9ICQubWFrZUFycmF5KCQoZWxlbWVudCkucGFyZW50KCkuZmluZChTZWxlY3Rvci5JVEVNKSk7CiAgICAgIHJldHVybiB0aGlzLl9pdGVtcy5pbmRleE9mKGVsZW1lbnQpOwogICAgfTsKCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuX2dldEl0ZW1CeURpcmVjdGlvbiA9IGZ1bmN0aW9uIF9nZXRJdGVtQnlEaXJlY3Rpb24oZGlyZWN0aW9uLCBhY3RpdmVFbGVtZW50KSB7CiAgICAgIHZhciBpc05leHREaXJlY3Rpb24gPSBkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5ORVhUOwogICAgICB2YXIgaXNQcmV2RGlyZWN0aW9uID0gZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uUFJFVjsKICAgICAgdmFyIGFjdGl2ZUluZGV4ID0gdGhpcy5fZ2V0SXRlbUluZGV4KGFjdGl2ZUVsZW1lbnQpOwogICAgICB2YXIgbGFzdEl0ZW1JbmRleCA9IHRoaXMuX2l0ZW1zLmxlbmd0aCAtIDE7CiAgICAgIHZhciBpc0dvaW5nVG9XcmFwID0gaXNQcmV2RGlyZWN0aW9uICYmIGFjdGl2ZUluZGV4ID09PSAwIHx8IGlzTmV4dERpcmVjdGlvbiAmJiBhY3RpdmVJbmRleCA9PT0gbGFzdEl0ZW1JbmRleDsKCiAgICAgIGlmIChpc0dvaW5nVG9XcmFwICYmICF0aGlzLl9jb25maWcud3JhcCkgewogICAgICAgIHJldHVybiBhY3RpdmVFbGVtZW50OwogICAgICB9CgogICAgICB2YXIgZGVsdGEgPSBkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5QUkVWID8gLTEgOiAxOwogICAgICB2YXIgaXRlbUluZGV4ID0gKGFjdGl2ZUluZGV4ICsgZGVsdGEpICUgdGhpcy5faXRlbXMubGVuZ3RoOwoKICAgICAgcmV0dXJuIGl0ZW1JbmRleCA9PT0gLTEgPyB0aGlzLl9pdGVtc1t0aGlzLl9pdGVtcy5sZW5ndGggLSAxXSA6IHRoaXMuX2l0ZW1zW2l0ZW1JbmRleF07CiAgICB9OwoKICAgIENhcm91c2VsLnByb3RvdHlwZS5fdHJpZ2dlclNsaWRlRXZlbnQgPSBmdW5jdGlvbiBfdHJpZ2dlclNsaWRlRXZlbnQocmVsYXRlZFRhcmdldCwgZXZlbnREaXJlY3Rpb25OYW1lKSB7CiAgICAgIHZhciB0YXJnZXRJbmRleCA9IHRoaXMuX2dldEl0ZW1JbmRleChyZWxhdGVkVGFyZ2V0KTsKICAgICAgdmFyIGZyb21JbmRleCA9IHRoaXMuX2dldEl0ZW1JbmRleCgkKHRoaXMuX2VsZW1lbnQpLmZpbmQoU2VsZWN0b3IuQUNUSVZFX0lURU0pWzBdKTsKICAgICAgdmFyIHNsaWRlRXZlbnQgPSAkLkV2ZW50KEV2ZW50LlNMSURFLCB7CiAgICAgICAgcmVsYXRlZFRhcmdldDogcmVsYXRlZFRhcmdldCwKICAgICAgICBkaXJlY3Rpb246IGV2ZW50RGlyZWN0aW9uTmFtZSwKICAgICAgICBmcm9tOiBmcm9tSW5kZXgsCiAgICAgICAgdG86IHRhcmdldEluZGV4CiAgICAgIH0pOwoKICAgICAgJCh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKHNsaWRlRXZlbnQpOwoKICAgICAgcmV0dXJuIHNsaWRlRXZlbnQ7CiAgICB9OwoKICAgIENhcm91c2VsLnByb3RvdHlwZS5fc2V0QWN0aXZlSW5kaWNhdG9yRWxlbWVudCA9IGZ1bmN0aW9uIF9zZXRBY3RpdmVJbmRpY2F0b3JFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgaWYgKHRoaXMuX2luZGljYXRvcnNFbGVtZW50KSB7CiAgICAgICAgJCh0aGlzLl9pbmRpY2F0b3JzRWxlbWVudCkuZmluZChTZWxlY3Rvci5BQ1RJVkUpLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5BQ1RJVkUpOwoKICAgICAgICB2YXIgbmV4dEluZGljYXRvciA9IHRoaXMuX2luZGljYXRvcnNFbGVtZW50LmNoaWxkcmVuW3RoaXMuX2dldEl0ZW1JbmRleChlbGVtZW50KV07CgogICAgICAgIGlmIChuZXh0SW5kaWNhdG9yKSB7CiAgICAgICAgICAkKG5leHRJbmRpY2F0b3IpLmFkZENsYXNzKENsYXNzTmFtZS5BQ1RJVkUpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuX3NsaWRlID0gZnVuY3Rpb24gX3NsaWRlKGRpcmVjdGlvbiwgZWxlbWVudCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBhY3RpdmVFbGVtZW50ID0gJCh0aGlzLl9lbGVtZW50KS5maW5kKFNlbGVjdG9yLkFDVElWRV9JVEVNKVswXTsKICAgICAgdmFyIGFjdGl2ZUVsZW1lbnRJbmRleCA9IHRoaXMuX2dldEl0ZW1JbmRleChhY3RpdmVFbGVtZW50KTsKICAgICAgdmFyIG5leHRFbGVtZW50ID0gZWxlbWVudCB8fCBhY3RpdmVFbGVtZW50ICYmIHRoaXMuX2dldEl0ZW1CeURpcmVjdGlvbihkaXJlY3Rpb24sIGFjdGl2ZUVsZW1lbnQpOwogICAgICB2YXIgbmV4dEVsZW1lbnRJbmRleCA9IHRoaXMuX2dldEl0ZW1JbmRleChuZXh0RWxlbWVudCk7CiAgICAgIHZhciBpc0N5Y2xpbmcgPSBCb29sZWFuKHRoaXMuX2ludGVydmFsKTsKCiAgICAgIHZhciBkaXJlY3Rpb25hbENsYXNzTmFtZSA9IHZvaWQgMDsKICAgICAgdmFyIG9yZGVyQ2xhc3NOYW1lID0gdm9pZCAwOwogICAgICB2YXIgZXZlbnREaXJlY3Rpb25OYW1lID0gdm9pZCAwOwoKICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLk5FWFQpIHsKICAgICAgICBkaXJlY3Rpb25hbENsYXNzTmFtZSA9IENsYXNzTmFtZS5MRUZUOwogICAgICAgIG9yZGVyQ2xhc3NOYW1lID0gQ2xhc3NOYW1lLk5FWFQ7CiAgICAgICAgZXZlbnREaXJlY3Rpb25OYW1lID0gRGlyZWN0aW9uLkxFRlQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGlyZWN0aW9uYWxDbGFzc05hbWUgPSBDbGFzc05hbWUuUklHSFQ7CiAgICAgICAgb3JkZXJDbGFzc05hbWUgPSBDbGFzc05hbWUuUFJFVjsKICAgICAgICBldmVudERpcmVjdGlvbk5hbWUgPSBEaXJlY3Rpb24uUklHSFQ7CiAgICAgIH0KCiAgICAgIGlmIChuZXh0RWxlbWVudCAmJiAkKG5leHRFbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuQUNUSVZFKSkgewogICAgICAgIHRoaXMuX2lzU2xpZGluZyA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHNsaWRlRXZlbnQgPSB0aGlzLl90cmlnZ2VyU2xpZGVFdmVudChuZXh0RWxlbWVudCwgZXZlbnREaXJlY3Rpb25OYW1lKTsKICAgICAgaWYgKHNsaWRlRXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghYWN0aXZlRWxlbWVudCB8fCAhbmV4dEVsZW1lbnQpIHsKICAgICAgICAvLyBzb21lIHdlaXJkbmVzcyBpcyBoYXBwZW5pbmcsIHNvIHdlIGJhaWwKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX2lzU2xpZGluZyA9IHRydWU7CgogICAgICBpZiAoaXNDeWNsaW5nKSB7CiAgICAgICAgdGhpcy5wYXVzZSgpOwogICAgICB9CgogICAgICB0aGlzLl9zZXRBY3RpdmVJbmRpY2F0b3JFbGVtZW50KG5leHRFbGVtZW50KTsKCiAgICAgIHZhciBzbGlkRXZlbnQgPSAkLkV2ZW50KEV2ZW50LlNMSUQsIHsKICAgICAgICByZWxhdGVkVGFyZ2V0OiBuZXh0RWxlbWVudCwKICAgICAgICBkaXJlY3Rpb246IGV2ZW50RGlyZWN0aW9uTmFtZSwKICAgICAgICBmcm9tOiBhY3RpdmVFbGVtZW50SW5kZXgsCiAgICAgICAgdG86IG5leHRFbGVtZW50SW5kZXgKICAgICAgfSk7CgogICAgICBpZiAoVXRpbC5zdXBwb3J0c1RyYW5zaXRpb25FbmQoKSAmJiAkKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5TTElERSkpIHsKCiAgICAgICAgJChuZXh0RWxlbWVudCkuYWRkQ2xhc3Mob3JkZXJDbGFzc05hbWUpOwoKICAgICAgICBVdGlsLnJlZmxvdyhuZXh0RWxlbWVudCk7CgogICAgICAgICQoYWN0aXZlRWxlbWVudCkuYWRkQ2xhc3MoZGlyZWN0aW9uYWxDbGFzc05hbWUpOwogICAgICAgICQobmV4dEVsZW1lbnQpLmFkZENsYXNzKGRpcmVjdGlvbmFsQ2xhc3NOYW1lKTsKCiAgICAgICAgJChhY3RpdmVFbGVtZW50KS5vbmUoVXRpbC5UUkFOU0lUSU9OX0VORCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgJChuZXh0RWxlbWVudCkucmVtb3ZlQ2xhc3MoZGlyZWN0aW9uYWxDbGFzc05hbWUgKyAnICcgKyBvcmRlckNsYXNzTmFtZSkuYWRkQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CgogICAgICAgICAgJChhY3RpdmVFbGVtZW50KS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuQUNUSVZFICsgJyAnICsgb3JkZXJDbGFzc05hbWUgKyAnICcgKyBkaXJlY3Rpb25hbENsYXNzTmFtZSk7CgogICAgICAgICAgX3RoaXM1Ll9pc1NsaWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICQoX3RoaXM1Ll9lbGVtZW50KS50cmlnZ2VyKHNsaWRFdmVudCk7CiAgICAgICAgICB9LCAwKTsKICAgICAgICB9KS5lbXVsYXRlVHJhbnNpdGlvbkVuZChUUkFOU0lUSU9OX0RVUkFUSU9OKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkKGFjdGl2ZUVsZW1lbnQpLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5BQ1RJVkUpOwogICAgICAgICQobmV4dEVsZW1lbnQpLmFkZENsYXNzKENsYXNzTmFtZS5BQ1RJVkUpOwoKICAgICAgICB0aGlzLl9pc1NsaWRpbmcgPSBmYWxzZTsKICAgICAgICAkKHRoaXMuX2VsZW1lbnQpLnRyaWdnZXIoc2xpZEV2ZW50KTsKICAgICAgfQoKICAgICAgaWYgKGlzQ3ljbGluZykgewogICAgICAgIHRoaXMuY3ljbGUoKTsKICAgICAgfQogICAgfTsKCiAgICAvLyBzdGF0aWMKCiAgICBDYXJvdXNlbC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoREFUQV9LRVkpOwogICAgICAgIHZhciBfY29uZmlnID0gJC5leHRlbmQoe30sIERlZmF1bHQsICQodGhpcykuZGF0YSgpKTsKCiAgICAgICAgaWYgKCh0eXBlb2YgY29uZmlnID09PSAndW5kZWZpbmVkJyA\/ICd1bmRlZmluZWQnIDogX3R5cGVvZihjb25maWcpKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICQuZXh0ZW5kKF9jb25maWcsIGNvbmZpZyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgYWN0aW9uID0gdHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycgPyBjb25maWcgOiBfY29uZmlnLnNsaWRlOwoKICAgICAgICBpZiAoIWRhdGEpIHsKICAgICAgICAgIGRhdGEgPSBuZXcgQ2Fyb3VzZWwodGhpcywgX2NvbmZpZyk7CiAgICAgICAgICAkKHRoaXMpLmRhdGEoREFUQV9LRVksIGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdudW1iZXInKSB7CiAgICAgICAgICBkYXRhLnRvKGNvbmZpZyk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWN0aW9uID09PSAnc3RyaW5nJykgewogICAgICAgICAgaWYgKGRhdGFbYWN0aW9uXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gbWV0aG9kIG5hbWVkICInICsgYWN0aW9uICsgJyInKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGFbYWN0aW9uXSgpOwogICAgICAgIH0gZWxzZSBpZiAoX2NvbmZpZy5pbnRlcnZhbCkgewogICAgICAgICAgZGF0YS5wYXVzZSgpOwogICAgICAgICAgZGF0YS5jeWNsZSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIENhcm91c2VsLl9kYXRhQXBpQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gX2RhdGFBcGlDbGlja0hhbmRsZXIoZXZlbnQpIHsKICAgICAgdmFyIHNlbGVjdG9yID0gVXRpbC5nZXRTZWxlY3RvckZyb21FbGVtZW50KHRoaXMpOwoKICAgICAgaWYgKCFzZWxlY3RvcikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHRhcmdldCA9ICQoc2VsZWN0b3IpWzBdOwoKICAgICAgaWYgKCF0YXJnZXQgfHwgISQodGFyZ2V0KS5oYXNDbGFzcyhDbGFzc05hbWUuQ0FST1VTRUwpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgY29uZmlnID0gJC5leHRlbmQoe30sICQodGFyZ2V0KS5kYXRhKCksICQodGhpcykuZGF0YSgpKTsKICAgICAgdmFyIHNsaWRlSW5kZXggPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1zbGlkZS10bycpOwoKICAgICAgaWYgKHNsaWRlSW5kZXgpIHsKICAgICAgICBjb25maWcuaW50ZXJ2YWwgPSBmYWxzZTsKICAgICAgfQoKICAgICAgQ2Fyb3VzZWwuX2pRdWVyeUludGVyZmFjZS5jYWxsKCQodGFyZ2V0KSwgY29uZmlnKTsKCiAgICAgIGlmIChzbGlkZUluZGV4KSB7CiAgICAgICAgJCh0YXJnZXQpLmRhdGEoREFUQV9LRVkpLnRvKHNsaWRlSW5kZXgpOwogICAgICB9CgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfTsKCiAgICBfY3JlYXRlQ2xhc3MoQ2Fyb3VzZWwsIG51bGwsIFt7CiAgICAgIGtleTogJ1ZFUlNJT04nLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdEZWZhdWx0JywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIERlZmF1bHQ7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQ2Fyb3VzZWw7CiAgfSgpOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBEYXRhIEFwaSBpbXBsZW1lbnRhdGlvbgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkKGRvY3VtZW50KS5vbihFdmVudC5DTElDS19EQVRBX0FQSSwgU2VsZWN0b3IuREFUQV9TTElERSwgQ2Fyb3VzZWwuX2RhdGFBcGlDbGlja0hhbmRsZXIpOwoKICAkKHdpbmRvdykub24oRXZlbnQuTE9BRF9EQVRBX0FQSSwgZnVuY3Rpb24gKCkgewogICAgJChTZWxlY3Rvci5EQVRBX1JJREUpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICB2YXIgJGNhcm91c2VsID0gJCh0aGlzKTsKICAgICAgQ2Fyb3VzZWwuX2pRdWVyeUludGVyZmFjZS5jYWxsKCRjYXJvdXNlbCwgJGNhcm91c2VsLmRhdGEoKSk7CiAgICB9KTsKICB9KTsKCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICogalF1ZXJ5CiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICovCgogICQuZm5bTkFNRV0gPSBDYXJvdXNlbC5falF1ZXJ5SW50ZXJmYWNlOwogICQuZm5bTkFNRV0uQ29uc3RydWN0b3IgPSBDYXJvdXNlbDsKICAkLmZuW05BTUVdLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuW05BTUVdID0gSlFVRVJZX05PX0NPTkZMSUNUOwogICAgcmV0dXJuIENhcm91c2VsLl9qUXVlcnlJbnRlcmZhY2U7CiAgfTsKCiAgcmV0dXJuIENhcm91c2VsOwp9KGpRdWVyeSk7CgovKioKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogQm9vdHN0cmFwICh2NC4wLjAtYmV0YSk6IGNvbGxhcHNlLmpzCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqLwoKdmFyIENvbGxhcHNlID0gZnVuY3Rpb24gKCQpIHsKCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICogQ29uc3RhbnRzCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICovCgogIHZhciBOQU1FID0gJ2NvbGxhcHNlJzsKICB2YXIgVkVSU0lPTiA9ICc0LjAuMC1iZXRhJzsKICB2YXIgREFUQV9LRVkgPSAnYnMuY29sbGFwc2UnOwogIHZhciBFVkVOVF9LRVkgPSAnLicgKyBEQVRBX0tFWTsKICB2YXIgREFUQV9BUElfS0VZID0gJy5kYXRhLWFwaSc7CiAgdmFyIEpRVUVSWV9OT19DT05GTElDVCA9ICQuZm5bTkFNRV07CiAgdmFyIFRSQU5TSVRJT05fRFVSQVRJT04gPSA2MDA7CgogIHZhciBEZWZhdWx0ID0gewogICAgdG9nZ2xlOiB0cnVlLAogICAgcGFyZW50OiAnJwogIH07CgogIHZhciBEZWZhdWx0VHlwZSA9IHsKICAgIHRvZ2dsZTogJ2Jvb2xlYW4nLAogICAgcGFyZW50OiAnc3RyaW5nJwogIH07CgogIHZhciBFdmVudCA9IHsKICAgIFNIT1c6ICdzaG93JyArIEVWRU5UX0tFWSwKICAgIFNIT1dOOiAnc2hvd24nICsgRVZFTlRfS0VZLAogICAgSElERTogJ2hpZGUnICsgRVZFTlRfS0VZLAogICAgSElEREVOOiAnaGlkZGVuJyArIEVWRU5UX0tFWSwKICAgIENMSUNLX0RBVEFfQVBJOiAnY2xpY2snICsgRVZFTlRfS0VZICsgREFUQV9BUElfS0VZCiAgfTsKCiAgdmFyIENsYXNzTmFtZSA9IHsKICAgIFNIT1c6ICdzaG93JywKICAgIENPTExBUFNFOiAnY29sbGFwc2UnLAogICAgQ09MTEFQU0lORzogJ2NvbGxhcHNpbmcnLAogICAgQ09MTEFQU0VEOiAnY29sbGFwc2VkJwogIH07CgogIHZhciBEaW1lbnNpb24gPSB7CiAgICBXSURUSDogJ3dpZHRoJywKICAgIEhFSUdIVDogJ2hlaWdodCcKICB9OwoKICB2YXIgU2VsZWN0b3IgPSB7CiAgICBBQ1RJVkVTOiAnLnNob3csIC5jb2xsYXBzaW5nJywKICAgIERBVEFfVE9HR0xFOiAnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdJwoKICAgIC8qKgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKiBDbGFzcyBEZWZpbml0aW9uCiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAqLwoKICB9OwogIHZhciBDb2xsYXBzZSA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIENvbGxhcHNlKGVsZW1lbnQsIGNvbmZpZykgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29sbGFwc2UpOwoKICAgICAgdGhpcy5faXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50OwogICAgICB0aGlzLl9jb25maWcgPSB0aGlzLl9nZXRDb25maWcoY29uZmlnKTsKICAgICAgdGhpcy5fdHJpZ2dlckFycmF5ID0gJC5tYWtlQXJyYXkoJCgnW2RhdGEtdG9nZ2xlPSJjb2xsYXBzZSJdW2hyZWY9IiMnICsgZWxlbWVudC5pZCArICciXSwnICsgKCdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl1bZGF0YS10YXJnZXQ9IiMnICsgZWxlbWVudC5pZCArICciXScpKSk7CiAgICAgIHZhciB0YWJUb2dnbGVzID0gJChTZWxlY3Rvci5EQVRBX1RPR0dMRSk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFiVG9nZ2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBlbGVtID0gdGFiVG9nZ2xlc1tpXTsKICAgICAgICB2YXIgc2VsZWN0b3IgPSBVdGlsLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQoZWxlbSk7CiAgICAgICAgaWYgKHNlbGVjdG9yICE9PSBudWxsICYmICQoc2VsZWN0b3IpLmZpbHRlcihlbGVtZW50KS5sZW5ndGggPiAwKSB7CiAgICAgICAgICB0aGlzLl90cmlnZ2VyQXJyYXkucHVzaChlbGVtKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuX3BhcmVudCA9IHRoaXMuX2NvbmZpZy5wYXJlbnQgPyB0aGlzLl9nZXRQYXJlbnQoKSA6IG51bGw7CgogICAgICBpZiAoIXRoaXMuX2NvbmZpZy5wYXJlbnQpIHsKICAgICAgICB0aGlzLl9hZGRBcmlhQW5kQ29sbGFwc2VkQ2xhc3ModGhpcy5fZWxlbWVudCwgdGhpcy5fdHJpZ2dlckFycmF5KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX2NvbmZpZy50b2dnbGUpIHsKICAgICAgICB0aGlzLnRvZ2dsZSgpOwogICAgICB9CiAgICB9CgogICAgLy8gZ2V0dGVycwoKICAgIC8vIHB1YmxpYwoKICAgIENvbGxhcHNlLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiB0b2dnbGUoKSB7CiAgICAgIGlmICgkKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5TSE9XKSkgewogICAgICAgIHRoaXMuaGlkZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9CiAgICB9OwoKICAgIENvbGxhcHNlLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gc2hvdygpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICBpZiAodGhpcy5faXNUcmFuc2l0aW9uaW5nIHx8ICQodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYWN0aXZlcyA9IHZvaWQgMDsKICAgICAgdmFyIGFjdGl2ZXNEYXRhID0gdm9pZCAwOwoKICAgICAgaWYgKHRoaXMuX3BhcmVudCkgewogICAgICAgIGFjdGl2ZXMgPSAkLm1ha2VBcnJheSgkKHRoaXMuX3BhcmVudCkuY2hpbGRyZW4oKS5jaGlsZHJlbihTZWxlY3Rvci5BQ1RJVkVTKSk7CiAgICAgICAgaWYgKCFhY3RpdmVzLmxlbmd0aCkgewogICAgICAgICAgYWN0aXZlcyA9IG51bGw7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoYWN0aXZlcykgewogICAgICAgIGFjdGl2ZXNEYXRhID0gJChhY3RpdmVzKS5kYXRhKERBVEFfS0VZKTsKICAgICAgICBpZiAoYWN0aXZlc0RhdGEgJiYgYWN0aXZlc0RhdGEuX2lzVHJhbnNpdGlvbmluZykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHN0YXJ0RXZlbnQgPSAkLkV2ZW50KEV2ZW50LlNIT1cpOwogICAgICAkKHRoaXMuX2VsZW1lbnQpLnRyaWdnZXIoc3RhcnRFdmVudCk7CiAgICAgIGlmIChzdGFydEV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoYWN0aXZlcykgewogICAgICAgIENvbGxhcHNlLl9qUXVlcnlJbnRlcmZhY2UuY2FsbCgkKGFjdGl2ZXMpLCAnaGlkZScpOwogICAgICAgIGlmICghYWN0aXZlc0RhdGEpIHsKICAgICAgICAgICQoYWN0aXZlcykuZGF0YShEQVRBX0tFWSwgbnVsbCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5fZ2V0RGltZW5zaW9uKCk7CgogICAgICAkKHRoaXMuX2VsZW1lbnQpLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5DT0xMQVBTRSkuYWRkQ2xhc3MoQ2xhc3NOYW1lLkNPTExBUFNJTkcpOwoKICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZVtkaW1lbnNpb25dID0gMDsKCiAgICAgIGlmICh0aGlzLl90cmlnZ2VyQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgJCh0aGlzLl90cmlnZ2VyQXJyYXkpLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5DT0xMQVBTRUQpLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRUcmFuc2l0aW9uaW5nKHRydWUpOwoKICAgICAgdmFyIGNvbXBsZXRlID0gZnVuY3Rpb24gY29tcGxldGUoKSB7CiAgICAgICAgJChfdGhpczYuX2VsZW1lbnQpLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5DT0xMQVBTSU5HKS5hZGRDbGFzcyhDbGFzc05hbWUuQ09MTEFQU0UpLmFkZENsYXNzKENsYXNzTmFtZS5TSE9XKTsKCiAgICAgICAgX3RoaXM2Ll9lbGVtZW50LnN0eWxlW2RpbWVuc2lvbl0gPSAnJzsKCiAgICAgICAgX3RoaXM2LnNldFRyYW5zaXRpb25pbmcoZmFsc2UpOwoKICAgICAgICAkKF90aGlzNi5fZWxlbWVudCkudHJpZ2dlcihFdmVudC5TSE9XTik7CiAgICAgIH07CgogICAgICBpZiAoIVV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkpIHsKICAgICAgICBjb21wbGV0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGNhcGl0YWxpemVkRGltZW5zaW9uID0gZGltZW5zaW9uWzBdLnRvVXBwZXJDYXNlKCkgKyBkaW1lbnNpb24uc2xpY2UoMSk7CiAgICAgIHZhciBzY3JvbGxTaXplID0gJ3Njcm9sbCcgKyBjYXBpdGFsaXplZERpbWVuc2lvbjsKCiAgICAgICQodGhpcy5fZWxlbWVudCkub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIGNvbXBsZXRlKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChUUkFOU0lUSU9OX0RVUkFUSU9OKTsKCiAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGVbZGltZW5zaW9uXSA9IHRoaXMuX2VsZW1lbnRbc2Nyb2xsU2l6ZV0gKyAncHgnOwogICAgfTsKCiAgICBDb2xsYXBzZS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uIGhpZGUoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuX2lzVHJhbnNpdGlvbmluZyB8fCAhJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuU0hPVykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBzdGFydEV2ZW50ID0gJC5FdmVudChFdmVudC5ISURFKTsKICAgICAgJCh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKHN0YXJ0RXZlbnQpOwogICAgICBpZiAoc3RhcnRFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuX2dldERpbWVuc2lvbigpOwoKICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZVtkaW1lbnNpb25dID0gdGhpcy5fZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVtkaW1lbnNpb25dICsgJ3B4JzsKCiAgICAgIFV0aWwucmVmbG93KHRoaXMuX2VsZW1lbnQpOwoKICAgICAgJCh0aGlzLl9lbGVtZW50KS5hZGRDbGFzcyhDbGFzc05hbWUuQ09MTEFQU0lORykucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkNPTExBUFNFKS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuU0hPVyk7CgogICAgICBpZiAodGhpcy5fdHJpZ2dlckFycmF5Lmxlbmd0aCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fdHJpZ2dlckFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgdHJpZ2dlciA9IHRoaXMuX3RyaWdnZXJBcnJheVtpXTsKICAgICAgICAgIHZhciBzZWxlY3RvciA9IFV0aWwuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudCh0cmlnZ2VyKTsKICAgICAgICAgIGlmIChzZWxlY3RvciAhPT0gbnVsbCkgewogICAgICAgICAgICB2YXIgJGVsZW0gPSAkKHNlbGVjdG9yKTsKICAgICAgICAgICAgaWYgKCEkZWxlbS5oYXNDbGFzcyhDbGFzc05hbWUuU0hPVykpIHsKICAgICAgICAgICAgICAkKHRyaWdnZXIpLmFkZENsYXNzKENsYXNzTmFtZS5DT0xMQVBTRUQpLmF0dHIoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0VHJhbnNpdGlvbmluZyh0cnVlKTsKCiAgICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uIGNvbXBsZXRlKCkgewogICAgICAgIF90aGlzNy5zZXRUcmFuc2l0aW9uaW5nKGZhbHNlKTsKICAgICAgICAkKF90aGlzNy5fZWxlbWVudCkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkNPTExBUFNJTkcpLmFkZENsYXNzKENsYXNzTmFtZS5DT0xMQVBTRSkudHJpZ2dlcihFdmVudC5ISURERU4pOwogICAgICB9OwoKICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZVtkaW1lbnNpb25dID0gJyc7CgogICAgICBpZiAoIVV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkpIHsKICAgICAgICBjb21wbGV0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgJCh0aGlzLl9lbGVtZW50KS5vbmUoVXRpbC5UUkFOU0lUSU9OX0VORCwgY29tcGxldGUpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKFRSQU5TSVRJT05fRFVSQVRJT04pOwogICAgfTsKCiAgICBDb2xsYXBzZS5wcm90b3R5cGUuc2V0VHJhbnNpdGlvbmluZyA9IGZ1bmN0aW9uIHNldFRyYW5zaXRpb25pbmcoaXNUcmFuc2l0aW9uaW5nKSB7CiAgICAgIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9IGlzVHJhbnNpdGlvbmluZzsKICAgIH07CgogICAgQ29sbGFwc2UucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICAkLnJlbW92ZURhdGEodGhpcy5fZWxlbWVudCwgREFUQV9LRVkpOwoKICAgICAgdGhpcy5fY29uZmlnID0gbnVsbDsKICAgICAgdGhpcy5fcGFyZW50ID0gbnVsbDsKICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7CiAgICAgIHRoaXMuX3RyaWdnZXJBcnJheSA9IG51bGw7CiAgICAgIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9IG51bGw7CiAgICB9OwoKICAgIC8vIHByaXZhdGUKCiAgICBDb2xsYXBzZS5wcm90b3R5cGUuX2dldENvbmZpZyA9IGZ1bmN0aW9uIF9nZXRDb25maWcoY29uZmlnKSB7CiAgICAgIGNvbmZpZyA9ICQuZXh0ZW5kKHt9LCBEZWZhdWx0LCBjb25maWcpOwogICAgICBjb25maWcudG9nZ2xlID0gQm9vbGVhbihjb25maWcudG9nZ2xlKTsgLy8gY29lcmNlIHN0cmluZyB2YWx1ZXMKICAgICAgVXRpbC50eXBlQ2hlY2tDb25maWcoTkFNRSwgY29uZmlnLCBEZWZhdWx0VHlwZSk7CiAgICAgIHJldHVybiBjb25maWc7CiAgICB9OwoKICAgIENvbGxhcHNlLnByb3RvdHlwZS5fZ2V0RGltZW5zaW9uID0gZnVuY3Rpb24gX2dldERpbWVuc2lvbigpIHsKICAgICAgdmFyIGhhc1dpZHRoID0gJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhEaW1lbnNpb24uV0lEVEgpOwogICAgICByZXR1cm4gaGFzV2lkdGggPyBEaW1lbnNpb24uV0lEVEggOiBEaW1lbnNpb24uSEVJR0hUOwogICAgfTsKCiAgICBDb2xsYXBzZS5wcm90b3R5cGUuX2dldFBhcmVudCA9IGZ1bmN0aW9uIF9nZXRQYXJlbnQoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgdmFyIHBhcmVudCA9ICQodGhpcy5fY29uZmlnLnBhcmVudClbMF07CiAgICAgIHZhciBzZWxlY3RvciA9ICdbZGF0YS10b2dnbGU9ImNvbGxhcHNlIl1bZGF0YS1wYXJlbnQ9IicgKyB0aGlzLl9jb25maWcucGFyZW50ICsgJyJdJzsKCiAgICAgICQocGFyZW50KS5maW5kKHNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uIChpLCBlbGVtZW50KSB7CiAgICAgICAgX3RoaXM4Ll9hZGRBcmlhQW5kQ29sbGFwc2VkQ2xhc3MoQ29sbGFwc2UuX2dldFRhcmdldEZyb21FbGVtZW50KGVsZW1lbnQpLCBbZWxlbWVudF0pOwogICAgICB9KTsKCiAgICAgIHJldHVybiBwYXJlbnQ7CiAgICB9OwoKICAgIENvbGxhcHNlLnByb3RvdHlwZS5fYWRkQXJpYUFuZENvbGxhcHNlZENsYXNzID0gZnVuY3Rpb24gX2FkZEFyaWFBbmRDb2xsYXBzZWRDbGFzcyhlbGVtZW50LCB0cmlnZ2VyQXJyYXkpIHsKICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICB2YXIgaXNPcGVuID0gJChlbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuU0hPVyk7CgogICAgICAgIGlmICh0cmlnZ2VyQXJyYXkubGVuZ3RoKSB7CiAgICAgICAgICAkKHRyaWdnZXJBcnJheSkudG9nZ2xlQ2xhc3MoQ2xhc3NOYW1lLkNPTExBUFNFRCwgIWlzT3BlbikuYXR0cignYXJpYS1leHBhbmRlZCcsIGlzT3Blbik7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vIHN0YXRpYwoKICAgIENvbGxhcHNlLl9nZXRUYXJnZXRGcm9tRWxlbWVudCA9IGZ1bmN0aW9uIF9nZXRUYXJnZXRGcm9tRWxlbWVudChlbGVtZW50KSB7CiAgICAgIHZhciBzZWxlY3RvciA9IFV0aWwuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudChlbGVtZW50KTsKICAgICAgcmV0dXJuIHNlbGVjdG9yID8gJChzZWxlY3RvcilbMF0gOiBudWxsOwogICAgfTsKCiAgICBDb2xsYXBzZS5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICB2YXIgZGF0YSA9ICR0aGlzLmRhdGEoREFUQV9LRVkpOwogICAgICAgIHZhciBfY29uZmlnID0gJC5leHRlbmQoe30sIERlZmF1bHQsICR0aGlzLmRhdGEoKSwgKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbmZpZykpID09PSAnb2JqZWN0JyAmJiBjb25maWcpOwoKICAgICAgICBpZiAoIWRhdGEgJiYgX2NvbmZpZy50b2dnbGUgJiYgL3Nob3d8aGlkZS8udGVzdChjb25maWcpKSB7CiAgICAgICAgICBfY29uZmlnLnRvZ2dsZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICBkYXRhID0gbmV3IENvbGxhcHNlKHRoaXMsIF9jb25maWcpOwogICAgICAgICAgJHRoaXMuZGF0YShEQVRBX0tFWSwgZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGlmIChkYXRhW2NvbmZpZ10gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIG1ldGhvZCBuYW1lZCAiJyArIGNvbmZpZyArICciJyk7CiAgICAgICAgICB9CiAgICAgICAgICBkYXRhW2NvbmZpZ10oKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICBfY3JlYXRlQ2xhc3MoQ29sbGFwc2UsIG51bGwsIFt7CiAgICAgIGtleTogJ1ZFUlNJT04nLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdEZWZhdWx0JywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIERlZmF1bHQ7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQ29sbGFwc2U7CiAgfSgpOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBEYXRhIEFwaSBpbXBsZW1lbnRhdGlvbgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkKGRvY3VtZW50KS5vbihFdmVudC5DTElDS19EQVRBX0FQSSwgU2VsZWN0b3IuREFUQV9UT0dHTEUsIGZ1bmN0aW9uIChldmVudCkgewogICAgaWYgKCEvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KGV2ZW50LnRhcmdldC50YWdOYW1lKSkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQoKICAgIHZhciAkdHJpZ2dlciA9ICQodGhpcyk7CiAgICB2YXIgc2VsZWN0b3IgPSBVdGlsLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQodGhpcyk7CiAgICAkKHNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyICR0YXJnZXQgPSAkKHRoaXMpOwogICAgICB2YXIgZGF0YSA9ICR0YXJnZXQuZGF0YShEQVRBX0tFWSk7CiAgICAgIHZhciBjb25maWcgPSBkYXRhID8gJ3RvZ2dsZScgOiAkdHJpZ2dlci5kYXRhKCk7CiAgICAgIENvbGxhcHNlLl9qUXVlcnlJbnRlcmZhY2UuY2FsbCgkdGFyZ2V0LCBjb25maWcpOwogICAgfSk7CiAgfSk7CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIGpRdWVyeQogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkLmZuW05BTUVdID0gQ29sbGFwc2UuX2pRdWVyeUludGVyZmFjZTsKICAkLmZuW05BTUVdLkNvbnN0cnVjdG9yID0gQ29sbGFwc2U7CiAgJC5mbltOQU1FXS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbltOQU1FXSA9IEpRVUVSWV9OT19DT05GTElDVDsKICAgIHJldHVybiBDb2xsYXBzZS5falF1ZXJ5SW50ZXJmYWNlOwogIH07CgogIHJldHVybiBDb2xsYXBzZTsKfShqUXVlcnkpOwoKLyogZ2xvYmFsIFBvcHBlciAqLwoKLyoqCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqIEJvb3RzdHJhcCAodjQuMC4wLWJldGEpOiBkcm9wZG93bi5qcwogKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKQogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKi8KCnZhciBEcm9wZG93biA9IGZ1bmN0aW9uICgkKSB7CgogIC8qKgogICAqIENoZWNrIGZvciBQb3BwZXIgZGVwZW5kZW5jeQogICAqIFBvcHBlciAtIGh0dHBzOi8vcG9wcGVyLmpzLm9yZwogICAqLwogIGlmICh0eXBlb2YgUG9wcGVyID09PSAndW5kZWZpbmVkJykgewogICAgdGhyb3cgbmV3IEVycm9yKCdCb290c3RyYXAgZHJvcGRvd24gcmVxdWlyZSBQb3BwZXIuanMgKGh0dHBzOi8vcG9wcGVyLmpzLm9yZyknKTsKICB9CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIENvbnN0YW50cwogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICB2YXIgTkFNRSA9ICdkcm9wZG93bic7CiAgdmFyIFZFUlNJT04gPSAnNC4wLjAtYmV0YSc7CiAgdmFyIERBVEFfS0VZID0gJ2JzLmRyb3Bkb3duJzsKICB2YXIgRVZFTlRfS0VZID0gJy4nICsgREFUQV9LRVk7CiAgdmFyIERBVEFfQVBJX0tFWSA9ICcuZGF0YS1hcGknOwogIHZhciBKUVVFUllfTk9fQ09ORkxJQ1QgPSAkLmZuW05BTUVdOwogIHZhciBFU0NBUEVfS0VZQ09ERSA9IDI3OyAvLyBLZXlib2FyZEV2ZW50LndoaWNoIHZhbHVlIGZvciBFc2NhcGUgKEVzYykga2V5CiAgdmFyIFNQQUNFX0tFWUNPREUgPSAzMjsgLy8gS2V5Ym9hcmRFdmVudC53aGljaCB2YWx1ZSBmb3Igc3BhY2Uga2V5CiAgdmFyIFRBQl9LRVlDT0RFID0gOTsgLy8gS2V5Ym9hcmRFdmVudC53aGljaCB2YWx1ZSBmb3IgdGFiIGtleQogIHZhciBBUlJPV19VUF9LRVlDT0RFID0gMzg7IC8vIEtleWJvYXJkRXZlbnQud2hpY2ggdmFsdWUgZm9yIHVwIGFycm93IGtleQogIHZhciBBUlJPV19ET1dOX0tFWUNPREUgPSA0MDsgLy8gS2V5Ym9hcmRFdmVudC53aGljaCB2YWx1ZSBmb3IgZG93biBhcnJvdyBrZXkKICB2YXIgUklHSFRfTU9VU0VfQlVUVE9OX1dISUNIID0gMzsgLy8gTW91c2VFdmVudC53aGljaCB2YWx1ZSBmb3IgdGhlIHJpZ2h0IGJ1dHRvbiAoYXNzdW1pbmcgYSByaWdodC1oYW5kZWQgbW91c2UpCiAgdmFyIFJFR0VYUF9LRVlET1dOID0gbmV3IFJlZ0V4cChBUlJPV19VUF9LRVlDT0RFICsgJ3wnICsgQVJST1dfRE9XTl9LRVlDT0RFICsgJ3wnICsgRVNDQVBFX0tFWUNPREUpOwoKICB2YXIgRXZlbnQgPSB7CiAgICBISURFOiAnaGlkZScgKyBFVkVOVF9LRVksCiAgICBISURERU46ICdoaWRkZW4nICsgRVZFTlRfS0VZLAogICAgU0hPVzogJ3Nob3cnICsgRVZFTlRfS0VZLAogICAgU0hPV046ICdzaG93bicgKyBFVkVOVF9LRVksCiAgICBDTElDSzogJ2NsaWNrJyArIEVWRU5UX0tFWSwKICAgIENMSUNLX0RBVEFfQVBJOiAnY2xpY2snICsgRVZFTlRfS0VZICsgREFUQV9BUElfS0VZLAogICAgS0VZRE9XTl9EQVRBX0FQSTogJ2tleWRvd24nICsgRVZFTlRfS0VZICsgREFUQV9BUElfS0VZLAogICAgS0VZVVBfREFUQV9BUEk6ICdrZXl1cCcgKyBFVkVOVF9LRVkgKyBEQVRBX0FQSV9LRVkKICB9OwoKICB2YXIgQ2xhc3NOYW1lID0gewogICAgRElTQUJMRUQ6ICdkaXNhYmxlZCcsCiAgICBTSE9XOiAnc2hvdycsCiAgICBEUk9QVVA6ICdkcm9wdXAnLAogICAgTUVOVVJJR0hUOiAnZHJvcGRvd24tbWVudS1yaWdodCcsCiAgICBNRU5VTEVGVDogJ2Ryb3Bkb3duLW1lbnUtbGVmdCcKICB9OwoKICB2YXIgU2VsZWN0b3IgPSB7CiAgICBEQVRBX1RPR0dMRTogJ1tkYXRhLXRvZ2dsZT0iZHJvcGRvd24iXScsCiAgICBGT1JNX0NISUxEOiAnLmRyb3Bkb3duIGZvcm0nLAogICAgTUVOVTogJy5kcm9wZG93bi1tZW51JywKICAgIE5BVkJBUl9OQVY6ICcubmF2YmFyLW5hdicsCiAgICBWSVNJQkxFX0lURU1TOiAnLmRyb3Bkb3duLW1lbnUgLmRyb3Bkb3duLWl0ZW06bm90KC5kaXNhYmxlZCknCiAgfTsKCiAgdmFyIEF0dGFjaG1lbnRNYXAgPSB7CiAgICBUT1A6ICd0b3Atc3RhcnQnLAogICAgVE9QRU5EOiAndG9wLWVuZCcsCiAgICBCT1RUT006ICdib3R0b20tc3RhcnQnLAogICAgQk9UVE9NRU5EOiAnYm90dG9tLWVuZCcKICB9OwoKICB2YXIgRGVmYXVsdCA9IHsKICAgIHBsYWNlbWVudDogQXR0YWNobWVudE1hcC5CT1RUT00sCiAgICBvZmZzZXQ6IDAsCiAgICBmbGlwOiB0cnVlCiAgfTsKCiAgdmFyIERlZmF1bHRUeXBlID0gewogICAgcGxhY2VtZW50OiAnc3RyaW5nJywKICAgIG9mZnNldDogJyhudW1iZXJ8c3RyaW5nKScsCiAgICBmbGlwOiAnYm9vbGVhbicKCiAgICAvKioKICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICogQ2xhc3MgRGVmaW5pdGlvbgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKi8KCiAgfTsKICB2YXIgRHJvcGRvd24gPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBEcm9wZG93bihlbGVtZW50LCBjb25maWcpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERyb3Bkb3duKTsKCiAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50OwogICAgICB0aGlzLl9wb3BwZXIgPSBudWxsOwogICAgICB0aGlzLl9jb25maWcgPSB0aGlzLl9nZXRDb25maWcoY29uZmlnKTsKICAgICAgdGhpcy5fbWVudSA9IHRoaXMuX2dldE1lbnVFbGVtZW50KCk7CiAgICAgIHRoaXMuX2luTmF2YmFyID0gdGhpcy5fZGV0ZWN0TmF2YmFyKCk7CgogICAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpOwogICAgfQoKICAgIC8vIGdldHRlcnMKCiAgICAvLyBwdWJsaWMKCiAgICBEcm9wZG93bi5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24gdG9nZ2xlKCkgewogICAgICBpZiAodGhpcy5fZWxlbWVudC5kaXNhYmxlZCB8fCAkKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5ESVNBQkxFRCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBwYXJlbnQgPSBEcm9wZG93bi5fZ2V0UGFyZW50RnJvbUVsZW1lbnQodGhpcy5fZWxlbWVudCk7CiAgICAgIHZhciBpc0FjdGl2ZSA9ICQodGhpcy5fbWVudSkuaGFzQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpOwoKICAgICAgRHJvcGRvd24uX2NsZWFyTWVudXMoKTsKCiAgICAgIGlmIChpc0FjdGl2ZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHJlbGF0ZWRUYXJnZXQgPSB7CiAgICAgICAgcmVsYXRlZFRhcmdldDogdGhpcy5fZWxlbWVudAogICAgICB9OwogICAgICB2YXIgc2hvd0V2ZW50ID0gJC5FdmVudChFdmVudC5TSE9XLCByZWxhdGVkVGFyZ2V0KTsKCiAgICAgICQocGFyZW50KS50cmlnZ2VyKHNob3dFdmVudCk7CgogICAgICBpZiAoc2hvd0V2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZWxlbWVudCA9IHRoaXMuX2VsZW1lbnQ7CiAgICAgIC8vIGZvciBkcm9wdXAgd2l0aCBhbGlnbm1lbnQgd2UgdXNlIHRoZSBwYXJlbnQgYXMgcG9wcGVyIGNvbnRhaW5lcgogICAgICBpZiAoJChwYXJlbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5EUk9QVVApKSB7CiAgICAgICAgaWYgKCQodGhpcy5fbWVudSkuaGFzQ2xhc3MoQ2xhc3NOYW1lLk1FTlVMRUZUKSB8fCAkKHRoaXMuX21lbnUpLmhhc0NsYXNzKENsYXNzTmFtZS5NRU5VUklHSFQpKSB7CiAgICAgICAgICBlbGVtZW50ID0gcGFyZW50OwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLl9wb3BwZXIgPSBuZXcgUG9wcGVyKGVsZW1lbnQsIHRoaXMuX21lbnUsIHRoaXMuX2dldFBvcHBlckNvbmZpZygpKTsKCiAgICAgIC8vIGlmIHRoaXMgaXMgYSB0b3VjaC1lbmFibGVkIGRldmljZSB3ZSBhZGQgZXh0cmEKICAgICAgLy8gZW1wdHkgbW91c2VvdmVyIGxpc3RlbmVycyB0byB0aGUgYm9keSdzIGltbWVkaWF0ZSBjaGlsZHJlbjsKICAgICAgLy8gb25seSBuZWVkZWQgYmVjYXVzZSBvZiBicm9rZW4gZXZlbnQgZGVsZWdhdGlvbiBvbiBpT1MKICAgICAgLy8gaHR0cHM6Ly93d3cucXVpcmtzbW9kZS5vcmcvYmxvZy9hcmNoaXZlcy8yMDE0LzAyL21vdXNlX2V2ZW50X2J1Yi5odG1sCiAgICAgIGlmICgnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgISQocGFyZW50KS5jbG9zZXN0KFNlbGVjdG9yLk5BVkJBUl9OQVYpLmxlbmd0aCkgewogICAgICAgICQoJ2JvZHknKS5jaGlsZHJlbigpLm9uKCdtb3VzZW92ZXInLCBudWxsLCAkLm5vb3ApOwogICAgICB9CgogICAgICB0aGlzLl9lbGVtZW50LmZvY3VzKCk7CiAgICAgIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSk7CgogICAgICAkKHRoaXMuX21lbnUpLnRvZ2dsZUNsYXNzKENsYXNzTmFtZS5TSE9XKTsKICAgICAgJChwYXJlbnQpLnRvZ2dsZUNsYXNzKENsYXNzTmFtZS5TSE9XKS50cmlnZ2VyKCQuRXZlbnQoRXZlbnQuU0hPV04sIHJlbGF0ZWRUYXJnZXQpKTsKICAgIH07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICAkLnJlbW92ZURhdGEodGhpcy5fZWxlbWVudCwgREFUQV9LRVkpOwogICAgICAkKHRoaXMuX2VsZW1lbnQpLm9mZihFVkVOVF9LRVkpOwogICAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDsKICAgICAgdGhpcy5fbWVudSA9IG51bGw7CiAgICAgIGlmICh0aGlzLl9wb3BwZXIgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9wb3BwZXIuZGVzdHJveSgpOwogICAgICB9CiAgICAgIHRoaXMuX3BvcHBlciA9IG51bGw7CiAgICB9OwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2luTmF2YmFyID0gdGhpcy5fZGV0ZWN0TmF2YmFyKCk7CiAgICAgIGlmICh0aGlzLl9wb3BwZXIgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9wb3BwZXIuc2NoZWR1bGVVcGRhdGUoKTsKICAgICAgfQogICAgfTsKCiAgICAvLyBwcml2YXRlCgogICAgRHJvcGRvd24ucHJvdG90eXBlLl9hZGRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uIF9hZGRFdmVudExpc3RlbmVycygpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICAkKHRoaXMuX2VsZW1lbnQpLm9uKEV2ZW50LkNMSUNLLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIF90aGlzOS50b2dnbGUoKTsKICAgICAgfSk7CiAgICB9OwoKICAgIERyb3Bkb3duLnByb3RvdHlwZS5fZ2V0Q29uZmlnID0gZnVuY3Rpb24gX2dldENvbmZpZyhjb25maWcpIHsKICAgICAgdmFyIGVsZW1lbnREYXRhID0gJCh0aGlzLl9lbGVtZW50KS5kYXRhKCk7CiAgICAgIGlmIChlbGVtZW50RGF0YS5wbGFjZW1lbnQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGVsZW1lbnREYXRhLnBsYWNlbWVudCA9IEF0dGFjaG1lbnRNYXBbZWxlbWVudERhdGEucGxhY2VtZW50LnRvVXBwZXJDYXNlKCldOwogICAgICB9CgogICAgICBjb25maWcgPSAkLmV4dGVuZCh7fSwgdGhpcy5jb25zdHJ1Y3Rvci5EZWZhdWx0LCAkKHRoaXMuX2VsZW1lbnQpLmRhdGEoKSwgY29uZmlnKTsKCiAgICAgIFV0aWwudHlwZUNoZWNrQ29uZmlnKE5BTUUsIGNvbmZpZywgdGhpcy5jb25zdHJ1Y3Rvci5EZWZhdWx0VHlwZSk7CgogICAgICByZXR1cm4gY29uZmlnOwogICAgfTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuX2dldE1lbnVFbGVtZW50ID0gZnVuY3Rpb24gX2dldE1lbnVFbGVtZW50KCkgewogICAgICBpZiAoIXRoaXMuX21lbnUpIHsKICAgICAgICB2YXIgcGFyZW50ID0gRHJvcGRvd24uX2dldFBhcmVudEZyb21FbGVtZW50KHRoaXMuX2VsZW1lbnQpOwogICAgICAgIHRoaXMuX21lbnUgPSAkKHBhcmVudCkuZmluZChTZWxlY3Rvci5NRU5VKVswXTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fbWVudTsKICAgIH07CgogICAgRHJvcGRvd24ucHJvdG90eXBlLl9nZXRQbGFjZW1lbnQgPSBmdW5jdGlvbiBfZ2V0UGxhY2VtZW50KCkgewogICAgICB2YXIgJHBhcmVudERyb3Bkb3duID0gJCh0aGlzLl9lbGVtZW50KS5wYXJlbnQoKTsKICAgICAgdmFyIHBsYWNlbWVudCA9IHRoaXMuX2NvbmZpZy5wbGFjZW1lbnQ7CgogICAgICAvLyBIYW5kbGUgZHJvcHVwCiAgICAgIGlmICgkcGFyZW50RHJvcGRvd24uaGFzQ2xhc3MoQ2xhc3NOYW1lLkRST1BVUCkgfHwgdGhpcy5fY29uZmlnLnBsYWNlbWVudCA9PT0gQXR0YWNobWVudE1hcC5UT1ApIHsKICAgICAgICBwbGFjZW1lbnQgPSBBdHRhY2htZW50TWFwLlRPUDsKICAgICAgICBpZiAoJCh0aGlzLl9tZW51KS5oYXNDbGFzcyhDbGFzc05hbWUuTUVOVVJJR0hUKSkgewogICAgICAgICAgcGxhY2VtZW50ID0gQXR0YWNobWVudE1hcC5UT1BFTkQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCQodGhpcy5fbWVudSkuaGFzQ2xhc3MoQ2xhc3NOYW1lLk1FTlVSSUdIVCkpIHsKICAgICAgICBwbGFjZW1lbnQgPSBBdHRhY2htZW50TWFwLkJPVFRPTUVORDsKICAgICAgfQogICAgICByZXR1cm4gcGxhY2VtZW50OwogICAgfTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuX2RldGVjdE5hdmJhciA9IGZ1bmN0aW9uIF9kZXRlY3ROYXZiYXIoKSB7CiAgICAgIHJldHVybiAkKHRoaXMuX2VsZW1lbnQpLmNsb3Nlc3QoJy5uYXZiYXInKS5sZW5ndGggPiAwOwogICAgfTsKCiAgICBEcm9wZG93bi5wcm90b3R5cGUuX2dldFBvcHBlckNvbmZpZyA9IGZ1bmN0aW9uIF9nZXRQb3BwZXJDb25maWcoKSB7CiAgICAgIHZhciBwb3BwZXJDb25maWcgPSB7CiAgICAgICAgcGxhY2VtZW50OiB0aGlzLl9nZXRQbGFjZW1lbnQoKSwKICAgICAgICBtb2RpZmllcnM6IHsKICAgICAgICAgIG9mZnNldDogewogICAgICAgICAgICBvZmZzZXQ6IHRoaXMuX2NvbmZpZy5vZmZzZXQKICAgICAgICAgIH0sCiAgICAgICAgICBmbGlwOiB7CiAgICAgICAgICAgIGVuYWJsZWQ6IHRoaXMuX2NvbmZpZy5mbGlwCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBEaXNhYmxlIFBvcHBlci5qcyBmb3IgRHJvcGRvd24gaW4gTmF2YmFyCiAgICAgIH07aWYgKHRoaXMuX2luTmF2YmFyKSB7CiAgICAgICAgcG9wcGVyQ29uZmlnLm1vZGlmaWVycy5hcHBseVN0eWxlID0gewogICAgICAgICAgZW5hYmxlZDogIXRoaXMuX2luTmF2YmFyCiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gcG9wcGVyQ29uZmlnOwogICAgfTsKCiAgICAvLyBzdGF0aWMKCiAgICBEcm9wZG93bi5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoREFUQV9LRVkpOwogICAgICAgIHZhciBfY29uZmlnID0gKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbmZpZykpID09PSAnb2JqZWN0JyA\/IGNvbmZpZyA6IG51bGw7CgogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgZGF0YSA9IG5ldyBEcm9wZG93bih0aGlzLCBfY29uZmlnKTsKICAgICAgICAgICQodGhpcykuZGF0YShEQVRBX0tFWSwgZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGlmIChkYXRhW2NvbmZpZ10gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIG1ldGhvZCBuYW1lZCAiJyArIGNvbmZpZyArICciJyk7CiAgICAgICAgICB9CiAgICAgICAgICBkYXRhW2NvbmZpZ10oKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICBEcm9wZG93bi5fY2xlYXJNZW51cyA9IGZ1bmN0aW9uIF9jbGVhck1lbnVzKGV2ZW50KSB7CiAgICAgIGlmIChldmVudCAmJiAoZXZlbnQud2hpY2ggPT09IFJJR0hUX01PVVNFX0JVVFRPTl9XSElDSCB8fCBldmVudC50eXBlID09PSAna2V5dXAnICYmIGV2ZW50LndoaWNoICE9PSBUQUJfS0VZQ09ERSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB0b2dnbGVzID0gJC5tYWtlQXJyYXkoJChTZWxlY3Rvci5EQVRBX1RPR0dMRSkpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRvZ2dsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgcGFyZW50ID0gRHJvcGRvd24uX2dldFBhcmVudEZyb21FbGVtZW50KHRvZ2dsZXNbaV0pOwogICAgICAgIHZhciBjb250ZXh0ID0gJCh0b2dnbGVzW2ldKS5kYXRhKERBVEFfS0VZKTsKICAgICAgICB2YXIgcmVsYXRlZFRhcmdldCA9IHsKICAgICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHRvZ2dsZXNbaV0KICAgICAgICB9OwoKICAgICAgICBpZiAoIWNvbnRleHQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRyb3Bkb3duTWVudSA9IGNvbnRleHQuX21lbnU7CiAgICAgICAgaWYgKCEkKHBhcmVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmIChldmVudCAmJiAoZXZlbnQudHlwZSA9PT0gJ2NsaWNrJyAmJiAvaW5wdXR8dGV4dGFyZWEvaS50ZXN0KGV2ZW50LnRhcmdldC50YWdOYW1lKSB8fCBldmVudC50eXBlID09PSAna2V5dXAnICYmIGV2ZW50LndoaWNoID09PSBUQUJfS0VZQ09ERSkgJiYgJC5jb250YWlucyhwYXJlbnQsIGV2ZW50LnRhcmdldCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGhpZGVFdmVudCA9ICQuRXZlbnQoRXZlbnQuSElERSwgcmVsYXRlZFRhcmdldCk7CiAgICAgICAgJChwYXJlbnQpLnRyaWdnZXIoaGlkZUV2ZW50KTsKICAgICAgICBpZiAoaGlkZUV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSB0b3VjaC1lbmFibGVkIGRldmljZSB3ZSByZW1vdmUgdGhlIGV4dHJhCiAgICAgICAgLy8gZW1wdHkgbW91c2VvdmVyIGxpc3RlbmVycyB3ZSBhZGRlZCBmb3IgaU9TIHN1cHBvcnQKICAgICAgICBpZiAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgICAgICAkKCdib2R5JykuY2hpbGRyZW4oKS5vZmYoJ21vdXNlb3ZlcicsIG51bGwsICQubm9vcCk7CiAgICAgICAgfQoKICAgICAgICB0b2dnbGVzW2ldLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICdmYWxzZScpOwoKICAgICAgICAkKGRyb3Bkb3duTWVudSkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpOwogICAgICAgICQocGFyZW50KS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuU0hPVykudHJpZ2dlcigkLkV2ZW50KEV2ZW50LkhJRERFTiwgcmVsYXRlZFRhcmdldCkpOwogICAgICB9CiAgICB9OwoKICAgIERyb3Bkb3duLl9nZXRQYXJlbnRGcm9tRWxlbWVudCA9IGZ1bmN0aW9uIF9nZXRQYXJlbnRGcm9tRWxlbWVudChlbGVtZW50KSB7CiAgICAgIHZhciBwYXJlbnQgPSB2b2lkIDA7CiAgICAgIHZhciBzZWxlY3RvciA9IFV0aWwuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudChlbGVtZW50KTsKCiAgICAgIGlmIChzZWxlY3RvcikgewogICAgICAgIHBhcmVudCA9ICQoc2VsZWN0b3IpWzBdOwogICAgICB9CgogICAgICByZXR1cm4gcGFyZW50IHx8IGVsZW1lbnQucGFyZW50Tm9kZTsKICAgIH07CgogICAgRHJvcGRvd24uX2RhdGFBcGlLZXlkb3duSGFuZGxlciA9IGZ1bmN0aW9uIF9kYXRhQXBpS2V5ZG93bkhhbmRsZXIoZXZlbnQpIHsKICAgICAgaWYgKCFSRUdFWFBfS0VZRE9XTi50ZXN0KGV2ZW50LndoaWNoKSB8fCAvYnV0dG9uL2kudGVzdChldmVudC50YXJnZXQudGFnTmFtZSkgJiYgZXZlbnQud2hpY2ggPT09IFNQQUNFX0tFWUNPREUgfHwgL2lucHV0fHRleHRhcmVhL2kudGVzdChldmVudC50YXJnZXQudGFnTmFtZSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgaWYgKHRoaXMuZGlzYWJsZWQgfHwgJCh0aGlzKS5oYXNDbGFzcyhDbGFzc05hbWUuRElTQUJMRUQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGFyZW50ID0gRHJvcGRvd24uX2dldFBhcmVudEZyb21FbGVtZW50KHRoaXMpOwogICAgICB2YXIgaXNBY3RpdmUgPSAkKHBhcmVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpOwoKICAgICAgaWYgKCFpc0FjdGl2ZSAmJiAoZXZlbnQud2hpY2ggIT09IEVTQ0FQRV9LRVlDT0RFIHx8IGV2ZW50LndoaWNoICE9PSBTUEFDRV9LRVlDT0RFKSB8fCBpc0FjdGl2ZSAmJiAoZXZlbnQud2hpY2ggPT09IEVTQ0FQRV9LRVlDT0RFIHx8IGV2ZW50LndoaWNoID09PSBTUEFDRV9LRVlDT0RFKSkgewoKICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IEVTQ0FQRV9LRVlDT0RFKSB7CiAgICAgICAgICB2YXIgdG9nZ2xlID0gJChwYXJlbnQpLmZpbmQoU2VsZWN0b3IuREFUQV9UT0dHTEUpWzBdOwogICAgICAgICAgJCh0b2dnbGUpLnRyaWdnZXIoJ2ZvY3VzJyk7CiAgICAgICAgfQoKICAgICAgICAkKHRoaXMpLnRyaWdnZXIoJ2NsaWNrJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgaXRlbXMgPSAkKHBhcmVudCkuZmluZChTZWxlY3Rvci5WSVNJQkxFX0lURU1TKS5nZXQoKTsKCiAgICAgIGlmICghaXRlbXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgaW5kZXggPSBpdGVtcy5pbmRleE9mKGV2ZW50LnRhcmdldCk7CgogICAgICBpZiAoZXZlbnQud2hpY2ggPT09IEFSUk9XX1VQX0tFWUNPREUgJiYgaW5kZXggPiAwKSB7CiAgICAgICAgLy8gdXAKICAgICAgICBpbmRleC0tOwogICAgICB9CgogICAgICBpZiAoZXZlbnQud2hpY2ggPT09IEFSUk9XX0RPV05fS0VZQ09ERSAmJiBpbmRleCA8IGl0ZW1zLmxlbmd0aCAtIDEpIHsKICAgICAgICAvLyBkb3duCiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGluZGV4IDwgMCkgewogICAgICAgIGluZGV4ID0gMDsKICAgICAgfQoKICAgICAgaXRlbXNbaW5kZXhdLmZvY3VzKCk7CiAgICB9OwoKICAgIF9jcmVhdGVDbGFzcyhEcm9wZG93biwgbnVsbCwgW3sKICAgICAga2V5OiAnVkVSU0lPTicsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBWRVJTSU9OOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ0RlZmF1bHQnLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gRGVmYXVsdDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdEZWZhdWx0VHlwZScsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBEZWZhdWx0VHlwZTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBEcm9wZG93bjsKICB9KCk7CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIERhdGEgQXBpIGltcGxlbWVudGF0aW9uCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICovCgogICQoZG9jdW1lbnQpLm9uKEV2ZW50LktFWURPV05fREFUQV9BUEksIFNlbGVjdG9yLkRBVEFfVE9HR0xFLCBEcm9wZG93bi5fZGF0YUFwaUtleWRvd25IYW5kbGVyKS5vbihFdmVudC5LRVlET1dOX0RBVEFfQVBJLCBTZWxlY3Rvci5NRU5VLCBEcm9wZG93bi5fZGF0YUFwaUtleWRvd25IYW5kbGVyKS5vbihFdmVudC5DTElDS19EQVRBX0FQSSArICcgJyArIEV2ZW50LktFWVVQX0RBVEFfQVBJLCBEcm9wZG93bi5fY2xlYXJNZW51cykub24oRXZlbnQuQ0xJQ0tfREFUQV9BUEksIFNlbGVjdG9yLkRBVEFfVE9HR0xFLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIERyb3Bkb3duLl9qUXVlcnlJbnRlcmZhY2UuY2FsbCgkKHRoaXMpLCAndG9nZ2xlJyk7CiAgfSkub24oRXZlbnQuQ0xJQ0tfREFUQV9BUEksIFNlbGVjdG9yLkZPUk1fQ0hJTEQsIGZ1bmN0aW9uIChlKSB7CiAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogIH0pOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBqUXVlcnkKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgJC5mbltOQU1FXSA9IERyb3Bkb3duLl9qUXVlcnlJbnRlcmZhY2U7CiAgJC5mbltOQU1FXS5Db25zdHJ1Y3RvciA9IERyb3Bkb3duOwogICQuZm5bTkFNRV0ubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICQuZm5bTkFNRV0gPSBKUVVFUllfTk9fQ09ORkxJQ1Q7CiAgICByZXR1cm4gRHJvcGRvd24uX2pRdWVyeUludGVyZmFjZTsKICB9OwoKICByZXR1cm4gRHJvcGRvd247Cn0oalF1ZXJ5KTsKCi8qKgogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiBCb290c3RyYXAgKHY0LjAuMC1iZXRhKTogbW9kYWwuanMKICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICovCgp2YXIgTW9kYWwgPSBmdW5jdGlvbiAoJCkgewoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBDb25zdGFudHMKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgdmFyIE5BTUUgPSAnbW9kYWwnOwogIHZhciBWRVJTSU9OID0gJzQuMC4wLWJldGEnOwogIHZhciBEQVRBX0tFWSA9ICdicy5tb2RhbCc7CiAgdmFyIEVWRU5UX0tFWSA9ICcuJyArIERBVEFfS0VZOwogIHZhciBEQVRBX0FQSV9LRVkgPSAnLmRhdGEtYXBpJzsKICB2YXIgSlFVRVJZX05PX0NPTkZMSUNUID0gJC5mbltOQU1FXTsKICB2YXIgVFJBTlNJVElPTl9EVVJBVElPTiA9IDMwMDsKICB2YXIgQkFDS0RST1BfVFJBTlNJVElPTl9EVVJBVElPTiA9IDE1MDsKICB2YXIgRVNDQVBFX0tFWUNPREUgPSAyNzsgLy8gS2V5Ym9hcmRFdmVudC53aGljaCB2YWx1ZSBmb3IgRXNjYXBlIChFc2MpIGtleQoKICB2YXIgRGVmYXVsdCA9IHsKICAgIGJhY2tkcm9wOiB0cnVlLAogICAga2V5Ym9hcmQ6IHRydWUsCiAgICBmb2N1czogdHJ1ZSwKICAgIHNob3c6IHRydWUKICB9OwoKICB2YXIgRGVmYXVsdFR5cGUgPSB7CiAgICBiYWNrZHJvcDogJyhib29sZWFufHN0cmluZyknLAogICAga2V5Ym9hcmQ6ICdib29sZWFuJywKICAgIGZvY3VzOiAnYm9vbGVhbicsCiAgICBzaG93OiAnYm9vbGVhbicKICB9OwoKICB2YXIgRXZlbnQgPSB7CiAgICBISURFOiAnaGlkZScgKyBFVkVOVF9LRVksCiAgICBISURERU46ICdoaWRkZW4nICsgRVZFTlRfS0VZLAogICAgU0hPVzogJ3Nob3cnICsgRVZFTlRfS0VZLAogICAgU0hPV046ICdzaG93bicgKyBFVkVOVF9LRVksCiAgICBGT0NVU0lOOiAnZm9jdXNpbicgKyBFVkVOVF9LRVksCiAgICBSRVNJWkU6ICdyZXNpemUnICsgRVZFTlRfS0VZLAogICAgQ0xJQ0tfRElTTUlTUzogJ2NsaWNrLmRpc21pc3MnICsgRVZFTlRfS0VZLAogICAgS0VZRE9XTl9ESVNNSVNTOiAna2V5ZG93bi5kaXNtaXNzJyArIEVWRU5UX0tFWSwKICAgIE1PVVNFVVBfRElTTUlTUzogJ21vdXNldXAuZGlzbWlzcycgKyBFVkVOVF9LRVksCiAgICBNT1VTRURPV05fRElTTUlTUzogJ21vdXNlZG93bi5kaXNtaXNzJyArIEVWRU5UX0tFWSwKICAgIENMSUNLX0RBVEFfQVBJOiAnY2xpY2snICsgRVZFTlRfS0VZICsgREFUQV9BUElfS0VZCiAgfTsKCiAgdmFyIENsYXNzTmFtZSA9IHsKICAgIFNDUk9MTEJBUl9NRUFTVVJFUjogJ21vZGFsLXNjcm9sbGJhci1tZWFzdXJlJywKICAgIEJBQ0tEUk9QOiAnbW9kYWwtYmFja2Ryb3AnLAogICAgT1BFTjogJ21vZGFsLW9wZW4nLAogICAgRkFERTogJ2ZhZGUnLAogICAgU0hPVzogJ3Nob3cnCiAgfTsKCiAgdmFyIFNlbGVjdG9yID0gewogICAgRElBTE9HOiAnLm1vZGFsLWRpYWxvZycsCiAgICBEQVRBX1RPR0dMRTogJ1tkYXRhLXRvZ2dsZT0ibW9kYWwiXScsCiAgICBEQVRBX0RJU01JU1M6ICdbZGF0YS1kaXNtaXNzPSJtb2RhbCJdJywKICAgIEZJWEVEX0NPTlRFTlQ6ICcuZml4ZWQtdG9wLCAuZml4ZWQtYm90dG9tLCAuaXMtZml4ZWQsIC5zdGlja3ktdG9wJywKICAgIE5BVkJBUl9UT0dHTEVSOiAnLm5hdmJhci10b2dnbGVyJwoKICAgIC8qKgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKiBDbGFzcyBEZWZpbml0aW9uCiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAqLwoKICB9OwogIHZhciBNb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIE1vZGFsKGVsZW1lbnQsIGNvbmZpZykgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTW9kYWwpOwoKICAgICAgdGhpcy5fY29uZmlnID0gdGhpcy5fZ2V0Q29uZmlnKGNvbmZpZyk7CiAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50OwogICAgICB0aGlzLl9kaWFsb2cgPSAkKGVsZW1lbnQpLmZpbmQoU2VsZWN0b3IuRElBTE9HKVswXTsKICAgICAgdGhpcy5fYmFja2Ryb3AgPSBudWxsOwogICAgICB0aGlzLl9pc1Nob3duID0gZmFsc2U7CiAgICAgIHRoaXMuX2lzQm9keU92ZXJmbG93aW5nID0gZmFsc2U7CiAgICAgIHRoaXMuX2lnbm9yZUJhY2tkcm9wQ2xpY2sgPSBmYWxzZTsKICAgICAgdGhpcy5fb3JpZ2luYWxCb2R5UGFkZGluZyA9IDA7CiAgICAgIHRoaXMuX3Njcm9sbGJhcldpZHRoID0gMDsKICAgIH0KCiAgICAvLyBnZXR0ZXJzCgogICAgLy8gcHVibGljCgogICAgTW9kYWwucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uIHRvZ2dsZShyZWxhdGVkVGFyZ2V0KSB7CiAgICAgIHJldHVybiB0aGlzLl9pc1Nob3duID8gdGhpcy5oaWRlKCkgOiB0aGlzLnNob3cocmVsYXRlZFRhcmdldCk7CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gc2hvdyhyZWxhdGVkVGFyZ2V0KSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGlmICh0aGlzLl9pc1RyYW5zaXRpb25pbmcpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChVdGlsLnN1cHBvcnRzVHJhbnNpdGlvbkVuZCgpICYmICQodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLkZBREUpKSB7CiAgICAgICAgdGhpcy5faXNUcmFuc2l0aW9uaW5nID0gdHJ1ZTsKICAgICAgfQoKICAgICAgdmFyIHNob3dFdmVudCA9ICQuRXZlbnQoRXZlbnQuU0hPVywgewogICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHJlbGF0ZWRUYXJnZXQKICAgICAgfSk7CgogICAgICAkKHRoaXMuX2VsZW1lbnQpLnRyaWdnZXIoc2hvd0V2ZW50KTsKCiAgICAgIGlmICh0aGlzLl9pc1Nob3duIHx8IHNob3dFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5faXNTaG93biA9IHRydWU7CgogICAgICB0aGlzLl9jaGVja1Njcm9sbGJhcigpOwogICAgICB0aGlzLl9zZXRTY3JvbGxiYXIoKTsKCiAgICAgICQoZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoQ2xhc3NOYW1lLk9QRU4pOwoKICAgICAgdGhpcy5fc2V0RXNjYXBlRXZlbnQoKTsKICAgICAgdGhpcy5fc2V0UmVzaXplRXZlbnQoKTsKCiAgICAgICQodGhpcy5fZWxlbWVudCkub24oRXZlbnQuQ0xJQ0tfRElTTUlTUywgU2VsZWN0b3IuREFUQV9ESVNNSVNTLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICByZXR1cm4gX3RoaXMxMC5oaWRlKGV2ZW50KTsKICAgICAgfSk7CgogICAgICAkKHRoaXMuX2RpYWxvZykub24oRXZlbnQuTU9VU0VET1dOX0RJU01JU1MsIGZ1bmN0aW9uICgpIHsKICAgICAgICAkKF90aGlzMTAuX2VsZW1lbnQpLm9uZShFdmVudC5NT1VTRVVQX0RJU01JU1MsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5pcyhfdGhpczEwLl9lbGVtZW50KSkgewogICAgICAgICAgICBfdGhpczEwLl9pZ25vcmVCYWNrZHJvcENsaWNrID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICB0aGlzLl9zaG93QmFja2Ryb3AoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczEwLl9zaG93RWxlbWVudChyZWxhdGVkVGFyZ2V0KTsKICAgICAgfSk7CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gaGlkZShldmVudCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBpZiAoZXZlbnQpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5faXNUcmFuc2l0aW9uaW5nIHx8ICF0aGlzLl9pc1Nob3duKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdHJhbnNpdGlvbiA9IFV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgJiYgJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuRkFERSk7CgogICAgICBpZiAodHJhbnNpdGlvbikgewogICAgICAgIHRoaXMuX2lzVHJhbnNpdGlvbmluZyA9IHRydWU7CiAgICAgIH0KCiAgICAgIHZhciBoaWRlRXZlbnQgPSAkLkV2ZW50KEV2ZW50LkhJREUpOwoKICAgICAgJCh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKGhpZGVFdmVudCk7CgogICAgICBpZiAoIXRoaXMuX2lzU2hvd24gfHwgaGlkZUV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9pc1Nob3duID0gZmFsc2U7CgogICAgICB0aGlzLl9zZXRFc2NhcGVFdmVudCgpOwogICAgICB0aGlzLl9zZXRSZXNpemVFdmVudCgpOwoKICAgICAgJChkb2N1bWVudCkub2ZmKEV2ZW50LkZPQ1VTSU4pOwoKICAgICAgJCh0aGlzLl9lbGVtZW50KS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuU0hPVyk7CgogICAgICAkKHRoaXMuX2VsZW1lbnQpLm9mZihFdmVudC5DTElDS19ESVNNSVNTKTsKICAgICAgJCh0aGlzLl9kaWFsb2cpLm9mZihFdmVudC5NT1VTRURPV05fRElTTUlTUyk7CgogICAgICBpZiAodHJhbnNpdGlvbikgewoKICAgICAgICAkKHRoaXMuX2VsZW1lbnQpLm9uZShVdGlsLlRSQU5TSVRJT05fRU5ELCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBfdGhpczExLl9oaWRlTW9kYWwoZXZlbnQpOwogICAgICAgIH0pLmVtdWxhdGVUcmFuc2l0aW9uRW5kKFRSQU5TSVRJT05fRFVSQVRJT04pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX2hpZGVNb2RhbCgpOwogICAgICB9CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgJC5yZW1vdmVEYXRhKHRoaXMuX2VsZW1lbnQsIERBVEFfS0VZKTsKCiAgICAgICQod2luZG93LCBkb2N1bWVudCwgdGhpcy5fZWxlbWVudCwgdGhpcy5fYmFja2Ryb3ApLm9mZihFVkVOVF9LRVkpOwoKICAgICAgdGhpcy5fY29uZmlnID0gbnVsbDsKICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7CiAgICAgIHRoaXMuX2RpYWxvZyA9IG51bGw7CiAgICAgIHRoaXMuX2JhY2tkcm9wID0gbnVsbDsKICAgICAgdGhpcy5faXNTaG93biA9IG51bGw7CiAgICAgIHRoaXMuX2lzQm9keU92ZXJmbG93aW5nID0gbnVsbDsKICAgICAgdGhpcy5faWdub3JlQmFja2Ryb3BDbGljayA9IG51bGw7CiAgICAgIHRoaXMuX3Njcm9sbGJhcldpZHRoID0gbnVsbDsKICAgIH07CgogICAgTW9kYWwucHJvdG90eXBlLmhhbmRsZVVwZGF0ZSA9IGZ1bmN0aW9uIGhhbmRsZVVwZGF0ZSgpIHsKICAgICAgdGhpcy5fYWRqdXN0RGlhbG9nKCk7CiAgICB9OwoKICAgIC8vIHByaXZhdGUKCiAgICBNb2RhbC5wcm90b3R5cGUuX2dldENvbmZpZyA9IGZ1bmN0aW9uIF9nZXRDb25maWcoY29uZmlnKSB7CiAgICAgIGNvbmZpZyA9ICQuZXh0ZW5kKHt9LCBEZWZhdWx0LCBjb25maWcpOwogICAgICBVdGlsLnR5cGVDaGVja0NvbmZpZyhOQU1FLCBjb25maWcsIERlZmF1bHRUeXBlKTsKICAgICAgcmV0dXJuIGNvbmZpZzsKICAgIH07CgogICAgTW9kYWwucHJvdG90eXBlLl9zaG93RWxlbWVudCA9IGZ1bmN0aW9uIF9zaG93RWxlbWVudChyZWxhdGVkVGFyZ2V0KSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHZhciB0cmFuc2l0aW9uID0gVXRpbC5zdXBwb3J0c1RyYW5zaXRpb25FbmQoKSAmJiAkKHRoaXMuX2VsZW1lbnQpLmhhc0NsYXNzKENsYXNzTmFtZS5GQURFKTsKCiAgICAgIGlmICghdGhpcy5fZWxlbWVudC5wYXJlbnROb2RlIHx8IHRoaXMuX2VsZW1lbnQucGFyZW50Tm9kZS5ub2RlVHlwZSAhPT0gTm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICAvLyBkb24ndCBtb3ZlIG1vZGFscyBkb20gcG9zaXRpb24KICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuX2VsZW1lbnQpOwogICAgICB9CgogICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nKTsKICAgICAgdGhpcy5fZWxlbWVudC5zY3JvbGxUb3AgPSAwOwoKICAgICAgaWYgKHRyYW5zaXRpb24pIHsKICAgICAgICBVdGlsLnJlZmxvdyh0aGlzLl9lbGVtZW50KTsKICAgICAgfQoKICAgICAgJCh0aGlzLl9lbGVtZW50KS5hZGRDbGFzcyhDbGFzc05hbWUuU0hPVyk7CgogICAgICBpZiAodGhpcy5fY29uZmlnLmZvY3VzKSB7CiAgICAgICAgdGhpcy5fZW5mb3JjZUZvY3VzKCk7CiAgICAgIH0KCiAgICAgIHZhciBzaG93bkV2ZW50ID0gJC5FdmVudChFdmVudC5TSE9XTiwgewogICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHJlbGF0ZWRUYXJnZXQKICAgICAgfSk7CgogICAgICB2YXIgdHJhbnNpdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24gdHJhbnNpdGlvbkNvbXBsZXRlKCkgewogICAgICAgIGlmIChfdGhpczEyLl9jb25maWcuZm9jdXMpIHsKICAgICAgICAgIF90aGlzMTIuX2VsZW1lbnQuZm9jdXMoKTsKICAgICAgICB9CiAgICAgICAgX3RoaXMxMi5faXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7CiAgICAgICAgJChfdGhpczEyLl9lbGVtZW50KS50cmlnZ2VyKHNob3duRXZlbnQpOwogICAgICB9OwoKICAgICAgaWYgKHRyYW5zaXRpb24pIHsKICAgICAgICAkKHRoaXMuX2RpYWxvZykub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIHRyYW5zaXRpb25Db21wbGV0ZSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoVFJBTlNJVElPTl9EVVJBVElPTik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHJhbnNpdGlvbkNvbXBsZXRlKCk7CiAgICAgIH0KICAgIH07CgogICAgTW9kYWwucHJvdG90eXBlLl9lbmZvcmNlRm9jdXMgPSBmdW5jdGlvbiBfZW5mb3JjZUZvY3VzKCkgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICAkKGRvY3VtZW50KS5vZmYoRXZlbnQuRk9DVVNJTikgLy8gZ3VhcmQgYWdhaW5zdCBpbmZpbml0ZSBmb2N1cyBsb29wCiAgICAgIC5vbihFdmVudC5GT0NVU0lOLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBpZiAoZG9jdW1lbnQgIT09IGV2ZW50LnRhcmdldCAmJiBfdGhpczEzLl9lbGVtZW50ICE9PSBldmVudC50YXJnZXQgJiYgISQoX3RoaXMxMy5fZWxlbWVudCkuaGFzKGV2ZW50LnRhcmdldCkubGVuZ3RoKSB7CiAgICAgICAgICBfdGhpczEzLl9lbGVtZW50LmZvY3VzKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgTW9kYWwucHJvdG90eXBlLl9zZXRFc2NhcGVFdmVudCA9IGZ1bmN0aW9uIF9zZXRFc2NhcGVFdmVudCgpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuX2lzU2hvd24gJiYgdGhpcy5fY29uZmlnLmtleWJvYXJkKSB7CiAgICAgICAgJCh0aGlzLl9lbGVtZW50KS5vbihFdmVudC5LRVlET1dOX0RJU01JU1MsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSBFU0NBUEVfS0VZQ09ERSkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBfdGhpczE0LmhpZGUoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICghdGhpcy5faXNTaG93bikgewogICAgICAgICQodGhpcy5fZWxlbWVudCkub2ZmKEV2ZW50LktFWURPV05fRElTTUlTUyk7CiAgICAgIH0KICAgIH07CgogICAgTW9kYWwucHJvdG90eXBlLl9zZXRSZXNpemVFdmVudCA9IGZ1bmN0aW9uIF9zZXRSZXNpemVFdmVudCgpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuX2lzU2hvd24pIHsKICAgICAgICAkKHdpbmRvdykub24oRXZlbnQuUkVTSVpFLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBfdGhpczE1LmhhbmRsZVVwZGF0ZShldmVudCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJCh3aW5kb3cpLm9mZihFdmVudC5SRVNJWkUpOwogICAgICB9CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5faGlkZU1vZGFsID0gZnVuY3Rpb24gX2hpZGVNb2RhbCgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgdGhpcy5fZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICB0aGlzLl9lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCB0cnVlKTsKICAgICAgdGhpcy5faXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuX3Nob3dCYWNrZHJvcChmdW5jdGlvbiAoKSB7CiAgICAgICAgJChkb2N1bWVudC5ib2R5KS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuT1BFTik7CiAgICAgICAgX3RoaXMxNi5fcmVzZXRBZGp1c3RtZW50cygpOwogICAgICAgIF90aGlzMTYuX3Jlc2V0U2Nyb2xsYmFyKCk7CiAgICAgICAgJChfdGhpczE2Ll9lbGVtZW50KS50cmlnZ2VyKEV2ZW50LkhJRERFTik7CiAgICAgIH0pOwogICAgfTsKCiAgICBNb2RhbC5wcm90b3R5cGUuX3JlbW92ZUJhY2tkcm9wID0gZnVuY3Rpb24gX3JlbW92ZUJhY2tkcm9wKCkgewogICAgICBpZiAodGhpcy5fYmFja2Ryb3ApIHsKICAgICAgICAkKHRoaXMuX2JhY2tkcm9wKS5yZW1vdmUoKTsKICAgICAgICB0aGlzLl9iYWNrZHJvcCA9IG51bGw7CiAgICAgIH0KICAgIH07CgogICAgTW9kYWwucHJvdG90eXBlLl9zaG93QmFja2Ryb3AgPSBmdW5jdGlvbiBfc2hvd0JhY2tkcm9wKGNhbGxiYWNrKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIHZhciBhbmltYXRlID0gJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuRkFERSkgPyBDbGFzc05hbWUuRkFERSA6ICcnOwoKICAgICAgaWYgKHRoaXMuX2lzU2hvd24gJiYgdGhpcy5fY29uZmlnLmJhY2tkcm9wKSB7CiAgICAgICAgdmFyIGRvQW5pbWF0ZSA9IFV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgJiYgYW5pbWF0ZTsKCiAgICAgICAgdGhpcy5fYmFja2Ryb3AgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLl9iYWNrZHJvcC5jbGFzc05hbWUgPSBDbGFzc05hbWUuQkFDS0RST1A7CgogICAgICAgIGlmIChhbmltYXRlKSB7CiAgICAgICAgICAkKHRoaXMuX2JhY2tkcm9wKS5hZGRDbGFzcyhhbmltYXRlKTsKICAgICAgICB9CgogICAgICAgICQodGhpcy5fYmFja2Ryb3ApLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwoKICAgICAgICAkKHRoaXMuX2VsZW1lbnQpLm9uKEV2ZW50LkNMSUNLX0RJU01JU1MsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgaWYgKF90aGlzMTcuX2lnbm9yZUJhY2tkcm9wQ2xpY2spIHsKICAgICAgICAgICAgX3RoaXMxNy5faWdub3JlQmFja2Ryb3BDbGljayA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICE9PSBldmVudC5jdXJyZW50VGFyZ2V0KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChfdGhpczE3Ll9jb25maWcuYmFja2Ryb3AgPT09ICdzdGF0aWMnKSB7CiAgICAgICAgICAgIF90aGlzMTcuX2VsZW1lbnQuZm9jdXMoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMTcuaGlkZSgpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBpZiAoZG9BbmltYXRlKSB7CiAgICAgICAgICBVdGlsLnJlZmxvdyh0aGlzLl9iYWNrZHJvcCk7CiAgICAgICAgfQoKICAgICAgICAkKHRoaXMuX2JhY2tkcm9wKS5hZGRDbGFzcyhDbGFzc05hbWUuU0hPVyk7CgogICAgICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghZG9BbmltYXRlKSB7CiAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgJCh0aGlzLl9iYWNrZHJvcCkub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIGNhbGxiYWNrKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChCQUNLRFJPUF9UUkFOU0lUSU9OX0RVUkFUSU9OKTsKICAgICAgfSBlbHNlIGlmICghdGhpcy5faXNTaG93biAmJiB0aGlzLl9iYWNrZHJvcCkgewogICAgICAgICQodGhpcy5fYmFja2Ryb3ApLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5TSE9XKTsKCiAgICAgICAgdmFyIGNhbGxiYWNrUmVtb3ZlID0gZnVuY3Rpb24gY2FsbGJhY2tSZW1vdmUoKSB7CiAgICAgICAgICBfdGhpczE3Ll9yZW1vdmVCYWNrZHJvcCgpOwogICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKFV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgJiYgJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuRkFERSkpIHsKICAgICAgICAgICQodGhpcy5fYmFja2Ryb3ApLm9uZShVdGlsLlRSQU5TSVRJT05fRU5ELCBjYWxsYmFja1JlbW92ZSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoQkFDS0RST1BfVFJBTlNJVElPTl9EVVJBVElPTik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNhbGxiYWNrUmVtb3ZlKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfTsKCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyB0aGUgZm9sbG93aW5nIG1ldGhvZHMgYXJlIHVzZWQgdG8gaGFuZGxlIG92ZXJmbG93aW5nIG1vZGFscwogICAgLy8gdG9kbyAoZmF0KTogdGhlc2Ugc2hvdWxkIHByb2JhYmx5IGJlIHJlZmFjdG9yZWQgb3V0IG9mIG1vZGFsLmpzCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgTW9kYWwucHJvdG90eXBlLl9hZGp1c3REaWFsb2cgPSBmdW5jdGlvbiBfYWRqdXN0RGlhbG9nKCkgewogICAgICB2YXIgaXNNb2RhbE92ZXJmbG93aW5nID0gdGhpcy5fZWxlbWVudC5zY3JvbGxIZWlnaHQgPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0OwoKICAgICAgaWYgKCF0aGlzLl9pc0JvZHlPdmVyZmxvd2luZyAmJiBpc01vZGFsT3ZlcmZsb3dpbmcpIHsKICAgICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLnBhZGRpbmdMZWZ0ID0gdGhpcy5fc2Nyb2xsYmFyV2lkdGggKyAncHgnOwogICAgICB9CgogICAgICBpZiAodGhpcy5faXNCb2R5T3ZlcmZsb3dpbmcgJiYgIWlzTW9kYWxPdmVyZmxvd2luZykgewogICAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gdGhpcy5fc2Nyb2xsYmFyV2lkdGggKyAncHgnOwogICAgICB9CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5fcmVzZXRBZGp1c3RtZW50cyA9IGZ1bmN0aW9uIF9yZXNldEFkanVzdG1lbnRzKCkgewogICAgICB0aGlzLl9lbGVtZW50LnN0eWxlLnBhZGRpbmdMZWZ0ID0gJyc7CiAgICAgIHRoaXMuX2VsZW1lbnQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gJyc7CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5fY2hlY2tTY3JvbGxiYXIgPSBmdW5jdGlvbiBfY2hlY2tTY3JvbGxiYXIoKSB7CiAgICAgIHRoaXMuX2lzQm9keU92ZXJmbG93aW5nID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCA8IHdpbmRvdy5pbm5lcldpZHRoOwogICAgICB0aGlzLl9zY3JvbGxiYXJXaWR0aCA9IHRoaXMuX2dldFNjcm9sbGJhcldpZHRoKCk7CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5fc2V0U2Nyb2xsYmFyID0gZnVuY3Rpb24gX3NldFNjcm9sbGJhcigpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuX2lzQm9keU92ZXJmbG93aW5nKSB7CiAgICAgICAgLy8gTm90ZTogRE9NTm9kZS5zdHlsZS5wYWRkaW5nUmlnaHQgcmV0dXJucyB0aGUgYWN0dWFsIHZhbHVlIG9yICcnIGlmIG5vdCBzZXQKICAgICAgICAvLyAgIHdoaWxlICQoRE9NTm9kZSkuY3NzKCdwYWRkaW5nLXJpZ2h0JykgcmV0dXJucyB0aGUgY2FsY3VsYXRlZCB2YWx1ZSBvciAwIGlmIG5vdCBzZXQKCiAgICAgICAgLy8gQWRqdXN0IGZpeGVkIGNvbnRlbnQgcGFkZGluZwogICAgICAgICQoU2VsZWN0b3IuRklYRURfQ09OVEVOVCkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgIHZhciBhY3R1YWxQYWRkaW5nID0gJChlbGVtZW50KVswXS5zdHlsZS5wYWRkaW5nUmlnaHQ7CiAgICAgICAgICB2YXIgY2FsY3VsYXRlZFBhZGRpbmcgPSAkKGVsZW1lbnQpLmNzcygncGFkZGluZy1yaWdodCcpOwogICAgICAgICAgJChlbGVtZW50KS5kYXRhKCdwYWRkaW5nLXJpZ2h0JywgYWN0dWFsUGFkZGluZykuY3NzKCdwYWRkaW5nLXJpZ2h0JywgcGFyc2VGbG9hdChjYWxjdWxhdGVkUGFkZGluZykgKyBfdGhpczE4Ll9zY3JvbGxiYXJXaWR0aCArICdweCcpOwogICAgICAgIH0pOwoKICAgICAgICAvLyBBZGp1c3QgbmF2YmFyLXRvZ2dsZXIgbWFyZ2luCiAgICAgICAgJChTZWxlY3Rvci5OQVZCQVJfVE9HR0xFUikuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgIHZhciBhY3R1YWxNYXJnaW4gPSAkKGVsZW1lbnQpWzBdLnN0eWxlLm1hcmdpblJpZ2h0OwogICAgICAgICAgdmFyIGNhbGN1bGF0ZWRNYXJnaW4gPSAkKGVsZW1lbnQpLmNzcygnbWFyZ2luLXJpZ2h0Jyk7CiAgICAgICAgICAkKGVsZW1lbnQpLmRhdGEoJ21hcmdpbi1yaWdodCcsIGFjdHVhbE1hcmdpbikuY3NzKCdtYXJnaW4tcmlnaHQnLCBwYXJzZUZsb2F0KGNhbGN1bGF0ZWRNYXJnaW4pICsgX3RoaXMxOC5fc2Nyb2xsYmFyV2lkdGggKyAncHgnKTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gQWRqdXN0IGJvZHkgcGFkZGluZwogICAgICAgIHZhciBhY3R1YWxQYWRkaW5nID0gZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nUmlnaHQ7CiAgICAgICAgdmFyIGNhbGN1bGF0ZWRQYWRkaW5nID0gJCgnYm9keScpLmNzcygncGFkZGluZy1yaWdodCcpOwogICAgICAgICQoJ2JvZHknKS5kYXRhKCdwYWRkaW5nLXJpZ2h0JywgYWN0dWFsUGFkZGluZykuY3NzKCdwYWRkaW5nLXJpZ2h0JywgcGFyc2VGbG9hdChjYWxjdWxhdGVkUGFkZGluZykgKyB0aGlzLl9zY3JvbGxiYXJXaWR0aCArICdweCcpOwogICAgICB9CiAgICB9OwoKICAgIE1vZGFsLnByb3RvdHlwZS5fcmVzZXRTY3JvbGxiYXIgPSBmdW5jdGlvbiBfcmVzZXRTY3JvbGxiYXIoKSB7CiAgICAgIC8vIFJlc3RvcmUgZml4ZWQgY29udGVudCBwYWRkaW5nCiAgICAgICQoU2VsZWN0b3IuRklYRURfQ09OVEVOVCkuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICB2YXIgcGFkZGluZyA9ICQoZWxlbWVudCkuZGF0YSgncGFkZGluZy1yaWdodCcpOwogICAgICAgIGlmICh0eXBlb2YgcGFkZGluZyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICQoZWxlbWVudCkuY3NzKCdwYWRkaW5nLXJpZ2h0JywgcGFkZGluZykucmVtb3ZlRGF0YSgncGFkZGluZy1yaWdodCcpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBSZXN0b3JlIG5hdmJhci10b2dnbGVyIG1hcmdpbgogICAgICAkKFNlbGVjdG9yLk5BVkJBUl9UT0dHTEVSKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkgewogICAgICAgIHZhciBtYXJnaW4gPSAkKGVsZW1lbnQpLmRhdGEoJ21hcmdpbi1yaWdodCcpOwogICAgICAgIGlmICh0eXBlb2YgbWFyZ2luICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgJChlbGVtZW50KS5jc3MoJ21hcmdpbi1yaWdodCcsIG1hcmdpbikucmVtb3ZlRGF0YSgnbWFyZ2luLXJpZ2h0Jyk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIFJlc3RvcmUgYm9keSBwYWRkaW5nCiAgICAgIHZhciBwYWRkaW5nID0gJCgnYm9keScpLmRhdGEoJ3BhZGRpbmctcmlnaHQnKTsKICAgICAgaWYgKHR5cGVvZiBwYWRkaW5nICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICQoJ2JvZHknKS5jc3MoJ3BhZGRpbmctcmlnaHQnLCBwYWRkaW5nKS5yZW1vdmVEYXRhKCdwYWRkaW5nLXJpZ2h0Jyk7CiAgICAgIH0KICAgIH07CgogICAgTW9kYWwucHJvdG90eXBlLl9nZXRTY3JvbGxiYXJXaWR0aCA9IGZ1bmN0aW9uIF9nZXRTY3JvbGxiYXJXaWR0aCgpIHsKICAgICAgLy8gdGh4IGQud2Fsc2gKICAgICAgdmFyIHNjcm9sbERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBzY3JvbGxEaXYuY2xhc3NOYW1lID0gQ2xhc3NOYW1lLlNDUk9MTEJBUl9NRUFTVVJFUjsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JvbGxEaXYpOwogICAgICB2YXIgc2Nyb2xsYmFyV2lkdGggPSBzY3JvbGxEaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggLSBzY3JvbGxEaXYuY2xpZW50V2lkdGg7CiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoc2Nyb2xsRGl2KTsKICAgICAgcmV0dXJuIHNjcm9sbGJhcldpZHRoOwogICAgfTsKCiAgICAvLyBzdGF0aWMKCiAgICBNb2RhbC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcsIHJlbGF0ZWRUYXJnZXQpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoREFUQV9LRVkpOwogICAgICAgIHZhciBfY29uZmlnID0gJC5leHRlbmQoe30sIE1vZGFsLkRlZmF1bHQsICQodGhpcykuZGF0YSgpLCAodHlwZW9mIGNvbmZpZyA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YoY29uZmlnKSkgPT09ICdvYmplY3QnICYmIGNvbmZpZyk7CgogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgZGF0YSA9IG5ldyBNb2RhbCh0aGlzLCBfY29uZmlnKTsKICAgICAgICAgICQodGhpcykuZGF0YShEQVRBX0tFWSwgZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGlmIChkYXRhW2NvbmZpZ10gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIG1ldGhvZCBuYW1lZCAiJyArIGNvbmZpZyArICciJyk7CiAgICAgICAgICB9CiAgICAgICAgICBkYXRhW2NvbmZpZ10ocmVsYXRlZFRhcmdldCk7CiAgICAgICAgfSBlbHNlIGlmIChfY29uZmlnLnNob3cpIHsKICAgICAgICAgIGRhdGEuc2hvdyhyZWxhdGVkVGFyZ2V0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICBfY3JlYXRlQ2xhc3MoTW9kYWwsIG51bGwsIFt7CiAgICAgIGtleTogJ1ZFUlNJT04nLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdEZWZhdWx0JywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIERlZmF1bHQ7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gTW9kYWw7CiAgfSgpOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBEYXRhIEFwaSBpbXBsZW1lbnRhdGlvbgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkKGRvY3VtZW50KS5vbihFdmVudC5DTElDS19EQVRBX0FQSSwgU2VsZWN0b3IuREFUQV9UT0dHTEUsIGZ1bmN0aW9uIChldmVudCkgewogICAgdmFyIF90aGlzMTkgPSB0aGlzOwoKICAgIHZhciB0YXJnZXQgPSB2b2lkIDA7CiAgICB2YXIgc2VsZWN0b3IgPSBVdGlsLmdldFNlbGVjdG9yRnJvbUVsZW1lbnQodGhpcyk7CgogICAgaWYgKHNlbGVjdG9yKSB7CiAgICAgIHRhcmdldCA9ICQoc2VsZWN0b3IpWzBdOwogICAgfQoKICAgIHZhciBjb25maWcgPSAkKHRhcmdldCkuZGF0YShEQVRBX0tFWSkgPyAndG9nZ2xlJyA6ICQuZXh0ZW5kKHt9LCAkKHRhcmdldCkuZGF0YSgpLCAkKHRoaXMpLmRhdGEoKSk7CgogICAgaWYgKHRoaXMudGFnTmFtZSA9PT0gJ0EnIHx8IHRoaXMudGFnTmFtZSA9PT0gJ0FSRUEnKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9CgogICAgdmFyICR0YXJnZXQgPSAkKHRhcmdldCkub25lKEV2ZW50LlNIT1csIGZ1bmN0aW9uIChzaG93RXZlbnQpIHsKICAgICAgaWYgKHNob3dFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgIC8vIG9ubHkgcmVnaXN0ZXIgZm9jdXMgcmVzdG9yZXIgaWYgbW9kYWwgd2lsbCBhY3R1YWxseSBnZXQgc2hvd24KICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgICR0YXJnZXQub25lKEV2ZW50LkhJRERFTiwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICgkKF90aGlzMTkpLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICBfdGhpczE5LmZvY3VzKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwoKICAgIE1vZGFsLl9qUXVlcnlJbnRlcmZhY2UuY2FsbCgkKHRhcmdldCksIGNvbmZpZywgdGhpcyk7CiAgfSk7CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIGpRdWVyeQogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkLmZuW05BTUVdID0gTW9kYWwuX2pRdWVyeUludGVyZmFjZTsKICAkLmZuW05BTUVdLkNvbnN0cnVjdG9yID0gTW9kYWw7CiAgJC5mbltOQU1FXS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbltOQU1FXSA9IEpRVUVSWV9OT19DT05GTElDVDsKICAgIHJldHVybiBNb2RhbC5falF1ZXJ5SW50ZXJmYWNlOwogIH07CgogIHJldHVybiBNb2RhbDsKfShqUXVlcnkpOwoKLyoqCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqIEJvb3RzdHJhcCAodjQuMC4wLWJldGEpOiBzY3JvbGxzcHkuanMKICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICovCgp2YXIgU2Nyb2xsU3B5ID0gZnVuY3Rpb24gKCQpIHsKCiAgLyoqCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICogQ29uc3RhbnRzCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICovCgogIHZhciBOQU1FID0gJ3Njcm9sbHNweSc7CiAgdmFyIFZFUlNJT04gPSAnNC4wLjAtYmV0YSc7CiAgdmFyIERBVEFfS0VZID0gJ2JzLnNjcm9sbHNweSc7CiAgdmFyIEVWRU5UX0tFWSA9ICcuJyArIERBVEFfS0VZOwogIHZhciBEQVRBX0FQSV9LRVkgPSAnLmRhdGEtYXBpJzsKICB2YXIgSlFVRVJZX05PX0NPTkZMSUNUID0gJC5mbltOQU1FXTsKCiAgdmFyIERlZmF1bHQgPSB7CiAgICBvZmZzZXQ6IDEwLAogICAgbWV0aG9kOiAnYXV0bycsCiAgICB0YXJnZXQ6ICcnCiAgfTsKCiAgdmFyIERlZmF1bHRUeXBlID0gewogICAgb2Zmc2V0OiAnbnVtYmVyJywKICAgIG1ldGhvZDogJ3N0cmluZycsCiAgICB0YXJnZXQ6ICcoc3RyaW5nfGVsZW1lbnQpJwogIH07CgogIHZhciBFdmVudCA9IHsKICAgIEFDVElWQVRFOiAnYWN0aXZhdGUnICsgRVZFTlRfS0VZLAogICAgU0NST0xMOiAnc2Nyb2xsJyArIEVWRU5UX0tFWSwKICAgIExPQURfREFUQV9BUEk6ICdsb2FkJyArIEVWRU5UX0tFWSArIERBVEFfQVBJX0tFWQogIH07CgogIHZhciBDbGFzc05hbWUgPSB7CiAgICBEUk9QRE9XTl9JVEVNOiAnZHJvcGRvd24taXRlbScsCiAgICBEUk9QRE9XTl9NRU5VOiAnZHJvcGRvd24tbWVudScsCiAgICBBQ1RJVkU6ICdhY3RpdmUnCiAgfTsKCiAgdmFyIFNlbGVjdG9yID0gewogICAgREFUQV9TUFk6ICdbZGF0YS1zcHk9InNjcm9sbCJdJywKICAgIEFDVElWRTogJy5hY3RpdmUnLAogICAgTkFWX0xJU1RfR1JPVVA6ICcubmF2LCAubGlzdC1ncm91cCcsCiAgICBOQVZfTElOS1M6ICcubmF2LWxpbmsnLAogICAgTElTVF9JVEVNUzogJy5saXN0LWdyb3VwLWl0ZW0nLAogICAgRFJPUERPV046ICcuZHJvcGRvd24nLAogICAgRFJPUERPV05fSVRFTVM6ICcuZHJvcGRvd24taXRlbScsCiAgICBEUk9QRE9XTl9UT0dHTEU6ICcuZHJvcGRvd24tdG9nZ2xlJwogIH07CgogIHZhciBPZmZzZXRNZXRob2QgPSB7CiAgICBPRkZTRVQ6ICdvZmZzZXQnLAogICAgUE9TSVRJT046ICdwb3NpdGlvbicKCiAgICAvKioKICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICogQ2xhc3MgRGVmaW5pdGlvbgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKi8KCiAgfTsKICB2YXIgU2Nyb2xsU3B5ID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gU2Nyb2xsU3B5KGVsZW1lbnQsIGNvbmZpZykgewogICAgICB2YXIgX3RoaXMyMCA9IHRoaXM7CgogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2Nyb2xsU3B5KTsKCiAgICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50OwogICAgICB0aGlzLl9zY3JvbGxFbGVtZW50ID0gZWxlbWVudC50YWdOYW1lID09PSAnQk9EWScgPyB3aW5kb3cgOiBlbGVtZW50OwogICAgICB0aGlzLl9jb25maWcgPSB0aGlzLl9nZXRDb25maWcoY29uZmlnKTsKICAgICAgdGhpcy5fc2VsZWN0b3IgPSB0aGlzLl9jb25maWcudGFyZ2V0ICsgJyAnICsgU2VsZWN0b3IuTkFWX0xJTktTICsgJywnICsgKHRoaXMuX2NvbmZpZy50YXJnZXQgKyAnICcgKyBTZWxlY3Rvci5MSVNUX0lURU1TICsgJywnKSArICh0aGlzLl9jb25maWcudGFyZ2V0ICsgJyAnICsgU2VsZWN0b3IuRFJPUERPV05fSVRFTVMpOwogICAgICB0aGlzLl9vZmZzZXRzID0gW107CiAgICAgIHRoaXMuX3RhcmdldHMgPSBbXTsKICAgICAgdGhpcy5fYWN0aXZlVGFyZ2V0ID0gbnVsbDsKICAgICAgdGhpcy5fc2Nyb2xsSGVpZ2h0ID0gMDsKCiAgICAgICQodGhpcy5fc2Nyb2xsRWxlbWVudCkub24oRXZlbnQuU0NST0xMLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICByZXR1cm4gX3RoaXMyMC5fcHJvY2VzcyhldmVudCk7CiAgICAgIH0pOwoKICAgICAgdGhpcy5yZWZyZXNoKCk7CiAgICAgIHRoaXMuX3Byb2Nlc3MoKTsKICAgIH0KCiAgICAvLyBnZXR0ZXJzCgogICAgLy8gcHVibGljCgogICAgU2Nyb2xsU3B5LnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gcmVmcmVzaCgpIHsKICAgICAgdmFyIF90aGlzMjEgPSB0aGlzOwoKICAgICAgdmFyIGF1dG9NZXRob2QgPSB0aGlzLl9zY3JvbGxFbGVtZW50ICE9PSB0aGlzLl9zY3JvbGxFbGVtZW50LndpbmRvdyA\/IE9mZnNldE1ldGhvZC5QT1NJVElPTiA6IE9mZnNldE1ldGhvZC5PRkZTRVQ7CgogICAgICB2YXIgb2Zmc2V0TWV0aG9kID0gdGhpcy5fY29uZmlnLm1ldGhvZCA9PT0gJ2F1dG8nID8gYXV0b01ldGhvZCA6IHRoaXMuX2NvbmZpZy5tZXRob2Q7CgogICAgICB2YXIgb2Zmc2V0QmFzZSA9IG9mZnNldE1ldGhvZCA9PT0gT2Zmc2V0TWV0aG9kLlBPU0lUSU9OID8gdGhpcy5fZ2V0U2Nyb2xsVG9wKCkgOiAwOwoKICAgICAgdGhpcy5fb2Zmc2V0cyA9IFtdOwogICAgICB0aGlzLl90YXJnZXRzID0gW107CgogICAgICB0aGlzLl9zY3JvbGxIZWlnaHQgPSB0aGlzLl9nZXRTY3JvbGxIZWlnaHQoKTsKCiAgICAgIHZhciB0YXJnZXRzID0gJC5tYWtlQXJyYXkoJCh0aGlzLl9zZWxlY3RvcikpOwoKICAgICAgdGFyZ2V0cy5tYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICB2YXIgdGFyZ2V0ID0gdm9pZCAwOwogICAgICAgIHZhciB0YXJnZXRTZWxlY3RvciA9IFV0aWwuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudChlbGVtZW50KTsKCiAgICAgICAgaWYgKHRhcmdldFNlbGVjdG9yKSB7CiAgICAgICAgICB0YXJnZXQgPSAkKHRhcmdldFNlbGVjdG9yKVswXTsKICAgICAgICB9CgogICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgIHZhciB0YXJnZXRCQ1IgPSB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICBpZiAodGFyZ2V0QkNSLndpZHRoIHx8IHRhcmdldEJDUi5oZWlnaHQpIHsKICAgICAgICAgICAgLy8gdG9kbyAoZmF0KTogcmVtb3ZlIHNrZXRjaCByZWxpYW5jZSBvbiBqUXVlcnkgcG9zaXRpb24vb2Zmc2V0CiAgICAgICAgICAgIHJldHVybiBbJCh0YXJnZXQpW29mZnNldE1ldGhvZF0oKS50b3AgKyBvZmZzZXRCYXNlLCB0YXJnZXRTZWxlY3Rvcl07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9KS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgfSkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhWzBdIC0gYlswXTsKICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIF90aGlzMjEuX29mZnNldHMucHVzaChpdGVtWzBdKTsKICAgICAgICBfdGhpczIxLl90YXJnZXRzLnB1c2goaXRlbVsxXSk7CiAgICAgIH0pOwogICAgfTsKCiAgICBTY3JvbGxTcHkucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICAkLnJlbW92ZURhdGEodGhpcy5fZWxlbWVudCwgREFUQV9LRVkpOwogICAgICAkKHRoaXMuX3Njcm9sbEVsZW1lbnQpLm9mZihFVkVOVF9LRVkpOwoKICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7CiAgICAgIHRoaXMuX3Njcm9sbEVsZW1lbnQgPSBudWxsOwogICAgICB0aGlzLl9jb25maWcgPSBudWxsOwogICAgICB0aGlzLl9zZWxlY3RvciA9IG51bGw7CiAgICAgIHRoaXMuX29mZnNldHMgPSBudWxsOwogICAgICB0aGlzLl90YXJnZXRzID0gbnVsbDsKICAgICAgdGhpcy5fYWN0aXZlVGFyZ2V0ID0gbnVsbDsKICAgICAgdGhpcy5fc2Nyb2xsSGVpZ2h0ID0gbnVsbDsKICAgIH07CgogICAgLy8gcHJpdmF0ZQoKICAgIFNjcm9sbFNweS5wcm90b3R5cGUuX2dldENvbmZpZyA9IGZ1bmN0aW9uIF9nZXRDb25maWcoY29uZmlnKSB7CiAgICAgIGNvbmZpZyA9ICQuZXh0ZW5kKHt9LCBEZWZhdWx0LCBjb25maWcpOwoKICAgICAgaWYgKHR5cGVvZiBjb25maWcudGFyZ2V0ICE9PSAnc3RyaW5nJykgewogICAgICAgIHZhciBpZCA9ICQoY29uZmlnLnRhcmdldCkuYXR0cignaWQnKTsKICAgICAgICBpZiAoIWlkKSB7CiAgICAgICAgICBpZCA9IFV0aWwuZ2V0VUlEKE5BTUUpOwogICAgICAgICAgJChjb25maWcudGFyZ2V0KS5hdHRyKCdpZCcsIGlkKTsKICAgICAgICB9CiAgICAgICAgY29uZmlnLnRhcmdldCA9ICcjJyArIGlkOwogICAgICB9CgogICAgICBVdGlsLnR5cGVDaGVja0NvbmZpZyhOQU1FLCBjb25maWcsIERlZmF1bHRUeXBlKTsKCiAgICAgIHJldHVybiBjb25maWc7CiAgICB9OwoKICAgIFNjcm9sbFNweS5wcm90b3R5cGUuX2dldFNjcm9sbFRvcCA9IGZ1bmN0aW9uIF9nZXRTY3JvbGxUb3AoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxFbGVtZW50ID09PSB3aW5kb3cgPyB0aGlzLl9zY3JvbGxFbGVtZW50LnBhZ2VZT2Zmc2V0IDogdGhpcy5fc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3A7CiAgICB9OwoKICAgIFNjcm9sbFNweS5wcm90b3R5cGUuX2dldFNjcm9sbEhlaWdodCA9IGZ1bmN0aW9uIF9nZXRTY3JvbGxIZWlnaHQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxFbGVtZW50LnNjcm9sbEhlaWdodCB8fCBNYXRoLm1heChkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCk7CiAgICB9OwoKICAgIFNjcm9sbFNweS5wcm90b3R5cGUuX2dldE9mZnNldEhlaWdodCA9IGZ1bmN0aW9uIF9nZXRPZmZzZXRIZWlnaHQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zY3JvbGxFbGVtZW50ID09PSB3aW5kb3cgPyB3aW5kb3cuaW5uZXJIZWlnaHQgOiB0aGlzLl9zY3JvbGxFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDsKICAgIH07CgogICAgU2Nyb2xsU3B5LnByb3RvdHlwZS5fcHJvY2VzcyA9IGZ1bmN0aW9uIF9wcm9jZXNzKCkgewogICAgICB2YXIgc2Nyb2xsVG9wID0gdGhpcy5fZ2V0U2Nyb2xsVG9wKCkgKyB0aGlzLl9jb25maWcub2Zmc2V0OwogICAgICB2YXIgc2Nyb2xsSGVpZ2h0ID0gdGhpcy5fZ2V0U2Nyb2xsSGVpZ2h0KCk7CiAgICAgIHZhciBtYXhTY3JvbGwgPSB0aGlzLl9jb25maWcub2Zmc2V0ICsgc2Nyb2xsSGVpZ2h0IC0gdGhpcy5fZ2V0T2Zmc2V0SGVpZ2h0KCk7CgogICAgICBpZiAodGhpcy5fc2Nyb2xsSGVpZ2h0ICE9PSBzY3JvbGxIZWlnaHQpIHsKICAgICAgICB0aGlzLnJlZnJlc2goKTsKICAgICAgfQoKICAgICAgaWYgKHNjcm9sbFRvcCA+PSBtYXhTY3JvbGwpIHsKICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fdGFyZ2V0c1t0aGlzLl90YXJnZXRzLmxlbmd0aCAtIDFdOwoKICAgICAgICBpZiAodGhpcy5fYWN0aXZlVGFyZ2V0ICE9PSB0YXJnZXQpIHsKICAgICAgICAgIHRoaXMuX2FjdGl2YXRlKHRhcmdldCk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX2FjdGl2ZVRhcmdldCAmJiBzY3JvbGxUb3AgPCB0aGlzLl9vZmZzZXRzWzBdICYmIHRoaXMuX29mZnNldHNbMF0gPiAwKSB7CiAgICAgICAgdGhpcy5fYWN0aXZlVGFyZ2V0ID0gbnVsbDsKICAgICAgICB0aGlzLl9jbGVhcigpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IHRoaXMuX29mZnNldHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgdmFyIGlzQWN0aXZlVGFyZ2V0ID0gdGhpcy5fYWN0aXZlVGFyZ2V0ICE9PSB0aGlzLl90YXJnZXRzW2ldICYmIHNjcm9sbFRvcCA+PSB0aGlzLl9vZmZzZXRzW2ldICYmICh0aGlzLl9vZmZzZXRzW2kgKyAxXSA9PT0gdW5kZWZpbmVkIHx8IHNjcm9sbFRvcCA8IHRoaXMuX29mZnNldHNbaSArIDFdKTsKCiAgICAgICAgaWYgKGlzQWN0aXZlVGFyZ2V0KSB7CiAgICAgICAgICB0aGlzLl9hY3RpdmF0ZSh0aGlzLl90YXJnZXRzW2ldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgU2Nyb2xsU3B5LnByb3RvdHlwZS5fYWN0aXZhdGUgPSBmdW5jdGlvbiBfYWN0aXZhdGUodGFyZ2V0KSB7CiAgICAgIHRoaXMuX2FjdGl2ZVRhcmdldCA9IHRhcmdldDsKCiAgICAgIHRoaXMuX2NsZWFyKCk7CgogICAgICB2YXIgcXVlcmllcyA9IHRoaXMuX3NlbGVjdG9yLnNwbGl0KCcsJyk7CiAgICAgIHF1ZXJpZXMgPSBxdWVyaWVzLm1hcChmdW5jdGlvbiAoc2VsZWN0b3IpIHsKICAgICAgICByZXR1cm4gc2VsZWN0b3IgKyAnW2RhdGEtdGFyZ2V0PSInICsgdGFyZ2V0ICsgJyJdLCcgKyAoc2VsZWN0b3IgKyAnW2hyZWY9IicgKyB0YXJnZXQgKyAnIl0nKTsKICAgICAgfSk7CgogICAgICB2YXIgJGxpbmsgPSAkKHF1ZXJpZXMuam9pbignLCcpKTsKCiAgICAgIGlmICgkbGluay5oYXNDbGFzcyhDbGFzc05hbWUuRFJPUERPV05fSVRFTSkpIHsKICAgICAgICAkbGluay5jbG9zZXN0KFNlbGVjdG9yLkRST1BET1dOKS5maW5kKFNlbGVjdG9yLkRST1BET1dOX1RPR0dMRSkuYWRkQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CiAgICAgICAgJGxpbmsuYWRkQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gU2V0IHRyaWdnZXJlZCBsaW5rIGFzIGFjdGl2ZQogICAgICAgICRsaW5rLmFkZENsYXNzKENsYXNzTmFtZS5BQ1RJVkUpOwogICAgICAgIC8vIFNldCB0cmlnZ2VyZWQgbGlua3MgcGFyZW50cyBhcyBhY3RpdmUKICAgICAgICAvLyBXaXRoIGJvdGggPHVsPiBhbmQgPG5hdj4gbWFya3VwIGEgcGFyZW50IGlzIHRoZSBwcmV2aW91cyBzaWJsaW5nIG9mIGFueSBuYXYgYW5jZXN0b3IKICAgICAgICAkbGluay5wYXJlbnRzKFNlbGVjdG9yLk5BVl9MSVNUX0dST1VQKS5wcmV2KFNlbGVjdG9yLk5BVl9MSU5LUyArICcsICcgKyBTZWxlY3Rvci5MSVNUX0lURU1TKS5hZGRDbGFzcyhDbGFzc05hbWUuQUNUSVZFKTsKICAgICAgfQoKICAgICAgJCh0aGlzLl9zY3JvbGxFbGVtZW50KS50cmlnZ2VyKEV2ZW50LkFDVElWQVRFLCB7CiAgICAgICAgcmVsYXRlZFRhcmdldDogdGFyZ2V0CiAgICAgIH0pOwogICAgfTsKCiAgICBTY3JvbGxTcHkucHJvdG90eXBlLl9jbGVhciA9IGZ1bmN0aW9uIF9jbGVhcigpIHsKICAgICAgJCh0aGlzLl9zZWxlY3RvcikuZmlsdGVyKFNlbGVjdG9yLkFDVElWRSkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CiAgICB9OwoKICAgIC8vIHN0YXRpYwoKICAgIFNjcm9sbFNweS5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoREFUQV9LRVkpOwogICAgICAgIHZhciBfY29uZmlnID0gKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbmZpZykpID09PSAnb2JqZWN0JyAmJiBjb25maWc7CgogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgZGF0YSA9IG5ldyBTY3JvbGxTcHkodGhpcywgX2NvbmZpZyk7CiAgICAgICAgICAkKHRoaXMpLmRhdGEoREFUQV9LRVksIGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBpZiAoZGF0YVtjb25maWddID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBtZXRob2QgbmFtZWQgIicgKyBjb25maWcgKyAnIicpOwogICAgICAgICAgfQogICAgICAgICAgZGF0YVtjb25maWddKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgX2NyZWF0ZUNsYXNzKFNjcm9sbFNweSwgbnVsbCwgW3sKICAgICAga2V5OiAnVkVSU0lPTicsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBWRVJTSU9OOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ0RlZmF1bHQnLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gRGVmYXVsdDsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBTY3JvbGxTcHk7CiAgfSgpOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBEYXRhIEFwaSBpbXBsZW1lbnRhdGlvbgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkKHdpbmRvdykub24oRXZlbnQuTE9BRF9EQVRBX0FQSSwgZnVuY3Rpb24gKCkgewogICAgdmFyIHNjcm9sbFNweXMgPSAkLm1ha2VBcnJheSgkKFNlbGVjdG9yLkRBVEFfU1BZKSk7CgogICAgZm9yICh2YXIgaSA9IHNjcm9sbFNweXMubGVuZ3RoOyBpLS07KSB7CiAgICAgIHZhciAkc3B5ID0gJChzY3JvbGxTcHlzW2ldKTsKICAgICAgU2Nyb2xsU3B5Ll9qUXVlcnlJbnRlcmZhY2UuY2FsbCgkc3B5LCAkc3B5LmRhdGEoKSk7CiAgICB9CiAgfSk7CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIGpRdWVyeQogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICAkLmZuW05BTUVdID0gU2Nyb2xsU3B5Ll9qUXVlcnlJbnRlcmZhY2U7CiAgJC5mbltOQU1FXS5Db25zdHJ1Y3RvciA9IFNjcm9sbFNweTsKICAkLmZuW05BTUVdLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuW05BTUVdID0gSlFVRVJZX05PX0NPTkZMSUNUOwogICAgcmV0dXJuIFNjcm9sbFNweS5falF1ZXJ5SW50ZXJmYWNlOwogIH07CgogIHJldHVybiBTY3JvbGxTcHk7Cn0oalF1ZXJ5KTsKCi8qKgogKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogKiBCb290c3RyYXAgKHY0LjAuMC1iZXRhKTogdGFiLmpzCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqLwoKdmFyIFRhYiA9IGZ1bmN0aW9uICgkKSB7CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIENvbnN0YW50cwogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICB2YXIgTkFNRSA9ICd0YWInOwogIHZhciBWRVJTSU9OID0gJzQuMC4wLWJldGEnOwogIHZhciBEQVRBX0tFWSA9ICdicy50YWInOwogIHZhciBFVkVOVF9LRVkgPSAnLicgKyBEQVRBX0tFWTsKICB2YXIgREFUQV9BUElfS0VZID0gJy5kYXRhLWFwaSc7CiAgdmFyIEpRVUVSWV9OT19DT05GTElDVCA9ICQuZm5bTkFNRV07CiAgdmFyIFRSQU5TSVRJT05fRFVSQVRJT04gPSAxNTA7CgogIHZhciBFdmVudCA9IHsKICAgIEhJREU6ICdoaWRlJyArIEVWRU5UX0tFWSwKICAgIEhJRERFTjogJ2hpZGRlbicgKyBFVkVOVF9LRVksCiAgICBTSE9XOiAnc2hvdycgKyBFVkVOVF9LRVksCiAgICBTSE9XTjogJ3Nob3duJyArIEVWRU5UX0tFWSwKICAgIENMSUNLX0RBVEFfQVBJOiAnY2xpY2snICsgRVZFTlRfS0VZICsgREFUQV9BUElfS0VZCiAgfTsKCiAgdmFyIENsYXNzTmFtZSA9IHsKICAgIERST1BET1dOX01FTlU6ICdkcm9wZG93bi1tZW51JywKICAgIEFDVElWRTogJ2FjdGl2ZScsCiAgICBESVNBQkxFRDogJ2Rpc2FibGVkJywKICAgIEZBREU6ICdmYWRlJywKICAgIFNIT1c6ICdzaG93JwogIH07CgogIHZhciBTZWxlY3RvciA9IHsKICAgIERST1BET1dOOiAnLmRyb3Bkb3duJywKICAgIE5BVl9MSVNUX0dST1VQOiAnLm5hdiwgLmxpc3QtZ3JvdXAnLAogICAgQUNUSVZFOiAnLmFjdGl2ZScsCiAgICBEQVRBX1RPR0dMRTogJ1tkYXRhLXRvZ2dsZT0idGFiIl0sIFtkYXRhLXRvZ2dsZT0icGlsbCJdLCBbZGF0YS10b2dnbGU9Imxpc3QiXScsCiAgICBEUk9QRE9XTl9UT0dHTEU6ICcuZHJvcGRvd24tdG9nZ2xlJywKICAgIERST1BET1dOX0FDVElWRV9DSElMRDogJz4gLmRyb3Bkb3duLW1lbnUgLmFjdGl2ZScKCiAgICAvKioKICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICogQ2xhc3MgRGVmaW5pdGlvbgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKi8KCiAgfTsKICB2YXIgVGFiID0gZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gVGFiKGVsZW1lbnQpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRhYik7CgogICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDsKICAgIH0KCiAgICAvLyBnZXR0ZXJzCgogICAgLy8gcHVibGljCgogICAgVGFiLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gc2hvdygpIHsKICAgICAgdmFyIF90aGlzMjIgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuX2VsZW1lbnQucGFyZW50Tm9kZSAmJiB0aGlzLl9lbGVtZW50LnBhcmVudE5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFICYmICQodGhpcy5fZWxlbWVudCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSkgfHwgJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuRElTQUJMRUQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdGFyZ2V0ID0gdm9pZCAwOwogICAgICB2YXIgcHJldmlvdXMgPSB2b2lkIDA7CiAgICAgIHZhciBsaXN0RWxlbWVudCA9ICQodGhpcy5fZWxlbWVudCkuY2xvc2VzdChTZWxlY3Rvci5OQVZfTElTVF9HUk9VUClbMF07CiAgICAgIHZhciBzZWxlY3RvciA9IFV0aWwuZ2V0U2VsZWN0b3JGcm9tRWxlbWVudCh0aGlzLl9lbGVtZW50KTsKCiAgICAgIGlmIChsaXN0RWxlbWVudCkgewogICAgICAgIHByZXZpb3VzID0gJC5tYWtlQXJyYXkoJChsaXN0RWxlbWVudCkuZmluZChTZWxlY3Rvci5BQ1RJVkUpKTsKICAgICAgICBwcmV2aW91cyA9IHByZXZpb3VzW3ByZXZpb3VzLmxlbmd0aCAtIDFdOwogICAgICB9CgogICAgICB2YXIgaGlkZUV2ZW50ID0gJC5FdmVudChFdmVudC5ISURFLCB7CiAgICAgICAgcmVsYXRlZFRhcmdldDogdGhpcy5fZWxlbWVudAogICAgICB9KTsKCiAgICAgIHZhciBzaG93RXZlbnQgPSAkLkV2ZW50KEV2ZW50LlNIT1csIHsKICAgICAgICByZWxhdGVkVGFyZ2V0OiBwcmV2aW91cwogICAgICB9KTsKCiAgICAgIGlmIChwcmV2aW91cykgewogICAgICAgICQocHJldmlvdXMpLnRyaWdnZXIoaGlkZUV2ZW50KTsKICAgICAgfQoKICAgICAgJCh0aGlzLl9lbGVtZW50KS50cmlnZ2VyKHNob3dFdmVudCk7CgogICAgICBpZiAoc2hvd0V2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8IGhpZGVFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNlbGVjdG9yKSB7CiAgICAgICAgdGFyZ2V0ID0gJChzZWxlY3RvcilbMF07CiAgICAgIH0KCiAgICAgIHRoaXMuX2FjdGl2YXRlKHRoaXMuX2VsZW1lbnQsIGxpc3RFbGVtZW50KTsKCiAgICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uIGNvbXBsZXRlKCkgewogICAgICAgIHZhciBoaWRkZW5FdmVudCA9ICQuRXZlbnQoRXZlbnQuSElEREVOLCB7CiAgICAgICAgICByZWxhdGVkVGFyZ2V0OiBfdGhpczIyLl9lbGVtZW50CiAgICAgICAgfSk7CgogICAgICAgIHZhciBzaG93bkV2ZW50ID0gJC5FdmVudChFdmVudC5TSE9XTiwgewogICAgICAgICAgcmVsYXRlZFRhcmdldDogcHJldmlvdXMKICAgICAgICB9KTsKCiAgICAgICAgJChwcmV2aW91cykudHJpZ2dlcihoaWRkZW5FdmVudCk7CiAgICAgICAgJChfdGhpczIyLl9lbGVtZW50KS50cmlnZ2VyKHNob3duRXZlbnQpOwogICAgICB9OwoKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRoaXMuX2FjdGl2YXRlKHRhcmdldCwgdGFyZ2V0LnBhcmVudE5vZGUsIGNvbXBsZXRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb21wbGV0ZSgpOwogICAgICB9CiAgICB9OwoKICAgIFRhYi5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7CiAgICAgICQucmVtb3ZlRGF0YSh0aGlzLl9lbGVtZW50LCBEQVRBX0tFWSk7CiAgICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsOwogICAgfTsKCiAgICAvLyBwcml2YXRlCgogICAgVGFiLnByb3RvdHlwZS5fYWN0aXZhdGUgPSBmdW5jdGlvbiBfYWN0aXZhdGUoZWxlbWVudCwgY29udGFpbmVyLCBjYWxsYmFjaykgewogICAgICB2YXIgX3RoaXMyMyA9IHRoaXM7CgogICAgICB2YXIgYWN0aXZlID0gJChjb250YWluZXIpLmZpbmQoU2VsZWN0b3IuQUNUSVZFKVswXTsKICAgICAgdmFyIGlzVHJhbnNpdGlvbmluZyA9IGNhbGxiYWNrICYmIFV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgJiYgYWN0aXZlICYmICQoYWN0aXZlKS5oYXNDbGFzcyhDbGFzc05hbWUuRkFERSk7CgogICAgICB2YXIgY29tcGxldGUgPSBmdW5jdGlvbiBjb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gX3RoaXMyMy5fdHJhbnNpdGlvbkNvbXBsZXRlKGVsZW1lbnQsIGFjdGl2ZSwgaXNUcmFuc2l0aW9uaW5nLCBjYWxsYmFjayk7CiAgICAgIH07CgogICAgICBpZiAoYWN0aXZlICYmIGlzVHJhbnNpdGlvbmluZykgewogICAgICAgICQoYWN0aXZlKS5vbmUoVXRpbC5UUkFOU0lUSU9OX0VORCwgY29tcGxldGUpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKFRSQU5TSVRJT05fRFVSQVRJT04pOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbXBsZXRlKCk7CiAgICAgIH0KCiAgICAgIGlmIChhY3RpdmUpIHsKICAgICAgICAkKGFjdGl2ZSkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpOwogICAgICB9CiAgICB9OwoKICAgIFRhYi5wcm90b3R5cGUuX3RyYW5zaXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uIF90cmFuc2l0aW9uQ29tcGxldGUoZWxlbWVudCwgYWN0aXZlLCBpc1RyYW5zaXRpb25pbmcsIGNhbGxiYWNrKSB7CiAgICAgIGlmIChhY3RpdmUpIHsKICAgICAgICAkKGFjdGl2ZSkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CgogICAgICAgIHZhciBkcm9wZG93bkNoaWxkID0gJChhY3RpdmUucGFyZW50Tm9kZSkuZmluZChTZWxlY3Rvci5EUk9QRE9XTl9BQ1RJVkVfQ0hJTEQpWzBdOwoKICAgICAgICBpZiAoZHJvcGRvd25DaGlsZCkgewogICAgICAgICAgJChkcm9wZG93bkNoaWxkKS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuQUNUSVZFKTsKICAgICAgICB9CgogICAgICAgIGFjdGl2ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgICQoZWxlbWVudCkuYWRkQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7CiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgdHJ1ZSk7CgogICAgICBpZiAoaXNUcmFuc2l0aW9uaW5nKSB7CiAgICAgICAgVXRpbC5yZWZsb3coZWxlbWVudCk7CiAgICAgICAgJChlbGVtZW50KS5hZGRDbGFzcyhDbGFzc05hbWUuU0hPVyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJChlbGVtZW50KS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuRkFERSk7CiAgICAgIH0KCiAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUgJiYgJChlbGVtZW50LnBhcmVudE5vZGUpLmhhc0NsYXNzKENsYXNzTmFtZS5EUk9QRE9XTl9NRU5VKSkgewoKICAgICAgICB2YXIgZHJvcGRvd25FbGVtZW50ID0gJChlbGVtZW50KS5jbG9zZXN0KFNlbGVjdG9yLkRST1BET1dOKVswXTsKICAgICAgICBpZiAoZHJvcGRvd25FbGVtZW50KSB7CiAgICAgICAgICAkKGRyb3Bkb3duRWxlbWVudCkuZmluZChTZWxlY3Rvci5EUk9QRE9XTl9UT0dHTEUpLmFkZENsYXNzKENsYXNzTmFtZS5BQ1RJVkUpOwogICAgICAgIH0KCiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTsKICAgICAgfQoKICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfTsKCiAgICAvLyBzdGF0aWMKCiAgICBUYWIuX2pRdWVyeUludGVyZmFjZSA9IGZ1bmN0aW9uIF9qUXVlcnlJbnRlcmZhY2UoY29uZmlnKSB7CiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgdmFyIGRhdGEgPSAkdGhpcy5kYXRhKERBVEFfS0VZKTsKCiAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICBkYXRhID0gbmV3IFRhYih0aGlzKTsKICAgICAgICAgICR0aGlzLmRhdGEoREFUQV9LRVksIGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBpZiAoZGF0YVtjb25maWddID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBtZXRob2QgbmFtZWQgIicgKyBjb25maWcgKyAnIicpOwogICAgICAgICAgfQogICAgICAgICAgZGF0YVtjb25maWddKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgX2NyZWF0ZUNsYXNzKFRhYiwgbnVsbCwgW3sKICAgICAga2V5OiAnVkVSU0lPTicsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBWRVJTSU9OOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFRhYjsKICB9KCk7CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIERhdGEgQXBpIGltcGxlbWVudGF0aW9uCiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICovCgogICQoZG9jdW1lbnQpLm9uKEV2ZW50LkNMSUNLX0RBVEFfQVBJLCBTZWxlY3Rvci5EQVRBX1RPR0dMRSwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgVGFiLl9qUXVlcnlJbnRlcmZhY2UuY2FsbCgkKHRoaXMpLCAnc2hvdycpOwogIH0pOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBqUXVlcnkKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgJC5mbltOQU1FXSA9IFRhYi5falF1ZXJ5SW50ZXJmYWNlOwogICQuZm5bTkFNRV0uQ29uc3RydWN0b3IgPSBUYWI7CiAgJC5mbltOQU1FXS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkgewogICAgJC5mbltOQU1FXSA9IEpRVUVSWV9OT19DT05GTElDVDsKICAgIHJldHVybiBUYWIuX2pRdWVyeUludGVyZmFjZTsKICB9OwoKICByZXR1cm4gVGFiOwp9KGpRdWVyeSk7CgovKiBnbG9iYWwgUG9wcGVyICovCgovKioKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogQm9vdHN0cmFwICh2NC4wLjAtYmV0YSk6IHRvb2x0aXAuanMKICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSkKICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICovCgp2YXIgVG9vbHRpcCA9IGZ1bmN0aW9uICgkKSB7CgogIC8qKgogICAqIENoZWNrIGZvciBQb3BwZXIgZGVwZW5kZW5jeQogICAqIFBvcHBlciAtIGh0dHBzOi8vcG9wcGVyLmpzLm9yZwogICAqLwogIGlmICh0eXBlb2YgUG9wcGVyID09PSAndW5kZWZpbmVkJykgewogICAgdGhyb3cgbmV3IEVycm9yKCdCb290c3RyYXAgdG9vbHRpcHMgcmVxdWlyZSBQb3BwZXIuanMgKGh0dHBzOi8vcG9wcGVyLmpzLm9yZyknKTsKICB9CgogIC8qKgogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqIENvbnN0YW50cwogICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAqLwoKICB2YXIgTkFNRSA9ICd0b29sdGlwJzsKICB2YXIgVkVSU0lPTiA9ICc0LjAuMC1iZXRhJzsKICB2YXIgREFUQV9LRVkgPSAnYnMudG9vbHRpcCc7CiAgdmFyIEVWRU5UX0tFWSA9ICcuJyArIERBVEFfS0VZOwogIHZhciBKUVVFUllfTk9fQ09ORkxJQ1QgPSAkLmZuW05BTUVdOwogIHZhciBUUkFOU0lUSU9OX0RVUkFUSU9OID0gMTUwOwogIHZhciBDTEFTU19QUkVGSVggPSAnYnMtdG9vbHRpcCc7CiAgdmFyIEJTQ0xTX1BSRUZJWF9SRUdFWCA9IG5ldyBSZWdFeHAoJyhefFxccyknICsgQ0xBU1NfUFJFRklYICsgJ1xcUysnLCAnZycpOwoKICB2YXIgRGVmYXVsdFR5cGUgPSB7CiAgICBhbmltYXRpb246ICdib29sZWFuJywKICAgIHRlbXBsYXRlOiAnc3RyaW5nJywKICAgIHRpdGxlOiAnKHN0cmluZ3xlbGVtZW50fGZ1bmN0aW9uKScsCiAgICB0cmlnZ2VyOiAnc3RyaW5nJywKICAgIGRlbGF5OiAnKG51bWJlcnxvYmplY3QpJywKICAgIGh0bWw6ICdib29sZWFuJywKICAgIHNlbGVjdG9yOiAnKHN0cmluZ3xib29sZWFuKScsCiAgICBwbGFjZW1lbnQ6ICcoc3RyaW5nfGZ1bmN0aW9uKScsCiAgICBvZmZzZXQ6ICcobnVtYmVyfHN0cmluZyknLAogICAgY29udGFpbmVyOiAnKHN0cmluZ3xlbGVtZW50fGJvb2xlYW4pJywKICAgIGZhbGxiYWNrUGxhY2VtZW50OiAnKHN0cmluZ3xhcnJheSknCiAgfTsKCiAgdmFyIEF0dGFjaG1lbnRNYXAgPSB7CiAgICBBVVRPOiAnYXV0bycsCiAgICBUT1A6ICd0b3AnLAogICAgUklHSFQ6ICdyaWdodCcsCiAgICBCT1RUT006ICdib3R0b20nLAogICAgTEVGVDogJ2xlZnQnCiAgfTsKCiAgdmFyIERlZmF1bHQgPSB7CiAgICBhbmltYXRpb246IHRydWUsCiAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9InRvb2x0aXAiIHJvbGU9InRvb2x0aXAiPicgKyAnPGRpdiBjbGFzcz0iYXJyb3ciPjwvZGl2PicgKyAnPGRpdiBjbGFzcz0idG9vbHRpcC1pbm5lciI+PC9kaXY+PC9kaXY+JywKICAgIHRyaWdnZXI6ICdob3ZlciBmb2N1cycsCiAgICB0aXRsZTogJycsCiAgICBkZWxheTogMCwKICAgIGh0bWw6IGZhbHNlLAogICAgc2VsZWN0b3I6IGZhbHNlLAogICAgcGxhY2VtZW50OiAndG9wJywKICAgIG9mZnNldDogMCwKICAgIGNvbnRhaW5lcjogZmFsc2UsCiAgICBmYWxsYmFja1BsYWNlbWVudDogJ2ZsaXAnCiAgfTsKCiAgdmFyIEhvdmVyU3RhdGUgPSB7CiAgICBTSE9XOiAnc2hvdycsCiAgICBPVVQ6ICdvdXQnCiAgfTsKCiAgdmFyIEV2ZW50ID0gewogICAgSElERTogJ2hpZGUnICsgRVZFTlRfS0VZLAogICAgSElEREVOOiAnaGlkZGVuJyArIEVWRU5UX0tFWSwKICAgIFNIT1c6ICdzaG93JyArIEVWRU5UX0tFWSwKICAgIFNIT1dOOiAnc2hvd24nICsgRVZFTlRfS0VZLAogICAgSU5TRVJURUQ6ICdpbnNlcnRlZCcgKyBFVkVOVF9LRVksCiAgICBDTElDSzogJ2NsaWNrJyArIEVWRU5UX0tFWSwKICAgIEZPQ1VTSU46ICdmb2N1c2luJyArIEVWRU5UX0tFWSwKICAgIEZPQ1VTT1VUOiAnZm9jdXNvdXQnICsgRVZFTlRfS0VZLAogICAgTU9VU0VFTlRFUjogJ21vdXNlZW50ZXInICsgRVZFTlRfS0VZLAogICAgTU9VU0VMRUFWRTogJ21vdXNlbGVhdmUnICsgRVZFTlRfS0VZCiAgfTsKCiAgdmFyIENsYXNzTmFtZSA9IHsKICAgIEZBREU6ICdmYWRlJywKICAgIFNIT1c6ICdzaG93JwogIH07CgogIHZhciBTZWxlY3RvciA9IHsKICAgIFRPT0xUSVA6ICcudG9vbHRpcCcsCiAgICBUT09MVElQX0lOTkVSOiAnLnRvb2x0aXAtaW5uZXInLAogICAgQVJST1c6ICcuYXJyb3cnCiAgfTsKCiAgdmFyIFRyaWdnZXIgPSB7CiAgICBIT1ZFUjogJ2hvdmVyJywKICAgIEZPQ1VTOiAnZm9jdXMnLAogICAgQ0xJQ0s6ICdjbGljaycsCiAgICBNQU5VQUw6ICdtYW51YWwnCgogICAgLyoqCiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAqIENsYXNzIERlZmluaXRpb24KICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICovCgogIH07CiAgdmFyIFRvb2x0aXAgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBUb29sdGlwKGVsZW1lbnQsIGNvbmZpZykgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVG9vbHRpcCk7CgogICAgICAvLyBwcml2YXRlCiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IHRydWU7CiAgICAgIHRoaXMuX3RpbWVvdXQgPSAwOwogICAgICB0aGlzLl9ob3ZlclN0YXRlID0gJyc7CiAgICAgIHRoaXMuX2FjdGl2ZVRyaWdnZXIgPSB7fTsKICAgICAgdGhpcy5fcG9wcGVyID0gbnVsbDsKCiAgICAgIC8vIHByb3RlY3RlZAogICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgICB0aGlzLmNvbmZpZyA9IHRoaXMuX2dldENvbmZpZyhjb25maWcpOwogICAgICB0aGlzLnRpcCA9IG51bGw7CgogICAgICB0aGlzLl9zZXRMaXN0ZW5lcnMoKTsKICAgIH0KCiAgICAvLyBnZXR0ZXJzCgogICAgLy8gcHVibGljCgogICAgVG9vbHRpcC5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24gZW5hYmxlKCkgewogICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlOwogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gZGlzYWJsZSgpIHsKICAgICAgdGhpcy5faXNFbmFibGVkID0gZmFsc2U7CiAgICB9OwoKICAgIFRvb2x0aXAucHJvdG90eXBlLnRvZ2dsZUVuYWJsZWQgPSBmdW5jdGlvbiB0b2dnbGVFbmFibGVkKCkgewogICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhdGhpcy5faXNFbmFibGVkOwogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiB0b2dnbGUoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgdmFyIGRhdGFLZXkgPSB0aGlzLmNvbnN0cnVjdG9yLkRBVEFfS0VZOwogICAgICAgIHZhciBjb250ZXh0ID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXkpOwoKICAgICAgICBpZiAoIWNvbnRleHQpIHsKICAgICAgICAgIGNvbnRleHQgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihldmVudC5jdXJyZW50VGFyZ2V0LCB0aGlzLl9nZXREZWxlZ2F0ZUNvbmZpZygpKTsKICAgICAgICAgICQoZXZlbnQuY3VycmVudFRhcmdldCkuZGF0YShkYXRhS2V5LCBjb250ZXh0KTsKICAgICAgICB9CgogICAgICAgIGNvbnRleHQuX2FjdGl2ZVRyaWdnZXIuY2xpY2sgPSAhY29udGV4dC5fYWN0aXZlVHJpZ2dlci5jbGljazsKCiAgICAgICAgaWYgKGNvbnRleHQuX2lzV2l0aEFjdGl2ZVRyaWdnZXIoKSkgewogICAgICAgICAgY29udGV4dC5fZW50ZXIobnVsbCwgY29udGV4dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnRleHQuX2xlYXZlKG51bGwsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKCiAgICAgICAgaWYgKCQodGhpcy5nZXRUaXBFbGVtZW50KCkpLmhhc0NsYXNzKENsYXNzTmFtZS5TSE9XKSkgewogICAgICAgICAgdGhpcy5fbGVhdmUobnVsbCwgdGhpcyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9lbnRlcihudWxsLCB0aGlzKTsKICAgICAgfQogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVvdXQpOwoKICAgICAgJC5yZW1vdmVEYXRhKHRoaXMuZWxlbWVudCwgdGhpcy5jb25zdHJ1Y3Rvci5EQVRBX0tFWSk7CgogICAgICAkKHRoaXMuZWxlbWVudCkub2ZmKHRoaXMuY29uc3RydWN0b3IuRVZFTlRfS0VZKTsKICAgICAgJCh0aGlzLmVsZW1lbnQpLmNsb3Nlc3QoJy5tb2RhbCcpLm9mZignaGlkZS5icy5tb2RhbCcpOwoKICAgICAgaWYgKHRoaXMudGlwKSB7CiAgICAgICAgJCh0aGlzLnRpcCkucmVtb3ZlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IG51bGw7CiAgICAgIHRoaXMuX3RpbWVvdXQgPSBudWxsOwogICAgICB0aGlzLl9ob3ZlclN0YXRlID0gbnVsbDsKICAgICAgdGhpcy5fYWN0aXZlVHJpZ2dlciA9IG51bGw7CiAgICAgIGlmICh0aGlzLl9wb3BwZXIgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9wb3BwZXIuZGVzdHJveSgpOwogICAgICB9CiAgICAgIHRoaXMuX3BvcHBlciA9IG51bGw7CgogICAgICB0aGlzLmVsZW1lbnQgPSBudWxsOwogICAgICB0aGlzLmNvbmZpZyA9IG51bGw7CiAgICAgIHRoaXMudGlwID0gbnVsbDsKICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uIHNob3coKSB7CiAgICAgIHZhciBfdGhpczI0ID0gdGhpczsKCiAgICAgIGlmICgkKHRoaXMuZWxlbWVudCkuY3NzKCdkaXNwbGF5JykgPT09ICdub25lJykgewogICAgICAgIHRocm93IG5ldyBFcnJvcignUGxlYXNlIHVzZSBzaG93IG9uIHZpc2libGUgZWxlbWVudHMnKTsKICAgICAgfQoKICAgICAgdmFyIHNob3dFdmVudCA9ICQuRXZlbnQodGhpcy5jb25zdHJ1Y3Rvci5FdmVudC5TSE9XKTsKICAgICAgaWYgKHRoaXMuaXNXaXRoQ29udGVudCgpICYmIHRoaXMuX2lzRW5hYmxlZCkgewogICAgICAgICQodGhpcy5lbGVtZW50KS50cmlnZ2VyKHNob3dFdmVudCk7CgogICAgICAgIHZhciBpc0luVGhlRG9tID0gJC5jb250YWlucyh0aGlzLmVsZW1lbnQub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHRoaXMuZWxlbWVudCk7CgogICAgICAgIGlmIChzaG93RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgIWlzSW5UaGVEb20pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0aXAgPSB0aGlzLmdldFRpcEVsZW1lbnQoKTsKICAgICAgICB2YXIgdGlwSWQgPSBVdGlsLmdldFVJRCh0aGlzLmNvbnN0cnVjdG9yLk5BTUUpOwoKICAgICAgICB0aXAuc2V0QXR0cmlidXRlKCdpZCcsIHRpcElkKTsKICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5JywgdGlwSWQpOwoKICAgICAgICB0aGlzLnNldENvbnRlbnQoKTsKCiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmFuaW1hdGlvbikgewogICAgICAgICAgJCh0aXApLmFkZENsYXNzKENsYXNzTmFtZS5GQURFKTsKICAgICAgICB9CgogICAgICAgIHZhciBwbGFjZW1lbnQgPSB0eXBlb2YgdGhpcy5jb25maWcucGxhY2VtZW50ID09PSAnZnVuY3Rpb24nID8gdGhpcy5jb25maWcucGxhY2VtZW50LmNhbGwodGhpcywgdGlwLCB0aGlzLmVsZW1lbnQpIDogdGhpcy5jb25maWcucGxhY2VtZW50OwoKICAgICAgICB2YXIgYXR0YWNobWVudCA9IHRoaXMuX2dldEF0dGFjaG1lbnQocGxhY2VtZW50KTsKICAgICAgICB0aGlzLmFkZEF0dGFjaG1lbnRDbGFzcyhhdHRhY2htZW50KTsKCiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY29uZmlnLmNvbnRhaW5lciA9PT0gZmFsc2UgPyBkb2N1bWVudC5ib2R5IDogJCh0aGlzLmNvbmZpZy5jb250YWluZXIpOwoKICAgICAgICAkKHRpcCkuZGF0YSh0aGlzLmNvbnN0cnVjdG9yLkRBVEFfS0VZLCB0aGlzKTsKCiAgICAgICAgaWYgKCEkLmNvbnRhaW5zKHRoaXMuZWxlbWVudC5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgdGhpcy50aXApKSB7CiAgICAgICAgICAkKHRpcCkuYXBwZW5kVG8oY29udGFpbmVyKTsKICAgICAgICB9CgogICAgICAgICQodGhpcy5lbGVtZW50KS50cmlnZ2VyKHRoaXMuY29uc3RydWN0b3IuRXZlbnQuSU5TRVJURUQpOwoKICAgICAgICB0aGlzLl9wb3BwZXIgPSBuZXcgUG9wcGVyKHRoaXMuZWxlbWVudCwgdGlwLCB7CiAgICAgICAgICBwbGFjZW1lbnQ6IGF0dGFjaG1lbnQsCiAgICAgICAgICBtb2RpZmllcnM6IHsKICAgICAgICAgICAgb2Zmc2V0OiB7CiAgICAgICAgICAgICAgb2Zmc2V0OiB0aGlzLmNvbmZpZy5vZmZzZXQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZmxpcDogewogICAgICAgICAgICAgIGJlaGF2aW9yOiB0aGlzLmNvbmZpZy5mYWxsYmFja1BsYWNlbWVudAogICAgICAgICAgICB9LAogICAgICAgICAgICBhcnJvdzogewogICAgICAgICAgICAgIGVsZW1lbnQ6IFNlbGVjdG9yLkFSUk9XCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBvbkNyZWF0ZTogZnVuY3Rpb24gb25DcmVhdGUoZGF0YSkgewogICAgICAgICAgICBpZiAoZGF0YS5vcmlnaW5hbFBsYWNlbWVudCAhPT0gZGF0YS5wbGFjZW1lbnQpIHsKICAgICAgICAgICAgICBfdGhpczI0Ll9oYW5kbGVQb3BwZXJQbGFjZW1lbnRDaGFuZ2UoZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBvblVwZGF0ZTogZnVuY3Rpb24gb25VcGRhdGUoZGF0YSkgewogICAgICAgICAgICBfdGhpczI0Ll9oYW5kbGVQb3BwZXJQbGFjZW1lbnRDaGFuZ2UoZGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgICQodGlwKS5hZGRDbGFzcyhDbGFzc05hbWUuU0hPVyk7CgogICAgICAgIC8vIGlmIHRoaXMgaXMgYSB0b3VjaC1lbmFibGVkIGRldmljZSB3ZSBhZGQgZXh0cmEKICAgICAgICAvLyBlbXB0eSBtb3VzZW92ZXIgbGlzdGVuZXJzIHRvIHRoZSBib2R5J3MgaW1tZWRpYXRlIGNoaWxkcmVuOwogICAgICAgIC8vIG9ubHkgbmVlZGVkIGJlY2F1c2Ugb2YgYnJva2VuIGV2ZW50IGRlbGVnYXRpb24gb24gaU9TCiAgICAgICAgLy8gaHR0cHM6Ly93d3cucXVpcmtzbW9kZS5vcmcvYmxvZy9hcmNoaXZlcy8yMDE0LzAyL21vdXNlX2V2ZW50X2J1Yi5odG1sCiAgICAgICAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgewogICAgICAgICAgJCgnYm9keScpLmNoaWxkcmVuKCkub24oJ21vdXNlb3ZlcicsIG51bGwsICQubm9vcCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29tcGxldGUgPSBmdW5jdGlvbiBjb21wbGV0ZSgpIHsKICAgICAgICAgIGlmIChfdGhpczI0LmNvbmZpZy5hbmltYXRpb24pIHsKICAgICAgICAgICAgX3RoaXMyNC5fZml4VHJhbnNpdGlvbigpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHByZXZIb3ZlclN0YXRlID0gX3RoaXMyNC5faG92ZXJTdGF0ZTsKICAgICAgICAgIF90aGlzMjQuX2hvdmVyU3RhdGUgPSBudWxsOwoKICAgICAgICAgICQoX3RoaXMyNC5lbGVtZW50KS50cmlnZ2VyKF90aGlzMjQuY29uc3RydWN0b3IuRXZlbnQuU0hPV04pOwoKICAgICAgICAgIGlmIChwcmV2SG92ZXJTdGF0ZSA9PT0gSG92ZXJTdGF0ZS5PVVQpIHsKICAgICAgICAgICAgX3RoaXMyNC5fbGVhdmUobnVsbCwgX3RoaXMyNCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKFV0aWwuc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgJiYgJCh0aGlzLnRpcCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLkZBREUpKSB7CiAgICAgICAgICAkKHRoaXMudGlwKS5vbmUoVXRpbC5UUkFOU0lUSU9OX0VORCwgY29tcGxldGUpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKFRvb2x0aXAuX1RSQU5TSVRJT05fRFVSQVRJT04pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb21wbGV0ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gaGlkZShjYWxsYmFjaykgewogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7CgogICAgICB2YXIgdGlwID0gdGhpcy5nZXRUaXBFbGVtZW50KCk7CiAgICAgIHZhciBoaWRlRXZlbnQgPSAkLkV2ZW50KHRoaXMuY29uc3RydWN0b3IuRXZlbnQuSElERSk7CiAgICAgIHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uIGNvbXBsZXRlKCkgewogICAgICAgIGlmIChfdGhpczI1Ll9ob3ZlclN0YXRlICE9PSBIb3ZlclN0YXRlLlNIT1cgJiYgdGlwLnBhcmVudE5vZGUpIHsKICAgICAgICAgIHRpcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRpcCk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczI1Ll9jbGVhblRpcENsYXNzKCk7CiAgICAgICAgX3RoaXMyNS5lbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScpOwogICAgICAgICQoX3RoaXMyNS5lbGVtZW50KS50cmlnZ2VyKF90aGlzMjUuY29uc3RydWN0b3IuRXZlbnQuSElEREVOKTsKICAgICAgICBpZiAoX3RoaXMyNS5fcG9wcGVyICE9PSBudWxsKSB7CiAgICAgICAgICBfdGhpczI1Ll9wb3BwZXIuZGVzdHJveSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgICQodGhpcy5lbGVtZW50KS50cmlnZ2VyKGhpZGVFdmVudCk7CgogICAgICBpZiAoaGlkZUV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAkKHRpcCkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpOwoKICAgICAgLy8gaWYgdGhpcyBpcyBhIHRvdWNoLWVuYWJsZWQgZGV2aWNlIHdlIHJlbW92ZSB0aGUgZXh0cmEKICAgICAgLy8gZW1wdHkgbW91c2VvdmVyIGxpc3RlbmVycyB3ZSBhZGRlZCBmb3IgaU9TIHN1cHBvcnQKICAgICAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgewogICAgICAgICQoJ2JvZHknKS5jaGlsZHJlbigpLm9mZignbW91c2VvdmVyJywgbnVsbCwgJC5ub29wKTsKICAgICAgfQoKICAgICAgdGhpcy5fYWN0aXZlVHJpZ2dlcltUcmlnZ2VyLkNMSUNLXSA9IGZhbHNlOwogICAgICB0aGlzLl9hY3RpdmVUcmlnZ2VyW1RyaWdnZXIuRk9DVVNdID0gZmFsc2U7CiAgICAgIHRoaXMuX2FjdGl2ZVRyaWdnZXJbVHJpZ2dlci5IT1ZFUl0gPSBmYWxzZTsKCiAgICAgIGlmIChVdGlsLnN1cHBvcnRzVHJhbnNpdGlvbkVuZCgpICYmICQodGhpcy50aXApLmhhc0NsYXNzKENsYXNzTmFtZS5GQURFKSkgewoKICAgICAgICAkKHRpcCkub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIGNvbXBsZXRlKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChUUkFOU0lUSU9OX0RVUkFUSU9OKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb21wbGV0ZSgpOwogICAgICB9CgogICAgICB0aGlzLl9ob3ZlclN0YXRlID0gJyc7CiAgICB9OwoKICAgIFRvb2x0aXAucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIHVwZGF0ZSgpIHsKICAgICAgaWYgKHRoaXMuX3BvcHBlciAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuX3BvcHBlci5zY2hlZHVsZVVwZGF0ZSgpOwogICAgICB9CiAgICB9OwoKICAgIC8vIHByb3RlY3RlZAoKICAgIFRvb2x0aXAucHJvdG90eXBlLmlzV2l0aENvbnRlbnQgPSBmdW5jdGlvbiBpc1dpdGhDb250ZW50KCkgewogICAgICByZXR1cm4gQm9vbGVhbih0aGlzLmdldFRpdGxlKCkpOwogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS5hZGRBdHRhY2htZW50Q2xhc3MgPSBmdW5jdGlvbiBhZGRBdHRhY2htZW50Q2xhc3MoYXR0YWNobWVudCkgewogICAgICAkKHRoaXMuZ2V0VGlwRWxlbWVudCgpKS5hZGRDbGFzcyhDTEFTU19QUkVGSVggKyAnLScgKyBhdHRhY2htZW50KTsKICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuZ2V0VGlwRWxlbWVudCA9IGZ1bmN0aW9uIGdldFRpcEVsZW1lbnQoKSB7CiAgICAgIHJldHVybiB0aGlzLnRpcCA9IHRoaXMudGlwIHx8ICQodGhpcy5jb25maWcudGVtcGxhdGUpWzBdOwogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gc2V0Q29udGVudCgpIHsKICAgICAgdmFyICR0aXAgPSAkKHRoaXMuZ2V0VGlwRWxlbWVudCgpKTsKICAgICAgdGhpcy5zZXRFbGVtZW50Q29udGVudCgkdGlwLmZpbmQoU2VsZWN0b3IuVE9PTFRJUF9JTk5FUiksIHRoaXMuZ2V0VGl0bGUoKSk7CiAgICAgICR0aXAucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkZBREUgKyAnICcgKyBDbGFzc05hbWUuU0hPVyk7CiAgICB9OwoKICAgIFRvb2x0aXAucHJvdG90eXBlLnNldEVsZW1lbnRDb250ZW50ID0gZnVuY3Rpb24gc2V0RWxlbWVudENvbnRlbnQoJGVsZW1lbnQsIGNvbnRlbnQpIHsKICAgICAgdmFyIGh0bWwgPSB0aGlzLmNvbmZpZy5odG1sOwogICAgICBpZiAoKHR5cGVvZiBjb250ZW50ID09PSAndW5kZWZpbmVkJyA\/ICd1bmRlZmluZWQnIDogX3R5cGVvZihjb250ZW50KSkgPT09ICdvYmplY3QnICYmIChjb250ZW50Lm5vZGVUeXBlIHx8IGNvbnRlbnQuanF1ZXJ5KSkgewogICAgICAgIC8vIGNvbnRlbnQgaXMgYSBET00gbm9kZSBvciBhIGpRdWVyeQogICAgICAgIGlmIChodG1sKSB7CiAgICAgICAgICBpZiAoISQoY29udGVudCkucGFyZW50KCkuaXMoJGVsZW1lbnQpKSB7CiAgICAgICAgICAgICRlbGVtZW50LmVtcHR5KCkuYXBwZW5kKGNvbnRlbnQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkZWxlbWVudC50ZXh0KCQoY29udGVudCkudGV4dCgpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJGVsZW1lbnRbaHRtbCA\/ICdodG1sJyA6ICd0ZXh0J10oY29udGVudCk7CiAgICAgIH0KICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuZ2V0VGl0bGUgPSBmdW5jdGlvbiBnZXRUaXRsZSgpIHsKICAgICAgdmFyIHRpdGxlID0gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1vcmlnaW5hbC10aXRsZScpOwoKICAgICAgaWYgKCF0aXRsZSkgewogICAgICAgIHRpdGxlID0gdHlwZW9mIHRoaXMuY29uZmlnLnRpdGxlID09PSAnZnVuY3Rpb24nID8gdGhpcy5jb25maWcudGl0bGUuY2FsbCh0aGlzLmVsZW1lbnQpIDogdGhpcy5jb25maWcudGl0bGU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aXRsZTsKICAgIH07CgogICAgLy8gcHJpdmF0ZQoKICAgIFRvb2x0aXAucHJvdG90eXBlLl9nZXRBdHRhY2htZW50ID0gZnVuY3Rpb24gX2dldEF0dGFjaG1lbnQocGxhY2VtZW50KSB7CiAgICAgIHJldHVybiBBdHRhY2htZW50TWFwW3BsYWNlbWVudC50b1VwcGVyQ2FzZSgpXTsKICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuX3NldExpc3RlbmVycyA9IGZ1bmN0aW9uIF9zZXRMaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBfdGhpczI2ID0gdGhpczsKCiAgICAgIHZhciB0cmlnZ2VycyA9IHRoaXMuY29uZmlnLnRyaWdnZXIuc3BsaXQoJyAnKTsKCiAgICAgIHRyaWdnZXJzLmZvckVhY2goZnVuY3Rpb24gKHRyaWdnZXIpIHsKICAgICAgICBpZiAodHJpZ2dlciA9PT0gJ2NsaWNrJykgewogICAgICAgICAgJChfdGhpczI2LmVsZW1lbnQpLm9uKF90aGlzMjYuY29uc3RydWN0b3IuRXZlbnQuQ0xJQ0ssIF90aGlzMjYuY29uZmlnLnNlbGVjdG9yLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMjYudG9nZ2xlKGV2ZW50KTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAodHJpZ2dlciAhPT0gVHJpZ2dlci5NQU5VQUwpIHsKICAgICAgICAgIHZhciBldmVudEluID0gdHJpZ2dlciA9PT0gVHJpZ2dlci5IT1ZFUiA\/IF90aGlzMjYuY29uc3RydWN0b3IuRXZlbnQuTU9VU0VFTlRFUiA6IF90aGlzMjYuY29uc3RydWN0b3IuRXZlbnQuRk9DVVNJTjsKICAgICAgICAgIHZhciBldmVudE91dCA9IHRyaWdnZXIgPT09IFRyaWdnZXIuSE9WRVIgPyBfdGhpczI2LmNvbnN0cnVjdG9yLkV2ZW50Lk1PVVNFTEVBVkUgOiBfdGhpczI2LmNvbnN0cnVjdG9yLkV2ZW50LkZPQ1VTT1VUOwoKICAgICAgICAgICQoX3RoaXMyNi5lbGVtZW50KS5vbihldmVudEluLCBfdGhpczI2LmNvbmZpZy5zZWxlY3RvciwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczI2Ll9lbnRlcihldmVudCk7CiAgICAgICAgICB9KS5vbihldmVudE91dCwgX3RoaXMyNi5jb25maWcuc2VsZWN0b3IsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMyNi5fbGVhdmUoZXZlbnQpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAkKF90aGlzMjYuZWxlbWVudCkuY2xvc2VzdCgnLm1vZGFsJykub24oJ2hpZGUuYnMubW9kYWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyNi5oaWRlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgaWYgKHRoaXMuY29uZmlnLnNlbGVjdG9yKSB7CiAgICAgICAgdGhpcy5jb25maWcgPSAkLmV4dGVuZCh7fSwgdGhpcy5jb25maWcsIHsKICAgICAgICAgIHRyaWdnZXI6ICdtYW51YWwnLAogICAgICAgICAgc2VsZWN0b3I6ICcnCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fZml4VGl0bGUoKTsKICAgICAgfQogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS5fZml4VGl0bGUgPSBmdW5jdGlvbiBfZml4VGl0bGUoKSB7CiAgICAgIHZhciB0aXRsZVR5cGUgPSBfdHlwZW9mKHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKSk7CiAgICAgIGlmICh0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKCd0aXRsZScpIHx8IHRpdGxlVHlwZSAhPT0gJ3N0cmluZycpIHsKICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLW9yaWdpbmFsLXRpdGxlJywgdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgndGl0bGUnKSB8fCAnJyk7CiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgndGl0bGUnLCAnJyk7CiAgICAgIH0KICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuX2VudGVyID0gZnVuY3Rpb24gX2VudGVyKGV2ZW50LCBjb250ZXh0KSB7CiAgICAgIHZhciBkYXRhS2V5ID0gdGhpcy5jb25zdHJ1Y3Rvci5EQVRBX0tFWTsKCiAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8ICQoZXZlbnQuY3VycmVudFRhcmdldCkuZGF0YShkYXRhS2V5KTsKCiAgICAgIGlmICghY29udGV4dCkgewogICAgICAgIGNvbnRleHQgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihldmVudC5jdXJyZW50VGFyZ2V0LCB0aGlzLl9nZXREZWxlZ2F0ZUNvbmZpZygpKTsKICAgICAgICAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmRhdGEoZGF0YUtleSwgY29udGV4dCk7CiAgICAgIH0KCiAgICAgIGlmIChldmVudCkgewogICAgICAgIGNvbnRleHQuX2FjdGl2ZVRyaWdnZXJbZXZlbnQudHlwZSA9PT0gJ2ZvY3VzaW4nID8gVHJpZ2dlci5GT0NVUyA6IFRyaWdnZXIuSE9WRVJdID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKCQoY29udGV4dC5nZXRUaXBFbGVtZW50KCkpLmhhc0NsYXNzKENsYXNzTmFtZS5TSE9XKSB8fCBjb250ZXh0Ll9ob3ZlclN0YXRlID09PSBIb3ZlclN0YXRlLlNIT1cpIHsKICAgICAgICBjb250ZXh0Ll9ob3ZlclN0YXRlID0gSG92ZXJTdGF0ZS5TSE9XOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY2xlYXJUaW1lb3V0KGNvbnRleHQuX3RpbWVvdXQpOwoKICAgICAgY29udGV4dC5faG92ZXJTdGF0ZSA9IEhvdmVyU3RhdGUuU0hPVzsKCiAgICAgIGlmICghY29udGV4dC5jb25maWcuZGVsYXkgfHwgIWNvbnRleHQuY29uZmlnLmRlbGF5LnNob3cpIHsKICAgICAgICBjb250ZXh0LnNob3coKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnRleHQuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoY29udGV4dC5faG92ZXJTdGF0ZSA9PT0gSG92ZXJTdGF0ZS5TSE9XKSB7CiAgICAgICAgICBjb250ZXh0LnNob3coKTsKICAgICAgICB9CiAgICAgIH0sIGNvbnRleHQuY29uZmlnLmRlbGF5LnNob3cpOwogICAgfTsKCiAgICBUb29sdGlwLnByb3RvdHlwZS5fbGVhdmUgPSBmdW5jdGlvbiBfbGVhdmUoZXZlbnQsIGNvbnRleHQpIHsKICAgICAgdmFyIGRhdGFLZXkgPSB0aGlzLmNvbnN0cnVjdG9yLkRBVEFfS0VZOwoKICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXkpOwoKICAgICAgaWYgKCFjb250ZXh0KSB7CiAgICAgICAgY29udGV4dCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKGV2ZW50LmN1cnJlbnRUYXJnZXQsIHRoaXMuX2dldERlbGVnYXRlQ29uZmlnKCkpOwogICAgICAgICQoZXZlbnQuY3VycmVudFRhcmdldCkuZGF0YShkYXRhS2V5LCBjb250ZXh0KTsKICAgICAgfQoKICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgY29udGV4dC5fYWN0aXZlVHJpZ2dlcltldmVudC50eXBlID09PSAnZm9jdXNvdXQnID8gVHJpZ2dlci5GT0NVUyA6IFRyaWdnZXIuSE9WRVJdID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChjb250ZXh0Ll9pc1dpdGhBY3RpdmVUcmlnZ2VyKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNsZWFyVGltZW91dChjb250ZXh0Ll90aW1lb3V0KTsKCiAgICAgIGNvbnRleHQuX2hvdmVyU3RhdGUgPSBIb3ZlclN0YXRlLk9VVDsKCiAgICAgIGlmICghY29udGV4dC5jb25maWcuZGVsYXkgfHwgIWNvbnRleHQuY29uZmlnLmRlbGF5LmhpZGUpIHsKICAgICAgICBjb250ZXh0LmhpZGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnRleHQuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoY29udGV4dC5faG92ZXJTdGF0ZSA9PT0gSG92ZXJTdGF0ZS5PVVQpIHsKICAgICAgICAgIGNvbnRleHQuaGlkZSgpOwogICAgICAgIH0KICAgICAgfSwgY29udGV4dC5jb25maWcuZGVsYXkuaGlkZSk7CiAgICB9OwoKICAgIFRvb2x0aXAucHJvdG90eXBlLl9pc1dpdGhBY3RpdmVUcmlnZ2VyID0gZnVuY3Rpb24gX2lzV2l0aEFjdGl2ZVRyaWdnZXIoKSB7CiAgICAgIGZvciAodmFyIHRyaWdnZXIgaW4gdGhpcy5fYWN0aXZlVHJpZ2dlcikgewogICAgICAgIGlmICh0aGlzLl9hY3RpdmVUcmlnZ2VyW3RyaWdnZXJdKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuX2dldENvbmZpZyA9IGZ1bmN0aW9uIF9nZXRDb25maWcoY29uZmlnKSB7CiAgICAgIGNvbmZpZyA9ICQuZXh0ZW5kKHt9LCB0aGlzLmNvbnN0cnVjdG9yLkRlZmF1bHQsICQodGhpcy5lbGVtZW50KS5kYXRhKCksIGNvbmZpZyk7CgogICAgICBpZiAoY29uZmlnLmRlbGF5ICYmIHR5cGVvZiBjb25maWcuZGVsYXkgPT09ICdudW1iZXInKSB7CiAgICAgICAgY29uZmlnLmRlbGF5ID0gewogICAgICAgICAgc2hvdzogY29uZmlnLmRlbGF5LAogICAgICAgICAgaGlkZTogY29uZmlnLmRlbGF5CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgaWYgKGNvbmZpZy50aXRsZSAmJiB0eXBlb2YgY29uZmlnLnRpdGxlID09PSAnbnVtYmVyJykgewogICAgICAgIGNvbmZpZy50aXRsZSA9IGNvbmZpZy50aXRsZS50b1N0cmluZygpOwogICAgICB9CgogICAgICBpZiAoY29uZmlnLmNvbnRlbnQgJiYgdHlwZW9mIGNvbmZpZy5jb250ZW50ID09PSAnbnVtYmVyJykgewogICAgICAgIGNvbmZpZy5jb250ZW50ID0gY29uZmlnLmNvbnRlbnQudG9TdHJpbmcoKTsKICAgICAgfQoKICAgICAgVXRpbC50eXBlQ2hlY2tDb25maWcoTkFNRSwgY29uZmlnLCB0aGlzLmNvbnN0cnVjdG9yLkRlZmF1bHRUeXBlKTsKCiAgICAgIHJldHVybiBjb25maWc7CiAgICB9OwoKICAgIFRvb2x0aXAucHJvdG90eXBlLl9nZXREZWxlZ2F0ZUNvbmZpZyA9IGZ1bmN0aW9uIF9nZXREZWxlZ2F0ZUNvbmZpZygpIHsKICAgICAgdmFyIGNvbmZpZyA9IHt9OwoKICAgICAgaWYgKHRoaXMuY29uZmlnKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuY29uZmlnKSB7CiAgICAgICAgICBpZiAodGhpcy5jb25zdHJ1Y3Rvci5EZWZhdWx0W2tleV0gIT09IHRoaXMuY29uZmlnW2tleV0pIHsKICAgICAgICAgICAgY29uZmlnW2tleV0gPSB0aGlzLmNvbmZpZ1trZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGNvbmZpZzsKICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuX2NsZWFuVGlwQ2xhc3MgPSBmdW5jdGlvbiBfY2xlYW5UaXBDbGFzcygpIHsKICAgICAgdmFyICR0aXAgPSAkKHRoaXMuZ2V0VGlwRWxlbWVudCgpKTsKICAgICAgdmFyIHRhYkNsYXNzID0gJHRpcC5hdHRyKCdjbGFzcycpLm1hdGNoKEJTQ0xTX1BSRUZJWF9SRUdFWCk7CiAgICAgIGlmICh0YWJDbGFzcyAhPT0gbnVsbCAmJiB0YWJDbGFzcy5sZW5ndGggPiAwKSB7CiAgICAgICAgJHRpcC5yZW1vdmVDbGFzcyh0YWJDbGFzcy5qb2luKCcnKSk7CiAgICAgIH0KICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuX2hhbmRsZVBvcHBlclBsYWNlbWVudENoYW5nZSA9IGZ1bmN0aW9uIF9oYW5kbGVQb3BwZXJQbGFjZW1lbnRDaGFuZ2UoZGF0YSkgewogICAgICB0aGlzLl9jbGVhblRpcENsYXNzKCk7CiAgICAgIHRoaXMuYWRkQXR0YWNobWVudENsYXNzKHRoaXMuX2dldEF0dGFjaG1lbnQoZGF0YS5wbGFjZW1lbnQpKTsKICAgIH07CgogICAgVG9vbHRpcC5wcm90b3R5cGUuX2ZpeFRyYW5zaXRpb24gPSBmdW5jdGlvbiBfZml4VHJhbnNpdGlvbigpIHsKICAgICAgdmFyIHRpcCA9IHRoaXMuZ2V0VGlwRWxlbWVudCgpOwogICAgICB2YXIgaW5pdENvbmZpZ0FuaW1hdGlvbiA9IHRoaXMuY29uZmlnLmFuaW1hdGlvbjsKICAgICAgaWYgKHRpcC5nZXRBdHRyaWJ1dGUoJ3gtcGxhY2VtZW50JykgIT09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgJCh0aXApLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5GQURFKTsKICAgICAgdGhpcy5jb25maWcuYW5pbWF0aW9uID0gZmFsc2U7CiAgICAgIHRoaXMuaGlkZSgpOwogICAgICB0aGlzLnNob3coKTsKICAgICAgdGhpcy5jb25maWcuYW5pbWF0aW9uID0gaW5pdENvbmZpZ0FuaW1hdGlvbjsKICAgIH07CgogICAgLy8gc3RhdGljCgogICAgVG9vbHRpcC5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoREFUQV9LRVkpOwogICAgICAgIHZhciBfY29uZmlnID0gKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbmZpZykpID09PSAnb2JqZWN0JyAmJiBjb25maWc7CgogICAgICAgIGlmICghZGF0YSAmJiAvZGlzcG9zZXxoaWRlLy50ZXN0KGNvbmZpZykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgZGF0YSA9IG5ldyBUb29sdGlwKHRoaXMsIF9jb25maWcpOwogICAgICAgICAgJCh0aGlzKS5kYXRhKERBVEFfS0VZLCBkYXRhKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykgewogICAgICAgICAgaWYgKGRhdGFbY29uZmlnXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gbWV0aG9kIG5hbWVkICInICsgY29uZmlnICsgJyInKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGFbY29uZmlnXSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIF9jcmVhdGVDbGFzcyhUb29sdGlwLCBudWxsLCBbewogICAgICBrZXk6ICdWRVJTSU9OJywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIFZFUlNJT047CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnRGVmYXVsdCcsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBEZWZhdWx0OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ05BTUUnLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gTkFNRTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdEQVRBX0tFWScsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBEQVRBX0tFWTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdFdmVudCcsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBFdmVudDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdFVkVOVF9LRVknLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gRVZFTlRfS0VZOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ0RlZmF1bHRUeXBlJywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIERlZmF1bHRUeXBlOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFRvb2x0aXA7CiAgfSgpOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBqUXVlcnkKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgJC5mbltOQU1FXSA9IFRvb2x0aXAuX2pRdWVyeUludGVyZmFjZTsKICAkLmZuW05BTUVdLkNvbnN0cnVjdG9yID0gVG9vbHRpcDsKICAkLmZuW05BTUVdLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuW05BTUVdID0gSlFVRVJZX05PX0NPTkZMSUNUOwogICAgcmV0dXJuIFRvb2x0aXAuX2pRdWVyeUludGVyZmFjZTsKICB9OwoKICByZXR1cm4gVG9vbHRpcDsKfShqUXVlcnkpOwoKLyoqCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqIEJvb3RzdHJhcCAodjQuMC4wLWJldGEpOiBwb3BvdmVyLmpzCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAqLwoKdmFyIFBvcG92ZXIgPSBmdW5jdGlvbiAoJCkgewoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBDb25zdGFudHMKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgdmFyIE5BTUUgPSAncG9wb3Zlcic7CiAgdmFyIFZFUlNJT04gPSAnNC4wLjAtYmV0YSc7CiAgdmFyIERBVEFfS0VZID0gJ2JzLnBvcG92ZXInOwogIHZhciBFVkVOVF9LRVkgPSAnLicgKyBEQVRBX0tFWTsKICB2YXIgSlFVRVJZX05PX0NPTkZMSUNUID0gJC5mbltOQU1FXTsKICB2YXIgQ0xBU1NfUFJFRklYID0gJ2JzLXBvcG92ZXInOwogIHZhciBCU0NMU19QUkVGSVhfUkVHRVggPSBuZXcgUmVnRXhwKCcoXnxcXHMpJyArIENMQVNTX1BSRUZJWCArICdcXFMrJywgJ2cnKTsKCiAgdmFyIERlZmF1bHQgPSAkLmV4dGVuZCh7fSwgVG9vbHRpcC5EZWZhdWx0LCB7CiAgICBwbGFjZW1lbnQ6ICdyaWdodCcsCiAgICB0cmlnZ2VyOiAnY2xpY2snLAogICAgY29udGVudDogJycsCiAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9InBvcG92ZXIiIHJvbGU9InRvb2x0aXAiPicgKyAnPGRpdiBjbGFzcz0iYXJyb3ciPjwvZGl2PicgKyAnPGgzIGNsYXNzPSJwb3BvdmVyLWhlYWRlciI+PC9oMz4nICsgJzxkaXYgY2xhc3M9InBvcG92ZXItYm9keSI+PC9kaXY+PC9kaXY+JwogIH0pOwoKICB2YXIgRGVmYXVsdFR5cGUgPSAkLmV4dGVuZCh7fSwgVG9vbHRpcC5EZWZhdWx0VHlwZSwgewogICAgY29udGVudDogJyhzdHJpbmd8ZWxlbWVudHxmdW5jdGlvbiknCiAgfSk7CgogIHZhciBDbGFzc05hbWUgPSB7CiAgICBGQURFOiAnZmFkZScsCiAgICBTSE9XOiAnc2hvdycKICB9OwoKICB2YXIgU2VsZWN0b3IgPSB7CiAgICBUSVRMRTogJy5wb3BvdmVyLWhlYWRlcicsCiAgICBDT05URU5UOiAnLnBvcG92ZXItYm9keScKICB9OwoKICB2YXIgRXZlbnQgPSB7CiAgICBISURFOiAnaGlkZScgKyBFVkVOVF9LRVksCiAgICBISURERU46ICdoaWRkZW4nICsgRVZFTlRfS0VZLAogICAgU0hPVzogJ3Nob3cnICsgRVZFTlRfS0VZLAogICAgU0hPV046ICdzaG93bicgKyBFVkVOVF9LRVksCiAgICBJTlNFUlRFRDogJ2luc2VydGVkJyArIEVWRU5UX0tFWSwKICAgIENMSUNLOiAnY2xpY2snICsgRVZFTlRfS0VZLAogICAgRk9DVVNJTjogJ2ZvY3VzaW4nICsgRVZFTlRfS0VZLAogICAgRk9DVVNPVVQ6ICdmb2N1c291dCcgKyBFVkVOVF9LRVksCiAgICBNT1VTRUVOVEVSOiAnbW91c2VlbnRlcicgKyBFVkVOVF9LRVksCiAgICBNT1VTRUxFQVZFOiAnbW91c2VsZWF2ZScgKyBFVkVOVF9LRVkKCiAgICAvKioKICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICogQ2xhc3MgRGVmaW5pdGlvbgogICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgKi8KCiAgfTsKICB2YXIgUG9wb3ZlciA9IGZ1bmN0aW9uIChfVG9vbHRpcCkgewogICAgX2luaGVyaXRzKFBvcG92ZXIsIF9Ub29sdGlwKTsKCiAgICBmdW5jdGlvbiBQb3BvdmVyKCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9wb3Zlcik7CgogICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX1Rvb2x0aXAuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9CgogICAgLy8gb3ZlcnJpZGVzCgogICAgUG9wb3Zlci5wcm90b3R5cGUuaXNXaXRoQ29udGVudCA9IGZ1bmN0aW9uIGlzV2l0aENvbnRlbnQoKSB7CiAgICAgIHJldHVybiB0aGlzLmdldFRpdGxlKCkgfHwgdGhpcy5fZ2V0Q29udGVudCgpOwogICAgfTsKCiAgICBQb3BvdmVyLnByb3RvdHlwZS5hZGRBdHRhY2htZW50Q2xhc3MgPSBmdW5jdGlvbiBhZGRBdHRhY2htZW50Q2xhc3MoYXR0YWNobWVudCkgewogICAgICAkKHRoaXMuZ2V0VGlwRWxlbWVudCgpKS5hZGRDbGFzcyhDTEFTU19QUkVGSVggKyAnLScgKyBhdHRhY2htZW50KTsKICAgIH07CgogICAgUG9wb3Zlci5wcm90b3R5cGUuZ2V0VGlwRWxlbWVudCA9IGZ1bmN0aW9uIGdldFRpcEVsZW1lbnQoKSB7CiAgICAgIHJldHVybiB0aGlzLnRpcCA9IHRoaXMudGlwIHx8ICQodGhpcy5jb25maWcudGVtcGxhdGUpWzBdOwogICAgfTsKCiAgICBQb3BvdmVyLnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gc2V0Q29udGVudCgpIHsKICAgICAgdmFyICR0aXAgPSAkKHRoaXMuZ2V0VGlwRWxlbWVudCgpKTsKCiAgICAgIC8vIHdlIHVzZSBhcHBlbmQgZm9yIGh0bWwgb2JqZWN0cyB0byBtYWludGFpbiBqcyBldmVudHMKICAgICAgdGhpcy5zZXRFbGVtZW50Q29udGVudCgkdGlwLmZpbmQoU2VsZWN0b3IuVElUTEUpLCB0aGlzLmdldFRpdGxlKCkpOwogICAgICB0aGlzLnNldEVsZW1lbnRDb250ZW50KCR0aXAuZmluZChTZWxlY3Rvci5DT05URU5UKSwgdGhpcy5fZ2V0Q29udGVudCgpKTsKCiAgICAgICR0aXAucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkZBREUgKyAnICcgKyBDbGFzc05hbWUuU0hPVyk7CiAgICB9OwoKICAgIC8vIHByaXZhdGUKCiAgICBQb3BvdmVyLnByb3RvdHlwZS5fZ2V0Q29udGVudCA9IGZ1bmN0aW9uIF9nZXRDb250ZW50KCkgewogICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1jb250ZW50JykgfHwgKHR5cGVvZiB0aGlzLmNvbmZpZy5jb250ZW50ID09PSAnZnVuY3Rpb24nID8gdGhpcy5jb25maWcuY29udGVudC5jYWxsKHRoaXMuZWxlbWVudCkgOiB0aGlzLmNvbmZpZy5jb250ZW50KTsKICAgIH07CgogICAgUG9wb3Zlci5wcm90b3R5cGUuX2NsZWFuVGlwQ2xhc3MgPSBmdW5jdGlvbiBfY2xlYW5UaXBDbGFzcygpIHsKICAgICAgdmFyICR0aXAgPSAkKHRoaXMuZ2V0VGlwRWxlbWVudCgpKTsKICAgICAgdmFyIHRhYkNsYXNzID0gJHRpcC5hdHRyKCdjbGFzcycpLm1hdGNoKEJTQ0xTX1BSRUZJWF9SRUdFWCk7CiAgICAgIGlmICh0YWJDbGFzcyAhPT0gbnVsbCAmJiB0YWJDbGFzcy5sZW5ndGggPiAwKSB7CiAgICAgICAgJHRpcC5yZW1vdmVDbGFzcyh0YWJDbGFzcy5qb2luKCcnKSk7CiAgICAgIH0KICAgIH07CgogICAgLy8gc3RhdGljCgogICAgUG9wb3Zlci5falF1ZXJ5SW50ZXJmYWNlID0gZnVuY3Rpb24gX2pRdWVyeUludGVyZmFjZShjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSAkKHRoaXMpLmRhdGEoREFUQV9LRVkpOwogICAgICAgIHZhciBfY29uZmlnID0gKHR5cGVvZiBjb25maWcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGNvbmZpZykpID09PSAnb2JqZWN0JyA\/IGNvbmZpZyA6IG51bGw7CgogICAgICAgIGlmICghZGF0YSAmJiAvZGVzdHJveXxoaWRlLy50ZXN0KGNvbmZpZykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgZGF0YSA9IG5ldyBQb3BvdmVyKHRoaXMsIF9jb25maWcpOwogICAgICAgICAgJCh0aGlzKS5kYXRhKERBVEFfS0VZLCBkYXRhKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykgewogICAgICAgICAgaWYgKGRhdGFbY29uZmlnXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gbWV0aG9kIG5hbWVkICInICsgY29uZmlnICsgJyInKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGFbY29uZmlnXSgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIF9jcmVhdGVDbGFzcyhQb3BvdmVyLCBudWxsLCBbewogICAgICBrZXk6ICdWRVJTSU9OJywKCgogICAgICAvLyBnZXR0ZXJzCgogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdEZWZhdWx0JywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIERlZmF1bHQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnTkFNRScsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBOQU1FOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ0RBVEFfS0VZJywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIERBVEFfS0VZOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ0V2ZW50JywKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIEV2ZW50OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ0VWRU5UX0tFWScsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBFVkVOVF9LRVk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnRGVmYXVsdFR5cGUnLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gRGVmYXVsdFR5cGU7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gUG9wb3ZlcjsKICB9KFRvb2x0aXApOwoKICAvKioKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKiBqUXVlcnkKICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgKi8KCiAgJC5mbltOQU1FXSA9IFBvcG92ZXIuX2pRdWVyeUludGVyZmFjZTsKICAkLmZuW05BTUVdLkNvbnN0cnVjdG9yID0gUG9wb3ZlcjsKICAkLmZuW05BTUVdLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmZuW05BTUVdID0gSlFVRVJZX05PX0NPTkZMSUNUOwogICAgcmV0dXJuIFBvcG92ZXIuX2pRdWVyeUludGVyZmFjZTsKICB9OwoKICByZXR1cm4gUG9wb3ZlcjsKfShqUXVlcnkpOwoKCn0pKCk7",
    "size": "111390"
}