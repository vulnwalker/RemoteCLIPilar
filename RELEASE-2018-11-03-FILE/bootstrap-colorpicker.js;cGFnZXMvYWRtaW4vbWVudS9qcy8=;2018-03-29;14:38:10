{
    "namaFile": "pages\/admin\/menu\/js\/bootstrap-colorpicker.js",
    "lastUpdate": "2018-03-29+14:38:10.27",
    "contentFile": "LyohCiAqIEJvb3RzdHJhcCBDb2xvcnBpY2tlciB2Mi41LjIKICogaHR0cHM6Ly9pdHNqYXZpLmNvbS9ib290c3RyYXAtY29sb3JwaWNrZXIvCiAqCiAqIE9yaWdpbmFsbHkgd3JpdHRlbiBieSAoYykgMjAxMiBTdGVmYW4gUGV0cmUKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlIHYyLjAKICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wLnR4dAogKgogKi8KCihmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlIHVubGVzcyBhbWRNb2R1bGVJZCBpcyBzZXQKICAgIGRlZmluZShbImpxdWVyeSJdLCBmdW5jdGlvbihqcSkgewogICAgICByZXR1cm4gKGZhY3RvcnkoanEpKTsKICAgIH0pOwogIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7CiAgICAvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXQKICAgIC8vIG9ubHkgQ29tbW9uSlMtbGlrZSBlbnZpcm9ubWVudHMgdGhhdCBzdXBwb3J0IG1vZHVsZS5leHBvcnRzLAogICAgLy8gbGlrZSBOb2RlLgogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoImpxdWVyeSIpKTsKICB9IGVsc2UgaWYgKGpRdWVyeSAmJiAhalF1ZXJ5LmZuLmNvbG9ycGlja2VyKSB7CiAgICBmYWN0b3J5KGpRdWVyeSk7CiAgfQp9KHRoaXMsIGZ1bmN0aW9uKCQpIHsKICAndXNlIHN0cmljdCc7CiAgLyoqCiAgICogQ29sb3IgbWFuaXB1bGF0aW9uIGhlbHBlciBjbGFzcwogICAqCiAgICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBbdmFsXQogICAqIEBwYXJhbSB7T2JqZWN0fSBbcHJlZGVmaW5lZENvbG9yc10KICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBbZmFsbGJhY2tDb2xvcl0KICAgKiBAcGFyYW0ge1N0cmluZ3xudWxsfSBbZmFsbGJhY2tGb3JtYXRdCiAgICogQHBhcmFtIHtCb29sZWFufSBbaGV4TnVtYmVyU2lnblByZWZpeF0KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICB2YXIgQ29sb3IgPSBmdW5jdGlvbigKICAgIHZhbCwgcHJlZGVmaW5lZENvbG9ycywgZmFsbGJhY2tDb2xvciwgZmFsbGJhY2tGb3JtYXQsIGhleE51bWJlclNpZ25QcmVmaXgpIHsKICAgIHRoaXMuZmFsbGJhY2tWYWx1ZSA9IGZhbGxiYWNrQ29sb3IgPwogICAgICAoCiAgICAgICAgKHR5cGVvZiBmYWxsYmFja0NvbG9yID09PSAnc3RyaW5nJykgPwogICAgICAgIHRoaXMucGFyc2UoZmFsbGJhY2tDb2xvcikgOgogICAgICAgIGZhbGxiYWNrQ29sb3IKICAgICAgKSA6CiAgICAgIG51bGw7CgogICAgdGhpcy5mYWxsYmFja0Zvcm1hdCA9IGZhbGxiYWNrRm9ybWF0ID8gZmFsbGJhY2tGb3JtYXQgOiAncmdiYSc7CgogICAgdGhpcy5oZXhOdW1iZXJTaWduUHJlZml4ID0gaGV4TnVtYmVyU2lnblByZWZpeCA9PT0gdHJ1ZTsKCiAgICB0aGlzLnZhbHVlID0gdGhpcy5mYWxsYmFja1ZhbHVlOwoKICAgIHRoaXMub3JpZ0Zvcm1hdCA9IG51bGw7IC8vIG9yaWdpbmFsIHN0cmluZyBmb3JtYXQKCiAgICB0aGlzLnByZWRlZmluZWRDb2xvcnMgPSBwcmVkZWZpbmVkQ29sb3JzID8gcHJlZGVmaW5lZENvbG9ycyA6IHt9OwoKICAgIC8vIFdlIGRvbid0IHdhbnQgdG8gc2hhcmUgYWxpYXNlcyBhY3Jvc3MgaW5zdGFuY2VzIHNvIHdlIGV4dGVuZCBuZXcgb2JqZWN0CiAgICB0aGlzLmNvbG9ycyA9ICQuZXh0ZW5kKHt9LCBDb2xvci53ZWJDb2xvcnMsIHRoaXMucHJlZGVmaW5lZENvbG9ycyk7CgogICAgaWYgKHZhbCkgewogICAgICBpZiAodHlwZW9mIHZhbC5oICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIHRoaXMudmFsdWUgPSB2YWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRDb2xvcihTdHJpbmcodmFsKSk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIXRoaXMudmFsdWUpIHsKICAgICAgLy8gSW5pdGlhbCB2YWx1ZSBpcyBhbHdheXMgYmxhY2sgaWYgbm8gYXJndW1lbnRzIGFyZSBwYXNzZWQgb3IgdmFsIGlzIGVtcHR5CiAgICAgIHRoaXMudmFsdWUgPSB7CiAgICAgICAgaDogMCwKICAgICAgICBzOiAwLAogICAgICAgIGI6IDAsCiAgICAgICAgYTogMQogICAgICB9OwogICAgfQogIH07CgogIENvbG9yLndlYkNvbG9ycyA9IHsgLy8gMTQwIHByZWRlZmluZWQgY29sb3JzIGZyb20gdGhlIEhUTUwgQ29sb3JzIHNwZWMKICAgICJhbGljZWJsdWUiOiAiZjBmOGZmIiwKICAgICJhbnRpcXVld2hpdGUiOiAiZmFlYmQ3IiwKICAgICJhcXVhIjogIjAwZmZmZiIsCiAgICAiYXF1YW1hcmluZSI6ICI3ZmZmZDQiLAogICAgImF6dXJlIjogImYwZmZmZiIsCiAgICAiYmVpZ2UiOiAiZjVmNWRjIiwKICAgICJiaXNxdWUiOiAiZmZlNGM0IiwKICAgICJibGFjayI6ICIwMDAwMDAiLAogICAgImJsYW5jaGVkYWxtb25kIjogImZmZWJjZCIsCiAgICAiYmx1ZSI6ICIwMDAwZmYiLAogICAgImJsdWV2aW9sZXQiOiAiOGEyYmUyIiwKICAgICJicm93biI6ICJhNTJhMmEiLAogICAgImJ1cmx5d29vZCI6ICJkZWI4ODciLAogICAgImNhZGV0Ymx1ZSI6ICI1ZjllYTAiLAogICAgImNoYXJ0cmV1c2UiOiAiN2ZmZjAwIiwKICAgICJjaG9jb2xhdGUiOiAiZDI2OTFlIiwKICAgICJjb3JhbCI6ICJmZjdmNTAiLAogICAgImNvcm5mbG93ZXJibHVlIjogIjY0OTVlZCIsCiAgICAiY29ybnNpbGsiOiAiZmZmOGRjIiwKICAgICJjcmltc29uIjogImRjMTQzYyIsCiAgICAiY3lhbiI6ICIwMGZmZmYiLAogICAgImRhcmtibHVlIjogIjAwMDA4YiIsCiAgICAiZGFya2N5YW4iOiAiMDA4YjhiIiwKICAgICJkYXJrZ29sZGVucm9kIjogImI4ODYwYiIsCiAgICAiZGFya2dyYXkiOiAiYTlhOWE5IiwKICAgICJkYXJrZ3JlZW4iOiAiMDA2NDAwIiwKICAgICJkYXJra2hha2kiOiAiYmRiNzZiIiwKICAgICJkYXJrbWFnZW50YSI6ICI4YjAwOGIiLAogICAgImRhcmtvbGl2ZWdyZWVuIjogIjU1NmIyZiIsCiAgICAiZGFya29yYW5nZSI6ICJmZjhjMDAiLAogICAgImRhcmtvcmNoaWQiOiAiOTkzMmNjIiwKICAgICJkYXJrcmVkIjogIjhiMDAwMCIsCiAgICAiZGFya3NhbG1vbiI6ICJlOTk2N2EiLAogICAgImRhcmtzZWFncmVlbiI6ICI4ZmJjOGYiLAogICAgImRhcmtzbGF0ZWJsdWUiOiAiNDgzZDhiIiwKICAgICJkYXJrc2xhdGVncmF5IjogIjJmNGY0ZiIsCiAgICAiZGFya3R1cnF1b2lzZSI6ICIwMGNlZDEiLAogICAgImRhcmt2aW9sZXQiOiAiOTQwMGQzIiwKICAgICJkZWVwcGluayI6ICJmZjE0OTMiLAogICAgImRlZXBza3libHVlIjogIjAwYmZmZiIsCiAgICAiZGltZ3JheSI6ICI2OTY5NjkiLAogICAgImRvZGdlcmJsdWUiOiAiMWU5MGZmIiwKICAgICJmaXJlYnJpY2siOiAiYjIyMjIyIiwKICAgICJmbG9yYWx3aGl0ZSI6ICJmZmZhZjAiLAogICAgImZvcmVzdGdyZWVuIjogIjIyOGIyMiIsCiAgICAiZnVjaHNpYSI6ICJmZjAwZmYiLAogICAgImdhaW5zYm9ybyI6ICJkY2RjZGMiLAogICAgImdob3N0d2hpdGUiOiAiZjhmOGZmIiwKICAgICJnb2xkIjogImZmZDcwMCIsCiAgICAiZ29sZGVucm9kIjogImRhYTUyMCIsCiAgICAiZ3JheSI6ICI4MDgwODAiLAogICAgImdyZWVuIjogIjAwODAwMCIsCiAgICAiZ3JlZW55ZWxsb3ciOiAiYWRmZjJmIiwKICAgICJob25leWRldyI6ICJmMGZmZjAiLAogICAgImhvdHBpbmsiOiAiZmY2OWI0IiwKICAgICJpbmRpYW5yZWQiOiAiY2Q1YzVjIiwKICAgICJpbmRpZ28iOiAiNGIwMDgyIiwKICAgICJpdm9yeSI6ICJmZmZmZjAiLAogICAgImtoYWtpIjogImYwZTY4YyIsCiAgICAibGF2ZW5kZXIiOiAiZTZlNmZhIiwKICAgICJsYXZlbmRlcmJsdXNoIjogImZmZjBmNSIsCiAgICAibGF3bmdyZWVuIjogIjdjZmMwMCIsCiAgICAibGVtb25jaGlmZm9uIjogImZmZmFjZCIsCiAgICAibGlnaHRibHVlIjogImFkZDhlNiIsCiAgICAibGlnaHRjb3JhbCI6ICJmMDgwODAiLAogICAgImxpZ2h0Y3lhbiI6ICJlMGZmZmYiLAogICAgImxpZ2h0Z29sZGVucm9keWVsbG93IjogImZhZmFkMiIsCiAgICAibGlnaHRncmV5IjogImQzZDNkMyIsCiAgICAibGlnaHRncmVlbiI6ICI5MGVlOTAiLAogICAgImxpZ2h0cGluayI6ICJmZmI2YzEiLAogICAgImxpZ2h0c2FsbW9uIjogImZmYTA3YSIsCiAgICAibGlnaHRzZWFncmVlbiI6ICIyMGIyYWEiLAogICAgImxpZ2h0c2t5Ymx1ZSI6ICI4N2NlZmEiLAogICAgImxpZ2h0c2xhdGVncmF5IjogIjc3ODg5OSIsCiAgICAibGlnaHRzdGVlbGJsdWUiOiAiYjBjNGRlIiwKICAgICJsaWdodHllbGxvdyI6ICJmZmZmZTAiLAogICAgImxpbWUiOiAiMDBmZjAwIiwKICAgICJsaW1lZ3JlZW4iOiAiMzJjZDMyIiwKICAgICJsaW5lbiI6ICJmYWYwZTYiLAogICAgIm1hZ2VudGEiOiAiZmYwMGZmIiwKICAgICJtYXJvb24iOiAiODAwMDAwIiwKICAgICJtZWRpdW1hcXVhbWFyaW5lIjogIjY2Y2RhYSIsCiAgICAibWVkaXVtYmx1ZSI6ICIwMDAwY2QiLAogICAgIm1lZGl1bW9yY2hpZCI6ICJiYTU1ZDMiLAogICAgIm1lZGl1bXB1cnBsZSI6ICI5MzcwZDgiLAogICAgIm1lZGl1bXNlYWdyZWVuIjogIjNjYjM3MSIsCiAgICAibWVkaXVtc2xhdGVibHVlIjogIjdiNjhlZSIsCiAgICAibWVkaXVtc3ByaW5nZ3JlZW4iOiAiMDBmYTlhIiwKICAgICJtZWRpdW10dXJxdW9pc2UiOiAiNDhkMWNjIiwKICAgICJtZWRpdW12aW9sZXRyZWQiOiAiYzcxNTg1IiwKICAgICJtaWRuaWdodGJsdWUiOiAiMTkxOTcwIiwKICAgICJtaW50Y3JlYW0iOiAiZjVmZmZhIiwKICAgICJtaXN0eXJvc2UiOiAiZmZlNGUxIiwKICAgICJtb2NjYXNpbiI6ICJmZmU0YjUiLAogICAgIm5hdmFqb3doaXRlIjogImZmZGVhZCIsCiAgICAibmF2eSI6ICIwMDAwODAiLAogICAgIm9sZGxhY2UiOiAiZmRmNWU2IiwKICAgICJvbGl2ZSI6ICI4MDgwMDAiLAogICAgIm9saXZlZHJhYiI6ICI2YjhlMjMiLAogICAgIm9yYW5nZSI6ICJmZmE1MDAiLAogICAgIm9yYW5nZXJlZCI6ICJmZjQ1MDAiLAogICAgIm9yY2hpZCI6ICJkYTcwZDYiLAogICAgInBhbGVnb2xkZW5yb2QiOiAiZWVlOGFhIiwKICAgICJwYWxlZ3JlZW4iOiAiOThmYjk4IiwKICAgICJwYWxldHVycXVvaXNlIjogImFmZWVlZSIsCiAgICAicGFsZXZpb2xldHJlZCI6ICJkODcwOTMiLAogICAgInBhcGF5YXdoaXAiOiAiZmZlZmQ1IiwKICAgICJwZWFjaHB1ZmYiOiAiZmZkYWI5IiwKICAgICJwZXJ1IjogImNkODUzZiIsCiAgICAicGluayI6ICJmZmMwY2IiLAogICAgInBsdW0iOiAiZGRhMGRkIiwKICAgICJwb3dkZXJibHVlIjogImIwZTBlNiIsCiAgICAicHVycGxlIjogIjgwMDA4MCIsCiAgICAicmVkIjogImZmMDAwMCIsCiAgICAicm9zeWJyb3duIjogImJjOGY4ZiIsCiAgICAicm95YWxibHVlIjogIjQxNjllMSIsCiAgICAic2FkZGxlYnJvd24iOiAiOGI0NTEzIiwKICAgICJzYWxtb24iOiAiZmE4MDcyIiwKICAgICJzYW5keWJyb3duIjogImY0YTQ2MCIsCiAgICAic2VhZ3JlZW4iOiAiMmU4YjU3IiwKICAgICJzZWFzaGVsbCI6ICJmZmY1ZWUiLAogICAgInNpZW5uYSI6ICJhMDUyMmQiLAogICAgInNpbHZlciI6ICJjMGMwYzAiLAogICAgInNreWJsdWUiOiAiODdjZWViIiwKICAgICJzbGF0ZWJsdWUiOiAiNmE1YWNkIiwKICAgICJzbGF0ZWdyYXkiOiAiNzA4MDkwIiwKICAgICJzbm93IjogImZmZmFmYSIsCiAgICAic3ByaW5nZ3JlZW4iOiAiMDBmZjdmIiwKICAgICJzdGVlbGJsdWUiOiAiNDY4MmI0IiwKICAgICJ0YW4iOiAiZDJiNDhjIiwKICAgICJ0ZWFsIjogIjAwODA4MCIsCiAgICAidGhpc3RsZSI6ICJkOGJmZDgiLAogICAgInRvbWF0byI6ICJmZjYzNDciLAogICAgInR1cnF1b2lzZSI6ICI0MGUwZDAiLAogICAgInZpb2xldCI6ICJlZTgyZWUiLAogICAgIndoZWF0IjogImY1ZGViMyIsCiAgICAid2hpdGUiOiAiZmZmZmZmIiwKICAgICJ3aGl0ZXNtb2tlIjogImY1ZjVmNSIsCiAgICAieWVsbG93IjogImZmZmYwMCIsCiAgICAieWVsbG93Z3JlZW4iOiAiOWFjZDMyIiwKICAgICJ0cmFuc3BhcmVudCI6ICJ0cmFuc3BhcmVudCIKICB9OwoKICBDb2xvci5wcm90b3R5cGUgPSB7CiAgICBjb25zdHJ1Y3RvcjogQ29sb3IsCiAgICBjb2xvcnM6IHt9LCAvLyBtZXJnZWQgd2ViIGFuZCBwcmVkZWZpbmVkIGNvbG9ycwogICAgcHJlZGVmaW5lZENvbG9yczoge30sCiAgICAvKioKICAgICAqIEByZXR1cm4ge09iamVjdH0KICAgICAqLwogICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy52YWx1ZTsKICAgIH0sCiAgICAvKioKICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWwKICAgICAqLwogICAgc2V0VmFsdWU6IGZ1bmN0aW9uKHZhbCkgewogICAgICB0aGlzLnZhbHVlID0gdmFsOwogICAgfSwKICAgIF9zYW5pdGl6ZU51bWJlcjogZnVuY3Rpb24odmFsKSB7CiAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykgewogICAgICAgIHJldHVybiB2YWw7CiAgICAgIH0KICAgICAgaWYgKGlzTmFOKHZhbCkgfHwgKHZhbCA9PT0gbnVsbCkgfHwgKHZhbCA9PT0gJycpIHx8ICh2YWwgPT09IHVuZGVmaW5lZCkpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgICBpZiAodmFsID09PSAnJykgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgdmFsLnRvTG93ZXJDYXNlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGlmICh2YWwubWF0Y2goL15cLi8pKSB7CiAgICAgICAgICB2YWwgPSAiMCIgKyB2YWw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBNYXRoLmNlaWwocGFyc2VGbG9hdCh2YWwpICogMTAwKSAvIDEwMDsKICAgICAgfQogICAgICByZXR1cm4gMTsKICAgIH0sCiAgICBpc1RyYW5zcGFyZW50OiBmdW5jdGlvbihzdHJWYWwpIHsKICAgICAgaWYgKCFzdHJWYWwgfHwgISh0eXBlb2Ygc3RyVmFsID09PSAnc3RyaW5nJyB8fCBzdHJWYWwgaW5zdGFuY2VvZiBTdHJpbmcpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHN0clZhbCA9IHN0clZhbC50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAgICAgcmV0dXJuIChzdHJWYWwgPT09ICd0cmFuc3BhcmVudCcpIHx8IChzdHJWYWwubWF0Y2goLyM\/MDAwMDAwMDAvKSkgfHwgKHN0clZhbC5tYXRjaCgvKHJnYmF8aHNsYSlcKDAsMCwwLDA\/XC4\/MFwpLykpOwogICAgfSwKICAgIHJnYmFJc1RyYW5zcGFyZW50OiBmdW5jdGlvbihyZ2JhKSB7CiAgICAgIHJldHVybiAoKHJnYmEuciA9PT0gMCkgJiYgKHJnYmEuZyA9PT0gMCkgJiYgKHJnYmEuYiA9PT0gMCkgJiYgKHJnYmEuYSA9PT0gMCkpOwogICAgfSwKICAgIC8vIHBhcnNlIGEgc3RyaW5nIHRvIEhTQgogICAgLyoqCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyVmFsCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIGl0IGNvdWxkIGJlIHBhcnNlZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIHNldENvbG9yOiBmdW5jdGlvbihzdHJWYWwpIHsKICAgICAgc3RyVmFsID0gc3RyVmFsLnRvTG93ZXJDYXNlKCkudHJpbSgpOwogICAgICBpZiAoc3RyVmFsKSB7CiAgICAgICAgaWYgKHRoaXMuaXNUcmFuc3BhcmVudChzdHJWYWwpKSB7CiAgICAgICAgICB0aGlzLnZhbHVlID0gewogICAgICAgICAgICBoOiAwLAogICAgICAgICAgICBzOiAwLAogICAgICAgICAgICBiOiAwLAogICAgICAgICAgICBhOiAwCiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBwYXJzZWRDb2xvciA9IHRoaXMucGFyc2Uoc3RyVmFsKTsKICAgICAgICAgIGlmIChwYXJzZWRDb2xvcikgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZSA9IHsKICAgICAgICAgICAgICBoOiBwYXJzZWRDb2xvci5oLAogICAgICAgICAgICAgIHM6IHBhcnNlZENvbG9yLnMsCiAgICAgICAgICAgICAgYjogcGFyc2VkQ29sb3IuYiwKICAgICAgICAgICAgICBhOiBwYXJzZWRDb2xvci5hCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICghdGhpcy5vcmlnRm9ybWF0KSB7CiAgICAgICAgICAgICAgdGhpcy5vcmlnRm9ybWF0ID0gcGFyc2VkQ29sb3IuZm9ybWF0OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZmFsbGJhY2tWYWx1ZSkgewogICAgICAgICAgICAvLyBpZiBwYXJzZXIgZmFpbHMsIGRlZmF1bHRzIHRvIGZhbGxiYWNrVmFsdWUgaWYgZGVmaW5lZCwgb3RoZXJ3aXNlIHRoZSB2YWx1ZSB3b24ndCBiZSBjaGFuZ2VkCiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmZhbGxiYWNrVmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBzZXRIdWU6IGZ1bmN0aW9uKGgpIHsKICAgICAgdGhpcy52YWx1ZS5oID0gMSAtIGg7CiAgICB9LAogICAgc2V0U2F0dXJhdGlvbjogZnVuY3Rpb24ocykgewogICAgICB0aGlzLnZhbHVlLnMgPSBzOwogICAgfSwKICAgIHNldEJyaWdodG5lc3M6IGZ1bmN0aW9uKGIpIHsKICAgICAgdGhpcy52YWx1ZS5iID0gMSAtIGI7CiAgICB9LAogICAgc2V0QWxwaGE6IGZ1bmN0aW9uKGEpIHsKICAgICAgdGhpcy52YWx1ZS5hID0gTWF0aC5yb3VuZCgocGFyc2VJbnQoKDEgLSBhKSAqIDEwMCwgMTApIC8gMTAwKSAqIDEwMCkgLyAxMDA7CiAgICB9LAogICAgdG9SR0I6IGZ1bmN0aW9uKGgsIHMsIGIsIGEpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICBoID0gdGhpcy52YWx1ZS5oOwogICAgICAgIHMgPSB0aGlzLnZhbHVlLnM7CiAgICAgICAgYiA9IHRoaXMudmFsdWUuYjsKICAgICAgICBhID0gdGhpcy52YWx1ZS5hOwogICAgICB9CgogICAgICBoICo9IDM2MDsKICAgICAgdmFyIFIsIEcsIEIsIFgsIEM7CiAgICAgIGggPSAoaCAlIDM2MCkgLyA2MDsKICAgICAgQyA9IGIgKiBzOwogICAgICBYID0gQyAqICgxIC0gTWF0aC5hYnMoaCAlIDIgLSAxKSk7CiAgICAgIFIgPSBHID0gQiA9IGIgLSBDOwoKICAgICAgaCA9IH5+aDsKICAgICAgUiArPSBbQywgWCwgMCwgMCwgWCwgQ11baF07CiAgICAgIEcgKz0gW1gsIEMsIEMsIFgsIDAsIDBdW2hdOwogICAgICBCICs9IFswLCAwLCBYLCBDLCBDLCBYXVtoXTsKCiAgICAgIHJldHVybiB7CiAgICAgICAgcjogTWF0aC5yb3VuZChSICogMjU1KSwKICAgICAgICBnOiBNYXRoLnJvdW5kKEcgKiAyNTUpLAogICAgICAgIGI6IE1hdGgucm91bmQoQiAqIDI1NSksCiAgICAgICAgYTogYQogICAgICB9OwogICAgfSwKICAgIHRvSGV4OiBmdW5jdGlvbihpZ25vcmVGb3JtYXQsIGgsIHMsIGIsIGEpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPD0gMSkgewogICAgICAgIGggPSB0aGlzLnZhbHVlLmg7CiAgICAgICAgcyA9IHRoaXMudmFsdWUuczsKICAgICAgICBiID0gdGhpcy52YWx1ZS5iOwogICAgICAgIGEgPSB0aGlzLnZhbHVlLmE7CiAgICAgIH0KCiAgICAgIHZhciBwcmVmaXggPSAnIyc7CiAgICAgIHZhciByZ2IgPSB0aGlzLnRvUkdCKGgsIHMsIGIsIGEpOwoKICAgICAgaWYgKHRoaXMucmdiYUlzVHJhbnNwYXJlbnQocmdiKSkgewogICAgICAgIHJldHVybiAndHJhbnNwYXJlbnQnOwogICAgICB9CgogICAgICBpZiAoIWlnbm9yZUZvcm1hdCkgewogICAgICAgIHByZWZpeCA9ICh0aGlzLmhleE51bWJlclNpZ25QcmVmaXggPyAnIycgOiAnJyk7CiAgICAgIH0KCiAgICAgIHZhciBoZXhTdHIgPSBwcmVmaXggKyAoCiAgICAgICAgICAoMSA8PCAyNCkgKwogICAgICAgICAgKHBhcnNlSW50KHJnYi5yKSA8PCAxNikgKwogICAgICAgICAgKHBhcnNlSW50KHJnYi5nKSA8PCA4KSArCiAgICAgICAgICBwYXJzZUludChyZ2IuYikpCiAgICAgICAgLnRvU3RyaW5nKDE2KQogICAgICAgIC5zbGljZSgxKTsKCiAgICAgIHJldHVybiBoZXhTdHI7CiAgICB9LAogICAgdG9IU0w6IGZ1bmN0aW9uKGgsIHMsIGIsIGEpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICBoID0gdGhpcy52YWx1ZS5oOwogICAgICAgIHMgPSB0aGlzLnZhbHVlLnM7CiAgICAgICAgYiA9IHRoaXMudmFsdWUuYjsKICAgICAgICBhID0gdGhpcy52YWx1ZS5hOwogICAgICB9CgogICAgICB2YXIgSCA9IGgsCiAgICAgICAgTCA9ICgyIC0gcykgKiBiLAogICAgICAgIFMgPSBzICogYjsKICAgICAgaWYgKEwgPiAwICYmIEwgPD0gMSkgewogICAgICAgIFMgLz0gTDsKICAgICAgfSBlbHNlIHsKICAgICAgICBTIC89IDIgLSBMOwogICAgICB9CiAgICAgIEwgLz0gMjsKICAgICAgaWYgKFMgPiAxKSB7CiAgICAgICAgUyA9IDE7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBoOiBpc05hTihIKSA\/IDAgOiBILAogICAgICAgIHM6IGlzTmFOKFMpID8gMCA6IFMsCiAgICAgICAgbDogaXNOYU4oTCkgPyAwIDogTCwKICAgICAgICBhOiBpc05hTihhKSA\/IDAgOiBhCiAgICAgIH07CiAgICB9LAogICAgdG9BbGlhczogZnVuY3Rpb24ociwgZywgYiwgYSkgewogICAgICB2YXIgYywgcmdiID0gKGFyZ3VtZW50cy5sZW5ndGggPT09IDApID8gdGhpcy50b0hleCh0cnVlKSA6IHRoaXMudG9IZXgodHJ1ZSwgciwgZywgYiwgYSk7CgogICAgICAvLyBzdXBwb3J0IHByZWRlZi4gY29sb3JzIGluIG5vbi1oZXggZm9ybWF0IHRvbywgYXMgZGVmaW5lZCBpbiB0aGUgYWxpYXMgaXRzZWxmCiAgICAgIHZhciBvcmlnaW5hbCA9IHRoaXMub3JpZ0Zvcm1hdCA9PT0gJ2FsaWFzJyA\/IHJnYiA6IHRoaXMudG9TdHJpbmcoZmFsc2UsIHRoaXMub3JpZ0Zvcm1hdCk7CgogICAgICBmb3IgKHZhciBhbGlhcyBpbiB0aGlzLmNvbG9ycykgewogICAgICAgIGMgPSB0aGlzLmNvbG9yc1thbGlhc10udG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgICAgaWYgKChjID09PSByZ2IpIHx8IChjID09PSBvcmlnaW5hbCkpIHsKICAgICAgICAgIHJldHVybiBhbGlhczsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIFJHQnRvSFNCOiBmdW5jdGlvbihyLCBnLCBiLCBhKSB7CiAgICAgIHIgLz0gMjU1OwogICAgICBnIC89IDI1NTsKICAgICAgYiAvPSAyNTU7CgogICAgICB2YXIgSCwgUywgViwgQzsKICAgICAgViA9IE1hdGgubWF4KHIsIGcsIGIpOwogICAgICBDID0gViAtIE1hdGgubWluKHIsIGcsIGIpOwogICAgICBIID0gKEMgPT09IDAgPyBudWxsIDoKICAgICAgICBWID09PSByID8gKGcgLSBiKSAvIEMgOgogICAgICAgIFYgPT09IGcgPyAoYiAtIHIpIC8gQyArIDIgOgogICAgICAgIChyIC0gZykgLyBDICsgNAogICAgICApOwogICAgICBIID0gKChIICsgMzYwKSAlIDYpICogNjAgLyAzNjA7CiAgICAgIFMgPSBDID09PSAwID8gMCA6IEMgLyBWOwogICAgICByZXR1cm4gewogICAgICAgIGg6IHRoaXMuX3Nhbml0aXplTnVtYmVyKEgpLAogICAgICAgIHM6IFMsCiAgICAgICAgYjogViwKICAgICAgICBhOiB0aGlzLl9zYW5pdGl6ZU51bWJlcihhKQogICAgICB9OwogICAgfSwKICAgIEh1ZVRvUkdCOiBmdW5jdGlvbihwLCBxLCBoKSB7CiAgICAgIGlmIChoIDwgMCkgewogICAgICAgIGggKz0gMTsKICAgICAgfSBlbHNlIGlmIChoID4gMSkgewogICAgICAgIGggLT0gMTsKICAgICAgfQogICAgICBpZiAoKGggKiA2KSA8IDEpIHsKICAgICAgICByZXR1cm4gcCArIChxIC0gcCkgKiBoICogNjsKICAgICAgfSBlbHNlIGlmICgoaCAqIDIpIDwgMSkgewogICAgICAgIHJldHVybiBxOwogICAgICB9IGVsc2UgaWYgKChoICogMykgPCAyKSB7CiAgICAgICAgcmV0dXJuIHAgKyAocSAtIHApICogKCgyIC8gMykgLSBoKSAqIDY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHA7CiAgICAgIH0KICAgIH0sCiAgICBIU0x0b1JHQjogZnVuY3Rpb24oaCwgcywgbCwgYSkgewogICAgICBpZiAocyA8IDApIHsKICAgICAgICBzID0gMDsKICAgICAgfQogICAgICB2YXIgcTsKICAgICAgaWYgKGwgPD0gMC41KSB7CiAgICAgICAgcSA9IGwgKiAoMSArIHMpOwogICAgICB9IGVsc2UgewogICAgICAgIHEgPSBsICsgcyAtIChsICogcyk7CiAgICAgIH0KCiAgICAgIHZhciBwID0gMiAqIGwgLSBxOwoKICAgICAgdmFyIHRyID0gaCArICgxIC8gMyk7CiAgICAgIHZhciB0ZyA9IGg7CiAgICAgIHZhciB0YiA9IGggLSAoMSAvIDMpOwoKICAgICAgdmFyIHIgPSBNYXRoLnJvdW5kKHRoaXMuSHVlVG9SR0IocCwgcSwgdHIpICogMjU1KTsKICAgICAgdmFyIGcgPSBNYXRoLnJvdW5kKHRoaXMuSHVlVG9SR0IocCwgcSwgdGcpICogMjU1KTsKICAgICAgdmFyIGIgPSBNYXRoLnJvdW5kKHRoaXMuSHVlVG9SR0IocCwgcSwgdGIpICogMjU1KTsKICAgICAgcmV0dXJuIFtyLCBnLCBiLCB0aGlzLl9zYW5pdGl6ZU51bWJlcihhKV07CiAgICB9LAogICAgLyoqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyVmFsCiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBPYmplY3QgY29udGFpbmluZyBoLHMsYixhLGZvcm1hdCBwcm9wZXJ0aWVzIG9yIEZBTFNFIGlmIGZhaWxlZCB0byBwYXJzZQogICAgICovCiAgICBwYXJzZTogZnVuY3Rpb24oc3RyVmFsKSB7CiAgICAgIGlmICh0eXBlb2Ygc3RyVmFsICE9PSAnc3RyaW5nJykgewogICAgICAgIHJldHVybiB0aGlzLmZhbGxiYWNrVmFsdWU7CiAgICAgIH0KICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciB0aGF0ID0gdGhpcywKICAgICAgICByZXN1bHQgPSBmYWxzZSwKICAgICAgICBpc0FsaWFzID0gKHR5cGVvZiB0aGlzLmNvbG9yc1tzdHJWYWxdICE9PSAndW5kZWZpbmVkJyksCiAgICAgICAgdmFsdWVzLCBmb3JtYXQ7CgogICAgICBpZiAoaXNBbGlhcykgewogICAgICAgIHN0clZhbCA9IHRoaXMuY29sb3JzW3N0clZhbF0udG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgIH0KCiAgICAgICQuZWFjaCh0aGlzLnN0cmluZ1BhcnNlcnMsIGZ1bmN0aW9uKGksIHBhcnNlcikgewogICAgICAgIHZhciBtYXRjaCA9IHBhcnNlci5yZS5leGVjKHN0clZhbCk7CiAgICAgICAgdmFsdWVzID0gbWF0Y2ggJiYgcGFyc2VyLnBhcnNlLmFwcGx5KHRoYXQsIFttYXRjaF0pOwogICAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICAgIHJlc3VsdCA9IHt9OwogICAgICAgICAgZm9ybWF0ID0gKGlzQWxpYXMgPyAnYWxpYXMnIDogKHBhcnNlci5mb3JtYXQgPyBwYXJzZXIuZm9ybWF0IDogdGhhdC5nZXRWYWxpZEZhbGxiYWNrRm9ybWF0KCkpKTsKICAgICAgICAgIGlmIChmb3JtYXQubWF0Y2goL2hzbGE\/LykpIHsKICAgICAgICAgICAgcmVzdWx0ID0gdGhhdC5SR0J0b0hTQi5hcHBseSh0aGF0LCB0aGF0LkhTTHRvUkdCLmFwcGx5KHRoYXQsIHZhbHVlcykpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gdGhhdC5SR0J0b0hTQi5hcHBseSh0aGF0LCB2YWx1ZXMpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIE9iamVjdCkgewogICAgICAgICAgICByZXN1bHQuZm9ybWF0ID0gZm9ybWF0OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBzdG9wIGl0ZXJhdGluZwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAogICAgZ2V0VmFsaWRGYWxsYmFja0Zvcm1hdDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmb3JtYXRzID0gWwogICAgICAgICdyZ2JhJywgJ3JnYicsICdoZXgnLCAnaHNsYScsICdoc2wnCiAgICAgIF07CiAgICAgIGlmICh0aGlzLm9yaWdGb3JtYXQgJiYgKGZvcm1hdHMuaW5kZXhPZih0aGlzLm9yaWdGb3JtYXQpICE9PSAtMSkpIHsKICAgICAgICByZXR1cm4gdGhpcy5vcmlnRm9ybWF0OwogICAgICB9CiAgICAgIGlmICh0aGlzLmZhbGxiYWNrRm9ybWF0ICYmIChmb3JtYXRzLmluZGV4T2YodGhpcy5mYWxsYmFja0Zvcm1hdCkgIT09IC0xKSkgewogICAgICAgIHJldHVybiB0aGlzLmZhbGxiYWNrRm9ybWF0OwogICAgICB9CgogICAgICByZXR1cm4gJ3JnYmEnOyAvLyBCeSBkZWZhdWx0LCByZXR1cm4gYSBmb3JtYXQgdGhhdCB3aWxsIG5vdCBsb3NlIHRoZSBhbHBoYSBpbmZvCiAgICB9LAogICAgLyoqCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IFtmb3JtYXRdIChkZWZhdWx0OiByZ2JhKQogICAgICogQHBhcmFtIHtib29sZWFufSBbdHJhbnNsYXRlQWxpYXNdIFJldHVybiByZWFsIGNvbG9yIGZvciBwcmUtZGVmaW5lZCAobm9uLXN0YW5kYXJkKSBhbGlhc2VzIChkZWZhdWx0OiBmYWxzZSkKICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ZvcmNlUmF3VmFsdWVdIEZvcmNlcyBoYXNodGFnIHByZWZpeCB3aGVuIGdldHRpbmcgaGV4IGNvbG9yIChkZWZhdWx0OiBmYWxzZSkKICAgICAqIEByZXR1cm5zIHtTdHJpbmd9CiAgICAgKi8KICAgIHRvU3RyaW5nOiBmdW5jdGlvbihmb3JjZVJhd1ZhbHVlLCBmb3JtYXQsIHRyYW5zbGF0ZUFsaWFzKSB7CiAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCB0aGlzLm9yaWdGb3JtYXQgfHwgdGhpcy5mYWxsYmFja0Zvcm1hdDsKICAgICAgdHJhbnNsYXRlQWxpYXMgPSB0cmFuc2xhdGVBbGlhcyB8fCBmYWxzZTsKCiAgICAgIHZhciBjID0gZmFsc2U7CgogICAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICAgIGNhc2UgJ3JnYic6CiAgICAgICAgICB7CiAgICAgICAgICAgIGMgPSB0aGlzLnRvUkdCKCk7CiAgICAgICAgICAgIGlmICh0aGlzLnJnYmFJc1RyYW5zcGFyZW50KGMpKSB7CiAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc3BhcmVudCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICdyZ2IoJyArIGMuciArICcsJyArIGMuZyArICcsJyArIGMuYiArICcpJzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3JnYmEnOgogICAgICAgICAgewogICAgICAgICAgICBjID0gdGhpcy50b1JHQigpOwogICAgICAgICAgICByZXR1cm4gJ3JnYmEoJyArIGMuciArICcsJyArIGMuZyArICcsJyArIGMuYiArICcsJyArIGMuYSArICcpJzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2hzbCc6CiAgICAgICAgICB7CiAgICAgICAgICAgIGMgPSB0aGlzLnRvSFNMKCk7CiAgICAgICAgICAgIHJldHVybiAnaHNsKCcgKyBNYXRoLnJvdW5kKGMuaCAqIDM2MCkgKyAnLCcgKyBNYXRoLnJvdW5kKGMucyAqIDEwMCkgKyAnJSwnICsgTWF0aC5yb3VuZChjLmwgKiAxMDApICsgJyUpJzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2hzbGEnOgogICAgICAgICAgewogICAgICAgICAgICBjID0gdGhpcy50b0hTTCgpOwogICAgICAgICAgICByZXR1cm4gJ2hzbGEoJyArIE1hdGgucm91bmQoYy5oICogMzYwKSArICcsJyArIE1hdGgucm91bmQoYy5zICogMTAwKSArICclLCcgKyBNYXRoLnJvdW5kKGMubCAqIDEwMCkgKyAnJSwnICsgYy5hICsgJyknOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnaGV4JzoKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudG9IZXgoZm9yY2VSYXdWYWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdhbGlhcyc6CiAgICAgICAgICB7CiAgICAgICAgICAgIGMgPSB0aGlzLnRvQWxpYXMoKTsKCiAgICAgICAgICAgIGlmIChjID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvU3RyaW5nKGZvcmNlUmF3VmFsdWUsIHRoaXMuZ2V0VmFsaWRGYWxsYmFja0Zvcm1hdCgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRyYW5zbGF0ZUFsaWFzICYmICEoYyBpbiBDb2xvci53ZWJDb2xvcnMpICYmIChjIGluIHRoaXMucHJlZGVmaW5lZENvbG9ycykpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wcmVkZWZpbmVkQ29sb3JzW2NdOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICAgIH0KICAgICAgICBkZWZhdWx0OgogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gYzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgLy8gYSBzZXQgb2YgUkUncyB0aGF0IGNhbiBtYXRjaCBzdHJpbmdzIGFuZCBnZW5lcmF0ZSBjb2xvciB0dXBsZXMuCiAgICAvLyBmcm9tIEpvaG4gUmVzaWcgY29sb3IgcGx1Z2luCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS1jb2xvci8KICAgIHN0cmluZ1BhcnNlcnM6IFt7CiAgICAgIHJlOiAvcmdiXChccyooXGR7MSwzfSlccyosXHMqKFxkezEsM30pXHMqLFxzKihcZHsxLDN9KVxzKj9cKS8sCiAgICAgIGZvcm1hdDogJ3JnYicsCiAgICAgIHBhcnNlOiBmdW5jdGlvbihleGVjUmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgIGV4ZWNSZXN1bHRbMV0sCiAgICAgICAgICBleGVjUmVzdWx0WzJdLAogICAgICAgICAgZXhlY1Jlc3VsdFszXSwKICAgICAgICAgIDEKICAgICAgICBdOwogICAgICB9CiAgICB9LCB7CiAgICAgIHJlOiAvcmdiXChccyooXGQqKD86XC5cZCspPylcJVxzKixccyooXGQqKD86XC5cZCspPylcJVxzKixccyooXGQqKD86XC5cZCspPylcJVxzKj9cKS8sCiAgICAgIGZvcm1hdDogJ3JnYicsCiAgICAgIHBhcnNlOiBmdW5jdGlvbihleGVjUmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgIDIuNTUgKiBleGVjUmVzdWx0WzFdLAogICAgICAgICAgMi41NSAqIGV4ZWNSZXN1bHRbMl0sCiAgICAgICAgICAyLjU1ICogZXhlY1Jlc3VsdFszXSwKICAgICAgICAgIDEKICAgICAgICBdOwogICAgICB9CiAgICB9LCB7CiAgICAgIHJlOiAvcmdiYVwoXHMqKFxkezEsM30pXHMqLFxzKihcZHsxLDN9KVxzKixccyooXGR7MSwzfSlccyooPzosXHMqKFxkKig\/OlwuXGQrKT8pXHMqKT9cKS8sCiAgICAgIGZvcm1hdDogJ3JnYmEnLAogICAgICBwYXJzZTogZnVuY3Rpb24oZXhlY1Jlc3VsdCkgewogICAgICAgIHJldHVybiBbCiAgICAgICAgICBleGVjUmVzdWx0WzFdLAogICAgICAgICAgZXhlY1Jlc3VsdFsyXSwKICAgICAgICAgIGV4ZWNSZXN1bHRbM10sCiAgICAgICAgICBleGVjUmVzdWx0WzRdCiAgICAgICAgXTsKICAgICAgfQogICAgfSwgewogICAgICByZTogL3JnYmFcKFxzKihcZCooPzpcLlxkKyk\/KVwlXHMqLFxzKihcZCooPzpcLlxkKyk\/KVwlXHMqLFxzKihcZCooPzpcLlxkKyk\/KVwlXHMqKD86LFxzKihcZCooPzpcLlxkKyk\/KVxzKik\/XCkvLAogICAgICBmb3JtYXQ6ICdyZ2JhJywKICAgICAgcGFyc2U6IGZ1bmN0aW9uKGV4ZWNSZXN1bHQpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgMi41NSAqIGV4ZWNSZXN1bHRbMV0sCiAgICAgICAgICAyLjU1ICogZXhlY1Jlc3VsdFsyXSwKICAgICAgICAgIDIuNTUgKiBleGVjUmVzdWx0WzNdLAogICAgICAgICAgZXhlY1Jlc3VsdFs0XQogICAgICAgIF07CiAgICAgIH0KICAgIH0sIHsKICAgICAgcmU6IC9oc2xcKFxzKihcZCooPzpcLlxkKyk\/KVxzKixccyooXGQqKD86XC5cZCspPylcJVxzKixccyooXGQqKD86XC5cZCspPylcJVxzKj9cKS8sCiAgICAgIGZvcm1hdDogJ2hzbCcsCiAgICAgIHBhcnNlOiBmdW5jdGlvbihleGVjUmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgIGV4ZWNSZXN1bHRbMV0gLyAzNjAsCiAgICAgICAgICBleGVjUmVzdWx0WzJdIC8gMTAwLAogICAgICAgICAgZXhlY1Jlc3VsdFszXSAvIDEwMCwKICAgICAgICAgIGV4ZWNSZXN1bHRbNF0KICAgICAgICBdOwogICAgICB9CiAgICB9LCB7CiAgICAgIHJlOiAvaHNsYVwoXHMqKFxkKig\/OlwuXGQrKT8pXHMqLFxzKihcZCooPzpcLlxkKyk\/KVwlXHMqLFxzKihcZCooPzpcLlxkKyk\/KVwlXHMqKD86LFxzKihcZCooPzpcLlxkKyk\/KVxzKik\/XCkvLAogICAgICBmb3JtYXQ6ICdoc2xhJywKICAgICAgcGFyc2U6IGZ1bmN0aW9uKGV4ZWNSZXN1bHQpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgZXhlY1Jlc3VsdFsxXSAvIDM2MCwKICAgICAgICAgIGV4ZWNSZXN1bHRbMl0gLyAxMDAsCiAgICAgICAgICBleGVjUmVzdWx0WzNdIC8gMTAwLAogICAgICAgICAgZXhlY1Jlc3VsdFs0XQogICAgICAgIF07CiAgICAgIH0KICAgIH0sIHsKICAgICAgcmU6IC8jPyhbYS1mQS1GMC05XXsyfSkoW2EtZkEtRjAtOV17Mn0pKFthLWZBLUYwLTldezJ9KS8sCiAgICAgIGZvcm1hdDogJ2hleCcsCiAgICAgIHBhcnNlOiBmdW5jdGlvbihleGVjUmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgIHBhcnNlSW50KGV4ZWNSZXN1bHRbMV0sIDE2KSwKICAgICAgICAgIHBhcnNlSW50KGV4ZWNSZXN1bHRbMl0sIDE2KSwKICAgICAgICAgIHBhcnNlSW50KGV4ZWNSZXN1bHRbM10sIDE2KSwKICAgICAgICAgIDEKICAgICAgICBdOwogICAgICB9CiAgICB9LCB7CiAgICAgIHJlOiAvIz8oW2EtZkEtRjAtOV0pKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkvLAogICAgICBmb3JtYXQ6ICdoZXgnLAogICAgICBwYXJzZTogZnVuY3Rpb24oZXhlY1Jlc3VsdCkgewogICAgICAgIHJldHVybiBbCiAgICAgICAgICBwYXJzZUludChleGVjUmVzdWx0WzFdICsgZXhlY1Jlc3VsdFsxXSwgMTYpLAogICAgICAgICAgcGFyc2VJbnQoZXhlY1Jlc3VsdFsyXSArIGV4ZWNSZXN1bHRbMl0sIDE2KSwKICAgICAgICAgIHBhcnNlSW50KGV4ZWNSZXN1bHRbM10gKyBleGVjUmVzdWx0WzNdLCAxNiksCiAgICAgICAgICAxCiAgICAgICAgXTsKICAgICAgfQogICAgfV0sCiAgICBjb2xvck5hbWVUb0hleDogZnVuY3Rpb24obmFtZSkgewogICAgICBpZiAodHlwZW9mIHRoaXMuY29sb3JzW25hbWUudG9Mb3dlckNhc2UoKV0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3JzW25hbWUudG9Mb3dlckNhc2UoKV07CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH07CgogIC8qCiAgICogRGVmYXVsdCBwbHVnaW4gb3B0aW9ucwogICAqLwogIHZhciBkZWZhdWx0cyA9IHsKICAgIGhvcml6b250YWw6IGZhbHNlLCAvLyBob3Jpem9udGFsIG1vZGUgbGF5b3V0ID8KICAgIGlubGluZTogZmFsc2UsIC8vZm9yY2VzIHRvIHNob3cgdGhlIGNvbG9ycGlja2VyIGFzIGFuIGlubGluZSBlbGVtZW50CiAgICBjb2xvcjogZmFsc2UsIC8vZm9yY2VzIGEgY29sb3IKICAgIGZvcm1hdDogZmFsc2UsIC8vZm9yY2VzIGEgZm9ybWF0CiAgICBpbnB1dDogJ2lucHV0JywgLy8gY2hpbGRyZW4gaW5wdXQgc2VsZWN0b3IKICAgIGNvbnRhaW5lcjogZmFsc2UsIC8vIGNvbnRhaW5lciBzZWxlY3RvcgogICAgY29tcG9uZW50OiAnLmFkZC1vbiwgLmlucHV0LWdyb3VwLWFkZG9uJywgLy8gY2hpbGRyZW4gY29tcG9uZW50IHNlbGVjdG9yCiAgICBmYWxsYmFja0NvbG9yOiBmYWxzZSwgLy8gZmFsbGJhY2sgY29sb3IgdmFsdWUuIG51bGwgPSBrZWVwcyBjdXJyZW50IGNvbG9yLgogICAgZmFsbGJhY2tGb3JtYXQ6ICdoZXgnLCAvLyBmYWxsYmFjayBjb2xvciBmb3JtYXQKICAgIGhleE51bWJlclNpZ25QcmVmaXg6IHRydWUsIC8vIHB1dCBhICcjJyAobnVtYmVyIHNpZ24pIGJlZm9yZSBoZXggc3RyaW5ncwogICAgc2xpZGVyczogewogICAgICBzYXR1cmF0aW9uOiB7CiAgICAgICAgbWF4TGVmdDogMTAwLAogICAgICAgIG1heFRvcDogMTAwLAogICAgICAgIGNhbGxMZWZ0OiAnc2V0U2F0dXJhdGlvbicsCiAgICAgICAgY2FsbFRvcDogJ3NldEJyaWdodG5lc3MnCiAgICAgIH0sCiAgICAgIGh1ZTogewogICAgICAgIG1heExlZnQ6IDAsCiAgICAgICAgbWF4VG9wOiAxMDAsCiAgICAgICAgY2FsbExlZnQ6IGZhbHNlLAogICAgICAgIGNhbGxUb3A6ICdzZXRIdWUnCiAgICAgIH0sCiAgICAgIGFscGhhOiB7CiAgICAgICAgbWF4TGVmdDogMCwKICAgICAgICBtYXhUb3A6IDEwMCwKICAgICAgICBjYWxsTGVmdDogZmFsc2UsCiAgICAgICAgY2FsbFRvcDogJ3NldEFscGhhJwogICAgICB9CiAgICB9LAogICAgc2xpZGVyc0hvcno6IHsKICAgICAgc2F0dXJhdGlvbjogewogICAgICAgIG1heExlZnQ6IDEwMCwKICAgICAgICBtYXhUb3A6IDEwMCwKICAgICAgICBjYWxsTGVmdDogJ3NldFNhdHVyYXRpb24nLAogICAgICAgIGNhbGxUb3A6ICdzZXRCcmlnaHRuZXNzJwogICAgICB9LAogICAgICBodWU6IHsKICAgICAgICBtYXhMZWZ0OiAxMDAsCiAgICAgICAgbWF4VG9wOiAwLAogICAgICAgIGNhbGxMZWZ0OiAnc2V0SHVlJywKICAgICAgICBjYWxsVG9wOiBmYWxzZQogICAgICB9LAogICAgICBhbHBoYTogewogICAgICAgIG1heExlZnQ6IDEwMCwKICAgICAgICBtYXhUb3A6IDAsCiAgICAgICAgY2FsbExlZnQ6ICdzZXRBbHBoYScsCiAgICAgICAgY2FsbFRvcDogZmFsc2UKICAgICAgfQogICAgfSwKICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0iY29sb3JwaWNrZXIgZHJvcGRvd24tbWVudSI+JyArCiAgICAgICc8ZGl2IGNsYXNzPSJjb2xvcnBpY2tlci1zYXR1cmF0aW9uIj48aT48Yj48L2I+PC9pPjwvZGl2PicgKwogICAgICAnPGRpdiBjbGFzcz0iY29sb3JwaWNrZXItaHVlIj48aT48L2k+PC9kaXY+JyArCiAgICAgICc8ZGl2IGNsYXNzPSJjb2xvcnBpY2tlci1hbHBoYSI+PGk+PC9pPjwvZGl2PicgKwogICAgICAnPGRpdiBjbGFzcz0iY29sb3JwaWNrZXItY29sb3IiPjxkaXYgLz48L2Rpdj4nICsKICAgICAgJzxkaXYgY2xhc3M9ImNvbG9ycGlja2VyLXNlbGVjdG9ycyI+PC9kaXY+JyArCiAgICAgICc8L2Rpdj4nLAogICAgYWxpZ246ICdyaWdodCcsCiAgICBjdXN0b21DbGFzczogbnVsbCwgLy8gY3VzdG9tIGNsYXNzIGFkZGVkIHRvIHRoZSBjb2xvcnBpY2tlciBlbGVtZW50CiAgICBjb2xvclNlbGVjdG9yczogbnVsbCAvLyBjdXN0b20gY29sb3IgYWxpYXNlcwogIH07CgogIC8qKgogICAqIENvbG9ycGlja2VyIGNvbXBvbmVudCBjbGFzcwogICAqCiAgICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBlbGVtZW50CiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAY29uc3RydWN0b3IKICAgKi8KICB2YXIgQ29sb3JwaWNrZXIgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7CiAgICB0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpLmFkZENsYXNzKCdjb2xvcnBpY2tlci1lbGVtZW50Jyk7CiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIHRoaXMuZWxlbWVudC5kYXRhKCksIG9wdGlvbnMpOwogICAgdGhpcy5jb21wb25lbnQgPSB0aGlzLm9wdGlvbnMuY29tcG9uZW50OwogICAgdGhpcy5jb21wb25lbnQgPSAodGhpcy5jb21wb25lbnQgIT09IGZhbHNlKSA\/IHRoaXMuZWxlbWVudC5maW5kKHRoaXMuY29tcG9uZW50KSA6IGZhbHNlOwogICAgaWYgKHRoaXMuY29tcG9uZW50ICYmICh0aGlzLmNvbXBvbmVudC5sZW5ndGggPT09IDApKSB7CiAgICAgIHRoaXMuY29tcG9uZW50ID0gZmFsc2U7CiAgICB9CiAgICB0aGlzLmNvbnRhaW5lciA9ICh0aGlzLm9wdGlvbnMuY29udGFpbmVyID09PSB0cnVlKSA\/IHRoaXMuZWxlbWVudCA6IHRoaXMub3B0aW9ucy5jb250YWluZXI7CiAgICB0aGlzLmNvbnRhaW5lciA9ICh0aGlzLmNvbnRhaW5lciAhPT0gZmFsc2UpID8gJCh0aGlzLmNvbnRhaW5lcikgOiBmYWxzZTsKCiAgICAvLyBJcyB0aGUgZWxlbWVudCBhbiBpbnB1dD8gU2hvdWxkIHdlIHNlYXJjaCBpbnNpZGUgZm9yIGFueSBpbnB1dD8KICAgIHRoaXMuaW5wdXQgPSB0aGlzLmVsZW1lbnQuaXMoJ2lucHV0JykgPyB0aGlzLmVsZW1lbnQgOiAodGhpcy5vcHRpb25zLmlucHV0ID8KICAgICAgdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLmlucHV0KSA6IGZhbHNlKTsKICAgIGlmICh0aGlzLmlucHV0ICYmICh0aGlzLmlucHV0Lmxlbmd0aCA9PT0gMCkpIHsKICAgICAgdGhpcy5pbnB1dCA9IGZhbHNlOwogICAgfQogICAgLy8gU2V0IEhTQiBjb2xvcgogICAgdGhpcy5jb2xvciA9IHRoaXMuY3JlYXRlQ29sb3IodGhpcy5vcHRpb25zLmNvbG9yICE9PSBmYWxzZSA\/IHRoaXMub3B0aW9ucy5jb2xvciA6IHRoaXMuZ2V0VmFsdWUoKSk7CgogICAgdGhpcy5mb3JtYXQgPSB0aGlzLm9wdGlvbnMuZm9ybWF0ICE9PSBmYWxzZSA\/IHRoaXMub3B0aW9ucy5mb3JtYXQgOiB0aGlzLmNvbG9yLm9yaWdGb3JtYXQ7CgogICAgaWYgKHRoaXMub3B0aW9ucy5jb2xvciAhPT0gZmFsc2UpIHsKICAgICAgdGhpcy51cGRhdGVJbnB1dCh0aGlzLmNvbG9yKTsKICAgICAgdGhpcy51cGRhdGVEYXRhKHRoaXMuY29sb3IpOwogICAgfQoKICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTsKCiAgICAvLyBTZXR1cCBwaWNrZXIKICAgIHZhciAkcGlja2VyID0gdGhpcy5waWNrZXIgPSAkKHRoaXMub3B0aW9ucy50ZW1wbGF0ZSk7CiAgICBpZiAodGhpcy5vcHRpb25zLmN1c3RvbUNsYXNzKSB7CiAgICAgICRwaWNrZXIuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmN1c3RvbUNsYXNzKTsKICAgIH0KICAgIGlmICh0aGlzLm9wdGlvbnMuaW5saW5lKSB7CiAgICAgICRwaWNrZXIuYWRkQ2xhc3MoJ2NvbG9ycGlja2VyLWlubGluZSBjb2xvcnBpY2tlci12aXNpYmxlJyk7CiAgICB9IGVsc2UgewogICAgICAkcGlja2VyLmFkZENsYXNzKCdjb2xvcnBpY2tlci1oaWRkZW4nKTsKICAgIH0KICAgIGlmICh0aGlzLm9wdGlvbnMuaG9yaXpvbnRhbCkgewogICAgICAkcGlja2VyLmFkZENsYXNzKCdjb2xvcnBpY2tlci1ob3Jpem9udGFsJyk7CiAgICB9CiAgICBpZiAoCiAgICAgIChbJ3JnYmEnLCAnaHNsYScsICdhbGlhcyddLmluZGV4T2YodGhpcy5mb3JtYXQpICE9PSAtMSkgfHwKICAgICAgdGhpcy5vcHRpb25zLmZvcm1hdCA9PT0gZmFsc2UgfHwKICAgICAgdGhpcy5nZXRWYWx1ZSgpID09PSAndHJhbnNwYXJlbnQnCiAgICApIHsKICAgICAgJHBpY2tlci5hZGRDbGFzcygnY29sb3JwaWNrZXItd2l0aC1hbHBoYScpOwogICAgfQogICAgaWYgKHRoaXMub3B0aW9ucy5hbGlnbiA9PT0gJ3JpZ2h0JykgewogICAgICAkcGlja2VyLmFkZENsYXNzKCdjb2xvcnBpY2tlci1yaWdodCcpOwogICAgfQogICAgaWYgKHRoaXMub3B0aW9ucy5pbmxpbmUgPT09IHRydWUpIHsKICAgICAgJHBpY2tlci5hZGRDbGFzcygnY29sb3JwaWNrZXItbm8tYXJyb3cnKTsKICAgIH0KICAgIGlmICh0aGlzLm9wdGlvbnMuY29sb3JTZWxlY3RvcnMpIHsKICAgICAgdmFyIGNvbG9ycGlja2VyID0gdGhpcywKICAgICAgICBzZWxlY3RvcnNDb250YWluZXIgPSBjb2xvcnBpY2tlci5waWNrZXIuZmluZCgnLmNvbG9ycGlja2VyLXNlbGVjdG9ycycpOwoKICAgICAgaWYgKHNlbGVjdG9yc0NvbnRhaW5lci5sZW5ndGggPiAwKSB7CiAgICAgICAgJC5lYWNoKHRoaXMub3B0aW9ucy5jb2xvclNlbGVjdG9ycywgZnVuY3Rpb24obmFtZSwgY29sb3IpIHsKICAgICAgICAgIHZhciAkYnRuID0gJCgnPGkgLz4nKQogICAgICAgICAgICAuYWRkQ2xhc3MoJ2NvbG9ycGlja2VyLXNlbGVjdG9ycy1jb2xvcicpCiAgICAgICAgICAgIC5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBjb2xvcikKICAgICAgICAgICAgLmRhdGEoJ2NsYXNzJywgbmFtZSkuZGF0YSgnYWxpYXMnLCBuYW1lKTsKCiAgICAgICAgICAkYnRuLm9uKCdtb3VzZWRvd24uY29sb3JwaWNrZXIgdG91Y2hzdGFydC5jb2xvcnBpY2tlcicsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbG9ycGlja2VyLnNldFZhbHVlKAogICAgICAgICAgICAgIGNvbG9ycGlja2VyLmZvcm1hdCA9PT0gJ2FsaWFzJyA\/ICQodGhpcykuZGF0YSgnYWxpYXMnKSA6ICQodGhpcykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJykKICAgICAgICAgICAgKTsKICAgICAgICAgIH0pOwogICAgICAgICAgc2VsZWN0b3JzQ29udGFpbmVyLmFwcGVuZCgkYnRuKTsKICAgICAgICB9KTsKICAgICAgICBzZWxlY3RvcnNDb250YWluZXIuc2hvdygpLmFkZENsYXNzKCdjb2xvcnBpY2tlci12aXNpYmxlJyk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBQcmV2ZW50IGNsb3NpbmcgdGhlIGNvbG9ycGlja2VyIHdoZW4gY2xpY2tpbmcgb24gaXRzZWxmCiAgICAkcGlja2VyLm9uKCdtb3VzZWRvd24uY29sb3JwaWNrZXIgdG91Y2hzdGFydC5jb2xvcnBpY2tlcicsICQucHJveHkoZnVuY3Rpb24oZSkgewogICAgICBpZiAoZS50YXJnZXQgPT09IGUuY3VycmVudFRhcmdldCkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSwgdGhpcykpOwoKICAgIC8vIEJpbmQgY2xpY2svdGFwIGV2ZW50cyBvbiB0aGUgc2xpZGVycwogICAgJHBpY2tlci5maW5kKCcuY29sb3JwaWNrZXItc2F0dXJhdGlvbiwgLmNvbG9ycGlja2VyLWh1ZSwgLmNvbG9ycGlja2VyLWFscGhhJykKICAgICAgLm9uKCdtb3VzZWRvd24uY29sb3JwaWNrZXIgdG91Y2hzdGFydC5jb2xvcnBpY2tlcicsICQucHJveHkodGhpcy5tb3VzZWRvd24sIHRoaXMpKTsKCiAgICAkcGlja2VyLmFwcGVuZFRvKHRoaXMuY29udGFpbmVyID8gdGhpcy5jb250YWluZXIgOiAkKCdib2R5JykpOwoKICAgIC8vIEJpbmQgb3RoZXIgZXZlbnRzCiAgICBpZiAodGhpcy5pbnB1dCAhPT0gZmFsc2UpIHsKICAgICAgdGhpcy5pbnB1dC5vbih7CiAgICAgICAgJ2tleXVwLmNvbG9ycGlja2VyJzogJC5wcm94eSh0aGlzLmtleXVwLCB0aGlzKQogICAgICB9KTsKICAgICAgdGhpcy5pbnB1dC5vbih7CiAgICAgICAgJ2NoYW5nZS5jb2xvcnBpY2tlcic6ICQucHJveHkodGhpcy5jaGFuZ2UsIHRoaXMpCiAgICAgIH0pOwogICAgICBpZiAodGhpcy5jb21wb25lbnQgPT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5lbGVtZW50Lm9uKHsKICAgICAgICAgICdmb2N1cy5jb2xvcnBpY2tlcic6ICQucHJveHkodGhpcy5zaG93LCB0aGlzKQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5saW5lID09PSBmYWxzZSkgewogICAgICAgIHRoaXMuZWxlbWVudC5vbih7CiAgICAgICAgICAnZm9jdXNvdXQuY29sb3JwaWNrZXInOiAkLnByb3h5KHRoaXMuaGlkZSwgdGhpcykKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLmNvbXBvbmVudCAhPT0gZmFsc2UpIHsKICAgICAgdGhpcy5jb21wb25lbnQub24oewogICAgICAgICdjbGljay5jb2xvcnBpY2tlcic6ICQucHJveHkodGhpcy5zaG93LCB0aGlzKQogICAgICB9KTsKICAgIH0KCiAgICBpZiAoKHRoaXMuaW5wdXQgPT09IGZhbHNlKSAmJiAodGhpcy5jb21wb25lbnQgPT09IGZhbHNlKSkgewogICAgICB0aGlzLmVsZW1lbnQub24oewogICAgICAgICdjbGljay5jb2xvcnBpY2tlcic6ICQucHJveHkodGhpcy5zaG93LCB0aGlzKQogICAgICB9KTsKICAgIH0KCiAgICAvLyBmb3IgSFRNTDUgaW5wdXRbdHlwZT0nY29sb3InXQogICAgaWYgKCh0aGlzLmlucHV0ICE9PSBmYWxzZSkgJiYgKHRoaXMuY29tcG9uZW50ICE9PSBmYWxzZSkgJiYgKHRoaXMuaW5wdXQuYXR0cigndHlwZScpID09PSAnY29sb3InKSkgewoKICAgICAgdGhpcy5pbnB1dC5vbih7CiAgICAgICAgJ2NsaWNrLmNvbG9ycGlja2VyJzogJC5wcm94eSh0aGlzLnNob3csIHRoaXMpLAogICAgICAgICdmb2N1cy5jb2xvcnBpY2tlcic6ICQucHJveHkodGhpcy5zaG93LCB0aGlzKQogICAgICB9KTsKICAgIH0KICAgIHRoaXMudXBkYXRlKCk7CgogICAgJCgkLnByb3h5KGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcignY3JlYXRlJyk7CiAgICB9LCB0aGlzKSk7CiAgfTsKCiAgQ29sb3JwaWNrZXIuQ29sb3IgPSBDb2xvcjsKCiAgQ29sb3JwaWNrZXIucHJvdG90eXBlID0gewogICAgY29uc3RydWN0b3I6IENvbG9ycGlja2VyLAogICAgZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucGlja2VyLnJlbW92ZSgpOwogICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlRGF0YSgnY29sb3JwaWNrZXInLCAnY29sb3InKS5vZmYoJy5jb2xvcnBpY2tlcicpOwogICAgICBpZiAodGhpcy5pbnB1dCAhPT0gZmFsc2UpIHsKICAgICAgICB0aGlzLmlucHV0Lm9mZignLmNvbG9ycGlja2VyJyk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29tcG9uZW50ICE9PSBmYWxzZSkgewogICAgICAgIHRoaXMuY29tcG9uZW50Lm9mZignLmNvbG9ycGlja2VyJyk7CiAgICAgIH0KICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCdjb2xvcnBpY2tlci1lbGVtZW50Jyk7CiAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKHsKICAgICAgICB0eXBlOiAnZGVzdHJveScKICAgICAgfSk7CiAgICB9LAogICAgcmVwb3NpdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5saW5lICE9PSBmYWxzZSB8fCB0aGlzLm9wdGlvbnMuY29udGFpbmVyKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciB0eXBlID0gdGhpcy5jb250YWluZXIgJiYgdGhpcy5jb250YWluZXJbMF0gIT09IHdpbmRvdy5kb2N1bWVudC5ib2R5ID8gJ3Bvc2l0aW9uJyA6ICdvZmZzZXQnOwogICAgICB2YXIgZWxlbWVudCA9IHRoaXMuY29tcG9uZW50IHx8IHRoaXMuZWxlbWVudDsKICAgICAgdmFyIG9mZnNldCA9IGVsZW1lbnRbdHlwZV0oKTsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5hbGlnbiA9PT0gJ3JpZ2h0JykgewogICAgICAgIG9mZnNldC5sZWZ0IC09IHRoaXMucGlja2VyLm91dGVyV2lkdGgoKSAtIGVsZW1lbnQub3V0ZXJXaWR0aCgpOwogICAgICB9CiAgICAgIHRoaXMucGlja2VyLmNzcyh7CiAgICAgICAgdG9wOiBvZmZzZXQudG9wICsgZWxlbWVudC5vdXRlckhlaWdodCgpLAogICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0CiAgICAgIH0pOwogICAgfSwKICAgIHNob3c6IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKHRoaXMuaXNEaXNhYmxlZCgpKSB7CiAgICAgICAgLy8gRG9uJ3Qgc2hvdyB0aGUgd2lkZ2V0IGlmIGl0J3MgZGlzYWJsZWQgKHRoZSBpbnB1dCkKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5waWNrZXIuYWRkQ2xhc3MoJ2NvbG9ycGlja2VyLXZpc2libGUnKS5yZW1vdmVDbGFzcygnY29sb3JwaWNrZXItaGlkZGVuJyk7CiAgICAgIHRoaXMucmVwb3NpdGlvbigpOwogICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZS5jb2xvcnBpY2tlcicsICQucHJveHkodGhpcy5yZXBvc2l0aW9uLCB0aGlzKSk7CiAgICAgIGlmIChlICYmICghdGhpcy5oYXNJbnB1dCgpIHx8IHRoaXMuaW5wdXQuYXR0cigndHlwZScpID09PSAnY29sb3InKSkgewogICAgICAgIGlmIChlLnN0b3BQcm9wYWdhdGlvbiAmJiBlLnByZXZlbnREZWZhdWx0KSB7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoKHRoaXMuY29tcG9uZW50IHx8ICF0aGlzLmlucHV0KSAmJiAodGhpcy5vcHRpb25zLmlubGluZSA9PT0gZmFsc2UpKSB7CiAgICAgICAgJCh3aW5kb3cuZG9jdW1lbnQpLm9uKHsKICAgICAgICAgICdtb3VzZWRvd24uY29sb3JwaWNrZXInOiAkLnByb3h5KHRoaXMuaGlkZSwgdGhpcykKICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcih7CiAgICAgICAgdHlwZTogJ3Nob3dQaWNrZXInLAogICAgICAgIGNvbG9yOiB0aGlzLmNvbG9yCiAgICAgIH0pOwogICAgfSwKICAgIGhpZGU6IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCh0eXBlb2YgZSAhPT0gJ3VuZGVmaW5lZCcpICYmIGUudGFyZ2V0KSB7CiAgICAgICAgLy8gUHJldmVudCBoaWRlIGlmIHRyaWdnZXJlZCBieSBhbiBldmVudCBhbmQgYW4gZWxlbWVudCBpbnNpZGUgdGhlIGNvbG9ycGlja2VyIGhhcyBiZWVuIGNsaWNrZWQvdG91Y2hlZAogICAgICAgIGlmICgKICAgICAgICAgICQoZS5jdXJyZW50VGFyZ2V0KS5wYXJlbnRzKCcuY29sb3JwaWNrZXInKS5sZW5ndGggPiAwIHx8CiAgICAgICAgICAkKGUudGFyZ2V0KS5wYXJlbnRzKCcuY29sb3JwaWNrZXInKS5sZW5ndGggPiAwCiAgICAgICAgKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGlja2VyLmFkZENsYXNzKCdjb2xvcnBpY2tlci1oaWRkZW4nKS5yZW1vdmVDbGFzcygnY29sb3JwaWNrZXItdmlzaWJsZScpOwogICAgICAkKHdpbmRvdykub2ZmKCdyZXNpemUuY29sb3JwaWNrZXInLCB0aGlzLnJlcG9zaXRpb24pOwogICAgICAkKHdpbmRvdy5kb2N1bWVudCkub2ZmKHsKICAgICAgICAnbW91c2Vkb3duLmNvbG9ycGlja2VyJzogdGhpcy5oaWRlCiAgICAgIH0pOwogICAgICB0aGlzLnVwZGF0ZSgpOwogICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcih7CiAgICAgICAgdHlwZTogJ2hpZGVQaWNrZXInLAogICAgICAgIGNvbG9yOiB0aGlzLmNvbG9yCiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZURhdGE6IGZ1bmN0aW9uKHZhbCkgewogICAgICB2YWwgPSB2YWwgfHwgdGhpcy5jb2xvci50b1N0cmluZyhmYWxzZSwgdGhpcy5mb3JtYXQpOwogICAgICB0aGlzLmVsZW1lbnQuZGF0YSgnY29sb3InLCB2YWwpOwogICAgICByZXR1cm4gdmFsOwogICAgfSwKICAgIHVwZGF0ZUlucHV0OiBmdW5jdGlvbih2YWwpIHsKICAgICAgdmFsID0gdmFsIHx8IHRoaXMuY29sb3IudG9TdHJpbmcoZmFsc2UsIHRoaXMuZm9ybWF0KTsKICAgICAgaWYgKHRoaXMuaW5wdXQgIT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5pbnB1dC5wcm9wKCd2YWx1ZScsIHZhbCk7CiAgICAgICAgdGhpcy5pbnB1dC50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgfQogICAgICByZXR1cm4gdmFsOwogICAgfSwKICAgIHVwZGF0ZVBpY2tlcjogZnVuY3Rpb24odmFsKSB7CiAgICAgIGlmICh0eXBlb2YgdmFsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIHRoaXMuY29sb3IgPSB0aGlzLmNyZWF0ZUNvbG9yKHZhbCk7CiAgICAgIH0KICAgICAgdmFyIHNsID0gKHRoaXMub3B0aW9ucy5ob3Jpem9udGFsID09PSBmYWxzZSkgPyB0aGlzLm9wdGlvbnMuc2xpZGVycyA6IHRoaXMub3B0aW9ucy5zbGlkZXJzSG9yejsKICAgICAgdmFyIGljbnMgPSB0aGlzLnBpY2tlci5maW5kKCdpJyk7CiAgICAgIGlmIChpY25zLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodGhpcy5vcHRpb25zLmhvcml6b250YWwgPT09IGZhbHNlKSB7CiAgICAgICAgc2wgPSB0aGlzLm9wdGlvbnMuc2xpZGVyczsKICAgICAgICBpY25zLmVxKDEpLmNzcygndG9wJywgc2wuaHVlLm1heFRvcCAqICgxIC0gdGhpcy5jb2xvci52YWx1ZS5oKSkuZW5kKCkKICAgICAgICAgIC5lcSgyKS5jc3MoJ3RvcCcsIHNsLmFscGhhLm1heFRvcCAqICgxIC0gdGhpcy5jb2xvci52YWx1ZS5hKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2wgPSB0aGlzLm9wdGlvbnMuc2xpZGVyc0hvcno7CiAgICAgICAgaWNucy5lcSgxKS5jc3MoJ2xlZnQnLCBzbC5odWUubWF4TGVmdCAqICgxIC0gdGhpcy5jb2xvci52YWx1ZS5oKSkuZW5kKCkKICAgICAgICAgIC5lcSgyKS5jc3MoJ2xlZnQnLCBzbC5hbHBoYS5tYXhMZWZ0ICogKDEgLSB0aGlzLmNvbG9yLnZhbHVlLmEpKTsKICAgICAgfQogICAgICBpY25zLmVxKDApLmNzcyh7CiAgICAgICAgJ3RvcCc6IHNsLnNhdHVyYXRpb24ubWF4VG9wIC0gdGhpcy5jb2xvci52YWx1ZS5iICogc2wuc2F0dXJhdGlvbi5tYXhUb3AsCiAgICAgICAgJ2xlZnQnOiB0aGlzLmNvbG9yLnZhbHVlLnMgKiBzbC5zYXR1cmF0aW9uLm1heExlZnQKICAgICAgfSk7CgogICAgICB0aGlzLnBpY2tlci5maW5kKCcuY29sb3JwaWNrZXItc2F0dXJhdGlvbicpCiAgICAgICAgLmNzcygnYmFja2dyb3VuZENvbG9yJywgdGhpcy5jb2xvci50b0hleCh0cnVlLCB0aGlzLmNvbG9yLnZhbHVlLmgsIDEsIDEsIDEpKTsKCiAgICAgIHRoaXMucGlja2VyLmZpbmQoJy5jb2xvcnBpY2tlci1hbHBoYScpCiAgICAgICAgLmNzcygnYmFja2dyb3VuZENvbG9yJywgdGhpcy5jb2xvci50b0hleCh0cnVlKSk7CgogICAgICB0aGlzLnBpY2tlci5maW5kKCcuY29sb3JwaWNrZXItY29sb3IsIC5jb2xvcnBpY2tlci1jb2xvciBkaXYnKQogICAgICAgIC5jc3MoJ2JhY2tncm91bmRDb2xvcicsIHRoaXMuY29sb3IudG9TdHJpbmcodHJ1ZSwgdGhpcy5mb3JtYXQpKTsKCiAgICAgIHJldHVybiB2YWw7CiAgICB9LAogICAgdXBkYXRlQ29tcG9uZW50OiBmdW5jdGlvbih2YWwpIHsKICAgICAgdmFyIGNvbG9yOwoKICAgICAgaWYgKHR5cGVvZiB2YWwgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgY29sb3IgPSB0aGlzLmNyZWF0ZUNvbG9yKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29sb3IgPSB0aGlzLmNvbG9yOwogICAgICB9CgogICAgICBpZiAodGhpcy5jb21wb25lbnQgIT09IGZhbHNlKSB7CiAgICAgICAgdmFyIGljbiA9IHRoaXMuY29tcG9uZW50LmZpbmQoJ2knKS5lcSgwKTsKICAgICAgICBpZiAoaWNuLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGljbi5jc3MoewogICAgICAgICAgICAnYmFja2dyb3VuZENvbG9yJzogY29sb3IudG9TdHJpbmcodHJ1ZSwgdGhpcy5mb3JtYXQpCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jb21wb25lbnQuY3NzKHsKICAgICAgICAgICAgJ2JhY2tncm91bmRDb2xvcic6IGNvbG9yLnRvU3RyaW5nKHRydWUsIHRoaXMuZm9ybWF0KQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gY29sb3IudG9TdHJpbmcoZmFsc2UsIHRoaXMuZm9ybWF0KTsKICAgIH0sCiAgICB1cGRhdGU6IGZ1bmN0aW9uKGZvcmNlKSB7CiAgICAgIHZhciB2YWw7CiAgICAgIGlmICgodGhpcy5nZXRWYWx1ZShmYWxzZSkgIT09IGZhbHNlKSB8fCAoZm9yY2UgPT09IHRydWUpKSB7CiAgICAgICAgLy8gVXBkYXRlIGlucHV0L2RhdGEgb25seSBpZiB0aGUgY3VycmVudCB2YWx1ZSBpcyBub3QgZW1wdHkKICAgICAgICB2YWwgPSB0aGlzLnVwZGF0ZUNvbXBvbmVudCgpOwogICAgICAgIHRoaXMudXBkYXRlSW5wdXQodmFsKTsKICAgICAgICB0aGlzLnVwZGF0ZURhdGEodmFsKTsKICAgICAgICB0aGlzLnVwZGF0ZVBpY2tlcigpOyAvLyBvbmx5IHVwZGF0ZSBwaWNrZXIgaWYgdmFsdWUgaXMgbm90IGVtcHR5CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbDsKCiAgICB9LAogICAgc2V0VmFsdWU6IGZ1bmN0aW9uKHZhbCkgeyAvLyBzZXQgY29sb3IgbWFudWFsbHkKICAgICAgdGhpcy5jb2xvciA9IHRoaXMuY3JlYXRlQ29sb3IodmFsKTsKICAgICAgdGhpcy51cGRhdGUodHJ1ZSk7CiAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKHsKICAgICAgICB0eXBlOiAnY2hhbmdlQ29sb3InLAogICAgICAgIGNvbG9yOiB0aGlzLmNvbG9yLAogICAgICAgIHZhbHVlOiB2YWwKICAgICAgfSk7CiAgICB9LAogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgbmV3IGNvbG9yIHVzaW5nIHRoZSBpbnN0YW5jZSBvcHRpb25zCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsCiAgICAgKiBAcmV0dXJucyB7Q29sb3J9CiAgICAgKi8KICAgIGNyZWF0ZUNvbG9yOiBmdW5jdGlvbih2YWwpIHsKICAgICAgcmV0dXJuIG5ldyBDb2xvcigKICAgICAgICB2YWwgPyB2YWwgOiBudWxsLAogICAgICAgIHRoaXMub3B0aW9ucy5jb2xvclNlbGVjdG9ycywKICAgICAgICB0aGlzLm9wdGlvbnMuZmFsbGJhY2tDb2xvciA\/IHRoaXMub3B0aW9ucy5mYWxsYmFja0NvbG9yIDogdGhpcy5jb2xvciwKICAgICAgICB0aGlzLm9wdGlvbnMuZmFsbGJhY2tGb3JtYXQsCiAgICAgICAgdGhpcy5vcHRpb25zLmhleE51bWJlclNpZ25QcmVmaXgKICAgICAgKTsKICAgIH0sCiAgICBnZXRWYWx1ZTogZnVuY3Rpb24oZGVmYXVsdFZhbHVlKSB7CiAgICAgIGRlZmF1bHRWYWx1ZSA9ICh0eXBlb2YgZGVmYXVsdFZhbHVlID09PSAndW5kZWZpbmVkJykgPyB0aGlzLm9wdGlvbnMuZmFsbGJhY2tDb2xvciA6IGRlZmF1bHRWYWx1ZTsKICAgICAgdmFyIHZhbDsKICAgICAgaWYgKHRoaXMuaGFzSW5wdXQoKSkgewogICAgICAgIHZhbCA9IHRoaXMuaW5wdXQudmFsKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsID0gdGhpcy5lbGVtZW50LmRhdGEoJ2NvbG9yJyk7CiAgICAgIH0KICAgICAgaWYgKCh2YWwgPT09IHVuZGVmaW5lZCkgfHwgKHZhbCA9PT0gJycpIHx8ICh2YWwgPT09IG51bGwpKSB7CiAgICAgICAgLy8gaWYgbm90IGRlZmluZWQgb3IgZW1wdHksIHJldHVybiBkZWZhdWx0CiAgICAgICAgdmFsID0gZGVmYXVsdFZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiB2YWw7CiAgICB9LAogICAgaGFzSW5wdXQ6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gKHRoaXMuaW5wdXQgIT09IGZhbHNlKTsKICAgIH0sCiAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQ7CiAgICB9LAogICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmhhc0lucHV0KCkpIHsKICAgICAgICB0aGlzLmlucHV0LnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7CiAgICAgIH0KICAgICAgdGhpcy5kaXNhYmxlZCA9IHRydWU7CiAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKHsKICAgICAgICB0eXBlOiAnZGlzYWJsZScsCiAgICAgICAgY29sb3I6IHRoaXMuY29sb3IsCiAgICAgICAgdmFsdWU6IHRoaXMuZ2V0VmFsdWUoKQogICAgICB9KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgZW5hYmxlOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMuaGFzSW5wdXQoKSkgewogICAgICAgIHRoaXMuaW5wdXQucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7CiAgICAgIH0KICAgICAgdGhpcy5kaXNhYmxlZCA9IGZhbHNlOwogICAgICB0aGlzLmVsZW1lbnQudHJpZ2dlcih7CiAgICAgICAgdHlwZTogJ2VuYWJsZScsCiAgICAgICAgY29sb3I6IHRoaXMuY29sb3IsCiAgICAgICAgdmFsdWU6IHRoaXMuZ2V0VmFsdWUoKQogICAgICB9KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgY3VycmVudFNsaWRlcjogbnVsbCwKICAgIG1vdXNlUG9pbnRlcjogewogICAgICBsZWZ0OiAwLAogICAgICB0b3A6IDAKICAgIH0sCiAgICBtb3VzZWRvd246IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKCFlLnBhZ2VYICYmICFlLnBhZ2VZICYmIGUub3JpZ2luYWxFdmVudCAmJiBlLm9yaWdpbmFsRXZlbnQudG91Y2hlcykgewogICAgICAgIGUucGFnZVggPSBlLm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWDsKICAgICAgICBlLnBhZ2VZID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVk7CiAgICAgIH0KICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgdmFyIHRhcmdldCA9ICQoZS50YXJnZXQpOwoKICAgICAgLy9kZXRlY3QgdGhlIHNsaWRlciBhbmQgc2V0IHRoZSBsaW1pdHMgYW5kIGNhbGxiYWNrcwogICAgICB2YXIgem9uZSA9IHRhcmdldC5jbG9zZXN0KCdkaXYnKTsKICAgICAgdmFyIHNsID0gdGhpcy5vcHRpb25zLmhvcml6b250YWwgPyB0aGlzLm9wdGlvbnMuc2xpZGVyc0hvcnogOiB0aGlzLm9wdGlvbnMuc2xpZGVyczsKICAgICAgaWYgKCF6b25lLmlzKCcuY29sb3JwaWNrZXInKSkgewogICAgICAgIGlmICh6b25lLmlzKCcuY29sb3JwaWNrZXItc2F0dXJhdGlvbicpKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZXIgPSAkLmV4dGVuZCh7fSwgc2wuc2F0dXJhdGlvbik7CiAgICAgICAgfSBlbHNlIGlmICh6b25lLmlzKCcuY29sb3JwaWNrZXItaHVlJykpIHsKICAgICAgICAgIHRoaXMuY3VycmVudFNsaWRlciA9ICQuZXh0ZW5kKHt9LCBzbC5odWUpOwogICAgICAgIH0gZWxzZSBpZiAoem9uZS5pcygnLmNvbG9ycGlja2VyLWFscGhhJykpIHsKICAgICAgICAgIHRoaXMuY3VycmVudFNsaWRlciA9ICQuZXh0ZW5kKHt9LCBzbC5hbHBoYSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIG9mZnNldCA9IHpvbmUub2Zmc2V0KCk7CiAgICAgICAgLy9yZWZlcmVuY2UgdG8gZ3VpZGUncyBzdHlsZQogICAgICAgIHRoaXMuY3VycmVudFNsaWRlci5ndWlkZSA9IHpvbmUuZmluZCgnaScpWzBdLnN0eWxlOwogICAgICAgIHRoaXMuY3VycmVudFNsaWRlci5sZWZ0ID0gZS5wYWdlWCAtIG9mZnNldC5sZWZ0OwogICAgICAgIHRoaXMuY3VycmVudFNsaWRlci50b3AgPSBlLnBhZ2VZIC0gb2Zmc2V0LnRvcDsKICAgICAgICB0aGlzLm1vdXNlUG9pbnRlciA9IHsKICAgICAgICAgIGxlZnQ6IGUucGFnZVgsCiAgICAgICAgICB0b3A6IGUucGFnZVkKICAgICAgICB9OwogICAgICAgIC8vdHJpZ2dlciBtb3VzZW1vdmUgdG8gbW92ZSB0aGUgZ3VpZGUgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb24KICAgICAgICAkKHdpbmRvdy5kb2N1bWVudCkub24oewogICAgICAgICAgJ21vdXNlbW92ZS5jb2xvcnBpY2tlcic6ICQucHJveHkodGhpcy5tb3VzZW1vdmUsIHRoaXMpLAogICAgICAgICAgJ3RvdWNobW92ZS5jb2xvcnBpY2tlcic6ICQucHJveHkodGhpcy5tb3VzZW1vdmUsIHRoaXMpLAogICAgICAgICAgJ21vdXNldXAuY29sb3JwaWNrZXInOiAkLnByb3h5KHRoaXMubW91c2V1cCwgdGhpcyksCiAgICAgICAgICAndG91Y2hlbmQuY29sb3JwaWNrZXInOiAkLnByb3h5KHRoaXMubW91c2V1cCwgdGhpcykKICAgICAgICB9KS50cmlnZ2VyKCdtb3VzZW1vdmUnKTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgbW91c2Vtb3ZlOiBmdW5jdGlvbihlKSB7CiAgICAgIGlmICghZS5wYWdlWCAmJiAhZS5wYWdlWSAmJiBlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMpIHsKICAgICAgICBlLnBhZ2VYID0gZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF0ucGFnZVg7CiAgICAgICAgZS5wYWdlWSA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VZOwogICAgICB9CiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgdmFyIGxlZnQgPSBNYXRoLm1heCgKICAgICAgICAwLAogICAgICAgIE1hdGgubWluKAogICAgICAgICAgdGhpcy5jdXJyZW50U2xpZGVyLm1heExlZnQsCiAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZXIubGVmdCArICgoZS5wYWdlWCB8fCB0aGlzLm1vdXNlUG9pbnRlci5sZWZ0KSAtIHRoaXMubW91c2VQb2ludGVyLmxlZnQpCiAgICAgICAgKQogICAgICApOwogICAgICB2YXIgdG9wID0gTWF0aC5tYXgoCiAgICAgICAgMCwKICAgICAgICBNYXRoLm1pbigKICAgICAgICAgIHRoaXMuY3VycmVudFNsaWRlci5tYXhUb3AsCiAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZXIudG9wICsgKChlLnBhZ2VZIHx8IHRoaXMubW91c2VQb2ludGVyLnRvcCkgLSB0aGlzLm1vdXNlUG9pbnRlci50b3ApCiAgICAgICAgKQogICAgICApOwogICAgICB0aGlzLmN1cnJlbnRTbGlkZXIuZ3VpZGUubGVmdCA9IGxlZnQgKyAncHgnOwogICAgICB0aGlzLmN1cnJlbnRTbGlkZXIuZ3VpZGUudG9wID0gdG9wICsgJ3B4JzsKICAgICAgaWYgKHRoaXMuY3VycmVudFNsaWRlci5jYWxsTGVmdCkgewogICAgICAgIHRoaXMuY29sb3JbdGhpcy5jdXJyZW50U2xpZGVyLmNhbGxMZWZ0XS5jYWxsKHRoaXMuY29sb3IsIGxlZnQgLyB0aGlzLmN1cnJlbnRTbGlkZXIubWF4TGVmdCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY3VycmVudFNsaWRlci5jYWxsVG9wKSB7CiAgICAgICAgdGhpcy5jb2xvclt0aGlzLmN1cnJlbnRTbGlkZXIuY2FsbFRvcF0uY2FsbCh0aGlzLmNvbG9yLCB0b3AgLyB0aGlzLmN1cnJlbnRTbGlkZXIubWF4VG9wKTsKICAgICAgfQogICAgICAvLyBDaGFuZ2UgZm9ybWF0IGR5bmFtaWNhbGx5CiAgICAgIC8vIE9ubHkgb2NjdXJzIGlmIHVzZXIgY2hvb3NlIHRoZSBkeW5hbWljIGZvcm1hdCBieQogICAgICAvLyBzZXR0aW5nIG9wdGlvbiBmb3JtYXQgdG8gZmFsc2UKICAgICAgaWYgKAogICAgICAgIHRoaXMub3B0aW9ucy5mb3JtYXQgPT09IGZhbHNlICYmCiAgICAgICAgKHRoaXMuY3VycmVudFNsaWRlci5jYWxsVG9wID09PSAnc2V0QWxwaGEnIHx8CiAgICAgICAgICB0aGlzLmN1cnJlbnRTbGlkZXIuY2FsbExlZnQgPT09ICdzZXRBbHBoYScpCiAgICAgICkgewoKICAgICAgICAvLyBDb252ZXJ0aW5nIGZyb20gaGV4IC8gcmdiIHRvIHJnYmEKICAgICAgICBpZiAodGhpcy5jb2xvci52YWx1ZS5hICE9PSAxKSB7CiAgICAgICAgICB0aGlzLmZvcm1hdCA9ICdyZ2JhJzsKICAgICAgICAgIHRoaXMuY29sb3Iub3JpZ0Zvcm1hdCA9ICdyZ2JhJzsKICAgICAgICB9CgogICAgICAgIC8vIENvbnZlcnRpbmcgZnJvbSByZ2JhIHRvIGhleAogICAgICAgIGVsc2UgewogICAgICAgICAgdGhpcy5mb3JtYXQgPSAnaGV4JzsKICAgICAgICAgIHRoaXMuY29sb3Iub3JpZ0Zvcm1hdCA9ICdoZXgnOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnVwZGF0ZSh0cnVlKTsKCiAgICAgIHRoaXMuZWxlbWVudC50cmlnZ2VyKHsKICAgICAgICB0eXBlOiAnY2hhbmdlQ29sb3InLAogICAgICAgIGNvbG9yOiB0aGlzLmNvbG9yCiAgICAgIH0pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgbW91c2V1cDogZnVuY3Rpb24oZSkgewogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICQod2luZG93LmRvY3VtZW50KS5vZmYoewogICAgICAgICdtb3VzZW1vdmUuY29sb3JwaWNrZXInOiB0aGlzLm1vdXNlbW92ZSwKICAgICAgICAndG91Y2htb3ZlLmNvbG9ycGlja2VyJzogdGhpcy5tb3VzZW1vdmUsCiAgICAgICAgJ21vdXNldXAuY29sb3JwaWNrZXInOiB0aGlzLm1vdXNldXAsCiAgICAgICAgJ3RvdWNoZW5kLmNvbG9ycGlja2VyJzogdGhpcy5tb3VzZXVwCiAgICAgIH0pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgY2hhbmdlOiBmdW5jdGlvbihlKSB7CiAgICAgIHRoaXMua2V5dXAoZSk7CiAgICB9LAogICAga2V5dXA6IGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKChlLmtleUNvZGUgPT09IDM4KSkgewogICAgICAgIGlmICh0aGlzLmNvbG9yLnZhbHVlLmEgPCAxKSB7CiAgICAgICAgICB0aGlzLmNvbG9yLnZhbHVlLmEgPSBNYXRoLnJvdW5kKCh0aGlzLmNvbG9yLnZhbHVlLmEgKyAwLjAxKSAqIDEwMCkgLyAxMDA7CiAgICAgICAgfQogICAgICAgIHRoaXMudXBkYXRlKHRydWUpOwogICAgICB9IGVsc2UgaWYgKChlLmtleUNvZGUgPT09IDQwKSkgewogICAgICAgIGlmICh0aGlzLmNvbG9yLnZhbHVlLmEgPiAwKSB7CiAgICAgICAgICB0aGlzLmNvbG9yLnZhbHVlLmEgPSBNYXRoLnJvdW5kKCh0aGlzLmNvbG9yLnZhbHVlLmEgLSAwLjAxKSAqIDEwMCkgLyAxMDA7CiAgICAgICAgfQogICAgICAgIHRoaXMudXBkYXRlKHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY29sb3IgPSB0aGlzLmNyZWF0ZUNvbG9yKHRoaXMuaW5wdXQudmFsKCkpOwogICAgICAgIC8vIENoYW5nZSBmb3JtYXQgZHluYW1pY2FsbHkKICAgICAgICAvLyBPbmx5IG9jY3VycyBpZiB1c2VyIGNob29zZSB0aGUgZHluYW1pYyBmb3JtYXQgYnkKICAgICAgICAvLyBzZXR0aW5nIG9wdGlvbiBmb3JtYXQgdG8gZmFsc2UKICAgICAgICBpZiAodGhpcy5jb2xvci5vcmlnRm9ybWF0ICYmIHRoaXMub3B0aW9ucy5mb3JtYXQgPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLmZvcm1hdCA9IHRoaXMuY29sb3Iub3JpZ0Zvcm1hdDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuZ2V0VmFsdWUoZmFsc2UpICE9PSBmYWxzZSkgewogICAgICAgICAgdGhpcy51cGRhdGVEYXRhKCk7CiAgICAgICAgICB0aGlzLnVwZGF0ZUNvbXBvbmVudCgpOwogICAgICAgICAgdGhpcy51cGRhdGVQaWNrZXIoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoewogICAgICAgIHR5cGU6ICdjaGFuZ2VDb2xvcicsCiAgICAgICAgY29sb3I6IHRoaXMuY29sb3IsCiAgICAgICAgdmFsdWU6IHRoaXMuaW5wdXQudmFsKCkKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgJC5jb2xvcnBpY2tlciA9IENvbG9ycGlja2VyOwoKICAkLmZuLmNvbG9ycGlja2VyID0gZnVuY3Rpb24ob3B0aW9uKSB7CiAgICB2YXIgYXBpQXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksCiAgICAgIGlzU2luZ2xlRWxlbWVudCA9ICh0aGlzLmxlbmd0aCA9PT0gMSksCiAgICAgIHJldHVyblZhbHVlID0gbnVsbDsKCiAgICB2YXIgJGpxID0gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLAogICAgICAgIGluc3QgPSAkdGhpcy5kYXRhKCdjb2xvcnBpY2tlcicpLAogICAgICAgIG9wdGlvbnMgPSAoKHR5cGVvZiBvcHRpb24gPT09ICdvYmplY3QnKSA\/IG9wdGlvbiA6IHt9KTsKCiAgICAgIGlmICghaW5zdCkgewogICAgICAgIGluc3QgPSBuZXcgQ29sb3JwaWNrZXIodGhpcywgb3B0aW9ucyk7CiAgICAgICAgJHRoaXMuZGF0YSgnY29sb3JwaWNrZXInLCBpbnN0KTsKICAgICAgfQoKICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihpbnN0W29wdGlvbl0pKSB7CiAgICAgICAgICByZXR1cm5WYWx1ZSA9IGluc3Rbb3B0aW9uXS5hcHBseShpbnN0LCBhcGlBcmdzKTsKICAgICAgICB9IGVsc2UgeyAvLyBpdHMgYSBwcm9wZXJ0eSA\/CiAgICAgICAgICBpZiAoYXBpQXJncy5sZW5ndGgpIHsKICAgICAgICAgICAgLy8gc2V0IHByb3BlcnR5CiAgICAgICAgICAgIGluc3Rbb3B0aW9uXSA9IGFwaUFyZ3NbMF07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm5WYWx1ZSA9IGluc3Rbb3B0aW9uXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuVmFsdWUgPSAkdGhpczsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gaXNTaW5nbGVFbGVtZW50ID8gcmV0dXJuVmFsdWUgOiAkanE7CiAgfTsKCiAgJC5mbi5jb2xvcnBpY2tlci5jb25zdHJ1Y3RvciA9IENvbG9ycGlja2VyOwoKfSkpOwo=",
    "size": "38858"
}