{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Writer\/Excel2007\/Worksheet.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKLyoqCiAqIFBIUEV4Y2VsCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNiAtIDIwMTUgUEhQRXhjZWwKICoKICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcgogKiBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgogKiB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KICoKICogVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCiAqCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKICogTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQogKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxICBVU0EKICoKICogQGNhdGVnb3J5ICAgUEhQRXhjZWwKICogQHBhY2thZ2UgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VsMjAwNwogKiBAY29weXJpZ2h0ICBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsIChodHRwOi8vd3d3LmNvZGVwbGV4LmNvbS9QSFBFeGNlbCkKICogQGxpY2Vuc2UgICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL29sZC1saWNlbnNlcy9sZ3BsLTIuMS50eHQgICAgTEdQTAogKiBAdmVyc2lvbiAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCgoKLyoqCiAqIFBIUEV4Y2VsX1dyaXRlcl9FeGNlbDIwMDdfV29ya3NoZWV0CiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsX1dyaXRlcl9FeGNlbDIwMDcKICogQGNvcHlyaWdodCAgQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbCAoaHR0cDovL3d3dy5jb2RlcGxleC5jb20vUEhQRXhjZWwpCiAqLwpjbGFzcyBQSFBFeGNlbF9Xcml0ZXJfRXhjZWwyMDA3X1dvcmtzaGVldCBleHRlbmRzIFBIUEV4Y2VsX1dyaXRlcl9FeGNlbDIwMDdfV3JpdGVyUGFydAp7CiAgICAvKioKICAgICAqIFdyaXRlIHdvcmtzaGVldCB0byBYTUwgZm9ybWF0CiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAgICAgJHBTaGVldAogICAgICogQHBhcmFtICAgIHN0cmluZ1tdICAgICAgICAgICAgICAgICRwU3RyaW5nVGFibGUKICAgICAqIEBwYXJhbSAgICBib29sZWFuICAgICAgICAgICAgICAgICAgICAkaW5jbHVkZUNoYXJ0cyAgICBGbGFnIGluZGljYXRpbmcgaWYgd2Ugc2hvdWxkIHdyaXRlIGNoYXJ0cwogICAgICogQHJldHVybiAgICBzdHJpbmcgICAgICAgICAgICAgICAgICAgIFhNTCBPdXRwdXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gd3JpdGVXb3Jrc2hlZXQoJHBTaGVldCA9IG51bGwsICRwU3RyaW5nVGFibGUgPSBudWxsLCAkaW5jbHVkZUNoYXJ0cyA9IGZhbHNlKQogICAgewogICAgICAgIGlmICghaXNfbnVsbCgkcFNoZWV0KSkgewogICAgICAgICAgICAvLyBDcmVhdGUgWE1MIHdyaXRlcgogICAgICAgICAgICAkb2JqV3JpdGVyID0gbnVsbDsKICAgICAgICAgICAgaWYgKCR0aGlzLT5nZXRQYXJlbnRXcml0ZXIoKS0+Z2V0VXNlRGlza0NhY2hpbmcoKSkgewogICAgICAgICAgICAgICAgJG9ialdyaXRlciA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXI6OlNUT1JBR0VfRElTSywgJHRoaXMtPmdldFBhcmVudFdyaXRlcigpLT5nZXREaXNrQ2FjaGluZ0RpcmVjdG9yeSgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXIgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlcihQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyOjpTVE9SQUdFX01FTU9SWSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFhNTCBoZWFkZXIKICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnREb2N1bWVudCgnMS4wJywgJ1VURi04JywgJ3llcycpOwoKICAgICAgICAgICAgLy8gV29ya3NoZWV0CiAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnd29ya3NoZWV0Jyk7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd4bWw6c3BhY2UnLCAncHJlc2VydmUnKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3htbG5zJywgJ2h0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9zcHJlYWRzaGVldG1sLzIwMDYvbWFpbicpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgneG1sbnM6cicsICdodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzJyk7CgogICAgICAgICAgICAgICAgLy8gc2hlZXRQcgogICAgICAgICAgICAgICAgJHRoaXMtPndyaXRlU2hlZXRQcigkb2JqV3JpdGVyLCAkcFNoZWV0KTsKCiAgICAgICAgICAgICAgICAvLyBEaW1lbnNpb24KICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZURpbWVuc2lvbigkb2JqV3JpdGVyLCAkcFNoZWV0KTsKCiAgICAgICAgICAgICAgICAvLyBzaGVldFZpZXdzCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVTaGVldFZpZXdzKCRvYmpXcml0ZXIsICRwU2hlZXQpOwoKICAgICAgICAgICAgICAgIC8vIHNoZWV0Rm9ybWF0UHIKICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZVNoZWV0Rm9ybWF0UHIoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gY29scwogICAgICAgICAgICAgICAgJHRoaXMtPndyaXRlQ29scygkb2JqV3JpdGVyLCAkcFNoZWV0KTsKCiAgICAgICAgICAgICAgICAvLyBzaGVldERhdGEKICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZVNoZWV0RGF0YSgkb2JqV3JpdGVyLCAkcFNoZWV0LCAkcFN0cmluZ1RhYmxlKTsKCiAgICAgICAgICAgICAgICAvLyBzaGVldFByb3RlY3Rpb24KICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZVNoZWV0UHJvdGVjdGlvbigkb2JqV3JpdGVyLCAkcFNoZWV0KTsKCiAgICAgICAgICAgICAgICAvLyBwcm90ZWN0ZWRSYW5nZXMKICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZVByb3RlY3RlZFJhbmdlcygkb2JqV3JpdGVyLCAkcFNoZWV0KTsKCiAgICAgICAgICAgICAgICAvLyBhdXRvRmlsdGVyCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVBdXRvRmlsdGVyKCRvYmpXcml0ZXIsICRwU2hlZXQpOwoKICAgICAgICAgICAgICAgIC8vIG1lcmdlQ2VsbHMKICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZU1lcmdlQ2VsbHMoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gY29uZGl0aW9uYWxGb3JtYXR0aW5nCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVDb25kaXRpb25hbEZvcm1hdHRpbmcoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gZGF0YVZhbGlkYXRpb25zCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVEYXRhVmFsaWRhdGlvbnMoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gaHlwZXJsaW5rcwogICAgICAgICAgICAgICAgJHRoaXMtPndyaXRlSHlwZXJsaW5rcygkb2JqV3JpdGVyLCAkcFNoZWV0KTsKCiAgICAgICAgICAgICAgICAvLyBQcmludCBvcHRpb25zCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVQcmludE9wdGlvbnMoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gUGFnZSBtYXJnaW5zCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVQYWdlTWFyZ2lucygkb2JqV3JpdGVyLCAkcFNoZWV0KTsKCiAgICAgICAgICAgICAgICAvLyBQYWdlIHNldHVwCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVQYWdlU2V0dXAoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gSGVhZGVyIC8gZm9vdGVyCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVIZWFkZXJGb290ZXIoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gQnJlYWtzCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVCcmVha3MoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gRHJhd2luZ3MgYW5kL29yIENoYXJ0cwogICAgICAgICAgICAgICAgJHRoaXMtPndyaXRlRHJhd2luZ3MoJG9ialdyaXRlciwgJHBTaGVldCwgJGluY2x1ZGVDaGFydHMpOwoKICAgICAgICAgICAgICAgIC8vIExlZ2FjeURyYXdpbmcKICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZUxlZ2FjeURyYXdpbmcoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAgICAgLy8gTGVnYWN5RHJhd2luZ0hGCiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVMZWdhY3lEcmF3aW5nSEYoJG9ialdyaXRlciwgJHBTaGVldCk7CgogICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CgogICAgICAgICAgICAvLyBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICRvYmpXcml0ZXItPmdldERhdGEoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbigiSW52YWxpZCBQSFBFeGNlbF9Xb3Jrc2hlZXQgb2JqZWN0IHBhc3NlZC4iKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBTaGVldFByCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgJHBTaGVldCAgICAgICAgICAgIFdvcmtzaGVldAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVTaGVldFByKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBzaGVldFByCiAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdzaGVldFByJyk7CiAgICAgICAgLy8kb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnY29kZU5hbWUnLCAgICAgICAgJHBTaGVldC0+Z2V0VGl0bGUoKSk7CiAgICAgICAgaWYgKCRwU2hlZXQtPmdldFBhcmVudCgpLT5oYXNNYWNyb3MoKSkgey8vaWYgdGhlIHdvcmtib29rIGhhdmUgbWFjcm9zLCB3ZSBuZWVkIHRvIGhhdmUgY29kZU5hbWUgZm9yIHRoZSBzaGVldAogICAgICAgICAgICBpZiAoJHBTaGVldC0+aGFzQ29kZU5hbWUoKT09ZmFsc2UpIHsKICAgICAgICAgICAgICAgICRwU2hlZXQtPnNldENvZGVOYW1lKCRwU2hlZXQtPmdldFRpdGxlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdjb2RlTmFtZScsICRwU2hlZXQtPmdldENvZGVOYW1lKCkpOwogICAgICAgIH0KICAgICAgICAkYXV0b0ZpbHRlclJhbmdlID0gJHBTaGVldC0+Z2V0QXV0b0ZpbHRlcigpLT5nZXRSYW5nZSgpOwogICAgICAgIGlmICghZW1wdHkoJGF1dG9GaWx0ZXJSYW5nZSkpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2ZpbHRlck1vZGUnLCAxKTsKICAgICAgICAgICAgJHBTaGVldC0+Z2V0QXV0b0ZpbHRlcigpLT5zaG93SGlkZVJvd3MoKTsKICAgICAgICB9CgogICAgICAgIC8vIHRhYkNvbG9yCiAgICAgICAgaWYgKCRwU2hlZXQtPmlzVGFiQ29sb3JTZXQoKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3RhYkNvbG9yJyk7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdyZ2InLCAkcFNoZWV0LT5nZXRUYWJDb2xvcigpLT5nZXRBUkdCKCkpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBvdXRsaW5lUHIKICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ291dGxpbmVQcicpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzdW1tYXJ5QmVsb3cnLCAoJHBTaGVldC0+Z2V0U2hvd1N1bW1hcnlCZWxvdygpID8gJzEnIDogJzAnKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3N1bW1hcnlSaWdodCcsICgkcFNoZWV0LT5nZXRTaG93U3VtbWFyeVJpZ2h0KCkgPyAnMScgOiAnMCcpKTsKICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CgogICAgICAgIC8vIHBhZ2VTZXRVcFByCiAgICAgICAgaWYgKCRwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRGaXRUb1BhZ2UoKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3BhZ2VTZXRVcFByJyk7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdmaXRUb1BhZ2UnLCAnMScpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgfQoKICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBEaW1lbnNpb24KICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAkb2JqV3JpdGVyICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICAgJHBTaGVldCAgICAgICAgICAgIFdvcmtzaGVldAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVEaW1lbnNpb24oUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyID0gbnVsbCwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsKQogICAgewogICAgICAgIC8vIGRpbWVuc2lvbgogICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnZGltZW5zaW9uJyk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3JlZicsICRwU2hlZXQtPmNhbGN1bGF0ZVdvcmtzaGVldERpbWVuc2lvbigpKTsKICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBTaGVldFZpZXdzCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgICAgICAgICAkb2JqV3JpdGVyICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICAgICAgICAgICAkcFNoZWV0ICAgICAgICAgICAgV29ya3NoZWV0CiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVNoZWV0Vmlld3MoUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyID0gbnVsbCwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsKQogICAgewogICAgICAgIC8vIHNoZWV0Vmlld3MKICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3NoZWV0Vmlld3MnKTsKCiAgICAgICAgLy8gU2hlZXQgc2VsZWN0ZWQ\/CiAgICAgICAgJHNoZWV0U2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgICBpZiAoJHRoaXMtPmdldFBhcmVudFdyaXRlcigpLT5nZXRQSFBFeGNlbCgpLT5nZXRJbmRleCgkcFNoZWV0KSA9PSAkdGhpcy0+Z2V0UGFyZW50V3JpdGVyKCktPmdldFBIUEV4Y2VsKCktPmdldEFjdGl2ZVNoZWV0SW5kZXgoKSkgewogICAgICAgICAgICAkc2hlZXRTZWxlY3RlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBzaGVldFZpZXcKICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3NoZWV0VmlldycpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd0YWJTZWxlY3RlZCcsICRzaGVldFNlbGVjdGVkID8gJzEnIDogJzAnKTsKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnd29ya2Jvb2tWaWV3SWQnLCAnMCcpOwoKICAgICAgICAvLyBab29tIHNjYWxlcwogICAgICAgIGlmICgkcFNoZWV0LT5nZXRTaGVldFZpZXcoKS0+Z2V0Wm9vbVNjYWxlKCkgIT0gMTAwKSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd6b29tU2NhbGUnLCAkcFNoZWV0LT5nZXRTaGVldFZpZXcoKS0+Z2V0Wm9vbVNjYWxlKCkpOwogICAgICAgIH0KICAgICAgICBpZiAoJHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPmdldFpvb21TY2FsZU5vcm1hbCgpICE9IDEwMCkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnem9vbVNjYWxlTm9ybWFsJywgJHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPmdldFpvb21TY2FsZU5vcm1hbCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIFZpZXcgTGF5b3V0IFR5cGUKICAgICAgICBpZiAoJHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPmdldFZpZXcoKSAhPT0gUEhQRXhjZWxfV29ya3NoZWV0X1NoZWV0Vmlldzo6U0hFRVRWSUVXX05PUk1BTCkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndmlldycsICRwU2hlZXQtPmdldFNoZWV0VmlldygpLT5nZXRWaWV3KCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gR3JpZGxpbmVzCiAgICAgICAgaWYgKCRwU2hlZXQtPmdldFNob3dHcmlkbGluZXMoKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc2hvd0dyaWRMaW5lcycsICd0cnVlJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3Nob3dHcmlkTGluZXMnLCAnZmFsc2UnKTsKICAgICAgICB9CgogICAgICAgIC8vIFJvdyBhbmQgY29sdW1uIGhlYWRlcnMKICAgICAgICBpZiAoJHBTaGVldC0+Z2V0U2hvd1Jvd0NvbEhlYWRlcnMoKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc2hvd1Jvd0NvbEhlYWRlcnMnLCAnMScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzaG93Um93Q29sSGVhZGVycycsICcwJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBSaWdodC10by1sZWZ0CiAgICAgICAgaWYgKCRwU2hlZXQtPmdldFJpZ2h0VG9MZWZ0KCkpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3JpZ2h0VG9MZWZ0JywgJ3RydWUnKTsKICAgICAgICB9CgogICAgICAgICRhY3RpdmVDZWxsID0gJHBTaGVldC0+Z2V0QWN0aXZlQ2VsbCgpOwoKICAgICAgICAvLyBQYW5lCiAgICAgICAgJHBhbmUgPSAnJzsKICAgICAgICAkdG9wTGVmdENlbGwgPSAkcFNoZWV0LT5nZXRGcmVlemVQYW5lKCk7CiAgICAgICAgaWYgKCgkdG9wTGVmdENlbGwgIT0gJycpICYmICgkdG9wTGVmdENlbGwgIT0gJ0ExJykpIHsKICAgICAgICAgICAgJGFjdGl2ZUNlbGwgPSBlbXB0eSgkYWN0aXZlQ2VsbCkgPyAkdG9wTGVmdENlbGwgOiAkYWN0aXZlQ2VsbDsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGZyZWV6ZSBjb29yZGluYXRlcwogICAgICAgICAgICAkeFNwbGl0ID0gJHlTcGxpdCA9IDA7CgogICAgICAgICAgICBsaXN0KCR4U3BsaXQsICR5U3BsaXQpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHRvcExlZnRDZWxsKTsKICAgICAgICAgICAgJHhTcGxpdCA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkeFNwbGl0KTsKCiAgICAgICAgICAgIC8vIHBhbmUKICAgICAgICAgICAgJHBhbmUgPSAndG9wUmlnaHQnOwogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3BhbmUnKTsKICAgICAgICAgICAgaWYgKCR4U3BsaXQgPiAxKSB7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgneFNwbGl0JywgJHhTcGxpdCAtIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkeVNwbGl0ID4gMSkgewogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3lTcGxpdCcsICR5U3BsaXQgLSAxKTsKICAgICAgICAgICAgICAgICRwYW5lID0gKCR4U3BsaXQgPiAxKSA\/ICdib3R0b21SaWdodCcgOiAnYm90dG9tTGVmdCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3RvcExlZnRDZWxsJywgJHRvcExlZnRDZWxsKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2FjdGl2ZVBhbmUnLCAkcGFuZSk7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzdGF0ZScsICdmcm96ZW4nKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwoKICAgICAgICAgICAgaWYgKCgkeFNwbGl0ID4gMSkgJiYgKCR5U3BsaXQgPiAxKSkgewogICAgICAgICAgICAgICAgLy8gICAgV3JpdGUgYWRkaXRpb25hbCBzZWxlY3Rpb25zIGlmIG1vcmUgdGhhbiB0d28gcGFuZXMgKGllIGJvdGggYW4gWCBhbmQgYSBZIHNwbGl0KQogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdzZWxlY3Rpb24nKTsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdwYW5lJywgJ3RvcFJpZ2h0Jyk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3NlbGVjdGlvbicpOwogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3BhbmUnLCAnYm90dG9tTGVmdCcpOwogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBTZWxlY3Rpb24KLy8gICAgICBpZiAoJHBhbmUgIT0gJycpIHsKICAgICAgICAvLyBPbmx5IG5lZWQgdG8gd3JpdGUgc2VsZWN0aW9uIGVsZW1lbnQgaWYgd2UgaGF2ZSBhIHNwbGl0IHBhbmUKICAgICAgICAvLyBXZSBjaGVhdCBhIGxpdHRsZSBieSBvdmVyLXJpZGluZyB0aGUgYWN0aXZlIGNlbGwgc2VsZWN0aW9uLCBzZXR0aW5nIGl0IHRvIHRoZSBzcGxpdCBjZWxsCiAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdzZWxlY3Rpb24nKTsKICAgICAgICBpZiAoJHBhbmUgIT0gJycpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3BhbmUnLCAkcGFuZSk7CiAgICAgICAgfQogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdhY3RpdmVDZWxsJywgJGFjdGl2ZUNlbGwpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzcXJlZicsICRhY3RpdmVDZWxsKTsKICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7Ci8vICAgICAgfQoKICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CgogICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIFNoZWV0Rm9ybWF0UHIKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlU2hlZXRGb3JtYXRQcihQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyICRvYmpXcml0ZXIgPSBudWxsLCBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCA9IG51bGwpCiAgICB7CiAgICAgICAgLy8gc2hlZXRGb3JtYXRQcgogICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnc2hlZXRGb3JtYXRQcicpOwoKICAgICAgICAvLyBEZWZhdWx0IHJvdyBoZWlnaHQKICAgICAgICBpZiAoJHBTaGVldC0+Z2V0RGVmYXVsdFJvd0RpbWVuc2lvbigpLT5nZXRSb3dIZWlnaHQoKSA+PSAwKSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdjdXN0b21IZWlnaHQnLCAndHJ1ZScpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZGVmYXVsdFJvd0hlaWdodCcsIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkcFNoZWV0LT5nZXREZWZhdWx0Um93RGltZW5zaW9uKCktPmdldFJvd0hlaWdodCgpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2RlZmF1bHRSb3dIZWlnaHQnLCAnMTQuNCcpOwogICAgICAgIH0KCiAgICAgICAgLy8gU2V0IFplcm8gSGVpZ2h0IHJvdwogICAgICAgIGlmICgoc3RyaW5nKSRwU2hlZXQtPmdldERlZmF1bHRSb3dEaW1lbnNpb24oKS0+Z2V0WmVyb0hlaWdodCgpICA9PSAnMScgfHwKICAgICAgICAgICAgc3RydG9sb3dlcigoc3RyaW5nKSRwU2hlZXQtPmdldERlZmF1bHRSb3dEaW1lbnNpb24oKS0+Z2V0WmVyb0hlaWdodCgpKSA9PSAndHJ1ZScpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3plcm9IZWlnaHQnLCAnMScpOwogICAgICAgIH0KCiAgICAgICAgLy8gRGVmYXVsdCBjb2x1bW4gd2lkdGgKICAgICAgICBpZiAoJHBTaGVldC0+Z2V0RGVmYXVsdENvbHVtbkRpbWVuc2lvbigpLT5nZXRXaWR0aCgpID49IDApIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2RlZmF1bHRDb2xXaWR0aCcsIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkcFNoZWV0LT5nZXREZWZhdWx0Q29sdW1uRGltZW5zaW9uKCktPmdldFdpZHRoKCkpKTsKICAgICAgICB9CgogICAgICAgIC8vIE91dGxpbmUgbGV2ZWwgLSByb3cKICAgICAgICAkb3V0bGluZUxldmVsUm93ID0gMDsKICAgICAgICBmb3JlYWNoICgkcFNoZWV0LT5nZXRSb3dEaW1lbnNpb25zKCkgYXMgJGRpbWVuc2lvbikgewogICAgICAgICAgICBpZiAoJGRpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCkgPiAkb3V0bGluZUxldmVsUm93KSB7CiAgICAgICAgICAgICAgICAkb3V0bGluZUxldmVsUm93ID0gJGRpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ291dGxpbmVMZXZlbFJvdycsIChpbnQpJG91dGxpbmVMZXZlbFJvdyk7CgogICAgICAgIC8vIE91dGxpbmUgbGV2ZWwgLSBjb2x1bW4KICAgICAgICAkb3V0bGluZUxldmVsQ29sID0gMDsKICAgICAgICBmb3JlYWNoICgkcFNoZWV0LT5nZXRDb2x1bW5EaW1lbnNpb25zKCkgYXMgJGRpbWVuc2lvbikgewogICAgICAgICAgICBpZiAoJGRpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCkgPiAkb3V0bGluZUxldmVsQ29sKSB7CiAgICAgICAgICAgICAgICAkb3V0bGluZUxldmVsQ29sID0gJGRpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ291dGxpbmVMZXZlbENvbCcsIChpbnQpJG91dGxpbmVMZXZlbENvbCk7CgogICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIENvbHMKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlQ29scyhQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyICRvYmpXcml0ZXIgPSBudWxsLCBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCA9IG51bGwpCiAgICB7CiAgICAgICAgLy8gY29scwogICAgICAgIGlmIChjb3VudCgkcFNoZWV0LT5nZXRDb2x1bW5EaW1lbnNpb25zKCkpID4gMCkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2NvbHMnKTsKCiAgICAgICAgICAgICRwU2hlZXQtPmNhbGN1bGF0ZUNvbHVtbldpZHRocygpOwoKICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGNvbHVtbiBkaW1lbnNpb25zCiAgICAgICAgICAgIGZvcmVhY2ggKCRwU2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbnMoKSBhcyAkY29sRGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAvLyBjb2wKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnY29sJyk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnbWluJywgUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRjb2xEaW1lbnNpb24tPmdldENvbHVtbkluZGV4KCkpKTsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdtYXgnLCBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNvbERpbWVuc2lvbi0+Z2V0Q29sdW1uSW5kZXgoKSkpOwoKICAgICAgICAgICAgICAgIGlmICgkY29sRGltZW5zaW9uLT5nZXRXaWR0aCgpIDwgMCkgewogICAgICAgICAgICAgICAgICAgIC8vIE5vIHdpZHRoIHNldCwgYXBwbHkgZGVmYXVsdCBvZiAxMAogICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd3aWR0aCcsICc5LjEwJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIFdpZHRoIHNldAogICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd3aWR0aCcsIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkY29sRGltZW5zaW9uLT5nZXRXaWR0aCgpKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQ29sdW1uIHZpc2liaWxpdHkKICAgICAgICAgICAgICAgIGlmICgkY29sRGltZW5zaW9uLT5nZXRWaXNpYmxlKCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnaGlkZGVuJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBBdXRvIHNpemU\/CiAgICAgICAgICAgICAgICBpZiAoJGNvbERpbWVuc2lvbi0+Z2V0QXV0b1NpemUoKSkgewogICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdiZXN0Rml0JywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBDdXN0b20gd2lkdGg\/CiAgICAgICAgICAgICAgICBpZiAoJGNvbERpbWVuc2lvbi0+Z2V0V2lkdGgoKSAhPSAkcFNoZWV0LT5nZXREZWZhdWx0Q29sdW1uRGltZW5zaW9uKCktPmdldFdpZHRoKCkpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnY3VzdG9tV2lkdGgnLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIENvbGxhcHNlZAogICAgICAgICAgICAgICAgaWYgKCRjb2xEaW1lbnNpb24tPmdldENvbGxhcHNlZCgpID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnY29sbGFwc2VkJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBPdXRsaW5lIGxldmVsCiAgICAgICAgICAgICAgICBpZiAoJGNvbERpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ291dGxpbmVMZXZlbCcsICRjb2xEaW1lbnNpb24tPmdldE91dGxpbmVMZXZlbCgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBTdHlsZQogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3N0eWxlJywgJGNvbERpbWVuc2lvbi0+Z2V0WGZJbmRleCgpKTsKCiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBTaGVldFByb3RlY3Rpb24KICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlU2hlZXRQcm90ZWN0aW9uKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBzaGVldFByb3RlY3Rpb24KICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3NoZWV0UHJvdGVjdGlvbicpOwoKICAgICAgICBpZiAoJHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRQYXNzd29yZCgpICE9ICcnKSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdwYXNzd29yZCcsICRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0UGFzc3dvcmQoKSk7CiAgICAgICAgfQoKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc2hlZXQnLCAoJHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRTaGVldCgpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdvYmplY3RzJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0T2JqZWN0cygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzY2VuYXJpb3MnLCAoJHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRTY2VuYXJpb3MoKSA\/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZm9ybWF0Q2VsbHMnLCAoJHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRGb3JtYXRDZWxscygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdmb3JtYXRDb2x1bW5zJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0Rm9ybWF0Q29sdW1ucygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdmb3JtYXRSb3dzJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0Rm9ybWF0Um93cygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdpbnNlcnRDb2x1bW5zJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0SW5zZXJ0Q29sdW1ucygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdpbnNlcnRSb3dzJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0SW5zZXJ0Um93cygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdpbnNlcnRIeXBlcmxpbmtzJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0SW5zZXJ0SHlwZXJsaW5rcygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdkZWxldGVDb2x1bW5zJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0RGVsZXRlQ29sdW1ucygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdkZWxldGVSb3dzJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0RGVsZXRlUm93cygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzZWxlY3RMb2NrZWRDZWxscycsICgkcFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPmdldFNlbGVjdExvY2tlZENlbGxzKCkgPyAndHJ1ZScgOiAnZmFsc2UnKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3NvcnQnLCAoJHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRTb3J0KCkgPyAndHJ1ZScgOiAnZmFsc2UnKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2F1dG9GaWx0ZXInLCAoJHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRBdXRvRmlsdGVyKCkgPyAndHJ1ZScgOiAnZmFsc2UnKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3Bpdm90VGFibGVzJywgKCRwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0UGl2b3RUYWJsZXMoKSA\/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc2VsZWN0VW5sb2NrZWRDZWxscycsICgkcFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPmdldFNlbGVjdFVubG9ja2VkQ2VsbHMoKSA\/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBDb25kaXRpb25hbEZvcm1hdHRpbmcKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlQ29uZGl0aW9uYWxGb3JtYXR0aW5nKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBDb25kaXRpb25hbCBpZAogICAgICAgICRpZCA9IDE7CgogICAgICAgIC8vIExvb3AgdGhyb3VnaCBzdHlsZXMgaW4gdGhlIGN1cnJlbnQgd29ya3NoZWV0CiAgICAgICAgZm9yZWFjaCAoJHBTaGVldC0+Z2V0Q29uZGl0aW9uYWxTdHlsZXNDb2xsZWN0aW9uKCkgYXMgJGNlbGxDb29yZGluYXRlID0+ICRjb25kaXRpb25hbFN0eWxlcykgewogICAgICAgICAgICBmb3JlYWNoICgkY29uZGl0aW9uYWxTdHlsZXMgYXMgJGNvbmRpdGlvbmFsKSB7CiAgICAgICAgICAgICAgICAvLyBXSFkgd2FzIHRoaXMgYWdhaW4\/CiAgICAgICAgICAgICAgICAvLyBpZiAoJHRoaXMtPmdldFBhcmVudFdyaXRlcigpLT5nZXRTdHlsZXNDb25kaXRpb25hbEhhc2hUYWJsZSgpLT5nZXRJbmRleEZvckhhc2hDb2RlKCRjb25kaXRpb25hbC0+Z2V0SGFzaENvZGUoKSkgPT0gJycpIHsKICAgICAgICAgICAgICAgIC8vICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpICE9IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fTk9ORSkgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbmRpdGlvbmFsRm9ybWF0dGluZwogICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnY29uZGl0aW9uYWxGb3JtYXR0aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3NxcmVmJywgJGNlbGxDb29yZGluYXRlKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gY2ZSdWxlCiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdjZlJ1bGUnKTsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndHlwZScsICRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZHhmSWQnLCAkdGhpcy0+Z2V0UGFyZW50V3JpdGVyKCktPmdldFN0eWxlc0NvbmRpdGlvbmFsSGFzaFRhYmxlKCktPmdldEluZGV4Rm9ySGFzaENvZGUoJGNvbmRpdGlvbmFsLT5nZXRIYXNoQ29kZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3ByaW9yaXR5JywgJGlkKyspOwoKICAgICAgICAgICAgICAgICAgICBpZiAoKCRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fQ0VMTElTIHx8ICRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fQ09OVEFJTlNURVhUKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAkY29uZGl0aW9uYWwtPmdldE9wZXJhdG9yVHlwZSgpICE9IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpPUEVSQVRPUl9OT05FKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdvcGVyYXRvcicsICRjb25kaXRpb25hbC0+Z2V0T3BlcmF0b3JUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fQ09OVEFJTlNURVhUCiAgICAgICAgICAgICAgICAgICAgICAgICYmICFpc19udWxsKCRjb25kaXRpb25hbC0+Z2V0VGV4dCgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndGV4dCcsICRjb25kaXRpb25hbC0+Z2V0VGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvblR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0NPTlRBSU5TVEVYVAogICAgICAgICAgICAgICAgICAgICAgICAmJiAkY29uZGl0aW9uYWwtPmdldE9wZXJhdG9yVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpPUEVSQVRPUl9DT05UQUlOU1RFWFQKICAgICAgICAgICAgICAgICAgICAgICAgJiYgIWlzX251bGwoJGNvbmRpdGlvbmFsLT5nZXRUZXh0KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgnZm9ybXVsYScsICdOT1QoSVNFUlJPUihTRUFSQ0goIicgLiAkY29uZGl0aW9uYWwtPmdldFRleHQoKSAuICciLCcgLiAkY2VsbENvb3JkaW5hdGUgLiAnKSkpJyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fQ09OVEFJTlNURVhUCiAgICAgICAgICAgICAgICAgICAgICAgICYmICRjb25kaXRpb25hbC0+Z2V0T3BlcmF0b3JUeXBlKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6Ok9QRVJBVE9SX0JFR0lOU1dJVEgKICAgICAgICAgICAgICAgICAgICAgICAgJiYgIWlzX251bGwoJGNvbmRpdGlvbmFsLT5nZXRUZXh0KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgnZm9ybXVsYScsICdMRUZUKCcgLiAkY2VsbENvb3JkaW5hdGUgLiAnLCcgLiBzdHJsZW4oJGNvbmRpdGlvbmFsLT5nZXRUZXh0KCkpIC4gJyk9IicgLiAkY29uZGl0aW9uYWwtPmdldFRleHQoKSAuICciJyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fQ09OVEFJTlNURVhUCiAgICAgICAgICAgICAgICAgICAgICAgICYmICRjb25kaXRpb25hbC0+Z2V0T3BlcmF0b3JUeXBlKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6Ok9QRVJBVE9SX0VORFNXSVRICiAgICAgICAgICAgICAgICAgICAgICAgICYmICFpc19udWxsKCRjb25kaXRpb25hbC0+Z2V0VGV4dCgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUVsZW1lbnQoJ2Zvcm11bGEnLCAnUklHSFQoJyAuICRjZWxsQ29vcmRpbmF0ZSAuICcsJyAuIHN0cmxlbigkY29uZGl0aW9uYWwtPmdldFRleHQoKSkgLiAnKT0iJyAuICRjb25kaXRpb25hbC0+Z2V0VGV4dCgpIC4gJyInKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGNvbmRpdGlvbmFsLT5nZXRDb25kaXRpb25UeXBlKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6OkNPTkRJVElPTl9DT05UQUlOU1RFWFQKICAgICAgICAgICAgICAgICAgICAgICAgJiYgJGNvbmRpdGlvbmFsLT5nZXRPcGVyYXRvclR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6T1BFUkFUT1JfTk9UQ09OVEFJTlMKICAgICAgICAgICAgICAgICAgICAgICAgJiYgIWlzX251bGwoJGNvbmRpdGlvbmFsLT5nZXRUZXh0KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgnZm9ybXVsYScsICdJU0VSUk9SKFNFQVJDSCgiJyAuICRjb25kaXRpb25hbC0+Z2V0VGV4dCgpIC4gJyIsJyAuICRjZWxsQ29vcmRpbmF0ZSAuICcpKScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvblR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0NFTExJUwogICAgICAgICAgICAgICAgICAgICAgICB8fCAkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvblR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0NPTlRBSU5TVEVYVAogICAgICAgICAgICAgICAgICAgICAgICB8fCAkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvblR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0VYUFJFU1NJT04pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGNvbmRpdGlvbmFsLT5nZXRDb25kaXRpb25zKCkgYXMgJGZvcm11bGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm11bGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgnZm9ybXVsYScsICRmb3JtdWxhKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwoKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBEYXRhVmFsaWRhdGlvbnMKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlRGF0YVZhbGlkYXRpb25zKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBEYXRhdmFsaWRhdGlvbiBjb2xsZWN0aW9uCiAgICAgICAgJGRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbiA9ICRwU2hlZXQtPmdldERhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbigpOwoKICAgICAgICAvLyBXcml0ZSBkYXRhIHZhbGlkYXRpb25zPwogICAgICAgIGlmICghZW1wdHkoJGRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbikpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdkYXRhVmFsaWRhdGlvbnMnKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2NvdW50JywgY291bnQoJGRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbikpOwoKICAgICAgICAgICAgZm9yZWFjaCAoJGRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbiBhcyAkY29vcmRpbmF0ZSA9PiAkZHYpIHsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnZGF0YVZhbGlkYXRpb24nKTsKCiAgICAgICAgICAgICAgICBpZiAoJGR2LT5nZXRUeXBlKCkgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndHlwZScsICRkdi0+Z2V0VHlwZSgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJGR2LT5nZXRFcnJvclN0eWxlKCkgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZXJyb3JTdHlsZScsICRkdi0+Z2V0RXJyb3JTdHlsZSgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJGR2LT5nZXRPcGVyYXRvcigpICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ29wZXJhdG9yJywgJGR2LT5nZXRPcGVyYXRvcigpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnYWxsb3dCbGFuaycsICgkZHYtPmdldEFsbG93QmxhbmsoKSA\/ICcxJyAgOiAnMCcpKTsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzaG93RHJvcERvd24nLCAoISRkdi0+Z2V0U2hvd0Ryb3BEb3duKCkgPyAnMScgIDogJzAnKSk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc2hvd0lucHV0TWVzc2FnZScsICgkZHYtPmdldFNob3dJbnB1dE1lc3NhZ2UoKSA\/ICcxJyAgOiAnMCcpKTsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzaG93RXJyb3JNZXNzYWdlJywgKCRkdi0+Z2V0U2hvd0Vycm9yTWVzc2FnZSgpID8gJzEnICA6ICcwJykpOwoKICAgICAgICAgICAgICAgIGlmICgkZHYtPmdldEVycm9yVGl0bGUoKSAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZXJyb3JUaXRsZScsICRkdi0+Z2V0RXJyb3JUaXRsZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkZHYtPmdldEVycm9yKCkgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2Vycm9yJywgJGR2LT5nZXRFcnJvcigpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkZHYtPmdldFByb21wdFRpdGxlKCkgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3Byb21wdFRpdGxlJywgJGR2LT5nZXRQcm9tcHRUaXRsZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkZHYtPmdldFByb21wdCgpICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdwcm9tcHQnLCAkZHYtPmdldFByb21wdCgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc3FyZWYnLCAkY29vcmRpbmF0ZSk7CgogICAgICAgICAgICAgICAgaWYgKCRkdi0+Z2V0Rm9ybXVsYTEoKSAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUVsZW1lbnQoJ2Zvcm11bGExJywgJGR2LT5nZXRGb3JtdWxhMSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkZHYtPmdldEZvcm11bGEyKCkgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCdmb3JtdWxhMicsICRkdi0+Z2V0Rm9ybXVsYTIoKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgSHlwZXJsaW5rcwogICAgICoKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyICAgICAgICAgICAgJG9ialdyaXRlciAgICAgICAgWE1MIFdyaXRlcgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAgICAgICAgICAgICAgICAgJHBTaGVldCAgICAgICAgICAgIFdvcmtzaGVldAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVIeXBlcmxpbmtzKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBIeXBlcmxpbmsgY29sbGVjdGlvbgogICAgICAgICRoeXBlcmxpbmtDb2xsZWN0aW9uID0gJHBTaGVldC0+Z2V0SHlwZXJsaW5rQ29sbGVjdGlvbigpOwoKICAgICAgICAvLyBSZWxhdGlvbiBJRAogICAgICAgICRyZWxhdGlvbklkID0gMTsKCiAgICAgICAgLy8gV3JpdGUgaHlwZXJsaW5rcz8KICAgICAgICBpZiAoIWVtcHR5KCRoeXBlcmxpbmtDb2xsZWN0aW9uKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2h5cGVybGlua3MnKTsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRoeXBlcmxpbmtDb2xsZWN0aW9uIGFzICRjb29yZGluYXRlID0+ICRoeXBlcmxpbmspIHsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnaHlwZXJsaW5rJyk7CgogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3JlZicsICRjb29yZGluYXRlKTsKICAgICAgICAgICAgICAgIGlmICghJGh5cGVybGluay0+aXNJbnRlcm5hbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3I6aWQnLCAncklkX2h5cGVybGlua18nIC4gJHJlbGF0aW9uSWQpOwogICAgICAgICAgICAgICAgICAgICsrJHJlbGF0aW9uSWQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdsb2NhdGlvbicsIHN0cl9yZXBsYWNlKCdzaGVldDovLycsICcnLCAkaHlwZXJsaW5rLT5nZXRVcmwoKSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkaHlwZXJsaW5rLT5nZXRUb29sdGlwKCkgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndG9vbHRpcCcsICRoeXBlcmxpbmstPmdldFRvb2x0aXAoKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgUHJvdGVjdGVkUmFuZ2VzCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgICAgICAgICAkb2JqV3JpdGVyICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICAgICAgICAgICAkcFNoZWV0ICAgICAgICAgICAgV29ya3NoZWV0CiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVByb3RlY3RlZFJhbmdlcyhQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyICRvYmpXcml0ZXIgPSBudWxsLCBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKGNvdW50KCRwU2hlZXQtPmdldFByb3RlY3RlZENlbGxzKCkpID4gMCkgewogICAgICAgICAgICAvLyBwcm90ZWN0ZWRSYW5nZXMKICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdwcm90ZWN0ZWRSYW5nZXMnKTsKCiAgICAgICAgICAgIC8vIExvb3AgcHJvdGVjdGVkUmFuZ2VzCiAgICAgICAgICAgIGZvcmVhY2ggKCRwU2hlZXQtPmdldFByb3RlY3RlZENlbGxzKCkgYXMgJHByb3RlY3RlZENlbGwgPT4gJHBhc3N3b3JkSGFzaCkgewogICAgICAgICAgICAgICAgLy8gcHJvdGVjdGVkUmFuZ2UKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgncHJvdGVjdGVkUmFuZ2UnKTsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCduYW1lJywgJ3AnIC4gbWQ1KCRwcm90ZWN0ZWRDZWxsKSk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc3FyZWYnLCAkcHJvdGVjdGVkQ2VsbCk7CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRwYXNzd29yZEhhc2gpKSB7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3Bhc3N3b3JkJywgJHBhc3N3b3JkSGFzaCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBNZXJnZUNlbGxzCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgICAgICAgICAkb2JqV3JpdGVyICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICAgICAgICAgICAkcFNoZWV0ICAgICAgICAgICAgV29ya3NoZWV0CiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZU1lcmdlQ2VsbHMoUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyID0gbnVsbCwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsKQogICAgewogICAgICAgIGlmIChjb3VudCgkcFNoZWV0LT5nZXRNZXJnZUNlbGxzKCkpID4gMCkgewogICAgICAgICAgICAvLyBtZXJnZUNlbGxzCiAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnbWVyZ2VDZWxscycpOwoKICAgICAgICAgICAgLy8gTG9vcCBtZXJnZUNlbGxzCiAgICAgICAgICAgIGZvcmVhY2ggKCRwU2hlZXQtPmdldE1lcmdlQ2VsbHMoKSBhcyAkbWVyZ2VDZWxsKSB7CiAgICAgICAgICAgICAgICAvLyBtZXJnZUNlbGwKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnbWVyZ2VDZWxsJyk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgncmVmJywgJG1lcmdlQ2VsbCk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBQcmludE9wdGlvbnMKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlUHJpbnRPcHRpb25zKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBwcmludE9wdGlvbnMKICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3ByaW50T3B0aW9ucycpOwoKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZ3JpZExpbmVzJywgKCRwU2hlZXQtPmdldFByaW50R3JpZGxpbmVzKCkgPyAndHJ1ZSc6ICdmYWxzZScpKTsKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZ3JpZExpbmVzU2V0JywgJ3RydWUnKTsKCiAgICAgICAgaWYgKCRwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRIb3Jpem9udGFsQ2VudGVyZWQoKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnaG9yaXpvbnRhbENlbnRlcmVkJywgJ3RydWUnKTsKICAgICAgICB9CgogICAgICAgIGlmICgkcFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0VmVydGljYWxDZW50ZXJlZCgpKSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd2ZXJ0aWNhbENlbnRlcmVkJywgJ3RydWUnKTsKICAgICAgICB9CgogICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIFBhZ2VNYXJnaW5zCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgICAgICAgICAgICAgJG9ialdyaXRlciAgICAgICAgWE1MIFdyaXRlcgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAgICAgICAgICAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlUGFnZU1hcmdpbnMoUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyID0gbnVsbCwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsKQogICAgewogICAgICAgIC8vIHBhZ2VNYXJnaW5zCiAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdwYWdlTWFyZ2lucycpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdsZWZ0JywgUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Rm9ybWF0TnVtYmVyKCRwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPmdldExlZnQoKSkpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdyaWdodCcsIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkcFNoZWV0LT5nZXRQYWdlTWFyZ2lucygpLT5nZXRSaWdodCgpKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3RvcCcsIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkcFNoZWV0LT5nZXRQYWdlTWFyZ2lucygpLT5nZXRUb3AoKSkpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdib3R0b20nLCBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpGb3JtYXROdW1iZXIoJHBTaGVldC0+Z2V0UGFnZU1hcmdpbnMoKS0+Z2V0Qm90dG9tKCkpKTsKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnaGVhZGVyJywgUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Rm9ybWF0TnVtYmVyKCRwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPmdldEhlYWRlcigpKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2Zvb3RlcicsIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkcFNoZWV0LT5nZXRQYWdlTWFyZ2lucygpLT5nZXRGb290ZXIoKSkpOwogICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIEF1dG9GaWx0ZXIKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgICAgICAgICAkb2JqV3JpdGVyICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICAgICAgICAgICAgICAgJHBTaGVldCAgICAgICAgICAgIFdvcmtzaGVldAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVBdXRvRmlsdGVyKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAkYXV0b0ZpbHRlclJhbmdlID0gJHBTaGVldC0+Z2V0QXV0b0ZpbHRlcigpLT5nZXRSYW5nZSgpOwogICAgICAgIGlmICghZW1wdHkoJGF1dG9GaWx0ZXJSYW5nZSkpIHsKICAgICAgICAgICAgLy8gYXV0b0ZpbHRlcgogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2F1dG9GaWx0ZXInKTsKCiAgICAgICAgICAgIC8vIFN0cmlwIGFueSB3b3Jrc2hlZXQgcmVmZXJlbmNlIGZyb20gdGhlIGZpbHRlciBjb29yZGluYXRlcwogICAgICAgICAgICAkcmFuZ2UgPSBQSFBFeGNlbF9DZWxsOjpzcGxpdFJhbmdlKCRhdXRvRmlsdGVyUmFuZ2UpOwogICAgICAgICAgICAkcmFuZ2UgPSAkcmFuZ2VbMF07CiAgICAgICAgICAgIC8vICAgIFN0cmlwIGFueSB3b3Jrc2hlZXQgcmVmCiAgICAgICAgICAgIGlmIChzdHJwb3MoJHJhbmdlWzBdLCAnIScpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgbGlzdCgkd3MsICRyYW5nZVswXSkgPSBleHBsb2RlKCchJywgJHJhbmdlWzBdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkcmFuZ2UgPSBpbXBsb2RlKCc6JywgJHJhbmdlKTsKCiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdyZWYnLCBzdHJfcmVwbGFjZSgnJCcsICcnLCAkcmFuZ2UpKTsKCiAgICAgICAgICAgICRjb2x1bW5zID0gJHBTaGVldC0+Z2V0QXV0b0ZpbHRlcigpLT5nZXRDb2x1bW5zKCk7CiAgICAgICAgICAgIGlmIChjb3VudCgkY29sdW1ucyA+IDApKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29sdW1ucyBhcyAkY29sdW1uSUQgPT4gJGNvbHVtbikgewogICAgICAgICAgICAgICAgICAgICRydWxlcyA9ICRjb2x1bW4tPmdldFJ1bGVzKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50KCRydWxlcykgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnZmlsdGVyQ29sdW1uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdjb2xJZCcsICRwU2hlZXQtPmdldEF1dG9GaWx0ZXIoKS0+Z2V0Q29sdW1uT2Zmc2V0KCRjb2x1bW5JRCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCRjb2x1bW4tPmdldEZpbHRlclR5cGUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkY29sdW1uLT5nZXRKb2luKCkgPT0gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0NPTFVNTl9KT0lOX0FORCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2FuZCcsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcnVsZXMgYXMgJHJ1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJGNvbHVtbi0+Z2V0RmlsdGVyVHlwZSgpID09PSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW46OkFVVE9GSUxURVJfRklMVEVSVFlQRV9GSUxURVIpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCRydWxlLT5nZXRPcGVyYXRvcigpID09PSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9FUVVBTCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJHJ1bGUtPmdldFZhbHVlKCkgPT09ICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIEZpbHRlciBydWxlIGZvciBCbGFua3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnYmxhbmsnLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcnVsZS0+Z2V0UnVsZVR5cGUoKSA9PT0gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ0ZJTFRFUikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIER5bmFtaWMgRmlsdGVyIFJ1bGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndHlwZScsICRydWxlLT5nZXRHcm91cGluZygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdmFsID0gJGNvbHVtbi0+Z2V0QXR0cmlidXRlKCd2YWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndmFsJywgJHZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtYXhWYWwgPSAkY29sdW1uLT5nZXRBdHRyaWJ1dGUoJ21heFZhbCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbWF4VmFsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdtYXhWYWwnLCAkbWF4VmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJ1bGUtPmdldFJ1bGVUeXBlKCkgPT09IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX1RPUFRFTkZJTFRFUikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIFRvcCAxMCBGaWx0ZXIgUnVsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd2YWwnLCAkcnVsZS0+Z2V0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3BlcmNlbnQnLCAoKCRydWxlLT5nZXRPcGVyYXRvcigpID09PSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9UT1BURU5fUEVSQ0VOVCkgPyAnMScgOiAnMCcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndG9wJywgKCgkcnVsZS0+Z2V0R3JvdXBpbmcoKSA9PT0gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfVE9QVEVOX1RPUCkgPyAnMSc6ICcwJykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBGaWx0ZXIsIERhdGVHcm91cEl0ZW0gb3IgQ3VzdG9tRmlsdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCRydWxlLT5nZXRSdWxlVHlwZSgpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRydWxlLT5nZXRPcGVyYXRvcigpICE9PSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9FUVVBTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnb3BlcmF0b3InLCAkcnVsZS0+Z2V0T3BlcmF0b3IoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcnVsZS0+Z2V0UnVsZVR5cGUoKSA9PT0gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERhdGUgR3JvdXAgZmlsdGVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcnVsZS0+Z2V0VmFsdWUoKSBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZSA+ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJGtleSwgJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZGF0ZVRpbWVHcm91cGluZycsICRydWxlLT5nZXRHcm91cGluZygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgndmFsJywgJHJ1bGUtPmdldFZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBQYWdlU2V0dXAKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlUGFnZVNldHVwKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBwYWdlU2V0dXAKICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3BhZ2VTZXR1cCcpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdwYXBlclNpemUnLCAkcFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0UGFwZXJTaXplKCkpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdvcmllbnRhdGlvbicsICRwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRPcmllbnRhdGlvbigpKTsKCiAgICAgICAgaWYgKCFpc19udWxsKCRwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRTY2FsZSgpKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnc2NhbGUnLCAkcFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0U2NhbGUoKSk7CiAgICAgICAgfQogICAgICAgIGlmICghaXNfbnVsbCgkcFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0Rml0VG9IZWlnaHQoKSkpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2ZpdFRvSGVpZ2h0JywgJHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPmdldEZpdFRvSGVpZ2h0KCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdmaXRUb0hlaWdodCcsICcwJyk7CiAgICAgICAgfQogICAgICAgIGlmICghaXNfbnVsbCgkcFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0Rml0VG9XaWR0aCgpKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZml0VG9XaWR0aCcsICRwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRGaXRUb1dpZHRoKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdmaXRUb1dpZHRoJywgJzAnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc19udWxsKCRwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRGaXJzdFBhZ2VOdW1iZXIoKSkpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2ZpcnN0UGFnZU51bWJlcicsICRwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRGaXJzdFBhZ2VOdW1iZXIoKSk7CiAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd1c2VGaXJzdFBhZ2VOdW1iZXInLCAnMScpOwogICAgICAgIH0KCiAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgSGVhZGVyIC8gRm9vdGVyCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgJHBTaGVldCAgICAgICAgICAgIFdvcmtzaGVldAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVIZWFkZXJGb290ZXIoUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyID0gbnVsbCwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsKQogICAgewogICAgICAgIC8vIGhlYWRlckZvb3RlcgogICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnaGVhZGVyRm9vdGVyJyk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2RpZmZlcmVudE9kZEV2ZW4nLCAoJHBTaGVldC0+Z2V0SGVhZGVyRm9vdGVyKCktPmdldERpZmZlcmVudE9kZEV2ZW4oKSA\/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnZGlmZmVyZW50Rmlyc3QnLCAoJHBTaGVldC0+Z2V0SGVhZGVyRm9vdGVyKCktPmdldERpZmZlcmVudEZpcnN0KCkgPyAndHJ1ZScgOiAnZmFsc2UnKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3NjYWxlV2l0aERvYycsICgkcFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+Z2V0U2NhbGVXaXRoRG9jdW1lbnQoKSA\/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnYWxpZ25XaXRoTWFyZ2lucycsICgkcFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+Z2V0QWxpZ25XaXRoTWFyZ2lucygpID8gJ3RydWUnIDogJ2ZhbHNlJykpOwoKICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUVsZW1lbnQoJ29kZEhlYWRlcicsICRwU2hlZXQtPmdldEhlYWRlckZvb3RlcigpLT5nZXRPZGRIZWFkZXIoKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCdvZGRGb290ZXInLCAkcFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+Z2V0T2RkRm9vdGVyKCkpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgnZXZlbkhlYWRlcicsICRwU2hlZXQtPmdldEhlYWRlckZvb3RlcigpLT5nZXRFdmVuSGVhZGVyKCkpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgnZXZlbkZvb3RlcicsICRwU2hlZXQtPmdldEhlYWRlckZvb3RlcigpLT5nZXRFdmVuRm9vdGVyKCkpOwogICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgnZmlyc3RIZWFkZXInLCAkcFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+Z2V0Rmlyc3RIZWFkZXIoKSk7CiAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCdmaXJzdEZvb3RlcicsICRwU2hlZXQtPmdldEhlYWRlckZvb3RlcigpLT5nZXRGaXJzdEZvb3RlcigpKTsKICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBCcmVha3MKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgJG9ialdyaXRlciAgICAgICAgWE1MIFdyaXRlcgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAgICAgICAgICAgICAkcFNoZWV0ICAgICAgICAgICAgV29ya3NoZWV0CiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZUJyZWFrcyhQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyICRvYmpXcml0ZXIgPSBudWxsLCBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCA9IG51bGwpCiAgICB7CiAgICAgICAgLy8gR2V0IHJvdyBhbmQgY29sdW1uIGJyZWFrcwogICAgICAgICRhUm93QnJlYWtzID0gYXJyYXkoKTsKICAgICAgICAkYUNvbHVtbkJyZWFrcyA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoJHBTaGVldC0+Z2V0QnJlYWtzKCkgYXMgJGNlbGwgPT4gJGJyZWFrVHlwZSkgewogICAgICAgICAgICBpZiAoJGJyZWFrVHlwZSA9PSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLX1JPVykgewogICAgICAgICAgICAgICAgJGFSb3dCcmVha3NbXSA9ICRjZWxsOwogICAgICAgICAgICB9IGVsc2VpZiAoJGJyZWFrVHlwZSA9PSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLX0NPTFVNTikgewogICAgICAgICAgICAgICAgJGFDb2x1bW5CcmVha3NbXSA9ICRjZWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyByb3dCcmVha3MKICAgICAgICBpZiAoIWVtcHR5KCRhUm93QnJlYWtzKSkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3Jvd0JyZWFrcycpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnY291bnQnLCBjb3VudCgkYVJvd0JyZWFrcykpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnbWFudWFsQnJlYWtDb3VudCcsIGNvdW50KCRhUm93QnJlYWtzKSk7CgogICAgICAgICAgICBmb3JlYWNoICgkYVJvd0JyZWFrcyBhcyAkY2VsbCkgewogICAgICAgICAgICAgICAgJGNvb3JkcyA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRjZWxsKTsKCiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2JyaycpOwogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2lkJywgJGNvb3Jkc1sxXSk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnbWFuJywgJzEnKTsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gU2Vjb25kLCB3cml0ZSBjb2x1bW4gYnJlYWtzCiAgICAgICAgaWYgKCFlbXB0eSgkYUNvbHVtbkJyZWFrcykpIHsKICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdjb2xCcmVha3MnKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2NvdW50JywgY291bnQoJGFDb2x1bW5CcmVha3MpKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ21hbnVhbEJyZWFrQ291bnQnLCBjb3VudCgkYUNvbHVtbkJyZWFrcykpOwoKICAgICAgICAgICAgZm9yZWFjaCAoJGFDb2x1bW5CcmVha3MgYXMgJGNlbGwpIHsKICAgICAgICAgICAgICAgICRjb29yZHMgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkY2VsbCk7CgogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+c3RhcnRFbGVtZW50KCdicmsnKTsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdpZCcsIFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkY29vcmRzWzBdKSAtIDEpOwogICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ21hbicsICcxJyk7CiAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBTaGVldERhdGEKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAgICAgICAgJG9ialdyaXRlciAgICAgICAgWE1MIFdyaXRlcgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAgICAgICAgICAgICAkcFNoZWV0ICAgICAgICAgICAgV29ya3NoZWV0CiAgICAgKiBAcGFyYW0gICAgc3RyaW5nW10gICAgICAgICAgICAgICAgICAgICAgICAkcFN0cmluZ1RhYmxlICAgIFN0cmluZyB0YWJsZQogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVTaGVldERhdGEoUEhQRXhjZWxfU2hhcmVkX1hNTFdyaXRlciAkb2JqV3JpdGVyID0gbnVsbCwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsLCAkcFN0cmluZ1RhYmxlID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAoaXNfYXJyYXkoJHBTdHJpbmdUYWJsZSkpIHsKICAgICAgICAgICAgLy8gRmxpcHBlZCBzdHJpbmd0YWJsZSwgZm9yIGZhc3RlciBpbmRleCBzZWFyY2hpbmcKICAgICAgICAgICAgJGFGbGlwcGVkU3RyaW5nVGFibGUgPSAkdGhpcy0+Z2V0UGFyZW50V3JpdGVyKCktPmdldFdyaXRlclBhcnQoJ3N0cmluZ3RhYmxlJyktPmZsaXBTdHJpbmdUYWJsZSgkcFN0cmluZ1RhYmxlKTsKCiAgICAgICAgICAgIC8vIHNoZWV0RGF0YQogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ3NoZWV0RGF0YScpOwoKICAgICAgICAgICAgLy8gR2V0IGNvbHVtbiBjb3VudAogICAgICAgICAgICAkY29sQ291bnQgPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJHBTaGVldC0+Z2V0SGlnaGVzdENvbHVtbigpKTsKCiAgICAgICAgICAgIC8vIEhpZ2hlc3Qgcm93IG51bWJlcgogICAgICAgICAgICAkaGlnaGVzdFJvdyA9ICRwU2hlZXQtPmdldEhpZ2hlc3RSb3coKTsKCiAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBjZWxscwogICAgICAgICAgICAkY2VsbHNCeVJvdyA9IGFycmF5KCk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRwU2hlZXQtPmdldENlbGxDb2xsZWN0aW9uKCkgYXMgJGNlbGxJRCkgewogICAgICAgICAgICAgICAgJGNlbGxBZGRyZXNzID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJGNlbGxJRCk7CiAgICAgICAgICAgICAgICAkY2VsbHNCeVJvd1skY2VsbEFkZHJlc3NbMV1dW10gPSAkY2VsbElEOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkY3VycmVudFJvdyA9IDA7CiAgICAgICAgICAgIHdoaWxlICgkY3VycmVudFJvdysrIDwgJGhpZ2hlc3RSb3cpIHsKICAgICAgICAgICAgICAgIC8vIEdldCByb3cgZGltZW5zaW9uCiAgICAgICAgICAgICAgICAkcm93RGltZW5zaW9uID0gJHBTaGVldC0+Z2V0Um93RGltZW5zaW9uKCRjdXJyZW50Um93KTsKCiAgICAgICAgICAgICAgICAvLyBXcml0ZSBjdXJyZW50IHJvdz8KICAgICAgICAgICAgICAgICR3cml0ZUN1cnJlbnRSb3cgPSBpc3NldCgkY2VsbHNCeVJvd1skY3VycmVudFJvd10pIHx8ICRyb3dEaW1lbnNpb24tPmdldFJvd0hlaWdodCgpID49IDAgfHwgJHJvd0RpbWVuc2lvbi0+Z2V0VmlzaWJsZSgpID09IGZhbHNlIHx8ICRyb3dEaW1lbnNpb24tPmdldENvbGxhcHNlZCgpID09IHRydWUgfHwgJHJvd0RpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCkgPiAwIHx8ICRyb3dEaW1lbnNpb24tPmdldFhmSW5kZXgoKSAhPT0gbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAoJHdyaXRlQ3VycmVudFJvdykgewogICAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IGEgbmV3IHJvdwogICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgncm93Jyk7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3InLCAkY3VycmVudFJvdyk7CiAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3NwYW5zJywgJzE6JyAuICRjb2xDb3VudCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFJvdyBkaW1lbnNpb25zCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3dEaW1lbnNpb24tPmdldFJvd0hlaWdodCgpID49IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2N1c3RvbUhlaWdodCcsICcxJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdodCcsIFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkcm93RGltZW5zaW9uLT5nZXRSb3dIZWlnaHQoKSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gUm93IHZpc2liaWxpdHkKICAgICAgICAgICAgICAgICAgICBpZiAoJHJvd0RpbWVuc2lvbi0+Z2V0VmlzaWJsZSgpID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdoaWRkZW4nLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gQ29sbGFwc2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3dEaW1lbnNpb24tPmdldENvbGxhcHNlZCgpID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2NvbGxhcHNlZCcsICd0cnVlJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBPdXRsaW5lIGxldmVsCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3dEaW1lbnNpb24tPmdldE91dGxpbmVMZXZlbCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnb3V0bGluZUxldmVsJywgJHJvd0RpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gU3R5bGUKICAgICAgICAgICAgICAgICAgICBpZiAoJHJvd0RpbWVuc2lvbi0+Z2V0WGZJbmRleCgpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzJywgJHJvd0RpbWVuc2lvbi0+Z2V0WGZJbmRleCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ2N1c3RvbUZvcm1hdCcsICcxJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBXcml0ZSBjZWxscwogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY2VsbHNCeVJvd1skY3VycmVudFJvd10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjZWxsc0J5Um93WyRjdXJyZW50Um93XSBhcyAkY2VsbEFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdyaXRlIGNlbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZUNlbGwoJG9ialdyaXRlciwgJHBTaGVldCwgJGNlbGxBZGRyZXNzLCAkcFN0cmluZ1RhYmxlLCAkYUZsaXBwZWRTdHJpbmdUYWJsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEVuZCByb3cKICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbigiSW52YWxpZCBwYXJhbWV0ZXJzIHBhc3NlZC4iKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBDZWxsCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgJG9ialdyaXRlciAgICAgICAgICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICAgJHBTaGVldCAgICAgICAgICAgICAgICAgICAgV29ya3NoZWV0CiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfQ2VsbCAgICAgICAgICAgICAgICAkcENlbGxBZGRyZXNzICAgICAgICAgICAgQ2VsbCBBZGRyZXNzCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nW10gICAgICAgICAgICAgICAgICAgICRwU3RyaW5nVGFibGUgICAgICAgICAgICBTdHJpbmcgdGFibGUKICAgICAqIEBwYXJhbSAgICBzdHJpbmdbXSAgICAgICAgICAgICAgICAgICAgJHBGbGlwcGVkU3RyaW5nVGFibGUgICAgU3RyaW5nIHRhYmxlIChmbGlwcGVkKSwgZm9yIGZhc3RlciBpbmRleCBzZWFyY2hpbmcKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlQ2VsbChQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyICRvYmpXcml0ZXIgPSBudWxsLCBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCA9IG51bGwsICRwQ2VsbEFkZHJlc3MgPSBudWxsLCAkcFN0cmluZ1RhYmxlID0gbnVsbCwgJHBGbGlwcGVkU3RyaW5nVGFibGUgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkcFN0cmluZ1RhYmxlKSAmJiBpc19hcnJheSgkcEZsaXBwZWRTdHJpbmdUYWJsZSkpIHsKICAgICAgICAgICAgLy8gQ2VsbAogICAgICAgICAgICAkcENlbGwgPSAkcFNoZWV0LT5nZXRDZWxsKCRwQ2VsbEFkZHJlc3MpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2MnKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3InLCAkcENlbGxBZGRyZXNzKTsKCiAgICAgICAgICAgIC8vIFNoZWV0IHN0eWxlcwogICAgICAgICAgICBpZiAoJHBDZWxsLT5nZXRYZkluZGV4KCkgIT0gJycpIHsKICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdzJywgJHBDZWxsLT5nZXRYZkluZGV4KCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiBjZWxsIHZhbHVlIGlzIHN1cHBsaWVkLCB3cml0ZSBjZWxsIHZhbHVlCiAgICAgICAgICAgICRjZWxsVmFsdWUgPSAkcENlbGwtPmdldFZhbHVlKCk7CiAgICAgICAgICAgIGlmIChpc19vYmplY3QoJGNlbGxWYWx1ZSkgfHwgJGNlbGxWYWx1ZSAhPT0gJycpIHsKICAgICAgICAgICAgICAgIC8vIE1hcCB0eXBlCiAgICAgICAgICAgICAgICAkbWFwcGVkVHlwZSA9ICRwQ2VsbC0+Z2V0RGF0YVR5cGUoKTsKCiAgICAgICAgICAgICAgICAvLyBXcml0ZSBkYXRhIHR5cGUgZGVwZW5kaW5nIG9uIGl0cyB0eXBlCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJG1hcHBlZFR5cGUpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW5saW5lc3RyJzogICAgLy8gSW5saW5lIHN0cmluZwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3MnOiAgICAgICAgICAgIC8vIFN0cmluZwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2InOiAgICAgICAgICAgIC8vIEJvb2xlYW4KICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3QnLCAkbWFwcGVkVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2YnOiAgICAgICAgICAgIC8vIEZvcm11bGEKICAgICAgICAgICAgICAgICAgICAgICAgJGNhbGN1bGF0ZWRWYWx1ZSA9ICgkdGhpcy0+Z2V0UGFyZW50V3JpdGVyKCktPmdldFByZUNhbGN1bGF0ZUZvcm11bGFzKCkpID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwQ2VsbC0+Z2V0Q2FsY3VsYXRlZFZhbHVlKCkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzX3N0cmluZygkY2FsY3VsYXRlZFZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3QnLCAnc3RyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZSc6ICAgICAgICAgICAgLy8gRXJyb3IKICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3QnLCAkbWFwcGVkVHlwZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gV3JpdGUgZGF0YSBkZXBlbmRpbmcgb24gaXRzIHR5cGUKICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkbWFwcGVkVHlwZSkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdpbmxpbmVzdHInOiAgICAvLyBJbmxpbmUgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghICRjZWxsVmFsdWUgaW5zdGFuY2VvZiBQSFBFeGNlbF9SaWNoVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCd0JywgUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q29udHJvbENoYXJhY3RlclBIUDJPT1hNTChodG1sc3BlY2lhbGNoYXJzKCRjZWxsVmFsdWUpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkY2VsbFZhbHVlIGluc3RhbmNlb2YgUEhQRXhjZWxfUmljaFRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnaXMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5nZXRQYXJlbnRXcml0ZXIoKS0+Z2V0V3JpdGVyUGFydCgnc3RyaW5ndGFibGUnKS0+d3JpdGVSaWNoVGV4dCgkb2JqV3JpdGVyLCAkY2VsbFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAncyc6ICAgICAgICAgICAgLy8gU3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghICRjZWxsVmFsdWUgaW5zdGFuY2VvZiBQSFBFeGNlbF9SaWNoVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRwRmxpcHBlZFN0cmluZ1RhYmxlWyRjZWxsVmFsdWVdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgndicsICRwRmxpcHBlZFN0cmluZ1RhYmxlWyRjZWxsVmFsdWVdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRjZWxsVmFsdWUgaW5zdGFuY2VvZiBQSFBFeGNlbF9SaWNoVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCd2JywgJHBGbGlwcGVkU3RyaW5nVGFibGVbJGNlbGxWYWx1ZS0+Z2V0SGFzaENvZGUoKV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdmJzogICAgICAgICAgICAvLyBGb3JtdWxhCiAgICAgICAgICAgICAgICAgICAgICAgICRhdHRyaWJ1dGVzID0gJHBDZWxsLT5nZXRGb3JtdWxhQXR0cmlidXRlcygpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGF0dHJpYnV0ZXNbJ3QnXSA9PSAnYXJyYXknKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2YnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCd0JywgJ2FycmF5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgncmVmJywgJHBDZWxsQWRkcmVzcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgnYWNhJywgJzEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlQXR0cmlidXRlKCdjYScsICcxJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT50ZXh0KHN1YnN0cigkY2VsbFZhbHVlLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT5lbmRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUVsZW1lbnQoJ2YnLCBzdWJzdHIoJGNlbGxWYWx1ZSwgMSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+Z2V0UGFyZW50V3JpdGVyKCktPmdldE9mZmljZTIwMDNDb21wYXRpYmlsaXR5KCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmdldFBhcmVudFdyaXRlcigpLT5nZXRQcmVDYWxjdWxhdGVGb3JtdWxhcygpKSB7Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2FsY3VsYXRlZFZhbHVlID0gJHBDZWxsLT5nZXRDYWxjdWxhdGVkVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX2FycmF5KCRjYWxjdWxhdGVkVmFsdWUpICYmIHN1YnN0cigkY2FsY3VsYXRlZFZhbHVlLCAwLCAxKSAhPSAnIycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCd2JywgUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Rm9ybWF0TnVtYmVyKCRjYWxjdWxhdGVkVmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUVsZW1lbnQoJ3YnLCAnMCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCd2JywgJzAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICduJzogICAgICAgICAgICAvLyBOdW1lcmljCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvcmNlIHBvaW50IGFzIGRlY2ltYWwgc2VwYXJhdG9yIGluIGNhc2UgY3VycmVudCBsb2NhbGUgdXNlcyBjb21tYQogICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUVsZW1lbnQoJ3YnLCBzdHJfcmVwbGFjZSgnLCcsICcuJywgJGNlbGxWYWx1ZSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdiJzogICAgICAgICAgICAvLyBCb29sZWFuCiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgndicsICgkY2VsbFZhbHVlID8gJzEnIDogJzAnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2UnOiAgICAgICAgICAgIC8vIEVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGNlbGxWYWx1ZSwgMCwgMSkgPT0gJz0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUVsZW1lbnQoJ2YnLCBzdWJzdHIoJGNlbGxWYWx1ZSwgMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVFbGVtZW50KCd2Jywgc3Vic3RyKCRjZWxsVmFsdWUsIDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpXcml0ZXItPndyaXRlRWxlbWVudCgndicsICRjZWxsVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCJJbnZhbGlkIHBhcmFtZXRlcnMgcGFzc2VkLiIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIERyYXdpbmdzCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgJG9ialdyaXRlciAgICAgICAgWE1MIFdyaXRlcgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEBwYXJhbSAgICBib29sZWFuICAgICAgICAgICAgICAgICAgICAgICAgJGluY2x1ZGVDaGFydHMgICAgRmxhZyBpbmRpY2F0aW5nIGlmIHdlIHNob3VsZCBpbmNsdWRlIGRyYXdpbmcgZGV0YWlscyBmb3IgY2hhcnRzCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZURyYXdpbmdzKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCwgJGluY2x1ZGVDaGFydHMgPSBmYWxzZSkKICAgIHsKICAgICAgICAkY2hhcnRDb3VudCA9ICgkaW5jbHVkZUNoYXJ0cykgPyAkcFNoZWV0LT5nZXRDaGFydENvbGxlY3Rpb24oKS0+Y291bnQoKSA6IDA7CiAgICAgICAgLy8gSWYgc2hlZXQgY29udGFpbnMgZHJhd2luZ3MsIGFkZCB0aGUgcmVsYXRpb25zaGlwcwogICAgICAgIGlmICgoJHBTaGVldC0+Z2V0RHJhd2luZ0NvbGxlY3Rpb24oKS0+Y291bnQoKSA+IDApIHx8CiAgICAgICAgICAgICgkY2hhcnRDb3VudCA+IDApKSB7CiAgICAgICAgICAgICRvYmpXcml0ZXItPnN0YXJ0RWxlbWVudCgnZHJhd2luZycpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgncjppZCcsICdySWQxJyk7CiAgICAgICAgICAgICRvYmpXcml0ZXItPmVuZEVsZW1lbnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBMZWdhY3lEcmF3aW5nCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgICAgICAgICRvYmpXcml0ZXIgICAgICAgIFhNTCBXcml0ZXIKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgICAgICAgICAgICAgJHBTaGVldCAgICAgICAgICAgIFdvcmtzaGVldAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVMZWdhY3lEcmF3aW5nKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBJZiBzaGVldCBjb250YWlucyBjb21tZW50cywgYWRkIHRoZSByZWxhdGlvbnNoaXBzCiAgICAgICAgaWYgKGNvdW50KCRwU2hlZXQtPmdldENvbW1lbnRzKCkpID4gMCkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2xlZ2FjeURyYXdpbmcnKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+d3JpdGVBdHRyaWJ1dGUoJ3I6aWQnLCAncklkX2NvbW1lbnRzX3ZtbDEnKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIExlZ2FjeURyYXdpbmdIRgogICAgICoKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9TaGFyZWRfWE1MV3JpdGVyICAgICAgICAkb2JqV3JpdGVyICAgICAgICBYTUwgV3JpdGVyCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICAgICAgICAgICAgICRwU2hlZXQgICAgICAgICAgICBXb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlTGVnYWN5RHJhd2luZ0hGKFBIUEV4Y2VsX1NoYXJlZF9YTUxXcml0ZXIgJG9ialdyaXRlciA9IG51bGwsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBJZiBzaGVldCBjb250YWlucyBpbWFnZXMsIGFkZCB0aGUgcmVsYXRpb25zaGlwcwogICAgICAgIGlmIChjb3VudCgkcFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+Z2V0SW1hZ2VzKCkpID4gMCkgewogICAgICAgICAgICAkb2JqV3JpdGVyLT5zdGFydEVsZW1lbnQoJ2xlZ2FjeURyYXdpbmdIRicpOwogICAgICAgICAgICAkb2JqV3JpdGVyLT53cml0ZUF0dHJpYnV0ZSgncjppZCcsICdySWRfaGVhZGVyZm9vdGVyX3ZtbDEnKTsKICAgICAgICAgICAgJG9ialdyaXRlci0+ZW5kRWxlbWVudCgpOwogICAgICAgIH0KICAgIH0KfQo=",
    "size": "55244"
}