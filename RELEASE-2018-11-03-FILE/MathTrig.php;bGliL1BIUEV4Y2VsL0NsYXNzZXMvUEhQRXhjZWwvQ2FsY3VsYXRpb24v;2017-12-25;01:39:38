{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Calculation\/MathTrig.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KICAgIGRlZmluZSgnUEhQRVhDRUxfUk9PVCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8uLi8uLi8nKTsKICAgIHJlcXVpcmUoUEhQRVhDRUxfUk9PVCAuICdQSFBFeGNlbC9BdXRvbG9hZGVyLnBocCcpOwp9CgovKioKICogUEhQRXhjZWxfQ2FsY3VsYXRpb25fTWF0aFRyaWcKICoKICogQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbAogKgogKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCiAqIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQQogKgogKiBAY2F0ZWdvcnkgICAgUEhQRXhjZWwKICogQHBhY2thZ2UgICAgICAgIFBIUEV4Y2VsX0NhbGN1bGF0aW9uCiAqIEBjb3B5cmlnaHQgICAgQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbCAoaHR0cDovL3d3dy5jb2RlcGxleC5jb20vUEhQRXhjZWwpCiAqIEBsaWNlbnNlICAgICAgICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvb2xkLWxpY2Vuc2VzL2xncGwtMi4xLnR4dCAgICBMR1BMCiAqIEB2ZXJzaW9uICAgICAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCmNsYXNzIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX01hdGhUcmlnCnsKICAgIC8vCiAgICAvLyAgICBQcml2YXRlIG1ldGhvZCB0byByZXR1cm4gYW4gYXJyYXkgb2YgdGhlIGZhY3RvcnMgb2YgdGhlIGlucHV0IHZhbHVlCiAgICAvLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gZmFjdG9ycygkdmFsdWUpCiAgICB7CiAgICAgICAgJHN0YXJ0VmFsID0gZmxvb3Ioc3FydCgkdmFsdWUpKTsKCiAgICAgICAgJGZhY3RvckFycmF5ID0gYXJyYXkoKTsKICAgICAgICBmb3IgKCRpID0gJHN0YXJ0VmFsOyAkaSA+IDE7IC0tJGkpIHsKICAgICAgICAgICAgaWYgKCgkdmFsdWUgJSAkaSkgPT0gMCkgewogICAgICAgICAgICAgICAgJGZhY3RvckFycmF5ID0gYXJyYXlfbWVyZ2UoJGZhY3RvckFycmF5LCBzZWxmOjpmYWN0b3JzKCR2YWx1ZSAvICRpKSk7CiAgICAgICAgICAgICAgICAkZmFjdG9yQXJyYXkgPSBhcnJheV9tZXJnZSgkZmFjdG9yQXJyYXksIHNlbGY6OmZhY3RvcnMoJGkpKTsKICAgICAgICAgICAgICAgIGlmICgkaSA8PSBzcXJ0KCR2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWVtcHR5KCRmYWN0b3JBcnJheSkpIHsKICAgICAgICAgICAgcnNvcnQoJGZhY3RvckFycmF5KTsKICAgICAgICAgICAgcmV0dXJuICRmYWN0b3JBcnJheTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYXJyYXkoKGludGVnZXIpICR2YWx1ZSk7CiAgICAgICAgfQogICAgfQoKCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiByb21hbkN1dCgkbnVtLCAkbikKICAgIHsKICAgICAgICByZXR1cm4gKCRudW0gLSAoJG51bSAlICRuICkgKSAvICRuOwogICAgfQoKCiAgICAvKioKICAgICAqIEFUQU4yCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIHRoZSBhcmMgdGFuZ2VudCBvZiB0aGUgdHdvIHZhcmlhYmxlcyB4IGFuZCB5LiBJdCBpcyBzaW1pbGFyIHRvCiAgICAgKiAgICAgICAgY2FsY3VsYXRpbmcgdGhlIGFyYyB0YW5nZW50IG9mIHkgw7cgeCwgZXhjZXB0IHRoYXQgdGhlIHNpZ25zIG9mIGJvdGggYXJndW1lbnRzIGFyZSB1c2VkCiAgICAgKiAgICAgICAgdG8gZGV0ZXJtaW5lIHRoZSBxdWFkcmFudCBvZiB0aGUgcmVzdWx0LgogICAgICogVGhlIGFyY3RhbmdlbnQgaXMgdGhlIGFuZ2xlIGZyb20gdGhlIHgtYXhpcyB0byBhIGxpbmUgY29udGFpbmluZyB0aGUgb3JpZ2luICgwLCAwKSBhbmQgYQogICAgICogICAgICAgIHBvaW50IHdpdGggY29vcmRpbmF0ZXMgKHhDb29yZGluYXRlLCB5Q29vcmRpbmF0ZSkuIFRoZSBhbmdsZSBpcyBnaXZlbiBpbiByYWRpYW5zIGJldHdlZW4KICAgICAqICAgICAgICAtcGkgYW5kIHBpLCBleGNsdWRpbmcgLXBpLgogICAgICoKICAgICAqIE5vdGUgdGhhdCB0aGUgRXhjZWwgQVRBTjIoKSBmdW5jdGlvbiBhY2NlcHRzIGl0cyBhcmd1bWVudHMgaW4gdGhlIHJldmVyc2Ugb3JkZXIgdG8gdGhlIHN0YW5kYXJkCiAgICAgKiAgICAgICAgUEhQIGF0YW4yKCkgZnVuY3Rpb24sIHNvIHdlIG5lZWQgdG8gcmV2ZXJzZSB0aGVtIGhlcmUgYmVmb3JlIGNhbGxpbmcgdGhlIFBIUCBhdGFuKCkgZnVuY3Rpb24uCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgQVRBTjIoeENvb3JkaW5hdGUseUNvb3JkaW5hdGUpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBNYXRoZW1hdGljYWwgYW5kIFRyaWdvbm9tZXRyaWMgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgJHhDb29yZGluYXRlICAgICAgICBUaGUgeC1jb29yZGluYXRlIG9mIHRoZSBwb2ludC4KICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAkeUNvb3JkaW5hdGUgICAgICAgIFRoZSB5LWNvb3JkaW5hdGUgb2YgdGhlIHBvaW50LgogICAgICogQHJldHVybiAgICBmbG9hdCAgICBUaGUgaW52ZXJzZSB0YW5nZW50IG9mIHRoZSBzcGVjaWZpZWQgeC0gYW5kIHktY29vcmRpbmF0ZXMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gQVRBTjIoJHhDb29yZGluYXRlID0gbnVsbCwgJHlDb29yZGluYXRlID0gbnVsbCkKICAgIHsKICAgICAgICAkeENvb3JkaW5hdGUgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkeENvb3JkaW5hdGUpOwogICAgICAgICR5Q29vcmRpbmF0ZSA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCR5Q29vcmRpbmF0ZSk7CgogICAgICAgICR4Q29vcmRpbmF0ZSA9ICgkeENvb3JkaW5hdGUgIT09IG51bGwpID8gJHhDb29yZGluYXRlIDogMC4wOwogICAgICAgICR5Q29vcmRpbmF0ZSA9ICgkeUNvb3JkaW5hdGUgIT09IG51bGwpID8gJHlDb29yZGluYXRlIDogMC4wOwoKICAgICAgICBpZiAoKChpc19udW1lcmljKCR4Q29vcmRpbmF0ZSkpIHx8IChpc19ib29sKCR4Q29vcmRpbmF0ZSkpKSAmJgogICAgICAgICAgICAoKGlzX251bWVyaWMoJHlDb29yZGluYXRlKSkpICB8fCAoaXNfYm9vbCgkeUNvb3JkaW5hdGUpKSkgewogICAgICAgICAgICAkeENvb3JkaW5hdGUgICAgPSAoZmxvYXQpICR4Q29vcmRpbmF0ZTsKICAgICAgICAgICAgJHlDb29yZGluYXRlICAgID0gKGZsb2F0KSAkeUNvb3JkaW5hdGU7CgogICAgICAgICAgICBpZiAoKCR4Q29vcmRpbmF0ZSA9PSAwKSAmJiAoJHlDb29yZGluYXRlID09IDApKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpESVYwKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBhdGFuMigkeUNvb3JkaW5hdGUsICR4Q29vcmRpbmF0ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogQ0VJTElORwogICAgICoKICAgICAqIFJldHVybnMgbnVtYmVyIHJvdW5kZWQgdXAsIGF3YXkgZnJvbSB6ZXJvLCB0byB0aGUgbmVhcmVzdCBtdWx0aXBsZSBvZiBzaWduaWZpY2FuY2UuCiAgICAgKiAgICAgICAgRm9yIGV4YW1wbGUsIGlmIHlvdSB3YW50IHRvIGF2b2lkIHVzaW5nIHBlbm5pZXMgaW4geW91ciBwcmljZXMgYW5kIHlvdXIgcHJvZHVjdCBpcwogICAgICogICAgICAgIHByaWNlZCBhdCAkNC40MiwgdXNlIHRoZSBmb3JtdWxhID1DRUlMSU5HKDQuNDIsMC4wNSkgdG8gcm91bmQgcHJpY2VzIHVwIHRvIHRoZQogICAgICogICAgICAgIG5lYXJlc3Qgbmlja2VsLgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIENFSUxJTkcobnVtYmVyWyxzaWduaWZpY2FuY2VdKQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgTWF0aGVtYXRpY2FsIGFuZCBUcmlnb25vbWV0cmljIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIGZsb2F0ICAgICRudW1iZXIgICAgICAgICAgICBUaGUgbnVtYmVyIHlvdSB3YW50IHRvIHJvdW5kLgogICAgICogQHBhcmFtICAgIGZsb2F0ICAgICRzaWduaWZpY2FuY2UgICAgVGhlIG11bHRpcGxlIHRvIHdoaWNoIHlvdSB3YW50IHRvIHJvdW5kLgogICAgICogQHJldHVybiAgICBmbG9hdCAgICBSb3VuZGVkIE51bWJlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIENFSUxJTkcoJG51bWJlciwgJHNpZ25pZmljYW5jZSA9IG51bGwpCiAgICB7CiAgICAgICAgJG51bWJlciAgICAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRudW1iZXIpOwogICAgICAgICRzaWduaWZpY2FuY2UgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkc2lnbmlmaWNhbmNlKTsKCiAgICAgICAgaWYgKChpc19udWxsKCRzaWduaWZpY2FuY2UpKSAmJgogICAgICAgICAgICAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRDb21wYXRpYmlsaXR5TW9kZSgpID09IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Q09NUEFUSUJJTElUWV9HTlVNRVJJQykpIHsKICAgICAgICAgICAgJHNpZ25pZmljYW5jZSA9ICRudW1iZXIgLyBhYnMoJG51bWJlcik7CiAgICAgICAgfQoKICAgICAgICBpZiAoKGlzX251bWVyaWMoJG51bWJlcikpICYmIChpc19udW1lcmljKCRzaWduaWZpY2FuY2UpKSkgewogICAgICAgICAgICBpZiAoKCRudW1iZXIgPT0gMC4wICkgfHwgKCRzaWduaWZpY2FuY2UgPT0gMC4wKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDAuMDsKICAgICAgICAgICAgfSBlbHNlaWYgKHNlbGY6OlNJR04oJG51bWJlcikgPT0gc2VsZjo6U0lHTigkc2lnbmlmaWNhbmNlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNlaWwoJG51bWJlciAvICRzaWduaWZpY2FuY2UpICogJHNpZ25pZmljYW5jZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogQ09NQklOCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGNvbWJpbmF0aW9ucyBmb3IgYSBnaXZlbiBudW1iZXIgb2YgaXRlbXMuIFVzZSBDT01CSU4gdG8KICAgICAqICAgICAgICBkZXRlcm1pbmUgdGhlIHRvdGFsIHBvc3NpYmxlIG51bWJlciBvZiBncm91cHMgZm9yIGEgZ2l2ZW4gbnVtYmVyIG9mIGl0ZW1zLgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIENPTUJJTihudW1PYmpzLG51bUluU2V0KQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgTWF0aGVtYXRpY2FsIGFuZCBUcmlnb25vbWV0cmljIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIGludCAgICAgICAgJG51bU9ianMgICAgTnVtYmVyIG9mIGRpZmZlcmVudCBvYmplY3RzCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkbnVtSW5TZXQgICAgTnVtYmVyIG9mIG9iamVjdHMgaW4gZWFjaCBjb21iaW5hdGlvbgogICAgICogQHJldHVybiAgICBpbnQgICAgICAgIE51bWJlciBvZiBjb21iaW5hdGlvbnMKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBDT01CSU4oJG51bU9ianMsICRudW1JblNldCkKICAgIHsKICAgICAgICAkbnVtT2JqcyAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRudW1PYmpzKTsKICAgICAgICAkbnVtSW5TZXQgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbnVtSW5TZXQpOwoKICAgICAgICBpZiAoKGlzX251bWVyaWMoJG51bU9ianMpKSAmJiAoaXNfbnVtZXJpYygkbnVtSW5TZXQpKSkgewogICAgICAgICAgICBpZiAoJG51bU9ianMgPCAkbnVtSW5TZXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICB9IGVsc2VpZiAoJG51bUluU2V0IDwgMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJvdW5kKHNlbGY6OkZBQ1QoJG51bU9ianMpIC8gc2VsZjo6RkFDVCgkbnVtT2JqcyAtICRudW1JblNldCkpIC8gc2VsZjo6RkFDVCgkbnVtSW5TZXQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgfQoKCiAgICAvKioKICAgICAqIEVWRU4KICAgICAqCiAgICAgKiBSZXR1cm5zIG51bWJlciByb3VuZGVkIHVwIHRvIHRoZSBuZWFyZXN0IGV2ZW4gaW50ZWdlci4KICAgICAqIFlvdSBjYW4gdXNlIHRoaXMgZnVuY3Rpb24gZm9yIHByb2Nlc3NpbmcgaXRlbXMgdGhhdCBjb21lIGluIHR3b3MuIEZvciBleGFtcGxlLAogICAgICogICAgICAgIGEgcGFja2luZyBjcmF0ZSBhY2NlcHRzIHJvd3Mgb2Ygb25lIG9yIHR3byBpdGVtcy4gVGhlIGNyYXRlIGlzIGZ1bGwgd2hlbgogICAgICogICAgICAgIHRoZSBudW1iZXIgb2YgaXRlbXMsIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgdHdvLCBtYXRjaGVzIHRoZSBjcmF0ZSdzCiAgICAgKiAgICAgICAgY2FwYWNpdHkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgRVZFTihudW1iZXIpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBNYXRoZW1hdGljYWwgYW5kIFRyaWdvbm9tZXRyaWMgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgJG51bWJlciAgICAgICAgICAgIE51bWJlciB0byByb3VuZAogICAgICogQHJldHVybiAgICBpbnQgICAgICAgIFJvdW5kZWQgTnVtYmVyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gRVZFTigkbnVtYmVyKQogICAgewogICAgICAgICRudW1iZXIgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbnVtYmVyKTsKCiAgICAgICAgaWYgKGlzX251bGwoJG51bWJlcikpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSBlbHNlaWYgKGlzX2Jvb2woJG51bWJlcikpIHsKICAgICAgICAgICAgJG51bWJlciA9IChpbnQpICRudW1iZXI7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNfbnVtZXJpYygkbnVtYmVyKSkgewogICAgICAgICAgICAkc2lnbmlmaWNhbmNlID0gMiAqIHNlbGY6OlNJR04oJG51bWJlcik7CiAgICAgICAgICAgIHJldHVybiAoaW50KSBzZWxmOjpDRUlMSU5HKCRudW1iZXIsICRzaWduaWZpY2FuY2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgfQoKCiAgICAvKioKICAgICAqIEZBQ1QKICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBmYWN0b3JpYWwgb2YgYSBudW1iZXIuCiAgICAgKiBUaGUgZmFjdG9yaWFsIG9mIGEgbnVtYmVyIGlzIGVxdWFsIHRvIDEqMiozKi4uLiogbnVtYmVyLgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIEZBQ1QoZmFjdFZhbCkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAkZmFjdFZhbCAgICBGYWN0b3JpYWwgVmFsdWUKICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBGYWN0b3JpYWwKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBGQUNUKCRmYWN0VmFsKQogICAgewogICAgICAgICRmYWN0VmFsICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGZhY3RWYWwpOwoKICAgICAgICBpZiAoaXNfbnVtZXJpYygkZmFjdFZhbCkpIHsKICAgICAgICAgICAgaWYgKCRmYWN0VmFsIDwgMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGZhY3RMb29wID0gZmxvb3IoJGZhY3RWYWwpOwogICAgICAgICAgICBpZiAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRDb21wYXRpYmlsaXR5TW9kZSgpID09IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Q09NUEFUSUJJTElUWV9HTlVNRVJJQykgewogICAgICAgICAgICAgICAgaWYgKCRmYWN0VmFsID4gJGZhY3RMb29wKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRmYWN0b3JpYWwgPSAxOwogICAgICAgICAgICB3aGlsZSAoJGZhY3RMb29wID4gMSkgewogICAgICAgICAgICAgICAgJGZhY3RvcmlhbCAqPSAkZmFjdExvb3AtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJGZhY3RvcmlhbCA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogRkFDVERPVUJMRQogICAgICoKICAgICAqIFJldHVybnMgdGhlIGRvdWJsZSBmYWN0b3JpYWwgb2YgYSBudW1iZXIuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgRkFDVERPVUJMRShmYWN0VmFsKQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgTWF0aGVtYXRpY2FsIGFuZCBUcmlnb25vbWV0cmljIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIGZsb2F0ICAgICRmYWN0VmFsICAgIEZhY3RvcmlhbCBWYWx1ZQogICAgICogQHJldHVybiAgICBpbnQgICAgICAgIERvdWJsZSBGYWN0b3JpYWwKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBGQUNURE9VQkxFKCRmYWN0VmFsKQogICAgewogICAgICAgICRmYWN0TG9vcCAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRmYWN0VmFsKTsKCiAgICAgICAgaWYgKGlzX251bWVyaWMoJGZhY3RMb29wKSkgewogICAgICAgICAgICAkZmFjdExvb3AgICAgPSBmbG9vcigkZmFjdExvb3ApOwogICAgICAgICAgICBpZiAoJGZhY3RWYWwgPCAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkZmFjdG9yaWFsID0gMTsKICAgICAgICAgICAgd2hpbGUgKCRmYWN0TG9vcCA+IDEpIHsKICAgICAgICAgICAgICAgICRmYWN0b3JpYWwgKj0gJGZhY3RMb29wLS07CiAgICAgICAgICAgICAgICAtLSRmYWN0TG9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJGZhY3RvcmlhbCA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogRkxPT1IKICAgICAqCiAgICAgKiBSb3VuZHMgbnVtYmVyIGRvd24sIHRvd2FyZCB6ZXJvLCB0byB0aGUgbmVhcmVzdCBtdWx0aXBsZSBvZiBzaWduaWZpY2FuY2UuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgRkxPT1IobnVtYmVyWyxzaWduaWZpY2FuY2VdKQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgTWF0aGVtYXRpY2FsIGFuZCBUcmlnb25vbWV0cmljIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIGZsb2F0ICAgICRudW1iZXIgICAgICAgICAgICBOdW1iZXIgdG8gcm91bmQKICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAkc2lnbmlmaWNhbmNlICAgIFNpZ25pZmljYW5jZQogICAgICogQHJldHVybiAgICBmbG9hdCAgICBSb3VuZGVkIE51bWJlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIEZMT09SKCRudW1iZXIsICRzaWduaWZpY2FuY2UgPSBudWxsKQogICAgewogICAgICAgICRudW1iZXIgICAgICAgICAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRudW1iZXIpOwogICAgICAgICRzaWduaWZpY2FuY2UgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkc2lnbmlmaWNhbmNlKTsKCiAgICAgICAgaWYgKChpc19udWxsKCRzaWduaWZpY2FuY2UpKSAmJgogICAgICAgICAgICAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRDb21wYXRpYmlsaXR5TW9kZSgpID09IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Q09NUEFUSUJJTElUWV9HTlVNRVJJQykpIHsKICAgICAgICAgICAgJHNpZ25pZmljYW5jZSA9ICRudW1iZXIvYWJzKCRudW1iZXIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKChpc19udW1lcmljKCRudW1iZXIpKSAmJiAoaXNfbnVtZXJpYygkc2lnbmlmaWNhbmNlKSkpIHsKICAgICAgICAgICAgaWYgKCRzaWduaWZpY2FuY2UgPT0gMC4wKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpESVYwKCk7CiAgICAgICAgICAgIH0gZWxzZWlmICgkbnVtYmVyID09IDAuMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDAuMDsKICAgICAgICAgICAgfSBlbHNlaWYgKHNlbGY6OlNJR04oJG51bWJlcikgPT0gc2VsZjo6U0lHTigkc2lnbmlmaWNhbmNlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZsb29yKCRudW1iZXIgLyAkc2lnbmlmaWNhbmNlKSAqICRzaWduaWZpY2FuY2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBHQ0QKICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBncmVhdGVzdCBjb21tb24gZGl2aXNvciBvZiBhIHNlcmllcyBvZiBudW1iZXJzLgogICAgICogVGhlIGdyZWF0ZXN0IGNvbW1vbiBkaXZpc29yIGlzIHRoZSBsYXJnZXN0IGludGVnZXIgdGhhdCBkaXZpZGVzIGJvdGgKICAgICAqICAgICAgICBudW1iZXIxIGFuZCBudW1iZXIyIHdpdGhvdXQgYSByZW1haW5kZXIuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgR0NEKG51bWJlcjFbLG51bWJlcjJbLCAuLi5dXSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAkYXJnLC4uLiAgICAgICAgRGF0YSB2YWx1ZXMKICAgICAqIEByZXR1cm4gICAgaW50ZWdlciAgICAgICAgICAgICAgICAgICAgR3JlYXRlc3QgQ29tbW9uIERpdmlzb3IKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBHQ0QoKQogICAgewogICAgICAgICRyZXR1cm5WYWx1ZSA9IDE7CiAgICAgICAgJGFsbFZhbHVlc0ZhY3RvcnMgPSBhcnJheSgpOwogICAgICAgIC8vIExvb3AgdGhyb3VnaCBhcmd1bWVudHMKICAgICAgICBmb3JlYWNoIChQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheShmdW5jX2dldF9hcmdzKCkpIGFzICR2YWx1ZSkgewogICAgICAgICAgICBpZiAoIWlzX251bWVyaWMoJHZhbHVlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgfSBlbHNlaWYgKCR2YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlaWYgKCR2YWx1ZSA8IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRteUZhY3RvcnMgPSBzZWxmOjpmYWN0b3JzKCR2YWx1ZSk7CiAgICAgICAgICAgICRteUNvdW50ZWRGYWN0b3JzID0gYXJyYXlfY291bnRfdmFsdWVzKCRteUZhY3RvcnMpOwogICAgICAgICAgICAkYWxsVmFsdWVzRmFjdG9yc1tdID0gJG15Q291bnRlZEZhY3RvcnM7CiAgICAgICAgfQogICAgICAgICRhbGxWYWx1ZXNDb3VudCA9IGNvdW50KCRhbGxWYWx1ZXNGYWN0b3JzKTsKICAgICAgICBpZiAoJGFsbFZhbHVlc0NvdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAkbWVyZ2VkQXJyYXkgPSAkYWxsVmFsdWVzRmFjdG9yc1swXTsKICAgICAgICBmb3IgKCRpPTE7ICRpIDwgJGFsbFZhbHVlc0NvdW50OyArKyRpKSB7CiAgICAgICAgICAgICRtZXJnZWRBcnJheSA9IGFycmF5X2ludGVyc2VjdF9rZXkoJG1lcmdlZEFycmF5LCAkYWxsVmFsdWVzRmFjdG9yc1skaV0pOwogICAgICAgIH0KICAgICAgICAkbWVyZ2VkQXJyYXlWYWx1ZXMgPSBjb3VudCgkbWVyZ2VkQXJyYXkpOwogICAgICAgIGlmICgkbWVyZ2VkQXJyYXlWYWx1ZXMgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gJHJldHVyblZhbHVlOwogICAgICAgIH0gZWxzZWlmICgkbWVyZ2VkQXJyYXlWYWx1ZXMgPiAxKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRtZXJnZWRBcnJheSBhcyAkbWVyZ2VkS2V5ID0+ICRtZXJnZWRWYWx1ZSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGFsbFZhbHVlc0ZhY3RvcnMgYXMgJGhpZ2hlc3RQb3dlclRlc3QpIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkaGlnaGVzdFBvd2VyVGVzdCBhcyAkdGVzdEtleSA9PiAkdGVzdFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJHRlc3RLZXkgPT0gJG1lcmdlZEtleSkgJiYgKCR0ZXN0VmFsdWUgPCAkbWVyZ2VkVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVyZ2VkQXJyYXlbJG1lcmdlZEtleV0gPSAkdGVzdFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lcmdlZFZhbHVlID0gJHRlc3RWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHJldHVyblZhbHVlID0gMTsKICAgICAgICAgICAgZm9yZWFjaCAoJG1lcmdlZEFycmF5IGFzICRrZXkgPT4gJHZhbHVlKSB7CiAgICAgICAgICAgICAgICAkcmV0dXJuVmFsdWUgKj0gcG93KCRrZXksICR2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRyZXR1cm5WYWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAka2V5cyA9IGFycmF5X2tleXMoJG1lcmdlZEFycmF5KTsKICAgICAgICAgICAgJGtleSA9ICRrZXlzWzBdOwogICAgICAgICAgICAkdmFsdWUgPSAkbWVyZ2VkQXJyYXlbJGtleV07CiAgICAgICAgICAgIGZvcmVhY2ggKCRhbGxWYWx1ZXNGYWN0b3JzIGFzICR0ZXN0VmFsdWUpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR0ZXN0VmFsdWUgYXMgJG1lcmdlZEtleSA9PiAkbWVyZ2VkVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKCRtZXJnZWRLZXkgPT0gJGtleSkgJiYgKCRtZXJnZWRWYWx1ZSA8ICR2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gJG1lcmdlZFZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcG93KCRrZXksICR2YWx1ZSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIElOVAogICAgICoKICAgICAqIENhc3RzIGEgZmxvYXRpbmcgcG9pbnQgdmFsdWUgdG8gYW4gaW50ZWdlcgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIElOVChudW1iZXIpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBNYXRoZW1hdGljYWwgYW5kIFRyaWdvbm9tZXRyaWMgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgJG51bWJlciAgICAgICAgICAgIE51bWJlciB0byBjYXN0IHRvIGFuIGludGVnZXIKICAgICAqIEByZXR1cm4gICAgaW50ZWdlciAgICBJbnRlZ2VyIHZhbHVlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gSU5UKCRudW1iZXIpCiAgICB7CiAgICAgICAgJG51bWJlciAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRudW1iZXIpOwoKICAgICAgICBpZiAoaXNfbnVsbCgkbnVtYmVyKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2VpZiAoaXNfYm9vbCgkbnVtYmVyKSkgewogICAgICAgICAgICByZXR1cm4gKGludCkgJG51bWJlcjsKICAgICAgICB9CiAgICAgICAgaWYgKGlzX251bWVyaWMoJG51bWJlcikpIHsKICAgICAgICAgICAgcmV0dXJuIChpbnQpIGZsb29yKCRudW1iZXIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgfQoKCiAgICAvKioKICAgICAqIExDTQogICAgICoKICAgICAqIFJldHVybnMgdGhlIGxvd2VzdCBjb21tb24gbXVsdGlwbGllciBvZiBhIHNlcmllcyBvZiBudW1iZXJzCiAgICAgKiBUaGUgbGVhc3QgY29tbW9uIG11bHRpcGxlIGlzIHRoZSBzbWFsbGVzdCBwb3NpdGl2ZSBpbnRlZ2VyIHRoYXQgaXMgYSBtdWx0aXBsZQogICAgICogb2YgYWxsIGludGVnZXIgYXJndW1lbnRzIG51bWJlcjEsIG51bWJlcjIsIGFuZCBzbyBvbi4gVXNlIExDTSB0byBhZGQgZnJhY3Rpb25zCiAgICAgKiB3aXRoIGRpZmZlcmVudCBkZW5vbWluYXRvcnMuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgTENNKG51bWJlcjFbLG51bWJlcjJbLCAuLi5dXSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAkYXJnLC4uLiAgICAgICAgRGF0YSB2YWx1ZXMKICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBMb3dlc3QgQ29tbW9uIE11bHRpcGxpZXIKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBMQ00oKQogICAgewogICAgICAgICRyZXR1cm5WYWx1ZSA9IDE7CiAgICAgICAgJGFsbFBvd2VyZWRGYWN0b3JzID0gYXJyYXkoKTsKICAgICAgICAvLyBMb29wIHRocm91Z2ggYXJndW1lbnRzCiAgICAgICAgZm9yZWFjaCAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoZnVuY19nZXRfYXJncygpKSBhcyAkdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCFpc19udW1lcmljKCR2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCR2YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfSBlbHNlaWYgKCR2YWx1ZSA8IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRteUZhY3RvcnMgPSBzZWxmOjpmYWN0b3JzKGZsb29yKCR2YWx1ZSkpOwogICAgICAgICAgICAkbXlDb3VudGVkRmFjdG9ycyA9IGFycmF5X2NvdW50X3ZhbHVlcygkbXlGYWN0b3JzKTsKICAgICAgICAgICAgJG15UG93ZXJlZEZhY3RvcnMgPSBhcnJheSgpOwogICAgICAgICAgICBmb3JlYWNoICgkbXlDb3VudGVkRmFjdG9ycyBhcyAkbXlDb3VudGVkRmFjdG9yID0+ICRteUNvdW50ZWRQb3dlcikgewogICAgICAgICAgICAgICAgJG15UG93ZXJlZEZhY3RvcnNbJG15Q291bnRlZEZhY3Rvcl0gPSBwb3coJG15Q291bnRlZEZhY3RvciwgJG15Q291bnRlZFBvd2VyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JlYWNoICgkbXlQb3dlcmVkRmFjdG9ycyBhcyAkbXlQb3dlcmVkVmFsdWUgPT4gJG15UG93ZXJlZEZhY3RvcikgewogICAgICAgICAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJG15UG93ZXJlZFZhbHVlLCAkYWxsUG93ZXJlZEZhY3RvcnMpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRhbGxQb3dlcmVkRmFjdG9yc1skbXlQb3dlcmVkVmFsdWVdIDwgJG15UG93ZXJlZEZhY3RvcikgewogICAgICAgICAgICAgICAgICAgICAgICAkYWxsUG93ZXJlZEZhY3RvcnNbJG15UG93ZXJlZFZhbHVlXSA9ICRteVBvd2VyZWRGYWN0b3I7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkYWxsUG93ZXJlZEZhY3RvcnNbJG15UG93ZXJlZFZhbHVlXSA9ICRteVBvd2VyZWRGYWN0b3I7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yZWFjaCAoJGFsbFBvd2VyZWRGYWN0b3JzIGFzICRhbGxQb3dlcmVkRmFjdG9yKSB7CiAgICAgICAgICAgICRyZXR1cm5WYWx1ZSAqPSAoaW50ZWdlcikgJGFsbFBvd2VyZWRGYWN0b3I7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkcmV0dXJuVmFsdWU7CiAgICB9CgoKICAgIC8qKgogICAgICogTE9HX0JBU0UKICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBsb2dhcml0aG0gb2YgYSBudW1iZXIgdG8gYSBzcGVjaWZpZWQgYmFzZS4gVGhlIGRlZmF1bHQgYmFzZSBpcyAxMC4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBMT0cobnVtYmVyWyxiYXNlXSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAkbnVtYmVyICAgICAgICBUaGUgcG9zaXRpdmUgcmVhbCBudW1iZXIgZm9yIHdoaWNoIHlvdSB3YW50IHRoZSBsb2dhcml0aG0KICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAkYmFzZSAgICAgICAgVGhlIGJhc2Ugb2YgdGhlIGxvZ2FyaXRobS4gSWYgYmFzZSBpcyBvbWl0dGVkLCBpdCBpcyBhc3N1bWVkIHRvIGJlIDEwLgogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIExPR19CQVNFKCRudW1iZXIgPSBudWxsLCAkYmFzZSA9IDEwKQogICAgewogICAgICAgICRudW1iZXIgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbnVtYmVyKTsKICAgICAgICAkYmFzZSAgICA9IChpc19udWxsKCRiYXNlKSkgPyAxMCA6IChmbG9hdCkgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGJhc2UpOwoKICAgICAgICBpZiAoKCFpc19udW1lcmljKCRiYXNlKSkgfHwgKCFpc19udW1lcmljKCRudW1iZXIpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KICAgICAgICBpZiAoKCRiYXNlIDw9IDApIHx8ICgkbnVtYmVyIDw9IDApKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbG9nKCRudW1iZXIsICRiYXNlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBNREVURVJNCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgbWF0cml4IGRldGVybWluYW50IG9mIGFuIGFycmF5LgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIE1ERVRFUk0oYXJyYXkpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBNYXRoZW1hdGljYWwgYW5kIFRyaWdvbm9tZXRyaWMgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgYXJyYXkgICAgJG1hdHJpeFZhbHVlcyAgICBBIG1hdHJpeCBvZiB2YWx1ZXMKICAgICAqIEByZXR1cm4gICAgZmxvYXQKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBNREVURVJNKCRtYXRyaXhWYWx1ZXMpCiAgICB7CiAgICAgICAgJG1hdHJpeERhdGEgPSBhcnJheSgpOwogICAgICAgIGlmICghaXNfYXJyYXkoJG1hdHJpeFZhbHVlcykpIHsKICAgICAgICAgICAgJG1hdHJpeFZhbHVlcyA9IGFycmF5KGFycmF5KCRtYXRyaXhWYWx1ZXMpKTsKICAgICAgICB9CgogICAgICAgICRyb3cgPSAkbWF4Q29sdW1uID0gMDsKICAgICAgICBmb3JlYWNoICgkbWF0cml4VmFsdWVzIGFzICRtYXRyaXhSb3cpIHsKICAgICAgICAgICAgaWYgKCFpc19hcnJheSgkbWF0cml4Um93KSkgewogICAgICAgICAgICAgICAgJG1hdHJpeFJvdyA9IGFycmF5KCRtYXRyaXhSb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRjb2x1bW4gPSAwOwogICAgICAgICAgICBmb3JlYWNoICgkbWF0cml4Um93IGFzICRtYXRyaXhDZWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKGlzX3N0cmluZygkbWF0cml4Q2VsbCkpIHx8ICgkbWF0cml4Q2VsbCA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG1hdHJpeERhdGFbJGNvbHVtbl1bJHJvd10gPSAkbWF0cml4Q2VsbDsKICAgICAgICAgICAgICAgICsrJGNvbHVtbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJGNvbHVtbiA+ICRtYXhDb2x1bW4pIHsKICAgICAgICAgICAgICAgICRtYXhDb2x1bW4gPSAkY29sdW1uOwogICAgICAgICAgICB9CiAgICAgICAgICAgICsrJHJvdzsKICAgICAgICB9CiAgICAgICAgaWYgKCRyb3cgIT0gJG1heENvbHVtbikgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJG1hdHJpeCA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJG1hdHJpeERhdGEpOwogICAgICAgICAgICByZXR1cm4gJG1hdHJpeC0+ZGV0KCk7CiAgICAgICAgfSBjYXRjaCAoUEhQRXhjZWxfRXhjZXB0aW9uICRleCkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBNSU5WRVJTRQogICAgICoKICAgICAqIFJldHVybnMgdGhlIGludmVyc2UgbWF0cml4IGZvciB0aGUgbWF0cml4IHN0b3JlZCBpbiBhbiBhcnJheS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBNSU5WRVJTRShhcnJheSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBhcnJheSAgICAkbWF0cml4VmFsdWVzICAgIEEgbWF0cml4IG9mIHZhbHVlcwogICAgICogQHJldHVybiAgICBhcnJheQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIE1JTlZFUlNFKCRtYXRyaXhWYWx1ZXMpCiAgICB7CiAgICAgICAgJG1hdHJpeERhdGEgPSBhcnJheSgpOwogICAgICAgIGlmICghaXNfYXJyYXkoJG1hdHJpeFZhbHVlcykpIHsKICAgICAgICAgICAgJG1hdHJpeFZhbHVlcyA9IGFycmF5KGFycmF5KCRtYXRyaXhWYWx1ZXMpKTsKICAgICAgICB9CgogICAgICAgICRyb3cgPSAkbWF4Q29sdW1uID0gMDsKICAgICAgICBmb3JlYWNoICgkbWF0cml4VmFsdWVzIGFzICRtYXRyaXhSb3cpIHsKICAgICAgICAgICAgaWYgKCFpc19hcnJheSgkbWF0cml4Um93KSkgewogICAgICAgICAgICAgICAgJG1hdHJpeFJvdyA9IGFycmF5KCRtYXRyaXhSb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRjb2x1bW4gPSAwOwogICAgICAgICAgICBmb3JlYWNoICgkbWF0cml4Um93IGFzICRtYXRyaXhDZWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoKGlzX3N0cmluZygkbWF0cml4Q2VsbCkpIHx8ICgkbWF0cml4Q2VsbCA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG1hdHJpeERhdGFbJGNvbHVtbl1bJHJvd10gPSAkbWF0cml4Q2VsbDsKICAgICAgICAgICAgICAgICsrJGNvbHVtbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJGNvbHVtbiA+ICRtYXhDb2x1bW4pIHsKICAgICAgICAgICAgICAgICRtYXhDb2x1bW4gPSAkY29sdW1uOwogICAgICAgICAgICB9CiAgICAgICAgICAgICsrJHJvdzsKICAgICAgICB9CiAgICAgICAgaWYgKCRyb3cgIT0gJG1heENvbHVtbikgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJG1hdHJpeCA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJG1hdHJpeERhdGEpOwogICAgICAgICAgICByZXR1cm4gJG1hdHJpeC0+aW52ZXJzZSgpLT5nZXRBcnJheSgpOwogICAgICAgIH0gY2F0Y2ggKFBIUEV4Y2VsX0V4Y2VwdGlvbiAkZXgpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogTU1VTFQKICAgICAqCiAgICAgKiBAcGFyYW0gICAgYXJyYXkgICAgJG1hdHJpeERhdGExICAgIEEgbWF0cml4IG9mIHZhbHVlcwogICAgICogQHBhcmFtICAgIGFycmF5ICAgICRtYXRyaXhEYXRhMiAgICBBIG1hdHJpeCBvZiB2YWx1ZXMKICAgICAqIEByZXR1cm4gICAgYXJyYXkKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBNTVVMVCgkbWF0cml4RGF0YTEsICRtYXRyaXhEYXRhMikKICAgIHsKICAgICAgICAkbWF0cml4QURhdGEgPSAkbWF0cml4QkRhdGEgPSBhcnJheSgpOwogICAgICAgIGlmICghaXNfYXJyYXkoJG1hdHJpeERhdGExKSkgewogICAgICAgICAgICAkbWF0cml4RGF0YTEgPSBhcnJheShhcnJheSgkbWF0cml4RGF0YTEpKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc19hcnJheSgkbWF0cml4RGF0YTIpKSB7CiAgICAgICAgICAgICRtYXRyaXhEYXRhMiA9IGFycmF5KGFycmF5KCRtYXRyaXhEYXRhMikpOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHJvd0EgPSAwOwogICAgICAgICAgICBmb3JlYWNoICgkbWF0cml4RGF0YTEgYXMgJG1hdHJpeFJvdykgewogICAgICAgICAgICAgICAgaWYgKCFpc19hcnJheSgkbWF0cml4Um93KSkgewogICAgICAgICAgICAgICAgICAgICRtYXRyaXhSb3cgPSBhcnJheSgkbWF0cml4Um93KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRjb2x1bW5BID0gMDsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRtYXRyaXhSb3cgYXMgJG1hdHJpeENlbGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKCFpc19udW1lcmljKCRtYXRyaXhDZWxsKSkgfHwgKCRtYXRyaXhDZWxsID09PSBudWxsKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkbWF0cml4QURhdGFbJHJvd0FdWyRjb2x1bW5BXSA9ICRtYXRyaXhDZWxsOwogICAgICAgICAgICAgICAgICAgICsrJGNvbHVtbkE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICArKyRyb3dBOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRtYXRyaXhBID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkbWF0cml4QURhdGEpOwogICAgICAgICAgICAkcm93QiA9IDA7CiAgICAgICAgICAgIGZvcmVhY2ggKCRtYXRyaXhEYXRhMiBhcyAkbWF0cml4Um93KSB7CiAgICAgICAgICAgICAgICBpZiAoIWlzX2FycmF5KCRtYXRyaXhSb3cpKSB7CiAgICAgICAgICAgICAgICAgICAgJG1hdHJpeFJvdyA9IGFycmF5KCRtYXRyaXhSb3cpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNvbHVtbkIgPSAwOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJG1hdHJpeFJvdyBhcyAkbWF0cml4Q2VsbCkgewogICAgICAgICAgICAgICAgICAgIGlmICgoIWlzX251bWVyaWMoJG1hdHJpeENlbGwpKSB8fCAoJG1hdHJpeENlbGwgPT09IG51bGwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRtYXRyaXhCRGF0YVskcm93Ql1bJGNvbHVtbkJdID0gJG1hdHJpeENlbGw7CiAgICAgICAgICAgICAgICAgICAgKyskY29sdW1uQjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICsrJHJvd0I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1hdHJpeEIgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRtYXRyaXhCRGF0YSk7CgogICAgICAgICAgICBpZiAoJGNvbHVtbkEgIT0gJHJvd0IpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkbWF0cml4QS0+dGltZXMoJG1hdHJpeEIpLT5nZXRBcnJheSgpOwogICAgICAgIH0gY2F0Y2ggKFBIUEV4Y2VsX0V4Y2VwdGlvbiAkZXgpIHsKICAgICAgICAgICAgdmFyX2R1bXAoJGV4LT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBNT0QKICAgICAqCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkYSAgICAgICAgRGl2aWRlbmQKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICRiICAgICAgICBEaXZpc29yCiAgICAgKiBAcmV0dXJuICAgIGludCAgICAgICAgUmVtYWluZGVyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gTU9EKCRhID0gMSwgJGIgPSAxKQogICAgewogICAgICAgICRhID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGEpOwogICAgICAgICRiID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGIpOwoKICAgICAgICBpZiAoJGIgPT0gMC4wKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OkRJVjAoKTsKICAgICAgICB9IGVsc2VpZiAoKCRhIDwgMC4wKSAmJiAoJGIgPiAwLjApKSB7CiAgICAgICAgICAgIHJldHVybiAkYiAtIGZtb2QoYWJzKCRhKSwgJGIpOwogICAgICAgIH0gZWxzZWlmICgoJGEgPiAwLjApICYmICgkYiA8IDAuMCkpIHsKICAgICAgICAgICAgcmV0dXJuICRiICsgZm1vZCgkYSwgYWJzKCRiKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZm1vZCgkYSwgJGIpOwogICAgfQoKCiAgICAvKioKICAgICAqIE1ST1VORAogICAgICoKICAgICAqIFJvdW5kcyBhIG51bWJlciB0byB0aGUgbmVhcmVzdCBtdWx0aXBsZSBvZiBhIHNwZWNpZmllZCB2YWx1ZQogICAgICoKICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAkbnVtYmVyICAgICAgICAgICAgTnVtYmVyIHRvIHJvdW5kCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkbXVsdGlwbGUgICAgICAgIE11bHRpcGxlIHRvIHdoaWNoIHlvdSB3YW50IHRvIHJvdW5kICRudW1iZXIKICAgICAqIEByZXR1cm4gICAgZmxvYXQgICAgUm91bmRlZCBOdW1iZXIKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBNUk9VTkQoJG51bWJlciwgJG11bHRpcGxlKQogICAgewogICAgICAgICRudW1iZXIgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRudW1iZXIpOwogICAgICAgICRtdWx0aXBsZSA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRtdWx0aXBsZSk7CgogICAgICAgIGlmICgoaXNfbnVtZXJpYygkbnVtYmVyKSkgJiYgKGlzX251bWVyaWMoJG11bHRpcGxlKSkpIHsKICAgICAgICAgICAgaWYgKCRtdWx0aXBsZSA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKHNlbGY6OlNJR04oJG51bWJlcikpID09IChzZWxmOjpTSUdOKCRtdWx0aXBsZSkpKSB7CiAgICAgICAgICAgICAgICAkbXVsdGlwbGllciA9IDEgLyAkbXVsdGlwbGU7CiAgICAgICAgICAgICAgICByZXR1cm4gcm91bmQoJG51bWJlciAqICRtdWx0aXBsaWVyKSAvICRtdWx0aXBsaWVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgfQoKCiAgICAvKioKICAgICAqIE1VTFRJTk9NSUFMCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgcmF0aW8gb2YgdGhlIGZhY3RvcmlhbCBvZiBhIHN1bSBvZiB2YWx1ZXMgdG8gdGhlIHByb2R1Y3Qgb2YgZmFjdG9yaWFscy4KICAgICAqCiAgICAgKiBAcGFyYW0gICAgYXJyYXkgb2YgbWl4ZWQgICAgICAgIERhdGEgU2VyaWVzCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gTVVMVElOT01JQUwoKQogICAgewogICAgICAgICRzdW1tZXIgPSAwOwogICAgICAgICRkaXZpc29yID0gMTsKICAgICAgICAvLyBMb29wIHRocm91Z2ggYXJndW1lbnRzCiAgICAgICAgZm9yZWFjaCAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoZnVuY19nZXRfYXJncygpKSBhcyAkYXJnKSB7CiAgICAgICAgICAgIC8vIElzIGl0IGEgbnVtZXJpYyB2YWx1ZT8KICAgICAgICAgICAgaWYgKGlzX251bWVyaWMoJGFyZykpIHsKICAgICAgICAgICAgICAgIGlmICgkYXJnIDwgMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHN1bW1lciArPSBmbG9vcigkYXJnKTsKICAgICAgICAgICAgICAgICRkaXZpc29yICo9IHNlbGY6OkZBQ1QoJGFyZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICBpZiAoJHN1bW1lciA+IDApIHsKICAgICAgICAgICAgJHN1bW1lciA9IHNlbGY6OkZBQ1QoJHN1bW1lcik7CiAgICAgICAgICAgIHJldHVybiAkc3VtbWVyIC8gJGRpdmlzb3I7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQoKCiAgICAvKioKICAgICAqIE9ERAogICAgICoKICAgICAqIFJldHVybnMgbnVtYmVyIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3Qgb2RkIGludGVnZXIuCiAgICAgKgogICAgICogQHBhcmFtICAgIGZsb2F0ICAgICRudW1iZXIgICAgICAgICAgICBOdW1iZXIgdG8gcm91bmQKICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBSb3VuZGVkIE51bWJlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIE9ERCgkbnVtYmVyKQogICAgewogICAgICAgICRudW1iZXIgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbnVtYmVyKTsKCiAgICAgICAgaWYgKGlzX251bGwoJG51bWJlcikpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfSBlbHNlaWYgKGlzX2Jvb2woJG51bWJlcikpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfSBlbHNlaWYgKGlzX251bWVyaWMoJG51bWJlcikpIHsKICAgICAgICAgICAgJHNpZ25pZmljYW5jZSA9IHNlbGY6OlNJR04oJG51bWJlcik7CiAgICAgICAgICAgIGlmICgkc2lnbmlmaWNhbmNlID09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcmVzdWx0ID0gc2VsZjo6Q0VJTElORygkbnVtYmVyLCAkc2lnbmlmaWNhbmNlKTsKICAgICAgICAgICAgaWYgKCRyZXN1bHQgPT0gc2VsZjo6RVZFTigkcmVzdWx0KSkgewogICAgICAgICAgICAgICAgJHJlc3VsdCArPSAkc2lnbmlmaWNhbmNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gKGludCkgJHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBQT1dFUgogICAgICoKICAgICAqIENvbXB1dGVzIHggcmFpc2VkIHRvIHRoZSBwb3dlciB5LgogICAgICoKICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAgICAgJHgKICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAgICAgJHkKICAgICAqIEByZXR1cm4gICAgZmxvYXQKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBQT1dFUigkeCA9IDAsICR5ID0gMikKICAgIHsKICAgICAgICAkeCAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCR4KTsKICAgICAgICAkeSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCR5KTsKCiAgICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVycwogICAgICAgIGlmICgkeCA9PSAwLjAgJiYgJHkgPT0gMC4wKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0gZWxzZWlmICgkeCA9PSAwLjAgJiYgJHkgPCAwLjApIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6RElWMCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuCiAgICAgICAgJHJlc3VsdCA9IHBvdygkeCwgJHkpOwogICAgICAgIHJldHVybiAoIWlzX25hbigkcmVzdWx0KSAmJiAhaXNfaW5maW5pdGUoJHJlc3VsdCkpID8gJHJlc3VsdCA6IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogUFJPRFVDVAogICAgICoKICAgICAqIFBST0RVQ1QgcmV0dXJucyB0aGUgcHJvZHVjdCBvZiBhbGwgdGhlIHZhbHVlcyBhbmQgY2VsbHMgcmVmZXJlbmNlZCBpbiB0aGUgYXJndW1lbnQgbGlzdC4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBQUk9EVUNUKHZhbHVlMVssdmFsdWUyWywgLi4uXV0pCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBNYXRoZW1hdGljYWwgYW5kIFRyaWdvbm9tZXRyaWMgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgICAgICRhcmcsLi4uICAgICAgICBEYXRhIHZhbHVlcwogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFBST0RVQ1QoKQogICAgewogICAgICAgIC8vIFJldHVybiB2YWx1ZQogICAgICAgICRyZXR1cm5WYWx1ZSA9IG51bGw7CgogICAgICAgIC8vIExvb3AgdGhyb3VnaCBhcmd1bWVudHMKICAgICAgICBmb3JlYWNoIChQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheShmdW5jX2dldF9hcmdzKCkpIGFzICRhcmcpIHsKICAgICAgICAgICAgLy8gSXMgaXQgYSBudW1lcmljIHZhbHVlPwogICAgICAgICAgICBpZiAoKGlzX251bWVyaWMoJGFyZykpICYmICghaXNfc3RyaW5nKCRhcmcpKSkgewogICAgICAgICAgICAgICAgaWYgKGlzX251bGwoJHJldHVyblZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZSA9ICRhcmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZSAqPSAkYXJnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICBpZiAoaXNfbnVsbCgkcmV0dXJuVmFsdWUpKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJldHVyblZhbHVlOwogICAgfQoKCiAgICAvKioKICAgICAqIFFVT1RJRU5UCiAgICAgKgogICAgICogUVVPVElFTlQgZnVuY3Rpb24gcmV0dXJucyB0aGUgaW50ZWdlciBwb3J0aW9uIG9mIGEgZGl2aXNpb24uIE51bWVyYXRvciBpcyB0aGUgZGl2aWRlZCBudW1iZXIKICAgICAqICAgICAgICBhbmQgZGVub21pbmF0b3IgaXMgdGhlIGRpdmlzb3IuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgUVVPVElFTlQodmFsdWUxWyx2YWx1ZTJbLCAuLi5dXSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAgICAgJGFyZywuLi4gICAgICAgIERhdGEgdmFsdWVzCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gUVVPVElFTlQoKQogICAgewogICAgICAgIC8vIFJldHVybiB2YWx1ZQogICAgICAgICRyZXR1cm5WYWx1ZSA9IG51bGw7CgogICAgICAgIC8vIExvb3AgdGhyb3VnaCBhcmd1bWVudHMKICAgICAgICBmb3JlYWNoIChQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheShmdW5jX2dldF9hcmdzKCkpIGFzICRhcmcpIHsKICAgICAgICAgICAgLy8gSXMgaXQgYSBudW1lcmljIHZhbHVlPwogICAgICAgICAgICBpZiAoKGlzX251bWVyaWMoJGFyZykpICYmICghaXNfc3RyaW5nKCRhcmcpKSkgewogICAgICAgICAgICAgICAgaWYgKGlzX251bGwoJHJldHVyblZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZSA9ICgkYXJnID09IDApID8gMCA6ICRhcmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgoJHJldHVyblZhbHVlID09IDApIHx8ICgkYXJnID09IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJldHVyblZhbHVlIC89ICRhcmc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gaW50dmFsKCRyZXR1cm5WYWx1ZSk7CiAgICB9CgoKICAgIC8qKgogICAgICogUkFORAogICAgICoKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICRtaW4gICAgTWluaW1hbCB2YWx1ZQogICAgICogQHBhcmFtICAgIGludCAgICAgICAgJG1heCAgICBNYXhpbWFsIHZhbHVlCiAgICAgKiBAcmV0dXJuICAgIGludCAgICAgICAgUmFuZG9tIG51bWJlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFJBTkQoJG1pbiA9IDAsICRtYXggPSAwKQogICAgewogICAgICAgICRtaW4gPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbWluKTsKICAgICAgICAkbWF4ID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJG1heCk7CgogICAgICAgIGlmICgkbWluID09IDAgJiYgJG1heCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAobXRfcmFuZCgwLCAxMDAwMDAwMCkpIC8gMTAwMDAwMDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG10X3JhbmQoJG1pbiwgJG1heCk7CiAgICAgICAgfQogICAgfQoKCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFJPTUFOKCRhVmFsdWUsICRzdHlsZSA9IDApCiAgICB7CiAgICAgICAgJGFWYWx1ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRhVmFsdWUpOwogICAgICAgICRzdHlsZSAgICA9IChpc19udWxsKCRzdHlsZSkpICAgID8gMCA6ICAgIChpbnRlZ2VyKSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkc3R5bGUpOwogICAgICAgIGlmICgoIWlzX251bWVyaWMoJGFWYWx1ZSkpIHx8ICgkYVZhbHVlIDwgMCkgfHwgKCRhVmFsdWUgPj0gNDAwMCkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CiAgICAgICAgJGFWYWx1ZSA9IChpbnRlZ2VyKSAkYVZhbHVlOwogICAgICAgIGlmICgkYVZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0KCiAgICAgICAgJG1pbGwgPSBhcnJheSgnJywgJ00nLCAnTU0nLCAnTU1NJywgJ01NTU0nLCAnTU1NTU0nKTsKICAgICAgICAkY2VudCA9IGFycmF5KCcnLCAnQycsICdDQycsICdDQ0MnLCAnQ0QnLCAnRCcsICdEQycsICdEQ0MnLCAnRENDQycsICdDTScpOwogICAgICAgICR0ZW5zID0gYXJyYXkoJycsICdYJywgJ1hYJywgJ1hYWCcsICdYTCcsICdMJywgJ0xYJywgJ0xYWCcsICdMWFhYJywgJ1hDJyk7CiAgICAgICAgJG9uZXMgPSBhcnJheSgnJywgJ0knLCAnSUknLCAnSUlJJywgJ0lWJywgJ1YnLCAnVkknLCAnVklJJywgJ1ZJSUknLCAnSVgnKTsKCiAgICAgICAgJHJvbWFuID0gJyc7CiAgICAgICAgd2hpbGUgKCRhVmFsdWUgPiA1OTk5KSB7CiAgICAgICAgICAgICRyb21hbiAuPSAnTSc7CiAgICAgICAgICAgICRhVmFsdWUgLT0gMTAwMDsKICAgICAgICB9CiAgICAgICAgJG0gPSBzZWxmOjpyb21hbkN1dCgkYVZhbHVlLCAxMDAwKTsKICAgICAgICAkYVZhbHVlICU9IDEwMDA7CiAgICAgICAgJGMgPSBzZWxmOjpyb21hbkN1dCgkYVZhbHVlLCAxMDApOwogICAgICAgICRhVmFsdWUgJT0gMTAwOwogICAgICAgICR0ID0gc2VsZjo6cm9tYW5DdXQoJGFWYWx1ZSwgMTApOwogICAgICAgICRhVmFsdWUgJT0gMTA7CgogICAgICAgIHJldHVybiAkcm9tYW4uJG1pbGxbJG1dLiRjZW50WyRjXS4kdGVuc1skdF0uJG9uZXNbJGFWYWx1ZV07CiAgICB9CgoKICAgIC8qKgogICAgICogUk9VTkRVUAogICAgICoKICAgICAqIFJvdW5kcyBhIG51bWJlciB1cCB0byBhIHNwZWNpZmllZCBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMKICAgICAqCiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgJG51bWJlciAgICAgICAgICAgIE51bWJlciB0byByb3VuZAogICAgICogQHBhcmFtICAgIGludCAgICAgICAgJGRpZ2l0cyAgICAgICAgICAgIE51bWJlciBvZiBkaWdpdHMgdG8gd2hpY2ggeW91IHdhbnQgdG8gcm91bmQgJG51bWJlcgogICAgICogQHJldHVybiAgICBmbG9hdCAgICBSb3VuZGVkIE51bWJlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFJPVU5EVVAoJG51bWJlciwgJGRpZ2l0cykKICAgIHsKICAgICAgICAkbnVtYmVyICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJG51bWJlcik7CiAgICAgICAgJGRpZ2l0cyAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRkaWdpdHMpOwoKICAgICAgICBpZiAoKGlzX251bWVyaWMoJG51bWJlcikpICYmIChpc19udW1lcmljKCRkaWdpdHMpKSkgewogICAgICAgICAgICAkc2lnbmlmaWNhbmNlID0gcG93KDEwLCAoaW50KSAkZGlnaXRzKTsKICAgICAgICAgICAgaWYgKCRudW1iZXIgPCAwLjApIHsKICAgICAgICAgICAgICAgIHJldHVybiBmbG9vcigkbnVtYmVyICogJHNpZ25pZmljYW5jZSkgLyAkc2lnbmlmaWNhbmNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGNlaWwoJG51bWJlciAqICRzaWduaWZpY2FuY2UpIC8gJHNpZ25pZmljYW5jZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgfQoKCiAgICAvKioKICAgICAqIFJPVU5ERE9XTgogICAgICoKICAgICAqIFJvdW5kcyBhIG51bWJlciBkb3duIHRvIGEgc3BlY2lmaWVkIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlcwogICAgICoKICAgICAqIEBwYXJhbSAgICBmbG9hdCAgICAkbnVtYmVyICAgICAgICAgICAgTnVtYmVyIHRvIHJvdW5kCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkZGlnaXRzICAgICAgICAgICAgTnVtYmVyIG9mIGRpZ2l0cyB0byB3aGljaCB5b3Ugd2FudCB0byByb3VuZCAkbnVtYmVyCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0ICAgIFJvdW5kZWQgTnVtYmVyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gUk9VTkRET1dOKCRudW1iZXIsICRkaWdpdHMpCiAgICB7CiAgICAgICAgJG51bWJlciAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRudW1iZXIpOwogICAgICAgICRkaWdpdHMgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkZGlnaXRzKTsKCiAgICAgICAgaWYgKChpc19udW1lcmljKCRudW1iZXIpKSAmJiAoaXNfbnVtZXJpYygkZGlnaXRzKSkpIHsKICAgICAgICAgICAgJHNpZ25pZmljYW5jZSA9IHBvdygxMCwgKGludCkgJGRpZ2l0cyk7CiAgICAgICAgICAgIGlmICgkbnVtYmVyIDwgMC4wKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2VpbCgkbnVtYmVyICogJHNpZ25pZmljYW5jZSkgLyAkc2lnbmlmaWNhbmNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZsb29yKCRudW1iZXIgKiAkc2lnbmlmaWNhbmNlKSAvICRzaWduaWZpY2FuY2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBTRVJJRVNTVU0KICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBzdW0gb2YgYSBwb3dlciBzZXJpZXMKICAgICAqCiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgICAgICAgICAkeCAgICBJbnB1dCB2YWx1ZSB0byB0aGUgcG93ZXIgc2VyaWVzCiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgICAgICAgICAkbiAgICBJbml0aWFsIHBvd2VyIHRvIHdoaWNoIHlvdSB3YW50IHRvIHJhaXNlICR4CiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgICAgICAgICAkbSAgICBTdGVwIGJ5IHdoaWNoIHRvIGluY3JlYXNlICRuIGZvciBlYWNoIHRlcm0gaW4gdGhlIHNlcmllcwogICAgICogQHBhcmFtICAgIGFycmF5IG9mIG1peGVkICAgICAgICBEYXRhIFNlcmllcwogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFNFUklFU1NVTSgpCiAgICB7CiAgICAgICAgJHJldHVyblZhbHVlID0gMDsKCiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFyZ3VtZW50cwogICAgICAgICRhQXJncyA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlbkFycmF5KGZ1bmNfZ2V0X2FyZ3MoKSk7CgogICAgICAgICR4ID0gYXJyYXlfc2hpZnQoJGFBcmdzKTsKICAgICAgICAkbiA9IGFycmF5X3NoaWZ0KCRhQXJncyk7CiAgICAgICAgJG0gPSBhcnJheV9zaGlmdCgkYUFyZ3MpOwoKICAgICAgICBpZiAoKGlzX251bWVyaWMoJHgpKSAmJiAoaXNfbnVtZXJpYygkbikpICYmIChpc19udW1lcmljKCRtKSkpIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlCiAgICAgICAgICAgICRpID0gMDsKICAgICAgICAgICAgZm9yZWFjaCAoJGFBcmdzIGFzICRhcmcpIHsKICAgICAgICAgICAgICAgIC8vIElzIGl0IGEgbnVtZXJpYyB2YWx1ZT8KICAgICAgICAgICAgICAgIGlmICgoaXNfbnVtZXJpYygkYXJnKSkgJiYgKCFpc19zdHJpbmcoJGFyZykpKSB7CiAgICAgICAgICAgICAgICAgICAgJHJldHVyblZhbHVlICs9ICRhcmcgKiBwb3coJHgsICRuICsgKCRtICogJGkrKykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkcmV0dXJuVmFsdWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogU0lHTgogICAgICoKICAgICAqIERldGVybWluZXMgdGhlIHNpZ24gb2YgYSBudW1iZXIuIFJldHVybnMgMSBpZiB0aGUgbnVtYmVyIGlzIHBvc2l0aXZlLCB6ZXJvICgwKQogICAgICogICAgICAgIGlmIHRoZSBudW1iZXIgaXMgMCwgYW5kIC0xIGlmIHRoZSBudW1iZXIgaXMgbmVnYXRpdmUuCiAgICAgKgogICAgICogQHBhcmFtICAgIGZsb2F0ICAgICRudW1iZXIgICAgICAgICAgICBOdW1iZXIgdG8gcm91bmQKICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBzaWduIHZhbHVlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gU0lHTigkbnVtYmVyKQogICAgewogICAgICAgICRudW1iZXIgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbnVtYmVyKTsKCiAgICAgICAgaWYgKGlzX2Jvb2woJG51bWJlcikpIHsKICAgICAgICAgICAgcmV0dXJuIChpbnQpICRudW1iZXI7CiAgICAgICAgfQogICAgICAgIGlmIChpc19udW1lcmljKCRudW1iZXIpKSB7CiAgICAgICAgICAgIGlmICgkbnVtYmVyID09IDAuMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRudW1iZXIgLyBhYnMoJG51bWJlcik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogU1FSVFBJCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgc3F1YXJlIHJvb3Qgb2YgKG51bWJlciAqIHBpKS4KICAgICAqCiAgICAgKiBAcGFyYW0gICAgZmxvYXQgICAgJG51bWJlciAgICAgICAgTnVtYmVyCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0ICAgIFNxdWFyZSBSb290IG9mIE51bWJlciAqIFBpCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gU1FSVFBJKCRudW1iZXIpCiAgICB7CiAgICAgICAgJG51bWJlciAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRudW1iZXIpOwoKICAgICAgICBpZiAoaXNfbnVtZXJpYygkbnVtYmVyKSkgewogICAgICAgICAgICBpZiAoJG51bWJlciA8IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzcXJ0KCRudW1iZXIgKiBNX1BJKSA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogU1VCVE9UQUwKICAgICAqCiAgICAgKiBSZXR1cm5zIGEgc3VidG90YWwgaW4gYSBsaXN0IG9yIGRhdGFiYXNlLgogICAgICoKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgIHRoZSBudW1iZXIgMSB0byAxMSB0aGF0IHNwZWNpZmllcyB3aGljaCBmdW5jdGlvbiB0bwogICAgICogICAgICAgICAgICAgICAgICAgIHVzZSBpbiBjYWxjdWxhdGluZyBzdWJ0b3RhbHMgd2l0aGluIGEgbGlzdC4KICAgICAqIEBwYXJhbSAgICBhcnJheSBvZiBtaXhlZCAgICAgICAgRGF0YSBTZXJpZXMKICAgICAqIEByZXR1cm4gICAgZmxvYXQKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBTVUJUT1RBTCgpCiAgICB7CiAgICAgICAgJGFBcmdzID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoZnVuY19nZXRfYXJncygpKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlCiAgICAgICAgJHN1YnRvdGFsID0gYXJyYXlfc2hpZnQoJGFBcmdzKTsKCiAgICAgICAgaWYgKChpc19udW1lcmljKCRzdWJ0b3RhbCkpICYmICghaXNfc3RyaW5nKCRzdWJ0b3RhbCkpKSB7CiAgICAgICAgICAgIHN3aXRjaCAoJHN1YnRvdGFsKSB7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX1N0YXRpc3RpY2FsOjpBVkVSQUdFKCRhQXJncyk7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX1N0YXRpc3RpY2FsOjpDT1VOVCgkYUFyZ3MpOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9TdGF0aXN0aWNhbDo6Q09VTlRBKCRhQXJncyk7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX1N0YXRpc3RpY2FsOjpNQVgoJGFBcmdzKTsKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fU3RhdGlzdGljYWw6Ok1JTigkYUFyZ3MpOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOjpQUk9EVUNUKCRhQXJncyk7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX1N0YXRpc3RpY2FsOjpTVERFVigkYUFyZ3MpOwogICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9TdGF0aXN0aWNhbDo6U1RERVZQKCRhQXJncyk7CiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGY6OlNVTSgkYUFyZ3MpOwogICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fU3RhdGlzdGljYWw6OlZBUkZ1bmMoJGFBcmdzKTsKICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX1N0YXRpc3RpY2FsOjpWQVJQKCRhQXJncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBTVU0KICAgICAqCiAgICAgKiBTVU0gY29tcHV0ZXMgdGhlIHN1bSBvZiBhbGwgdGhlIHZhbHVlcyBhbmQgY2VsbHMgcmVmZXJlbmNlZCBpbiB0aGUgYXJndW1lbnQgbGlzdC4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBTVU0odmFsdWUxWyx2YWx1ZTJbLCAuLi5dXSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAgICAgJGFyZywuLi4gICAgICAgIERhdGEgdmFsdWVzCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gU1VNKCkKICAgIHsKICAgICAgICAkcmV0dXJuVmFsdWUgPSAwOwoKICAgICAgICAvLyBMb29wIHRocm91Z2ggdGhlIGFyZ3VtZW50cwogICAgICAgIGZvcmVhY2ggKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlbkFycmF5KGZ1bmNfZ2V0X2FyZ3MoKSkgYXMgJGFyZykgewogICAgICAgICAgICAvLyBJcyBpdCBhIG51bWVyaWMgdmFsdWU\/CiAgICAgICAgICAgIGlmICgoaXNfbnVtZXJpYygkYXJnKSkgJiYgKCFpc19zdHJpbmcoJGFyZykpKSB7CiAgICAgICAgICAgICAgICAkcmV0dXJuVmFsdWUgKz0gJGFyZzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXR1cm5WYWx1ZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBTVU1JRgogICAgICoKICAgICAqIENvdW50cyB0aGUgbnVtYmVyIG9mIGNlbGxzIHRoYXQgY29udGFpbiBudW1iZXJzIHdpdGhpbiB0aGUgbGlzdCBvZiBhcmd1bWVudHMKICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBTVU1JRih2YWx1ZTFbLHZhbHVlMlssIC4uLl1dLGNvbmRpdGlvbikKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAgICAgJGFyZywuLi4gICAgICAgIERhdGEgdmFsdWVzCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICAgICAkY29uZGl0aW9uICAgICAgICBUaGUgY3JpdGVyaWEgdGhhdCBkZWZpbmVzIHdoaWNoIGNlbGxzIHdpbGwgYmUgc3VtbWVkLgogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFNVTUlGKCRhQXJncywgJGNvbmRpdGlvbiwgJHN1bUFyZ3MgPSBhcnJheSgpKQogICAgewogICAgICAgICRyZXR1cm5WYWx1ZSA9IDA7CgogICAgICAgICRhQXJncyA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlbkFycmF5KCRhQXJncyk7CiAgICAgICAgJHN1bUFyZ3MgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkc3VtQXJncyk7CiAgICAgICAgaWYgKGVtcHR5KCRzdW1BcmdzKSkgewogICAgICAgICAgICAkc3VtQXJncyA9ICRhQXJnczsKICAgICAgICB9CiAgICAgICAgJGNvbmRpdGlvbiA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6aWZDb25kaXRpb24oJGNvbmRpdGlvbik7CiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFyZ3VtZW50cwogICAgICAgIGZvcmVhY2ggKCRhQXJncyBhcyAka2V5ID0+ICRhcmcpIHsKICAgICAgICAgICAgaWYgKCFpc19udW1lcmljKCRhcmcpKSB7CiAgICAgICAgICAgICAgICAkYXJnID0gc3RyX3JlcGxhY2UoJyInLCAnIiInLCAkYXJnKTsKICAgICAgICAgICAgICAgICRhcmcgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6d3JhcFJlc3VsdChzdHJ0b3VwcGVyKCRhcmcpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRlc3RDb25kaXRpb24gPSAnPScuJGFyZy4kY29uZGl0aW9uOwogICAgICAgICAgICBpZiAoUEhQRXhjZWxfQ2FsY3VsYXRpb246OmdldEluc3RhbmNlKCktPl9jYWxjdWxhdGVGb3JtdWxhVmFsdWUoJHRlc3RDb25kaXRpb24pKSB7CiAgICAgICAgICAgICAgICAvLyBJcyBpdCBhIHZhbHVlIHdpdGhpbiBvdXIgY3JpdGVyaWEKICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZSArPSAkc3VtQXJnc1ska2V5XTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXR1cm5WYWx1ZTsKICAgIH0KCgogCS8qKgoJICoJU1VNSUZTCgkgKgoJICoJQ291bnRzIHRoZSBudW1iZXIgb2YgY2VsbHMgdGhhdCBjb250YWluIG51bWJlcnMgd2l0aGluIHRoZSBsaXN0IG9mIGFyZ3VtZW50cwoJICoKCSAqCUV4Y2VsIEZ1bmN0aW9uOgoJICoJCVNVTUlGUyh2YWx1ZTFbLHZhbHVlMlssIC4uLl1dLGNvbmRpdGlvbikKCSAqCgkgKglAYWNjZXNzCXB1YmxpYwoJICoJQGNhdGVnb3J5IE1hdGhlbWF0aWNhbCBhbmQgVHJpZ29ub21ldHJpYyBGdW5jdGlvbnMKCSAqCUBwYXJhbQltaXhlZAkJJGFyZywuLi4JCURhdGEgdmFsdWVzCgkgKglAcGFyYW0Jc3RyaW5nCQkkY29uZGl0aW9uCQlUaGUgY3JpdGVyaWEgdGhhdCBkZWZpbmVzIHdoaWNoIGNlbGxzIHdpbGwgYmUgc3VtbWVkLgoJICoJQHJldHVybglmbG9hdAoJICovCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFNVTUlGUygpIHsKCQkkYXJyYXlMaXN0ID0gZnVuY19nZXRfYXJncygpOwoKCQkkc3VtQXJncyA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlbkFycmF5KGFycmF5X3NoaWZ0KCRhcnJheUxpc3QpKTsKCiAgICAgICAgd2hpbGUgKGNvdW50KCRhcnJheUxpc3QpID4gMCkgewogICAgICAgICAgICAkYUFyZ3NBcnJheVtdID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoYXJyYXlfc2hpZnQoJGFycmF5TGlzdCkpOwogICAgICAgICAgICAkY29uZGl0aW9uc1tdID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjppZkNvbmRpdGlvbihhcnJheV9zaGlmdCgkYXJyYXlMaXN0KSk7CiAgICAgICAgfQoKICAgICAgICAvLyBMb29wIHRocm91Z2ggZWFjaCBzZXQgb2YgYXJndW1lbnRzIGFuZCBjb25kaXRpb25zCiAgICAgICAgZm9yZWFjaCAoJGNvbmRpdGlvbnMgYXMgJGluZGV4ID0+ICRjb25kaXRpb24pIHsKICAgICAgICAgICAgJGFBcmdzID0gJGFBcmdzQXJyYXlbJGluZGV4XTsKICAgICAgICAgICAgJHdpbGRjYXJkID0gZmFsc2U7CiAgICAgICAgICAgIGlmICgoc3RycG9zKCRjb25kaXRpb24sICcqJykgIT09IGZhbHNlKSB8fCAoc3RycG9zKCRjb25kaXRpb24sICc\/JykgIT09IGZhbHNlKSkgewogICAgICAgICAgICAgICAgLy8gKiBhbmQgPyBhcmUgd2lsZGNhcmQgY2hhcmFjdGVycy4KICAgICAgICAgICAgICAgIC8vIFVzZSB+KiBhbmQgfj8gZm9yIGxpdGVyYWwgc3RhciBhbmQgcXVlc3Rpb24gbWFyawogICAgICAgICAgICAgICAgLy8gQ29kZSBsb2dpYyBkb2Vzbid0IHlldCBoYW5kbGUgZXNjYXBpbmcKICAgICAgICAgICAgICAgICRjb25kaXRpb24gPSB0cmltKGx0cmltKCRjb25kaXRpb24sICc9PD4nKSwgJyInKTsKICAgICAgICAgICAgICAgICR3aWxkY2FyZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFyZ3VtZW50cwogICAgICAgICAgICBmb3JlYWNoICgkYUFyZ3MgYXMgJGtleSA9PiAkYXJnKSB7CiAgICAgICAgICAgICAgICBpZiAoJHdpbGRjYXJkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbm1hdGNoKCRjb25kaXRpb24sICRhcmcsIEZOTV9DQVNFRk9MRCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXMgaXQgYSB2YWx1ZSB3aXRoaW4gb3VyIGNyaXRlcmlhCiAgICAgICAgICAgICAgICAgICAgICAgICRzdW1BcmdzWyRrZXldID0gMC4wOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc19udW1lcmljKCRhcmcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmcgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6d3JhcFJlc3VsdChzdHJ0b3VwcGVyKCRhcmcpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHRlc3RDb25kaXRpb24gPSAnPScuJGFyZy4kY29uZGl0aW9uOwogICAgICAgICAgICAgICAgICAgIGlmICghUEhQRXhjZWxfQ2FsY3VsYXRpb246OmdldEluc3RhbmNlKCktPl9jYWxjdWxhdGVGb3JtdWxhVmFsdWUoJHRlc3RDb25kaXRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElzIGl0IGEgdmFsdWUgd2l0aGluIG91ciBjcml0ZXJpYQogICAgICAgICAgICAgICAgICAgICAgICAkc3VtQXJnc1ska2V5XSA9IDAuMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgoJCS8vIFJldHVybgoJCXJldHVybiBhcnJheV9zdW0oJHN1bUFyZ3MpOwoJfQoKCiAgICAvKioKICAgICAqIFNVTVBST0RVQ1QKICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBTVU1QUk9EVUNUKHZhbHVlMVssdmFsdWUyWywgLi4uXV0pCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBNYXRoZW1hdGljYWwgYW5kIFRyaWdvbm9tZXRyaWMgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgICAgICRhcmcsLi4uICAgICAgICBEYXRhIHZhbHVlcwogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFNVTVBST0RVQ1QoKQogICAgewogICAgICAgICRhcnJheUxpc3QgPSBmdW5jX2dldF9hcmdzKCk7CgogICAgICAgICR3cmtBcnJheSA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlbkFycmF5KGFycmF5X3NoaWZ0KCRhcnJheUxpc3QpKTsKICAgICAgICAkd3JrQ2VsbENvdW50ID0gY291bnQoJHdya0FycmF5KTsKCiAgICAgICAgZm9yICgkaT0wOyAkaTwgJHdya0NlbGxDb3VudDsgKyskaSkgewogICAgICAgICAgICBpZiAoKCFpc19udW1lcmljKCR3cmtBcnJheVskaV0pKSB8fCAoaXNfc3RyaW5nKCR3cmtBcnJheVskaV0pKSkgewogICAgICAgICAgICAgICAgJHdya0FycmF5WyRpXSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvcmVhY2ggKCRhcnJheUxpc3QgYXMgJG1hdHJpeERhdGEpIHsKICAgICAgICAgICAgJGFycmF5MiA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlbkFycmF5KCRtYXRyaXhEYXRhKTsKICAgICAgICAgICAgJGNvdW50ID0gY291bnQoJGFycmF5Mik7CiAgICAgICAgICAgIGlmICgkd3JrQ2VsbENvdW50ICE9ICRjb3VudCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yZWFjaCAoJGFycmF5MiBhcyAkaSA9PiAkdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoKCFpc19udW1lcmljKCR2YWwpKSB8fCAoaXNfc3RyaW5nKCR2YWwpKSkgewogICAgICAgICAgICAgICAgICAgICR2YWwgPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHdya0FycmF5WyRpXSAqPSAkdmFsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXJyYXlfc3VtKCR3cmtBcnJheSk7CiAgICB9CgoKICAgIC8qKgogICAgICogU1VNU1EKICAgICAqCiAgICAgKiBTVU1TUSByZXR1cm5zIHRoZSBzdW0gb2YgdGhlIHNxdWFyZXMgb2YgdGhlIGFyZ3VtZW50cwogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIFNVTVNRKHZhbHVlMVssdmFsdWUyWywgLi4uXV0pCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBNYXRoZW1hdGljYWwgYW5kIFRyaWdvbm9tZXRyaWMgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgICAgICRhcmcsLi4uICAgICAgICBEYXRhIHZhbHVlcwogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFNVTVNRKCkKICAgIHsKICAgICAgICAkcmV0dXJuVmFsdWUgPSAwOwoKICAgICAgICAvLyBMb29wIHRocm91Z2ggYXJndW1lbnRzCiAgICAgICAgZm9yZWFjaCAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoZnVuY19nZXRfYXJncygpKSBhcyAkYXJnKSB7CiAgICAgICAgICAgIC8vIElzIGl0IGEgbnVtZXJpYyB2YWx1ZT8KICAgICAgICAgICAgaWYgKChpc19udW1lcmljKCRhcmcpKSAmJiAoIWlzX3N0cmluZygkYXJnKSkpIHsKICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZSArPSAoJGFyZyAqICRhcmcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJldHVyblZhbHVlOwogICAgfQoKCiAgICAvKioKICAgICAqIFNVTVgyTVkyCiAgICAgKgogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgJG1hdHJpeERhdGExICAgIE1hdHJpeCAjMQogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgJG1hdHJpeERhdGEyICAgIE1hdHJpeCAjMgogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFNVTVgyTVkyKCRtYXRyaXhEYXRhMSwgJG1hdHJpeERhdGEyKQogICAgewogICAgICAgICRhcnJheTEgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkbWF0cml4RGF0YTEpOwogICAgICAgICRhcnJheTIgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkbWF0cml4RGF0YTIpOwogICAgICAgICRjb3VudCA9IG1pbihjb3VudCgkYXJyYXkxKSwgY291bnQoJGFycmF5MikpOwoKICAgICAgICAkcmVzdWx0ID0gMDsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkY291bnQ7ICsrJGkpIHsKICAgICAgICAgICAgaWYgKCgoaXNfbnVtZXJpYygkYXJyYXkxWyRpXSkpICYmICghaXNfc3RyaW5nKCRhcnJheTFbJGldKSkpICYmCiAgICAgICAgICAgICAgICAoKGlzX251bWVyaWMoJGFycmF5MlskaV0pKSAmJiAoIWlzX3N0cmluZygkYXJyYXkyWyRpXSkpKSkgewogICAgICAgICAgICAgICAgJHJlc3VsdCArPSAoJGFycmF5MVskaV0gKiAkYXJyYXkxWyRpXSkgLSAoJGFycmF5MlskaV0gKiAkYXJyYXkyWyRpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKCiAgICAvKioKICAgICAqIFNVTVgyUFkyCiAgICAgKgogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgJG1hdHJpeERhdGExICAgIE1hdHJpeCAjMQogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgJG1hdHJpeERhdGEyICAgIE1hdHJpeCAjMgogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFNVTVgyUFkyKCRtYXRyaXhEYXRhMSwgJG1hdHJpeERhdGEyKQogICAgewogICAgICAgICRhcnJheTEgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkbWF0cml4RGF0YTEpOwogICAgICAgICRhcnJheTIgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkbWF0cml4RGF0YTIpOwogICAgICAgICRjb3VudCA9IG1pbihjb3VudCgkYXJyYXkxKSwgY291bnQoJGFycmF5MikpOwoKICAgICAgICAkcmVzdWx0ID0gMDsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkY291bnQ7ICsrJGkpIHsKICAgICAgICAgICAgaWYgKCgoaXNfbnVtZXJpYygkYXJyYXkxWyRpXSkpICYmICghaXNfc3RyaW5nKCRhcnJheTFbJGldKSkpICYmCiAgICAgICAgICAgICAgICAoKGlzX251bWVyaWMoJGFycmF5MlskaV0pKSAmJiAoIWlzX3N0cmluZygkYXJyYXkyWyRpXSkpKSkgewogICAgICAgICAgICAgICAgJHJlc3VsdCArPSAoJGFycmF5MVskaV0gKiAkYXJyYXkxWyRpXSkgKyAoJGFycmF5MlskaV0gKiAkYXJyYXkyWyRpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKCiAgICAvKioKICAgICAqIFNVTVhNWTIKICAgICAqCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAkbWF0cml4RGF0YTEgICAgTWF0cml4ICMxCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAkbWF0cml4RGF0YTIgICAgTWF0cml4ICMyCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gU1VNWE1ZMigkbWF0cml4RGF0YTEsICRtYXRyaXhEYXRhMikKICAgIHsKICAgICAgICAkYXJyYXkxID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoJG1hdHJpeERhdGExKTsKICAgICAgICAkYXJyYXkyID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoJG1hdHJpeERhdGEyKTsKICAgICAgICAkY291bnQgPSBtaW4oY291bnQoJGFycmF5MSksIGNvdW50KCRhcnJheTIpKTsKCiAgICAgICAgJHJlc3VsdCA9IDA7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGNvdW50OyArKyRpKSB7CiAgICAgICAgICAgIGlmICgoKGlzX251bWVyaWMoJGFycmF5MVskaV0pKSAmJiAoIWlzX3N0cmluZygkYXJyYXkxWyRpXSkpKSAmJgogICAgICAgICAgICAgICAgKChpc19udW1lcmljKCRhcnJheTJbJGldKSkgJiYgKCFpc19zdHJpbmcoJGFycmF5MlskaV0pKSkpIHsKICAgICAgICAgICAgICAgICRyZXN1bHQgKz0gKCRhcnJheTFbJGldIC0gJGFycmF5MlskaV0pICogKCRhcnJheTFbJGldIC0gJGFycmF5MlskaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBUUlVOQwogICAgICoKICAgICAqIFRydW5jYXRlcyB2YWx1ZSB0byB0aGUgbnVtYmVyIG9mIGZyYWN0aW9uYWwgZGlnaXRzIGJ5IG51bWJlcl9kaWdpdHMuCiAgICAgKgogICAgICogQHBhcmFtICAgIGZsb2F0ICAgICAgICAkdmFsdWUKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICAgICAkZGlnaXRzCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0ICAgICAgICBUcnVuY2F0ZWQgdmFsdWUKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBUUlVOQygkdmFsdWUgPSAwLCAkZGlnaXRzID0gMCkKICAgIHsKICAgICAgICAkdmFsdWUgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkdmFsdWUpOwogICAgICAgICRkaWdpdHMgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkZGlnaXRzKTsKCiAgICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVycwogICAgICAgIGlmICgoIWlzX251bWVyaWMoJHZhbHVlKSkgfHwgKCFpc19udW1lcmljKCRkaWdpdHMpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KICAgICAgICAkZGlnaXRzID0gZmxvb3IoJGRpZ2l0cyk7CgogICAgICAgIC8vIFRydW5jYXRlCiAgICAgICAgJGFkanVzdCA9IHBvdygxMCwgJGRpZ2l0cyk7CgogICAgICAgIGlmICgoJGRpZ2l0cyA+IDApICYmIChydHJpbShpbnR2YWwoKGFicygkdmFsdWUpIC0gYWJzKGludHZhbCgkdmFsdWUpKSkgKiAkYWRqdXN0KSwgJzAnKSA8ICRhZGp1c3QvMTApKSB7CiAgICAgICAgICAgIHJldHVybiAkdmFsdWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKGludHZhbCgkdmFsdWUgKiAkYWRqdXN0KSkgLyAkYWRqdXN0OwogICAgfQp9Cg==",
    "size": "48250"
}