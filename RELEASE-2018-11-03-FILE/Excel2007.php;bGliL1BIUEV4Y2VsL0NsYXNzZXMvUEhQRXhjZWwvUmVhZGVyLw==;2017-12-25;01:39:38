{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Reader\/Excel2007.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KICAgIGRlZmluZSgnUEhQRVhDRUxfUk9PVCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8uLi8uLi8nKTsKICAgIHJlcXVpcmUoUEhQRVhDRUxfUk9PVCAuICdQSFBFeGNlbC9BdXRvbG9hZGVyLnBocCcpOwp9CgovKioKICogUEhQRXhjZWxfUmVhZGVyX0V4Y2VsMjAwNwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKICogdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBCiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsX1JlYWRlcgogKiBAY29weXJpZ2h0ICBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsIChodHRwOi8vd3d3LmNvZGVwbGV4LmNvbS9QSFBFeGNlbCkKICogQGxpY2Vuc2UgICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL29sZC1saWNlbnNlcy9sZ3BsLTIuMS50eHQgICAgTEdQTAogKiBAdmVyc2lvbiAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCmNsYXNzIFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDIwMDcgZXh0ZW5kcyBQSFBFeGNlbF9SZWFkZXJfQWJzdHJhY3QgaW1wbGVtZW50cyBQSFBFeGNlbF9SZWFkZXJfSVJlYWRlcgp7CiAgICAvKioKICAgICAqIFBIUEV4Y2VsX1JlZmVyZW5jZUhlbHBlciBpbnN0YW5jZQogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyCiAgICAgKi8KICAgIHByaXZhdGUgJHJlZmVyZW5jZUhlbHBlciA9IG51bGw7CgogICAgLyoqCiAgICAgKiBQSFBFeGNlbF9SZWFkZXJfRXhjZWwyMDA3X1RoZW1lIGluc3RhbmNlCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9SZWFkZXJfRXhjZWwyMDA3X1RoZW1lCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljICR0aGVtZSA9IG51bGw7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VsMjAwNyBpbnN0YW5jZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKQogICAgewogICAgICAgICR0aGlzLT5yZWFkRmlsdGVyID0gbmV3IFBIUEV4Y2VsX1JlYWRlcl9EZWZhdWx0UmVhZEZpbHRlcigpOwogICAgICAgICR0aGlzLT5yZWZlcmVuY2VIZWxwZXIgPSBQSFBFeGNlbF9SZWZlcmVuY2VIZWxwZXI6OmdldEluc3RhbmNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYW4gdGhlIGN1cnJlbnQgUEhQRXhjZWxfUmVhZGVyX0lSZWFkZXIgcmVhZCB0aGUgZmlsZT8KICAgICAqCiAgICAgKiBAcGFyYW0gICAgIHN0cmluZyAgICAgICAgICRwRmlsZW5hbWUKICAgICAqIEByZXR1cm4gICAgIGJvb2xlYW4KICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2FuUmVhZCgkcEZpbGVuYW1lKQogICAgewogICAgICAgIC8vIENoZWNrIGlmIGZpbGUgZXhpc3RzCiAgICAgICAgaWYgKCFmaWxlX2V4aXN0cygkcEZpbGVuYW1lKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbigiQ291bGQgbm90IG9wZW4gIiAuICRwRmlsZW5hbWUgLiAiIGZvciByZWFkaW5nISBGaWxlIGRvZXMgbm90IGV4aXN0LiIpOwogICAgICAgIH0KCiAgICAgICAgJHppcENsYXNzID0gUEhQRXhjZWxfU2V0dGluZ3M6OmdldFppcENsYXNzKCk7CgogICAgICAgIC8vIENoZWNrIGlmIHppcCBjbGFzcyBleGlzdHMKLy8gICAgICAgIGlmICghY2xhc3NfZXhpc3RzKCR6aXBDbGFzcywgZmFsc2UpKSB7Ci8vICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJHppcENsYXNzIC4gIiBsaWJyYXJ5IGlzIG5vdCBlbmFibGVkIik7Ci8vICAgICAgICB9CgogICAgICAgICR4bCA9IGZhbHNlOwogICAgICAgIC8vIExvYWQgZmlsZQogICAgICAgICR6aXAgPSBuZXcgJHppcENsYXNzOwogICAgICAgIGlmICgkemlwLT5vcGVuKCRwRmlsZW5hbWUpID09PSB0cnVlKSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGl0IGlzIGFuIE9PWE1MIGFyY2hpdmUKICAgICAgICAgICAgJHJlbHMgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgIl9yZWxzLy5yZWxzIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOwogICAgICAgICAgICBpZiAoJHJlbHMgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVscy0+UmVsYXRpb25zaGlwIGFzICRyZWwpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRyZWxbIlR5cGUiXSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL29mZmljZURvY3VtZW50IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlbmFtZSgkcmVsWyJUYXJnZXQiXSkgPT0gJ3dvcmtib29rLnhtbCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeGwgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkemlwLT5jbG9zZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR4bDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWFkcyBuYW1lcyBvZiB0aGUgd29ya3NoZWV0cyBmcm9tIGEgZmlsZSwgd2l0aG91dCBwYXJzaW5nIHRoZSB3aG9sZSBmaWxlIHRvIGEgUEhQRXhjZWwgb2JqZWN0CiAgICAgKgogICAgICogQHBhcmFtICAgICBzdHJpbmcgICAgICAgICAkcEZpbGVuYW1lCiAgICAgKiBAdGhyb3dzICAgICBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBsaXN0V29ya3NoZWV0TmFtZXMoJHBGaWxlbmFtZSkKICAgIHsKICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGV4aXN0cwogICAgICAgIGlmICghZmlsZV9leGlzdHMoJHBGaWxlbmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oIkNvdWxkIG5vdCBvcGVuICIgLiAkcEZpbGVuYW1lIC4gIiBmb3IgcmVhZGluZyEgRmlsZSBkb2VzIG5vdCBleGlzdC4iKTsKICAgICAgICB9CgogICAgICAgICR3b3Jrc2hlZXROYW1lcyA9IGFycmF5KCk7CgogICAgICAgICR6aXBDbGFzcyA9IFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRaaXBDbGFzcygpOwoKICAgICAgICAkemlwID0gbmV3ICR6aXBDbGFzczsKICAgICAgICAkemlwLT5vcGVuKCRwRmlsZW5hbWUpOwoKICAgICAgICAvLyAgICBUaGUgZmlsZXMgd2UncmUgbG9va2luZyBhdCBoZXJlIGFyZSBzbWFsbCBlbm91Z2ggdGhhdCBzaW1wbGVYTUwgaXMgbW9yZSBlZmZpY2llbnQgdGhhbiBYTUxSZWFkZXIKICAgICAgICAkcmVscyA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygKICAgICAgICAgICAgJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgIl9yZWxzLy5yZWxzIiksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSkKICAgICAgICApOyAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3BhY2thZ2UvMjAwNi9yZWxhdGlvbnNoaXBzIik7CiAgICAgICAgZm9yZWFjaCAoJHJlbHMtPlJlbGF0aW9uc2hpcCBhcyAkcmVsKSB7CiAgICAgICAgICAgIHN3aXRjaCAoJHJlbFsiVHlwZSJdKSB7CiAgICAgICAgICAgICAgICBjYXNlICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL29mZmljZURvY3VtZW50IjoKICAgICAgICAgICAgICAgICAgICAkeG1sV29ya2Jvb2sgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZWN1cml0eVNjYW4oJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICJ7JHJlbFsnVGFyZ2V0J119IiksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSkKICAgICAgICAgICAgICAgICAgICApOyAgLy9+IGh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9zcHJlYWRzaGVldG1sLzIwMDYvbWFpbiIpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbFdvcmtib29rLT5zaGVldHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFdvcmtib29rLT5zaGVldHMtPnNoZWV0IGFzICRlbGVTaGVldCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgc2hlZXQgc2hvdWxkIGJlIHNraXBwZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR3b3Jrc2hlZXROYW1lc1tdID0gKHN0cmluZykgJGVsZVNoZWV0WyJuYW1lIl07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICR6aXAtPmNsb3NlKCk7CgogICAgICAgIHJldHVybiAkd29ya3NoZWV0TmFtZXM7CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJuIHdvcmtzaGVldCBpbmZvIChOYW1lLCBMYXN0IENvbHVtbiBMZXR0ZXIsIExhc3QgQ29sdW1uIEluZGV4LCBUb3RhbCBSb3dzLCBUb3RhbCBDb2x1bW5zKQogICAgICoKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgJHBGaWxlbmFtZQogICAgICogQHRocm93cyAgIFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGxpc3RXb3Jrc2hlZXRJbmZvKCRwRmlsZW5hbWUpCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSBleGlzdHMKICAgICAgICBpZiAoIWZpbGVfZXhpc3RzKCRwRmlsZW5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCJDb3VsZCBub3Qgb3BlbiAiIC4gJHBGaWxlbmFtZSAuICIgZm9yIHJlYWRpbmchIEZpbGUgZG9lcyBub3QgZXhpc3QuIik7CiAgICAgICAgfQoKICAgICAgICAkd29ya3NoZWV0SW5mbyA9IGFycmF5KCk7CgogICAgICAgICR6aXBDbGFzcyA9IFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRaaXBDbGFzcygpOwoKICAgICAgICAkemlwID0gbmV3ICR6aXBDbGFzczsKICAgICAgICAkemlwLT5vcGVuKCRwRmlsZW5hbWUpOwoKICAgICAgICAkcmVscyA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCAiX3JlbHMvLnJlbHMiKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7IC8vfiBodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvcGFja2FnZS8yMDA2L3JlbGF0aW9uc2hpcHMiKTsKICAgICAgICBmb3JlYWNoICgkcmVscy0+UmVsYXRpb25zaGlwIGFzICRyZWwpIHsKICAgICAgICAgICAgaWYgKCRyZWxbIlR5cGUiXSA9PSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9vZmZpY2VEb2N1bWVudCIpIHsKICAgICAgICAgICAgICAgICRkaXIgPSBkaXJuYW1lKCRyZWxbIlRhcmdldCJdKTsKICAgICAgICAgICAgICAgICRyZWxzV29ya2Jvb2sgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgIiRkaXIvX3JlbHMvIiAuIGJhc2VuYW1lKCRyZWxbIlRhcmdldCJdKSAuICIucmVscyIpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKTsgIC8vfiBodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvcGFja2FnZS8yMDA2L3JlbGF0aW9uc2hpcHMiKTsKICAgICAgICAgICAgICAgICRyZWxzV29ya2Jvb2stPnJlZ2lzdGVyWFBhdGhOYW1lc3BhY2UoInJlbCIsICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvcGFja2FnZS8yMDA2L3JlbGF0aW9uc2hpcHMiKTsKCiAgICAgICAgICAgICAgICAkd29ya3NoZWV0cyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVsc1dvcmtib29rLT5SZWxhdGlvbnNoaXAgYXMgJGVsZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgkZWxlWyJUeXBlIl0gPT0gImh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9vZmZpY2VEb2N1bWVudC8yMDA2L3JlbGF0aW9uc2hpcHMvd29ya3NoZWV0IikgewogICAgICAgICAgICAgICAgICAgICAgICAkd29ya3NoZWV0c1soc3RyaW5nKSAkZWxlWyJJZCJdXSA9ICRlbGVbIlRhcmdldCJdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkeG1sV29ya2Jvb2sgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgInskcmVsWydUYXJnZXQnXX0iKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7ICAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3NwcmVhZHNoZWV0bWwvMjAwNi9tYWluIik7CiAgICAgICAgICAgICAgICBpZiAoJHhtbFdvcmtib29rLT5zaGVldHMpIHsKICAgICAgICAgICAgICAgICAgICAkZGlyID0gZGlybmFtZSgkcmVsWyJUYXJnZXQiXSk7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFdvcmtib29rLT5zaGVldHMtPnNoZWV0IGFzICRlbGVTaGVldCkgewogICAgICAgICAgICAgICAgICAgICAgICAkdG1wSW5mbyA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dvcmtzaGVldE5hbWUnID0+IChzdHJpbmcpICRlbGVTaGVldFsibmFtZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhc3RDb2x1bW5MZXR0ZXInID0+ICdBJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYXN0Q29sdW1uSW5kZXgnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxSb3dzJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsQ29sdW1ucycgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlV29ya3NoZWV0ID0gJHdvcmtzaGVldHNbKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCRlbGVTaGVldC0+YXR0cmlidXRlcygiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcyIpLCAiaWQiKV07CgogICAgICAgICAgICAgICAgICAgICAgICAkeG1sID0gbmV3IFhNTFJlYWRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAkcmVzID0gJHhtbC0+eG1sKCR0aGlzLT5zZWN1cml0eVNjYW5GaWxlKCd6aXA6Ly8nLlBIUEV4Y2VsX1NoYXJlZF9GaWxlOjpyZWFscGF0aCgkcEZpbGVuYW1lKS4nIycuIiRkaXIvJGZpbGVXb3Jrc2hlZXQiKSwgbnVsbCwgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICR4bWwtPnNldFBhcnNlclByb3BlcnR5KDIsIHRydWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGN1cnJDZWxscyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgkeG1sLT5yZWFkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sLT5uYW1lID09ICdyb3cnICYmICR4bWwtPm5vZGVUeXBlID09IFhNTFJlYWRlcjo6RUxFTUVOVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb3cgPSAkeG1sLT5nZXRBdHRyaWJ1dGUoJ3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG1wSW5mb1sndG90YWxSb3dzJ10gPSAkcm93OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0bXBJbmZvWyd0b3RhbENvbHVtbnMnXSA9IG1heCgkdG1wSW5mb1sndG90YWxDb2x1bW5zJ10sICRjdXJyQ2VsbHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjdXJyQ2VsbHMgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCR4bWwtPm5hbWUgPT0gJ2MnICYmICR4bWwtPm5vZGVUeXBlID09IFhNTFJlYWRlcjo6RUxFTUVOVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjdXJyQ2VsbHMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkdG1wSW5mb1sndG90YWxDb2x1bW5zJ10gPSBtYXgoJHRtcEluZm9bJ3RvdGFsQ29sdW1ucyddLCAkY3VyckNlbGxzKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHhtbC0+Y2xvc2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uSW5kZXgnXSA9ICR0bXBJbmZvWyd0b3RhbENvbHVtbnMnXSAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uTGV0dGVyJ10gPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHRtcEluZm9bJ2xhc3RDb2x1bW5JbmRleCddKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICR3b3Jrc2hlZXRJbmZvW10gPSAkdG1wSW5mbzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICR6aXAtPmNsb3NlKCk7CgogICAgICAgIHJldHVybiAkd29ya3NoZWV0SW5mbzsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBjYXN0VG9Cb29sZWFuKCRjKQogICAgewovLyAgICAgICAgZWNobyAnSW5pdGlhbCBDYXN0IHRvIEJvb2xlYW4nLCBQSFBfRU9MOwogICAgICAgICR2YWx1ZSA9IGlzc2V0KCRjLT52KSA\/IChzdHJpbmcpICRjLT52IDogbnVsbDsKICAgICAgICBpZiAoJHZhbHVlID09ICcwJykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlaWYgKCR2YWx1ZSA9PSAnMScpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIChib29sKSRjLT52OwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHZhbHVlOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGNhc3RUb0Vycm9yKCRjKQogICAgewovLyAgICAgICAgZWNobyAnSW5pdGlhbCBDYXN0IHRvIEVycm9yJywgUEhQX0VPTDsKICAgICAgICByZXR1cm4gaXNzZXQoJGMtPnYpID8gKHN0cmluZykgJGMtPnYgOiBudWxsOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGNhc3RUb1N0cmluZygkYykKICAgIHsKLy8gICAgICAgIGVjaG8gJ0luaXRpYWwgQ2FzdCB0byBTdHJpbmcsIFBIUF9FT0w7CiAgICAgICAgcmV0dXJuIGlzc2V0KCRjLT52KSA\/IChzdHJpbmcpICRjLT52IDogbnVsbDsKICAgIH0KCiAgICBwcml2YXRlIGZ1bmN0aW9uIGNhc3RUb0Zvcm11bGEoJGMsICRyLCAmJGNlbGxEYXRhVHlwZSwgJiR2YWx1ZSwgJiRjYWxjdWxhdGVkVmFsdWUsICYkc2hhcmVkRm9ybXVsYXMsICRjYXN0QmFzZVR5cGUpCiAgICB7Ci8vICAgICAgICBlY2hvICdGb3JtdWxhJywgUEhQX0VPTDsKLy8gICAgICAgIGVjaG8gJyRjLT5mIGlzICcsICRjLT5mLCBQSFBfRU9MOwogICAgICAgICRjZWxsRGF0YVR5cGUgICAgICAgPSAnZic7CiAgICAgICAgJHZhbHVlICAgICAgICAgICAgICA9ICI9eyRjLT5mfSI7CiAgICAgICAgJGNhbGN1bGF0ZWRWYWx1ZSAgICA9IHNlbGY6OiRjYXN0QmFzZVR5cGUoJGMpOwoKICAgICAgICAvLyBTaGFyZWQgZm9ybXVsYT8KICAgICAgICBpZiAoaXNzZXQoJGMtPmZbJ3QnXSkgJiYgc3RydG9sb3dlcigoc3RyaW5nKSRjLT5mWyd0J10pID09ICdzaGFyZWQnKSB7Ci8vICAgICAgICAgICAgZWNobyAnU0hBUkVEIEZPUk1VTEEnLCBQSFBfRU9MOwogICAgICAgICAgICAkaW5zdGFuY2UgPSAoc3RyaW5nKSRjLT5mWydzaSddOwoKLy8gICAgICAgICAgICBlY2hvICdJbnN0YW5jZSBJRCA9ICcsICRpbnN0YW5jZSwgUEhQX0VPTDsKLy8KLy8gICAgICAgICAgICBlY2hvICdTaGFyZWQgRm9ybXVsYSBBcnJheTonLCBQSFBfRU9MOwovLyAgICAgICAgICAgIHByaW50X3IoJHNoYXJlZEZvcm11bGFzKTsKICAgICAgICAgICAgaWYgKCFpc3NldCgkc2hhcmVkRm9ybXVsYXNbKHN0cmluZykkYy0+Zlsnc2knXV0pKSB7Ci8vICAgICAgICAgICAgICAgIGVjaG8gJ1NFVFRJTkcgTkVXIFNIQVJFRCBGT1JNVUxBJywgUEhQX0VPTDsKLy8gICAgICAgICAgICAgICAgZWNobyAnTWFzdGVyIGlzICcsICRyLCBQSFBfRU9MOwovLyAgICAgICAgICAgICAgICBlY2hvICdGb3JtdWxhIGlzICcsICR2YWx1ZSwgUEhQX0VPTDsKICAgICAgICAgICAgICAgICRzaGFyZWRGb3JtdWxhc1skaW5zdGFuY2VdID0gYXJyYXkoJ21hc3RlcicgPT4gJHIsICdmb3JtdWxhJyA9PiAkdmFsdWUpOwovLyAgICAgICAgICAgICAgICBlY2hvICdOZXcgU2hhcmVkIEZvcm11bGEgQXJyYXk6JywgUEhQX0VPTDsKLy8gICAgICAgICAgICAgICAgcHJpbnRfcigkc2hhcmVkRm9ybXVsYXMpOwogICAgICAgICAgICB9IGVsc2UgewovLyAgICAgICAgICAgICAgICBlY2hvICdHRVRUSU5HIFNIQVJFRCBGT1JNVUxBJywgUEhQX0VPTDsKLy8gICAgICAgICAgICAgICAgZWNobyAnTWFzdGVyIGlzICcsICRzaGFyZWRGb3JtdWxhc1skaW5zdGFuY2VdWydtYXN0ZXInXSwgUEhQX0VPTDsKLy8gICAgICAgICAgICAgICAgZWNobyAnRm9ybXVsYSBpcyAnLCAkc2hhcmVkRm9ybXVsYXNbJGluc3RhbmNlXVsnZm9ybXVsYSddLCBQSFBfRU9MOwogICAgICAgICAgICAgICAgJG1hc3RlciA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRzaGFyZWRGb3JtdWxhc1skaW5zdGFuY2VdWydtYXN0ZXInXSk7CiAgICAgICAgICAgICAgICAkY3VycmVudCA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRyKTsKCiAgICAgICAgICAgICAgICAkZGlmZmVyZW5jZSA9IGFycmF5KDAsIDApOwogICAgICAgICAgICAgICAgJGRpZmZlcmVuY2VbMF0gPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGN1cnJlbnRbMF0pIC0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRtYXN0ZXJbMF0pOwogICAgICAgICAgICAgICAgJGRpZmZlcmVuY2VbMV0gPSAkY3VycmVudFsxXSAtICRtYXN0ZXJbMV07CgogICAgICAgICAgICAgICAgJHZhbHVlID0gJHRoaXMtPnJlZmVyZW5jZUhlbHBlci0+dXBkYXRlRm9ybXVsYVJlZmVyZW5jZXMoJHNoYXJlZEZvcm11bGFzWyRpbnN0YW5jZV1bJ2Zvcm11bGEnXSwgJ0ExJywgJGRpZmZlcmVuY2VbMF0sICRkaWZmZXJlbmNlWzFdKTsKLy8gICAgICAgICAgICAgICAgZWNobyAnQWRqdXN0ZWQgRm9ybXVsYSBpcyAnLCAkdmFsdWUsIFBIUF9FT0w7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIHByaXZhdGUgZnVuY3Rpb24gZ2V0RnJvbVppcEFyY2hpdmUoJGFyY2hpdmUsICRmaWxlTmFtZSA9ICcnKQogICAgewogICAgICAgIC8vIFJvb3QtcmVsYXRpdmUgcGF0aHMKICAgICAgICBpZiAoc3RycG9zKCRmaWxlTmFtZSwgJy8vJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICRmaWxlTmFtZSA9IHN1YnN0cigkZmlsZU5hbWUsIHN0cnBvcygkZmlsZU5hbWUsICcvLycpICsgMSk7CiAgICAgICAgfQogICAgICAgICRmaWxlTmFtZSA9IFBIUEV4Y2VsX1NoYXJlZF9GaWxlOjpyZWFscGF0aCgkZmlsZU5hbWUpOwoKICAgICAgICAvLyBTYWRseSwgc29tZSAzcmQgcGFydHkgeGxzeCBnZW5lcmF0b3JzIGRvbid0IHVzZSBjb25zaXN0ZW50IGNhc2UgZm9yIGZpbGVuYW1pbmcKICAgICAgICAvLyAgICBzbyB3ZSBuZWVkIHRvIGxvYWQgY2FzZS1pbnNlbnNpdGl2ZWx5IGZyb20gdGhlIHppcCBmaWxlCiAgICAgICAgCiAgICAgICAgLy8gQXBhY2hlIFBPSSBmaXhlcwogICAgICAgICRjb250ZW50cyA9ICRhcmNoaXZlLT5nZXRGcm9tSW5kZXgoCiAgICAgICAgICAgICRhcmNoaXZlLT5sb2NhdGVOYW1lKCRmaWxlTmFtZSwgWklQQVJDSElWRTo6RkxfTk9DQVNFKQogICAgICAgICk7CiAgICAgICAgaWYgKCRjb250ZW50cyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgJGNvbnRlbnRzID0gJGFyY2hpdmUtPmdldEZyb21JbmRleCgKICAgICAgICAgICAgICAgICRhcmNoaXZlLT5sb2NhdGVOYW1lKHN1YnN0cigkZmlsZU5hbWUsIDEpLCBaSVBBUkNISVZFOjpGTF9OT0NBU0UpCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGNvbnRlbnRzOwogICAgfQoKCiAgICAvKioKICAgICAqIExvYWRzIFBIUEV4Y2VsIGZyb20gZmlsZQogICAgICoKICAgICAqIEBwYXJhbSAgICAgc3RyaW5nICAgICAgICAgJHBGaWxlbmFtZQogICAgICogQHJldHVybiAgUEhQRXhjZWwKICAgICAqIEB0aHJvd3MgICAgIFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGxvYWQoJHBGaWxlbmFtZSkKICAgIHsKICAgICAgICAvLyBDaGVjayBpZiBmaWxlIGV4aXN0cwogICAgICAgIGlmICghZmlsZV9leGlzdHMoJHBGaWxlbmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oIkNvdWxkIG5vdCBvcGVuICIgLiAkcEZpbGVuYW1lIC4gIiBmb3IgcmVhZGluZyEgRmlsZSBkb2VzIG5vdCBleGlzdC4iKTsKICAgICAgICB9CgogICAgICAgIC8vIEluaXRpYWxpc2F0aW9ucwogICAgICAgICRleGNlbCA9IG5ldyBQSFBFeGNlbDsKICAgICAgICAkZXhjZWwtPnJlbW92ZVNoZWV0QnlJbmRleCgwKTsKICAgICAgICBpZiAoISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgJGV4Y2VsLT5yZW1vdmVDZWxsU3R5bGVYZkJ5SW5kZXgoMCk7IC8vIHJlbW92ZSB0aGUgZGVmYXVsdCBzdHlsZQogICAgICAgICAgICAkZXhjZWwtPnJlbW92ZUNlbGxYZkJ5SW5kZXgoMCk7IC8vIHJlbW92ZSB0aGUgZGVmYXVsdCBzdHlsZQogICAgICAgIH0KCiAgICAgICAgJHppcENsYXNzID0gUEhQRXhjZWxfU2V0dGluZ3M6OmdldFppcENsYXNzKCk7CgogICAgICAgICR6aXAgPSBuZXcgJHppcENsYXNzOwogICAgICAgICR6aXAtPm9wZW4oJHBGaWxlbmFtZSk7CgogICAgICAgIC8vICAgIFJlYWQgdGhlIHRoZW1lIGZpcnN0LCBiZWNhdXNlIHdlIG5lZWQgdGhlIGNvbG91ciBzY2hlbWUgd2hlbiByZWFkaW5nIHRoZSBzdHlsZXMKICAgICAgICAkd2JSZWxzID0gc2ltcGxleG1sX2xvYWRfc3RyaW5nKCR0aGlzLT5zZWN1cml0eVNjYW4oJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICJ4bC9fcmVscy93b3JrYm9vay54bWwucmVscyIpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKTsgLy9+IGh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9wYWNrYWdlLzIwMDYvcmVsYXRpb25zaGlwcyIpOwogICAgICAgIGZvcmVhY2ggKCR3YlJlbHMtPlJlbGF0aW9uc2hpcCBhcyAkcmVsKSB7CiAgICAgICAgICAgIHN3aXRjaCAoJHJlbFsiVHlwZSJdKSB7CiAgICAgICAgICAgICAgICBjYXNlICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL3RoZW1lIjoKICAgICAgICAgICAgICAgICAgICAkdGhlbWVPcmRlckFycmF5ID0gYXJyYXkoJ2x0MScsICdkazEnLCAnbHQyJywgJ2RrMicpOwogICAgICAgICAgICAgICAgICAgICR0aGVtZU9yZGVyQWRkaXRpb25hbCA9IGNvdW50KCR0aGVtZU9yZGVyQXJyYXkpOwoKICAgICAgICAgICAgICAgICAgICAkeG1sVGhlbWUgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgInhsL3skcmVsWydUYXJnZXQnXX0iKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX29iamVjdCgkeG1sVGhlbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR4bWxUaGVtZU5hbWUgPSAkeG1sVGhlbWUtPmF0dHJpYnV0ZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHhtbFRoZW1lID0gJHhtbFRoZW1lLT5jaGlsZHJlbigiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL2RyYXdpbmdtbC8yMDA2L21haW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoZW1lTmFtZSA9IChzdHJpbmcpJHhtbFRoZW1lTmFtZVsnbmFtZSddOwoKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbG91clNjaGVtZSA9ICR4bWxUaGVtZS0+dGhlbWVFbGVtZW50cy0+Y2xyU2NoZW1lLT5hdHRyaWJ1dGVzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb2xvdXJTY2hlbWVOYW1lID0gKHN0cmluZykkY29sb3VyU2NoZW1lWyduYW1lJ107CiAgICAgICAgICAgICAgICAgICAgICAgICRjb2xvdXJTY2hlbWUgPSAkeG1sVGhlbWUtPnRoZW1lRWxlbWVudHMtPmNsclNjaGVtZS0+Y2hpbGRyZW4oImh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9kcmF3aW5nbWwvMjAwNi9tYWluIik7CgogICAgICAgICAgICAgICAgICAgICAgICAkdGhlbWVDb2xvdXJzID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGNvbG91clNjaGVtZSBhcyAkayA9PiAkeG1sQ29sb3VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhlbWVQb3MgPSBhcnJheV9zZWFyY2goJGssICR0aGVtZU9yZGVyQXJyYXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGVtZVBvcyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhlbWVQb3MgPSAkdGhlbWVPcmRlckFkZGl0aW9uYWwrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sQ29sb3VyLT5zeXNDbHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHhtbENvbG91ckRhdGEgPSAkeG1sQ29sb3VyLT5zeXNDbHItPmF0dHJpYnV0ZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhlbWVDb2xvdXJzWyR0aGVtZVBvc10gPSAkeG1sQ29sb3VyRGF0YVsnbGFzdENsciddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCR4bWxDb2xvdXItPnNyZ2JDbHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHhtbENvbG91ckRhdGEgPSAkeG1sQ29sb3VyLT5zcmdiQ2xyLT5hdHRyaWJ1dGVzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoZW1lQ29sb3Vyc1skdGhlbWVQb3NdID0gJHhtbENvbG91ckRhdGFbJ3ZhbCddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6OiR0aGVtZSA9IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZWwyMDA3X1RoZW1lKCR0aGVtZU5hbWUsICRjb2xvdXJTY2hlbWVOYW1lLCAkdGhlbWVDb2xvdXJzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRyZWxzID0gc2ltcGxleG1sX2xvYWRfc3RyaW5nKCR0aGlzLT5zZWN1cml0eVNjYW4oJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICJfcmVscy8ucmVscyIpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKTsgLy9+IGh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9wYWNrYWdlLzIwMDYvcmVsYXRpb25zaGlwcyIpOwogICAgICAgIGZvcmVhY2ggKCRyZWxzLT5SZWxhdGlvbnNoaXAgYXMgJHJlbCkgewogICAgICAgICAgICBzd2l0Y2ggKCRyZWxbIlR5cGUiXSkgewogICAgICAgICAgICAgICAgY2FzZSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3BhY2thZ2UvMjAwNi9yZWxhdGlvbnNoaXBzL21ldGFkYXRhL2NvcmUtcHJvcGVydGllcyI6CiAgICAgICAgICAgICAgICAgICAgJHhtbENvcmUgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgInskcmVsWydUYXJnZXQnXX0iKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX29iamVjdCgkeG1sQ29yZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHhtbENvcmUtPnJlZ2lzdGVyWFBhdGhOYW1lc3BhY2UoImRjIiwgImh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIik7CiAgICAgICAgICAgICAgICAgICAgICAgICR4bWxDb3JlLT5yZWdpc3RlclhQYXRoTmFtZXNwYWNlKCJkY3Rlcm1zIiwgImh0dHA6Ly9wdXJsLm9yZy9kYy90ZXJtcy8iKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHhtbENvcmUtPnJlZ2lzdGVyWFBhdGhOYW1lc3BhY2UoImNwIiwgImh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9wYWNrYWdlLzIwMDYvbWV0YWRhdGEvY29yZS1wcm9wZXJ0aWVzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQcm9wcyA9ICRleGNlbC0+Z2V0UHJvcGVydGllcygpOwogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldENyZWF0b3IoKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCR4bWxDb3JlLT54cGF0aCgiZGM6Y3JlYXRvciIpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQcm9wcy0+c2V0TGFzdE1vZGlmaWVkQnkoKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCR4bWxDb3JlLT54cGF0aCgiY3A6bGFzdE1vZGlmaWVkQnkiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldENyZWF0ZWQoc3RydG90aW1lKHNlbGY6OmdldEFycmF5SXRlbSgkeG1sQ29yZS0+eHBhdGgoImRjdGVybXM6Y3JlYXRlZCIpKSkpOyAvLyEgcmVzcGVjdCB4c2k6dHlwZQogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldE1vZGlmaWVkKHN0cnRvdGltZShzZWxmOjpnZXRBcnJheUl0ZW0oJHhtbENvcmUtPnhwYXRoKCJkY3Rlcm1zOm1vZGlmaWVkIikpKSk7IC8vISByZXNwZWN0IHhzaTp0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQcm9wcy0+c2V0VGl0bGUoKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCR4bWxDb3JlLT54cGF0aCgiZGM6dGl0bGUiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldERlc2NyaXB0aW9uKChzdHJpbmcpIHNlbGY6OmdldEFycmF5SXRlbSgkeG1sQ29yZS0+eHBhdGgoImRjOmRlc2NyaXB0aW9uIikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXRTdWJqZWN0KChzdHJpbmcpIHNlbGY6OmdldEFycmF5SXRlbSgkeG1sQ29yZS0+eHBhdGgoImRjOnN1YmplY3QiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldEtleXdvcmRzKChzdHJpbmcpIHNlbGY6OmdldEFycmF5SXRlbSgkeG1sQ29yZS0+eHBhdGgoImNwOmtleXdvcmRzIikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXRDYXRlZ29yeSgoc3RyaW5nKSBzZWxmOjpnZXRBcnJheUl0ZW0oJHhtbENvcmUtPnhwYXRoKCJjcDpjYXRlZ29yeSIpKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9leHRlbmRlZC1wcm9wZXJ0aWVzIjoKICAgICAgICAgICAgICAgICAgICAkeG1sQ29yZSA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCAieyRyZWxbJ1RhcmdldCddfSIpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNfb2JqZWN0KCR4bWxDb3JlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMgPSAkZXhjZWwtPmdldFByb3BlcnRpZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxDb3JlLT5Db21wYW55KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXRDb21wYW55KChzdHJpbmcpICR4bWxDb3JlLT5Db21wYW55KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbENvcmUtPk1hbmFnZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldE1hbmFnZXIoKHN0cmluZykgJHhtbENvcmUtPk1hbmFnZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9jdXN0b20tcHJvcGVydGllcyI6CiAgICAgICAgICAgICAgICAgICAgJHhtbENvcmUgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgInskcmVsWydUYXJnZXQnXX0iKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX29iamVjdCgkeG1sQ29yZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzID0gJGV4Y2VsLT5nZXRQcm9wZXJ0aWVzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR4bWxDb3JlIGFzICR4bWxQcm9wZXJ0eSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhT2ZmaWNlQXR0cmlidXRlcyA9ICR4bWxQcm9wZXJ0eS0+YXR0cmlidXRlcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRjZWxsRGF0YU9mZmljZUF0dHJpYnV0ZXNbJ25hbWUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHJvcGVydHlOYW1lID0gKHN0cmluZykgJGNlbGxEYXRhT2ZmaWNlQXR0cmlidXRlc1snbmFtZSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YU9mZmljZUNoaWxkcmVuID0gJHhtbFByb3BlcnR5LT5jaGlsZHJlbignaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvZG9jUHJvcHNWVHlwZXMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0cmlidXRlVHlwZSA9ICRjZWxsRGF0YU9mZmljZUNoaWxkcmVuLT5nZXROYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF0dHJpYnV0ZVZhbHVlID0gKHN0cmluZykgJGNlbGxEYXRhT2ZmaWNlQ2hpbGRyZW4tPnskYXR0cmlidXRlVHlwZX07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF0dHJpYnV0ZVZhbHVlID0gUEhQRXhjZWxfRG9jdW1lbnRQcm9wZXJ0aWVzOjpjb252ZXJ0UHJvcGVydHkoJGF0dHJpYnV0ZVZhbHVlLCAkYXR0cmlidXRlVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF0dHJpYnV0ZVR5cGUgPSBQSFBFeGNlbF9Eb2N1bWVudFByb3BlcnRpZXM6OmNvbnZlcnRQcm9wZXJ0eVR5cGUoJGF0dHJpYnV0ZVR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQcm9wcy0+c2V0Q3VzdG9tUHJvcGVydHkoJHByb3BlcnR5TmFtZSwgJGF0dHJpYnV0ZVZhbHVlLCAkYXR0cmlidXRlVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvL1JpYmJvbgogICAgICAgICAgICAgICAgY2FzZSAiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS9vZmZpY2UvMjAwNi9yZWxhdGlvbnNoaXBzL3VpL2V4dGVuc2liaWxpdHkiOgogICAgICAgICAgICAgICAgICAgICRjdXN0b21VSSA9ICRyZWxbJ1RhcmdldCddOwogICAgICAgICAgICAgICAgICAgIGlmICghaXNfbnVsbCgkY3VzdG9tVUkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZWFkUmliYm9uKCRleGNlbCwgJGN1c3RvbVVJLCAkemlwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL29mZmljZURvY3VtZW50IjoKICAgICAgICAgICAgICAgICAgICAkZGlyID0gZGlybmFtZSgkcmVsWyJUYXJnZXQiXSk7CiAgICAgICAgICAgICAgICAgICAgJHJlbHNXb3JrYm9vayA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCAiJGRpci9fcmVscy8iIC4gYmFzZW5hbWUoJHJlbFsiVGFyZ2V0Il0pIC4gIi5yZWxzIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOyAgLy9+IGh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9wYWNrYWdlLzIwMDYvcmVsYXRpb25zaGlwcyIpOwogICAgICAgICAgICAgICAgICAgICRyZWxzV29ya2Jvb2stPnJlZ2lzdGVyWFBhdGhOYW1lc3BhY2UoInJlbCIsICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvcGFja2FnZS8yMDA2L3JlbGF0aW9uc2hpcHMiKTsKCiAgICAgICAgICAgICAgICAgICAgJHNoYXJlZFN0cmluZ3MgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICR4cGF0aCA9IHNlbGY6OmdldEFycmF5SXRlbSgkcmVsc1dvcmtib29rLT54cGF0aCgicmVsOlJlbGF0aW9uc2hpcFtAVHlwZT0naHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9zaGFyZWRTdHJpbmdzJ10iKSk7CiAgICAgICAgICAgICAgICAgICAgJHhtbFN0cmluZ3MgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgIiRkaXIvJHhwYXRoW1RhcmdldF0iKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7ICAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3NwcmVhZHNoZWV0bWwvMjAwNi9tYWluIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTdHJpbmdzKSAmJiBpc3NldCgkeG1sU3RyaW5ncy0+c2kpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR4bWxTdHJpbmdzLT5zaSBhcyAkdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZhbC0+dCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhcmVkU3RyaW5nc1tdID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q29udHJvbENoYXJhY3Rlck9PWE1MMlBIUCgoc3RyaW5nKSAkdmFsLT50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChpc3NldCgkdmFsLT5yKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFyZWRTdHJpbmdzW10gPSAkdGhpcy0+cGFyc2VSaWNoVGV4dCgkdmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJHdvcmtzaGVldHMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICRtYWNyb3MgPSAkY3VzdG9tVUkgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZWxzV29ya2Jvb2stPlJlbGF0aW9uc2hpcCBhcyAkZWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoJGVsZVsnVHlwZSddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL3dvcmtzaGVldCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdvcmtzaGVldHNbKHN0cmluZykgJGVsZVsiSWQiXV0gPSAkZWxlWyJUYXJnZXQiXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGEgdmJhUHJvamVjdCA\/ICg6IHNvbWUgbWFjcm9zKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS9vZmZpY2UvMjAwNi9yZWxhdGlvbnNoaXBzL3ZiYVByb2plY3QiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtYWNyb3MgPSAkZWxlWyJUYXJnZXQiXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc19udWxsKCRtYWNyb3MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtYWNyb3NDb2RlID0gJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICd4bC92YmFQcm9qZWN0LmJpbicpOy8vdmJhUHJvamVjdC5iaW4gYWx3YXlzIGluICd4bCcgZGlyIGFuZCBhbHdheXMgbmFtZWQgdmJhUHJvamVjdC5iaW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRtYWNyb3NDb2RlICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4Y2VsLT5zZXRNYWNyb3NDb2RlKCRtYWNyb3NDb2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleGNlbC0+c2V0SGFzTWFjcm9zKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zaG9ydC1jaXJjdWl0IDogbm90IHJlYWRpbmcgdmJhUHJvamVjdC5iaW4ucmVsIHRvIGdldCBTaWduYXR1cmUgPT5hbGx3YXlzIHZiYVByb2plY3RTaWduYXR1cmUuYmluIGluICd4bCcgZGlyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ2VydGlmaWNhdGUgPSAkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgJ3hsL3ZiYVByb2plY3RTaWduYXR1cmUuYmluJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJENlcnRpZmljYXRlICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleGNlbC0+c2V0TWFjcm9zQ2VydGlmaWNhdGUoJENlcnRpZmljYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkc3R5bGVzICAgICA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgJGNlbGxTdHlsZXMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICR4cGF0aCA9IHNlbGY6OmdldEFycmF5SXRlbSgkcmVsc1dvcmtib29rLT54cGF0aCgicmVsOlJlbGF0aW9uc2hpcFtAVHlwZT0naHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9zdHlsZXMnXSIpKTsKICAgICAgICAgICAgICAgICAgICAkeG1sU3R5bGVzID0gc2ltcGxleG1sX2xvYWRfc3RyaW5nKCR0aGlzLT5zZWN1cml0eVNjYW4oJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICIkZGlyLyR4cGF0aFtUYXJnZXRdIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOwogICAgICAgICAgICAgICAgICAgIC8vfiBodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvc3ByZWFkc2hlZXRtbC8yMDA2L21haW4iKTsKCiAgICAgICAgICAgICAgICAgICAgJG51bUZtdHMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmICgkeG1sU3R5bGVzICYmICR4bWxTdHlsZXMtPm51bUZtdHNbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG51bUZtdHMgPSAkeG1sU3R5bGVzLT5udW1GbXRzWzBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJG51bUZtdHMpICYmICgkbnVtRm10cyAhPT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG51bUZtdHMtPnJlZ2lzdGVyWFBhdGhOYW1lc3BhY2UoInNtbCIsICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvc3ByZWFkc2hlZXRtbC8yMDA2L21haW4iKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5ICYmICR4bWxTdHlsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFN0eWxlcy0+Y2VsbFhmcy0+eGYgYXMgJHhmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbnVtRm10ID0gUEhQRXhjZWxfU3R5bGVfTnVtYmVyRm9ybWF0OjpGT1JNQVRfR0VORVJBTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeGZbIm51bUZtdElkIl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJG51bUZtdHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0bXBOdW1GbXQgPSBzZWxmOjpnZXRBcnJheUl0ZW0oJG51bUZtdHMtPnhwYXRoKCJzbWw6bnVtRm10W0BudW1GbXRJZD0keGZbbnVtRm10SWRdXSIpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdG1wTnVtRm10WyJmb3JtYXRDb2RlIl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbnVtRm10ID0gKHN0cmluZykgJHRtcE51bUZtdFsiZm9ybWF0Q29kZSJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBzaG91bGRuJ3Qgb3ZlcnJpZGUgYW55IG9mIHRoZSBidWlsdC1pbiBNUyBFeGNlbCB2YWx1ZXMgKHZhbHVlcyBiZWxvdyBpZCAxNjQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIEJ1dCB0aGVyZSdzIGEgbG90IG9mIG5hdWdodHkgaG9tZWJyZXcgeGxzeCB3cml0ZXJzIHRoYXQgZG8gdXNlICJyZXNlcnZlZCIgaWQgdmFsdWVzIHRoYXQgYXJlbid0IGFjdHVhbGx5IHVzZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgU28gd2UgbWFrZSBhbGxvd2FuY2UgZm9yIHRoZW0gcmF0aGVyIHRoYW4gbG9zZSBmb3JtYXR0aW5nIG1hc2tzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChpbnQpJHhmWyJudW1GbXRJZCJdIDwgMTY0ICYmIFBIUEV4Y2VsX1N0eWxlX051bWJlckZvcm1hdDo6YnVpbHRJbkZvcm1hdENvZGUoKGludCkkeGZbIm51bUZtdElkIl0pICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbnVtRm10ID0gUEhQRXhjZWxfU3R5bGVfTnVtYmVyRm9ybWF0OjpidWlsdEluRm9ybWF0Q29kZSgoaW50KSR4ZlsibnVtRm10SWQiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1b3RlUHJlZml4ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhmWyJxdW90ZVByZWZpeCJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdW90ZVByZWZpeCA9IChib29sZWFuKSAkeGZbInF1b3RlUHJlZml4Il07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlID0gKG9iamVjdCkgYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm51bUZtdCIgPT4gJG51bUZtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZm9udCIgPT4gJHhtbFN0eWxlcy0+Zm9udHMtPmZvbnRbaW50dmFsKCR4ZlsiZm9udElkIl0pXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmlsbCIgPT4gJHhtbFN0eWxlcy0+ZmlsbHMtPmZpbGxbaW50dmFsKCR4ZlsiZmlsbElkIl0pXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYm9yZGVyIiA9PiAkeG1sU3R5bGVzLT5ib3JkZXJzLT5ib3JkZXJbaW50dmFsKCR4ZlsiYm9yZGVySWQiXSldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhbGlnbm1lbnQiID0+ICR4Zi0+YWxpZ25tZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcm90ZWN0aW9uIiA9PiAkeGYtPnByb3RlY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInF1b3RlUHJlZml4IiA9PiAkcXVvdGVQcmVmaXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlc1tdID0gJHN0eWxlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBzdHlsZSB0byBjZWxsWGYgY29sbGVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialN0eWxlID0gbmV3IFBIUEV4Y2VsX1N0eWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjo6cmVhZFN0eWxlKCRvYmpTdHlsZSwgJHN0eWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleGNlbC0+YWRkQ2VsbFhmKCRvYmpTdHlsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR4bWxTdHlsZXMtPmNlbGxTdHlsZVhmcy0+eGYgYXMgJHhmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbnVtRm10ID0gUEhQRXhjZWxfU3R5bGVfTnVtYmVyRm9ybWF0OjpGT1JNQVRfR0VORVJBTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbnVtRm10cyAmJiAkeGZbIm51bUZtdElkIl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG1wTnVtRm10ID0gc2VsZjo6Z2V0QXJyYXlJdGVtKCRudW1GbXRzLT54cGF0aCgic21sOm51bUZtdFtAbnVtRm10SWQ9JHhmW251bUZtdElkXV0iKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0bXBOdW1GbXRbImZvcm1hdENvZGUiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG51bUZtdCA9IChzdHJpbmcpICR0bXBOdW1GbXRbImZvcm1hdENvZGUiXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoKGludCkkeGZbIm51bUZtdElkIl0gPCAxNjUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG51bUZtdCA9IFBIUEV4Y2VsX1N0eWxlX051bWJlckZvcm1hdDo6YnVpbHRJbkZvcm1hdENvZGUoKGludCkkeGZbIm51bUZtdElkIl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbFN0eWxlID0gKG9iamVjdCkgYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm51bUZtdCIgPT4gJG51bUZtdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZm9udCIgPT4gJHhtbFN0eWxlcy0+Zm9udHMtPmZvbnRbaW50dmFsKCR4ZlsiZm9udElkIl0pXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmlsbCIgPT4gJHhtbFN0eWxlcy0+ZmlsbHMtPmZpbGxbaW50dmFsKCR4ZlsiZmlsbElkIl0pXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYm9yZGVyIiA9PiAkeG1sU3R5bGVzLT5ib3JkZXJzLT5ib3JkZXJbaW50dmFsKCR4ZlsiYm9yZGVySWQiXSldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhbGlnbm1lbnQiID0+ICR4Zi0+YWxpZ25tZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcm90ZWN0aW9uIiA9PiAkeGYtPnByb3RlY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInF1b3RlUHJlZml4IiA9PiAkcXVvdGVQcmVmaXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxTdHlsZXNbXSA9ICRjZWxsU3R5bGU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHN0eWxlIHRvIGNlbGxTdHlsZVhmIGNvbGxlY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpTdHlsZSA9IG5ldyBQSFBFeGNlbF9TdHlsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6OnJlYWRTdHlsZSgkb2JqU3R5bGUsICRjZWxsU3R5bGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4Y2VsLT5hZGRDZWxsU3R5bGVYZigkb2JqU3R5bGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkZHhmcyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5ICYmICR4bWxTdHlsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgQ29uZGl0aW9uYWwgU3R5bGVzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sU3R5bGVzLT5keGZzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkeG1sU3R5bGVzLT5keGZzLT5keGYgYXMgJGR4ZikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdHlsZSA9IG5ldyBQSFBFeGNlbF9TdHlsZShmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjo6cmVhZFN0eWxlKCRzdHlsZSwgJGR4Zik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGR4ZnNbXSA9ICRzdHlsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBDZWxsIFN0eWxlcwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbFN0eWxlcy0+Y2VsbFN0eWxlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFN0eWxlcy0+Y2VsbFN0eWxlcy0+Y2VsbFN0eWxlIGFzICRjZWxsU3R5bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50dmFsKCRjZWxsU3R5bGVbJ2J1aWx0aW5JZCddKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY2VsbFN0eWxlc1tpbnR2YWwoJGNlbGxTdHlsZVsneGZJZCddKV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCBzdHlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlID0gbmV3IFBIUEV4Y2VsX1N0eWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjo6cmVhZFN0eWxlKCRzdHlsZSwgJGNlbGxTdHlsZXNbaW50dmFsKCRjZWxsU3R5bGVbJ3hmSWQnXSldKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub3JtYWwgc3R5bGUsIGN1cnJlbnRseSBub3QgdXNpbmcgaXQgZm9yIGFueXRoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICR4bWxXb3JrYm9vayA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCAieyRyZWxbJ1RhcmdldCddfSIpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKTsgIC8vfiBodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvc3ByZWFkc2hlZXRtbC8yMDA2L21haW4iKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGJhc2UgZGF0ZQogICAgICAgICAgICAgICAgICAgIGlmICgkeG1sV29ya2Jvb2stPndvcmtib29rUHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OnNldEV4Y2VsQ2FsZW5kYXIoUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkNBTEVOREFSX1dJTkRPV1NfMTkwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sV29ya2Jvb2stPndvcmtib29rUHJbJ2RhdGUxOTA0J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkeG1sV29ya2Jvb2stPndvcmtib29rUHJbJ2RhdGUxOTA0J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OnNldEV4Y2VsQ2FsZW5kYXIoUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkNBTEVOREFSX01BQ18xOTA0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJHNoZWV0SWQgPSAwOyAvLyBrZWVwIHRyYWNrIG9mIG5ldyBzaGVldCBpZCBpbiBmaW5hbCB3b3JrYm9vawogICAgICAgICAgICAgICAgICAgICRvbGRTaGVldElkID0gLTE7IC8vIGtlZXAgdHJhY2sgb2Ygb2xkIHNoZWV0IGlkIGluIGZpbmFsIHdvcmtib29rCiAgICAgICAgICAgICAgICAgICAgJGNvdW50U2tpcHBlZFNoZWV0cyA9IDA7IC8vIGtlZXAgdHJhY2sgb2YgbnVtYmVyIG9mIHNraXBwZWQgc2hlZXRzCiAgICAgICAgICAgICAgICAgICAgJG1hcFNoZWV0SWQgPSBhcnJheSgpOyAvLyBtYXBwaW5nIG9mIHNoZWV0IGlkcyBmcm9tIG9sZCB0byBuZXcKCiAgICAgICAgICAgICAgICAgICAgJGNoYXJ0cyA9ICRjaGFydERldGFpbHMgPSBhcnJheSgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbFdvcmtib29rLT5zaGVldHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFdvcmtib29rLT5zaGVldHMtPnNoZWV0IGFzICRlbGVTaGVldCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyskb2xkU2hlZXRJZDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBzaGVldCBzaG91bGQgYmUgc2tpcHBlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5sb2FkU2hlZXRzT25seSkgJiYgIWluX2FycmF5KChzdHJpbmcpICRlbGVTaGVldFsibmFtZSJdLCAkdGhpcy0+bG9hZFNoZWV0c09ubHkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyskY291bnRTa2lwcGVkU2hlZXRzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtYXBTaGVldElkWyRvbGRTaGVldElkXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFwIG9sZCBzaGVldCBpZCBpbiBvcmlnaW5hbCB3b3JrYm9vayB0byBuZXcgc2hlZXQgaWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGV5IHdpbGwgZGlmZmVyIGlmIGxvYWRTaGVldHNPbmx5KCkgaXMgYmVpbmcgdXNlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1hcFNoZWV0SWRbJG9sZFNoZWV0SWRdID0gJG9sZFNoZWV0SWQgLSAkY291bnRTa2lwcGVkU2hlZXRzOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvYWQgc2hlZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldCA9ICRleGNlbC0+Y3JlYXRlU2hlZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIFVzZSBmYWxzZSBmb3IgJHVwZGF0ZUZvcm11bGFDZWxsUmVmZXJlbmNlcyB0byBwcmV2ZW50IGFkanVzdG1lbnQgb2Ygd29ya3NoZWV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgcmVmZXJlbmNlcyBpbiBmb3JtdWxhIGNlbGxzLi4uIGR1cmluZyB0aGUgbG9hZCwgYWxsIGZvcm11bGFlIHNob3VsZCBiZSBjb3JyZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIGFuZCB3ZSdyZSBzaW1wbHkgYnJpbmdpbmcgdGhlIHdvcmtzaGVldCBuYW1lIGluIGxpbmUgd2l0aCB0aGUgZm9ybXVsYSwgbm90IHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHJldmVyc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+c2V0VGl0bGUoKHN0cmluZykgJGVsZVNoZWV0WyJuYW1lIl0sIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlV29ya3NoZWV0ID0gJHdvcmtzaGVldHNbKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCRlbGVTaGVldC0+YXR0cmlidXRlcygiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcyIpLCAiaWQiKV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeG1sU2hlZXQgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgIiRkaXIvJGZpbGVXb3Jrc2hlZXQiKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7ICAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3NwcmVhZHNoZWV0bWwvMjAwNi9tYWluIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlZEZvcm11bGFzID0gYXJyYXkoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGVsZVNoZWV0WyJzdGF0ZSJdKSAmJiAoc3RyaW5nKSAkZWxlU2hlZXRbInN0YXRlIl0gIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPnNldFNoZWV0U3RhdGUoKHN0cmluZykgJGVsZVNoZWV0WyJzdGF0ZSJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzKSAmJiBpc3NldCgkeG1sU2hlZXQtPnNoZWV0Vmlld3MtPnNoZWV0VmlldykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXdbJ3pvb21TY2FsZSddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFNoZWV0VmlldygpLT5zZXRab29tU2NhbGUoaW50dmFsKCR4bWxTaGVldC0+c2hlZXRWaWV3cy0+c2hlZXRWaWV3Wyd6b29tU2NhbGUnXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXdbJ3pvb21TY2FsZU5vcm1hbCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFNoZWV0VmlldygpLT5zZXRab29tU2NhbGVOb3JtYWwoaW50dmFsKCR4bWxTaGVldC0+c2hlZXRWaWV3cy0+c2hlZXRWaWV3Wyd6b29tU2NhbGVOb3JtYWwnXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXdbJ3ZpZXcnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5nZXRTaGVldFZpZXcoKS0+c2V0Vmlldygoc3RyaW5nKSAkeG1sU2hlZXQtPnNoZWV0Vmlld3MtPnNoZWV0Vmlld1sndmlldyddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRWaWV3cy0+c2hlZXRWaWV3WydzaG93R3JpZExpbmVzJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+c2V0U2hvd0dyaWRMaW5lcyhzZWxmOjpib29sZWFuKChzdHJpbmcpJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXdbJ3Nob3dHcmlkTGluZXMnXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXdbJ3Nob3dSb3dDb2xIZWFkZXJzJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+c2V0U2hvd1Jvd0NvbEhlYWRlcnMoc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSR4bWxTaGVldC0+c2hlZXRWaWV3cy0+c2hlZXRWaWV3WydzaG93Um93Q29sSGVhZGVycyddKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnNoZWV0Vmlld3MtPnNoZWV0Vmlld1sncmlnaHRUb0xlZnQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5zZXRSaWdodFRvTGVmdChzZWxmOjpib29sZWFuKChzdHJpbmcpJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXdbJ3JpZ2h0VG9MZWZ0J10pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRWaWV3cy0+c2hlZXRWaWV3LT5wYW5lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXctPnBhbmVbJ3RvcExlZnRDZWxsJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmZyZWV6ZVBhbmUoKHN0cmluZykkeG1sU2hlZXQtPnNoZWV0Vmlld3MtPnNoZWV0Vmlldy0+cGFuZVsndG9wTGVmdENlbGwnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeFNwbGl0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR5U3BsaXQgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnNoZWV0Vmlld3MtPnNoZWV0Vmlldy0+cGFuZVsneFNwbGl0J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHhTcGxpdCA9IDEgKyBpbnR2YWwoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXctPnBhbmVbJ3hTcGxpdCddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXctPnBhbmVbJ3lTcGxpdCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR5U3BsaXQgPSAxICsgaW50dmFsKCR4bWxTaGVldC0+c2hlZXRWaWV3cy0+c2hlZXRWaWV3LT5wYW5lWyd5U3BsaXQnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5mcmVlemVQYW5lQnlDb2x1bW5BbmRSb3coJHhTcGxpdCwgJHlTcGxpdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnNoZWV0Vmlld3MtPnNoZWV0Vmlldy0+c2VsZWN0aW9uKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXctPnNlbGVjdGlvblsnc3FyZWYnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcXJlZiA9IChzdHJpbmcpJHhtbFNoZWV0LT5zaGVldFZpZXdzLT5zaGVldFZpZXctPnNlbGVjdGlvblsnc3FyZWYnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcXJlZiA9IGV4cGxvZGUoJyAnLCAkc3FyZWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNxcmVmID0gJHNxcmVmWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5zZXRTZWxlY3RlZENlbGxzKCRzcXJlZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRQcikgJiYgaXNzZXQoJHhtbFNoZWV0LT5zaGVldFByLT50YWJDb2xvcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFByLT50YWJDb2xvclsncmdiJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0VGFiQ29sb3IoKS0+c2V0QVJHQigoc3RyaW5nKSR4bWxTaGVldC0+c2hlZXRQci0+dGFiQ29sb3JbJ3JnYiddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5zaGVldFByKSAmJiBpc3NldCgkeG1sU2hlZXQtPnNoZWV0UHJbJ2NvZGVOYW1lJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5zZXRDb2RlTmFtZSgoc3RyaW5nKSAkeG1sU2hlZXQtPnNoZWV0UHJbJ2NvZGVOYW1lJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRQcikgJiYgaXNzZXQoJHhtbFNoZWV0LT5zaGVldFByLT5vdXRsaW5lUHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRQci0+b3V0bGluZVByWydzdW1tYXJ5UmlnaHQnXSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIXNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHhtbFNoZWV0LT5zaGVldFByLT5vdXRsaW5lUHJbJ3N1bW1hcnlSaWdodCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPnNldFNob3dTdW1tYXJ5UmlnaHQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+c2V0U2hvd1N1bW1hcnlSaWdodCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnNoZWV0UHItPm91dGxpbmVQclsnc3VtbWFyeUJlbG93J10pICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFzZWxmOjpib29sZWFuKChzdHJpbmcpICR4bWxTaGVldC0+c2hlZXRQci0+b3V0bGluZVByWydzdW1tYXJ5QmVsb3cnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5zZXRTaG93U3VtbWFyeUJlbG93KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPnNldFNob3dTdW1tYXJ5QmVsb3codHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnNoZWV0UHIpICYmIGlzc2V0KCR4bWxTaGVldC0+c2hlZXRQci0+cGFnZVNldFVwUHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRQci0+cGFnZVNldFVwUHJbJ2ZpdFRvUGFnZSddKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkeG1sU2hlZXQtPnNoZWV0UHItPnBhZ2VTZXRVcFByWydmaXRUb1BhZ2UnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5nZXRQYWdlU2V0dXAoKS0+c2V0Rml0VG9QYWdlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5zZXRGaXRUb1BhZ2UodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnNoZWV0Rm9ybWF0UHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRGb3JtYXRQclsnY3VzdG9tSGVpZ2h0J10pICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHhtbFNoZWV0LT5zaGVldEZvcm1hdFByWydjdXN0b21IZWlnaHQnXSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNzZXQoJHhtbFNoZWV0LT5zaGVldEZvcm1hdFByWydkZWZhdWx0Um93SGVpZ2h0J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0RGVmYXVsdFJvd0RpbWVuc2lvbigpLT5zZXRSb3dIZWlnaHQoKGZsb2F0KSR4bWxTaGVldC0+c2hlZXRGb3JtYXRQclsnZGVmYXVsdFJvd0hlaWdodCddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+c2hlZXRGb3JtYXRQclsnZGVmYXVsdENvbFdpZHRoJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0RGVmYXVsdENvbHVtbkRpbWVuc2lvbigpLT5zZXRXaWR0aCgoZmxvYXQpJHhtbFNoZWV0LT5zaGVldEZvcm1hdFByWydkZWZhdWx0Q29sV2lkdGgnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnNoZWV0Rm9ybWF0UHJbJ3plcm9IZWlnaHQnXSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChzdHJpbmcpJHhtbFNoZWV0LT5zaGVldEZvcm1hdFByWyd6ZXJvSGVpZ2h0J10gPT0gJzEnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldERlZmF1bHRSb3dEaW1lbnNpb24oKS0+c2V0WmVyb0hlaWdodCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+Y29scykgJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkeG1sU2hlZXQtPmNvbHMtPmNvbCBhcyAkY29sKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSBpbnR2YWwoJGNvbFsibWluIl0pIC0gMTsgJGkgPCBpbnR2YWwoJGNvbFsibWF4Il0pOyArKyRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbFsic3R5bGUiXSAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0Q29sdW1uRGltZW5zaW9uKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkaSkpLT5zZXRYZkluZGV4KGludHZhbCgkY29sWyJzdHlsZSJdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigkY29sWyJiZXN0Rml0Il0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kZG9jU2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbihQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGkpKS0+c2V0QXV0b1NpemUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigkY29sWyJoaWRkZW4iXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVjaG8gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRpKSwgJzogSElEREVOIENPTFVNTicsUEhQX0VPTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbihQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGkpKS0+c2V0VmlzaWJsZShmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigkY29sWyJjb2xsYXBzZWQiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbihQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGkpKS0+c2V0Q29sbGFwc2VkKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRjb2xbIm91dGxpbmVMZXZlbCJdID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0Q29sdW1uRGltZW5zaW9uKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkaSkpLT5zZXRPdXRsaW5lTGV2ZWwoaW50dmFsKCRjb2xbIm91dGxpbmVMZXZlbCJdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbihQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGkpKS0+c2V0V2lkdGgoZmxvYXR2YWwoJGNvbFsid2lkdGgiXSkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnR2YWwoJGNvbFsibWF4Il0pID09IDE2Mzg0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+cHJpbnRPcHRpb25zKSAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmOjpib29sZWFuKChzdHJpbmcpICR4bWxTaGVldC0+cHJpbnRPcHRpb25zWydncmlkTGluZXNTZXQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5zZXRTaG93R3JpZGxpbmVzKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkeG1sU2hlZXQtPnByaW50T3B0aW9uc1snZ3JpZExpbmVzJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+c2V0UHJpbnRHcmlkbGluZXModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmOjpib29sZWFuKChzdHJpbmcpICR4bWxTaGVldC0+cHJpbnRPcHRpb25zWydob3Jpem9udGFsQ2VudGVyZWQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5nZXRQYWdlU2V0dXAoKS0+c2V0SG9yaXpvbnRhbENlbnRlcmVkKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkeG1sU2hlZXQtPnByaW50T3B0aW9uc1sndmVydGljYWxDZW50ZXJlZCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5zZXRWZXJ0aWNhbENlbnRlcmVkKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbFNoZWV0ICYmICR4bWxTaGVldC0+c2hlZXREYXRhICYmICR4bWxTaGVldC0+c2hlZXREYXRhLT5yb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkeG1sU2hlZXQtPnNoZWV0RGF0YS0+cm93IGFzICRyb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3dbImh0Il0gJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0Um93RGltZW5zaW9uKGludHZhbCgkcm93WyJyIl0pKS0+c2V0Um93SGVpZ2h0KGZsb2F0dmFsKCRyb3dbImh0Il0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigkcm93WyJoaWRkZW4iXSkgJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0Um93RGltZW5zaW9uKGludHZhbCgkcm93WyJyIl0pKS0+c2V0VmlzaWJsZShmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGY6OmJvb2xlYW4oJHJvd1siY29sbGFwc2VkIl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFJvd0RpbWVuc2lvbihpbnR2YWwoJHJvd1siciJdKSktPnNldENvbGxhcHNlZCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHJvd1sib3V0bGluZUxldmVsIl0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFJvd0RpbWVuc2lvbihpbnR2YWwoJHJvd1siciJdKSktPnNldE91dGxpbmVMZXZlbChpbnR2YWwoJHJvd1sib3V0bGluZUxldmVsIl0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHJvd1sicyJdICYmICEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFJvd0RpbWVuc2lvbihpbnR2YWwoJHJvd1siciJdKSktPnNldFhmSW5kZXgoaW50dmFsKCRyb3dbInMiXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcm93LT5jIGFzICRjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkciAgICAgICAgICAgICAgICAgICAgID0gKHN0cmluZykgJGNbInIiXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YVR5cGUgICAgICAgICA9IChzdHJpbmcpICRjWyJ0Il07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgICAgICAgICAgICAgICAgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhbGN1bGF0ZWRWYWx1ZSAgICAgPSBudWxsOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlYWQgY2VsbD8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+Z2V0UmVhZEZpbHRlcigpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvb3JkaW5hdGVzID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5nZXRSZWFkRmlsdGVyKCktPnJlYWRDZWxsKCRjb29yZGluYXRlc1swXSwgJGNvb3JkaW5hdGVzWzFdLCAkZG9jU2hlZXQtPmdldFRpdGxlKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJ1JlYWRpbmcgY2VsbCAnLCAkY29vcmRpbmF0ZXNbMF0sICRjb29yZGluYXRlc1sxXSwgUEhQX0VPTDsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRfcigkYyk7CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gUEhQX0VPTDsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnQ2VsbCBEYXRhIFR5cGUgaXMgJywgJGNlbGxEYXRhVHlwZSwgJzogJzsKICAgIC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIGNlbGwhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRjZWxsRGF0YVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJzIjoKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdTdHJpbmcnLCBQSFBfRU9MOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHN0cmluZykkYy0+diAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gJHNoYXJlZFN0cmluZ3NbaW50dmFsKCRjLT52KV07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZSBpbnN0YW5jZW9mIFBIUEV4Y2VsX1JpY2hUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gY2xvbmUgJHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiYiI6CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnQm9vbGVhbicsIFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJGMtPmYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBzZWxmOjpjYXN0VG9Cb29sZWFuKCRjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm11bGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5jYXN0VG9Gb3JtdWxhKCRjLCAkciwgJGNlbGxEYXRhVHlwZSwgJHZhbHVlLCAkY2FsY3VsYXRlZFZhbHVlLCAkc2hhcmVkRm9ybXVsYXMsICdjYXN0VG9Cb29sZWFuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGMtPmZbJ3QnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0ID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXR0ID0gJGMtPmY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5nZXRDZWxsKCRyKS0+c2V0Rm9ybXVsYUF0dHJpYnV0ZXMoJGF0dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJyRjYWxjdWxhdGVkVmFsdWUgPSAnLCAkY2FsY3VsYXRlZFZhbHVlLCBQSFBfRU9MOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImlubGluZVN0ciI6Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnSW5saW5lIFN0cmluZycsIFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYy0+ZikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5jYXN0VG9Gb3JtdWxhKCRjLCAkciwgJGNlbGxEYXRhVHlwZSwgJHZhbHVlLCAkY2FsY3VsYXRlZFZhbHVlLCAkc2hhcmVkRm9ybXVsYXMsICdjYXN0VG9FcnJvcicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gJHRoaXMtPnBhcnNlUmljaFRleHQoJGMtPmlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlIjoKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdFcnJvcicsIFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJGMtPmYpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBzZWxmOjpjYXN0VG9FcnJvcigkYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3JtdWxhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y2FzdFRvRm9ybXVsYSgkYywgJHIsICRjZWxsRGF0YVR5cGUsICR2YWx1ZSwgJGNhbGN1bGF0ZWRWYWx1ZSwgJHNoYXJlZEZvcm11bGFzLCAnY2FzdFRvRXJyb3InKTsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnJGNhbGN1bGF0ZWRWYWx1ZSA9ICcsICRjYWxjdWxhdGVkVmFsdWUsIFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdEZWZhdWx0JywgUEhQX0VPTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkYy0+ZikpIHsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnTm90IGEgRm9ybXVsYScsIFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBzZWxmOjpjYXN0VG9TdHJpbmcoJGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdUcmVhdCBhcyBGb3JtdWxhJywgUEhQX0VPTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm11bGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5jYXN0VG9Gb3JtdWxhKCRjLCAkciwgJGNlbGxEYXRhVHlwZSwgJHZhbHVlLCAkY2FsY3VsYXRlZFZhbHVlLCAkc2hhcmVkRm9ybXVsYXMsICdjYXN0VG9TdHJpbmcnKTsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnJGNhbGN1bGF0ZWRWYWx1ZSA9ICcsICRjYWxjdWxhdGVkVmFsdWUsIFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJ1ZhbHVlIGlzICcsICR2YWx1ZSwgUEhQX0VPTDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgbnVtZXJpYyB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc19udW1lcmljKCR2YWx1ZSkgJiYgJGNlbGxEYXRhVHlwZSAhPSAncycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlID09IChpbnQpJHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IChpbnQpJHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkdmFsdWUgPT0gKGZsb2F0KSR2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSAoZmxvYXQpJHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkdmFsdWUgPT0gKGRvdWJsZSkkdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gKGRvdWJsZSkkdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJpY2ggdGV4dD8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWUgaW5zdGFuY2VvZiBQSFBFeGNlbF9SaWNoVGV4dCAmJiAkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gJHZhbHVlLT5nZXRQbGFpblRleHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbCA9ICRkb2NTaGVldC0+Z2V0Q2VsbCgkcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBc3NpZ24gdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkY2VsbERhdGFUeXBlICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJHZhbHVlLCAkY2VsbERhdGFUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlKCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNhbGN1bGF0ZWRWYWx1ZSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsLT5zZXRDYWxjdWxhdGVkVmFsdWUoJGNhbGN1bGF0ZWRWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3R5bGUgaW5mb3JtYXRpb24\/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNbInMiXSAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHN0eWxlIGluZGV4IG1lYW5zIDAsIGl0IHNlZW1zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFhmSW5kZXgoaXNzZXQoJHN0eWxlc1tpbnR2YWwoJGNbInMiXSldKSA\/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludHZhbCgkY1sicyJdKSA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb25kaXRpb25hbHMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5ICYmICR4bWxTaGVldCAmJiAkeG1sU2hlZXQtPmNvbmRpdGlvbmFsRm9ybWF0dGluZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR4bWxTaGVldC0+Y29uZGl0aW9uYWxGb3JtYXR0aW5nIGFzICRjb25kaXRpb25hbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29uZGl0aW9uYWwtPmNmUnVsZSBhcyAkY2ZSdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKChzdHJpbmcpJGNmUnVsZVsidHlwZSJdID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fTk9ORSB8fCAoc3RyaW5nKSRjZlJ1bGVbInR5cGUiXSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0NFTExJUyB8fCAoc3RyaW5nKSRjZlJ1bGVbInR5cGUiXSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0NPTlRBSU5TVEVYVCB8fCAoc3RyaW5nKSRjZlJ1bGVbInR5cGUiXSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0VYUFJFU1NJT04pICYmIGlzc2V0KCRkeGZzW2ludHZhbCgkY2ZSdWxlWyJkeGZJZCJdKV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbmRpdGlvbmFsc1soc3RyaW5nKSAkY29uZGl0aW9uYWxbInNxcmVmIl1dW2ludHZhbCgkY2ZSdWxlWyJwcmlvcml0eSJdKV0gPSAkY2ZSdWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29uZGl0aW9uYWxzIGFzICRyZWYgPT4gJGNmUnVsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga3NvcnQoJGNmUnVsZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29uZGl0aW9uYWxTdHlsZXMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY2ZSdWxlcyBhcyAkY2ZSdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqQ29uZGl0aW9uYWwgPSBuZXcgUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpDb25kaXRpb25hbC0+c2V0Q29uZGl0aW9uVHlwZSgoc3RyaW5nKSRjZlJ1bGVbInR5cGUiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqQ29uZGl0aW9uYWwtPnNldE9wZXJhdG9yVHlwZSgoc3RyaW5nKSRjZlJ1bGVbIm9wZXJhdG9yIl0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoc3RyaW5nKSRjZlJ1bGVbInRleHQiXSAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpDb25kaXRpb25hbC0+c2V0VGV4dCgoc3RyaW5nKSRjZlJ1bGVbInRleHQiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50KCRjZlJ1bGUtPmZvcm11bGEpID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjZlJ1bGUtPmZvcm11bGEgYXMgJGZvcm11bGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakNvbmRpdGlvbmFsLT5hZGRDb25kaXRpb24oKHN0cmluZykkZm9ybXVsYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqQ29uZGl0aW9uYWwtPmFkZENvbmRpdGlvbigoc3RyaW5nKSRjZlJ1bGUtPmZvcm11bGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakNvbmRpdGlvbmFsLT5zZXRTdHlsZShjbG9uZSAkZHhmc1tpbnR2YWwoJGNmUnVsZVsiZHhmSWQiXSldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb25kaXRpb25hbFN0eWxlc1tdID0gJG9iakNvbmRpdGlvbmFsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeHRyYWN0IGFsbCBjZWxsIHJlZmVyZW5jZXMgaW4gJHJlZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbEJsb2NrcyA9IGV4cGxvZGUoJyAnLCBzdHJfcmVwbGFjZSgnJCcsICcnLCBzdHJ0b3VwcGVyKCRyZWYpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjZWxsQmxvY2tzIGFzICRjZWxsQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0U3R5bGUoJGNlbGxCbG9jayktPnNldENvbmRpdGlvbmFsU3R5bGVzKCRjb25kaXRpb25hbFN0eWxlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFLZXlzID0gYXJyYXkoInNoZWV0IiwgIm9iamVjdHMiLCAic2NlbmFyaW9zIiwgImZvcm1hdENlbGxzIiwgImZvcm1hdENvbHVtbnMiLCAiZm9ybWF0Um93cyIsICJpbnNlcnRDb2x1bW5zIiwgImluc2VydFJvd3MiLCAiaW5zZXJ0SHlwZXJsaW5rcyIsICJkZWxldGVDb2x1bW5zIiwgImRlbGV0ZVJvd3MiLCAic2VsZWN0TG9ja2VkQ2VsbHMiLCAic29ydCIsICJhdXRvRmlsdGVyIiwgInBpdm90VGFibGVzIiwgInNlbGVjdFVubG9ja2VkQ2VsbHMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSAmJiAkeG1sU2hlZXQgJiYgJHhtbFNoZWV0LT5zaGVldFByb3RlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkYUtleXMgYXMgJGtleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWV0aG9kID0gInNldCIgLiB1Y2ZpcnN0KCRrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+JG1ldGhvZChzZWxmOjpib29sZWFuKChzdHJpbmcpICR4bWxTaGVldC0+c2hlZXRQcm90ZWN0aW9uWyRrZXldKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSAmJiAkeG1sU2hlZXQgJiYgJHhtbFNoZWV0LT5zaGVldFByb3RlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+c2V0UGFzc3dvcmQoKHN0cmluZykgJHhtbFNoZWV0LT5zaGVldFByb3RlY3Rpb25bInBhc3N3b3JkIl0sIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sU2hlZXQtPnByb3RlY3RlZFJhbmdlcy0+cHJvdGVjdGVkUmFuZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFNoZWV0LT5wcm90ZWN0ZWRSYW5nZXMtPnByb3RlY3RlZFJhbmdlIGFzICRwcm90ZWN0ZWRSYW5nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5wcm90ZWN0Q2VsbHMoKHN0cmluZykgJHByb3RlY3RlZFJhbmdlWyJzcXJlZiJdLCAoc3RyaW5nKSAkcHJvdGVjdGVkUmFuZ2VbInBhc3N3b3JkIl0sIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sU2hlZXQgJiYgJHhtbFNoZWV0LT5hdXRvRmlsdGVyICYmICEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF1dG9GaWx0ZXJSYW5nZSA9IChzdHJpbmcpICR4bWxTaGVldC0+YXV0b0ZpbHRlclsicmVmIl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkYXV0b0ZpbHRlclJhbmdlLCAnOicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXV0b0ZpbHRlciA9ICRkb2NTaGVldC0+Z2V0QXV0b0ZpbHRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXV0b0ZpbHRlci0+c2V0UmFuZ2UoJGF1dG9GaWx0ZXJSYW5nZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkeG1sU2hlZXQtPmF1dG9GaWx0ZXItPmZpbHRlckNvbHVtbiBhcyAkZmlsdGVyQ29sdW1uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uID0gJGF1dG9GaWx0ZXItPmdldENvbHVtbkJ5T2Zmc2V0KChpbnRlZ2VyKSAkZmlsdGVyQ29sdW1uWyJjb2xJZCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIENoZWNrIGZvciBzdGFuZGFyZCBmaWx0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGZpbHRlckNvbHVtbi0+ZmlsdGVycykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW4tPnNldEZpbHRlclR5cGUoUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0ZJTFRFUlRZUEVfRklMVEVSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmlsdGVycyA9ICRmaWx0ZXJDb2x1bW4tPmZpbHRlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChpc3NldCgkZmlsdGVyc1siYmxhbmsiXSkpICYmICgkZmlsdGVyc1siYmxhbmsiXSA9PSAxKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBPcGVyYXRvciBpcyB1bmRlZmluZWQsIGJ1dCBhbHdheXMgdHJlYXRlZCBhcyBFUVVBTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uLT5jcmVhdGVSdWxlKCktPnNldFJ1bGUobnVsbCwgJycpLT5zZXRSdWxlVHlwZShQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9GSUxURVIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBTdGFuZGFyZCBmaWx0ZXJzIGFyZSBhbHdheXMgYW4gT1Igam9pbiwgc28gbm8gam9pbiBydWxlIG5lZWRzIHRvIGJlIHNldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIEVudHJpZXMgY2FuIGJlIGVpdGhlciBmaWx0ZXIgZWxlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkZmlsdGVycy0+ZmlsdGVyIGFzICRmaWx0ZXJSdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIE9wZXJhdG9yIGlzIHVuZGVmaW5lZCwgYnV0IGFsd2F5cyB0cmVhdGVkIGFzIEVRVUFMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW4tPmNyZWF0ZVJ1bGUoKS0+c2V0UnVsZShudWxsLCAoc3RyaW5nKSAkZmlsdGVyUnVsZVsidmFsIl0pLT5zZXRSdWxlVHlwZShQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9GSUxURVIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBPciBEYXRlIEdyb3VwIGVsZW1lbnRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGZpbHRlcnMtPmRhdGVHcm91cEl0ZW0gYXMgJGRhdGVHcm91cEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbi0+Y3JlYXRlUnVsZSgpLT5zZXRSdWxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgT3BlcmF0b3IgaXMgdW5kZWZpbmVkLCBidXQgYWx3YXlzIHRyZWF0ZWQgYXMgRVFVQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWVhcicgPT4gKHN0cmluZykgJGRhdGVHcm91cEl0ZW1bInllYXIiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9udGgnID0+IChzdHJpbmcpICRkYXRlR3JvdXBJdGVtWyJtb250aCJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXknID0+IChzdHJpbmcpICRkYXRlR3JvdXBJdGVtWyJkYXkiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaG91cicgPT4gKHN0cmluZykgJGRhdGVHcm91cEl0ZW1bImhvdXIiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWludXRlJyA9PiAoc3RyaW5nKSAkZGF0ZUdyb3VwSXRlbVsibWludXRlIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NlY29uZCcgPT4gKHN0cmluZykgJGRhdGVHcm91cEl0ZW1bInNlY29uZCJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdHJpbmcpICRkYXRlR3JvdXBJdGVtWyJkYXRlVGltZUdyb3VwaW5nIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnNldFJ1bGVUeXBlKFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RBVEVHUk9VUCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgQ2hlY2sgZm9yIGN1c3RvbSBmaWx0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGZpbHRlckNvbHVtbi0+Y3VzdG9tRmlsdGVycykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW4tPnNldEZpbHRlclR5cGUoUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0ZJTFRFUlRZUEVfQ1VTVE9NRklMVEVSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3VzdG9tRmlsdGVycyA9ICRmaWx0ZXJDb2x1bW4tPmN1c3RvbUZpbHRlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgQ3VzdG9tIGZpbHRlcnMgY2FuIGFuIEFORCBvciBhbiBPUiBqb2luOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBhbmQgdGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUgb3IgdHdvIGVudHJpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlzc2V0KCRjdXN0b21GaWx0ZXJzWyJhbmQiXSkpICYmICgkY3VzdG9tRmlsdGVyc1siYW5kIl0gPT0gMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbi0+c2V0Sm9pbihQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW46OkFVVE9GSUxURVJfQ09MVU1OX0pPSU5fQU5EKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGN1c3RvbUZpbHRlcnMtPmN1c3RvbUZpbHRlciBhcyAkZmlsdGVyUnVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uLT5jcmVhdGVSdWxlKCktPnNldFJ1bGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RyaW5nKSAkZmlsdGVyUnVsZVsib3BlcmF0b3IiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdHJpbmcpICRmaWx0ZXJSdWxlWyJ2YWwiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+c2V0UnVsZVR5cGUoUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfQ1VTVE9NRklMVEVSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBDaGVjayBmb3IgZHluYW1pYyBmaWx0ZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGZpbHRlckNvbHVtbi0+ZHluYW1pY0ZpbHRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW4tPnNldEZpbHRlclR5cGUoUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0ZJTFRFUlRZUEVfRFlOQU1JQ0ZJTFRFUik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgV2Ugc2hvdWxkIG9ubHkgZXZlciBoYXZlIG9uZSBkeW5hbWljIGZpbHRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRmaWx0ZXJDb2x1bW4tPmR5bmFtaWNGaWx0ZXIgYXMgJGZpbHRlclJ1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbi0+Y3JlYXRlUnVsZSgpLT5zZXRSdWxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgT3BlcmF0b3IgaXMgdW5kZWZpbmVkLCBidXQgYWx3YXlzIHRyZWF0ZWQgYXMgRVFVQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RyaW5nKSAkZmlsdGVyUnVsZVsidmFsIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RyaW5nKSAkZmlsdGVyUnVsZVsidHlwZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5zZXRSdWxlVHlwZShQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDRklMVEVSKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRmaWx0ZXJSdWxlWyJ2YWwiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW4tPnNldEF0dHJpYnV0ZSgndmFsJywgKHN0cmluZykgJGZpbHRlclJ1bGVbInZhbCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGZpbHRlclJ1bGVbIm1heFZhbCJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbi0+c2V0QXR0cmlidXRlKCdtYXhWYWwnLCAoc3RyaW5nKSAkZmlsdGVyUnVsZVsibWF4VmFsIl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgQ2hlY2sgZm9yIGR5bmFtaWMgZmlsdGVycwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRmaWx0ZXJDb2x1bW4tPnRvcDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbi0+c2V0RmlsdGVyVHlwZShQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW46OkFVVE9GSUxURVJfRklMVEVSVFlQRV9UT1BURU5GSUxURVIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIFdlIHNob3VsZCBvbmx5IGV2ZXIgaGF2ZSBvbmUgdG9wMTAgZmlsdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGZpbHRlckNvbHVtbi0+dG9wMTAgYXMgJGZpbHRlclJ1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbi0+Y3JlYXRlUnVsZSgpLT5zZXRSdWxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCgoaXNzZXQoJGZpbHRlclJ1bGVbInBlcmNlbnQiXSkpICYmICgkZmlsdGVyUnVsZVsicGVyY2VudCJdID09IDEpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfVE9QVEVOX1BFUkNFTlQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX0NPTFVNTl9SVUxFX1RPUFRFTl9CWV9WQUxVRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzdHJpbmcpICRmaWx0ZXJSdWxlWyJ2YWwiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoKGlzc2V0KCRmaWx0ZXJSdWxlWyJ0b3AiXSkpICYmICgkZmlsdGVyUnVsZVsidG9wIl0gPT0gMSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9UT1BURU5fVE9QCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9UT1BURU5fQk9UVE9NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5zZXRSdWxlVHlwZShQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9UT1BURU5GSUxURVIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbFNoZWV0ICYmICR4bWxTaGVldC0+bWVyZ2VDZWxscyAmJiAkeG1sU2hlZXQtPm1lcmdlQ2VsbHMtPm1lcmdlQ2VsbCAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR4bWxTaGVldC0+bWVyZ2VDZWxscy0+bWVyZ2VDZWxsIGFzICRtZXJnZUNlbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lcmdlUmVmID0gKHN0cmluZykgJG1lcmdlQ2VsbFsicmVmIl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJwb3MoJG1lcmdlUmVmLCAnOicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5tZXJnZUNlbGxzKChzdHJpbmcpICRtZXJnZUNlbGxbInJlZiJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbFNoZWV0ICYmICR4bWxTaGVldC0+cGFnZU1hcmdpbnMgJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jUGFnZU1hcmdpbnMgPSAkZG9jU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1BhZ2VNYXJnaW5zLT5zZXRMZWZ0KGZsb2F0dmFsKCR4bWxTaGVldC0+cGFnZU1hcmdpbnNbImxlZnQiXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlTWFyZ2lucy0+c2V0UmlnaHQoZmxvYXR2YWwoJHhtbFNoZWV0LT5wYWdlTWFyZ2luc1sicmlnaHQiXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlTWFyZ2lucy0+c2V0VG9wKGZsb2F0dmFsKCR4bWxTaGVldC0+cGFnZU1hcmdpbnNbInRvcCJdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1BhZ2VNYXJnaW5zLT5zZXRCb3R0b20oZmxvYXR2YWwoJHhtbFNoZWV0LT5wYWdlTWFyZ2luc1siYm90dG9tIl0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jUGFnZU1hcmdpbnMtPnNldEhlYWRlcihmbG9hdHZhbCgkeG1sU2hlZXQtPnBhZ2VNYXJnaW5zWyJoZWFkZXIiXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlTWFyZ2lucy0+c2V0Rm9vdGVyKGZsb2F0dmFsKCR4bWxTaGVldC0+cGFnZU1hcmdpbnNbImZvb3RlciJdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR4bWxTaGVldCAmJiAkeG1sU2hlZXQtPnBhZ2VTZXR1cCAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlU2V0dXAgPSAkZG9jU2hlZXQtPmdldFBhZ2VTZXR1cCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5wYWdlU2V0dXBbIm9yaWVudGF0aW9uIl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlU2V0dXAtPnNldE9yaWVudGF0aW9uKChzdHJpbmcpICR4bWxTaGVldC0+cGFnZVNldHVwWyJvcmllbnRhdGlvbiJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+cGFnZVNldHVwWyJwYXBlclNpemUiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1BhZ2VTZXR1cC0+c2V0UGFwZXJTaXplKGludHZhbCgkeG1sU2hlZXQtPnBhZ2VTZXR1cFsicGFwZXJTaXplIl0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+cGFnZVNldHVwWyJzY2FsZSJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jUGFnZVNldHVwLT5zZXRTY2FsZShpbnR2YWwoJHhtbFNoZWV0LT5wYWdlU2V0dXBbInNjYWxlIl0pLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnBhZ2VTZXR1cFsiZml0VG9IZWlnaHQiXSkgJiYgaW50dmFsKCR4bWxTaGVldC0+cGFnZVNldHVwWyJmaXRUb0hlaWdodCJdKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlU2V0dXAtPnNldEZpdFRvSGVpZ2h0KGludHZhbCgkeG1sU2hlZXQtPnBhZ2VTZXR1cFsiZml0VG9IZWlnaHQiXSksIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+cGFnZVNldHVwWyJmaXRUb1dpZHRoIl0pICYmIGludHZhbCgkeG1sU2hlZXQtPnBhZ2VTZXR1cFsiZml0VG9XaWR0aCJdKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlU2V0dXAtPnNldEZpdFRvV2lkdGgoaW50dmFsKCR4bWxTaGVldC0+cGFnZVNldHVwWyJmaXRUb1dpZHRoIl0pLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkeG1sU2hlZXQtPnBhZ2VTZXR1cFsiZmlyc3RQYWdlTnVtYmVyIl0pICYmIGlzc2V0KCR4bWxTaGVldC0+cGFnZVNldHVwWyJ1c2VGaXJzdFBhZ2VOdW1iZXIiXSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkeG1sU2hlZXQtPnBhZ2VTZXR1cFsidXNlRmlyc3RQYWdlTnVtYmVyIl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQYWdlU2V0dXAtPnNldEZpcnN0UGFnZU51bWJlcihpbnR2YWwoJHhtbFNoZWV0LT5wYWdlU2V0dXBbImZpcnN0UGFnZU51bWJlciJdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sU2hlZXQgJiYgJHhtbFNoZWV0LT5oZWFkZXJGb290ZXIgJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jSGVhZGVyRm9vdGVyID0gJGRvY1NoZWV0LT5nZXRIZWFkZXJGb290ZXIoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR4bWxTaGVldC0+aGVhZGVyRm9vdGVyWyJkaWZmZXJlbnRPZGRFdmVuIl0pICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6OmJvb2xlYW4oKHN0cmluZykkeG1sU2hlZXQtPmhlYWRlckZvb3RlclsiZGlmZmVyZW50T2RkRXZlbiJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jSGVhZGVyRm9vdGVyLT5zZXREaWZmZXJlbnRPZGRFdmVuKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NIZWFkZXJGb290ZXItPnNldERpZmZlcmVudE9kZEV2ZW4oZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5oZWFkZXJGb290ZXJbImRpZmZlcmVudEZpcnN0Il0pICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6OmJvb2xlYW4oKHN0cmluZykkeG1sU2hlZXQtPmhlYWRlckZvb3RlclsiZGlmZmVyZW50Rmlyc3QiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY0hlYWRlckZvb3Rlci0+c2V0RGlmZmVyZW50Rmlyc3QodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY0hlYWRlckZvb3Rlci0+c2V0RGlmZmVyZW50Rmlyc3QoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5oZWFkZXJGb290ZXJbInNjYWxlV2l0aERvYyJdKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSR4bWxTaGVldC0+aGVhZGVyRm9vdGVyWyJzY2FsZVdpdGhEb2MiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY0hlYWRlckZvb3Rlci0+c2V0U2NhbGVXaXRoRG9jdW1lbnQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NIZWFkZXJGb290ZXItPnNldFNjYWxlV2l0aERvY3VtZW50KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHhtbFNoZWV0LT5oZWFkZXJGb290ZXJbImFsaWduV2l0aE1hcmdpbnMiXSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIXNlbGY6OmJvb2xlYW4oKHN0cmluZykkeG1sU2hlZXQtPmhlYWRlckZvb3RlclsiYWxpZ25XaXRoTWFyZ2lucyJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jSGVhZGVyRm9vdGVyLT5zZXRBbGlnbldpdGhNYXJnaW5zKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jSGVhZGVyRm9vdGVyLT5zZXRBbGlnbldpdGhNYXJnaW5zKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY0hlYWRlckZvb3Rlci0+c2V0T2RkSGVhZGVyKChzdHJpbmcpICR4bWxTaGVldC0+aGVhZGVyRm9vdGVyLT5vZGRIZWFkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NIZWFkZXJGb290ZXItPnNldE9kZEZvb3Rlcigoc3RyaW5nKSAkeG1sU2hlZXQtPmhlYWRlckZvb3Rlci0+b2RkRm9vdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jSGVhZGVyRm9vdGVyLT5zZXRFdmVuSGVhZGVyKChzdHJpbmcpICR4bWxTaGVldC0+aGVhZGVyRm9vdGVyLT5ldmVuSGVhZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jSGVhZGVyRm9vdGVyLT5zZXRFdmVuRm9vdGVyKChzdHJpbmcpICR4bWxTaGVldC0+aGVhZGVyRm9vdGVyLT5ldmVuRm9vdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jSGVhZGVyRm9vdGVyLT5zZXRGaXJzdEhlYWRlcigoc3RyaW5nKSAkeG1sU2hlZXQtPmhlYWRlckZvb3Rlci0+Zmlyc3RIZWFkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NIZWFkZXJGb290ZXItPnNldEZpcnN0Rm9vdGVyKChzdHJpbmcpICR4bWxTaGVldC0+aGVhZGVyRm9vdGVyLT5maXJzdEZvb3Rlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR4bWxTaGVldCAmJiAkeG1sU2hlZXQtPnJvd0JyZWFrcyAmJiAkeG1sU2hlZXQtPnJvd0JyZWFrcy0+YnJrICYmICEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFNoZWV0LT5yb3dCcmVha3MtPmJyayBhcyAkYnJrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkYnJrWyJtYW4iXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5zZXRCcmVhaygiQSRicmtbaWRdIiwgUEhQRXhjZWxfV29ya3NoZWV0OjpCUkVBS19ST1cpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR4bWxTaGVldCAmJiAkeG1sU2hlZXQtPmNvbEJyZWFrcyAmJiAkeG1sU2hlZXQtPmNvbEJyZWFrcy0+YnJrICYmICEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFNoZWV0LT5jb2xCcmVha3MtPmJyayBhcyAkYnJrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkYnJrWyJtYW4iXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5zZXRCcmVhayhQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoKHN0cmluZykgJGJya1siaWQiXSkgLiAiMSIsIFBIUEV4Y2VsX1dvcmtzaGVldDo6QlJFQUtfQ09MVU1OKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbFNoZWV0ICYmICR4bWxTaGVldC0+ZGF0YVZhbGlkYXRpb25zICYmICEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFNoZWV0LT5kYXRhVmFsaWRhdGlvbnMtPmRhdGFWYWxpZGF0aW9uIGFzICRkYXRhVmFsaWRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmFuZ2UgPSBzdHJ0b3VwcGVyKCRkYXRhVmFsaWRhdGlvblsic3FyZWYiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyYW5nZVNldCA9IGV4cGxvZGUoJyAnLCAkcmFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmFuZ2VTZXQgYXMgJHJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RSYW5nZSA9ICRkb2NTaGVldC0+c2hyaW5rUmFuZ2VUb0ZpdCgkcmFuZ2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgYWxsIGNlbGwgcmVmZXJlbmNlcyBpbiAkcmFuZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFBIUEV4Y2VsX0NlbGw6OmV4dHJhY3RBbGxDZWxsUmVmZXJlbmNlc0luUmFuZ2UoJHN0UmFuZ2UpIGFzICRyZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdmFsaWRhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NWYWxpZGF0aW9uID0gJGRvY1NoZWV0LT5nZXRDZWxsKCRyZWZlcmVuY2UpLT5nZXREYXRhVmFsaWRhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NWYWxpZGF0aW9uLT5zZXRUeXBlKChzdHJpbmcpICRkYXRhVmFsaWRhdGlvblsidHlwZSJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jVmFsaWRhdGlvbi0+c2V0RXJyb3JTdHlsZSgoc3RyaW5nKSAkZGF0YVZhbGlkYXRpb25bImVycm9yU3R5bGUiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1ZhbGlkYXRpb24tPnNldE9wZXJhdG9yKChzdHJpbmcpICRkYXRhVmFsaWRhdGlvblsib3BlcmF0b3IiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1ZhbGlkYXRpb24tPnNldEFsbG93QmxhbmsoJGRhdGFWYWxpZGF0aW9uWyJhbGxvd0JsYW5rIl0gIT0gMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1ZhbGlkYXRpb24tPnNldFNob3dEcm9wRG93bigkZGF0YVZhbGlkYXRpb25bInNob3dEcm9wRG93biJdID09IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NWYWxpZGF0aW9uLT5zZXRTaG93SW5wdXRNZXNzYWdlKCRkYXRhVmFsaWRhdGlvblsic2hvd0lucHV0TWVzc2FnZSJdICE9IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NWYWxpZGF0aW9uLT5zZXRTaG93RXJyb3JNZXNzYWdlKCRkYXRhVmFsaWRhdGlvblsic2hvd0Vycm9yTWVzc2FnZSJdICE9IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NWYWxpZGF0aW9uLT5zZXRFcnJvclRpdGxlKChzdHJpbmcpICRkYXRhVmFsaWRhdGlvblsiZXJyb3JUaXRsZSJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jVmFsaWRhdGlvbi0+c2V0RXJyb3IoKHN0cmluZykgJGRhdGFWYWxpZGF0aW9uWyJlcnJvciJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jVmFsaWRhdGlvbi0+c2V0UHJvbXB0VGl0bGUoKHN0cmluZykgJGRhdGFWYWxpZGF0aW9uWyJwcm9tcHRUaXRsZSJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jVmFsaWRhdGlvbi0+c2V0UHJvbXB0KChzdHJpbmcpICRkYXRhVmFsaWRhdGlvblsicHJvbXB0Il0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NWYWxpZGF0aW9uLT5zZXRGb3JtdWxhMSgoc3RyaW5nKSAkZGF0YVZhbGlkYXRpb24tPmZvcm11bGExKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jVmFsaWRhdGlvbi0+c2V0Rm9ybXVsYTIoKHN0cmluZykgJGRhdGFWYWxpZGF0aW9uLT5mb3JtdWxhMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGh5cGVybGlua3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoeXBlcmxpbmtzID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvY2F0ZSBoeXBlcmxpbmsgcmVsYXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR6aXAtPmxvY2F0ZU5hbWUoZGlybmFtZSgiJGRpci8kZmlsZVdvcmtzaGVldCIpIC4gIi9fcmVscy8iIC4gYmFzZW5hbWUoJGZpbGVXb3Jrc2hlZXQpIC4gIi5yZWxzIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlbHNXb3Jrc2hlZXQgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgZGlybmFtZSgiJGRpci8kZmlsZVdvcmtzaGVldCIpIC4gIi9fcmVscy8iIC4gYmFzZW5hbWUoJGZpbGVXb3Jrc2hlZXQpIC4gIi5yZWxzIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOyAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3BhY2thZ2UvMjAwNi9yZWxhdGlvbnNoaXBzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZWxzV29ya3NoZWV0LT5SZWxhdGlvbnNoaXAgYXMgJGVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVbIlR5cGUiXSA9PSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9oeXBlcmxpbmsiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh5cGVybGlua3NbKHN0cmluZykkZWxlWyJJZCJdXSA9IChzdHJpbmcpJGVsZVsiVGFyZ2V0Il07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBoeXBlcmxpbmtzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR4bWxTaGVldCAmJiAkeG1sU2hlZXQtPmh5cGVybGlua3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFNoZWV0LT5oeXBlcmxpbmtzLT5oeXBlcmxpbmsgYXMgJGh5cGVybGluaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGluayB1cmwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaW5rUmVsID0gJGh5cGVybGluay0+YXR0cmlidXRlcygnaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcycpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKFBIUEV4Y2VsX0NlbGw6OmV4dHJhY3RBbGxDZWxsUmVmZXJlbmNlc0luUmFuZ2UoJGh5cGVybGlua1sncmVmJ10pIGFzICRjZWxsUmVmZXJlbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGwgPSAkZG9jU2hlZXQtPmdldENlbGwoJGNlbGxSZWZlcmVuY2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkbGlua1JlbFsnaWQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh5cGVybGlua1VybCA9ICRoeXBlcmxpbmtzWyAoc3RyaW5nKSRsaW5rUmVsWydpZCddIF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkaHlwZXJsaW5rWydsb2NhdGlvbiddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh5cGVybGlua1VybCAuPSAnIycgLiAoc3RyaW5nKSAkaHlwZXJsaW5rWydsb2NhdGlvbiddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsLT5nZXRIeXBlcmxpbmsoKS0+c2V0VXJsKCRoeXBlcmxpbmtVcmwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChpc3NldCgkaHlwZXJsaW5rWydsb2NhdGlvbiddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbC0+Z2V0SHlwZXJsaW5rKCktPnNldFVybCgnc2hlZXQ6Ly8nIC4gKHN0cmluZykkaHlwZXJsaW5rWydsb2NhdGlvbiddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvb2x0aXAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGh5cGVybGlua1sndG9vbHRpcCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbC0+Z2V0SHlwZXJsaW5rKCktPnNldFRvb2x0aXAoKHN0cmluZykkaHlwZXJsaW5rWyd0b29sdGlwJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgY29tbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21tZW50cyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm1sQ29tbWVudHMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+cmVhZERhdGFPbmx5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9jYXRlIGNvbW1lbnQgcmVsYXRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR6aXAtPmxvY2F0ZU5hbWUoZGlybmFtZSgiJGRpci8kZmlsZVdvcmtzaGVldCIpIC4gIi9fcmVscy8iIC4gYmFzZW5hbWUoJGZpbGVXb3Jrc2hlZXQpIC4gIi5yZWxzIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlbHNXb3Jrc2hlZXQgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgZGlybmFtZSgiJGRpci8kZmlsZVdvcmtzaGVldCIpIC4gIi9fcmVscy8iIC4gYmFzZW5hbWUoJGZpbGVXb3Jrc2hlZXQpIC4gIi5yZWxzIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOyAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3BhY2thZ2UvMjAwNi9yZWxhdGlvbnNoaXBzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZWxzV29ya3NoZWV0LT5SZWxhdGlvbnNoaXAgYXMgJGVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVbIlR5cGUiXSA9PSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9jb21tZW50cyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tbWVudHNbKHN0cmluZykkZWxlWyJJZCJdXSA9IChzdHJpbmcpJGVsZVsiVGFyZ2V0Il07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGVsZVsiVHlwZSJdID09ICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL3ZtbERyYXdpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZtbENvbW1lbnRzWyhzdHJpbmcpJGVsZVsiSWQiXV0gPSAoc3RyaW5nKSRlbGVbIlRhcmdldCJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMb29wIHRocm91Z2ggY29tbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29tbWVudHMgYXMgJHJlbE5hbWUgPT4gJHJlbFBhdGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9hZCBjb21tZW50cyBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZWxQYXRoID0gUEhQRXhjZWxfU2hhcmVkX0ZpbGU6OnJlYWxwYXRoKGRpcm5hbWUoIiRkaXIvJGZpbGVXb3Jrc2hlZXQiKSAuICIvIiAuICRyZWxQYXRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRzRmlsZSA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCAkcmVsUGF0aCkpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXRpbGl0eSB2YXJpYWJsZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF1dGhvcnMgPSBhcnJheSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGF1dGhvcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGNvbW1lbnRzRmlsZS0+YXV0aG9ycy0+YXV0aG9yIGFzICRhdXRob3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhdXRob3JzW10gPSAoc3RyaW5nKSRhdXRob3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBjb250ZW50cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY29tbWVudHNGaWxlLT5jb21tZW50TGlzdC0+Y29tbWVudCBhcyAkY29tbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkY29tbWVudFsnYXV0aG9ySWQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldENvbW1lbnQoKHN0cmluZykkY29tbWVudFsncmVmJ10pLT5zZXRBdXRob3IoJGF1dGhvcnNbKHN0cmluZykkY29tbWVudFsnYXV0aG9ySWQnXV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5nZXRDb21tZW50KChzdHJpbmcpJGNvbW1lbnRbJ3JlZiddKS0+c2V0VGV4dCgkdGhpcy0+cGFyc2VSaWNoVGV4dCgkY29tbWVudC0+dGV4dCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMb29wIHRocm91Z2ggVk1MIGNvbW1lbnRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHZtbENvbW1lbnRzIGFzICRyZWxOYW1lID0+ICRyZWxQYXRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvYWQgVk1MIGNvbW1lbnRzIGZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlbFBhdGggPSBQSFBFeGNlbF9TaGFyZWRfRmlsZTo6cmVhbHBhdGgoZGlybmFtZSgiJGRpci8kZmlsZVdvcmtzaGVldCIpIC4gIi8iIC4gJHJlbFBhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm1sQ29tbWVudHNGaWxlID0gc2ltcGxleG1sX2xvYWRfc3RyaW5nKCR0aGlzLT5zZWN1cml0eVNjYW4oJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICRyZWxQYXRoKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2bWxDb21tZW50c0ZpbGUtPnJlZ2lzdGVyWFBhdGhOYW1lc3BhY2UoJ3YnLCAndXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp2bWwnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFwZXMgPSAkdm1sQ29tbWVudHNGaWxlLT54cGF0aCgnLy92OnNoYXBlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzaGFwZXMgYXMgJHNoYXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhcGUtPnJlZ2lzdGVyWFBhdGhOYW1lc3BhY2UoJ3YnLCAndXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp2bWwnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHNoYXBlWydzdHlsZSddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdHlsZSAgICAgICAgPSAoc3RyaW5nKSRzaGFwZVsnc3R5bGUnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmlsbENvbG9yICAgID0gc3RydG91cHBlcihzdWJzdHIoKHN0cmluZykkc2hhcGVbJ2ZpbGxjb2xvciddLCAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbiAgICAgICA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvdyAgICAgICAgICA9IG51bGw7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjbGllbnREYXRhICAgPSAkc2hhcGUtPnhwYXRoKCcuLy94OkNsaWVudERhdGEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNfYXJyYXkoJGNsaWVudERhdGEpICYmICFlbXB0eSgkY2xpZW50RGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNsaWVudERhdGEgICA9ICRjbGllbnREYXRhWzBdOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRjbGllbnREYXRhWydPYmplY3RUeXBlJ10pICYmIChzdHJpbmcpJGNsaWVudERhdGFbJ09iamVjdFR5cGUnXSA9PSAnTm90ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0ZW1wID0gJGNsaWVudERhdGEtPnhwYXRoKCcuLy94OlJvdycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR0ZW1wKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb3cgPSAkdGVtcFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGVtcCA9ICRjbGllbnREYXRhLT54cGF0aCgnLi8veDpDb2x1bW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkdGVtcCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uID0gJHRlbXBbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJGNvbHVtbiAhPT0gbnVsbCkgJiYgKCRyb3cgIT09IG51bGwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBjb21tZW50IHByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnQgPSAkZG9jU2hlZXQtPmdldENvbW1lbnRCeUNvbHVtbkFuZFJvdygoc3RyaW5nKSAkY29sdW1uLCAkcm93ICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21tZW50LT5nZXRGaWxsQ29sb3IoKS0+c2V0UkdCKCRmaWxsQ29sb3IpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGFyc2Ugc3R5bGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlQXJyYXkgPSBleHBsb2RlKCc7Jywgc3RyX3JlcGxhY2UoJyAnLCAnJywgJHN0eWxlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzdHlsZUFycmF5IGFzICRzdHlsZVBhaXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdHlsZVBhaXIgPSBleHBsb2RlKCc6JywgJHN0eWxlUGFpcik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdHlsZVBhaXJbMF0gPT0gJ21hcmdpbi1sZWZ0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21tZW50LT5zZXRNYXJnaW5MZWZ0KCRzdHlsZVBhaXJbMV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdHlsZVBhaXJbMF0gPT0gJ21hcmdpbi10b3AnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnQtPnNldE1hcmdpblRvcCgkc3R5bGVQYWlyWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3R5bGVQYWlyWzBdID09ICd3aWR0aCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tbWVudC0+c2V0V2lkdGgoJHN0eWxlUGFpclsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0eWxlUGFpclswXSA9PSAnaGVpZ2h0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21tZW50LT5zZXRIZWlnaHQoJHN0eWxlUGFpclsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHN0eWxlUGFpclswXSA9PSAndmlzaWJpbGl0eScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29tbWVudC0+c2V0VmlzaWJsZSgkc3R5bGVQYWlyWzFdID09ICd2aXNpYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhlYWRlci9mb290ZXIgaW1hZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR4bWxTaGVldCAmJiAkeG1sU2hlZXQtPmxlZ2FjeURyYXdpbmdIRiAmJiAhJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHppcC0+bG9jYXRlTmFtZShkaXJuYW1lKCIkZGlyLyRmaWxlV29ya3NoZWV0IikgLiAiL19yZWxzLyIgLiBiYXNlbmFtZSgkZmlsZVdvcmtzaGVldCkgLiAiLnJlbHMiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlbHNXb3Jrc2hlZXQgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgZGlybmFtZSgiJGRpci8kZmlsZVdvcmtzaGVldCIpIC4gIi9fcmVscy8iIC4gYmFzZW5hbWUoJGZpbGVXb3Jrc2hlZXQpIC4gIi5yZWxzIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOyAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3BhY2thZ2UvMjAwNi9yZWxhdGlvbnNoaXBzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm1sUmVsYXRpb25zaGlwID0gJyc7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlbHNXb3Jrc2hlZXQtPlJlbGF0aW9uc2hpcCBhcyAkZWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVbIlR5cGUiXSA9PSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy92bWxEcmF3aW5nIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdm1sUmVsYXRpb25zaGlwID0gc2VsZjo6ZGlyQWRkKCIkZGlyLyRmaWxlV29ya3NoZWV0IiwgJGVsZVsiVGFyZ2V0Il0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZtbFJlbGF0aW9uc2hpcCAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZldGNoIGxpbmtlZCBpbWFnZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVsc1ZNTCA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCBkaXJuYW1lKCR2bWxSZWxhdGlvbnNoaXApIC4gJy9fcmVscy8nIC4gYmFzZW5hbWUoJHZtbFJlbGF0aW9uc2hpcCkgLiAnLnJlbHMnKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7IC8vfiBodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvcGFja2FnZS8yMDA2L3JlbGF0aW9uc2hpcHMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJhd2luZ3MgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZWxzVk1MLT5SZWxhdGlvbnNoaXAgYXMgJGVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGVsZVsiVHlwZSJdID09ICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL2ltYWdlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmdzWyhzdHJpbmcpICRlbGVbIklkIl1dID0gc2VsZjo6ZGlyQWRkKCR2bWxSZWxhdGlvbnNoaXAsICRlbGVbIlRhcmdldCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmV0Y2ggVk1MIGRvY3VtZW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZtbERyYXdpbmcgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgJHZtbFJlbGF0aW9uc2hpcCkpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2bWxEcmF3aW5nLT5yZWdpc3RlclhQYXRoTmFtZXNwYWNlKCd2JywgJ3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206dm1sJyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZkltYWdlcyA9IGFycmF5KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFwZXMgPSAkdm1sRHJhd2luZy0+eHBhdGgoJy8vdjpzaGFwZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzaGFwZXMgYXMgJGlkeCA9PiAkc2hhcGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXBlLT5yZWdpc3RlclhQYXRoTmFtZXNwYWNlKCd2JywgJ3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206dm1sJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZURhdGEgPSAkc2hhcGUtPnhwYXRoKCcvL3Y6aW1hZ2VkYXRhJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZURhdGEgPSAkaW1hZ2VEYXRhWyRpZHhdOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlRGF0YSA9ICRpbWFnZURhdGEtPmF0dHJpYnV0ZXMoJ3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3R5bGUgPSBzZWxmOjp0b0NTU0FycmF5KChzdHJpbmcpJHNoYXBlWydzdHlsZSddKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZkltYWdlc1sgKHN0cmluZykkc2hhcGVbJ2lkJ10gXSA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfSGVhZGVyRm9vdGVyRHJhd2luZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGltYWdlRGF0YVsndGl0bGUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZkltYWdlc1sgKHN0cmluZykkc2hhcGVbJ2lkJ10gXS0+c2V0TmFtZSgoc3RyaW5nKSRpbWFnZURhdGFbJ3RpdGxlJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGZJbWFnZXNbIChzdHJpbmcpJHNoYXBlWydpZCddIF0tPnNldFBhdGgoInppcDovLyIuUEhQRXhjZWxfU2hhcmVkX0ZpbGU6OnJlYWxwYXRoKCRwRmlsZW5hbWUpLiIjIiAuICRkcmF3aW5nc1soc3RyaW5nKSRpbWFnZURhdGFbJ3JlbGlkJ11dLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZkltYWdlc1sgKHN0cmluZykkc2hhcGVbJ2lkJ10gXS0+c2V0UmVzaXplUHJvcG9ydGlvbmFsKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhmSW1hZ2VzWyAoc3RyaW5nKSRzaGFwZVsnaWQnXSBdLT5zZXRXaWR0aCgkc3R5bGVbJ3dpZHRoJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGZJbWFnZXNbIChzdHJpbmcpJHNoYXBlWydpZCddIF0tPnNldEhlaWdodCgkc3R5bGVbJ2hlaWdodCddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRzdHlsZVsnbWFyZ2luLWxlZnQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZkltYWdlc1sgKHN0cmluZykkc2hhcGVbJ2lkJ10gXS0+c2V0T2Zmc2V0WCgkc3R5bGVbJ21hcmdpbi1sZWZ0J10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZkltYWdlc1sgKHN0cmluZykkc2hhcGVbJ2lkJ10gXS0+c2V0T2Zmc2V0WSgkc3R5bGVbJ21hcmdpbi10b3AnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoZkltYWdlc1sgKHN0cmluZykkc2hhcGVbJ2lkJ10gXS0+c2V0UmVzaXplUHJvcG9ydGlvbmFsKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+c2V0SW1hZ2VzKCRoZkltYWdlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IEF1dG9zaGFwZXMgZnJvbSB0d29DZWxsQW5jaG9ycyEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkemlwLT5sb2NhdGVOYW1lKGRpcm5hbWUoIiRkaXIvJGZpbGVXb3Jrc2hlZXQiKSAuICIvX3JlbHMvIiAuIGJhc2VuYW1lKCRmaWxlV29ya3NoZWV0KSAuICIucmVscyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlbHNXb3Jrc2hlZXQgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgZGlybmFtZSgiJGRpci8kZmlsZVdvcmtzaGVldCIpIC4gIi9fcmVscy8iIC4gYmFzZW5hbWUoJGZpbGVXb3Jrc2hlZXQpIC4gIi5yZWxzIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOyAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3BhY2thZ2UvMjAwNi9yZWxhdGlvbnNoaXBzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmdzID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVsc1dvcmtzaGVldC0+UmVsYXRpb25zaGlwIGFzICRlbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVbIlR5cGUiXSA9PSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9kcmF3aW5nIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmdzWyhzdHJpbmcpICRlbGVbIklkIl1dID0gc2VsZjo6ZGlyQWRkKCIkZGlyLyRmaWxlV29ya3NoZWV0IiwgJGVsZVsiVGFyZ2V0Il0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sU2hlZXQtPmRyYXdpbmcgJiYgISR0aGlzLT5yZWFkRGF0YU9ubHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFNoZWV0LT5kcmF3aW5nIGFzICRkcmF3aW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmlsZURyYXdpbmcgPSAkZHJhd2luZ3NbKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCRkcmF3aW5nLT5hdHRyaWJ1dGVzKCJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzIiksICJpZCIpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZWxzRHJhd2luZyA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCBkaXJuYW1lKCRmaWxlRHJhd2luZykgLiAiL19yZWxzLyIgLiBiYXNlbmFtZSgkZmlsZURyYXdpbmcpIC4gIi5yZWxzIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOyAvL34gaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL3BhY2thZ2UvMjAwNi9yZWxhdGlvbnNoaXBzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VzID0gYXJyYXkoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHJlbHNEcmF3aW5nICYmICRyZWxzRHJhd2luZy0+UmVsYXRpb25zaGlwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlbHNEcmF3aW5nLT5SZWxhdGlvbnNoaXAgYXMgJGVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGVsZVsiVHlwZSJdID09ICJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzL2ltYWdlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1soc3RyaW5nKSAkZWxlWyJJZCJdXSA9IHNlbGY6OmRpckFkZCgkZmlsZURyYXdpbmcsICRlbGVbIlRhcmdldCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRlbGVbIlR5cGUiXSA9PSAiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9jaGFydCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aW5jbHVkZUNoYXJ0cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjaGFydHNbc2VsZjo6ZGlyQWRkKCRmaWxlRHJhd2luZywgJGVsZVsiVGFyZ2V0Il0pXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaWQnICAgICAgICA9PiAoc3RyaW5nKSAkZWxlWyJJZCJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2hlZXQnICAgID0+ICRkb2NTaGVldC0+Z2V0VGl0bGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeG1sRHJhd2luZyA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKCR0aGlzLT5nZXRGcm9tWmlwQXJjaGl2ZSgkemlwLCAkZmlsZURyYXdpbmcpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKS0+Y2hpbGRyZW4oImh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9kcmF3aW5nbWwvMjAwNi9zcHJlYWRzaGVldERyYXdpbmciKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhtbERyYXdpbmctPm9uZUNlbGxBbmNob3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkeG1sRHJhd2luZy0+b25lQ2VsbEFuY2hvciBhcyAkb25lQ2VsbEFuY2hvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG9uZUNlbGxBbmNob3ItPnBpYy0+YmxpcEZpbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRibGlwID0gJG9uZUNlbGxBbmNob3ItPnBpYy0+YmxpcEZpbGwtPmNoaWxkcmVuKCJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvZHJhd2luZ21sLzIwMDYvbWFpbiIpLT5ibGlwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHhmcm0gPSAkb25lQ2VsbEFuY2hvci0+cGljLT5zcFByLT5jaGlsZHJlbigiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL2RyYXdpbmdtbC8yMDA2L21haW4iKS0+eGZybTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvdXRlclNoZHcgPSAkb25lQ2VsbEFuY2hvci0+cGljLT5zcFByLT5jaGlsZHJlbigiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL2RyYXdpbmdtbC8yMDA2L21haW4iKS0+ZWZmZWN0THN0LT5vdXRlclNoZHc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqRHJhd2luZyA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfRHJhd2luZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXROYW1lKChzdHJpbmcpIHNlbGY6OmdldEFycmF5SXRlbSgkb25lQ2VsbEFuY2hvci0+cGljLT5udlBpY1ByLT5jTnZQci0+YXR0cmlidXRlcygpLCAibmFtZSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXREZXNjcmlwdGlvbigoc3RyaW5nKSBzZWxmOjpnZXRBcnJheUl0ZW0oJG9uZUNlbGxBbmNob3ItPnBpYy0+bnZQaWNQci0+Y052UHItPmF0dHJpYnV0ZXMoKSwgImRlc2NyIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakRyYXdpbmctPnNldFBhdGgoInppcDovLyIuUEhQRXhjZWxfU2hhcmVkX0ZpbGU6OnJlYWxwYXRoKCRwRmlsZW5hbWUpLiIjIiAuICRpbWFnZXNbKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCRibGlwLT5hdHRyaWJ1dGVzKCJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzIiksICJlbWJlZCIpXSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakRyYXdpbmctPnNldENvb3JkaW5hdGVzKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgoc3RyaW5nKSAkb25lQ2VsbEFuY2hvci0+ZnJvbS0+Y29sKSAuICgkb25lQ2VsbEFuY2hvci0+ZnJvbS0+cm93ICsgMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakRyYXdpbmctPnNldE9mZnNldFgoUEhQRXhjZWxfU2hhcmVkX0RyYXdpbmc6OkVNVVRvUGl4ZWxzKCRvbmVDZWxsQW5jaG9yLT5mcm9tLT5jb2xPZmYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRPZmZzZXRZKFBIUEV4Y2VsX1NoYXJlZF9EcmF3aW5nOjpFTVVUb1BpeGVscygkb25lQ2VsbEFuY2hvci0+ZnJvbS0+cm93T2ZmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqRHJhd2luZy0+c2V0UmVzaXplUHJvcG9ydGlvbmFsKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRXaWR0aChQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoc2VsZjo6Z2V0QXJyYXlJdGVtKCRvbmVDZWxsQW5jaG9yLT5leHQtPmF0dHJpYnV0ZXMoKSwgImN4IikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRIZWlnaHQoUEhQRXhjZWxfU2hhcmVkX0RyYXdpbmc6OkVNVVRvUGl4ZWxzKHNlbGY6OmdldEFycmF5SXRlbSgkb25lQ2VsbEFuY2hvci0+ZXh0LT5hdHRyaWJ1dGVzKCksICJjeSIpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHhmcm0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqRHJhd2luZy0+c2V0Um90YXRpb24oUEhQRXhjZWxfU2hhcmVkX0RyYXdpbmc6OmFuZ2xlVG9EZWdyZWVzKHNlbGY6OmdldEFycmF5SXRlbSgkeGZybS0+YXR0cmlidXRlcygpLCAicm90IikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkb3V0ZXJTaGR3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYWRvdyA9ICRvYmpEcmF3aW5nLT5nZXRTaGFkb3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhZG93LT5zZXRWaXNpYmxlKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFkb3ctPnNldEJsdXJSYWRpdXMoUEhQRXhjZWxfU2hhcmVkX0RyYXdpbmc6OkVNVVRvcGl4ZWxzKHNlbGY6OmdldEFycmF5SXRlbSgkb3V0ZXJTaGR3LT5hdHRyaWJ1dGVzKCksICJibHVyUmFkIikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhZG93LT5zZXREaXN0YW5jZShQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9waXhlbHMoc2VsZjo6Z2V0QXJyYXlJdGVtKCRvdXRlclNoZHctPmF0dHJpYnV0ZXMoKSwgImRpc3QiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFkb3ctPnNldERpcmVjdGlvbihQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6YW5nbGVUb0RlZ3JlZXMoc2VsZjo6Z2V0QXJyYXlJdGVtKCRvdXRlclNoZHctPmF0dHJpYnV0ZXMoKSwgImRpciIpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYWRvdy0+c2V0QWxpZ25tZW50KChzdHJpbmcpIHNlbGY6OmdldEFycmF5SXRlbSgkb3V0ZXJTaGR3LT5hdHRyaWJ1dGVzKCksICJhbGduIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFkb3ctPmdldENvbG9yKCktPnNldFJHQihzZWxmOjpnZXRBcnJheUl0ZW0oJG91dGVyU2hkdy0+c3JnYkNsci0+YXR0cmlidXRlcygpLCAidmFsIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFkb3ctPnNldEFscGhhKHNlbGY6OmdldEFycmF5SXRlbSgkb3V0ZXJTaGR3LT5zcmdiQ2xyLT5hbHBoYS0+YXR0cmlidXRlcygpLCAidmFsIikgLyAxMDAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRXb3Jrc2hlZXQoJGRvY1NoZWV0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgID8gQ2FuIGNoYXJ0cyBiZSBwb3NpdGlvbmVkIHdpdGggYSBvbmVDZWxsQW5jaG9yID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb29yZGluYXRlcyAgICA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgoc3RyaW5nKSAkb25lQ2VsbEFuY2hvci0+ZnJvbS0+Y29sKSAuICgkb25lQ2VsbEFuY2hvci0+ZnJvbS0+cm93ICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2Zmc2V0WCAgICAgICAgPSBQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoJG9uZUNlbGxBbmNob3ItPmZyb20tPmNvbE9mZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2Zmc2V0WSAgICAgICAgPSBQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoJG9uZUNlbGxBbmNob3ItPmZyb20tPnJvd09mZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2lkdGggICAgICAgICAgPSBQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoc2VsZjo6Z2V0QXJyYXlJdGVtKCRvbmVDZWxsQW5jaG9yLT5leHQtPmF0dHJpYnV0ZXMoKSwgImN4IikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhlaWdodCAgICAgICAgID0gUEhQRXhjZWxfU2hhcmVkX0RyYXdpbmc6OkVNVVRvUGl4ZWxzKHNlbGY6OmdldEFycmF5SXRlbSgkb25lQ2VsbEFuY2hvci0+ZXh0LT5hdHRyaWJ1dGVzKCksICJjeSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sRHJhd2luZy0+dHdvQ2VsbEFuY2hvcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR4bWxEcmF3aW5nLT50d29DZWxsQW5jaG9yIGFzICR0d29DZWxsQW5jaG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdHdvQ2VsbEFuY2hvci0+cGljLT5ibGlwRmlsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJsaXAgPSAkdHdvQ2VsbEFuY2hvci0+cGljLT5ibGlwRmlsbC0+Y2hpbGRyZW4oImh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9kcmF3aW5nbWwvMjAwNi9tYWluIiktPmJsaXA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeGZybSA9ICR0d29DZWxsQW5jaG9yLT5waWMtPnNwUHItPmNoaWxkcmVuKCJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvZHJhd2luZ21sLzIwMDYvbWFpbiIpLT54ZnJtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG91dGVyU2hkdyA9ICR0d29DZWxsQW5jaG9yLT5waWMtPnNwUHItPmNoaWxkcmVuKCJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvZHJhd2luZ21sLzIwMDYvbWFpbiIpLT5lZmZlY3RMc3QtPm91dGVyU2hkdzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nID0gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldF9EcmF3aW5nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakRyYXdpbmctPnNldE5hbWUoKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCR0d29DZWxsQW5jaG9yLT5waWMtPm52UGljUHItPmNOdlByLT5hdHRyaWJ1dGVzKCksICJuYW1lIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakRyYXdpbmctPnNldERlc2NyaXB0aW9uKChzdHJpbmcpIHNlbGY6OmdldEFycmF5SXRlbSgkdHdvQ2VsbEFuY2hvci0+cGljLT5udlBpY1ByLT5jTnZQci0+YXR0cmlidXRlcygpLCAiZGVzY3IiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqRHJhd2luZy0+c2V0UGF0aCgiemlwOi8vIi5QSFBFeGNlbF9TaGFyZWRfRmlsZTo6cmVhbHBhdGgoJHBGaWxlbmFtZSkuIiMiIC4gJGltYWdlc1soc3RyaW5nKSBzZWxmOjpnZXRBcnJheUl0ZW0oJGJsaXAtPmF0dHJpYnV0ZXMoImh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9vZmZpY2VEb2N1bWVudC8yMDA2L3JlbGF0aW9uc2hpcHMiKSwgImVtYmVkIildLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqRHJhd2luZy0+c2V0Q29vcmRpbmF0ZXMoUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KChzdHJpbmcpICR0d29DZWxsQW5jaG9yLT5mcm9tLT5jb2wpIC4gKCR0d29DZWxsQW5jaG9yLT5mcm9tLT5yb3cgKyAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqRHJhd2luZy0+c2V0T2Zmc2V0WChQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoJHR3b0NlbGxBbmNob3ItPmZyb20tPmNvbE9mZikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakRyYXdpbmctPnNldE9mZnNldFkoUEhQRXhjZWxfU2hhcmVkX0RyYXdpbmc6OkVNVVRvUGl4ZWxzKCR0d29DZWxsQW5jaG9yLT5mcm9tLT5yb3dPZmYpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRSZXNpemVQcm9wb3J0aW9uYWwoZmFsc2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeGZybSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRXaWR0aChQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoc2VsZjo6Z2V0QXJyYXlJdGVtKCR4ZnJtLT5leHQtPmF0dHJpYnV0ZXMoKSwgImN4IikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqRHJhd2luZy0+c2V0SGVpZ2h0KFBIUEV4Y2VsX1NoYXJlZF9EcmF3aW5nOjpFTVVUb1BpeGVscyhzZWxmOjpnZXRBcnJheUl0ZW0oJHhmcm0tPmV4dC0+YXR0cmlidXRlcygpLCAiY3kiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRSb3RhdGlvbihQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6YW5nbGVUb0RlZ3JlZXMoc2VsZjo6Z2V0QXJyYXlJdGVtKCR4ZnJtLT5hdHRyaWJ1dGVzKCksICJyb3QiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvdXRlclNoZHcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhZG93ID0gJG9iakRyYXdpbmctPmdldFNoYWRvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFkb3ctPnNldFZpc2libGUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYWRvdy0+c2V0Qmx1clJhZGl1cyhQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9waXhlbHMoc2VsZjo6Z2V0QXJyYXlJdGVtKCRvdXRlclNoZHctPmF0dHJpYnV0ZXMoKSwgImJsdXJSYWQiKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzaGFkb3ctPnNldERpc3RhbmNlKFBIUEV4Y2VsX1NoYXJlZF9EcmF3aW5nOjpFTVVUb3BpeGVscyhzZWxmOjpnZXRBcnJheUl0ZW0oJG91dGVyU2hkdy0+YXR0cmlidXRlcygpLCAiZGlzdCIpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYWRvdy0+c2V0RGlyZWN0aW9uKFBIUEV4Y2VsX1NoYXJlZF9EcmF3aW5nOjphbmdsZVRvRGVncmVlcyhzZWxmOjpnZXRBcnJheUl0ZW0oJG91dGVyU2hkdy0+YXR0cmlidXRlcygpLCAiZGlyIikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hhZG93LT5zZXRBbGlnbm1lbnQoKHN0cmluZykgc2VsZjo6Z2V0QXJyYXlJdGVtKCRvdXRlclNoZHctPmF0dHJpYnV0ZXMoKSwgImFsZ24iKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYWRvdy0+Z2V0Q29sb3IoKS0+c2V0UkdCKHNlbGY6OmdldEFycmF5SXRlbSgkb3V0ZXJTaGR3LT5zcmdiQ2xyLT5hdHRyaWJ1dGVzKCksICJ2YWwiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNoYWRvdy0+c2V0QWxwaGEoc2VsZjo6Z2V0QXJyYXlJdGVtKCRvdXRlclNoZHctPnNyZ2JDbHItPmFscGhhLT5hdHRyaWJ1dGVzKCksICJ2YWwiKSAvIDEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakRyYXdpbmctPnNldFdvcmtzaGVldCgkZG9jU2hlZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoKCR0aGlzLT5pbmNsdWRlQ2hhcnRzKSAmJiAoJHR3b0NlbGxBbmNob3ItPmdyYXBoaWNGcmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tQ29vcmRpbmF0ZSA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgoc3RyaW5nKSAkdHdvQ2VsbEFuY2hvci0+ZnJvbS0+Y29sKSAuICgkdHdvQ2VsbEFuY2hvci0+ZnJvbS0+cm93ICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZnJvbU9mZnNldFggICAgPSBQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoJHR3b0NlbGxBbmNob3ItPmZyb20tPmNvbE9mZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZnJvbU9mZnNldFkgICAgPSBQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoJHR3b0NlbGxBbmNob3ItPmZyb20tPnJvd09mZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9Db29yZGluYXRlICAgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoKHN0cmluZykgJHR3b0NlbGxBbmNob3ItPnRvLT5jb2wpIC4gKCR0d29DZWxsQW5jaG9yLT50by0+cm93ICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9PZmZzZXRYICAgICAgPSBQSFBFeGNlbF9TaGFyZWRfRHJhd2luZzo6RU1VVG9QaXhlbHMoJHR3b0NlbGxBbmNob3ItPnRvLT5jb2xPZmYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvT2Zmc2V0WSAgICAgID0gUEhQRXhjZWxfU2hhcmVkX0RyYXdpbmc6OkVNVVRvUGl4ZWxzKCR0d29DZWxsQW5jaG9yLT50by0+cm93T2ZmKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRncmFwaGljICAgICAgICA9ICR0d29DZWxsQW5jaG9yLT5ncmFwaGljRnJhbWUtPmNoaWxkcmVuKCJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvZHJhd2luZ21sLzIwMDYvbWFpbiIpLT5ncmFwaGljOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNoYXJ0UmVmICAgICAgID0gJGdyYXBoaWMtPmdyYXBoaWNEYXRhLT5jaGlsZHJlbigiaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL2RyYXdpbmdtbC8yMDA2L2NoYXJ0IiktPmNoYXJ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNDaGFydCAgICAgID0gKHN0cmluZykgJGNoYXJ0UmVmLT5hdHRyaWJ1dGVzKCJodHRwOi8vc2NoZW1hcy5vcGVueG1sZm9ybWF0cy5vcmcvb2ZmaWNlRG9jdW1lbnQvMjAwNi9yZWxhdGlvbnNoaXBzIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNoYXJ0RGV0YWlsc1skZG9jU2hlZXQtPmdldFRpdGxlKCkuJyEnLiR0aGlzQ2hhcnRdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb21Db29yZGluYXRlJyAgICA9PiAkZnJvbUNvb3JkaW5hdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb21PZmZzZXRYJyAgICAgICA9PiAkZnJvbU9mZnNldFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb21PZmZzZXRZJyAgICAgICA9PiAkZnJvbU9mZnNldFksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvQ29vcmRpbmF0ZScgICAgICA9PiAkdG9Db29yZGluYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b09mZnNldFgnICAgICAgICAgPT4gJHRvT2Zmc2V0WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndG9PZmZzZXRZJyAgICAgICAgID0+ICR0b09mZnNldFksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dvcmtzaGVldFRpdGxlJyAgICA9PiAkZG9jU2hlZXQtPmdldFRpdGxlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGRlZmluZWROYW1lcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR4bWxXb3JrYm9vay0+ZGVmaW5lZE5hbWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFdvcmtib29rLT5kZWZpbmVkTmFtZXMtPmRlZmluZWROYW1lIGFzICRkZWZpbmVkTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeHRyYWN0IHJhbmdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHRyYWN0ZWRSYW5nZSA9IChzdHJpbmcpJGRlZmluZWROYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSBwcmVnX3JlcGxhY2UoJy9cJyhcdyspXCdcIS8nLCAnJywgJGV4dHJhY3RlZFJhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkc3BvcyA9IHN0cnBvcygkZXh0cmFjdGVkUmFuZ2UsICchJykpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4dHJhY3RlZFJhbmdlID0gc3Vic3RyKCRleHRyYWN0ZWRSYW5nZSwgMCwgJHNwb3MpLnN0cl9yZXBsYWNlKCckJywgJycsIHN1YnN0cigkZXh0cmFjdGVkUmFuZ2UsICRzcG9zKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSBzdHJfcmVwbGFjZSgnJCcsICcnLCAkZXh0cmFjdGVkUmFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZCByYW5nZT8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmlwb3MoKHN0cmluZykkZGVmaW5lZE5hbWUsICcjUkVGIScpICE9PSBmYWxzZSB8fCAkZXh0cmFjdGVkUmFuZ2UgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTb21lIGRlZmluZWROYW1lcyBhcmUgb25seSBhcHBsaWNhYmxlIGlmIHdlIGFyZSBvbiB0aGUgc2FtZSBzaGVldC4uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHN0cmluZykkZGVmaW5lZE5hbWVbJ2xvY2FsU2hlZXRJZCddICE9ICcnICYmIChzdHJpbmcpJGRlZmluZWROYW1lWydsb2NhbFNoZWV0SWQnXSA9PSAkc2hlZXRJZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3dpdGNoIG9uIHR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoKHN0cmluZykkZGVmaW5lZE5hbWVbJ25hbWUnXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ194bG5tLl9GaWx0ZXJEYXRhYmFzZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoc3RyaW5nKSRkZWZpbmVkTmFtZVsnaGlkZGVuJ10gIT09ICcxJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4dHJhY3RlZFJhbmdlID0gZXhwbG9kZSgnLCcsICRleHRyYWN0ZWRSYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkZXh0cmFjdGVkUmFuZ2UgYXMgJHJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF1dG9GaWx0ZXJSYW5nZSA9ICRyYW5nZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRhdXRvRmlsdGVyUmFuZ2UsICc6JykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0QXV0b0ZpbHRlcigpLT5zZXRSYW5nZSgkYXV0b0ZpbHRlclJhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnX3hsbm0uUHJpbnRfVGl0bGVzJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BsaXQgJGV4dHJhY3RlZFJhbmdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHRyYWN0ZWRSYW5nZSA9IGV4cGxvZGUoJywnLCAkZXh0cmFjdGVkUmFuZ2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHByaW50IHRpdGxlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkZXh0cmFjdGVkUmFuZ2UgYXMgJHJhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWF0Y2hlcyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmFuZ2UgPSBzdHJfcmVwbGFjZSgnJCcsICcnLCAkcmFuZ2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciByZXBlYXRpbmcgY29sdW1ucywgZSBnLiAnQTpBJyBvciAnQTpEJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJy8hPyhbQS1aXSspXDooW0EtWl0rKSQvJywgJHJhbmdlLCAkbWF0Y2hlcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZG9jU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5zZXRDb2x1bW5zVG9SZXBlYXRBdExlZnQoYXJyYXkoJG1hdGNoZXNbMV0sICRtYXRjaGVzWzJdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAocHJlZ19tYXRjaCgnLyE\/KFxkKylcOihcZCspJC8nLCAkcmFuZ2UsICRtYXRjaGVzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciByZXBlYXRpbmcgcm93cywgZS5nLiAnMToxJyBvciAnMTo1JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkb2NTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldFJvd3NUb1JlcGVhdEF0VG9wKGFycmF5KCRtYXRjaGVzWzFdLCAkbWF0Y2hlc1syXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ194bG5tLlByaW50X0FyZWEnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmFuZ2VTZXRzID0gZXhwbG9kZSgnLCcsICRleHRyYWN0ZWRSYW5nZSk7ICAgICAgICAvLyBGSVhNRTogd2hhdCBpZiBzaGVldG5hbWUgY29udGFpbnMgY29tbWE\/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXdSYW5nZVNldHMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmFuZ2VTZXRzIGFzICRyYW5nZVNldCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJhbmdlID0gZXhwbG9kZSgnIScsICRyYW5nZVNldCk7ICAgIC8vIEZJWE1FOiB3aGF0IGlmIHNoZWV0bmFtZSBjb250YWlucyBleGNsYW1hdGlvbiBtYXJrPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJhbmdlU2V0ID0gaXNzZXQoJHJhbmdlWzFdKSA\/ICRyYW5nZVsxXSA6ICRyYW5nZVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJwb3MoJHJhbmdlU2V0LCAnOicpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyYW5nZVNldCA9ICRyYW5nZVNldCAuICc6JyAuICRyYW5nZVNldDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXdSYW5nZVNldHNbXSA9IHN0cl9yZXBsYWNlKCckJywgJycsICRyYW5nZVNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1NoZWV0LT5nZXRQYWdlU2V0dXAoKS0+c2V0UHJpbnRBcmVhKGltcGxvZGUoJywnLCAkbmV3UmFuZ2VTZXRzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZXh0IHNoZWV0IGlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArKyRzaGVldElkOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBMb29wIHRocm91Z2ggZGVmaW5lZE5hbWVzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeG1sV29ya2Jvb2stPmRlZmluZWROYW1lcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHhtbFdvcmtib29rLT5kZWZpbmVkTmFtZXMtPmRlZmluZWROYW1lIGFzICRkZWZpbmVkTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgcmFuZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSAoc3RyaW5nKSRkZWZpbmVkTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSBwcmVnX3JlcGxhY2UoJy9cJyhcdyspXCdcIS8nLCAnJywgJGV4dHJhY3RlZFJhbmdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRzcG9zID0gc3RycG9zKCRleHRyYWN0ZWRSYW5nZSwgJyEnKSkgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHRyYWN0ZWRSYW5nZSA9IHN1YnN0cigkZXh0cmFjdGVkUmFuZ2UsIDAsICRzcG9zKS5zdHJfcmVwbGFjZSgnJCcsICcnLCBzdWJzdHIoJGV4dHJhY3RlZFJhbmdlLCAkc3BvcykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHRyYWN0ZWRSYW5nZSA9IHN0cl9yZXBsYWNlKCckJywgJycsICRleHRyYWN0ZWRSYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZCByYW5nZT8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RyaXBvcygoc3RyaW5nKSRkZWZpbmVkTmFtZSwgJyNSRUYhJykgIT09IGZhbHNlIHx8ICRleHRyYWN0ZWRSYW5nZSA9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNvbWUgZGVmaW5lZE5hbWVzIGFyZSBvbmx5IGFwcGxpY2FibGUgaWYgd2UgYXJlIG9uIHRoZSBzYW1lIHNoZWV0Li4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChzdHJpbmcpJGRlZmluZWROYW1lWydsb2NhbFNoZWV0SWQnXSAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMb2NhbCBkZWZpbmVkIG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3dpdGNoIG9uIHR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgoc3RyaW5nKSRkZWZpbmVkTmFtZVsnbmFtZSddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdfeGxubS5fRmlsdGVyRGF0YWJhc2UnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnX3hsbm0uUHJpbnRfVGl0bGVzJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ194bG5tLlByaW50X0FyZWEnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG1hcFNoZWV0SWRbKGludGVnZXIpICRkZWZpbmVkTmFtZVsnbG9jYWxTaGVldElkJ11dICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyYW5nZSA9IGV4cGxvZGUoJyEnLCAoc3RyaW5nKSRkZWZpbmVkTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCgkcmFuZ2UpID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyYW5nZVswXSA9IHN0cl9yZXBsYWNlKCInJyIsICInIiwgJHJhbmdlWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyYW5nZVswXSA9IHN0cl9yZXBsYWNlKCInIiwgIiIsICRyYW5nZVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHdvcmtzaGVldCA9ICRkb2NTaGVldC0+Z2V0UGFyZW50KCktPmdldFNoZWV0QnlOYW1lKCRyYW5nZVswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSBzdHJfcmVwbGFjZSgnJCcsICcnLCAkcmFuZ2VbMV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZSA9ICRkb2NTaGVldC0+Z2V0UGFyZW50KCktPmdldFNoZWV0KCRtYXBTaGVldElkWyhpbnRlZ2VyKSAkZGVmaW5lZE5hbWVbJ2xvY2FsU2hlZXRJZCddXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4Y2VsLT5hZGROYW1lZFJhbmdlKG5ldyBQSFBFeGNlbF9OYW1lZFJhbmdlKChzdHJpbmcpJGRlZmluZWROYW1lWyduYW1lJ10sICR3b3Jrc2hlZXQsICRleHRyYWN0ZWRSYW5nZSwgdHJ1ZSwgJHNjb3BlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoIWlzc2V0KCRkZWZpbmVkTmFtZVsnbG9jYWxTaGVldElkJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICJHbG9iYWwiIGRlZmluZWROYW1lcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRlZFNoZWV0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4dHJhY3RlZFNoZWV0TmFtZSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RycG9zKChzdHJpbmcpJGRlZmluZWROYW1lLCAnIScpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBzaGVldCBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkU2hlZXROYW1lID0gUEhQRXhjZWxfV29ya3NoZWV0OjpleHRyYWN0U2hlZXRUaXRsZSgoc3RyaW5nKSRkZWZpbmVkTmFtZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkU2hlZXROYW1lID0gJGV4dHJhY3RlZFNoZWV0TmFtZVswXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMb2NhdGUgc2hlZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGVkU2hlZXQgPSAkZXhjZWwtPmdldFNoZWV0QnlOYW1lKCRleHRyYWN0ZWRTaGVldE5hbWUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1vZGlmeSByYW5nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJhbmdlID0gZXhwbG9kZSgnIScsICRleHRyYWN0ZWRSYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXh0cmFjdGVkUmFuZ2UgPSBpc3NldCgkcmFuZ2VbMV0pID8gJHJhbmdlWzFdIDogJHJhbmdlWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGxvY2F0ZWRTaGVldCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4Y2VsLT5hZGROYW1lZFJhbmdlKG5ldyBQSFBFeGNlbF9OYW1lZFJhbmdlKChzdHJpbmcpJGRlZmluZWROYW1lWyduYW1lJ10sICRsb2NhdGVkU2hlZXQsICRleHRyYWN0ZWRSYW5nZSwgZmFsc2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCghJHRoaXMtPnJlYWREYXRhT25seSkgfHwgKCFlbXB0eSgkdGhpcy0+bG9hZFNoZWV0c09ubHkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBhY3RpdmUgc2hlZXQgaW5kZXgKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGl2ZVRhYiA9IGludHZhbCgkeG1sV29ya2Jvb2stPmJvb2tWaWV3cy0+d29ya2Jvb2tWaWV3WyJhY3RpdmVUYWIiXSk7IC8vIHJlZmVycyB0byBvbGQgc2hlZXQgaW5kZXgKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGtlZXAgYWN0aXZlIHNoZWV0IGluZGV4IGlmIHNoZWV0IGlzIHN0aWxsIGxvYWRlZCwgZWxzZSBmaXJzdCBzaGVldCBpcyBzZXQgYXMgdGhlIGFjdGl2ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJG1hcFNoZWV0SWRbJGFjdGl2ZVRhYl0pICYmICRtYXBTaGVldElkWyRhY3RpdmVUYWJdICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhjZWwtPnNldEFjdGl2ZVNoZWV0SW5kZXgoJG1hcFNoZWV0SWRbJGFjdGl2ZVRhYl0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRleGNlbC0+Z2V0U2hlZXRDb3VudCgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhjZWwtPmNyZWF0ZVNoZWV0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhjZWwtPnNldEFjdGl2ZVNoZWV0SW5kZXgoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghJHRoaXMtPnJlYWREYXRhT25seSkgewogICAgICAgICAgICAkY29udGVudFR5cGVzID0gc2ltcGxleG1sX2xvYWRfc3RyaW5nKCR0aGlzLT5zZWN1cml0eVNjYW4oJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICJbQ29udGVudF9UeXBlc10ueG1sIikpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOwogICAgICAgICAgICBmb3JlYWNoICgkY29udGVudFR5cGVzLT5PdmVycmlkZSBhcyAkY29udGVudFR5cGUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoJGNvbnRlbnRUeXBlWyJDb250ZW50VHlwZSJdKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LmRyYXdpbmdtbC5jaGFydCt4bWwiOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmluY2x1ZGVDaGFydHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjaGFydEVudHJ5UmVmID0gbHRyaW0oJGNvbnRlbnRUeXBlWydQYXJ0TmFtZSddLCAnLycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNoYXJ0RWxlbWVudHMgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkdGhpcy0+Z2V0RnJvbVppcEFyY2hpdmUoJHppcCwgJGNoYXJ0RW50cnlSZWYpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpDaGFydCA9IFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDIwMDdfQ2hhcnQ6OnJlYWRDaGFydCgkY2hhcnRFbGVtZW50cywgYmFzZW5hbWUoJGNoYXJ0RW50cnlSZWYsICcueG1sJykpOwoKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnQ2hhcnQgJywgJGNoYXJ0RW50cnlSZWYsICc8YnIgLz4nOwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJfZHVtcCgkY2hhcnRzWyRjaGFydEVudHJ5UmVmXSk7Ci8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGNoYXJ0c1skY2hhcnRFbnRyeVJlZl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNoYXJ0UG9zaXRpb25SZWYgPSAkY2hhcnRzWyRjaGFydEVudHJ5UmVmXVsnc2hlZXQnXS4nIScuJGNoYXJ0c1skY2hhcnRFbnRyeVJlZl1bJ2lkJ107Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdQb3NpdGlvbiBSZWYgJywgJGNoYXJ0UG9zaXRpb25SZWYsICc8YnIgLz4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY2hhcnREZXRhaWxzWyRjaGFydFBvc2l0aW9uUmVmXSkpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJfZHVtcCgkY2hhcnREZXRhaWxzWyRjaGFydFBvc2l0aW9uUmVmXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhjZWwtPmdldFNoZWV0QnlOYW1lKCRjaGFydHNbJGNoYXJ0RW50cnlSZWZdWydzaGVldCddKS0+YWRkQ2hhcnQoJG9iakNoYXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakNoYXJ0LT5zZXRXb3Jrc2hlZXQoJGV4Y2VsLT5nZXRTaGVldEJ5TmFtZSgkY2hhcnRzWyRjaGFydEVudHJ5UmVmXVsnc2hlZXQnXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqQ2hhcnQtPnNldFRvcExlZnRQb3NpdGlvbigkY2hhcnREZXRhaWxzWyRjaGFydFBvc2l0aW9uUmVmXVsnZnJvbUNvb3JkaW5hdGUnXSwgJGNoYXJ0RGV0YWlsc1skY2hhcnRQb3NpdGlvblJlZl1bJ2Zyb21PZmZzZXRYJ10sICRjaGFydERldGFpbHNbJGNoYXJ0UG9zaXRpb25SZWZdWydmcm9tT2Zmc2V0WSddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9iakNoYXJ0LT5zZXRCb3R0b21SaWdodFBvc2l0aW9uKCRjaGFydERldGFpbHNbJGNoYXJ0UG9zaXRpb25SZWZdWyd0b0Nvb3JkaW5hdGUnXSwgJGNoYXJ0RGV0YWlsc1skY2hhcnRQb3NpdGlvblJlZl1bJ3RvT2Zmc2V0WCddLCAkY2hhcnREZXRhaWxzWyRjaGFydFBvc2l0aW9uUmVmXVsndG9PZmZzZXRZJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkemlwLT5jbG9zZSgpOwoKICAgICAgICByZXR1cm4gJGV4Y2VsOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIHJlYWRDb2xvcigkY29sb3IsICRiYWNrZ3JvdW5kID0gZmFsc2UpCiAgICB7CiAgICAgICAgaWYgKGlzc2V0KCRjb2xvclsicmdiIl0pKSB7CiAgICAgICAgICAgIHJldHVybiAoc3RyaW5nKSRjb2xvclsicmdiIl07CiAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRjb2xvclsiaW5kZXhlZCJdKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfU3R5bGVfQ29sb3I6OmluZGV4ZWRDb2xvcigkY29sb3JbImluZGV4ZWQiXS03LCAkYmFja2dyb3VuZCktPmdldEFSR0IoKTsKICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJGNvbG9yWyJ0aGVtZSJdKSkgewogICAgICAgICAgICBpZiAoc2VsZjo6JHRoZW1lICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAkcmV0dXJuQ29sb3VyID0gc2VsZjo6JHRoZW1lLT5nZXRDb2xvdXJCeUluZGV4KChpbnQpJGNvbG9yWyJ0aGVtZSJdKTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY29sb3JbInRpbnQiXSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGludEFkanVzdCA9IChmbG9hdCkgJGNvbG9yWyJ0aW50Il07CiAgICAgICAgICAgICAgICAgICAgJHJldHVybkNvbG91ciA9IFBIUEV4Y2VsX1N0eWxlX0NvbG9yOjpjaGFuZ2VCcmlnaHRuZXNzKCRyZXR1cm5Db2xvdXIsICR0aW50QWRqdXN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAnRkYnLiRyZXR1cm5Db2xvdXI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkYmFja2dyb3VuZCkgewogICAgICAgICAgICByZXR1cm4gJ0ZGRkZGRkZGJzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdGRjAwMDAwMCc7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gcmVhZFN0eWxlKCRkb2NTdHlsZSwgJHN0eWxlKQogICAgewogICAgICAgIC8vIGZvcm1hdCBjb2RlCi8vICAgICAgICBpZiAoaXNzZXQoJHN0eWxlLT5udW1GbXQpKSB7Ci8vICAgICAgICAgICAgaWYgKGlzc2V0KCRzdHlsZS0+bnVtRm10Wydmb3JtYXRDb2RlJ10pKSB7Ci8vICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0TnVtYmVyRm9ybWF0KCktPnNldEZvcm1hdENvZGUoKHN0cmluZykgJHN0eWxlLT5udW1GbXRbJ2Zvcm1hdENvZGUnXSk7Ci8vICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0TnVtYmVyRm9ybWF0KCktPnNldEZvcm1hdENvZGUoJHN0eWxlLT5udW1GbXQpOwovLyAgICAgICAgICAgIH0KLy8gICAgICAgIH0KCiAgICAgICAgLy8gZm9udAogICAgICAgIGlmIChpc3NldCgkc3R5bGUtPmZvbnQpKSB7CiAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0Rm9udCgpLT5zZXROYW1lKChzdHJpbmcpICRzdHlsZS0+Zm9udC0+bmFtZVsidmFsIl0pOwogICAgICAgICAgICAkZG9jU3R5bGUtPmdldEZvbnQoKS0+c2V0U2l6ZSgoc3RyaW5nKSAkc3R5bGUtPmZvbnQtPnN6WyJ2YWwiXSk7CiAgICAgICAgICAgIGlmIChpc3NldCgkc3R5bGUtPmZvbnQtPmIpKSB7CiAgICAgICAgICAgICAgICAkZG9jU3R5bGUtPmdldEZvbnQoKS0+c2V0Qm9sZCghaXNzZXQoJHN0eWxlLT5mb250LT5iWyJ2YWwiXSkgfHwgc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkc3R5bGUtPmZvbnQtPmJbInZhbCJdKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzc2V0KCRzdHlsZS0+Zm9udC0+aSkpIHsKICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0Rm9udCgpLT5zZXRJdGFsaWMoIWlzc2V0KCRzdHlsZS0+Zm9udC0+aVsidmFsIl0pIHx8IHNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHN0eWxlLT5mb250LT5pWyJ2YWwiXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc3NldCgkc3R5bGUtPmZvbnQtPnN0cmlrZSkpIHsKICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0Rm9udCgpLT5zZXRTdHJpa2V0aHJvdWdoKCFpc3NldCgkc3R5bGUtPmZvbnQtPnN0cmlrZVsidmFsIl0pIHx8IHNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHN0eWxlLT5mb250LT5zdHJpa2VbInZhbCJdKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRGb250KCktPmdldENvbG9yKCktPnNldEFSR0Ioc2VsZjo6cmVhZENvbG9yKCRzdHlsZS0+Zm9udC0+Y29sb3IpKTsKCiAgICAgICAgICAgIGlmIChpc3NldCgkc3R5bGUtPmZvbnQtPnUpICYmICFpc3NldCgkc3R5bGUtPmZvbnQtPnVbInZhbCJdKSkgewogICAgICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRGb250KCktPnNldFVuZGVybGluZShQSFBFeGNlbF9TdHlsZV9Gb250OjpVTkRFUkxJTkVfU0lOR0xFKTsKICAgICAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRzdHlsZS0+Zm9udC0+dSkgJiYgaXNzZXQoJHN0eWxlLT5mb250LT51WyJ2YWwiXSkpIHsKICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0Rm9udCgpLT5zZXRVbmRlcmxpbmUoKHN0cmluZykkc3R5bGUtPmZvbnQtPnVbInZhbCJdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCRzdHlsZS0+Zm9udC0+dmVydEFsaWduKSAmJiBpc3NldCgkc3R5bGUtPmZvbnQtPnZlcnRBbGlnblsidmFsIl0pKSB7CiAgICAgICAgICAgICAgICAkdmVydEFsaWduID0gc3RydG9sb3dlcigoc3RyaW5nKSRzdHlsZS0+Zm9udC0+dmVydEFsaWduWyJ2YWwiXSk7CiAgICAgICAgICAgICAgICBpZiAoJHZlcnRBbGlnbiA9PSAnc3VwZXJzY3JpcHQnKSB7CiAgICAgICAgICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRGb250KCktPnNldFN1cGVyU2NyaXB0KHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCR2ZXJ0QWxpZ24gPT0gJ3N1YnNjcmlwdCcpIHsKICAgICAgICAgICAgICAgICAgICAkZG9jU3R5bGUtPmdldEZvbnQoKS0+c2V0U3ViU2NyaXB0KHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBmaWxsCiAgICAgICAgaWYgKGlzc2V0KCRzdHlsZS0+ZmlsbCkpIHsKICAgICAgICAgICAgaWYgKCRzdHlsZS0+ZmlsbC0+Z3JhZGllbnRGaWxsKSB7CiAgICAgICAgICAgICAgICAkZ3JhZGllbnRGaWxsID0gJHN0eWxlLT5maWxsLT5ncmFkaWVudEZpbGxbMF07CiAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRncmFkaWVudEZpbGxbInR5cGUiXSkpIHsKICAgICAgICAgICAgICAgICAgICAkZG9jU3R5bGUtPmdldEZpbGwoKS0+c2V0RmlsbFR5cGUoKHN0cmluZykgJGdyYWRpZW50RmlsbFsidHlwZSJdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0RmlsbCgpLT5zZXRSb3RhdGlvbihmbG9hdHZhbCgkZ3JhZGllbnRGaWxsWyJkZWdyZWUiXSkpOwogICAgICAgICAgICAgICAgJGdyYWRpZW50RmlsbC0+cmVnaXN0ZXJYUGF0aE5hbWVzcGFjZSgic21sIiwgImh0dHA6Ly9zY2hlbWFzLm9wZW54bWxmb3JtYXRzLm9yZy9zcHJlYWRzaGVldG1sLzIwMDYvbWFpbiIpOwogICAgICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRGaWxsKCktPmdldFN0YXJ0Q29sb3IoKS0+c2V0QVJHQihzZWxmOjpyZWFkQ29sb3Ioc2VsZjo6Z2V0QXJyYXlJdGVtKCRncmFkaWVudEZpbGwtPnhwYXRoKCJzbWw6c3RvcFtAcG9zaXRpb249MF0iKSktPmNvbG9yKSk7CiAgICAgICAgICAgICAgICAkZG9jU3R5bGUtPmdldEZpbGwoKS0+Z2V0RW5kQ29sb3IoKS0+c2V0QVJHQihzZWxmOjpyZWFkQ29sb3Ioc2VsZjo6Z2V0QXJyYXlJdGVtKCRncmFkaWVudEZpbGwtPnhwYXRoKCJzbWw6c3RvcFtAcG9zaXRpb249MV0iKSktPmNvbG9yKSk7CiAgICAgICAgICAgIH0gZWxzZWlmICgkc3R5bGUtPmZpbGwtPnBhdHRlcm5GaWxsKSB7CiAgICAgICAgICAgICAgICAkcGF0dGVyblR5cGUgPSAoc3RyaW5nKSRzdHlsZS0+ZmlsbC0+cGF0dGVybkZpbGxbInBhdHRlcm5UeXBlIl0gIT0gJycgPyAoc3RyaW5nKSRzdHlsZS0+ZmlsbC0+cGF0dGVybkZpbGxbInBhdHRlcm5UeXBlIl0gOiAnc29saWQnOwogICAgICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRGaWxsKCktPnNldEZpbGxUeXBlKCRwYXR0ZXJuVHlwZSk7CiAgICAgICAgICAgICAgICBpZiAoJHN0eWxlLT5maWxsLT5wYXR0ZXJuRmlsbC0+ZmdDb2xvcikgewogICAgICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0RmlsbCgpLT5nZXRTdGFydENvbG9yKCktPnNldEFSR0Ioc2VsZjo6cmVhZENvbG9yKCRzdHlsZS0+ZmlsbC0+cGF0dGVybkZpbGwtPmZnQ29sb3IsIHRydWUpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRGaWxsKCktPmdldFN0YXJ0Q29sb3IoKS0+c2V0QVJHQignRkYwMDAwMDAnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkc3R5bGUtPmZpbGwtPnBhdHRlcm5GaWxsLT5iZ0NvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRGaWxsKCktPmdldEVuZENvbG9yKCktPnNldEFSR0Ioc2VsZjo6cmVhZENvbG9yKCRzdHlsZS0+ZmlsbC0+cGF0dGVybkZpbGwtPmJnQ29sb3IsIHRydWUpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gYm9yZGVyCiAgICAgICAgaWYgKGlzc2V0KCRzdHlsZS0+Ym9yZGVyKSkgewogICAgICAgICAgICAkZGlhZ29uYWxVcCA9IHNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHN0eWxlLT5ib3JkZXJbImRpYWdvbmFsVXAiXSk7CiAgICAgICAgICAgICRkaWFnb25hbERvd24gPSBzZWxmOjpib29sZWFuKChzdHJpbmcpICRzdHlsZS0+Ym9yZGVyWyJkaWFnb25hbERvd24iXSk7CiAgICAgICAgICAgIGlmICghJGRpYWdvbmFsVXAgJiYgISRkaWFnb25hbERvd24pIHsKICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0Qm9yZGVycygpLT5zZXREaWFnb25hbERpcmVjdGlvbihQSFBFeGNlbF9TdHlsZV9Cb3JkZXJzOjpESUFHT05BTF9OT05FKTsKICAgICAgICAgICAgfSBlbHNlaWYgKCRkaWFnb25hbFVwICYmICEkZGlhZ29uYWxEb3duKSB7CiAgICAgICAgICAgICAgICAkZG9jU3R5bGUtPmdldEJvcmRlcnMoKS0+c2V0RGlhZ29uYWxEaXJlY3Rpb24oUEhQRXhjZWxfU3R5bGVfQm9yZGVyczo6RElBR09OQUxfVVApOwogICAgICAgICAgICB9IGVsc2VpZiAoISRkaWFnb25hbFVwICYmICRkaWFnb25hbERvd24pIHsKICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0Qm9yZGVycygpLT5zZXREaWFnb25hbERpcmVjdGlvbihQSFBFeGNlbF9TdHlsZV9Cb3JkZXJzOjpESUFHT05BTF9ET1dOKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0Qm9yZGVycygpLT5zZXREaWFnb25hbERpcmVjdGlvbihQSFBFeGNlbF9TdHlsZV9Cb3JkZXJzOjpESUFHT05BTF9CT1RIKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmOjpyZWFkQm9yZGVyKCRkb2NTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRMZWZ0KCksICRzdHlsZS0+Ym9yZGVyLT5sZWZ0KTsKICAgICAgICAgICAgc2VsZjo6cmVhZEJvcmRlcigkZG9jU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0UmlnaHQoKSwgJHN0eWxlLT5ib3JkZXItPnJpZ2h0KTsKICAgICAgICAgICAgc2VsZjo6cmVhZEJvcmRlcigkZG9jU3R5bGUtPmdldEJvcmRlcnMoKS0+Z2V0VG9wKCksICRzdHlsZS0+Ym9yZGVyLT50b3ApOwogICAgICAgICAgICBzZWxmOjpyZWFkQm9yZGVyKCRkb2NTdHlsZS0+Z2V0Qm9yZGVycygpLT5nZXRCb3R0b20oKSwgJHN0eWxlLT5ib3JkZXItPmJvdHRvbSk7CiAgICAgICAgICAgIHNlbGY6OnJlYWRCb3JkZXIoJGRvY1N0eWxlLT5nZXRCb3JkZXJzKCktPmdldERpYWdvbmFsKCksICRzdHlsZS0+Ym9yZGVyLT5kaWFnb25hbCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhbGlnbm1lbnQKICAgICAgICBpZiAoaXNzZXQoJHN0eWxlLT5hbGlnbm1lbnQpKSB7CiAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEhvcml6b250YWwoKHN0cmluZykgJHN0eWxlLT5hbGlnbm1lbnRbImhvcml6b250YWwiXSk7CiAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldFZlcnRpY2FsKChzdHJpbmcpICRzdHlsZS0+YWxpZ25tZW50WyJ2ZXJ0aWNhbCJdKTsKCiAgICAgICAgICAgICR0ZXh0Um90YXRpb24gPSAwOwogICAgICAgICAgICBpZiAoKGludCkkc3R5bGUtPmFsaWdubWVudFsidGV4dFJvdGF0aW9uIl0gPD0gOTApIHsKICAgICAgICAgICAgICAgICR0ZXh0Um90YXRpb24gPSAoaW50KSRzdHlsZS0+YWxpZ25tZW50WyJ0ZXh0Um90YXRpb24iXTsKICAgICAgICAgICAgfSBlbHNlaWYgKChpbnQpJHN0eWxlLT5hbGlnbm1lbnRbInRleHRSb3RhdGlvbiJdID4gOTApIHsKICAgICAgICAgICAgICAgICR0ZXh0Um90YXRpb24gPSA5MCAtIChpbnQpJHN0eWxlLT5hbGlnbm1lbnRbInRleHRSb3RhdGlvbiJdOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZG9jU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRUZXh0Um90YXRpb24oaW50dmFsKCR0ZXh0Um90YXRpb24pKTsKICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRBbGlnbm1lbnQoKS0+c2V0V3JhcFRleHQoc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkc3R5bGUtPmFsaWdubWVudFsid3JhcFRleHQiXSkpOwogICAgICAgICAgICAkZG9jU3R5bGUtPmdldEFsaWdubWVudCgpLT5zZXRTaHJpbmtUb0ZpdChzZWxmOjpib29sZWFuKChzdHJpbmcpICRzdHlsZS0+YWxpZ25tZW50WyJzaHJpbmtUb0ZpdCJdKSk7CiAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0QWxpZ25tZW50KCktPnNldEluZGVudChpbnR2YWwoKHN0cmluZykkc3R5bGUtPmFsaWdubWVudFsiaW5kZW50Il0pID4gMCA\/IGludHZhbCgoc3RyaW5nKSRzdHlsZS0+YWxpZ25tZW50WyJpbmRlbnQiXSkgOiAwKTsKICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRBbGlnbm1lbnQoKS0+c2V0UmVhZG9yZGVyKGludHZhbCgoc3RyaW5nKSRzdHlsZS0+YWxpZ25tZW50WyJyZWFkaW5nT3JkZXIiXSkgPiAwID8gaW50dmFsKChzdHJpbmcpJHN0eWxlLT5hbGlnbm1lbnRbInJlYWRpbmdPcmRlciJdKSA6IDApOwogICAgICAgIH0KCiAgICAgICAgLy8gcHJvdGVjdGlvbgogICAgICAgIGlmIChpc3NldCgkc3R5bGUtPnByb3RlY3Rpb24pKSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkc3R5bGUtPnByb3RlY3Rpb25bJ2xvY2tlZCddKSkgewogICAgICAgICAgICAgICAgaWYgKHNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHN0eWxlLT5wcm90ZWN0aW9uWydsb2NrZWQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkZG9jU3R5bGUtPmdldFByb3RlY3Rpb24oKS0+c2V0TG9ja2VkKFBIUEV4Y2VsX1N0eWxlX1Byb3RlY3Rpb246OlBST1RFQ1RJT05fUFJPVEVDVEVEKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGRvY1N0eWxlLT5nZXRQcm90ZWN0aW9uKCktPnNldExvY2tlZChQSFBFeGNlbF9TdHlsZV9Qcm90ZWN0aW9uOjpQUk9URUNUSU9OX1VOUFJPVEVDVEVEKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCRzdHlsZS0+cHJvdGVjdGlvblsnaGlkZGVuJ10pKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkc3R5bGUtPnByb3RlY3Rpb25bJ2hpZGRlbiddKSkgewogICAgICAgICAgICAgICAgICAgICRkb2NTdHlsZS0+Z2V0UHJvdGVjdGlvbigpLT5zZXRIaWRkZW4oUEhQRXhjZWxfU3R5bGVfUHJvdGVjdGlvbjo6UFJPVEVDVElPTl9QUk9URUNURUQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkZG9jU3R5bGUtPmdldFByb3RlY3Rpb24oKS0+c2V0SGlkZGVuKFBIUEV4Y2VsX1N0eWxlX1Byb3RlY3Rpb246OlBST1RFQ1RJT05fVU5QUk9URUNURUQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0b3AtbGV2ZWwgc3R5bGUgc2V0dGluZ3MKICAgICAgICBpZiAoaXNzZXQoJHN0eWxlLT5xdW90ZVByZWZpeCkpIHsKICAgICAgICAgICAgJGRvY1N0eWxlLT5zZXRRdW90ZVByZWZpeCgkc3R5bGUtPnF1b3RlUHJlZml4KTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gcmVhZEJvcmRlcigkZG9jQm9yZGVyLCAkZWxlQm9yZGVyKQogICAgewogICAgICAgIGlmIChpc3NldCgkZWxlQm9yZGVyWyJzdHlsZSJdKSkgewogICAgICAgICAgICAkZG9jQm9yZGVyLT5zZXRCb3JkZXJTdHlsZSgoc3RyaW5nKSAkZWxlQm9yZGVyWyJzdHlsZSJdKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRlbGVCb3JkZXItPmNvbG9yKSkgewogICAgICAgICAgICAkZG9jQm9yZGVyLT5nZXRDb2xvcigpLT5zZXRBUkdCKHNlbGY6OnJlYWRDb2xvcigkZWxlQm9yZGVyLT5jb2xvcikpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGZ1bmN0aW9uIHBhcnNlUmljaFRleHQoJGlzID0gbnVsbCkKICAgIHsKICAgICAgICAkdmFsdWUgPSBuZXcgUEhQRXhjZWxfUmljaFRleHQoKTsKCiAgICAgICAgaWYgKGlzc2V0KCRpcy0+dCkpIHsKICAgICAgICAgICAgJHZhbHVlLT5jcmVhdGVUZXh0KFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkNvbnRyb2xDaGFyYWN0ZXJPT1hNTDJQSFAoKHN0cmluZykgJGlzLT50KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGlzX29iamVjdCgkaXMtPnIpKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkaXMtPnIgYXMgJHJ1bikgewogICAgICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJHJ1bi0+clByKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkb2JqVGV4dCA9ICR2YWx1ZS0+Y3JlYXRlVGV4dChQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb250cm9sQ2hhcmFjdGVyT09YTUwyUEhQKChzdHJpbmcpICRydW4tPnQpKTsKCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG9ialRleHQgPSAkdmFsdWUtPmNyZWF0ZVRleHRSdW4oUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q29udHJvbENoYXJhY3Rlck9PWE1MMlBIUCgoc3RyaW5nKSAkcnVuLT50KSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJ1bi0+clByLT5yRm9udFsidmFsIl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqVGV4dC0+Z2V0Rm9udCgpLT5zZXROYW1lKChzdHJpbmcpICRydW4tPnJQci0+ckZvbnRbInZhbCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJ1bi0+clByLT5zelsidmFsIl0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqVGV4dC0+Z2V0Rm9udCgpLT5zZXRTaXplKChzdHJpbmcpICRydW4tPnJQci0+c3pbInZhbCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJ1bi0+clByLT5jb2xvcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpUZXh0LT5nZXRGb250KCktPnNldENvbG9yKG5ldyBQSFBFeGNlbF9TdHlsZV9Db2xvcihzZWxmOjpyZWFkQ29sb3IoJHJ1bi0+clByLT5jb2xvcikpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlzc2V0KCRydW4tPnJQci0+YlsidmFsIl0pICYmIHNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHJ1bi0+clByLT5iWyJ2YWwiXSkpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaXNzZXQoJHJ1bi0+clByLT5iKSAmJiAhaXNzZXQoJHJ1bi0+clByLT5iWyJ2YWwiXSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqVGV4dC0+Z2V0Rm9udCgpLT5zZXRCb2xkKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHJ1bi0+clByLT5pWyJ2YWwiXSkgJiYgc2VsZjo6Ym9vbGVhbigoc3RyaW5nKSAkcnVuLT5yUHItPmlbInZhbCJdKSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpc3NldCgkcnVuLT5yUHItPmkpICYmICFpc3NldCgkcnVuLT5yUHItPmlbInZhbCJdKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpUZXh0LT5nZXRGb250KCktPnNldEl0YWxpYyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJ1bi0+clByLT52ZXJ0QWxpZ24pICYmIGlzc2V0KCRydW4tPnJQci0+dmVydEFsaWduWyJ2YWwiXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2ZXJ0QWxpZ24gPSBzdHJ0b2xvd2VyKChzdHJpbmcpJHJ1bi0+clByLT52ZXJ0QWxpZ25bInZhbCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmVydEFsaWduID09ICdzdXBlcnNjcmlwdCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqVGV4dC0+Z2V0Rm9udCgpLT5zZXRTdXBlclNjcmlwdCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmVydEFsaWduID09ICdzdWJzY3JpcHQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialRleHQtPmdldEZvbnQoKS0+c2V0U3ViU2NyaXB0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkcnVuLT5yUHItPnUpICYmICFpc3NldCgkcnVuLT5yUHItPnVbInZhbCJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialRleHQtPmdldEZvbnQoKS0+c2V0VW5kZXJsaW5lKFBIUEV4Y2VsX1N0eWxlX0ZvbnQ6OlVOREVSTElORV9TSU5HTEUpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJHJ1bi0+clByLT51KSAmJiBpc3NldCgkcnVuLT5yUHItPnVbInZhbCJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialRleHQtPmdldEZvbnQoKS0+c2V0VW5kZXJsaW5lKChzdHJpbmcpJHJ1bi0+clByLT51WyJ2YWwiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChpc3NldCgkcnVuLT5yUHItPnN0cmlrZVsidmFsIl0pICYmIHNlbGY6OmJvb2xlYW4oKHN0cmluZykgJHJ1bi0+clByLT5zdHJpa2VbInZhbCJdKSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpc3NldCgkcnVuLT5yUHItPnN0cmlrZSkgJiYgIWlzc2V0KCRydW4tPnJQci0+c3RyaWtlWyJ2YWwiXSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqVGV4dC0+Z2V0Rm9udCgpLT5zZXRTdHJpa2V0aHJvdWdoKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHZhbHVlOwogICAgfQoKICAgIHByaXZhdGUgZnVuY3Rpb24gcmVhZFJpYmJvbigkZXhjZWwsICRjdXN0b21VSVRhcmdldCwgJHppcCkKICAgIHsKICAgICAgICAkYmFzZURpciA9IGRpcm5hbWUoJGN1c3RvbVVJVGFyZ2V0KTsKICAgICAgICAkbmFtZUN1c3RvbVVJID0gYmFzZW5hbWUoJGN1c3RvbVVJVGFyZ2V0KTsKICAgICAgICAvLyBnZXQgdGhlIHhtbCBmaWxlIChyaWJib24pCiAgICAgICAgJGxvY2FsUmliYm9uID0gJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICRjdXN0b21VSVRhcmdldCk7CiAgICAgICAgJGN1c3RvbVVJSW1hZ2VzTmFtZXMgPSBhcnJheSgpOwogICAgICAgICRjdXN0b21VSUltYWdlc0JpbmFyaWVzID0gYXJyYXkoKTsKICAgICAgICAvLyBzb21ldGhpbmcgbGlrZSBjdXN0b21VSS9fcmVscy9jdXN0b21VSS54bWwucmVscwogICAgICAgICRwYXRoUmVscyA9ICRiYXNlRGlyIC4gJy9fcmVscy8nIC4gJG5hbWVDdXN0b21VSSAuICcucmVscyc7CiAgICAgICAgJGRhdGFSZWxzID0gJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICRwYXRoUmVscyk7CiAgICAgICAgaWYgKCRkYXRhUmVscykgewogICAgICAgICAgICAvLyBleGlzdHMgYW5kIG5vdCBlbXB0eSBpZiB0aGUgcmliYm9uIGhhdmUgc29tZSBwaWN0dXJlcyAob3RoZXIgdGhhbiBpbnRlcm5hbCBNU08pCiAgICAgICAgICAgICRVSVJlbHMgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbigkZGF0YVJlbHMpLCAnU2ltcGxlWE1MRWxlbWVudCcsIFBIUEV4Y2VsX1NldHRpbmdzOjpnZXRMaWJYbWxMb2FkZXJPcHRpb25zKCkpOwogICAgICAgICAgICBpZiAoJFVJUmVscykgewogICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBzYXZlIGlkIGFuZCB0YXJnZXQgdG8gYXZvaWQgcGFyc2luZyBjdXN0b21VSS54bWwgYW5kICJndWVzcyIgaWYgaXQncyBhIHBzZXVkbyBjYWxsYmFjayB3aG8gbG9hZCB0aGUgaW1hZ2UKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRVSVJlbHMtPlJlbGF0aW9uc2hpcCBhcyAkZWxlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVbIlR5cGUiXSA9PSAnaHR0cDovL3NjaGVtYXMub3BlbnhtbGZvcm1hdHMub3JnL29mZmljZURvY3VtZW50LzIwMDYvcmVsYXRpb25zaGlwcy9pbWFnZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW4gaW1hZ2UgPwogICAgICAgICAgICAgICAgICAgICAgICAkY3VzdG9tVUlJbWFnZXNOYW1lc1soc3RyaW5nKSAkZWxlWydJZCddXSA9IChzdHJpbmcpJGVsZVsnVGFyZ2V0J107CiAgICAgICAgICAgICAgICAgICAgICAgICRjdXN0b21VSUltYWdlc0JpbmFyaWVzWyhzdHJpbmcpJGVsZVsnVGFyZ2V0J11dID0gJHRoaXMtPmdldEZyb21aaXBBcmNoaXZlKCR6aXAsICRiYXNlRGlyIC4gJy8nIC4gKHN0cmluZykgJGVsZVsnVGFyZ2V0J10pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoJGxvY2FsUmliYm9uKSB7CiAgICAgICAgICAgICRleGNlbC0+c2V0UmliYm9uWE1MRGF0YSgkY3VzdG9tVUlUYXJnZXQsICRsb2NhbFJpYmJvbik7CiAgICAgICAgICAgIGlmIChjb3VudCgkY3VzdG9tVUlJbWFnZXNOYW1lcykgPiAwICYmIGNvdW50KCRjdXN0b21VSUltYWdlc0JpbmFyaWVzKSA+IDApIHsKICAgICAgICAgICAgICAgICRleGNlbC0+c2V0UmliYm9uQmluT2JqZWN0cygkY3VzdG9tVUlJbWFnZXNOYW1lcywgJGN1c3RvbVVJSW1hZ2VzQmluYXJpZXMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGV4Y2VsLT5zZXRSaWJib25CaW5PYmplY3RzKG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGV4Y2VsLT5zZXRSaWJib25YTUxEYXRhKG51bGwpOwogICAgICAgICAgICAkZXhjZWwtPnNldFJpYmJvbkJpbk9iamVjdHMobnVsbCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGdldEFycmF5SXRlbSgkYXJyYXksICRrZXkgPSAwKQogICAgewogICAgICAgIHJldHVybiAoaXNzZXQoJGFycmF5WyRrZXldKSA\/ICRhcnJheVska2V5XSA6IG51bGwpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGRpckFkZCgkYmFzZSwgJGFkZCkKICAgIHsKICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCd+W14vXSsvXC5cLi9+JywgJycsIGRpcm5hbWUoJGJhc2UpIC4gIi8kYWRkIik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gdG9DU1NBcnJheSgkc3R5bGUpCiAgICB7CiAgICAgICAgJHN0eWxlID0gc3RyX3JlcGxhY2UoYXJyYXkoIlxyIiwiXG4iKSwgIiIsICRzdHlsZSk7CgogICAgICAgICR0ZW1wID0gZXhwbG9kZSgnOycsICRzdHlsZSk7CiAgICAgICAgJHN0eWxlID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdGVtcCBhcyAkaXRlbSkgewogICAgICAgICAgICAkaXRlbSA9IGV4cGxvZGUoJzonLCAkaXRlbSk7CgogICAgICAgICAgICBpZiAoc3RycG9zKCRpdGVtWzFdLCAncHgnKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICRpdGVtWzFdID0gc3RyX3JlcGxhY2UoJ3B4JywgJycsICRpdGVtWzFdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RycG9zKCRpdGVtWzFdLCAncHQnKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICRpdGVtWzFdID0gc3RyX3JlcGxhY2UoJ3B0JywgJycsICRpdGVtWzFdKTsKICAgICAgICAgICAgICAgICRpdGVtWzFdID0gUEhQRXhjZWxfU2hhcmVkX0ZvbnQ6OmZvbnRTaXplVG9QaXhlbHMoJGl0ZW1bMV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdHJwb3MoJGl0ZW1bMV0sICdpbicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgJGl0ZW1bMV0gPSBzdHJfcmVwbGFjZSgnaW4nLCAnJywgJGl0ZW1bMV0pOwogICAgICAgICAgICAgICAgJGl0ZW1bMV0gPSBQSFBFeGNlbF9TaGFyZWRfRm9udDo6aW5jaFNpemVUb1BpeGVscygkaXRlbVsxXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0cnBvcygkaXRlbVsxXSwgJ2NtJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAkaXRlbVsxXSA9IHN0cl9yZXBsYWNlKCdjbScsICcnLCAkaXRlbVsxXSk7CiAgICAgICAgICAgICAgICAkaXRlbVsxXSA9IFBIUEV4Y2VsX1NoYXJlZF9Gb250OjpjZW50aW1ldGVyU2l6ZVRvUGl4ZWxzKCRpdGVtWzFdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHN0eWxlWyRpdGVtWzBdXSA9ICRpdGVtWzFdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRzdHlsZTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBib29sZWFuKCR2YWx1ZSA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKGlzX29iamVjdCgkdmFsdWUpKSB7CiAgICAgICAgICAgICR2YWx1ZSA9IChzdHJpbmcpICR2YWx1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzX251bWVyaWMoJHZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gKGJvb2wpICR2YWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICgkdmFsdWUgPT09ICd0cnVlJyB8fCAkdmFsdWUgPT09ICdUUlVFJyk7CiAgICB9Cn0K",
    "size": "134706"
}