{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Shared\/PCLZip\/pclzip.lib.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gUGhwQ29uY2VwdCBMaWJyYXJ5IC0gWmlwIE1vZHVsZSAyLjguMgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBMaWNlbnNlIEdOVS9MR1BMIC0gVmluY2VudCBCbGF2ZXQgLSBBdWd1c3QgMjAwOQovLyBodHRwOi8vd3d3LnBocGNvbmNlcHQubmV0Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vCi8vIFByZXNlbnRhdGlvbiA6Ci8vICAgICBQY2xaaXAgaXMgYSBQSFAgbGlicmFyeSB0aGF0IG1hbmFnZSBaSVAgYXJjaGl2ZXMuCi8vICAgICBTbyBmYXIgdGVzdHMgc2hvdyB0aGF0IGFyY2hpdmVzIGdlbmVyYXRlZCBieSBQY2xaaXAgYXJlIHJlYWRhYmxlIGJ5Ci8vICAgICBXaW5aaXAgYXBwbGljYXRpb24gYW5kIG90aGVyIHRvb2xzLgovLwovLyBEZXNjcmlwdGlvbiA6Ci8vICAgICBTZWUgcmVhZG1lLnR4dCBhbmQgaHR0cDovL3d3dy5waHBjb25jZXB0Lm5ldAovLwovLyBXYXJuaW5nIDoKLy8gICAgIFRoaXMgbGlicmFyeSBhbmQgdGhlIGFzc29jaWF0ZWQgZmlsZXMgYXJlIG5vbiBjb21tZXJjaWFsLCBub24gcHJvZmVzc2lvbmFsCi8vICAgICB3b3JrLgovLyAgICAgSXQgc2hvdWxkIG5vdCBoYXZlIHVuZXhwZWN0ZWQgcmVzdWx0cy4gSG93ZXZlciBpZiBhbnkgZGFtYWdlIGlzIGNhdXNlZCBieQovLyAgICAgdGhpcyBzb2Z0d2FyZSB0aGUgYXV0aG9yIGNhbiBub3QgYmUgcmVzcG9uc2libGUuCi8vICAgICBUaGUgdXNlIG9mIHRoaXMgc29mdHdhcmUgaXMgYXQgdGhlIHJpc2sgb2YgdGhlIHVzZXIuCi8vCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vICRJZDogcGNsemlwLmxpYi5waHAsdiAxLjYwIDIwMDkvMDkvMzAgMjE6MDE6MDQgdmJsYXZldCBFeHAgJAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8gLS0tLS0gQ29uc3RhbnRzCmlmICghZGVmaW5lZCgnUENMWklQX1JFQURfQkxPQ0tfU0laRScpKSB7CiAgICBkZWZpbmUoJ1BDTFpJUF9SRUFEX0JMT0NLX1NJWkUnLCAyMDQ4KTsKfQoKLy8gLS0tLS0gRmlsZSBsaXN0IHNlcGFyYXRvcgovLyBJbiB2ZXJzaW9uIDEueCBvZiBQY2xaaXAsIHRoZSBzZXBhcmF0b3IgZm9yIGZpbGUgbGlzdCBpcyBhIHNwYWNlCi8vICh3aGljaCBpcyBub3QgYSB2ZXJ5IHNtYXJ0IGNob2ljZSwgc3BlY2lmaWNhbGx5IGZvciB3aW5kb3dzIHBhdGhzICEpLgovLyBBIGJldHRlciBzZXBhcmF0b3Igc2hvdWxkIGJlIGEgY29tbWEgKCwpLiBUaGlzIGNvbnN0YW50IGdpdmVzIHlvdSB0aGUKLy8gYWJpbHR5IHRvIGNoYW5nZSB0aGF0LgovLyBIb3dldmVyIG5vdGljZSB0aGF0IGNoYW5naW5nIHRoaXMgdmFsdWUsIG1heSBoYXZlIGltcGFjdCBvbiBleGlzdGluZwovLyBzY3JpcHRzLCB1c2luZyBzcGFjZSBzZXBhcmF0ZWQgZmlsZW5hbWVzLgovLyBSZWNvbW1hbmRlZCB2YWx1ZXMgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBvbGRlciB2ZXJzaW9ucyA6Ci8vZGVmaW5lKCdQQ0xaSVBfU0VQQVJBVE9SJywgJyAnKTsKLy8gUmVjb21tYW5kZWQgdmFsdWVzIGZvciBzbWFydCBzZXBhcmF0aW9uIG9mIGZpbGVuYW1lcy4KaWYgKCFkZWZpbmVkKCdQQ0xaSVBfU0VQQVJBVE9SJykpIHsKICAgIGRlZmluZSgnUENMWklQX1NFUEFSQVRPUicsICcsJyk7Cn0KCi8vIC0tLS0tIEVycm9yIGNvbmZpZ3VyYXRpb24KLy8gMCA6IFBjbFppcCBDbGFzcyBpbnRlZ3JhdGVkIGVycm9yIGhhbmRsaW5nCi8vIDEgOiBQY2xFcnJvciBleHRlcm5hbCBsaWJyYXJ5IGVycm9yIGhhbmRsaW5nLiBCeSBlbmFibGluZyB0aGlzCi8vICAgICAgICAgeW91IG11c3QgZW5zdXJlIHRoYXQgeW91IGhhdmUgaW5jbHVkZWQgUGNsRXJyb3IgbGlicmFyeS4KLy8gWzIsLi4uXSA6IHJlc2VydmVkIGZvciBmdXR1ciB1c2UKaWYgKCFkZWZpbmVkKCdQQ0xaSVBfRVJST1JfRVhURVJOQUwnKSkgewogICAgZGVmaW5lKCdQQ0xaSVBfRVJST1JfRVhURVJOQUwnLCAwKTsKfQoKLy8gLS0tLS0gT3B0aW9uYWwgc3RhdGljIHRlbXBvcmFyeSBkaXJlY3RvcnkKLy8gICAgICAgICAgICAgQnkgZGVmYXVsdCB0ZW1wb3JhcnkgZmlsZXMgYXJlIGdlbmVyYXRlZCBpbiB0aGUgc2NyaXB0IGN1cnJlbnQKLy8gICAgICAgICAgICAgcGF0aC4KLy8gICAgICAgICAgICAgSWYgZGVmaW5lZCA6Ci8vICAgICAgICAgICAgIC0gTVVTVCBCRSB0ZXJtaW5hdGVkIGJ5IGEgJy8nLgovLyAgICAgICAgICAgICAtIE1VU1QgYmUgYSB2YWxpZCwgYWxyZWFkeSBjcmVhdGVkIGRpcmVjdG9yeQovLyAgICAgICAgICAgICBTYW1wbGVzIDoKLy8gZGVmaW5lKCdQQ0xaSVBfVEVNUE9SQVJZX0RJUicsICcvdGVtcC8nKTsKLy8gZGVmaW5lKCdQQ0xaSVBfVEVNUE9SQVJZX0RJUicsICdDOi9UZW1wLycpOwppZiAoIWRlZmluZWQoJ1BDTFpJUF9URU1QT1JBUllfRElSJykpIHsKICAgIGRlZmluZSgnUENMWklQX1RFTVBPUkFSWV9ESVInLCAnJyk7Cn0KCi8vIC0tLS0tIE9wdGlvbmFsIHRocmVzaG9sZCByYXRpbyBmb3IgdXNlIG9mIHRlbXBvcmFyeSBmaWxlcwovLyAgICAgICAgICAgICBQY2x6aXAgc2Vuc2UgdGhlIHNpemUgb2YgdGhlIGZpbGUgdG8gYWRkL2V4dHJhY3QgYW5kIGRlY2lkZSB0bwovLyAgICAgICAgICAgICB1c2Ugb3Igbm90IHRlbXBvcmFyeSBmaWxlLiBUaGUgYWxnb3J5dGhtIGlzIGxvb2tpbmcgZm9yCi8vICAgICAgICAgICAgIG1lbW9yeV9saW1pdCBvZiBQSFAgYW5kIGFwcGx5IGEgcmF0aW8uCi8vICAgICAgICAgICAgIHRocmVzaG9sZCA9IG1lbW9yeV9saW1pdCAqIHJhdGlvLgovLyAgICAgICAgICAgICBSZWNvbW1lbmRlZCB2YWx1ZXMgYXJlIHVuZGVyIDAuNS4gRGVmYXVsdCAwLjQ3LgovLyAgICAgICAgICAgICBTYW1wbGVzIDoKLy8gZGVmaW5lKCdQQ0xaSVBfVEVNUE9SQVJZX0ZJTEVfUkFUSU8nLCAwLjUpOwppZiAoIWRlZmluZWQoJ1BDTFpJUF9URU1QT1JBUllfRklMRV9SQVRJTycpKSB7CiAgICBkZWZpbmUoJ1BDTFpJUF9URU1QT1JBUllfRklMRV9SQVRJTycsIDAuNDcpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAqKioqKiBVTkRFUiBUSElTIExJTkUgTk9USElORyBORUVEUyBUTyBCRSBNT0RJRklFRCAqKioqKgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8gLS0tLS0gR2xvYmFsIHZhcmlhYmxlcwokZ19wY2x6aXBfdmVyc2lvbiA9ICIyLjguMiI7CgovLyAtLS0tLSBFcnJvciBjb2RlcwovLyAgICAgLTEgOiBVbmFibGUgdG8gb3BlbiBmaWxlIGluIGJpbmFyeSB3cml0ZSBtb2RlCi8vICAgICAtMiA6IFVuYWJsZSB0byBvcGVuIGZpbGUgaW4gYmluYXJ5IHJlYWQgbW9kZQovLyAgICAgLTMgOiBJbnZhbGlkIHBhcmFtZXRlcnMKLy8gICAgIC00IDogRmlsZSBkb2VzIG5vdCBleGlzdAovLyAgICAgLTUgOiBGaWxlbmFtZSBpcyB0b28gbG9uZyAobWF4LiAyNTUpCi8vICAgICAtNiA6IE5vdCBhIHZhbGlkIHppcCBmaWxlCi8vICAgICAtNyA6IEludmFsaWQgZXh0cmFjdGVkIGZpbGUgc2l6ZQovLyAgICAgLTggOiBVbmFibGUgdG8gY3JlYXRlIGRpcmVjdG9yeQovLyAgICAgLTkgOiBJbnZhbGlkIGFyY2hpdmUgZXh0ZW5zaW9uCi8vICAgIC0xMCA6IEludmFsaWQgYXJjaGl2ZSBmb3JtYXQKLy8gICAgLTExIDogVW5hYmxlIHRvIGRlbGV0ZSBmaWxlICh1bmxpbmspCi8vICAgIC0xMiA6IFVuYWJsZSB0byByZW5hbWUgZmlsZSAocmVuYW1lKQovLyAgICAtMTMgOiBJbnZhbGlkIGhlYWRlciBjaGVja3N1bQovLyAgICAtMTQgOiBJbnZhbGlkIGFyY2hpdmUgc2l6ZQpkZWZpbmUoJ1BDTFpJUF9FUlJfVVNFUl9BQk9SVEVEJywgMik7CmRlZmluZSgnUENMWklQX0VSUl9OT19FUlJPUicsIDApOwpkZWZpbmUoJ1BDTFpJUF9FUlJfV1JJVEVfT1BFTl9GQUlMJywgLTEpOwpkZWZpbmUoJ1BDTFpJUF9FUlJfUkVBRF9PUEVOX0ZBSUwnLCAtMik7CmRlZmluZSgnUENMWklQX0VSUl9JTlZBTElEX1BBUkFNRVRFUicsIC0zKTsKZGVmaW5lKCdQQ0xaSVBfRVJSX01JU1NJTkdfRklMRScsIC00KTsKZGVmaW5lKCdQQ0xaSVBfRVJSX0ZJTEVOQU1FX1RPT19MT05HJywgLTUpOwpkZWZpbmUoJ1BDTFpJUF9FUlJfSU5WQUxJRF9aSVAnLCAtNik7CmRlZmluZSgnUENMWklQX0VSUl9CQURfRVhUUkFDVEVEX0ZJTEUnLCAtNyk7CmRlZmluZSgnUENMWklQX0VSUl9ESVJfQ1JFQVRFX0ZBSUwnLCAtOCk7CmRlZmluZSgnUENMWklQX0VSUl9CQURfRVhURU5TSU9OJywgLTkpOwpkZWZpbmUoJ1BDTFpJUF9FUlJfQkFEX0ZPUk1BVCcsIC0xMCk7CmRlZmluZSgnUENMWklQX0VSUl9ERUxFVEVfRklMRV9GQUlMJywgLTExKTsKZGVmaW5lKCdQQ0xaSVBfRVJSX1JFTkFNRV9GSUxFX0ZBSUwnLCAtMTIpOwpkZWZpbmUoJ1BDTFpJUF9FUlJfQkFEX0NIRUNLU1VNJywgLTEzKTsKZGVmaW5lKCdQQ0xaSVBfRVJSX0lOVkFMSURfQVJDSElWRV9aSVAnLCAtMTQpOwpkZWZpbmUoJ1BDTFpJUF9FUlJfTUlTU0lOR19PUFRJT05fVkFMVUUnLCAtMTUpOwpkZWZpbmUoJ1BDTFpJUF9FUlJfSU5WQUxJRF9PUFRJT05fVkFMVUUnLCAtMTYpOwpkZWZpbmUoJ1BDTFpJUF9FUlJfQUxSRUFEWV9BX0RJUkVDVE9SWScsIC0xNyk7CmRlZmluZSgnUENMWklQX0VSUl9VTlNVUFBPUlRFRF9DT01QUkVTU0lPTicsIC0xOCk7CmRlZmluZSgnUENMWklQX0VSUl9VTlNVUFBPUlRFRF9FTkNSWVBUSU9OJywgLTE5KTsKZGVmaW5lKCdQQ0xaSVBfRVJSX0lOVkFMSURfQVRUUklCVVRFX1ZBTFVFJywgLTIwKTsKZGVmaW5lKCdQQ0xaSVBfRVJSX0RJUkVDVE9SWV9SRVNUUklDVElPTicsIC0yMSk7CgovLyAtLS0tLSBPcHRpb25zIHZhbHVlcwpkZWZpbmUoJ1BDTFpJUF9PUFRfUEFUSCcsIDc3MDAxKTsKZGVmaW5lKCdQQ0xaSVBfT1BUX0FERF9QQVRIJywgNzcwMDIpOwpkZWZpbmUoJ1BDTFpJUF9PUFRfUkVNT1ZFX1BBVEgnLCA3NzAwMyk7CmRlZmluZSgnUENMWklQX09QVF9SRU1PVkVfQUxMX1BBVEgnLCA3NzAwNCk7CmRlZmluZSgnUENMWklQX09QVF9TRVRfQ0hNT0QnLCA3NzAwNSk7CmRlZmluZSgnUENMWklQX09QVF9FWFRSQUNUX0FTX1NUUklORycsIDc3MDA2KTsKZGVmaW5lKCdQQ0xaSVBfT1BUX05PX0NPTVBSRVNTSU9OJywgNzcwMDcpOwpkZWZpbmUoJ1BDTFpJUF9PUFRfQllfTkFNRScsIDc3MDA4KTsKZGVmaW5lKCdQQ0xaSVBfT1BUX0JZX0lOREVYJywgNzcwMDkpOwpkZWZpbmUoJ1BDTFpJUF9PUFRfQllfRVJFRycsIDc3MDEwKTsKZGVmaW5lKCdQQ0xaSVBfT1BUX0JZX1BSRUcnLCA3NzAxMSk7CmRlZmluZSgnUENMWklQX09QVF9DT01NRU5UJywgNzcwMTIpOwpkZWZpbmUoJ1BDTFpJUF9PUFRfQUREX0NPTU1FTlQnLCA3NzAxMyk7CmRlZmluZSgnUENMWklQX09QVF9QUkVQRU5EX0NPTU1FTlQnLCA3NzAxNCk7CmRlZmluZSgnUENMWklQX09QVF9FWFRSQUNUX0lOX09VVFBVVCcsIDc3MDE1KTsKZGVmaW5lKCdQQ0xaSVBfT1BUX1JFUExBQ0VfTkVXRVInLCA3NzAxNik7CmRlZmluZSgnUENMWklQX09QVF9TVE9QX09OX0VSUk9SJywgNzcwMTcpOwovLyBIYXZpbmcgYmlnIHRyb3VibGUgd2l0aCBjcnlwdC4gTmVlZCB0byBtdWx0aXBseSAyIGxvbmcgaW50Ci8vIHdoaWNoIGlzIG5vdCBjb3JyZWN0bHkgc3VwcG9ydGVkIGJ5IFBIUCAuLi4KLy9kZWZpbmUoJ1BDTFpJUF9PUFRfQ1JZUFQnLCA3NzAxOCk7CmRlZmluZSgnUENMWklQX09QVF9FWFRSQUNUX0RJUl9SRVNUUklDVElPTicsIDc3MDE5KTsKZGVmaW5lKCdQQ0xaSVBfT1BUX1RFTVBfRklMRV9USFJFU0hPTEQnLCA3NzAyMCk7CmRlZmluZSgnUENMWklQX09QVF9BRERfVEVNUF9GSUxFX1RIUkVTSE9MRCcsIDc3MDIwKTsgLy8gYWxpYXMKZGVmaW5lKCdQQ0xaSVBfT1BUX1RFTVBfRklMRV9PTicsIDc3MDIxKTsKZGVmaW5lKCdQQ0xaSVBfT1BUX0FERF9URU1QX0ZJTEVfT04nLCA3NzAyMSk7IC8vIGFsaWFzCmRlZmluZSgnUENMWklQX09QVF9URU1QX0ZJTEVfT0ZGJywgNzcwMjIpOwpkZWZpbmUoJ1BDTFpJUF9PUFRfQUREX1RFTVBfRklMRV9PRkYnLCA3NzAyMik7IC8vIGFsaWFzCgovLyAtLS0tLSBGaWxlIGRlc2NyaXB0aW9uIGF0dHJpYnV0ZXMKZGVmaW5lKCdQQ0xaSVBfQVRUX0ZJTEVfTkFNRScsIDc5MDAxKTsKZGVmaW5lKCdQQ0xaSVBfQVRUX0ZJTEVfTkVXX1NIT1JUX05BTUUnLCA3OTAwMik7CmRlZmluZSgnUENMWklQX0FUVF9GSUxFX05FV19GVUxMX05BTUUnLCA3OTAwMyk7CmRlZmluZSgnUENMWklQX0FUVF9GSUxFX01USU1FJywgNzkwMDQpOwpkZWZpbmUoJ1BDTFpJUF9BVFRfRklMRV9DT05URU5UJywgNzkwMDUpOwpkZWZpbmUoJ1BDTFpJUF9BVFRfRklMRV9DT01NRU5UJywgNzkwMDYpOwoKLy8gLS0tLS0gQ2FsbCBiYWNrcyB2YWx1ZXMKZGVmaW5lKCdQQ0xaSVBfQ0JfUFJFX0VYVFJBQ1QnLCA3ODAwMSk7CmRlZmluZSgnUENMWklQX0NCX1BPU1RfRVhUUkFDVCcsIDc4MDAyKTsKZGVmaW5lKCdQQ0xaSVBfQ0JfUFJFX0FERCcsIDc4MDAzKTsKZGVmaW5lKCdQQ0xaSVBfQ0JfUE9TVF9BREQnLCA3ODAwNCk7Ci8qIEZvciBmdXR1ciB1c2UKZGVmaW5lKCdQQ0xaSVBfQ0JfUFJFX0xJU1QnLCA3ODAwNSk7CmRlZmluZSgnUENMWklQX0NCX1BPU1RfTElTVCcsIDc4MDA2KTsKZGVmaW5lKCdQQ0xaSVBfQ0JfUFJFX0RFTEVURScsIDc4MDA3KTsKZGVmaW5lKCdQQ0xaSVBfQ0JfUE9TVF9ERUxFVEUnLCA3ODAwOCk7CiovCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBDbGFzcyA6IFBjbFppcAovLyBEZXNjcmlwdGlvbiA6Ci8vICAgICBQY2xaaXAgaXMgdGhlIGNsYXNzIHRoYXQgcmVwcmVzZW50IGEgWmlwIGFyY2hpdmUuCi8vICAgICBUaGUgcHVibGljIG1ldGhvZHMgYWxsb3cgdGhlIG1hbmlwdWxhdGlvbiBvZiB0aGUgYXJjaGl2ZS4KLy8gQXR0cmlidXRlcyA6Ci8vICAgICBBdHRyaWJ1dGVzIG11c3Qgbm90IGJlIGFjY2Vzc2VkIGRpcmVjdGx5LgovLyBNZXRob2RzIDoKLy8gICAgIFBjbFppcCgpIDogT2JqZWN0IGNyZWF0b3IKLy8gICAgIGNyZWF0ZSgpIDogQ3JlYXRlcyB0aGUgWmlwIGFyY2hpdmUKLy8gICAgIGxpc3RDb250ZW50KCkgOiBMaXN0IHRoZSBjb250ZW50IG9mIHRoZSBaaXAgYXJjaGl2ZQovLyAgICAgZXh0cmFjdCgpIDogRXh0cmFjdCB0aGUgY29udGVudCBvZiB0aGUgYXJjaGl2ZQovLyAgICAgcHJvcGVydGllcygpIDogTGlzdCB0aGUgcHJvcGVydGllcyBvZiB0aGUgYXJjaGl2ZQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjbGFzcyBQY2xaaXAKewogICAgLy8gLS0tLS0gRmlsZW5hbWUgb2YgdGhlIHppcCBmaWxlCiAgICBwdWJsaWMgJHppcG5hbWUgPSAnJzsKCiAgICAvLyAtLS0tLSBGaWxlIGRlc2NyaXB0b3Igb2YgdGhlIHppcCBmaWxlCiAgICBwdWJsaWMgJHppcF9mZCA9IDA7CgogICAgLy8gLS0tLS0gSW50ZXJuYWwgZXJyb3IgaGFuZGxpbmcKICAgIHB1YmxpYyAkZXJyb3JfY29kZSA9IDE7CiAgICBwdWJsaWMgJGVycm9yX3N0cmluZyA9ICcnOwoKICAgIC8vIC0tLS0tIEN1cnJlbnQgc3RhdHVzIG9mIHRoZSBtYWdpY19xdW90ZXNfcnVudGltZQogICAgLy8gVGhpcyB2YWx1ZSBzdG9yZSB0aGUgcGhwIGNvbmZpZ3VyYXRpb24gZm9yIG1hZ2ljX3F1b3RlcwogICAgLy8gVGhlIGNsYXNzIGNhbiB0aGVuIGRpc2FibGUgdGhlIG1hZ2ljX3F1b3RlcyBhbmQgcmVzZXQgaXQgYWZ0ZXIKICAgIHB1YmxpYyAkbWFnaWNfcXVvdGVzX3N0YXR1czsKCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBQY2xaaXAoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIENyZWF0ZXMgYSBQY2xaaXAgb2JqZWN0IGFuZCBzZXQgdGhlIG5hbWUgb2YgdGhlIGFzc29jaWF0ZWQgWmlwIGFyY2hpdmUKICAgIC8vICAgICBmaWxlbmFtZS4KICAgIC8vICAgICBOb3RlIHRoYXQgbm8gcmVhbCBhY3Rpb24gaXMgdGFrZW4sIGlmIHRoZSBhcmNoaXZlIGRvZXMgbm90IGV4aXN0IGl0IGlzIG5vdAogICAgLy8gICAgIGNyZWF0ZWQuIFVzZSBjcmVhdGUoKSBmb3IgdGhhdC4KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJHBfemlwbmFtZSkKICAgIHsKCiAgICAgICAgLy8gLS0tLS0gVGVzdHMgdGhlIHpsaWIKICAgICAgICBpZiAoIWZ1bmN0aW9uX2V4aXN0cygnZ3pvcGVuJykpIHsKICAgICAgICAgICAgZGllKCdBYm9ydCAnLmJhc2VuYW1lKF9fRklMRV9fKS4nIDogTWlzc2luZyB6bGliIGV4dGVuc2lvbnMnKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFNldCB0aGUgYXR0cmlidXRlcwogICAgICAgICR0aGlzLT56aXBuYW1lID0gJHBfemlwbmFtZTsKICAgICAgICAkdGhpcy0+emlwX2ZkID0gMDsKICAgICAgICAkdGhpcy0+bWFnaWNfcXVvdGVzX3N0YXR1cyA9IC0xOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm47CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6CiAgICAvLyAgICAgY3JlYXRlKCRwX2ZpbGVsaXN0LCAkcF9hZGRfZGlyPSIiLCAkcF9yZW1vdmVfZGlyPSIiKQogICAgLy8gICAgIGNyZWF0ZSgkcF9maWxlbGlzdCwgJHBfb3B0aW9uLCAkcF9vcHRpb25fdmFsdWUsIC4uLikKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vICAgICBUaGlzIG1ldGhvZCBzdXBwb3J0cyB0d28gZGlmZmVyZW50IHN5bm9wc2lzLiBUaGUgZmlyc3Qgb25lIGlzIGhpc3RvcmljYWwuCiAgICAvLyAgICAgVGhpcyBtZXRob2QgY3JlYXRlcyBhIFppcCBBcmNoaXZlLiBUaGUgWmlwIGZpbGUgaXMgY3JlYXRlZCBpbiB0aGUKICAgIC8vICAgICBmaWxlc3lzdGVtLiBUaGUgZmlsZXMgYW5kIGRpcmVjdG9yaWVzIGluZGljYXRlZCBpbiAkcF9maWxlbGlzdAogICAgLy8gICAgIGFyZSBhZGRlZCBpbiB0aGUgYXJjaGl2ZS4gU2VlIHRoZSBwYXJhbWV0ZXJzIGRlc2NyaXB0aW9uIGZvciB0aGUKICAgIC8vICAgICBzdXBwb3J0ZWQgZm9ybWF0IG9mICRwX2ZpbGVsaXN0LgogICAgLy8gICAgIFdoZW4gYSBkaXJlY3RvcnkgaXMgaW4gdGhlIGxpc3QsIHRoZSBkaXJlY3RvcnkgYW5kIGl0cyBjb250ZW50IGlzIGFkZGVkCiAgICAvLyAgICAgaW4gdGhlIGFyY2hpdmUuCiAgICAvLyAgICAgSW4gdGhpcyBzeW5vcHNpcywgdGhlIGZ1bmN0aW9uIHRha2VzIGFuIG9wdGlvbmFsIHZhcmlhYmxlIGxpc3Qgb2YKICAgIC8vICAgICBvcHRpb25zLiBTZWUgYmVsbG93IHRoZSBzdXBwb3J0ZWQgb3B0aW9ucy4KICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX2ZpbGVsaXN0IDogQW4gYXJyYXkgY29udGFpbmluZyBmaWxlIG9yIGRpcmVjdG9yeSBuYW1lcywgb3IKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBzdHJpbmcgY29udGFpbmluZyBvbmUgZmlsZW5hbWUgb3Igb25lIGRpcmVjdG9yeSBuYW1lLCBvcgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHN0cmluZyBjb250YWluaW5nIGEgbGlzdCBvZiBmaWxlbmFtZXMgYW5kL29yIGRpcmVjdG9yeQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lcyBzZXBhcmF0ZWQgYnkgc3BhY2VzLgogICAgLy8gICAgICRwX2FkZF9kaXIgOiBBIHBhdGggdG8gYWRkIGJlZm9yZSB0aGUgcmVhbCBwYXRoIG9mIHRoZSBhcmNoaXZlZCBmaWxlLAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIG9yZGVyIHRvIGhhdmUgaXQgbWVtb3JpemVkIGluIHRoZSBhcmNoaXZlLgogICAgLy8gICAgICRwX3JlbW92ZV9kaXIgOiBBIHBhdGggdG8gcmVtb3ZlIGZyb20gdGhlIHJlYWwgcGF0aCBvZiB0aGUgZmlsZSB0byBhcmNoaXZlLAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW4gb3JkZXIgdG8gaGF2ZSBhIHNob3J0ZXIgcGF0aCBtZW1vcml6ZWQgaW4gdGhlIGFyY2hpdmUuCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaGVuICRwX2FkZF9kaXIgYW5kICRwX3JlbW92ZV9kaXIgYXJlIHNldCwgJHBfcmVtb3ZlX2RpcgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXMgcmVtb3ZlZCBmaXJzdCwgYmVmb3JlICRwX2FkZF9kaXIgaXMgYWRkZWQuCiAgICAvLyBPcHRpb25zIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX0FERF9QQVRIIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX1JFTU9WRV9QQVRIIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX1JFTU9WRV9BTExfUEFUSCA6CiAgICAvLyAgICAgUENMWklQX09QVF9DT01NRU5UIDoKICAgIC8vICAgICBQQ0xaSVBfQ0JfUFJFX0FERCA6CiAgICAvLyAgICAgUENMWklQX0NCX1BPU1RfQUREIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDAgb24gZmFpbHVyZSwKICAgIC8vICAgICBUaGUgbGlzdCBvZiB0aGUgYWRkZWQgZmlsZXMsIHdpdGggYSBzdGF0dXMgb2YgdGhlIGFkZCBhY3Rpb24uCiAgICAvLyAgICAgKHNlZSBQY2xaaXA6Omxpc3RDb250ZW50KCkgZm9yIGxpc3QgZW50cnkgZm9ybWF0KQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoJHBfZmlsZWxpc3QpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CgogICAgICAgIC8vIC0tLS0tIFJlc2V0IHRoZSBlcnJvciBoYW5kbGVyCiAgICAgICAgJHRoaXMtPnByaXZFcnJvclJlc2V0KCk7CgogICAgICAgIC8vIC0tLS0tIFNldCBkZWZhdWx0IHZhbHVlcwogICAgICAgICR2X29wdGlvbnMgPSBhcnJheSgpOwogICAgICAgICR2X29wdGlvbnNbUENMWklQX09QVF9OT19DT01QUkVTU0lPTl0gPSBmYWxzZTsKCiAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdmFyaWFibGUgb3B0aW9ucyBhcmd1bWVudHMKICAgICAgICAkdl9zaXplID0gZnVuY19udW1fYXJncygpOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhcmd1bWVudHMKICAgICAgICBpZiAoJHZfc2l6ZSA+IDEpIHsKICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSBhcmd1bWVudHMKICAgICAgICAgICAgJHZfYXJnX2xpc3QgPSBmdW5jX2dldF9hcmdzKCk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZW1vdmUgZnJvbSB0aGUgb3B0aW9ucyBsaXN0IHRoZSBmaXJzdCBhcmd1bWVudAogICAgICAgICAgICBhcnJheV9zaGlmdCgkdl9hcmdfbGlzdCk7CiAgICAgICAgICAgICR2X3NpemUtLTsKCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGZpcnN0IGFyZwogICAgICAgICAgICBpZiAoKGlzX2ludGVnZXIoJHZfYXJnX2xpc3RbMF0pKSAmJiAoJHZfYXJnX2xpc3RbMF0gPiA3NzAwMCkpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFBhcnNlIHRoZSBvcHRpb25zCiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdlBhcnNlT3B0aW9ucygkdl9hcmdfbGlzdCwgJHZfc2l6ZSwgJHZfb3B0aW9ucywgYXJyYXkgKAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfUkVNT1ZFX1BBVEggPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1JFTU9WRV9BTExfUEFUSCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfQUREX1BBVEggPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfQ0JfUFJFX0FERCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9DQl9QT1NUX0FERCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfTk9fQ09NUFJFU1NJT04gPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX0NPTU1FTlQgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1RFTVBfRklMRV9USFJFU0hPTEQgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1RFTVBfRklMRV9PTiA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfVEVNUF9GSUxFX09GRiA9PiAnb3B0aW9uYWwnCiAgICAgICAgICAgICAgICAgICAgLy8sIFBDTFpJUF9PUFRfQ1JZUFQgPT4gJ29wdGlvbmFsJwogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICBpZiAoJHZfcmVzdWx0ICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIDIgYXJncwogICAgICAgICAgICAgICAgLy8gSGVyZSB3ZSBuZWVkIHRvIHN1cHBvcnQgdGhlIGZpcnN0IGhpc3RvcmljIHN5bm9wc2lzIG9mIHRoZQogICAgICAgICAgICAgICAgLy8gbWV0aG9kLgogICAgICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSBmaXJzdCBhcmd1bWVudAogICAgICAgICAgICAgICAgJHZfb3B0aW9uc1tQQ0xaSVBfT1BUX0FERF9QQVRIXSA9ICR2X2FyZ19saXN0WzBdOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHRoZSBvcHRpb25hbCBzZWNvbmQgYXJndW1lbnQKICAgICAgICAgICAgICAgIGlmICgkdl9zaXplID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAkdl9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX1BBVEhdID0gJHZfYXJnX2xpc3RbMV07CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHZfc2l6ZSA+IDIpIHsKICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiSW52YWxpZCBudW1iZXIgLyB0eXBlIG9mIGFyZ3VtZW50cyIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBkZWZhdWx0IG9wdGlvbiB2YWx1ZXMKICAgICAgICAkdGhpcy0+cHJpdk9wdGlvbkRlZmF1bHRUaHJlc2hvbGQoJHZfb3B0aW9ucyk7CgogICAgICAgIC8vIC0tLS0tIEluaXQKICAgICAgICAkdl9zdHJpbmdfbGlzdCA9IGFycmF5KCk7CiAgICAgICAgJHZfYXR0X2xpc3QgPSBhcnJheSgpOwogICAgICAgICR2X2ZpbGVkZXNjcl9saXN0ID0gYXJyYXkoKTsKICAgICAgICAkcF9yZXN1bHRfbGlzdCA9IGFycmF5KCk7CgogICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlICRwX2ZpbGVsaXN0IGlzIHJlYWxseSBhbiBhcnJheQogICAgICAgIGlmIChpc19hcnJheSgkcF9maWxlbGlzdCkpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBpZiB0aGUgZmlyc3QgZWxlbWVudCBpcyBhbHNvIGFuIGFycmF5CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIFRoaXMgd2lsbCBtZWFuIHRoYXQgdGhpcyBpcyBhIGZpbGUgZGVzY3JpcHRpb24gZW50cnkKICAgICAgICAgICAgaWYgKGlzc2V0KCRwX2ZpbGVsaXN0WzBdKSAmJiBpc19hcnJheSgkcF9maWxlbGlzdFswXSkpIHsKICAgICAgICAgICAgICAgICR2X2F0dF9saXN0ID0gJHBfZmlsZWxpc3Q7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBUaGUgbGlzdCBpcyBhIGxpc3Qgb2Ygc3RyaW5nIG5hbWVzCiAgICAgICAgICAgICAgICAkdl9zdHJpbmdfbGlzdCA9ICRwX2ZpbGVsaXN0OwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlaWYgKGlzX3N0cmluZygkcF9maWxlbGlzdCkpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBpZiB0aGUgJHBfZmlsZWxpc3QgaXMgYSBzdHJpbmcKICAgICAgICAgICAgLy8gLS0tLS0gQ3JlYXRlIGEgbGlzdCBmcm9tIHRoZSBzdHJpbmcKICAgICAgICAgICAgJHZfc3RyaW5nX2xpc3QgPSBleHBsb2RlKFBDTFpJUF9TRVBBUkFUT1IsICRwX2ZpbGVsaXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyAtLS0tLSBJbnZhbGlkIHZhcmlhYmxlIHR5cGUgZm9yICRwX2ZpbGVsaXN0CiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVIsICJJbnZhbGlkIHZhcmlhYmxlIHR5cGUgcF9maWxlbGlzdCIpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJlZm9ybWF0IHRoZSBzdHJpbmcgbGlzdAogICAgICAgIGlmIChzaXplb2YoJHZfc3RyaW5nX2xpc3QpICE9IDApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHZfc3RyaW5nX2xpc3QgYXMgJHZfc3RyaW5nKSB7CiAgICAgICAgICAgICAgICBpZiAoJHZfc3RyaW5nICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfYXR0X2xpc3RbXVtQQ0xaSVBfQVRUX0ZJTEVfTkFNRV0gPSAkdl9zdHJpbmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBGb3IgZWFjaCBmaWxlIGluIHRoZSBsaXN0IGNoZWNrIHRoZSBhdHRyaWJ1dGVzCiAgICAgICAgJHZfc3VwcG9ydGVkX2F0dHJpYnV0ZXMgPSBhcnJheSgKICAgICAgICAgICAgUENMWklQX0FUVF9GSUxFX05BTUUgPT4gJ21hbmRhdG9yeScsCiAgICAgICAgICAgIFBDTFpJUF9BVFRfRklMRV9ORVdfU0hPUlRfTkFNRSA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICBQQ0xaSVBfQVRUX0ZJTEVfTkVXX0ZVTExfTkFNRSA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICBQQ0xaSVBfQVRUX0ZJTEVfTVRJTUUgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgUENMWklQX0FUVF9GSUxFX0NPTlRFTlQgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgUENMWklQX0FUVF9GSUxFX0NPTU1FTlQgPT4gJ29wdGlvbmFsJwogICAgICAgICk7CiAgICAgICAgZm9yZWFjaCAoJHZfYXR0X2xpc3QgYXMgJHZfZW50cnkpIHsKICAgICAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZGaWxlRGVzY3JQYXJzZUF0dCgkdl9lbnRyeSwgJHZfZmlsZWRlc2NyX2xpc3RbXSwgJHZfb3B0aW9ucywgJHZfc3VwcG9ydGVkX2F0dHJpYnV0ZXMpOwogICAgICAgICAgICBpZiAoJHZfcmVzdWx0ICE9IDEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBFeHBhbmQgdGhlIGZpbGVsaXN0IChleHBhbmQgZGlyZWN0b3JpZXMpCiAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZGaWxlRGVzY3JFeHBhbmQoJHZfZmlsZWRlc2NyX2xpc3QsICR2X29wdGlvbnMpOwogICAgICAgIGlmICgkdl9yZXN1bHQgIT0gMSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENhbGwgdGhlIGNyZWF0ZSBmY3QKICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkNyZWF0ZSgkdl9maWxlZGVzY3JfbGlzdCwgJHBfcmVzdWx0X2xpc3QsICR2X29wdGlvbnMpOwogICAgICAgIGlmICgkdl9yZXN1bHQgIT0gMSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkcF9yZXN1bHRfbGlzdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDoKICAgIC8vICAgICBhZGQoJHBfZmlsZWxpc3QsICRwX2FkZF9kaXI9IiIsICRwX3JlbW92ZV9kaXI9IiIpCiAgICAvLyAgICAgYWRkKCRwX2ZpbGVsaXN0LCAkcF9vcHRpb24sICRwX29wdGlvbl92YWx1ZSwgLi4uKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIFRoaXMgbWV0aG9kIHN1cHBvcnRzIHR3byBzeW5vcHNpcy4gVGhlIGZpcnN0IG9uZSBpcyBoaXN0b3JpY2FsLgogICAgLy8gICAgIFRoaXMgbWV0aG9kcyBhZGQgdGhlIGxpc3Qgb2YgZmlsZXMgaW4gYW4gZXhpc3RpbmcgYXJjaGl2ZS4KICAgIC8vICAgICBJZiBhIGZpbGUgd2l0aCB0aGUgc2FtZSBuYW1lIGFscmVhZHkgZXhpc3RzLCBpdCBpcyBhZGRlZCBhdCB0aGUgZW5kIG9mIHRoZQogICAgLy8gICAgIGFyY2hpdmUsIHRoZSBmaXJzdCBvbmUgaXMgc3RpbGwgcHJlc2VudC4KICAgIC8vICAgICBJZiB0aGUgYXJjaGl2ZSBkb2VzIG5vdCBleGlzdCwgaXQgaXMgY3JlYXRlZC4KICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX2ZpbGVsaXN0IDogQW4gYXJyYXkgY29udGFpbmluZyBmaWxlIG9yIGRpcmVjdG9yeSBuYW1lcywgb3IKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBzdHJpbmcgY29udGFpbmluZyBvbmUgZmlsZW5hbWUgb3Igb25lIGRpcmVjdG9yeSBuYW1lLCBvcgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIHN0cmluZyBjb250YWluaW5nIGEgbGlzdCBvZiBmaWxlbmFtZXMgYW5kL29yIGRpcmVjdG9yeQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lcyBzZXBhcmF0ZWQgYnkgc3BhY2VzLgogICAgLy8gICAgICRwX2FkZF9kaXIgOiBBIHBhdGggdG8gYWRkIGJlZm9yZSB0aGUgcmVhbCBwYXRoIG9mIHRoZSBhcmNoaXZlZCBmaWxlLAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIG9yZGVyIHRvIGhhdmUgaXQgbWVtb3JpemVkIGluIHRoZSBhcmNoaXZlLgogICAgLy8gICAgICRwX3JlbW92ZV9kaXIgOiBBIHBhdGggdG8gcmVtb3ZlIGZyb20gdGhlIHJlYWwgcGF0aCBvZiB0aGUgZmlsZSB0byBhcmNoaXZlLAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW4gb3JkZXIgdG8gaGF2ZSBhIHNob3J0ZXIgcGF0aCBtZW1vcml6ZWQgaW4gdGhlIGFyY2hpdmUuCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaGVuICRwX2FkZF9kaXIgYW5kICRwX3JlbW92ZV9kaXIgYXJlIHNldCwgJHBfcmVtb3ZlX2RpcgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXMgcmVtb3ZlZCBmaXJzdCwgYmVmb3JlICRwX2FkZF9kaXIgaXMgYWRkZWQuCiAgICAvLyBPcHRpb25zIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX0FERF9QQVRIIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX1JFTU9WRV9QQVRIIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX1JFTU9WRV9BTExfUEFUSCA6CiAgICAvLyAgICAgUENMWklQX09QVF9DT01NRU5UIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX0FERF9DT01NRU5UIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX1BSRVBFTkRfQ09NTUVOVCA6CiAgICAvLyAgICAgUENMWklQX0NCX1BSRV9BREQgOgogICAgLy8gICAgIFBDTFpJUF9DQl9QT1NUX0FERCA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vICAgICAwIG9uIGZhaWx1cmUsCiAgICAvLyAgICAgVGhlIGxpc3Qgb2YgdGhlIGFkZGVkIGZpbGVzLCB3aXRoIGEgc3RhdHVzIG9mIHRoZSBhZGQgYWN0aW9uLgogICAgLy8gICAgIChzZWUgUGNsWmlwOjpsaXN0Q29udGVudCgpIGZvciBsaXN0IGVudHJ5IGZvcm1hdCkKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkKCRwX2ZpbGVsaXN0KQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBSZXNldCB0aGUgZXJyb3IgaGFuZGxlcgogICAgICAgICR0aGlzLT5wcml2RXJyb3JSZXNldCgpOwoKICAgICAgICAvLyAtLS0tLSBTZXQgZGVmYXVsdCB2YWx1ZXMKICAgICAgICAkdl9vcHRpb25zID0gYXJyYXkoKTsKICAgICAgICAkdl9vcHRpb25zW1BDTFpJUF9PUFRfTk9fQ09NUFJFU1NJT05dID0gZmFsc2U7CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHZhcmlhYmxlIG9wdGlvbnMgYXJndW1lbnRzCiAgICAgICAgJHZfc2l6ZSA9IGZ1bmNfbnVtX2FyZ3MoKTsKCiAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgYXJndW1lbnRzCiAgICAgICAgaWYgKCR2X3NpemUgPiAxKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEdldCB0aGUgYXJndW1lbnRzCiAgICAgICAgICAgICR2X2FyZ19saXN0ID0gZnVuY19nZXRfYXJncygpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmVtb3ZlIGZvcm0gdGhlIG9wdGlvbnMgbGlzdCB0aGUgZmlyc3QgYXJndW1lbnQKICAgICAgICAgICAgYXJyYXlfc2hpZnQoJHZfYXJnX2xpc3QpOwogICAgICAgICAgICAkdl9zaXplLS07CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBmaXJzdCBhcmcKICAgICAgICAgICAgaWYgKChpc19pbnRlZ2VyKCR2X2FyZ19saXN0WzBdKSkgJiYgKCR2X2FyZ19saXN0WzBdID4gNzcwMDApKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBQYXJzZSB0aGUgb3B0aW9ucwogICAgICAgICAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZQYXJzZU9wdGlvbnMoJHZfYXJnX2xpc3QsICR2X3NpemUsICR2X29wdGlvbnMsIGFycmF5ICgKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1JFTU9WRV9QQVRIID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9SRU1PVkVfQUxMX1BBVEggPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX0FERF9QQVRIID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX0NCX1BSRV9BREQgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfQ0JfUE9TVF9BREQgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX05PX0NPTVBSRVNTSU9OID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9DT01NRU5UID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9BRERfQ09NTUVOVCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfUFJFUEVORF9DT01NRU5UID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9URU1QX0ZJTEVfVEhSRVNIT0xEID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9URU1QX0ZJTEVfT04gPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1RFTVBfRklMRV9PRkYgPT4gJ29wdGlvbmFsJwogICAgICAgICAgICAgICAgICAgIC8vLCBQQ0xaSVBfT1BUX0NSWVBUID0+ICdvcHRpb25hbCcKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdCAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciAyIGFyZ3MKICAgICAgICAgICAgICAgIC8vIEhlcmUgd2UgbmVlZCB0byBzdXBwb3J0IHRoZSBmaXJzdCBoaXN0b3JpYyBzeW5vcHNpcyBvZiB0aGUKICAgICAgICAgICAgICAgIC8vIG1ldGhvZC4KICAgICAgICAgICAgICAgIC8vIC0tLS0tIEdldCB0aGUgZmlyc3QgYXJndW1lbnQKICAgICAgICAgICAgICAgICR2X29wdGlvbnNbUENMWklQX09QVF9BRERfUEFUSF0gPSAkdl9hZGRfcGF0aCA9ICR2X2FyZ19saXN0WzBdOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHRoZSBvcHRpb25hbCBzZWNvbmQgYXJndW1lbnQKICAgICAgICAgICAgICAgIGlmICgkdl9zaXplID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAkdl9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX1BBVEhdID0gJHZfYXJnX2xpc3RbMV07CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHZfc2l6ZSA+IDIpIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiSW52YWxpZCBudW1iZXIgLyB0eXBlIG9mIGFyZ3VtZW50cyIpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZGVmYXVsdCBvcHRpb24gdmFsdWVzCiAgICAgICAgJHRoaXMtPnByaXZPcHRpb25EZWZhdWx0VGhyZXNob2xkKCR2X29wdGlvbnMpOwoKICAgICAgICAvLyAtLS0tLSBJbml0CiAgICAgICAgJHZfc3RyaW5nX2xpc3QgPSBhcnJheSgpOwogICAgICAgICR2X2F0dF9saXN0ID0gYXJyYXkoKTsKICAgICAgICAkdl9maWxlZGVzY3JfbGlzdCA9IGFycmF5KCk7CiAgICAgICAgJHBfcmVzdWx0X2xpc3QgPSBhcnJheSgpOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSAkcF9maWxlbGlzdCBpcyByZWFsbHkgYW4gYXJyYXkKICAgICAgICBpZiAoaXNfYXJyYXkoJHBfZmlsZWxpc3QpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlIGZpcnN0IGVsZW1lbnQgaXMgYWxzbyBhbiBhcnJheQogICAgICAgICAgICAvLyAgICAgICAgICAgICBUaGlzIHdpbGwgbWVhbiB0aGF0IHRoaXMgaXMgYSBmaWxlIGRlc2NyaXB0aW9uIGVudHJ5CiAgICAgICAgICAgIGlmIChpc3NldCgkcF9maWxlbGlzdFswXSkgJiYgaXNfYXJyYXkoJHBfZmlsZWxpc3RbMF0pKSB7CiAgICAgICAgICAgICAgICAkdl9hdHRfbGlzdCA9ICRwX2ZpbGVsaXN0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gVGhlIGxpc3QgaXMgYSBsaXN0IG9mIHN0cmluZyBuYW1lcwogICAgICAgICAgICAgICAgJHZfc3RyaW5nX2xpc3QgPSAkcF9maWxlbGlzdDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZWlmIChpc19zdHJpbmcoJHBfZmlsZWxpc3QpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlICRwX2ZpbGVsaXN0IGlzIGEgc3RyaW5nCiAgICAgICAgICAgIC8vIC0tLS0tIENyZWF0ZSBhIGxpc3QgZnJvbSB0aGUgc3RyaW5nCiAgICAgICAgICAgICR2X3N0cmluZ19saXN0ID0gZXhwbG9kZShQQ0xaSVBfU0VQQVJBVE9SLCAkcF9maWxlbGlzdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gLS0tLS0gSW52YWxpZCB2YXJpYWJsZSB0eXBlIGZvciAkcF9maWxlbGlzdAogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiSW52YWxpZCB2YXJpYWJsZSB0eXBlICciLmdldHR5cGUoJHBfZmlsZWxpc3QpLiInIGZvciBwX2ZpbGVsaXN0Iik7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmVmb3JtYXQgdGhlIHN0cmluZyBsaXN0CiAgICAgICAgaWYgKHNpemVvZigkdl9zdHJpbmdfbGlzdCkgIT0gMCkgewogICAgICAgICAgICBmb3JlYWNoICgkdl9zdHJpbmdfbGlzdCBhcyAkdl9zdHJpbmcpIHsKICAgICAgICAgICAgICAgICR2X2F0dF9saXN0W11bUENMWklQX0FUVF9GSUxFX05BTUVdID0gJHZfc3RyaW5nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBGb3IgZWFjaCBmaWxlIGluIHRoZSBsaXN0IGNoZWNrIHRoZSBhdHRyaWJ1dGVzCiAgICAgICAgJHZfc3VwcG9ydGVkX2F0dHJpYnV0ZXMgPSBhcnJheSgKICAgICAgICAgIFBDTFpJUF9BVFRfRklMRV9OQU1FID0+ICdtYW5kYXRvcnknLAogICAgICAgICAgUENMWklQX0FUVF9GSUxFX05FV19TSE9SVF9OQU1FID0+ICdvcHRpb25hbCcsCiAgICAgICAgICBQQ0xaSVBfQVRUX0ZJTEVfTkVXX0ZVTExfTkFNRSA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgUENMWklQX0FUVF9GSUxFX01USU1FID0+ICdvcHRpb25hbCcsCiAgICAgICAgICBQQ0xaSVBfQVRUX0ZJTEVfQ09OVEVOVCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgUENMWklQX0FUVF9GSUxFX0NPTU1FTlQgPT4gJ29wdGlvbmFsJywKICAgICAgICApOwogICAgICAgIGZvcmVhY2ggKCR2X2F0dF9saXN0IGFzICR2X2VudHJ5KSB7CiAgICAgICAgICAgICR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2RmlsZURlc2NyUGFyc2VBdHQoJHZfZW50cnksICR2X2ZpbGVkZXNjcl9saXN0W10sICR2X29wdGlvbnMsICR2X3N1cHBvcnRlZF9hdHRyaWJ1dGVzKTsKICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdCAhPSAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gRXhwYW5kIHRoZSBmaWxlbGlzdCAoZXhwYW5kIGRpcmVjdG9yaWVzKQogICAgICAgICR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2RmlsZURlc2NyRXhwYW5kKCR2X2ZpbGVkZXNjcl9saXN0LCAkdl9vcHRpb25zKTsKICAgICAgICBpZiAoJHZfcmVzdWx0ICE9IDEpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDYWxsIHRoZSBjcmVhdGUgZmN0CiAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZBZGQoJHZfZmlsZWRlc2NyX2xpc3QsICRwX3Jlc3VsdF9saXN0LCAkdl9vcHRpb25zKTsKICAgICAgICBpZiAoJHZfcmVzdWx0ICE9IDEpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHBfcmVzdWx0X2xpc3Q7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IGxpc3RDb250ZW50KCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vICAgICBUaGlzIHB1YmxpYyBtZXRob2QsIGdpdmVzIHRoZSBsaXN0IG9mIHRoZSBmaWxlcyBhbmQgZGlyZWN0b3JpZXMsIHdpdGggdGhlaXIKICAgIC8vICAgICBwcm9wZXJ0aWVzLgogICAgLy8gICAgIFRoZSBwcm9wZXJ0aWVzIG9mIGVhY2ggZW50cmllcyBpbiB0aGUgbGlzdCBhcmUgKHVzZWQgYWxzbyBpbiBvdGhlciBmdW5jdGlvbnMpIDoKICAgIC8vICAgICAgICAgZmlsZW5hbWUgOiBOYW1lIG9mIHRoZSBmaWxlLiBGb3IgYSBjcmVhdGUgb3IgYWRkIGFjdGlvbiBpdCBpcyB0aGUgZmlsZW5hbWUKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnaXZlbiBieSB0aGUgdXNlci4gRm9yIGFuIGV4dHJhY3QgZnVuY3Rpb24gaXQgaXMgdGhlIGZpbGVuYW1lCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2YgdGhlIGV4dHJhY3RlZCBmaWxlLgogICAgLy8gICAgICAgICBzdG9yZWRfZmlsZW5hbWUgOiBOYW1lIG9mIHRoZSBmaWxlIC8gZGlyZWN0b3J5IHN0b3JlZCBpbiB0aGUgYXJjaGl2ZS4KICAgIC8vICAgICAgICAgc2l6ZSA6IFNpemUgb2YgdGhlIHN0b3JlZCBmaWxlLgogICAgLy8gICAgICAgICBjb21wcmVzc2VkX3NpemUgOiBTaXplIG9mIHRoZSBmaWxlJ3MgZGF0YSBjb21wcmVzc2VkIGluIHRoZSBhcmNoaXZlCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh3aXRob3V0IHRoZSBoZWFkZXJzIG92ZXJoZWFkKQogICAgLy8gICAgICAgICBtdGltZSA6IExhc3Qga25vd24gbW9kaWZpY2F0aW9uIGRhdGUgb2YgdGhlIGZpbGUgKFVOSVggdGltZXN0YW1wKQogICAgLy8gICAgICAgICBjb21tZW50IDogQ29tbWVudCBhc3NvY2lhdGVkIHdpdGggdGhlIGZpbGUKICAgIC8vICAgICAgICAgZm9sZGVyIDogdHJ1ZSB8IGZhbHNlCiAgICAvLyAgICAgICAgIGluZGV4IDogaW5kZXggb2YgdGhlIGZpbGUgaW4gdGhlIGFyY2hpdmUKICAgIC8vICAgICAgICAgc3RhdHVzIDogc3RhdHVzIG9mIHRoZSBhY3Rpb24gKGRlcGVuZGluZyBvZiB0aGUgYWN0aW9uKSA6CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZXMgYXJlIDoKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvayA6IE9LICEKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZCA6IHRoZSBmaWxlIC8gZGlyIGlzIG5vdCBleHRyYWN0ZWQgKGZpbHRlcmVkIGJ5IHVzZXIpCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxyZWFkeV9hX2RpcmVjdG9yeSA6IHRoZSBmaWxlIGNhbiBub3QgYmUgZXh0cmFjdGVkIGJlY2F1c2UgYQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0b3J5IHdpdGggdGhlIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0cwogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlX3Byb3RlY3RlZCA6IHRoZSBmaWxlIGNhbiBub3QgYmUgZXh0cmFjdGVkIGJlY2F1c2UgYSBmaWxlCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCB0aGUgc2FtZSBuYW1lIGFscmVhZHkgZXhpc3RzIGFuZCBpcwogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlIHByb3RlY3RlZAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld2VyX2V4aXN0IDogdGhlIGZpbGUgd2FzIG5vdCBleHRyYWN0ZWQgYmVjYXVzZSBhIG5ld2VyIGZpbGUgZXhpc3RzCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aF9jcmVhdGlvbl9mYWlsIDogdGhlIGZpbGUgaXMgbm90IGV4dHJhY3RlZCBiZWNhdXNlIHRoZSBmb2xkZXIKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvZXMgbm90IGV4aXN0IGFuZCBjYW4gbm90IGJlIGNyZWF0ZWQKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZV9lcnJvciA6IHRoZSBmaWxlIHdhcyBub3QgZXh0cmFjdGVkIGJlY2F1c2UgdGhlcmUgd2FzIGEKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3Igd2hpbGUgd3JpdGluZyB0aGUgZmlsZQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfZXJyb3IgOiB0aGUgZmlsZSB3YXMgbm90IGV4dHJhY3RlZCBiZWNhdXNlIHRoZXJlIHdhcyBhIGVycm9yCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIHJlYWRpbmcgdGhlIGZpbGUKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkX2hlYWRlciA6IHRoZSBmaWxlIHdhcyBub3QgZXh0cmFjdGVkIGJlY2F1c2Ugb2YgYW4gYXJjaGl2ZQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCBlcnJvciAoYmFkIGZpbGUgaGVhZGVyKQogICAgLy8gICAgIE5vdGUgdGhhdCBlYWNoIHRpbWUgYSBtZXRob2QgY2FuIGNvbnRpbnVlIG9wZXJhdGluZyB3aGVuIHRoZXJlCiAgICAvLyAgICAgaXMgYW4gYWN0aW9uIGVycm9yIG9uIGEgZmlsZSwgdGhlIGVycm9yIGlzIG9ubHkgbG9nZ2VkIGluIHRoZSBmaWxlIHN0YXR1cy4KICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDAgb24gYW4gdW5yZWNvdmVyYWJsZSBmYWlsdXJlLAogICAgLy8gICAgIFRoZSBsaXN0IG9mIHRoZSBmaWxlcyBpbiB0aGUgYXJjaGl2ZS4KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gbGlzdENvbnRlbnQoKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBSZXNldCB0aGUgZXJyb3IgaGFuZGxlcgogICAgICAgICR0aGlzLT5wcml2RXJyb3JSZXNldCgpOwoKICAgICAgICAvLyAtLS0tLSBDaGVjayBhcmNoaXZlCiAgICAgICAgaWYgKCEkdGhpcy0+cHJpdkNoZWNrRm9ybWF0KCkpIHsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgZXh0cmFjdGluZyBmY3QKICAgICAgICAkcF9saXN0ID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2TGlzdCgkcF9saXN0KSkgIT0gMSkgewogICAgICAgICAgICB1bnNldCgkcF9saXN0KTsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICRwX2xpc3Q7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6CiAgICAvLyAgICAgZXh0cmFjdCgkcF9wYXRoPSIuLyIsICRwX3JlbW92ZV9wYXRoPSIiKQogICAgLy8gICAgIGV4dHJhY3QoWyRwX29wdGlvbiwgJHBfb3B0aW9uX3ZhbHVlLCAuLi5dKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIFRoaXMgbWV0aG9kIHN1cHBvcnRzIHR3byBzeW5vcHNpcy4gVGhlIGZpcnN0IG9uZSBpcyBoaXN0b3JpY2FsLgogICAgLy8gICAgIFRoaXMgbWV0aG9kIGV4dHJhY3QgYWxsIHRoZSBmaWxlcyAvIGRpcmVjdG9yaWVzIGZyb20gdGhlIGFyY2hpdmUgdG8gdGhlCiAgICAvLyAgICAgZm9sZGVyIGluZGljYXRlZCBpbiAkcF9wYXRoLgogICAgLy8gICAgIElmIHlvdSB3YW50IHRvIGlnbm9yZSB0aGUgJ3Jvb3QnIHBhcnQgb2YgcGF0aCBvZiB0aGUgbWVtb3JpemVkIGZpbGVzCiAgICAvLyAgICAgeW91IGNhbiBpbmRpY2F0ZSB0aGlzIGluIHRoZSBvcHRpb25hbCAkcF9yZW1vdmVfcGF0aCBwYXJhbWV0ZXIuCiAgICAvLyAgICAgQnkgZGVmYXVsdCwgaWYgYSBuZXdlciBmaWxlIHdpdGggdGhlIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0cywgdGhlCiAgICAvLyAgICAgZmlsZSBpcyBub3QgZXh0cmFjdGVkLgogICAgLy8KICAgIC8vICAgICBJZiBib3RoIFBDTFpJUF9PUFRfUEFUSCBhbmQgUENMWklQX09QVF9BRERfUEFUSCBhb3B0aW9ucwogICAgLy8gICAgIGFyZSB1c2VkLCB0aGUgcGF0aCBpbmRpY2F0ZWQgaW4gUENMWklQX09QVF9BRERfUEFUSCBpcyBhcHBlbmQKICAgIC8vICAgICBhdCB0aGUgZW5kIG9mIHRoZSBwYXRoIHZhbHVlIG9mIFBDTFpJUF9PUFRfUEFUSC4KICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX3BhdGggOiBQYXRoIHdoZXJlIHRoZSBmaWxlcyBhbmQgZGlyZWN0b3JpZXMgYXJlIHRvIGJlIGV4dHJhY3RlZAogICAgLy8gICAgICRwX3JlbW92ZV9wYXRoIDogRmlyc3QgcGFydCAoJ3Jvb3QnIHBhcnQpIG9mIHRoZSBtZW1vcml6ZWQgcGF0aAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGlmIGFueSBzaW1pbGFyKSB0byByZW1vdmUgd2hpbGUgZXh0cmFjdGluZy4KICAgIC8vIE9wdGlvbnMgOgogICAgLy8gICAgIFBDTFpJUF9PUFRfUEFUSCA6CiAgICAvLyAgICAgUENMWklQX09QVF9BRERfUEFUSCA6CiAgICAvLyAgICAgUENMWklQX09QVF9SRU1PVkVfUEFUSCA6CiAgICAvLyAgICAgUENMWklQX09QVF9SRU1PVkVfQUxMX1BBVEggOgogICAgLy8gICAgIFBDTFpJUF9DQl9QUkVfRVhUUkFDVCA6CiAgICAvLyAgICAgUENMWklQX0NCX1BPU1RfRVhUUkFDVCA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vICAgICAwIG9yIGEgbmVnYXRpdmUgdmFsdWUgb24gZmFpbHVyZSwKICAgIC8vICAgICBUaGUgbGlzdCBvZiB0aGUgZXh0cmFjdGVkIGZpbGVzLCB3aXRoIGEgc3RhdHVzIG9mIHRoZSBhY3Rpb24uCiAgICAvLyAgICAgKHNlZSBQY2xaaXA6Omxpc3RDb250ZW50KCkgZm9yIGxpc3QgZW50cnkgZm9ybWF0KQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBleHRyYWN0KCkKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gUmVzZXQgdGhlIGVycm9yIGhhbmRsZXIKICAgICAgICAkdGhpcy0+cHJpdkVycm9yUmVzZXQoKTsKCiAgICAgICAgLy8gLS0tLS0gQ2hlY2sgYXJjaGl2ZQogICAgICAgIGlmICghJHRoaXMtPnByaXZDaGVja0Zvcm1hdCgpKSB7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFNldCBkZWZhdWx0IHZhbHVlcwogICAgICAgICR2X29wdGlvbnMgPSBhcnJheSgpOwogICAgLy8gICAgICAgICR2X3BhdGggPSAiLi8iOwogICAgICAgICR2X3BhdGggPSAnJzsKICAgICAgICAkdl9yZW1vdmVfcGF0aCA9ICIiOwogICAgICAgICR2X3JlbW92ZV9hbGxfcGF0aCA9IGZhbHNlOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciB2YXJpYWJsZSBvcHRpb25zIGFyZ3VtZW50cwogICAgICAgICR2X3NpemUgPSBmdW5jX251bV9hcmdzKCk7CgogICAgICAgIC8vIC0tLS0tIERlZmF1bHQgdmFsdWVzIGZvciBvcHRpb24KICAgICAgICAkdl9vcHRpb25zW1BDTFpJUF9PUFRfRVhUUkFDVF9BU19TVFJJTkddID0gZmFsc2U7CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGFyZ3VtZW50cwogICAgICAgIGlmICgkdl9zaXplID4gMCkgewogICAgICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIGFyZ3VtZW50cwogICAgICAgICAgICAkdl9hcmdfbGlzdCA9IGZ1bmNfZ2V0X2FyZ3MoKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGZpcnN0IGFyZwogICAgICAgICAgICBpZiAoKGlzX2ludGVnZXIoJHZfYXJnX2xpc3RbMF0pKSAmJiAoJHZfYXJnX2xpc3RbMF0gPiA3NzAwMCkpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFBhcnNlIHRoZSBvcHRpb25zCiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdlBhcnNlT3B0aW9ucygkdl9hcmdfbGlzdCwgJHZfc2l6ZSwgJHZfb3B0aW9ucywgYXJyYXkgKAogICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1BBVEggPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9SRU1PVkVfUEFUSCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1JFTU9WRV9BTExfUEFUSCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX0FERF9QQVRIID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgIFBDTFpJUF9DQl9QUkVfRVhUUkFDVCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICBQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNUID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfU0VUX0NITU9EID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfQllfTkFNRSA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX0JZX0VSRUcgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9CWV9QUkVHID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfQllfSU5ERVggPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9FWFRSQUNUX0FTX1NUUklORyA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX0VYVFJBQ1RfSU5fT1VUUFVUID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfUkVQTEFDRV9ORVdFUiA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1IgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9FWFRSQUNUX0RJUl9SRVNUUklDVElPTiA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1RFTVBfRklMRV9USFJFU0hPTEQgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9URU1QX0ZJTEVfT04gPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9URU1QX0ZJTEVfT0ZGID0+ICdvcHRpb25hbCcKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdCAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gU2V0IHRoZSBhcmd1bWVudHMKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdl9vcHRpb25zW1BDTFpJUF9PUFRfUEFUSF0pKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfcGF0aCA9ICR2X29wdGlvbnNbUENMWklQX09QVF9QQVRIXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdl9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX1BBVEhdKSkgewogICAgICAgICAgICAgICAgICAgICR2X3JlbW92ZV9wYXRoID0gJHZfb3B0aW9uc1tQQ0xaSVBfT1BUX1JFTU9WRV9QQVRIXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdl9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX0FMTF9QQVRIXSkpIHsKICAgICAgICAgICAgICAgICAgICAkdl9yZW1vdmVfYWxsX3BhdGggPSAkdl9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX0FMTF9QQVRIXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdl9vcHRpb25zW1BDTFpJUF9PUFRfQUREX1BBVEhdKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoZWNrIGZvciAnLycgaW4gbGFzdCBwYXRoIGNoYXIKICAgICAgICAgICAgICAgICAgICBpZiAoKHN0cmxlbigkdl9wYXRoKSA+IDApICYmIChzdWJzdHIoJHZfcGF0aCwgLTEpICE9ICcvJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHZfcGF0aCAuPSAnLyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR2X3BhdGggLj0gJHZfb3B0aW9uc1tQQ0xaSVBfT1BUX0FERF9QQVRIXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIDIgYXJncwogICAgICAgICAgICAgICAgLy8gSGVyZSB3ZSBuZWVkIHRvIHN1cHBvcnQgdGhlIGZpcnN0IGhpc3RvcmljIHN5bm9wc2lzIG9mIHRoZQogICAgICAgICAgICAgICAgLy8gbWV0aG9kLgogICAgICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSBmaXJzdCBhcmd1bWVudAogICAgICAgICAgICAgICAgJHZfcGF0aCA9ICR2X2FyZ19saXN0WzBdOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHRoZSBvcHRpb25hbCBzZWNvbmQgYXJndW1lbnQKICAgICAgICAgICAgICAgIGlmICgkdl9zaXplID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAkdl9yZW1vdmVfcGF0aCA9ICR2X2FyZ19saXN0WzFdOwogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCR2X3NpemUgPiAyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX1BBUkFNRVRFUiwgIkludmFsaWQgbnVtYmVyIC8gdHlwZSBvZiBhcmd1bWVudHMiKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGRlZmF1bHQgb3B0aW9uIHZhbHVlcwogICAgICAgICR0aGlzLT5wcml2T3B0aW9uRGVmYXVsdFRocmVzaG9sZCgkdl9vcHRpb25zKTsKCiAgICAgICAgLy8gLS0tLS0gVHJhY2UKCiAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgZXh0cmFjdGluZyBmY3QKICAgICAgICAkcF9saXN0ID0gYXJyYXkoKTsKICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkV4dHJhY3RCeVJ1bGUoJHBfbGlzdCwgJHZfcGF0aCwgJHZfcmVtb3ZlX3BhdGgsICR2X3JlbW92ZV9hbGxfcGF0aCwgJHZfb3B0aW9ucyk7CiAgICAgICAgaWYgKCR2X3Jlc3VsdCA8IDEpIHsKICAgICAgICAgICAgdW5zZXQoJHBfbGlzdCk7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkcF9saXN0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDoKICAgIC8vICAgICBleHRyYWN0QnlJbmRleCgkcF9pbmRleCwgJHBfcGF0aD0iLi8iLCAkcF9yZW1vdmVfcGF0aD0iIikKICAgIC8vICAgICBleHRyYWN0QnlJbmRleCgkcF9pbmRleCwgWyRwX29wdGlvbiwgJHBfb3B0aW9uX3ZhbHVlLCAuLi5dKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIFRoaXMgbWV0aG9kIHN1cHBvcnRzIHR3byBzeW5vcHNpcy4gVGhlIGZpcnN0IG9uZSBpcyBoaXN0b3JpY2FsLgogICAgLy8gICAgIFRoaXMgbWV0aG9kIGlzIGRvaW5nIGEgcGFydGlhbCBleHRyYWN0IG9mIHRoZSBhcmNoaXZlLgogICAgLy8gICAgIFRoZSBleHRyYWN0ZWQgZmlsZXMgb3IgZm9sZGVycyBhcmUgaWRlbnRpZmllZCBieSB0aGVpciBpbmRleCBpbiB0aGUKICAgIC8vICAgICBhcmNoaXZlIChmcm9tIDAgdG8gbikuCiAgICAvLyAgICAgTm90ZSB0aGF0IGlmIHRoZSBpbmRleCBpZGVudGlmeSBhIGZvbGRlciwgb25seSB0aGUgZm9sZGVyIGVudHJ5IGlzCiAgICAvLyAgICAgZXh0cmFjdGVkLCBub3QgYWxsIHRoZSBmaWxlcyBpbmNsdWRlZCBpbiB0aGUgYXJjaGl2ZS4KICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX2luZGV4IDogQSBzaW5nbGUgaW5kZXggKGludGVnZXIpIG9yIGEgc3RyaW5nIG9mIGluZGV4ZXMgb2YgZmlsZXMgdG8KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3QuIFRoZSBmb3JtIG9mIHRoZSBzdHJpbmcgaXMgIjAsNC02LDgtMTIiIHdpdGggb25seSBudW1iZXJzCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgJy0nIGZvciByYW5nZSBvciAnLCcgdG8gc2VwYXJhdGUgcmFuZ2VzLiBObyBzcGFjZXMgb3IgJzsnCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmUgYWxsb3dlZC4KICAgIC8vICAgICAkcF9wYXRoIDogUGF0aCB3aGVyZSB0aGUgZmlsZXMgYW5kIGRpcmVjdG9yaWVzIGFyZSB0byBiZSBleHRyYWN0ZWQKICAgIC8vICAgICAkcF9yZW1vdmVfcGF0aCA6IEZpcnN0IHBhcnQgKCdyb290JyBwYXJ0KSBvZiB0aGUgbWVtb3JpemVkIHBhdGgKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpZiBhbnkgc2ltaWxhcikgdG8gcmVtb3ZlIHdoaWxlIGV4dHJhY3RpbmcuCiAgICAvLyBPcHRpb25zIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX1BBVEggOgogICAgLy8gICAgIFBDTFpJUF9PUFRfQUREX1BBVEggOgogICAgLy8gICAgIFBDTFpJUF9PUFRfUkVNT1ZFX1BBVEggOgogICAgLy8gICAgIFBDTFpJUF9PUFRfUkVNT1ZFX0FMTF9QQVRIIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX0VYVFJBQ1RfQVNfU1RSSU5HIDogVGhlIGZpbGVzIGFyZSBleHRyYWN0ZWQgYXMgc3RyaW5ncyBhbmQKICAgIC8vICAgICAgICAgbm90IGFzIGZpbGVzLgogICAgLy8gICAgICAgICBUaGUgcmVzdWx0aW5nIGNvbnRlbnQgaXMgaW4gYSBuZXcgZmllbGQgJ2NvbnRlbnQnIGluIHRoZSBmaWxlCiAgICAvLyAgICAgICAgIHN0cnVjdHVyZS4KICAgIC8vICAgICAgICAgVGhpcyBvcHRpb24gbXVzdCBiZSB1c2VkIGFsb25lIChhbnkgb3RoZXIgb3B0aW9ucyBhcmUgaWdub3JlZCkuCiAgICAvLyAgICAgUENMWklQX0NCX1BSRV9FWFRSQUNUIDoKICAgIC8vICAgICBQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNUIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDAgb24gZmFpbHVyZSwKICAgIC8vICAgICBUaGUgbGlzdCBvZiB0aGUgZXh0cmFjdGVkIGZpbGVzLCB3aXRoIGEgc3RhdHVzIG9mIHRoZSBhY3Rpb24uCiAgICAvLyAgICAgKHNlZSBQY2xaaXA6Omxpc3RDb250ZW50KCkgZm9yIGxpc3QgZW50cnkgZm9ybWF0KQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vZnVuY3Rpb24gZXh0cmFjdEJ5SW5kZXgoJHBfaW5kZXgsIG9wdGlvbnMuLi4pCiAgICBwdWJsaWMgZnVuY3Rpb24gZXh0cmFjdEJ5SW5kZXgoJHBfaW5kZXgpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CgogICAgICAgIC8vIC0tLS0tIFJlc2V0IHRoZSBlcnJvciBoYW5kbGVyCiAgICAgICAgJHRoaXMtPnByaXZFcnJvclJlc2V0KCk7CgogICAgICAgIC8vIC0tLS0tIENoZWNrIGFyY2hpdmUKICAgICAgICBpZiAoISR0aGlzLT5wcml2Q2hlY2tGb3JtYXQoKSkgewogICAgICAgICAgICByZXR1cm4oMCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBTZXQgZGVmYXVsdCB2YWx1ZXMKICAgICAgICAkdl9vcHRpb25zID0gYXJyYXkoKTsKICAgIC8vICAgICAgICAkdl9wYXRoID0gIi4vIjsKICAgICAgICAkdl9wYXRoID0gJyc7CiAgICAgICAgJHZfcmVtb3ZlX3BhdGggPSAiIjsKICAgICAgICAkdl9yZW1vdmVfYWxsX3BhdGggPSBmYWxzZTsKCiAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdmFyaWFibGUgb3B0aW9ucyBhcmd1bWVudHMKICAgICAgICAkdl9zaXplID0gZnVuY19udW1fYXJncygpOwoKICAgICAgICAvLyAtLS0tLSBEZWZhdWx0IHZhbHVlcyBmb3Igb3B0aW9uCiAgICAgICAgJHZfb3B0aW9uc1tQQ0xaSVBfT1BUX0VYVFJBQ1RfQVNfU1RSSU5HXSA9IGZhbHNlOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhcmd1bWVudHMKICAgICAgICBpZiAoJHZfc2l6ZSA+IDEpIHsKICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSBhcmd1bWVudHMKICAgICAgICAgICAgJHZfYXJnX2xpc3QgPSBmdW5jX2dldF9hcmdzKCk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZW1vdmUgZm9ybSB0aGUgb3B0aW9ucyBsaXN0IHRoZSBmaXJzdCBhcmd1bWVudAogICAgICAgICAgICBhcnJheV9zaGlmdCgkdl9hcmdfbGlzdCk7CiAgICAgICAgICAgICR2X3NpemUtLTsKCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGZpcnN0IGFyZwogICAgICAgICAgICBpZiAoKGlzX2ludGVnZXIoJHZfYXJnX2xpc3RbMF0pKSAmJiAoJHZfYXJnX2xpc3RbMF0gPiA3NzAwMCkpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFBhcnNlIHRoZSBvcHRpb25zCiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdlBhcnNlT3B0aW9ucygkdl9hcmdfbGlzdCwgJHZfc2l6ZSwgJHZfb3B0aW9ucywgYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9QQVRIID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9SRU1PVkVfUEFUSCA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfUkVNT1ZFX0FMTF9QQVRIID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9FWFRSQUNUX0FTX1NUUklORyA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfQUREX1BBVEggPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfQ0JfUFJFX0VYVFJBQ1QgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNUID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9TRVRfQ0hNT0QgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1JFUExBQ0VfTkVXRVIgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1IgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX0VYVFJBQ1RfRElSX1JFU1RSSUNUSU9OID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9URU1QX0ZJTEVfVEhSRVNIT0xEID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICAgICAgUENMWklQX09QVF9URU1QX0ZJTEVfT04gPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX1RFTVBfRklMRV9PRkYgPT4gJ29wdGlvbmFsJwogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICBpZiAoJHZfcmVzdWx0ICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBTZXQgdGhlIGFyZ3VtZW50cwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2X29wdGlvbnNbUENMWklQX09QVF9QQVRIXSkpIHsKICAgICAgICAgICAgICAgICAgICAkdl9wYXRoID0gJHZfb3B0aW9uc1tQQ0xaSVBfT1BUX1BBVEhdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2X29wdGlvbnNbUENMWklQX09QVF9SRU1PVkVfUEFUSF0pKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfcmVtb3ZlX3BhdGggPSAkdl9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX1BBVEhdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2X29wdGlvbnNbUENMWklQX09QVF9SRU1PVkVfQUxMX1BBVEhdKSkgewogICAgICAgICAgICAgICAgICAgICR2X3JlbW92ZV9hbGxfcGF0aCA9ICR2X29wdGlvbnNbUENMWklQX09QVF9SRU1PVkVfQUxMX1BBVEhdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2X29wdGlvbnNbUENMWklQX09QVF9BRERfUEFUSF0pKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgZm9yICcvJyBpbiBsYXN0IHBhdGggY2hhcgogICAgICAgICAgICAgICAgICAgIGlmICgoc3RybGVuKCR2X3BhdGgpID4gMCkgJiYgKHN1YnN0cigkdl9wYXRoLCAtMSkgIT0gJy8nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdl9wYXRoIC49ICcvJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHZfcGF0aCAuPSAkdl9vcHRpb25zW1BDTFpJUF9PUFRfQUREX1BBVEhdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkdl9vcHRpb25zW1BDTFpJUF9PUFRfRVhUUkFDVF9BU19TVFJJTkddKSkgewogICAgICAgICAgICAgICAgICAgICR2X29wdGlvbnNbUENMWklQX09QVF9FWFRSQUNUX0FTX1NUUklOR10gPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciAyIGFyZ3MKICAgICAgICAgICAgICAgIC8vIEhlcmUgd2UgbmVlZCB0byBzdXBwb3J0IHRoZSBmaXJzdCBoaXN0b3JpYyBzeW5vcHNpcyBvZiB0aGUKICAgICAgICAgICAgICAgIC8vIG1ldGhvZC4KCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIGZpcnN0IGFyZ3VtZW50CiAgICAgICAgICAgICAgICAkdl9wYXRoID0gJHZfYXJnX2xpc3RbMF07CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdGhlIG9wdGlvbmFsIHNlY29uZCBhcmd1bWVudAogICAgICAgICAgICAgICAgaWYgKCR2X3NpemUgPT0gMikgewogICAgICAgICAgICAgICAgICAgICR2X3JlbW92ZV9wYXRoID0gJHZfYXJnX2xpc3RbMV07CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHZfc2l6ZSA+IDIpIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiSW52YWxpZCBudW1iZXIgLyB0eXBlIG9mIGFyZ3VtZW50cyIpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gVHJhY2UKCiAgICAgICAgLy8gLS0tLS0gVHJpY2sKICAgICAgICAvLyBIZXJlIEkgd2FudCB0byByZXVzZSBleHRyYWN0QnlSdWxlKCksIHNvIEkgbmVlZCB0byBwYXJzZSB0aGUgJHBfaW5kZXgKICAgICAgICAvLyB3aXRoIHByaXZQYXJzZU9wdGlvbnMoKQogICAgICAgICR2X2FyZ190cmljayA9IGFycmF5IChQQ0xaSVBfT1BUX0JZX0lOREVYLCAkcF9pbmRleCk7CiAgICAgICAgJHZfb3B0aW9uc190cmljayA9IGFycmF5KCk7CiAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZQYXJzZU9wdGlvbnMoJHZfYXJnX3RyaWNrLCBzaXplb2YoJHZfYXJnX3RyaWNrKSwgJHZfb3B0aW9uc190cmljaywgYXJyYXkgKFBDTFpJUF9PUFRfQllfSU5ERVggPT4gJ29wdGlvbmFsJykpOwogICAgICAgIGlmICgkdl9yZXN1bHQgIT0gMSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgJHZfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX0lOREVYXSA9ICR2X29wdGlvbnNfdHJpY2tbUENMWklQX09QVF9CWV9JTkRFWF07CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGRlZmF1bHQgb3B0aW9uIHZhbHVlcwogICAgICAgICR0aGlzLT5wcml2T3B0aW9uRGVmYXVsdFRocmVzaG9sZCgkdl9vcHRpb25zKTsKCiAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgZXh0cmFjdGluZyBmY3QKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2RXh0cmFjdEJ5UnVsZSgkcF9saXN0LCAkdl9wYXRoLCAkdl9yZW1vdmVfcGF0aCwgJHZfcmVtb3ZlX2FsbF9wYXRoLCAkdl9vcHRpb25zKSkgPCAxKSB7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkcF9saXN0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOgogICAgLy8gICAgIGRlbGV0ZShbJHBfb3B0aW9uLCAkcF9vcHRpb25fdmFsdWUsIC4uLl0pCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyAgICAgVGhpcyBtZXRob2QgcmVtb3ZlcyBmaWxlcyBmcm9tIHRoZSBhcmNoaXZlLgogICAgLy8gICAgIElmIG5vIHBhcmFtZXRlcnMgYXJlIGdpdmVuLCB0aGVuIGFsbCB0aGUgYXJjaGl2ZSBpcyBlbXB0aWVkLgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyAgICAgTm9uZSBvciBvcHRpb25hbCBhcmd1bWVudHMuCiAgICAvLyBPcHRpb25zIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX0JZX0lOREVYIDoKICAgIC8vICAgICBQQ0xaSVBfT1BUX0JZX05BTUUgOgogICAgLy8gICAgIFBDTFpJUF9PUFRfQllfRVJFRyA6CiAgICAvLyAgICAgUENMWklQX09QVF9CWV9QUkVHIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDAgb24gZmFpbHVyZSwKICAgIC8vICAgICBUaGUgbGlzdCBvZiB0aGUgZmlsZXMgd2hpY2ggYXJlIHN0aWxsIHByZXNlbnQgaW4gdGhlIGFyY2hpdmUuCiAgICAvLyAgICAgKHNlZSBQY2xaaXA6Omxpc3RDb250ZW50KCkgZm9yIGxpc3QgZW50cnkgZm9ybWF0KQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxldGUoKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBSZXNldCB0aGUgZXJyb3IgaGFuZGxlcgogICAgICAgICR0aGlzLT5wcml2RXJyb3JSZXNldCgpOwoKICAgICAgICAvLyAtLS0tLSBDaGVjayBhcmNoaXZlCiAgICAgICAgaWYgKCEkdGhpcy0+cHJpdkNoZWNrRm9ybWF0KCkpIHsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gU2V0IGRlZmF1bHQgdmFsdWVzCiAgICAgICAgJHZfb3B0aW9ucyA9IGFycmF5KCk7CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHZhcmlhYmxlIG9wdGlvbnMgYXJndW1lbnRzCiAgICAgICAgJHZfc2l6ZSA9IGZ1bmNfbnVtX2FyZ3MoKTsKCiAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgYXJndW1lbnRzCiAgICAgICAgaWYgKCR2X3NpemUgPiAwKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEdldCB0aGUgYXJndW1lbnRzCiAgICAgICAgICAgICR2X2FyZ19saXN0ID0gZnVuY19nZXRfYXJncygpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUGFyc2UgdGhlIG9wdGlvbnMKICAgICAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZQYXJzZU9wdGlvbnMoJHZfYXJnX2xpc3QsICR2X3NpemUsICR2X29wdGlvbnMsIGFycmF5ICgKICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfQllfTkFNRSA9PiAnb3B0aW9uYWwnLAogICAgICAgICAgICAgICAgUENMWklQX09QVF9CWV9FUkVHID0+ICdvcHRpb25hbCcsCiAgICAgICAgICAgICAgICBQQ0xaSVBfT1BUX0JZX1BSRUcgPT4gJ29wdGlvbmFsJywKICAgICAgICAgICAgICAgIFBDTFpJUF9PUFRfQllfSU5ERVggPT4gJ29wdGlvbmFsJwogICAgICAgICAgICApKTsKICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdCAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIE1hZ2ljIHF1b3RlcyB0cmljawogICAgICAgICR0aGlzLT5wcml2RGlzYWJsZU1hZ2ljUXVvdGVzKCk7CgogICAgICAgIC8vIC0tLS0tIENhbGwgdGhlIGRlbGV0ZSBmY3QKICAgICAgICAkdl9saXN0ID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2RGVsZXRlQnlSdWxlKCR2X2xpc3QsICR2X29wdGlvbnMpKSAhPSAxKSB7CiAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwogICAgICAgICAgICB1bnNldCgkdl9saXN0KTsKICAgICAgICAgICAgcmV0dXJuKDApOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gTWFnaWMgcXVvdGVzIHRyaWNrCiAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9saXN0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBkZWxldGVCeUluZGV4KCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vICAgICAqKioqKiBEZXByZWNhdGVkICoqKioqCiAgICAvLyAgICAgZGVsZXRlKFBDTFpJUF9PUFRfQllfSU5ERVgsICRwX2luZGV4KSBzaG91bGQgYmUgcHJlZmVyZWQuCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIGRlbGV0ZUJ5SW5kZXgoJHBfaW5kZXgpCiAgICB7CgogICAgICAgICRwX2xpc3QgPSAkdGhpcy0+ZGVsZXRlKFBDTFpJUF9PUFRfQllfSU5ERVgsICRwX2luZGV4KTsKCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICRwX2xpc3Q7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByb3BlcnRpZXMoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIFRoaXMgbWV0aG9kIGdpdmVzIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBhcmNoaXZlLgogICAgLy8gICAgIFRoZSBwcm9wZXJ0aWVzIGFyZSA6CiAgICAvLyAgICAgICAgIG5iIDogTnVtYmVyIG9mIGZpbGVzIGluIHRoZSBhcmNoaXZlCiAgICAvLyAgICAgICAgIGNvbW1lbnQgOiBDb21tZW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgYXJjaGl2ZSBmaWxlCiAgICAvLyAgICAgICAgIHN0YXR1cyA6IG5vdF9leGlzdCwgb2sKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgIE5vbmUKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDAgb24gZmFpbHVyZSwKICAgIC8vICAgICBBbiBhcnJheSB3aXRoIHRoZSBhcmNoaXZlIHByb3BlcnRpZXMuCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByb3BlcnRpZXMoKQogICAgewoKICAgICAgICAvLyAtLS0tLSBSZXNldCB0aGUgZXJyb3IgaGFuZGxlcgogICAgICAgICR0aGlzLT5wcml2RXJyb3JSZXNldCgpOwoKICAgICAgICAvLyAtLS0tLSBNYWdpYyBxdW90ZXMgdHJpY2sKICAgICAgICAkdGhpcy0+cHJpdkRpc2FibGVNYWdpY1F1b3RlcygpOwoKICAgICAgICAvLyAtLS0tLSBDaGVjayBhcmNoaXZlCiAgICAgICAgaWYgKCEkdGhpcy0+cHJpdkNoZWNrRm9ybWF0KCkpIHsKICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIERlZmF1bHQgcHJvcGVydGllcwogICAgICAgICR2X3Byb3AgPSBhcnJheSgpOwogICAgICAgICR2X3Byb3BbJ2NvbW1lbnQnXSA9ICcnOwogICAgICAgICR2X3Byb3BbJ25iJ10gPSAwOwogICAgICAgICR2X3Byb3BbJ3N0YXR1cyddID0gJ25vdF9leGlzdCc7CgogICAgICAgIC8vIC0tLS0tIExvb2sgaWYgZmlsZSBleGlzdHMKICAgICAgICBpZiAoQGlzX2ZpbGUoJHRoaXMtPnppcG5hbWUpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIE9wZW4gdGhlIHppcCBmaWxlCiAgICAgICAgICAgIGlmICgoJHRoaXMtPnppcF9mZCA9IEBmb3BlbigkdGhpcy0+emlwbmFtZSwgJ3JiJykpID09IDApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9SRUFEX09QRU5fRkFJTCwgJ1VuYWJsZSB0byBvcGVuIGFyY2hpdmUgXCcnLiR0aGlzLT56aXBuYW1lLidcJyBpbiBiaW5hcnkgcmVhZCBtb2RlJyk7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgY2VudHJhbCBkaXJlY3RvcnkgaW5mb3JtYXRpb25zCiAgICAgICAgICAgICR2X2NlbnRyYWxfZGlyID0gYXJyYXkoKTsKICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdlJlYWRFbmRDZW50cmFsRGlyKCR2X2NlbnRyYWxfZGlyKSkgIT0gMSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2UgdGhlIHppcCBmaWxlCiAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwoKICAgICAgICAgICAgLy8gLS0tLS0gU2V0IHRoZSB1c2VyIGF0dHJpYnV0ZXMKICAgICAgICAgICAgJHZfcHJvcFsnY29tbWVudCddID0gJHZfY2VudHJhbF9kaXJbJ2NvbW1lbnQnXTsKICAgICAgICAgICAgJHZfcHJvcFsnbmInXSA9ICR2X2NlbnRyYWxfZGlyWydlbnRyaWVzJ107CiAgICAgICAgICAgICR2X3Byb3BbJ3N0YXR1cyddID0gJ29rJzsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIE1hZ2ljIHF1b3RlcyB0cmljawogICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcHJvcDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogZHVwbGljYXRlKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vICAgICBUaGlzIG1ldGhvZCBjcmVhdGVzIGFuIGFyY2hpdmUgYnkgY29weWluZyB0aGUgY29udGVudCBvZiBhbiBvdGhlciBvbmUuIElmCiAgICAvLyAgICAgdGhlIGFyY2hpdmUgYWxyZWFkeSBleGlzdCwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlIG5ldyBvbmUgd2l0aG91dCBhbnkgd2FybmluZy4KICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX2FyY2hpdmUgOiBUaGUgZmlsZW5hbWUgb2YgYSB2YWxpZCBhcmNoaXZlLCBvcgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgdmFsaWQgUGNsWmlwIG9iamVjdC4KICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDEgb24gc3VjY2Vzcy4KICAgIC8vICAgICAwIG9yIGEgbmVnYXRpdmUgdmFsdWUgb24gZXJyb3IgKGVycm9yIGNvZGUpLgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBkdXBsaWNhdGUoJHBfYXJjaGl2ZSkKICAgIHsKICAgICAgICAkdl9yZXN1bHQgPSAxOwoKICAgICAgICAvLyAtLS0tLSBSZXNldCB0aGUgZXJyb3IgaGFuZGxlcgogICAgICAgICR0aGlzLT5wcml2RXJyb3JSZXNldCgpOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSAkcF9hcmNoaXZlIGlzIGEgUGNsWmlwIG9iamVjdAogICAgICAgIGlmICgoaXNfb2JqZWN0KCRwX2FyY2hpdmUpKSAmJiAoZ2V0X2NsYXNzKCRwX2FyY2hpdmUpID09ICdwY2x6aXAnKSkgewogICAgICAgICAgICAvLyAtLS0tLSBEdXBsaWNhdGUgdGhlIGFyY2hpdmUKICAgICAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZEdXBsaWNhdGUoJHBfYXJjaGl2ZS0+emlwbmFtZSk7CiAgICAgICAgfSBlbHNlaWYgKGlzX3N0cmluZygkcF9hcmNoaXZlKSkgewogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSAkcF9hcmNoaXZlIGlzIGEgc3RyaW5nIChzbyBhIGZpbGVuYW1lKQogICAgICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGF0ICRwX2FyY2hpdmUgaXMgYSB2YWxpZCB6aXAgZmlsZQogICAgICAgICAgICAvLyBUQkMgOiBTaG91bGQgYWxzbyBjaGVjayB0aGUgYXJjaGl2ZSBmb3JtYXQKICAgICAgICAgICAgaWYgKCFpc19maWxlKCRwX2FyY2hpdmUpKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfTUlTU0lOR19GSUxFLCAiTm8gZmlsZSB3aXRoIGZpbGVuYW1lICciLiRwX2FyY2hpdmUuIiciKTsKICAgICAgICAgICAgICAgICR2X3Jlc3VsdCA9IFBDTFpJUF9FUlJfTUlTU0lOR19GSUxFOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gRHVwbGljYXRlIHRoZSBhcmNoaXZlCiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkR1cGxpY2F0ZSgkcF9hcmNoaXZlKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEludmFsaWQgdmFyaWFibGUKICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVIsICJJbnZhbGlkIHZhcmlhYmxlIHR5cGUgcF9hcmNoaXZlX3RvX2FkZCIpOwogICAgICAgICAgICAkdl9yZXN1bHQgPSBQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogbWVyZ2UoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIFRoaXMgbWV0aG9kIG1lcmdlIHRoZSAkcF9hcmNoaXZlX3RvX2FkZCBhcmNoaXZlIGF0IHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQKICAgIC8vICAgICBvbmUgKCR0aGlzKS4KICAgIC8vICAgICBJZiB0aGUgYXJjaGl2ZSAoJHRoaXMpIGRvZXMgbm90IGV4aXN0LCB0aGUgbWVyZ2UgYmVjb21lcyBhIGR1cGxpY2F0ZS4KICAgIC8vICAgICBJZiB0aGUgJHBfYXJjaGl2ZV90b19hZGQgYXJjaGl2ZSBkb2VzIG5vdCBleGlzdCwgdGhlIG1lcmdlIGlzIGEgc3VjY2Vzcy4KICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX2FyY2hpdmVfdG9fYWRkIDogSXQgY2FuIGJlIGRpcmVjdGx5IHRoZSBmaWxlbmFtZSBvZiBhIHZhbGlkIHppcCBhcmNoaXZlLAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBhIFBjbFppcCBvYmplY3QgYXJjaGl2ZS4KICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDEgb24gc3VjY2VzcywKICAgIC8vICAgICAwIG9yIG5lZ2F0aXZlIHZhbHVlcyBvbiBlcnJvciAoc2VlIGJlbG93KS4KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gbWVyZ2UoJHBfYXJjaGl2ZV90b19hZGQpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0ID0gMTsKCiAgICAgICAgLy8gLS0tLS0gUmVzZXQgdGhlIGVycm9yIGhhbmRsZXIKICAgICAgICAkdGhpcy0+cHJpdkVycm9yUmVzZXQoKTsKCiAgICAgICAgLy8gLS0tLS0gQ2hlY2sgYXJjaGl2ZQogICAgICAgIGlmICghJHRoaXMtPnByaXZDaGVja0Zvcm1hdCgpKSB7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlICRwX2FyY2hpdmVfdG9fYWRkIGlzIGEgUGNsWmlwIG9iamVjdAogICAgICAgIGlmICgoaXNfb2JqZWN0KCRwX2FyY2hpdmVfdG9fYWRkKSkgJiYgKGdldF9jbGFzcygkcF9hcmNoaXZlX3RvX2FkZCkgPT0gJ3BjbHppcCcpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIE1lcmdlIHRoZSBhcmNoaXZlCiAgICAgICAgICAgICR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2TWVyZ2UoJHBfYXJjaGl2ZV90b19hZGQpOwogICAgICAgIH0gZWxzZWlmIChpc19zdHJpbmcoJHBfYXJjaGl2ZV90b19hZGQpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlICRwX2FyY2hpdmVfdG9fYWRkIGlzIGEgc3RyaW5nIChzbyBhIGZpbGVuYW1lKQogICAgICAgICAgICAvLyAtLS0tLSBDcmVhdGUgYSB0ZW1wb3JhcnkgYXJjaGl2ZQogICAgICAgICAgICAkdl9vYmplY3RfYXJjaGl2ZSA9IG5ldyBQY2xaaXAoJHBfYXJjaGl2ZV90b19hZGQpOwoKICAgICAgICAgICAgLy8gLS0tLS0gTWVyZ2UgdGhlIGFyY2hpdmUKICAgICAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZNZXJnZSgkdl9vYmplY3RfYXJjaGl2ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gLS0tLS0gSW52YWxpZCB2YXJpYWJsZQogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX1BBUkFNRVRFUiwgIkludmFsaWQgdmFyaWFibGUgdHlwZSBwX2FyY2hpdmVfdG9fYWRkIik7CiAgICAgICAgICAgICR2X3Jlc3VsdCA9IFBDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVI7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IGVycm9yQ29kZSgpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gZXJyb3JDb2RlKCkKICAgIHsKICAgICAgICBpZiAoUENMWklQX0VSUk9SX0VYVEVSTkFMID09IDEpIHsKICAgICAgICAgICAgcmV0dXJuKFBjbEVycm9yQ29kZSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4oJHRoaXMtPmVycm9yX2NvZGUpOwogICAgICAgIH0KICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogZXJyb3JOYW1lKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBlcnJvck5hbWUoJHBfd2l0aF9jb2RlID0gZmFsc2UpCiAgICB7CiAgICAgICAgJHZfbmFtZSA9IGFycmF5KAogICAgICAgICAgICBQQ0xaSVBfRVJSX05PX0VSUk9SID0+ICdQQ0xaSVBfRVJSX05PX0VSUk9SJywKICAgICAgICAgICAgUENMWklQX0VSUl9XUklURV9PUEVOX0ZBSUwgPT4gJ1BDTFpJUF9FUlJfV1JJVEVfT1BFTl9GQUlMJywKICAgICAgICAgICAgUENMWklQX0VSUl9SRUFEX09QRU5fRkFJTCA9PiAnUENMWklQX0VSUl9SRUFEX09QRU5fRkFJTCcsCiAgICAgICAgICAgIFBDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVIgPT4gJ1BDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVInLAogICAgICAgICAgICBQQ0xaSVBfRVJSX01JU1NJTkdfRklMRSA9PiAnUENMWklQX0VSUl9NSVNTSU5HX0ZJTEUnLAogICAgICAgICAgICBQQ0xaSVBfRVJSX0ZJTEVOQU1FX1RPT19MT05HID0+ICdQQ0xaSVBfRVJSX0ZJTEVOQU1FX1RPT19MT05HJywKICAgICAgICAgICAgUENMWklQX0VSUl9JTlZBTElEX1pJUCA9PiAnUENMWklQX0VSUl9JTlZBTElEX1pJUCcsCiAgICAgICAgICAgIFBDTFpJUF9FUlJfQkFEX0VYVFJBQ1RFRF9GSUxFID0+ICdQQ0xaSVBfRVJSX0JBRF9FWFRSQUNURURfRklMRScsCiAgICAgICAgICAgIFBDTFpJUF9FUlJfRElSX0NSRUFURV9GQUlMID0+ICdQQ0xaSVBfRVJSX0RJUl9DUkVBVEVfRkFJTCcsCiAgICAgICAgICAgIFBDTFpJUF9FUlJfQkFEX0VYVEVOU0lPTiA9PiAnUENMWklQX0VSUl9CQURfRVhURU5TSU9OJywKICAgICAgICAgICAgUENMWklQX0VSUl9CQURfRk9STUFUID0+ICdQQ0xaSVBfRVJSX0JBRF9GT1JNQVQnLAogICAgICAgICAgICBQQ0xaSVBfRVJSX0RFTEVURV9GSUxFX0ZBSUwgPT4gJ1BDTFpJUF9FUlJfREVMRVRFX0ZJTEVfRkFJTCcsCiAgICAgICAgICAgIFBDTFpJUF9FUlJfUkVOQU1FX0ZJTEVfRkFJTCA9PiAnUENMWklQX0VSUl9SRU5BTUVfRklMRV9GQUlMJywKICAgICAgICAgICAgUENMWklQX0VSUl9CQURfQ0hFQ0tTVU0gPT4gJ1BDTFpJUF9FUlJfQkFEX0NIRUNLU1VNJywKICAgICAgICAgICAgUENMWklQX0VSUl9JTlZBTElEX0FSQ0hJVkVfWklQID0+ICdQQ0xaSVBfRVJSX0lOVkFMSURfQVJDSElWRV9aSVAnLAogICAgICAgICAgICBQQ0xaSVBfRVJSX01JU1NJTkdfT1BUSU9OX1ZBTFVFID0+ICdQQ0xaSVBfRVJSX01JU1NJTkdfT1BUSU9OX1ZBTFVFJywKICAgICAgICAgICAgUENMWklQX0VSUl9JTlZBTElEX09QVElPTl9WQUxVRSA9PiAnUENMWklQX0VSUl9JTlZBTElEX09QVElPTl9WQUxVRScsCiAgICAgICAgICAgIFBDTFpJUF9FUlJfVU5TVVBQT1JURURfQ09NUFJFU1NJT04gPT4gJ1BDTFpJUF9FUlJfVU5TVVBQT1JURURfQ09NUFJFU1NJT04nLAogICAgICAgICAgICBQQ0xaSVBfRVJSX1VOU1VQUE9SVEVEX0VOQ1JZUFRJT04gPT4gJ1BDTFpJUF9FUlJfVU5TVVBQT1JURURfRU5DUllQVElPTicsCiAgICAgICAgICAgIFBDTFpJUF9FUlJfSU5WQUxJRF9BVFRSSUJVVEVfVkFMVUUgPT4gJ1BDTFpJUF9FUlJfSU5WQUxJRF9BVFRSSUJVVEVfVkFMVUUnLAogICAgICAgICAgICBQQ0xaSVBfRVJSX0RJUkVDVE9SWV9SRVNUUklDVElPTiA9PiAnUENMWklQX0VSUl9ESVJFQ1RPUllfUkVTVFJJQ1RJT04nLAogICAgICAgICk7CgogICAgICAgIGlmIChpc3NldCgkdl9uYW1lWyR0aGlzLT5lcnJvcl9jb2RlXSkpIHsKICAgICAgICAgICAgJHZfdmFsdWUgPSAkdl9uYW1lWyR0aGlzLT5lcnJvcl9jb2RlXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdl92YWx1ZSA9ICdOb05hbWUnOwogICAgICAgIH0KCiAgICAgICAgaWYgKCRwX3dpdGhfY29kZSkgewogICAgICAgICAgICByZXR1cm4oJHZfdmFsdWUuJyAoJy4kdGhpcy0+ZXJyb3JfY29kZS4nKScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybigkdl92YWx1ZSk7CiAgICAgICAgfQogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBlcnJvckluZm8oKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIGVycm9ySW5mbygkcF9mdWxsID0gZmFsc2UpCiAgICB7CiAgICAgICAgaWYgKFBDTFpJUF9FUlJPUl9FWFRFUk5BTCA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybihQY2xFcnJvclN0cmluZygpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoJHBfZnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuKCR0aGlzLT5lcnJvck5hbWUodHJ1ZSkuIiA6ICIuJHRoaXMtPmVycm9yX3N0cmluZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4oJHRoaXMtPmVycm9yX3N0cmluZy4iIFtjb2RlICIuJHRoaXMtPmVycm9yX2NvZGUuIl0iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyAqKioqKiBVTkRFUiBUSElTIExJTkUgQVJFIERFRklORUQgUFJJVkFURSBJTlRFUk5BTCBGVU5DVElPTlMgKioqKioKICAgIC8vICoqKioqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoqKioqCiAgICAvLyAqKioqKiAgICAgICAgICAgICBUSEVTRVMgRlVOQ1RJT05TIE1VU1QgTk9UIEJFIFVTRUQgRElSRUNUTFkgICAgICAgICAgICAgKioqKioKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2Q2hlY2tGb3JtYXQoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIFRoaXMgbWV0aG9kIGNoZWNrIHRoYXQgdGhlIGFyY2hpdmUgZXhpc3RzIGFuZCBpcyBhIHZhbGlkIHppcCBhcmNoaXZlLgogICAgLy8gICAgIFNldmVyYWwgbGV2ZWwgb2YgY2hlY2sgZXhpc3RzLiAoZnV0dXIpCiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vICAgICAkcF9sZXZlbCA6IExldmVsIG9mIGNoZWNrLiBEZWZhdWx0IDAuCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAwIDogQ2hlY2sgdGhlIGZpcnN0IGJ5dGVzIChtYWdpYyBjb2RlcykgKGRlZmF1bHQgdmFsdWUpKQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgMSA6IDAgKyBDaGVjayB0aGUgY2VudHJhbCBkaXJlY3RvcnkgKGZ1dHVyKQogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgMiA6IDEgKyBDaGVjayBlYWNoIGZpbGUgaGVhZGVyIChmdXR1cikKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIHRydWUgb24gc3VjY2VzcywKICAgIC8vICAgICBmYWxzZSBvbiBlcnJvciwgdGhlIGVycm9yIGNvZGUgaXMgc2V0LgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2Q2hlY2tGb3JtYXQoJHBfbGV2ZWwgPSAwKQogICAgewogICAgICAgICR2X3Jlc3VsdCA9IHRydWU7CgogICAgICAgIC8vIC0tLS0tIFJlc2V0IHRoZSBmaWxlIHN5c3RlbSBjYWNoZQogICAgICAgIGNsZWFyc3RhdGNhY2hlKCk7CgogICAgICAgIC8vIC0tLS0tIFJlc2V0IHRoZSBlcnJvciBoYW5kbGVyCiAgICAgICAgJHRoaXMtPnByaXZFcnJvclJlc2V0KCk7CgogICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlIGZpbGUgZXhpdHMKICAgICAgICBpZiAoIWlzX2ZpbGUoJHRoaXMtPnppcG5hbWUpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX01JU1NJTkdfRklMRSwgIk1pc3NpbmcgYXJjaGl2ZSBmaWxlICciLiR0aGlzLT56aXBuYW1lLiInIik7CiAgICAgICAgICAgIHJldHVybihmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGF0IHRoZSBmaWxlIGlzIHJlYWRlYWJsZQogICAgICAgIGlmICghaXNfcmVhZGFibGUoJHRoaXMtPnppcG5hbWUpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX1JFQURfT1BFTl9GQUlMLCAiVW5hYmxlIHRvIHJlYWQgYXJjaGl2ZSAnIi4kdGhpcy0+emlwbmFtZS4iJyIpOwogICAgICAgICAgICByZXR1cm4oZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIG1hZ2ljIGNvZGUKICAgICAgICAvLyBUQkMKCiAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIGNlbnRyYWwgaGVhZGVyCiAgICAgICAgLy8gVEJDCgogICAgICAgIC8vIC0tLS0tIENoZWNrIGVhY2ggZmlsZSBoZWFkZXIKICAgICAgICAvLyBUQkMKCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdlBhcnNlT3B0aW9ucygpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyAgICAgVGhpcyBpbnRlcm5hbCBtZXRob2RzIHJlYWRzIHRoZSB2YXJpYWJsZSBsaXN0IG9mIGFyZ3VtZW50cyAoJHBfb3B0aW9uc19saXN0LAogICAgLy8gICAgICRwX3NpemUpIGFuZCBnZW5lcmF0ZSBhbiBhcnJheSB3aXRoIHRoZSBvcHRpb25zIGFuZCB2YWx1ZXMgKCR2X3Jlc3VsdF9saXN0KS4KICAgIC8vICAgICAkdl9yZXF1ZXN0ZWRfb3B0aW9ucyBjb250YWlucyB0aGUgb3B0aW9ucyB0aGF0IGNhbiBiZSBwcmVzZW50IGFuZCB0aG9zZSB0aGF0CiAgICAvLyAgICAgbXVzdCBiZSBwcmVzZW50LgogICAgLy8gICAgICR2X3JlcXVlc3RlZF9vcHRpb25zIGlzIGFuIGFycmF5LCB3aXRoIHRoZSBvcHRpb24gdmFsdWUgYXMga2V5LCBhbmQgJ29wdGlvbmFsJywKICAgIC8vICAgICBvciAnbWFuZGF0b3J5JyBhcyB2YWx1ZS4KICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgIFNlZSBhYm92ZS4KICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDEgb24gc3VjY2Vzcy4KICAgIC8vICAgICAwIG9uIGZhaWx1cmUuCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZQYXJzZU9wdGlvbnMoJiRwX29wdGlvbnNfbGlzdCwgJHBfc2l6ZSwgJiR2X3Jlc3VsdF9saXN0LCAkdl9yZXF1ZXN0ZWRfb3B0aW9ucyA9IGZhbHNlKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBvcHRpb25zCiAgICAgICAgJGk9MDsKICAgICAgICB3aGlsZSAoJGk8JHBfc2l6ZSkgewogICAgICAgICAgICAvLyAtLS0tLSBDaGVjayBpZiB0aGUgb3B0aW9uIGlzIHN1cHBvcnRlZAogICAgICAgICAgICBpZiAoIWlzc2V0KCR2X3JlcXVlc3RlZF9vcHRpb25zWyRwX29wdGlvbnNfbGlzdFskaV1dKSkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiSW52YWxpZCBvcHRpb25hbCBwYXJhbWV0ZXIgJyIuJHBfb3B0aW9uc19saXN0WyRpXS4iJyBmb3IgdGhpcyBtZXRob2QiKTsKCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBuZXh0IG9wdGlvbgogICAgICAgICAgICBzd2l0Y2ggKCRwX29wdGlvbnNfbGlzdFskaV0pIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG9wdGlvbnMgdGhhdCByZXF1ZXN0IGEgcGF0aCB2YWx1ZQogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfT1BUX1BBVEg6CiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfUkVNT1ZFX1BBVEg6CiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfQUREX1BBVEg6CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIG51bWJlciBvZiBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkaSsxKSA+PSAkcF9zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX01JU1NJTkdfT1BUSU9OX1ZBTFVFLCAiTWlzc2luZyBwYXJhbWV0ZXIgdmFsdWUgZm9yIG9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSB2YWx1ZQogICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdF9saXN0WyRwX29wdGlvbnNfbGlzdFskaV1dID0gUGNsWmlwVXRpbFRyYW5zbGF0ZVdpblBhdGgoJHBfb3B0aW9uc19saXN0WyRpKzFdLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgJGkrKzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfVEVNUF9GSUxFX1RIUkVTSE9MRDoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMKICAgICAgICAgICAgICAgICAgICBpZiAoKCRpKzEpID49ICRwX3NpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9NSVNTSU5HX09QVElPTl9WQUxVRSwgIk1pc3NpbmcgcGFyYW1ldGVyIHZhbHVlIGZvciBvcHRpb24gJyIuUGNsWmlwVXRpbE9wdGlvblRleHQoJHBfb3B0aW9uc19saXN0WyRpXSkuIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGVjayBmb3IgaW5jb21wYXRpYmxlIG9wdGlvbnMKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZfcmVzdWx0X2xpc3RbUENMWklQX09QVF9URU1QX0ZJTEVfT0ZGXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX1BBUkFNRVRFUiwgIk9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyBjYW4gbm90IGJlIHVzZWQgd2l0aCBvcHRpb24gJ1BDTFpJUF9PUFRfVEVNUF9GSUxFX09GRiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGUgdmFsdWUKICAgICAgICAgICAgICAgICAgICAkdl92YWx1ZSA9ICRwX29wdGlvbnNfbGlzdFskaSsxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoKCFpc19pbnRlZ2VyKCR2X3ZhbHVlKSkgfHwgKCR2X3ZhbHVlPDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9PUFRJT05fVkFMVUUsICJJbnRlZ2VyIGV4cGVjdGVkIGZvciBvcHRpb24gJyIuUGNsWmlwVXRpbE9wdGlvblRleHQoJHBfb3B0aW9uc19saXN0WyRpXSkuIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIHZhbHVlIChhbmQgY29udmVydCBpdCBpbiBieXRlcykKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHRfbGlzdFskcF9vcHRpb25zX2xpc3RbJGldXSA9ICR2X3ZhbHVlKjEwNDg1NzY7CiAgICAgICAgICAgICAgICAgICAgJGkrKzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfVEVNUF9GSUxFX09OOgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoZWNrIGZvciBpbmNvbXBhdGlibGUgb3B0aW9ucwogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdl9yZXN1bHRfbGlzdFtQQ0xaSVBfT1BUX1RFTVBfRklMRV9PRkZdKSkgewogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiT3B0aW9uICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCRwX29wdGlvbnNfbGlzdFskaV0pLiInIGNhbiBub3QgYmUgdXNlZCB3aXRoIG9wdGlvbiAnUENMWklQX09QVF9URU1QX0ZJTEVfT0ZGJyIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdF9saXN0WyRwX29wdGlvbnNfbGlzdFskaV1dID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfVEVNUF9GSUxFX09GRjoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGVjayBmb3IgaW5jb21wYXRpYmxlIG9wdGlvbnMKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZfcmVzdWx0X2xpc3RbUENMWklQX09QVF9URU1QX0ZJTEVfT05dKSkgewogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiT3B0aW9uICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCRwX29wdGlvbnNfbGlzdFskaV0pLiInIGNhbiBub3QgYmUgdXNlZCB3aXRoIG9wdGlvbiAnUENMWklQX09QVF9URU1QX0ZJTEVfT04nIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGVjayBmb3IgaW5jb21wYXRpYmxlIG9wdGlvbnMKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHZfcmVzdWx0X2xpc3RbUENMWklQX09QVF9URU1QX0ZJTEVfVEhSRVNIT0xEXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX1BBUkFNRVRFUiwgIk9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyBjYW4gbm90IGJlIHVzZWQgd2l0aCBvcHRpb24gJ1BDTFpJUF9PUFRfVEVNUF9GSUxFX1RIUkVTSE9MRCciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdF9saXN0WyRwX29wdGlvbnNfbGlzdFskaV1dID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfRVhUUkFDVF9ESVJfUkVTVFJJQ1RJT046CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIG51bWJlciBvZiBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkaSsxKSA+PSAkcF9zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX01JU1NJTkdfT1BUSU9OX1ZBTFVFLCAiTWlzc2luZyBwYXJhbWV0ZXIgdmFsdWUgZm9yIG9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyIpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX3N0cmluZygkcF9vcHRpb25zX2xpc3RbJGkrMV0pICYmICgkcF9vcHRpb25zX2xpc3RbJGkrMV0gIT0gJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdF9saXN0WyRwX29wdGlvbnNfbGlzdFskaV1dID0gUGNsWmlwVXRpbFRyYW5zbGF0ZVdpblBhdGgoJHBfb3B0aW9uc19saXN0WyRpKzFdLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBvcHRpb25zIHRoYXQgcmVxdWVzdCBhbiBhcnJheSBvZiBzdHJpbmcgZm9yIHZhbHVlCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfQllfTkFNRToKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMKICAgICAgICAgICAgICAgICAgICBpZiAoKCRpKzEpID49ICRwX3NpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfTUlTU0lOR19PUFRJT05fVkFMVUUsICJNaXNzaW5nIHBhcmFtZXRlciB2YWx1ZSBmb3Igb3B0aW9uICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCRwX29wdGlvbnNfbGlzdFskaV0pLiInIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEdldCB0aGUgdmFsdWUKICAgICAgICAgICAgICAgICAgICBpZiAoaXNfc3RyaW5nKCRwX29wdGlvbnNfbGlzdFskaSsxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdF9saXN0WyRwX29wdGlvbnNfbGlzdFskaV1dWzBdID0gJHBfb3B0aW9uc19saXN0WyRpKzFdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmIChpc19hcnJheSgkcF9vcHRpb25zX2xpc3RbJGkrMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHRfbGlzdFskcF9vcHRpb25zX2xpc3RbJGldXSA9ICRwX29wdGlvbnNfbGlzdFskaSsxXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX09QVElPTl9WQUxVRSwgIldyb25nIHBhcmFtZXRlciB2YWx1ZSBmb3Igb3B0aW9uICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCRwX29wdGlvbnNfbGlzdFskaV0pLiInIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGkrKzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG9wdGlvbnMgdGhhdCByZXF1ZXN0IGFuIEVSRUcgb3IgUFJFRyBleHByZXNzaW9uCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfQllfRVJFRzoKICAgICAgICAgICAgICAgICAgICAvLyBlcmVnKCkgaXMgZGVwcmVjYXRlZCBzdGFydGluZyB3aXRoIFBIUCA1LjMuIE1vdmUgUENMWklQX09QVF9CWV9FUkVHCiAgICAgICAgICAgICAgICAgICAgLy8gdG8gUENMWklQX09QVF9CWV9QUkVHCiAgICAgICAgICAgICAgICAgICAgJHBfb3B0aW9uc19saXN0WyRpXSA9IFBDTFpJUF9PUFRfQllfUFJFRzsKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9CWV9QUkVHOgogICAgICAgICAgICAgICAgLy9jYXNlIFBDTFpJUF9PUFRfQ1JZUFQgOgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoZWNrIHRoZSBudW1iZXIgb2YgcGFyYW1ldGVycwogICAgICAgICAgICAgICAgICAgIGlmICgoJGkrMSkgPj0gJHBfc2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9NSVNTSU5HX09QVElPTl9WQUxVRSwgIk1pc3NpbmcgcGFyYW1ldGVyIHZhbHVlIGZvciBvcHRpb24gJyIuUGNsWmlwVXRpbE9wdGlvblRleHQoJHBfb3B0aW9uc19saXN0WyRpXSkuIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGlmIChpc19zdHJpbmcoJHBfb3B0aW9uc19saXN0WyRpKzFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0X2xpc3RbJHBfb3B0aW9uc19saXN0WyRpXV0gPSAkcF9vcHRpb25zX2xpc3RbJGkrMV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9PUFRJT05fVkFMVUUsICJXcm9uZyBwYXJhbWV0ZXIgdmFsdWUgZm9yIG9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyIpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igb3B0aW9ucyB0aGF0IHRha2VzIGEgc3RyaW5nCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9PUFRfQ09NTUVOVDoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9BRERfQ09NTUVOVDoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9QUkVQRU5EX0NPTU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIG51bWJlciBvZiBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkaSsxKSA+PSAkcF9zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX01JU1NJTkdfT1BUSU9OX1ZBTFVFLCAiTWlzc2luZyBwYXJhbWV0ZXIgdmFsdWUgZm9yIG9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGlmIChpc19zdHJpbmcoJHBfb3B0aW9uc19saXN0WyRpKzFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0X2xpc3RbJHBfb3B0aW9uc19saXN0WyRpXV0gPSAkcF9vcHRpb25zX2xpc3RbJGkrMV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9PUFRJT05fVkFMVUUsICJXcm9uZyBwYXJhbWV0ZXIgdmFsdWUgZm9yIG9wdGlvbiAnIiAuUGNsWmlwVXRpbE9wdGlvblRleHQoJHBfb3B0aW9uc19saXN0WyRpXSkgLiInIik7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igb3B0aW9ucyB0aGF0IHJlcXVlc3QgYW4gYXJyYXkgb2YgaW5kZXgKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9CWV9JTkRFWDoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGUgbnVtYmVyIG9mIHBhcmFtZXRlcnMKICAgICAgICAgICAgICAgICAgICBpZiAoKCRpKzEpID49ICRwX3NpemUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfTUlTU0lOR19PUFRJT05fVkFMVUUsICJNaXNzaW5nIHBhcmFtZXRlciB2YWx1ZSBmb3Igb3B0aW9uICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCRwX29wdGlvbnNfbGlzdFskaV0pLiInIik7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgJHZfd29ya19saXN0ID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNfc3RyaW5nKCRwX29wdGlvbnNfbGlzdFskaSsxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmVtb3ZlIHNwYWNlcwogICAgICAgICAgICAgICAgICAgICAgICAkcF9vcHRpb25zX2xpc3RbJGkrMV0gPSBzdHJ0cigkcF9vcHRpb25zX2xpc3RbJGkrMV0sICcgJywgJycpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUGFyc2UgaXRlbXMKICAgICAgICAgICAgICAgICAgICAgICAgJHZfd29ya19saXN0ID0gZXhwbG9kZSgiLCIsICRwX29wdGlvbnNfbGlzdFskaSsxXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKGlzX2ludGVnZXIoJHBfb3B0aW9uc19saXN0WyRpKzFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZfd29ya19saXN0WzBdID0gJHBfb3B0aW9uc19saXN0WyRpKzFdLictJy4kcF9vcHRpb25zX2xpc3RbJGkrMV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKGlzX2FycmF5KCRwX29wdGlvbnNfbGlzdFskaSsxXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2X3dvcmtfbGlzdCA9ICRwX29wdGlvbnNfbGlzdFskaSsxXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX09QVElPTl9WQUxVRSwgIlZhbHVlIG11c3QgYmUgaW50ZWdlciwgc3RyaW5nIG9yIGFycmF5IGZvciBvcHRpb24gJyIuUGNsWmlwVXRpbE9wdGlvblRleHQoJHBfb3B0aW9uc19saXN0WyRpXSkuIiciKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJlZHVjZSB0aGUgaW5kZXggbGlzdAogICAgICAgICAgICAgICAgICAgIC8vIGVhY2ggaW5kZXggaXRlbSBpbiB0aGUgbGlzdCBtdXN0IGJlIGEgY291cGxlIHdpdGggYSBzdGFydCBhbmQKICAgICAgICAgICAgICAgICAgICAvLyBhbiBlbmQgdmFsdWUgOiBbMCwzXSwgWzUtNV0sIFs4LTEwXSwgLi4uCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIGZvcm1hdCBvZiBlYWNoIGl0ZW0KICAgICAgICAgICAgICAgICAgICAkdl9zb3J0X2ZsYWc9ZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgJHZfc29ydF92YWx1ZT0wOwogICAgICAgICAgICAgICAgICAgIGZvciAoJGo9MDsgJGo8c2l6ZW9mKCR2X3dvcmtfbGlzdCk7ICRqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXhwbG9kZSB0aGUgaXRlbQogICAgICAgICAgICAgICAgICAgICAgICAkdl9pdGVtX2xpc3QgPSBleHBsb2RlKCItIiwgJHZfd29ya19saXN0WyRqXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICR2X3NpemVfaXRlbV9saXN0ID0gc2l6ZW9mKCR2X2l0ZW1fbGlzdCk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBUQkMgOiBIZXJlIHdlIG1pZ2h0IGNoZWNrIHRoYXQgZWFjaCBpdGVtIGlzIGEKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVhbCBpbnRlZ2VyIC4uLgoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igc2luZ2xlIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdl9zaXplX2l0ZW1fbGlzdCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBTZXQgdGhlIG9wdGlvbiB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0X2xpc3RbJHBfb3B0aW9uc19saXN0WyRpXV1bJGpdWydzdGFydCddID0gJHZfaXRlbV9saXN0WzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0X2xpc3RbJHBfb3B0aW9uc19saXN0WyRpXV1bJGpdWydlbmQnXSA9ICR2X2l0ZW1fbGlzdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCR2X3NpemVfaXRlbV9saXN0ID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFNldCB0aGUgb3B0aW9uIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHRfbGlzdFskcF9vcHRpb25zX2xpc3RbJGldXVskal1bJ3N0YXJ0J10gPSAkdl9pdGVtX2xpc3RbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHRfbGlzdFskcF9vcHRpb25zX2xpc3RbJGldXVskal1bJ2VuZCddID0gJHZfaXRlbV9saXN0WzFdOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfT1BUSU9OX1ZBTFVFLCAiVG9vIG1hbnkgdmFsdWVzIGluIGluZGV4IHJhbmdlIGZvciBvcHRpb24gJyIuUGNsWmlwVXRpbE9wdGlvblRleHQoJHBfb3B0aW9uc19saXN0WyRpXSkuIiciKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgbGlzdCBzb3J0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdl9yZXN1bHRfbGlzdFskcF9vcHRpb25zX2xpc3RbJGldXVskal1bJ3N0YXJ0J10gPCAkdl9zb3J0X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdl9zb3J0X2ZsYWc9dHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBUQkMgOiBBbiBhdXRvbWF0aWMgc29ydCBzaG91bGQgYmUgd3JpdGVuIC4uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfT1BUSU9OX1ZBTFVFLCAiSW52YWxpZCBvcmRlciBvZiBpbmRleCByYW5nZSBmb3Igb3B0aW9uICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCRwX29wdGlvbnNfbGlzdFskaV0pLiInIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkdl9zb3J0X3ZhbHVlID0gJHZfcmVzdWx0X2xpc3RbJHBfb3B0aW9uc19saXN0WyRpXV1bJGpdWydzdGFydCddOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gU29ydCB0aGUgaXRlbXMKICAgICAgICAgICAgICAgICAgICBpZiAoJHZfc29ydF9mbGFnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRCQyA6IFRvIEJlIENvbXBsZXRlZAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBOZXh0IG9wdGlvbgogICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBvcHRpb25zIHRoYXQgcmVxdWVzdCBubyB2YWx1ZQogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfT1BUX1JFTU9WRV9BTExfUEFUSDoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9FWFRSQUNUX0FTX1NUUklORzoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9OT19DT01QUkVTU0lPTjoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9FWFRSQUNUX0lOX09VVFBVVDoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9SRVBMQUNFX05FV0VSOgogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1I6CiAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0X2xpc3RbJHBfb3B0aW9uc19saXN0WyRpXV0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igb3B0aW9ucyB0aGF0IHJlcXVlc3QgYW4gb2N0YWwgdmFsdWUKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX09QVF9TRVRfQ0hNT0Q6CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIG51bWJlciBvZiBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkaSsxKSA+PSAkcF9zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX01JU1NJTkdfT1BUSU9OX1ZBTFVFLCAiTWlzc2luZyBwYXJhbWV0ZXIgdmFsdWUgZm9yIG9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyIpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEdldCB0aGUgdmFsdWUKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHRfbGlzdFskcF9vcHRpb25zX2xpc3RbJGldXSA9ICRwX29wdGlvbnNfbGlzdFskaSsxXTsKICAgICAgICAgICAgICAgICAgICAkaSsrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG9wdGlvbnMgdGhhdCByZXF1ZXN0IGEgY2FsbC1iYWNrCiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9DQl9QUkVfRVhUUkFDVDoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX0NCX1BPU1RfRVhUUkFDVDoKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX0NCX1BSRV9BREQ6CiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9DQl9QT1NUX0FERDoKICAgICAgICAgICAgICAgIC8qIGZvciBmdXR1ciB1c2UKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX0NCX1BSRV9ERUxFVEUgOgogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfQ0JfUE9TVF9ERUxFVEUgOgogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfQ0JfUFJFX0xJU1QgOgogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfQ0JfUE9TVF9MSVNUIDoKICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIG51bWJlciBvZiBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkaSsxKSA+PSAkcF9zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX01JU1NJTkdfT1BUSU9OX1ZBTFVFLCAiTWlzc2luZyBwYXJhbWV0ZXIgdmFsdWUgZm9yIG9wdGlvbiAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb25zX2xpc3RbJGldKS4iJyIpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgJHZfZnVuY3Rpb25fbmFtZSA9ICRwX29wdGlvbnNfbGlzdFskaSsxXTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhhdCB0aGUgdmFsdWUgaXMgYSB2YWxpZCBleGlzdGluZyBmdW5jdGlvbgogICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25fZXhpc3RzKCR2X2Z1bmN0aW9uX25hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfT1BUSU9OX1ZBTFVFLCAiRnVuY3Rpb24gJyIuJHZfZnVuY3Rpb25fbmFtZS4iKCknIGlzIG5vdCBhbiBleGlzdGluZyBmdW5jdGlvbiBmb3Igb3B0aW9uICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCRwX29wdGlvbnNfbGlzdFskaV0pLiInIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFNldCB0aGUgYXR0cmlidXRlCiAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0X2xpc3RbJHBfb3B0aW9uc19saXN0WyRpXV0gPSAkdl9mdW5jdGlvbl9uYW1lOwogICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVIsICJVbmtub3duIHBhcmFtZXRlciAnIiAuJHBfb3B0aW9uc19saXN0WyRpXS4iJyIpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gTmV4dCBvcHRpb25zCiAgICAgICAgICAgICRpKys7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBtYW5kYXRvcnkgb3B0aW9ucwogICAgICAgIGlmICgkdl9yZXF1ZXN0ZWRfb3B0aW9ucyAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgZm9yICgka2V5PXJlc2V0KCR2X3JlcXVlc3RlZF9vcHRpb25zKTsgJGtleT1rZXkoJHZfcmVxdWVzdGVkX29wdGlvbnMpOyAka2V5PW5leHQoJHZfcmVxdWVzdGVkX29wdGlvbnMpKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBtYW5kYXRvcnkgb3B0aW9uCiAgICAgICAgICAgICAgICBpZiAoJHZfcmVxdWVzdGVkX29wdGlvbnNbJGtleV0gPT0gJ21hbmRhdG9yeScpIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCR2X3Jlc3VsdF9saXN0WyRrZXldKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX1BBUkFNRVRFUiwgIk1pc3NpbmcgbWFuZGF0b3J5IHBhcmFtZXRlciAiLlBjbFppcFV0aWxPcHRpb25UZXh0KCRrZXkpLiIoIi4ka2V5LiIpIik7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBkZWZhdWx0IHZhbHVlcwogICAgICAgIGlmICghaXNzZXQoJHZfcmVzdWx0X2xpc3RbUENMWklQX09QVF9URU1QX0ZJTEVfVEhSRVNIT0xEXSkpIHsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZPcHRpb25EZWZhdWx0VGhyZXNob2xkKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZPcHRpb25EZWZhdWx0VGhyZXNob2xkKCYkcF9vcHRpb25zKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICBpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1RFTVBfRklMRV9USFJFU0hPTERdKSB8fCBpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX09GRl0pKSB7CiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBHZXQgJ21lbW9yeV9saW1pdCcgY29uZmlndXJhdGlvbiB2YWx1ZQogICAgICAgICR2X21lbW9yeV9saW1pdCA9IGluaV9nZXQoJ21lbW9yeV9saW1pdCcpOwogICAgICAgICR2X21lbW9yeV9saW1pdCA9IHRyaW0oJHZfbWVtb3J5X2xpbWl0KTsKICAgICAgICAkbGFzdCA9IHN0cnRvbG93ZXIoc3Vic3RyKCR2X21lbW9yeV9saW1pdCwgLTEpKTsKCiAgICAgICAgaWYgKCRsYXN0ID09ICdnJykgewogICAgICAgICAgICAvLyR2X21lbW9yeV9saW1pdCA9ICR2X21lbW9yeV9saW1pdCoxMDI0KjEwMjQqMTAyNDsKICAgICAgICAgICAgJHZfbWVtb3J5X2xpbWl0ID0gJHZfbWVtb3J5X2xpbWl0KjEwNzM3NDE4MjQ7CiAgICAgICAgfQogICAgICAgIGlmICgkbGFzdCA9PSAnbScpIHsKICAgICAgICAgICAgLy8kdl9tZW1vcnlfbGltaXQgPSAkdl9tZW1vcnlfbGltaXQqMTAyNCoxMDI0OwogICAgICAgICAgICAkdl9tZW1vcnlfbGltaXQgPSAkdl9tZW1vcnlfbGltaXQqMTA0ODU3NjsKICAgICAgICB9CiAgICAgICAgaWYgKCRsYXN0ID09ICdrJykgewogICAgICAgICAgICAkdl9tZW1vcnlfbGltaXQgPSAkdl9tZW1vcnlfbGltaXQqMTAyNDsKICAgICAgICB9CgogICAgICAgICRwX29wdGlvbnNbUENMWklQX09QVF9URU1QX0ZJTEVfVEhSRVNIT0xEXSA9IGZsb29yKCR2X21lbW9yeV9saW1pdCpQQ0xaSVBfVEVNUE9SQVJZX0ZJTEVfUkFUSU8pOwoKICAgICAgICAvLyAtLS0tLSBTYW5pdHkgY2hlY2sgOiBObyB0aHJlc2hvbGQgaWYgdmFsdWUgbG93ZXIgdGhhbiAxTQogICAgICAgIGlmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX1RIUkVTSE9MRF0gPCAxMDQ4NTc2KSB7CiAgICAgICAgICAgIHVuc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9URU1QX0ZJTEVfVEhSRVNIT0xEXSk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2RmlsZURlc2NyUGFyc2VBdHQoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vICAgICAxIG9uIHN1Y2Nlc3MuCiAgICAvLyAgICAgMCBvbiBmYWlsdXJlLgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2RmlsZURlc2NyUGFyc2VBdHQoJiRwX2ZpbGVfbGlzdCwgJiRwX2ZpbGVkZXNjciwgJHZfb3B0aW9ucywgJHZfcmVxdWVzdGVkX29wdGlvbnMgPSBmYWxzZSkKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gRm9yIGVhY2ggZmlsZSBpbiB0aGUgbGlzdCBjaGVjayB0aGUgYXR0cmlidXRlcwogICAgICAgIGZvcmVhY2ggKCRwX2ZpbGVfbGlzdCBhcyAkdl9rZXkgPT4gJHZfdmFsdWUpIHsKICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgaWYgdGhlIG9wdGlvbiBpcyBzdXBwb3J0ZWQKICAgICAgICAgICAgaWYgKCFpc3NldCgkdl9yZXF1ZXN0ZWRfb3B0aW9uc1skdl9rZXldKSkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfUEFSQU1FVEVSLCAiSW52YWxpZCBmaWxlIGF0dHJpYnV0ZSAnIi4kdl9rZXkuIicgZm9yIHRoaXMgZmlsZSIpOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGF0dHJpYnV0ZQogICAgICAgICAgICBzd2l0Y2ggKCR2X2tleSkgewogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfQVRUX0ZJTEVfTkFNRToKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX3N0cmluZygkdl92YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX0FUVFJJQlVURV9WQUxVRSwgIkludmFsaWQgdHlwZSAiLmdldHR5cGUoJHZfdmFsdWUpLiIuIFN0cmluZyBleHBlY3RlZCBmb3IgYXR0cmlidXRlICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCR2X2tleSkuIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkcF9maWxlZGVzY3JbJ2ZpbGVuYW1lJ10gPSBQY2xaaXBVdGlsUGF0aFJlZHVjdGlvbigkdl92YWx1ZSk7CgogICAgICAgICAgICAgICAgICAgIGlmICgkcF9maWxlZGVzY3JbJ2ZpbGVuYW1lJ10gPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX0FUVFJJQlVURV9WQUxVRSwgIkludmFsaWQgZW1wdHkgZmlsZW5hbWUgZm9yIGF0dHJpYnV0ZSAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkdl9rZXkpLiInIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUENMWklQX0FUVF9GSUxFX05FV19TSE9SVF9OQU1FOgogICAgICAgICAgICAgICAgICAgIGlmICghaXNfc3RyaW5nKCR2X3ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfQVRUUklCVVRFX1ZBTFVFLCAiSW52YWxpZCB0eXBlICIuZ2V0dHlwZSgkdl92YWx1ZSkuIi4gU3RyaW5nIGV4cGVjdGVkIGZvciBhdHRyaWJ1dGUgJyIuUGNsWmlwVXRpbE9wdGlvblRleHQoJHZfa2V5KS4iJyIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRwX2ZpbGVkZXNjclsnbmV3X3Nob3J0X25hbWUnXSA9IFBjbFppcFV0aWxQYXRoUmVkdWN0aW9uKCR2X3ZhbHVlKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRwX2ZpbGVkZXNjclsnbmV3X3Nob3J0X25hbWUnXSA9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfQVRUUklCVVRFX1ZBTFVFLCAiSW52YWxpZCBlbXB0eSBzaG9ydCBmaWxlbmFtZSBmb3IgYXR0cmlidXRlICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCR2X2tleSkuIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfQVRUX0ZJTEVfTkVXX0ZVTExfTkFNRToKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX3N0cmluZygkdl92YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX0FUVFJJQlVURV9WQUxVRSwgIkludmFsaWQgdHlwZSAiLmdldHR5cGUoJHZfdmFsdWUpLiIuIFN0cmluZyBleHBlY3RlZCBmb3IgYXR0cmlidXRlICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCR2X2tleSkuIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkcF9maWxlZGVzY3JbJ25ld19mdWxsX25hbWUnXSA9IFBjbFppcFV0aWxQYXRoUmVkdWN0aW9uKCR2X3ZhbHVlKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRwX2ZpbGVkZXNjclsnbmV3X2Z1bGxfbmFtZSddID09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9BVFRSSUJVVEVfVkFMVUUsICJJbnZhbGlkIGVtcHR5IGZ1bGwgZmlsZW5hbWUgZm9yIGF0dHJpYnV0ZSAnIi5QY2xaaXBVdGlsT3B0aW9uVGV4dCgkdl9rZXkpLiInIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG9wdGlvbnMgdGhhdCB0YWtlcyBhIHN0cmluZwogICAgICAgICAgICAgICAgY2FzZSBQQ0xaSVBfQVRUX0ZJTEVfQ09NTUVOVDoKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX3N0cmluZygkdl92YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX0FUVFJJQlVURV9WQUxVRSwgIkludmFsaWQgdHlwZSAiLmdldHR5cGUoJHZfdmFsdWUpLiIuIFN0cmluZyBleHBlY3RlZCBmb3IgYXR0cmlidXRlICciLlBjbFppcFV0aWxPcHRpb25UZXh0KCR2X2tleSkuIiciKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRwX2ZpbGVkZXNjclsnY29tbWVudCddID0gJHZfdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9BVFRfRklMRV9NVElNRToKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX2ludGVnZXIoJHZfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9BVFRSSUJVVEVfVkFMVUUsICJJbnZhbGlkIHR5cGUgIi5nZXR0eXBlKCR2X3ZhbHVlKS4iLiBJbnRlZ2VyIGV4cGVjdGVkIGZvciBhdHRyaWJ1dGUgJyIuUGNsWmlwVXRpbE9wdGlvblRleHQoJHZfa2V5KS4iJyIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHBfZmlsZWRlc2NyWydtdGltZSddID0gJHZfdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBDTFpJUF9BVFRfRklMRV9DT05URU5UOgogICAgICAgICAgICAgICAgICAgICRwX2ZpbGVkZXNjclsnY29udGVudCddID0gJHZfdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVIsICJVbmtub3duIHBhcmFtZXRlciAnIi4kdl9rZXkuIiciKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG1hbmRhdG9yeSBvcHRpb25zCiAgICAgICAgICAgIGlmICgkdl9yZXF1ZXN0ZWRfb3B0aW9ucyAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGZvciAoJGtleSA9IHJlc2V0KCR2X3JlcXVlc3RlZF9vcHRpb25zKTsgJGtleSA9IGtleSgkdl9yZXF1ZXN0ZWRfb3B0aW9ucyk7ICRrZXkgPSBuZXh0KCR2X3JlcXVlc3RlZF9vcHRpb25zKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG1hbmRhdG9yeSBvcHRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoJHZfcmVxdWVzdGVkX29wdGlvbnNbJGtleV0gPT0gJ21hbmRhdG9yeScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBpZiBwcmVzZW50CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJHBfZmlsZV9saXN0WyRrZXldKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX1BBUkFNRVRFUiwgIk1pc3NpbmcgbWFuZGF0b3J5IHBhcmFtZXRlciAiLlBjbFppcFV0aWxPcHRpb25UZXh0KCRrZXkpLiIoIi4ka2V5LiIpIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkZpbGVEZXNjckV4cGFuZCgpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyAgICAgVGhpcyBtZXRob2QgbG9vayBmb3IgZWFjaCBpdGVtIG9mIHRoZSBsaXN0IHRvIHNlZSBpZiBpdHMgYSBmaWxlLCBhIGZvbGRlcgogICAgLy8gICAgIG9yIGEgc3RyaW5nIHRvIGJlIGFkZGVkIGFzIGZpbGUuIEZvciBhbnkgb3RoZXIgdHlwZSBvZiBmaWxlcyAobGluaywgb3RoZXIpCiAgICAvLyAgICAganVzdCBpZ25vcmUgdGhlIGl0ZW0uCiAgICAvLyAgICAgVGhlbiBwcmVwYXJlIHRoZSBpbmZvcm1hdGlvbiB0aGF0IHdpbGwgYmUgc3RvcmVkIGZvciB0aGF0IGZpbGUuCiAgICAvLyAgICAgV2hlbiBpdHMgYSBmb2xkZXIsIGV4cGFuZCB0aGUgZm9sZGVyIHdpdGggYWxsIHRoZSBmaWxlcyB0aGF0IGFyZSBpbiB0aGF0CiAgICAvLyAgICAgZm9sZGVyIChyZWN1cnNpdmVseSkuCiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gICAgIDEgb24gc3VjY2Vzcy4KICAgIC8vICAgICAwIG9uIGZhaWx1cmUuCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZGaWxlRGVzY3JFeHBhbmQoJiRwX2ZpbGVkZXNjcl9saXN0LCAmJHBfb3B0aW9ucykKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gQ3JlYXRlIGEgcmVzdWx0IGxpc3QKICAgICAgICAkdl9yZXN1bHRfbGlzdCA9IGFycmF5KCk7CgogICAgICAgIC8vIC0tLS0tIExvb2sgZWFjaCBlbnRyeQogICAgICAgIGZvciAoJGk9MDsgJGk8c2l6ZW9mKCRwX2ZpbGVkZXNjcl9saXN0KTsgJGkrKykgewogICAgICAgICAgICAvLyAtLS0tLSBHZXQgZmlsZWRlc2NyCiAgICAgICAgICAgICR2X2Rlc2NyID0gJHBfZmlsZWRlc2NyX2xpc3RbJGldOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmVkdWNlIHRoZSBmaWxlbmFtZQogICAgICAgICAgICAkdl9kZXNjclsnZmlsZW5hbWUnXSA9IFBjbFppcFV0aWxUcmFuc2xhdGVXaW5QYXRoKCR2X2Rlc2NyWydmaWxlbmFtZSddLCBmYWxzZSk7CiAgICAgICAgICAgICR2X2Rlc2NyWydmaWxlbmFtZSddID0gUGNsWmlwVXRpbFBhdGhSZWR1Y3Rpb24oJHZfZGVzY3JbJ2ZpbGVuYW1lJ10pOwoKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgcmVhbCBmaWxlIG9yIGZvbGRlcgogICAgICAgICAgICBpZiAoZmlsZV9leGlzdHMoJHZfZGVzY3JbJ2ZpbGVuYW1lJ10pKSB7CiAgICAgICAgICAgICAgICBpZiAoQGlzX2ZpbGUoJHZfZGVzY3JbJ2ZpbGVuYW1lJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfZGVzY3JbJ3R5cGUnXSA9ICdmaWxlJzsKICAgICAgICAgICAgICAgIH0gZWxzZWlmIChAaXNfZGlyKCR2X2Rlc2NyWydmaWxlbmFtZSddKSkgewogICAgICAgICAgICAgICAgICAgICR2X2Rlc2NyWyd0eXBlJ10gPSAnZm9sZGVyJzsKICAgICAgICAgICAgICAgIH0gZWxzZWlmIChAaXNfbGluaygkdl9kZXNjclsnZmlsZW5hbWUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBza2lwCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHNraXAKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCR2X2Rlc2NyWydjb250ZW50J10pKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBzdHJpbmcgYWRkZWQgYXMgZmlsZQogICAgICAgICAgICAgICAgJHZfZGVzY3JbJ3R5cGUnXSA9ICd2aXJ0dWFsX2ZpbGUnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gTWlzc2luZyBmaWxlCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfTUlTU0lOR19GSUxFLCAiRmlsZSAnIi4kdl9kZXNjclsnZmlsZW5hbWUnXS4iJyBkb2VzIG5vdCBleGlzdCIpOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIENhbGN1bGF0ZSB0aGUgc3RvcmVkIGZpbGVuYW1lCiAgICAgICAgICAgICR0aGlzLT5wcml2Q2FsY3VsYXRlU3RvcmVkRmlsZW5hbWUoJHZfZGVzY3IsICRwX29wdGlvbnMpOwoKICAgICAgICAgICAgLy8gLS0tLS0gQWRkIHRoZSBkZXNjcmlwdG9yIGluIHJlc3VsdCBsaXN0CiAgICAgICAgICAgICR2X3Jlc3VsdF9saXN0W3NpemVvZigkdl9yZXN1bHRfbGlzdCldID0gJHZfZGVzY3I7CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBmb2xkZXIKICAgICAgICAgICAgaWYgKCR2X2Rlc2NyWyd0eXBlJ10gPT0gJ2ZvbGRlcicpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExpc3Qgb2YgaXRlbXMgaW4gZm9sZGVyCiAgICAgICAgICAgICAgICAkdl9kaXJsaXN0X2Rlc2NyID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICR2X2Rpcmxpc3RfbmIgPSAwOwogICAgICAgICAgICAgICAgaWYgKCR2X2ZvbGRlcl9oYW5kbGVyID0gQG9wZW5kaXIoJHZfZGVzY3JbJ2ZpbGVuYW1lJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCgkdl9pdGVtX2hhbmRsZXIgPSBAcmVhZGRpcigkdl9mb2xkZXJfaGFuZGxlcikpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBTa2lwICcuJyBhbmQgJy4uJwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCR2X2l0ZW1faGFuZGxlciA9PSAnLicpIHx8ICgkdl9pdGVtX2hhbmRsZXIgPT0gJy4uJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ29tcG9zZSB0aGUgZnVsbCBmaWxlbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkdl9kaXJsaXN0X2Rlc2NyWyR2X2Rpcmxpc3RfbmJdWydmaWxlbmFtZSddID0gJHZfZGVzY3JbJ2ZpbGVuYW1lJ10uJy8nLiR2X2l0ZW1faGFuZGxlcjsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGRpZmZlcmVudCBzdG9yZWQgZmlsZW5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmVjYXVzZSB0aGUgbmFtZSBvZiB0aGUgZm9sZGVyIHdhcyBjaGFuZ2VkLCB0aGUgbmFtZSBvZiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlsZXMvc3ViLWZvbGRlcnMgYWxzbyBjaGFuZ2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkdl9kZXNjclsnc3RvcmVkX2ZpbGVuYW1lJ10gIT0gJHZfZGVzY3JbJ2ZpbGVuYW1lJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICghaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1JFTU9WRV9BTExfUEFUSF0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2X2Rlc2NyWydzdG9yZWRfZmlsZW5hbWUnXSAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2X2Rpcmxpc3RfZGVzY3JbJHZfZGlybGlzdF9uYl1bJ25ld19mdWxsX25hbWUnXSA9ICR2X2Rlc2NyWydzdG9yZWRfZmlsZW5hbWUnXS4nLycuJHZfaXRlbV9oYW5kbGVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdl9kaXJsaXN0X2Rlc2NyWyR2X2Rpcmxpc3RfbmJdWyduZXdfZnVsbF9uYW1lJ10gPSAkdl9pdGVtX2hhbmRsZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJHZfZGlybGlzdF9uYisrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgQGNsb3NlZGlyKCR2X2ZvbGRlcl9oYW5kbGVyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVEJDIDogdW5hYmxlIHRvIG9wZW4gZm9sZGVyIGluIHJlYWQgbW9kZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIEV4cGFuZCBlYWNoIGVsZW1lbnQgb2YgdGhlIGxpc3QKICAgICAgICAgICAgICAgIGlmICgkdl9kaXJsaXN0X25iICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFeHBhbmQKICAgICAgICAgICAgICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2RmlsZURlc2NyRXhwYW5kKCR2X2Rpcmxpc3RfZGVzY3IsICRwX29wdGlvbnMpKSAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDb25jYXQgdGhlIHJlc3VsdGluZyBsaXN0CiAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0X2xpc3QgPSBhcnJheV9tZXJnZSgkdl9yZXN1bHRfbGlzdCwgJHZfZGlybGlzdF9kZXNjcik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gRnJlZSBsb2NhbCBhcnJheQogICAgICAgICAgICAgICAgdW5zZXQoJHZfZGlybGlzdF9kZXNjcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEdldCB0aGUgcmVzdWx0IGxpc3QKICAgICAgICAkcF9maWxlZGVzY3JfbGlzdCA9ICR2X3Jlc3VsdF9saXN0OwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2Q3JlYXRlKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZDcmVhdGUoJHBfZmlsZWRlc2NyX2xpc3QsICYkcF9yZXN1bHRfbGlzdCwgJiRwX29wdGlvbnMpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CiAgICAgICAgJHZfbGlzdF9kZXRhaWwgPSBhcnJheSgpOwoKICAgICAgICAvLyAtLS0tLSBNYWdpYyBxdW90ZXMgdHJpY2sKICAgICAgICAkdGhpcy0+cHJpdkRpc2FibGVNYWdpY1F1b3RlcygpOwoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSBmaWxlIGluIHdyaXRlIG1vZGUKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2T3BlbkZkKCd3YicpKSAhPSAxKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQWRkIHRoZSBsaXN0IG9mIGZpbGVzCiAgICAgICAgJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZBZGRMaXN0KCRwX2ZpbGVkZXNjcl9saXN0LCAkcF9yZXN1bHRfbGlzdCwgJHBfb3B0aW9ucyk7CgogICAgICAgIC8vIC0tLS0tIENsb3NlCiAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgIC8vIC0tLS0tIE1hZ2ljIHF1b3RlcyB0cmljawogICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2QWRkKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZBZGQoJHBfZmlsZWRlc2NyX2xpc3QsICYkcF9yZXN1bHRfbGlzdCwgJiRwX29wdGlvbnMpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CiAgICAgICAgJHZfbGlzdF9kZXRhaWwgPSBhcnJheSgpOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSBhcmNoaXZlIGV4aXN0cyBvciBpcyBlbXB0eQogICAgICAgIGlmICgoIWlzX2ZpbGUoJHRoaXMtPnppcG5hbWUpKSB8fCAoZmlsZXNpemUoJHRoaXMtPnppcG5hbWUpID09IDApKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIERvIGEgY3JlYXRlCiAgICAgICAgICAgICR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2Q3JlYXRlKCRwX2ZpbGVkZXNjcl9saXN0LCAkcF9yZXN1bHRfbGlzdCwgJHBfb3B0aW9ucyk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CiAgICAgICAgLy8gLS0tLS0gTWFnaWMgcXVvdGVzIHRyaWNrCiAgICAgICAgJHRoaXMtPnByaXZEaXNhYmxlTWFnaWNRdW90ZXMoKTsKCiAgICAgICAgLy8gLS0tLS0gT3BlbiB0aGUgemlwIGZpbGUKICAgICAgICBpZiAoKCR2X3Jlc3VsdD0kdGhpcy0+cHJpdk9wZW5GZCgncmInKSkgIT0gMSkgewogICAgICAgICAgICAvLyAtLS0tLSBNYWdpYyBxdW90ZXMgdHJpY2sKICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGNlbnRyYWwgZGlyZWN0b3J5IGluZm9ybWF0aW9ucwogICAgICAgICR2X2NlbnRyYWxfZGlyID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2UmVhZEVuZENlbnRyYWxEaXIoJHZfY2VudHJhbF9kaXIpKSAhPSAxKSB7CiAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEdvIHRvIGJlZ2lubmluZyBvZiBGaWxlCiAgICAgICAgQHJld2luZCgkdGhpcy0+emlwX2ZkKTsKCiAgICAgICAgLy8gLS0tLS0gQ3JlYXRlcyBhIHRlbXBvcmF5IGZpbGUKICAgICAgICAkdl96aXBfdGVtcF9uYW1lID0gUENMWklQX1RFTVBPUkFSWV9ESVIudW5pcWlkKCdwY2x6aXAtJykuJy50bXAnOwoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSB0ZW1wb3JhcnkgZmlsZSBpbiB3cml0ZSBtb2RlCiAgICAgICAgaWYgKCgkdl96aXBfdGVtcF9mZCA9IEBmb3Blbigkdl96aXBfdGVtcF9uYW1lLCAnd2InKSkgPT0gMCkgewogICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CgogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX1JFQURfT1BFTl9GQUlMLCAnVW5hYmxlIHRvIG9wZW4gdGVtcG9yYXJ5IGZpbGUgXCcnLiR2X3ppcF90ZW1wX25hbWUuJ1wnIGluIGJpbmFyeSB3cml0ZSBtb2RlJyk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDb3B5IHRoZSBmaWxlcyBmcm9tIHRoZSBhcmNoaXZlIHRvIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIC8vIFRCQyA6IEhlcmUgSSBzaG91bGQgYmV0dGVyIGFwcGVuZCB0aGUgZmlsZSBhbmQgZ28gYmFjayB0byBlcmFzZSB0aGUgY2VudHJhbCBkaXIKICAgICAgICAkdl9zaXplID0gJHZfY2VudHJhbF9kaXJbJ29mZnNldCddOwogICAgICAgIHdoaWxlICgkdl9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCR2X3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHZfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBmcmVhZCgkdGhpcy0+emlwX2ZkLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICBAZndyaXRlKCR2X3ppcF90ZW1wX2ZkLCAkdl9idWZmZXIsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgICR2X3NpemUgLT0gJHZfcmVhZF9zaXplOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gU3dhcCB0aGUgZmlsZSBkZXNjcmlwdG9yCiAgICAgICAgLy8gSGVyZSBpcyBhIHRyaWNrIDogSSBzd2FwIHRoZSB0ZW1wb3JhcnkgZmQgd2l0aCB0aGUgemlwIGZkLCBpbiBvcmRlciB0byB1c2UKICAgICAgICAvLyB0aGUgZm9sbG93aW5nIG1ldGhvZHMgb24gdGhlIHRlbXBvcmFyeSBmaWwgYW5kIG5vdCB0aGUgcmVhbCBhcmNoaXZlCiAgICAgICAgJHZfc3dhcCA9ICR0aGlzLT56aXBfZmQ7CiAgICAgICAgJHRoaXMtPnppcF9mZCA9ICR2X3ppcF90ZW1wX2ZkOwogICAgICAgICR2X3ppcF90ZW1wX2ZkID0gJHZfc3dhcDsKCiAgICAgICAgLy8gLS0tLS0gQWRkIHRoZSBmaWxlcwogICAgICAgICR2X2hlYWRlcl9saXN0ID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2QWRkRmlsZUxpc3QoJHBfZmlsZWRlc2NyX2xpc3QsICR2X2hlYWRlcl9saXN0LCAkcF9vcHRpb25zKSkgIT0gMSkgewogICAgICAgICAgICBmY2xvc2UoJHZfemlwX3RlbXBfZmQpOwogICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgQHVubGluaygkdl96aXBfdGVtcF9uYW1lKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFN0b3JlIHRoZSBvZmZzZXQgb2YgdGhlIGNlbnRyYWwgZGlyCiAgICAgICAgJHZfb2Zmc2V0ID0gQGZ0ZWxsKCR0aGlzLT56aXBfZmQpOwoKICAgICAgICAvLyAtLS0tLSBDb3B5IHRoZSBibG9jayBvZiBmaWxlIGhlYWRlcnMgZnJvbSB0aGUgb2xkIGFyY2hpdmUKICAgICAgICAkdl9zaXplID0gJHZfY2VudHJhbF9kaXJbJ3NpemUnXTsKICAgICAgICB3aGlsZSAoJHZfc2l6ZSAhPSAwKSB7CiAgICAgICAgICAgICR2X3JlYWRfc2l6ZSA9ICgkdl9zaXplIDwgUENMWklQX1JFQURfQkxPQ0tfU0laRSA\/ICR2X3NpemUgOiBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFKTsKICAgICAgICAgICAgJHZfYnVmZmVyID0gQGZyZWFkKCR2X3ppcF90ZW1wX2ZkLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICBAZndyaXRlKCR0aGlzLT56aXBfZmQsICR2X2J1ZmZlciwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgJHZfc2l6ZSAtPSAkdl9yZWFkX3NpemU7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDcmVhdGUgdGhlIENlbnRyYWwgRGlyIGZpbGVzIGhlYWRlcgogICAgICAgIGZvciAoJGk9MCwgJHZfY291bnQ9MDsgJGk8c2l6ZW9mKCR2X2hlYWRlcl9saXN0KTsgJGkrKykgewogICAgICAgICAgICAvLyAtLS0tLSBDcmVhdGUgdGhlIGZpbGUgaGVhZGVyCiAgICAgICAgICAgIGlmICgkdl9oZWFkZXJfbGlzdFskaV1bJ3N0YXR1cyddID09ICdvaycpIHsKICAgICAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZXcml0ZUNlbnRyYWxGaWxlSGVhZGVyKCR2X2hlYWRlcl9saXN0WyRpXSkpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICBmY2xvc2UoJHZfemlwX3RlbXBfZmQpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHZfemlwX3RlbXBfbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdl9jb3VudCsrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBUcmFuc2Zvcm0gdGhlIGhlYWRlciB0byBhICd1c2FibGUnIGluZm8KICAgICAgICAgICAgJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCR2X2hlYWRlcl9saXN0WyRpXSwgJHBfcmVzdWx0X2xpc3RbJGldKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFppcCBmaWxlIGNvbW1lbnQKICAgICAgICAkdl9jb21tZW50ID0gJHZfY2VudHJhbF9kaXJbJ2NvbW1lbnQnXTsKICAgICAgICBpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0NPTU1FTlRdKSkgewogICAgICAgICAgICAkdl9jb21tZW50ID0gJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0NPTU1FTlRdOwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0FERF9DT01NRU5UXSkpIHsKICAgICAgICAgICAgJHZfY29tbWVudCA9ICR2X2NvbW1lbnQuJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0FERF9DT01NRU5UXTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9QUkVQRU5EX0NPTU1FTlRdKSkgewogICAgICAgICAgICAkdl9jb21tZW50ID0gJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1BSRVBFTkRfQ09NTUVOVF0uJHZfY29tbWVudDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENhbGN1bGF0ZSB0aGUgc2l6ZSBvZiB0aGUgY2VudHJhbCBoZWFkZXIKICAgICAgICAkdl9zaXplID0gQGZ0ZWxsKCR0aGlzLT56aXBfZmQpLSR2X29mZnNldDsKCiAgICAgICAgLy8gLS0tLS0gQ3JlYXRlIHRoZSBjZW50cmFsIGRpciBmb290ZXIKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2V3JpdGVDZW50cmFsSGVhZGVyKCR2X2NvdW50KyR2X2NlbnRyYWxfZGlyWydlbnRyaWVzJ10sICR2X3NpemUsICR2X29mZnNldCwgJHZfY29tbWVudCkpICE9IDEpIHsKICAgICAgICAgICAgLy8gLS0tLS0gUmVzZXQgdGhlIGZpbGUgbGlzdAogICAgICAgICAgICB1bnNldCgkdl9oZWFkZXJfbGlzdCk7CiAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBTd2FwIGJhY2sgdGhlIGZpbGUgZGVzY3JpcHRvcgogICAgICAgICR2X3N3YXAgPSAkdGhpcy0+emlwX2ZkOwogICAgICAgICR0aGlzLT56aXBfZmQgPSAkdl96aXBfdGVtcF9mZDsKICAgICAgICAkdl96aXBfdGVtcF9mZCA9ICR2X3N3YXA7CgogICAgICAgIC8vIC0tLS0tIENsb3NlCiAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIEBmY2xvc2UoJHZfemlwX3RlbXBfZmQpOwoKICAgICAgICAvLyAtLS0tLSBNYWdpYyBxdW90ZXMgdHJpY2sKICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKCiAgICAgICAgLy8gLS0tLS0gRGVsZXRlIHRoZSB6aXAgZmlsZQogICAgICAgIC8vIFRCQyA6IEkgc2hvdWxkIHRlc3QgdGhlIHJlc3VsdCAuLi4KICAgICAgICBAdW5saW5rKCR0aGlzLT56aXBuYW1lKTsKCiAgICAgICAgLy8gLS0tLS0gUmVuYW1lIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIC8vIFRCQyA6IEkgc2hvdWxkIHRlc3QgdGhlIHJlc3VsdCAuLi4KICAgICAgICAvL0ByZW5hbWUoJHZfemlwX3RlbXBfbmFtZSwgJHRoaXMtPnppcG5hbWUpOwogICAgICAgIFBjbFppcFV0aWxSZW5hbWUoJHZfemlwX3RlbXBfbmFtZSwgJHRoaXMtPnppcG5hbWUpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2T3BlbkZkKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2T3BlbkZkKCRwX21vZGUpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CgogICAgICAgIC8vIC0tLS0tIExvb2sgaWYgYWxyZWFkeSBvcGVuCiAgICAgICAgaWYgKCR0aGlzLT56aXBfZmQgIT0gMCkgewogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9SRUFEX09QRU5fRkFJTCwgJ1ppcCBmaWxlIFwnJy4kdGhpcy0+emlwbmFtZS4nXCcgYWxyZWFkeSBvcGVuJyk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSB6aXAgZmlsZQogICAgICAgIGlmICgoJHRoaXMtPnppcF9mZCA9IEBmb3BlbigkdGhpcy0+emlwbmFtZSwgJHBfbW9kZSkpID09IDApIHsKICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfUkVBRF9PUEVOX0ZBSUwsICdVbmFibGUgdG8gb3BlbiBhcmNoaXZlIFwnJy4kdGhpcy0+emlwbmFtZS4nXCcgaW4gJy4kcF9tb2RlLicgbW9kZScpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkNsb3NlRmQoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZDbG9zZUZkKCkKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgaWYgKCR0aGlzLT56aXBfZmQgIT0gMCkgewogICAgICAgICAgICBAZmNsb3NlKCR0aGlzLT56aXBfZmQpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+emlwX2ZkID0gMDsKCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkFkZExpc3QoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgICRwX2FkZF9kaXIgYW5kICRwX3JlbW92ZV9kaXIgd2lsbCBnaXZlIHRoZSBhYmlsaXR5IHRvIG1lbW9yaXplIGEgcGF0aCB3aGljaCBpcwogICAgLy8gICAgIGRpZmZlcmVudCBmcm9tIHRoZSByZWFsIHBhdGggb2YgdGhlIGZpbGUuIFRoaXMgaXMgdXNlZnVsbCBpZiB5b3Ugd2FudCB0byBoYXZlIFBjbFRhcgogICAgLy8gICAgIHJ1bm5pbmcgaW4gYW55IGRpcmVjdG9yeSwgYW5kIG1lbW9yaXplIHJlbGF0aXZlIHBhdGggZnJvbSBhbiBvdGhlciBkaXJlY3RvcnkuCiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vICAgICAkcF9saXN0IDogQW4gYXJyYXkgY29udGFpbmluZyB0aGUgZmlsZSBvciBkaXJlY3RvcnkgbmFtZXMgdG8gYWRkIGluIHRoZSB0YXIKICAgIC8vICAgICAkcF9yZXN1bHRfbGlzdCA6IGxpc3Qgb2YgYWRkZWQgZmlsZXMgd2l0aCB0aGVpciBwcm9wZXJ0aWVzIChzcGVjaWFsbHkgdGhlIHN0YXR1cyBmaWVsZCkKICAgIC8vICAgICAkcF9hZGRfZGlyIDogUGF0aCB0byBhZGQgaW4gdGhlIGZpbGVuYW1lIHBhdGggYXJjaGl2ZWQKICAgIC8vICAgICAkcF9yZW1vdmVfZGlyIDogUGF0aCB0byByZW1vdmUgaW4gdGhlIGZpbGVuYW1lIHBhdGggYXJjaGl2ZWQKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2QWRkTGlzdCgkcF9saXN0LCAmJHBfcmVzdWx0X2xpc3QsICRwX2FkZF9kaXIsICRwX3JlbW92ZV9kaXIsICRwX3JlbW92ZV9hbGxfZGlyLCAmJHBfb3B0aW9ucykKICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2QWRkTGlzdCgkcF9maWxlZGVzY3JfbGlzdCwgJiRwX3Jlc3VsdF9saXN0LCAmJHBfb3B0aW9ucykKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gQWRkIHRoZSBmaWxlcwogICAgICAgICR2X2hlYWRlcl9saXN0ID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2QWRkRmlsZUxpc3QoJHBfZmlsZWRlc2NyX2xpc3QsICR2X2hlYWRlcl9saXN0LCAkcF9vcHRpb25zKSkgIT0gMSkgewogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFN0b3JlIHRoZSBvZmZzZXQgb2YgdGhlIGNlbnRyYWwgZGlyCiAgICAgICAgJHZfb2Zmc2V0ID0gQGZ0ZWxsKCR0aGlzLT56aXBfZmQpOwoKICAgICAgICAvLyAtLS0tLSBDcmVhdGUgdGhlIENlbnRyYWwgRGlyIGZpbGVzIGhlYWRlcgogICAgICAgIGZvciAoJGk9MCwgJHZfY291bnQ9MDsgJGk8c2l6ZW9mKCR2X2hlYWRlcl9saXN0KTsgJGkrKykgewogICAgICAgICAgICAvLyAtLS0tLSBDcmVhdGUgdGhlIGZpbGUgaGVhZGVyCiAgICAgICAgICAgIGlmICgkdl9oZWFkZXJfbGlzdFskaV1bJ3N0YXR1cyddID09ICdvaycpIHsKICAgICAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZXcml0ZUNlbnRyYWxGaWxlSGVhZGVyKCR2X2hlYWRlcl9saXN0WyRpXSkpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHZfY291bnQrKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gVHJhbnNmb3JtIHRoZSBoZWFkZXIgdG8gYSAndXNhYmxlJyBpbmZvCiAgICAgICAgICAgICR0aGlzLT5wcml2Q29udmVydEhlYWRlcjJGaWxlSW5mbygkdl9oZWFkZXJfbGlzdFskaV0sICRwX3Jlc3VsdF9saXN0WyRpXSk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBaaXAgZmlsZSBjb21tZW50CiAgICAgICAgJHZfY29tbWVudCA9ICcnOwogICAgICAgIGlmIChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfQ09NTUVOVF0pKSB7CiAgICAgICAgICAgICR2X2NvbW1lbnQgPSAkcF9vcHRpb25zW1BDTFpJUF9PUFRfQ09NTUVOVF07CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDYWxjdWxhdGUgdGhlIHNpemUgb2YgdGhlIGNlbnRyYWwgaGVhZGVyCiAgICAgICAgJHZfc2l6ZSA9IEBmdGVsbCgkdGhpcy0+emlwX2ZkKS0kdl9vZmZzZXQ7CgogICAgICAgIC8vIC0tLS0tIENyZWF0ZSB0aGUgY2VudHJhbCBkaXIgZm9vdGVyCiAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdldyaXRlQ2VudHJhbEhlYWRlcigkdl9jb3VudCwgJHZfc2l6ZSwgJHZfb2Zmc2V0LCAkdl9jb21tZW50KSkgIT0gMSkgewogICAgICAgICAgICAvLyAtLS0tLSBSZXNldCB0aGUgZmlsZSBsaXN0CiAgICAgICAgICAgIHVuc2V0KCR2X2hlYWRlcl9saXN0KTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkFkZEZpbGVMaXN0KCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX2ZpbGVkZXNjcl9saXN0IDogQW4gYXJyYXkgY29udGFpbmluZyB0aGUgZmlsZSBkZXNjcmlwdGlvbgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGRpcmVjdG9yeSBuYW1lcyB0byBhZGQgaW4gdGhlIHppcAogICAgLy8gICAgICRwX3Jlc3VsdF9saXN0IDogbGlzdCBvZiBhZGRlZCBmaWxlcyB3aXRoIHRoZWlyIHByb3BlcnRpZXMgKHNwZWNpYWxseSB0aGUgc3RhdHVzIGZpZWxkKQogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZBZGRGaWxlTGlzdCgkcF9maWxlZGVzY3JfbGlzdCwgJiRwX3Jlc3VsdF9saXN0LCAmJHBfb3B0aW9ucykKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKICAgICAgICAkdl9oZWFkZXIgPSBhcnJheSgpOwoKICAgICAgICAvLyAtLS0tLSBSZWN1cGVyYXRlIHRoZSBjdXJyZW50IG51bWJlciBvZiBlbHQgaW4gbGlzdAogICAgICAgICR2X25iID0gc2l6ZW9mKCRwX3Jlc3VsdF9saXN0KTsKCiAgICAgICAgLy8gLS0tLS0gTG9vcCBvbiB0aGUgZmlsZXMKICAgICAgICBmb3IgKCRqPTA7ICgkajxzaXplb2YoJHBfZmlsZWRlc2NyX2xpc3QpKSAmJiAoJHZfcmVzdWx0PT0xKTsgJGorKykgewogICAgICAgICAgICAvLyAtLS0tLSBGb3JtYXQgdGhlIGZpbGVuYW1lCiAgICAgICAgICAgICRwX2ZpbGVkZXNjcl9saXN0WyRqXVsnZmlsZW5hbWUnXSA9IFBjbFppcFV0aWxUcmFuc2xhdGVXaW5QYXRoKCRwX2ZpbGVkZXNjcl9saXN0WyRqXVsnZmlsZW5hbWUnXSwgZmFsc2UpOwoKICAgICAgICAgICAgLy8gLS0tLS0gU2tpcCBlbXB0eSBmaWxlIG5hbWVzCiAgICAgICAgICAgIC8vIFRCQyA6IENhbiB0aGlzIGJlIHBvc3NpYmxlID8gbm90IGNoZWNrZWQgaW4gRGVzY3JQYXJzZUF0dCA\/CiAgICAgICAgICAgIGlmICgkcF9maWxlZGVzY3JfbGlzdFskal1bJ2ZpbGVuYW1lJ10gPT0gIiIpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGUgZmlsZW5hbWUKICAgICAgICAgICAgaWYgKCgkcF9maWxlZGVzY3JfbGlzdFskal1bJ3R5cGUnXSAhPSAndmlydHVhbF9maWxlJykgJiYgKCFmaWxlX2V4aXN0cygkcF9maWxlZGVzY3JfbGlzdFskal1bJ2ZpbGVuYW1lJ10pKSkgewogICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9NSVNTSU5HX0ZJTEUsICJGaWxlICciLiRwX2ZpbGVkZXNjcl9saXN0WyRqXVsnZmlsZW5hbWUnXS4iJyBkb2VzIG5vdCBleGlzdCIpOwogICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgaWYgaXQgaXMgYSBmaWxlIG9yIGEgZGlyIHdpdGggbm8gYWxsIHBhdGggcmVtb3ZlIG9wdGlvbgogICAgICAgICAgICAvLyBvciBhIGRpciB3aXRoIGFsbCBpdHMgcGF0aCByZW1vdmVkCiAgICAvLyAgICAgICAgICAgIGlmICggICAgKGlzX2ZpbGUoJHBfZmlsZWRlc2NyX2xpc3RbJGpdWydmaWxlbmFtZSddKSkKICAgIC8vICAgICAgICAgICAgICAgICAgICB8fCAoICAgIGlzX2RpcigkcF9maWxlZGVzY3JfbGlzdFskal1bJ2ZpbGVuYW1lJ10pCiAgICAgICAgICAgIGlmICgoJHBfZmlsZWRlc2NyX2xpc3RbJGpdWyd0eXBlJ10gPT0gJ2ZpbGUnKSB8fCAoJHBfZmlsZWRlc2NyX2xpc3RbJGpdWyd0eXBlJ10gPT0gJ3ZpcnR1YWxfZmlsZScpIHx8ICgoJHBfZmlsZWRlc2NyX2xpc3RbJGpdWyd0eXBlJ10gPT0gJ2ZvbGRlcicpICYmICghaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1JFTU9WRV9BTExfUEFUSF0pIHx8ICEkcF9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX0FMTF9QQVRIXSkpKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBBZGQgdGhlIGZpbGUKICAgICAgICAgICAgICAgICR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2QWRkRmlsZSgkcF9maWxlZGVzY3JfbGlzdFskal0sICR2X2hlYWRlciwgJHBfb3B0aW9ucyk7CiAgICAgICAgICAgICAgICBpZiAoJHZfcmVzdWx0ICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFN0b3JlIHRoZSBmaWxlIGluZm9zCiAgICAgICAgICAgICAgICAkcF9yZXN1bHRfbGlzdFskdl9uYisrXSA9ICR2X2hlYWRlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkFkZEZpbGUoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdkFkZEZpbGUoJHBfZmlsZWRlc2NyLCAmJHBfaGVhZGVyLCAmJHBfb3B0aW9ucykKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gV29ya2luZyB2YXJpYWJsZQogICAgICAgICRwX2ZpbGVuYW1lID0gJHBfZmlsZWRlc2NyWydmaWxlbmFtZSddOwoKICAgICAgICAvLyBUQkMgOiBBbHJlYWR5IGRvbmUgaW4gdGhlIGZpbGVBdHQgY2hlY2sgLi4uID8KICAgICAgICBpZiAoJHBfZmlsZW5hbWUgPT0gIiIpIHsKICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9QQVJBTUVURVIsICJJbnZhbGlkIGZpbGUgbGlzdCBwYXJhbWV0ZXIgKGludmFsaWQgb3IgZW1wdHkgbGlzdCkiKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGEgc3RvcmVkIGRpZmZlcmVudCBmaWxlbmFtZQogICAgICAgIC8qIFRCQyA6IFJlbW92ZWQKICAgICAgICBpZiAoaXNzZXQoJHBfZmlsZWRlc2NyWydzdG9yZWRfZmlsZW5hbWUnXSkpIHsKICAgICAgICAgICAgJHZfc3RvcmVkX2ZpbGVuYW1lID0gJHBfZmlsZWRlc2NyWydzdG9yZWRfZmlsZW5hbWUnXTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR2X3N0b3JlZF9maWxlbmFtZSA9ICRwX2ZpbGVkZXNjclsnc3RvcmVkX2ZpbGVuYW1lJ107CiAgICAgICAgfQogICAgICAgICovCgogICAgICAgIC8vIC0tLS0tIFNldCB0aGUgZmlsZSBwcm9wZXJ0aWVzCiAgICAgICAgY2xlYXJzdGF0Y2FjaGUoKTsKICAgICAgICAkcF9oZWFkZXJbJ3ZlcnNpb24nXSA9IDIwOwogICAgICAgICRwX2hlYWRlclsndmVyc2lvbl9leHRyYWN0ZWQnXSA9IDEwOwogICAgICAgICRwX2hlYWRlclsnZmxhZyddID0gMDsKICAgICAgICAkcF9oZWFkZXJbJ2NvbXByZXNzaW9uJ10gPSAwOwogICAgICAgICRwX2hlYWRlclsnY3JjJ10gPSAwOwogICAgICAgICRwX2hlYWRlclsnY29tcHJlc3NlZF9zaXplJ10gPSAwOwogICAgICAgICRwX2hlYWRlclsnZmlsZW5hbWVfbGVuJ10gPSBzdHJsZW4oJHBfZmlsZW5hbWUpOwogICAgICAgICRwX2hlYWRlclsnZXh0cmFfbGVuJ10gPSAwOwogICAgICAgICRwX2hlYWRlclsnZGlzayddID0gMDsKICAgICAgICAkcF9oZWFkZXJbJ2ludGVybmFsJ10gPSAwOwogICAgICAgICRwX2hlYWRlclsnb2Zmc2V0J10gPSAwOwogICAgICAgICRwX2hlYWRlclsnZmlsZW5hbWUnXSA9ICRwX2ZpbGVuYW1lOwogICAgLy8gVEJDIDogUmVtb3ZlZCAgICAgICAgJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSA9ICR2X3N0b3JlZF9maWxlbmFtZTsKICAgICAgICAkcF9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddID0gJHBfZmlsZWRlc2NyWydzdG9yZWRfZmlsZW5hbWUnXTsKICAgICAgICAkcF9oZWFkZXJbJ2V4dHJhJ10gPSAnJzsKICAgICAgICAkcF9oZWFkZXJbJ3N0YXR1cyddID0gJ29rJzsKICAgICAgICAkcF9oZWFkZXJbJ2luZGV4J10gPSAtMTsKCiAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgcmVndWxhciBmaWxlCiAgICAgICAgaWYgKCRwX2ZpbGVkZXNjclsndHlwZSddPT0nZmlsZScpIHsKICAgICAgICAgICAgJHBfaGVhZGVyWydleHRlcm5hbCddID0gMHgwMDAwMDAwMDsKICAgICAgICAgICAgJHBfaGVhZGVyWydzaXplJ10gPSBmaWxlc2l6ZSgkcF9maWxlbmFtZSk7CiAgICAgICAgfSBlbHNlaWYgKCRwX2ZpbGVkZXNjclsndHlwZSddPT0nZm9sZGVyJykgewogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciByZWd1bGFyIGZvbGRlcgogICAgICAgICAgICAkcF9oZWFkZXJbJ2V4dGVybmFsJ10gPSAweDAwMDAwMDEwOwogICAgICAgICAgICAkcF9oZWFkZXJbJ210aW1lJ10gPSBmaWxlbXRpbWUoJHBfZmlsZW5hbWUpOwogICAgICAgICAgICAkcF9oZWFkZXJbJ3NpemUnXSA9IGZpbGVzaXplKCRwX2ZpbGVuYW1lKTsKICAgICAgICB9IGVsc2VpZiAoJHBfZmlsZWRlc2NyWyd0eXBlJ10gPT0gJ3ZpcnR1YWxfZmlsZScpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdmlydHVhbCBmaWxlCiAgICAgICAgICAgICRwX2hlYWRlclsnZXh0ZXJuYWwnXSA9IDB4MDAwMDAwMDA7CiAgICAgICAgICAgICRwX2hlYWRlclsnc2l6ZSddID0gc3RybGVuKCRwX2ZpbGVkZXNjclsnY29udGVudCddKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGZpbGV0aW1lCiAgICAgICAgaWYgKGlzc2V0KCRwX2ZpbGVkZXNjclsnbXRpbWUnXSkpIHsKICAgICAgICAgICAgJHBfaGVhZGVyWydtdGltZSddID0gJHBfZmlsZWRlc2NyWydtdGltZSddOwogICAgICAgIH0gZWxzZWlmICgkcF9maWxlZGVzY3JbJ3R5cGUnXSA9PSAndmlydHVhbF9maWxlJykgewogICAgICAgICAgICAkcF9oZWFkZXJbJ210aW1lJ10gPSB0aW1lKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHBfaGVhZGVyWydtdGltZSddID0gZmlsZW10aW1lKCRwX2ZpbGVuYW1lKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tLSBMb29rIGZvciBmaWxlIGNvbW1lbnQKICAgICAgICBpZiAoaXNzZXQoJHBfZmlsZWRlc2NyWydjb21tZW50J10pKSB7CiAgICAgICAgICAgICRwX2hlYWRlclsnY29tbWVudF9sZW4nXSA9IHN0cmxlbigkcF9maWxlZGVzY3JbJ2NvbW1lbnQnXSk7CiAgICAgICAgICAgICRwX2hlYWRlclsnY29tbWVudCddID0gJHBfZmlsZWRlc2NyWydjb21tZW50J107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHBfaGVhZGVyWydjb21tZW50X2xlbiddID0gMDsKICAgICAgICAgICAgJHBfaGVhZGVyWydjb21tZW50J10gPSAnJzsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHByZS1hZGQgY2FsbGJhY2sKICAgICAgICBpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfQ0JfUFJFX0FERF0pKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEdlbmVyYXRlIGEgbG9jYWwgaW5mb3JtYXRpb24KICAgICAgICAgICAgJHZfbG9jYWxfaGVhZGVyID0gYXJyYXkoKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCRwX2hlYWRlciwgJHZfbG9jYWxfaGVhZGVyKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIENhbGwgdGhlIGNhbGxiYWNrCiAgICAgICAgICAgIC8vIEhlcmUgSSBkbyBub3QgdXNlIGNhbGxfdXNlcl9mdW5jKCkgYmVjYXVzZSBJIG5lZWQgdG8gc2VuZCBhIHJlZmVyZW5jZSB0byB0aGUKICAgICAgICAgICAgLy8gaGVhZGVyLgogICAgLy8gICAgICAgICAgICBldmFsKCckdl9yZXN1bHQgPSAnLiRwX29wdGlvbnNbUENMWklQX0NCX1BSRV9BRERdLicoUENMWklQX0NCX1BSRV9BREQsICR2X2xvY2FsX2hlYWRlcik7Jyk7CiAgICAgICAgICAgICR2X3Jlc3VsdCA9ICRwX29wdGlvbnNbUENMWklQX0NCX1BSRV9BRERdKFBDTFpJUF9DQl9QUkVfQURELCAkdl9sb2NhbF9oZWFkZXIpOwogICAgICAgICAgICBpZiAoJHZfcmVzdWx0ID09IDApIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoYW5nZSB0aGUgZmlsZSBzdGF0dXMKICAgICAgICAgICAgICAgICRwX2hlYWRlclsnc3RhdHVzJ10gPSAic2tpcHBlZCI7CiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBVcGRhdGUgdGhlIGluZm9ybWF0aW9ucwogICAgICAgICAgICAvLyBPbmx5IHNvbWUgZmllbGRzIGNhbiBiZSBtb2RpZmllZAogICAgICAgICAgICBpZiAoJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSAhPSAkdl9sb2NhbF9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddKSB7CiAgICAgICAgICAgICAgICAkcF9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddID0gUGNsWmlwVXRpbFBhdGhSZWR1Y3Rpb24oJHZfbG9jYWxfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGVtcHR5IHN0b3JlZCBmaWxlbmFtZQogICAgICAgIGlmICgkcF9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddID09ICIiKSB7CiAgICAgICAgICAgICRwX2hlYWRlclsnc3RhdHVzJ10gPSAiZmlsdGVyZWQiOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIHBhdGggbGVuZ3RoCiAgICAgICAgaWYgKHN0cmxlbigkcF9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddKSA+IDB4RkYpIHsKICAgICAgICAgICAgJHBfaGVhZGVyWydzdGF0dXMnXSA9ICdmaWxlbmFtZV90b29fbG9uZyc7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIG5vIGVycm9yLCBvciBmaWxlIG5vdCBza2lwcGVkCiAgICAgICAgaWYgKCRwX2hlYWRlclsnc3RhdHVzJ10gPT0gJ29rJykgewogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhIGZpbGUKICAgICAgICAgICAgaWYgKCRwX2ZpbGVkZXNjclsndHlwZSddID09ICdmaWxlJykgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdXNpbmcgdGVtcG9yYXJ5IGZpbGUgdG8gemlwCiAgICAgICAgICAgICAgICBpZiAoKCFpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX09GRl0pKSAmJiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1RFTVBfRklMRV9PTl0pIHx8IChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX1RIUkVTSE9MRF0pICYmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX1RIUkVTSE9MRF0gPD0gJHBfaGVhZGVyWydzaXplJ10pKSkpIHsKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkFkZEZpbGVVc2luZ1RlbXBGaWxlKCRwX2ZpbGVkZXNjciwgJHBfaGVhZGVyLCAkcF9vcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHZfcmVzdWx0IDwgUENMWklQX0VSUl9OT19FUlJPUikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gVXNlICJpbiBtZW1vcnkiIHppcCBhbGdvCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gT3BlbiB0aGUgc291cmNlIGZpbGUKICAgICAgICAgICAgICAgICAgICBpZiAoKCR2X2ZpbGUgPSBAZm9wZW4oJHBfZmlsZW5hbWUsICJyYiIpKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfUkVBRF9PUEVOX0ZBSUwsICJVbmFibGUgdG8gb3BlbiBmaWxlICckcF9maWxlbmFtZScgaW4gYmluYXJ5IHJlYWQgbW9kZSIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGZpbGUgY29udGVudAogICAgICAgICAgICAgICAgICAgICR2X2NvbnRlbnQgPSBAZnJlYWQoJHZfZmlsZSwgJHBfaGVhZGVyWydzaXplJ10pOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgZmlsZQogICAgICAgICAgICAgICAgICAgIEBmY2xvc2UoJHZfZmlsZSk7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENhbGN1bGF0ZSB0aGUgQ1JDCiAgICAgICAgICAgICAgICAgICAgJHBfaGVhZGVyWydjcmMnXSA9IEBjcmMzMigkdl9jb250ZW50KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igbm8gY29tcHJlc3Npb24KICAgICAgICAgICAgICAgICAgICBpZiAoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX05PX0NPTVBSRVNTSU9OXSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBTZXQgaGVhZGVyIHBhcmFtZXRlcnMKICAgICAgICAgICAgICAgICAgICAgICAgJHBfaGVhZGVyWydjb21wcmVzc2VkX3NpemUnXSA9ICRwX2hlYWRlclsnc2l6ZSddOwogICAgICAgICAgICAgICAgICAgICAgICAkcF9oZWFkZXJbJ2NvbXByZXNzaW9uJ10gPSAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG5vcm1hbCBjb21wcmVzc2lvbgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDb21wcmVzcyB0aGUgY29udGVudAogICAgICAgICAgICAgICAgICAgICAgICAkdl9jb250ZW50ID0gQGd6ZGVmbGF0ZSgkdl9jb250ZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFNldCBoZWFkZXIgcGFyYW1ldGVycwogICAgICAgICAgICAgICAgICAgICAgICAkcF9oZWFkZXJbJ2NvbXByZXNzZWRfc2l6ZSddID0gc3RybGVuKCR2X2NvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAkcF9oZWFkZXJbJ2NvbXByZXNzaW9uJ10gPSA4OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgaGVhZGVyIGdlbmVyYXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2V3JpdGVGaWxlSGVhZGVyKCRwX2hlYWRlcikpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQGZjbG9zZSgkdl9maWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFdyaXRlIHRoZSBjb21wcmVzc2VkIChvciBub3QpIGNvbnRlbnQKICAgICAgICAgICAgICAgICAgICBAZndyaXRlKCR0aGlzLT56aXBfZmQsICR2X2NvbnRlbnQsICRwX2hlYWRlclsnY29tcHJlc3NlZF9zaXplJ10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoJHBfZmlsZWRlc2NyWyd0eXBlJ10gPT0gJ3ZpcnR1YWxfZmlsZScpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGEgdmlydHVhbCBmaWxlIChhIGZpbGUgZnJvbSBzdHJpbmcpCiAgICAgICAgICAgICAgICAkdl9jb250ZW50ID0gJHBfZmlsZWRlc2NyWydjb250ZW50J107CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2FsY3VsYXRlIHRoZSBDUkMKICAgICAgICAgICAgICAgICRwX2hlYWRlclsnY3JjJ10gPSBAY3JjMzIoJHZfY29udGVudCk7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igbm8gY29tcHJlc3Npb24KICAgICAgICAgICAgICAgIGlmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfTk9fQ09NUFJFU1NJT05dKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gU2V0IGhlYWRlciBwYXJhbWV0ZXJzCiAgICAgICAgICAgICAgICAgICAgJHBfaGVhZGVyWydjb21wcmVzc2VkX3NpemUnXSA9ICRwX2hlYWRlclsnc2l6ZSddOwogICAgICAgICAgICAgICAgICAgICRwX2hlYWRlclsnY29tcHJlc3Npb24nXSA9IDA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG5vcm1hbCBjb21wcmVzc2lvbgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENvbXByZXNzIHRoZSBjb250ZW50CiAgICAgICAgICAgICAgICAgICAgJHZfY29udGVudCA9IEBnemRlZmxhdGUoJHZfY29udGVudCk7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFNldCBoZWFkZXIgcGFyYW1ldGVycwogICAgICAgICAgICAgICAgICAgICRwX2hlYWRlclsnY29tcHJlc3NlZF9zaXplJ10gPSBzdHJsZW4oJHZfY29udGVudCk7CiAgICAgICAgICAgICAgICAgICAgJHBfaGVhZGVyWydjb21wcmVzc2lvbiddID0gODsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBDYWxsIHRoZSBoZWFkZXIgZ2VuZXJhdGlvbgogICAgICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdldyaXRlRmlsZUhlYWRlcigkcF9oZWFkZXIpKSAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgQGZjbG9zZSgkdl9maWxlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFdyaXRlIHRoZSBjb21wcmVzc2VkIChvciBub3QpIGNvbnRlbnQKICAgICAgICAgICAgICAgIEBmd3JpdGUoJHRoaXMtPnppcF9mZCwgJHZfY29udGVudCwgJHBfaGVhZGVyWydjb21wcmVzc2VkX3NpemUnXSk7CiAgICAgICAgICAgIH0gZWxzZWlmICgkcF9maWxlZGVzY3JbJ3R5cGUnXSA9PSAnZm9sZGVyJykgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgYSBkaXJlY3RvcnkKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGRpcmVjdG9yeSBsYXN0ICcvJwogICAgICAgICAgICAgICAgaWYgKEBzdWJzdHIoJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSwgLTEpICE9ICcvJykgewogICAgICAgICAgICAgICAgICAgICRwX2hlYWRlclsnc3RvcmVkX2ZpbGVuYW1lJ10gLj0gJy8nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFNldCB0aGUgZmlsZSBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAkcF9oZWFkZXJbJ3NpemUnXSA9IDA7CiAgICAgICAgICAgICAgICAvLyRwX2hlYWRlclsnZXh0ZXJuYWwnXSA9IDB4NDFGRjAwMTA7ICAgICAvLyBWYWx1ZSBmb3IgYSBmb2xkZXIgOiB0byBiZSBjaGVja2VkCiAgICAgICAgICAgICAgICAkcF9oZWFkZXJbJ2V4dGVybmFsJ10gPSAweDAwMDAwMDEwOyAgICAgLy8gVmFsdWUgZm9yIGEgZm9sZGVyIDogdG8gYmUgY2hlY2tlZAoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENhbGwgdGhlIGhlYWRlciBnZW5lcmF0aW9uCiAgICAgICAgICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2V3JpdGVGaWxlSGVhZGVyKCRwX2hlYWRlcikpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBwb3N0LWFkZCBjYWxsYmFjawogICAgICAgIGlmIChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9DQl9QT1NUX0FERF0pKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEdlbmVyYXRlIGEgbG9jYWwgaW5mb3JtYXRpb24KICAgICAgICAgICAgJHZfbG9jYWxfaGVhZGVyID0gYXJyYXkoKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCRwX2hlYWRlciwgJHZfbG9jYWxfaGVhZGVyKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIENhbGwgdGhlIGNhbGxiYWNrCiAgICAgICAgICAgIC8vIEhlcmUgSSBkbyBub3QgdXNlIGNhbGxfdXNlcl9mdW5jKCkgYmVjYXVzZSBJIG5lZWQgdG8gc2VuZCBhIHJlZmVyZW5jZSB0byB0aGUKICAgICAgICAgICAgLy8gaGVhZGVyLgogICAgLy8gICAgICAgICAgICBldmFsKCckdl9yZXN1bHQgPSAnLiRwX29wdGlvbnNbUENMWklQX0NCX1BPU1RfQUREXS4nKFBDTFpJUF9DQl9QT1NUX0FERCwgJHZfbG9jYWxfaGVhZGVyKTsnKTsKICAgICAgICAgICAgJHZfcmVzdWx0ID0gJHBfb3B0aW9uc1tQQ0xaSVBfQ0JfUE9TVF9BRERdKFBDTFpJUF9DQl9QT1NUX0FERCwgJHZfbG9jYWxfaGVhZGVyKTsKICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdCA9PSAwKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBJZ25vcmVkCiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBVcGRhdGUgdGhlIGluZm9ybWF0aW9ucwogICAgICAgICAgICAvLyBOb3RoaW5nIGNhbiBiZSBtb2RpZmllZAogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkFkZEZpbGVVc2luZ1RlbXBGaWxlKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZBZGRGaWxlVXNpbmdUZW1wRmlsZSgkcF9maWxlZGVzY3IsICYkcF9oZWFkZXIsICYkcF9vcHRpb25zKQogICAgewogICAgICAgICR2X3Jlc3VsdD1QQ0xaSVBfRVJSX05PX0VSUk9SOwoKICAgICAgICAvLyAtLS0tLSBXb3JraW5nIHZhcmlhYmxlCiAgICAgICAgJHBfZmlsZW5hbWUgPSAkcF9maWxlZGVzY3JbJ2ZpbGVuYW1lJ107CgoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSBzb3VyY2UgZmlsZQogICAgICAgIGlmICgoJHZfZmlsZSA9IEBmb3BlbigkcF9maWxlbmFtZSwgInJiIikpID09IDApIHsKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9SRUFEX09QRU5fRkFJTCwgIlVuYWJsZSB0byBvcGVuIGZpbGUgJyRwX2ZpbGVuYW1lJyBpbiBiaW5hcnkgcmVhZCBtb2RlIik7CiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ3JlYXRlcyBhIGNvbXByZXNzZWQgdGVtcG9yYXJ5IGZpbGUKICAgICAgICAkdl9nemlwX3RlbXBfbmFtZSA9IFBDTFpJUF9URU1QT1JBUllfRElSLnVuaXFpZCgncGNsemlwLScpLicuZ3onOwogICAgICAgIGlmICgoJHZfZmlsZV9jb21wcmVzc2VkID0gQGd6b3Blbigkdl9nemlwX3RlbXBfbmFtZSwgIndiIikpID09IDApIHsKICAgICAgICAgICAgZmNsb3NlKCR2X2ZpbGUpOwogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX1dSSVRFX09QRU5fRkFJTCwgJ1VuYWJsZSB0byBvcGVuIHRlbXBvcmFyeSBmaWxlIFwnJy4kdl9nemlwX3RlbXBfbmFtZS4nXCcgaW4gYmluYXJ5IHdyaXRlIG1vZGUnKTsKICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBmaWxlIGJ5IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUgb2N0ZXRzIGJsb2NrcwogICAgICAgICR2X3NpemUgPSBmaWxlc2l6ZSgkcF9maWxlbmFtZSk7CiAgICAgICAgd2hpbGUgKCR2X3NpemUgIT0gMCkgewogICAgICAgICAgICAkdl9yZWFkX3NpemUgPSAoJHZfc2l6ZSA8IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUgPyAkdl9zaXplIDogUENMWklQX1JFQURfQkxPQ0tfU0laRSk7CiAgICAgICAgICAgICR2X2J1ZmZlciA9IEBmcmVhZCgkdl9maWxlLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAvLyR2X2JpbmFyeV9kYXRhID0gcGFjaygnYScuJHZfcmVhZF9zaXplLCAkdl9idWZmZXIpOwogICAgICAgICAgICBAZ3pwdXRzKCR2X2ZpbGVfY29tcHJlc3NlZCwgJHZfYnVmZmVyLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAkdl9zaXplIC09ICR2X3JlYWRfc2l6ZTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSBmaWxlCiAgICAgICAgQGZjbG9zZSgkdl9maWxlKTsKICAgICAgICBAZ3pjbG9zZSgkdl9maWxlX2NvbXByZXNzZWQpOwoKICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGUgbWluaW11bSBmaWxlIHNpemUKICAgICAgICBpZiAoZmlsZXNpemUoJHZfZ3ppcF90ZW1wX25hbWUpIDwgMTgpIHsKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9CQURfRk9STUFULCAnZ3ppcCB0ZW1wb3JhcnkgZmlsZSBcJycuJHZfZ3ppcF90ZW1wX25hbWUuJ1wnIGhhcyBpbnZhbGlkIGZpbGVzaXplIC0gc2hvdWxkIGJlIG1pbmltdW0gMTggYnl0ZXMnKTsKICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBFeHRyYWN0IHRoZSBjb21wcmVzc2VkIGF0dHJpYnV0ZXMKICAgICAgICBpZiAoKCR2X2ZpbGVfY29tcHJlc3NlZCA9IEBmb3Blbigkdl9nemlwX3RlbXBfbmFtZSwgInJiIikpID09IDApIHsKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9SRUFEX09QRU5fRkFJTCwgJ1VuYWJsZSB0byBvcGVuIHRlbXBvcmFyeSBmaWxlIFwnJy4kdl9nemlwX3RlbXBfbmFtZS4nXCcgaW4gYmluYXJ5IHJlYWQgbW9kZScpOwogICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGd6aXAgZmlsZSBoZWFkZXIKICAgICAgICAkdl9iaW5hcnlfZGF0YSA9IEBmcmVhZCgkdl9maWxlX2NvbXByZXNzZWQsIDEwKTsKICAgICAgICAkdl9kYXRhX2hlYWRlciA9IHVucGFjaygnYTFpZDEvYTFpZDIvYTFjbS9hMWZsYWcvVm10aW1lL2ExeGZsL2Exb3MnLCAkdl9iaW5hcnlfZGF0YSk7CgogICAgICAgIC8vIC0tLS0tIENoZWNrIHNvbWUgcGFyYW1ldGVycwogICAgICAgICR2X2RhdGFfaGVhZGVyWydvcyddID0gYmluMmhleCgkdl9kYXRhX2hlYWRlclsnb3MnXSk7CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGd6aXAgZmlsZSBmb290ZXIKICAgICAgICBAZnNlZWsoJHZfZmlsZV9jb21wcmVzc2VkLCBmaWxlc2l6ZSgkdl9nemlwX3RlbXBfbmFtZSktOCk7CiAgICAgICAgJHZfYmluYXJ5X2RhdGEgPSBAZnJlYWQoJHZfZmlsZV9jb21wcmVzc2VkLCA4KTsKICAgICAgICAkdl9kYXRhX2Zvb3RlciA9IHVucGFjaygnVmNyYy9WY29tcHJlc3NlZF9zaXplJywgJHZfYmluYXJ5X2RhdGEpOwoKICAgICAgICAvLyAtLS0tLSBTZXQgdGhlIGF0dHJpYnV0ZXMKICAgICAgICAkcF9oZWFkZXJbJ2NvbXByZXNzaW9uJ10gPSBvcmQoJHZfZGF0YV9oZWFkZXJbJ2NtJ10pOwogICAgICAgIC8vJHBfaGVhZGVyWydtdGltZSddID0gJHZfZGF0YV9oZWFkZXJbJ210aW1lJ107CiAgICAgICAgJHBfaGVhZGVyWydjcmMnXSA9ICR2X2RhdGFfZm9vdGVyWydjcmMnXTsKICAgICAgICAkcF9oZWFkZXJbJ2NvbXByZXNzZWRfc2l6ZSddID0gZmlsZXNpemUoJHZfZ3ppcF90ZW1wX25hbWUpLTE4OwoKICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgZmlsZQogICAgICAgIEBmY2xvc2UoJHZfZmlsZV9jb21wcmVzc2VkKTsKCiAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgaGVhZGVyIGdlbmVyYXRpb24KICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2V3JpdGVGaWxlSGVhZGVyKCRwX2hlYWRlcikpICE9IDEpIHsKICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEFkZCB0aGUgY29tcHJlc3NlZCBkYXRhCiAgICAgICAgaWYgKCgkdl9maWxlX2NvbXByZXNzZWQgPSBAZm9wZW4oJHZfZ3ppcF90ZW1wX25hbWUsICJyYiIpKSA9PSAwKSB7CiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfUkVBRF9PUEVOX0ZBSUwsICdVbmFibGUgdG8gb3BlbiB0ZW1wb3JhcnkgZmlsZSBcJycuJHZfZ3ppcF90ZW1wX25hbWUuJ1wnIGluIGJpbmFyeSByZWFkIG1vZGUnKTsKICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBmaWxlIGJ5IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUgb2N0ZXRzIGJsb2NrcwogICAgICAgIGZzZWVrKCR2X2ZpbGVfY29tcHJlc3NlZCwgMTApOwogICAgICAgICR2X3NpemUgPSAkcF9oZWFkZXJbJ2NvbXByZXNzZWRfc2l6ZSddOwogICAgICAgIHdoaWxlICgkdl9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCR2X3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHZfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBAZnJlYWQoJHZfZmlsZV9jb21wcmVzc2VkLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAvLyR2X2JpbmFyeV9kYXRhID0gcGFjaygnYScuJHZfcmVhZF9zaXplLCAkdl9idWZmZXIpOwogICAgICAgICAgICBAZndyaXRlKCR0aGlzLT56aXBfZmQsICR2X2J1ZmZlciwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgJHZfc2l6ZSAtPSAkdl9yZWFkX3NpemU7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgZmlsZQogICAgICAgIEBmY2xvc2UoJHZfZmlsZV9jb21wcmVzc2VkKTsKCiAgICAgICAgLy8gLS0tLS0gVW5saW5rIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIEB1bmxpbmsoJHZfZ3ppcF90ZW1wX25hbWUpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2Q2FsY3VsYXRlU3RvcmVkRmlsZW5hbWUoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIEJhc2VkIG9uIGZpbGUgZGVzY3JpcHRvciBwcm9wZXJ0aWVzIGFuZCBnbG9iYWwgb3B0aW9ucywgdGhpcyBtZXRob2QKICAgIC8vICAgICBjYWxjdWxhdGUgdGhlIGZpbGVuYW1lIHRoYXQgd2lsbCBiZSBzdG9yZWQgaW4gdGhlIGFyY2hpdmUuCiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2Q2FsY3VsYXRlU3RvcmVkRmlsZW5hbWUoJiRwX2ZpbGVkZXNjciwgJiRwX29wdGlvbnMpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CgogICAgICAgIC8vIC0tLS0tIFdvcmtpbmcgdmFyaWFibGVzCiAgICAgICAgJHBfZmlsZW5hbWUgPSAkcF9maWxlZGVzY3JbJ2ZpbGVuYW1lJ107CiAgICAgICAgaWYgKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9BRERfUEFUSF0pKSB7CiAgICAgICAgICAgICRwX2FkZF9kaXIgPSAkcF9vcHRpb25zW1BDTFpJUF9PUFRfQUREX1BBVEhdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwX2FkZF9kaXIgPSAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9SRU1PVkVfUEFUSF0pKSB7CiAgICAgICAgICAgICRwX3JlbW92ZV9kaXIgPSAkcF9vcHRpb25zW1BDTFpJUF9PUFRfUkVNT1ZFX1BBVEhdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwX3JlbW92ZV9kaXIgPSAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9SRU1PVkVfQUxMX1BBVEhdKSkgewogICAgICAgICAgICAkcF9yZW1vdmVfYWxsX2RpciA9ICRwX29wdGlvbnNbUENMWklQX09QVF9SRU1PVkVfQUxMX1BBVEhdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwX3JlbW92ZV9hbGxfZGlyID0gMDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGZ1bGwgbmFtZSBjaGFuZ2UKICAgICAgICBpZiAoaXNzZXQoJHBfZmlsZWRlc2NyWyduZXdfZnVsbF9uYW1lJ10pKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIFJlbW92ZSBkcml2ZSBsZXR0ZXIgaWYgYW55CiAgICAgICAgICAgICR2X3N0b3JlZF9maWxlbmFtZSA9IFBjbFppcFV0aWxUcmFuc2xhdGVXaW5QYXRoKCRwX2ZpbGVkZXNjclsnbmV3X2Z1bGxfbmFtZSddKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBwYXRoIGFuZC9vciBzaG9ydCBuYW1lIGNoYW5nZQogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBzaG9ydCBuYW1lIGNoYW5nZQogICAgICAgICAgICAvLyBJdHMgd2hlbiB3ZSBjYWhuZ2UganVzdCB0aGUgZmlsZW5hbWUgYnV0IG5vdCB0aGUgcGF0aAogICAgICAgICAgICBpZiAoaXNzZXQoJHBfZmlsZWRlc2NyWyduZXdfc2hvcnRfbmFtZSddKSkgewogICAgICAgICAgICAgICAgJHZfcGF0aF9pbmZvID0gcGF0aGluZm8oJHBfZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgJHZfZGlyID0gJyc7CiAgICAgICAgICAgICAgICBpZiAoJHZfcGF0aF9pbmZvWydkaXJuYW1lJ10gIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkdl9kaXIgPSAkdl9wYXRoX2luZm9bJ2Rpcm5hbWUnXS4nLyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdl9zdG9yZWRfZmlsZW5hbWUgPSAkdl9kaXIuJHBfZmlsZWRlc2NyWyduZXdfc2hvcnRfbmFtZSddOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2FsY3VsYXRlIHRoZSBzdG9yZWQgZmlsZW5hbWUKICAgICAgICAgICAgICAgICR2X3N0b3JlZF9maWxlbmFtZSA9ICRwX2ZpbGVuYW1lOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhbGwgcGF0aCB0byByZW1vdmUKICAgICAgICAgICAgaWYgKCRwX3JlbW92ZV9hbGxfZGlyKSB7CiAgICAgICAgICAgICAgICAkdl9zdG9yZWRfZmlsZW5hbWUgPSBiYXNlbmFtZSgkcF9maWxlbmFtZSk7CiAgICAgICAgICAgIH0gZWxzZWlmICgkcF9yZW1vdmVfZGlyICE9ICIiKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBwYXJ0aWFsIHBhdGggcmVtb3ZlCiAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRwX3JlbW92ZV9kaXIsIC0xKSAhPSAnLycpIHsKICAgICAgICAgICAgICAgICAgICAkcF9yZW1vdmVfZGlyIC49ICIvIjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoKHN1YnN0cigkcF9maWxlbmFtZSwgMCwgMikgPT0gIi4vIikgfHwgKHN1YnN0cigkcF9yZW1vdmVfZGlyLCAwLCAyKSA9PSAiLi8iKSkgewogICAgICAgICAgICAgICAgICAgIGlmICgoc3Vic3RyKCRwX2ZpbGVuYW1lLCAwLCAyKSA9PSAiLi8iKSAmJiAoc3Vic3RyKCRwX3JlbW92ZV9kaXIsIDAsIDIpICE9ICIuLyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwX3JlbW92ZV9kaXIgPSAiLi8iLiRwX3JlbW92ZV9kaXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgoc3Vic3RyKCRwX2ZpbGVuYW1lLCAwLCAyKSAhPSAiLi8iKSAmJiAoc3Vic3RyKCRwX3JlbW92ZV9kaXIsIDAsIDIpID09ICIuLyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwX3JlbW92ZV9kaXIgPSBzdWJzdHIoJHBfcmVtb3ZlX2RpciwgMik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR2X2NvbXBhcmUgPSBQY2xaaXBVdGlsUGF0aEluY2x1c2lvbigkcF9yZW1vdmVfZGlyLCAkdl9zdG9yZWRfZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgaWYgKCR2X2NvbXBhcmUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR2X2NvbXBhcmUgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAkdl9zdG9yZWRfZmlsZW5hbWUgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkdl9zdG9yZWRfZmlsZW5hbWUgPSBzdWJzdHIoJHZfc3RvcmVkX2ZpbGVuYW1lLCBzdHJsZW4oJHBfcmVtb3ZlX2RpcikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gUmVtb3ZlIGRyaXZlIGxldHRlciBpZiBhbnkKICAgICAgICAgICAgJHZfc3RvcmVkX2ZpbGVuYW1lID0gUGNsWmlwVXRpbFRyYW5zbGF0ZVdpblBhdGgoJHZfc3RvcmVkX2ZpbGVuYW1lKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHBhdGggdG8gYWRkCiAgICAgICAgICAgIGlmICgkcF9hZGRfZGlyICE9ICIiKSB7CiAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRwX2FkZF9kaXIsIC0xKSA9PSAiLyIpIHsKICAgICAgICAgICAgICAgICAgICAkdl9zdG9yZWRfZmlsZW5hbWUgPSAkcF9hZGRfZGlyLiR2X3N0b3JlZF9maWxlbmFtZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHZfc3RvcmVkX2ZpbGVuYW1lID0gJHBfYWRkX2Rpci4iLyIuJHZfc3RvcmVkX2ZpbGVuYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBGaWxlbmFtZSAocmVkdWNlIHRoZSBwYXRoIG9mIHN0b3JlZCBuYW1lKQogICAgICAgICR2X3N0b3JlZF9maWxlbmFtZSA9IFBjbFppcFV0aWxQYXRoUmVkdWN0aW9uKCR2X3N0b3JlZF9maWxlbmFtZSk7CiAgICAgICAgJHBfZmlsZWRlc2NyWydzdG9yZWRfZmlsZW5hbWUnXSA9ICR2X3N0b3JlZF9maWxlbmFtZTsKCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdldyaXRlRmlsZUhlYWRlcigpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2V3JpdGVGaWxlSGVhZGVyKCYkcF9oZWFkZXIpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CgogICAgICAgIC8vIC0tLS0tIFN0b3JlIHRoZSBvZmZzZXQgcG9zaXRpb24gb2YgdGhlIGZpbGUKICAgICAgICAkcF9oZWFkZXJbJ29mZnNldCddID0gZnRlbGwoJHRoaXMtPnppcF9mZCk7CgogICAgICAgIC8vIC0tLS0tIFRyYW5zZm9ybSBVTklYIG10aW1lIHRvIERPUyBmb3JtYXQgbWRhdGUvbXRpbWUKICAgICAgICAkdl9kYXRlID0gZ2V0ZGF0ZSgkcF9oZWFkZXJbJ210aW1lJ10pOwogICAgICAgICR2X210aW1lID0gKCR2X2RhdGVbJ2hvdXJzJ108PDExKSArICgkdl9kYXRlWydtaW51dGVzJ108PDUpICsgJHZfZGF0ZVsnc2Vjb25kcyddLzI7CiAgICAgICAgJHZfbWRhdGUgPSAoKCR2X2RhdGVbJ3llYXInXS0xOTgwKTw8OSkgKyAoJHZfZGF0ZVsnbW9uJ108PDUpICsgJHZfZGF0ZVsnbWRheSddOwoKICAgICAgICAvLyAtLS0tLSBQYWNrZWQgZGF0YQogICAgICAgICR2X2JpbmFyeV9kYXRhID0gcGFjaygiVnZ2dnZ2VlZWdnYiLCAweDA0MDM0YjUwLCAkcF9oZWFkZXJbJ3ZlcnNpb25fZXh0cmFjdGVkJ10sICRwX2hlYWRlclsnZmxhZyddLCAkcF9oZWFkZXJbJ2NvbXByZXNzaW9uJ10sICR2X210aW1lLCAkdl9tZGF0ZSwgJHBfaGVhZGVyWydjcmMnXSwgJHBfaGVhZGVyWydjb21wcmVzc2VkX3NpemUnXSwgJHBfaGVhZGVyWydzaXplJ10sIHN0cmxlbigkcF9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddKSwgJHBfaGVhZGVyWydleHRyYV9sZW4nXSk7CgogICAgICAgIC8vIC0tLS0tIFdyaXRlIHRoZSBmaXJzdCAxNDggYnl0ZXMgb2YgdGhlIGhlYWRlciBpbiB0aGUgYXJjaGl2ZQogICAgICAgIGZwdXRzKCR0aGlzLT56aXBfZmQsICR2X2JpbmFyeV9kYXRhLCAzMCk7CgogICAgICAgIC8vIC0tLS0tIFdyaXRlIHRoZSB2YXJpYWJsZSBmaWVsZHMKICAgICAgICBpZiAoc3RybGVuKCRwX2hlYWRlclsnc3RvcmVkX2ZpbGVuYW1lJ10pICE9IDApIHsKICAgICAgICAgICAgZnB1dHMoJHRoaXMtPnppcF9mZCwgJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSwgc3RybGVuKCRwX2hlYWRlclsnc3RvcmVkX2ZpbGVuYW1lJ10pKTsKICAgICAgICB9CiAgICAgICAgaWYgKCRwX2hlYWRlclsnZXh0cmFfbGVuJ10gIT0gMCkgewogICAgICAgICAgICBmcHV0cygkdGhpcy0+emlwX2ZkLCAkcF9oZWFkZXJbJ2V4dHJhJ10sICRwX2hlYWRlclsnZXh0cmFfbGVuJ10pOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdldyaXRlQ2VudHJhbEZpbGVIZWFkZXIoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdldyaXRlQ2VudHJhbEZpbGVIZWFkZXIoJiRwX2hlYWRlcikKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gVEJDCiAgICAgICAgLy9mb3IocmVzZXQoJHBfaGVhZGVyKTsgJGtleSA9IGtleSgkcF9oZWFkZXIpOyBuZXh0KCRwX2hlYWRlcikpIHsKICAgICAgICAvL30KCiAgICAgICAgLy8gLS0tLS0gVHJhbnNmb3JtIFVOSVggbXRpbWUgdG8gRE9TIGZvcm1hdCBtZGF0ZS9tdGltZQogICAgICAgICR2X2RhdGUgPSBnZXRkYXRlKCRwX2hlYWRlclsnbXRpbWUnXSk7CiAgICAgICAgJHZfbXRpbWUgPSAoJHZfZGF0ZVsnaG91cnMnXTw8MTEpICsgKCR2X2RhdGVbJ21pbnV0ZXMnXTw8NSkgKyAkdl9kYXRlWydzZWNvbmRzJ10vMjsKICAgICAgICAkdl9tZGF0ZSA9ICgoJHZfZGF0ZVsneWVhciddLTE5ODApPDw5KSArICgkdl9kYXRlWydtb24nXTw8NSkgKyAkdl9kYXRlWydtZGF5J107CgoKICAgICAgICAvLyAtLS0tLSBQYWNrZWQgZGF0YQogICAgICAgICR2X2JpbmFyeV9kYXRhID0gcGFjaygiVnZ2dnZ2dlZWVnZ2dnZ2VlYiLCAweDAyMDE0YjUwLCAkcF9oZWFkZXJbJ3ZlcnNpb24nXSwgJHBfaGVhZGVyWyd2ZXJzaW9uX2V4dHJhY3RlZCddLCAkcF9oZWFkZXJbJ2ZsYWcnXSwgJHBfaGVhZGVyWydjb21wcmVzc2lvbiddLCAkdl9tdGltZSwgJHZfbWRhdGUsICRwX2hlYWRlclsnY3JjJ10sICRwX2hlYWRlclsnY29tcHJlc3NlZF9zaXplJ10sICRwX2hlYWRlclsnc2l6ZSddLCBzdHJsZW4oJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSksICRwX2hlYWRlclsnZXh0cmFfbGVuJ10sICRwX2hlYWRlclsnY29tbWVudF9sZW4nXSwgJHBfaGVhZGVyWydkaXNrJ10sICRwX2hlYWRlclsnaW50ZXJuYWwnXSwgJHBfaGVhZGVyWydleHRlcm5hbCddLCAkcF9oZWFkZXJbJ29mZnNldCddKTsKCiAgICAgICAgLy8gLS0tLS0gV3JpdGUgdGhlIDQyIGJ5dGVzIG9mIHRoZSBoZWFkZXIgaW4gdGhlIHppcCBmaWxlCiAgICAgICAgZnB1dHMoJHRoaXMtPnppcF9mZCwgJHZfYmluYXJ5X2RhdGEsIDQ2KTsKCiAgICAgICAgLy8gLS0tLS0gV3JpdGUgdGhlIHZhcmlhYmxlIGZpZWxkcwogICAgICAgIGlmIChzdHJsZW4oJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSkgIT0gMCkgewogICAgICAgICAgICBmcHV0cygkdGhpcy0+emlwX2ZkLCAkcF9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddLCBzdHJsZW4oJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSkpOwogICAgICAgIH0KICAgICAgICBpZiAoJHBfaGVhZGVyWydleHRyYV9sZW4nXSAhPSAwKSB7CiAgICAgICAgICAgIGZwdXRzKCR0aGlzLT56aXBfZmQsICRwX2hlYWRlclsnZXh0cmEnXSwgJHBfaGVhZGVyWydleHRyYV9sZW4nXSk7CiAgICAgICAgfQogICAgICAgIGlmICgkcF9oZWFkZXJbJ2NvbW1lbnRfbGVuJ10gIT0gMCkgewogICAgICAgICAgICBmcHV0cygkdGhpcy0+emlwX2ZkLCAkcF9oZWFkZXJbJ2NvbW1lbnQnXSwgJHBfaGVhZGVyWydjb21tZW50X2xlbiddKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZXcml0ZUNlbnRyYWxIZWFkZXIoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdldyaXRlQ2VudHJhbEhlYWRlcigkcF9uYl9lbnRyaWVzLCAkcF9zaXplLCAkcF9vZmZzZXQsICRwX2NvbW1lbnQpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0ID0gMTsKCiAgICAgICAgLy8gLS0tLS0gUGFja2VkIGRhdGEKICAgICAgICAkdl9iaW5hcnlfZGF0YSA9IHBhY2soIlZ2dnZ2VlZ2IiwgMHgwNjA1NGI1MCwgMCwgMCwgJHBfbmJfZW50cmllcywgJHBfbmJfZW50cmllcywgJHBfc2l6ZSwgJHBfb2Zmc2V0LCBzdHJsZW4oJHBfY29tbWVudCkpOwoKICAgICAgICAvLyAtLS0tLSBXcml0ZSB0aGUgMjIgYnl0ZXMgb2YgdGhlIGhlYWRlciBpbiB0aGUgemlwIGZpbGUKICAgICAgICBmcHV0cygkdGhpcy0+emlwX2ZkLCAkdl9iaW5hcnlfZGF0YSwgMjIpOwoKICAgICAgICAvLyAtLS0tLSBXcml0ZSB0aGUgdmFyaWFibGUgZmllbGRzCiAgICAgICAgaWYgKHN0cmxlbigkcF9jb21tZW50KSAhPSAwKSB7CiAgICAgICAgICAgIGZwdXRzKCR0aGlzLT56aXBfZmQsICRwX2NvbW1lbnQsIHN0cmxlbigkcF9jb21tZW50KSk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2TGlzdCgpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2TGlzdCgmJHBfbGlzdCkKICAgIHsKICAgICAgICAkdl9yZXN1bHQgPSAxOwoKICAgICAgICAvLyAtLS0tLSBNYWdpYyBxdW90ZXMgdHJpY2sKICAgICAgICAkdGhpcy0+cHJpdkRpc2FibGVNYWdpY1F1b3RlcygpOwoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSB6aXAgZmlsZQogICAgICAgIGlmICgoJHRoaXMtPnppcF9mZCA9IEBmb3BlbigkdGhpcy0+emlwbmFtZSwgJ3JiJykpID09IDApIHsKICAgICAgICAgICAgLy8gLS0tLS0gTWFnaWMgcXVvdGVzIHRyaWNrCiAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfUkVBRF9PUEVOX0ZBSUwsICdVbmFibGUgdG8gb3BlbiBhcmNoaXZlIFwnJy4kdGhpcy0+emlwbmFtZS4nXCcgaW4gYmluYXJ5IHJlYWQgbW9kZScpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgY2VudHJhbCBkaXJlY3RvcnkgaW5mb3JtYXRpb25zCiAgICAgICAgJHZfY2VudHJhbF9kaXIgPSBhcnJheSgpOwogICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZSZWFkRW5kQ2VudHJhbERpcigkdl9jZW50cmFsX2RpcikpICE9IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBHbyB0byBiZWdpbm5pbmcgb2YgQ2VudHJhbCBEaXIKICAgICAgICBAcmV3aW5kKCR0aGlzLT56aXBfZmQpOwogICAgICAgIGlmIChAZnNlZWsoJHRoaXMtPnppcF9mZCwgJHZfY2VudHJhbF9kaXJbJ29mZnNldCddKSkgewogICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfQVJDSElWRV9aSVAsICdJbnZhbGlkIGFyY2hpdmUgc2l6ZScpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmVhZCBlYWNoIGVudHJ5CiAgICAgICAgZm9yICgkaT0wOyAkaTwkdl9jZW50cmFsX2RpclsnZW50cmllcyddOyAkaSsrKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGZpbGUgaGVhZGVyCiAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZSZWFkQ2VudHJhbEZpbGVIZWFkZXIoJHZfaGVhZGVyKSkgIT0gMSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICR2X2hlYWRlclsnaW5kZXgnXSA9ICRpOwoKICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSBvbmx5IGludGVyZXN0aW5nIGF0dHJpYnV0ZXMKICAgICAgICAgICAgJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCR2X2hlYWRlciwgJHBfbGlzdFskaV0pOwogICAgICAgICAgICB1bnNldCgkdl9oZWFkZXIpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ2xvc2UgdGhlIHppcCBmaWxlCiAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgIC8vIC0tLS0tIE1hZ2ljIHF1b3RlcyB0cmljawogICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2Q29udmVydEhlYWRlcjJGaWxlSW5mbygpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyAgICAgVGhpcyBmdW5jdGlvbiB0YWtlcyB0aGUgZmlsZSBpbmZvcm1hdGlvbnMgZnJvbSB0aGUgY2VudHJhbCBkaXJlY3RvcnkKICAgIC8vICAgICBlbnRyaWVzIGFuZCBleHRyYWN0IHRoZSBpbnRlcmVzdGluZyBwYXJhbWV0ZXJzIHRoYXQgd2lsbCBiZSBnaXZlbiBiYWNrLgogICAgLy8gICAgIFRoZSByZXN1bHRpbmcgZmlsZSBpbmZvcyBhcmUgc2V0IGluIHRoZSBhcnJheSAkcF9pbmZvCiAgICAvLyAgICAgICAgICRwX2luZm9bJ2ZpbGVuYW1lJ10gOiBGaWxlbmFtZSB3aXRoIGZ1bGwgcGF0aC4gR2l2ZW4gYnkgdXNlciAoYWRkKSwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0ZWQgaW4gdGhlIGZpbGVzeXN0ZW0gKGV4dHJhY3QpLgogICAgLy8gICAgICAgICAkcF9pbmZvWydzdG9yZWRfZmlsZW5hbWUnXSA6IFN0b3JlZCBmaWxlbmFtZSBpbiB0aGUgYXJjaGl2ZS4KICAgIC8vICAgICAgICAgJHBfaW5mb1snc2l6ZSddID0gU2l6ZSBvZiB0aGUgZmlsZS4KICAgIC8vICAgICAgICAgJHBfaW5mb1snY29tcHJlc3NlZF9zaXplJ10gPSBDb21wcmVzc2VkIHNpemUgb2YgdGhlIGZpbGUuCiAgICAvLyAgICAgICAgICRwX2luZm9bJ210aW1lJ10gPSBMYXN0IG1vZGlmaWNhdGlvbiBkYXRlIG9mIHRoZSBmaWxlLgogICAgLy8gICAgICAgICAkcF9pbmZvWydjb21tZW50J10gPSBDb21tZW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgZmlsZS4KICAgIC8vICAgICAgICAgJHBfaW5mb1snZm9sZGVyJ10gPSB0cnVlL2ZhbHNlIDogaW5kaWNhdGVzIGlmIHRoZSBlbnRyeSBpcyBhIGZvbGRlciBvciBub3QuCiAgICAvLyAgICAgICAgICRwX2luZm9bJ3N0YXR1cyddID0gc3RhdHVzIG9mIHRoZSBhY3Rpb24gb24gdGhlIGZpbGUuCiAgICAvLyAgICAgICAgICRwX2luZm9bJ2NyYyddID0gQ1JDIG9mIHRoZSBmaWxlIGNvbnRlbnQuCiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2Q29udmVydEhlYWRlcjJGaWxlSW5mbygkcF9oZWFkZXIsICYkcF9pbmZvKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIGludGVyZXN0aW5nIGF0dHJpYnV0ZXMKICAgICAgICAkdl90ZW1wX3BhdGggPSBQY2xaaXBVdGlsUGF0aFJlZHVjdGlvbigkcF9oZWFkZXJbJ2ZpbGVuYW1lJ10pOwogICAgICAgICRwX2luZm9bJ2ZpbGVuYW1lJ10gPSAkdl90ZW1wX3BhdGg7CiAgICAgICAgJHZfdGVtcF9wYXRoID0gUGNsWmlwVXRpbFBhdGhSZWR1Y3Rpb24oJHBfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSk7CiAgICAgICAgJHBfaW5mb1snc3RvcmVkX2ZpbGVuYW1lJ10gPSAkdl90ZW1wX3BhdGg7CiAgICAgICAgJHBfaW5mb1snc2l6ZSddID0gJHBfaGVhZGVyWydzaXplJ107CiAgICAgICAgJHBfaW5mb1snY29tcHJlc3NlZF9zaXplJ10gPSAkcF9oZWFkZXJbJ2NvbXByZXNzZWRfc2l6ZSddOwogICAgICAgICRwX2luZm9bJ210aW1lJ10gPSAkcF9oZWFkZXJbJ210aW1lJ107CiAgICAgICAgJHBfaW5mb1snY29tbWVudCddID0gJHBfaGVhZGVyWydjb21tZW50J107CiAgICAgICAgJHBfaW5mb1snZm9sZGVyJ10gPSAoKCRwX2hlYWRlclsnZXh0ZXJuYWwnXSYweDAwMDAwMDEwKT09MHgwMDAwMDAxMCk7CiAgICAgICAgJHBfaW5mb1snaW5kZXgnXSA9ICRwX2hlYWRlclsnaW5kZXgnXTsKICAgICAgICAkcF9pbmZvWydzdGF0dXMnXSA9ICRwX2hlYWRlclsnc3RhdHVzJ107CiAgICAgICAgJHBfaW5mb1snY3JjJ10gPSAkcF9oZWFkZXJbJ2NyYyddOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2RXh0cmFjdEJ5UnVsZSgpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyAgICAgRXh0cmFjdCBhIGZpbGUgb3IgZGlyZWN0b3J5IGRlcGVuZGluZyBvZiBydWxlcyAoYnkgaW5kZXgsIGJ5IG5hbWUsIC4uLikKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gICAgICRwX2ZpbGVfbGlzdCA6IEFuIGFycmF5IHdoZXJlIHdpbGwgYmUgcGxhY2VkIHRoZSBwcm9wZXJ0aWVzIG9mIGVhY2gKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdGVkIGZpbGUKICAgIC8vICAgICAkcF9wYXRoIDogUGF0aCB0byBhZGQgd2hpbGUgd3JpdGluZyB0aGUgZXh0cmFjdGVkIGZpbGVzCiAgICAvLyAgICAgJHBfcmVtb3ZlX3BhdGggOiBQYXRoIHRvIHJlbW92ZSAoZnJvbSB0aGUgZmlsZSBtZW1vcml6ZWQgcGF0aCkgd2hpbGUgd3JpdGluZyB0aGUKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZCBmaWxlcy4gSWYgdGhlIHBhdGggZG9lcyBub3QgbWF0Y2ggdGhlIGZpbGUgcGF0aCwKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaWxlIGlzIGV4dHJhY3RlZCB3aXRoIGl0cyBtZW1vcml6ZWQgcGF0aC4KICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwX3JlbW92ZV9wYXRoIGRvZXMgbm90IGFwcGx5IHRvICdsaXN0JyBtb2RlLgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBfcGF0aCBhbmQgJHBfcmVtb3ZlX3BhdGggYXJlIGNvbW11bGF0aXZlLgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAgICAgMSBvbiBzdWNjZXNzLDAgb3IgbGVzcyBvbiBlcnJvciAoc2VlIGVycm9yIGNvZGUgbGlzdCkKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdkV4dHJhY3RCeVJ1bGUoJiRwX2ZpbGVfbGlzdCwgJHBfcGF0aCwgJHBfcmVtb3ZlX3BhdGgsICRwX3JlbW92ZV9hbGxfcGF0aCwgJiRwX29wdGlvbnMpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CgogICAgICAgIC8vIC0tLS0tIE1hZ2ljIHF1b3RlcyB0cmljawogICAgICAgICR0aGlzLT5wcml2RGlzYWJsZU1hZ2ljUXVvdGVzKCk7CgogICAgICAgIC8vIC0tLS0tIENoZWNrIHRoZSBwYXRoCiAgICAgICAgaWYgKCgkcF9wYXRoID09ICIiKSB8fCAoKHN1YnN0cigkcF9wYXRoLCAwLCAxKSAhPSAiLyIpICYmIChzdWJzdHIoJHBfcGF0aCwgMCwgMykgIT0gIi4uLyIpICYmIChzdWJzdHIoJHBfcGF0aCwgMSwgMikhPSI6LyIpKSkgewogICAgICAgICAgICAkcF9wYXRoID0gIi4vIi4kcF9wYXRoOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmVkdWNlIHRoZSBwYXRoIGxhc3QgKGFuZCBkdXBsaWNhdGVkKSAnLycKICAgICAgICBpZiAoKCRwX3BhdGggIT0gIi4vIikgJiYgKCRwX3BhdGggIT0gIi8iKSkgewogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciB0aGUgcGF0aCBlbmQgJy8nCiAgICAgICAgICAgIHdoaWxlIChzdWJzdHIoJHBfcGF0aCwgLTEpID09ICIvIikgewogICAgICAgICAgICAgICAgJHBfcGF0aCA9IHN1YnN0cigkcF9wYXRoLCAwLCBzdHJsZW4oJHBfcGF0aCktMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHBhdGggdG8gcmVtb3ZlIGZvcm1hdCAoc2hvdWxkIGVuZCBieSAvKQogICAgICAgIGlmICgoJHBfcmVtb3ZlX3BhdGggIT0gIiIpICYmIChzdWJzdHIoJHBfcmVtb3ZlX3BhdGgsIC0xKSAhPSAnLycpKSB7CiAgICAgICAgICAgICRwX3JlbW92ZV9wYXRoIC49ICcvJzsKICAgICAgICB9CiAgICAgICAgJHBfcmVtb3ZlX3BhdGhfc2l6ZSA9IHN0cmxlbigkcF9yZW1vdmVfcGF0aCk7CgogICAgICAgIC8vIC0tLS0tIE9wZW4gdGhlIHppcCBmaWxlCiAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdk9wZW5GZCgncmInKSkgIT0gMSkgewogICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGNlbnRyYWwgZGlyZWN0b3J5IGluZm9ybWF0aW9ucwogICAgICAgICR2X2NlbnRyYWxfZGlyID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2UmVhZEVuZENlbnRyYWxEaXIoJHZfY2VudHJhbF9kaXIpKSAhPSAxKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSB6aXAgZmlsZQogICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CgogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gU3RhcnQgYXQgYmVnaW5uaW5nIG9mIENlbnRyYWwgRGlyCiAgICAgICAgJHZfcG9zX2VudHJ5ID0gJHZfY2VudHJhbF9kaXJbJ29mZnNldCddOwoKICAgICAgICAvLyAtLS0tLSBSZWFkIGVhY2ggZW50cnkKICAgICAgICAkal9zdGFydCA9IDA7CiAgICAgICAgZm9yICgkaT0wLCAkdl9uYl9leHRyYWN0ZWQ9MDsgJGk8JHZfY2VudHJhbF9kaXJbJ2VudHJpZXMnXTsgJGkrKykgewogICAgICAgICAgICAvLyAtLS0tLSBSZWFkIG5leHQgQ2VudHJhbCBkaXIgZW50cnkKICAgICAgICAgICAgQHJld2luZCgkdGhpcy0+emlwX2ZkKTsKICAgICAgICAgICAgaWYgKEBmc2VlaygkdGhpcy0+emlwX2ZkLCAkdl9wb3NfZW50cnkpKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgemlwIGZpbGUKICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0lOVkFMSURfQVJDSElWRV9aSVAsICdJbnZhbGlkIGFyY2hpdmUgc2l6ZScpOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGZpbGUgaGVhZGVyCiAgICAgICAgICAgICR2X2hlYWRlciA9IGFycmF5KCk7CiAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZSZWFkQ2VudHJhbEZpbGVIZWFkZXIoJHZfaGVhZGVyKSkgIT0gMSkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2UgdGhlIHppcCBmaWxlCiAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIFN0b3JlIHRoZSBpbmRleAogICAgICAgICAgICAkdl9oZWFkZXJbJ2luZGV4J10gPSAkaTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFN0b3JlIHRoZSBmaWxlIHBvc2l0aW9uCiAgICAgICAgICAgICR2X3Bvc19lbnRyeSA9IGZ0ZWxsKCR0aGlzLT56aXBfZmQpOwoKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdGhlIHNwZWNpZmljIGV4dHJhY3QgcnVsZXMKICAgICAgICAgICAgJHZfZXh0cmFjdCA9IGZhbHNlOwoKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZXh0cmFjdCBieSBuYW1lIHJ1bGUKICAgICAgICAgICAgaWYgKChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfTkFNRV0pKSAmJiAoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX05BTUVdICE9IDApKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSBmaWxlbmFtZSBpcyBpbiB0aGUgbGlzdAogICAgICAgICAgICAgICAgZm9yICgkaj0wOyAoJGo8c2l6ZW9mKCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9OQU1FXSkpICYmICghJHZfZXh0cmFjdCk7ICRqKyspIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhIGRpcmVjdG9yeQogICAgICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX05BTUVdWyRqXSwgLTEpID09ICIvIikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSBkaXJlY3RvcnkgaXMgaW4gdGhlIGZpbGVuYW1lIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChzdHJsZW4oJHZfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSkgPiBzdHJsZW4oJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX05BTUVdWyRqXSkpICYmIChzdWJzdHIoJHZfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSwgMCwgc3RybGVuKCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9OQU1FXVskal0pKSA9PSAkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfTkFNRV1bJGpdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZfZXh0cmFjdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHZfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXSA9PSAkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfTkFNRV1bJGpdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGEgZmlsZW5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJHZfZXh0cmFjdCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9QUkVHXSkpICYmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfUFJFR10gIT0gIiIpKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBleHRyYWN0IGJ5IHByZWcgcnVsZQogICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX1BSRUddLCAkdl9oZWFkZXJbJ3N0b3JlZF9maWxlbmFtZSddKSkgewogICAgICAgICAgICAgICAgICAgICR2X2V4dHJhY3QgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF0pKSAmJiAoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX0lOREVYXSAhPSAwKSkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZXh0cmFjdCBieSBpbmRleCBydWxlCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSBpbmRleCBpcyBpbiB0aGUgbGlzdAogICAgICAgICAgICAgICAgZm9yICgkaj0kal9zdGFydDsgKCRqPHNpemVvZigkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfSU5ERVhdKSkgJiYgKCEkdl9leHRyYWN0KTsgJGorKykgewogICAgICAgICAgICAgICAgICAgIGlmICgoJGk+PSRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF1bJGpdWydzdGFydCddKSAmJiAoJGk8PSRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF1bJGpdWydlbmQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2X2V4dHJhY3QgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJGk+PSRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF1bJGpdWydlbmQnXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGpfc3RhcnQgPSAkaisxOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF1bJGpdWydzdGFydCddPiRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG5vIHJ1bGUsIHdoaWNoIG1lYW5zIGV4dHJhY3QgYWxsIHRoZSBhcmNoaXZlCiAgICAgICAgICAgICAgICAkdl9leHRyYWN0ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gQ2hlY2sgY29tcHJlc3Npb24gbWV0aG9kCiAgICAgICAgICAgIGlmICgoJHZfZXh0cmFjdCkgJiYgKCgkdl9oZWFkZXJbJ2NvbXByZXNzaW9uJ10gIT0gOCkgJiYgKCR2X2hlYWRlclsnY29tcHJlc3Npb24nXSAhPSAwKSkpIHsKICAgICAgICAgICAgICAgICR2X2hlYWRlclsnc3RhdHVzJ10gPSAndW5zdXBwb3J0ZWRfY29tcHJlc3Npb24nOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIFBDTFpJUF9PUFRfU1RPUF9PTl9FUlJPUgogICAgICAgICAgICAgICAgaWYgKChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfU1RPUF9PTl9FUlJPUl0pKSAmJiAoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1JdID09PSB0cnVlKSkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX1VOU1VQUE9SVEVEX0NPTVBSRVNTSU9OLCAiRmlsZW5hbWUgJyIuJHZfaGVhZGVyWydzdG9yZWRfZmlsZW5hbWUnXS4iJyBpcyBjb21wcmVzc2VkIGJ5IGFuIHVuc3VwcG9ydGVkIGNvbXByZXNzaW9uIG1ldGhvZCAoIi4kdl9oZWFkZXJbJ2NvbXByZXNzaW9uJ10uIikgIik7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBDaGVjayBlbmNyeXB0ZWQgZmlsZXMKICAgICAgICAgICAgaWYgKCgkdl9leHRyYWN0KSAmJiAoKCR2X2hlYWRlclsnZmxhZyddICYgMSkgPT0gMSkpIHsKICAgICAgICAgICAgICAgICR2X2hlYWRlclsnc3RhdHVzJ10gPSAndW5zdXBwb3J0ZWRfZW5jcnlwdGlvbic7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1IKICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1JdKSkgJiYgKCRwX29wdGlvbnNbUENMWklQX09QVF9TVE9QX09OX0VSUk9SXSA9PT0gdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKCiAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9VTlNVUFBPUlRFRF9FTkNSWVBUSU9OLCAiVW5zdXBwb3J0ZWQgZW5jcnlwdGlvbiBmb3IgIGZpbGVuYW1lICciLiR2X2hlYWRlclsnc3RvcmVkX2ZpbGVuYW1lJ10uIiciKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHJlYWwgZXh0cmFjdGlvbgogICAgICAgICAgICBpZiAoKCR2X2V4dHJhY3QpICYmICgkdl9oZWFkZXJbJ3N0YXR1cyddICE9ICdvaycpKSB7CiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkNvbnZlcnRIZWFkZXIyRmlsZUluZm8oJHZfaGVhZGVyLCAkcF9maWxlX2xpc3RbJHZfbmJfZXh0cmFjdGVkKytdKTsKICAgICAgICAgICAgICAgIGlmICgkdl9yZXN1bHQgIT0gMSkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHZfZXh0cmFjdCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciByZWFsIGV4dHJhY3Rpb24KICAgICAgICAgICAgaWYgKCR2X2V4dHJhY3QpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIEdvIHRvIHRoZSBmaWxlIHBvc2l0aW9uCiAgICAgICAgICAgICAgICBAcmV3aW5kKCR0aGlzLT56aXBfZmQpOwogICAgICAgICAgICAgICAgaWYgKEBmc2VlaygkdGhpcy0+emlwX2ZkLCAkdl9oZWFkZXJbJ29mZnNldCddKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSB6aXAgZmlsZQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXJyb3IgbG9nCiAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX0FSQ0hJVkVfWklQLCAnSW52YWxpZCBhcmNoaXZlIHNpemUnKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZXh0cmFjdGlvbiBhcyBzdHJpbmcKICAgICAgICAgICAgICAgIGlmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfRVhUUkFDVF9BU19TVFJJTkddKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfc3RyaW5nID0gJyc7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEV4dHJhY3RpbmcgdGhlIGZpbGUKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQxID0gJHRoaXMtPnByaXZFeHRyYWN0RmlsZUFzU3RyaW5nKCR2X2hlYWRlciwgJHZfc3RyaW5nLCAkcF9vcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHZfcmVzdWx0MSA8IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0MTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEdldCB0aGUgb25seSBpbnRlcmVzdGluZyBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkNvbnZlcnRIZWFkZXIyRmlsZUluZm8oJHZfaGVhZGVyLCAkcF9maWxlX2xpc3RbJHZfbmJfZXh0cmFjdGVkXSkpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2UgdGhlIHppcCBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBTZXQgdGhlIGZpbGUgY29udGVudAogICAgICAgICAgICAgICAgICAgICRwX2ZpbGVfbGlzdFskdl9uYl9leHRyYWN0ZWRdWydjb250ZW50J10gPSAkdl9zdHJpbmc7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIE5leHQgZXh0cmFjdGVkIGZpbGUKICAgICAgICAgICAgICAgICAgICAkdl9uYl9leHRyYWN0ZWQrKzsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdXNlciBjYWxsYmFjayBhYm9ydAogICAgICAgICAgICAgICAgICAgIGlmICgkdl9yZXN1bHQxID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlaWYgKChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfRVhUUkFDVF9JTl9PVVRQVVRdKSkgJiYgKCRwX29wdGlvbnNbUENMWklQX09QVF9FWFRSQUNUX0lOX09VVFBVVF0pKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZXh0cmFjdGlvbiBpbiBzdGFuZGFyZCBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBFeHRyYWN0aW5nIHRoZSBmaWxlIGluIHN0YW5kYXJkIG91dHB1dAogICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdDEgPSAkdGhpcy0+cHJpdkV4dHJhY3RGaWxlSW5PdXRwdXQoJHZfaGVhZGVyLCAkcF9vcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHZfcmVzdWx0MSA8IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0MTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEdldCB0aGUgb25seSBpbnRlcmVzdGluZyBhdHRyaWJ1dGVzCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkNvbnZlcnRIZWFkZXIyRmlsZUluZm8oJHZfaGVhZGVyLCAkcF9maWxlX2xpc3RbJHZfbmJfZXh0cmFjdGVkKytdKSkgIT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnByaXZTd2FwQmFja01hZ2ljUXVvdGVzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciB1c2VyIGNhbGxiYWNrIGFib3J0CiAgICAgICAgICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdDEgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG5vcm1hbCBleHRyYWN0aW9uCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRXh0cmFjdGluZyB0aGUgZmlsZQogICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdDEgPSAkdGhpcy0+cHJpdkV4dHJhY3RGaWxlKCR2X2hlYWRlciwgJHBfcGF0aCwgJHBfcmVtb3ZlX3BhdGgsICRwX3JlbW92ZV9hbGxfcGF0aCwgJHBfb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdDEgPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDE7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBHZXQgdGhlIG9ubHkgaW50ZXJlc3RpbmcgYXR0cmlidXRlcwogICAgICAgICAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCR2X2hlYWRlciwgJHBfZmlsZV9saXN0WyR2X25iX2V4dHJhY3RlZCsrXSkpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2UgdGhlIHppcCBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciB1c2VyIGNhbGxiYWNrIGFib3J0CiAgICAgICAgICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdDEgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSB6aXAgZmlsZQogICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICR0aGlzLT5wcml2U3dhcEJhY2tNYWdpY1F1b3RlcygpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2RXh0cmFjdEZpbGUoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vCiAgICAvLyAxIDogLi4uID8KICAgIC8vIFBDTFpJUF9FUlJfVVNFUl9BQk9SVEVEKDIpIDogVXNlciBhc2sgZm9yIGV4dHJhY3Rpb24gc3RvcCBpbiBjYWxsYmFjawogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2RXh0cmFjdEZpbGUoJiRwX2VudHJ5LCAkcF9wYXRoLCAkcF9yZW1vdmVfcGF0aCwgJHBfcmVtb3ZlX2FsbF9wYXRoLCAmJHBfb3B0aW9ucykKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgZmlsZSBoZWFkZXIKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2UmVhZEZpbGVIZWFkZXIoJHZfaGVhZGVyKSkgIT0gMSkgewogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgoKICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGF0IHRoZSBmaWxlIGhlYWRlciBpcyBjb2hlcmVudCB3aXRoICRwX2VudHJ5IGluZm8KICAgICAgICBpZiAoJHRoaXMtPnByaXZDaGVja0ZpbGVIZWFkZXJzKCR2X2hlYWRlciwgJHBfZW50cnkpICE9IDEpIHsKICAgICAgICAgICAgLy8gVEJDCiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhbGwgcGF0aCB0byByZW1vdmUKICAgICAgICBpZiAoJHBfcmVtb3ZlX2FsbF9wYXRoID09IHRydWUpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZm9sZGVyIGVudHJ5IHRoYXQgbm90IG5lZWQgdG8gYmUgZXh0cmFjdGVkCiAgICAgICAgICAgIGlmICgoJHBfZW50cnlbJ2V4dGVybmFsJ10mMHgwMDAwMDAxMCk9PTB4MDAwMDAwMTApIHsKICAgICAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJmaWx0ZXJlZCI7CgogICAgICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gR2V0IHRoZSBiYXNlbmFtZSBvZiB0aGUgcGF0aAogICAgICAgICAgICAkcF9lbnRyeVsnZmlsZW5hbWUnXSA9IGJhc2VuYW1lKCRwX2VudHJ5WydmaWxlbmFtZSddKTsKICAgICAgICB9IGVsc2VpZiAoJHBfcmVtb3ZlX3BhdGggIT0gIiIpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgcGF0aCB0byByZW1vdmUKICAgICAgICAgICAgaWYgKFBjbFppcFV0aWxQYXRoSW5jbHVzaW9uKCRwX3JlbW92ZV9wYXRoLCAkcF9lbnRyeVsnZmlsZW5hbWUnXSkgPT0gMikgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIHRoZSBmaWxlIHN0YXR1cwogICAgICAgICAgICAgICAgJHBfZW50cnlbJ3N0YXR1cyddID0gImZpbHRlcmVkIjsKCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRwX3JlbW92ZV9wYXRoX3NpemUgPSBzdHJsZW4oJHBfcmVtb3ZlX3BhdGgpOwogICAgICAgICAgICBpZiAoc3Vic3RyKCRwX2VudHJ5WydmaWxlbmFtZSddLCAwLCAkcF9yZW1vdmVfcGF0aF9zaXplKSA9PSAkcF9yZW1vdmVfcGF0aCkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gUmVtb3ZlIHRoZSBwYXRoCiAgICAgICAgICAgICAgICAkcF9lbnRyeVsnZmlsZW5hbWUnXSA9IHN1YnN0cigkcF9lbnRyeVsnZmlsZW5hbWUnXSwgJHBfcmVtb3ZlX3BhdGhfc2l6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEFkZCB0aGUgcGF0aAogICAgICAgIGlmICgkcF9wYXRoICE9ICcnKSB7CiAgICAgICAgICAgICRwX2VudHJ5WydmaWxlbmFtZSddID0gJHBfcGF0aC4iLyIuJHBfZW50cnlbJ2ZpbGVuYW1lJ107CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDaGVjayBhIGJhc2VfZGlyX3Jlc3RyaWN0aW9uCiAgICAgICAgaWYgKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9FWFRSQUNUX0RJUl9SRVNUUklDVElPTl0pKSB7CiAgICAgICAgICAgICR2X2luY2x1c2lvbiA9IFBjbFppcFV0aWxQYXRoSW5jbHVzaW9uKCRwX29wdGlvbnNbUENMWklQX09QVF9FWFRSQUNUX0RJUl9SRVNUUklDVElPTl0sICRwX2VudHJ5WydmaWxlbmFtZSddKTsKICAgICAgICAgICAgaWYgKCR2X2luY2x1c2lvbiA9PSAwKSB7CiAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0RJUkVDVE9SWV9SRVNUUklDVElPTiwgIkZpbGVuYW1lICciLiRwX2VudHJ5WydmaWxlbmFtZSddLiInIGlzIG91dHNpZGUgUENMWklQX09QVF9FWFRSQUNUX0RJUl9SRVNUUklDVElPTiIpOwoKICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBwcmUtZXh0cmFjdCBjYWxsYmFjawogICAgICAgIGlmIChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9DQl9QUkVfRVhUUkFDVF0pKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEdlbmVyYXRlIGEgbG9jYWwgaW5mb3JtYXRpb24KICAgICAgICAgICAgJHZfbG9jYWxfaGVhZGVyID0gYXJyYXkoKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCRwX2VudHJ5LCAkdl9sb2NhbF9oZWFkZXIpOwoKICAgICAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgY2FsbGJhY2sKICAgICAgICAgICAgLy8gSGVyZSBJIGRvIG5vdCB1c2UgY2FsbF91c2VyX2Z1bmMoKSBiZWNhdXNlIEkgbmVlZCB0byBzZW5kIGEgcmVmZXJlbmNlIHRvIHRoZQogICAgICAgICAgICAvLyBoZWFkZXIuCiAgICAvLyAgICAgICAgICAgIGV2YWwoJyR2X3Jlc3VsdCA9ICcuJHBfb3B0aW9uc1tQQ0xaSVBfQ0JfUFJFX0VYVFJBQ1RdLicoUENMWklQX0NCX1BSRV9FWFRSQUNULCAkdl9sb2NhbF9oZWFkZXIpOycpOwogICAgICAgICAgICAkdl9yZXN1bHQgPSAkcF9vcHRpb25zW1BDTFpJUF9DQl9QUkVfRVhUUkFDVF0oUENMWklQX0NCX1BSRV9FWFRSQUNULCAkdl9sb2NhbF9oZWFkZXIpOwogICAgICAgICAgICBpZiAoJHZfcmVzdWx0ID09IDApIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoYW5nZSB0aGUgZmlsZSBzdGF0dXMKICAgICAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJza2lwcGVkIjsKICAgICAgICAgICAgICAgICR2X3Jlc3VsdCA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGFib3J0IHJlc3VsdAogICAgICAgICAgICBpZiAoJHZfcmVzdWx0ID09IDIpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFRoaXMgc3RhdHVzIGlzIGludGVybmFsIGFuZCB3aWxsIGJlIGNoYW5nZWQgaW4gJ3NraXBwZWQnCiAgICAgICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAiYWJvcnRlZCI7CiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSBQQ0xaSVBfRVJSX1VTRVJfQUJPUlRFRDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gVXBkYXRlIHRoZSBpbmZvcm1hdGlvbnMKICAgICAgICAgICAgLy8gT25seSBzb21lIGZpZWxkcyBjYW4gYmUgbW9kaWZpZWQKICAgICAgICAgICAgJHBfZW50cnlbJ2ZpbGVuYW1lJ10gPSAkdl9sb2NhbF9oZWFkZXJbJ2ZpbGVuYW1lJ107CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIGV4dHJhY3Rpb24gc2hvdWxkIGJlIGRvbmUKICAgICAgICBpZiAoJHBfZW50cnlbJ3N0YXR1cyddID09ICdvaycpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igc3BlY2lmaWMgYWN0aW9ucyB3aGlsZSB0aGUgZmlsZSBleGlzdAogICAgICAgICAgICBpZiAoZmlsZV9leGlzdHMoJHBfZW50cnlbJ2ZpbGVuYW1lJ10pKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIGZpbGUgaXMgYSBkaXJlY3RvcnkKICAgICAgICAgICAgICAgIGlmIChpc19kaXIoJHBfZW50cnlbJ2ZpbGVuYW1lJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIHRoZSBmaWxlIHN0YXR1cwogICAgICAgICAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJhbHJlYWR5X2FfZGlyZWN0b3J5IjsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgUENMWklQX09QVF9TVE9QX09OX0VSUk9SCiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGhpc3RvcmljYWwgcmVhc29uIGZpcnN0IFBjbFppcCBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdCBzdG9wCiAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiB0aGlzIGtpbmQgb2YgZXJyb3Igb2NjdXJzLgogICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1JdKSkgJiYgKCRwX29wdGlvbnNbUENMWklQX09QVF9TVE9QX09OX0VSUk9SXT09PXRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfQUxSRUFEWV9BX0RJUkVDVE9SWSwgIkZpbGVuYW1lICciLiRwX2VudHJ5WydmaWxlbmFtZSddLiInIGlzIGFscmVhZHkgdXNlZCBieSBhbiBleGlzdGluZyBkaXJlY3RvcnkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlaWYgKCFpc193cml0ZWFibGUoJHBfZW50cnlbJ2ZpbGVuYW1lJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBpZiBmaWxlIGlzIHdyaXRlIHByb3RlY3RlZAogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoYW5nZSB0aGUgZmlsZSBzdGF0dXMKICAgICAgICAgICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAid3JpdGVfcHJvdGVjdGVkIjsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgUENMWklQX09QVF9TVE9QX09OX0VSUk9SCiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGhpc3RvcmljYWwgcmVhc29uIGZpcnN0IFBjbFppcCBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdCBzdG9wCiAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiB0aGlzIGtpbmQgb2YgZXJyb3Igb2NjdXJzLgogICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1JdKSkgJiYgKCRwX29wdGlvbnNbUENMWklQX09QVF9TVE9QX09OX0VSUk9SXSA9PT0gdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9XUklURV9PUEVOX0ZBSUwsICJGaWxlbmFtZSAnIi4kcF9lbnRyeVsnZmlsZW5hbWUnXS4iJyBleGlzdHMgYW5kIGlzIHdyaXRlIHByb3RlY3RlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoZmlsZW10aW1lKCRwX2VudHJ5WydmaWxlbmFtZSddKSA+ICRwX2VudHJ5WydtdGltZSddKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBpZiB0aGUgZXh0cmFjdGVkIGZpbGUgaXMgb2xkZXIKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGFuZ2UgdGhlIGZpbGUgc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgaWYgKChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfUkVQTEFDRV9ORVdFUl0pKSAmJiAoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1JFUExBQ0VfTkVXRVJdID09PSB0cnVlKSkgewogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJuZXdlcl9leGlzdCI7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1IKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGhpc3RvcmljYWwgcmVhc29uIGZpcnN0IFBjbFppcCBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdCBzdG9wCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhpcyBraW5kIG9mIGVycm9yIG9jY3Vycy4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfU1RPUF9PTl9FUlJPUl0pKSAmJiAoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1NUT1BfT05fRVJST1JdID09PSB0cnVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9XUklURV9PUEVOX0ZBSUwsICJOZXdlciB2ZXJzaW9uIG9mICciLiRwX2VudHJ5WydmaWxlbmFtZSddLiInIGV4aXN0cyBhbmQgb3B0aW9uIFBDTFpJUF9PUFRfUkVQTEFDRV9ORVdFUiBpcyBub3Qgc2VsZWN0ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoZWNrIHRoZSBkaXJlY3RvcnkgYXZhaWxhYmlsaXR5IGFuZCBjcmVhdGUgaXQgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICBpZiAoKCgkcF9lbnRyeVsnZXh0ZXJuYWwnXSYweDAwMDAwMDEwKT09MHgwMDAwMDAxMCkgfHwgKHN1YnN0cigkcF9lbnRyeVsnZmlsZW5hbWUnXSwgLTEpID09ICcvJykpIHsKICAgICAgICAgICAgICAgICAgICAkdl9kaXJfdG9fY2hlY2sgPSAkcF9lbnRyeVsnZmlsZW5hbWUnXTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICghc3Ryc3RyKCRwX2VudHJ5WydmaWxlbmFtZSddLCAiLyIpKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfZGlyX3RvX2NoZWNrID0gIiI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR2X2Rpcl90b19jaGVjayA9IGRpcm5hbWUoJHBfZW50cnlbJ2ZpbGVuYW1lJ10pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZEaXJDaGVjaygkdl9kaXJfdG9fY2hlY2ssICgoJHBfZW50cnlbJ2V4dGVybmFsJ10mMHgwMDAwMDAxMCk9PTB4MDAwMDAwMTApKSkgIT0gMSkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoYW5nZSB0aGUgZmlsZSBzdGF0dXMKICAgICAgICAgICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAicGF0aF9jcmVhdGlvbl9mYWlsIjsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdCA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgaWYgZXh0cmFjdGlvbiBzaG91bGQgYmUgZG9uZQogICAgICAgIGlmICgkcF9lbnRyeVsnc3RhdHVzJ10gPT0gJ29rJykgewogICAgICAgICAgICAvLyAtLS0tLSBEbyB0aGUgZXh0cmFjdGlvbiAoaWYgbm90IGEgZm9sZGVyKQogICAgICAgICAgICBpZiAoISgoJHBfZW50cnlbJ2V4dGVybmFsJ10mMHgwMDAwMDAxMCkgPT0gMHgwMDAwMDAxMCkpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG5vdCBjb21wcmVzc2VkIGZpbGUKICAgICAgICAgICAgICAgIGlmICgkcF9lbnRyeVsnY29tcHJlc3Npb24nXSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gT3BlbmluZyBkZXN0aW5hdGlvbiBmaWxlCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkdl9kZXN0X2ZpbGUgPSBAZm9wZW4oJHBfZW50cnlbJ2ZpbGVuYW1lJ10sICd3YicpKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoYW5nZSB0aGUgZmlsZSBzdGF0dXMKICAgICAgICAgICAgICAgICAgICAgICAgJHBfZW50cnlbJ3N0YXR1cyddID0gIndyaXRlX2Vycm9yIjsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgZmlsZSBieSBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFIG9jdGV0cyBibG9ja3MKICAgICAgICAgICAgICAgICAgICAkdl9zaXplID0gJHBfZW50cnlbJ2NvbXByZXNzZWRfc2l6ZSddOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICgkdl9zaXplICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCR2X3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHZfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAgICAgICAgICAgICAkdl9idWZmZXIgPSBAZnJlYWQoJHRoaXMtPnppcF9mZCwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgICAgICAgICAgICAgLyogVHJ5IHRvIHNwZWVkIHVwIHRoZSBjb2RlCiAgICAgICAgICAgICAgICAgICAgICAgICR2X2JpbmFyeV9kYXRhID0gcGFjaygnYScuJHZfcmVhZF9zaXplLCAkdl9idWZmZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBAZndyaXRlKCR2X2Rlc3RfZmlsZSwgJHZfYmluYXJ5X2RhdGEsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgIEBmd3JpdGUoJHZfZGVzdF9maWxlLCAkdl9idWZmZXIsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICR2X3NpemUgLT0gJHZfcmVhZF9zaXplOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2luZyB0aGUgZGVzdGluYXRpb24gZmlsZQogICAgICAgICAgICAgICAgICAgIGZjbG9zZSgkdl9kZXN0X2ZpbGUpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGFuZ2UgdGhlIGZpbGUgbXRpbWUKICAgICAgICAgICAgICAgICAgICB0b3VjaCgkcF9lbnRyeVsnZmlsZW5hbWUnXSwgJHBfZW50cnlbJ210aW1lJ10pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBUQkMKICAgICAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGJlIGZpbmlzaGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkcF9lbnRyeVsnZmxhZyddICYgMSkgPT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX1VOU1VQUE9SVEVEX0VOQ1JZUFRJT04sICdGaWxlIFwnJy4kcF9lbnRyeVsnZmlsZW5hbWUnXS4nXCcgaXMgZW5jcnlwdGVkLiBFbmNyeXB0ZWQgZmlsZXMgYXJlIG5vdCBzdXBwb3J0ZWQuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgdXNpbmcgdGVtcG9yYXJ5IGZpbGUgdG8gdW56aXAKICAgICAgICAgICAgICAgICAgICBpZiAoKCFpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX09GRl0pKSAmJiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1RFTVBfRklMRV9PTl0pIHx8IChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX1RIUkVTSE9MRF0pICYmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfVEVNUF9GSUxFX1RIUkVTSE9MRF0gPD0gJHBfZW50cnlbJ3NpemUnXSkpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdkV4dHJhY3RGaWxlVXNpbmdUZW1wRmlsZSgkcF9lbnRyeSwgJHBfb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdl9yZXN1bHQgPCBQQ0xaSVBfRVJSX05PX0VSUk9SKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZXh0cmFjdCBpbiBtZW1vcnkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgY29tcHJlc3NlZCBmaWxlIGluIGEgYnVmZmVyIChvbmUgc2hvdCkKICAgICAgICAgICAgICAgICAgICAgICAgJHZfYnVmZmVyID0gQGZyZWFkKCR0aGlzLT56aXBfZmQsICRwX2VudHJ5Wydjb21wcmVzc2VkX3NpemUnXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBEZWNvbXByZXNzIHRoZSBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICR2X2ZpbGVfY29udGVudCA9IEBnemluZmxhdGUoJHZfYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHZfYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2X2ZpbGVfY29udGVudCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoYW5nZSB0aGUgZmlsZSBzdGF0dXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRCQwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBfZW50cnlbJ3N0YXR1cyddID0gImVycm9yIjsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBPcGVuaW5nIGRlc3RpbmF0aW9uIGZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkdl9kZXN0X2ZpbGUgPSBAZm9wZW4oJHBfZW50cnlbJ2ZpbGVuYW1lJ10sICd3YicpKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDaGFuZ2UgdGhlIGZpbGUgc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAid3JpdGVfZXJyb3IiOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFdyaXRlIHRoZSB1bmNvbXByZXNzZWQgZGF0YQogICAgICAgICAgICAgICAgICAgICAgICBAZndyaXRlKCR2X2Rlc3RfZmlsZSwgJHZfZmlsZV9jb250ZW50LCAkcF9lbnRyeVsnc2l6ZSddKTsKICAgICAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHZfZmlsZV9jb250ZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENsb3NpbmcgdGhlIGRlc3RpbmF0aW9uIGZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgQGZjbG9zZSgkdl9kZXN0X2ZpbGUpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIHRoZSBmaWxlIG10aW1lCiAgICAgICAgICAgICAgICAgICAgQHRvdWNoKCRwX2VudHJ5WydmaWxlbmFtZSddLCAkcF9lbnRyeVsnbXRpbWUnXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgY2htb2Qgb3B0aW9uCiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX1NFVF9DSE1PRF0pKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIHRoZSBtb2RlIG9mIHRoZSBmaWxlCiAgICAgICAgICAgICAgICAgICAgQGNobW9kKCRwX2VudHJ5WydmaWxlbmFtZSddLCAkcF9vcHRpb25zW1BDTFpJUF9PUFRfU0VUX0NITU9EXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENoYW5nZSBhYm9ydCBzdGF0dXMKICAgICAgICBpZiAoJHBfZW50cnlbJ3N0YXR1cyddID09ICJhYm9ydGVkIikgewogICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAic2tpcHBlZCI7CiAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX0NCX1BPU1RfRVhUUkFDVF0pKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHBvc3QtZXh0cmFjdCBjYWxsYmFjawogICAgICAgICAgICAvLyAtLS0tLSBHZW5lcmF0ZSBhIGxvY2FsIGluZm9ybWF0aW9uCiAgICAgICAgICAgICR2X2xvY2FsX2hlYWRlciA9IGFycmF5KCk7CiAgICAgICAgICAgICR0aGlzLT5wcml2Q29udmVydEhlYWRlcjJGaWxlSW5mbygkcF9lbnRyeSwgJHZfbG9jYWxfaGVhZGVyKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIENhbGwgdGhlIGNhbGxiYWNrCiAgICAgICAgICAgIC8vIEhlcmUgSSBkbyBub3QgdXNlIGNhbGxfdXNlcl9mdW5jKCkgYmVjYXVzZSBJIG5lZWQgdG8gc2VuZCBhIHJlZmVyZW5jZSB0byB0aGUKICAgICAgICAgICAgLy8gaGVhZGVyLgogICAgLy8gICAgICAgICAgICBldmFsKCckdl9yZXN1bHQgPSAnLiRwX29wdGlvbnNbUENMWklQX0NCX1BPU1RfRVhUUkFDVF0uJyhQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNULCAkdl9sb2NhbF9oZWFkZXIpOycpOwogICAgICAgICAgICAkdl9yZXN1bHQgPSAkcF9vcHRpb25zW1BDTFpJUF9DQl9QT1NUX0VYVFJBQ1RdKFBDTFpJUF9DQl9QT1NUX0VYVFJBQ1QsICR2X2xvY2FsX2hlYWRlcik7CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhYm9ydCByZXN1bHQKICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdCA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0ID0gUENMWklQX0VSUl9VU0VSX0FCT1JURUQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZFeHRyYWN0RmlsZVVzaW5nVGVtcEZpbGUoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdkV4dHJhY3RGaWxlVXNpbmdUZW1wRmlsZSgmJHBfZW50cnksICYkcF9vcHRpb25zKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBDcmVhdGVzIGEgdGVtcG9yYXJ5IGZpbGUKICAgICAgICAkdl9nemlwX3RlbXBfbmFtZSA9IFBDTFpJUF9URU1QT1JBUllfRElSLnVuaXFpZCgncGNsemlwLScpLicuZ3onOwogICAgICAgIGlmICgoJHZfZGVzdF9maWxlID0gQGZvcGVuKCR2X2d6aXBfdGVtcF9uYW1lLCAid2IiKSkgPT0gMCkgewogICAgICAgICAgICBmY2xvc2UoJHZfZmlsZSk7CiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfV1JJVEVfT1BFTl9GQUlMLCAnVW5hYmxlIHRvIG9wZW4gdGVtcG9yYXJ5IGZpbGUgXCcnLiR2X2d6aXBfdGVtcF9uYW1lLidcJyBpbiBiaW5hcnkgd3JpdGUgbW9kZScpOwogICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFdyaXRlIGd6IGZpbGUgZm9ybWF0IGhlYWRlcgogICAgICAgICR2X2JpbmFyeV9kYXRhID0gcGFjaygndmExYTFWYTFhMScsIDB4OGIxZiwgQ2hyKCRwX2VudHJ5Wydjb21wcmVzc2lvbiddKSwgQ2hyKDB4MDApLCB0aW1lKCksIENocigweDAwKSwgQ2hyKDMpKTsKICAgICAgICBAZndyaXRlKCR2X2Rlc3RfZmlsZSwgJHZfYmluYXJ5X2RhdGEsIDEwKTsKCiAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgZmlsZSBieSBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFIG9jdGV0cyBibG9ja3MKICAgICAgICAkdl9zaXplID0gJHBfZW50cnlbJ2NvbXByZXNzZWRfc2l6ZSddOwogICAgICAgIHdoaWxlICgkdl9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCR2X3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHZfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBAZnJlYWQoJHRoaXMtPnppcF9mZCwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgLy8kdl9iaW5hcnlfZGF0YSA9IHBhY2soJ2EnLiR2X3JlYWRfc2l6ZSwgJHZfYnVmZmVyKTsKICAgICAgICAgICAgQGZ3cml0ZSgkdl9kZXN0X2ZpbGUsICR2X2J1ZmZlciwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgJHZfc2l6ZSAtPSAkdl9yZWFkX3NpemU7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBXcml0ZSBneiBmaWxlIGZvcm1hdCBmb290ZXIKICAgICAgICAkdl9iaW5hcnlfZGF0YSA9IHBhY2soJ1ZWJywgJHBfZW50cnlbJ2NyYyddLCAkcF9lbnRyeVsnc2l6ZSddKTsKICAgICAgICBAZndyaXRlKCR2X2Rlc3RfZmlsZSwgJHZfYmluYXJ5X2RhdGEsIDgpOwoKICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgdGVtcG9yYXJ5IGZpbGUKICAgICAgICBAZmNsb3NlKCR2X2Rlc3RfZmlsZSk7CgogICAgICAgIC8vIC0tLS0tIE9wZW5pbmcgZGVzdGluYXRpb24gZmlsZQogICAgICAgIGlmICgoJHZfZGVzdF9maWxlID0gQGZvcGVuKCRwX2VudHJ5WydmaWxlbmFtZSddLCAnd2InKSkgPT0gMCkgewogICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAid3JpdGVfZXJyb3IiOwogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gT3BlbiB0aGUgdGVtcG9yYXJ5IGd6IGZpbGUKICAgICAgICBpZiAoKCR2X3NyY19maWxlID0gQGd6b3Blbigkdl9nemlwX3RlbXBfbmFtZSwgJ3JiJykpID09IDApIHsKICAgICAgICAgICAgQGZjbG9zZSgkdl9kZXN0X2ZpbGUpOwogICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAicmVhZF9lcnJvciI7CiAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfUkVBRF9PUEVOX0ZBSUwsICdVbmFibGUgdG8gb3BlbiB0ZW1wb3JhcnkgZmlsZSBcJycuJHZfZ3ppcF90ZW1wX25hbWUuJ1wnIGluIGJpbmFyeSByZWFkIG1vZGUnKTsKICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBmaWxlIGJ5IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUgb2N0ZXRzIGJsb2NrcwogICAgICAgICR2X3NpemUgPSAkcF9lbnRyeVsnc2l6ZSddOwogICAgICAgIHdoaWxlICgkdl9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCR2X3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHZfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBAZ3pyZWFkKCR2X3NyY19maWxlLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAvLyR2X2JpbmFyeV9kYXRhID0gcGFjaygnYScuJHZfcmVhZF9zaXplLCAkdl9idWZmZXIpOwogICAgICAgICAgICBAZndyaXRlKCR2X2Rlc3RfZmlsZSwgJHZfYnVmZmVyLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAkdl9zaXplIC09ICR2X3JlYWRfc2l6ZTsKICAgICAgICB9CiAgICAgICAgQGZjbG9zZSgkdl9kZXN0X2ZpbGUpOwogICAgICAgIEBnemNsb3NlKCR2X3NyY19maWxlKTsKCiAgICAgICAgLy8gLS0tLS0gRGVsZXRlIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIEB1bmxpbmsoJHZfZ3ppcF90ZW1wX25hbWUpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2RXh0cmFjdEZpbGVJbk91dHB1dCgpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2RXh0cmFjdEZpbGVJbk91dHB1dCgmJHBfZW50cnksICYkcF9vcHRpb25zKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBmaWxlIGhlYWRlcgogICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZSZWFkRmlsZUhlYWRlcigkdl9oZWFkZXIpKSAhPSAxKSB7CiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGF0IHRoZSBmaWxlIGhlYWRlciBpcyBjb2hlcmVudCB3aXRoICRwX2VudHJ5IGluZm8KICAgICAgICBpZiAoJHRoaXMtPnByaXZDaGVja0ZpbGVIZWFkZXJzKCR2X2hlYWRlciwgJHBfZW50cnkpICE9IDEpIHsKICAgICAgICAgICAgLy8gVEJDCiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBwcmUtZXh0cmFjdCBjYWxsYmFjawogICAgICAgIGlmIChpc3NldCgkcF9vcHRpb25zW1BDTFpJUF9DQl9QUkVfRVhUUkFDVF0pKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEdlbmVyYXRlIGEgbG9jYWwgaW5mb3JtYXRpb24KICAgICAgICAgICAgJHZfbG9jYWxfaGVhZGVyID0gYXJyYXkoKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCRwX2VudHJ5LCAkdl9sb2NhbF9oZWFkZXIpOwoKICAgICAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgY2FsbGJhY2sKICAgICAgICAgICAgLy8gSGVyZSBJIGRvIG5vdCB1c2UgY2FsbF91c2VyX2Z1bmMoKSBiZWNhdXNlIEkgbmVlZCB0byBzZW5kIGEgcmVmZXJlbmNlIHRvIHRoZQogICAgICAgICAgICAvLyBoZWFkZXIuCiAgICAvLyAgICAgICAgICAgIGV2YWwoJyR2X3Jlc3VsdCA9ICcuJHBfb3B0aW9uc1tQQ0xaSVBfQ0JfUFJFX0VYVFJBQ1RdLicoUENMWklQX0NCX1BSRV9FWFRSQUNULCAkdl9sb2NhbF9oZWFkZXIpOycpOwogICAgICAgICAgICAkdl9yZXN1bHQgPSAkcF9vcHRpb25zW1BDTFpJUF9DQl9QUkVfRVhUUkFDVF0oUENMWklQX0NCX1BSRV9FWFRSQUNULCAkdl9sb2NhbF9oZWFkZXIpOwogICAgICAgICAgICBpZiAoJHZfcmVzdWx0ID09IDApIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoYW5nZSB0aGUgZmlsZSBzdGF0dXMKICAgICAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJza2lwcGVkIjsKICAgICAgICAgICAgICAgICR2X3Jlc3VsdCA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGFib3J0IHJlc3VsdAogICAgICAgICAgICBpZiAoJHZfcmVzdWx0ID09IDIpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFRoaXMgc3RhdHVzIGlzIGludGVybmFsIGFuZCB3aWxsIGJlIGNoYW5nZWQgaW4gJ3NraXBwZWQnCiAgICAgICAgICAgICAgICAkcF9lbnRyeVsnc3RhdHVzJ10gPSAiYWJvcnRlZCI7CiAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0ID0gUENMWklQX0VSUl9VU0VSX0FCT1JURUQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIFVwZGF0ZSB0aGUgaW5mb3JtYXRpb25zCiAgICAgICAgICAgIC8vIE9ubHkgc29tZSBmaWVsZHMgY2FuIGJlIG1vZGlmaWVkCiAgICAgICAgICAgICRwX2VudHJ5WydmaWxlbmFtZSddID0gJHZfbG9jYWxfaGVhZGVyWydmaWxlbmFtZSddOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gVHJhY2UKCiAgICAgICAgLy8gLS0tLS0gTG9vayBpZiBleHRyYWN0aW9uIHNob3VsZCBiZSBkb25lCiAgICAgICAgaWYgKCRwX2VudHJ5WydzdGF0dXMnXSA9PSAnb2snKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIERvIHRoZSBleHRyYWN0aW9uIChpZiBub3QgYSBmb2xkZXIpCiAgICAgICAgICAgIGlmICghKCgkcF9lbnRyeVsnZXh0ZXJuYWwnXSYweDAwMDAwMDEwKT09MHgwMDAwMDAxMCkpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIG5vdCBjb21wcmVzc2VkIGZpbGUKICAgICAgICAgICAgICAgIGlmICgkcF9lbnRyeVsnY29tcHJlc3NlZF9zaXplJ10gPT0gJHBfZW50cnlbJ3NpemUnXSkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGZpbGUgaW4gYSBidWZmZXIgKG9uZSBzaG90KQogICAgICAgICAgICAgICAgICAgICR2X2J1ZmZlciA9IEBmcmVhZCgkdGhpcy0+emlwX2ZkLCAkcF9lbnRyeVsnY29tcHJlc3NlZF9zaXplJ10pOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBTZW5kIHRoZSBmaWxlIHRvIHRoZSBvdXRwdXQKICAgICAgICAgICAgICAgICAgICBlY2hvICR2X2J1ZmZlcjsKICAgICAgICAgICAgICAgICAgICB1bnNldCgkdl9idWZmZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBjb21wcmVzc2VkIGZpbGUgaW4gYSBidWZmZXIgKG9uZSBzaG90KQogICAgICAgICAgICAgICAgICAgICR2X2J1ZmZlciA9IEBmcmVhZCgkdGhpcy0+emlwX2ZkLCAkcF9lbnRyeVsnY29tcHJlc3NlZF9zaXplJ10pOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBEZWNvbXByZXNzIHRoZSBmaWxlCiAgICAgICAgICAgICAgICAgICAgJHZfZmlsZV9jb250ZW50ID0gZ3ppbmZsYXRlKCR2X2J1ZmZlcik7CiAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHZfYnVmZmVyKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gU2VuZCB0aGUgZmlsZSB0byB0aGUgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgZWNobyAkdl9maWxlX2NvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHZfZmlsZV9jb250ZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIGFib3J0IHN0YXR1cwogICAgICAgIGlmICgkcF9lbnRyeVsnc3RhdHVzJ10gPT0gImFib3J0ZWQiKSB7CiAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJza2lwcGVkIjsKICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNUXSkpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgcG9zdC1leHRyYWN0IGNhbGxiYWNrCgogICAgICAgICAgICAvLyAtLS0tLSBHZW5lcmF0ZSBhIGxvY2FsIGluZm9ybWF0aW9uCiAgICAgICAgICAgICR2X2xvY2FsX2hlYWRlciA9IGFycmF5KCk7CiAgICAgICAgICAgICR0aGlzLT5wcml2Q29udmVydEhlYWRlcjJGaWxlSW5mbygkcF9lbnRyeSwgJHZfbG9jYWxfaGVhZGVyKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIENhbGwgdGhlIGNhbGxiYWNrCiAgICAgICAgICAgIC8vIEhlcmUgSSBkbyBub3QgdXNlIGNhbGxfdXNlcl9mdW5jKCkgYmVjYXVzZSBJIG5lZWQgdG8gc2VuZCBhIHJlZmVyZW5jZSB0byB0aGUKICAgICAgICAgICAgLy8gaGVhZGVyLgogICAgLy8gICAgICAgICAgICBldmFsKCckdl9yZXN1bHQgPSAnLiRwX29wdGlvbnNbUENMWklQX0NCX1BPU1RfRVhUUkFDVF0uJyhQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNULCAkdl9sb2NhbF9oZWFkZXIpOycpOwogICAgICAgICAgICAkdl9yZXN1bHQgPSAkcF9vcHRpb25zW1BDTFpJUF9DQl9QT1NUX0VYVFJBQ1RdKFBDTFpJUF9DQl9QT1NUX0VYVFJBQ1QsICR2X2xvY2FsX2hlYWRlcik7CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhYm9ydCByZXN1bHQKICAgICAgICAgICAgaWYgKCR2X3Jlc3VsdCA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfcmVzdWx0ID0gUENMWklQX0VSUl9VU0VSX0FCT1JURUQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZFeHRyYWN0RmlsZUFzU3RyaW5nKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZFeHRyYWN0RmlsZUFzU3RyaW5nKCYkcF9lbnRyeSwgJiRwX3N0cmluZywgJiRwX29wdGlvbnMpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGZpbGUgaGVhZGVyCiAgICAgICAgJHZfaGVhZGVyID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2UmVhZEZpbGVIZWFkZXIoJHZfaGVhZGVyKSkgIT0gMSkgewogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENoZWNrIHRoYXQgdGhlIGZpbGUgaGVhZGVyIGlzIGNvaGVyZW50IHdpdGggJHBfZW50cnkgaW5mbwogICAgICAgIGlmICgkdGhpcy0+cHJpdkNoZWNrRmlsZUhlYWRlcnMoJHZfaGVhZGVyLCAkcF9lbnRyeSkgIT0gMSkgewogICAgICAgICAgICAvLyBUQkMKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHByZS1leHRyYWN0IGNhbGxiYWNrCiAgICAgICAgaWYgKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX0NCX1BSRV9FWFRSQUNUXSkpIHsKICAgICAgICAgICAgLy8gLS0tLS0gR2VuZXJhdGUgYSBsb2NhbCBpbmZvcm1hdGlvbgogICAgICAgICAgICAkdl9sb2NhbF9oZWFkZXIgPSBhcnJheSgpOwogICAgICAgICAgICAkdGhpcy0+cHJpdkNvbnZlcnRIZWFkZXIyRmlsZUluZm8oJHBfZW50cnksICR2X2xvY2FsX2hlYWRlcik7CgogICAgICAgICAgICAvLyAtLS0tLSBDYWxsIHRoZSBjYWxsYmFjawogICAgICAgICAgICAvLyBIZXJlIEkgZG8gbm90IHVzZSBjYWxsX3VzZXJfZnVuYygpIGJlY2F1c2UgSSBuZWVkIHRvIHNlbmQgYSByZWZlcmVuY2UgdG8gdGhlCiAgICAgICAgICAgIC8vIGhlYWRlci4KICAgIC8vICAgICAgICAgICAgZXZhbCgnJHZfcmVzdWx0ID0gJy4kcF9vcHRpb25zW1BDTFpJUF9DQl9QUkVfRVhUUkFDVF0uJyhQQ0xaSVBfQ0JfUFJFX0VYVFJBQ1QsICR2X2xvY2FsX2hlYWRlcik7Jyk7CiAgICAgICAgICAgICR2X3Jlc3VsdCA9ICRwX29wdGlvbnNbUENMWklQX0NCX1BSRV9FWFRSQUNUXShQQ0xaSVBfQ0JfUFJFX0VYVFJBQ1QsICR2X2xvY2FsX2hlYWRlcik7CiAgICAgICAgICAgIGlmICgkdl9yZXN1bHQgPT0gMCkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIHRoZSBmaWxlIHN0YXR1cwogICAgICAgICAgICAgICAgJHBfZW50cnlbJ3N0YXR1cyddID0gInNraXBwZWQiOwogICAgICAgICAgICAgICAgJHZfcmVzdWx0ID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgYWJvcnQgcmVzdWx0CiAgICAgICAgICAgIGlmICgkdl9yZXN1bHQgPT0gMikgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gVGhpcyBzdGF0dXMgaXMgaW50ZXJuYWwgYW5kIHdpbGwgYmUgY2hhbmdlZCBpbiAnc2tpcHBlZCcKICAgICAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJhYm9ydGVkIjsKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSBQQ0xaSVBfRVJSX1VTRVJfQUJPUlRFRDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gVXBkYXRlIHRoZSBpbmZvcm1hdGlvbnMKICAgICAgICAgICAgLy8gT25seSBzb21lIGZpZWxkcyBjYW4gYmUgbW9kaWZpZWQKICAgICAgICAgICAgJHBfZW50cnlbJ2ZpbGVuYW1lJ10gPSAkdl9sb2NhbF9oZWFkZXJbJ2ZpbGVuYW1lJ107CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIGV4dHJhY3Rpb24gc2hvdWxkIGJlIGRvbmUKICAgICAgICBpZiAoJHBfZW50cnlbJ3N0YXR1cyddID09ICdvaycpIHsKICAgICAgICAgICAgLy8gLS0tLS0gRG8gdGhlIGV4dHJhY3Rpb24gKGlmIG5vdCBhIGZvbGRlcikKICAgICAgICAgICAgaWYgKCEoKCRwX2VudHJ5WydleHRlcm5hbCddJjB4MDAwMDAwMTApPT0weDAwMDAwMDEwKSkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3Igbm90IGNvbXByZXNzZWQgZmlsZQogICAgLy8gICAgICAgICAgICBpZiAoJHBfZW50cnlbJ2NvbXByZXNzZWRfc2l6ZSddID09ICRwX2VudHJ5WydzaXplJ10pCiAgICAgICAgICAgICAgICBpZiAoJHBfZW50cnlbJ2NvbXByZXNzaW9uJ10gPT0gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJlYWRpbmcgdGhlIGZpbGUKICAgICAgICAgICAgICAgICAgICAkcF9zdHJpbmcgPSBAZnJlYWQoJHRoaXMtPnppcF9mZCwgJHBfZW50cnlbJ2NvbXByZXNzZWRfc2l6ZSddKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmVhZGluZyB0aGUgZmlsZQogICAgICAgICAgICAgICAgICAgICR2X2RhdGEgPSBAZnJlYWQoJHRoaXMtPnppcF9mZCwgJHBfZW50cnlbJ2NvbXByZXNzZWRfc2l6ZSddKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRGVjb21wcmVzcyB0aGUgZmlsZQogICAgICAgICAgICAgICAgICAgIGlmICgoJHBfc3RyaW5nID0gQGd6aW5mbGF0ZSgkdl9kYXRhKSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRCQwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIC0tLS0tIFRyYWNlCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVEJDIDogZXJyb3IgOiBjYW4gbm90IGV4dHJhY3QgYSBmb2xkZXIgaW4gYSBzdHJpbmcKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIGFib3J0IHN0YXR1cwogICAgICAgIGlmICgkcF9lbnRyeVsnc3RhdHVzJ10gPT0gImFib3J0ZWQiKSB7CiAgICAgICAgICAgICRwX2VudHJ5WydzdGF0dXMnXSA9ICJza2lwcGVkIjsKICAgICAgICB9IGVsc2VpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNUXSkpIHsKICAgICAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgcG9zdC1leHRyYWN0IGNhbGxiYWNrCiAgICAgICAgICAgIC8vIC0tLS0tIEdlbmVyYXRlIGEgbG9jYWwgaW5mb3JtYXRpb24KICAgICAgICAgICAgJHZfbG9jYWxfaGVhZGVyID0gYXJyYXkoKTsKICAgICAgICAgICAgJHRoaXMtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCRwX2VudHJ5LCAkdl9sb2NhbF9oZWFkZXIpOwoKICAgICAgICAgICAgLy8gLS0tLS0gU3dhcCB0aGUgY29udGVudCB0byBoZWFkZXIKICAgICAgICAgICAgJHZfbG9jYWxfaGVhZGVyWydjb250ZW50J10gPSAkcF9zdHJpbmc7CiAgICAgICAgICAgICRwX3N0cmluZyA9ICcnOwoKICAgICAgICAgICAgLy8gLS0tLS0gQ2FsbCB0aGUgY2FsbGJhY2sKICAgICAgICAgICAgLy8gSGVyZSBJIGRvIG5vdCB1c2UgY2FsbF91c2VyX2Z1bmMoKSBiZWNhdXNlIEkgbmVlZCB0byBzZW5kIGEgcmVmZXJlbmNlIHRvIHRoZQogICAgICAgICAgICAvLyBoZWFkZXIuCiAgICAvLyAgICAgICAgICAgIGV2YWwoJyR2X3Jlc3VsdCA9ICcuJHBfb3B0aW9uc1tQQ0xaSVBfQ0JfUE9TVF9FWFRSQUNUXS4nKFBDTFpJUF9DQl9QT1NUX0VYVFJBQ1QsICR2X2xvY2FsX2hlYWRlcik7Jyk7CiAgICAgICAgICAgICR2X3Jlc3VsdCA9ICRwX29wdGlvbnNbUENMWklQX0NCX1BPU1RfRVhUUkFDVF0oUENMWklQX0NCX1BPU1RfRVhUUkFDVCwgJHZfbG9jYWxfaGVhZGVyKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFN3YXAgYmFjayB0aGUgY29udGVudCB0byBoZWFkZXIKICAgICAgICAgICAgJHBfc3RyaW5nID0gJHZfbG9jYWxfaGVhZGVyWydjb250ZW50J107CiAgICAgICAgICAgIHVuc2V0KCR2X2xvY2FsX2hlYWRlclsnY29udGVudCddKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGFib3J0IHJlc3VsdAogICAgICAgICAgICBpZiAoJHZfcmVzdWx0ID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSBQQ0xaSVBfRVJSX1VTRVJfQUJPUlRFRDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdlJlYWRGaWxlSGVhZGVyKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZSZWFkRmlsZUhlYWRlcigmJHBfaGVhZGVyKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSA0IGJ5dGVzIHNpZ25hdHVyZQogICAgICAgICR2X2JpbmFyeV9kYXRhID0gQGZyZWFkKCR0aGlzLT56aXBfZmQsIDQpOwogICAgICAgICR2X2RhdGEgPSB1bnBhY2soJ1ZpZCcsICR2X2JpbmFyeV9kYXRhKTsKCiAgICAgICAgLy8gLS0tLS0gQ2hlY2sgc2lnbmF0dXJlCiAgICAgICAgaWYgKCR2X2RhdGFbJ2lkJ10gIT0gMHgwNDAzNGI1MCkgewogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9CQURfRk9STUFULCAnSW52YWxpZCBhcmNoaXZlIHN0cnVjdHVyZScpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgZmlyc3QgNDIgYnl0ZXMgb2YgdGhlIGhlYWRlcgogICAgICAgICR2X2JpbmFyeV9kYXRhID0gZnJlYWQoJHRoaXMtPnppcF9mZCwgMjYpOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBpbnZhbGlkIGJsb2NrIHNpemUKICAgICAgICBpZiAoc3RybGVuKCR2X2JpbmFyeV9kYXRhKSAhPSAyNikgewogICAgICAgICAgICAkcF9oZWFkZXJbJ2ZpbGVuYW1lJ10gPSAiIjsKICAgICAgICAgICAgJHBfaGVhZGVyWydzdGF0dXMnXSA9ICJpbnZhbGlkX2hlYWRlciI7CgogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9CQURfRk9STUFULCAiSW52YWxpZCBibG9jayBzaXplIDogIi5zdHJsZW4oJHZfYmluYXJ5X2RhdGEpKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEV4dHJhY3QgdGhlIHZhbHVlcwogICAgICAgICR2X2RhdGEgPSB1bnBhY2soJ3Z2ZXJzaW9uL3ZmbGFnL3Zjb21wcmVzc2lvbi92bXRpbWUvdm1kYXRlL1ZjcmMvVmNvbXByZXNzZWRfc2l6ZS9Wc2l6ZS92ZmlsZW5hbWVfbGVuL3ZleHRyYV9sZW4nLCAkdl9iaW5hcnlfZGF0YSk7CgogICAgICAgIC8vIC0tLS0tIEdldCBmaWxlbmFtZQogICAgICAgICRwX2hlYWRlclsnZmlsZW5hbWUnXSA9IGZyZWFkKCR0aGlzLT56aXBfZmQsICR2X2RhdGFbJ2ZpbGVuYW1lX2xlbiddKTsKCiAgICAgICAgLy8gLS0tLS0gR2V0IGV4dHJhX2ZpZWxkcwogICAgICAgIGlmICgkdl9kYXRhWydleHRyYV9sZW4nXSAhPSAwKSB7CiAgICAgICAgICAgICRwX2hlYWRlclsnZXh0cmEnXSA9IGZyZWFkKCR0aGlzLT56aXBfZmQsICR2X2RhdGFbJ2V4dHJhX2xlbiddKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcF9oZWFkZXJbJ2V4dHJhJ10gPSAnJzsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEV4dHJhY3QgcHJvcGVydGllcwogICAgICAgICRwX2hlYWRlclsndmVyc2lvbl9leHRyYWN0ZWQnXSA9ICR2X2RhdGFbJ3ZlcnNpb24nXTsKICAgICAgICAkcF9oZWFkZXJbJ2NvbXByZXNzaW9uJ10gPSAkdl9kYXRhWydjb21wcmVzc2lvbiddOwogICAgICAgICRwX2hlYWRlclsnc2l6ZSddID0gJHZfZGF0YVsnc2l6ZSddOwogICAgICAgICRwX2hlYWRlclsnY29tcHJlc3NlZF9zaXplJ10gPSAkdl9kYXRhWydjb21wcmVzc2VkX3NpemUnXTsKICAgICAgICAkcF9oZWFkZXJbJ2NyYyddID0gJHZfZGF0YVsnY3JjJ107CiAgICAgICAgJHBfaGVhZGVyWydmbGFnJ10gPSAkdl9kYXRhWydmbGFnJ107CiAgICAgICAgJHBfaGVhZGVyWydmaWxlbmFtZV9sZW4nXSA9ICR2X2RhdGFbJ2ZpbGVuYW1lX2xlbiddOwoKICAgICAgICAvLyAtLS0tLSBSZWN1cGVyYXRlIGRhdGUgaW4gVU5JWCBmb3JtYXQKICAgICAgICAkcF9oZWFkZXJbJ21kYXRlJ10gPSAkdl9kYXRhWydtZGF0ZSddOwogICAgICAgICRwX2hlYWRlclsnbXRpbWUnXSA9ICR2X2RhdGFbJ210aW1lJ107CiAgICAgICAgaWYgKCRwX2hlYWRlclsnbWRhdGUnXSAmJiAkcF9oZWFkZXJbJ210aW1lJ10pIHsKICAgICAgICAgICAgLy8gLS0tLS0gRXh0cmFjdCB0aW1lCiAgICAgICAgICAgICR2X2hvdXIgPSAoJHBfaGVhZGVyWydtdGltZSddICYgMHhGODAwKSA+PiAxMTsKICAgICAgICAgICAgJHZfbWludXRlID0gKCRwX2hlYWRlclsnbXRpbWUnXSAmIDB4MDdFMCkgPj4gNTsKICAgICAgICAgICAgJHZfc2Vjb25kZSA9ICgkcF9oZWFkZXJbJ210aW1lJ10gJiAweDAwMUYpKjI7CgogICAgICAgICAgICAvLyAtLS0tLSBFeHRyYWN0IGRhdGUKICAgICAgICAgICAgJHZfeWVhciA9ICgoJHBfaGVhZGVyWydtZGF0ZSddICYgMHhGRTAwKSA+PiA5KSArIDE5ODA7CiAgICAgICAgICAgICR2X21vbnRoID0gKCRwX2hlYWRlclsnbWRhdGUnXSAmIDB4MDFFMCkgPj4gNTsKICAgICAgICAgICAgJHZfZGF5ID0gJHBfaGVhZGVyWydtZGF0ZSddICYgMHgwMDFGOwoKICAgICAgICAgICAgLy8gLS0tLS0gR2V0IFVOSVggZGF0ZSBmb3JtYXQKICAgICAgICAgICAgJHBfaGVhZGVyWydtdGltZSddID0gQG1rdGltZSgkdl9ob3VyLCAkdl9taW51dGUsICR2X3NlY29uZGUsICR2X21vbnRoLCAkdl9kYXksICR2X3llYXIpOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcF9oZWFkZXJbJ210aW1lJ10gPSB0aW1lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBUQkMKICAgICAgICAvL2ZvcihyZXNldCgkdl9kYXRhKTsgJGtleSA9IGtleSgkdl9kYXRhKTsgbmV4dCgkdl9kYXRhKSkgewogICAgICAgIC8vfQoKICAgICAgICAvLyAtLS0tLSBTZXQgdGhlIHN0b3JlZCBmaWxlbmFtZQogICAgICAgICRwX2hlYWRlclsnc3RvcmVkX2ZpbGVuYW1lJ10gPSAkcF9oZWFkZXJbJ2ZpbGVuYW1lJ107CgogICAgICAgIC8vIC0tLS0tIFNldCB0aGUgc3RhdHVzIGZpZWxkCiAgICAgICAgJHBfaGVhZGVyWydzdGF0dXMnXSA9ICJvayI7CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZSZWFkQ2VudHJhbEZpbGVIZWFkZXIoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdlJlYWRDZW50cmFsRmlsZUhlYWRlcigmJHBfaGVhZGVyKQogICAgewogICAgICAgICR2X3Jlc3VsdCA9IDE7CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIDQgYnl0ZXMgc2lnbmF0dXJlCiAgICAgICAgJHZfYmluYXJ5X2RhdGEgPSBAZnJlYWQoJHRoaXMtPnppcF9mZCwgNCk7CiAgICAgICAgJHZfZGF0YSA9IHVucGFjaygnVmlkJywgJHZfYmluYXJ5X2RhdGEpOwoKICAgICAgICAvLyAtLS0tLSBDaGVjayBzaWduYXR1cmUKICAgICAgICBpZiAoJHZfZGF0YVsnaWQnXSAhPSAweDAyMDE0YjUwKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0JBRF9GT1JNQVQsICdJbnZhbGlkIGFyY2hpdmUgc3RydWN0dXJlJyk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBmaXJzdCA0MiBieXRlcyBvZiB0aGUgaGVhZGVyCiAgICAgICAgJHZfYmluYXJ5X2RhdGEgPSBmcmVhZCgkdGhpcy0+emlwX2ZkLCA0Mik7CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGludmFsaWQgYmxvY2sgc2l6ZQogICAgICAgIGlmIChzdHJsZW4oJHZfYmluYXJ5X2RhdGEpICE9IDQyKSB7CiAgICAgICAgICAgICRwX2hlYWRlclsnZmlsZW5hbWUnXSA9ICIiOwogICAgICAgICAgICAkcF9oZWFkZXJbJ3N0YXR1cyddID0gImludmFsaWRfaGVhZGVyIjsKCiAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX0JBRF9GT1JNQVQsICJJbnZhbGlkIGJsb2NrIHNpemUgOiAiLnN0cmxlbigkdl9iaW5hcnlfZGF0YSkpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gRXh0cmFjdCB0aGUgdmFsdWVzCiAgICAgICAgJHBfaGVhZGVyID0gdW5wYWNrKCd2dmVyc2lvbi92dmVyc2lvbl9leHRyYWN0ZWQvdmZsYWcvdmNvbXByZXNzaW9uL3ZtdGltZS92bWRhdGUvVmNyYy9WY29tcHJlc3NlZF9zaXplL1ZzaXplL3ZmaWxlbmFtZV9sZW4vdmV4dHJhX2xlbi92Y29tbWVudF9sZW4vdmRpc2svdmludGVybmFsL1ZleHRlcm5hbC9Wb2Zmc2V0JywgJHZfYmluYXJ5X2RhdGEpOwoKICAgICAgICAvLyAtLS0tLSBHZXQgZmlsZW5hbWUKICAgICAgICBpZiAoJHBfaGVhZGVyWydmaWxlbmFtZV9sZW4nXSAhPSAwKSB7CiAgICAgICAgICAgICRwX2hlYWRlclsnZmlsZW5hbWUnXSA9IGZyZWFkKCR0aGlzLT56aXBfZmQsICRwX2hlYWRlclsnZmlsZW5hbWVfbGVuJ10pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwX2hlYWRlclsnZmlsZW5hbWUnXSA9ICcnOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gR2V0IGV4dHJhCiAgICAgICAgaWYgKCRwX2hlYWRlclsnZXh0cmFfbGVuJ10gIT0gMCkgewogICAgICAgICAgICAkcF9oZWFkZXJbJ2V4dHJhJ10gPSBmcmVhZCgkdGhpcy0+emlwX2ZkLCAkcF9oZWFkZXJbJ2V4dHJhX2xlbiddKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcF9oZWFkZXJbJ2V4dHJhJ10gPSAnJzsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEdldCBjb21tZW50CiAgICAgICAgaWYgKCRwX2hlYWRlclsnY29tbWVudF9sZW4nXSAhPSAwKSB7CiAgICAgICAgICAgICRwX2hlYWRlclsnY29tbWVudCddID0gZnJlYWQoJHRoaXMtPnppcF9mZCwgJHBfaGVhZGVyWydjb21tZW50X2xlbiddKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcF9oZWFkZXJbJ2NvbW1lbnQnXSA9ICcnOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gRXh0cmFjdCBwcm9wZXJ0aWVzCgogICAgICAgIC8vIC0tLS0tIFJlY3VwZXJhdGUgZGF0ZSBpbiBVTklYIGZvcm1hdAogICAgICAgIC8vaWYgKCRwX2hlYWRlclsnbWRhdGUnXSAmJiAkcF9oZWFkZXJbJ210aW1lJ10pCiAgICAgICAgLy8gVEJDIDogYnVnIDogdGhpcyB3YXMgaWdub3JpbmcgdGltZSB3aXRoIDAvMC8wCiAgICAgICAgaWYgKDEpIHsKICAgICAgICAgICAgLy8gLS0tLS0gRXh0cmFjdCB0aW1lCiAgICAgICAgICAgICR2X2hvdXIgPSAoJHBfaGVhZGVyWydtdGltZSddICYgMHhGODAwKSA+PiAxMTsKICAgICAgICAgICAgJHZfbWludXRlID0gKCRwX2hlYWRlclsnbXRpbWUnXSAmIDB4MDdFMCkgPj4gNTsKICAgICAgICAgICAgJHZfc2Vjb25kZSA9ICgkcF9oZWFkZXJbJ210aW1lJ10gJiAweDAwMUYpKjI7CgogICAgICAgICAgICAvLyAtLS0tLSBFeHRyYWN0IGRhdGUKICAgICAgICAgICAgJHZfeWVhciA9ICgoJHBfaGVhZGVyWydtZGF0ZSddICYgMHhGRTAwKSA+PiA5KSArIDE5ODA7CiAgICAgICAgICAgICR2X21vbnRoID0gKCRwX2hlYWRlclsnbWRhdGUnXSAmIDB4MDFFMCkgPj4gNTsKICAgICAgICAgICAgJHZfZGF5ID0gJHBfaGVhZGVyWydtZGF0ZSddICYgMHgwMDFGOwoKICAgICAgICAgICAgLy8gLS0tLS0gR2V0IFVOSVggZGF0ZSBmb3JtYXQKICAgICAgICAgICAgJHBfaGVhZGVyWydtdGltZSddID0gQG1rdGltZSgkdl9ob3VyLCAkdl9taW51dGUsICR2X3NlY29uZGUsICR2X21vbnRoLCAkdl9kYXksICR2X3llYXIpOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcF9oZWFkZXJbJ210aW1lJ10gPSB0aW1lKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBTZXQgdGhlIHN0b3JlZCBmaWxlbmFtZQogICAgICAgICRwX2hlYWRlclsnc3RvcmVkX2ZpbGVuYW1lJ10gPSAkcF9oZWFkZXJbJ2ZpbGVuYW1lJ107CgogICAgICAgIC8vIC0tLS0tIFNldCBkZWZhdWx0IHN0YXR1cyB0byBvawogICAgICAgICRwX2hlYWRlclsnc3RhdHVzJ10gPSAnb2snOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIGl0IGlzIGEgZGlyZWN0b3J5CiAgICAgICAgaWYgKHN1YnN0cigkcF9oZWFkZXJbJ2ZpbGVuYW1lJ10sIC0xKSA9PSAnLycpIHsKICAgICAgICAgICAgLy8kcF9oZWFkZXJbJ2V4dGVybmFsJ10gPSAweDQxRkYwMDEwOwogICAgICAgICAgICAkcF9oZWFkZXJbJ2V4dGVybmFsJ10gPSAweDAwMDAwMDEwOwogICAgICAgIH0KCgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZDaGVja0ZpbGVIZWFkZXJzKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vIFBhcmFtZXRlcnMgOgogICAgLy8gUmV0dXJuIFZhbHVlcyA6CiAgICAvLyAgICAgMSBvbiBzdWNjZXNzLAogICAgLy8gICAgIDAgb24gZXJyb3I7CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZDaGVja0ZpbGVIZWFkZXJzKCYkcF9sb2NhbF9oZWFkZXIsICYkcF9jZW50cmFsX2hlYWRlcikKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gQ2hlY2sgdGhlIHN0YXRpYyB2YWx1ZXMKICAgICAgICAvLyBUQkMKICAgICAgICBpZiAoJHBfbG9jYWxfaGVhZGVyWydmaWxlbmFtZSddICE9ICRwX2NlbnRyYWxfaGVhZGVyWydmaWxlbmFtZSddKSB7CiAgICAgICAgfQogICAgICAgIGlmICgkcF9sb2NhbF9oZWFkZXJbJ3ZlcnNpb25fZXh0cmFjdGVkJ10gIT0gJHBfY2VudHJhbF9oZWFkZXJbJ3ZlcnNpb25fZXh0cmFjdGVkJ10pIHsKICAgICAgICB9CiAgICAgICAgaWYgKCRwX2xvY2FsX2hlYWRlclsnZmxhZyddICE9ICRwX2NlbnRyYWxfaGVhZGVyWydmbGFnJ10pIHsKICAgICAgICB9CiAgICAgICAgaWYgKCRwX2xvY2FsX2hlYWRlclsnY29tcHJlc3Npb24nXSAhPSAkcF9jZW50cmFsX2hlYWRlclsnY29tcHJlc3Npb24nXSkgewogICAgICAgIH0KICAgICAgICBpZiAoJHBfbG9jYWxfaGVhZGVyWydtdGltZSddICE9ICRwX2NlbnRyYWxfaGVhZGVyWydtdGltZSddKSB7CiAgICAgICAgfQogICAgICAgIGlmICgkcF9sb2NhbF9oZWFkZXJbJ2ZpbGVuYW1lX2xlbiddICE9ICRwX2NlbnRyYWxfaGVhZGVyWydmaWxlbmFtZV9sZW4nXSkgewogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gTG9vayBmb3IgZmxhZyBiaXQgMwogICAgICAgIGlmICgoJHBfbG9jYWxfaGVhZGVyWydmbGFnJ10gJiA4KSA9PSA4KSB7CiAgICAgICAgICAgICRwX2xvY2FsX2hlYWRlclsnc2l6ZSddID0gJHBfY2VudHJhbF9oZWFkZXJbJ3NpemUnXTsKICAgICAgICAgICAgJHBfbG9jYWxfaGVhZGVyWydjb21wcmVzc2VkX3NpemUnXSA9ICRwX2NlbnRyYWxfaGVhZGVyWydjb21wcmVzc2VkX3NpemUnXTsKICAgICAgICAgICAgJHBfbG9jYWxfaGVhZGVyWydjcmMnXSA9ICRwX2NlbnRyYWxfaGVhZGVyWydjcmMnXTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZSZWFkRW5kQ2VudHJhbERpcigpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2UmVhZEVuZENlbnRyYWxEaXIoJiRwX2NlbnRyYWxfZGlyKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBHbyB0byB0aGUgZW5kIG9mIHRoZSB6aXAgZmlsZQogICAgICAgICR2X3NpemUgPSBmaWxlc2l6ZSgkdGhpcy0+emlwbmFtZSk7CiAgICAgICAgQGZzZWVrKCR0aGlzLT56aXBfZmQsICR2X3NpemUpOwogICAgICAgIGlmIChAZnRlbGwoJHRoaXMtPnppcF9mZCkgIT0gJHZfc2l6ZSkgewogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9CQURfRk9STUFULCAnVW5hYmxlIHRvIGdvIHRvIHRoZSBlbmQgb2YgdGhlIGFyY2hpdmUgXCcnLiR0aGlzLT56aXBuYW1lLidcJycpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gRmlyc3QgdHJ5IDogbG9vayBpZiB0aGlzIGlzIGFuIGFyY2hpdmUgd2l0aCBubyBjb21tZW50YXJpZXMgKG1vc3Qgb2YgdGhlIHRpbWUpCiAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHRoZSBlbmQgb2YgY2VudHJhbCBkaXIgaXMgYXQgMjIgYnl0ZXMgb2YgdGhlIGZpbGUgZW5kCiAgICAgICAgJHZfZm91bmQgPSAwOwogICAgICAgIGlmICgkdl9zaXplID4gMjYpIHsKICAgICAgICAgICAgQGZzZWVrKCR0aGlzLT56aXBfZmQsICR2X3NpemUtMjIpOwogICAgICAgICAgICBpZiAoKCR2X3BvcyA9IEBmdGVsbCgkdGhpcy0+emlwX2ZkKSkgIT0gKCR2X3NpemUtMjIpKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfQkFEX0ZPUk1BVCwgJ1VuYWJsZSB0byBzZWVrIGJhY2sgdG8gdGhlIG1pZGRsZSBvZiB0aGUgYXJjaGl2ZSBcJycuJHRoaXMtPnppcG5hbWUuJ1wnJyk7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gUmVhZCBmb3IgYnl0ZXMKICAgICAgICAgICAgJHZfYmluYXJ5X2RhdGEgPSBAZnJlYWQoJHRoaXMtPnppcF9mZCwgNCk7CiAgICAgICAgICAgICR2X2RhdGEgPSBAdW5wYWNrKCdWaWQnLCAkdl9iaW5hcnlfZGF0YSk7CgogICAgICAgICAgICAvLyAtLS0tLSBDaGVjayBzaWduYXR1cmUKICAgICAgICAgICAgaWYgKCR2X2RhdGFbJ2lkJ10gPT0gMHgwNjA1NGI1MCkgewogICAgICAgICAgICAgICAgJHZfZm91bmQgPSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdl9wb3MgPSBmdGVsbCgkdGhpcy0+emlwX2ZkKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEdvIGJhY2sgdG8gdGhlIG1heGltdW0gcG9zc2libGUgc2l6ZSBvZiB0aGUgQ2VudHJhbCBEaXIgRW5kIFJlY29yZAogICAgICAgIGlmICghJHZfZm91bmQpIHsKICAgICAgICAgICAgJHZfbWF4aW11bV9zaXplID0gNjU1NTc7IC8vIDB4RkZGRiArIDIyOwogICAgICAgICAgICBpZiAoJHZfbWF4aW11bV9zaXplID4gJHZfc2l6ZSkgewogICAgICAgICAgICAgICAgJHZfbWF4aW11bV9zaXplID0gJHZfc2l6ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBAZnNlZWsoJHRoaXMtPnppcF9mZCwgJHZfc2l6ZS0kdl9tYXhpbXVtX3NpemUpOwogICAgICAgICAgICBpZiAoQGZ0ZWxsKCR0aGlzLT56aXBfZmQpICE9ICgkdl9zaXplLSR2X21heGltdW1fc2l6ZSkpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9CQURfRk9STUFULCAnVW5hYmxlIHRvIHNlZWsgYmFjayB0byB0aGUgbWlkZGxlIG9mIHRoZSBhcmNoaXZlIFwnJy4kdGhpcy0+emlwbmFtZS4nXCcnKTsKCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBSZWFkIGJ5dGUgcGVyIGJ5dGUgaW4gb3JkZXIgdG8gZmluZCB0aGUgc2lnbmF0dXJlCiAgICAgICAgICAgICR2X3BvcyA9IGZ0ZWxsKCR0aGlzLT56aXBfZmQpOwogICAgICAgICAgICAkdl9ieXRlcyA9IDB4MDAwMDAwMDA7CiAgICAgICAgICAgIHdoaWxlICgkdl9wb3MgPCAkdl9zaXplKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZWFkIGEgYnl0ZQogICAgICAgICAgICAgICAgJHZfYnl0ZSA9IEBmcmVhZCgkdGhpcy0+emlwX2ZkLCAxKTsKCiAgICAgICAgICAgICAgICAvLyAtLS0tLSAgICBBZGQgdGhlIGJ5dGUKICAgICAgICAgICAgICAgIC8vJHZfYnl0ZXMgPSAoJHZfYnl0ZXMgPDwgOCkgfCBPcmQoJHZfYnl0ZSk7CiAgICAgICAgICAgICAgICAvLyBOb3RlIHdlIG1hc2sgdGhlIG9sZCB2YWx1ZSBkb3duIHN1Y2ggdGhhdCBvbmNlIHNoaWZ0ZWQgd2UgY2FuIG5ldmVyIGVuZCB1cCB3aXRoIG1vcmUgdGhhbiBhIDMyYml0IG51bWJlcgogICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIG9uIHN5c3RlbXMgd2hlcmUgd2UgaGF2ZSA2NGJpdCBpbnRlZ2VycyB0aGUgY2hlY2sgYmVsb3cgZm9yIHRoZSBtYWdpYyBudW1iZXIgd2lsbCBmYWlsLgogICAgICAgICAgICAgICAgJHZfYnl0ZXMgPSAoKCR2X2J5dGVzICYgMHhGRkZGRkYpIDw8IDgpIHwgT3JkKCR2X2J5dGUpOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENvbXBhcmUgdGhlIGJ5dGVzCiAgICAgICAgICAgICAgICBpZiAoJHZfYnl0ZXMgPT0gMHg1MDRiMDUwNikgewogICAgICAgICAgICAgICAgICAgICR2X3BvcysrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR2X3BvcysrOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIG5vdCBmb3VuZCBlbmQgb2YgY2VudHJhbCBkaXIKICAgICAgICAgICAgaWYgKCR2X3BvcyA9PSAkdl9zaXplKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfQkFEX0ZPUk1BVCwgIlVuYWJsZSB0byBmaW5kIEVuZCBvZiBDZW50cmFsIERpciBSZWNvcmQgc2lnbmF0dXJlIik7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgZmlyc3QgMTggYnl0ZXMgb2YgdGhlIGhlYWRlcgogICAgICAgICR2X2JpbmFyeV9kYXRhID0gZnJlYWQoJHRoaXMtPnppcF9mZCwgMTgpOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBpbnZhbGlkIGJsb2NrIHNpemUKICAgICAgICBpZiAoc3RybGVuKCR2X2JpbmFyeV9kYXRhKSAhPSAxOCkgewogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9CQURfRk9STUFULCAiSW52YWxpZCBFbmQgb2YgQ2VudHJhbCBEaXIgUmVjb3JkIHNpemUgOiAiLnN0cmxlbigkdl9iaW5hcnlfZGF0YSkpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gRXh0cmFjdCB0aGUgdmFsdWVzCiAgICAgICAgJHZfZGF0YSA9IHVucGFjaygndmRpc2svdmRpc2tfc3RhcnQvdmRpc2tfZW50cmllcy92ZW50cmllcy9Wc2l6ZS9Wb2Zmc2V0L3Zjb21tZW50X3NpemUnLCAkdl9iaW5hcnlfZGF0YSk7CgogICAgICAgIC8vIC0tLS0tIENoZWNrIHRoZSBnbG9iYWwgc2l6ZQogICAgICAgIGlmICgoJHZfcG9zICsgJHZfZGF0YVsnY29tbWVudF9zaXplJ10gKyAxOCkgIT0gJHZfc2l6ZSkgewogICAgICAgICAgICAvLyAtLS0tLSBSZW1vdmVkIGluIHJlbGVhc2UgMi4yIHNlZSByZWFkbWUgZmlsZQogICAgICAgICAgICAvLyBUaGUgY2hlY2sgb2YgdGhlIGZpbGUgc2l6ZSBpcyBhIGxpdHRsZSB0b28gc3RyaWN0LgogICAgICAgICAgICAvLyBTb21lIGJ1Z3Mgd2hlcmUgZm91bmQgd2hlbiBhIHppcCBpcyBlbmNyeXB0ZWQvZGVjcnlwdGVkIHdpdGggJ2NyeXB0Jy4KICAgICAgICAgICAgLy8gV2hpbGUgZGVjcnlwdGVkLCB6aXAgaGFzIHRyYWluaW5nIDAgYnl0ZXMKICAgICAgICAgICAgaWYgKDApIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9CQURfRk9STUFULCAnVGhlIGNlbnRyYWwgZGlyIGlzIG5vdCBhdCB0aGUgZW5kIG9mIHRoZSBhcmNoaXZlLiBTb21lIHRyYWlsaW5nIGJ5dGVzIGV4aXN0cyBhZnRlciB0aGUgYXJjaGl2ZS4nKTsKCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBHZXQgY29tbWVudAogICAgICAgIGlmICgkdl9kYXRhWydjb21tZW50X3NpemUnXSAhPSAwKSB7CiAgICAgICAgICAgICRwX2NlbnRyYWxfZGlyWydjb21tZW50J10gPSBmcmVhZCgkdGhpcy0+emlwX2ZkLCAkdl9kYXRhWydjb21tZW50X3NpemUnXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHBfY2VudHJhbF9kaXJbJ2NvbW1lbnQnXSA9ICcnOwogICAgICAgIH0KCiAgICAgICAgJHBfY2VudHJhbF9kaXJbJ2VudHJpZXMnXSA9ICR2X2RhdGFbJ2VudHJpZXMnXTsKICAgICAgICAkcF9jZW50cmFsX2RpclsnZGlza19lbnRyaWVzJ10gPSAkdl9kYXRhWydkaXNrX2VudHJpZXMnXTsKICAgICAgICAkcF9jZW50cmFsX2Rpclsnb2Zmc2V0J10gPSAkdl9kYXRhWydvZmZzZXQnXTsKICAgICAgICAkcF9jZW50cmFsX2Rpclsnc2l6ZSddID0gJHZfZGF0YVsnc2l6ZSddOwogICAgICAgICRwX2NlbnRyYWxfZGlyWydkaXNrJ10gPSAkdl9kYXRhWydkaXNrJ107CiAgICAgICAgJHBfY2VudHJhbF9kaXJbJ2Rpc2tfc3RhcnQnXSA9ICR2X2RhdGFbJ2Rpc2tfc3RhcnQnXTsKCiAgICAgICAgLy8gVEJDCiAgICAgICAgLy9mb3IocmVzZXQoJHBfY2VudHJhbF9kaXIpOyAka2V5ID0ga2V5KCRwX2NlbnRyYWxfZGlyKTsgbmV4dCgkcF9jZW50cmFsX2RpcikpIHsKICAgICAgICAvL30KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkRlbGV0ZUJ5UnVsZSgpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2RGVsZXRlQnlSdWxlKCYkcF9yZXN1bHRfbGlzdCwgJiRwX29wdGlvbnMpCiAgICB7CiAgICAgICAgJHZfcmVzdWx0PTE7CiAgICAgICAgJHZfbGlzdF9kZXRhaWwgPSBhcnJheSgpOwoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSB6aXAgZmlsZQogICAgICAgIGlmICgoJHZfcmVzdWx0PSR0aGlzLT5wcml2T3BlbkZkKCdyYicpKSAhPSAxKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmVhZCB0aGUgY2VudHJhbCBkaXJlY3RvcnkgaW5mb3JtYXRpb25zCiAgICAgICAgJHZfY2VudHJhbF9kaXIgPSBhcnJheSgpOwogICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZSZWFkRW5kQ2VudHJhbERpcigkdl9jZW50cmFsX2RpcikpICE9IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBHbyB0byBiZWdpbm5pbmcgb2YgRmlsZQogICAgICAgIEByZXdpbmQoJHRoaXMtPnppcF9mZCk7CgogICAgICAgIC8vIC0tLS0tIFNjYW4gYWxsIHRoZSBmaWxlcwogICAgICAgIC8vIC0tLS0tIFN0YXJ0IGF0IGJlZ2lubmluZyBvZiBDZW50cmFsIERpcgogICAgICAgICR2X3Bvc19lbnRyeSA9ICR2X2NlbnRyYWxfZGlyWydvZmZzZXQnXTsKICAgICAgICBAcmV3aW5kKCR0aGlzLT56aXBfZmQpOwogICAgICAgIGlmIChAZnNlZWsoJHRoaXMtPnppcF9mZCwgJHZfcG9zX2VudHJ5KSkgewogICAgICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgemlwIGZpbGUKICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9JTlZBTElEX0FSQ0hJVkVfWklQLCAnSW52YWxpZCBhcmNoaXZlIHNpemUnKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJlYWQgZWFjaCBlbnRyeQogICAgICAgICR2X2hlYWRlcl9saXN0ID0gYXJyYXkoKTsKICAgICAgICAkal9zdGFydCA9IDA7CiAgICAgICAgZm9yICgkaT0wLCAkdl9uYl9leHRyYWN0ZWQ9MDsgJGk8JHZfY2VudHJhbF9kaXJbJ2VudHJpZXMnXTsgJGkrKykgewogICAgICAgICAgICAvLyAtLS0tLSBSZWFkIHRoZSBmaWxlIGhlYWRlcgogICAgICAgICAgICAkdl9oZWFkZXJfbGlzdFskdl9uYl9leHRyYWN0ZWRdID0gYXJyYXkoKTsKICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdlJlYWRDZW50cmFsRmlsZUhlYWRlcigkdl9oZWFkZXJfbGlzdFskdl9uYl9leHRyYWN0ZWRdKSkgIT0gMSkgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2UgdGhlIHppcCBmaWxlCiAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8gLS0tLS0gU3RvcmUgdGhlIGluZGV4CiAgICAgICAgICAgICR2X2hlYWRlcl9saXN0WyR2X25iX2V4dHJhY3RlZF1bJ2luZGV4J10gPSAkaTsKCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHRoZSBzcGVjaWZpYyBleHRyYWN0IHJ1bGVzCiAgICAgICAgICAgICR2X2ZvdW5kID0gZmFsc2U7CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBleHRyYWN0IGJ5IG5hbWUgcnVsZQogICAgICAgICAgICBpZiAoKGlzc2V0KCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9OQU1FXSkpICYmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfTkFNRV0gIT0gMCkpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlIGZpbGVuYW1lIGlzIGluIHRoZSBsaXN0CiAgICAgICAgICAgICAgICBmb3IgKCRqPTA7ICgkajxzaXplb2YoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX05BTUVdKSkgJiYgKCEkdl9mb3VuZCk7ICRqKyspIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhIGRpcmVjdG9yeQogICAgICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX05BTUVdWyRqXSwgLTEpID09ICIvIikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSBkaXJlY3RvcnkgaXMgaW4gdGhlIGZpbGVuYW1lIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChzdHJsZW4oJHZfaGVhZGVyX2xpc3RbJHZfbmJfZXh0cmFjdGVkXVsnc3RvcmVkX2ZpbGVuYW1lJ10pID4gc3RybGVuKCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9OQU1FXVskal0pKSAmJiAoc3Vic3RyKCR2X2hlYWRlcl9saXN0WyR2X25iX2V4dHJhY3RlZF1bJ3N0b3JlZF9maWxlbmFtZSddLCAwLCBzdHJsZW4oJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX05BTUVdWyRqXSkpID09ICRwX29wdGlvbnNbUENMWklQX09QVF9CWV9OQU1FXVskal0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdl9mb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgoKCR2X2hlYWRlcl9saXN0WyR2X25iX2V4dHJhY3RlZF1bJ2V4dGVybmFsJ10mMHgwMDAwMDAxMCk9PTB4MDAwMDAwMTApIC8qIEluZGljYXRlcyBhIGZvbGRlciAqLyAmJiAoJHZfaGVhZGVyX2xpc3RbJHZfbmJfZXh0cmFjdGVkXVsnc3RvcmVkX2ZpbGVuYW1lJ10uJy8nID09ICRwX29wdGlvbnNbUENMWklQX09QVF9CWV9OQU1FXVskal0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdl9mb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHZfaGVhZGVyX2xpc3RbJHZfbmJfZXh0cmFjdGVkXVsnc3RvcmVkX2ZpbGVuYW1lJ10gPT0gJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX05BTUVdWyRqXSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBhIGZpbGVuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICR2X2ZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmICgoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX1BSRUddKSkgJiYgKCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9QUkVHXSAhPSAiIikpIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGV4dHJhY3QgYnkgcHJlZyBydWxlCiAgICAgICAgICAgICAgICBpZiAocHJlZ19tYXRjaCgkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfUFJFR10sICR2X2hlYWRlcl9saXN0WyR2X25iX2V4dHJhY3RlZF1bJ3N0b3JlZF9maWxlbmFtZSddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdl9mb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmICgoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0JZX0lOREVYXSkpICYmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfSU5ERVhdICE9IDApKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBleHRyYWN0IGJ5IGluZGV4IHJ1bGUKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgaWYgdGhlIGluZGV4IGlzIGluIHRoZSBsaXN0CiAgICAgICAgICAgICAgICBmb3IgKCRqPSRqX3N0YXJ0OyAoJGo8c2l6ZW9mKCRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF0pKSAmJiAoISR2X2ZvdW5kKTsgJGorKykgewogICAgICAgICAgICAgICAgICAgIGlmICgoJGk+PSRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF1bJGpdWydzdGFydCddKSAmJiAoJGk8PSRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF1bJGpdWydlbmQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHZfZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJGk+PSRwX29wdGlvbnNbUENMWklQX09QVF9CWV9JTkRFWF1bJGpdWydlbmQnXSkgewogICAgICAgICAgICAgICAgICAgICAgICAkal9zdGFydCA9ICRqKzE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkcF9vcHRpb25zW1BDTFpJUF9PUFRfQllfSU5ERVhdWyRqXVsnc3RhcnQnXT4kaSkgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdl9mb3VuZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGRlbGV0aW9uCiAgICAgICAgICAgIGlmICgkdl9mb3VuZCkgewogICAgICAgICAgICAgICAgdW5zZXQoJHZfaGVhZGVyX2xpc3RbJHZfbmJfZXh0cmFjdGVkXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdl9uYl9leHRyYWN0ZWQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gTG9vayBpZiBzb21ldGhpbmcgbmVlZCB0byBiZSBkZWxldGVkCiAgICAgICAgaWYgKCR2X25iX2V4dHJhY3RlZCA+IDApIHsKICAgICAgICAgICAgLy8gLS0tLS0gQ3JlYXRlcyBhIHRlbXBvcmF5IGZpbGUKICAgICAgICAgICAgJHZfemlwX3RlbXBfbmFtZSA9IFBDTFpJUF9URU1QT1JBUllfRElSLnVuaXFpZCgncGNsemlwLScpLicudG1wJzsKCiAgICAgICAgICAgIC8vIC0tLS0tIENyZWF0ZXMgYSB0ZW1wb3JhcnkgemlwIGFyY2hpdmUKICAgICAgICAgICAgJHZfdGVtcF96aXAgPSBuZXcgUGNsWmlwKCR2X3ppcF90ZW1wX25hbWUpOwoKICAgICAgICAgICAgLy8gLS0tLS0gT3BlbiB0aGUgdGVtcG9yYXJ5IHppcCBmaWxlIGluIHdyaXRlIG1vZGUKICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdl90ZW1wX3ppcC0+cHJpdk9wZW5GZCgnd2InKSkgIT0gMSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBMb29rIHdoaWNoIGZpbGUgbmVlZCB0byBiZSBrZXB0CiAgICAgICAgICAgIGZvciAoJGk9MDsgJGk8c2l6ZW9mKCR2X2hlYWRlcl9saXN0KTsgJGkrKykgewogICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2FsY3VsYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgaGVhZGVyCiAgICAgICAgICAgICAgICBAcmV3aW5kKCR0aGlzLT56aXBfZmQpOwogICAgICAgICAgICAgICAgaWYgKEBmc2VlaygkdGhpcy0+emlwX2ZkLCAkdl9oZWFkZXJfbGlzdFskaV1bJ29mZnNldCddKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSB6aXAgZmlsZQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgICAgICR2X3RlbXBfemlwLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHZfemlwX3RlbXBfbmFtZSk7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEVycm9yIGxvZwogICAgICAgICAgICAgICAgICAgIFBjbFppcDo6cHJpdkVycm9yTG9nKFBDTFpJUF9FUlJfSU5WQUxJRF9BUkNISVZFX1pJUCwgJ0ludmFsaWQgYXJjaGl2ZSBzaXplJyk7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGZpbGUgaGVhZGVyCiAgICAgICAgICAgICAgICAkdl9sb2NhbF9oZWFkZXIgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdGhpcy0+cHJpdlJlYWRGaWxlSGVhZGVyKCR2X2xvY2FsX2hlYWRlcikpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgemlwIGZpbGUKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICAgICAkdl90ZW1wX3ppcC0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCR2X3ppcF90ZW1wX25hbWUpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENoZWNrIHRoYXQgbG9jYWwgZmlsZSBoZWFkZXIgaXMgc2FtZSBhcyBjZW50cmFsIGZpbGUgaGVhZGVyCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPnByaXZDaGVja0ZpbGVIZWFkZXJzKCR2X2xvY2FsX2hlYWRlciwgJHZfaGVhZGVyX2xpc3RbJGldKSAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVEJDCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1bnNldCgkdl9sb2NhbF9oZWFkZXIpOwoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFdyaXRlIHRoZSBmaWxlIGhlYWRlcgogICAgICAgICAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkdl90ZW1wX3ppcC0+cHJpdldyaXRlRmlsZUhlYWRlcigkdl9oZWFkZXJfbGlzdFskaV0pKSAhPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2UgdGhlIHppcCBmaWxlCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICAgICAgICAgJHZfdGVtcF96aXAtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkdl96aXBfdGVtcF9uYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZWFkL3dyaXRlIHRoZSBkYXRhIGJsb2NrCiAgICAgICAgICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9IFBjbFppcFV0aWxDb3B5QmxvY2soJHRoaXMtPnppcF9mZCwgJHZfdGVtcF96aXAtPnppcF9mZCwgJHZfaGVhZGVyX2xpc3RbJGldWydjb21wcmVzc2VkX3NpemUnXSkpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBDbG9zZSB0aGUgemlwIGZpbGUKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICAgICAkdl90ZW1wX3ppcC0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCR2X3ppcF90ZW1wX25hbWUpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0tLSBTdG9yZSB0aGUgb2Zmc2V0IG9mIHRoZSBjZW50cmFsIGRpcgogICAgICAgICAgICAkdl9vZmZzZXQgPSBAZnRlbGwoJHZfdGVtcF96aXAtPnppcF9mZCk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZS1DcmVhdGUgdGhlIENlbnRyYWwgRGlyIGZpbGVzIGhlYWRlcgogICAgICAgICAgICBmb3IgKCRpPTA7ICRpPHNpemVvZigkdl9oZWFkZXJfbGlzdCk7ICRpKyspIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIENyZWF0ZSB0aGUgZmlsZSBoZWFkZXIKICAgICAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHZfdGVtcF96aXAtPnByaXZXcml0ZUNlbnRyYWxGaWxlSGVhZGVyKCR2X2hlYWRlcl9saXN0WyRpXSkpICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICAkdl90ZW1wX3ppcC0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCR2X3ppcF90ZW1wX25hbWUpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC0tLS0tIFRyYW5zZm9ybSB0aGUgaGVhZGVyIHRvIGEgJ3VzYWJsZScgaW5mbwogICAgICAgICAgICAgICAgJHZfdGVtcF96aXAtPnByaXZDb252ZXJ0SGVhZGVyMkZpbGVJbmZvKCR2X2hlYWRlcl9saXN0WyRpXSwgJHBfcmVzdWx0X2xpc3RbJGldKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIC0tLS0tIFppcCBmaWxlIGNvbW1lbnQKICAgICAgICAgICAgJHZfY29tbWVudCA9ICcnOwogICAgICAgICAgICBpZiAoaXNzZXQoJHBfb3B0aW9uc1tQQ0xaSVBfT1BUX0NPTU1FTlRdKSkgewogICAgICAgICAgICAgICAgJHZfY29tbWVudCA9ICRwX29wdGlvbnNbUENMWklQX09QVF9DT01NRU5UXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gQ2FsY3VsYXRlIHRoZSBzaXplIG9mIHRoZSBjZW50cmFsIGhlYWRlcgogICAgICAgICAgICAkdl9zaXplID0gQGZ0ZWxsKCR2X3RlbXBfemlwLT56aXBfZmQpLSR2X29mZnNldDsKCiAgICAgICAgICAgIC8vIC0tLS0tIENyZWF0ZSB0aGUgY2VudHJhbCBkaXIgZm9vdGVyCiAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHZfdGVtcF96aXAtPnByaXZXcml0ZUNlbnRyYWxIZWFkZXIoc2l6ZW9mKCR2X2hlYWRlcl9saXN0KSwgJHZfc2l6ZSwgJHZfb2Zmc2V0LCAkdl9jb21tZW50KSkgIT0gMSkgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIFJlc2V0IHRoZSBmaWxlIGxpc3QKICAgICAgICAgICAgICAgICAgICB1bnNldCgkdl9oZWFkZXJfbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgJHZfdGVtcF96aXAtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkdl96aXBfdGVtcF9uYW1lKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tLS0gQ2xvc2UKICAgICAgICAgICAgJHZfdGVtcF96aXAtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwoKICAgICAgICAgICAgLy8gLS0tLS0gRGVsZXRlIHRoZSB6aXAgZmlsZQogICAgICAgICAgICAvLyBUQkMgOiBJIHNob3VsZCB0ZXN0IHRoZSByZXN1bHQgLi4uCiAgICAgICAgICAgIEB1bmxpbmsoJHRoaXMtPnppcG5hbWUpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmVuYW1lIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgICAgICAvLyBUQkMgOiBJIHNob3VsZCB0ZXN0IHRoZSByZXN1bHQgLi4uCiAgICAgICAgICAgIC8vQHJlbmFtZSgkdl96aXBfdGVtcF9uYW1lLCAkdGhpcy0+emlwbmFtZSk7CiAgICAgICAgICAgIFBjbFppcFV0aWxSZW5hbWUoJHZfemlwX3RlbXBfbmFtZSwgJHRoaXMtPnppcG5hbWUpOwoKICAgICAgICAgICAgLy8gLS0tLS0gRGVzdHJveSB0aGUgdGVtcG9yYXJ5IGFyY2hpdmUKICAgICAgICAgICAgdW5zZXQoJHZfdGVtcF96aXApOwogICAgICAgIH0gZWxzZWlmICgkdl9jZW50cmFsX2RpclsnZW50cmllcyddICE9IDApIHsKICAgICAgICAgICAgLy8gLS0tLS0gUmVtb3ZlIGV2ZXJ5IGZpbGVzIDogcmVzZXQgdGhlIGZpbGUKICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2T3BlbkZkKCd3YicpKSAhPSAxKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2V3JpdGVDZW50cmFsSGVhZGVyKDAsIDAsIDAsICcnKSkgIT0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2RGlyQ2hlY2soKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gICAgIENoZWNrIGlmIGEgZGlyZWN0b3J5IGV4aXN0cywgaWYgbm90IGl0IGNyZWF0ZXMgaXQgYW5kIGFsbCB0aGUgcGFyZW50cyBkaXJlY3RvcnkKICAgIC8vICAgICB3aGljaCBtYXkgYmUgdXNlZnVsLgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyAgICAgJHBfZGlyIDogRGlyZWN0b3J5IHBhdGggdG8gY2hlY2suCiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vICAgICAgICAxIDogT0sKICAgIC8vICAgICAtMSA6IFVuYWJsZSB0byBjcmVhdGUgZGlyZWN0b3J5CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZEaXJDaGVjaygkcF9kaXIsICRwX2lzX2RpciA9IGZhbHNlKQogICAgewogICAgICAgICR2X3Jlc3VsdCA9IDE7CgogICAgICAgIC8vIC0tLS0tIFJlbW92ZSB0aGUgZmluYWwgJy8nCiAgICAgICAgaWYgKCgkcF9pc19kaXIpICYmIChzdWJzdHIoJHBfZGlyLCAtMSk9PScvJykpIHsKICAgICAgICAgICAgJHBfZGlyID0gc3Vic3RyKCRwX2RpciwgMCwgc3RybGVuKCRwX2RpciktMSk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDaGVjayB0aGUgZGlyZWN0b3J5IGF2YWlsYWJpbGl0eQogICAgICAgIGlmICgoaXNfZGlyKCRwX2RpcikpIHx8ICgkcF9kaXIgPT0gIiIpKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gRXh0cmFjdCBwYXJlbnQgZGlyZWN0b3J5CiAgICAgICAgJHBfcGFyZW50X2RpciA9IGRpcm5hbWUoJHBfZGlyKTsKCiAgICAgICAgLy8gLS0tLS0gSnVzdCBhIGNoZWNrCiAgICAgICAgaWYgKCRwX3BhcmVudF9kaXIgIT0gJHBfZGlyKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHBhcmVudCBkaXJlY3RvcnkKICAgICAgICAgICAgaWYgKCRwX3BhcmVudF9kaXIgIT0gIiIpIHsKICAgICAgICAgICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZEaXJDaGVjaygkcF9wYXJlbnRfZGlyKSkgIT0gMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENyZWF0ZSB0aGUgZGlyZWN0b3J5CiAgICAgICAgaWYgKCFAbWtkaXIoJHBfZGlyLCAwNzc3KSkgewogICAgICAgICAgICAvLyAtLS0tLSBFcnJvciBsb2cKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9ESVJfQ1JFQVRFX0ZBSUwsICJVbmFibGUgdG8gY3JlYXRlIGRpcmVjdG9yeSAnJHBfZGlyJyIpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiBQY2xaaXA6OmVycm9yQ29kZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdk1lcmdlKCkKICAgIC8vIERlc2NyaXB0aW9uIDoKICAgIC8vICAgICBJZiAkcF9hcmNoaXZlX3RvX2FkZCBkb2VzIG5vdCBleGlzdCwgdGhlIGZ1bmN0aW9uIGV4aXQgd2l0aCBhIHN1Y2Nlc3MgcmVzdWx0LgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdk1lcmdlKCYkcF9hcmNoaXZlX3RvX2FkZCkKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gTG9vayBpZiB0aGUgYXJjaGl2ZV90b19hZGQgZXhpc3RzCiAgICAgICAgaWYgKCFpc19maWxlKCRwX2FyY2hpdmVfdG9fYWRkLT56aXBuYW1lKSkgewogICAgICAgICAgICAvLyAtLS0tLSBOb3RoaW5nIHRvIG1lcmdlLCBzbyBtZXJnZSBpcyBhIHN1Y2Nlc3MKICAgICAgICAgICAgJHZfcmVzdWx0ID0gMTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gTG9vayBpZiB0aGUgYXJjaGl2ZSBleGlzdHMKICAgICAgICBpZiAoIWlzX2ZpbGUoJHRoaXMtPnppcG5hbWUpKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIERvIGEgZHVwbGljYXRlCiAgICAgICAgICAgICR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2RHVwbGljYXRlKCRwX2FyY2hpdmVfdG9fYWRkLT56aXBuYW1lKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gT3BlbiB0aGUgemlwIGZpbGUKICAgICAgICBpZiAoKCR2X3Jlc3VsdD0kdGhpcy0+cHJpdk9wZW5GZCgncmInKSkgIT0gMSkgewogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGNlbnRyYWwgZGlyZWN0b3J5IGluZm9ybWF0aW9ucwogICAgICAgICR2X2NlbnRyYWxfZGlyID0gYXJyYXkoKTsKICAgICAgICBpZiAoKCR2X3Jlc3VsdCA9ICR0aGlzLT5wcml2UmVhZEVuZENlbnRyYWxEaXIoJHZfY2VudHJhbF9kaXIpKSAhPSAxKSB7CiAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gR28gdG8gYmVnaW5uaW5nIG9mIEZpbGUKICAgICAgICBAcmV3aW5kKCR0aGlzLT56aXBfZmQpOwoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSBhcmNoaXZlX3RvX2FkZCBmaWxlCiAgICAgICAgaWYgKCgkdl9yZXN1bHQ9JHBfYXJjaGl2ZV90b19hZGQtPnByaXZPcGVuRmQoJ3JiJykpICE9IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFJlYWQgdGhlIGNlbnRyYWwgZGlyZWN0b3J5IGluZm9ybWF0aW9ucwogICAgICAgICR2X2NlbnRyYWxfZGlyX3RvX2FkZCA9IGFycmF5KCk7CiAgICAgICAgaWYgKCgkdl9yZXN1bHQgPSAkcF9hcmNoaXZlX3RvX2FkZC0+cHJpdlJlYWRFbmRDZW50cmFsRGlyKCR2X2NlbnRyYWxfZGlyX3RvX2FkZCkpICE9IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgICRwX2FyY2hpdmVfdG9fYWRkLT5wcml2Q2xvc2VGZCgpOwoKICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIEdvIHRvIGJlZ2lubmluZyBvZiBGaWxlCiAgICAgICAgQHJld2luZCgkcF9hcmNoaXZlX3RvX2FkZC0+emlwX2ZkKTsKCiAgICAgICAgLy8gLS0tLS0gQ3JlYXRlcyBhIHRlbXBvcmF5IGZpbGUKICAgICAgICAkdl96aXBfdGVtcF9uYW1lID0gUENMWklQX1RFTVBPUkFSWV9ESVIudW5pcWlkKCdwY2x6aXAtJykuJy50bXAnOwoKICAgICAgICAvLyAtLS0tLSBPcGVuIHRoZSB0ZW1wb3JhcnkgZmlsZSBpbiB3cml0ZSBtb2RlCiAgICAgICAgaWYgKCgkdl96aXBfdGVtcF9mZCA9IEBmb3Blbigkdl96aXBfdGVtcF9uYW1lLCAnd2InKSkgPT0gMCkgewogICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgJHBfYXJjaGl2ZV90b19hZGQtPnByaXZDbG9zZUZkKCk7CgogICAgICAgICAgICBQY2xaaXA6OnByaXZFcnJvckxvZyhQQ0xaSVBfRVJSX1JFQURfT1BFTl9GQUlMLCAnVW5hYmxlIHRvIG9wZW4gdGVtcG9yYXJ5IGZpbGUgXCcnLiR2X3ppcF90ZW1wX25hbWUuJ1wnIGluIGJpbmFyeSB3cml0ZSBtb2RlJyk7CgogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuIFBjbFppcDo6ZXJyb3JDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDb3B5IHRoZSBmaWxlcyBmcm9tIHRoZSBhcmNoaXZlIHRvIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIC8vIFRCQyA6IEhlcmUgSSBzaG91bGQgYmV0dGVyIGFwcGVuZCB0aGUgZmlsZSBhbmQgZ28gYmFjayB0byBlcmFzZSB0aGUgY2VudHJhbCBkaXIKICAgICAgICAkdl9zaXplID0gJHZfY2VudHJhbF9kaXJbJ29mZnNldCddOwogICAgICAgIHdoaWxlICgkdl9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCR2X3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHZfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBmcmVhZCgkdGhpcy0+emlwX2ZkLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICBAZndyaXRlKCR2X3ppcF90ZW1wX2ZkLCAkdl9idWZmZXIsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgICR2X3NpemUgLT0gJHZfcmVhZF9zaXplOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ29weSB0aGUgZmlsZXMgZnJvbSB0aGUgYXJjaGl2ZV90b19hZGQgaW50byB0aGUgdGVtcG9yYXJ5IGZpbGUKICAgICAgICAkdl9zaXplID0gJHZfY2VudHJhbF9kaXJfdG9fYWRkWydvZmZzZXQnXTsKICAgICAgICB3aGlsZSAoJHZfc2l6ZSAhPSAwKSB7CiAgICAgICAgICAgICR2X3JlYWRfc2l6ZSA9ICgkdl9zaXplIDwgUENMWklQX1JFQURfQkxPQ0tfU0laRSA\/ICR2X3NpemUgOiBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFKTsKICAgICAgICAgICAgJHZfYnVmZmVyID0gZnJlYWQoJHBfYXJjaGl2ZV90b19hZGQtPnppcF9mZCwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgQGZ3cml0ZSgkdl96aXBfdGVtcF9mZCwgJHZfYnVmZmVyLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAkdl9zaXplIC09ICR2X3JlYWRfc2l6ZTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIFN0b3JlIHRoZSBvZmZzZXQgb2YgdGhlIGNlbnRyYWwgZGlyCiAgICAgICAgJHZfb2Zmc2V0ID0gQGZ0ZWxsKCR2X3ppcF90ZW1wX2ZkKTsKCiAgICAgICAgLy8gLS0tLS0gQ29weSB0aGUgYmxvY2sgb2YgZmlsZSBoZWFkZXJzIGZyb20gdGhlIG9sZCBhcmNoaXZlCiAgICAgICAgJHZfc2l6ZSA9ICR2X2NlbnRyYWxfZGlyWydzaXplJ107CiAgICAgICAgd2hpbGUgKCR2X3NpemUgIT0gMCkgewogICAgICAgICAgICAkdl9yZWFkX3NpemUgPSAoJHZfc2l6ZSA8IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUgPyAkdl9zaXplIDogUENMWklQX1JFQURfQkxPQ0tfU0laRSk7CiAgICAgICAgICAgICR2X2J1ZmZlciA9IEBmcmVhZCgkdGhpcy0+emlwX2ZkLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICBAZndyaXRlKCR2X3ppcF90ZW1wX2ZkLCAkdl9idWZmZXIsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgICR2X3NpemUgLT0gJHZfcmVhZF9zaXplOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gQ29weSB0aGUgYmxvY2sgb2YgZmlsZSBoZWFkZXJzIGZyb20gdGhlIGFyY2hpdmVfdG9fYWRkCiAgICAgICAgJHZfc2l6ZSA9ICR2X2NlbnRyYWxfZGlyX3RvX2FkZFsnc2l6ZSddOwogICAgICAgIHdoaWxlICgkdl9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCR2X3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHZfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBAZnJlYWQoJHBfYXJjaGl2ZV90b19hZGQtPnppcF9mZCwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgQGZ3cml0ZSgkdl96aXBfdGVtcF9mZCwgJHZfYnVmZmVyLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAkdl9zaXplIC09ICR2X3JlYWRfc2l6ZTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIE1lcmdlIHRoZSBmaWxlIGNvbW1lbnRzCiAgICAgICAgJHZfY29tbWVudCA9ICR2X2NlbnRyYWxfZGlyWydjb21tZW50J10uJyAnLiR2X2NlbnRyYWxfZGlyX3RvX2FkZFsnY29tbWVudCddOwoKICAgICAgICAvLyAtLS0tLSBDYWxjdWxhdGUgdGhlIHNpemUgb2YgdGhlIChuZXcpIGNlbnRyYWwgaGVhZGVyCiAgICAgICAgJHZfc2l6ZSA9IEBmdGVsbCgkdl96aXBfdGVtcF9mZCktJHZfb2Zmc2V0OwoKICAgICAgICAvLyAtLS0tLSBTd2FwIHRoZSBmaWxlIGRlc2NyaXB0b3IKICAgICAgICAvLyBIZXJlIGlzIGEgdHJpY2sgOiBJIHN3YXAgdGhlIHRlbXBvcmFyeSBmZCB3aXRoIHRoZSB6aXAgZmQsIGluIG9yZGVyIHRvIHVzZQogICAgICAgIC8vIHRoZSBmb2xsb3dpbmcgbWV0aG9kcyBvbiB0aGUgdGVtcG9yYXJ5IGZpbCBhbmQgbm90IHRoZSByZWFsIGFyY2hpdmUgZmQKICAgICAgICAkdl9zd2FwID0gJHRoaXMtPnppcF9mZDsKICAgICAgICAkdGhpcy0+emlwX2ZkID0gJHZfemlwX3RlbXBfZmQ7CiAgICAgICAgJHZfemlwX3RlbXBfZmQgPSAkdl9zd2FwOwoKICAgICAgICAvLyAtLS0tLSBDcmVhdGUgdGhlIGNlbnRyYWwgZGlyIGZvb3RlcgogICAgICAgIGlmICgoJHZfcmVzdWx0ID0gJHRoaXMtPnByaXZXcml0ZUNlbnRyYWxIZWFkZXIoJHZfY2VudHJhbF9kaXJbJ2VudHJpZXMnXSskdl9jZW50cmFsX2Rpcl90b19hZGRbJ2VudHJpZXMnXSwgJHZfc2l6ZSwgJHZfb2Zmc2V0LCAkdl9jb21tZW50KSkgIT0gMSkgewogICAgICAgICAgICAkdGhpcy0+cHJpdkNsb3NlRmQoKTsKICAgICAgICAgICAgJHBfYXJjaGl2ZV90b19hZGQtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgICAgIEBmY2xvc2UoJHZfemlwX3RlbXBfZmQpOwogICAgICAgICAgICAkdGhpcy0+emlwX2ZkID0gbnVsbDsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJlc2V0IHRoZSBmaWxlIGxpc3QKICAgICAgICAgICAgdW5zZXQoJHZfaGVhZGVyX2xpc3QpOwoKICAgICAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBTd2FwIGJhY2sgdGhlIGZpbGUgZGVzY3JpcHRvcgogICAgICAgICR2X3N3YXAgPSAkdGhpcy0+emlwX2ZkOwogICAgICAgICR0aGlzLT56aXBfZmQgPSAkdl96aXBfdGVtcF9mZDsKICAgICAgICAkdl96aXBfdGVtcF9mZCA9ICR2X3N3YXA7CgogICAgICAgIC8vIC0tLS0tIENsb3NlCiAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CiAgICAgICAgJHBfYXJjaGl2ZV90b19hZGQtPnByaXZDbG9zZUZkKCk7CgogICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIEBmY2xvc2UoJHZfemlwX3RlbXBfZmQpOwoKICAgICAgICAvLyAtLS0tLSBEZWxldGUgdGhlIHppcCBmaWxlCiAgICAgICAgLy8gVEJDIDogSSBzaG91bGQgdGVzdCB0aGUgcmVzdWx0IC4uLgogICAgICAgIEB1bmxpbmsoJHRoaXMtPnppcG5hbWUpOwoKICAgICAgICAvLyAtLS0tLSBSZW5hbWUgdGhlIHRlbXBvcmFyeSBmaWxlCiAgICAgICAgLy8gVEJDIDogSSBzaG91bGQgdGVzdCB0aGUgcmVzdWx0IC4uLgogICAgICAgIC8vQHJlbmFtZSgkdl96aXBfdGVtcF9uYW1lLCAkdGhpcy0+emlwbmFtZSk7CiAgICAgICAgUGNsWmlwVXRpbFJlbmFtZSgkdl96aXBfdGVtcF9uYW1lLCAkdGhpcy0+emlwbmFtZSk7CgogICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGdW5jdGlvbiA6IHByaXZEdXBsaWNhdGUoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdkR1cGxpY2F0ZSgkcF9hcmNoaXZlX2ZpbGVuYW1lKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIHRoZSAkcF9hcmNoaXZlX2ZpbGVuYW1lIGV4aXN0cwogICAgICAgIGlmICghaXNfZmlsZSgkcF9hcmNoaXZlX2ZpbGVuYW1lKSkgewogICAgICAgICAgICAvLyAtLS0tLSBOb3RoaW5nIHRvIGR1cGxpY2F0ZSwgc28gZHVwbGljYXRlIGlzIGEgc3VjY2Vzcy4KICAgICAgICAgICAgJHZfcmVzdWx0ID0gMTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gT3BlbiB0aGUgemlwIGZpbGUKICAgICAgICBpZiAoKCR2X3Jlc3VsdD0kdGhpcy0+cHJpdk9wZW5GZCgnd2InKSkgIT0gMSkgewogICAgICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIE9wZW4gdGhlIHRlbXBvcmFyeSBmaWxlIGluIHdyaXRlIG1vZGUKICAgICAgICBpZiAoKCR2X3ppcF90ZW1wX2ZkID0gQGZvcGVuKCRwX2FyY2hpdmVfZmlsZW5hbWUsICdyYicpKSA9PSAwKSB7CiAgICAgICAgICAgICR0aGlzLT5wcml2Q2xvc2VGZCgpOwoKICAgICAgICAgICAgUGNsWmlwOjpwcml2RXJyb3JMb2coUENMWklQX0VSUl9SRUFEX09QRU5fRkFJTCwgJ1VuYWJsZSB0byBvcGVuIGFyY2hpdmUgZmlsZSBcJycuJHBfYXJjaGl2ZV9maWxlbmFtZS4nXCcgaW4gYmluYXJ5IHdyaXRlIG1vZGUnKTsKCiAgICAgICAgICAgIC8vIC0tLS0tIFJldHVybgogICAgICAgICAgICByZXR1cm4gUGNsWmlwOjplcnJvckNvZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENvcHkgdGhlIGZpbGVzIGZyb20gdGhlIGFyY2hpdmUgdG8gdGhlIHRlbXBvcmFyeSBmaWxlCiAgICAgICAgLy8gVEJDIDogSGVyZSBJIHNob3VsZCBiZXR0ZXIgYXBwZW5kIHRoZSBmaWxlIGFuZCBnbyBiYWNrIHRvIGVyYXNlIHRoZSBjZW50cmFsIGRpcgogICAgICAgICR2X3NpemUgPSBmaWxlc2l6ZSgkcF9hcmNoaXZlX2ZpbGVuYW1lKTsKICAgICAgICB3aGlsZSAoJHZfc2l6ZSAhPSAwKSB7CiAgICAgICAgICAgICR2X3JlYWRfc2l6ZSA9ICgkdl9zaXplIDwgUENMWklQX1JFQURfQkxPQ0tfU0laRSA\/ICR2X3NpemUgOiBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFKTsKICAgICAgICAgICAgJHZfYnVmZmVyID0gZnJlYWQoJHZfemlwX3RlbXBfZmQsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgIEBmd3JpdGUoJHRoaXMtPnppcF9mZCwgJHZfYnVmZmVyLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAkdl9zaXplIC09ICR2X3JlYWRfc2l6ZTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIENsb3NlCiAgICAgICAgJHRoaXMtPnByaXZDbG9zZUZkKCk7CgogICAgICAgIC8vIC0tLS0tIENsb3NlIHRoZSB0ZW1wb3JhcnkgZmlsZQogICAgICAgIEBmY2xvc2UoJHZfemlwX3RlbXBfZmQpOwoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRnVuY3Rpb24gOiBwcml2RXJyb3JMb2coKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZFcnJvckxvZygkcF9lcnJvcl9jb2RlID0gMCwgJHBfZXJyb3Jfc3RyaW5nID0gJycpCiAgICB7CiAgICAgICAgaWYgKFBDTFpJUF9FUlJPUl9FWFRFUk5BTCA9PSAxKSB7CiAgICAgICAgICAgIFBjbEVycm9yKCRwX2Vycm9yX2NvZGUsICRwX2Vycm9yX3N0cmluZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmVycm9yX2NvZGUgPSAkcF9lcnJvcl9jb2RlOwogICAgICAgICAgICAkdGhpcy0+ZXJyb3Jfc3RyaW5nID0gJHBfZXJyb3Jfc3RyaW5nOwogICAgICAgIH0KICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkVycm9yUmVzZXQoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgcHVibGljIGZ1bmN0aW9uIHByaXZFcnJvclJlc2V0KCkKICAgIHsKICAgICAgICBpZiAoUENMWklQX0VSUk9SX0VYVEVSTkFMID09IDEpIHsKICAgICAgICAgICAgUGNsRXJyb3JSZXNldCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5lcnJvcl9jb2RlID0gMDsKICAgICAgICAgICAgJHRoaXMtPmVycm9yX3N0cmluZyA9ICcnOwogICAgICAgIH0KICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdkRpc2FibGVNYWdpY1F1b3RlcygpCiAgICAvLyBEZXNjcmlwdGlvbiA6CiAgICAvLyBQYXJhbWV0ZXJzIDoKICAgIC8vIFJldHVybiBWYWx1ZXMgOgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHB1YmxpYyBmdW5jdGlvbiBwcml2RGlzYWJsZU1hZ2ljUXVvdGVzKCkKICAgIHsKICAgICAgICAkdl9yZXN1bHQ9MTsKCiAgICAgICAgLy8gLS0tLS0gTG9vayBpZiBmdW5jdGlvbiBleGlzdHMKICAgICAgICBpZiAoKCFmdW5jdGlvbl9leGlzdHMoImdldF9tYWdpY19xdW90ZXNfcnVudGltZSIpKSB8fCAoIWZ1bmN0aW9uX2V4aXN0cygic2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lIikpKSB7CiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIGFscmVhZHkgZG9uZQogICAgICAgIGlmICgkdGhpcy0+bWFnaWNfcXVvdGVzX3N0YXR1cyAhPSAtMSkgewogICAgICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gR2V0IGFuZCBtZW1vcml6ZSB0aGUgbWFnaWNfcXVvdGUgdmFsdWUKICAgICAgICAkdGhpcy0+bWFnaWNfcXVvdGVzX3N0YXR1cyA9IEBnZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoKTsKCiAgICAgICAgLy8gLS0tLS0gRGlzYWJsZSBtYWdpY19xdW90ZXMKICAgICAgICBpZiAoJHRoaXMtPm1hZ2ljX3F1b3Rlc19zdGF0dXMgPT0gMSkgewogICAgICAgICAgICBAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gUmV0dXJuCiAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEZ1bmN0aW9uIDogcHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKQogICAgLy8gRGVzY3JpcHRpb24gOgogICAgLy8gUGFyYW1ldGVycyA6CiAgICAvLyBSZXR1cm4gVmFsdWVzIDoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJpdlN3YXBCYWNrTWFnaWNRdW90ZXMoKQogICAgewogICAgICAgICR2X3Jlc3VsdD0xOwoKICAgICAgICAvLyAtLS0tLSBMb29rIGlmIGZ1bmN0aW9uIGV4aXN0cwogICAgICAgIGlmICgoIWZ1bmN0aW9uX2V4aXN0cygiZ2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lIikpIHx8ICghZnVuY3Rpb25fZXhpc3RzKCJzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUiKSkpIHsKICAgICAgICAgICAgcmV0dXJuICR2X3Jlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgaWYgc29tZXRoaW5nIHRvIGRvCiAgICAgICAgaWYgKCR0aGlzLT5tYWdpY19xdW90ZXNfc3RhdHVzICE9IC0xKSB7CiAgICAgICAgICAgIHJldHVybiAkdl9yZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBTd2FwIGJhY2sgbWFnaWNfcXVvdGVzCiAgICAgICAgaWYgKCR0aGlzLT5tYWdpY19xdW90ZXNfc3RhdHVzID09IDEpIHsKICAgICAgICAgICAgQHNldF9tYWdpY19xdW90ZXNfcnVudGltZSgkdGhpcy0+bWFnaWNfcXVvdGVzX3N0YXR1cyk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBSZXR1cm4KICAgICAgICByZXR1cm4gJHZfcmVzdWx0OwogICAgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KfQovLyBFbmQgb2YgY2xhc3MKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEZ1bmN0aW9uIDogUGNsWmlwVXRpbFBhdGhSZWR1Y3Rpb24oKQovLyBEZXNjcmlwdGlvbiA6Ci8vIFBhcmFtZXRlcnMgOgovLyBSZXR1cm4gVmFsdWVzIDoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gUGNsWmlwVXRpbFBhdGhSZWR1Y3Rpb24oJHBfZGlyKQp7CiAgICAkdl9yZXN1bHQgPSAiIjsKCiAgICAvLyAtLS0tLSBMb29rIGZvciBub3QgZW1wdHkgcGF0aAogICAgaWYgKCRwX2RpciAhPSAiIikgewogICAgICAgIC8vIC0tLS0tIEV4cGxvZGUgcGF0aCBieSBkaXJlY3RvcnkgbmFtZXMKICAgICAgICAkdl9saXN0ID0gZXhwbG9kZSgiLyIsICRwX2Rpcik7CgogICAgICAgIC8vIC0tLS0tIFN0dWR5IGRpcmVjdG9yaWVzIGZyb20gbGFzdCB0byBmaXJzdAogICAgICAgICR2X3NraXAgPSAwOwogICAgICAgIGZvciAoJGk9c2l6ZW9mKCR2X2xpc3QpLTE7ICRpPj0wOyAkaS0tKSB7CiAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGN1cnJlbnQgcGF0aAogICAgICAgICAgICBpZiAoJHZfbGlzdFskaV0gPT0gIi4iKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBJZ25vcmUgdGhpcyBkaXJlY3RvcnkKICAgICAgICAgICAgICAgIC8vIFNob3VsZCBiZSB0aGUgZmlyc3QgJGk9MCwgYnV0IG5vIGNoZWNrIGlzIGRvbmUKICAgICAgICAgICAgfSBlbHNlaWYgKCR2X2xpc3RbJGldID09ICIuLiIpIHsKICAgICAgICAgICAgICAgICR2X3NraXArKzsKICAgICAgICAgICAgfSBlbHNlaWYgKCR2X2xpc3RbJGldID09ICIiKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0tLSBGaXJzdCAnLycgaS5lLiByb290IHNsYXNoCiAgICAgICAgICAgICAgICBpZiAoJGkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICR2X3Jlc3VsdCA9ICIvIi4kdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR2X3NraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tIEl0IGlzIGFuIGludmFsaWQgcGF0aCwgc28gdGhlIHBhdGggaXMgbm90IG1vZGlmaWVkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRCQwogICAgICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkcF9kaXI7CiAgICAgICAgICAgICAgICAgICAgICAgICR2X3NraXAgPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkaSA9PSAoc2l6ZW9mKCR2X2xpc3QpLTEpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gTGFzdCAnLycgaS5lLiBpbmRpY2F0ZXMgYSBkaXJlY3RvcnkKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdl9saXN0WyRpXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0gRG91YmxlICcvJyBpbnNpZGUgdGhlIHBhdGgKICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLSBJZ25vcmUgb25seSB0aGUgZG91YmxlICcvLycgaW4gcGF0aCwKICAgICAgICAgICAgICAgICAgICAvLyBidXQgbm90IHRoZSBmaXJzdCBhbmQgbGFzdCAnLycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGl0ZW0gdG8gc2tpcAogICAgICAgICAgICAgICAgaWYgKCR2X3NraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHZfc2tpcC0tOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAkdl9saXN0WyRpXS4oJGkhPShzaXplb2YoJHZfbGlzdCktMSk\/Ii8iLiR2X3Jlc3VsdDoiIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIHNraXAKICAgICAgICBpZiAoJHZfc2tpcCA+IDApIHsKICAgICAgICAgICAgd2hpbGUgKCR2X3NraXAgPiAwKSB7CiAgICAgICAgICAgICAgICAkdl9yZXN1bHQgPSAnLi4vJy4kdl9yZXN1bHQ7CiAgICAgICAgICAgICAgICAkdl9za2lwLS07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tLS0gUmV0dXJuCiAgICByZXR1cm4gJHZfcmVzdWx0Owp9Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBGdW5jdGlvbiA6IFBjbFppcFV0aWxQYXRoSW5jbHVzaW9uKCkKLy8gRGVzY3JpcHRpb24gOgovLyAgICAgVGhpcyBmdW5jdGlvbiBpbmRpY2F0ZXMgaWYgdGhlIHBhdGggJHBfcGF0aCBpcyB1bmRlciB0aGUgJHBfZGlyIHRyZWUuIE9yLAovLyAgICAgc2FpZCBpbiBhbiBvdGhlciB3YXksIGlmIHRoZSBmaWxlIG9yIHN1Yi1kaXIgJHBfcGF0aCBpcyBpbnNpZGUgdGhlIGRpcgovLyAgICAgJHBfZGlyLgovLyAgICAgVGhlIGZ1bmN0aW9uIGluZGljYXRlcyBhbHNvIGlmIHRoZSBwYXRoIGlzIGV4YWN0bHkgdGhlIHNhbWUgYXMgdGhlIGRpci4KLy8gICAgIFRoaXMgZnVuY3Rpb24gc3VwcG9ydHMgcGF0aCB3aXRoIGR1cGxpY2F0ZWQgJy8nIGxpa2UgJy8vJywgYnV0IGRvZXMgbm90Ci8vICAgICBzdXBwb3J0ICcuJyBvciAnLi4nIHN0YXRlbWVudHMuCi8vIFBhcmFtZXRlcnMgOgovLyBSZXR1cm4gVmFsdWVzIDoKLy8gICAgIDAgaWYgJHBfcGF0aCBpcyBub3QgaW5zaWRlIGRpcmVjdG9yeSAkcF9kaXIKLy8gICAgIDEgaWYgJHBfcGF0aCBpcyBpbnNpZGUgZGlyZWN0b3J5ICRwX2RpcgovLyAgICAgMiBpZiAkcF9wYXRoIGlzIGV4YWN0bHkgdGhlIHNhbWUgYXMgJHBfZGlyCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIFBjbFppcFV0aWxQYXRoSW5jbHVzaW9uKCRwX2RpciwgJHBfcGF0aCkKewogICAgJHZfcmVzdWx0ID0gMTsKCiAgICAvLyAtLS0tLSBMb29rIGZvciBwYXRoIGJlZ2lubmluZyBieSAuLwogICAgaWYgKCgkcF9kaXIgPT0gJy4nKSB8fCAoKHN0cmxlbigkcF9kaXIpID49MikgJiYgKHN1YnN0cigkcF9kaXIsIDAsIDIpID09ICcuLycpKSkgewogICAgICAgICRwX2RpciA9IFBjbFppcFV0aWxUcmFuc2xhdGVXaW5QYXRoKGdldGN3ZCgpLCBmYWxzZSkuJy8nLnN1YnN0cigkcF9kaXIsIDEpOwogICAgfQogICAgaWYgKCgkcF9wYXRoID09ICcuJykgfHwgKChzdHJsZW4oJHBfcGF0aCkgPj0yKSAmJiAoc3Vic3RyKCRwX3BhdGgsIDAsIDIpID09ICcuLycpKSkgewogICAgICAgICRwX3BhdGggPSBQY2xaaXBVdGlsVHJhbnNsYXRlV2luUGF0aChnZXRjd2QoKSwgZmFsc2UpLicvJy5zdWJzdHIoJHBfcGF0aCwgMSk7CiAgICB9CgogICAgLy8gLS0tLS0gRXhwbG9kZSBkaXIgYW5kIHBhdGggYnkgZGlyZWN0b3J5IHNlcGFyYXRvcgogICAgJHZfbGlzdF9kaXIgPSBleHBsb2RlKCIvIiwgJHBfZGlyKTsKICAgICR2X2xpc3RfZGlyX3NpemUgPSBzaXplb2YoJHZfbGlzdF9kaXIpOwogICAgJHZfbGlzdF9wYXRoID0gZXhwbG9kZSgiLyIsICRwX3BhdGgpOwogICAgJHZfbGlzdF9wYXRoX3NpemUgPSBzaXplb2YoJHZfbGlzdF9wYXRoKTsKCiAgICAvLyAtLS0tLSBTdHVkeSBkaXJlY3RvcmllcyBwYXRocwogICAgJGkgPSAwOwogICAgJGogPSAwOwogICAgd2hpbGUgKCgkaSA8ICR2X2xpc3RfZGlyX3NpemUpICYmICgkaiA8ICR2X2xpc3RfcGF0aF9zaXplKSAmJiAoJHZfcmVzdWx0KSkgewogICAgICAgIC8vIC0tLS0tIExvb2sgZm9yIGVtcHR5IGRpciAocGF0aCByZWR1Y3Rpb24pCiAgICAgICAgaWYgKCR2X2xpc3RfZGlyWyRpXSA9PSAnJykgewogICAgICAgICAgICAkaSsrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCR2X2xpc3RfcGF0aFskal0gPT0gJycpIHsKICAgICAgICAgICAgJGorKzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0tLSBDb21wYXJlIHRoZSBpdGVtcwogICAgICAgIGlmICgoJHZfbGlzdF9kaXJbJGldICE9ICR2X2xpc3RfcGF0aFskal0pICYmICgkdl9saXN0X2RpclskaV0gIT0gJycpICYmICgkdl9saXN0X3BhdGhbJGpdICE9ICcnKSkgewogICAgICAgICAgICAkdl9yZXN1bHQgPSAwOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0gTmV4dCBpdGVtcwogICAgICAgICRpKys7CiAgICAgICAgJGorKzsKICAgIH0KCiAgICAvLyAtLS0tLSBMb29rIGlmIGV2ZXJ5dGhpbmcgc2VlbXMgdG8gYmUgdGhlIHNhbWUKICAgIGlmICgkdl9yZXN1bHQpIHsKICAgICAgICAvLyAtLS0tLSBTa2lwIGFsbCB0aGUgZW1wdHkgaXRlbXMKICAgICAgICB3aGlsZSAoKCRqIDwgJHZfbGlzdF9wYXRoX3NpemUpICYmICgkdl9saXN0X3BhdGhbJGpdID09ICcnKSkgewogICAgICAgICAgICAkaisrOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoKCRpIDwgJHZfbGlzdF9kaXJfc2l6ZSkgJiYgKCR2X2xpc3RfZGlyWyRpXSA9PSAnJykpIHsKICAgICAgICAgICAgJGkrKzsKICAgICAgICB9CgogICAgICAgIGlmICgoJGkgPj0gJHZfbGlzdF9kaXJfc2l6ZSkgJiYgKCRqID49ICR2X2xpc3RfcGF0aF9zaXplKSkgewogICAgICAgICAgICAvLyAtLS0tLSBUaGVyZSBhcmUgZXhhY3RseSB0aGUgc2FtZQogICAgICAgICAgICAkdl9yZXN1bHQgPSAyOwogICAgICAgIH0gZWxzZWlmICgkaSA8ICR2X2xpc3RfZGlyX3NpemUpIHsKICAgICAgICAgICAgLy8gLS0tLS0gVGhlIHBhdGggaXMgc2hvcnRlciB0aGFuIHRoZSBkaXIKICAgICAgICAgICAgJHZfcmVzdWx0ID0gMDsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tLS0gUmV0dXJuCiAgICByZXR1cm4gJHZfcmVzdWx0Owp9Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBGdW5jdGlvbiA6IFBjbFppcFV0aWxDb3B5QmxvY2soKQovLyBEZXNjcmlwdGlvbiA6Ci8vIFBhcmFtZXRlcnMgOgovLyAgICAgJHBfbW9kZSA6IHJlYWQvd3JpdGUgY29tcHJlc3Npb24gbW9kZQovLyAgICAgICAgICAgICAgICAgICAgICAgICAwIDogc3JjICYgZGVzdCBub3JtYWwKLy8gICAgICAgICAgICAgICAgICAgICAgICAgMSA6IHNyYyBnemlwLCBkZXN0IG5vcm1hbAovLyAgICAgICAgICAgICAgICAgICAgICAgICAyIDogc3JjIG5vcm1hbCwgZGVzdCBnemlwCi8vICAgICAgICAgICAgICAgICAgICAgICAgIDMgOiBzcmMgJiBkZXN0IGd6aXAKLy8gUmV0dXJuIFZhbHVlcyA6Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIFBjbFppcFV0aWxDb3B5QmxvY2soJHBfc3JjLCAkcF9kZXN0LCAkcF9zaXplLCAkcF9tb2RlID0gMCkKewogICAgJHZfcmVzdWx0ID0gMTsKCiAgICBpZiAoJHBfbW9kZT09MCkgewogICAgICAgIHdoaWxlICgkcF9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCRwX3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHBfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBAZnJlYWQoJHBfc3JjLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICBAZndyaXRlKCRwX2Rlc3QsICR2X2J1ZmZlciwgJHZfcmVhZF9zaXplKTsKICAgICAgICAgICAgJHBfc2l6ZSAtPSAkdl9yZWFkX3NpemU7CiAgICAgICAgfQogICAgfSBlbHNlaWYgKCRwX21vZGU9PTEpIHsKICAgICAgICB3aGlsZSAoJHBfc2l6ZSAhPSAwKSB7CiAgICAgICAgICAgICR2X3JlYWRfc2l6ZSA9ICgkcF9zaXplIDwgUENMWklQX1JFQURfQkxPQ0tfU0laRSA\/ICRwX3NpemUgOiBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFKTsKICAgICAgICAgICAgJHZfYnVmZmVyID0gQGd6cmVhZCgkcF9zcmMsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgIEBmd3JpdGUoJHBfZGVzdCwgJHZfYnVmZmVyLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICAkcF9zaXplIC09ICR2X3JlYWRfc2l6ZTsKICAgICAgICB9CiAgICB9IGVsc2VpZiAoJHBfbW9kZT09MikgewogICAgICAgIHdoaWxlICgkcF9zaXplICE9IDApIHsKICAgICAgICAgICAgJHZfcmVhZF9zaXplID0gKCRwX3NpemUgPCBQQ0xaSVBfUkVBRF9CTE9DS19TSVpFID8gJHBfc2l6ZSA6IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUpOwogICAgICAgICAgICAkdl9idWZmZXIgPSBAZnJlYWQoJHBfc3JjLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICBAZ3p3cml0ZSgkcF9kZXN0LCAkdl9idWZmZXIsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgICRwX3NpemUgLT0gJHZfcmVhZF9zaXplOwogICAgICAgIH0KICAgIH0gZWxzZWlmICgkcF9tb2RlPT0zKSB7CiAgICAgICAgd2hpbGUgKCRwX3NpemUgIT0gMCkgewogICAgICAgICAgICAkdl9yZWFkX3NpemUgPSAoJHBfc2l6ZSA8IFBDTFpJUF9SRUFEX0JMT0NLX1NJWkUgPyAkcF9zaXplIDogUENMWklQX1JFQURfQkxPQ0tfU0laRSk7CiAgICAgICAgICAgICR2X2J1ZmZlciA9IEBnenJlYWQoJHBfc3JjLCAkdl9yZWFkX3NpemUpOwogICAgICAgICAgICBAZ3p3cml0ZSgkcF9kZXN0LCAkdl9idWZmZXIsICR2X3JlYWRfc2l6ZSk7CiAgICAgICAgICAgICRwX3NpemUgLT0gJHZfcmVhZF9zaXplOwogICAgICAgIH0KICAgIH0KCiAgICAvLyAtLS0tLSBSZXR1cm4KICAgIHJldHVybiAkdl9yZXN1bHQ7Cn0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEZ1bmN0aW9uIDogUGNsWmlwVXRpbFJlbmFtZSgpCi8vIERlc2NyaXB0aW9uIDoKLy8gICAgIFRoaXMgZnVuY3Rpb24gdHJpZXMgdG8gZG8gYSBzaW1wbGUgcmVuYW1lKCkgZnVuY3Rpb24uIElmIGl0IGZhaWxzLCBpdAovLyAgICAgdHJpZXMgdG8gY29weSB0aGUgJHBfc3JjIGZpbGUgaW4gYSBuZXcgJHBfZGVzdCBmaWxlIGFuZCB0aGVuIHVubGluayB0aGUKLy8gICAgIGZpcnN0IG9uZS4KLy8gUGFyYW1ldGVycyA6Ci8vICAgICAkcF9zcmMgOiBPbGQgZmlsZW5hbWUKLy8gICAgICRwX2Rlc3QgOiBOZXcgZmlsZW5hbWUKLy8gUmV0dXJuIFZhbHVlcyA6Ci8vICAgICAxIG9uIHN1Y2Nlc3MsIDAgb24gZmFpbHVyZS4KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gUGNsWmlwVXRpbFJlbmFtZSgkcF9zcmMsICRwX2Rlc3QpCnsKICAgICR2X3Jlc3VsdCA9IDE7CgogICAgLy8gLS0tLS0gVHJ5IHRvIHJlbmFtZSB0aGUgZmlsZXMKICAgIGlmICghQHJlbmFtZSgkcF9zcmMsICRwX2Rlc3QpKSB7CiAgICAgICAgLy8gLS0tLS0gVHJ5IHRvIGNvcHkgJiB1bmxpbmsgdGhlIHNyYwogICAgICAgIGlmICghQGNvcHkoJHBfc3JjLCAkcF9kZXN0KSkgewogICAgICAgICAgICAkdl9yZXN1bHQgPSAwOwogICAgICAgIH0gZWxzZWlmICghQHVubGluaygkcF9zcmMpKSB7CiAgICAgICAgICAgICR2X3Jlc3VsdCA9IDA7CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLS0tIFJldHVybgogICAgcmV0dXJuICR2X3Jlc3VsdDsKfQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRnVuY3Rpb24gOiBQY2xaaXBVdGlsT3B0aW9uVGV4dCgpCi8vIERlc2NyaXB0aW9uIDoKLy8gICAgIFRyYW5zbGF0ZSBvcHRpb24gdmFsdWUgaW4gdGV4dC4gTWFpbmx5IGZvciBkZWJ1ZyBwdXJwb3NlLgovLyBQYXJhbWV0ZXJzIDoKLy8gICAgICRwX29wdGlvbiA6IHRoZSBvcHRpb24gdmFsdWUuCi8vIFJldHVybiBWYWx1ZXMgOgovLyAgICAgVGhlIG9wdGlvbiB0ZXh0IHZhbHVlLgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBQY2xaaXBVdGlsT3B0aW9uVGV4dCgkcF9vcHRpb24pCnsKICAgICR2X2xpc3QgPSBnZXRfZGVmaW5lZF9jb25zdGFudHMoKTsKICAgIGZvciAocmVzZXQoJHZfbGlzdCk7ICR2X2tleSA9IGtleSgkdl9saXN0KTsgbmV4dCgkdl9saXN0KSkgewogICAgICAgICR2X3ByZWZpeCA9IHN1YnN0cigkdl9rZXksIDAsIDEwKTsKICAgICAgICBpZiAoKCgkdl9wcmVmaXggPT0gJ1BDTFpJUF9PUFQnKSB8fCAoJHZfcHJlZml4ID09ICdQQ0xaSVBfQ0JfJykgfHwgKCR2X3ByZWZpeCA9PSAnUENMWklQX0FUVCcpKSAmJiAoJHZfbGlzdFskdl9rZXldID09ICRwX29wdGlvbikpIHsKICAgICAgICAgICAgcmV0dXJuICR2X2tleTsKICAgICAgICB9CiAgICB9CgogICAgJHZfcmVzdWx0ID0gJ1Vua25vd24nOwoKICAgIHJldHVybiAkdl9yZXN1bHQ7Cn0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEZ1bmN0aW9uIDogUGNsWmlwVXRpbFRyYW5zbGF0ZVdpblBhdGgoKQovLyBEZXNjcmlwdGlvbiA6Ci8vICAgICBUcmFuc2xhdGUgd2luZG93cyBwYXRoIGJ5IHJlcGxhY2luZyAnXCcgYnkgJy8nIGFuZCBvcHRpb25hbGx5IHJlbW92aW5nCi8vICAgICBkcml2ZSBsZXR0ZXIuCi8vIFBhcmFtZXRlcnMgOgovLyAgICAgJHBfcGF0aCA6IHBhdGggdG8gdHJhbnNsYXRlLgovLyAgICAgJHBfcmVtb3ZlX2Rpc2tfbGV0dGVyIDogdHJ1ZSB8IGZhbHNlCi8vIFJldHVybiBWYWx1ZXMgOgovLyAgICAgVGhlIHBhdGggdHJhbnNsYXRlZC4KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gUGNsWmlwVXRpbFRyYW5zbGF0ZVdpblBhdGgoJHBfcGF0aCwgJHBfcmVtb3ZlX2Rpc2tfbGV0dGVyID0gdHJ1ZSkKewogICAgaWYgKHN0cmlzdHIocGhwX3VuYW1lKCksICd3aW5kb3dzJykpIHsKICAgICAgICAvLyAtLS0tLSBMb29rIGZvciBwb3RlbnRpYWwgZGlzayBsZXR0ZXIKICAgICAgICBpZiAoKCRwX3JlbW92ZV9kaXNrX2xldHRlcikgJiYgKCgkdl9wb3NpdGlvbiA9IHN0cnBvcygkcF9wYXRoLCAnOicpKSAhPSBmYWxzZSkpIHsKICAgICAgICAgICAgJHBfcGF0aCA9IHN1YnN0cigkcF9wYXRoLCAkdl9wb3NpdGlvbisxKTsKICAgICAgICB9CiAgICAgICAgLy8gLS0tLS0gQ2hhbmdlIHBvdGVudGlhbCB3aW5kb3dzIGRpcmVjdG9yeSBzZXBhcmF0b3IKICAgICAgICBpZiAoKHN0cnBvcygkcF9wYXRoLCAnXFwnKSA+IDApIHx8IChzdWJzdHIoJHBfcGF0aCwgMCwgMSkgPT0gJ1xcJykpIHsKICAgICAgICAgICAgJHBfcGF0aCA9IHN0cnRyKCRwX3BhdGgsICdcXCcsICcvJyk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuICRwX3BhdGg7Cn0K",
    "size": "214239"
}