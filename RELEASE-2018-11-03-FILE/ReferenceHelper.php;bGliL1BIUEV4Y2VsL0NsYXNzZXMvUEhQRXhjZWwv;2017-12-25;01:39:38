{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/ReferenceHelper.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKgogKiBQSFBFeGNlbF9SZWZlcmVuY2VIZWxwZXIgKFNpbmdsZXRvbikKICoKICogQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbAogKgogKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCiAqIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KICoKICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3YXJlCiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgIDAyMTEwLTEzMDEgIFVTQQogKgogKiBAY2F0ZWdvcnkgICBQSFBFeGNlbAogKiBAcGFja2FnZSAgICBQSFBFeGNlbAogKiBAY29weXJpZ2h0ICBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsIChodHRwOi8vd3d3LmNvZGVwbGV4LmNvbS9QSFBFeGNlbCkKICogQGxpY2Vuc2UgICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL29sZC1saWNlbnNlcy9sZ3BsLTIuMS50eHQgICAgTEdQTAogKiBAdmVyc2lvbiAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCmNsYXNzIFBIUEV4Y2VsX1JlZmVyZW5jZUhlbHBlcgp7CiAgICAvKiogICAgQ29uc3RhbnRzICAgICAgICAgICAgICAgICovCiAgICAvKiogICAgUmVndWxhciBFeHByZXNzaW9ucyAgICAgICovCiAgICBjb25zdCBSRUZIRUxQRVJfUkVHRVhQX0NFTExSRUYgICAgICA9ICcoKFx3KnxcJ1teIV0qXCcpISk\/KD88IVs6YS16XCRdKShcJD9bYS16XXsxLDN9XCQ\/XGQrKSg\/PVteOiFcZFwnXSknOwogICAgY29uc3QgUkVGSEVMUEVSX1JFR0VYUF9DRUxMUkFOR0UgICAgPSAnKChcdyp8XCdbXiFdKlwnKSEpPyhcJD9bYS16XXsxLDN9XCQ\/XGQrKTooXCQ\/W2Etel17MSwzfVwkP1xkKyknOwogICAgY29uc3QgUkVGSEVMUEVSX1JFR0VYUF9ST1dSQU5HRSAgICAgPSAnKChcdyp8XCdbXiFdKlwnKSEpPyhcJD9cZCspOihcJD9cZCspJzsKICAgIGNvbnN0IFJFRkhFTFBFUl9SRUdFWFBfQ09MUkFOR0UgICAgID0gJygoXHcqfFwnW14hXSpcJykhKT8oXCQ\/W2Etel17MSwzfSk6KFwkP1thLXpdezEsM30pJzsKCiAgICAvKioKICAgICAqIEluc3RhbmNlIG9mIHRoaXMgY2xhc3MKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX1JlZmVyZW5jZUhlbHBlcgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyAkaW5zdGFuY2U7CgogICAgLyoqCiAgICAgKiBHZXQgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcwogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0SW5zdGFuY2UoKQogICAgewogICAgICAgIGlmICghaXNzZXQoc2VsZjo6JGluc3RhbmNlKSB8fCAoc2VsZjo6JGluc3RhbmNlID09PSBudWxsKSkgewogICAgICAgICAgICBzZWxmOjokaW5zdGFuY2UgPSBuZXcgUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjo6JGluc3RhbmNlOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IFBIUEV4Y2VsX1JlZmVyZW5jZUhlbHBlcgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKQogICAgewogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyZSB0d28gY29sdW1uIGFkZHJlc3NlcwogICAgICogSW50ZW5kZWQgZm9yIHVzZSBhcyBhIENhbGxiYWNrIGZ1bmN0aW9uIGZvciBzb3J0aW5nIGNvbHVtbiBhZGRyZXNzZXMgYnkgY29sdW1uCiAgICAgKgogICAgICogQHBhcmFtICAgc3RyaW5nICAgJGEgIEZpcnN0IGNvbHVtbiB0byB0ZXN0IChlLmcuICdBQScpCiAgICAgKiBAcGFyYW0gICBzdHJpbmcgICAkYiAgU2Vjb25kIGNvbHVtbiB0byB0ZXN0IChlLmcuICdaJykKICAgICAqIEByZXR1cm4gIGludGVnZXIKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBjb2x1bW5Tb3J0KCRhLCAkYikKICAgIHsKICAgICAgICByZXR1cm4gc3RyY2FzZWNtcChzdHJsZW4oJGEpIC4gJGEsIHN0cmxlbigkYikgLiAkYik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYXJlIHR3byBjb2x1bW4gYWRkcmVzc2VzCiAgICAgKiBJbnRlbmRlZCBmb3IgdXNlIGFzIGEgQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHJldmVyc2Ugc29ydGluZyBjb2x1bW4gYWRkcmVzc2VzIGJ5IGNvbHVtbgogICAgICoKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICRhICBGaXJzdCBjb2x1bW4gdG8gdGVzdCAoZS5nLiAnQUEnKQogICAgICogQHBhcmFtICAgc3RyaW5nICAgJGIgIFNlY29uZCBjb2x1bW4gdG8gdGVzdCAoZS5nLiAnWicpCiAgICAgKiBAcmV0dXJuICBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY29sdW1uUmV2ZXJzZVNvcnQoJGEsICRiKQogICAgewogICAgICAgIHJldHVybiAxIC0gc3RyY2FzZWNtcChzdHJsZW4oJGEpIC4gJGEsIHN0cmxlbigkYikgLiAkYik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYXJlIHR3byBjZWxsIGFkZHJlc3NlcwogICAgICogSW50ZW5kZWQgZm9yIHVzZSBhcyBhIENhbGxiYWNrIGZ1bmN0aW9uIGZvciBzb3J0aW5nIGNlbGwgYWRkcmVzc2VzIGJ5IGNvbHVtbiBhbmQgcm93CiAgICAgKgogICAgICogQHBhcmFtICAgc3RyaW5nICAgJGEgIEZpcnN0IGNlbGwgdG8gdGVzdCAoZS5nLiAnQUExJykKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICRiICBTZWNvbmQgY2VsbCB0byB0ZXN0IChlLmcuICdaMScpCiAgICAgKiBAcmV0dXJuICBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY2VsbFNvcnQoJGEsICRiKQogICAgewogICAgICAgIHNzY2FuZigkYSwgJyVbQS1aXSVkJywgJGFjLCAkYXIpOwogICAgICAgIHNzY2FuZigkYiwgJyVbQS1aXSVkJywgJGJjLCAkYnIpOwoKICAgICAgICBpZiAoJGFyID09ICRicikgewogICAgICAgICAgICByZXR1cm4gc3RyY2FzZWNtcChzdHJsZW4oJGFjKSAuICRhYywgc3RybGVuKCRiYykgLiAkYmMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKCRhciA8ICRicikgPyAtMSA6IDE7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYXJlIHR3byBjZWxsIGFkZHJlc3NlcwogICAgICogSW50ZW5kZWQgZm9yIHVzZSBhcyBhIENhbGxiYWNrIGZ1bmN0aW9uIGZvciBzb3J0aW5nIGNlbGwgYWRkcmVzc2VzIGJ5IGNvbHVtbiBhbmQgcm93CiAgICAgKgogICAgICogQHBhcmFtICAgc3RyaW5nICAgJGEgIEZpcnN0IGNlbGwgdG8gdGVzdCAoZS5nLiAnQUExJykKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICRiICBTZWNvbmQgY2VsbCB0byB0ZXN0IChlLmcuICdaMScpCiAgICAgKiBAcmV0dXJuICBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY2VsbFJldmVyc2VTb3J0KCRhLCAkYikKICAgIHsKICAgICAgICBzc2NhbmYoJGEsICclW0EtWl0lZCcsICRhYywgJGFyKTsKICAgICAgICBzc2NhbmYoJGIsICclW0EtWl0lZCcsICRiYywgJGJyKTsKCiAgICAgICAgaWYgKCRhciA9PSAkYnIpIHsKICAgICAgICAgICAgcmV0dXJuIDEgLSBzdHJjYXNlY21wKHN0cmxlbigkYWMpIC4gJGFjLCBzdHJsZW4oJGJjKSAuICRiYyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoJGFyIDwgJGJyKSA\/IDEgOiAtMTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3Qgd2hldGhlciBhIGNlbGwgYWRkcmVzcyBmYWxscyB3aXRoaW4gYSBkZWZpbmVkIHJhbmdlIG9mIGNlbGxzCiAgICAgKgogICAgICogQHBhcmFtICAgc3RyaW5nICAgICAkY2VsbEFkZHJlc3MgICAgICAgIEFkZHJlc3Mgb2YgdGhlIGNlbGwgd2UncmUgdGVzdGluZwogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAkYmVmb3JlUm93ICAgICAgICAgIE51bWJlciBvZiB0aGUgcm93IHdlJ3JlIGluc2VydGluZy9kZWxldGluZyBiZWZvcmUKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgJHBOdW1Sb3dzICAgICAgICAgICBOdW1iZXIgb2Ygcm93cyB0byBpbnNlcnQvZGVsZXRlIChuZWdhdGl2ZSB2YWx1ZXMgaW5kaWNhdGUgZGVsZXRpb24pCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICRiZWZvcmVDb2x1bW5JbmRleCAgSW5kZXggbnVtYmVyIG9mIHRoZSBjb2x1bW4gd2UncmUgaW5zZXJ0aW5nL2RlbGV0aW5nIGJlZm9yZQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAkcE51bUNvbHMgICAgICAgICAgIE51bWJlciBvZiBjb2x1bW5zIHRvIGluc2VydC9kZWxldGUgKG5lZ2F0aXZlIHZhbHVlcyBpbmRpY2F0ZSBkZWxldGlvbikKICAgICAqIEByZXR1cm4gIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gY2VsbEFkZHJlc3NJbkRlbGV0ZVJhbmdlKCRjZWxsQWRkcmVzcywgJGJlZm9yZVJvdywgJHBOdW1Sb3dzLCAkYmVmb3JlQ29sdW1uSW5kZXgsICRwTnVtQ29scykKICAgIHsKICAgICAgICBsaXN0KCRjZWxsQ29sdW1uLCAkY2VsbFJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkY2VsbEFkZHJlc3MpOwogICAgICAgICRjZWxsQ29sdW1uSW5kZXggPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNlbGxDb2x1bW4pOwogICAgICAgIC8vICAgIElzIGNlbGwgd2l0aGluIHRoZSByYW5nZSBvZiByb3dzL2NvbHVtbnMgaWYgd2UncmUgZGVsZXRpbmcKICAgICAgICBpZiAoJHBOdW1Sb3dzIDwgMCAmJgogICAgICAgICAgICAoJGNlbGxSb3cgPj0gKCRiZWZvcmVSb3cgKyAkcE51bVJvd3MpKSAmJgogICAgICAgICAgICAoJGNlbGxSb3cgPCAkYmVmb3JlUm93KSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2VpZiAoJHBOdW1Db2xzIDwgMCAmJgogICAgICAgICAgICAoJGNlbGxDb2x1bW5JbmRleCA+PSAoJGJlZm9yZUNvbHVtbkluZGV4ICsgJHBOdW1Db2xzKSkgJiYKICAgICAgICAgICAgKCRjZWxsQ29sdW1uSW5kZXggPCAkYmVmb3JlQ29sdW1uSW5kZXgpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgcGFnZSBicmVha3Mgd2hlbiBpbnNlcnRpbmcvZGVsZXRpbmcgcm93cy9jb2x1bW5zCiAgICAgKgogICAgICogQHBhcmFtICAgUEhQRXhjZWxfV29ya3NoZWV0ICAkcFNoZWV0ICAgICAgICAgICAgIFRoZSB3b3Jrc2hlZXQgdGhhdCB3ZSdyZSBlZGl0aW5nCiAgICAgKiBAcGFyYW0gICBzdHJpbmcgICAgICAgICAgICAgICRwQmVmb3JlICAgICAgICAgICAgSW5zZXJ0L0RlbGV0ZSBiZWZvcmUgdGhpcyBjZWxsIGFkZHJlc3MgKGUuZy4gJ0ExJykKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJGJlZm9yZUNvbHVtbkluZGV4ICBJbmRleCBudW1iZXIgb2YgdGhlIGNvbHVtbiB3ZSdyZSBpbnNlcnRpbmcvZGVsZXRpbmcgYmVmb3JlCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRwTnVtQ29scyAgICAgICAgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5zZXJ0L2RlbGV0ZSAobmVnYXRpdmUgdmFsdWVzIGluZGljYXRlIGRlbGV0aW9uKQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkYmVmb3JlUm93ICAgICAgICAgIE51bWJlciBvZiB0aGUgcm93IHdlJ3JlIGluc2VydGluZy9kZWxldGluZyBiZWZvcmUKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJHBOdW1Sb3dzICAgICAgICAgICBOdW1iZXIgb2Ygcm93cyB0byBpbnNlcnQvZGVsZXRlIChuZWdhdGl2ZSB2YWx1ZXMgaW5kaWNhdGUgZGVsZXRpb24pCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGp1c3RQYWdlQnJlYWtzKFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0LCAkcEJlZm9yZSwgJGJlZm9yZUNvbHVtbkluZGV4LCAkcE51bUNvbHMsICRiZWZvcmVSb3csICRwTnVtUm93cykKICAgIHsKICAgICAgICAkYUJyZWFrcyA9ICRwU2hlZXQtPmdldEJyZWFrcygpOwogICAgICAgICgkcE51bUNvbHMgPiAwIHx8ICRwTnVtUm93cyA+IDApID8KICAgICAgICAgICAgdWtzb3J0KCRhQnJlYWtzLCBhcnJheSgnUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyJywnY2VsbFJldmVyc2VTb3J0JykpIDoKICAgICAgICAgICAgdWtzb3J0KCRhQnJlYWtzLCBhcnJheSgnUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyJywnY2VsbFNvcnQnKSk7CgogICAgICAgIGZvcmVhY2ggKCRhQnJlYWtzIGFzICRrZXkgPT4gJHZhbHVlKSB7CiAgICAgICAgICAgIGlmIChzZWxmOjpjZWxsQWRkcmVzc0luRGVsZXRlUmFuZ2UoJGtleSwgJGJlZm9yZVJvdywgJHBOdW1Sb3dzLCAkYmVmb3JlQ29sdW1uSW5kZXgsICRwTnVtQ29scykpIHsKICAgICAgICAgICAgICAgIC8vICAgIElmIHdlJ3JlIGRlbGV0aW5nLCB0aGVuIGNsZWFyIGFueSBkZWZpbmVkIGJyZWFrcyB0aGF0IGFyZSB3aXRoaW4gdGhlIHJhbmdlCiAgICAgICAgICAgICAgICAvLyAgICAgICAgb2Ygcm93cy9jb2x1bW5zIHRoYXQgd2UncmUgZGVsZXRpbmcKICAgICAgICAgICAgICAgICRwU2hlZXQtPnNldEJyZWFrKCRrZXksIFBIUEV4Y2VsX1dvcmtzaGVldDo6QlJFQUtfTk9ORSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAgICBPdGhlcndpc2UgdXBkYXRlIGFueSBhZmZlY3RlZCBicmVha3MgYnkgaW5zZXJ0aW5nIGEgbmV3IGJyZWFrIGF0IHRoZSBhcHByb3ByaWF0ZSBwb2ludAogICAgICAgICAgICAgICAgLy8gICAgICAgIGFuZCByZW1vdmluZyB0aGUgb2xkIGFmZmVjdGVkIGJyZWFrCiAgICAgICAgICAgICAgICAkbmV3UmVmZXJlbmNlID0gJHRoaXMtPnVwZGF0ZUNlbGxSZWZlcmVuY2UoJGtleSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKTsKICAgICAgICAgICAgICAgIGlmICgka2V5ICE9ICRuZXdSZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAkcFNoZWV0LT5zZXRCcmVhaygkbmV3UmVmZXJlbmNlLCAkdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+c2V0QnJlYWsoJGtleSwgUEhQRXhjZWxfV29ya3NoZWV0OjpCUkVBS19OT05FKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBjZWxsIGNvbW1lbnRzIHdoZW4gaW5zZXJ0aW5nL2RlbGV0aW5nIHJvd3MvY29sdW1ucwogICAgICoKICAgICAqIEBwYXJhbSAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgJHBTaGVldCAgICAgICAgICAgICBUaGUgd29ya3NoZWV0IHRoYXQgd2UncmUgZWRpdGluZwogICAgICogQHBhcmFtICAgc3RyaW5nICAgICAgICAgICAgICAkcEJlZm9yZSAgICAgICAgICAgIEluc2VydC9EZWxldGUgYmVmb3JlIHRoaXMgY2VsbCBhZGRyZXNzIChlLmcuICdBMScpCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRiZWZvcmVDb2x1bW5JbmRleCAgSW5kZXggbnVtYmVyIG9mIHRoZSBjb2x1bW4gd2UncmUgaW5zZXJ0aW5nL2RlbGV0aW5nIGJlZm9yZQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkcE51bUNvbHMgICAgICAgICAgIE51bWJlciBvZiBjb2x1bW5zIHRvIGluc2VydC9kZWxldGUgKG5lZ2F0aXZlIHZhbHVlcyBpbmRpY2F0ZSBkZWxldGlvbikKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJGJlZm9yZVJvdyAgICAgICAgICBOdW1iZXIgb2YgdGhlIHJvdyB3ZSdyZSBpbnNlcnRpbmcvZGVsZXRpbmcgYmVmb3JlCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRwTnVtUm93cyAgICAgICAgICAgTnVtYmVyIG9mIHJvd3MgdG8gaW5zZXJ0L2RlbGV0ZSAobmVnYXRpdmUgdmFsdWVzIGluZGljYXRlIGRlbGV0aW9uKQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRqdXN0Q29tbWVudHMoJHBTaGVldCwgJHBCZWZvcmUsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzLCAkYmVmb3JlUm93LCAkcE51bVJvd3MpCiAgICB7CiAgICAgICAgJGFDb21tZW50cyA9ICRwU2hlZXQtPmdldENvbW1lbnRzKCk7CiAgICAgICAgJGFOZXdDb21tZW50cyA9IGFycmF5KCk7IC8vIHRoZSBuZXcgYXJyYXkgb2YgYWxsIGNvbW1lbnRzCgogICAgICAgIGZvcmVhY2ggKCRhQ29tbWVudHMgYXMgJGtleSA9PiAmJHZhbHVlKSB7CiAgICAgICAgICAgIC8vIEFueSBjb21tZW50cyBpbnNpZGUgYSBkZWxldGVkIHJhbmdlIHdpbGwgYmUgaWdub3JlZAogICAgICAgICAgICBpZiAoIXNlbGY6OmNlbGxBZGRyZXNzSW5EZWxldGVSYW5nZSgka2V5LCAkYmVmb3JlUm93LCAkcE51bVJvd3MsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzKSkgewogICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGJ1aWxkIGEgbmV3IGFycmF5IG9mIGNvbW1lbnRzIGluZGV4ZWQgYnkgdGhlIGFkanVzdGVkIGNlbGwgcmVmZXJlbmNlCiAgICAgICAgICAgICAgICAkbmV3UmVmZXJlbmNlID0gJHRoaXMtPnVwZGF0ZUNlbGxSZWZlcmVuY2UoJGtleSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKTsKICAgICAgICAgICAgICAgICRhTmV3Q29tbWVudHNbJG5ld1JlZmVyZW5jZV0gPSAkdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gICAgUmVwbGFjZSB0aGUgY29tbWVudHMgYXJyYXkgd2l0aCB0aGUgbmV3IHNldCBvZiBjb21tZW50cwogICAgICAgICRwU2hlZXQtPnNldENvbW1lbnRzKCRhTmV3Q29tbWVudHMpOwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIGh5cGVybGlua3Mgd2hlbiBpbnNlcnRpbmcvZGVsZXRpbmcgcm93cy9jb2x1bW5zCiAgICAgKgogICAgICogQHBhcmFtICAgUEhQRXhjZWxfV29ya3NoZWV0ICAkcFNoZWV0ICAgICAgICAgICAgIFRoZSB3b3Jrc2hlZXQgdGhhdCB3ZSdyZSBlZGl0aW5nCiAgICAgKiBAcGFyYW0gICBzdHJpbmcgICAgICAgICAgICAgICRwQmVmb3JlICAgICAgICAgICAgSW5zZXJ0L0RlbGV0ZSBiZWZvcmUgdGhpcyBjZWxsIGFkZHJlc3MgKGUuZy4gJ0ExJykKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJGJlZm9yZUNvbHVtbkluZGV4ICBJbmRleCBudW1iZXIgb2YgdGhlIGNvbHVtbiB3ZSdyZSBpbnNlcnRpbmcvZGVsZXRpbmcgYmVmb3JlCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRwTnVtQ29scyAgICAgICAgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5zZXJ0L2RlbGV0ZSAobmVnYXRpdmUgdmFsdWVzIGluZGljYXRlIGRlbGV0aW9uKQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkYmVmb3JlUm93ICAgICAgICAgIE51bWJlciBvZiB0aGUgcm93IHdlJ3JlIGluc2VydGluZy9kZWxldGluZyBiZWZvcmUKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJHBOdW1Sb3dzICAgICAgICAgICBOdW1iZXIgb2Ygcm93cyB0byBpbnNlcnQvZGVsZXRlIChuZWdhdGl2ZSB2YWx1ZXMgaW5kaWNhdGUgZGVsZXRpb24pCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGp1c3RIeXBlcmxpbmtzKCRwU2hlZXQsICRwQmVmb3JlLCAkYmVmb3JlQ29sdW1uSW5kZXgsICRwTnVtQ29scywgJGJlZm9yZVJvdywgJHBOdW1Sb3dzKQogICAgewogICAgICAgICRhSHlwZXJsaW5rQ29sbGVjdGlvbiA9ICRwU2hlZXQtPmdldEh5cGVybGlua0NvbGxlY3Rpb24oKTsKICAgICAgICAoJHBOdW1Db2xzID4gMCB8fCAkcE51bVJvd3MgPiAwKSA\/IHVrc29ydCgkYUh5cGVybGlua0NvbGxlY3Rpb24sIGFycmF5KCdQSFBFeGNlbF9SZWZlcmVuY2VIZWxwZXInLCdjZWxsUmV2ZXJzZVNvcnQnKSkgOiB1a3NvcnQoJGFIeXBlcmxpbmtDb2xsZWN0aW9uLCBhcnJheSgnUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyJywnY2VsbFNvcnQnKSk7CgogICAgICAgIGZvcmVhY2ggKCRhSHlwZXJsaW5rQ29sbGVjdGlvbiBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAkbmV3UmVmZXJlbmNlID0gJHRoaXMtPnVwZGF0ZUNlbGxSZWZlcmVuY2UoJGtleSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKTsKICAgICAgICAgICAgaWYgKCRrZXkgIT0gJG5ld1JlZmVyZW5jZSkgewogICAgICAgICAgICAgICAgJHBTaGVldC0+c2V0SHlwZXJsaW5rKCRuZXdSZWZlcmVuY2UsICR2YWx1ZSk7CiAgICAgICAgICAgICAgICAkcFNoZWV0LT5zZXRIeXBlcmxpbmsoJGtleSwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgZGF0YSB2YWxpZGF0aW9ucyB3aGVuIGluc2VydGluZy9kZWxldGluZyByb3dzL2NvbHVtbnMKICAgICAqCiAgICAgKiBAcGFyYW0gICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICRwU2hlZXQgICAgICAgICAgICAgVGhlIHdvcmtzaGVldCB0aGF0IHdlJ3JlIGVkaXRpbmcKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgICAgICAgICAgJHBCZWZvcmUgICAgICAgICAgICBJbnNlcnQvRGVsZXRlIGJlZm9yZSB0aGlzIGNlbGwgYWRkcmVzcyAoZS5nLiAnQTEnKQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkYmVmb3JlQ29sdW1uSW5kZXggIEluZGV4IG51bWJlciBvZiB0aGUgY29sdW1uIHdlJ3JlIGluc2VydGluZy9kZWxldGluZyBiZWZvcmUKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJHBOdW1Db2xzICAgICAgICAgICBOdW1iZXIgb2YgY29sdW1ucyB0byBpbnNlcnQvZGVsZXRlIChuZWdhdGl2ZSB2YWx1ZXMgaW5kaWNhdGUgZGVsZXRpb24pCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRiZWZvcmVSb3cgICAgICAgICAgTnVtYmVyIG9mIHRoZSByb3cgd2UncmUgaW5zZXJ0aW5nL2RlbGV0aW5nIGJlZm9yZQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkcE51bVJvd3MgICAgICAgICAgIE51bWJlciBvZiByb3dzIHRvIGluc2VydC9kZWxldGUgKG5lZ2F0aXZlIHZhbHVlcyBpbmRpY2F0ZSBkZWxldGlvbikKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkanVzdERhdGFWYWxpZGF0aW9ucygkcFNoZWV0LCAkcEJlZm9yZSwgJGJlZm9yZUNvbHVtbkluZGV4LCAkcE51bUNvbHMsICRiZWZvcmVSb3csICRwTnVtUm93cykKICAgIHsKICAgICAgICAkYURhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbiA9ICRwU2hlZXQtPmdldERhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbigpOwogICAgICAgICgkcE51bUNvbHMgPiAwIHx8ICRwTnVtUm93cyA+IDApID8gdWtzb3J0KCRhRGF0YVZhbGlkYXRpb25Db2xsZWN0aW9uLCBhcnJheSgnUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyJywnY2VsbFJldmVyc2VTb3J0JykpIDogdWtzb3J0KCRhRGF0YVZhbGlkYXRpb25Db2xsZWN0aW9uLCBhcnJheSgnUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyJywnY2VsbFNvcnQnKSk7CiAgICAgICAgCiAgICAgICAgZm9yZWFjaCAoJGFEYXRhVmFsaWRhdGlvbkNvbGxlY3Rpb24gYXMgJGtleSA9PiAkdmFsdWUpIHsKICAgICAgICAgICAgJG5ld1JlZmVyZW5jZSA9ICR0aGlzLT51cGRhdGVDZWxsUmVmZXJlbmNlKCRrZXksICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyk7CiAgICAgICAgICAgIGlmICgka2V5ICE9ICRuZXdSZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICRwU2hlZXQtPnNldERhdGFWYWxpZGF0aW9uKCRuZXdSZWZlcmVuY2UsICR2YWx1ZSk7CiAgICAgICAgICAgICAgICAkcFNoZWV0LT5zZXREYXRhVmFsaWRhdGlvbigka2V5LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBtZXJnZWQgY2VsbHMgd2hlbiBpbnNlcnRpbmcvZGVsZXRpbmcgcm93cy9jb2x1bW5zCiAgICAgKgogICAgICogQHBhcmFtICAgUEhQRXhjZWxfV29ya3NoZWV0ICAkcFNoZWV0ICAgICAgICAgICAgIFRoZSB3b3Jrc2hlZXQgdGhhdCB3ZSdyZSBlZGl0aW5nCiAgICAgKiBAcGFyYW0gICBzdHJpbmcgICAgICAgICAgICAgICRwQmVmb3JlICAgICAgICAgICAgSW5zZXJ0L0RlbGV0ZSBiZWZvcmUgdGhpcyBjZWxsIGFkZHJlc3MgKGUuZy4gJ0ExJykKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJGJlZm9yZUNvbHVtbkluZGV4ICBJbmRleCBudW1iZXIgb2YgdGhlIGNvbHVtbiB3ZSdyZSBpbnNlcnRpbmcvZGVsZXRpbmcgYmVmb3JlCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRwTnVtQ29scyAgICAgICAgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5zZXJ0L2RlbGV0ZSAobmVnYXRpdmUgdmFsdWVzIGluZGljYXRlIGRlbGV0aW9uKQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkYmVmb3JlUm93ICAgICAgICAgIE51bWJlciBvZiB0aGUgcm93IHdlJ3JlIGluc2VydGluZy9kZWxldGluZyBiZWZvcmUKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJHBOdW1Sb3dzICAgICAgICAgICBOdW1iZXIgb2Ygcm93cyB0byBpbnNlcnQvZGVsZXRlIChuZWdhdGl2ZSB2YWx1ZXMgaW5kaWNhdGUgZGVsZXRpb24pCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGp1c3RNZXJnZUNlbGxzKCRwU2hlZXQsICRwQmVmb3JlLCAkYmVmb3JlQ29sdW1uSW5kZXgsICRwTnVtQ29scywgJGJlZm9yZVJvdywgJHBOdW1Sb3dzKQogICAgewogICAgICAgICRhTWVyZ2VDZWxscyA9ICRwU2hlZXQtPmdldE1lcmdlQ2VsbHMoKTsKICAgICAgICAkYU5ld01lcmdlQ2VsbHMgPSBhcnJheSgpOyAvLyB0aGUgbmV3IGFycmF5IG9mIGFsbCBtZXJnZSBjZWxscwogICAgICAgIGZvcmVhY2ggKCRhTWVyZ2VDZWxscyBhcyAka2V5ID0+ICYkdmFsdWUpIHsKICAgICAgICAgICAgJG5ld1JlZmVyZW5jZSA9ICR0aGlzLT51cGRhdGVDZWxsUmVmZXJlbmNlKCRrZXksICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyk7CiAgICAgICAgICAgICRhTmV3TWVyZ2VDZWxsc1skbmV3UmVmZXJlbmNlXSA9ICRuZXdSZWZlcmVuY2U7CiAgICAgICAgfQogICAgICAgICRwU2hlZXQtPnNldE1lcmdlQ2VsbHMoJGFOZXdNZXJnZUNlbGxzKTsgLy8gcmVwbGFjZSB0aGUgbWVyZ2UgY2VsbHMgYXJyYXkKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBwcm90ZWN0ZWQgY2VsbHMgd2hlbiBpbnNlcnRpbmcvZGVsZXRpbmcgcm93cy9jb2x1bW5zCiAgICAgKgogICAgICogQHBhcmFtICAgUEhQRXhjZWxfV29ya3NoZWV0ICAkcFNoZWV0ICAgICAgICAgICAgIFRoZSB3b3Jrc2hlZXQgdGhhdCB3ZSdyZSBlZGl0aW5nCiAgICAgKiBAcGFyYW0gICBzdHJpbmcgICAgICAgICAgICAgICRwQmVmb3JlICAgICAgICAgICAgSW5zZXJ0L0RlbGV0ZSBiZWZvcmUgdGhpcyBjZWxsIGFkZHJlc3MgKGUuZy4gJ0ExJykKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJGJlZm9yZUNvbHVtbkluZGV4ICBJbmRleCBudW1iZXIgb2YgdGhlIGNvbHVtbiB3ZSdyZSBpbnNlcnRpbmcvZGVsZXRpbmcgYmVmb3JlCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRwTnVtQ29scyAgICAgICAgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5zZXJ0L2RlbGV0ZSAobmVnYXRpdmUgdmFsdWVzIGluZGljYXRlIGRlbGV0aW9uKQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkYmVmb3JlUm93ICAgICAgICAgIE51bWJlciBvZiB0aGUgcm93IHdlJ3JlIGluc2VydGluZy9kZWxldGluZyBiZWZvcmUKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJHBOdW1Sb3dzICAgICAgICAgICBOdW1iZXIgb2Ygcm93cyB0byBpbnNlcnQvZGVsZXRlIChuZWdhdGl2ZSB2YWx1ZXMgaW5kaWNhdGUgZGVsZXRpb24pCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGp1c3RQcm90ZWN0ZWRDZWxscygkcFNoZWV0LCAkcEJlZm9yZSwgJGJlZm9yZUNvbHVtbkluZGV4LCAkcE51bUNvbHMsICRiZWZvcmVSb3csICRwTnVtUm93cykKICAgIHsKICAgICAgICAkYVByb3RlY3RlZENlbGxzID0gJHBTaGVldC0+Z2V0UHJvdGVjdGVkQ2VsbHMoKTsKICAgICAgICAoJHBOdW1Db2xzID4gMCB8fCAkcE51bVJvd3MgPiAwKSA\/CiAgICAgICAgICAgIHVrc29ydCgkYVByb3RlY3RlZENlbGxzLCBhcnJheSgnUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyJywnY2VsbFJldmVyc2VTb3J0JykpIDoKICAgICAgICAgICAgdWtzb3J0KCRhUHJvdGVjdGVkQ2VsbHMsIGFycmF5KCdQSFBFeGNlbF9SZWZlcmVuY2VIZWxwZXInLCdjZWxsU29ydCcpKTsKICAgICAgICBmb3JlYWNoICgkYVByb3RlY3RlZENlbGxzIGFzICRrZXkgPT4gJHZhbHVlKSB7CiAgICAgICAgICAgICRuZXdSZWZlcmVuY2UgPSAkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgka2V5LCAkcEJlZm9yZSwgJHBOdW1Db2xzLCAkcE51bVJvd3MpOwogICAgICAgICAgICBpZiAoJGtleSAhPSAkbmV3UmVmZXJlbmNlKSB7CiAgICAgICAgICAgICAgICAkcFNoZWV0LT5wcm90ZWN0Q2VsbHMoJG5ld1JlZmVyZW5jZSwgJHZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICRwU2hlZXQtPnVucHJvdGVjdENlbGxzKCRrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIGNvbHVtbiBkaW1lbnNpb25zIHdoZW4gaW5zZXJ0aW5nL2RlbGV0aW5nIHJvd3MvY29sdW1ucwogICAgICoKICAgICAqIEBwYXJhbSAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgJHBTaGVldCAgICAgICAgICAgICBUaGUgd29ya3NoZWV0IHRoYXQgd2UncmUgZWRpdGluZwogICAgICogQHBhcmFtICAgc3RyaW5nICAgICAgICAgICAgICAkcEJlZm9yZSAgICAgICAgICAgIEluc2VydC9EZWxldGUgYmVmb3JlIHRoaXMgY2VsbCBhZGRyZXNzIChlLmcuICdBMScpCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRiZWZvcmVDb2x1bW5JbmRleCAgSW5kZXggbnVtYmVyIG9mIHRoZSBjb2x1bW4gd2UncmUgaW5zZXJ0aW5nL2RlbGV0aW5nIGJlZm9yZQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkcE51bUNvbHMgICAgICAgICAgIE51bWJlciBvZiBjb2x1bW5zIHRvIGluc2VydC9kZWxldGUgKG5lZ2F0aXZlIHZhbHVlcyBpbmRpY2F0ZSBkZWxldGlvbikKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJGJlZm9yZVJvdyAgICAgICAgICBOdW1iZXIgb2YgdGhlIHJvdyB3ZSdyZSBpbnNlcnRpbmcvZGVsZXRpbmcgYmVmb3JlCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRwTnVtUm93cyAgICAgICAgICAgTnVtYmVyIG9mIHJvd3MgdG8gaW5zZXJ0L2RlbGV0ZSAobmVnYXRpdmUgdmFsdWVzIGluZGljYXRlIGRlbGV0aW9uKQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRqdXN0Q29sdW1uRGltZW5zaW9ucygkcFNoZWV0LCAkcEJlZm9yZSwgJGJlZm9yZUNvbHVtbkluZGV4LCAkcE51bUNvbHMsICRiZWZvcmVSb3csICRwTnVtUm93cykKICAgIHsKICAgICAgICAkYUNvbHVtbkRpbWVuc2lvbnMgPSBhcnJheV9yZXZlcnNlKCRwU2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbnMoKSwgdHJ1ZSk7CiAgICAgICAgaWYgKCFlbXB0eSgkYUNvbHVtbkRpbWVuc2lvbnMpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRhQ29sdW1uRGltZW5zaW9ucyBhcyAkb2JqQ29sdW1uRGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICAkbmV3UmVmZXJlbmNlID0gJHRoaXMtPnVwZGF0ZUNlbGxSZWZlcmVuY2UoJG9iakNvbHVtbkRpbWVuc2lvbi0+Z2V0Q29sdW1uSW5kZXgoKSAuICcxJywgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKTsKICAgICAgICAgICAgICAgIGxpc3QoJG5ld1JlZmVyZW5jZSkgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkbmV3UmVmZXJlbmNlKTsKICAgICAgICAgICAgICAgIGlmICgkb2JqQ29sdW1uRGltZW5zaW9uLT5nZXRDb2x1bW5JbmRleCgpICE9ICRuZXdSZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqQ29sdW1uRGltZW5zaW9uLT5zZXRDb2x1bW5JbmRleCgkbmV3UmVmZXJlbmNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkcFNoZWV0LT5yZWZyZXNoQ29sdW1uRGltZW5zaW9ucygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSByb3cgZGltZW5zaW9ucyB3aGVuIGluc2VydGluZy9kZWxldGluZyByb3dzL2NvbHVtbnMKICAgICAqCiAgICAgKiBAcGFyYW0gICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICRwU2hlZXQgICAgICAgICAgICAgVGhlIHdvcmtzaGVldCB0aGF0IHdlJ3JlIGVkaXRpbmcKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgICAgICAgICAgJHBCZWZvcmUgICAgICAgICAgICBJbnNlcnQvRGVsZXRlIGJlZm9yZSB0aGlzIGNlbGwgYWRkcmVzcyAoZS5nLiAnQTEnKQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkYmVmb3JlQ29sdW1uSW5kZXggIEluZGV4IG51bWJlciBvZiB0aGUgY29sdW1uIHdlJ3JlIGluc2VydGluZy9kZWxldGluZyBiZWZvcmUKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJHBOdW1Db2xzICAgICAgICAgICBOdW1iZXIgb2YgY29sdW1ucyB0byBpbnNlcnQvZGVsZXRlIChuZWdhdGl2ZSB2YWx1ZXMgaW5kaWNhdGUgZGVsZXRpb24pCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRiZWZvcmVSb3cgICAgICAgICAgTnVtYmVyIG9mIHRoZSByb3cgd2UncmUgaW5zZXJ0aW5nL2RlbGV0aW5nIGJlZm9yZQogICAgICogQHBhcmFtICAgaW50ZWdlciAgICAgICAgICAgICAkcE51bVJvd3MgICAgICAgICAgIE51bWJlciBvZiByb3dzIHRvIGluc2VydC9kZWxldGUgKG5lZ2F0aXZlIHZhbHVlcyBpbmRpY2F0ZSBkZWxldGlvbikKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkanVzdFJvd0RpbWVuc2lvbnMoJHBTaGVldCwgJHBCZWZvcmUsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzLCAkYmVmb3JlUm93LCAkcE51bVJvd3MpCiAgICB7CiAgICAgICAgJGFSb3dEaW1lbnNpb25zID0gYXJyYXlfcmV2ZXJzZSgkcFNoZWV0LT5nZXRSb3dEaW1lbnNpb25zKCksIHRydWUpOwogICAgICAgIGlmICghZW1wdHkoJGFSb3dEaW1lbnNpb25zKSkgewogICAgICAgICAgICBmb3JlYWNoICgkYVJvd0RpbWVuc2lvbnMgYXMgJG9ialJvd0RpbWVuc2lvbikgewogICAgICAgICAgICAgICAgJG5ld1JlZmVyZW5jZSA9ICR0aGlzLT51cGRhdGVDZWxsUmVmZXJlbmNlKCdBJyAuICRvYmpSb3dEaW1lbnNpb24tPmdldFJvd0luZGV4KCksICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyk7CiAgICAgICAgICAgICAgICBsaXN0KCwgJG5ld1JlZmVyZW5jZSkgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkbmV3UmVmZXJlbmNlKTsKICAgICAgICAgICAgICAgIGlmICgkb2JqUm93RGltZW5zaW9uLT5nZXRSb3dJbmRleCgpICE9ICRuZXdSZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAkb2JqUm93RGltZW5zaW9uLT5zZXRSb3dJbmRleCgkbmV3UmVmZXJlbmNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkcFNoZWV0LT5yZWZyZXNoUm93RGltZW5zaW9ucygpOwoKICAgICAgICAgICAgJGNvcHlEaW1lbnNpb24gPSAkcFNoZWV0LT5nZXRSb3dEaW1lbnNpb24oJGJlZm9yZVJvdyAtIDEpOwogICAgICAgICAgICBmb3IgKCRpID0gJGJlZm9yZVJvdzsgJGkgPD0gJGJlZm9yZVJvdyAtIDEgKyAkcE51bVJvd3M7ICsrJGkpIHsKICAgICAgICAgICAgICAgICRuZXdEaW1lbnNpb24gPSAkcFNoZWV0LT5nZXRSb3dEaW1lbnNpb24oJGkpOwogICAgICAgICAgICAgICAgJG5ld0RpbWVuc2lvbi0+c2V0Um93SGVpZ2h0KCRjb3B5RGltZW5zaW9uLT5nZXRSb3dIZWlnaHQoKSk7CiAgICAgICAgICAgICAgICAkbmV3RGltZW5zaW9uLT5zZXRWaXNpYmxlKCRjb3B5RGltZW5zaW9uLT5nZXRWaXNpYmxlKCkpOwogICAgICAgICAgICAgICAgJG5ld0RpbWVuc2lvbi0+c2V0T3V0bGluZUxldmVsKCRjb3B5RGltZW5zaW9uLT5nZXRPdXRsaW5lTGV2ZWwoKSk7CiAgICAgICAgICAgICAgICAkbmV3RGltZW5zaW9uLT5zZXRDb2xsYXBzZWQoJGNvcHlEaW1lbnNpb24tPmdldENvbGxhcHNlZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluc2VydCBhIG5ldyBjb2x1bW4gb3Igcm93LCB1cGRhdGluZyBhbGwgcG9zc2libGUgcmVsYXRlZCBkYXRhCiAgICAgKgogICAgICogQHBhcmFtICAgc3RyaW5nICAgICAgICAgICAgICAkcEJlZm9yZSAgICBJbnNlcnQgYmVmb3JlIHRoaXMgY2VsbCBhZGRyZXNzIChlLmcuICdBMScpCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgICAgICAgICAgICRwTnVtQ29scyAgIE51bWJlciBvZiBjb2x1bW5zIHRvIGluc2VydC9kZWxldGUgKG5lZ2F0aXZlIHZhbHVlcyBpbmRpY2F0ZSBkZWxldGlvbikKICAgICAqIEBwYXJhbSAgIGludGVnZXIgICAgICAgICAgICAgJHBOdW1Sb3dzICAgTnVtYmVyIG9mIHJvd3MgdG8gaW5zZXJ0L2RlbGV0ZSAobmVnYXRpdmUgdmFsdWVzIGluZGljYXRlIGRlbGV0aW9uKQogICAgICogQHBhcmFtICAgUEhQRXhjZWxfV29ya3NoZWV0ICAkcFNoZWV0ICAgICBUaGUgd29ya3NoZWV0IHRoYXQgd2UncmUgZWRpdGluZwogICAgICogQHRocm93cyAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbnNlcnROZXdCZWZvcmUoJHBCZWZvcmUgPSAnQTEnLCAkcE51bUNvbHMgPSAwLCAkcE51bVJvd3MgPSAwLCBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCA9IG51bGwpCiAgICB7CiAgICAgICAgJHJlbW92ZSA9ICgkcE51bUNvbHMgPCAwIHx8ICRwTnVtUm93cyA8IDApOwogICAgICAgICRhQ2VsbENvbGxlY3Rpb24gPSAkcFNoZWV0LT5nZXRDZWxsQ29sbGVjdGlvbigpOwoKICAgICAgICAvLyBHZXQgY29vcmRpbmF0ZXMgb2YgJHBCZWZvcmUKICAgICAgICAkYmVmb3JlQ29sdW1uICAgID0gJ0EnOwogICAgICAgICRiZWZvcmVSb3cgICAgICAgID0gMTsKICAgICAgICBsaXN0KCRiZWZvcmVDb2x1bW4sICRiZWZvcmVSb3cpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHBCZWZvcmUpOwogICAgICAgICRiZWZvcmVDb2x1bW5JbmRleCA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkYmVmb3JlQ29sdW1uKTsKCiAgICAgICAgLy8gQ2xlYXIgY2VsbHMgaWYgd2UgYXJlIHJlbW92aW5nIGNvbHVtbnMgb3Igcm93cwogICAgICAgICRoaWdoZXN0Q29sdW1uICAgID0gJHBTaGVldC0+Z2V0SGlnaGVzdENvbHVtbigpOwogICAgICAgICRoaWdoZXN0Um93ICAgID0gJHBTaGVldC0+Z2V0SGlnaGVzdFJvdygpOwoKICAgICAgICAvLyAxLiBDbGVhciBjb2x1bW4gc3RyaXBzIGlmIHdlIGFyZSByZW1vdmluZyBjb2x1bW5zCiAgICAgICAgaWYgKCRwTnVtQ29scyA8IDAgJiYgJGJlZm9yZUNvbHVtbkluZGV4IC0gMiArICRwTnVtQ29scyA+IDApIHsKICAgICAgICAgICAgZm9yICgkaSA9IDE7ICRpIDw9ICRoaWdoZXN0Um93IC0gMTsgKyskaSkgewogICAgICAgICAgICAgICAgZm9yICgkaiA9ICRiZWZvcmVDb2x1bW5JbmRleCAtIDEgKyAkcE51bUNvbHM7ICRqIDw9ICRiZWZvcmVDb2x1bW5JbmRleCAtIDI7ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAkY29vcmRpbmF0ZSA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkaikgLiAkaTsKICAgICAgICAgICAgICAgICAgICAkcFNoZWV0LT5yZW1vdmVDb25kaXRpb25hbFN0eWxlcygkY29vcmRpbmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRwU2hlZXQtPmNlbGxFeGlzdHMoJGNvb3JkaW5hdGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwU2hlZXQtPmdldENlbGwoJGNvb3JkaW5hdGUpLT5zZXRWYWx1ZUV4cGxpY2l0KCcnLCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTEwpOwogICAgICAgICAgICAgICAgICAgICAgICAkcFNoZWV0LT5nZXRDZWxsKCRjb29yZGluYXRlKS0+c2V0WGZJbmRleCgwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIDIuIENsZWFyIHJvdyBzdHJpcHMgaWYgd2UgYXJlIHJlbW92aW5nIHJvd3MKICAgICAgICBpZiAoJHBOdW1Sb3dzIDwgMCAmJiAkYmVmb3JlUm93IC0gMSArICRwTnVtUm93cyA+IDApIHsKICAgICAgICAgICAgZm9yICgkaSA9ICRiZWZvcmVDb2x1bW5JbmRleCAtIDE7ICRpIDw9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkaGlnaGVzdENvbHVtbikgLSAxOyArKyRpKSB7CiAgICAgICAgICAgICAgICBmb3IgKCRqID0gJGJlZm9yZVJvdyArICRwTnVtUm93czsgJGogPD0gJGJlZm9yZVJvdyAtIDE7ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAkY29vcmRpbmF0ZSA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkaSkgLiAkajsKICAgICAgICAgICAgICAgICAgICAkcFNoZWV0LT5yZW1vdmVDb25kaXRpb25hbFN0eWxlcygkY29vcmRpbmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRwU2hlZXQtPmNlbGxFeGlzdHMoJGNvb3JkaW5hdGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwU2hlZXQtPmdldENlbGwoJGNvb3JkaW5hdGUpLT5zZXRWYWx1ZUV4cGxpY2l0KCcnLCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTEwpOwogICAgICAgICAgICAgICAgICAgICAgICAkcFNoZWV0LT5nZXRDZWxsKCRjb29yZGluYXRlKS0+c2V0WGZJbmRleCgwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIExvb3AgdGhyb3VnaCBjZWxscywgYm90dG9tLXVwLCBhbmQgY2hhbmdlIGNlbGwgY29vcmRpbmF0ZXMKICAgICAgICBpZiAoJHJlbW92ZSkgewogICAgICAgICAgICAvLyBJdCdzIGZhc3RlciB0byByZXZlcnNlIGFuZCBwb3AgdGhhbiB0byB1c2UgdW5zaGlmdCwgZXNwZWNpYWxseSB3aXRoIGxhcmdlIGNlbGwgY29sbGVjdGlvbnMKICAgICAgICAgICAgJGFDZWxsQ29sbGVjdGlvbiA9IGFycmF5X3JldmVyc2UoJGFDZWxsQ29sbGVjdGlvbik7CiAgICAgICAgfQogICAgICAgIHdoaWxlICgkY2VsbElEID0gYXJyYXlfcG9wKCRhQ2VsbENvbGxlY3Rpb24pKSB7CiAgICAgICAgICAgICRjZWxsID0gJHBTaGVldC0+Z2V0Q2VsbCgkY2VsbElEKTsKICAgICAgICAgICAgJGNlbGxJbmRleCA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkY2VsbC0+Z2V0Q29sdW1uKCkpOwoKICAgICAgICAgICAgaWYgKCRjZWxsSW5kZXgtMSArICRwTnVtQ29scyA8IDApIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBOZXcgY29vcmRpbmF0ZXMKICAgICAgICAgICAgJG5ld0Nvb3JkaW5hdGVzID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjZWxsSW5kZXgtMSArICRwTnVtQ29scykgLiAoJGNlbGwtPmdldFJvdygpICsgJHBOdW1Sb3dzKTsKCiAgICAgICAgICAgIC8vIFNob3VsZCB0aGUgY2VsbCBiZSB1cGRhdGVkPyBNb3ZlIHZhbHVlIGFuZCBjZWxsWGYgaW5kZXggZnJvbSBvbmUgY2VsbCB0byBhbm90aGVyLgogICAgICAgICAgICBpZiAoKCRjZWxsSW5kZXggPj0gJGJlZm9yZUNvbHVtbkluZGV4KSAmJiAoJGNlbGwtPmdldFJvdygpID49ICRiZWZvcmVSb3cpKSB7CiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgY2VsbCBzdHlsZXMKICAgICAgICAgICAgICAgICRwU2hlZXQtPmdldENlbGwoJG5ld0Nvb3JkaW5hdGVzKS0+c2V0WGZJbmRleCgkY2VsbC0+Z2V0WGZJbmRleCgpKTsKCiAgICAgICAgICAgICAgICAvLyBJbnNlcnQgdGhpcyBjZWxsIGF0IGl0cyBuZXcgbG9jYXRpb24KICAgICAgICAgICAgICAgIGlmICgkY2VsbC0+Z2V0RGF0YVR5cGUoKSA9PSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX0ZPUk1VTEEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBGb3JtdWxhIHNob3VsZCBiZSBhZGp1c3RlZAogICAgICAgICAgICAgICAgICAgICRwU2hlZXQtPmdldENlbGwoJG5ld0Nvb3JkaW5hdGVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAtPnNldFZhbHVlKCR0aGlzLT51cGRhdGVGb3JtdWxhUmVmZXJlbmNlcygkY2VsbC0+Z2V0VmFsdWUoKSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzLCAkcFNoZWV0LT5nZXRUaXRsZSgpKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIEZvcm11bGEgc2hvdWxkIG5vdCBiZSBhZGp1c3RlZAogICAgICAgICAgICAgICAgICAgICRwU2hlZXQtPmdldENlbGwoJG5ld0Nvb3JkaW5hdGVzKS0+c2V0VmFsdWUoJGNlbGwtPmdldFZhbHVlKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIENsZWFyIHRoZSBvcmlnaW5hbCBjZWxsCiAgICAgICAgICAgICAgICAkcFNoZWV0LT5nZXRDZWxsQ2FjaGVDb250cm9sbGVyKCktPmRlbGV0ZUNhY2hlRGF0YSgkY2VsbElEKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8qICAgIFdlIGRvbid0IG5lZWQgdG8gdXBkYXRlIHN0eWxlcyBmb3Igcm93cy9jb2x1bW5zIGJlZm9yZSBvdXIgaW5zZXJ0aW9uIHBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBidXQgd2UgZG8gc3RpbGwgbmVlZCB0byBhZGp1c3QgYW55IGZvcm11bGFlICAgIGluIHRob3NlIGNlbGxzICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaWYgKCRjZWxsLT5nZXREYXRhVHlwZSgpID09IFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfRk9STVVMQSkgewogICAgICAgICAgICAgICAgICAgIC8vIEZvcm11bGEgc2hvdWxkIGJlIGFkanVzdGVkCiAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlKCR0aGlzLT51cGRhdGVGb3JtdWxhUmVmZXJlbmNlcygkY2VsbC0+Z2V0VmFsdWUoKSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzLCAkcFNoZWV0LT5nZXRUaXRsZSgpKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBEdXBsaWNhdGUgc3R5bGVzIGZvciB0aGUgbmV3bHkgaW5zZXJ0ZWQgY2VsbHMKICAgICAgICAkaGlnaGVzdENvbHVtbiAgICA9ICRwU2hlZXQtPmdldEhpZ2hlc3RDb2x1bW4oKTsKICAgICAgICAkaGlnaGVzdFJvdyAgICA9ICRwU2hlZXQtPmdldEhpZ2hlc3RSb3coKTsKCiAgICAgICAgaWYgKCRwTnVtQ29scyA+IDAgJiYgJGJlZm9yZUNvbHVtbkluZGV4IC0gMiA+IDApIHsKICAgICAgICAgICAgZm9yICgkaSA9ICRiZWZvcmVSb3c7ICRpIDw9ICRoaWdoZXN0Um93IC0gMTsgKyskaSkgewogICAgICAgICAgICAgICAgLy8gU3R5bGUKICAgICAgICAgICAgICAgICRjb29yZGluYXRlID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRiZWZvcmVDb2x1bW5JbmRleCAtIDIpIC4gJGk7CiAgICAgICAgICAgICAgICBpZiAoJHBTaGVldC0+Y2VsbEV4aXN0cygkY29vcmRpbmF0ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkeGZJbmRleCA9ICRwU2hlZXQtPmdldENlbGwoJGNvb3JkaW5hdGUpLT5nZXRYZkluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgJGNvbmRpdGlvbmFsU3R5bGVzID0gJHBTaGVldC0+Y29uZGl0aW9uYWxTdHlsZXNFeGlzdHMoJGNvb3JkaW5hdGUpID8KICAgICAgICAgICAgICAgICAgICAgICAgJHBTaGVldC0+Z2V0Q29uZGl0aW9uYWxTdHlsZXMoJGNvb3JkaW5hdGUpIDogZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9ICRiZWZvcmVDb2x1bW5JbmRleCAtIDE7ICRqIDw9ICRiZWZvcmVDb2x1bW5JbmRleCAtIDIgKyAkcE51bUNvbHM7ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHBTaGVldC0+Z2V0Q2VsbEJ5Q29sdW1uQW5kUm93KCRqLCAkaSktPnNldFhmSW5kZXgoJHhmSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbmRpdGlvbmFsU3R5bGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2xvbmVkID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjb25kaXRpb25hbFN0eWxlcyBhcyAkY29uZGl0aW9uYWxTdHlsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjbG9uZWRbXSA9IGNsb25lICRjb25kaXRpb25hbFN0eWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBTaGVldC0+c2V0Q29uZGl0aW9uYWxTdHlsZXMoUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRqKSAuICRpLCAkY2xvbmVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkcE51bVJvd3MgPiAwICYmICRiZWZvcmVSb3cgLSAxID4gMCkgewogICAgICAgICAgICBmb3IgKCRpID0gJGJlZm9yZUNvbHVtbkluZGV4IC0gMTsgJGkgPD0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRoaWdoZXN0Q29sdW1uKSAtIDE7ICsrJGkpIHsKICAgICAgICAgICAgICAgIC8vIFN0eWxlCiAgICAgICAgICAgICAgICAkY29vcmRpbmF0ZSA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkaSkgLiAoJGJlZm9yZVJvdyAtIDEpOwogICAgICAgICAgICAgICAgaWYgKCRwU2hlZXQtPmNlbGxFeGlzdHMoJGNvb3JkaW5hdGUpKSB7CiAgICAgICAgICAgICAgICAgICAgJHhmSW5kZXggPSAkcFNoZWV0LT5nZXRDZWxsKCRjb29yZGluYXRlKS0+Z2V0WGZJbmRleCgpOwogICAgICAgICAgICAgICAgICAgICRjb25kaXRpb25hbFN0eWxlcyA9ICRwU2hlZXQtPmNvbmRpdGlvbmFsU3R5bGVzRXhpc3RzKCRjb29yZGluYXRlKSA\/CiAgICAgICAgICAgICAgICAgICAgICAgICRwU2hlZXQtPmdldENvbmRpdGlvbmFsU3R5bGVzKCRjb29yZGluYXRlKSA6IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGZvciAoJGogPSAkYmVmb3JlUm93OyAkaiA8PSAkYmVmb3JlUm93IC0gMSArICRwTnVtUm93czsgKyskaikgewogICAgICAgICAgICAgICAgICAgICAgICAkcFNoZWV0LT5nZXRDZWxsKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkaSkgLiAkaiktPnNldFhmSW5kZXgoJHhmSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbmRpdGlvbmFsU3R5bGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2xvbmVkID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRjb25kaXRpb25hbFN0eWxlcyBhcyAkY29uZGl0aW9uYWxTdHlsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjbG9uZWRbXSA9IGNsb25lICRjb25kaXRpb25hbFN0eWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBTaGVldC0+c2V0Q29uZGl0aW9uYWxTdHlsZXMoUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRpKSAuICRqLCAkY2xvbmVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIHdvcmtzaGVldDogY29sdW1uIGRpbWVuc2lvbnMKICAgICAgICAkdGhpcy0+YWRqdXN0Q29sdW1uRGltZW5zaW9ucygkcFNoZWV0LCAkcEJlZm9yZSwgJGJlZm9yZUNvbHVtbkluZGV4LCAkcE51bUNvbHMsICRiZWZvcmVSb3csICRwTnVtUm93cyk7CgogICAgICAgIC8vIFVwZGF0ZSB3b3Jrc2hlZXQ6IHJvdyBkaW1lbnNpb25zCiAgICAgICAgJHRoaXMtPmFkanVzdFJvd0RpbWVuc2lvbnMoJHBTaGVldCwgJHBCZWZvcmUsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzLCAkYmVmb3JlUm93LCAkcE51bVJvd3MpOwoKICAgICAgICAvLyAgICBVcGRhdGUgd29ya3NoZWV0OiBwYWdlIGJyZWFrcwogICAgICAgICR0aGlzLT5hZGp1c3RQYWdlQnJlYWtzKCRwU2hlZXQsICRwQmVmb3JlLCAkYmVmb3JlQ29sdW1uSW5kZXgsICRwTnVtQ29scywgJGJlZm9yZVJvdywgJHBOdW1Sb3dzKTsKCiAgICAgICAgLy8gICAgVXBkYXRlIHdvcmtzaGVldDogY29tbWVudHMKICAgICAgICAkdGhpcy0+YWRqdXN0Q29tbWVudHMoJHBTaGVldCwgJHBCZWZvcmUsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzLCAkYmVmb3JlUm93LCAkcE51bVJvd3MpOwoKICAgICAgICAvLyBVcGRhdGUgd29ya3NoZWV0OiBoeXBlcmxpbmtzCiAgICAgICAgJHRoaXMtPmFkanVzdEh5cGVybGlua3MoJHBTaGVldCwgJHBCZWZvcmUsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzLCAkYmVmb3JlUm93LCAkcE51bVJvd3MpOwoKICAgICAgICAvLyBVcGRhdGUgd29ya3NoZWV0OiBkYXRhIHZhbGlkYXRpb25zCiAgICAgICAgJHRoaXMtPmFkanVzdERhdGFWYWxpZGF0aW9ucygkcFNoZWV0LCAkcEJlZm9yZSwgJGJlZm9yZUNvbHVtbkluZGV4LCAkcE51bUNvbHMsICRiZWZvcmVSb3csICRwTnVtUm93cyk7CgogICAgICAgIC8vIFVwZGF0ZSB3b3Jrc2hlZXQ6IG1lcmdlIGNlbGxzCiAgICAgICAgJHRoaXMtPmFkanVzdE1lcmdlQ2VsbHMoJHBTaGVldCwgJHBCZWZvcmUsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzLCAkYmVmb3JlUm93LCAkcE51bVJvd3MpOwoKICAgICAgICAvLyBVcGRhdGUgd29ya3NoZWV0OiBwcm90ZWN0ZWQgY2VsbHMKICAgICAgICAkdGhpcy0+YWRqdXN0UHJvdGVjdGVkQ2VsbHMoJHBTaGVldCwgJHBCZWZvcmUsICRiZWZvcmVDb2x1bW5JbmRleCwgJHBOdW1Db2xzLCAkYmVmb3JlUm93LCAkcE51bVJvd3MpOwoKICAgICAgICAvLyBVcGRhdGUgd29ya3NoZWV0OiBhdXRvZmlsdGVyCiAgICAgICAgJGF1dG9GaWx0ZXIgPSAkcFNoZWV0LT5nZXRBdXRvRmlsdGVyKCk7CiAgICAgICAgJGF1dG9GaWx0ZXJSYW5nZSA9ICRhdXRvRmlsdGVyLT5nZXRSYW5nZSgpOwogICAgICAgIGlmICghZW1wdHkoJGF1dG9GaWx0ZXJSYW5nZSkpIHsKICAgICAgICAgICAgaWYgKCRwTnVtQ29scyAhPSAwKSB7CiAgICAgICAgICAgICAgICAkYXV0b0ZpbHRlckNvbHVtbnMgPSBhcnJheV9rZXlzKCRhdXRvRmlsdGVyLT5nZXRDb2x1bW5zKCkpOwogICAgICAgICAgICAgICAgaWYgKGNvdW50KCRhdXRvRmlsdGVyQ29sdW1ucykgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgc3NjYW5mKCRwQmVmb3JlLCAnJVtBLVpdJWQnLCAkY29sdW1uLCAkcm93KTsKICAgICAgICAgICAgICAgICAgICAkY29sdW1uSW5kZXggPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNvbHVtbik7CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkcmFuZ2VTdGFydCwgJHJhbmdlRW5kKSA9IFBIUEV4Y2VsX0NlbGw6OnJhbmdlQm91bmRhcmllcygkYXV0b0ZpbHRlclJhbmdlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbHVtbkluZGV4IDw9ICRyYW5nZUVuZFswXSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHBOdW1Db2xzIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgSWYgd2UncmUgYWN0dWFsbHkgZGVsZXRpbmcgYW55IGNvbHVtbnMgdGhhdCBmYWxsIHdpdGhpbiB0aGUgYXV0b2ZpbHRlciByYW5nZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICB0aGVuIHdlIGRlbGV0ZSBhbnkgcnVsZXMgZm9yIHRob3NlIGNvbHVtbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZWxldGVDb2x1bW4gPSAkY29sdW1uSW5kZXggKyAkcE51bUNvbHMgLSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlbGV0ZUNvdW50ID0gYWJzKCRwTnVtQ29scyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMTsgJGkgPD0gJGRlbGV0ZUNvdW50OyArKyRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluX2FycmF5KFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkZGVsZXRlQ29sdW1uKSwgJGF1dG9GaWx0ZXJDb2x1bW5zKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXV0b0ZpbHRlci0+Y2xlYXJDb2x1bW4oUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRkZWxldGVDb2x1bW4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyskZGVsZXRlQ29sdW1uOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGFydENvbCA9ICgkY29sdW1uSW5kZXggPiAkcmFuZ2VTdGFydFswXSkgPyAkY29sdW1uSW5kZXggOiAkcmFuZ2VTdGFydFswXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIFNodWZmbGUgY29sdW1ucyBpbiBhdXRvZmlsdGVyIHJhbmdlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcE51bUNvbHMgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBGb3IgaW5zZXJ0LCB3ZSBzaHVmZmxlIGZyb20gZW5kIHRvIGJlZ2lubmluZyB0byBhdm9pZCBvdmVyd3JpdGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXJ0Q29sSUQgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHN0YXJ0Q29sLTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvQ29sSUQgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHN0YXJ0Q29sKyRwTnVtQ29scy0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbmRDb2xJRCA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcmFuZ2VFbmRbMF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdGFydENvbFJlZiA9ICRzdGFydENvbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbmRDb2xSZWYgPSAkcmFuZ2VFbmRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9Db2xSZWYgPSAkcmFuZ2VFbmRbMF0rJHBOdW1Db2xzOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXV0b0ZpbHRlci0+c2hpZnRDb2x1bW4oUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRlbmRDb2xSZWYtMSksIFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkdG9Db2xSZWYtMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tJGVuZENvbFJlZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSR0b0NvbFJlZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKCRzdGFydENvbFJlZiA8PSAkZW5kQ29sUmVmKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIEZvciBkZWxldGUsIHdlIHNodWZmbGUgZnJvbSBiZWdpbm5pbmcgdG8gZW5kIHRvIGF2b2lkIG92ZXJ3cml0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhcnRDb2xJRCA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkc3RhcnRDb2wtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9Db2xJRCA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkc3RhcnRDb2wrJHBOdW1Db2xzLTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVuZENvbElEID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRyYW5nZUVuZFswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF1dG9GaWx0ZXItPnNoaWZ0Q29sdW1uKCRzdGFydENvbElELCAkdG9Db2xJRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyskc3RhcnRDb2xJRDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArKyR0b0NvbElEOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoJHN0YXJ0Q29sSUQgIT0gJGVuZENvbElEKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkcFNoZWV0LT5zZXRBdXRvRmlsdGVyKCR0aGlzLT51cGRhdGVDZWxsUmVmZXJlbmNlKCRhdXRvRmlsdGVyUmFuZ2UsICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cykpOwogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIHdvcmtzaGVldDogZnJlZXplIHBhbmUKICAgICAgICBpZiAoJHBTaGVldC0+Z2V0RnJlZXplUGFuZSgpICE9ICcnKSB7CiAgICAgICAgICAgICRwU2hlZXQtPmZyZWV6ZVBhbmUoJHRoaXMtPnVwZGF0ZUNlbGxSZWZlcmVuY2UoJHBTaGVldC0+Z2V0RnJlZXplUGFuZSgpLCAkcEJlZm9yZSwgJHBOdW1Db2xzLCAkcE51bVJvd3MpKTsKICAgICAgICB9CgogICAgICAgIC8vIFBhZ2Ugc2V0dXAKICAgICAgICBpZiAoJHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPmlzUHJpbnRBcmVhU2V0KCkpIHsKICAgICAgICAgICAgJHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPnNldFByaW50QXJlYSgkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgkcFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0UHJpbnRBcmVhKCksICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cykpOwogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIHdvcmtzaGVldDogZHJhd2luZ3MKICAgICAgICAkYURyYXdpbmdzID0gJHBTaGVldC0+Z2V0RHJhd2luZ0NvbGxlY3Rpb24oKTsKICAgICAgICBmb3JlYWNoICgkYURyYXdpbmdzIGFzICRvYmpEcmF3aW5nKSB7CiAgICAgICAgICAgICRuZXdSZWZlcmVuY2UgPSAkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgkb2JqRHJhd2luZy0+Z2V0Q29vcmRpbmF0ZXMoKSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKTsKICAgICAgICAgICAgaWYgKCRvYmpEcmF3aW5nLT5nZXRDb29yZGluYXRlcygpICE9ICRuZXdSZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICRvYmpEcmF3aW5nLT5zZXRDb29yZGluYXRlcygkbmV3UmVmZXJlbmNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIHdvcmtib29rOiBuYW1lZCByYW5nZXMKICAgICAgICBpZiAoY291bnQoJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldE5hbWVkUmFuZ2VzKCkpID4gMCkgewogICAgICAgICAgICBmb3JlYWNoICgkcFNoZWV0LT5nZXRQYXJlbnQoKS0+Z2V0TmFtZWRSYW5nZXMoKSBhcyAkbmFtZWRSYW5nZSkgewogICAgICAgICAgICAgICAgaWYgKCRuYW1lZFJhbmdlLT5nZXRXb3Jrc2hlZXQoKS0+Z2V0SGFzaENvZGUoKSA9PSAkcFNoZWV0LT5nZXRIYXNoQ29kZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgJG5hbWVkUmFuZ2UtPnNldFJhbmdlKCR0aGlzLT51cGRhdGVDZWxsUmVmZXJlbmNlKCRuYW1lZFJhbmdlLT5nZXRSYW5nZSgpLCAkcEJlZm9yZSwgJHBOdW1Db2xzLCAkcE51bVJvd3MpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gR2FyYmFnZSBjb2xsZWN0CiAgICAgICAgJHBTaGVldC0+Z2FyYmFnZUNvbGxlY3QoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSByZWZlcmVuY2VzIHdpdGhpbiBmb3JtdWxhcwogICAgICoKICAgICAqIEBwYXJhbSAgICBzdHJpbmcgICAgJHBGb3JtdWxhICAgIEZvcm11bGEgdG8gdXBkYXRlCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkcEJlZm9yZSAgICBJbnNlcnQgYmVmb3JlIHRoaXMgb25lCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkcE51bUNvbHMgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5zZXJ0CiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkcE51bVJvd3MgICAgTnVtYmVyIG9mIHJvd3MgdG8gaW5zZXJ0CiAgICAgKiBAcGFyYW0gICBzdHJpbmcgICRzaGVldE5hbWUgIFdvcmtzaGVldCBuYW1lL3RpdGxlCiAgICAgKiBAcmV0dXJuICAgIHN0cmluZyAgICBVcGRhdGVkIGZvcm11bGEKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGVGb3JtdWxhUmVmZXJlbmNlcygkcEZvcm11bGEgPSAnJywgJHBCZWZvcmUgPSAnQTEnLCAkcE51bUNvbHMgPSAwLCAkcE51bVJvd3MgPSAwLCAkc2hlZXROYW1lID0gJycpCiAgICB7CiAgICAgICAgLy8gICAgVXBkYXRlIGNlbGwgcmVmZXJlbmNlcyBpbiB0aGUgZm9ybXVsYQogICAgICAgICRmb3JtdWxhQmxvY2tzID0gZXhwbG9kZSgnIicsICRwRm9ybXVsYSk7CiAgICAgICAgJGkgPSBmYWxzZTsKICAgICAgICBmb3JlYWNoICgkZm9ybXVsYUJsb2NrcyBhcyAmJGZvcm11bGFCbG9jaykgewogICAgICAgICAgICAvLyAgICBJZ25vcmUgYmxvY2tzIHRoYXQgd2VyZSBlbmNsb3NlZCBpbiBxdW90ZXMgKGFsdGVybmF0aW5nIGVudHJpZXMgaW4gdGhlICRmb3JtdWxhQmxvY2tzIGFycmF5IGFmdGVyIHRoZSBleHBsb2RlKQogICAgICAgICAgICBpZiAoJGkgPSAhJGkpIHsKICAgICAgICAgICAgICAgICRhZGp1c3RDb3VudCA9IDA7CiAgICAgICAgICAgICAgICAkbmV3Q2VsbFRva2VucyA9ICRjZWxsVG9rZW5zID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgIC8vICAgIFNlYXJjaCBmb3Igcm93IHJhbmdlcyAoZS5nLiAnU2hlZXQxJyEzOjUgb3IgMzo1KSB3aXRoIG9yIHdpdGhvdXQgJCBhYnNvbHV0ZXMgKGUuZy4gJDM6NSkKICAgICAgICAgICAgICAgICRtYXRjaENvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy8nLnNlbGY6OlJFRkhFTFBFUl9SRUdFWFBfUk9XUkFOR0UuJy9pJywgJyAnLiRmb3JtdWxhQmxvY2suJyAnLCAkbWF0Y2hlcywgUFJFR19TRVRfT1JERVIpOwogICAgICAgICAgICAgICAgaWYgKCRtYXRjaENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRtYXRjaGVzIGFzICRtYXRjaCkgewogICAgICAgICAgICAgICAgICAgICAgICAkZnJvbVN0cmluZyA9ICgkbWF0Y2hbMl0gPiAnJykgPyAkbWF0Y2hbMl0uJyEnIDogJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tU3RyaW5nIC49ICRtYXRjaFszXS4nOicuJG1hdGNoWzRdOwogICAgICAgICAgICAgICAgICAgICAgICAkbW9kaWZpZWQzID0gc3Vic3RyKCR0aGlzLT51cGRhdGVDZWxsUmVmZXJlbmNlKCckQScuJG1hdGNoWzNdLCAkcEJlZm9yZSwgJHBOdW1Db2xzLCAkcE51bVJvd3MpLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGlmaWVkNCA9IHN1YnN0cigkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgnJEEnLiRtYXRjaFs0XSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKSwgMik7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG1hdGNoWzNdLic6Jy4kbWF0Y2hbNF0gIT09ICRtb2RpZmllZDMuJzonLiRtb2RpZmllZDQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJG1hdGNoWzJdID09ICcnKSB8fCAodHJpbSgkbWF0Y2hbMl0sICInIikgPT0gJHNoZWV0TmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9TdHJpbmcgPSAoJG1hdGNoWzJdID4gJycpID8gJG1hdGNoWzJdLichJyA6ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b1N0cmluZyAuPSAkbW9kaWZpZWQzLic6Jy4kbW9kaWZpZWQ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIE1heCB3b3Jrc2hlZXQgc2l6ZSBpcyAxLDA0OCw1NzYgcm93cyBieSAxNiwzODQgY29sdW1ucyBpbiBFeGNlbCAyMDA3LCBzbyBvdXIgYWRqdXN0bWVudHMgbmVlZCB0byBiZSBhdCBsZWFzdCBvbmUgZGlnaXQgbW9yZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW4gPSAxMDAwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvdyA9IDEwMDAwMDAwICsgdHJpbSgkbWF0Y2hbM10sICckJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxJbmRleCA9ICRjb2x1bW4uJHJvdzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5ld0NlbGxUb2tlbnNbJGNlbGxJbmRleF0gPSBwcmVnX3F1b3RlKCR0b1N0cmluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxUb2tlbnNbJGNlbGxJbmRleF0gPSAnLyg\/PCFcZFwkXCEpJy5wcmVnX3F1b3RlKCRmcm9tU3RyaW5nKS4nKD8hXGQpL2knOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrJGFkanVzdENvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gICAgU2VhcmNoIGZvciBjb2x1bW4gcmFuZ2VzIChlLmcuICdTaGVldDEnIUM6RSBvciBDOkUpIHdpdGggb3Igd2l0aG91dCAkIGFic29sdXRlcyAoZS5nLiAkQzpFKQogICAgICAgICAgICAgICAgJG1hdGNoQ291bnQgPSBwcmVnX21hdGNoX2FsbCgnLycuc2VsZjo6UkVGSEVMUEVSX1JFR0VYUF9DT0xSQU5HRS4nL2knLCAnICcuJGZvcm11bGFCbG9jay4nICcsICRtYXRjaGVzLCBQUkVHX1NFVF9PUkRFUik7CiAgICAgICAgICAgICAgICBpZiAoJG1hdGNoQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJG1hdGNoZXMgYXMgJG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tU3RyaW5nID0gKCRtYXRjaFsyXSA+ICcnKSA\/ICRtYXRjaFsyXS4nIScgOiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGZyb21TdHJpbmcgLj0gJG1hdGNoWzNdLic6Jy4kbWF0Y2hbNF07CiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RpZmllZDMgPSBzdWJzdHIoJHRoaXMtPnVwZGF0ZUNlbGxSZWZlcmVuY2UoJG1hdGNoWzNdLickMScsICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyksIDAsIC0yKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGlmaWVkNCA9IHN1YnN0cigkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgkbWF0Y2hbNF0uJyQxJywgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKSwgMCwgLTIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRtYXRjaFszXS4nOicuJG1hdGNoWzRdICE9PSAkbW9kaWZpZWQzLic6Jy4kbW9kaWZpZWQ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRtYXRjaFsyXSA9PSAnJykgfHwgKHRyaW0oJG1hdGNoWzJdLCAiJyIpID09ICRzaGVldE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvU3RyaW5nID0gKCRtYXRjaFsyXSA+ICcnKSA\/ICRtYXRjaFsyXS4nIScgOiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9TdHJpbmcgLj0gJG1vZGlmaWVkMy4nOicuJG1vZGlmaWVkNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBNYXggd29ya3NoZWV0IHNpemUgaXMgMSwwNDgsNTc2IHJvd3MgYnkgMTYsMzg0IGNvbHVtbnMgaW4gRXhjZWwgMjAwNywgc28gb3VyIGFkanVzdG1lbnRzIG5lZWQgdG8gYmUgYXQgbGVhc3Qgb25lIGRpZ2l0IG1vcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKHRyaW0oJG1hdGNoWzNdLCAnJCcpKSArIDEwMDAwMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93ID0gMTAwMDAwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxJbmRleCA9ICRjb2x1bW4uJHJvdzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5ld0NlbGxUb2tlbnNbJGNlbGxJbmRleF0gPSBwcmVnX3F1b3RlKCR0b1N0cmluZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxUb2tlbnNbJGNlbGxJbmRleF0gPSAnLyg\/PCFbQS1aXCRcIV0pJy5wcmVnX3F1b3RlKCRmcm9tU3RyaW5nKS4nKD8hW0EtWl0pL2knOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrJGFkanVzdENvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gICAgU2VhcmNoIGZvciBjZWxsIHJhbmdlcyAoZS5nLiAnU2hlZXQxJyFBMzpDNSBvciBBMzpDNSkgd2l0aCBvciB3aXRob3V0ICQgYWJzb2x1dGVzIChlLmcuICRBMTpDJDUpCiAgICAgICAgICAgICAgICAkbWF0Y2hDb3VudCA9IHByZWdfbWF0Y2hfYWxsKCcvJy5zZWxmOjpSRUZIRUxQRVJfUkVHRVhQX0NFTExSQU5HRS4nL2knLCAnICcuJGZvcm11bGFCbG9jay4nICcsICRtYXRjaGVzLCBQUkVHX1NFVF9PUkRFUik7CiAgICAgICAgICAgICAgICBpZiAoJG1hdGNoQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJG1hdGNoZXMgYXMgJG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tU3RyaW5nID0gKCRtYXRjaFsyXSA+ICcnKSA\/ICRtYXRjaFsyXS4nIScgOiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJGZyb21TdHJpbmcgLj0gJG1hdGNoWzNdLic6Jy4kbWF0Y2hbNF07CiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RpZmllZDMgPSAkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgkbWF0Y2hbM10sICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RpZmllZDQgPSAkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgkbWF0Y2hbNF0sICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJG1hdGNoWzNdLiRtYXRjaFs0XSAhPT0gJG1vZGlmaWVkMy4kbW9kaWZpZWQ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRtYXRjaFsyXSA9PSAnJykgfHwgKHRyaW0oJG1hdGNoWzJdLCAiJyIpID09ICRzaGVldE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvU3RyaW5nID0gKCRtYXRjaFsyXSA+ICcnKSA\/ICRtYXRjaFsyXS4nIScgOiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9TdHJpbmcgLj0gJG1vZGlmaWVkMy4nOicuJG1vZGlmaWVkNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0KCRjb2x1bW4sICRyb3cpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJG1hdGNoWzNdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBNYXggd29ya3NoZWV0IHNpemUgaXMgMSwwNDgsNTc2IHJvd3MgYnkgMTYsMzg0IGNvbHVtbnMgaW4gRXhjZWwgMjAwNywgc28gb3VyIGFkanVzdG1lbnRzIG5lZWQgdG8gYmUgYXQgbGVhc3Qgb25lIGRpZ2l0IG1vcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKHRyaW0oJGNvbHVtbiwgJyQnKSkgKyAxMDAwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvdyA9IHRyaW0oJHJvdywgJyQnKSArIDEwMDAwMDAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsSW5kZXggPSAkY29sdW1uLiRyb3c7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuZXdDZWxsVG9rZW5zWyRjZWxsSW5kZXhdID0gcHJlZ19xdW90ZSgkdG9TdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsVG9rZW5zWyRjZWxsSW5kZXhdID0gJy8oPzwhW0EtWl1cJFwhKScucHJlZ19xdW90ZSgkZnJvbVN0cmluZykuJyg\/IVxkKS9pJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArKyRhZGp1c3RDb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vICAgIFNlYXJjaCBmb3IgY2VsbCByZWZlcmVuY2VzIChlLmcuICdTaGVldDEnIUEzIG9yIEM1KSB3aXRoIG9yIHdpdGhvdXQgJCBhYnNvbHV0ZXMgKGUuZy4gJEExIG9yIEMkNSkKICAgICAgICAgICAgICAgICRtYXRjaENvdW50ID0gcHJlZ19tYXRjaF9hbGwoJy8nLnNlbGY6OlJFRkhFTFBFUl9SRUdFWFBfQ0VMTFJFRi4nL2knLCAnICcuJGZvcm11bGFCbG9jay4nICcsICRtYXRjaGVzLCBQUkVHX1NFVF9PUkRFUik7CgogICAgICAgICAgICAgICAgaWYgKCRtYXRjaENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRtYXRjaGVzIGFzICRtYXRjaCkgewogICAgICAgICAgICAgICAgICAgICAgICAkZnJvbVN0cmluZyA9ICgkbWF0Y2hbMl0gPiAnJykgPyAkbWF0Y2hbMl0uJyEnIDogJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tU3RyaW5nIC49ICRtYXRjaFszXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RpZmllZDMgPSAkdGhpcy0+dXBkYXRlQ2VsbFJlZmVyZW5jZSgkbWF0Y2hbM10sICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkbWF0Y2hbM10gIT09ICRtb2RpZmllZDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJG1hdGNoWzJdID09ICcnKSB8fCAodHJpbSgkbWF0Y2hbMl0sICInIikgPT0gJHNoZWV0TmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9TdHJpbmcgPSAoJG1hdGNoWzJdID4gJycpID8gJG1hdGNoWzJdLichJyA6ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b1N0cmluZyAuPSAkbW9kaWZpZWQzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QoJGNvbHVtbiwgJHJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkbWF0Y2hbM10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIE1heCB3b3Jrc2hlZXQgc2l6ZSBpcyAxLDA0OCw1NzYgcm93cyBieSAxNiwzODQgY29sdW1ucyBpbiBFeGNlbCAyMDA3LCBzbyBvdXIgYWRqdXN0bWVudHMgbmVlZCB0byBiZSBhdCBsZWFzdCBvbmUgZGlnaXQgbW9yZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW4gPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcodHJpbSgkY29sdW1uLCAnJCcpKSArIDEwMDAwMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93ID0gdHJpbSgkcm93LCAnJCcpICsgMTAwMDAwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxJbmRleCA9ICRyb3cgLiAkY29sdW1uOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbmV3Q2VsbFRva2Vuc1skY2VsbEluZGV4XSA9IHByZWdfcXVvdGUoJHRvU3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbFRva2Vuc1skY2VsbEluZGV4XSA9ICcvKD88IVtBLVpcJFwhXSknLnByZWdfcXVvdGUoJGZyb21TdHJpbmcpLicoPyFcZCkvaSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyskYWRqdXN0Q291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJGFkanVzdENvdW50ID4gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICgkcE51bUNvbHMgPiAwIHx8ICRwTnVtUm93cyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAga3Jzb3J0KCRjZWxsVG9rZW5zKTsKICAgICAgICAgICAgICAgICAgICAgICAga3Jzb3J0KCRuZXdDZWxsVG9rZW5zKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBrc29ydCgkY2VsbFRva2Vucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGtzb3J0KCRuZXdDZWxsVG9rZW5zKTsKICAgICAgICAgICAgICAgICAgICB9ICAgLy8gIFVwZGF0ZSBjZWxsIHJlZmVyZW5jZXMgaW4gdGhlIGZvcm11bGEKICAgICAgICAgICAgICAgICAgICAkZm9ybXVsYUJsb2NrID0gc3RyX3JlcGxhY2UoJ1xcJywgJycsIHByZWdfcmVwbGFjZSgkY2VsbFRva2VucywgJG5ld0NlbGxUb2tlbnMsICRmb3JtdWxhQmxvY2spKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB1bnNldCgkZm9ybXVsYUJsb2NrKTsKCiAgICAgICAgLy8gICAgVGhlbiByZWJ1aWxkIHRoZSBmb3JtdWxhIHN0cmluZwogICAgICAgIHJldHVybiBpbXBsb2RlKCciJywgJGZvcm11bGFCbG9ja3MpOwogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIGNlbGwgcmVmZXJlbmNlCiAgICAgKgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAkcENlbGxSYW5nZSAgICAgICAgICAgIENlbGwgcmFuZ2UKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICRwQmVmb3JlICAgICAgICAgICAgSW5zZXJ0IGJlZm9yZSB0aGlzIG9uZQogICAgICogQHBhcmFtICAgIGludCAgICAgICAgJHBOdW1Db2xzICAgICAgICAgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5jcmVtZW50CiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkcE51bVJvd3MgICAgICAgICAgICBOdW1iZXIgb2Ygcm93cyB0byBpbmNyZW1lbnQKICAgICAqIEByZXR1cm4gICAgc3RyaW5nICAgIFVwZGF0ZWQgY2VsbCByYW5nZQogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZUNlbGxSZWZlcmVuY2UoJHBDZWxsUmFuZ2UgPSAnQTEnLCAkcEJlZm9yZSA9ICdBMScsICRwTnVtQ29scyA9IDAsICRwTnVtUm93cyA9IDApCiAgICB7CiAgICAgICAgLy8gSXMgaXQgaW4gYW5vdGhlciB3b3Jrc2hlZXQ\/IFdpbGwgbm90IGhhdmUgdG8gdXBkYXRlIGFueXRoaW5nLgogICAgICAgIGlmIChzdHJwb3MoJHBDZWxsUmFuZ2UsICIhIikgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiAkcENlbGxSYW5nZTsKICAgICAgICAvLyBJcyBpdCBhIHJhbmdlIG9yIGEgc2luZ2xlIGNlbGw\/CiAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkcENlbGxSYW5nZSwgJzonKSA9PT0gZmFsc2UgJiYgc3RycG9zKCRwQ2VsbFJhbmdlLCAnLCcpID09PSBmYWxzZSkgewogICAgICAgICAgICAvLyBTaW5nbGUgY2VsbAogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnVwZGF0ZVNpbmdsZUNlbGxSZWZlcmVuY2UoJHBDZWxsUmFuZ2UsICRwQmVmb3JlLCAkcE51bUNvbHMsICRwTnVtUm93cyk7CiAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkcENlbGxSYW5nZSwgJzonKSAhPT0gZmFsc2UgfHwgc3RycG9zKCRwQ2VsbFJhbmdlLCAnLCcpICE9PSBmYWxzZSkgewogICAgICAgICAgICAvLyBSYW5nZQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnVwZGF0ZUNlbGxSYW5nZSgkcENlbGxSYW5nZSwgJHBCZWZvcmUsICRwTnVtQ29scywgJHBOdW1Sb3dzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBSZXR1cm4gb3JpZ2luYWwKICAgICAgICAgICAgcmV0dXJuICRwQ2VsbFJhbmdlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBuYW1lZCBmb3JtdWxhcyAoaS5lLiBjb250YWluaW5nIHdvcmtzaGVldCByZWZlcmVuY2VzIC8gbmFtZWQgcmFuZ2VzKQogICAgICoKICAgICAqIEBwYXJhbSBQSFBFeGNlbCAkcFBocEV4Y2VsICAgIE9iamVjdCB0byB1cGRhdGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJG9sZE5hbWUgICAgICAgIE9sZCBuYW1lIChuYW1lIHRvIHJlcGxhY2UpCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuZXdOYW1lICAgICAgICBOZXcgbmFtZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlTmFtZWRGb3JtdWxhcyhQSFBFeGNlbCAkcFBocEV4Y2VsLCAkb2xkTmFtZSA9ICcnLCAkbmV3TmFtZSA9ICcnKQogICAgewogICAgICAgIGlmICgkb2xkTmFtZSA9PSAnJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBmb3JlYWNoICgkcFBocEV4Y2VsLT5nZXRXb3Jrc2hlZXRJdGVyYXRvcigpIGFzICRzaGVldCkgewogICAgICAgICAgICBmb3JlYWNoICgkc2hlZXQtPmdldENlbGxDb2xsZWN0aW9uKGZhbHNlKSBhcyAkY2VsbElEKSB7CiAgICAgICAgICAgICAgICAkY2VsbCA9ICRzaGVldC0+Z2V0Q2VsbCgkY2VsbElEKTsKICAgICAgICAgICAgICAgIGlmICgoJGNlbGwgIT09IG51bGwpICYmICgkY2VsbC0+Z2V0RGF0YVR5cGUoKSA9PSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX0ZPUk1VTEEpKSB7CiAgICAgICAgICAgICAgICAgICAgJGZvcm11bGEgPSAkY2VsbC0+Z2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRmb3JtdWxhLCAkb2xkTmFtZSkgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtdWxhID0gc3RyX3JlcGxhY2UoIiciIC4gJG9sZE5hbWUgLiAiJyEiLCAiJyIgLiAkbmV3TmFtZSAuICInISIsICRmb3JtdWxhKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGZvcm11bGEgPSBzdHJfcmVwbGFjZSgkb2xkTmFtZSAuICIhIiwgJG5ld05hbWUgLiAiISIsICRmb3JtdWxhKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGwtPnNldFZhbHVlRXhwbGljaXQoJGZvcm11bGEsIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfRk9STVVMQSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVXBkYXRlIGNlbGwgcmFuZ2UKICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICRwQ2VsbFJhbmdlICAgICAgICAgICAgQ2VsbCByYW5nZSAgICAoZS5nLiAnQjI6RDQnLCAnQjpDJyBvciAnMjozJykKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICRwQmVmb3JlICAgICAgICAgICAgSW5zZXJ0IGJlZm9yZSB0aGlzIG9uZQogICAgICogQHBhcmFtICAgIGludCAgICAgICAgJHBOdW1Db2xzICAgICAgICAgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5jcmVtZW50CiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkcE51bVJvd3MgICAgICAgICAgICBOdW1iZXIgb2Ygcm93cyB0byBpbmNyZW1lbnQKICAgICAqIEByZXR1cm4gICAgc3RyaW5nICAgIFVwZGF0ZWQgY2VsbCByYW5nZQogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB1cGRhdGVDZWxsUmFuZ2UoJHBDZWxsUmFuZ2UgPSAnQTE6QTEnLCAkcEJlZm9yZSA9ICdBMScsICRwTnVtQ29scyA9IDAsICRwTnVtUm93cyA9IDApCiAgICB7CiAgICAgICAgaWYgKHN0cnBvcygkcENlbGxSYW5nZSwgJzonKSAhPT0gZmFsc2UgfHwgc3RycG9zKCRwQ2VsbFJhbmdlLCAnLCcpICE9PSBmYWxzZSkgewogICAgICAgICAgICAvLyBVcGRhdGUgcmFuZ2UKICAgICAgICAgICAgJHJhbmdlID0gUEhQRXhjZWxfQ2VsbDo6c3BsaXRSYW5nZSgkcENlbGxSYW5nZSk7CiAgICAgICAgICAgICRpYyA9IGNvdW50KCRyYW5nZSk7CiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRpYzsgKyskaSkgewogICAgICAgICAgICAgICAgJGpjID0gY291bnQoJHJhbmdlWyRpXSk7CiAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkamM7ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY3R5cGVfYWxwaGEoJHJhbmdlWyRpXVskal0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHRoaXMtPnVwZGF0ZVNpbmdsZUNlbGxSZWZlcmVuY2UoJHJhbmdlWyRpXVskal0uJzEnLCAkcEJlZm9yZSwgJHBOdW1Db2xzLCAkcE51bVJvd3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJhbmdlWyRpXVskal0gPSAkclswXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoY3R5cGVfZGlnaXQoJHJhbmdlWyRpXVskal0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHRoaXMtPnVwZGF0ZVNpbmdsZUNlbGxSZWZlcmVuY2UoJ0EnLiRyYW5nZVskaV1bJGpdLCAkcEJlZm9yZSwgJHBOdW1Db2xzLCAkcE51bVJvd3MpKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJhbmdlWyRpXVskal0gPSAkclsxXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkcmFuZ2VbJGldWyRqXSA9ICR0aGlzLT51cGRhdGVTaW5nbGVDZWxsUmVmZXJlbmNlKCRyYW5nZVskaV1bJGpdLCAkcEJlZm9yZSwgJHBOdW1Db2xzLCAkcE51bVJvd3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUmVjcmVhdGUgcmFuZ2Ugc3RyaW5nCiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DZWxsOjpidWlsZFJhbmdlKCRyYW5nZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiT25seSBjZWxsIHJhbmdlcyBtYXkgYmUgcGFzc2VkIHRvIHRoaXMgbWV0aG9kLiIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVwZGF0ZSBzaW5nbGUgY2VsbCByZWZlcmVuY2UKICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICRwQ2VsbFJlZmVyZW5jZSAgICAgICAgU2luZ2xlIGNlbGwgcmVmZXJlbmNlCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkcEJlZm9yZSAgICAgICAgICAgIEluc2VydCBiZWZvcmUgdGhpcyBvbmUKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICRwTnVtQ29scyAgICAgICAgICAgIE51bWJlciBvZiBjb2x1bW5zIHRvIGluY3JlbWVudAogICAgICogQHBhcmFtICAgIGludCAgICAgICAgJHBOdW1Sb3dzICAgICAgICAgICAgTnVtYmVyIG9mIHJvd3MgdG8gaW5jcmVtZW50CiAgICAgKiBAcmV0dXJuICAgIHN0cmluZyAgICBVcGRhdGVkIGNlbGwgcmVmZXJlbmNlCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHVwZGF0ZVNpbmdsZUNlbGxSZWZlcmVuY2UoJHBDZWxsUmVmZXJlbmNlID0gJ0ExJywgJHBCZWZvcmUgPSAnQTEnLCAkcE51bUNvbHMgPSAwLCAkcE51bVJvd3MgPSAwKQogICAgewogICAgICAgIGlmIChzdHJwb3MoJHBDZWxsUmVmZXJlbmNlLCAnOicpID09PSBmYWxzZSAmJiBzdHJwb3MoJHBDZWxsUmVmZXJlbmNlLCAnLCcpID09PSBmYWxzZSkgewogICAgICAgICAgICAvLyBHZXQgY29vcmRpbmF0ZXMgb2YgJHBCZWZvcmUKICAgICAgICAgICAgbGlzdCgkYmVmb3JlQ29sdW1uLCAkYmVmb3JlUm93KSA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRwQmVmb3JlKTsKCiAgICAgICAgICAgIC8vIEdldCBjb29yZGluYXRlcyBvZiAkcENlbGxSZWZlcmVuY2UKICAgICAgICAgICAgbGlzdCgkbmV3Q29sdW1uLCAkbmV3Um93KSA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRwQ2VsbFJlZmVyZW5jZSk7CgogICAgICAgICAgICAvLyBWZXJpZnkgd2hpY2ggcGFydHMgc2hvdWxkIGJlIHVwZGF0ZWQKICAgICAgICAgICAgJHVwZGF0ZUNvbHVtbiA9ICgoJG5ld0NvbHVtbnswfSAhPSAnJCcpICYmICgkYmVmb3JlQ29sdW1uezB9ICE9ICckJykgJiYgKFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkbmV3Q29sdW1uKSA+PSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGJlZm9yZUNvbHVtbikpKTsKICAgICAgICAgICAgJHVwZGF0ZVJvdyA9ICgoJG5ld1Jvd3swfSAhPSAnJCcpICYmICgkYmVmb3JlUm93ezB9ICE9ICckJykgJiYgJG5ld1JvdyA+PSAkYmVmb3JlUm93KTsKCiAgICAgICAgICAgIC8vIENyZWF0ZSBuZXcgY29sdW1uIHJlZmVyZW5jZQogICAgICAgICAgICBpZiAoJHVwZGF0ZUNvbHVtbikgewogICAgICAgICAgICAgICAgJG5ld0NvbHVtbiAgICA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleChQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJG5ld0NvbHVtbikgLSAxICsgJHBOdW1Db2xzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyByb3cgcmVmZXJlbmNlCiAgICAgICAgICAgIGlmICgkdXBkYXRlUm93KSB7CiAgICAgICAgICAgICAgICAkbmV3Um93ICAgID0gJG5ld1JvdyArICRwTnVtUm93czsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUmV0dXJuIG5ldyByZWZlcmVuY2UKICAgICAgICAgICAgcmV0dXJuICRuZXdDb2x1bW4gLiAkbmV3Um93OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oIk9ubHkgc2luZ2xlIGNlbGwgcmVmZXJlbmNlcyBtYXkgYmUgcGFzc2VkIHRvIHRoaXMgbWV0aG9kLiIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIF9fY2xvbmUgaW1wbGVtZW50YXRpb24uIENsb25pbmcgc2hvdWxkIG5vdCBiZSBhbGxvd2VkIGluIGEgU2luZ2xldG9uIQogICAgICoKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIGZpbmFsIHB1YmxpYyBmdW5jdGlvbiBfX2Nsb25lKCkKICAgIHsKICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCJDbG9uaW5nIGEgU2luZ2xldG9uIGlzIG5vdCBhbGxvd2VkISIpOwogICAgfQp9Cg==",
    "size": "47539"
}