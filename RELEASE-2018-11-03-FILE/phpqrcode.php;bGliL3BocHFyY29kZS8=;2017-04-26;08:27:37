{
    "namaFile": "lib\/phpqrcode\/phpqrcode.php",
    "lastUpdate": "2017-04-26+08:27:37.62",
    "contentFile": "PD9waHANCg0KLyoNCiAqIFBIUCBRUiBDb2RlIGVuY29kZXINCiAqDQogKiBUaGlzIGZpbGUgY29udGFpbnMgTUVSR0VEIHZlcnNpb24gb2YgUEhQIFFSIENvZGUgbGlicmFyeS4NCiAqIEl0IHdhcyBhdXRvLWdlbmVyYXRlZCBmcm9tIGZ1bGwgdmVyc2lvbiBmb3IgeW91ciBjb252ZW5pZW5jZS4NCiAqDQogKiBUaGlzIG1lcmdlZCB2ZXJzaW9uIHdhcyBjb25maWd1cmVkIHRvIG5vdCByZXF1cmUgYW55IGV4dGVybmFsIGZpbGVzLA0KICogd2l0aCBkaXNhYmxlZCBjYWNoZSwgZXJyb3IgbG9naW5nIGFuZCB3ZWtlciBidXQgZmFzdGVyIG1hc2sgbWF0Y2hpbmcuDQogKiBJZiB5b3UgbmVlZCB0dW5lIGl0IHVwIHBsZWFzZSB1c2Ugbm9uLW1lcmdlZCB2ZXJzaW9uLg0KICoNCiAqIEZvciBmdWxsIHZlcnNpb24sIGRvY3VtZW50YXRpb24sIGV4YW1wbGVzIG9mIHVzZSBwbGVhc2UgdmlzaXQ6DQogKg0KICogICAgaHR0cDovL3BocHFyY29kZS5zb3VyY2Vmb3JnZS5uZXQvDQogKiAgICBodHRwczovL3NvdXJjZWZvcmdlLm5ldC9wcm9qZWN0cy9waHBxcmNvZGUvDQogKg0KICogUEhQIFFSIENvZGUgaXMgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAzDQogKiBDb3B5cmlnaHQgKEMpIDIwMTAgRG9taW5payBEemllbmlhIDxkZWx0YWxhYiBhdCBwb2N6dGEgZG90IGZtPg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3INCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcg0KICogdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi4NCiAqDQogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VDQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KICoNCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUNCiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQQ0KICovDQogDQogCgovKgogKiBWZXJzaW9uOiAxLjEuNAogKiBCdWlsZDogMjAxMDEwMDcyMQogKi8KCgoKLy8tLS0tIHFyY29uc3QucGhwIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCg0KDQovKg0KICogUEhQIFFSIENvZGUgZW5jb2Rlcg0KICoNCiAqIENvbW1vbiBjb25zdGFudHMNCiAqDQogKiBCYXNlZCBvbiBsaWJxcmVuY29kZSBDIGxpYnJhcnkgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAyLjENCiAqIENvcHlyaWdodCAoQykgMjAwNiwgMjAwNywgMjAwOCwgMjAwOSBLZW50YXJvIEZ1a3VjaGkgPGZ1a3VjaGlAbWVnYXVpLm5ldD4NCiAqDQogKiBQSFAgUVIgQ29kZSBpcyBkaXN0cmlidXRlZCB1bmRlciBMR1BMIDMNCiAqIENvcHlyaWdodCAoQykgMjAxMCBEb21pbmlrIER6aWVuaWEgPGRlbHRhbGFiIGF0IHBvY3p0YSBkb3QgZm0+DQogKg0KICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcg0KICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyDQogKiB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUNCiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQogKg0KICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQ0KICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBDQogKi8NCiANCgkvLyBFbmNvZGluZyBtb2Rlcw0KCSANCglkZWZpbmUoJ1FSX01PREVfTlVMJywgLTEpOw0KCWRlZmluZSgnUVJfTU9ERV9OVU0nLCAwKTsNCglkZWZpbmUoJ1FSX01PREVfQU4nLCAxKTsNCglkZWZpbmUoJ1FSX01PREVfOCcsIDIpOw0KCWRlZmluZSgnUVJfTU9ERV9LQU5KSScsIDMpOw0KCWRlZmluZSgnUVJfTU9ERV9TVFJVQ1RVUkUnLCA0KTsNCg0KCS8vIExldmVscyBvZiBlcnJvciBjb3JyZWN0aW9uLg0KDQoJZGVmaW5lKCdRUl9FQ0xFVkVMX0wnLCAwKTsNCglkZWZpbmUoJ1FSX0VDTEVWRUxfTScsIDEpOw0KCWRlZmluZSgnUVJfRUNMRVZFTF9RJywgMik7DQoJZGVmaW5lKCdRUl9FQ0xFVkVMX0gnLCAzKTsNCgkNCgkvLyBTdXBwb3J0ZWQgb3V0cHV0IGZvcm1hdHMNCgkNCglkZWZpbmUoJ1FSX0ZPUk1BVF9URVhUJywgMCk7DQoJZGVmaW5lKCdRUl9GT1JNQVRfUE5HJywgIDEpOw0KCQ0KCWNsYXNzIHFyc3RyIHsNCgkJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBzZXQoJiRzcmN0YWIsICR4LCAkeSwgJHJlcGwsICRyZXBsTGVuID0gZmFsc2UpIHsNCgkJCSRzcmN0YWJbJHldID0gc3Vic3RyX3JlcGxhY2UoJHNyY3RhYlskeV0sICgkcmVwbExlbiAhPT0gZmFsc2UpP3N1YnN0cigkcmVwbCwwLCRyZXBsTGVuKTokcmVwbCwgJHgsICgkcmVwbExlbiAhPT0gZmFsc2UpPyRyZXBsTGVuOnN0cmxlbigkcmVwbCkpOw0KCQl9DQoJfQkKCgoKLy8tLS0tIG1lcmdlZF9jb25maWcucGhwIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCg0KLyoNCiAqIFBIUCBRUiBDb2RlIGVuY29kZXINCiAqDQogKiBDb25maWcgZmlsZSwgdHVuZWQtdXAgZm9yIG1lcmdlZCB2ZXJpb24NCiAqLw0KICAgICANCiAgICBkZWZpbmUoJ1FSX0NBQ0hFQUJMRScsIGZhbHNlKTsgICAgICAgLy8gdXNlIGNhY2hlIC0gbW9yZSBkaXNrIHJlYWRzIGJ1dCBsZXNzIENQVSBwb3dlciwgbWFza3MgYW5kIGZvcm1hdCB0ZW1wbGF0ZXMgYXJlIHN0b3JlZCB0aGVyZQ0KICAgIGRlZmluZSgnUVJfQ0FDSEVfRElSJywgZmFsc2UpOyAgICAgICAvLyB1c2VkIHdoZW4gUVJfQ0FDSEVBQkxFID09PSB0cnVlDQogICAgZGVmaW5lKCdRUl9MT0dfRElSJywgZmFsc2UpOyAgICAgICAgIC8vIGRlZmF1bHQgZXJyb3IgbG9ncyBkaXIgICANCiAgICANCiAgICBkZWZpbmUoJ1FSX0ZJTkRfQkVTVF9NQVNLJywgdHJ1ZSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRydWUsIGVzdGltYXRlcyBiZXN0IG1hc2sgKHNwZWMuIGRlZmF1bHQsIGJ1dCBleHRyZW1hbGx5IHNsb3c7IHNldCB0byBmYWxzZSB0byBzaWduaWZpY2FudCBwZXJmb3JtYW5jZSBib29zdCBidXQgKHByb3BhYmx5KSB3b3JzdCBxdWFsaXR5IGNvZGUNCiAgICBkZWZpbmUoJ1FSX0ZJTkRfRlJPTV9SQU5ET00nLCAyKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgZmFsc2UsIGNoZWNrcyBhbGwgbWFza3MgYXZhaWxhYmxlLCBvdGhlcndpc2UgdmFsdWUgdGVsbHMgY291bnQgb2YgbWFza3MgbmVlZCB0byBiZSBjaGVja2VkLCBtYXNrIGlkIGFyZSBnb3QgcmFuZG9tbHkNCiAgICBkZWZpbmUoJ1FSX0RFRkFVTFRfTUFTSycsIDIpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gUVJfRklORF9CRVNUX01BU0sgPT09IGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgIGRlZmluZSgnUVJfUE5HX01BWElNVU1fU0laRScsICAxMDI0KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF4aW11bSBhbGxvd2VkIHBuZyBpbWFnZSB3aWR0aCAoaW4gcGl4ZWxzKSwgdHVuZSB0byBtYWtlIHN1cmUgR0QgYW5kIFBIUCBjYW4gaGFuZGxlIHN1Y2ggYmlnIGltYWdlcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCgoKLy8tLS0tIHFydG9vbHMucGhwIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCg0KLyoNCiAqIFBIUCBRUiBDb2RlIGVuY29kZXINCiAqDQogKiBUb29sc2V0LCBoYW5keSBhbmQgZGVidWcgdXRpbGl0ZXMuDQogKg0KICogUEhQIFFSIENvZGUgaXMgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAzDQogKiBDb3B5cmlnaHQgKEMpIDIwMTAgRG9taW5payBEemllbmlhIDxkZWx0YWxhYiBhdCBwb2N6dGEgZG90IGZtPg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3INCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcg0KICogdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi4NCiAqDQogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VDQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KICoNCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUNCiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQQ0KICovDQoNCiAgICBjbGFzcyBRUnRvb2xzIHsNCiAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gYmluYXJpemUoJGZyYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICAkbGVuID0gY291bnQoJGZyYW1lKTsNCiAgICAgICAgICAgIGZvcmVhY2ggKCRmcmFtZSBhcyAmJGZyYW1lTGluZSkgew0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvcigkaT0wOyAkaTwkbGVuOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICRmcmFtZUxpbmVbJGldID0gKG9yZCgkZnJhbWVMaW5lWyRpXSkmMSk\/JzEnOicwJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkZnJhbWU7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHRjcGRmQmFyY29kZUFycmF5KCRjb2RlLCAkbW9kZSA9ICdRUixMJywgJHRjUGRmVmVyc2lvbiA9ICc0LjUuMDM3JykNCiAgICAgICAgew0KICAgICAgICAgICAgJGJhcmNvZGVfYXJyYXkgPSBhcnJheSgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoIWlzX2FycmF5KCRtb2RlKSkNCiAgICAgICAgICAgICAgICAkbW9kZSA9IGV4cGxvZGUoJywnLCAkbW9kZSk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAkZWNjTGV2ZWwgPSAnTCc7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoY291bnQoJG1vZGUpID4gMSkgew0KICAgICAgICAgICAgICAgICRlY2NMZXZlbCA9ICRtb2RlWzFdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgJHFyVGFiID0gUVJjb2RlOjp0ZXh0KCRjb2RlLCBmYWxzZSwgJGVjY0xldmVsKTsNCiAgICAgICAgICAgICRzaXplID0gY291bnQoJHFyVGFiKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICRiYXJjb2RlX2FycmF5WydudW1fcm93cyddID0gJHNpemU7DQogICAgICAgICAgICAkYmFyY29kZV9hcnJheVsnbnVtX2NvbHMnXSA9ICRzaXplOw0KICAgICAgICAgICAgJGJhcmNvZGVfYXJyYXlbJ2Jjb2RlJ10gPSBhcnJheSgpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yZWFjaCAoJHFyVGFiIGFzICRsaW5lKSB7DQogICAgICAgICAgICAgICAgJGFyckFkZCA9IGFycmF5KCk7DQogICAgICAgICAgICAgICAgZm9yZWFjaChzdHJfc3BsaXQoJGxpbmUpIGFzICRjaGFyKQ0KICAgICAgICAgICAgICAgICAgICAkYXJyQWRkW10gPSAoJGNoYXI9PScxJyk\/MTowOw0KICAgICAgICAgICAgICAgICRiYXJjb2RlX2FycmF5WydiY29kZSddW10gPSAkYXJyQWRkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkYmFyY29kZV9hcnJheTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY2xlYXJDYWNoZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHNlbGY6OiRmcmFtZXMgPSBhcnJheSgpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBidWlsZENhY2hlKCkNCiAgICAgICAgew0KCQkJUVJ0b29sczo6bWFya1RpbWUoJ2JlZm9yZV9idWlsZF9jYWNoZScpOw0KCQkJDQoJCQkkbWFzayA9IG5ldyBRUm1hc2soKTsNCiAgICAgICAgICAgIGZvciAoJGE9MTsgJGEgPD0gUVJTUEVDX1ZFUlNJT05fTUFYOyAkYSsrKSB7DQogICAgICAgICAgICAgICAgJGZyYW1lID0gUVJzcGVjOjpuZXdGcmFtZSgkYSk7DQogICAgICAgICAgICAgICAgaWYgKFFSX0lNQUdFKSB7DQogICAgICAgICAgICAgICAgICAgICRmaWxlTmFtZSA9IFFSX0NBQ0hFX0RJUi4nZnJhbWVfJy4kYS4nLnBuZyc7DQogICAgICAgICAgICAgICAgICAgIFFSaW1hZ2U6OnBuZyhzZWxmOjpiaW5hcml6ZSgkZnJhbWUpLCAkZmlsZU5hbWUsIDEsIDApOw0KICAgICAgICAgICAgICAgIH0NCgkJCQkNCgkJCQkkd2lkdGggPSBjb3VudCgkZnJhbWUpOw0KCQkJCSRiaXRNYXNrID0gYXJyYXlfZmlsbCgwLCAkd2lkdGgsIGFycmF5X2ZpbGwoMCwgJHdpZHRoLCAwKSk7DQoJCQkJZm9yICgkbWFza05vPTA7ICRtYXNrTm88ODsgJG1hc2tObysrKQ0KCQkJCQkkbWFzay0+bWFrZU1hc2tObygkbWFza05vLCAkd2lkdGgsICRmcmFtZSwgJGJpdE1hc2ssIHRydWUpOw0KICAgICAgICAgICAgfQ0KCQkJDQoJCQlRUnRvb2xzOjptYXJrVGltZSgnYWZ0ZXJfYnVpbGRfY2FjaGUnKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGxvZygkb3V0ZmlsZSwgJGVycikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKFFSX0xPR19ESVIgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgaWYgKCRlcnIgIT0gJycpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRvdXRmaWxlICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsZV9wdXRfY29udGVudHMoUVJfTE9HX0RJUi5iYXNlbmFtZSgkb3V0ZmlsZSkuJy1lcnJvcnMudHh0JywgZGF0ZSgnWS1tLWQgSDppOnMnKS4nOiAnLiRlcnIsIEZJTEVfQVBQRU5EKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKFFSX0xPR19ESVIuJ2Vycm9ycy50eHQnLCBkYXRlKCdZLW0tZCBIOmk6cycpLic6ICcuJGVyciwgRklMRV9BUFBFTkQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZHVtcE1hc2soJGZyYW1lKSANCiAgICAgICAgew0KICAgICAgICAgICAgJHdpZHRoID0gY291bnQoJGZyYW1lKTsNCiAgICAgICAgICAgIGZvcigkeT0wOyR5PCR3aWR0aDskeSsrKSB7DQogICAgICAgICAgICAgICAgZm9yKCR4PTA7JHg8JHdpZHRoOyR4KyspIHsNCiAgICAgICAgICAgICAgICAgICAgZWNobyBvcmQoJGZyYW1lWyR5XVskeF0pLicsJzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG1hcmtUaW1lKCRtYXJrZXJJZCkNCiAgICAgICAgew0KICAgICAgICAgICAgbGlzdCgkdXNlYywgJHNlYykgPSBleHBsb2RlKCIgIiwgbWljcm90aW1lKCkpOw0KICAgICAgICAgICAgJHRpbWUgPSAoKGZsb2F0KSR1c2VjICsgKGZsb2F0KSRzZWMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoIWlzc2V0KCRHTE9CQUxTWydxcl90aW1lX2JlbmNoJ10pKQ0KICAgICAgICAgICAgICAgICRHTE9CQUxTWydxcl90aW1lX2JlbmNoJ10gPSBhcnJheSgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAkR0xPQkFMU1sncXJfdGltZV9iZW5jaCddWyRtYXJrZXJJZF0gPSAkdGltZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdGltZUJlbmNobWFyaygpDQogICAgICAgIHsNCiAgICAgICAgICAgIHNlbGY6Om1hcmtUaW1lKCdmaW5pc2gnKTsNCiAgICAgICAgDQogICAgICAgICAgICAkbGFzdFRpbWUgPSAwOw0KICAgICAgICAgICAgJHN0YXJ0VGltZSA9IDA7DQogICAgICAgICAgICAkcCA9IDA7DQoNCiAgICAgICAgICAgIGVjaG8gJzx0YWJsZSBjZWxscGFkZGluZz0iMyIgY2VsbHNwYWNpbmc9IjEiPg0KICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+PHRyIHN0eWxlPSJib3JkZXItYm90dG9tOjFweCBzb2xpZCBzaWx2ZXIiPjx0ZCBjb2xzcGFuPSIyIiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXIiPkJFTkNITUFSSzwvdGQ+PC90cj48L3RoZWFkPg0KICAgICAgICAgICAgICAgICAgICA8dGJvZHk+JzsNCg0KICAgICAgICAgICAgZm9yZWFjaCgkR0xPQkFMU1sncXJfdGltZV9iZW5jaCddIGFzICRtYXJrZXJJZD0+JHRoaXNUaW1lKSB7DQogICAgICAgICAgICAgICAgaWYgKCRwID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBlY2hvICc8dHI+PHRoIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0Ij50aWxsICcuJG1hcmtlcklkLic6IDwvdGg+PHRkPicubnVtYmVyX2Zvcm1hdCgkdGhpc1RpbWUtJGxhc3RUaW1lLCA2KS4nczwvdGQ+PC90cj4nOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRzdGFydFRpbWUgPSAkdGhpc1RpbWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRwKys7DQogICAgICAgICAgICAgICAgJGxhc3RUaW1lID0gJHRoaXNUaW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBlY2hvICc8L3Rib2R5Pjx0Zm9vdD4NCiAgICAgICAgICAgICAgICA8dHIgc3R5bGU9ImJvcmRlci10b3A6MnB4IHNvbGlkIGJsYWNrIj48dGggc3R5bGU9InRleHQtYWxpZ246cmlnaHQiPlRPVEFMOiA8L3RoPjx0ZD4nLm51bWJlcl9mb3JtYXQoJGxhc3RUaW1lLSRzdGFydFRpbWUsIDYpLidzPC90ZD48L3RyPg0KICAgICAgICAgICAgPC90Zm9vdD4NCiAgICAgICAgICAgIDwvdGFibGU+JzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICB9DQogICAgDQogICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KICAgIA0KICAgIFFSdG9vbHM6Om1hcmtUaW1lKCdzdGFydCcpOw0KICAgIAoKCgovLy0tLS0gcXJzcGVjLnBocCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCgoNCi8qDQogKiBQSFAgUVIgQ29kZSBlbmNvZGVyDQogKg0KICogUVIgQ29kZSBzcGVjaWZpY2F0aW9ucw0KICoNCiAqIEJhc2VkIG9uIGxpYnFyZW5jb2RlIEMgbGlicmFyeSBkaXN0cmlidXRlZCB1bmRlciBMR1BMIDIuMQ0KICogQ29weXJpZ2h0IChDKSAyMDA2LCAyMDA3LCAyMDA4LCAyMDA5IEtlbnRhcm8gRnVrdWNoaSA8ZnVrdWNoaUBtZWdhdWkubmV0Pg0KICoNCiAqIFBIUCBRUiBDb2RlIGlzIGRpc3RyaWJ1dGVkIHVuZGVyIExHUEwgMw0KICogQ29weXJpZ2h0IChDKSAyMDEwIERvbWluaWsgRHppZW5pYSA8ZGVsdGFsYWIgYXQgcG9jenRhIGRvdCBmbT4NCiAqDQogKiBUaGUgZm9sbG93aW5nIGRhdGEgLyBzcGVjaWZpY2F0aW9ucyBhcmUgdGFrZW4gZnJvbQ0KICogIlR3byBkaW1lbnNpb25hbCBzeW1ib2wgLS0gUVItY29kZSAtLSBCYXNpYyBTcGVjaWZpY2F0aW9uIiAoSklTIFgwNTEwOjIwMDQpDQogKiAgb3INCiAqICJBdXRvbWF0aWMgaWRlbnRpZmljYXRpb24gYW5kIGRhdGEgY2FwdHVyZSB0ZWNobmlxdWVzIC0tIA0KICogIFFSIENvZGUgMjAwNSBiYXIgY29kZSBzeW1ib2xvZ3kgc3BlY2lmaWNhdGlvbiIgKElTTy9JRUMgMTgwMDQ6MjAwNikNCiAqDQogKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yDQogKiBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljDQogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXINCiAqIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uDQogKg0KICogVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVQ0KICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCiAqDQogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljDQogKiBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3YXJlDQogKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgMDIxMTAtMTMwMSBVU0ENCiAqLw0KIA0KICAgIGRlZmluZSgnUVJTUEVDX1ZFUlNJT05fTUFYJywgNDApOw0KICAgIGRlZmluZSgnUVJTUEVDX1dJRFRIX01BWCcsICAgMTc3KTsNCg0KICAgIGRlZmluZSgnUVJDQVBfV0lEVEgnLCAgICAgICAgMCk7DQogICAgZGVmaW5lKCdRUkNBUF9XT1JEUycsICAgICAgICAxKTsNCiAgICBkZWZpbmUoJ1FSQ0FQX1JFTUlOREVSJywgICAgIDIpOw0KICAgIGRlZmluZSgnUVJDQVBfRUMnLCAgICAgICAgICAgMyk7DQoNCiAgICBjbGFzcyBRUnNwZWMgew0KICAgIA0KICAgICAgICBwdWJsaWMgc3RhdGljICRjYXBhY2l0eSA9IGFycmF5KA0KICAgICAgICAgICAgYXJyYXkoICAwLCAgICAwLCAwLCBhcnJheSggICAwLCAgICAwLCAgICAwLCAgICAwKSksDQogICAgICAgICAgICBhcnJheSggMjEsICAgMjYsIDAsIGFycmF5KCAgIDcsICAgMTAsICAgMTMsICAgMTcpKSwgLy8gMQ0KICAgICAgICAgICAgYXJyYXkoIDI1LCAgIDQ0LCA3LCBhcnJheSggIDEwLCAgIDE2LCAgIDIyLCAgIDI4KSksDQogICAgICAgICAgICBhcnJheSggMjksICAgNzAsIDcsIGFycmF5KCAgMTUsICAgMjYsICAgMzYsICAgNDQpKSwNCiAgICAgICAgICAgIGFycmF5KCAzMywgIDEwMCwgNywgYXJyYXkoICAyMCwgICAzNiwgICA1MiwgICA2NCkpLA0KICAgICAgICAgICAgYXJyYXkoIDM3LCAgMTM0LCA3LCBhcnJheSggIDI2LCAgIDQ4LCAgIDcyLCAgIDg4KSksIC8vIDUNCiAgICAgICAgICAgIGFycmF5KCA0MSwgIDE3MiwgNywgYXJyYXkoICAzNiwgICA2NCwgICA5NiwgIDExMikpLA0KICAgICAgICAgICAgYXJyYXkoIDQ1LCAgMTk2LCAwLCBhcnJheSggIDQwLCAgIDcyLCAgMTA4LCAgMTMwKSksDQogICAgICAgICAgICBhcnJheSggNDksICAyNDIsIDAsIGFycmF5KCAgNDgsICAgODgsICAxMzIsICAxNTYpKSwNCiAgICAgICAgICAgIGFycmF5KCA1MywgIDI5MiwgMCwgYXJyYXkoICA2MCwgIDExMCwgIDE2MCwgIDE5MikpLA0KICAgICAgICAgICAgYXJyYXkoIDU3LCAgMzQ2LCAwLCBhcnJheSggIDcyLCAgMTMwLCAgMTkyLCAgMjI0KSksIC8vMTANCiAgICAgICAgICAgIGFycmF5KCA2MSwgIDQwNCwgMCwgYXJyYXkoICA4MCwgIDE1MCwgIDIyNCwgIDI2NCkpLA0KICAgICAgICAgICAgYXJyYXkoIDY1LCAgNDY2LCAwLCBhcnJheSggIDk2LCAgMTc2LCAgMjYwLCAgMzA4KSksDQogICAgICAgICAgICBhcnJheSggNjksICA1MzIsIDAsIGFycmF5KCAxMDQsICAxOTgsICAyODgsICAzNTIpKSwNCiAgICAgICAgICAgIGFycmF5KCA3MywgIDU4MSwgMywgYXJyYXkoIDEyMCwgIDIxNiwgIDMyMCwgIDM4NCkpLA0KICAgICAgICAgICAgYXJyYXkoIDc3LCAgNjU1LCAzLCBhcnJheSggMTMyLCAgMjQwLCAgMzYwLCAgNDMyKSksIC8vMTUNCiAgICAgICAgICAgIGFycmF5KCA4MSwgIDczMywgMywgYXJyYXkoIDE0NCwgIDI4MCwgIDQwOCwgIDQ4MCkpLA0KICAgICAgICAgICAgYXJyYXkoIDg1LCAgODE1LCAzLCBhcnJheSggMTY4LCAgMzA4LCAgNDQ4LCAgNTMyKSksDQogICAgICAgICAgICBhcnJheSggODksICA5MDEsIDMsIGFycmF5KCAxODAsICAzMzgsICA1MDQsICA1ODgpKSwNCiAgICAgICAgICAgIGFycmF5KCA5MywgIDk5MSwgMywgYXJyYXkoIDE5NiwgIDM2NCwgIDU0NiwgIDY1MCkpLA0KICAgICAgICAgICAgYXJyYXkoIDk3LCAxMDg1LCAzLCBhcnJheSggMjI0LCAgNDE2LCAgNjAwLCAgNzAwKSksIC8vMjANCiAgICAgICAgICAgIGFycmF5KDEwMSwgMTE1NiwgNCwgYXJyYXkoIDIyNCwgIDQ0MiwgIDY0NCwgIDc1MCkpLA0KICAgICAgICAgICAgYXJyYXkoMTA1LCAxMjU4LCA0LCBhcnJheSggMjUyLCAgNDc2LCAgNjkwLCAgODE2KSksDQogICAgICAgICAgICBhcnJheSgxMDksIDEzNjQsIDQsIGFycmF5KCAyNzAsICA1MDQsICA3NTAsICA5MDApKSwNCiAgICAgICAgICAgIGFycmF5KDExMywgMTQ3NCwgNCwgYXJyYXkoIDMwMCwgIDU2MCwgIDgxMCwgIDk2MCkpLA0KICAgICAgICAgICAgYXJyYXkoMTE3LCAxNTg4LCA0LCBhcnJheSggMzEyLCAgNTg4LCAgODcwLCAxMDUwKSksIC8vMjUNCiAgICAgICAgICAgIGFycmF5KDEyMSwgMTcwNiwgNCwgYXJyYXkoIDMzNiwgIDY0NCwgIDk1MiwgMTExMCkpLA0KICAgICAgICAgICAgYXJyYXkoMTI1LCAxODI4LCA0LCBhcnJheSggMzYwLCAgNzAwLCAxMDIwLCAxMjAwKSksDQogICAgICAgICAgICBhcnJheSgxMjksIDE5MjEsIDMsIGFycmF5KCAzOTAsICA3MjgsIDEwNTAsIDEyNjApKSwNCiAgICAgICAgICAgIGFycmF5KDEzMywgMjA1MSwgMywgYXJyYXkoIDQyMCwgIDc4NCwgMTE0MCwgMTM1MCkpLA0KICAgICAgICAgICAgYXJyYXkoMTM3LCAyMTg1LCAzLCBhcnJheSggNDUwLCAgODEyLCAxMjAwLCAxNDQwKSksIC8vMzANCiAgICAgICAgICAgIGFycmF5KDE0MSwgMjMyMywgMywgYXJyYXkoIDQ4MCwgIDg2OCwgMTI5MCwgMTUzMCkpLA0KICAgICAgICAgICAgYXJyYXkoMTQ1LCAyNDY1LCAzLCBhcnJheSggNTEwLCAgOTI0LCAxMzUwLCAxNjIwKSksDQogICAgICAgICAgICBhcnJheSgxNDksIDI2MTEsIDMsIGFycmF5KCA1NDAsICA5ODAsIDE0NDAsIDE3MTApKSwNCiAgICAgICAgICAgIGFycmF5KDE1MywgMjc2MSwgMywgYXJyYXkoIDU3MCwgMTAzNiwgMTUzMCwgMTgwMCkpLA0KICAgICAgICAgICAgYXJyYXkoMTU3LCAyODc2LCAwLCBhcnJheSggNTcwLCAxMDY0LCAxNTkwLCAxODkwKSksIC8vMzUNCiAgICAgICAgICAgIGFycmF5KDE2MSwgMzAzNCwgMCwgYXJyYXkoIDYwMCwgMTEyMCwgMTY4MCwgMTk4MCkpLA0KICAgICAgICAgICAgYXJyYXkoMTY1LCAzMTk2LCAwLCBhcnJheSggNjMwLCAxMjA0LCAxNzcwLCAyMTAwKSksDQogICAgICAgICAgICBhcnJheSgxNjksIDMzNjIsIDAsIGFycmF5KCA2NjAsIDEyNjAsIDE4NjAsIDIyMjApKSwNCiAgICAgICAgICAgIGFycmF5KDE3MywgMzUzMiwgMCwgYXJyYXkoIDcyMCwgMTMxNiwgMTk1MCwgMjMxMCkpLA0KICAgICAgICAgICAgYXJyYXkoMTc3LCAzNzA2LCAwLCBhcnJheSggNzUwLCAxMzcyLCAyMDQwLCAyNDMwKSkgLy80MA0KICAgICAgICApOw0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0RGF0YUxlbmd0aCgkdmVyc2lvbiwgJGxldmVsKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gc2VsZjo6JGNhcGFjaXR5WyR2ZXJzaW9uXVtRUkNBUF9XT1JEU10gLSBzZWxmOjokY2FwYWNpdHlbJHZlcnNpb25dW1FSQ0FQX0VDXVskbGV2ZWxdOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRFQ0NMZW5ndGgoJHZlcnNpb24sICRsZXZlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGY6OiRjYXBhY2l0eVskdmVyc2lvbl1bUVJDQVBfRUNdWyRsZXZlbF07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFdpZHRoKCR2ZXJzaW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gc2VsZjo6JGNhcGFjaXR5WyR2ZXJzaW9uXVtRUkNBUF9XSURUSF07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFJlbWFpbmRlcigkdmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIHNlbGY6OiRjYXBhY2l0eVskdmVyc2lvbl1bUVJDQVBfUkVNSU5ERVJdOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRNaW5pbXVtVmVyc2lvbigkc2l6ZSwgJGxldmVsKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGZvcigkaT0xOyAkaTw9IFFSU1BFQ19WRVJTSU9OX01BWDsgJGkrKykgew0KICAgICAgICAgICAgICAgICR3b3JkcyAgPSBzZWxmOjokY2FwYWNpdHlbJGldW1FSQ0FQX1dPUkRTXSAtIHNlbGY6OiRjYXBhY2l0eVskaV1bUVJDQVBfRUNdWyRsZXZlbF07DQogICAgICAgICAgICAgICAgaWYoJHdvcmRzID49ICRzaXplKSANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQogICAgICAgIA0KICAgICAgICBwdWJsaWMgc3RhdGljICRsZW5ndGhUYWJsZUJpdHMgPSBhcnJheSgNCiAgICAgICAgICAgIGFycmF5KDEwLCAxMiwgMTQpLA0KICAgICAgICAgICAgYXJyYXkoIDksIDExLCAxMyksDQogICAgICAgICAgICBhcnJheSggOCwgMTYsIDE2KSwNCiAgICAgICAgICAgIGFycmF5KCA4LCAxMCwgMTIpDQogICAgICAgICk7DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBsZW5ndGhJbmRpY2F0b3IoJG1vZGUsICR2ZXJzaW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoJG1vZGUgPT0gUVJfTU9ERV9TVFJVQ1RVUkUpDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoJHZlcnNpb24gPD0gOSkgew0KICAgICAgICAgICAgICAgICRsID0gMDsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoJHZlcnNpb24gPD0gMjYpIHsNCiAgICAgICAgICAgICAgICAkbCA9IDE7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRsID0gMjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY6OiRsZW5ndGhUYWJsZUJpdHNbJG1vZGVdWyRsXTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbWF4aW11bVdvcmRzKCRtb2RlLCAkdmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYoJG1vZGUgPT0gUVJfTU9ERV9TVFJVQ1RVUkUpIA0KICAgICAgICAgICAgICAgIHJldHVybiAzOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoJHZlcnNpb24gPD0gOSkgew0KICAgICAgICAgICAgICAgICRsID0gMDsNCiAgICAgICAgICAgIH0gZWxzZSBpZigkdmVyc2lvbiA8PSAyNikgew0KICAgICAgICAgICAgICAgICRsID0gMTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGwgPSAyOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkYml0cyA9IHNlbGY6OiRsZW5ndGhUYWJsZUJpdHNbJG1vZGVdWyRsXTsNCiAgICAgICAgICAgICR3b3JkcyA9ICgxIDw8ICRiaXRzKSAtIDE7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCRtb2RlID09IFFSX01PREVfS0FOSkkpIHsNCiAgICAgICAgICAgICAgICAkd29yZHMgKj0gMjsgLy8gdGhlIG51bWJlciBvZiBieXRlcyBpcyByZXF1aXJlZA0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gJHdvcmRzOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRXJyb3IgY29ycmVjdGlvbiBjb2RlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIFRhYmxlIG9mIHRoZSBlcnJvciBjb3JyZWN0aW9uIGNvZGUgKFJlZWQtU29sb21vbiBibG9jaykNCiAgICAgICAgLy8gU2VlIFRhYmxlIDEyLTE2IChwcC4zMC0zNiksIEpJUyBYMDUxMDoyMDA0Lg0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgJGVjY1RhYmxlID0gYXJyYXkoDQogICAgICAgICAgICBhcnJheShhcnJheSggMCwgIDApLCBhcnJheSggMCwgIDApLCBhcnJheSggMCwgIDApLCBhcnJheSggMCwgIDApKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCAxLCAgMCksIGFycmF5KCAxLCAgMCksIGFycmF5KCAxLCAgMCksIGFycmF5KCAxLCAgMCkpLCAvLyAxDQogICAgICAgICAgICBhcnJheShhcnJheSggMSwgIDApLCBhcnJheSggMSwgIDApLCBhcnJheSggMSwgIDApLCBhcnJheSggMSwgIDApKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCAxLCAgMCksIGFycmF5KCAxLCAgMCksIGFycmF5KCAyLCAgMCksIGFycmF5KCAyLCAgMCkpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDEsICAwKSwgYXJyYXkoIDIsICAwKSwgYXJyYXkoIDIsICAwKSwgYXJyYXkoIDQsICAwKSksDQogICAgICAgICAgICBhcnJheShhcnJheSggMSwgIDApLCBhcnJheSggMiwgIDApLCBhcnJheSggMiwgIDIpLCBhcnJheSggMiwgIDIpKSwgLy8gNQ0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDIsICAwKSwgYXJyYXkoIDQsICAwKSwgYXJyYXkoIDQsICAwKSwgYXJyYXkoIDQsICAwKSksDQogICAgICAgICAgICBhcnJheShhcnJheSggMiwgIDApLCBhcnJheSggNCwgIDApLCBhcnJheSggMiwgIDQpLCBhcnJheSggNCwgIDEpKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCAyLCAgMCksIGFycmF5KCAyLCAgMiksIGFycmF5KCA0LCAgMiksIGFycmF5KCA0LCAgMikpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDIsICAwKSwgYXJyYXkoIDMsICAyKSwgYXJyYXkoIDQsICA0KSwgYXJyYXkoIDQsICA0KSksDQogICAgICAgICAgICBhcnJheShhcnJheSggMiwgIDIpLCBhcnJheSggNCwgIDEpLCBhcnJheSggNiwgIDIpLCBhcnJheSggNiwgIDIpKSwgLy8xMA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDQsICAwKSwgYXJyYXkoIDEsICA0KSwgYXJyYXkoIDQsICA0KSwgYXJyYXkoIDMsICA4KSksDQogICAgICAgICAgICBhcnJheShhcnJheSggMiwgIDIpLCBhcnJheSggNiwgIDIpLCBhcnJheSggNCwgIDYpLCBhcnJheSggNywgIDQpKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCA0LCAgMCksIGFycmF5KCA4LCAgMSksIGFycmF5KCA4LCAgNCksIGFycmF5KDEyLCAgNCkpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDMsICAxKSwgYXJyYXkoIDQsICA1KSwgYXJyYXkoMTEsICA1KSwgYXJyYXkoMTEsICA1KSksDQogICAgICAgICAgICBhcnJheShhcnJheSggNSwgIDEpLCBhcnJheSggNSwgIDUpLCBhcnJheSggNSwgIDcpLCBhcnJheSgxMSwgIDcpKSwgLy8xNQ0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDUsICAxKSwgYXJyYXkoIDcsICAzKSwgYXJyYXkoMTUsICAyKSwgYXJyYXkoIDMsIDEzKSksDQogICAgICAgICAgICBhcnJheShhcnJheSggMSwgIDUpLCBhcnJheSgxMCwgIDEpLCBhcnJheSggMSwgMTUpLCBhcnJheSggMiwgMTcpKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCA1LCAgMSksIGFycmF5KCA5LCAgNCksIGFycmF5KDE3LCAgMSksIGFycmF5KCAyLCAxOSkpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDMsICA0KSwgYXJyYXkoIDMsIDExKSwgYXJyYXkoMTcsICA0KSwgYXJyYXkoIDksIDE2KSksDQogICAgICAgICAgICBhcnJheShhcnJheSggMywgIDUpLCBhcnJheSggMywgMTMpLCBhcnJheSgxNSwgIDUpLCBhcnJheSgxNSwgMTApKSwgLy8yMA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDQsICA0KSwgYXJyYXkoMTcsICAwKSwgYXJyYXkoMTcsICA2KSwgYXJyYXkoMTksICA2KSksDQogICAgICAgICAgICBhcnJheShhcnJheSggMiwgIDcpLCBhcnJheSgxNywgIDApLCBhcnJheSggNywgMTYpLCBhcnJheSgzNCwgIDApKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCA0LCAgNSksIGFycmF5KCA0LCAxNCksIGFycmF5KDExLCAxNCksIGFycmF5KDE2LCAxNCkpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDYsICA0KSwgYXJyYXkoIDYsIDE0KSwgYXJyYXkoMTEsIDE2KSwgYXJyYXkoMzAsICAyKSksDQogICAgICAgICAgICBhcnJheShhcnJheSggOCwgIDQpLCBhcnJheSggOCwgMTMpLCBhcnJheSggNywgMjIpLCBhcnJheSgyMiwgMTMpKSwgLy8yNQ0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoMTAsICAyKSwgYXJyYXkoMTksICA0KSwgYXJyYXkoMjgsICA2KSwgYXJyYXkoMzMsICA0KSksDQogICAgICAgICAgICBhcnJheShhcnJheSggOCwgIDQpLCBhcnJheSgyMiwgIDMpLCBhcnJheSggOCwgMjYpLCBhcnJheSgxMiwgMjgpKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCAzLCAxMCksIGFycmF5KCAzLCAyMyksIGFycmF5KCA0LCAzMSksIGFycmF5KDExLCAzMSkpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDcsICA3KSwgYXJyYXkoMjEsICA3KSwgYXJyYXkoIDEsIDM3KSwgYXJyYXkoMTksIDI2KSksDQogICAgICAgICAgICBhcnJheShhcnJheSggNSwgMTApLCBhcnJheSgxOSwgMTApLCBhcnJheSgxNSwgMjUpLCBhcnJheSgyMywgMjUpKSwgLy8zMA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoMTMsICAzKSwgYXJyYXkoIDIsIDI5KSwgYXJyYXkoNDIsICAxKSwgYXJyYXkoMjMsIDI4KSksDQogICAgICAgICAgICBhcnJheShhcnJheSgxNywgIDApLCBhcnJheSgxMCwgMjMpLCBhcnJheSgxMCwgMzUpLCBhcnJheSgxOSwgMzUpKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KDE3LCAgMSksIGFycmF5KDE0LCAyMSksIGFycmF5KDI5LCAxOSksIGFycmF5KDExLCA0NikpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoMTMsICA2KSwgYXJyYXkoMTQsIDIzKSwgYXJyYXkoNDQsICA3KSwgYXJyYXkoNTksICAxKSksDQogICAgICAgICAgICBhcnJheShhcnJheSgxMiwgIDcpLCBhcnJheSgxMiwgMjYpLCBhcnJheSgzOSwgMTQpLCBhcnJheSgyMiwgNDEpKSwgLy8zNQ0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoIDYsIDE0KSwgYXJyYXkoIDYsIDM0KSwgYXJyYXkoNDYsIDEwKSwgYXJyYXkoIDIsIDY0KSksDQogICAgICAgICAgICBhcnJheShhcnJheSgxNywgIDQpLCBhcnJheSgyOSwgMTQpLCBhcnJheSg0OSwgMTApLCBhcnJheSgyNCwgNDYpKSwNCiAgICAgICAgICAgIGFycmF5KGFycmF5KCA0LCAxOCksIGFycmF5KDEzLCAzMiksIGFycmF5KDQ4LCAxNCksIGFycmF5KDQyLCAzMikpLA0KICAgICAgICAgICAgYXJyYXkoYXJyYXkoMjAsICA0KSwgYXJyYXkoNDAsICA3KSwgYXJyYXkoNDMsIDIyKSwgYXJyYXkoMTAsIDY3KSksDQogICAgICAgICAgICBhcnJheShhcnJheSgxOSwgIDYpLCBhcnJheSgxOCwgMzEpLCBhcnJheSgzNCwgMzQpLCBhcnJheSgyMCwgNjEpKSwvLzQwDQogICAgICAgICk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gQ0FDSEVBQkxFISEhDQogICAgICAgIA0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldEVjY1NwZWMoJHZlcnNpb24sICRsZXZlbCwgYXJyYXkgJiRzcGVjKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoY291bnQoJHNwZWMpIDwgNSkgew0KICAgICAgICAgICAgICAgICRzcGVjID0gYXJyYXkoMCwwLDAsMCwwKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGIxICAgPSBzZWxmOjokZWNjVGFibGVbJHZlcnNpb25dWyRsZXZlbF1bMF07DQogICAgICAgICAgICAkYjIgICA9IHNlbGY6OiRlY2NUYWJsZVskdmVyc2lvbl1bJGxldmVsXVsxXTsNCiAgICAgICAgICAgICRkYXRhID0gc2VsZjo6Z2V0RGF0YUxlbmd0aCgkdmVyc2lvbiwgJGxldmVsKTsNCiAgICAgICAgICAgICRlY2MgID0gc2VsZjo6Z2V0RUNDTGVuZ3RoKCR2ZXJzaW9uLCAkbGV2ZWwpOw0KDQogICAgICAgICAgICBpZigkYjIgPT0gMCkgew0KICAgICAgICAgICAgICAgICRzcGVjWzBdID0gJGIxOw0KICAgICAgICAgICAgICAgICRzcGVjWzFdID0gKGludCkoJGRhdGEgLyAkYjEpOw0KICAgICAgICAgICAgICAgICRzcGVjWzJdID0gKGludCkoJGVjYyAvICRiMSk7DQogICAgICAgICAgICAgICAgJHNwZWNbM10gPSAwOyANCiAgICAgICAgICAgICAgICAkc3BlY1s0XSA9IDA7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRzcGVjWzBdID0gJGIxOw0KICAgICAgICAgICAgICAgICRzcGVjWzFdID0gKGludCkoJGRhdGEgLyAoJGIxICsgJGIyKSk7DQogICAgICAgICAgICAgICAgJHNwZWNbMl0gPSAoaW50KSgkZWNjICAvICgkYjEgKyAkYjIpKTsNCiAgICAgICAgICAgICAgICAkc3BlY1szXSA9ICRiMjsNCiAgICAgICAgICAgICAgICAkc3BlY1s0XSA9ICRzcGVjWzFdICsgMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFsaWdubWVudCBwYXR0ZXJuIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgICAgIC8vIFBvc2l0aW9ucyBvZiBhbGlnbm1lbnQgcGF0dGVybnMuDQogICAgICAgIC8vIFRoaXMgYXJyYXkgaW5jbHVkZXMgb25seSB0aGUgc2Vjb25kIGFuZCB0aGUgdGhpcmQgcG9zaXRpb24gb2YgdGhlIA0KICAgICAgICAvLyBhbGlnbm1lbnQgcGF0dGVybnMuIFJlc3Qgb2YgdGhlbSBjYW4gYmUgY2FsY3VsYXRlZCBmcm9tIHRoZSBkaXN0YW5jZSANCiAgICAgICAgLy8gYmV0d2VlbiB0aGVtLg0KICAgICAgICAgDQogICAgICAgIC8vIFNlZSBUYWJsZSAxIGluIEFwcGVuZGl4IEUgKHBwLjcxKSBvZiBKSVMgWDA1MTA6MjAwNC4NCiAgICAgICAgIA0KICAgICAgICBwdWJsaWMgc3RhdGljICRhbGlnbm1lbnRQYXR0ZXJuID0gYXJyYXkoICAgICAgDQogICAgICAgICAgICBhcnJheSggMCwgIDApLA0KICAgICAgICAgICAgYXJyYXkoIDAsICAwKSwgYXJyYXkoMTgsICAwKSwgYXJyYXkoMjIsICAwKSwgYXJyYXkoMjYsICAwKSwgYXJyYXkoMzAsICAwKSwgLy8gMS0gNQ0KICAgICAgICAgICAgYXJyYXkoMzQsICAwKSwgYXJyYXkoMjIsIDM4KSwgYXJyYXkoMjQsIDQyKSwgYXJyYXkoMjYsIDQ2KSwgYXJyYXkoMjgsIDUwKSwgLy8gNi0xMA0KICAgICAgICAgICAgYXJyYXkoMzAsIDU0KSwgYXJyYXkoMzIsIDU4KSwgYXJyYXkoMzQsIDYyKSwgYXJyYXkoMjYsIDQ2KSwgYXJyYXkoMjYsIDQ4KSwgLy8xMS0xNQ0KICAgICAgICAgICAgYXJyYXkoMjYsIDUwKSwgYXJyYXkoMzAsIDU0KSwgYXJyYXkoMzAsIDU2KSwgYXJyYXkoMzAsIDU4KSwgYXJyYXkoMzQsIDYyKSwgLy8xNi0yMA0KICAgICAgICAgICAgYXJyYXkoMjgsIDUwKSwgYXJyYXkoMjYsIDUwKSwgYXJyYXkoMzAsIDU0KSwgYXJyYXkoMjgsIDU0KSwgYXJyYXkoMzIsIDU4KSwgLy8yMS0yNQ0KICAgICAgICAgICAgYXJyYXkoMzAsIDU4KSwgYXJyYXkoMzQsIDYyKSwgYXJyYXkoMjYsIDUwKSwgYXJyYXkoMzAsIDU0KSwgYXJyYXkoMjYsIDUyKSwgLy8yNi0zMA0KICAgICAgICAgICAgYXJyYXkoMzAsIDU2KSwgYXJyYXkoMzQsIDYwKSwgYXJyYXkoMzAsIDU4KSwgYXJyYXkoMzQsIDYyKSwgYXJyYXkoMzAsIDU0KSwgLy8zMS0zNQ0KICAgICAgICAgICAgYXJyYXkoMjQsIDUwKSwgYXJyYXkoMjgsIDU0KSwgYXJyYXkoMzIsIDU4KSwgYXJyYXkoMjYsIDU0KSwgYXJyYXkoMzAsIDU4KSwgLy8zNS00MA0KICAgICAgICApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCg0KICAgICAgICANCiAgICAgICAgLyoqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAqIFB1dCBhbiBhbGlnbm1lbnQgbWFya2VyLg0KICAgICAgICAgKiBAcGFyYW0gZnJhbWUNCiAgICAgICAgICogQHBhcmFtIHdpZHRoDQogICAgICAgICAqIEBwYXJhbSBveCxveSBjZW50ZXIgY29vcmRpbmF0ZSBvZiB0aGUgcGF0dGVybg0KICAgICAgICAgKi8NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBwdXRBbGlnbm1lbnRNYXJrZXIoYXJyYXkgJiRmcmFtZSwgJG94LCAkb3kpDQogICAgICAgIHsNCiAgICAgICAgICAgICRmaW5kZXIgPSBhcnJheSgNCiAgICAgICAgICAgICAgICAiXHhhMVx4YTFceGExXHhhMVx4YTEiLA0KICAgICAgICAgICAgICAgICJceGExXHhhMFx4YTBceGEwXHhhMSIsDQogICAgICAgICAgICAgICAgIlx4YTFceGEwXHhhMVx4YTBceGExIiwNCiAgICAgICAgICAgICAgICAiXHhhMVx4YTBceGEwXHhhMFx4YTEiLA0KICAgICAgICAgICAgICAgICJceGExXHhhMVx4YTFceGExXHhhMSINCiAgICAgICAgICAgICk7ICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICANCiAgICAgICAgICAgICR5U3RhcnQgPSAkb3ktMjsgICAgICAgICANCiAgICAgICAgICAgICR4U3RhcnQgPSAkb3gtMjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yKCR5PTA7ICR5PDU7ICR5KyspIHsNCiAgICAgICAgICAgICAgICBRUnN0cjo6c2V0KCRmcmFtZSwgJHhTdGFydCwgJHlTdGFydCskeSwgJGZpbmRlclskeV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcHV0QWxpZ25tZW50UGF0dGVybigkdmVyc2lvbiwgJiRmcmFtZSwgJHdpZHRoKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZigkdmVyc2lvbiA8IDIpDQogICAgICAgICAgICAgICAgcmV0dXJuOw0KDQogICAgICAgICAgICAkZCA9IHNlbGY6OiRhbGlnbm1lbnRQYXR0ZXJuWyR2ZXJzaW9uXVsxXSAtIHNlbGY6OiRhbGlnbm1lbnRQYXR0ZXJuWyR2ZXJzaW9uXVswXTsNCiAgICAgICAgICAgIGlmKCRkIDwgMCkgew0KICAgICAgICAgICAgICAgICR3ID0gMjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJHcgPSAoaW50KSgoJHdpZHRoIC0gc2VsZjo6JGFsaWdubWVudFBhdHRlcm5bJHZlcnNpb25dWzBdKSAvICRkICsgMik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKCR3ICogJHcgLSAzID09IDEpIHsNCiAgICAgICAgICAgICAgICAkeCA9IHNlbGY6OiRhbGlnbm1lbnRQYXR0ZXJuWyR2ZXJzaW9uXVswXTsNCiAgICAgICAgICAgICAgICAkeSA9IHNlbGY6OiRhbGlnbm1lbnRQYXR0ZXJuWyR2ZXJzaW9uXVswXTsNCiAgICAgICAgICAgICAgICBzZWxmOjpwdXRBbGlnbm1lbnRNYXJrZXIoJGZyYW1lLCAkeCwgJHkpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGN4ID0gc2VsZjo6JGFsaWdubWVudFBhdHRlcm5bJHZlcnNpb25dWzBdOw0KICAgICAgICAgICAgZm9yKCR4PTE7ICR4PCR3IC0gMTsgJHgrKykgew0KICAgICAgICAgICAgICAgIHNlbGY6OnB1dEFsaWdubWVudE1hcmtlcigkZnJhbWUsIDYsICRjeCk7DQogICAgICAgICAgICAgICAgc2VsZjo6cHV0QWxpZ25tZW50TWFya2VyKCRmcmFtZSwgJGN4LCAgNik7DQogICAgICAgICAgICAgICAgJGN4ICs9ICRkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkY3kgPSBzZWxmOjokYWxpZ25tZW50UGF0dGVyblskdmVyc2lvbl1bMF07DQogICAgICAgICAgICBmb3IoJHk9MDsgJHk8JHctMTsgJHkrKykgew0KICAgICAgICAgICAgICAgICRjeCA9IHNlbGY6OiRhbGlnbm1lbnRQYXR0ZXJuWyR2ZXJzaW9uXVswXTsNCiAgICAgICAgICAgICAgICBmb3IoJHg9MDsgJHg8JHctMTsgJHgrKykgew0KICAgICAgICAgICAgICAgICAgICBzZWxmOjpwdXRBbGlnbm1lbnRNYXJrZXIoJGZyYW1lLCAkY3gsICRjeSk7DQogICAgICAgICAgICAgICAgICAgICRjeCArPSAkZDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGN5ICs9ICRkOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gVmVyc2lvbiBpbmZvcm1hdGlvbiBwYXR0ZXJuIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCgkJLy8gVmVyc2lvbiBpbmZvcm1hdGlvbiBwYXR0ZXJuIChCQ0ggY29kZWQpLg0KICAgICAgICAvLyBTZWUgVGFibGUgMSBpbiBBcHBlbmRpeCBEIChwcC42OCkgb2YgSklTIFgwNTEwOjIwMDQuDQogICAgICAgIA0KCQkvLyBzaXplOiBbUVJTUEVDX1ZFUlNJT05fTUFYIC0gNl0NCgkJDQogICAgICAgIHB1YmxpYyBzdGF0aWMgJHZlcnNpb25QYXR0ZXJuID0gYXJyYXkoDQogICAgICAgICAgICAweDA3Yzk0LCAweDA4NWJjLCAweDA5YTk5LCAweDBhNGQzLCAweDBiYmY2LCAweDBjNzYyLCAweDBkODQ3LCAweDBlNjBkLA0KICAgICAgICAgICAgMHgwZjkyOCwgMHgxMGI3OCwgMHgxMTQ1ZCwgMHgxMmExNywgMHgxMzUzMiwgMHgxNDlhNiwgMHgxNTY4MywgMHgxNjhjOSwNCiAgICAgICAgICAgIDB4MTc3ZWMsIDB4MThlYzQsIDB4MTkxZTEsIDB4MWFmYWIsIDB4MWIwOGUsIDB4MWNjMWEsIDB4MWQzM2YsIDB4MWVkNzUsDQogICAgICAgICAgICAweDFmMjUwLCAweDIwOWQ1LCAweDIxNmYwLCAweDIyOGJhLCAweDIzNzlmLCAweDI0YjBiLCAweDI1NDJlLCAweDI2YTY0LA0KICAgICAgICAgICAgMHgyNzU0MSwgMHgyOGM2OQ0KICAgICAgICApOw0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFZlcnNpb25QYXR0ZXJuKCR2ZXJzaW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZigkdmVyc2lvbiA8IDcgfHwgJHZlcnNpb24gPiBRUlNQRUNfVkVSU0lPTl9NQVgpDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQoNCiAgICAgICAgICAgIHJldHVybiBzZWxmOjokdmVyc2lvblBhdHRlcm5bJHZlcnNpb24gLTddOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRm9ybWF0IGluZm9ybWF0aW9uIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIC8vIFNlZSBjYWxjRm9ybWF0SW5mbyBpbiB0ZXN0cy90ZXN0X3Fyc3BlYy5jIChvcmdpbmFsIHFyZW5jb2RlIGMgbGliKQ0KICAgICAgICANCiAgICAgICAgcHVibGljIHN0YXRpYyAkZm9ybWF0SW5mbyA9IGFycmF5KA0KICAgICAgICAgICAgYXJyYXkoMHg3N2M0LCAweDcyZjMsIDB4N2RhYSwgMHg3ODlkLCAweDY2MmYsIDB4NjMxOCwgMHg2YzQxLCAweDY5NzYpLA0KICAgICAgICAgICAgYXJyYXkoMHg1NDEyLCAweDUxMjUsIDB4NWU3YywgMHg1YjRiLCAweDQ1ZjksIDB4NDBjZSwgMHg0Zjk3LCAweDRhYTApLA0KICAgICAgICAgICAgYXJyYXkoMHgzNTVmLCAweDMwNjgsIDB4M2YzMSwgMHgzYTA2LCAweDI0YjQsIDB4MjE4MywgMHgyZWRhLCAweDJiZWQpLA0KICAgICAgICAgICAgYXJyYXkoMHgxNjg5LCAweDEzYmUsIDB4MWNlNywgMHgxOWQwLCAweDA3NjIsIDB4MDI1NSwgMHgwZDBjLCAweDA4M2IpDQogICAgICAgICk7DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRGb3JtYXRJbmZvKCRtYXNrLCAkbGV2ZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmKCRtYXNrIDwgMCB8fCAkbWFzayA+IDcpDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICBpZigkbGV2ZWwgPCAwIHx8ICRsZXZlbCA+IDMpDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7ICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICByZXR1cm4gc2VsZjo6JGZvcm1hdEluZm9bJGxldmVsXVskbWFza107DQogICAgICAgIH0NCg0KICAgICAgICAvLyBGcmFtZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgLy8gQ2FjaGUgb2YgaW5pdGlhbCBmcmFtZXMuDQogICAgICAgICANCiAgICAgICAgcHVibGljIHN0YXRpYyAkZnJhbWVzID0gYXJyYXkoKTsNCg0KICAgICAgICAvKiogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICogUHV0IGEgZmluZGVyIHBhdHRlcm4uDQogICAgICAgICAqIEBwYXJhbSBmcmFtZQ0KICAgICAgICAgKiBAcGFyYW0gd2lkdGgNCiAgICAgICAgICogQHBhcmFtIG94LG95IHVwcGVyLWxlZnQgY29vcmRpbmF0ZSBvZiB0aGUgcGF0dGVybg0KICAgICAgICAgKi8NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBwdXRGaW5kZXJQYXR0ZXJuKCYkZnJhbWUsICRveCwgJG95KQ0KICAgICAgICB7DQogICAgICAgICAgICAkZmluZGVyID0gYXJyYXkoDQogICAgICAgICAgICAgICAgIlx4YzFceGMxXHhjMVx4YzFceGMxXHhjMVx4YzEiLA0KICAgICAgICAgICAgICAgICJceGMxXHhjMFx4YzBceGMwXHhjMFx4YzBceGMxIiwNCiAgICAgICAgICAgICAgICAiXHhjMVx4YzBceGMxXHhjMVx4YzFceGMwXHhjMSIsDQogICAgICAgICAgICAgICAgIlx4YzFceGMwXHhjMVx4YzFceGMxXHhjMFx4YzEiLA0KICAgICAgICAgICAgICAgICJceGMxXHhjMFx4YzFceGMxXHhjMVx4YzBceGMxIiwNCiAgICAgICAgICAgICAgICAiXHhjMVx4YzBceGMwXHhjMFx4YzBceGMwXHhjMSIsDQogICAgICAgICAgICAgICAgIlx4YzFceGMxXHhjMVx4YzFceGMxXHhjMVx4YzEiDQogICAgICAgICAgICApOyAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yKCR5PTA7ICR5PDc7ICR5KyspIHsNCiAgICAgICAgICAgICAgICBRUnN0cjo6c2V0KCRmcmFtZSwgJG94LCAkb3krJHksICRmaW5kZXJbJHldKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGNyZWF0ZUZyYW1lKCR2ZXJzaW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICAkd2lkdGggPSBzZWxmOjokY2FwYWNpdHlbJHZlcnNpb25dW1FSQ0FQX1dJRFRIXTsNCiAgICAgICAgICAgICRmcmFtZUxpbmUgPSBzdHJfcmVwZWF0ICgiXDAiLCAkd2lkdGgpOw0KICAgICAgICAgICAgJGZyYW1lID0gYXJyYXlfZmlsbCgwLCAkd2lkdGgsICRmcmFtZUxpbmUpOw0KDQogICAgICAgICAgICAvLyBGaW5kZXIgcGF0dGVybg0KICAgICAgICAgICAgc2VsZjo6cHV0RmluZGVyUGF0dGVybigkZnJhbWUsIDAsIDApOw0KICAgICAgICAgICAgc2VsZjo6cHV0RmluZGVyUGF0dGVybigkZnJhbWUsICR3aWR0aCAtIDcsIDApOw0KICAgICAgICAgICAgc2VsZjo6cHV0RmluZGVyUGF0dGVybigkZnJhbWUsIDAsICR3aWR0aCAtIDcpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBTZXBhcmF0b3INCiAgICAgICAgICAgICR5T2Zmc2V0ID0gJHdpZHRoIC0gNzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yKCR5PTA7ICR5PDc7ICR5KyspIHsNCiAgICAgICAgICAgICAgICAkZnJhbWVbJHldWzddID0gIlx4YzAiOw0KICAgICAgICAgICAgICAgICRmcmFtZVskeV1bJHdpZHRoIC0gOF0gPSAiXHhjMCI7DQogICAgICAgICAgICAgICAgJGZyYW1lWyR5T2Zmc2V0XVs3XSA9ICJceGMwIjsNCiAgICAgICAgICAgICAgICAkeU9mZnNldCsrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAkc2V0UGF0dGVybiA9IHN0cl9yZXBlYXQoIlx4YzAiLCA4KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgUVJzdHI6OnNldCgkZnJhbWUsIDAsIDcsICRzZXRQYXR0ZXJuKTsNCiAgICAgICAgICAgIFFSc3RyOjpzZXQoJGZyYW1lLCAkd2lkdGgtOCwgNywgJHNldFBhdHRlcm4pOw0KICAgICAgICAgICAgUVJzdHI6OnNldCgkZnJhbWUsIDAsICR3aWR0aCAtIDgsICRzZXRQYXR0ZXJuKTsNCiAgICAgICAgDQogICAgICAgICAgICAvLyBGb3JtYXQgaW5mbw0KICAgICAgICAgICAgJHNldFBhdHRlcm4gPSBzdHJfcmVwZWF0KCJceDg0IiwgOSk7DQogICAgICAgICAgICBRUnN0cjo6c2V0KCRmcmFtZSwgMCwgOCwgJHNldFBhdHRlcm4pOw0KICAgICAgICAgICAgUVJzdHI6OnNldCgkZnJhbWUsICR3aWR0aCAtIDgsIDgsICRzZXRQYXR0ZXJuLCA4KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHlPZmZzZXQgPSAkd2lkdGggLSA4Ow0KDQogICAgICAgICAgICBmb3IoJHk9MDsgJHk8ODsgJHkrKywkeU9mZnNldCsrKSB7DQogICAgICAgICAgICAgICAgJGZyYW1lWyR5XVs4XSA9ICJceDg0IjsNCiAgICAgICAgICAgICAgICAkZnJhbWVbJHlPZmZzZXRdWzhdID0gIlx4ODQiOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaW1pbmcgcGF0dGVybiAgDQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvcigkaT0xOyAkaTwkd2lkdGgtMTU7ICRpKyspIHsNCiAgICAgICAgICAgICAgICAkZnJhbWVbNl1bNyskaV0gPSBjaHIoMHg5MCB8ICgkaSAmIDEpKTsNCiAgICAgICAgICAgICAgICAkZnJhbWVbNyskaV1bNl0gPSBjaHIoMHg5MCB8ICgkaSAmIDEpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm4gIA0KICAgICAgICAgICAgc2VsZjo6cHV0QWxpZ25tZW50UGF0dGVybigkdmVyc2lvbiwgJGZyYW1lLCAkd2lkdGgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBWZXJzaW9uIGluZm9ybWF0aW9uIA0KICAgICAgICAgICAgaWYoJHZlcnNpb24gPj0gNykgew0KICAgICAgICAgICAgICAgICR2aW5mID0gc2VsZjo6Z2V0VmVyc2lvblBhdHRlcm4oJHZlcnNpb24pOw0KDQogICAgICAgICAgICAgICAgJHYgPSAkdmluZjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IoJHg9MDsgJHg8NjsgJHgrKykgew0KICAgICAgICAgICAgICAgICAgICBmb3IoJHk9MDsgJHk8MzsgJHkrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGZyYW1lWygkd2lkdGggLSAxMSkrJHldWyR4XSA9IGNocigweDg4IHwgKCR2ICYgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgJHYgPSAkdiA+PiAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgJHYgPSAkdmluZjsNCiAgICAgICAgICAgICAgICBmb3IoJHk9MDsgJHk8NjsgJHkrKykgew0KICAgICAgICAgICAgICAgICAgICBmb3IoJHg9MDsgJHg8MzsgJHgrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGZyYW1lWyR5XVskeCsoJHdpZHRoIC0gMTEpXSA9IGNocigweDg4IHwgKCR2ICYgMSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgJHYgPSAkdiA+PiAxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgLy8gYW5kIGEgbGl0dGxlIGJpdC4uLiAgDQogICAgICAgICAgICAkZnJhbWVbJHdpZHRoIC0gOF1bOF0gPSAiXHg4MSI7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkZnJhbWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBkZWJ1ZygkZnJhbWUsICRiaW5hcnlfbW9kZSA9IGZhbHNlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoJGJpbmFyeV9tb2RlKSB7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGZyYW1lIGFzICYkZnJhbWVMaW5lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkZnJhbWVMaW5lID0gam9pbignPHNwYW4gY2xhc3M9Im0iPiZuYnNwOyZuYnNwOzwvc3Bhbj4nLCBleHBsb2RlKCcwJywgJGZyYW1lTGluZSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgJGZyYW1lTGluZSA9IGpvaW4oJyYjOTYwODsmIzk2MDg7JywgZXhwbG9kZSgnMScsICRmcmFtZUxpbmUpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgPz4NCiAgICAgICAgICAgICAgICA8c3R5bGU+DQogICAgICAgICAgICAgICAgICAgIC5tIHsgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IH0NCiAgICAgICAgICAgICAgICA8L3N0eWxlPg0KICAgICAgICAgICAgICAgIDw\/cGhwDQogICAgICAgICAgICAgICAgICAgIGVjaG8gJzxwcmU+PHR0Pjxici8gPjxici8gPjxici8gPiZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOyc7DQogICAgICAgICAgICAgICAgICAgIGVjaG8gam9pbigiPGJyLyA+Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7IiwgJGZyYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgZWNobyAnPC90dD48L3ByZT48YnIvID48YnIvID48YnIvID48YnIvID48YnIvID48YnIvID4nOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGZyYW1lIGFzICYkZnJhbWVMaW5lKSB7DQogICAgICAgICAgICAgICAgICAgICRmcmFtZUxpbmUgPSBqb2luKCc8c3BhbiBjbGFzcz0ibSI+Jm5ic3A7PC9zcGFuPicsICBleHBsb2RlKCJceGMwIiwgJGZyYW1lTGluZSkpOw0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVMaW5lID0gam9pbignPHNwYW4gY2xhc3M9Im0iPiYjOTYxODs8L3NwYW4+JywgZXhwbG9kZSgiXHhjMSIsICRmcmFtZUxpbmUpKTsNCiAgICAgICAgICAgICAgICAgICAgJGZyYW1lTGluZSA9IGpvaW4oJzxzcGFuIGNsYXNzPSJwIj4mbmJzcDs8L3NwYW4+JywgIGV4cGxvZGUoIlx4YTAiLCAkZnJhbWVMaW5lKSk7DQogICAgICAgICAgICAgICAgICAgICRmcmFtZUxpbmUgPSBqb2luKCc8c3BhbiBjbGFzcz0icCI+JiM5NjE4Ozwvc3Bhbj4nLCBleHBsb2RlKCJceGExIiwgJGZyYW1lTGluZSkpOw0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVMaW5lID0gam9pbignPHNwYW4gY2xhc3M9InMiPiYjOTY3MTs8L3NwYW4+JywgZXhwbG9kZSgiXHg4NCIsICRmcmFtZUxpbmUpKTsgLy9mb3JtYXQgMA0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVMaW5lID0gam9pbignPHNwYW4gY2xhc3M9InMiPiYjOTY3MDs8L3NwYW4+JywgZXhwbG9kZSgiXHg4NSIsICRmcmFtZUxpbmUpKTsgLy9mb3JtYXQgMQ0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVMaW5lID0gam9pbignPHNwYW4gY2xhc3M9IngiPiYjOTc2Mjs8L3NwYW4+JywgZXhwbG9kZSgiXHg4MSIsICRmcmFtZUxpbmUpKTsgLy9zcGVjaWFsIGJpdA0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVMaW5lID0gam9pbignPHNwYW4gY2xhc3M9ImMiPiZuYnNwOzwvc3Bhbj4nLCAgZXhwbG9kZSgiXHg5MCIsICRmcmFtZUxpbmUpKTsgLy9jbG9jayAwDQogICAgICAgICAgICAgICAgICAgICRmcmFtZUxpbmUgPSBqb2luKCc8c3BhbiBjbGFzcz0iYyI+JiM5NzE5Ozwvc3Bhbj4nLCBleHBsb2RlKCJceDkxIiwgJGZyYW1lTGluZSkpOyAvL2Nsb2NrIDENCiAgICAgICAgICAgICAgICAgICAgJGZyYW1lTGluZSA9IGpvaW4oJzxzcGFuIGNsYXNzPSJmIj4mbmJzcDs8L3NwYW4+JywgIGV4cGxvZGUoIlx4ODgiLCAkZnJhbWVMaW5lKSk7IC8vdmVyc2lvbg0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVMaW5lID0gam9pbignPHNwYW4gY2xhc3M9ImYiPiYjOTYxODs8L3NwYW4+JywgZXhwbG9kZSgiXHg4OSIsICRmcmFtZUxpbmUpKTsgLy92ZXJzaW9uDQogICAgICAgICAgICAgICAgICAgICRmcmFtZUxpbmUgPSBqb2luKCcmIzk4MzA7JywgZXhwbG9kZSgiXHgwMSIsICRmcmFtZUxpbmUpKTsNCiAgICAgICAgICAgICAgICAgICAgJGZyYW1lTGluZSA9IGpvaW4oJyYjODkwMTsnLCBleHBsb2RlKCJcMCIsICRmcmFtZUxpbmUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPz4NCiAgICAgICAgICAgICAgICA8c3R5bGU+DQogICAgICAgICAgICAgICAgICAgIC5wIHsgYmFja2dyb3VuZC1jb2xvcjogeWVsbG93OyB9DQogICAgICAgICAgICAgICAgICAgIC5tIHsgYmFja2dyb3VuZC1jb2xvcjogIzAwRkYwMDsgfQ0KICAgICAgICAgICAgICAgICAgICAucyB7IGJhY2tncm91bmQtY29sb3I6ICNGRjAwMDA7IH0NCiAgICAgICAgICAgICAgICAgICAgLmMgeyBiYWNrZ3JvdW5kLWNvbG9yOiBhcXVhOyB9DQogICAgICAgICAgICAgICAgICAgIC54IHsgYmFja2dyb3VuZC1jb2xvcjogcGluazsgfQ0KICAgICAgICAgICAgICAgICAgICAuZiB7IGJhY2tncm91bmQtY29sb3I6IGdvbGQ7IH0NCiAgICAgICAgICAgICAgICA8L3N0eWxlPg0KICAgICAgICAgICAgICAgIDw\/cGhwDQogICAgICAgICAgICAgICAgZWNobyAiPHByZT48dHQ+IjsNCiAgICAgICAgICAgICAgICBlY2hvIGpvaW4oIjxici8gPiIsICRmcmFtZSk7DQogICAgICAgICAgICAgICAgZWNobyAiPC90dD48L3ByZT4iOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBzZXJpYWwoJGZyYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gZ3pjb21wcmVzcyhqb2luKCJcbiIsICRmcmFtZSksIDkpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiB1bnNlcmlhbCgkY29kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIGV4cGxvZGUoIlxuIiwgZ3p1bmNvbXByZXNzKCRjb2RlKSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIG5ld0ZyYW1lKCR2ZXJzaW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZigkdmVyc2lvbiA8IDEgfHwgJHZlcnNpb24gPiBRUlNQRUNfVkVSU0lPTl9NQVgpIA0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KDQogICAgICAgICAgICBpZighaXNzZXQoc2VsZjo6JGZyYW1lc1skdmVyc2lvbl0pKSB7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgJGZpbGVOYW1lID0gUVJfQ0FDSEVfRElSLidmcmFtZV8nLiR2ZXJzaW9uLicuZGF0JzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiAoUVJfQ0FDSEVBQkxFKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlX2V4aXN0cygkZmlsZU5hbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmOjokZnJhbWVzWyR2ZXJzaW9uXSA9IHNlbGY6OnVuc2VyaWFsKGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlTmFtZSkpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjo6JGZyYW1lc1skdmVyc2lvbl0gPSBzZWxmOjpjcmVhdGVGcmFtZSgkdmVyc2lvbik7DQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3B1dF9jb250ZW50cygkZmlsZU5hbWUsIHNlbGY6OnNlcmlhbChzZWxmOjokZnJhbWVzWyR2ZXJzaW9uXSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgc2VsZjo6JGZyYW1lc1skdmVyc2lvbl0gPSBzZWxmOjpjcmVhdGVGcmFtZSgkdmVyc2lvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihpc19udWxsKHNlbGY6OiRmcmFtZXNbJHZlcnNpb25dKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCg0KICAgICAgICAgICAgcmV0dXJuIHNlbGY6OiRmcmFtZXNbJHZlcnNpb25dOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcnNCbG9ja051bSgkc3BlYykgICAgIHsgcmV0dXJuICRzcGVjWzBdICsgJHNwZWNbM107IH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByc0Jsb2NrTnVtMSgkc3BlYykgICAgeyByZXR1cm4gJHNwZWNbMF07IH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByc0RhdGFDb2RlczEoJHNwZWMpICAgeyByZXR1cm4gJHNwZWNbMV07IH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByc0VjY0NvZGVzMSgkc3BlYykgICAgeyByZXR1cm4gJHNwZWNbMl07IH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByc0Jsb2NrTnVtMigkc3BlYykgICAgeyByZXR1cm4gJHNwZWNbM107IH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByc0RhdGFDb2RlczIoJHNwZWMpICAgeyByZXR1cm4gJHNwZWNbNF07IH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByc0VjY0NvZGVzMigkc3BlYykgICAgeyByZXR1cm4gJHNwZWNbMl07IH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByc0RhdGFMZW5ndGgoJHNwZWMpICAgeyByZXR1cm4gKCRzcGVjWzBdICogJHNwZWNbMV0pICsgKCRzcGVjWzNdICogJHNwZWNbNF0pOyAgICB9DQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcnNFY2NMZW5ndGgoJHNwZWMpICAgIHsgcmV0dXJuICgkc3BlY1swXSArICRzcGVjWzNdKSAqICRzcGVjWzJdOyB9DQogICAgICAgIA0KICAgIH0KCgoKLy8tLS0tIHFyaW1hZ2UucGhwIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCg0KLyoNCiAqIFBIUCBRUiBDb2RlIGVuY29kZXINCiAqDQogKiBJbWFnZSBvdXRwdXQgb2YgY29kZSB1c2luZyBHRDINCiAqDQogKiBQSFAgUVIgQ29kZSBpcyBkaXN0cmlidXRlZCB1bmRlciBMR1BMIDMNCiAqIENvcHlyaWdodCAoQykgMjAxMCBEb21pbmlrIER6aWVuaWEgPGRlbHRhbGFiIGF0IHBvY3p0YSBkb3QgZm0+DQogKg0KICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcg0KICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyDQogKiB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUNCiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQogKg0KICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQ0KICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBDQogKi8NCiANCiAgICBkZWZpbmUoJ1FSX0lNQUdFJywgdHJ1ZSk7DQoNCiAgICBjbGFzcyBRUmltYWdlIHsNCiAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcG5nKCRmcmFtZSwgJGZpbGVuYW1lID0gZmFsc2UsICRwaXhlbFBlclBvaW50ID0gNCwgJG91dGVyRnJhbWUgPSA0LCRzYXZlYW5kcHJpbnQ9RkFMU0UpIA0KICAgICAgICB7DQogICAgICAgICAgICAkaW1hZ2UgPSBzZWxmOjppbWFnZSgkZnJhbWUsICRwaXhlbFBlclBvaW50LCAkb3V0ZXJGcmFtZSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICgkZmlsZW5hbWUgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgSGVhZGVyKCJDb250ZW50LXR5cGU6IGltYWdlL3BuZyIpOw0KICAgICAgICAgICAgICAgIEltYWdlUG5nKCRpbWFnZSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmKCRzYXZlYW5kcHJpbnQ9PT1UUlVFKXsNCiAgICAgICAgICAgICAgICAgICAgSW1hZ2VQbmcoJGltYWdlLCAkZmlsZW5hbWUpOw0KICAgICAgICAgICAgICAgICAgICBoZWFkZXIoIkNvbnRlbnQtdHlwZTogaW1hZ2UvcG5nIik7DQogICAgICAgICAgICAgICAgICAgIEltYWdlUG5nKCRpbWFnZSk7DQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIEltYWdlUG5nKCRpbWFnZSwgJGZpbGVuYW1lKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIEltYWdlRGVzdHJveSgkaW1hZ2UpOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGpwZygkZnJhbWUsICRmaWxlbmFtZSA9IGZhbHNlLCAkcGl4ZWxQZXJQb2ludCA9IDgsICRvdXRlckZyYW1lID0gNCwgJHEgPSA4NSkgDQogICAgICAgIHsNCiAgICAgICAgICAgICRpbWFnZSA9IHNlbGY6OmltYWdlKCRmcmFtZSwgJHBpeGVsUGVyUG9pbnQsICRvdXRlckZyYW1lKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKCRmaWxlbmFtZSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICBIZWFkZXIoIkNvbnRlbnQtdHlwZTogaW1hZ2UvanBlZyIpOw0KICAgICAgICAgICAgICAgIEltYWdlSnBlZygkaW1hZ2UsIG51bGwsICRxKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgSW1hZ2VKcGVnKCRpbWFnZSwgJGZpbGVuYW1lLCAkcSk7ICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIEltYWdlRGVzdHJveSgkaW1hZ2UpOw0KICAgICAgICB9DQogICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBpbWFnZSgkZnJhbWUsICRwaXhlbFBlclBvaW50ID0gNCwgJG91dGVyRnJhbWUgPSA0KSANCiAgICAgICAgew0KICAgICAgICAgICAgJGggPSBjb3VudCgkZnJhbWUpOw0KICAgICAgICAgICAgJHcgPSBzdHJsZW4oJGZyYW1lWzBdKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJGltZ1cgPSAkdyArIDIqJG91dGVyRnJhbWU7DQogICAgICAgICAgICAkaW1nSCA9ICRoICsgMiokb3V0ZXJGcmFtZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJGJhc2VfaW1hZ2UgPUltYWdlQ3JlYXRlKCRpbWdXLCAkaW1nSCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICRjb2xbMF0gPSBJbWFnZUNvbG9yQWxsb2NhdGUoJGJhc2VfaW1hZ2UsMjU1LDI1NSwyNTUpOw0KICAgICAgICAgICAgJGNvbFsxXSA9IEltYWdlQ29sb3JBbGxvY2F0ZSgkYmFzZV9pbWFnZSwwLDAsMCk7DQoNCiAgICAgICAgICAgIGltYWdlZmlsbCgkYmFzZV9pbWFnZSwgMCwgMCwgJGNvbFswXSk7DQoNCiAgICAgICAgICAgIGZvcigkeT0wOyAkeTwkaDsgJHkrKykgew0KICAgICAgICAgICAgICAgIGZvcigkeD0wOyAkeDwkdzsgJHgrKykgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJGZyYW1lWyR5XVskeF0gPT0gJzEnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBJbWFnZVNldFBpeGVsKCRiYXNlX2ltYWdlLCR4KyRvdXRlckZyYW1lLCR5KyRvdXRlckZyYW1lLCRjb2xbMV0pOyANCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHRhcmdldF9pbWFnZSA9SW1hZ2VDcmVhdGUoJGltZ1cgKiAkcGl4ZWxQZXJQb2ludCwgJGltZ0ggKiAkcGl4ZWxQZXJQb2ludCk7DQogICAgICAgICAgICBJbWFnZUNvcHlSZXNpemVkKCR0YXJnZXRfaW1hZ2UsICRiYXNlX2ltYWdlLCAwLCAwLCAwLCAwLCAkaW1nVyAqICRwaXhlbFBlclBvaW50LCAkaW1nSCAqICRwaXhlbFBlclBvaW50LCAkaW1nVywgJGltZ0gpOw0KICAgICAgICAgICAgSW1hZ2VEZXN0cm95KCRiYXNlX2ltYWdlKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICR0YXJnZXRfaW1hZ2U7DQogICAgICAgIH0NCiAgICB9CgoKCi8vLS0tLSBxcmlucHV0LnBocCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCgoNCi8qDQogKiBQSFAgUVIgQ29kZSBlbmNvZGVyDQogKg0KICogSW5wdXQgZW5jb2RpbmcgY2xhc3MNCiAqDQogKiBCYXNlZCBvbiBsaWJxcmVuY29kZSBDIGxpYnJhcnkgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAyLjENCiAqIENvcHlyaWdodCAoQykgMjAwNiwgMjAwNywgMjAwOCwgMjAwOSBLZW50YXJvIEZ1a3VjaGkgPGZ1a3VjaGlAbWVnYXVpLm5ldD4NCiAqDQogKiBQSFAgUVIgQ29kZSBpcyBkaXN0cmlidXRlZCB1bmRlciBMR1BMIDMNCiAqIENvcHlyaWdodCAoQykgMjAxMCBEb21pbmlrIER6aWVuaWEgPGRlbHRhbGFiIGF0IHBvY3p0YSBkb3QgZm0+DQogKg0KICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcg0KICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyDQogKiB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUNCiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQogKg0KICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQ0KICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBDQogKi8NCiANCiAgICBkZWZpbmUoJ1NUUlVDVFVSRV9IRUFERVJfQklUUycsICAyMCk7DQogICAgZGVmaW5lKCdNQVhfU1RSVUNUVVJFRF9TWU1CT0xTJywgMTYpOw0KDQogICAgY2xhc3MgUVJpbnB1dEl0ZW0gew0KICAgIA0KICAgICAgICBwdWJsaWMgJG1vZGU7DQogICAgICAgIHB1YmxpYyAkc2l6ZTsNCiAgICAgICAgcHVibGljICRkYXRhOw0KICAgICAgICBwdWJsaWMgJGJzdHJlYW07DQoNCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRtb2RlLCAkc2l6ZSwgJGRhdGEsICRic3RyZWFtID0gbnVsbCkgDQogICAgICAgIHsNCiAgICAgICAgICAgICRzZXREYXRhID0gYXJyYXlfc2xpY2UoJGRhdGEsIDAsICRzaXplKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGNvdW50KCRzZXREYXRhKSA8ICRzaXplKSB7DQogICAgICAgICAgICAgICAgJHNldERhdGEgPSBhcnJheV9tZXJnZSgkc2V0RGF0YSwgYXJyYXlfZmlsbCgwLCRzaXplLWNvdW50KCRzZXREYXRhKSwwKSk7DQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgaWYoIVFSaW5wdXQ6OmNoZWNrKCRtb2RlLCAkc2l6ZSwgJHNldERhdGEpKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignRXJyb3IgbTonLiRtb2RlLicsczonLiRzaXplLicsZDonLmpvaW4oJywnLCRzZXREYXRhKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICR0aGlzLT5tb2RlID0gJG1vZGU7DQogICAgICAgICAgICAkdGhpcy0+c2l6ZSA9ICRzaXplOw0KICAgICAgICAgICAgJHRoaXMtPmRhdGEgPSAkc2V0RGF0YTsNCiAgICAgICAgICAgICR0aGlzLT5ic3RyZWFtID0gJGJzdHJlYW07DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlTW9kZU51bSgkdmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICR3b3JkcyA9IChpbnQpKCR0aGlzLT5zaXplIC8gMyk7DQogICAgICAgICAgICAgICAgJGJzID0gbmV3IFFSYml0c3RyZWFtKCk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgJHZhbCA9IDB4MTsNCiAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg0LCAkdmFsKTsNCiAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bShRUnNwZWM6Omxlbmd0aEluZGljYXRvcihRUl9NT0RFX05VTSwgJHZlcnNpb24pLCAkdGhpcy0+c2l6ZSk7DQoNCiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGk8JHdvcmRzOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICR2YWwgID0gKG9yZCgkdGhpcy0+ZGF0YVskaSozICBdKSAtIG9yZCgnMCcpKSAqIDEwMDsNCiAgICAgICAgICAgICAgICAgICAgJHZhbCArPSAob3JkKCR0aGlzLT5kYXRhWyRpKjMrMV0pIC0gb3JkKCcwJykpICogMTA7DQogICAgICAgICAgICAgICAgICAgICR2YWwgKz0gKG9yZCgkdGhpcy0+ZGF0YVskaSozKzJdKSAtIG9yZCgnMCcpKTsNCiAgICAgICAgICAgICAgICAgICAgJGJzLT5hcHBlbmROdW0oMTAsICR2YWwpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmKCR0aGlzLT5zaXplIC0gJHdvcmRzICogMyA9PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICR2YWwgPSBvcmQoJHRoaXMtPmRhdGFbJHdvcmRzKjNdKSAtIG9yZCgnMCcpOw0KICAgICAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg0LCAkdmFsKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoJHRoaXMtPnNpemUgLSAkd29yZHMgKiAzID09IDIpIHsNCiAgICAgICAgICAgICAgICAgICAgJHZhbCAgPSAob3JkKCR0aGlzLT5kYXRhWyR3b3JkcyozICBdKSAtIG9yZCgnMCcpKSAqIDEwOw0KICAgICAgICAgICAgICAgICAgICAkdmFsICs9IChvcmQoJHRoaXMtPmRhdGFbJHdvcmRzKjMrMV0pIC0gb3JkKCcwJykpOw0KICAgICAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg3LCAkdmFsKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAkdGhpcy0+YnN0cmVhbSA9ICRiczsNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVNb2RlQW4oJHZlcnNpb24pDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgJHdvcmRzID0gKGludCkoJHRoaXMtPnNpemUgLyAyKTsNCiAgICAgICAgICAgICAgICAkYnMgPSBuZXcgUVJiaXRzdHJlYW0oKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg0LCAweDAyKTsNCiAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bShRUnNwZWM6Omxlbmd0aEluZGljYXRvcihRUl9NT0RFX0FOLCAkdmVyc2lvbiksICR0aGlzLT5zaXplKTsNCg0KICAgICAgICAgICAgICAgIGZvcigkaT0wOyAkaTwkd29yZHM7ICRpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgJHZhbCAgPSAoaW50KVFSaW5wdXQ6Omxvb2tBblRhYmxlKG9yZCgkdGhpcy0+ZGF0YVskaSoyICBdKSkgKiA0NTsNCiAgICAgICAgICAgICAgICAgICAgJHZhbCArPSAoaW50KVFSaW5wdXQ6Omxvb2tBblRhYmxlKG9yZCgkdGhpcy0+ZGF0YVskaSoyKzFdKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgJGJzLT5hcHBlbmROdW0oMTEsICR2YWwpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmKCR0aGlzLT5zaXplICYgMSkgew0KICAgICAgICAgICAgICAgICAgICAkdmFsID0gUVJpbnB1dDo6bG9va0FuVGFibGUob3JkKCR0aGlzLT5kYXRhWyR3b3JkcyAqIDJdKSk7DQogICAgICAgICAgICAgICAgICAgICRicy0+YXBwZW5kTnVtKDYsICR2YWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICAgICAgJHRoaXMtPmJzdHJlYW0gPSAkYnM7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVNb2RlOCgkdmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAkYnMgPSBuZXcgUVJiaXRzdHJlYW0oKTsNCg0KICAgICAgICAgICAgICAgICRicy0+YXBwZW5kTnVtKDQsIDB4NCk7DQogICAgICAgICAgICAgICAgJGJzLT5hcHBlbmROdW0oUVJzcGVjOjpsZW5ndGhJbmRpY2F0b3IoUVJfTU9ERV84LCAkdmVyc2lvbiksICR0aGlzLT5zaXplKTsNCg0KICAgICAgICAgICAgICAgIGZvcigkaT0wOyAkaTwkdGhpcy0+c2l6ZTsgJGkrKykgew0KICAgICAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg4LCBvcmQoJHRoaXMtPmRhdGFbJGldKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgJHRoaXMtPmJzdHJlYW0gPSAkYnM7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVNb2RlS2FuamkoJHZlcnNpb24pDQogICAgICAgIHsNCiAgICAgICAgICAgIHRyeSB7DQoNCiAgICAgICAgICAgICAgICAkYnMgPSBuZXcgUVJiaXRydHJlYW0oKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg0LCAweDgpOw0KICAgICAgICAgICAgICAgICRicy0+YXBwZW5kTnVtKFFSc3BlYzo6bGVuZ3RoSW5kaWNhdG9yKFFSX01PREVfS0FOSkksICR2ZXJzaW9uKSwgKGludCkoJHRoaXMtPnNpemUgLyAyKSk7DQoNCiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGk8JHRoaXMtPnNpemU7ICRpKz0yKSB7DQogICAgICAgICAgICAgICAgICAgICR2YWwgPSAob3JkKCR0aGlzLT5kYXRhWyRpXSkgPDwgOCkgfCBvcmQoJHRoaXMtPmRhdGFbJGkrMV0pOw0KICAgICAgICAgICAgICAgICAgICBpZigkdmFsIDw9IDB4OWZmYykgew0KICAgICAgICAgICAgICAgICAgICAgICAgJHZhbCAtPSAweDgxNDA7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkdmFsIC09IDB4YzE0MDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgJGggPSAoJHZhbCA+PiA4KSAqIDB4YzA7DQogICAgICAgICAgICAgICAgICAgICR2YWwgPSAoJHZhbCAmIDB4ZmYpICsgJGg7DQoNCiAgICAgICAgICAgICAgICAgICAgJGJzLT5hcHBlbmROdW0oMTMsICR2YWwpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICR0aGlzLT5ic3RyZWFtID0gJGJzOw0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gJGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZU1vZGVTdHJ1Y3R1cmUoKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICRicyA9ICBuZXcgUVJiaXRzdHJlYW0oKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg0LCAweDAzKTsNCiAgICAgICAgICAgICAgICAkYnMtPmFwcGVuZE51bSg0LCBvcmQoJHRoaXMtPmRhdGFbMV0pIC0gMSk7DQogICAgICAgICAgICAgICAgJGJzLT5hcHBlbmROdW0oNCwgb3JkKCR0aGlzLT5kYXRhWzBdKSAtIDEpOw0KICAgICAgICAgICAgICAgICRicy0+YXBwZW5kTnVtKDgsIG9yZCgkdGhpcy0+ZGF0YVsyXSkpOw0KDQogICAgICAgICAgICAgICAgJHRoaXMtPmJzdHJlYW0gPSAkYnM7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlc3RpbWF0ZUJpdFN0cmVhbVNpemVPZkVudHJ5KCR2ZXJzaW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICAkYml0cyA9IDA7DQoNCiAgICAgICAgICAgIGlmKCR2ZXJzaW9uID09IDApIA0KICAgICAgICAgICAgICAgICR2ZXJzaW9uID0gMTsNCg0KICAgICAgICAgICAgc3dpdGNoKCR0aGlzLT5tb2RlKSB7DQogICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFX05VTTogICAgICAgICRiaXRzID0gUVJpbnB1dDo6ZXN0aW1hdGVCaXRzTW9kZU51bSgkdGhpcy0+c2l6ZSk7ICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9BTjogICAgICAgICRiaXRzID0gUVJpbnB1dDo6ZXN0aW1hdGVCaXRzTW9kZUFuKCR0aGlzLT5zaXplKTsgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFXzg6ICAgICAgICAgICAgJGJpdHMgPSBRUmlucHV0Ojplc3RpbWF0ZUJpdHNNb2RlOCgkdGhpcy0+c2l6ZSk7ICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9LQU5KSTogICAgICAgICRiaXRzID0gUVJpbnB1dDo6ZXN0aW1hdGVCaXRzTW9kZUthbmppKCR0aGlzLT5zaXplKTticmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFFSX01PREVfU1RSVUNUVVJFOiAgICByZXR1cm4gU1RSVUNUVVJFX0hFQURFUl9CSVRTOyAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkbCA9IFFSc3BlYzo6bGVuZ3RoSW5kaWNhdG9yKCR0aGlzLT5tb2RlLCAkdmVyc2lvbik7DQogICAgICAgICAgICAkbSA9IDEgPDwgJGw7DQogICAgICAgICAgICAkbnVtID0gKGludCkoKCR0aGlzLT5zaXplICsgJG0gLSAxKSAvICRtKTsNCg0KICAgICAgICAgICAgJGJpdHMgKz0gJG51bSAqICg0ICsgJGwpOw0KDQogICAgICAgICAgICByZXR1cm4gJGJpdHM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlQml0U3RyZWFtKCR2ZXJzaW9uKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmJzdHJlYW0pOw0KICAgICAgICAgICAgICAgICR3b3JkcyA9IFFSc3BlYzo6bWF4aW11bVdvcmRzKCR0aGlzLT5tb2RlLCAkdmVyc2lvbik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoJHRoaXMtPnNpemUgPiAkd29yZHMpIHsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgJHN0MSA9IG5ldyBRUmlucHV0SXRlbSgkdGhpcy0+bW9kZSwgJHdvcmRzLCAkdGhpcy0+ZGF0YSk7DQogICAgICAgICAgICAgICAgICAgICRzdDIgPSBuZXcgUVJpbnB1dEl0ZW0oJHRoaXMtPm1vZGUsICR0aGlzLT5zaXplIC0gJHdvcmRzLCBhcnJheV9zbGljZSgkdGhpcy0+ZGF0YSwgJHdvcmRzKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgJHN0MS0+ZW5jb2RlQml0U3RyZWFtKCR2ZXJzaW9uKTsNCiAgICAgICAgICAgICAgICAgICAgJHN0Mi0+ZW5jb2RlQml0U3RyZWFtKCR2ZXJzaW9uKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5ic3RyZWFtID0gbmV3IFFSYml0c3RyZWFtKCk7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5ic3RyZWFtLT5hcHBlbmQoJHN0MS0+YnN0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgICR0aGlzLT5ic3RyZWFtLT5hcHBlbmQoJHN0Mi0+YnN0cmVhbSk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB1bnNldCgkc3QxKTsNCiAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHN0Mik7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAkcmV0ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCgkdGhpcy0+bW9kZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFX05VTTogICAgICAgICRyZXQgPSAkdGhpcy0+ZW5jb2RlTW9kZU51bSgkdmVyc2lvbik7ICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFX0FOOiAgICAgICAgJHJldCA9ICR0aGlzLT5lbmNvZGVNb2RlQW4oJHZlcnNpb24pOyAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV84OiAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+ZW5jb2RlTW9kZTgoJHZlcnNpb24pOyAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9LQU5KSTogICAgICAgICRyZXQgPSAkdGhpcy0+ZW5jb2RlTW9kZUthbmppKCR2ZXJzaW9uKTticmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9TVFJVQ1RVUkU6ICAgICRyZXQgPSAkdGhpcy0+ZW5jb2RlTW9kZVN0cnVjdHVyZSgpOyAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYoJHJldCA8IDApDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5ic3RyZWFtLT5zaXplKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQogICAgDQogICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQogICAgY2xhc3MgUVJpbnB1dCB7DQoNCiAgICAgICAgcHVibGljICRpdGVtczsNCiAgICAgICAgDQogICAgICAgIHByaXZhdGUgJHZlcnNpb247DQogICAgICAgIHByaXZhdGUgJGxldmVsOw0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkdmVyc2lvbiA9IDAsICRsZXZlbCA9IFFSX0VDTEVWRUxfTCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCR2ZXJzaW9uIDwgMCB8fCAkdmVyc2lvbiA+IFFSU1BFQ19WRVJTSU9OX01BWCB8fCAkbGV2ZWwgPiBRUl9FQ0xFVkVMX0gpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdJbnZhbGlkIHZlcnNpb24gbm8nKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHRoaXMtPnZlcnNpb24gPSAkdmVyc2lvbjsNCiAgICAgICAgICAgICR0aGlzLT5sZXZlbCA9ICRsZXZlbDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRWZXJzaW9uKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT52ZXJzaW9uOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIHNldFZlcnNpb24oJHZlcnNpb24pDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmKCR2ZXJzaW9uIDwgMCB8fCAkdmVyc2lvbiA+IFFSU1BFQ19WRVJTSU9OX01BWCkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ0ludmFsaWQgdmVyc2lvbiBubycpOw0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHRoaXMtPnZlcnNpb24gPSAkdmVyc2lvbjsNCg0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxldmVsOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRFcnJvckNvcnJlY3Rpb25MZXZlbCgkbGV2ZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmKCRsZXZlbCA+IFFSX0VDTEVWRUxfSCkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ0ludmFsaWQgRUNMRVZFTCcpOw0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHRoaXMtPmxldmVsID0gJGxldmVsOw0KDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBhcHBlbmRFbnRyeShRUmlucHV0SXRlbSAkZW50cnkpDQogICAgICAgIHsNCiAgICAgICAgICAgICR0aGlzLT5pdGVtc1tdID0gJGVudHJ5Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGFwcGVuZCgkbW9kZSwgJHNpemUsICRkYXRhKQ0KICAgICAgICB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICRlbnRyeSA9IG5ldyBRUmlucHV0SXRlbSgkbW9kZSwgJHNpemUsICRkYXRhKTsNCiAgICAgICAgICAgICAgICAkdGhpcy0+aXRlbXNbXSA9ICRlbnRyeTsNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIA0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gaW5zZXJ0U3RydWN0dXJlZEFwcGVuZEhlYWRlcigkc2l6ZSwgJGluZGV4LCAkcGFyaXR5KQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiggJHNpemUgPiBNQVhfU1RSVUNUVVJFRF9TWU1CT0xTICkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ2luc2VydFN0cnVjdHVyZWRBcHBlbmRIZWFkZXIgd3Jvbmcgc2l6ZScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiggJGluZGV4IDw9IDAgfHwgJGluZGV4ID4gTUFYX1NUUlVDVFVSRURfU1lNQk9MUyApIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdpbnNlcnRTdHJ1Y3R1cmVkQXBwZW5kSGVhZGVyIHdyb25nIGluZGV4Jyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRidWYgPSBhcnJheSgkc2l6ZSwgJGluZGV4LCAkcGFyaXR5KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAkZW50cnkgPSBuZXcgUVJpbnB1dEl0ZW0oUVJfTU9ERV9TVFJVQ1RVUkUsIDMsIGJ1Zik7DQogICAgICAgICAgICAgICAgYXJyYXlfdW5zaGlmdCgkdGhpcy0+aXRlbXMsICRlbnRyeSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gJGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGNhbGNQYXJpdHkoKQ0KICAgICAgICB7DQogICAgICAgICAgICAkcGFyaXR5ID0gMDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yZWFjaCgkdGhpcy0+aXRlbXMgYXMgJGl0ZW0pIHsNCiAgICAgICAgICAgICAgICBpZigkaXRlbS0+bW9kZSAhPSBRUl9NT0RFX1NUUlVDVFVSRSkgew0KICAgICAgICAgICAgICAgICAgICBmb3IoJGk9JGl0ZW0tPnNpemUtMTsgJGk+PTA7ICRpLS0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJpdHkgXj0gJGl0ZW0tPmRhdGFbJGldOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gJHBhcml0eTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY2hlY2tNb2RlTnVtKCRzaXplLCAkZGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yKCRpPTA7ICRpPCRzaXplOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgaWYoKG9yZCgkZGF0YVskaV0pIDwgb3JkKCcwJykpIHx8IChvcmQoJGRhdGFbJGldKSA+IG9yZCgnOScpKSl7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZXN0aW1hdGVCaXRzTW9kZU51bSgkc2l6ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgJHcgPSAoaW50KSRzaXplIC8gMzsNCiAgICAgICAgICAgICRiaXRzID0gJHcgKiAxMDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc3dpdGNoKCRzaXplIC0gJHcgKiAzKSB7DQogICAgICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgICAgICAkYml0cyArPSA0Ow0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDI6DQogICAgICAgICAgICAgICAgICAgICRiaXRzICs9IDc7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gJGJpdHM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljICRhblRhYmxlID0gYXJyYXkoDQogICAgICAgICAgICAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwNCiAgICAgICAgICAgIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLA0KICAgICAgICAgICAgMzYsIC0xLCAtMSwgLTEsIDM3LCAzOCwgLTEsIC0xLCAtMSwgLTEsIDM5LCA0MCwgLTEsIDQxLCA0MiwgNDMsDQogICAgICAgICAgICAgMCwgIDEsICAyLCAgMywgIDQsICA1LCAgNiwgIDcsICA4LCAgOSwgNDQsIC0xLCAtMSwgLTEsIC0xLCAtMSwNCiAgICAgICAgICAgIC0xLCAxMCwgMTEsIDEyLCAxMywgMTQsIDE1LCAxNiwgMTcsIDE4LCAxOSwgMjAsIDIxLCAyMiwgMjMsIDI0LA0KICAgICAgICAgICAgMjUsIDI2LCAyNywgMjgsIDI5LCAzMCwgMzEsIDMyLCAzMywgMzQsIDM1LCAtMSwgLTEsIC0xLCAtMSwgLTEsDQogICAgICAgICAgICAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwNCiAgICAgICAgICAgIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xDQogICAgICAgICk7DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBsb29rQW5UYWJsZSgkYykNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuICgoJGMgPiAxMjcpPy0xOnNlbGY6OiRhblRhYmxlWyRjXSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGNoZWNrTW9kZUFuKCRzaXplLCAkZGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yKCRpPTA7ICRpPCRzaXplOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKHNlbGY6Omxvb2tBblRhYmxlKG9yZCgkZGF0YVskaV0pKSA9PSAtMSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZXN0aW1hdGVCaXRzTW9kZUFuKCRzaXplKQ0KICAgICAgICB7DQogICAgICAgICAgICAkdyA9IChpbnQpKCRzaXplIC8gMik7DQogICAgICAgICAgICAkYml0cyA9ICR3ICogMTE7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCRzaXplICYgMSkgew0KICAgICAgICAgICAgICAgICRiaXRzICs9IDY7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAkYml0czsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBlc3RpbWF0ZUJpdHNNb2RlOCgkc2l6ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuICRzaXplICogODsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlc3RpbWF0ZUJpdHNNb2RlS2FuamkoJHNpemUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiAoaW50KSgoJHNpemUgLyAyKSAqIDEzKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY2hlY2tNb2RlS2FuamkoJHNpemUsICRkYXRhKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZigkc2l6ZSAmIDEpDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICBmb3IoJGk9MDsgJGk8JHNpemU7ICRpKz0yKSB7DQogICAgICAgICAgICAgICAgJHZhbCA9IChvcmQoJGRhdGFbJGldKSA8PCA4KSB8IG9yZCgkZGF0YVskaSsxXSk7DQogICAgICAgICAgICAgICAgaWYoICR2YWwgPCAweDgxNDAgDQogICAgICAgICAgICAgICAgfHwgKCR2YWwgPiAweDlmZmMgJiYgJHZhbCA8IDB4ZTA0MCkgDQogICAgICAgICAgICAgICAgfHwgJHZhbCA+IDB4ZWJiZikgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgICAgICAgKiBWYWxpZGF0aW9uDQogICAgICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gY2hlY2soJG1vZGUsICRzaXplLCAkZGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYoJHNpemUgPD0gMCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KDQogICAgICAgICAgICBzd2l0Y2goJG1vZGUpIHsNCiAgICAgICAgICAgICAgICBjYXNlIFFSX01PREVfTlVNOiAgICAgICByZXR1cm4gc2VsZjo6Y2hlY2tNb2RlTnVtKCRzaXplLCAkZGF0YSk7ICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFX0FOOiAgICAgICAgcmV0dXJuIHNlbGY6OmNoZWNrTW9kZUFuKCRzaXplLCAkZGF0YSk7ICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9LQU5KSTogICAgIHJldHVybiBzZWxmOjpjaGVja01vZGVLYW5qaSgkc2l6ZSwgJGRhdGEpOyBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIFFSX01PREVfODogICAgICAgICByZXR1cm4gdHJ1ZTsgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFX1NUUlVDVFVSRTogcmV0dXJuIHRydWU7IGJyZWFrOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGVzdGltYXRlQml0U3RyZWFtU2l6ZSgkdmVyc2lvbikNCiAgICAgICAgew0KICAgICAgICAgICAgJGJpdHMgPSAwOw0KDQogICAgICAgICAgICBmb3JlYWNoKCR0aGlzLT5pdGVtcyBhcyAkaXRlbSkgew0KICAgICAgICAgICAgICAgICRiaXRzICs9ICRpdGVtLT5lc3RpbWF0ZUJpdFN0cmVhbVNpemVPZkVudHJ5KCR2ZXJzaW9uKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuICRiaXRzOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGVzdGltYXRlVmVyc2lvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgICR2ZXJzaW9uID0gMDsNCiAgICAgICAgICAgICRwcmV2ID0gMDsNCiAgICAgICAgICAgIGRvIHsNCiAgICAgICAgICAgICAgICAkcHJldiA9ICR2ZXJzaW9uOw0KICAgICAgICAgICAgICAgICRiaXRzID0gJHRoaXMtPmVzdGltYXRlQml0U3RyZWFtU2l6ZSgkcHJldik7DQogICAgICAgICAgICAgICAgJHZlcnNpb24gPSBRUnNwZWM6OmdldE1pbmltdW1WZXJzaW9uKChpbnQpKCgkYml0cyArIDcpIC8gOCksICR0aGlzLT5sZXZlbCk7DQogICAgICAgICAgICAgICAgaWYgKCR2ZXJzaW9uIDwgMCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSB3aGlsZSAoJHZlcnNpb24gPiAkcHJldik7DQoNCiAgICAgICAgICAgIHJldHVybiAkdmVyc2lvbjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbGVuZ3RoT2ZDb2RlKCRtb2RlLCAkdmVyc2lvbiwgJGJpdHMpDQogICAgICAgIHsNCiAgICAgICAgICAgICRwYXlsb2FkID0gJGJpdHMgLSA0IC0gUVJzcGVjOjpsZW5ndGhJbmRpY2F0b3IoJG1vZGUsICR2ZXJzaW9uKTsNCiAgICAgICAgICAgIHN3aXRjaCgkbW9kZSkgew0KICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9OVU06DQogICAgICAgICAgICAgICAgICAgICRjaHVua3MgPSAoaW50KSgkcGF5bG9hZCAvIDEwKTsNCiAgICAgICAgICAgICAgICAgICAgJHJlbWFpbiA9ICRwYXlsb2FkIC0gJGNodW5rcyAqIDEwOw0KICAgICAgICAgICAgICAgICAgICAkc2l6ZSA9ICRjaHVua3MgKiAzOw0KICAgICAgICAgICAgICAgICAgICBpZigkcmVtYWluID49IDcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRzaXplICs9IDI7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZigkcmVtYWluID49IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRzaXplICs9IDE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFX0FOOg0KICAgICAgICAgICAgICAgICAgICAkY2h1bmtzID0gKGludCkoJHBheWxvYWQgLyAxMSk7DQogICAgICAgICAgICAgICAgICAgICRyZW1haW4gPSAkcGF5bG9hZCAtICRjaHVua3MgKiAxMTsNCiAgICAgICAgICAgICAgICAgICAgJHNpemUgPSAkY2h1bmtzICogMjsNCiAgICAgICAgICAgICAgICAgICAgaWYoJHJlbWFpbiA+PSA2KSANCiAgICAgICAgICAgICAgICAgICAgICAgICRzaXplKys7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV84Og0KICAgICAgICAgICAgICAgICAgICAkc2l6ZSA9IChpbnQpKCRwYXlsb2FkIC8gOCk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9LQU5KSToNCiAgICAgICAgICAgICAgICAgICAgJHNpemUgPSAoaW50KSgoJHBheWxvYWQgLyAxMykgKiAyKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSBRUl9NT0RFX1NUUlVDVFVSRToNCiAgICAgICAgICAgICAgICAgICAgJHNpemUgPSAoaW50KSgkcGF5bG9hZCAvIDgpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAkc2l6ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAkbWF4c2l6ZSA9IFFSc3BlYzo6bWF4aW11bVdvcmRzKCRtb2RlLCAkdmVyc2lvbik7DQogICAgICAgICAgICBpZigkc2l6ZSA8IDApICRzaXplID0gMDsNCiAgICAgICAgICAgIGlmKCRzaXplID4gJG1heHNpemUpICRzaXplID0gJG1heHNpemU7DQoNCiAgICAgICAgICAgIHJldHVybiAkc2l6ZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGVCaXRTdHJlYW0oKQ0KICAgICAgICB7DQogICAgICAgICAgICAkdG90YWwgPSAwOw0KDQogICAgICAgICAgICBmb3JlYWNoKCR0aGlzLT5pdGVtcyBhcyAkaXRlbSkgew0KICAgICAgICAgICAgICAgICRiaXRzID0gJGl0ZW0tPmVuY29kZUJpdFN0cmVhbSgkdGhpcy0+dmVyc2lvbik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoJGJpdHMgPCAwKSANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkdG90YWwgKz0gJGJpdHM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAkdG90YWw7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gY29udmVydERhdGEoKQ0KICAgICAgICB7DQogICAgICAgICAgICAkdmVyID0gJHRoaXMtPmVzdGltYXRlVmVyc2lvbigpOw0KICAgICAgICAgICAgaWYoJHZlciA+ICR0aGlzLT5nZXRWZXJzaW9uKCkpIHsNCiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0VmVyc2lvbigkdmVyKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZm9yKDs7KSB7DQogICAgICAgICAgICAgICAgJGJpdHMgPSAkdGhpcy0+Y3JlYXRlQml0U3RyZWFtKCk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoJGJpdHMgPCAwKSANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkdmVyID0gUVJzcGVjOjpnZXRNaW5pbXVtVmVyc2lvbigoaW50KSgoJGJpdHMgKyA3KSAvIDgpLCAkdGhpcy0+bGV2ZWwpOw0KICAgICAgICAgICAgICAgIGlmKCR2ZXIgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ1dST05HIFZFUlNJT04nKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZigkdmVyID4gJHRoaXMtPmdldFZlcnNpb24oKSkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2V0VmVyc2lvbigkdmVyKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGFwcGVuZFBhZGRpbmdCaXQoJiRic3RyZWFtKQ0KICAgICAgICB7DQogICAgICAgICAgICAkYml0cyA9ICRic3RyZWFtLT5zaXplKCk7DQogICAgICAgICAgICAkbWF4d29yZHMgPSBRUnNwZWM6OmdldERhdGFMZW5ndGgoJHRoaXMtPnZlcnNpb24sICR0aGlzLT5sZXZlbCk7DQogICAgICAgICAgICAkbWF4Yml0cyA9ICRtYXh3b3JkcyAqIDg7DQoNCiAgICAgICAgICAgIGlmICgkbWF4Yml0cyA9PSAkYml0cykgew0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoJG1heGJpdHMgLSAkYml0cyA8IDUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gJGJzdHJlYW0tPmFwcGVuZE51bSgkbWF4Yml0cyAtICRiaXRzLCAwKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGJpdHMgKz0gNDsNCiAgICAgICAgICAgICR3b3JkcyA9IChpbnQpKCgkYml0cyArIDcpIC8gOCk7DQoNCiAgICAgICAgICAgICRwYWRkaW5nID0gbmV3IFFSYml0c3RyZWFtKCk7DQogICAgICAgICAgICAkcmV0ID0gJHBhZGRpbmctPmFwcGVuZE51bSgkd29yZHMgKiA4IC0gJGJpdHMgKyA0LCAwKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoJHJldCA8IDApIA0KICAgICAgICAgICAgICAgIHJldHVybiAkcmV0Ow0KDQogICAgICAgICAgICAkcGFkbGVuID0gJG1heHdvcmRzIC0gJHdvcmRzOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZigkcGFkbGVuID4gMCkgew0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRwYWRidWYgPSBhcnJheSgpOw0KICAgICAgICAgICAgICAgIGZvcigkaT0wOyAkaTwkcGFkbGVuOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICRwYWRidWZbJGldID0gKCRpJjEpPzB4MTE6MHhlYzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgJHJldCA9ICRwYWRkaW5nLT5hcHBlbmRCeXRlcygkcGFkbGVuLCAkcGFkYnVmKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZigkcmV0IDwgMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRyZXQ7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRyZXQgPSAkYnN0cmVhbS0+YXBwZW5kKCRwYWRkaW5nKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICRyZXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIG1lcmdlQml0U3RyZWFtKCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYoJHRoaXMtPmNvbnZlcnREYXRhKCkgPCAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRic3RyZWFtID0gbmV3IFFSYml0c3RyZWFtKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvcmVhY2goJHRoaXMtPml0ZW1zIGFzICRpdGVtKSB7DQogICAgICAgICAgICAgICAgJHJldCA9ICRic3RyZWFtLT5hcHBlbmQoJGl0ZW0tPmJzdHJlYW0pOw0KICAgICAgICAgICAgICAgIGlmKCRyZXQgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuICRic3RyZWFtOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCaXRTdHJlYW0oKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgICRic3RyZWFtID0gJHRoaXMtPm1lcmdlQml0U3RyZWFtKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCRic3RyZWFtID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHJldCA9ICR0aGlzLT5hcHBlbmRQYWRkaW5nQml0KCRic3RyZWFtKTsNCiAgICAgICAgICAgIGlmKCRyZXQgPCAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAkYnN0cmVhbTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCeXRlU3RyZWFtKCkNCiAgICAgICAgew0KICAgICAgICAgICAgJGJzdHJlYW0gPSAkdGhpcy0+Z2V0Qml0U3RyZWFtKCk7DQogICAgICAgICAgICBpZigkYnN0cmVhbSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkYnN0cmVhbS0+dG9CeXRlKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgICAgIA0KICAgICAgICANCiAgICAKCgoKLy8tLS0tIHFyYml0c3RyZWFtLnBocCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCgoNCi8qDQogKiBQSFAgUVIgQ29kZSBlbmNvZGVyDQogKg0KICogQml0c3RyZWFtIGNsYXNzDQogKg0KICogQmFzZWQgb24gbGlicXJlbmNvZGUgQyBsaWJyYXJ5IGRpc3RyaWJ1dGVkIHVuZGVyIExHUEwgMi4xDQogKiBDb3B5cmlnaHQgKEMpIDIwMDYsIDIwMDcsIDIwMDgsIDIwMDkgS2VudGFybyBGdWt1Y2hpIDxmdWt1Y2hpQG1lZ2F1aS5uZXQ+DQogKg0KICogUEhQIFFSIENvZGUgaXMgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAzDQogKiBDb3B5cmlnaHQgKEMpIDIwMTAgRG9taW5payBEemllbmlhIDxkZWx0YWxhYiBhdCBwb2N6dGEgZG90IGZtPg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3INCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcg0KICogdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi4NCiAqDQogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VDQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KICoNCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUNCiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQQ0KICovDQogICAgIA0KICAgIGNsYXNzIFFSYml0c3RyZWFtIHsNCiAgICANCiAgICAgICAgcHVibGljICRkYXRhID0gYXJyYXkoKTsNCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gc2l6ZSgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBjb3VudCgkdGhpcy0+ZGF0YSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gYWxsb2NhdGUoJHNldExlbmd0aCkNCiAgICAgICAgew0KICAgICAgICAgICAgJHRoaXMtPmRhdGEgPSBhcnJheV9maWxsKDAsICRzZXRMZW5ndGgsIDApOw0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbmV3RnJvbU51bSgkYml0cywgJG51bSkNCiAgICAgICAgew0KICAgICAgICAgICAgJGJzdHJlYW0gPSBuZXcgUVJiaXRzdHJlYW0oKTsNCiAgICAgICAgICAgICRic3RyZWFtLT5hbGxvY2F0ZSgkYml0cyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICRtYXNrID0gMSA8PCAoJGJpdHMgLSAxKTsNCiAgICAgICAgICAgIGZvcigkaT0wOyAkaTwkYml0czsgJGkrKykgew0KICAgICAgICAgICAgICAgIGlmKCRudW0gJiAkbWFzaykgew0KICAgICAgICAgICAgICAgICAgICAkYnN0cmVhbS0+ZGF0YVskaV0gPSAxOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRic3RyZWFtLT5kYXRhWyRpXSA9IDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRtYXNrID0gJG1hc2sgPj4gMTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuICRic3RyZWFtOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBuZXdGcm9tQnl0ZXMoJHNpemUsICRkYXRhKQ0KICAgICAgICB7DQogICAgICAgICAgICAkYnN0cmVhbSA9IG5ldyBRUmJpdHN0cmVhbSgpOw0KICAgICAgICAgICAgJGJzdHJlYW0tPmFsbG9jYXRlKCRzaXplICogOCk7DQogICAgICAgICAgICAkcD0wOw0KDQogICAgICAgICAgICBmb3IoJGk9MDsgJGk8JHNpemU7ICRpKyspIHsNCiAgICAgICAgICAgICAgICAkbWFzayA9IDB4ODA7DQogICAgICAgICAgICAgICAgZm9yKCRqPTA7ICRqPDg7ICRqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYoJGRhdGFbJGldICYgJG1hc2spIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRic3RyZWFtLT5kYXRhWyRwXSA9IDE7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYnN0cmVhbS0+ZGF0YVskcF0gPSAwOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRwKys7DQogICAgICAgICAgICAgICAgICAgICRtYXNrID0gJG1hc2sgPj4gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAkYnN0cmVhbTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBhcHBlbmQoUVJiaXRzdHJlYW0gJGFyZykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKGlzX251bGwoJGFyZykpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCRhcmctPnNpemUoKSA9PSAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCR0aGlzLT5zaXplKCkgPT0gMCkgew0KICAgICAgICAgICAgICAgICR0aGlzLT5kYXRhID0gJGFyZy0+ZGF0YTsNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHRoaXMtPmRhdGEgPSBhcnJheV92YWx1ZXMoYXJyYXlfbWVyZ2UoJHRoaXMtPmRhdGEsICRhcmctPmRhdGEpKTsNCg0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gYXBwZW5kTnVtKCRiaXRzLCAkbnVtKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoJGJpdHMgPT0gMCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQoNCiAgICAgICAgICAgICRiID0gUVJiaXRzdHJlYW06Om5ld0Zyb21OdW0oJGJpdHMsICRudW0pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZihpc19udWxsKCRiKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQoNCiAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+YXBwZW5kKCRiKTsNCiAgICAgICAgICAgIHVuc2V0KCRiKTsNCg0KICAgICAgICAgICAgcmV0dXJuICRyZXQ7DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGFwcGVuZEJ5dGVzKCRzaXplLCAkZGF0YSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCRzaXplID09IDApIA0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KDQogICAgICAgICAgICAkYiA9IFFSYml0c3RyZWFtOjpuZXdGcm9tQnl0ZXMoJHNpemUsICRkYXRhKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoaXNfbnVsbCgkYikpDQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KDQogICAgICAgICAgICAkcmV0ID0gJHRoaXMtPmFwcGVuZCgkYik7DQogICAgICAgICAgICB1bnNldCgkYik7DQoNCiAgICAgICAgICAgIHJldHVybiAkcmV0Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIHRvQnl0ZSgpDQogICAgICAgIHsNCiAgICAgICAgDQogICAgICAgICAgICAkc2l6ZSA9ICR0aGlzLT5zaXplKCk7DQoNCiAgICAgICAgICAgIGlmKCRzaXplID09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXkoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJGRhdGEgPSBhcnJheV9maWxsKDAsIChpbnQpKCgkc2l6ZSArIDcpIC8gOCksIDApOw0KICAgICAgICAgICAgJGJ5dGVzID0gKGludCkoJHNpemUgLyA4KTsNCg0KICAgICAgICAgICAgJHAgPSAwOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IoJGk9MDsgJGk8JGJ5dGVzOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgJHYgPSAwOw0KICAgICAgICAgICAgICAgIGZvcigkaj0wOyAkajw4OyAkaisrKSB7DQogICAgICAgICAgICAgICAgICAgICR2ID0gJHYgPDwgMTsNCiAgICAgICAgICAgICAgICAgICAgJHYgfD0gJHRoaXMtPmRhdGFbJHBdOw0KICAgICAgICAgICAgICAgICAgICAkcCsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkZGF0YVskaV0gPSAkdjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoJHNpemUgJiA3KSB7DQogICAgICAgICAgICAgICAgJHYgPSAwOw0KICAgICAgICAgICAgICAgIGZvcigkaj0wOyAkajwoJHNpemUgJiA3KTsgJGorKykgew0KICAgICAgICAgICAgICAgICAgICAkdiA9ICR2IDw8IDE7DQogICAgICAgICAgICAgICAgICAgICR2IHw9ICR0aGlzLT5kYXRhWyRwXTsNCiAgICAgICAgICAgICAgICAgICAgJHArKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJGRhdGFbJGJ5dGVzXSA9ICR2Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gJGRhdGE7DQogICAgICAgIH0NCg0KICAgIH0NCgoKCgovLy0tLS0gcXJzcGxpdC5waHAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKDQovKg0KICogUEhQIFFSIENvZGUgZW5jb2Rlcg0KICoNCiAqIElucHV0IHNwbGl0dGluZyBjbGFzc2VzDQogKg0KICogQmFzZWQgb24gbGlicXJlbmNvZGUgQyBsaWJyYXJ5IGRpc3RyaWJ1dGVkIHVuZGVyIExHUEwgMi4xDQogKiBDb3B5cmlnaHQgKEMpIDIwMDYsIDIwMDcsIDIwMDgsIDIwMDkgS2VudGFybyBGdWt1Y2hpIDxmdWt1Y2hpQG1lZ2F1aS5uZXQ+DQogKg0KICogUEhQIFFSIENvZGUgaXMgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAzDQogKiBDb3B5cmlnaHQgKEMpIDIwMTAgRG9taW5payBEemllbmlhIDxkZWx0YWxhYiBhdCBwb2N6dGEgZG90IGZtPg0KICoNCiAqIFRoZSBmb2xsb3dpbmcgZGF0YSAvIHNwZWNpZmljYXRpb25zIGFyZSB0YWtlbiBmcm9tDQogKiAiVHdvIGRpbWVuc2lvbmFsIHN5bWJvbCAtLSBRUi1jb2RlIC0tIEJhc2ljIFNwZWNpZmljYXRpb24iIChKSVMgWDA1MTA6MjAwNCkNCiAqICBvcg0KICogIkF1dG9tYXRpYyBpZGVudGlmaWNhdGlvbiBhbmQgZGF0YSBjYXB0dXJlIHRlY2huaXF1ZXMgLS0gDQogKiAgUVIgQ29kZSAyMDA1IGJhciBjb2RlIHN5bWJvbG9neSBzcGVjaWZpY2F0aW9uIiAoSVNPL0lFQyAxODAwNDoyMDA2KQ0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3INCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcg0KICogdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvciBhbnkgbGF0ZXIgdmVyc2lvbi4NCiAqDQogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwNCiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUgR05VDQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLg0KICoNCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMNCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUNCiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQQ0KICovDQogICAgY2xhc3MgUVJzcGxpdCB7DQoNCiAgICAgICAgcHVibGljICRkYXRhU3RyID0gJyc7DQogICAgICAgIHB1YmxpYyAkaW5wdXQ7DQogICAgICAgIHB1YmxpYyAkbW9kZUhpbnQ7DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkZGF0YVN0ciwgJGlucHV0LCAkbW9kZUhpbnQpIA0KICAgICAgICB7DQogICAgICAgICAgICAkdGhpcy0+ZGF0YVN0ciAgPSAkZGF0YVN0cjsNCiAgICAgICAgICAgICR0aGlzLT5pbnB1dCAgICA9ICRpbnB1dDsNCiAgICAgICAgICAgICR0aGlzLT5tb2RlSGludCA9ICRtb2RlSGludDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gaXNkaWdpdGF0KCRzdHIsICRwb3MpDQogICAgICAgIHsgICAgDQogICAgICAgICAgICBpZiAoJHBvcyA+PSBzdHJsZW4oJHN0cikpDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gKChvcmQoJHN0clskcG9zXSkgPj0gb3JkKCcwJykpJiYob3JkKCRzdHJbJHBvc10pIDw9IG9yZCgnOScpKSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGlzYWxudW1hdCgkc3RyLCAkcG9zKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoJHBvcyA+PSBzdHJsZW4oJHN0cikpDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIChRUmlucHV0Ojpsb29rQW5UYWJsZShvcmQoJHN0clskcG9zXSkpID49IDApOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBpZGVudGlmeU1vZGUoJHBvcykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCRwb3MgPj0gc3RybGVuKCR0aGlzLT5kYXRhU3RyKSkgDQogICAgICAgICAgICAgICAgcmV0dXJuIFFSX01PREVfTlVMOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgJGMgPSAkdGhpcy0+ZGF0YVN0clskcG9zXTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoc2VsZjo6aXNkaWdpdGF0KCR0aGlzLT5kYXRhU3RyLCAkcG9zKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBRUl9NT0RFX05VTTsNCiAgICAgICAgICAgIH0gZWxzZSBpZihzZWxmOjppc2FsbnVtYXQoJHRoaXMtPmRhdGFTdHIsICRwb3MpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFFSX01PREVfQU47DQogICAgICAgICAgICB9IGVsc2UgaWYoJHRoaXMtPm1vZGVIaW50ID09IFFSX01PREVfS0FOSkkpIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICgkcG9zKzEgPCBzdHJsZW4oJHRoaXMtPmRhdGFTdHIpKSANCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICRkID0gJHRoaXMtPmRhdGFTdHJbJHBvcysxXTsNCiAgICAgICAgICAgICAgICAgICAgJHdvcmQgPSAob3JkKCRjKSA8PCA4KSB8IG9yZCgkZCk7DQogICAgICAgICAgICAgICAgICAgIGlmKCgkd29yZCA+PSAweDgxNDAgJiYgJHdvcmQgPD0gMHg5ZmZjKSB8fCAoJHdvcmQgPj0gMHhlMDQwICYmICR3b3JkIDw9IDB4ZWJiZikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBRUl9NT0RFX0tBTkpJOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gUVJfTU9ERV84Ow0KICAgICAgICB9IA0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlYXROdW0oKQ0KICAgICAgICB7DQogICAgICAgICAgICAkbG4gPSBRUnNwZWM6Omxlbmd0aEluZGljYXRvcihRUl9NT0RFX05VTSwgJHRoaXMtPmlucHV0LT5nZXRWZXJzaW9uKCkpOw0KDQogICAgICAgICAgICAkcCA9IDA7DQogICAgICAgICAgICB3aGlsZShzZWxmOjppc2RpZ2l0YXQoJHRoaXMtPmRhdGFTdHIsICRwKSkgew0KICAgICAgICAgICAgICAgICRwKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICRydW4gPSAkcDsNCiAgICAgICAgICAgICRtb2RlID0gJHRoaXMtPmlkZW50aWZ5TW9kZSgkcCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCRtb2RlID09IFFSX01PREVfOCkgew0KICAgICAgICAgICAgICAgICRkaWYgPSBRUmlucHV0Ojplc3RpbWF0ZUJpdHNNb2RlTnVtKCRydW4pICsgNCArICRsbg0KICAgICAgICAgICAgICAgICAgICAgKyBRUmlucHV0Ojplc3RpbWF0ZUJpdHNNb2RlOCgxKSAgICAgICAgIC8vICsgNCArIGw4DQogICAgICAgICAgICAgICAgICAgICAtIFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGU4KCRydW4gKyAxKTsgLy8gLSA0IC0gbDgNCiAgICAgICAgICAgICAgICBpZigkZGlmID4gMCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmVhdDgoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZigkbW9kZSA9PSBRUl9NT0RFX0FOKSB7DQogICAgICAgICAgICAgICAgJGRpZiA9IFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGVOdW0oJHJ1bikgKyA0ICsgJGxuDQogICAgICAgICAgICAgICAgICAgICArIFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGVBbigxKSAgICAgICAgLy8gKyA0ICsgbGENCiAgICAgICAgICAgICAgICAgICAgIC0gUVJpbnB1dDo6ZXN0aW1hdGVCaXRzTW9kZUFuKCRydW4gKyAxKTsvLyAtIDQgLSBsYQ0KICAgICAgICAgICAgICAgIGlmKCRkaWYgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZWF0QW4oKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+aW5wdXQtPmFwcGVuZChRUl9NT0RFX05VTSwgJHJ1biwgc3RyX3NwbGl0KCR0aGlzLT5kYXRhU3RyKSk7DQogICAgICAgICAgICBpZigkcmV0IDwgMCkNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQoNCiAgICAgICAgICAgIHJldHVybiAkcnVuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGVhdEFuKCkNCiAgICAgICAgew0KICAgICAgICAgICAgJGxhID0gUVJzcGVjOjpsZW5ndGhJbmRpY2F0b3IoUVJfTU9ERV9BTiwgICR0aGlzLT5pbnB1dC0+Z2V0VmVyc2lvbigpKTsNCiAgICAgICAgICAgICRsbiA9IFFSc3BlYzo6bGVuZ3RoSW5kaWNhdG9yKFFSX01PREVfTlVNLCAkdGhpcy0+aW5wdXQtPmdldFZlcnNpb24oKSk7DQoNCiAgICAgICAgICAgICRwID0gMDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgd2hpbGUoc2VsZjo6aXNhbG51bWF0KCR0aGlzLT5kYXRhU3RyLCAkcCkpIHsNCiAgICAgICAgICAgICAgICBpZihzZWxmOjppc2RpZ2l0YXQoJHRoaXMtPmRhdGFTdHIsICRwKSkgew0KICAgICAgICAgICAgICAgICAgICAkcSA9ICRwOw0KICAgICAgICAgICAgICAgICAgICB3aGlsZShzZWxmOjppc2RpZ2l0YXQoJHRoaXMtPmRhdGFTdHIsICRxKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJHErKzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgJGRpZiA9IFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGVBbigkcCkgLy8gKyA0ICsgbGENCiAgICAgICAgICAgICAgICAgICAgICAgICArIFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGVOdW0oJHEgLSAkcCkgKyA0ICsgJGxuDQogICAgICAgICAgICAgICAgICAgICAgICAgLSBRUmlucHV0Ojplc3RpbWF0ZUJpdHNNb2RlQW4oJHEpOyAvLyAtIDQgLSBsYQ0KICAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZigkZGlmIDwgMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkcCA9ICRxOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHArKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRydW4gPSAkcDsNCg0KICAgICAgICAgICAgaWYoIXNlbGY6OmlzYWxudW1hdCgkdGhpcy0+ZGF0YVN0ciwgJHApKSB7DQogICAgICAgICAgICAgICAgJGRpZiA9IFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGVBbigkcnVuKSArIDQgKyAkbGENCiAgICAgICAgICAgICAgICAgICAgICsgUVJpbnB1dDo6ZXN0aW1hdGVCaXRzTW9kZTgoMSkgLy8gKyA0ICsgbDgNCiAgICAgICAgICAgICAgICAgICAgICAtIFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGU4KCRydW4gKyAxKTsgLy8gLSA0IC0gbDgNCiAgICAgICAgICAgICAgICBpZigkZGlmID4gMCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmVhdDgoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+aW5wdXQtPmFwcGVuZChRUl9NT0RFX0FOLCAkcnVuLCBzdHJfc3BsaXQoJHRoaXMtPmRhdGFTdHIpKTsNCiAgICAgICAgICAgIGlmKCRyZXQgPCAwKQ0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCg0KICAgICAgICAgICAgcmV0dXJuICRydW47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZWF0S2FuamkoKQ0KICAgICAgICB7DQogICAgICAgICAgICAkcCA9IDA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHdoaWxlKCR0aGlzLT5pZGVudGlmeU1vZGUoJHApID09IFFSX01PREVfS0FOSkkpIHsNCiAgICAgICAgICAgICAgICAkcCArPSAyOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAkcmV0ID0gJHRoaXMtPmlucHV0LT5hcHBlbmQoUVJfTU9ERV9LQU5KSSwgJHAsIHN0cl9zcGxpdCgkdGhpcy0+ZGF0YVN0cikpOw0KICAgICAgICAgICAgaWYoJHJldCA8IDApDQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KDQogICAgICAgICAgICByZXR1cm4gJHJ1bjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZWF0OCgpDQogICAgICAgIHsNCiAgICAgICAgICAgICRsYSA9IFFSc3BlYzo6bGVuZ3RoSW5kaWNhdG9yKFFSX01PREVfQU4sICR0aGlzLT5pbnB1dC0+Z2V0VmVyc2lvbigpKTsNCiAgICAgICAgICAgICRsbiA9IFFSc3BlYzo6bGVuZ3RoSW5kaWNhdG9yKFFSX01PREVfTlVNLCAkdGhpcy0+aW5wdXQtPmdldFZlcnNpb24oKSk7DQoNCiAgICAgICAgICAgICRwID0gMTsNCiAgICAgICAgICAgICRkYXRhU3RyTGVuID0gc3RybGVuKCR0aGlzLT5kYXRhU3RyKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgd2hpbGUoJHAgPCAkZGF0YVN0ckxlbikgew0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRtb2RlID0gJHRoaXMtPmlkZW50aWZ5TW9kZSgkcCk7DQogICAgICAgICAgICAgICAgaWYoJG1vZGUgPT0gUVJfTU9ERV9LQU5KSSkgew0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoJG1vZGUgPT0gUVJfTU9ERV9OVU0pIHsNCiAgICAgICAgICAgICAgICAgICAgJHEgPSAkcDsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc2VsZjo6aXNkaWdpdGF0KCR0aGlzLT5kYXRhU3RyLCAkcSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRxKys7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJGRpZiA9IFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGU4KCRwKSAvLyArIDQgKyBsOA0KICAgICAgICAgICAgICAgICAgICAgICAgICsgUVJpbnB1dDo6ZXN0aW1hdGVCaXRzTW9kZU51bSgkcSAtICRwKSArIDQgKyAkbG4NCiAgICAgICAgICAgICAgICAgICAgICAgICAtIFFSaW5wdXQ6OmVzdGltYXRlQml0c01vZGU4KCRxKTsgLy8gLSA0IC0gbDgNCiAgICAgICAgICAgICAgICAgICAgaWYoJGRpZiA8IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJHAgPSAkcTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZigkbW9kZSA9PSBRUl9NT0RFX0FOKSB7DQogICAgICAgICAgICAgICAgICAgICRxID0gJHA7DQogICAgICAgICAgICAgICAgICAgIHdoaWxlKHNlbGY6OmlzYWxudW1hdCgkdGhpcy0+ZGF0YVN0ciwgJHEpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkcSsrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRkaWYgPSBRUmlucHV0Ojplc3RpbWF0ZUJpdHNNb2RlOCgkcCkgIC8vICsgNCArIGw4DQogICAgICAgICAgICAgICAgICAgICAgICAgKyBRUmlucHV0Ojplc3RpbWF0ZUJpdHNNb2RlQW4oJHEgLSAkcCkgKyA0ICsgJGxhDQogICAgICAgICAgICAgICAgICAgICAgICAgLSBRUmlucHV0Ojplc3RpbWF0ZUJpdHNNb2RlOCgkcSk7IC8vIC0gNCAtIGw4DQogICAgICAgICAgICAgICAgICAgIGlmKCRkaWYgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRwID0gJHE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkcCsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHJ1biA9ICRwOw0KICAgICAgICAgICAgJHJldCA9ICR0aGlzLT5pbnB1dC0+YXBwZW5kKFFSX01PREVfOCwgJHJ1biwgc3RyX3NwbGl0KCR0aGlzLT5kYXRhU3RyKSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCRyZXQgPCAwKQ0KICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCg0KICAgICAgICAgICAgcmV0dXJuICRydW47DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIHNwbGl0U3RyaW5nKCkNCiAgICAgICAgew0KICAgICAgICAgICAgd2hpbGUgKHN0cmxlbigkdGhpcy0+ZGF0YVN0cikgPiAwKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlmKCR0aGlzLT5kYXRhU3RyID09ICcnKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsNCg0KICAgICAgICAgICAgICAgICRtb2RlID0gJHRoaXMtPmlkZW50aWZ5TW9kZSgwKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRtb2RlKSB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgUVJfTU9ERV9OVU06ICRsZW5ndGggPSAkdGhpcy0+ZWF0TnVtKCk7IGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFFSX01PREVfQU46ICAkbGVuZ3RoID0gJHRoaXMtPmVhdEFuKCk7IGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIFFSX01PREVfS0FOSkk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGhpbnQgPT0gUVJfTU9ERV9LQU5KSSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbmd0aCA9ICR0aGlzLT5lYXRLYW5qaSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAkbGVuZ3RoID0gJHRoaXMtPmVhdDgoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiAkbGVuZ3RoID0gJHRoaXMtPmVhdDgoKTsgYnJlYWs7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYoJGxlbmd0aCA9PSAwKSByZXR1cm4gMDsNCiAgICAgICAgICAgICAgICBpZigkbGVuZ3RoIDwgMCkgIHJldHVybiAtMTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkdGhpcy0+ZGF0YVN0ciA9IHN1YnN0cigkdGhpcy0+ZGF0YVN0ciwgJGxlbmd0aCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIHRvVXBwZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICAkc3RyaW5nTGVuID0gc3RybGVuKCR0aGlzLT5kYXRhU3RyKTsNCiAgICAgICAgICAgICRwID0gMDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgd2hpbGUgKCRwPCRzdHJpbmdMZW4pIHsNCiAgICAgICAgICAgICAgICAkbW9kZSA9IHNlbGY6OmlkZW50aWZ5TW9kZShzdWJzdHIoJHRoaXMtPmRhdGFTdHIsICRwKSwgJHRoaXMtPm1vZGVIaW50KTsNCiAgICAgICAgICAgICAgICBpZigkbW9kZSA9PSBRUl9NT0RFX0tBTkpJKSB7DQogICAgICAgICAgICAgICAgICAgICRwICs9IDI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9yZCgkdGhpcy0+ZGF0YVN0clskcF0pID49IG9yZCgnYScpICYmIG9yZCgkdGhpcy0+ZGF0YVN0clskcF0pIDw9IG9yZCgneicpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZGF0YVN0clskcF0gPSBjaHIob3JkKCR0aGlzLT5kYXRhU3RyWyRwXSkgLSAzMik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgJHArKzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZGF0YVN0cjsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHNwbGl0U3RyaW5nVG9RUmlucHV0KCRzdHJpbmcsIFFSaW5wdXQgJGlucHV0LCAkbW9kZUhpbnQsICRjYXNlc2Vuc2l0aXZlID0gdHJ1ZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYoaXNfbnVsbCgkc3RyaW5nKSB8fCAkc3RyaW5nID09ICdcMCcgfHwgJHN0cmluZyA9PSAnJykgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ2VtcHR5IHN0cmluZyEhIScpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkc3BsaXQgPSBuZXcgUVJzcGxpdCgkc3RyaW5nLCAkaW5wdXQsICRtb2RlSGludCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmKCEkY2FzZXNlbnNpdGl2ZSkNCiAgICAgICAgICAgICAgICAkc3BsaXQtPnRvVXBwZXIoKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkc3BsaXQtPnNwbGl0U3RyaW5nKCk7DQogICAgICAgIH0NCiAgICB9CgoKCi8vLS0tLSBxcnJzY29kZS5waHAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKDQovKg0KICogUEhQIFFSIENvZGUgZW5jb2Rlcg0KICoNCiAqIFJlZWQtU29sb21vbiBlcnJvciBjb3JyZWN0aW9uIHN1cHBvcnQNCiAqIA0KICogQ29weXJpZ2h0IChDKSAyMDAyLCAyMDAzLCAyMDA0LCAyMDA2IFBoaWwgS2FybiwgS0E5UQ0KICogKGxpYmZlYyBpcyByZWxlYXNlZCB1bmRlciB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlLikNCiAqDQogKiBCYXNlZCBvbiBsaWJxcmVuY29kZSBDIGxpYnJhcnkgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAyLjENCiAqIENvcHlyaWdodCAoQykgMjAwNiwgMjAwNywgMjAwOCwgMjAwOSBLZW50YXJvIEZ1a3VjaGkgPGZ1a3VjaGlAbWVnYXVpLm5ldD4NCiAqDQogKiBQSFAgUVIgQ29kZSBpcyBkaXN0cmlidXRlZCB1bmRlciBMR1BMIDMNCiAqIENvcHlyaWdodCAoQykgMjAxMCBEb21pbmlrIER6aWVuaWEgPGRlbHRhbGFiIGF0IHBvY3p0YSBkb3QgZm0+DQogKg0KICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcg0KICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyDQogKiB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUNCiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQogKg0KICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQ0KICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBDQogKi8NCiANCiAgICBjbGFzcyBRUnJzSXRlbSB7DQogICAgDQogICAgICAgIHB1YmxpYyAkbW07ICAgICAgICAgICAgICAgICAgLy8gQml0cyBwZXIgc3ltYm9sIA0KICAgICAgICBwdWJsaWMgJG5uOyAgICAgICAgICAgICAgICAgIC8vIFN5bWJvbHMgcGVyIGJsb2NrICg9ICgxPDxtbSktMSkgDQogICAgICAgIHB1YmxpYyAkYWxwaGFfdG8gPSBhcnJheSgpOyAgLy8gbG9nIGxvb2t1cCB0YWJsZSANCiAgICAgICAgcHVibGljICRpbmRleF9vZiA9IGFycmF5KCk7ICAvLyBBbnRpbG9nIGxvb2t1cCB0YWJsZSANCiAgICAgICAgcHVibGljICRnZW5wb2x5ID0gYXJyYXkoKTsgICAvLyBHZW5lcmF0b3IgcG9seW5vbWlhbCANCiAgICAgICAgcHVibGljICRucm9vdHM7ICAgICAgICAgICAgICAvLyBOdW1iZXIgb2YgZ2VuZXJhdG9yIHJvb3RzID0gbnVtYmVyIG9mIHBhcml0eSBzeW1ib2xzIA0KICAgICAgICBwdWJsaWMgJGZjcjsgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGNvbnNlY3V0aXZlIHJvb3QsIGluZGV4IGZvcm0gDQogICAgICAgIHB1YmxpYyAkcHJpbTsgICAgICAgICAgICAgICAgLy8gUHJpbWl0aXZlIGVsZW1lbnQsIGluZGV4IGZvcm0gDQogICAgICAgIHB1YmxpYyAkaXByaW07ICAgICAgICAgICAgICAgLy8gcHJpbS10aCByb290IG9mIDEsIGluZGV4IGZvcm0gDQogICAgICAgIHB1YmxpYyAkcGFkOyAgICAgICAgICAgICAgICAgLy8gUGFkZGluZyBieXRlcyBpbiBzaG9ydGVuZWQgYmxvY2sgDQogICAgICAgIHB1YmxpYyAkZ2Zwb2x5Ow0KICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIG1vZG5uKCR4KQ0KICAgICAgICB7DQogICAgICAgICAgICB3aGlsZSAoJHggPj0gJHRoaXMtPm5uKSB7DQogICAgICAgICAgICAgICAgJHggLT0gJHRoaXMtPm5uOw0KICAgICAgICAgICAgICAgICR4ID0gKCR4ID4+ICR0aGlzLT5tbSkgKyAoJHggJiAkdGhpcy0+bm4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gJHg7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGluaXRfcnNfY2hhcigkc3ltc2l6ZSwgJGdmcG9seSwgJGZjciwgJHByaW0sICRucm9vdHMsICRwYWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIENvbW1vbiBjb2RlIGZvciBpbnRpYWxpemluZyBhIFJlZWQtU29sb21vbiBjb250cm9sIGJsb2NrIChjaGFyIG9yIGludCBzeW1ib2xzKQ0KICAgICAgICAgICAgLy8gQ29weXJpZ2h0IDIwMDQgUGhpbCBLYXJuLCBLQTlRDQogICAgICAgICAgICAvLyBNYXkgYmUgdXNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSAoTEdQTCkNCg0KICAgICAgICAgICAgJHJzID0gbnVsbDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQ2hlY2sgcGFyYW1ldGVyIHJhbmdlcw0KICAgICAgICAgICAgaWYoJHN5bXNpemUgPCAwIHx8ICRzeW1zaXplID4gOCkgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHJzOw0KICAgICAgICAgICAgaWYoJGZjciA8IDAgfHwgJGZjciA+PSAoMTw8JHN5bXNpemUpKSAgICAgICAgICAgICAgICByZXR1cm4gJHJzOw0KICAgICAgICAgICAgaWYoJHByaW0gPD0gMCB8fCAkcHJpbSA+PSAoMTw8JHN5bXNpemUpKSAgICAgICAgICAgICByZXR1cm4gJHJzOw0KICAgICAgICAgICAgaWYoJG5yb290cyA8IDAgfHwgJG5yb290cyA+PSAoMTw8JHN5bXNpemUpKSAgICAgICAgICByZXR1cm4gJHJzOyAvLyBDYW4ndCBoYXZlIG1vcmUgcm9vdHMgdGhhbiBzeW1ib2wgdmFsdWVzIQ0KICAgICAgICAgICAgaWYoJHBhZCA8IDAgfHwgJHBhZCA+PSAoKDE8PCRzeW1zaXplKSAtMSAtICRucm9vdHMpKSByZXR1cm4gJHJzOyAvLyBUb28gbXVjaCBwYWRkaW5nDQoNCiAgICAgICAgICAgICRycyA9IG5ldyBRUnJzSXRlbSgpOw0KICAgICAgICAgICAgJHJzLT5tbSA9ICRzeW1zaXplOw0KICAgICAgICAgICAgJHJzLT5ubiA9ICgxPDwkc3ltc2l6ZSktMTsNCiAgICAgICAgICAgICRycy0+cGFkID0gJHBhZDsNCg0KICAgICAgICAgICAgJHJzLT5hbHBoYV90byA9IGFycmF5X2ZpbGwoMCwgJHJzLT5ubisxLCAwKTsNCiAgICAgICAgICAgICRycy0+aW5kZXhfb2YgPSBhcnJheV9maWxsKDAsICRycy0+bm4rMSwgMCk7DQogICAgICAgICAgDQogICAgICAgICAgICAvLyBQSFAgc3R5bGUgbWFjcm8gcmVwbGFjZW1lbnQgOykNCiAgICAgICAgICAgICROTiA9JiAkcnMtPm5uOw0KICAgICAgICAgICAgJEEwID0mICROTjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gR2VuZXJhdGUgR2Fsb2lzIGZpZWxkIGxvb2t1cCB0YWJsZXMNCiAgICAgICAgICAgICRycy0+aW5kZXhfb2ZbMF0gPSAkQTA7IC8vIGxvZyh6ZXJvKSA9IC1pbmYNCiAgICAgICAgICAgICRycy0+YWxwaGFfdG9bJEEwXSA9IDA7IC8vIGFscGhhKiotaW5mID0gMA0KICAgICAgICAgICAgJHNyID0gMTsNCiAgICAgICAgICANCiAgICAgICAgICAgIGZvcigkaT0wOyAkaTwkcnMtPm5uOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgJHJzLT5pbmRleF9vZlskc3JdID0gJGk7DQogICAgICAgICAgICAgICAgJHJzLT5hbHBoYV90b1skaV0gPSAkc3I7DQogICAgICAgICAgICAgICAgJHNyIDw8PSAxOw0KICAgICAgICAgICAgICAgIGlmKCRzciAmICgxPDwkc3ltc2l6ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHNyIF49ICRnZnBvbHk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRzciAmPSAkcnMtPm5uOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZigkc3IgIT0gMSl7DQogICAgICAgICAgICAgICAgLy8gZmllbGQgZ2VuZXJhdG9yIHBvbHlub21pYWwgaXMgbm90IHByaW1pdGl2ZSENCiAgICAgICAgICAgICAgICAkcnMgPSBOVUxMOw0KICAgICAgICAgICAgICAgIHJldHVybiAkcnM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIEZvcm0gUlMgY29kZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBmcm9tIGl0cyByb290cyAqLw0KICAgICAgICAgICAgJHJzLT5nZW5wb2x5ID0gYXJyYXlfZmlsbCgwLCAkbnJvb3RzKzEsIDApOw0KICAgICAgICANCiAgICAgICAgICAgICRycy0+ZmNyID0gJGZjcjsNCiAgICAgICAgICAgICRycy0+cHJpbSA9ICRwcmltOw0KICAgICAgICAgICAgJHJzLT5ucm9vdHMgPSAkbnJvb3RzOw0KICAgICAgICAgICAgJHJzLT5nZnBvbHkgPSAkZ2Zwb2x5Ow0KDQogICAgICAgICAgICAvKiBGaW5kIHByaW0tdGggcm9vdCBvZiAxLCB1c2VkIGluIGRlY29kaW5nICovDQogICAgICAgICAgICBmb3IoJGlwcmltPTE7KCRpcHJpbSAlICRwcmltKSAhPSAwOyRpcHJpbSArPSAkcnMtPm5uKQ0KICAgICAgICAgICAgOyAvLyBpbnRlbnRpb25hbCBlbXB0eS1ib2R5IGxvb3AhDQogICAgICAgICAgICANCiAgICAgICAgICAgICRycy0+aXByaW0gPSAoaW50KSgkaXByaW0gLyAkcHJpbSk7DQogICAgICAgICAgICAkcnMtPmdlbnBvbHlbMF0gPSAxOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgKCRpID0gMCwkcm9vdD0kZmNyKiRwcmltOyAkaSA8ICRucm9vdHM7ICRpKyssICRyb290ICs9ICRwcmltKSB7DQogICAgICAgICAgICAgICAgJHJzLT5nZW5wb2x5WyRpKzFdID0gMTsNCg0KICAgICAgICAgICAgICAgIC8vIE11bHRpcGx5IHJzLT5nZW5wb2x5W10gYnkgIEAqKihyb290ICsgeCkNCiAgICAgICAgICAgICAgICBmb3IgKCRqID0gJGk7ICRqID4gMDsgJGotLSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJHJzLT5nZW5wb2x5WyRqXSAhPSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkcnMtPmdlbnBvbHlbJGpdID0gJHJzLT5nZW5wb2x5WyRqLTFdIF4gJHJzLT5hbHBoYV90b1skcnMtPm1vZG5uKCRycy0+aW5kZXhfb2ZbJHJzLT5nZW5wb2x5WyRqXV0gKyAkcm9vdCldOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJHJzLT5nZW5wb2x5WyRqXSA9ICRycy0+Z2VucG9seVskai0xXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBycy0+Z2VucG9seVswXSBjYW4gbmV2ZXIgYmUgemVybw0KICAgICAgICAgICAgICAgICRycy0+Z2VucG9seVswXSA9ICRycy0+YWxwaGFfdG9bJHJzLT5tb2RubigkcnMtPmluZGV4X29mWyRycy0+Z2VucG9seVswXV0gKyAkcm9vdCldOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBjb252ZXJ0IHJzLT5nZW5wb2x5W10gdG8gaW5kZXggZm9ybSBmb3IgcXVpY2tlciBlbmNvZGluZw0KICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDw9ICRucm9vdHM7ICRpKyspDQogICAgICAgICAgICAgICAgJHJzLT5nZW5wb2x5WyRpXSA9ICRycy0+aW5kZXhfb2ZbJHJzLT5nZW5wb2x5WyRpXV07DQoNCiAgICAgICAgICAgIHJldHVybiAkcnM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlX3JzX2NoYXIoJGRhdGEsICYkcGFyaXR5KQ0KICAgICAgICB7DQogICAgICAgICAgICAkTU0gICAgICAgPSYgJHRoaXMtPm1tOw0KICAgICAgICAgICAgJE5OICAgICAgID0mICR0aGlzLT5ubjsNCiAgICAgICAgICAgICRBTFBIQV9UTyA9JiAkdGhpcy0+YWxwaGFfdG87DQogICAgICAgICAgICAkSU5ERVhfT0YgPSYgJHRoaXMtPmluZGV4X29mOw0KICAgICAgICAgICAgJEdFTlBPTFkgID0mICR0aGlzLT5nZW5wb2x5Ow0KICAgICAgICAgICAgJE5ST09UUyAgID0mICR0aGlzLT5ucm9vdHM7DQogICAgICAgICAgICAkRkNSICAgICAgPSYgJHRoaXMtPmZjcjsNCiAgICAgICAgICAgICRQUklNICAgICA9JiAkdGhpcy0+cHJpbTsNCiAgICAgICAgICAgICRJUFJJTSAgICA9JiAkdGhpcy0+aXByaW07DQogICAgICAgICAgICAkUEFEICAgICAgPSYgJHRoaXMtPnBhZDsNCiAgICAgICAgICAgICRBMCAgICAgICA9JiAkTk47DQoNCiAgICAgICAgICAgICRwYXJpdHkgPSBhcnJheV9maWxsKDAsICROUk9PVFMsIDApOw0KDQogICAgICAgICAgICBmb3IoJGk9MDsgJGk8ICgkTk4tJE5ST09UUy0kUEFEKTsgJGkrKykgew0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRmZWVkYmFjayA9ICRJTkRFWF9PRlskZGF0YVskaV0gXiAkcGFyaXR5WzBdXTsNCiAgICAgICAgICAgICAgICBpZigkZmVlZGJhY2sgIT0gJEEwKSB7ICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIGZlZWRiYWNrIHRlcm0gaXMgbm9uLXplcm8NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGxpbmUgaXMgdW5uZWNlc3Nhcnkgd2hlbiBHRU5QT0xZW05ST09UU10gaXMgdW5pdHksIGFzIGl0IG11c3QNCiAgICAgICAgICAgICAgICAgICAgLy8gYWx3YXlzIGJlIGZvciB0aGUgcG9seW5vbWlhbHMgY29uc3RydWN0ZWQgYnkgaW5pdF9ycygpDQogICAgICAgICAgICAgICAgICAgICRmZWVkYmFjayA9ICR0aGlzLT5tb2RubigkTk4gLSAkR0VOUE9MWVskTlJPT1RTXSArICRmZWVkYmFjayk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yKCRqPTE7JGo8JE5ST09UUzskaisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkcGFyaXR5WyRqXSBePSAkQUxQSEFfVE9bJHRoaXMtPm1vZG5uKCRmZWVkYmFjayArICRHRU5QT0xZWyROUk9PVFMtJGpdKV07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU2hpZnQgDQogICAgICAgICAgICAgICAgYXJyYXlfc2hpZnQoJHBhcml0eSk7DQogICAgICAgICAgICAgICAgaWYoJGZlZWRiYWNrICE9ICRBMCkgew0KICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRwYXJpdHksICRBTFBIQV9UT1skdGhpcy0+bW9kbm4oJGZlZWRiYWNrICsgJEdFTlBPTFlbMF0pXSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcGFyaXR5LCAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KICAgIA0KICAgIGNsYXNzIFFScnMgew0KICAgIA0KICAgICAgICBwdWJsaWMgc3RhdGljICRpdGVtcyA9IGFycmF5KCk7DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBpbml0X3JzKCRzeW1zaXplLCAkZ2Zwb2x5LCAkZmNyLCAkcHJpbSwgJG5yb290cywgJHBhZCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaChzZWxmOjokaXRlbXMgYXMgJHJzKSB7DQogICAgICAgICAgICAgICAgaWYoJHJzLT5wYWQgIT0gJHBhZCkgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgaWYoJHJzLT5ucm9vdHMgIT0gJG5yb290cykgY29udGludWU7DQogICAgICAgICAgICAgICAgaWYoJHJzLT5tbSAhPSAkc3ltc2l6ZSkgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgaWYoJHJzLT5nZnBvbHkgIT0gJGdmcG9seSkgY29udGludWU7DQogICAgICAgICAgICAgICAgaWYoJHJzLT5mY3IgIT0gJGZjcikgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgaWYoJHJzLT5wcmltICE9ICRwcmltKSAgICAgY29udGludWU7DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gJHJzOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkcnMgPSBRUnJzSXRlbTo6aW5pdF9yc19jaGFyKCRzeW1zaXplLCAkZ2Zwb2x5LCAkZmNyLCAkcHJpbSwgJG5yb290cywgJHBhZCk7DQogICAgICAgICAgICBhcnJheV91bnNoaWZ0KHNlbGY6OiRpdGVtcywgJHJzKTsNCg0KICAgICAgICAgICAgcmV0dXJuICRyczsNCiAgICAgICAgfQ0KICAgIH0KCgoKLy8tLS0tIHFybWFzay5waHAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKDQovKg0KICogUEhQIFFSIENvZGUgZW5jb2Rlcg0KICoNCiAqIE1hc2tpbmcNCiAqDQogKiBCYXNlZCBvbiBsaWJxcmVuY29kZSBDIGxpYnJhcnkgZGlzdHJpYnV0ZWQgdW5kZXIgTEdQTCAyLjENCiAqIENvcHlyaWdodCAoQykgMjAwNiwgMjAwNywgMjAwOCwgMjAwOSBLZW50YXJvIEZ1a3VjaGkgPGZ1a3VjaGlAbWVnYXVpLm5ldD4NCiAqDQogKiBQSFAgUVIgQ29kZSBpcyBkaXN0cmlidXRlZCB1bmRlciBMR1BMIDMNCiAqIENvcHlyaWdodCAoQykgMjAxMCBEb21pbmlrIER6aWVuaWEgPGRlbHRhbGFiIGF0IHBvY3p0YSBkb3QgZm0+DQogKg0KICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcg0KICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyDQogKiB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yIGFueSBsYXRlciB2ZXJzaW9uLg0KICoNCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUNCiAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQogKg0KICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYw0KICogTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGlicmFyeTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQ0KICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3QsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BIDAyMTEwLTEzMDEgVVNBDQogKi8NCiANCglkZWZpbmUoJ04xJywgMyk7DQoJZGVmaW5lKCdOMicsIDMpOw0KCWRlZmluZSgnTjMnLCA0MCk7DQoJZGVmaW5lKCdONCcsIDEwKTsNCg0KCWNsYXNzIFFSbWFzayB7DQoJDQoJCXB1YmxpYyAkcnVuTGVuZ3RoID0gYXJyYXkoKTsNCgkJDQoJCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQlwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKSANCiAgICAgICAgew0KICAgICAgICAgICAgJHRoaXMtPnJ1bkxlbmd0aCA9IGFycmF5X2ZpbGwoMCwgUVJTUEVDX1dJRFRIX01BWCArIDEsIDApOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIHdyaXRlRm9ybWF0SW5mb3JtYXRpb24oJHdpZHRoLCAmJGZyYW1lLCAkbWFzaywgJGxldmVsKQ0KICAgICAgICB7DQogICAgICAgICAgICAkYmxhY2tzID0gMDsNCiAgICAgICAgICAgICRmb3JtYXQgPSAgUVJzcGVjOjpnZXRGb3JtYXRJbmZvKCRtYXNrLCAkbGV2ZWwpOw0KDQogICAgICAgICAgICBmb3IoJGk9MDsgJGk8ODsgJGkrKykgew0KICAgICAgICAgICAgICAgIGlmKCRmb3JtYXQgJiAxKSB7DQogICAgICAgICAgICAgICAgICAgICRibGFja3MgKz0gMjsNCiAgICAgICAgICAgICAgICAgICAgJHYgPSAweDg1Ow0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICR2ID0gMHg4NDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgJGZyYW1lWzhdWyR3aWR0aCAtIDEgLSAkaV0gPSBjaHIoJHYpOw0KICAgICAgICAgICAgICAgIGlmKCRpIDwgNikgew0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVbJGldWzhdID0gY2hyKCR2KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVbJGkgKyAxXVs4XSA9IGNocigkdik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRmb3JtYXQgPSAkZm9ybWF0ID4+IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvcigkaT0wOyAkaTw3OyAkaSsrKSB7DQogICAgICAgICAgICAgICAgaWYoJGZvcm1hdCAmIDEpIHsNCiAgICAgICAgICAgICAgICAgICAgJGJsYWNrcyArPSAyOw0KICAgICAgICAgICAgICAgICAgICAkdiA9IDB4ODU7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHYgPSAweDg0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAkZnJhbWVbJHdpZHRoIC0gNyArICRpXVs4XSA9IGNocigkdik7DQogICAgICAgICAgICAgICAgaWYoJGkgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVbOF1bN10gPSBjaHIoJHYpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRmcmFtZVs4XVs2IC0gJGldID0gY2hyKCR2KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgJGZvcm1hdCA9ICRmb3JtYXQgPj4gMTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuICRibGFja3M7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gbWFzazAoJHgsICR5KSB7IHJldHVybiAoJHgrJHkpJjE7ICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBtYXNrMSgkeCwgJHkpIHsgcmV0dXJuICgkeSYxKTsgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIG1hc2syKCR4LCAkeSkgeyByZXR1cm4gKCR4JTMpOyAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gbWFzazMoJHgsICR5KSB7IHJldHVybiAoJHgrJHkpJTM7ICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBtYXNrNCgkeCwgJHkpIHsgcmV0dXJuICgoKGludCkoJHkvMikpKygoaW50KSgkeC8zKSkpJjE7IH0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIG1hc2s1KCR4LCAkeSkgeyByZXR1cm4gKCgkeCokeSkmMSkrKCR4KiR5KSUzOyAgICAgICAgICAgfQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gbWFzazYoJHgsICR5KSB7IHJldHVybiAoKCgkeCokeSkmMSkrKCR4KiR5KSUzKSYxOyAgICAgICB9DQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBtYXNrNygkeCwgJHkpIHsgcmV0dXJuICgoKCR4KiR5KSUzKSsoKCR4KyR5KSYxKSkmMTsgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwcml2YXRlIGZ1bmN0aW9uIGdlbmVyYXRlTWFza05vKCRtYXNrTm8sICR3aWR0aCwgJGZyYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICAkYml0TWFzayA9IGFycmF5X2ZpbGwoMCwgJHdpZHRoLCBhcnJheV9maWxsKDAsICR3aWR0aCwgMCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IoJHk9MDsgJHk8JHdpZHRoOyAkeSsrKSB7DQogICAgICAgICAgICAgICAgZm9yKCR4PTA7ICR4PCR3aWR0aDsgJHgrKykgew0KICAgICAgICAgICAgICAgICAgICBpZihvcmQoJGZyYW1lWyR5XVskeF0pICYgMHg4MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGJpdE1hc2tbJHldWyR4XSA9IDA7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkbWFza0Z1bmMgPSBjYWxsX3VzZXJfZnVuYyhhcnJheSgkdGhpcywgJ21hc2snLiRtYXNrTm8pLCAkeCwgJHkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgJGJpdE1hc2tbJHldWyR4XSA9ICgkbWFza0Z1bmMgPT0gMCk\/MTowOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICRiaXRNYXNrOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBzZXJpYWwoJGJpdEZyYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICAkY29kZUFyciA9IGFycmF5KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGZvcmVhY2ggKCRiaXRGcmFtZSBhcyAkbGluZSkNCiAgICAgICAgICAgICAgICAkY29kZUFycltdID0gam9pbignJywgJGxpbmUpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIGd6Y29tcHJlc3Moam9pbigiXG4iLCAkY29kZUFyciksIDkpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiB1bnNlcmlhbCgkY29kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgJGNvZGVBcnIgPSBhcnJheSgpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAkY29kZUxpbmVzID0gZXhwbG9kZSgiXG4iLCBnenVuY29tcHJlc3MoJGNvZGUpKTsNCiAgICAgICAgICAgIGZvcmVhY2ggKCRjb2RlTGluZXMgYXMgJGxpbmUpDQogICAgICAgICAgICAgICAgJGNvZGVBcnJbXSA9IHN0cl9zcGxpdCgkbGluZSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkY29kZUFycjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBtYWtlTWFza05vKCRtYXNrTm8sICR3aWR0aCwgJHMsICYkZCwgJG1hc2tHZW5Pbmx5ID0gZmFsc2UpIA0KICAgICAgICB7DQogICAgICAgICAgICAkYiA9IDA7DQogICAgICAgICAgICAkYml0TWFzayA9IGFycmF5KCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICRmaWxlTmFtZSA9IFFSX0NBQ0hFX0RJUi4nbWFza18nLiRtYXNrTm8uRElSRUNUT1JZX1NFUEFSQVRPUi4nbWFza18nLiR3aWR0aC4nXycuJG1hc2tOby4nLmRhdCc7DQoNCiAgICAgICAgICAgIGlmIChRUl9DQUNIRUFCTEUpIHsNCiAgICAgICAgICAgICAgICBpZiAoZmlsZV9leGlzdHMoJGZpbGVOYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAkYml0TWFzayA9IHNlbGY6OnVuc2VyaWFsKGZpbGVfZ2V0X2NvbnRlbnRzKCRmaWxlTmFtZSkpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRiaXRNYXNrID0gJHRoaXMtPmdlbmVyYXRlTWFza05vKCRtYXNrTm8sICR3aWR0aCwgJHMsICRkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlX2V4aXN0cyhRUl9DQUNIRV9ESVIuJ21hc2tfJy4kbWFza05vKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIG1rZGlyKFFSX0NBQ0hFX0RJUi4nbWFza18nLiRtYXNrTm8pOw0KICAgICAgICAgICAgICAgICAgICBmaWxlX3B1dF9jb250ZW50cygkZmlsZU5hbWUsIHNlbGY6OnNlcmlhbCgkYml0TWFzaykpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGJpdE1hc2sgPSAkdGhpcy0+Z2VuZXJhdGVNYXNrTm8oJG1hc2tObywgJHdpZHRoLCAkcywgJGQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoJG1hc2tHZW5Pbmx5KQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICRkID0gJHM7DQoNCiAgICAgICAgICAgIGZvcigkeT0wOyAkeTwkd2lkdGg7ICR5KyspIHsNCiAgICAgICAgICAgICAgICBmb3IoJHg9MDsgJHg8JHdpZHRoOyAkeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmKCRiaXRNYXNrWyR5XVskeF0gPT0gMSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGRbJHldWyR4XSA9IGNocihvcmQoJHNbJHldWyR4XSkgXiAoaW50KSRiaXRNYXNrWyR5XVskeF0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICRiICs9IChpbnQpKG9yZCgkZFskeV1bJHhdKSAmIDEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuICRiOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIG1ha2VNYXNrKCR3aWR0aCwgJGZyYW1lLCAkbWFza05vLCAkbGV2ZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgICRtYXNrZWQgPSBhcnJheV9maWxsKDAsICR3aWR0aCwgc3RyX3JlcGVhdCgiXDAiLCAkd2lkdGgpKTsNCiAgICAgICAgICAgICR0aGlzLT5tYWtlTWFza05vKCRtYXNrTm8sICR3aWR0aCwgJGZyYW1lLCAkbWFza2VkKTsNCiAgICAgICAgICAgICR0aGlzLT53cml0ZUZvcm1hdEluZm9ybWF0aW9uKCR3aWR0aCwgJG1hc2tlZCwgJG1hc2tObywgJGxldmVsKTsNCiAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkbWFza2VkOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGNhbGNOMU4zKCRsZW5ndGgpDQogICAgICAgIHsNCiAgICAgICAgICAgICRkZW1lcml0ID0gMDsNCg0KICAgICAgICAgICAgZm9yKCRpPTA7ICRpPCRsZW5ndGg7ICRpKyspIHsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZigkdGhpcy0+cnVuTGVuZ3RoWyRpXSA+PSA1KSB7DQogICAgICAgICAgICAgICAgICAgICRkZW1lcml0ICs9IChOMSArICgkdGhpcy0+cnVuTGVuZ3RoWyRpXSAtIDUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoJGkgJiAxKSB7DQogICAgICAgICAgICAgICAgICAgIGlmKCgkaSA+PSAzKSAmJiAoJGkgPCAoJGxlbmd0aC0yKSkgJiYgKCR0aGlzLT5ydW5MZW5ndGhbJGldICUgMyA9PSAwKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJGZhY3QgPSAoaW50KSgkdGhpcy0+cnVuTGVuZ3RoWyRpXSAvIDMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoKCR0aGlzLT5ydW5MZW5ndGhbJGktMl0gPT0gJGZhY3QpICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAoJHRoaXMtPnJ1bkxlbmd0aFskaS0xXSA9PSAkZmFjdCkgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICgkdGhpcy0+cnVuTGVuZ3RoWyRpKzFdID09ICRmYWN0KSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgKCR0aGlzLT5ydW5MZW5ndGhbJGkrMl0gPT0gJGZhY3QpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKCR0aGlzLT5ydW5MZW5ndGhbJGktM10gPCAwKSB8fCAoJHRoaXMtPnJ1bkxlbmd0aFskaS0zXSA+PSAoNCAqICRmYWN0KSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlbWVyaXQgKz0gTjM7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCgoJGkrMykgPj0gJGxlbmd0aCkgfHwgKCR0aGlzLT5ydW5MZW5ndGhbJGkrM10gPj0gKDQgKiAkZmFjdCkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZW1lcml0ICs9IE4zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAkZGVtZXJpdDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBldmFsdWF0ZVN5bWJvbCgkd2lkdGgsICRmcmFtZSkNCiAgICAgICAgew0KICAgICAgICAgICAgJGhlYWQgPSAwOw0KICAgICAgICAgICAgJGRlbWVyaXQgPSAwOw0KDQogICAgICAgICAgICBmb3IoJHk9MDsgJHk8JHdpZHRoOyAkeSsrKSB7DQogICAgICAgICAgICAgICAgJGhlYWQgPSAwOw0KICAgICAgICAgICAgICAgICR0aGlzLT5ydW5MZW5ndGhbMF0gPSAxOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRmcmFtZVkgPSAkZnJhbWVbJHldOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICgkeT4wKQ0KICAgICAgICAgICAgICAgICAgICAkZnJhbWVZTSA9ICRmcmFtZVskeS0xXTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IoJHg9MDsgJHg8JHdpZHRoOyAkeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmKCgkeCA+IDApICYmICgkeSA+IDApKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkYjIyID0gb3JkKCRmcmFtZVlbJHhdKSAmIG9yZCgkZnJhbWVZWyR4LTFdKSAmIG9yZCgkZnJhbWVZTVskeF0pICYgb3JkKCRmcmFtZVlNWyR4LTFdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICR3MjIgPSBvcmQoJGZyYW1lWVskeF0pIHwgb3JkKCRmcmFtZVlbJHgtMV0pIHwgb3JkKCRmcmFtZVlNWyR4XSkgfCBvcmQoJGZyYW1lWU1bJHgtMV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZigoJGIyMiB8ICgkdzIyIF4gMSkpJjEpIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGVtZXJpdCArPSBOMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZigoJHggPT0gMCkgJiYgKG9yZCgkZnJhbWVZWyR4XSkgJiAxKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJ1bkxlbmd0aFswXSA9IC0xOw0KICAgICAgICAgICAgICAgICAgICAgICAgJGhlYWQgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJ1bkxlbmd0aFskaGVhZF0gPSAxOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoJHggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZigob3JkKCRmcmFtZVlbJHhdKSBeIG9yZCgkZnJhbWVZWyR4LTFdKSkgJiAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhlYWQrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cnVuTGVuZ3RoWyRoZWFkXSA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5ydW5MZW5ndGhbJGhlYWRdKys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICAgICAgJGRlbWVyaXQgKz0gJHRoaXMtPmNhbGNOMU4zKCRoZWFkKzEpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmb3IoJHg9MDsgJHg8JHdpZHRoOyAkeCsrKSB7DQogICAgICAgICAgICAgICAgJGhlYWQgPSAwOw0KICAgICAgICAgICAgICAgICR0aGlzLT5ydW5MZW5ndGhbMF0gPSAxOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvcigkeT0wOyAkeTwkd2lkdGg7ICR5KyspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYoJHkgPT0gMCAmJiAob3JkKCRmcmFtZVskeV1bJHhdKSAmIDEpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cnVuTGVuZ3RoWzBdID0gLTE7DQogICAgICAgICAgICAgICAgICAgICAgICAkaGVhZCA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cnVuTGVuZ3RoWyRoZWFkXSA9IDE7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZigkeSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKChvcmQoJGZyYW1lWyR5XVskeF0pIF4gb3JkKCRmcmFtZVskeS0xXVskeF0pKSAmIDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGVhZCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5ydW5MZW5ndGhbJGhlYWRdID0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnJ1bkxlbmd0aFskaGVhZF0rKzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRkZW1lcml0ICs9ICR0aGlzLT5jYWxjTjFOMygkaGVhZCsxKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuICRkZW1lcml0Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBtYXNrKCR3aWR0aCwgJGZyYW1lLCAkbGV2ZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgICRtaW5EZW1lcml0ID0gUEhQX0lOVF9NQVg7DQogICAgICAgICAgICAkYmVzdE1hc2tOdW0gPSAwOw0KICAgICAgICAgICAgJGJlc3RNYXNrID0gYXJyYXkoKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJGNoZWNrZWRfbWFza3MgPSBhcnJheSgwLDEsMiwzLDQsNSw2LDcpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoUVJfRklORF9GUk9NX1JBTkRPTSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRob3dNYW51T3V0ID0gOC0oUVJfRklORF9GUk9NX1JBTkRPTSAlIDkpOw0KICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICAkaG93TWFudU91dDsgJGkrKykgew0KICAgICAgICAgICAgICAgICAgICAkcmVtUG9zID0gcmFuZCAoMCwgY291bnQoJGNoZWNrZWRfbWFza3MpLTEpOw0KICAgICAgICAgICAgICAgICAgICB1bnNldCgkY2hlY2tlZF9tYXNrc1skcmVtUG9zXSk7DQogICAgICAgICAgICAgICAgICAgICRjaGVja2VkX21hc2tzID0gYXJyYXlfdmFsdWVzKCRjaGVja2VkX21hc2tzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJGJlc3RNYXNrID0gJGZyYW1lOw0KICAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yZWFjaCgkY2hlY2tlZF9tYXNrcyBhcyAkaSkgew0KICAgICAgICAgICAgICAgICRtYXNrID0gYXJyYXlfZmlsbCgwLCAkd2lkdGgsIHN0cl9yZXBlYXQoIlwwIiwgJHdpZHRoKSk7DQoNCiAgICAgICAgICAgICAgICAkZGVtZXJpdCA9IDA7DQogICAgICAgICAgICAgICAgJGJsYWNrcyA9IDA7DQogICAgICAgICAgICAgICAgJGJsYWNrcyAgPSAkdGhpcy0+bWFrZU1hc2tObygkaSwgJHdpZHRoLCAkZnJhbWUsICRtYXNrKTsNCiAgICAgICAgICAgICAgICAkYmxhY2tzICs9ICR0aGlzLT53cml0ZUZvcm1hdEluZm9ybWF0aW9uKCR3aWR0aCwgJG1hc2ssICRpLCAkbGV2ZWwpOw0KICAgICAgICAgICAgICAgICRibGFja3MgID0gKGludCkoMTAwICogJGJsYWNrcyAvICgkd2lkdGggKiAkd2lkdGgpKTsNCiAgICAgICAgICAgICAgICAkZGVtZXJpdCA9IChpbnQpKChpbnQpKGFicygkYmxhY2tzIC0gNTApIC8gNSkgKiBONCk7DQogICAgICAgICAgICAgICAgJGRlbWVyaXQgKz0gJHRoaXMtPmV2YWx1YXRlU3ltYm9sKCR3aWR0aCwgJG1hc2spOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKCRkZW1lcml0IDwgJG1pbkRlbWVyaXQpIHsNCiAgICAgICAgICAgICAgICAgICAgJG1pbkRlbWVyaXQgPSAkZGVtZXJpdDsNCiAgICAgICAgICAgICAgICAgICAgJGJlc3RNYXNrID0gJG1hc2s7DQogICAgICAgICAgICAgICAgICAgICRiZXN0TWFza051bSA9ICRpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICRiZXN0TWFzazsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgfQ0KCgoKCi8vLS0tLSBxcmVuY29kZS5waHAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKDQovKg0KICogUEhQIFFSIENvZGUgZW5jb2Rlcg0KICoNCiAqIE1haW4gZW5jb2RlciBjbGFzc2VzLg0KICoNCiAqIEJhc2VkIG9uIGxpYnFyZW5jb2RlIEMgbGlicmFyeSBkaXN0cmlidXRlZCB1bmRlciBMR1BMIDIuMQ0KICogQ29weXJpZ2h0IChDKSAyMDA2LCAyMDA3LCAyMDA4LCAyMDA5IEtlbnRhcm8gRnVrdWNoaSA8ZnVrdWNoaUBtZWdhdWkubmV0Pg0KICoNCiAqIFBIUCBRUiBDb2RlIGlzIGRpc3RyaWJ1dGVkIHVuZGVyIExHUEwgMw0KICogQ29weXJpZ2h0IChDKSAyMDEwIERvbWluaWsgRHppZW5pYSA8ZGVsdGFsYWIgYXQgcG9jenRhIGRvdCBmbT4NCiAqDQogKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yDQogKiBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljDQogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXINCiAqIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IgYW55IGxhdGVyIHZlcnNpb24uDQogKg0KICogVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZg0KICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVQ0KICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCiAqDQogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljDQogKiBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3YXJlDQogKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgMDIxMTAtMTMwMSBVU0ENCiAqLw0KIA0KICAgIGNsYXNzIFFScnNibG9jayB7DQogICAgICAgIHB1YmxpYyAkZGF0YUxlbmd0aDsNCiAgICAgICAgcHVibGljICRkYXRhID0gYXJyYXkoKTsNCiAgICAgICAgcHVibGljICRlY2NMZW5ndGg7DQogICAgICAgIHB1YmxpYyAkZWNjID0gYXJyYXkoKTsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkZGwsICRkYXRhLCAkZWwsICYkZWNjLCBRUnJzSXRlbSAkcnMpDQogICAgICAgIHsNCiAgICAgICAgICAgICRycy0+ZW5jb2RlX3JzX2NoYXIoJGRhdGEsICRlY2MpOw0KICAgICAgICANCiAgICAgICAgICAgICR0aGlzLT5kYXRhTGVuZ3RoID0gJGRsOw0KICAgICAgICAgICAgJHRoaXMtPmRhdGEgPSAkZGF0YTsNCiAgICAgICAgICAgICR0aGlzLT5lY2NMZW5ndGggPSAkZWw7DQogICAgICAgICAgICAkdGhpcy0+ZWNjID0gJGVjYzsNCiAgICAgICAgfQ0KICAgIH07DQogICAgDQogICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KDQogICAgY2xhc3MgUVJyYXdjb2RlIHsNCiAgICAgICAgcHVibGljICR2ZXJzaW9uOw0KICAgICAgICBwdWJsaWMgJGRhdGFjb2RlID0gYXJyYXkoKTsNCiAgICAgICAgcHVibGljICRlY2Njb2RlID0gYXJyYXkoKTsNCiAgICAgICAgcHVibGljICRibG9ja3M7DQogICAgICAgIHB1YmxpYyAkcnNibG9ja3MgPSBhcnJheSgpOyAvL29mIFJTYmxvY2sNCiAgICAgICAgcHVibGljICRjb3VudDsNCiAgICAgICAgcHVibGljICRkYXRhTGVuZ3RoOw0KICAgICAgICBwdWJsaWMgJGVjY0xlbmd0aDsNCiAgICAgICAgcHVibGljICRiMTsNCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoUVJpbnB1dCAkaW5wdXQpDQogICAgICAgIHsNCiAgICAgICAgICAgICRzcGVjID0gYXJyYXkoMCwwLDAsMCwwKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgJHRoaXMtPmRhdGFjb2RlID0gJGlucHV0LT5nZXRCeXRlU3RyZWFtKCk7DQogICAgICAgICAgICBpZihpc19udWxsKCR0aGlzLT5kYXRhY29kZSkpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdudWxsIGltcHV0IHN0cmluZycpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBRUnNwZWM6OmdldEVjY1NwZWMoJGlucHV0LT5nZXRWZXJzaW9uKCksICRpbnB1dC0+Z2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKSwgJHNwZWMpOw0KDQogICAgICAgICAgICAkdGhpcy0+dmVyc2lvbiA9ICRpbnB1dC0+Z2V0VmVyc2lvbigpOw0KICAgICAgICAgICAgJHRoaXMtPmIxID0gUVJzcGVjOjpyc0Jsb2NrTnVtMSgkc3BlYyk7DQogICAgICAgICAgICAkdGhpcy0+ZGF0YUxlbmd0aCA9IFFSc3BlYzo6cnNEYXRhTGVuZ3RoKCRzcGVjKTsNCiAgICAgICAgICAgICR0aGlzLT5lY2NMZW5ndGggPSBRUnNwZWM6OnJzRWNjTGVuZ3RoKCRzcGVjKTsNCiAgICAgICAgICAgICR0aGlzLT5lY2Njb2RlID0gYXJyYXlfZmlsbCgwLCAkdGhpcy0+ZWNjTGVuZ3RoLCAwKTsNCiAgICAgICAgICAgICR0aGlzLT5ibG9ja3MgPSBRUnNwZWM6OnJzQmxvY2tOdW0oJHNwZWMpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAkcmV0ID0gJHRoaXMtPmluaXQoJHNwZWMpOw0KICAgICAgICAgICAgaWYoJHJldCA8IDApIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdibG9jayBhbGxvYyBlcnJvcicpOw0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkdGhpcy0+Y291bnQgPSAwOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGluaXQoYXJyYXkgJHNwZWMpDQogICAgICAgIHsNCiAgICAgICAgICAgICRkbCA9IFFSc3BlYzo6cnNEYXRhQ29kZXMxKCRzcGVjKTsNCiAgICAgICAgICAgICRlbCA9IFFSc3BlYzo6cnNFY2NDb2RlczEoJHNwZWMpOw0KICAgICAgICAgICAgJHJzID0gUVJyczo6aW5pdF9ycyg4LCAweDExZCwgMCwgMSwgJGVsLCAyNTUgLSAkZGwgLSAkZWwpOw0KICAgICAgICAgICAgDQoNCiAgICAgICAgICAgICRibG9ja05vID0gMDsNCiAgICAgICAgICAgICRkYXRhUG9zID0gMDsNCiAgICAgICAgICAgICRlY2NQb3MgPSAwOw0KICAgICAgICAgICAgZm9yKCRpPTA7ICRpPFFSc3BlYzo6cnNCbG9ja051bTEoJHNwZWMpOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgJGVjYyA9IGFycmF5X3NsaWNlKCR0aGlzLT5lY2Njb2RlLCRlY2NQb3MpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5yc2Jsb2Nrc1skYmxvY2tOb10gPSBuZXcgUVJyc2Jsb2NrKCRkbCwgYXJyYXlfc2xpY2UoJHRoaXMtPmRhdGFjb2RlLCAkZGF0YVBvcyksICRlbCwgICRlY2MsICRycyk7DQogICAgICAgICAgICAgICAgJHRoaXMtPmVjY2NvZGUgPSBhcnJheV9tZXJnZShhcnJheV9zbGljZSgkdGhpcy0+ZWNjY29kZSwwLCAkZWNjUG9zKSwgJGVjYyk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgJGRhdGFQb3MgKz0gJGRsOw0KICAgICAgICAgICAgICAgICRlY2NQb3MgKz0gJGVsOw0KICAgICAgICAgICAgICAgICRibG9ja05vKys7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmKFFSc3BlYzo6cnNCbG9ja051bTIoJHNwZWMpID09IDApDQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQoNCiAgICAgICAgICAgICRkbCA9IFFSc3BlYzo6cnNEYXRhQ29kZXMyKCRzcGVjKTsNCiAgICAgICAgICAgICRlbCA9IFFSc3BlYzo6cnNFY2NDb2RlczIoJHNwZWMpOw0KICAgICAgICAgICAgJHJzID0gUVJyczo6aW5pdF9ycyg4LCAweDExZCwgMCwgMSwgJGVsLCAyNTUgLSAkZGwgLSAkZWwpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZigkcnMgPT0gTlVMTCkgcmV0dXJuIC0xOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IoJGk9MDsgJGk8UVJzcGVjOjpyc0Jsb2NrTnVtMigkc3BlYyk7ICRpKyspIHsNCiAgICAgICAgICAgICAgICAkZWNjID0gYXJyYXlfc2xpY2UoJHRoaXMtPmVjY2NvZGUsJGVjY1Bvcyk7DQogICAgICAgICAgICAgICAgJHRoaXMtPnJzYmxvY2tzWyRibG9ja05vXSA9IG5ldyBRUnJzYmxvY2soJGRsLCBhcnJheV9zbGljZSgkdGhpcy0+ZGF0YWNvZGUsICRkYXRhUG9zKSwgJGVsLCAkZWNjLCAkcnMpOw0KICAgICAgICAgICAgICAgICR0aGlzLT5lY2Njb2RlID0gYXJyYXlfbWVyZ2UoYXJyYXlfc2xpY2UoJHRoaXMtPmVjY2NvZGUsMCwgJGVjY1BvcyksICRlY2MpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICRkYXRhUG9zICs9ICRkbDsNCiAgICAgICAgICAgICAgICAkZWNjUG9zICs9ICRlbDsNCiAgICAgICAgICAgICAgICAkYmxvY2tObysrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDb2RlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgJHJldDsNCg0KICAgICAgICAgICAgaWYoJHRoaXMtPmNvdW50IDwgJHRoaXMtPmRhdGFMZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAkcm93ID0gJHRoaXMtPmNvdW50ICUgJHRoaXMtPmJsb2NrczsNCiAgICAgICAgICAgICAgICAkY29sID0gJHRoaXMtPmNvdW50IC8gJHRoaXMtPmJsb2NrczsNCiAgICAgICAgICAgICAgICBpZigkY29sID49ICR0aGlzLT5yc2Jsb2Nrc1swXS0+ZGF0YUxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICAkcm93ICs9ICR0aGlzLT5iMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHJldCA9ICR0aGlzLT5yc2Jsb2Nrc1skcm93XS0+ZGF0YVskY29sXTsNCiAgICAgICAgICAgIH0gZWxzZSBpZigkdGhpcy0+Y291bnQgPCAkdGhpcy0+ZGF0YUxlbmd0aCArICR0aGlzLT5lY2NMZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAkcm93ID0gKCR0aGlzLT5jb3VudCAtICR0aGlzLT5kYXRhTGVuZ3RoKSAlICR0aGlzLT5ibG9ja3M7DQogICAgICAgICAgICAgICAgJGNvbCA9ICgkdGhpcy0+Y291bnQgLSAkdGhpcy0+ZGF0YUxlbmd0aCkgLyAkdGhpcy0+YmxvY2tzOw0KICAgICAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+cnNibG9ja3NbJHJvd10tPmVjY1skY29sXTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkdGhpcy0+Y291bnQrKzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICRyZXQ7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjDQogICAgDQogICAgY2xhc3MgUVJjb2RlIHsNCiAgICANCiAgICAgICAgcHVibGljICR2ZXJzaW9uOw0KICAgICAgICBwdWJsaWMgJHdpZHRoOw0KICAgICAgICBwdWJsaWMgJGRhdGE7IA0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVNYXNrKFFSaW5wdXQgJGlucHV0LCAkbWFzaykNCiAgICAgICAgew0KICAgICAgICAgICAgaWYoJGlucHV0LT5nZXRWZXJzaW9uKCkgPCAwIHx8ICRpbnB1dC0+Z2V0VmVyc2lvbigpID4gUVJTUEVDX1ZFUlNJT05fTUFYKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignd3JvbmcgdmVyc2lvbicpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYoJGlucHV0LT5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCgpID4gUVJfRUNMRVZFTF9IKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignd3JvbmcgbGV2ZWwnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHJhdyA9IG5ldyBRUnJhd2NvZGUoJGlucHV0KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgUVJ0b29sczo6bWFya1RpbWUoJ2FmdGVyX3JhdycpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAkdmVyc2lvbiA9ICRyYXctPnZlcnNpb247DQogICAgICAgICAgICAkd2lkdGggPSBRUnNwZWM6OmdldFdpZHRoKCR2ZXJzaW9uKTsNCiAgICAgICAgICAgICRmcmFtZSA9IFFSc3BlYzo6bmV3RnJhbWUoJHZlcnNpb24pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAkZmlsbGVyID0gbmV3IEZyYW1lRmlsbGVyKCR3aWR0aCwgJGZyYW1lKTsNCiAgICAgICAgICAgIGlmKGlzX251bGwoJGZpbGxlcikpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gaW50ZWxlYXZlZCBkYXRhIGFuZCBlY2MgY29kZXMNCiAgICAgICAgICAgIGZvcigkaT0wOyAkaTwkcmF3LT5kYXRhTGVuZ3RoICsgJHJhdy0+ZWNjTGVuZ3RoOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgJGNvZGUgPSAkcmF3LT5nZXRDb2RlKCk7DQogICAgICAgICAgICAgICAgJGJpdCA9IDB4ODA7DQogICAgICAgICAgICAgICAgZm9yKCRqPTA7ICRqPDg7ICRqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgJGFkZHIgPSAkZmlsbGVyLT5uZXh0KCk7DQogICAgICAgICAgICAgICAgICAgICRmaWxsZXItPnNldEZyYW1lQXQoJGFkZHIsIDB4MDIgfCAoKCRiaXQgJiAkY29kZSkgIT0gMCkpOw0KICAgICAgICAgICAgICAgICAgICAkYml0ID0gJGJpdCA+PiAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgUVJ0b29sczo6bWFya1RpbWUoJ2FmdGVyX2ZpbGxlcicpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB1bnNldCgkcmF3KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gcmVtYWluZGVyIGJpdHMNCiAgICAgICAgICAgICRqID0gUVJzcGVjOjpnZXRSZW1haW5kZXIoJHZlcnNpb24pOw0KICAgICAgICAgICAgZm9yKCRpPTA7ICRpPCRqOyAkaSsrKSB7DQogICAgICAgICAgICAgICAgJGFkZHIgPSAkZmlsbGVyLT5uZXh0KCk7DQogICAgICAgICAgICAgICAgJGZpbGxlci0+c2V0RnJhbWVBdCgkYWRkciwgMHgwMik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgICRmcmFtZSA9ICRmaWxsZXItPmZyYW1lOw0KICAgICAgICAgICAgdW5zZXQoJGZpbGxlcik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gbWFza2luZw0KICAgICAgICAgICAgJG1hc2tPYmogPSBuZXcgUVJtYXNrKCk7DQogICAgICAgICAgICBpZigkbWFzayA8IDApIHsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChRUl9GSU5EX0JFU1RfTUFTSykgew0KICAgICAgICAgICAgICAgICAgICAkbWFza2VkID0gJG1hc2tPYmotPm1hc2soJHdpZHRoLCAkZnJhbWUsICRpbnB1dC0+Z2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJG1hc2tlZCA9ICRtYXNrT2JqLT5tYWtlTWFzaygkd2lkdGgsICRmcmFtZSwgKGludHZhbChRUl9ERUZBVUxUX01BU0spICUgOCksICRpbnB1dC0+Z2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkbWFza2VkID0gJG1hc2tPYmotPm1ha2VNYXNrKCR3aWR0aCwgJGZyYW1lLCAkbWFzaywgJGlucHV0LT5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYoJG1hc2tlZCA9PSBOVUxMKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIFFSdG9vbHM6Om1hcmtUaW1lKCdhZnRlcl9tYXNrJyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgICR0aGlzLT52ZXJzaW9uID0gJHZlcnNpb247DQogICAgICAgICAgICAkdGhpcy0+d2lkdGggPSAkd2lkdGg7DQogICAgICAgICAgICAkdGhpcy0+ZGF0YSA9ICRtYXNrZWQ7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiAkdGhpczsNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZUlucHV0KFFSaW5wdXQgJGlucHV0KQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmVuY29kZU1hc2soJGlucHV0LCAtMSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlU3RyaW5nOGJpdCgkc3RyaW5nLCAkdmVyc2lvbiwgJGxldmVsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZihzdHJpbmcgPT0gTlVMTCkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ2VtcHR5IHN0cmluZyEnKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGlucHV0ID0gbmV3IFFSaW5wdXQoJHZlcnNpb24sICRsZXZlbCk7DQogICAgICAgICAgICBpZigkaW5wdXQgPT0gTlVMTCkgcmV0dXJuIE5VTEw7DQoNCiAgICAgICAgICAgICRyZXQgPSAkaW5wdXQtPmFwcGVuZCgkaW5wdXQsIFFSX01PREVfOCwgc3RybGVuKCRzdHJpbmcpLCBzdHJfc3BsaXQoJHN0cmluZykpOw0KICAgICAgICAgICAgaWYoJHJldCA8IDApIHsNCiAgICAgICAgICAgICAgICB1bnNldCgkaW5wdXQpOw0KICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5lbmNvZGVJbnB1dCgkaW5wdXQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVTdHJpbmcoJHN0cmluZywgJHZlcnNpb24sICRsZXZlbCwgJGhpbnQsICRjYXNlc2Vuc2l0aXZlKQ0KICAgICAgICB7DQoNCiAgICAgICAgICAgIGlmKCRoaW50ICE9IFFSX01PREVfOCAmJiAkaGludCAhPSBRUl9NT0RFX0tBTkpJKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignYmFkIGhpbnQnKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gTlVMTDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGlucHV0ID0gbmV3IFFSaW5wdXQoJHZlcnNpb24sICRsZXZlbCk7DQogICAgICAgICAgICBpZigkaW5wdXQgPT0gTlVMTCkgcmV0dXJuIE5VTEw7DQoNCiAgICAgICAgICAgICRyZXQgPSBRUnNwbGl0OjpzcGxpdFN0cmluZ1RvUVJpbnB1dCgkc3RyaW5nLCAkaW5wdXQsICRoaW50LCAkY2FzZXNlbnNpdGl2ZSk7DQogICAgICAgICAgICBpZigkcmV0IDwgMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmVuY29kZUlucHV0KCRpbnB1dCk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHBuZygkdGV4dCwgJG91dGZpbGUgPSBmYWxzZSwgJGxldmVsID0gUVJfRUNMRVZFTF9MLCAkc2l6ZSA9IDMsICRtYXJnaW4gPSA0LCAkc2F2ZWFuZHByaW50PWZhbHNlKSANCiAgICAgICAgew0KICAgICAgICAgICAgJGVuYyA9IFFSZW5jb2RlOjpmYWN0b3J5KCRsZXZlbCwgJHNpemUsICRtYXJnaW4pOw0KICAgICAgICAgICAgcmV0dXJuICRlbmMtPmVuY29kZVBORygkdGV4dCwgJG91dGZpbGUsICRzYXZlYW5kcHJpbnQ9ZmFsc2UpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gdGV4dCgkdGV4dCwgJG91dGZpbGUgPSBmYWxzZSwgJGxldmVsID0gUVJfRUNMRVZFTF9MLCAkc2l6ZSA9IDMsICRtYXJnaW4gPSA0KSANCiAgICAgICAgew0KICAgICAgICAgICAgJGVuYyA9IFFSZW5jb2RlOjpmYWN0b3J5KCRsZXZlbCwgJHNpemUsICRtYXJnaW4pOw0KICAgICAgICAgICAgcmV0dXJuICRlbmMtPmVuY29kZSgkdGV4dCwgJG91dGZpbGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcmF3KCR0ZXh0LCAkb3V0ZmlsZSA9IGZhbHNlLCAkbGV2ZWwgPSBRUl9FQ0xFVkVMX0wsICRzaXplID0gMywgJG1hcmdpbiA9IDQpIA0KICAgICAgICB7DQogICAgICAgICAgICAkZW5jID0gUVJlbmNvZGU6OmZhY3RvcnkoJGxldmVsLCAkc2l6ZSwgJG1hcmdpbik7DQogICAgICAgICAgICByZXR1cm4gJGVuYy0+ZW5jb2RlUkFXKCR0ZXh0LCAkb3V0ZmlsZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgDQogICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIw0KICAgIA0KICAgIGNsYXNzIEZyYW1lRmlsbGVyIHsNCiAgICANCiAgICAgICAgcHVibGljICR3aWR0aDsNCiAgICAgICAgcHVibGljICRmcmFtZTsNCiAgICAgICAgcHVibGljICR4Ow0KICAgICAgICBwdWJsaWMgJHk7DQogICAgICAgIHB1YmxpYyAkZGlyOw0KICAgICAgICBwdWJsaWMgJGJpdDsNCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJHdpZHRoLCAmJGZyYW1lKQ0KICAgICAgICB7DQogICAgICAgICAgICAkdGhpcy0+d2lkdGggPSAkd2lkdGg7DQogICAgICAgICAgICAkdGhpcy0+ZnJhbWUgPSAkZnJhbWU7DQogICAgICAgICAgICAkdGhpcy0+eCA9ICR3aWR0aCAtIDE7DQogICAgICAgICAgICAkdGhpcy0+eSA9ICR3aWR0aCAtIDE7DQogICAgICAgICAgICAkdGhpcy0+ZGlyID0gLTE7DQogICAgICAgICAgICAkdGhpcy0+Yml0ID0gLTE7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gc2V0RnJhbWVBdCgkYXQsICR2YWwpDQogICAgICAgIHsNCiAgICAgICAgICAgICR0aGlzLT5mcmFtZVskYXRbJ3knXV1bJGF0Wyd4J11dID0gY2hyKCR2YWwpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGdldEZyYW1lQXQoJGF0KQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gb3JkKCR0aGlzLT5mcmFtZVskYXRbJ3knXV1bJGF0Wyd4J11dKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBuZXh0KCkNCiAgICAgICAgew0KICAgICAgICAgICAgZG8gew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoJHRoaXMtPmJpdCA9PSAtMSkgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Yml0ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5KCd4Jz0+JHRoaXMtPngsICd5Jz0+JHRoaXMtPnkpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICR4ID0gJHRoaXMtPng7DQogICAgICAgICAgICAgICAgJHkgPSAkdGhpcy0+eTsNCiAgICAgICAgICAgICAgICAkdyA9ICR0aGlzLT53aWR0aDsNCg0KICAgICAgICAgICAgICAgIGlmKCR0aGlzLT5iaXQgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAkeC0tOw0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Yml0Kys7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJHgrKzsNCiAgICAgICAgICAgICAgICAgICAgJHkgKz0gJHRoaXMtPmRpcjsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJpdC0tOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmKCR0aGlzLT5kaXIgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgIGlmKCR5IDwgMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJHkgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgJHggLT0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5kaXIgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHggPT0gNikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR4LS07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHkgPSA5Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYoJHkgPT0gJHcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICR5ID0gJHcgLSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgJHggLT0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5kaXIgPSAtMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR4ID09IDYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeC0tOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR5IC09IDg7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYoJHggPCAwIHx8ICR5IDwgMCkgcmV0dXJuIG51bGw7DQoNCiAgICAgICAgICAgICAgICAkdGhpcy0+eCA9ICR4Ow0KICAgICAgICAgICAgICAgICR0aGlzLT55ID0gJHk7DQoNCiAgICAgICAgICAgIH0gd2hpbGUob3JkKCR0aGlzLT5mcmFtZVskeV1bJHhdKSAmIDB4ODApOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gYXJyYXkoJ3gnPT4keCwgJ3knPT4keSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgfSA7DQogICAgDQogICAgLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyAgICANCiAgICANCiAgICBjbGFzcyBRUmVuY29kZSB7DQogICAgDQogICAgICAgIHB1YmxpYyAkY2FzZXNlbnNpdGl2ZSA9IHRydWU7DQogICAgICAgIHB1YmxpYyAkZWlnaHRiaXQgPSBmYWxzZTsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYyAkdmVyc2lvbiA9IDA7DQogICAgICAgIHB1YmxpYyAkc2l6ZSA9IDM7DQogICAgICAgIHB1YmxpYyAkbWFyZ2luID0gNDsNCiAgICAgICAgDQogICAgICAgIHB1YmxpYyAkc3RydWN0dXJlZCA9IDA7IC8vIG5vdCBzdXBwb3J0ZWQgeWV0DQogICAgICAgIA0KICAgICAgICBwdWJsaWMgJGxldmVsID0gUVJfRUNMRVZFTF9MOw0KICAgICAgICBwdWJsaWMgJGhpbnQgPSBRUl9NT0RFXzg7DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBmYWN0b3J5KCRsZXZlbCA9IFFSX0VDTEVWRUxfTCwgJHNpemUgPSAzLCAkbWFyZ2luID0gNCkNCiAgICAgICAgew0KICAgICAgICAgICAgJGVuYyA9IG5ldyBRUmVuY29kZSgpOw0KICAgICAgICAgICAgJGVuYy0+c2l6ZSA9ICRzaXplOw0KICAgICAgICAgICAgJGVuYy0+bWFyZ2luID0gJG1hcmdpbjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc3dpdGNoICgkbGV2ZWwuJycpIHsNCiAgICAgICAgICAgICAgICBjYXNlICcwJzoNCiAgICAgICAgICAgICAgICBjYXNlICcxJzoNCiAgICAgICAgICAgICAgICBjYXNlICcyJzoNCiAgICAgICAgICAgICAgICBjYXNlICczJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICRlbmMtPmxldmVsID0gJGxldmVsOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICdsJzoNCiAgICAgICAgICAgICAgICBjYXNlICdMJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICRlbmMtPmxldmVsID0gUVJfRUNMRVZFTF9MOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICdtJzoNCiAgICAgICAgICAgICAgICBjYXNlICdNJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICRlbmMtPmxldmVsID0gUVJfRUNMRVZFTF9NOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICdxJzoNCiAgICAgICAgICAgICAgICBjYXNlICdRJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICRlbmMtPmxldmVsID0gUVJfRUNMRVZFTF9ROw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICdoJzoNCiAgICAgICAgICAgICAgICBjYXNlICdIJzoNCiAgICAgICAgICAgICAgICAgICAgICAgICRlbmMtPmxldmVsID0gUVJfRUNMRVZFTF9IOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICRlbmM7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlUkFXKCRpbnRleHQsICRvdXRmaWxlID0gZmFsc2UpIA0KICAgICAgICB7DQogICAgICAgICAgICAkY29kZSA9IG5ldyBRUmNvZGUoKTsNCg0KICAgICAgICAgICAgaWYoJHRoaXMtPmVpZ2h0Yml0KSB7DQogICAgICAgICAgICAgICAgJGNvZGUtPmVuY29kZVN0cmluZzhiaXQoJGludGV4dCwgJHRoaXMtPnZlcnNpb24sICR0aGlzLT5sZXZlbCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRjb2RlLT5lbmNvZGVTdHJpbmcoJGludGV4dCwgJHRoaXMtPnZlcnNpb24sICR0aGlzLT5sZXZlbCwgJHRoaXMtPmhpbnQsICR0aGlzLT5jYXNlc2Vuc2l0aXZlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICRjb2RlLT5kYXRhOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGUoJGludGV4dCwgJG91dGZpbGUgPSBmYWxzZSkgDQogICAgICAgIHsNCiAgICAgICAgICAgICRjb2RlID0gbmV3IFFSY29kZSgpOw0KDQogICAgICAgICAgICBpZigkdGhpcy0+ZWlnaHRiaXQpIHsNCiAgICAgICAgICAgICAgICAkY29kZS0+ZW5jb2RlU3RyaW5nOGJpdCgkaW50ZXh0LCAkdGhpcy0+dmVyc2lvbiwgJHRoaXMtPmxldmVsKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGNvZGUtPmVuY29kZVN0cmluZygkaW50ZXh0LCAkdGhpcy0+dmVyc2lvbiwgJHRoaXMtPmxldmVsLCAkdGhpcy0+aGludCwgJHRoaXMtPmNhc2VzZW5zaXRpdmUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBRUnRvb2xzOjptYXJrVGltZSgnYWZ0ZXJfZW5jb2RlJyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmICgkb3V0ZmlsZSE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCRvdXRmaWxlLCBqb2luKCJcbiIsIFFSdG9vbHM6OmJpbmFyaXplKCRjb2RlLT5kYXRhKSkpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUVJ0b29sczo6YmluYXJpemUoJGNvZGUtPmRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVBORygkaW50ZXh0LCAkb3V0ZmlsZSA9IGZhbHNlLCRzYXZlYW5kcHJpbnQ9ZmFsc2UpIA0KICAgICAgICB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgb2Jfc3RhcnQoKTsNCiAgICAgICAgICAgICAgICAkdGFiID0gJHRoaXMtPmVuY29kZSgkaW50ZXh0KTsNCiAgICAgICAgICAgICAgICAkZXJyID0gb2JfZ2V0X2NvbnRlbnRzKCk7DQogICAgICAgICAgICAgICAgb2JfZW5kX2NsZWFuKCk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKCRlcnIgIT0gJycpDQogICAgICAgICAgICAgICAgICAgIFFSdG9vbHM6OmxvZygkb3V0ZmlsZSwgJGVycik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgJG1heFNpemUgPSAoaW50KShRUl9QTkdfTUFYSU1VTV9TSVpFIC8gKGNvdW50KCR0YWIpKzIqJHRoaXMtPm1hcmdpbikpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIFFSaW1hZ2U6OnBuZygkdGFiLCAkb3V0ZmlsZSwgbWluKG1heCgxLCAkdGhpcy0+c2l6ZSksICRtYXhTaXplKSwgJHRoaXMtPm1hcmdpbiwkc2F2ZWFuZHByaW50KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7DQogICAgICAgICAgICANCiAgICAgICAgICAgICAgICBRUnRvb2xzOjpsb2coJG91dGZpbGUsICRlLT5nZXRNZXNzYWdlKCkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoKCg==",
    "size": "121780"
}