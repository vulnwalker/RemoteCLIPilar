{
    "namaFile": "pages\/admin\/menu\/assets\/js\/libs\/jquery-validation\/test\/qunit\/qunit.js",
    "lastUpdate": "2018-03-22+14:27:08.55",
    "contentFile": "LyohCiAqIFFVbml0IDEuMTQuMAogKiBodHRwOi8vcXVuaXRqcy5jb20vCiAqCiAqIENvcHlyaWdodCAyMDEzIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogRGF0ZTogMjAxNC0wMS0zMVQxNjo0MFoKICovCgooZnVuY3Rpb24oIHdpbmRvdyApIHsKCnZhciBRVW5pdCwKCWFzc2VydCwKCWNvbmZpZywKCW9uRXJyb3JGblByZXYsCgl0ZXN0SWQgPSAwLAoJZmlsZU5hbWUgPSAoc291cmNlRnJvbVN0YWNrdHJhY2UoIDAgKSB8fCAiIiApLnJlcGxhY2UoLyg6XGQrKStcKT8vLCAiIikucmVwbGFjZSgvLitcLy8sICIiKSwKCXRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywKCWhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCgkvLyBLZWVwIGEgbG9jYWwgcmVmZXJlbmNlIHRvIERhdGUgKEdILTI4MykKCURhdGUgPSB3aW5kb3cuRGF0ZSwKCXNldFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dCwKCWNsZWFyVGltZW91dCA9IHdpbmRvdy5jbGVhclRpbWVvdXQsCglkZWZpbmVkID0gewoJCWRvY3VtZW50OiB0eXBlb2Ygd2luZG93LmRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiwKCQlzZXRUaW1lb3V0OiB0eXBlb2Ygd2luZG93LnNldFRpbWVvdXQgIT09ICJ1bmRlZmluZWQiLAoJCXNlc3Npb25TdG9yYWdlOiAoZnVuY3Rpb24oKSB7CgkJCXZhciB4ID0gInF1bml0LXRlc3Qtc3RyaW5nIjsKCQkJdHJ5IHsKCQkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oIHgsIHggKTsKCQkJCXNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oIHggKTsKCQkJCXJldHVybiB0cnVlOwoJCQl9IGNhdGNoKCBlICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSgpKQoJfSwKCS8qKgoJICogUHJvdmlkZXMgYSBub3JtYWxpemVkIGVycm9yIHN0cmluZywgY29ycmVjdGluZyBhbiBpc3N1ZQoJICogd2l0aCBJRSA3IChhbmQgcHJpb3IpIHdoZXJlIEVycm9yLnByb3RvdHlwZS50b1N0cmluZyBpcwoJICogbm90IHByb3Blcmx5IGltcGxlbWVudGVkCgkgKgoJICogQmFzZWQgb24gaHR0cDovL2VzNS5naXRodWIuY29tLyN4MTUuMTEuNC40CgkgKgoJICogQHBhcmFtIHtTdHJpbmd8RXJyb3J9IGVycm9yCgkgKiBAcmV0dXJuIHtTdHJpbmd9IGVycm9yIG1lc3NhZ2UKCSAqLwoJZXJyb3JTdHJpbmcgPSBmdW5jdGlvbiggZXJyb3IgKSB7CgkJdmFyIG5hbWUsIG1lc3NhZ2UsCgkJCWVycm9yU3RyaW5nID0gZXJyb3IudG9TdHJpbmcoKTsKCQlpZiAoIGVycm9yU3RyaW5nLnN1YnN0cmluZyggMCwgNyApID09PSAiW29iamVjdCIgKSB7CgkJCW5hbWUgPSBlcnJvci5uYW1lID8gZXJyb3IubmFtZS50b1N0cmluZygpIDogIkVycm9yIjsKCQkJbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlLnRvU3RyaW5nKCkgOiAiIjsKCQkJaWYgKCBuYW1lICYmIG1lc3NhZ2UgKSB7CgkJCQlyZXR1cm4gbmFtZSArICI6ICIgKyBtZXNzYWdlOwoJCQl9IGVsc2UgaWYgKCBuYW1lICkgewoJCQkJcmV0dXJuIG5hbWU7CgkJCX0gZWxzZSBpZiAoIG1lc3NhZ2UgKSB7CgkJCQlyZXR1cm4gbWVzc2FnZTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiAiRXJyb3IiOwoJCQl9CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGVycm9yU3RyaW5nOwoJCX0KCX0sCgkvKioKCSAqIE1ha2VzIGEgY2xvbmUgb2YgYW4gb2JqZWN0IHVzaW5nIG9ubHkgQXJyYXkgb3IgT2JqZWN0IGFzIGJhc2UsCgkgKiBhbmQgY29waWVzIG92ZXIgdGhlIG93biBlbnVtZXJhYmxlIHByb3BlcnRpZXMuCgkgKgoJICogQHBhcmFtIHtPYmplY3R9IG9iagoJICogQHJldHVybiB7T2JqZWN0fSBOZXcgb2JqZWN0IHdpdGggb25seSB0aGUgb3duIHByb3BlcnRpZXMgKHJlY3Vyc2l2ZWx5KS4KCSAqLwoJb2JqZWN0VmFsdWVzID0gZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBHcnVudCAwLjMueCB1c2VzIGFuIG9sZGVyIHZlcnNpb24gb2YganNoaW50IHRoYXQgc3RpbGwgaGFzIGpzaGludC9qc2hpbnQjMzkyLgoJCS8qanNoaW50IG5ld2NhcDogZmFsc2UgKi8KCQl2YXIga2V5LCB2YWwsCgkJCXZhbHMgPSBRVW5pdC5pcyggImFycmF5Iiwgb2JqICkgPyBbXSA6IHt9OwoJCWZvciAoIGtleSBpbiBvYmogKSB7CgkJCWlmICggaGFzT3duLmNhbGwoIG9iaiwga2V5ICkgKSB7CgkJCQl2YWwgPSBvYmpba2V5XTsKCQkJCXZhbHNba2V5XSA9IHZhbCA9PT0gT2JqZWN0KHZhbCkgPyBvYmplY3RWYWx1ZXModmFsKSA6IHZhbDsKCQkJfQoJCX0KCQlyZXR1cm4gdmFsczsKCX07CgoKLy8gUm9vdCBRVW5pdCBvYmplY3QuCi8vIGBRVW5pdGAgaW5pdGlhbGl6ZWQgYXQgdG9wIG9mIHNjb3BlClFVbml0ID0gewoKCS8vIGNhbGwgb24gc3RhcnQgb2YgbW9kdWxlIHRlc3QgdG8gcHJlcGVuZCBuYW1lIHRvIGFsbCB0ZXN0cwoJbW9kdWxlOiBmdW5jdGlvbiggbmFtZSwgdGVzdEVudmlyb25tZW50ICkgewoJCWNvbmZpZy5jdXJyZW50TW9kdWxlID0gbmFtZTsKCQljb25maWcuY3VycmVudE1vZHVsZVRlc3RFbnZpcm9ubWVudCA9IHRlc3RFbnZpcm9ubWVudDsKCQljb25maWcubW9kdWxlc1tuYW1lXSA9IHRydWU7Cgl9LAoKCWFzeW5jVGVzdDogZnVuY3Rpb24oIHRlc3ROYW1lLCBleHBlY3RlZCwgY2FsbGJhY2sgKSB7CgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoID09PSAyICkgewoJCQljYWxsYmFjayA9IGV4cGVjdGVkOwoJCQlleHBlY3RlZCA9IG51bGw7CgkJfQoKCQlRVW5pdC50ZXN0KCB0ZXN0TmFtZSwgZXhwZWN0ZWQsIGNhbGxiYWNrLCB0cnVlICk7Cgl9LAoKCXRlc3Q6IGZ1bmN0aW9uKCB0ZXN0TmFtZSwgZXhwZWN0ZWQsIGNhbGxiYWNrLCBhc3luYyApIHsKCQl2YXIgdGVzdCwKCQkJbmFtZUh0bWwgPSAiPHNwYW4gY2xhc3M9J3Rlc3QtbmFtZSc+IiArIGVzY2FwZVRleHQoIHRlc3ROYW1lICkgKyAiPC9zcGFuPiI7CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMiApIHsKCQkJY2FsbGJhY2sgPSBleHBlY3RlZDsKCQkJZXhwZWN0ZWQgPSBudWxsOwoJCX0KCgkJaWYgKCBjb25maWcuY3VycmVudE1vZHVsZSApIHsKCQkJbmFtZUh0bWwgPSAiPHNwYW4gY2xhc3M9J21vZHVsZS1uYW1lJz4iICsgZXNjYXBlVGV4dCggY29uZmlnLmN1cnJlbnRNb2R1bGUgKSArICI8L3NwYW4+OiAiICsgbmFtZUh0bWw7CgkJfQoKCQl0ZXN0ID0gbmV3IFRlc3QoewoJCQluYW1lSHRtbDogbmFtZUh0bWwsCgkJCXRlc3ROYW1lOiB0ZXN0TmFtZSwKCQkJZXhwZWN0ZWQ6IGV4cGVjdGVkLAoJCQlhc3luYzogYXN5bmMsCgkJCWNhbGxiYWNrOiBjYWxsYmFjaywKCQkJbW9kdWxlOiBjb25maWcuY3VycmVudE1vZHVsZSwKCQkJbW9kdWxlVGVzdEVudmlyb25tZW50OiBjb25maWcuY3VycmVudE1vZHVsZVRlc3RFbnZpcm9ubWVudCwKCQkJc3RhY2s6IHNvdXJjZUZyb21TdGFja3RyYWNlKCAyICkKCQl9KTsKCgkJaWYgKCAhdmFsaWRUZXN0KCB0ZXN0ICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCXRlc3QucXVldWUoKTsKCX0sCgoJLy8gU3BlY2lmeSB0aGUgbnVtYmVyIG9mIGV4cGVjdGVkIGFzc2VydGlvbnMgdG8gZ3VhcmFudGVlIHRoYXQgZmFpbGVkIHRlc3QgKG5vIGFzc2VydGlvbnMgYXJlIHJ1biBhdCBhbGwpIGRvbid0IHNsaXAgdGhyb3VnaC4KCWV4cGVjdDogZnVuY3Rpb24oIGFzc2VydHMgKSB7CgkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKCQkJY29uZmlnLmN1cnJlbnQuZXhwZWN0ZWQgPSBhc3NlcnRzOwoJCX0gZWxzZSB7CgkJCXJldHVybiBjb25maWcuY3VycmVudC5leHBlY3RlZDsKCQl9Cgl9LAoKCXN0YXJ0OiBmdW5jdGlvbiggY291bnQgKSB7CgkJLy8gUVVuaXQgaGFzbid0IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LgoJCS8vIE5vdGU6IFJlcXVpcmVKUyAoZXQgYWwpIG1heSBkZWxheSBvbkxvYWQKCQlpZiAoIGNvbmZpZy5zZW1hcGhvcmUgPT09IHVuZGVmaW5lZCApIHsKCQkJUVVuaXQuYmVnaW4oZnVuY3Rpb24oKSB7CgkJCQkvLyBUaGlzIGlzIHRyaWdnZXJlZCBhdCB0aGUgdG9wIG9mIFFVbml0LmxvYWQsIHB1c2ggc3RhcnQoKSB0byB0aGUgZXZlbnQgbG9vcCwgdG8gYWxsb3cgUVVuaXQubG9hZCB0byBmaW5pc2ggZmlyc3QKCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJUVVuaXQuc3RhcnQoIGNvdW50ICk7CgkJCQl9KTsKCQkJfSk7CgkJCXJldHVybjsKCQl9CgoJCWNvbmZpZy5zZW1hcGhvcmUgLT0gY291bnQgfHwgMTsKCQkvLyBkb24ndCBzdGFydCB1bnRpbCBlcXVhbCBudW1iZXIgb2Ygc3RvcC1jYWxscwoJCWlmICggY29uZmlnLnNlbWFwaG9yZSA+IDAgKSB7CgkJCXJldHVybjsKCQl9CgkJLy8gaWdub3JlIGlmIHN0YXJ0IGlzIGNhbGxlZCBtb3JlIG9mdGVuIHRoZW4gc3RvcAoJCWlmICggY29uZmlnLnNlbWFwaG9yZSA8IDAgKSB7CgkJCWNvbmZpZy5zZW1hcGhvcmUgPSAwOwoJCQlRVW5pdC5wdXNoRmFpbHVyZSggIkNhbGxlZCBzdGFydCgpIHdoaWxlIGFscmVhZHkgc3RhcnRlZCAoUVVuaXQuY29uZmlnLnNlbWFwaG9yZSB3YXMgMCBhbHJlYWR5KSIsIG51bGwsIHNvdXJjZUZyb21TdGFja3RyYWNlKDIpICk7CgkJCXJldHVybjsKCQl9CgkJLy8gQSBzbGlnaHQgZGVsYXksIHRvIGF2b2lkIGFueSBjdXJyZW50IGNhbGxiYWNrcwoJCWlmICggZGVmaW5lZC5zZXRUaW1lb3V0ICkgewoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBjb25maWcuc2VtYXBob3JlID4gMCApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlpZiAoIGNvbmZpZy50aW1lb3V0ICkgewoJCQkJCWNsZWFyVGltZW91dCggY29uZmlnLnRpbWVvdXQgKTsKCQkJCX0KCgkJCQljb25maWcuYmxvY2tpbmcgPSBmYWxzZTsKCQkJCXByb2Nlc3MoIHRydWUgKTsKCQkJfSwgMTMpOwoJCX0gZWxzZSB7CgkJCWNvbmZpZy5ibG9ja2luZyA9IGZhbHNlOwoJCQlwcm9jZXNzKCB0cnVlICk7CgkJfQoJfSwKCglzdG9wOiBmdW5jdGlvbiggY291bnQgKSB7CgkJY29uZmlnLnNlbWFwaG9yZSArPSBjb3VudCB8fCAxOwoJCWNvbmZpZy5ibG9ja2luZyA9IHRydWU7CgoJCWlmICggY29uZmlnLnRlc3RUaW1lb3V0ICYmIGRlZmluZWQuc2V0VGltZW91dCApIHsKCQkJY2xlYXJUaW1lb3V0KCBjb25maWcudGltZW91dCApOwoJCQljb25maWcudGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQlRVW5pdC5vayggZmFsc2UsICJUZXN0IHRpbWVkIG91dCIgKTsKCQkJCWNvbmZpZy5zZW1hcGhvcmUgPSAxOwoJCQkJUVVuaXQuc3RhcnQoKTsKCQkJfSwgY29uZmlnLnRlc3RUaW1lb3V0ICk7CgkJfQoJfQp9OwoKLy8gV2UgdXNlIHRoZSBwcm90b3R5cGUgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBwcm9wZXJ0aWVzIHRoYXQgc2hvdWxkCi8vIGJlIGV4cG9zZWQgYXMgZ2xvYmFscyAoYW5kIGluIGV4cG9ydHMpIGFuZCB0aG9zZSB0aGF0IHNob3VsZG4ndAooZnVuY3Rpb24oKSB7CglmdW5jdGlvbiBGKCkge30KCUYucHJvdG90eXBlID0gUVVuaXQ7CglRVW5pdCA9IG5ldyBGKCk7CgkvLyBNYWtlIEYgUVVuaXQncyBjb25zdHJ1Y3RvciBzbyB0aGF0IHdlIGNhbiBhZGQgdG8gdGhlIHByb3RvdHlwZSBsYXRlcgoJUVVuaXQuY29uc3RydWN0b3IgPSBGOwp9KCkpOwoKLyoqCiAqIENvbmZpZyBvYmplY3Q6IE1haW50YWluIGludGVybmFsIHN0YXRlCiAqIExhdGVyIGV4cG9zZWQgYXMgUVVuaXQuY29uZmlnCiAqIGBjb25maWdgIGluaXRpYWxpemVkIGF0IHRvcCBvZiBzY29wZQogKi8KY29uZmlnID0gewoJLy8gVGhlIHF1ZXVlIG9mIHRlc3RzIHRvIHJ1bgoJcXVldWU6IFtdLAoKCS8vIGJsb2NrIHVudGlsIGRvY3VtZW50IHJlYWR5CglibG9ja2luZzogdHJ1ZSwKCgkvLyB3aGVuIGVuYWJsZWQsIHNob3cgb25seSBmYWlsaW5nIHRlc3RzCgkvLyBnZXRzIHBlcnNpc3RlZCB0aHJvdWdoIHNlc3Npb25TdG9yYWdlIGFuZCBjYW4gYmUgY2hhbmdlZCBpbiBVSSB2aWEgY2hlY2tib3gKCWhpZGVwYXNzZWQ6IGZhbHNlLAoKCS8vIGJ5IGRlZmF1bHQsIHJ1biBwcmV2aW91c2x5IGZhaWxlZCB0ZXN0cyBmaXJzdAoJLy8gdmVyeSB1c2VmdWwgaW4gY29tYmluYXRpb24gd2l0aCAiSGlkZSBwYXNzZWQgdGVzdHMiIGNoZWNrZWQKCXJlb3JkZXI6IHRydWUsCgoJLy8gYnkgZGVmYXVsdCwgbW9kaWZ5IGRvY3VtZW50LnRpdGxlIHdoZW4gc3VpdGUgaXMgZG9uZQoJYWx0ZXJ0aXRsZTogdHJ1ZSwKCgkvLyBieSBkZWZhdWx0LCBzY3JvbGwgdG8gdG9wIG9mIHRoZSBwYWdlIHdoZW4gc3VpdGUgaXMgZG9uZQoJc2Nyb2xsdG9wOiB0cnVlLAoKCS8vIHdoZW4gZW5hYmxlZCwgYWxsIHRlc3RzIG11c3QgY2FsbCBleHBlY3QoKQoJcmVxdWlyZUV4cGVjdHM6IGZhbHNlLAoKCS8vIGFkZCBjaGVja2JveGVzIHRoYXQgYXJlIHBlcnNpc3RlZCBpbiB0aGUgcXVlcnktc3RyaW5nCgkvLyB3aGVuIGVuYWJsZWQsIHRoZSBpZCBpcyBzZXQgdG8gYHRydWVgIGFzIGEgYFFVbml0LmNvbmZpZ2AgcHJvcGVydHkKCXVybENvbmZpZzogWwoJCXsKCQkJaWQ6ICJub2dsb2JhbHMiLAoJCQlsYWJlbDogIkNoZWNrIGZvciBHbG9iYWxzIiwKCQkJdG9vbHRpcDogIkVuYWJsaW5nIHRoaXMgd2lsbCB0ZXN0IGlmIGFueSB0ZXN0IGludHJvZHVjZXMgbmV3IHByb3BlcnRpZXMgb24gdGhlIGB3aW5kb3dgIG9iamVjdC4gU3RvcmVkIGFzIHF1ZXJ5LXN0cmluZ3MuIgoJCX0sCgkJewoJCQlpZDogIm5vdHJ5Y2F0Y2giLAoJCQlsYWJlbDogIk5vIHRyeS1jYXRjaCIsCgkJCXRvb2x0aXA6ICJFbmFibGluZyB0aGlzIHdpbGwgcnVuIHRlc3RzIG91dHNpZGUgb2YgYSB0cnktY2F0Y2ggYmxvY2suIE1ha2VzIGRlYnVnZ2luZyBleGNlcHRpb25zIGluIElFIHJlYXNvbmFibGUuIFN0b3JlZCBhcyBxdWVyeS1zdHJpbmdzLiIKCQl9CgldLAoKCS8vIFNldCBvZiBhbGwgbW9kdWxlcy4KCW1vZHVsZXM6IHt9LAoKCS8vIGxvZ2dpbmcgY2FsbGJhY2sgcXVldWVzCgliZWdpbjogW10sCglkb25lOiBbXSwKCWxvZzogW10sCgl0ZXN0U3RhcnQ6IFtdLAoJdGVzdERvbmU6IFtdLAoJbW9kdWxlU3RhcnQ6IFtdLAoJbW9kdWxlRG9uZTogW10KfTsKCi8vIEluaXRpYWxpemUgbW9yZSBRVW5pdC5jb25maWcgYW5kIFFVbml0LnVybFBhcmFtcwooZnVuY3Rpb24oKSB7Cgl2YXIgaSwgY3VycmVudCwKCQlsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbiB8fCB7IHNlYXJjaDogIiIsIHByb3RvY29sOiAiZmlsZToiIH0sCgkJcGFyYW1zID0gbG9jYXRpb24uc2VhcmNoLnNsaWNlKCAxICkuc3BsaXQoICImIiApLAoJCWxlbmd0aCA9IHBhcmFtcy5sZW5ndGgsCgkJdXJsUGFyYW1zID0ge307CgoJaWYgKCBwYXJhbXNbIDAgXSApIHsKCQlmb3IgKCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQljdXJyZW50ID0gcGFyYW1zWyBpIF0uc3BsaXQoICI9IiApOwoJCQljdXJyZW50WyAwIF0gPSBkZWNvZGVVUklDb21wb25lbnQoIGN1cnJlbnRbIDAgXSApOwoKCQkJLy8gYWxsb3cganVzdCBhIGtleSB0byB0dXJuIG9uIGEgZmxhZywgZS5nLiwgdGVzdC5odG1sP25vZ2xvYmFscwoJCQljdXJyZW50WyAxIF0gPSBjdXJyZW50WyAxIF0gPyBkZWNvZGVVUklDb21wb25lbnQoIGN1cnJlbnRbIDEgXSApIDogdHJ1ZTsKCQkJaWYgKCB1cmxQYXJhbXNbIGN1cnJlbnRbIDAgXSBdICkgewoJCQkJdXJsUGFyYW1zWyBjdXJyZW50WyAwIF0gXSA9IFtdLmNvbmNhdCggdXJsUGFyYW1zWyBjdXJyZW50WyAwIF0gXSwgY3VycmVudFsgMSBdICk7CgkJCX0gZWxzZSB7CgkJCQl1cmxQYXJhbXNbIGN1cnJlbnRbIDAgXSBdID0gY3VycmVudFsgMSBdOwoJCQl9CgkJfQoJfQoKCVFVbml0LnVybFBhcmFtcyA9IHVybFBhcmFtczsKCgkvLyBTdHJpbmcgc2VhcmNoIGFueXdoZXJlIGluIG1vZHVsZU5hbWUrdGVzdE5hbWUKCWNvbmZpZy5maWx0ZXIgPSB1cmxQYXJhbXMuZmlsdGVyOwoKCS8vIEV4YWN0IG1hdGNoIG9mIHRoZSBtb2R1bGUgbmFtZQoJY29uZmlnLm1vZHVsZSA9IHVybFBhcmFtcy5tb2R1bGU7CgoJY29uZmlnLnRlc3ROdW1iZXIgPSBbXTsKCWlmICggdXJsUGFyYW1zLnRlc3ROdW1iZXIgKSB7CgoJCS8vIEVuc3VyZSB0aGF0IHVybFBhcmFtcy50ZXN0TnVtYmVyIGlzIGFuIGFycmF5CgkJdXJsUGFyYW1zLnRlc3ROdW1iZXIgPSBbXS5jb25jYXQoIHVybFBhcmFtcy50ZXN0TnVtYmVyICk7CgkJZm9yICggaSA9IDA7IGkgPCB1cmxQYXJhbXMudGVzdE51bWJlci5sZW5ndGg7IGkrKyApIHsKCQkJY3VycmVudCA9IHVybFBhcmFtcy50ZXN0TnVtYmVyWyBpIF07CgkJCWNvbmZpZy50ZXN0TnVtYmVyLnB1c2goIHBhcnNlSW50KCBjdXJyZW50LCAxMCApICk7CgkJfQoJfQoKCS8vIEZpZ3VyZSBvdXQgaWYgd2UncmUgcnVubmluZyB0aGUgdGVzdHMgZnJvbSBhIHNlcnZlciBvciBub3QKCVFVbml0LmlzTG9jYWwgPSBsb2NhdGlvbi5wcm90b2NvbCA9PT0gImZpbGU6IjsKfSgpKTsKCmV4dGVuZCggUVVuaXQsIHsKCgljb25maWc6IGNvbmZpZywKCgkvLyBJbml0aWFsaXplIHRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMKCWluaXQ6IGZ1bmN0aW9uKCkgewoJCWV4dGVuZCggY29uZmlnLCB7CgkJCXN0YXRzOiB7IGFsbDogMCwgYmFkOiAwIH0sCgkJCW1vZHVsZVN0YXRzOiB7IGFsbDogMCwgYmFkOiAwIH0sCgkJCXN0YXJ0ZWQ6ICtuZXcgRGF0ZSgpLAoJCQl1cGRhdGVSYXRlOiAxMDAwLAoJCQlibG9ja2luZzogZmFsc2UsCgkJCWF1dG9zdGFydDogdHJ1ZSwKCQkJYXV0b3J1bjogZmFsc2UsCgkJCWZpbHRlcjogIiIsCgkJCXF1ZXVlOiBbXSwKCQkJc2VtYXBob3JlOiAxCgkJfSk7CgoJCXZhciB0ZXN0cywgYmFubmVyLCByZXN1bHQsCgkJCXF1bml0ID0gaWQoICJxdW5pdCIgKTsKCgkJaWYgKCBxdW5pdCApIHsKCQkJcXVuaXQuaW5uZXJIVE1MID0KCQkJCSI8aDEgaWQ9J3F1bml0LWhlYWRlcic+IiArIGVzY2FwZVRleHQoIGRvY3VtZW50LnRpdGxlICkgKyAiPC9oMT4iICsKCQkJCSI8aDIgaWQ9J3F1bml0LWJhbm5lcic+PC9oMj4iICsKCQkJCSI8ZGl2IGlkPSdxdW5pdC10ZXN0cnVubmVyLXRvb2xiYXInPjwvZGl2PiIgKwoJCQkJIjxoMiBpZD0ncXVuaXQtdXNlckFnZW50Jz48L2gyPiIgKwoJCQkJIjxvbCBpZD0ncXVuaXQtdGVzdHMnPjwvb2w+IjsKCQl9CgoJCXRlc3RzID0gaWQoICJxdW5pdC10ZXN0cyIgKTsKCQliYW5uZXIgPSBpZCggInF1bml0LWJhbm5lciIgKTsKCQlyZXN1bHQgPSBpZCggInF1bml0LXRlc3RyZXN1bHQiICk7CgoJCWlmICggdGVzdHMgKSB7CgkJCXRlc3RzLmlubmVySFRNTCA9ICIiOwoJCX0KCgkJaWYgKCBiYW5uZXIgKSB7CgkJCWJhbm5lci5jbGFzc05hbWUgPSAiIjsKCQl9CgoJCWlmICggcmVzdWx0ICkgewoJCQlyZXN1bHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggcmVzdWx0ICk7CgkJfQoKCQlpZiAoIHRlc3RzICkgewoJCQlyZXN1bHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAicCIgKTsKCQkJcmVzdWx0LmlkID0gInF1bml0LXRlc3RyZXN1bHQiOwoJCQlyZXN1bHQuY2xhc3NOYW1lID0gInJlc3VsdCI7CgkJCXRlc3RzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCByZXN1bHQsIHRlc3RzICk7CgkJCXJlc3VsdC5pbm5lckhUTUwgPSAiUnVubmluZy4uLjxici8+Jm5ic3A7IjsKCQl9Cgl9LAoKCS8vIFJlc2V0cyB0aGUgdGVzdCBzZXR1cC4gVXNlZnVsIGZvciB0ZXN0cyB0aGF0IG1vZGlmeSB0aGUgRE9NLgoJLyoKCURFUFJFQ0FURUQ6IFVzZSBtdWx0aXBsZSB0ZXN0cyBpbnN0ZWFkIG9mIHJlc2V0dGluZyBpbnNpZGUgYSB0ZXN0LgoJVXNlIHRlc3RTdGFydCBvciB0ZXN0RG9uZSBmb3IgY3VzdG9tIGNsZWFudXAuCglUaGlzIG1ldGhvZCB3aWxsIHRocm93IGFuIGVycm9yIGluIDIuMCwgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiAyLjEKCSovCglyZXNldDogZnVuY3Rpb24oKSB7CgkJdmFyIGZpeHR1cmUgPSBpZCggInF1bml0LWZpeHR1cmUiICk7CgkJaWYgKCBmaXh0dXJlICkgewoJCQlmaXh0dXJlLmlubmVySFRNTCA9IGNvbmZpZy5maXh0dXJlOwoJCX0KCX0sCgoJLy8gU2FmZSBvYmplY3QgdHlwZSBjaGVja2luZwoJaXM6IGZ1bmN0aW9uKCB0eXBlLCBvYmogKSB7CgkJcmV0dXJuIFFVbml0Lm9iamVjdFR5cGUoIG9iaiApID09PSB0eXBlOwoJfSwKCglvYmplY3RUeXBlOiBmdW5jdGlvbiggb2JqICkgewoJCWlmICggdHlwZW9mIG9iaiA9PT0gInVuZGVmaW5lZCIgKSB7CgkJCXJldHVybiAidW5kZWZpbmVkIjsKCQl9CgoJCS8vIENvbnNpZGVyOiB0eXBlb2YgbnVsbCA9PT0gb2JqZWN0CgkJaWYgKCBvYmogPT09IG51bGwgKSB7CgkJCXJldHVybiAibnVsbCI7CgkJfQoKCQl2YXIgbWF0Y2ggPSB0b1N0cmluZy5jYWxsKCBvYmogKS5tYXRjaCgvXlxbb2JqZWN0XHMoLiopXF0kLyksCgkJCXR5cGUgPSBtYXRjaCAmJiBtYXRjaFsxXSB8fCAiIjsKCgkJc3dpdGNoICggdHlwZSApIHsKCQkJY2FzZSAiTnVtYmVyIjoKCQkJCWlmICggaXNOYU4ob2JqKSApIHsKCQkJCQlyZXR1cm4gIm5hbiI7CgkJCQl9CgkJCQlyZXR1cm4gIm51bWJlciI7CgkJCWNhc2UgIlN0cmluZyI6CgkJCWNhc2UgIkJvb2xlYW4iOgoJCQljYXNlICJBcnJheSI6CgkJCWNhc2UgIkRhdGUiOgoJCQljYXNlICJSZWdFeHAiOgoJCQljYXNlICJGdW5jdGlvbiI6CgkJCQlyZXR1cm4gdHlwZS50b0xvd2VyQ2FzZSgpOwoJCX0KCQlpZiAoIHR5cGVvZiBvYmogPT09ICJvYmplY3QiICkgewoJCQlyZXR1cm4gIm9iamVjdCI7CgkJfQoJCXJldHVybiB1bmRlZmluZWQ7Cgl9LAoKCXB1c2g6IGZ1bmN0aW9uKCByZXN1bHQsIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UgKSB7CgkJaWYgKCAhY29uZmlnLmN1cnJlbnQgKSB7CgkJCXRocm93IG5ldyBFcnJvciggImFzc2VydGlvbiBvdXRzaWRlIHRlc3QgY29udGV4dCwgd2FzICIgKyBzb3VyY2VGcm9tU3RhY2t0cmFjZSgpICk7CgkJfQoKCQl2YXIgb3V0cHV0LCBzb3VyY2UsCgkJCWRldGFpbHMgPSB7CgkJCQltb2R1bGU6IGNvbmZpZy5jdXJyZW50Lm1vZHVsZSwKCQkJCW5hbWU6IGNvbmZpZy5jdXJyZW50LnRlc3ROYW1lLAoJCQkJcmVzdWx0OiByZXN1bHQsCgkJCQltZXNzYWdlOiBtZXNzYWdlLAoJCQkJYWN0dWFsOiBhY3R1YWwsCgkJCQlleHBlY3RlZDogZXhwZWN0ZWQKCQkJfTsKCgkJbWVzc2FnZSA9IGVzY2FwZVRleHQoIG1lc3NhZ2UgKSB8fCAoIHJlc3VsdCA\/ICJva2F5IiA6ICJmYWlsZWQiICk7CgkJbWVzc2FnZSA9ICI8c3BhbiBjbGFzcz0ndGVzdC1tZXNzYWdlJz4iICsgbWVzc2FnZSArICI8L3NwYW4+IjsKCQlvdXRwdXQgPSBtZXNzYWdlOwoKCQlpZiAoICFyZXN1bHQgKSB7CgkJCWV4cGVjdGVkID0gZXNjYXBlVGV4dCggUVVuaXQuanNEdW1wLnBhcnNlKGV4cGVjdGVkKSApOwoJCQlhY3R1YWwgPSBlc2NhcGVUZXh0KCBRVW5pdC5qc0R1bXAucGFyc2UoYWN0dWFsKSApOwoJCQlvdXRwdXQgKz0gIjx0YWJsZT48dHIgY2xhc3M9J3Rlc3QtZXhwZWN0ZWQnPjx0aD5FeHBlY3RlZDogPC90aD48dGQ+PHByZT4iICsgZXhwZWN0ZWQgKyAiPC9wcmU+PC90ZD48L3RyPiI7CgoJCQlpZiAoIGFjdHVhbCAhPT0gZXhwZWN0ZWQgKSB7CgkJCQlvdXRwdXQgKz0gIjx0ciBjbGFzcz0ndGVzdC1hY3R1YWwnPjx0aD5SZXN1bHQ6IDwvdGg+PHRkPjxwcmU+IiArIGFjdHVhbCArICI8L3ByZT48L3RkPjwvdHI+IjsKCQkJCW91dHB1dCArPSAiPHRyIGNsYXNzPSd0ZXN0LWRpZmYnPjx0aD5EaWZmOiA8L3RoPjx0ZD48cHJlPiIgKyBRVW5pdC5kaWZmKCBleHBlY3RlZCwgYWN0dWFsICkgKyAiPC9wcmU+PC90ZD48L3RyPiI7CgkJCX0KCgkJCXNvdXJjZSA9IHNvdXJjZUZyb21TdGFja3RyYWNlKCk7CgoJCQlpZiAoIHNvdXJjZSApIHsKCQkJCWRldGFpbHMuc291cmNlID0gc291cmNlOwoJCQkJb3V0cHV0ICs9ICI8dHIgY2xhc3M9J3Rlc3Qtc291cmNlJz48dGg+U291cmNlOiA8L3RoPjx0ZD48cHJlPiIgKyBlc2NhcGVUZXh0KCBzb3VyY2UgKSArICI8L3ByZT48L3RkPjwvdHI+IjsKCQkJfQoKCQkJb3V0cHV0ICs9ICI8L3RhYmxlPiI7CgkJfQoKCQlydW5Mb2dnaW5nQ2FsbGJhY2tzKCAibG9nIiwgUVVuaXQsIGRldGFpbHMgKTsKCgkJY29uZmlnLmN1cnJlbnQuYXNzZXJ0aW9ucy5wdXNoKHsKCQkJcmVzdWx0OiAhIXJlc3VsdCwKCQkJbWVzc2FnZTogb3V0cHV0CgkJfSk7Cgl9LAoKCXB1c2hGYWlsdXJlOiBmdW5jdGlvbiggbWVzc2FnZSwgc291cmNlLCBhY3R1YWwgKSB7CgkJaWYgKCAhY29uZmlnLmN1cnJlbnQgKSB7CgkJCXRocm93IG5ldyBFcnJvciggInB1c2hGYWlsdXJlKCkgYXNzZXJ0aW9uIG91dHNpZGUgdGVzdCBjb250ZXh0LCB3YXMgIiArIHNvdXJjZUZyb21TdGFja3RyYWNlKDIpICk7CgkJfQoKCQl2YXIgb3V0cHV0LAoJCQlkZXRhaWxzID0gewoJCQkJbW9kdWxlOiBjb25maWcuY3VycmVudC5tb2R1bGUsCgkJCQluYW1lOiBjb25maWcuY3VycmVudC50ZXN0TmFtZSwKCQkJCXJlc3VsdDogZmFsc2UsCgkJCQltZXNzYWdlOiBtZXNzYWdlCgkJCX07CgoJCW1lc3NhZ2UgPSBlc2NhcGVUZXh0KCBtZXNzYWdlICkgfHwgImVycm9yIjsKCQltZXNzYWdlID0gIjxzcGFuIGNsYXNzPSd0ZXN0LW1lc3NhZ2UnPiIgKyBtZXNzYWdlICsgIjwvc3Bhbj4iOwoJCW91dHB1dCA9IG1lc3NhZ2U7CgoJCW91dHB1dCArPSAiPHRhYmxlPiI7CgoJCWlmICggYWN0dWFsICkgewoJCQlvdXRwdXQgKz0gIjx0ciBjbGFzcz0ndGVzdC1hY3R1YWwnPjx0aD5SZXN1bHQ6IDwvdGg+PHRkPjxwcmU+IiArIGVzY2FwZVRleHQoIGFjdHVhbCApICsgIjwvcHJlPjwvdGQ+PC90cj4iOwoJCX0KCgkJaWYgKCBzb3VyY2UgKSB7CgkJCWRldGFpbHMuc291cmNlID0gc291cmNlOwoJCQlvdXRwdXQgKz0gIjx0ciBjbGFzcz0ndGVzdC1zb3VyY2UnPjx0aD5Tb3VyY2U6IDwvdGg+PHRkPjxwcmU+IiArIGVzY2FwZVRleHQoIHNvdXJjZSApICsgIjwvcHJlPjwvdGQ+PC90cj4iOwoJCX0KCgkJb3V0cHV0ICs9ICI8L3RhYmxlPiI7CgoJCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICJsb2ciLCBRVW5pdCwgZGV0YWlscyApOwoKCQljb25maWcuY3VycmVudC5hc3NlcnRpb25zLnB1c2goewoJCQlyZXN1bHQ6IGZhbHNlLAoJCQltZXNzYWdlOiBvdXRwdXQKCQl9KTsKCX0sCgoJdXJsOiBmdW5jdGlvbiggcGFyYW1zICkgewoJCXBhcmFtcyA9IGV4dGVuZCggZXh0ZW5kKCB7fSwgUVVuaXQudXJsUGFyYW1zICksIHBhcmFtcyApOwoJCXZhciBrZXksCgkJCXF1ZXJ5c3RyaW5nID0gIj8iOwoKCQlmb3IgKCBrZXkgaW4gcGFyYW1zICkgewoJCQlpZiAoIGhhc093bi5jYWxsKCBwYXJhbXMsIGtleSApICkgewoJCQkJcXVlcnlzdHJpbmcgKz0gZW5jb2RlVVJJQ29tcG9uZW50KCBrZXkgKSArICI9IiArCgkJCQkJZW5jb2RlVVJJQ29tcG9uZW50KCBwYXJhbXNbIGtleSBdICkgKyAiJiI7CgkJCX0KCQl9CgkJcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArCgkJCXdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIHF1ZXJ5c3RyaW5nLnNsaWNlKCAwLCAtMSApOwoJfSwKCglleHRlbmQ6IGV4dGVuZCwKCWlkOiBpZCwKCWFkZEV2ZW50OiBhZGRFdmVudCwKCWFkZENsYXNzOiBhZGRDbGFzcywKCWhhc0NsYXNzOiBoYXNDbGFzcywKCXJlbW92ZUNsYXNzOiByZW1vdmVDbGFzcwoJLy8gbG9hZCwgZXF1aXYsIGpzRHVtcCwgZGlmZjogQXR0YWNoZWQgbGF0ZXIKfSk7CgovKioKICogQGRlcHJlY2F0ZWQ6IENyZWF0ZWQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGggdGVzdCBydW5uZXIgdGhhdCBzZXQgdGhlIGhvb2sgZnVuY3Rpb24KICogaW50byBRVW5pdC57aG9va30sIGluc3RlYWQgb2YgaW52b2tpbmcgaXQgYW5kIHBhc3NpbmcgdGhlIGhvb2sgZnVuY3Rpb24uCiAqIFFVbml0LmNvbnN0cnVjdG9yIGlzIHNldCB0byB0aGUgZW1wdHkgRigpIGFib3ZlIHNvIHRoYXQgd2UgY2FuIGFkZCB0byBpdCdzIHByb3RvdHlwZSBoZXJlLgogKiBEb2luZyB0aGlzIGFsbG93cyB1cyB0byB0ZWxsIGlmIHRoZSBmb2xsb3dpbmcgbWV0aG9kcyBoYXZlIGJlZW4gb3ZlcndyaXR0ZW4gb24gdGhlIGFjdHVhbAogKiBRVW5pdCBvYmplY3QuCiAqLwpleHRlbmQoIFFVbml0LmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgewoKCS8vIExvZ2dpbmcgY2FsbGJhY2tzOyBhbGwgcmVjZWl2ZSBhIHNpbmdsZSBhcmd1bWVudCB3aXRoIHRoZSBsaXN0ZWQgcHJvcGVydGllcwoJLy8gcnVuIHRlc3QvbG9ncy5odG1sIGZvciBhbnkgcmVsYXRlZCBjaGFuZ2VzCgliZWdpbjogcmVnaXN0ZXJMb2dnaW5nQ2FsbGJhY2soICJiZWdpbiIgKSwKCgkvLyBkb25lOiB7IGZhaWxlZCwgcGFzc2VkLCB0b3RhbCwgcnVudGltZSB9Cglkb25lOiByZWdpc3RlckxvZ2dpbmdDYWxsYmFjayggImRvbmUiICksCgoJLy8gbG9nOiB7IHJlc3VsdCwgYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSB9Cglsb2c6IHJlZ2lzdGVyTG9nZ2luZ0NhbGxiYWNrKCAibG9nIiApLAoKCS8vIHRlc3RTdGFydDogeyBuYW1lIH0KCXRlc3RTdGFydDogcmVnaXN0ZXJMb2dnaW5nQ2FsbGJhY2soICJ0ZXN0U3RhcnQiICksCgoJLy8gdGVzdERvbmU6IHsgbmFtZSwgZmFpbGVkLCBwYXNzZWQsIHRvdGFsLCBydW50aW1lIH0KCXRlc3REb25lOiByZWdpc3RlckxvZ2dpbmdDYWxsYmFjayggInRlc3REb25lIiApLAoKCS8vIG1vZHVsZVN0YXJ0OiB7IG5hbWUgfQoJbW9kdWxlU3RhcnQ6IHJlZ2lzdGVyTG9nZ2luZ0NhbGxiYWNrKCAibW9kdWxlU3RhcnQiICksCgoJLy8gbW9kdWxlRG9uZTogeyBuYW1lLCBmYWlsZWQsIHBhc3NlZCwgdG90YWwgfQoJbW9kdWxlRG9uZTogcmVnaXN0ZXJMb2dnaW5nQ2FsbGJhY2soICJtb2R1bGVEb25lIiApCn0pOwoKaWYgKCAhZGVmaW5lZC5kb2N1bWVudCB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJY29uZmlnLmF1dG9ydW4gPSB0cnVlOwp9CgpRVW5pdC5sb2FkID0gZnVuY3Rpb24oKSB7CglydW5Mb2dnaW5nQ2FsbGJhY2tzKCAiYmVnaW4iLCBRVW5pdCwge30gKTsKCgkvLyBJbml0aWFsaXplIHRoZSBjb25maWcsIHNhdmluZyB0aGUgZXhlY3V0aW9uIHF1ZXVlCgl2YXIgYmFubmVyLCBmaWx0ZXIsIGksIGosIGxhYmVsLCBsZW4sIG1haW4sIG9sLCB0b29sYmFyLCB2YWwsIHNlbGVjdGlvbiwKCQl1cmxDb25maWdDb250YWluZXIsIG1vZHVsZUZpbHRlciwgdXNlckFnZW50LAoJCW51bU1vZHVsZXMgPSAwLAoJCW1vZHVsZU5hbWVzID0gW10sCgkJbW9kdWxlRmlsdGVySHRtbCA9ICIiLAoJCXVybENvbmZpZ0h0bWwgPSAiIiwKCQlvbGRjb25maWcgPSBleHRlbmQoIHt9LCBjb25maWcgKTsKCglRVW5pdC5pbml0KCk7CglleHRlbmQoY29uZmlnLCBvbGRjb25maWcpOwoKCWNvbmZpZy5ibG9ja2luZyA9IGZhbHNlOwoKCWxlbiA9IGNvbmZpZy51cmxDb25maWcubGVuZ3RoOwoKCWZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7CgkJdmFsID0gY29uZmlnLnVybENvbmZpZ1tpXTsKCQlpZiAoIHR5cGVvZiB2YWwgPT09ICJzdHJpbmciICkgewoJCQl2YWwgPSB7CgkJCQlpZDogdmFsLAoJCQkJbGFiZWw6IHZhbAoJCQl9OwoJCX0KCQljb25maWdbIHZhbC5pZCBdID0gUVVuaXQudXJsUGFyYW1zWyB2YWwuaWQgXTsKCQlpZiAoICF2YWwudmFsdWUgfHwgdHlwZW9mIHZhbC52YWx1ZSA9PT0gInN0cmluZyIgKSB7CgkJCXVybENvbmZpZ0h0bWwgKz0gIjxpbnB1dCBpZD0ncXVuaXQtdXJsY29uZmlnLSIgKyBlc2NhcGVUZXh0KCB2YWwuaWQgKSArCgkJCQkiJyBuYW1lPSciICsgZXNjYXBlVGV4dCggdmFsLmlkICkgKwoJCQkJIicgdHlwZT0nY2hlY2tib3gnIiArCgkJCQkoIHZhbC52YWx1ZSA\/ICIgdmFsdWU9JyIgKyBlc2NhcGVUZXh0KCB2YWwudmFsdWUgKSArICInIiA6ICIiICkgKwoJCQkJKCBjb25maWdbIHZhbC5pZCBdID8gIiBjaGVja2VkPSdjaGVja2VkJyIgOiAiIiApICsKCQkJCSIgdGl0bGU9JyIgKyBlc2NhcGVUZXh0KCB2YWwudG9vbHRpcCApICsKCQkJCSInPjxsYWJlbCBmb3I9J3F1bml0LXVybGNvbmZpZy0iICsgZXNjYXBlVGV4dCggdmFsLmlkICkgKwoJCQkJIicgdGl0bGU9JyIgKyBlc2NhcGVUZXh0KCB2YWwudG9vbHRpcCApICsgIic+IiArIHZhbC5sYWJlbCArICI8L2xhYmVsPiI7CgkJfSBlbHNlIHsKCQkJdXJsQ29uZmlnSHRtbCArPSAiPGxhYmVsIGZvcj0ncXVuaXQtdXJsY29uZmlnLSIgKyBlc2NhcGVUZXh0KCB2YWwuaWQgKSArCgkJCQkiJyB0aXRsZT0nIiArIGVzY2FwZVRleHQoIHZhbC50b29sdGlwICkgKwoJCQkJIic+IiArIHZhbC5sYWJlbCArCgkJCQkiOiA8L2xhYmVsPjxzZWxlY3QgaWQ9J3F1bml0LXVybGNvbmZpZy0iICsgZXNjYXBlVGV4dCggdmFsLmlkICkgKwoJCQkJIicgbmFtZT0nIiArIGVzY2FwZVRleHQoIHZhbC5pZCApICsKCQkJCSInIHRpdGxlPSciICsgZXNjYXBlVGV4dCggdmFsLnRvb2x0aXAgKSArCgkJCQkiJz48b3B0aW9uPjwvb3B0aW9uPiI7CgkJCXNlbGVjdGlvbiA9IGZhbHNlOwoJCQlpZiAoIFFVbml0LmlzKCAiYXJyYXkiLCB2YWwudmFsdWUgKSApIHsKCQkJCWZvciAoIGogPSAwOyBqIDwgdmFsLnZhbHVlLmxlbmd0aDsgaisrICkgewoJCQkJCXVybENvbmZpZ0h0bWwgKz0gIjxvcHRpb24gdmFsdWU9JyIgKyBlc2NhcGVUZXh0KCB2YWwudmFsdWVbal0gKSArICInIiArCgkJCQkJCSggY29uZmlnWyB2YWwuaWQgXSA9PT0gdmFsLnZhbHVlW2pdID8KCQkJCQkJCShzZWxlY3Rpb24gPSB0cnVlKSAmJiAiIHNlbGVjdGVkPSdzZWxlY3RlZCciIDoKCQkJCQkJCSIiICkgKwoJCQkJCQkiPiIgKyBlc2NhcGVUZXh0KCB2YWwudmFsdWVbal0gKSArICI8L29wdGlvbj4iOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaiBpbiB2YWwudmFsdWUgKSB7CgkJCQkJaWYgKCBoYXNPd24uY2FsbCggdmFsLnZhbHVlLCBqICkgKSB7CgkJCQkJCXVybENvbmZpZ0h0bWwgKz0gIjxvcHRpb24gdmFsdWU9JyIgKyBlc2NhcGVUZXh0KCBqICkgKyAiJyIgKwoJCQkJCQkJKCBjb25maWdbIHZhbC5pZCBdID09PSBqID8KCQkJCQkJCQkoc2VsZWN0aW9uID0gdHJ1ZSkgJiYgIiBzZWxlY3RlZD0nc2VsZWN0ZWQnIiA6CgkJCQkJCQkJIiIgKSArCgkJCQkJCQkiPiIgKyBlc2NhcGVUZXh0KCB2YWwudmFsdWVbal0gKSArICI8L29wdGlvbj4iOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQlpZiAoIGNvbmZpZ1sgdmFsLmlkIF0gJiYgIXNlbGVjdGlvbiApIHsKCQkJCXVybENvbmZpZ0h0bWwgKz0gIjxvcHRpb24gdmFsdWU9JyIgKyBlc2NhcGVUZXh0KCBjb25maWdbIHZhbC5pZCBdICkgKwoJCQkJCSInIHNlbGVjdGVkPSdzZWxlY3RlZCcgZGlzYWJsZWQ9J2Rpc2FibGVkJz4iICsKCQkJCQllc2NhcGVUZXh0KCBjb25maWdbIHZhbC5pZCBdICkgKwoJCQkJCSI8L29wdGlvbj4iOwoJCQl9CgkJCXVybENvbmZpZ0h0bWwgKz0gIjwvc2VsZWN0PiI7CgkJfQoJfQoJZm9yICggaSBpbiBjb25maWcubW9kdWxlcyApIHsKCQlpZiAoIGNvbmZpZy5tb2R1bGVzLmhhc093blByb3BlcnR5KCBpICkgKSB7CgkJCW1vZHVsZU5hbWVzLnB1c2goaSk7CgkJfQoJfQoJbnVtTW9kdWxlcyA9IG1vZHVsZU5hbWVzLmxlbmd0aDsKCW1vZHVsZU5hbWVzLnNvcnQoIGZ1bmN0aW9uKCBhLCBiICkgewoJCXJldHVybiBhLmxvY2FsZUNvbXBhcmUoIGIgKTsKCX0pOwoJbW9kdWxlRmlsdGVySHRtbCArPSAiPGxhYmVsIGZvcj0ncXVuaXQtbW9kdWxlZmlsdGVyJz5Nb2R1bGU6IDwvbGFiZWw+PHNlbGVjdCBpZD0ncXVuaXQtbW9kdWxlZmlsdGVyJyBuYW1lPSdtb2R1bGVmaWx0ZXInPjxvcHRpb24gdmFsdWU9JycgIiArCgkJKCBjb25maWcubW9kdWxlID09PSB1bmRlZmluZWQgID8gInNlbGVjdGVkPSdzZWxlY3RlZCciIDogIiIgKSArCgkJIj48IEFsbCBNb2R1bGVzID48L29wdGlvbj4iOwoKCglmb3IgKCBpID0gMDsgaSA8IG51bU1vZHVsZXM7IGkrKykgewoJCQltb2R1bGVGaWx0ZXJIdG1sICs9ICI8b3B0aW9uIHZhbHVlPSciICsgZXNjYXBlVGV4dCggZW5jb2RlVVJJQ29tcG9uZW50KG1vZHVsZU5hbWVzW2ldKSApICsgIicgIiArCgkJCQkoIGNvbmZpZy5tb2R1bGUgPT09IG1vZHVsZU5hbWVzW2ldID8gInNlbGVjdGVkPSdzZWxlY3RlZCciIDogIiIgKSArCgkJCQkiPiIgKyBlc2NhcGVUZXh0KG1vZHVsZU5hbWVzW2ldKSArICI8L29wdGlvbj4iOwoJfQoJbW9kdWxlRmlsdGVySHRtbCArPSAiPC9zZWxlY3Q+IjsKCgkvLyBgdXNlckFnZW50YCBpbml0aWFsaXplZCBhdCB0b3Agb2Ygc2NvcGUKCXVzZXJBZ2VudCA9IGlkKCAicXVuaXQtdXNlckFnZW50IiApOwoJaWYgKCB1c2VyQWdlbnQgKSB7CgkJdXNlckFnZW50LmlubmVySFRNTCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7Cgl9CgoJLy8gYGJhbm5lcmAgaW5pdGlhbGl6ZWQgYXQgdG9wIG9mIHNjb3BlCgliYW5uZXIgPSBpZCggInF1bml0LWhlYWRlciIgKTsKCWlmICggYmFubmVyICkgewoJCWJhbm5lci5pbm5lckhUTUwgPSAiPGEgaHJlZj0nIiArIFFVbml0LnVybCh7IGZpbHRlcjogdW5kZWZpbmVkLCBtb2R1bGU6IHVuZGVmaW5lZCwgdGVzdE51bWJlcjogdW5kZWZpbmVkIH0pICsgIic+IiArIGJhbm5lci5pbm5lckhUTUwgKyAiPC9hPiAiOwoJfQoKCS8vIGB0b29sYmFyYCBpbml0aWFsaXplZCBhdCB0b3Agb2Ygc2NvcGUKCXRvb2xiYXIgPSBpZCggInF1bml0LXRlc3RydW5uZXItdG9vbGJhciIgKTsKCWlmICggdG9vbGJhciApIHsKCQkvLyBgZmlsdGVyYCBpbml0aWFsaXplZCBhdCB0b3Agb2Ygc2NvcGUKCQlmaWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiaW5wdXQiICk7CgkJZmlsdGVyLnR5cGUgPSAiY2hlY2tib3giOwoJCWZpbHRlci5pZCA9ICJxdW5pdC1maWx0ZXItcGFzcyI7CgoJCWFkZEV2ZW50KCBmaWx0ZXIsICJjbGljayIsIGZ1bmN0aW9uKCkgewoJCQl2YXIgdG1wLAoJCQkJb2wgPSBpZCggInF1bml0LXRlc3RzIiApOwoKCQkJaWYgKCBmaWx0ZXIuY2hlY2tlZCApIHsKCQkJCW9sLmNsYXNzTmFtZSA9IG9sLmNsYXNzTmFtZSArICIgaGlkZXBhc3MiOwoJCQl9IGVsc2UgewoJCQkJdG1wID0gIiAiICsgb2wuY2xhc3NOYW1lLnJlcGxhY2UoIC9bXG5cdFxyXS9nLCAiICIgKSArICIgIjsKCQkJCW9sLmNsYXNzTmFtZSA9IHRtcC5yZXBsYWNlKCAvIGhpZGVwYXNzIC8sICIgIiApOwoJCQl9CgkJCWlmICggZGVmaW5lZC5zZXNzaW9uU3RvcmFnZSApIHsKCQkJCWlmIChmaWx0ZXIuY2hlY2tlZCkgewoJCQkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oICJxdW5pdC1maWx0ZXItcGFzc2VkLXRlc3RzIiwgInRydWUiICk7CgkJCQl9IGVsc2UgewoJCQkJCXNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oICJxdW5pdC1maWx0ZXItcGFzc2VkLXRlc3RzIiApOwoJCQkJfQoJCQl9CgkJfSk7CgoJCWlmICggY29uZmlnLmhpZGVwYXNzZWQgfHwgZGVmaW5lZC5zZXNzaW9uU3RvcmFnZSAmJiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCAicXVuaXQtZmlsdGVyLXBhc3NlZC10ZXN0cyIgKSApIHsKCQkJZmlsdGVyLmNoZWNrZWQgPSB0cnVlOwoJCQkvLyBgb2xgIGluaXRpYWxpemVkIGF0IHRvcCBvZiBzY29wZQoJCQlvbCA9IGlkKCAicXVuaXQtdGVzdHMiICk7CgkJCW9sLmNsYXNzTmFtZSA9IG9sLmNsYXNzTmFtZSArICIgaGlkZXBhc3MiOwoJCX0KCQl0b29sYmFyLmFwcGVuZENoaWxkKCBmaWx0ZXIgKTsKCgkJLy8gYGxhYmVsYCBpbml0aWFsaXplZCBhdCB0b3Agb2Ygc2NvcGUKCQlsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJsYWJlbCIgKTsKCQlsYWJlbC5zZXRBdHRyaWJ1dGUoICJmb3IiLCAicXVuaXQtZmlsdGVyLXBhc3MiICk7CgkJbGFiZWwuc2V0QXR0cmlidXRlKCAidGl0bGUiLCAiT25seSBzaG93IHRlc3RzIGFuZCBhc3NlcnRpb25zIHRoYXQgZmFpbC4gU3RvcmVkIGluIHNlc3Npb25TdG9yYWdlLiIgKTsKCQlsYWJlbC5pbm5lckhUTUwgPSAiSGlkZSBwYXNzZWQgdGVzdHMiOwoJCXRvb2xiYXIuYXBwZW5kQ2hpbGQoIGxhYmVsICk7CgoJCXVybENvbmZpZ0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKCQl1cmxDb25maWdDb250YWluZXIuaW5uZXJIVE1MID0gdXJsQ29uZmlnSHRtbDsKCQkvLyBGb3Igb2xkSUUgc3VwcG9ydDoKCQkvLyAqIEFkZCBoYW5kbGVycyB0byB0aGUgaW5kaXZpZHVhbCBlbGVtZW50cyBpbnN0ZWFkIG9mIHRoZSBjb250YWluZXIKCQkvLyAqIFVzZSAiY2xpY2siIGluc3RlYWQgb2YgImNoYW5nZSIgZm9yIGNoZWNrYm94ZXMKCQkvLyAqIEZhbGxiYWNrIGZyb20gZXZlbnQudGFyZ2V0IHRvIGV2ZW50LnNyY0VsZW1lbnQKCQlhZGRFdmVudHMoIHVybENvbmZpZ0NvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKSwgImNsaWNrIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgcGFyYW1zID0ge30sCgkJCQl0YXJnZXQgPSBldmVudC50YXJnZXQgfHwgZXZlbnQuc3JjRWxlbWVudDsKCQkJcGFyYW1zWyB0YXJnZXQubmFtZSBdID0gdGFyZ2V0LmNoZWNrZWQgPwoJCQkJdGFyZ2V0LmRlZmF1bHRWYWx1ZSB8fCB0cnVlIDoKCQkJCXVuZGVmaW5lZDsKCQkJd2luZG93LmxvY2F0aW9uID0gUVVuaXQudXJsKCBwYXJhbXMgKTsKCQl9KTsKCQlhZGRFdmVudHMoIHVybENvbmZpZ0NvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2VsZWN0IiksICJjaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCXZhciBwYXJhbXMgPSB7fSwKCQkJCXRhcmdldCA9IGV2ZW50LnRhcmdldCB8fCBldmVudC5zcmNFbGVtZW50OwoJCQlwYXJhbXNbIHRhcmdldC5uYW1lIF0gPSB0YXJnZXQub3B0aW9uc1sgdGFyZ2V0LnNlbGVjdGVkSW5kZXggXS52YWx1ZSB8fCB1bmRlZmluZWQ7CgkJCXdpbmRvdy5sb2NhdGlvbiA9IFFVbml0LnVybCggcGFyYW1zICk7CgkJfSk7CgkJdG9vbGJhci5hcHBlbmRDaGlsZCggdXJsQ29uZmlnQ29udGFpbmVyICk7CgoJCWlmIChudW1Nb2R1bGVzID4gMSkgewoJCQltb2R1bGVGaWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAic3BhbiIgKTsKCQkJbW9kdWxlRmlsdGVyLnNldEF0dHJpYnV0ZSggImlkIiwgInF1bml0LW1vZHVsZWZpbHRlci1jb250YWluZXIiICk7CgkJCW1vZHVsZUZpbHRlci5pbm5lckhUTUwgPSBtb2R1bGVGaWx0ZXJIdG1sOwoJCQlhZGRFdmVudCggbW9kdWxlRmlsdGVyLmxhc3RDaGlsZCwgImNoYW5nZSIsIGZ1bmN0aW9uKCkgewoJCQkJdmFyIHNlbGVjdEJveCA9IG1vZHVsZUZpbHRlci5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2VsZWN0IilbMF0sCgkJCQkJc2VsZWN0ZWRNb2R1bGUgPSBkZWNvZGVVUklDb21wb25lbnQoc2VsZWN0Qm94Lm9wdGlvbnNbc2VsZWN0Qm94LnNlbGVjdGVkSW5kZXhdLnZhbHVlKTsKCgkJCQl3aW5kb3cubG9jYXRpb24gPSBRVW5pdC51cmwoewoJCQkJCW1vZHVsZTogKCBzZWxlY3RlZE1vZHVsZSA9PT0gIiIgKSA\/IHVuZGVmaW5lZCA6IHNlbGVjdGVkTW9kdWxlLAoJCQkJCS8vIFJlbW92ZSBhbnkgZXhpc3RpbmcgZmlsdGVycwoJCQkJCWZpbHRlcjogdW5kZWZpbmVkLAoJCQkJCXRlc3ROdW1iZXI6IHVuZGVmaW5lZAoJCQkJfSk7CgkJCX0pOwoJCQl0b29sYmFyLmFwcGVuZENoaWxkKG1vZHVsZUZpbHRlcik7CgkJfQoJfQoKCS8vIGBtYWluYCBpbml0aWFsaXplZCBhdCB0b3Agb2Ygc2NvcGUKCW1haW4gPSBpZCggInF1bml0LWZpeHR1cmUiICk7CglpZiAoIG1haW4gKSB7CgkJY29uZmlnLmZpeHR1cmUgPSBtYWluLmlubmVySFRNTDsKCX0KCglpZiAoIGNvbmZpZy5hdXRvc3RhcnQgKSB7CgkJUVVuaXQuc3RhcnQoKTsKCX0KfTsKCmlmICggZGVmaW5lZC5kb2N1bWVudCApIHsKCWFkZEV2ZW50KCB3aW5kb3csICJsb2FkIiwgUVVuaXQubG9hZCApOwp9CgovLyBgb25FcnJvckZuUHJldmAgaW5pdGlhbGl6ZWQgYXQgdG9wIG9mIHNjb3BlCi8vIFByZXNlcnZlIG90aGVyIGhhbmRsZXJzCm9uRXJyb3JGblByZXYgPSB3aW5kb3cub25lcnJvcjsKCi8vIENvdmVyIHVuY2F1Z2h0IGV4Y2VwdGlvbnMKLy8gUmV0dXJuaW5nIHRydWUgd2lsbCBzdXBwcmVzcyB0aGUgZGVmYXVsdCBicm93c2VyIGhhbmRsZXIsCi8vIHJldHVybmluZyBmYWxzZSB3aWxsIGxldCBpdCBydW4uCndpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24gKCBlcnJvciwgZmlsZVBhdGgsIGxpbmVyTnIgKSB7Cgl2YXIgcmV0ID0gZmFsc2U7CglpZiAoIG9uRXJyb3JGblByZXYgKSB7CgkJcmV0ID0gb25FcnJvckZuUHJldiggZXJyb3IsIGZpbGVQYXRoLCBsaW5lck5yICk7Cgl9CgoJLy8gVHJlYXQgcmV0dXJuIHZhbHVlIGFzIHdpbmRvdy5vbmVycm9yIGl0c2VsZiBkb2VzLAoJLy8gT25seSBkbyBvdXIgaGFuZGxpbmcgaWYgbm90IHN1cHByZXNzZWQuCglpZiAoIHJldCAhPT0gdHJ1ZSApIHsKCQlpZiAoIFFVbml0LmNvbmZpZy5jdXJyZW50ICkgewoJCQlpZiAoIFFVbml0LmNvbmZpZy5jdXJyZW50Lmlnbm9yZUdsb2JhbEVycm9ycyApIHsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJCVFVbml0LnB1c2hGYWlsdXJlKCBlcnJvciwgZmlsZVBhdGggKyAiOiIgKyBsaW5lck5yICk7CgkJfSBlbHNlIHsKCQkJUVVuaXQudGVzdCggImdsb2JhbCBmYWlsdXJlIiwgZXh0ZW5kKCBmdW5jdGlvbigpIHsKCQkJCVFVbml0LnB1c2hGYWlsdXJlKCBlcnJvciwgZmlsZVBhdGggKyAiOiIgKyBsaW5lck5yICk7CgkJCX0sIHsgdmFsaWRUZXN0OiB2YWxpZFRlc3QgfSApICk7CgkJfQoJCXJldHVybiBmYWxzZTsKCX0KCglyZXR1cm4gcmV0Owp9OwoKZnVuY3Rpb24gZG9uZSgpIHsKCWNvbmZpZy5hdXRvcnVuID0gdHJ1ZTsKCgkvLyBMb2cgdGhlIGxhc3QgbW9kdWxlIHJlc3VsdHMKCWlmICggY29uZmlnLnByZXZpb3VzTW9kdWxlICkgewoJCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICJtb2R1bGVEb25lIiwgUVVuaXQsIHsKCQkJbmFtZTogY29uZmlnLnByZXZpb3VzTW9kdWxlLAoJCQlmYWlsZWQ6IGNvbmZpZy5tb2R1bGVTdGF0cy5iYWQsCgkJCXBhc3NlZDogY29uZmlnLm1vZHVsZVN0YXRzLmFsbCAtIGNvbmZpZy5tb2R1bGVTdGF0cy5iYWQsCgkJCXRvdGFsOiBjb25maWcubW9kdWxlU3RhdHMuYWxsCgkJfSk7Cgl9CglkZWxldGUgY29uZmlnLnByZXZpb3VzTW9kdWxlOwoKCXZhciBpLCBrZXksCgkJYmFubmVyID0gaWQoICJxdW5pdC1iYW5uZXIiICksCgkJdGVzdHMgPSBpZCggInF1bml0LXRlc3RzIiApLAoJCXJ1bnRpbWUgPSArbmV3IERhdGUoKSAtIGNvbmZpZy5zdGFydGVkLAoJCXBhc3NlZCA9IGNvbmZpZy5zdGF0cy5hbGwgLSBjb25maWcuc3RhdHMuYmFkLAoJCWh0bWwgPSBbCgkJCSJUZXN0cyBjb21wbGV0ZWQgaW4gIiwKCQkJcnVudGltZSwKCQkJIiBtaWxsaXNlY29uZHMuPGJyLz4iLAoJCQkiPHNwYW4gY2xhc3M9J3Bhc3NlZCc+IiwKCQkJcGFzc2VkLAoJCQkiPC9zcGFuPiBhc3NlcnRpb25zIG9mIDxzcGFuIGNsYXNzPSd0b3RhbCc+IiwKCQkJY29uZmlnLnN0YXRzLmFsbCwKCQkJIjwvc3Bhbj4gcGFzc2VkLCA8c3BhbiBjbGFzcz0nZmFpbGVkJz4iLAoJCQljb25maWcuc3RhdHMuYmFkLAoJCQkiPC9zcGFuPiBmYWlsZWQuIgoJCV0uam9pbiggIiIgKTsKCglpZiAoIGJhbm5lciApIHsKCQliYW5uZXIuY2xhc3NOYW1lID0gKCBjb25maWcuc3RhdHMuYmFkID8gInF1bml0LWZhaWwiIDogInF1bml0LXBhc3MiICk7Cgl9CgoJaWYgKCB0ZXN0cyApIHsKCQlpZCggInF1bml0LXRlc3RyZXN1bHQiICkuaW5uZXJIVE1MID0gaHRtbDsKCX0KCglpZiAoIGNvbmZpZy5hbHRlcnRpdGxlICYmIGRlZmluZWQuZG9jdW1lbnQgJiYgZG9jdW1lbnQudGl0bGUgKSB7CgkJLy8gc2hvdyDinJYgZm9yIGdvb2QsIOKclCBmb3IgYmFkIHN1aXRlIHJlc3VsdCBpbiB0aXRsZQoJCS8vIHVzZSBlc2NhcGUgc2VxdWVuY2VzIGluIGNhc2UgZmlsZSBnZXRzIGxvYWRlZCB3aXRoIG5vbi11dGYtOC1jaGFyc2V0CgkJZG9jdW1lbnQudGl0bGUgPSBbCgkJCSggY29uZmlnLnN0YXRzLmJhZCA\/ICJcdTI3MTYiIDogIlx1MjcxNCIgKSwKCQkJZG9jdW1lbnQudGl0bGUucmVwbGFjZSggL15bXHUyNzE0XHUyNzE2XSAvaSwgIiIgKQoJCV0uam9pbiggIiAiICk7Cgl9CgoJLy8gY2xlYXIgb3duIHNlc3Npb25TdG9yYWdlIGl0ZW1zIGlmIGFsbCB0ZXN0cyBwYXNzZWQKCWlmICggY29uZmlnLnJlb3JkZXIgJiYgZGVmaW5lZC5zZXNzaW9uU3RvcmFnZSAmJiBjb25maWcuc3RhdHMuYmFkID09PSAwICkgewoJCS8vIGBrZXlgICYgYGlgIGluaXRpYWxpemVkIGF0IHRvcCBvZiBzY29wZQoJCWZvciAoIGkgPSAwOyBpIDwgc2Vzc2lvblN0b3JhZ2UubGVuZ3RoOyBpKysgKSB7CgkJCWtleSA9IHNlc3Npb25TdG9yYWdlLmtleSggaSsrICk7CgkJCWlmICgga2V5LmluZGV4T2YoICJxdW5pdC10ZXN0LSIgKSA9PT0gMCApIHsKCQkJCXNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oIGtleSApOwoJCQl9CgkJfQoJfQoKCS8vIHNjcm9sbCBiYWNrIHRvIHRvcCB0byBzaG93IHJlc3VsdHMKCWlmICggY29uZmlnLnNjcm9sbHRvcCAmJiB3aW5kb3cuc2Nyb2xsVG8gKSB7CgkJd2luZG93LnNjcm9sbFRvKDAsIDApOwoJfQoKCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICJkb25lIiwgUVVuaXQsIHsKCQlmYWlsZWQ6IGNvbmZpZy5zdGF0cy5iYWQsCgkJcGFzc2VkOiBwYXNzZWQsCgkJdG90YWw6IGNvbmZpZy5zdGF0cy5hbGwsCgkJcnVudGltZTogcnVudGltZQoJfSk7Cn0KCi8qKiBAcmV0dXJuIEJvb2xlYW46IHRydWUgaWYgdGhpcyB0ZXN0IHNob3VsZCBiZSByYW4gKi8KZnVuY3Rpb24gdmFsaWRUZXN0KCB0ZXN0ICkgewoJdmFyIGluY2x1ZGUsCgkJZmlsdGVyID0gY29uZmlnLmZpbHRlciAmJiBjb25maWcuZmlsdGVyLnRvTG93ZXJDYXNlKCksCgkJbW9kdWxlID0gY29uZmlnLm1vZHVsZSAmJiBjb25maWcubW9kdWxlLnRvTG93ZXJDYXNlKCksCgkJZnVsbE5hbWUgPSAoIHRlc3QubW9kdWxlICsgIjogIiArIHRlc3QudGVzdE5hbWUgKS50b0xvd2VyQ2FzZSgpOwoKCS8vIEludGVybmFsbHktZ2VuZXJhdGVkIHRlc3RzIGFyZSBhbHdheXMgdmFsaWQKCWlmICggdGVzdC5jYWxsYmFjayAmJiB0ZXN0LmNhbGxiYWNrLnZhbGlkVGVzdCA9PT0gdmFsaWRUZXN0ICkgewoJCWRlbGV0ZSB0ZXN0LmNhbGxiYWNrLnZhbGlkVGVzdDsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglpZiAoIGNvbmZpZy50ZXN0TnVtYmVyLmxlbmd0aCA+IDAgKSB7CgkJaWYgKCBpbkFycmF5KCB0ZXN0LnRlc3ROdW1iZXIsIGNvbmZpZy50ZXN0TnVtYmVyICkgPCAwICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCWlmICggbW9kdWxlICYmICggIXRlc3QubW9kdWxlIHx8IHRlc3QubW9kdWxlLnRvTG93ZXJDYXNlKCkgIT09IG1vZHVsZSApICkgewoJCXJldHVybiBmYWxzZTsKCX0KCglpZiAoICFmaWx0ZXIgKSB7CgkJcmV0dXJuIHRydWU7Cgl9CgoJaW5jbHVkZSA9IGZpbHRlci5jaGFyQXQoIDAgKSAhPT0gIiEiOwoJaWYgKCAhaW5jbHVkZSApIHsKCQlmaWx0ZXIgPSBmaWx0ZXIuc2xpY2UoIDEgKTsKCX0KCgkvLyBJZiB0aGUgZmlsdGVyIG1hdGNoZXMsIHdlIG5lZWQgdG8gaG9ub3VyIGluY2x1ZGUKCWlmICggZnVsbE5hbWUuaW5kZXhPZiggZmlsdGVyICkgIT09IC0xICkgewoJCXJldHVybiBpbmNsdWRlOwoJfQoKCS8vIE90aGVyd2lzZSwgZG8gdGhlIG9wcG9zaXRlCglyZXR1cm4gIWluY2x1ZGU7Cn0KCi8vIHNvIGZhciBzdXBwb3J0cyBvbmx5IEZpcmVmb3gsIENocm9tZSBhbmQgT3BlcmEgKGJ1Z2d5KSwgU2FmYXJpIChmb3IgcmVhbCBleGNlcHRpb25zKQovLyBMYXRlciBTYWZhcmkgYW5kIElFMTAgYXJlIHN1cHBvc2VkIHRvIHN1cHBvcnQgZXJyb3Iuc3RhY2sgYXMgd2VsbAovLyBTZWUgYWxzbyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9FcnJvci9TdGFjawpmdW5jdGlvbiBleHRyYWN0U3RhY2t0cmFjZSggZSwgb2Zmc2V0ICkgewoJb2Zmc2V0ID0gb2Zmc2V0ID09PSB1bmRlZmluZWQgPyAzIDogb2Zmc2V0OwoKCXZhciBzdGFjaywgaW5jbHVkZSwgaTsKCglpZiAoIGUuc3RhY2t0cmFjZSApIHsKCQkvLyBPcGVyYQoJCXJldHVybiBlLnN0YWNrdHJhY2Uuc3BsaXQoICJcbiIgKVsgb2Zmc2V0ICsgMyBdOwoJfSBlbHNlIGlmICggZS5zdGFjayApIHsKCQkvLyBGaXJlZm94LCBDaHJvbWUKCQlzdGFjayA9IGUuc3RhY2suc3BsaXQoICJcbiIgKTsKCQlpZiAoL15lcnJvciQvaS50ZXN0KCBzdGFja1swXSApICkgewoJCQlzdGFjay5zaGlmdCgpOwoJCX0KCQlpZiAoIGZpbGVOYW1lICkgewoJCQlpbmNsdWRlID0gW107CgkJCWZvciAoIGkgPSBvZmZzZXQ7IGkgPCBzdGFjay5sZW5ndGg7IGkrKyApIHsKCQkJCWlmICggc3RhY2tbIGkgXS5pbmRleE9mKCBmaWxlTmFtZSApICE9PSAtMSApIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWluY2x1ZGUucHVzaCggc3RhY2tbIGkgXSApOwoJCQl9CgkJCWlmICggaW5jbHVkZS5sZW5ndGggKSB7CgkJCQlyZXR1cm4gaW5jbHVkZS5qb2luKCAiXG4iICk7CgkJCX0KCQl9CgkJcmV0dXJuIHN0YWNrWyBvZmZzZXQgXTsKCX0gZWxzZSBpZiAoIGUuc291cmNlVVJMICkgewoJCS8vIFNhZmFyaSwgUGhhbnRvbUpTCgkJLy8gaG9wZWZ1bGx5IG9uZSBkYXkgU2FmYXJpIHByb3ZpZGVzIGFjdHVhbCBzdGFja3RyYWNlcwoJCS8vIGV4Y2x1ZGUgdXNlbGVzcyBzZWxmLXJlZmVyZW5jZSBmb3IgZ2VuZXJhdGVkIEVycm9yIG9iamVjdHMKCQlpZiAoIC9xdW5pdC5qcyQvLnRlc3QoIGUuc291cmNlVVJMICkgKSB7CgkJCXJldHVybjsKCQl9CgkJLy8gZm9yIGFjdHVhbCBleGNlcHRpb25zLCB0aGlzIGlzIHVzZWZ1bAoJCXJldHVybiBlLnNvdXJjZVVSTCArICI6IiArIGUubGluZTsKCX0KfQpmdW5jdGlvbiBzb3VyY2VGcm9tU3RhY2t0cmFjZSggb2Zmc2V0ICkgewoJdHJ5IHsKCQl0aHJvdyBuZXcgRXJyb3IoKTsKCX0gY2F0Y2ggKCBlICkgewoJCXJldHVybiBleHRyYWN0U3RhY2t0cmFjZSggZSwgb2Zmc2V0ICk7Cgl9Cn0KCi8qKgogKiBFc2NhcGUgdGV4dCBmb3IgYXR0cmlidXRlIG9yIHRleHQgY29udGVudC4KICovCmZ1bmN0aW9uIGVzY2FwZVRleHQoIHMgKSB7CglpZiAoICFzICkgewoJCXJldHVybiAiIjsKCX0KCXMgPSBzICsgIiI7CgkvLyBCb3RoIHNpbmdsZSBxdW90ZXMgYW5kIGRvdWJsZSBxdW90ZXMgKGZvciBhdHRyaWJ1dGVzKQoJcmV0dXJuIHMucmVwbGFjZSggL1snIjw+Jl0vZywgZnVuY3Rpb24oIHMgKSB7CgkJc3dpdGNoKCBzICkgewoJCQljYXNlICInIjoKCQkJCXJldHVybiAiJiMwMzk7IjsKCQkJY2FzZSAiXCIiOgoJCQkJcmV0dXJuICImcXVvdDsiOwoJCQljYXNlICI8IjoKCQkJCXJldHVybiAiJmx0OyI7CgkJCWNhc2UgIj4iOgoJCQkJcmV0dXJuICImZ3Q7IjsKCQkJY2FzZSAiJiI6CgkJCQlyZXR1cm4gIiZhbXA7IjsKCQl9Cgl9KTsKfQoKZnVuY3Rpb24gc3luY2hyb25pemUoIGNhbGxiYWNrLCBsYXN0ICkgewoJY29uZmlnLnF1ZXVlLnB1c2goIGNhbGxiYWNrICk7CgoJaWYgKCBjb25maWcuYXV0b3J1biAmJiAhY29uZmlnLmJsb2NraW5nICkgewoJCXByb2Nlc3MoIGxhc3QgKTsKCX0KfQoKZnVuY3Rpb24gcHJvY2VzcyggbGFzdCApIHsKCWZ1bmN0aW9uIG5leHQoKSB7CgkJcHJvY2VzcyggbGFzdCApOwoJfQoJdmFyIHN0YXJ0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7Cgljb25maWcuZGVwdGggPSBjb25maWcuZGVwdGggPyBjb25maWcuZGVwdGggKyAxIDogMTsKCgl3aGlsZSAoIGNvbmZpZy5xdWV1ZS5sZW5ndGggJiYgIWNvbmZpZy5ibG9ja2luZyApIHsKCQlpZiAoICFkZWZpbmVkLnNldFRpbWVvdXQgfHwgY29uZmlnLnVwZGF0ZVJhdGUgPD0gMCB8fCAoICggbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzdGFydCApIDwgY29uZmlnLnVwZGF0ZVJhdGUgKSApIHsKCQkJY29uZmlnLnF1ZXVlLnNoaWZ0KCkoKTsKCQl9IGVsc2UgewoJCQlzZXRUaW1lb3V0KCBuZXh0LCAxMyApOwoJCQlicmVhazsKCQl9Cgl9Cgljb25maWcuZGVwdGgtLTsKCWlmICggbGFzdCAmJiAhY29uZmlnLmJsb2NraW5nICYmICFjb25maWcucXVldWUubGVuZ3RoICYmIGNvbmZpZy5kZXB0aCA9PT0gMCApIHsKCQlkb25lKCk7Cgl9Cn0KCmZ1bmN0aW9uIHNhdmVHbG9iYWwoKSB7Cgljb25maWcucG9sbHV0aW9uID0gW107CgoJaWYgKCBjb25maWcubm9nbG9iYWxzICkgewoJCWZvciAoIHZhciBrZXkgaW4gd2luZG93ICkgewoJCQlpZiAoIGhhc093bi5jYWxsKCB3aW5kb3csIGtleSApICkgewoJCQkJLy8gaW4gT3BlcmEgc29tZXRpbWVzIERPTSBlbGVtZW50IGlkcyBzaG93IHVwIGhlcmUsIGlnbm9yZSB0aGVtCgkJCQlpZiAoIC9ecXVuaXQtdGVzdC1vdXRwdXQvLnRlc3QoIGtleSApICkgewoJCQkJCWNvbnRpbnVlOwoJCQkJfQoJCQkJY29uZmlnLnBvbGx1dGlvbi5wdXNoKCBrZXkgKTsKCQkJfQoJCX0KCX0KfQoKZnVuY3Rpb24gY2hlY2tQb2xsdXRpb24oKSB7Cgl2YXIgbmV3R2xvYmFscywKCQlkZWxldGVkR2xvYmFscywKCQlvbGQgPSBjb25maWcucG9sbHV0aW9uOwoKCXNhdmVHbG9iYWwoKTsKCgluZXdHbG9iYWxzID0gZGlmZiggY29uZmlnLnBvbGx1dGlvbiwgb2xkICk7CglpZiAoIG5ld0dsb2JhbHMubGVuZ3RoID4gMCApIHsKCQlRVW5pdC5wdXNoRmFpbHVyZSggIkludHJvZHVjZWQgZ2xvYmFsIHZhcmlhYmxlKHMpOiAiICsgbmV3R2xvYmFscy5qb2luKCIsICIpICk7Cgl9CgoJZGVsZXRlZEdsb2JhbHMgPSBkaWZmKCBvbGQsIGNvbmZpZy5wb2xsdXRpb24gKTsKCWlmICggZGVsZXRlZEdsb2JhbHMubGVuZ3RoID4gMCApIHsKCQlRVW5pdC5wdXNoRmFpbHVyZSggIkRlbGV0ZWQgZ2xvYmFsIHZhcmlhYmxlKHMpOiAiICsgZGVsZXRlZEdsb2JhbHMuam9pbigiLCAiKSApOwoJfQp9CgovLyByZXR1cm5zIGEgbmV3IEFycmF5IHdpdGggdGhlIGVsZW1lbnRzIHRoYXQgYXJlIGluIGEgYnV0IG5vdCBpbiBiCmZ1bmN0aW9uIGRpZmYoIGEsIGIgKSB7Cgl2YXIgaSwgaiwKCQlyZXN1bHQgPSBhLnNsaWNlKCk7CgoJZm9yICggaSA9IDA7IGkgPCByZXN1bHQubGVuZ3RoOyBpKysgKSB7CgkJZm9yICggaiA9IDA7IGogPCBiLmxlbmd0aDsgaisrICkgewoJCQlpZiAoIHJlc3VsdFtpXSA9PT0gYltqXSApIHsKCQkJCXJlc3VsdC5zcGxpY2UoIGksIDEgKTsKCQkJCWktLTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoJcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gZXh0ZW5kKCBhLCBiICkgewoJZm9yICggdmFyIHByb3AgaW4gYiApIHsKCQlpZiAoIGhhc093bi5jYWxsKCBiLCBwcm9wICkgKSB7CgkJCS8vIEF2b2lkICJNZW1iZXIgbm90IGZvdW5kIiBlcnJvciBpbiBJRTggY2F1c2VkIGJ5IG1lc3Npbmcgd2l0aCB3aW5kb3cuY29uc3RydWN0b3IKCQkJaWYgKCAhKCBwcm9wID09PSAiY29uc3RydWN0b3IiICYmIGEgPT09IHdpbmRvdyApICkgewoJCQkJaWYgKCBiWyBwcm9wIF0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQlkZWxldGUgYVsgcHJvcCBdOwoJCQkJfSBlbHNlIHsKCQkJCQlhWyBwcm9wIF0gPSBiWyBwcm9wIF07CgkJCQl9CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIGE7Cn0KCi8qKgogKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtCiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAqLwpmdW5jdGlvbiBhZGRFdmVudCggZWxlbSwgdHlwZSwgZm4gKSB7CglpZiAoIGVsZW0uYWRkRXZlbnRMaXN0ZW5lciApIHsKCgkJLy8gU3RhbmRhcmRzLWJhc2VkIGJyb3dzZXJzCgkJZWxlbS5hZGRFdmVudExpc3RlbmVyKCB0eXBlLCBmbiwgZmFsc2UgKTsKCX0gZWxzZSBpZiAoIGVsZW0uYXR0YWNoRXZlbnQgKSB7CgoJCS8vIHN1cHBvcnQ6IElFIDw5CgkJZWxlbS5hdHRhY2hFdmVudCggIm9uIiArIHR5cGUsIGZuICk7Cgl9IGVsc2UgewoKCQkvLyBDYWxsZXIgbXVzdCBlbnN1cmUgc3VwcG9ydCBmb3IgZXZlbnQgbGlzdGVuZXJzIGlzIHByZXNlbnQKCQl0aHJvdyBuZXcgRXJyb3IoICJhZGRFdmVudCgpIHdhcyBjYWxsZWQgaW4gYSBjb250ZXh0IHdpdGhvdXQgZXZlbnQgbGlzdGVuZXIgc3VwcG9ydCIgKTsKCX0KfQoKLyoqCiAqIEBwYXJhbSB7QXJyYXl8Tm9kZUxpc3R9IGVsZW1zCiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAqLwpmdW5jdGlvbiBhZGRFdmVudHMoIGVsZW1zLCB0eXBlLCBmbiApIHsKCXZhciBpID0gZWxlbXMubGVuZ3RoOwoJd2hpbGUgKCBpLS0gKSB7CgkJYWRkRXZlbnQoIGVsZW1zW2ldLCB0eXBlLCBmbiApOwoJfQp9CgpmdW5jdGlvbiBoYXNDbGFzcyggZWxlbSwgbmFtZSApIHsKCXJldHVybiAoIiAiICsgZWxlbS5jbGFzc05hbWUgKyAiICIpLmluZGV4T2YoIiAiICsgbmFtZSArICIgIikgPiAtMTsKfQoKZnVuY3Rpb24gYWRkQ2xhc3MoIGVsZW0sIG5hbWUgKSB7CglpZiAoICFoYXNDbGFzcyggZWxlbSwgbmFtZSApICkgewoJCWVsZW0uY2xhc3NOYW1lICs9IChlbGVtLmNsYXNzTmFtZSA\/ICIgIiA6ICIiKSArIG5hbWU7Cgl9Cn0KCmZ1bmN0aW9uIHJlbW92ZUNsYXNzKCBlbGVtLCBuYW1lICkgewoJdmFyIHNldCA9ICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiOwoJLy8gQ2xhc3MgbmFtZSBtYXkgYXBwZWFyIG11bHRpcGxlIHRpbWVzCgl3aGlsZSAoIHNldC5pbmRleE9mKCIgIiArIG5hbWUgKyAiICIpID4gLTEgKSB7CgkJc2V0ID0gc2V0LnJlcGxhY2UoIiAiICsgbmFtZSArICIgIiAsICIgIik7Cgl9CgkvLyBJZiBwb3NzaWJsZSwgdHJpbSBpdCBmb3IgcHJldHRpbmVzcywgYnV0IG5vdCBuZWNlc3NhcmlseQoJZWxlbS5jbGFzc05hbWUgPSB0eXBlb2Ygc2V0LnRyaW0gPT09ICJmdW5jdGlvbiIgPyBzZXQudHJpbSgpIDogc2V0LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAiIik7Cn0KCmZ1bmN0aW9uIGlkKCBuYW1lICkgewoJcmV0dXJuIGRlZmluZWQuZG9jdW1lbnQgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIG5hbWUgKTsKfQoKZnVuY3Rpb24gcmVnaXN0ZXJMb2dnaW5nQ2FsbGJhY2soIGtleSApIHsKCXJldHVybiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJY29uZmlnW2tleV0ucHVzaCggY2FsbGJhY2sgKTsKCX07Cn0KCi8vIFN1cHBvcnRzIGRlcHJlY2F0ZWQgbWV0aG9kIG9mIGNvbXBsZXRlbHkgb3ZlcndyaXRpbmcgbG9nZ2luZyBjYWxsYmFja3MKZnVuY3Rpb24gcnVuTG9nZ2luZ0NhbGxiYWNrcygga2V5LCBzY29wZSwgYXJncyApIHsKCXZhciBpLCBjYWxsYmFja3M7CglpZiAoIFFVbml0Lmhhc093blByb3BlcnR5KCBrZXkgKSApIHsKCQlRVW5pdFsga2V5IF0uY2FsbChzY29wZSwgYXJncyApOwoJfSBlbHNlIHsKCQljYWxsYmFja3MgPSBjb25maWdbIGtleSBdOwoJCWZvciAoIGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrICkgewoJCQljYWxsYmFja3NbIGkgXS5jYWxsKCBzY29wZSwgYXJncyApOwoJCX0KCX0KfQoKLy8gZnJvbSBqcXVlcnkuanMKZnVuY3Rpb24gaW5BcnJheSggZWxlbSwgYXJyYXkgKSB7CglpZiAoIGFycmF5LmluZGV4T2YgKSB7CgkJcmV0dXJuIGFycmF5LmluZGV4T2YoIGVsZW0gKTsKCX0KCglmb3IgKCB2YXIgaSA9IDAsIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCWlmICggYXJyYXlbIGkgXSA9PT0gZWxlbSApIHsKCQkJcmV0dXJuIGk7CgkJfQoJfQoKCXJldHVybiAtMTsKfQoKZnVuY3Rpb24gVGVzdCggc2V0dGluZ3MgKSB7CglleHRlbmQoIHRoaXMsIHNldHRpbmdzICk7Cgl0aGlzLmFzc2VydGlvbnMgPSBbXTsKCXRoaXMudGVzdE51bWJlciA9ICsrVGVzdC5jb3VudDsKfQoKVGVzdC5jb3VudCA9IDA7CgpUZXN0LnByb3RvdHlwZSA9IHsKCWluaXQ6IGZ1bmN0aW9uKCkgewoJCXZhciBhLCBiLCBsaSwKCQkJdGVzdHMgPSBpZCggInF1bml0LXRlc3RzIiApOwoKCQlpZiAoIHRlc3RzICkgewoJCQliID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInN0cm9uZyIgKTsKCQkJYi5pbm5lckhUTUwgPSB0aGlzLm5hbWVIdG1sOwoKCQkJLy8gYGFgIGluaXRpYWxpemVkIGF0IHRvcCBvZiBzY29wZQoJCQlhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImEiICk7CgkJCWEuaW5uZXJIVE1MID0gIlJlcnVuIjsKCQkJYS5ocmVmID0gUVVuaXQudXJsKHsgdGVzdE51bWJlcjogdGhpcy50ZXN0TnVtYmVyIH0pOwoKCQkJbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAibGkiICk7CgkJCWxpLmFwcGVuZENoaWxkKCBiICk7CgkJCWxpLmFwcGVuZENoaWxkKCBhICk7CgkJCWxpLmNsYXNzTmFtZSA9ICJydW5uaW5nIjsKCQkJbGkuaWQgPSB0aGlzLmlkID0gInF1bml0LXRlc3Qtb3V0cHV0IiArIHRlc3RJZCsrOwoKCQkJdGVzdHMuYXBwZW5kQ2hpbGQoIGxpICk7CgkJfQoJfSwKCXNldHVwOiBmdW5jdGlvbigpIHsKCQlpZiAoCgkJCS8vIEVtaXQgbW9kdWxlU3RhcnQgd2hlbiB3ZSdyZSBzd2l0Y2hpbmcgZnJvbSBvbmUgbW9kdWxlIHRvIGFub3RoZXIKCQkJdGhpcy5tb2R1bGUgIT09IGNvbmZpZy5wcmV2aW91c01vZHVsZSB8fAoJCQkJLy8gVGhleSBjb3VsZCBiZSBlcXVhbCAoYm90aCB1bmRlZmluZWQpIGJ1dCBpZiB0aGUgcHJldmlvdXNNb2R1bGUgcHJvcGVydHkgZG9lc24ndAoJCQkJLy8geWV0IGV4aXN0IGl0IG1lYW5zIHRoaXMgaXMgdGhlIGZpcnN0IHRlc3QgaW4gYSBzdWl0ZSB0aGF0IGlzbid0IHdyYXBwZWQgaW4gYQoJCQkJLy8gbW9kdWxlLCBpbiB3aGljaCBjYXNlIHdlJ2xsIGp1c3QgZW1pdCBhIG1vZHVsZVN0YXJ0IGV2ZW50IGZvciAndW5kZWZpbmVkJy4KCQkJCS8vIFdpdGhvdXQgdGhpcywgcmVwb3J0ZXJzIGNhbiBnZXQgdGVzdFN0YXJ0IGJlZm9yZSBtb2R1bGVTdGFydCAgd2hpY2ggaXMgYSBwcm9ibGVtLgoJCQkJIWhhc093bi5jYWxsKCBjb25maWcsICJwcmV2aW91c01vZHVsZSIgKQoJCSkgewoJCQlpZiAoIGhhc093bi5jYWxsKCBjb25maWcsICJwcmV2aW91c01vZHVsZSIgKSApIHsKCQkJCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICJtb2R1bGVEb25lIiwgUVVuaXQsIHsKCQkJCQluYW1lOiBjb25maWcucHJldmlvdXNNb2R1bGUsCgkJCQkJZmFpbGVkOiBjb25maWcubW9kdWxlU3RhdHMuYmFkLAoJCQkJCXBhc3NlZDogY29uZmlnLm1vZHVsZVN0YXRzLmFsbCAtIGNvbmZpZy5tb2R1bGVTdGF0cy5iYWQsCgkJCQkJdG90YWw6IGNvbmZpZy5tb2R1bGVTdGF0cy5hbGwKCQkJCX0pOwoJCQl9CgkJCWNvbmZpZy5wcmV2aW91c01vZHVsZSA9IHRoaXMubW9kdWxlOwoJCQljb25maWcubW9kdWxlU3RhdHMgPSB7IGFsbDogMCwgYmFkOiAwIH07CgkJCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICJtb2R1bGVTdGFydCIsIFFVbml0LCB7CgkJCQluYW1lOiB0aGlzLm1vZHVsZQoJCQl9KTsKCQl9CgoJCWNvbmZpZy5jdXJyZW50ID0gdGhpczsKCgkJdGhpcy50ZXN0RW52aXJvbm1lbnQgPSBleHRlbmQoewoJCQlzZXR1cDogZnVuY3Rpb24oKSB7fSwKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkge30KCQl9LCB0aGlzLm1vZHVsZVRlc3RFbnZpcm9ubWVudCApOwoKCQl0aGlzLnN0YXJ0ZWQgPSArbmV3IERhdGUoKTsKCQlydW5Mb2dnaW5nQ2FsbGJhY2tzKCAidGVzdFN0YXJ0IiwgUVVuaXQsIHsKCQkJbmFtZTogdGhpcy50ZXN0TmFtZSwKCQkJbW9kdWxlOiB0aGlzLm1vZHVsZQoJCX0pOwoKCQkvKmpzaGludCBjYW1lbGNhc2U6ZmFsc2UgKi8KCgoJCS8qKgoJCSAqIEV4cG9zZSB0aGUgY3VycmVudCB0ZXN0IGVudmlyb25tZW50LgoJCSAqCgkJICogQGRlcHJlY2F0ZWQgc2luY2UgMS4xMi4wOiBVc2UgUVVuaXQuY29uZmlnLmN1cnJlbnQudGVzdEVudmlyb25tZW50IGluc3RlYWQuCgkJICovCgkJUVVuaXQuY3VycmVudF90ZXN0RW52aXJvbm1lbnQgPSB0aGlzLnRlc3RFbnZpcm9ubWVudDsKCgkJLypqc2hpbnQgY2FtZWxjYXNlOnRydWUgKi8KCgkJaWYgKCAhY29uZmlnLnBvbGx1dGlvbiApIHsKCQkJc2F2ZUdsb2JhbCgpOwoJCX0KCQlpZiAoIGNvbmZpZy5ub3RyeWNhdGNoICkgewoJCQl0aGlzLnRlc3RFbnZpcm9ubWVudC5zZXR1cC5jYWxsKCB0aGlzLnRlc3RFbnZpcm9ubWVudCwgUVVuaXQuYXNzZXJ0ICk7CgkJCXJldHVybjsKCQl9CgkJdHJ5IHsKCQkJdGhpcy50ZXN0RW52aXJvbm1lbnQuc2V0dXAuY2FsbCggdGhpcy50ZXN0RW52aXJvbm1lbnQsIFFVbml0LmFzc2VydCApOwoJCX0gY2F0Y2goIGUgKSB7CgkJCVFVbml0LnB1c2hGYWlsdXJlKCAiU2V0dXAgZmFpbGVkIG9uICIgKyB0aGlzLnRlc3ROYW1lICsgIjogIiArICggZS5tZXNzYWdlIHx8IGUgKSwgZXh0cmFjdFN0YWNrdHJhY2UoIGUsIDEgKSApOwoJCX0KCX0sCglydW46IGZ1bmN0aW9uKCkgewoJCWNvbmZpZy5jdXJyZW50ID0gdGhpczsKCgkJdmFyIHJ1bm5pbmcgPSBpZCggInF1bml0LXRlc3RyZXN1bHQiICk7CgoJCWlmICggcnVubmluZyApIHsKCQkJcnVubmluZy5pbm5lckhUTUwgPSAiUnVubmluZzogPGJyLz4iICsgdGhpcy5uYW1lSHRtbDsKCQl9CgoJCWlmICggdGhpcy5hc3luYyApIHsKCQkJUVVuaXQuc3RvcCgpOwoJCX0KCgkJdGhpcy5jYWxsYmFja1N0YXJ0ZWQgPSArbmV3IERhdGUoKTsKCgkJaWYgKCBjb25maWcubm90cnljYXRjaCApIHsKCQkJdGhpcy5jYWxsYmFjay5jYWxsKCB0aGlzLnRlc3RFbnZpcm9ubWVudCwgUVVuaXQuYXNzZXJ0ICk7CgkJCXRoaXMuY2FsbGJhY2tSdW50aW1lID0gK25ldyBEYXRlKCkgLSB0aGlzLmNhbGxiYWNrU3RhcnRlZDsKCQkJcmV0dXJuOwoJCX0KCgkJdHJ5IHsKCQkJdGhpcy5jYWxsYmFjay5jYWxsKCB0aGlzLnRlc3RFbnZpcm9ubWVudCwgUVVuaXQuYXNzZXJ0ICk7CgkJCXRoaXMuY2FsbGJhY2tSdW50aW1lID0gK25ldyBEYXRlKCkgLSB0aGlzLmNhbGxiYWNrU3RhcnRlZDsKCQl9IGNhdGNoKCBlICkgewoJCQl0aGlzLmNhbGxiYWNrUnVudGltZSA9ICtuZXcgRGF0ZSgpIC0gdGhpcy5jYWxsYmFja1N0YXJ0ZWQ7CgoJCQlRVW5pdC5wdXNoRmFpbHVyZSggIkRpZWQgb24gdGVzdCAjIiArICh0aGlzLmFzc2VydGlvbnMubGVuZ3RoICsgMSkgKyAiICIgKyB0aGlzLnN0YWNrICsgIjogIiArICggZS5tZXNzYWdlIHx8IGUgKSwgZXh0cmFjdFN0YWNrdHJhY2UoIGUsIDAgKSApOwoJCQkvLyBlbHNlIG5leHQgdGVzdCB3aWxsIGNhcnJ5IHRoZSByZXNwb25zaWJpbGl0eQoJCQlzYXZlR2xvYmFsKCk7CgoJCQkvLyBSZXN0YXJ0IHRoZSB0ZXN0cyBpZiB0aGV5J3JlIGJsb2NraW5nCgkJCWlmICggY29uZmlnLmJsb2NraW5nICkgewoJCQkJUVVuaXQuc3RhcnQoKTsKCQkJfQoJCX0KCX0sCgl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJY29uZmlnLmN1cnJlbnQgPSB0aGlzOwoJCWlmICggY29uZmlnLm5vdHJ5Y2F0Y2ggKSB7CgkJCWlmICggdHlwZW9mIHRoaXMuY2FsbGJhY2tSdW50aW1lID09PSAidW5kZWZpbmVkIiApIHsKCQkJCXRoaXMuY2FsbGJhY2tSdW50aW1lID0gK25ldyBEYXRlKCkgLSB0aGlzLmNhbGxiYWNrU3RhcnRlZDsKCQkJfQoJCQl0aGlzLnRlc3RFbnZpcm9ubWVudC50ZWFyZG93bi5jYWxsKCB0aGlzLnRlc3RFbnZpcm9ubWVudCwgUVVuaXQuYXNzZXJ0ICk7CgkJCXJldHVybjsKCQl9IGVsc2UgewoJCQl0cnkgewoJCQkJdGhpcy50ZXN0RW52aXJvbm1lbnQudGVhcmRvd24uY2FsbCggdGhpcy50ZXN0RW52aXJvbm1lbnQsIFFVbml0LmFzc2VydCApOwoJCQl9IGNhdGNoKCBlICkgewoJCQkJUVVuaXQucHVzaEZhaWx1cmUoICJUZWFyZG93biBmYWlsZWQgb24gIiArIHRoaXMudGVzdE5hbWUgKyAiOiAiICsgKCBlLm1lc3NhZ2UgfHwgZSApLCBleHRyYWN0U3RhY2t0cmFjZSggZSwgMSApICk7CgkJCX0KCQl9CgkJY2hlY2tQb2xsdXRpb24oKTsKCX0sCglmaW5pc2g6IGZ1bmN0aW9uKCkgewoJCWNvbmZpZy5jdXJyZW50ID0gdGhpczsKCQlpZiAoIGNvbmZpZy5yZXF1aXJlRXhwZWN0cyAmJiB0aGlzLmV4cGVjdGVkID09PSBudWxsICkgewoJCQlRVW5pdC5wdXNoRmFpbHVyZSggIkV4cGVjdGVkIG51bWJlciBvZiBhc3NlcnRpb25zIHRvIGJlIGRlZmluZWQsIGJ1dCBleHBlY3QoKSB3YXMgbm90IGNhbGxlZC4iLCB0aGlzLnN0YWNrICk7CgkJfSBlbHNlIGlmICggdGhpcy5leHBlY3RlZCAhPT0gbnVsbCAmJiB0aGlzLmV4cGVjdGVkICE9PSB0aGlzLmFzc2VydGlvbnMubGVuZ3RoICkgewoJCQlRVW5pdC5wdXNoRmFpbHVyZSggIkV4cGVjdGVkICIgKyB0aGlzLmV4cGVjdGVkICsgIiBhc3NlcnRpb25zLCBidXQgIiArIHRoaXMuYXNzZXJ0aW9ucy5sZW5ndGggKyAiIHdlcmUgcnVuIiwgdGhpcy5zdGFjayApOwoJCX0gZWxzZSBpZiAoIHRoaXMuZXhwZWN0ZWQgPT09IG51bGwgJiYgIXRoaXMuYXNzZXJ0aW9ucy5sZW5ndGggKSB7CgkJCVFVbml0LnB1c2hGYWlsdXJlKCAiRXhwZWN0ZWQgYXQgbGVhc3Qgb25lIGFzc2VydGlvbiwgYnV0IG5vbmUgd2VyZSBydW4gLSBjYWxsIGV4cGVjdCgwKSB0byBhY2NlcHQgemVybyBhc3NlcnRpb25zLiIsIHRoaXMuc3RhY2sgKTsKCQl9CgoJCXZhciBpLCBhc3NlcnRpb24sIGEsIGIsIHRpbWUsIGxpLCBvbCwKCQkJdGVzdCA9IHRoaXMsCgkJCWdvb2QgPSAwLAoJCQliYWQgPSAwLAoJCQl0ZXN0cyA9IGlkKCAicXVuaXQtdGVzdHMiICk7CgoJCXRoaXMucnVudGltZSA9ICtuZXcgRGF0ZSgpIC0gdGhpcy5zdGFydGVkOwoJCWNvbmZpZy5zdGF0cy5hbGwgKz0gdGhpcy5hc3NlcnRpb25zLmxlbmd0aDsKCQljb25maWcubW9kdWxlU3RhdHMuYWxsICs9IHRoaXMuYXNzZXJ0aW9ucy5sZW5ndGg7CgoJCWlmICggdGVzdHMgKSB7CgkJCW9sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggIm9sIiApOwoJCQlvbC5jbGFzc05hbWUgPSAicXVuaXQtYXNzZXJ0LWxpc3QiOwoKCQkJZm9yICggaSA9IDA7IGkgPCB0aGlzLmFzc2VydGlvbnMubGVuZ3RoOyBpKysgKSB7CgkJCQlhc3NlcnRpb24gPSB0aGlzLmFzc2VydGlvbnNbaV07CgoJCQkJbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAibGkiICk7CgkJCQlsaS5jbGFzc05hbWUgPSBhc3NlcnRpb24ucmVzdWx0ID8gInBhc3MiIDogImZhaWwiOwoJCQkJbGkuaW5uZXJIVE1MID0gYXNzZXJ0aW9uLm1lc3NhZ2UgfHwgKCBhc3NlcnRpb24ucmVzdWx0ID8gIm9rYXkiIDogImZhaWxlZCIgKTsKCQkJCW9sLmFwcGVuZENoaWxkKCBsaSApOwoKCQkJCWlmICggYXNzZXJ0aW9uLnJlc3VsdCApIHsKCQkJCQlnb29kKys7CgkJCQl9IGVsc2UgewoJCQkJCWJhZCsrOwoJCQkJCWNvbmZpZy5zdGF0cy5iYWQrKzsKCQkJCQljb25maWcubW9kdWxlU3RhdHMuYmFkKys7CgkJCQl9CgkJCX0KCgkJCS8vIHN0b3JlIHJlc3VsdCB3aGVuIHBvc3NpYmxlCgkJCWlmICggUVVuaXQuY29uZmlnLnJlb3JkZXIgJiYgZGVmaW5lZC5zZXNzaW9uU3RvcmFnZSApIHsKCQkJCWlmICggYmFkICkgewoJCQkJCXNlc3Npb25TdG9yYWdlLnNldEl0ZW0oICJxdW5pdC10ZXN0LSIgKyB0aGlzLm1vZHVsZSArICItIiArIHRoaXMudGVzdE5hbWUsIGJhZCApOwoJCQkJfSBlbHNlIHsKCQkJCQlzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCAicXVuaXQtdGVzdC0iICsgdGhpcy5tb2R1bGUgKyAiLSIgKyB0aGlzLnRlc3ROYW1lICk7CgkJCQl9CgkJCX0KCgkJCWlmICggYmFkID09PSAwICkgewoJCQkJYWRkQ2xhc3MoIG9sLCAicXVuaXQtY29sbGFwc2VkIiApOwoJCQl9CgoJCQkvLyBgYmAgaW5pdGlhbGl6ZWQgYXQgdG9wIG9mIHNjb3BlCgkJCWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAic3Ryb25nIiApOwoJCQliLmlubmVySFRNTCA9IHRoaXMubmFtZUh0bWwgKyAiIDxiIGNsYXNzPSdjb3VudHMnPig8YiBjbGFzcz0nZmFpbGVkJz4iICsgYmFkICsgIjwvYj4sIDxiIGNsYXNzPSdwYXNzZWQnPiIgKyBnb29kICsgIjwvYj4sICIgKyB0aGlzLmFzc2VydGlvbnMubGVuZ3RoICsgIik8L2I+IjsKCgkJCWFkZEV2ZW50KGIsICJjbGljayIsIGZ1bmN0aW9uKCkgewoJCQkJdmFyIG5leHQgPSBiLnBhcmVudE5vZGUubGFzdENoaWxkLAoJCQkJCWNvbGxhcHNlZCA9IGhhc0NsYXNzKCBuZXh0LCAicXVuaXQtY29sbGFwc2VkIiApOwoJCQkJKCBjb2xsYXBzZWQgPyByZW1vdmVDbGFzcyA6IGFkZENsYXNzICkoIG5leHQsICJxdW5pdC1jb2xsYXBzZWQiICk7CgkJCX0pOwoKCQkJYWRkRXZlbnQoYiwgImRibGNsaWNrIiwgZnVuY3Rpb24oIGUgKSB7CgkJCQl2YXIgdGFyZ2V0ID0gZSAmJiBlLnRhcmdldCA\/IGUudGFyZ2V0IDogd2luZG93LmV2ZW50LnNyY0VsZW1lbnQ7CgkJCQlpZiAoIHRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAic3BhbiIgfHwgdGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJiIiApIHsKCQkJCQl0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZTsKCQkJCX0KCQkJCWlmICggd2luZG93LmxvY2F0aW9uICYmIHRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAic3Ryb25nIiApIHsKCQkJCQl3aW5kb3cubG9jYXRpb24gPSBRVW5pdC51cmwoeyB0ZXN0TnVtYmVyOiB0ZXN0LnRlc3ROdW1iZXIgfSk7CgkJCQl9CgkJCX0pOwoKCQkJLy8gYHRpbWVgIGluaXRpYWxpemVkIGF0IHRvcCBvZiBzY29wZQoJCQl0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggInNwYW4iICk7CgkJCXRpbWUuY2xhc3NOYW1lID0gInJ1bnRpbWUiOwoJCQl0aW1lLmlubmVySFRNTCA9IHRoaXMucnVudGltZSArICIgbXMiOwoKCQkJLy8gYGxpYCBpbml0aWFsaXplZCBhdCB0b3Agb2Ygc2NvcGUKCQkJbGkgPSBpZCggdGhpcy5pZCApOwoJCQlsaS5jbGFzc05hbWUgPSBiYWQgPyAiZmFpbCIgOiAicGFzcyI7CgkJCWxpLnJlbW92ZUNoaWxkKCBsaS5maXJzdENoaWxkICk7CgkJCWEgPSBsaS5maXJzdENoaWxkOwoJCQlsaS5hcHBlbmRDaGlsZCggYiApOwoJCQlsaS5hcHBlbmRDaGlsZCggYSApOwoJCQlsaS5hcHBlbmRDaGlsZCggdGltZSApOwoJCQlsaS5hcHBlbmRDaGlsZCggb2wgKTsKCgkJfSBlbHNlIHsKCQkJZm9yICggaSA9IDA7IGkgPCB0aGlzLmFzc2VydGlvbnMubGVuZ3RoOyBpKysgKSB7CgkJCQlpZiAoICF0aGlzLmFzc2VydGlvbnNbaV0ucmVzdWx0ICkgewoJCQkJCWJhZCsrOwoJCQkJCWNvbmZpZy5zdGF0cy5iYWQrKzsKCQkJCQljb25maWcubW9kdWxlU3RhdHMuYmFkKys7CgkJCQl9CgkJCX0KCQl9CgoJCXJ1bkxvZ2dpbmdDYWxsYmFja3MoICJ0ZXN0RG9uZSIsIFFVbml0LCB7CgkJCW5hbWU6IHRoaXMudGVzdE5hbWUsCgkJCW1vZHVsZTogdGhpcy5tb2R1bGUsCgkJCWZhaWxlZDogYmFkLAoJCQlwYXNzZWQ6IHRoaXMuYXNzZXJ0aW9ucy5sZW5ndGggLSBiYWQsCgkJCXRvdGFsOiB0aGlzLmFzc2VydGlvbnMubGVuZ3RoLAoJCQlydW50aW1lOiB0aGlzLnJ1bnRpbWUsCgkJCS8vIERFUFJFQ0FURUQ6IHRoaXMgcHJvcGVydHkgd2lsbCBiZSByZW1vdmVkIGluIDIuMC4wLCB1c2UgcnVudGltZSBpbnN0ZWFkCgkJCWR1cmF0aW9uOiB0aGlzLnJ1bnRpbWUKCQl9KTsKCgkJUVVuaXQucmVzZXQoKTsKCgkJY29uZmlnLmN1cnJlbnQgPSB1bmRlZmluZWQ7Cgl9LAoKCXF1ZXVlOiBmdW5jdGlvbigpIHsKCQl2YXIgYmFkLAoJCQl0ZXN0ID0gdGhpczsKCgkJc3luY2hyb25pemUoZnVuY3Rpb24oKSB7CgkJCXRlc3QuaW5pdCgpOwoJCX0pOwoJCWZ1bmN0aW9uIHJ1bigpIHsKCQkJLy8gZWFjaCBvZiB0aGVzZSBjYW4gYnkgYXN5bmMKCQkJc3luY2hyb25pemUoZnVuY3Rpb24oKSB7CgkJCQl0ZXN0LnNldHVwKCk7CgkJCX0pOwoJCQlzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQkJCXRlc3QucnVuKCk7CgkJCX0pOwoJCQlzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQkJCXRlc3QudGVhcmRvd24oKTsKCQkJfSk7CgkJCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCQkJdGVzdC5maW5pc2goKTsKCQkJfSk7CgkJfQoKCQkvLyBgYmFkYCBpbml0aWFsaXplZCBhdCB0b3Agb2Ygc2NvcGUKCQkvLyBkZWZlciB3aGVuIHByZXZpb3VzIHRlc3QgcnVuIHBhc3NlZCwgaWYgc3RvcmFnZSBpcyBhdmFpbGFibGUKCQliYWQgPSBRVW5pdC5jb25maWcucmVvcmRlciAmJiBkZWZpbmVkLnNlc3Npb25TdG9yYWdlICYmCgkJCQkJCStzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCAicXVuaXQtdGVzdC0iICsgdGhpcy5tb2R1bGUgKyAiLSIgKyB0aGlzLnRlc3ROYW1lICk7CgoJCWlmICggYmFkICkgewoJCQlydW4oKTsKCQl9IGVsc2UgewoJCQlzeW5jaHJvbml6ZSggcnVuLCB0cnVlICk7CgkJfQoJfQp9OwoKLy8gYGFzc2VydGAgaW5pdGlhbGl6ZWQgYXQgdG9wIG9mIHNjb3BlCi8vIEFzc2VydCBoZWxwZXJzCi8vIEFsbCBvZiB0aGVzZSBtdXN0IGVpdGhlciBjYWxsIFFVbml0LnB1c2goKSBvciBtYW51YWxseSBkbzoKLy8gLSBydW5Mb2dnaW5nQ2FsbGJhY2tzKCAibG9nIiwgLi4gKTsKLy8gLSBjb25maWcuY3VycmVudC5hc3NlcnRpb25zLnB1c2goeyAuLiB9KTsKYXNzZXJ0ID0gUVVuaXQuYXNzZXJ0ID0gewoJLyoqCgkgKiBBc3NlcnRzIHJvdWdoIHRydWUtaXNoIHJlc3VsdC4KCSAqIEBuYW1lIG9rCgkgKiBAZnVuY3Rpb24KCSAqIEBleGFtcGxlIG9rKCAiYXNkZmFzZGYiLmxlbmd0aCA+IDUsICJUaGVyZSBtdXN0IGJlIGF0IGxlYXN0IDUgY2hhcnMiICk7CgkgKi8KCW9rOiBmdW5jdGlvbiggcmVzdWx0LCBtc2cgKSB7CgkJaWYgKCAhY29uZmlnLmN1cnJlbnQgKSB7CgkJCXRocm93IG5ldyBFcnJvciggIm9rKCkgYXNzZXJ0aW9uIG91dHNpZGUgdGVzdCBjb250ZXh0LCB3YXMgIiArIHNvdXJjZUZyb21TdGFja3RyYWNlKDIpICk7CgkJfQoJCXJlc3VsdCA9ICEhcmVzdWx0OwoJCW1zZyA9IG1zZyB8fCAoIHJlc3VsdCA\/ICJva2F5IiA6ICJmYWlsZWQiICk7CgoJCXZhciBzb3VyY2UsCgkJCWRldGFpbHMgPSB7CgkJCQltb2R1bGU6IGNvbmZpZy5jdXJyZW50Lm1vZHVsZSwKCQkJCW5hbWU6IGNvbmZpZy5jdXJyZW50LnRlc3ROYW1lLAoJCQkJcmVzdWx0OiByZXN1bHQsCgkJCQltZXNzYWdlOiBtc2cKCQkJfTsKCgkJbXNnID0gIjxzcGFuIGNsYXNzPSd0ZXN0LW1lc3NhZ2UnPiIgKyBlc2NhcGVUZXh0KCBtc2cgKSArICI8L3NwYW4+IjsKCgkJaWYgKCAhcmVzdWx0ICkgewoJCQlzb3VyY2UgPSBzb3VyY2VGcm9tU3RhY2t0cmFjZSggMiApOwoJCQlpZiAoIHNvdXJjZSApIHsKCQkJCWRldGFpbHMuc291cmNlID0gc291cmNlOwoJCQkJbXNnICs9ICI8dGFibGU+PHRyIGNsYXNzPSd0ZXN0LXNvdXJjZSc+PHRoPlNvdXJjZTogPC90aD48dGQ+PHByZT4iICsKCQkJCQllc2NhcGVUZXh0KCBzb3VyY2UgKSArCgkJCQkJIjwvcHJlPjwvdGQ+PC90cj48L3RhYmxlPiI7CgkJCX0KCQl9CgkJcnVuTG9nZ2luZ0NhbGxiYWNrcyggImxvZyIsIFFVbml0LCBkZXRhaWxzICk7CgkJY29uZmlnLmN1cnJlbnQuYXNzZXJ0aW9ucy5wdXNoKHsKCQkJcmVzdWx0OiByZXN1bHQsCgkJCW1lc3NhZ2U6IG1zZwoJCX0pOwoJfSwKCgkvKioKCSAqIEFzc2VydCB0aGF0IHRoZSBmaXJzdCB0d28gYXJndW1lbnRzIGFyZSBlcXVhbCwgd2l0aCBhbiBvcHRpb25hbCBtZXNzYWdlLgoJICogUHJpbnRzIG91dCBib3RoIGFjdHVhbCBhbmQgZXhwZWN0ZWQgdmFsdWVzLgoJICogQG5hbWUgZXF1YWwKCSAqIEBmdW5jdGlvbgoJICogQGV4YW1wbGUgZXF1YWwoIGZvcm1hdCggIlJlY2VpdmVkIHswfSBieXRlcy4iLCAyKSwgIlJlY2VpdmVkIDIgYnl0ZXMuIiwgImZvcm1hdCgpIHJlcGxhY2VzIHswfSB3aXRoIG5leHQgYXJndW1lbnQiICk7CgkgKi8KCWVxdWFsOiBmdW5jdGlvbiggYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSApIHsKCQkvKmpzaGludCBlcWVxZXE6ZmFsc2UgKi8KCQlRVW5pdC5wdXNoKCBleHBlY3RlZCA9PSBhY3R1YWwsIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UgKTsKCX0sCgoJLyoqCgkgKiBAbmFtZSBub3RFcXVhbAoJICogQGZ1bmN0aW9uCgkgKi8KCW5vdEVxdWFsOiBmdW5jdGlvbiggYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSApIHsKCQkvKmpzaGludCBlcWVxZXE6ZmFsc2UgKi8KCQlRVW5pdC5wdXNoKCBleHBlY3RlZCAhPSBhY3R1YWwsIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UgKTsKCX0sCgoJLyoqCgkgKiBAbmFtZSBwcm9wRXF1YWwKCSAqIEBmdW5jdGlvbgoJICovCglwcm9wRXF1YWw6IGZ1bmN0aW9uKCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlICkgewoJCWFjdHVhbCA9IG9iamVjdFZhbHVlcyhhY3R1YWwpOwoJCWV4cGVjdGVkID0gb2JqZWN0VmFsdWVzKGV4cGVjdGVkKTsKCQlRVW5pdC5wdXNoKCBRVW5pdC5lcXVpdihhY3R1YWwsIGV4cGVjdGVkKSwgYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSApOwoJfSwKCgkvKioKCSAqIEBuYW1lIG5vdFByb3BFcXVhbAoJICogQGZ1bmN0aW9uCgkgKi8KCW5vdFByb3BFcXVhbDogZnVuY3Rpb24oIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UgKSB7CgkJYWN0dWFsID0gb2JqZWN0VmFsdWVzKGFjdHVhbCk7CgkJZXhwZWN0ZWQgPSBvYmplY3RWYWx1ZXMoZXhwZWN0ZWQpOwoJCVFVbml0LnB1c2goICFRVW5pdC5lcXVpdihhY3R1YWwsIGV4cGVjdGVkKSwgYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSApOwoJfSwKCgkvKioKCSAqIEBuYW1lIGRlZXBFcXVhbAoJICogQGZ1bmN0aW9uCgkgKi8KCWRlZXBFcXVhbDogZnVuY3Rpb24oIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UgKSB7CgkJUVVuaXQucHVzaCggUVVuaXQuZXF1aXYoYWN0dWFsLCBleHBlY3RlZCksIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UgKTsKCX0sCgoJLyoqCgkgKiBAbmFtZSBub3REZWVwRXF1YWwKCSAqIEBmdW5jdGlvbgoJICovCglub3REZWVwRXF1YWw6IGZ1bmN0aW9uKCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlICkgewoJCVFVbml0LnB1c2goICFRVW5pdC5lcXVpdihhY3R1YWwsIGV4cGVjdGVkKSwgYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSApOwoJfSwKCgkvKioKCSAqIEBuYW1lIHN0cmljdEVxdWFsCgkgKiBAZnVuY3Rpb24KCSAqLwoJc3RyaWN0RXF1YWw6IGZ1bmN0aW9uKCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlICkgewoJCVFVbml0LnB1c2goIGV4cGVjdGVkID09PSBhY3R1YWwsIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UgKTsKCX0sCgoJLyoqCgkgKiBAbmFtZSBub3RTdHJpY3RFcXVhbAoJICogQGZ1bmN0aW9uCgkgKi8KCW5vdFN0cmljdEVxdWFsOiBmdW5jdGlvbiggYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSApIHsKCQlRVW5pdC5wdXNoKCBleHBlY3RlZCAhPT0gYWN0dWFsLCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlICk7Cgl9LAoKCSJ0aHJvd3MiOiBmdW5jdGlvbiggYmxvY2ssIGV4cGVjdGVkLCBtZXNzYWdlICkgewoJCXZhciBhY3R1YWwsCgkJCWV4cGVjdGVkT3V0cHV0ID0gZXhwZWN0ZWQsCgkJCW9rID0gZmFsc2U7CgoJCS8vICdleHBlY3RlZCcgaXMgb3B0aW9uYWwKCQlpZiAoICFtZXNzYWdlICYmIHR5cGVvZiBleHBlY3RlZCA9PT0gInN0cmluZyIgKSB7CgkJCW1lc3NhZ2UgPSBleHBlY3RlZDsKCQkJZXhwZWN0ZWQgPSBudWxsOwoJCX0KCgkJY29uZmlnLmN1cnJlbnQuaWdub3JlR2xvYmFsRXJyb3JzID0gdHJ1ZTsKCQl0cnkgewoJCQlibG9jay5jYWxsKCBjb25maWcuY3VycmVudC50ZXN0RW52aXJvbm1lbnQgKTsKCQl9IGNhdGNoIChlKSB7CgkJCWFjdHVhbCA9IGU7CgkJfQoJCWNvbmZpZy5jdXJyZW50Lmlnbm9yZUdsb2JhbEVycm9ycyA9IGZhbHNlOwoKCQlpZiAoIGFjdHVhbCApIHsKCgkJCS8vIHdlIGRvbid0IHdhbnQgdG8gdmFsaWRhdGUgdGhyb3duIGVycm9yCgkJCWlmICggIWV4cGVjdGVkICkgewoJCQkJb2sgPSB0cnVlOwoJCQkJZXhwZWN0ZWRPdXRwdXQgPSBudWxsOwoKCQkJLy8gZXhwZWN0ZWQgaXMgYW4gRXJyb3Igb2JqZWN0CgkJCX0gZWxzZSBpZiAoIGV4cGVjdGVkIGluc3RhbmNlb2YgRXJyb3IgKSB7CgkJCQlvayA9IGFjdHVhbCBpbnN0YW5jZW9mIEVycm9yICYmCgkJCQkJIGFjdHVhbC5uYW1lID09PSBleHBlY3RlZC5uYW1lICYmCgkJCQkJIGFjdHVhbC5tZXNzYWdlID09PSBleHBlY3RlZC5tZXNzYWdlOwoKCQkJLy8gZXhwZWN0ZWQgaXMgYSByZWdleHAKCQkJfSBlbHNlIGlmICggUVVuaXQub2JqZWN0VHlwZSggZXhwZWN0ZWQgKSA9PT0gInJlZ2V4cCIgKSB7CgkJCQlvayA9IGV4cGVjdGVkLnRlc3QoIGVycm9yU3RyaW5nKCBhY3R1YWwgKSApOwoKCQkJLy8gZXhwZWN0ZWQgaXMgYSBzdHJpbmcKCQkJfSBlbHNlIGlmICggUVVuaXQub2JqZWN0VHlwZSggZXhwZWN0ZWQgKSA9PT0gInN0cmluZyIgKSB7CgkJCQlvayA9IGV4cGVjdGVkID09PSBlcnJvclN0cmluZyggYWN0dWFsICk7CgoJCQkvLyBleHBlY3RlZCBpcyBhIGNvbnN0cnVjdG9yCgkJCX0gZWxzZSBpZiAoIGFjdHVhbCBpbnN0YW5jZW9mIGV4cGVjdGVkICkgewoJCQkJb2sgPSB0cnVlOwoKCQkJLy8gZXhwZWN0ZWQgaXMgYSB2YWxpZGF0aW9uIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgdHJ1ZSBpcyB2YWxpZGF0aW9uIHBhc3NlZAoJCQl9IGVsc2UgaWYgKCBleHBlY3RlZC5jYWxsKCB7fSwgYWN0dWFsICkgPT09IHRydWUgKSB7CgkJCQlleHBlY3RlZE91dHB1dCA9IG51bGw7CgkJCQlvayA9IHRydWU7CgkJCX0KCgkJCVFVbml0LnB1c2goIG9rLCBhY3R1YWwsIGV4cGVjdGVkT3V0cHV0LCBtZXNzYWdlICk7CgkJfSBlbHNlIHsKCQkJUVVuaXQucHVzaEZhaWx1cmUoIG1lc3NhZ2UsIG51bGwsICJObyBleGNlcHRpb24gd2FzIHRocm93bi4iICk7CgkJfQoJfQp9OwoKLyoqCiAqIEBkZXByZWNhdGVkIHNpbmNlIDEuOC4wCiAqIEtlcHQgYXNzZXJ0aW9uIGhlbHBlcnMgaW4gcm9vdCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAqLwpleHRlbmQoIFFVbml0LmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgYXNzZXJ0ICk7CgovKioKICogQGRlcHJlY2F0ZWQgc2luY2UgMS45LjAKICogS2VwdCB0byBhdm9pZCBUeXBlRXJyb3JzIGZvciB1bmRlZmluZWQgbWV0aG9kcy4KICovClFVbml0LmNvbnN0cnVjdG9yLnByb3RvdHlwZS5yYWlzZXMgPSBmdW5jdGlvbigpIHsKCVFVbml0LnB1c2goIGZhbHNlLCBmYWxzZSwgZmFsc2UsICJRVW5pdC5yYWlzZXMgaGFzIGJlZW4gZGVwcmVjYXRlZCBzaW5jZSAyMDEyIChmYWQzYzFlYSksIHVzZSBRVW5pdC50aHJvd3MgaW5zdGVhZCIgKTsKfTsKCi8qKgogKiBAZGVwcmVjYXRlZCBzaW5jZSAxLjAuMCwgcmVwbGFjZWQgd2l0aCBlcnJvciBwdXNoZXMgc2luY2UgMS4zLjAKICogS2VwdCB0byBhdm9pZCBUeXBlRXJyb3JzIGZvciB1bmRlZmluZWQgbWV0aG9kcy4KICovClFVbml0LmNvbnN0cnVjdG9yLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbigpIHsKCVFVbml0LnB1c2goIGZhbHNlLCBmYWxzZSwgZmFsc2UsICJRVW5pdC5lcXVhbHMgaGFzIGJlZW4gZGVwcmVjYXRlZCBzaW5jZSAyMDA5IChlODgwNDlhMCksIHVzZSBRVW5pdC5lcXVhbCBpbnN0ZWFkIiApOwp9OwpRVW5pdC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuc2FtZSA9IGZ1bmN0aW9uKCkgewoJUVVuaXQucHVzaCggZmFsc2UsIGZhbHNlLCBmYWxzZSwgIlFVbml0LnNhbWUgaGFzIGJlZW4gZGVwcmVjYXRlZCBzaW5jZSAyMDA5IChlODgwNDlhMCksIHVzZSBRVW5pdC5kZWVwRXF1YWwgaW5zdGVhZCIgKTsKfTsKCi8vIFRlc3QgZm9yIGVxdWFsaXR5IGFueSBKYXZhU2NyaXB0IHR5cGUuCi8vIEF1dGhvcjogUGhpbGlwcGUgUmF0aMOpIDxwcmF0aGVAZ21haWwuY29tPgpRVW5pdC5lcXVpdiA9IChmdW5jdGlvbigpIHsKCgkvLyBDYWxsIHRoZSBvIHJlbGF0ZWQgY2FsbGJhY2sgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzLgoJZnVuY3Rpb24gYmluZENhbGxiYWNrcyggbywgY2FsbGJhY2tzLCBhcmdzICkgewoJCXZhciBwcm9wID0gUVVuaXQub2JqZWN0VHlwZSggbyApOwoJCWlmICggcHJvcCApIHsKCQkJaWYgKCBRVW5pdC5vYmplY3RUeXBlKCBjYWxsYmFja3NbIHByb3AgXSApID09PSAiZnVuY3Rpb24iICkgewoJCQkJcmV0dXJuIGNhbGxiYWNrc1sgcHJvcCBdLmFwcGx5KCBjYWxsYmFja3MsIGFyZ3MgKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBjYWxsYmFja3NbIHByb3AgXTsgLy8gb3IgdW5kZWZpbmVkCgkJCX0KCQl9Cgl9CgoJLy8gdGhlIHJlYWwgZXF1aXYgZnVuY3Rpb24KCXZhciBpbm5lckVxdWl2LAoJCS8vIHN0YWNrIHRvIGRlY2lkZSBiZXR3ZWVuIHNraXAvYWJvcnQgZnVuY3Rpb25zCgkJY2FsbGVycyA9IFtdLAoJCS8vIHN0YWNrIHRvIGF2b2lkaW5nIGxvb3BzIGZyb20gY2lyY3VsYXIgcmVmZXJlbmNpbmcKCQlwYXJlbnRzID0gW10sCgkJcGFyZW50c0IgPSBbXSwKCgkJZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gKCBvYmogKSB7CgkJCS8qanNoaW50IGNhbWVsY2FzZTpmYWxzZSAqLwoJCQlyZXR1cm4gb2JqLl9fcHJvdG9fXzsKCQl9LAoJCWNhbGxiYWNrcyA9IChmdW5jdGlvbiAoKSB7CgoJCQkvLyBmb3Igc3RyaW5nLCBib29sZWFuLCBudW1iZXIgYW5kIG51bGwKCQkJZnVuY3Rpb24gdXNlU3RyaWN0RXF1YWxpdHkoIGIsIGEgKSB7CgkJCQkvKmpzaGludCBlcWVxZXE6ZmFsc2UgKi8KCQkJCWlmICggYiBpbnN0YW5jZW9mIGEuY29uc3RydWN0b3IgfHwgYSBpbnN0YW5jZW9mIGIuY29uc3RydWN0b3IgKSB7CgkJCQkJLy8gdG8gY2F0Y2ggc2hvcnQgYW5ub3RhdGlvbiBWUyAnbmV3JyBhbm5vdGF0aW9uIG9mIGEKCQkJCQkvLyBkZWNsYXJhdGlvbgoJCQkJCS8vIGUuZy4gdmFyIGkgPSAxOwoJCQkJCS8vIHZhciBqID0gbmV3IE51bWJlcigxKTsKCQkJCQlyZXR1cm4gYSA9PSBiOwoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gYSA9PT0gYjsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIHsKCQkJCSJzdHJpbmciOiB1c2VTdHJpY3RFcXVhbGl0eSwKCQkJCSJib29sZWFuIjogdXNlU3RyaWN0RXF1YWxpdHksCgkJCQkibnVtYmVyIjogdXNlU3RyaWN0RXF1YWxpdHksCgkJCQkibnVsbCI6IHVzZVN0cmljdEVxdWFsaXR5LAoJCQkJInVuZGVmaW5lZCI6IHVzZVN0cmljdEVxdWFsaXR5LAoKCQkJCSJuYW4iOiBmdW5jdGlvbiggYiApIHsKCQkJCQlyZXR1cm4gaXNOYU4oIGIgKTsKCQkJCX0sCgoJCQkJImRhdGUiOiBmdW5jdGlvbiggYiwgYSApIHsKCQkJCQlyZXR1cm4gUVVuaXQub2JqZWN0VHlwZSggYiApID09PSAiZGF0ZSIgJiYgYS52YWx1ZU9mKCkgPT09IGIudmFsdWVPZigpOwoJCQkJfSwKCgkJCQkicmVnZXhwIjogZnVuY3Rpb24oIGIsIGEgKSB7CgkJCQkJcmV0dXJuIFFVbml0Lm9iamVjdFR5cGUoIGIgKSA9PT0gInJlZ2V4cCIgJiYKCQkJCQkJLy8gdGhlIHJlZ2V4IGl0c2VsZgoJCQkJCQlhLnNvdXJjZSA9PT0gYi5zb3VyY2UgJiYKCQkJCQkJLy8gYW5kIGl0cyBtb2RpZmllcnMKCQkJCQkJYS5nbG9iYWwgPT09IGIuZ2xvYmFsICYmCgkJCQkJCS8vIChnbWkpIC4uLgoJCQkJCQlhLmlnbm9yZUNhc2UgPT09IGIuaWdub3JlQ2FzZSAmJgoJCQkJCQlhLm11bHRpbGluZSA9PT0gYi5tdWx0aWxpbmUgJiYKCQkJCQkJYS5zdGlja3kgPT09IGIuc3RpY2t5OwoJCQkJfSwKCgkJCQkvLyAtIHNraXAgd2hlbiB0aGUgcHJvcGVydHkgaXMgYSBtZXRob2Qgb2YgYW4gaW5zdGFuY2UgKE9PUCkKCQkJCS8vIC0gYWJvcnQgb3RoZXJ3aXNlLAoJCQkJLy8gaW5pdGlhbCA9PT0gd291bGQgaGF2ZSBjYXRjaCBpZGVudGljYWwgcmVmZXJlbmNlcyBhbnl3YXkKCQkJCSJmdW5jdGlvbiI6IGZ1bmN0aW9uKCkgewoJCQkJCXZhciBjYWxsZXIgPSBjYWxsZXJzW2NhbGxlcnMubGVuZ3RoIC0gMV07CgkJCQkJcmV0dXJuIGNhbGxlciAhPT0gT2JqZWN0ICYmIHR5cGVvZiBjYWxsZXIgIT09ICJ1bmRlZmluZWQiOwoJCQkJfSwKCgkJCQkiYXJyYXkiOiBmdW5jdGlvbiggYiwgYSApIHsKCQkJCQl2YXIgaSwgaiwgbGVuLCBsb29wLCBhQ2lyY3VsYXIsIGJDaXJjdWxhcjsKCgkJCQkJLy8gYiBjb3VsZCBiZSBhbiBvYmplY3QgbGl0ZXJhbCBoZXJlCgkJCQkJaWYgKCBRVW5pdC5vYmplY3RUeXBlKCBiICkgIT09ICJhcnJheSIgKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgoJCQkJCWxlbiA9IGEubGVuZ3RoOwoJCQkJCWlmICggbGVuICE9PSBiLmxlbmd0aCApIHsKCQkJCQkJLy8gc2FmZSBhbmQgZmFzdGVyCgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgoJCQkJCS8vIHRyYWNrIHJlZmVyZW5jZSB0byBhdm9pZCBjaXJjdWxhciByZWZlcmVuY2VzCgkJCQkJcGFyZW50cy5wdXNoKCBhICk7CgkJCQkJcGFyZW50c0IucHVzaCggYiApOwoJCQkJCWZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7CgkJCQkJCWxvb3AgPSBmYWxzZTsKCQkJCQkJZm9yICggaiA9IDA7IGogPCBwYXJlbnRzLmxlbmd0aDsgaisrICkgewoJCQkJCQkJYUNpcmN1bGFyID0gcGFyZW50c1tqXSA9PT0gYVtpXTsKCQkJCQkJCWJDaXJjdWxhciA9IHBhcmVudHNCW2pdID09PSBiW2ldOwoJCQkJCQkJaWYgKCBhQ2lyY3VsYXIgfHwgYkNpcmN1bGFyICkgewoJCQkJCQkJCWlmICggYVtpXSA9PT0gYltpXSB8fCBhQ2lyY3VsYXIgJiYgYkNpcmN1bGFyICkgewoJCQkJCQkJCQlsb29wID0gdHJ1ZTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlwYXJlbnRzLnBvcCgpOwoJCQkJCQkJCQlwYXJlbnRzQi5wb3AoKTsKCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpZiAoICFsb29wICYmICFpbm5lckVxdWl2KGFbaV0sIGJbaV0pICkgewoJCQkJCQkJcGFyZW50cy5wb3AoKTsKCQkJCQkJCXBhcmVudHNCLnBvcCgpOwoJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXBhcmVudHMucG9wKCk7CgkJCQkJcGFyZW50c0IucG9wKCk7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9LAoKCQkJCSJvYmplY3QiOiBmdW5jdGlvbiggYiwgYSApIHsKCQkJCQkvKmpzaGludCBmb3JpbjpmYWxzZSAqLwoJCQkJCXZhciBpLCBqLCBsb29wLCBhQ2lyY3VsYXIsIGJDaXJjdWxhciwKCQkJCQkJLy8gRGVmYXVsdCB0byB0cnVlCgkJCQkJCWVxID0gdHJ1ZSwKCQkJCQkJYVByb3BlcnRpZXMgPSBbXSwKCQkJCQkJYlByb3BlcnRpZXMgPSBbXTsKCgkJCQkJLy8gY29tcGFyaW5nIGNvbnN0cnVjdG9ycyBpcyBtb3JlIHN0cmljdCB0aGFuIHVzaW5nCgkJCQkJLy8gaW5zdGFuY2VvZgoJCQkJCWlmICggYS5jb25zdHJ1Y3RvciAhPT0gYi5jb25zdHJ1Y3RvciApIHsKCQkJCQkJLy8gQWxsb3cgb2JqZWN0cyB3aXRoIG5vIHByb3RvdHlwZSB0byBiZSBlcXVpdmFsZW50IHRvCgkJCQkJCS8vIG9iamVjdHMgd2l0aCBPYmplY3QgYXMgdGhlaXIgY29uc3RydWN0b3IuCgkJCQkJCWlmICggISgoIGdldFByb3RvKGEpID09PSBudWxsICYmIGdldFByb3RvKGIpID09PSBPYmplY3QucHJvdG90eXBlICkgfHwKCQkJCQkJCSggZ2V0UHJvdG8oYikgPT09IG51bGwgJiYgZ2V0UHJvdG8oYSkgPT09IE9iamVjdC5wcm90b3R5cGUgKSApICkgewoJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gc3RhY2sgY29uc3RydWN0b3IgYmVmb3JlIHRyYXZlcnNpbmcgcHJvcGVydGllcwoJCQkJCWNhbGxlcnMucHVzaCggYS5jb25zdHJ1Y3RvciApOwoKCQkJCQkvLyB0cmFjayByZWZlcmVuY2UgdG8gYXZvaWQgY2lyY3VsYXIgcmVmZXJlbmNlcwoJCQkJCXBhcmVudHMucHVzaCggYSApOwoJCQkJCXBhcmVudHNCLnB1c2goIGIgKTsKCgkJCQkJLy8gYmUgc3RyaWN0OiBkb24ndCBlbnN1cmUgaGFzT3duUHJvcGVydHkgYW5kIGdvIGRlZXAKCQkJCQlmb3IgKCBpIGluIGEgKSB7CgkJCQkJCWxvb3AgPSBmYWxzZTsKCQkJCQkJZm9yICggaiA9IDA7IGogPCBwYXJlbnRzLmxlbmd0aDsgaisrICkgewoJCQkJCQkJYUNpcmN1bGFyID0gcGFyZW50c1tqXSA9PT0gYVtpXTsKCQkJCQkJCWJDaXJjdWxhciA9IHBhcmVudHNCW2pdID09PSBiW2ldOwoJCQkJCQkJaWYgKCBhQ2lyY3VsYXIgfHwgYkNpcmN1bGFyICkgewoJCQkJCQkJCWlmICggYVtpXSA9PT0gYltpXSB8fCBhQ2lyY3VsYXIgJiYgYkNpcmN1bGFyICkgewoJCQkJCQkJCQlsb29wID0gdHJ1ZTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQllcSA9IGZhbHNlOwoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJYVByb3BlcnRpZXMucHVzaChpKTsKCQkJCQkJaWYgKCAhbG9vcCAmJiAhaW5uZXJFcXVpdihhW2ldLCBiW2ldKSApIHsKCQkJCQkJCWVxID0gZmFsc2U7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJcGFyZW50cy5wb3AoKTsKCQkJCQlwYXJlbnRzQi5wb3AoKTsKCQkJCQljYWxsZXJzLnBvcCgpOyAvLyB1bnN0YWNrLCB3ZSBhcmUgZG9uZQoKCQkJCQlmb3IgKCBpIGluIGIgKSB7CgkJCQkJCWJQcm9wZXJ0aWVzLnB1c2goIGkgKTsgLy8gY29sbGVjdCBiJ3MgcHJvcGVydGllcwoJCQkJCX0KCgkJCQkJLy8gRW5zdXJlcyBpZGVudGljYWwgcHJvcGVydGllcyBuYW1lCgkJCQkJcmV0dXJuIGVxICYmIGlubmVyRXF1aXYoIGFQcm9wZXJ0aWVzLnNvcnQoKSwgYlByb3BlcnRpZXMuc29ydCgpICk7CgkJCQl9CgkJCX07CgkJfSgpKTsKCglpbm5lckVxdWl2ID0gZnVuY3Rpb24oKSB7IC8vIGNhbiB0YWtlIG11bHRpcGxlIGFyZ3VtZW50cwoJCXZhciBhcmdzID0gW10uc2xpY2UuYXBwbHkoIGFyZ3VtZW50cyApOwoJCWlmICggYXJncy5sZW5ndGggPCAyICkgewoJCQlyZXR1cm4gdHJ1ZTsgLy8gZW5kIHRyYW5zaXRpb24KCQl9CgoJCXJldHVybiAoZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYSA9PT0gYiApIHsKCQkJCXJldHVybiB0cnVlOyAvLyBjYXRjaCB0aGUgbW9zdCB5b3UgY2FuCgkJCX0gZWxzZSBpZiAoIGEgPT09IG51bGwgfHwgYiA9PT0gbnVsbCB8fCB0eXBlb2YgYSA9PT0gInVuZGVmaW5lZCIgfHwKCQkJCQl0eXBlb2YgYiA9PT0gInVuZGVmaW5lZCIgfHwKCQkJCQlRVW5pdC5vYmplY3RUeXBlKGEpICE9PSBRVW5pdC5vYmplY3RUeXBlKGIpICkgewoJCQkJcmV0dXJuIGZhbHNlOyAvLyBkb24ndCBsb3NlIHRpbWUgd2l0aCBlcnJvciBwcm9uZSBjYXNlcwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIGJpbmRDYWxsYmFja3MoYSwgY2FsbGJhY2tzLCBbIGIsIGEgXSk7CgkJCX0KCgkJCS8vIGFwcGx5IHRyYW5zaXRpb24gd2l0aCAoMS4ubikgYXJndW1lbnRzCgkJfSggYXJnc1swXSwgYXJnc1sxXSApICYmIGlubmVyRXF1aXYuYXBwbHkoIHRoaXMsIGFyZ3Muc3BsaWNlKDEsIGFyZ3MubGVuZ3RoIC0gMSApKSApOwoJfTsKCglyZXR1cm4gaW5uZXJFcXVpdjsKfSgpKTsKCi8qKgogKiBqc0R1bXAgQ29weXJpZ2h0IChjKSAyMDA4IEFyaWVsIEZsZXNsZXIgLSBhZmxlc2xlcihhdClnbWFpbChkb3QpY29tIHwKICogaHR0cDovL2ZsZXNsZXIuYmxvZ3Nwb3QuY29tIExpY2Vuc2VkIHVuZGVyIEJTRAogKiAoaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9ic2QtbGljZW5zZS5waHApIERhdGU6IDUvMTUvMjAwOAogKgogKiBAcHJvamVjdERlc2NyaXB0aW9uIEFkdmFuY2VkIGFuZCBleHRlbnNpYmxlIGRhdGEgZHVtcGluZyBmb3IgSmF2YXNjcmlwdC4KICogQHZlcnNpb24gMS4wLjAKICogQGF1dGhvciBBcmllbCBGbGVzbGVyCiAqIEBsaW5rIHtodHRwOi8vZmxlc2xlci5ibG9nc3BvdC5jb20vMjAwOC8wNS9qc2R1bXAtcHJldHR5LWR1bXAtb2YtYW55LWphdmFzY3JpcHQuaHRtbH0KICovClFVbml0LmpzRHVtcCA9IChmdW5jdGlvbigpIHsKCWZ1bmN0aW9uIHF1b3RlKCBzdHIgKSB7CgkJcmV0dXJuICJcIiIgKyBzdHIudG9TdHJpbmcoKS5yZXBsYWNlKCAvIi9nLCAiXFxcIiIgKSArICJcIiI7Cgl9CglmdW5jdGlvbiBsaXRlcmFsKCBvICkgewoJCXJldHVybiBvICsgIiI7Cgl9CglmdW5jdGlvbiBqb2luKCBwcmUsIGFyciwgcG9zdCApIHsKCQl2YXIgcyA9IGpzRHVtcC5zZXBhcmF0b3IoKSwKCQkJYmFzZSA9IGpzRHVtcC5pbmRlbnQoKSwKCQkJaW5uZXIgPSBqc0R1bXAuaW5kZW50KDEpOwoJCWlmICggYXJyLmpvaW4gKSB7CgkJCWFyciA9IGFyci5qb2luKCAiLCIgKyBzICsgaW5uZXIgKTsKCQl9CgkJaWYgKCAhYXJyICkgewoJCQlyZXR1cm4gcHJlICsgcG9zdDsKCQl9CgkJcmV0dXJuIFsgcHJlLCBpbm5lciArIGFyciwgYmFzZSArIHBvc3QgXS5qb2luKHMpOwoJfQoJZnVuY3Rpb24gYXJyYXkoIGFyciwgc3RhY2sgKSB7CgkJdmFyIGkgPSBhcnIubGVuZ3RoLCByZXQgPSBuZXcgQXJyYXkoaSk7CgkJdGhpcy51cCgpOwoJCXdoaWxlICggaS0tICkgewoJCQlyZXRbaV0gPSB0aGlzLnBhcnNlKCBhcnJbaV0gLCB1bmRlZmluZWQgLCBzdGFjayk7CgkJfQoJCXRoaXMuZG93bigpOwoJCXJldHVybiBqb2luKCAiWyIsIHJldCwgIl0iICk7Cgl9CgoJdmFyIHJlTmFtZSA9IC9eZnVuY3Rpb24gKFx3KykvLAoJCWpzRHVtcCA9IHsKCQkJLy8gdHlwZSBpcyB1c2VkIG1vc3RseSBpbnRlcm5hbGx5LCB5b3UgY2FuIGZpeCBhIChjdXN0b20pdHlwZSBpbiBhZHZhbmNlCgkJCXBhcnNlOiBmdW5jdGlvbiggb2JqLCB0eXBlLCBzdGFjayApIHsKCQkJCXN0YWNrID0gc3RhY2sgfHwgWyBdOwoJCQkJdmFyIGluU3RhY2ssIHJlcywKCQkJCQlwYXJzZXIgPSB0aGlzLnBhcnNlcnNbIHR5cGUgfHwgdGhpcy50eXBlT2Yob2JqKSBdOwoKCQkJCXR5cGUgPSB0eXBlb2YgcGFyc2VyOwoJCQkJaW5TdGFjayA9IGluQXJyYXkoIG9iaiwgc3RhY2sgKTsKCgkJCQlpZiAoIGluU3RhY2sgIT09IC0xICkgewoJCQkJCXJldHVybiAicmVjdXJzaW9uKCIgKyAoaW5TdGFjayAtIHN0YWNrLmxlbmd0aCkgKyAiKSI7CgkJCQl9CgkJCQlpZiAoIHR5cGUgPT09ICJmdW5jdGlvbiIgKSAgewoJCQkJCXN0YWNrLnB1c2goIG9iaiApOwoJCQkJCXJlcyA9IHBhcnNlci5jYWxsKCB0aGlzLCBvYmosIHN0YWNrICk7CgkJCQkJc3RhY2sucG9wKCk7CgkJCQkJcmV0dXJuIHJlczsKCQkJCX0KCQkJCXJldHVybiAoIHR5cGUgPT09ICJzdHJpbmciICkgPyBwYXJzZXIgOiB0aGlzLnBhcnNlcnMuZXJyb3I7CgkJCX0sCgkJCXR5cGVPZjogZnVuY3Rpb24oIG9iaiApIHsKCQkJCXZhciB0eXBlOwoJCQkJaWYgKCBvYmogPT09IG51bGwgKSB7CgkJCQkJdHlwZSA9ICJudWxsIjsKCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiICkgewoJCQkJCXR5cGUgPSAidW5kZWZpbmVkIjsKCQkJCX0gZWxzZSBpZiAoIFFVbml0LmlzKCAicmVnZXhwIiwgb2JqKSApIHsKCQkJCQl0eXBlID0gInJlZ2V4cCI7CgkJCQl9IGVsc2UgaWYgKCBRVW5pdC5pcyggImRhdGUiLCBvYmopICkgewoJCQkJCXR5cGUgPSAiZGF0ZSI7CgkJCQl9IGVsc2UgaWYgKCBRVW5pdC5pcyggImZ1bmN0aW9uIiwgb2JqKSApIHsKCQkJCQl0eXBlID0gImZ1bmN0aW9uIjsKCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiBvYmouc2V0SW50ZXJ2YWwgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb2JqLmRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygb2JqLm5vZGVUeXBlID09PSAidW5kZWZpbmVkIiApIHsKCQkJCQl0eXBlID0gIndpbmRvdyI7CgkJCQl9IGVsc2UgaWYgKCBvYmoubm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJdHlwZSA9ICJkb2N1bWVudCI7CgkJCQl9IGVsc2UgaWYgKCBvYmoubm9kZVR5cGUgKSB7CgkJCQkJdHlwZSA9ICJub2RlIjsKCQkJCX0gZWxzZSBpZiAoCgkJCQkJLy8gbmF0aXZlIGFycmF5cwoJCQkJCXRvU3RyaW5nLmNhbGwoIG9iaiApID09PSAiW29iamVjdCBBcnJheV0iIHx8CgkJCQkJLy8gTm9kZUxpc3Qgb2JqZWN0cwoJCQkJCSggdHlwZW9mIG9iai5sZW5ndGggPT09ICJudW1iZXIiICYmIHR5cGVvZiBvYmouaXRlbSAhPT0gInVuZGVmaW5lZCIgJiYgKCBvYmoubGVuZ3RoID8gb2JqLml0ZW0oMCkgPT09IG9ialswXSA6ICggb2JqLml0ZW0oIDAgKSA9PT0gbnVsbCAmJiB0eXBlb2Ygb2JqWzBdID09PSAidW5kZWZpbmVkIiApICkgKQoJCQkJKSB7CgkJCQkJdHlwZSA9ICJhcnJheSI7CgkJCQl9IGVsc2UgaWYgKCBvYmouY29uc3RydWN0b3IgPT09IEVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciApIHsKCQkJCQl0eXBlID0gImVycm9yIjsKCQkJCX0gZWxzZSB7CgkJCQkJdHlwZSA9IHR5cGVvZiBvYmo7CgkJCQl9CgkJCQlyZXR1cm4gdHlwZTsKCQkJfSwKCQkJc2VwYXJhdG9yOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiB0aGlzLm11bHRpbGluZSA\/CXRoaXMuSFRNTCA\/ICI8YnIgLz4iIDogIlxuIiA6IHRoaXMuSFRNTCA\/ICImbmJzcDsiIDogIiAiOwoJCQl9LAoJCQkvLyBleHRyYSBjYW4gYmUgYSBudW1iZXIsIHNob3J0Y3V0IGZvciBpbmNyZWFzaW5nLWNhbGxpbmctZGVjcmVhc2luZwoJCQlpbmRlbnQ6IGZ1bmN0aW9uKCBleHRyYSApIHsKCQkJCWlmICggIXRoaXMubXVsdGlsaW5lICkgewoJCQkJCXJldHVybiAiIjsKCQkJCX0KCQkJCXZhciBjaHIgPSB0aGlzLmluZGVudENoYXI7CgkJCQlpZiAoIHRoaXMuSFRNTCApIHsKCQkJCQljaHIgPSBjaHIucmVwbGFjZSggL1x0L2csICIgICAiICkucmVwbGFjZSggLyAvZywgIiZuYnNwOyIgKTsKCQkJCX0KCQkJCXJldHVybiBuZXcgQXJyYXkoIHRoaXMuZGVwdGggKyAoIGV4dHJhIHx8IDAgKSApLmpvaW4oY2hyKTsKCQkJfSwKCQkJdXA6IGZ1bmN0aW9uKCBhICkgewoJCQkJdGhpcy5kZXB0aCArPSBhIHx8IDE7CgkJCX0sCgkJCWRvd246IGZ1bmN0aW9uKCBhICkgewoJCQkJdGhpcy5kZXB0aCAtPSBhIHx8IDE7CgkJCX0sCgkJCXNldFBhcnNlcjogZnVuY3Rpb24oIG5hbWUsIHBhcnNlciApIHsKCQkJCXRoaXMucGFyc2Vyc1tuYW1lXSA9IHBhcnNlcjsKCQkJfSwKCQkJLy8gVGhlIG5leHQgMyBhcmUgZXhwb3NlZCBzbyB5b3UgY2FuIHVzZSB0aGVtCgkJCXF1b3RlOiBxdW90ZSwKCQkJbGl0ZXJhbDogbGl0ZXJhbCwKCQkJam9pbjogam9pbiwKCQkJLy8KCQkJZGVwdGg6IDEsCgkJCS8vIFRoaXMgaXMgdGhlIGxpc3Qgb2YgcGFyc2VycywgdG8gbW9kaWZ5IHRoZW0sIHVzZSBqc0R1bXAuc2V0UGFyc2VyCgkJCXBhcnNlcnM6IHsKCQkJCXdpbmRvdzogIltXaW5kb3ddIiwKCQkJCWRvY3VtZW50OiAiW0RvY3VtZW50XSIsCgkJCQllcnJvcjogZnVuY3Rpb24oZXJyb3IpIHsKCQkJCQlyZXR1cm4gIkVycm9yKFwiIiArIGVycm9yLm1lc3NhZ2UgKyAiXCIpIjsKCQkJCX0sCgkJCQl1bmtub3duOiAiW1Vua25vd25dIiwKCQkJCSJudWxsIjogIm51bGwiLAoJCQkJInVuZGVmaW5lZCI6ICJ1bmRlZmluZWQiLAoJCQkJImZ1bmN0aW9uIjogZnVuY3Rpb24oIGZuICkgewoJCQkJCXZhciByZXQgPSAiZnVuY3Rpb24iLAoJCQkJCQkvLyBmdW5jdGlvbnMgbmV2ZXIgaGF2ZSBuYW1lIGluIElFCgkJCQkJCW5hbWUgPSAibmFtZSIgaW4gZm4gPyBmbi5uYW1lIDogKHJlTmFtZS5leGVjKGZuKSB8fCBbXSlbMV07CgoJCQkJCWlmICggbmFtZSApIHsKCQkJCQkJcmV0ICs9ICIgIiArIG5hbWU7CgkJCQkJfQoJCQkJCXJldCArPSAiKCAiOwoKCQkJCQlyZXQgPSBbIHJldCwgUVVuaXQuanNEdW1wLnBhcnNlKCBmbiwgImZ1bmN0aW9uQXJncyIgKSwgIil7IiBdLmpvaW4oICIiICk7CgkJCQkJcmV0dXJuIGpvaW4oIHJldCwgUVVuaXQuanNEdW1wLnBhcnNlKGZuLCJmdW5jdGlvbkNvZGUiICksICJ9IiApOwoJCQkJfSwKCQkJCWFycmF5OiBhcnJheSwKCQkJCW5vZGVsaXN0OiBhcnJheSwKCQkJCSJhcmd1bWVudHMiOiBhcnJheSwKCQkJCW9iamVjdDogZnVuY3Rpb24oIG1hcCwgc3RhY2sgKSB7CgkJCQkJLypqc2hpbnQgZm9yaW46ZmFsc2UgKi8KCQkJCQl2YXIgcmV0ID0gWyBdLCBrZXlzLCBrZXksIHZhbCwgaTsKCQkJCQlRVW5pdC5qc0R1bXAudXAoKTsKCQkJCQlrZXlzID0gW107CgkJCQkJZm9yICgga2V5IGluIG1hcCApIHsKCQkJCQkJa2V5cy5wdXNoKCBrZXkgKTsKCQkJCQl9CgkJCQkJa2V5cy5zb3J0KCk7CgkJCQkJZm9yICggaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrICkgewoJCQkJCQlrZXkgPSBrZXlzWyBpIF07CgkJCQkJCXZhbCA9IG1hcFsga2V5IF07CgkJCQkJCXJldC5wdXNoKCBRVW5pdC5qc0R1bXAucGFyc2UoIGtleSwgImtleSIgKSArICI6ICIgKyBRVW5pdC5qc0R1bXAucGFyc2UoIHZhbCwgdW5kZWZpbmVkLCBzdGFjayApICk7CgkJCQkJfQoJCQkJCVFVbml0LmpzRHVtcC5kb3duKCk7CgkJCQkJcmV0dXJuIGpvaW4oICJ7IiwgcmV0LCAifSIgKTsKCQkJCX0sCgkJCQlub2RlOiBmdW5jdGlvbiggbm9kZSApIHsKCQkJCQl2YXIgbGVuLCBpLCB2YWwsCgkJCQkJCW9wZW4gPSBRVW5pdC5qc0R1bXAuSFRNTCA\/ICImbHQ7IiA6ICI8IiwKCQkJCQkJY2xvc2UgPSBRVW5pdC5qc0R1bXAuSFRNTCA\/ICImZ3Q7IiA6ICI+IiwKCQkJCQkJdGFnID0gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCQlyZXQgPSBvcGVuICsgdGFnLAoJCQkJCQlhdHRycyA9IG5vZGUuYXR0cmlidXRlczsKCgkJCQkJaWYgKCBhdHRycyApIHsKCQkJCQkJZm9yICggaSA9IDAsIGxlbiA9IGF0dHJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCQkJdmFsID0gYXR0cnNbaV0ubm9kZVZhbHVlOwoJCQkJCQkJLy8gSUU2IGluY2x1ZGVzIGFsbCBhdHRyaWJ1dGVzIGluIC5hdHRyaWJ1dGVzLCBldmVuIG9uZXMgbm90IGV4cGxpY2l0bHkgc2V0LgoJCQkJCQkJLy8gVGhvc2UgaGF2ZSB2YWx1ZXMgbGlrZSB1bmRlZmluZWQsIG51bGwsIDAsIGZhbHNlLCAiIiBvciAiaW5oZXJpdCIuCgkJCQkJCQlpZiAoIHZhbCAmJiB2YWwgIT09ICJpbmhlcml0IiApIHsKCQkJCQkJCQlyZXQgKz0gIiAiICsgYXR0cnNbaV0ubm9kZU5hbWUgKyAiPSIgKyBRVW5pdC5qc0R1bXAucGFyc2UoIHZhbCwgImF0dHJpYnV0ZSIgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXQgKz0gY2xvc2U7CgoJCQkJCS8vIFNob3cgY29udGVudCBvZiBUZXh0Tm9kZSBvciBDREFUQVNlY3Rpb24KCQkJCQlpZiAoIG5vZGUubm9kZVR5cGUgPT09IDMgfHwgbm9kZS5ub2RlVHlwZSA9PT0gNCApIHsKCQkJCQkJcmV0ICs9IG5vZGUubm9kZVZhbHVlOwoJCQkJCX0KCgkJCQkJcmV0dXJuIHJldCArIG9wZW4gKyAiLyIgKyB0YWcgKyBjbG9zZTsKCQkJCX0sCgkJCQkvLyBmdW5jdGlvbiBjYWxscyBpdCBpbnRlcm5hbGx5LCBpdCdzIHRoZSBhcmd1bWVudHMgcGFydCBvZiB0aGUgZnVuY3Rpb24KCQkJCWZ1bmN0aW9uQXJnczogZnVuY3Rpb24oIGZuICkgewoJCQkJCXZhciBhcmdzLAoJCQkJCQlsID0gZm4ubGVuZ3RoOwoKCQkJCQlpZiAoICFsICkgewoJCQkJCQlyZXR1cm4gIiI7CgkJCQkJfQoKCQkJCQlhcmdzID0gbmV3IEFycmF5KGwpOwoJCQkJCXdoaWxlICggbC0tICkgewoJCQkJCQkvLyA5NyBpcyAnYScKCQkJCQkJYXJnc1tsXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoOTcrbCk7CgkJCQkJfQoJCQkJCXJldHVybiAiICIgKyBhcmdzLmpvaW4oICIsICIgKSArICIgIjsKCQkJCX0sCgkJCQkvLyBvYmplY3QgY2FsbHMgaXQgaW50ZXJuYWxseSwgdGhlIGtleSBwYXJ0IG9mIGFuIGl0ZW0gaW4gYSBtYXAKCQkJCWtleTogcXVvdGUsCgkJCQkvLyBmdW5jdGlvbiBjYWxscyBpdCBpbnRlcm5hbGx5LCBpdCdzIHRoZSBjb250ZW50IG9mIHRoZSBmdW5jdGlvbgoJCQkJZnVuY3Rpb25Db2RlOiAiW2NvZGVdIiwKCQkJCS8vIG5vZGUgY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyBhbiBodG1sIGF0dHJpYnV0ZSB2YWx1ZQoJCQkJYXR0cmlidXRlOiBxdW90ZSwKCQkJCXN0cmluZzogcXVvdGUsCgkJCQlkYXRlOiBxdW90ZSwKCQkJCXJlZ2V4cDogbGl0ZXJhbCwKCQkJCW51bWJlcjogbGl0ZXJhbCwKCQkJCSJib29sZWFuIjogbGl0ZXJhbAoJCQl9LAoJCQkvLyBpZiB0cnVlLCBlbnRpdGllcyBhcmUgZXNjYXBlZCAoIDwsID4sIFx0LCBzcGFjZSBhbmQgXG4gKQoJCQlIVE1MOiBmYWxzZSwKCQkJLy8gaW5kZW50YXRpb24gdW5pdAoJCQlpbmRlbnRDaGFyOiAiICAiLAoJCQkvLyBpZiB0cnVlLCBpdGVtcyBpbiBhIGNvbGxlY3Rpb24sIGFyZSBzZXBhcmF0ZWQgYnkgYSBcbiwgZWxzZSBqdXN0IGEgc3BhY2UuCgkJCW11bHRpbGluZTogdHJ1ZQoJCX07CgoJcmV0dXJuIGpzRHVtcDsKfSgpKTsKCi8qCiAqIEphdmFzY3JpcHQgRGlmZiBBbGdvcml0aG0KICogIEJ5IEpvaG4gUmVzaWcgKGh0dHA6Ly9lam9obi5vcmcvKQogKiAgTW9kaWZpZWQgYnkgQ2h1IEFsYW4gInNwcml0ZSIKICoKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKgogKiBNb3JlIEluZm86CiAqICBodHRwOi8vZWpvaG4ub3JnL3Byb2plY3RzL2phdmFzY3JpcHQtZGlmZi1hbGdvcml0aG0vCiAqCiAqIFVzYWdlOiBRVW5pdC5kaWZmKGV4cGVjdGVkLCBhY3R1YWwpCiAqCiAqIFFVbml0LmRpZmYoICJ0aGUgcXVpY2sgYnJvd24gZm94IGp1bXBlZCBvdmVyIiwgInRoZSBxdWljayBmb3gganVtcHMgb3ZlciIgKSA9PSAidGhlICBxdWljayA8ZGVsPmJyb3duIDwvZGVsPiBmb3ggPGRlbD5qdW1wZWQgPC9kZWw+PGlucz5qdW1wcyA8L2lucz4gb3ZlciIKICovClFVbml0LmRpZmYgPSAoZnVuY3Rpb24oKSB7CgkvKmpzaGludCBlcWVxZXE6ZmFsc2UsIGVxbnVsbDp0cnVlICovCglmdW5jdGlvbiBkaWZmKCBvLCBuICkgewoJCXZhciBpLAoJCQlucyA9IHt9LAoJCQlvcyA9IHt9OwoKCQlmb3IgKCBpID0gMDsgaSA8IG4ubGVuZ3RoOyBpKysgKSB7CgkJCWlmICggIWhhc093bi5jYWxsKCBucywgbltpXSApICkgewoJCQkJbnNbIG5baV0gXSA9IHsKCQkJCQlyb3dzOiBbXSwKCQkJCQlvOiBudWxsCgkJCQl9OwoJCQl9CgkJCW5zWyBuW2ldIF0ucm93cy5wdXNoKCBpICk7CgkJfQoKCQlmb3IgKCBpID0gMDsgaSA8IG8ubGVuZ3RoOyBpKysgKSB7CgkJCWlmICggIWhhc093bi5jYWxsKCBvcywgb1tpXSApICkgewoJCQkJb3NbIG9baV0gXSA9IHsKCQkJCQlyb3dzOiBbXSwKCQkJCQluOiBudWxsCgkJCQl9OwoJCQl9CgkJCW9zWyBvW2ldIF0ucm93cy5wdXNoKCBpICk7CgkJfQoKCQlmb3IgKCBpIGluIG5zICkgewoJCQlpZiAoIGhhc093bi5jYWxsKCBucywgaSApICkgewoJCQkJaWYgKCBuc1tpXS5yb3dzLmxlbmd0aCA9PT0gMSAmJiBoYXNPd24uY2FsbCggb3MsIGkgKSAmJiBvc1tpXS5yb3dzLmxlbmd0aCA9PT0gMSApIHsKCQkJCQluWyBuc1tpXS5yb3dzWzBdIF0gPSB7CgkJCQkJCXRleHQ6IG5bIG5zW2ldLnJvd3NbMF0gXSwKCQkJCQkJcm93OiBvc1tpXS5yb3dzWzBdCgkJCQkJfTsKCQkJCQlvWyBvc1tpXS5yb3dzWzBdIF0gPSB7CgkJCQkJCXRleHQ6IG9bIG9zW2ldLnJvd3NbMF0gXSwKCQkJCQkJcm93OiBuc1tpXS5yb3dzWzBdCgkJCQkJfTsKCQkJCX0KCQkJfQoJCX0KCgkJZm9yICggaSA9IDA7IGkgPCBuLmxlbmd0aCAtIDE7IGkrKyApIHsKCQkJaWYgKCBuW2ldLnRleHQgIT0gbnVsbCAmJiBuWyBpICsgMSBdLnRleHQgPT0gbnVsbCAmJiBuW2ldLnJvdyArIDEgPCBvLmxlbmd0aCAmJiBvWyBuW2ldLnJvdyArIDEgXS50ZXh0ID09IG51bGwgJiYKCQkJCQkJblsgaSArIDEgXSA9PSBvWyBuW2ldLnJvdyArIDEgXSApIHsKCgkJCQluWyBpICsgMSBdID0gewoJCQkJCXRleHQ6IG5bIGkgKyAxIF0sCgkJCQkJcm93OiBuW2ldLnJvdyArIDEKCQkJCX07CgkJCQlvWyBuW2ldLnJvdyArIDEgXSA9IHsKCQkJCQl0ZXh0OiBvWyBuW2ldLnJvdyArIDEgXSwKCQkJCQlyb3c6IGkgKyAxCgkJCQl9OwoJCQl9CgkJfQoKCQlmb3IgKCBpID0gbi5sZW5ndGggLSAxOyBpID4gMDsgaS0tICkgewoJCQlpZiAoIG5baV0udGV4dCAhPSBudWxsICYmIG5bIGkgLSAxIF0udGV4dCA9PSBudWxsICYmIG5baV0ucm93ID4gMCAmJiBvWyBuW2ldLnJvdyAtIDEgXS50ZXh0ID09IG51bGwgJiYKCQkJCQkJblsgaSAtIDEgXSA9PSBvWyBuW2ldLnJvdyAtIDEgXSkgewoKCQkJCW5bIGkgLSAxIF0gPSB7CgkJCQkJdGV4dDogblsgaSAtIDEgXSwKCQkJCQlyb3c6IG5baV0ucm93IC0gMQoJCQkJfTsKCQkJCW9bIG5baV0ucm93IC0gMSBdID0gewoJCQkJCXRleHQ6IG9bIG5baV0ucm93IC0gMSBdLAoJCQkJCXJvdzogaSAtIDEKCQkJCX07CgkJCX0KCQl9CgoJCXJldHVybiB7CgkJCW86IG8sCgkJCW46IG4KCQl9OwoJfQoKCXJldHVybiBmdW5jdGlvbiggbywgbiApIHsKCQlvID0gby5yZXBsYWNlKCAvXHMrJC8sICIiICk7CgkJbiA9IG4ucmVwbGFjZSggL1xzKyQvLCAiIiApOwoKCQl2YXIgaSwgcHJlLAoJCQlzdHIgPSAiIiwKCQkJb3V0ID0gZGlmZiggbyA9PT0gIiIgPyBbXSA6IG8uc3BsaXQoL1xzKy8pLCBuID09PSAiIiA\/IFtdIDogbi5zcGxpdCgvXHMrLykgKSwKCQkJb1NwYWNlID0gby5tYXRjaCgvXHMrL2cpLAoJCQluU3BhY2UgPSBuLm1hdGNoKC9ccysvZyk7CgoJCWlmICggb1NwYWNlID09IG51bGwgKSB7CgkJCW9TcGFjZSA9IFsgIiAiIF07CgkJfQoJCWVsc2UgewoJCQlvU3BhY2UucHVzaCggIiAiICk7CgkJfQoKCQlpZiAoIG5TcGFjZSA9PSBudWxsICkgewoJCQluU3BhY2UgPSBbICIgIiBdOwoJCX0KCQllbHNlIHsKCQkJblNwYWNlLnB1c2goICIgIiApOwoJCX0KCgkJaWYgKCBvdXQubi5sZW5ndGggPT09IDAgKSB7CgkJCWZvciAoIGkgPSAwOyBpIDwgb3V0Lm8ubGVuZ3RoOyBpKysgKSB7CgkJCQlzdHIgKz0gIjxkZWw+IiArIG91dC5vW2ldICsgb1NwYWNlW2ldICsgIjwvZGVsPiI7CgkJCX0KCQl9CgkJZWxzZSB7CgkJCWlmICggb3V0Lm5bMF0udGV4dCA9PSBudWxsICkgewoJCQkJZm9yICggbiA9IDA7IG4gPCBvdXQuby5sZW5ndGggJiYgb3V0Lm9bbl0udGV4dCA9PSBudWxsOyBuKysgKSB7CgkJCQkJc3RyICs9ICI8ZGVsPiIgKyBvdXQub1tuXSArIG9TcGFjZVtuXSArICI8L2RlbD4iOwoJCQkJfQoJCQl9CgoJCQlmb3IgKCBpID0gMDsgaSA8IG91dC5uLmxlbmd0aDsgaSsrICkgewoJCQkJaWYgKG91dC5uW2ldLnRleHQgPT0gbnVsbCkgewoJCQkJCXN0ciArPSAiPGlucz4iICsgb3V0Lm5baV0gKyBuU3BhY2VbaV0gKyAiPC9pbnM+IjsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCS8vIGBwcmVgIGluaXRpYWxpemVkIGF0IHRvcCBvZiBzY29wZQoJCQkJCXByZSA9ICIiOwoKCQkJCQlmb3IgKCBuID0gb3V0Lm5baV0ucm93ICsgMTsgbiA8IG91dC5vLmxlbmd0aCAmJiBvdXQub1tuXS50ZXh0ID09IG51bGw7IG4rKyApIHsKCQkJCQkJcHJlICs9ICI8ZGVsPiIgKyBvdXQub1tuXSArIG9TcGFjZVtuXSArICI8L2RlbD4iOwoJCQkJCX0KCQkJCQlzdHIgKz0gIiAiICsgb3V0Lm5baV0udGV4dCArIG5TcGFjZVtpXSArIHByZTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHN0cjsKCX07Cn0oKSk7CgovLyBGb3IgYnJvd3NlciwgZXhwb3J0IG9ubHkgc2VsZWN0IGdsb2JhbHMKaWYgKCB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiApIHsKCWV4dGVuZCggd2luZG93LCBRVW5pdC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgKTsKCXdpbmRvdy5RVW5pdCA9IFFVbml0Owp9CgovLyBGb3IgQ29tbW9uSlMgZW52aXJvbm1lbnRzLCBleHBvcnQgZXZlcnl0aGluZwppZiAoIHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiICYmIG1vZHVsZS5leHBvcnRzICkgewoJbW9kdWxlLmV4cG9ydHMgPSBRVW5pdDsKfQoKCi8vIEdldCBhIHJlZmVyZW5jZSB0byB0aGUgZ2xvYmFsIG9iamVjdCwgbGlrZSB3aW5kb3cgaW4gYnJvd3NlcnMKfSggKGZ1bmN0aW9uKCkgewoJcmV0dXJuIHRoaXM7Cn0pKCkgKSk7Cg==",
    "size": "61033"
}