{
    "namaFile": "lib\/jpgraph\/jpgraph_bar.php",
    "lastUpdate": "2013-12-16+17:18:04.00",
    "contentFile": "PD9waHAKLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogLy8gRmlsZTogICAgICAgIEpQR1JBUEhfQkFSLlBIUAogLy8gRGVzY3JpcHRpb246IEJhciBwbG90IGV4dGVuc2lvbiBmb3IgSnBHcmFwaAogLy8gQ3JlYXRlZDogICAgIDIwMDEtMDEtMDgKIC8vIFZlcjogICAgICAgICAkSWQ6IGpwZ3JhcGhfYmFyLnBocCAxOTA1IDIwMDktMTAtMDYgMTg6MDA6MjFaIGxqcCAkCiAvLwogLy8gQ29weXJpZ2h0IChjKSBBc2lhbCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqLwoKcmVxdWlyZV9vbmNlKCdqcGdyYXBoX3Bsb3RiYW5kLnBocCcpOwoKLy8gUGF0dGVybiBmb3IgQmFycwpERUZJTkUoJ1BBVFRFUk5fRElBRzEnLDEpOwpERUZJTkUoJ1BBVFRFUk5fRElBRzInLDIpOwpERUZJTkUoJ1BBVFRFUk5fRElBRzMnLDMpOwpERUZJTkUoJ1BBVFRFUk5fRElBRzQnLDQpOwpERUZJTkUoJ1BBVFRFUk5fQ1JPU1MxJyw1KTsKREVGSU5FKCdQQVRURVJOX0NST1NTMicsNik7CkRFRklORSgnUEFUVEVSTl9DUk9TUzMnLDcpOwpERUZJTkUoJ1BBVFRFUk5fQ1JPU1M0Jyw4KTsKREVGSU5FKCdQQVRURVJOX1NUUklQRTEnLDkpOwpERUZJTkUoJ1BBVFRFUk5fU1RSSVBFMicsMTApOwoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ0xBU1MgQmFyUGxvdAovLyBEZXNjcmlwdGlvbjogTWFpbiBjb2RlIHRvIHByb2R1Y2UgYSBiYXIgcGxvdAovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjbGFzcyBCYXJQbG90IGV4dGVuZHMgUGxvdCB7CiAgICBwdWJsaWMgJGZpbGw9ZmFsc2UsJGZpbGxfY29sb3I9ImxpZ2h0Ymx1ZSI7IC8vIERlZmF1bHQgaXMgdG8gZmlsbCB3aXRoIGxpZ2h0IGJsdWUKICAgIHB1YmxpYyAkaVBhdHRlcm49LTEsJGlQYXR0ZXJuRGVuc2l0eT04MCwkaVBhdHRlcm5Db2xvcj0nYmxhY2snOwogICAgcHVibGljICR2YWx1ZXBvcz0ndG9wJzsKICAgIHB1YmxpYyAkZ3JhZD1mYWxzZSwkZ3JhZF9zdHlsZT0xOwogICAgcHVibGljICRncmFkX2Zyb21jb2xvcj1hcnJheSg1MCw1MCwyMDApLCRncmFkX3RvY29sb3I9YXJyYXkoMjU1LDI1NSwyNTUpOwogICAgcHVibGljICR5bWluPTA7CiAgICBwcm90ZWN0ZWQgJHdpZHRoPTAuNDsgLy8gaW4gcGVyY2VudCBvZiBtYWpvciB0aWNrcwogICAgcHJvdGVjdGVkICRhYnN3aWR0aD0tMTsgLy8gV2lkdGggaW4gYWJzb2x1dGUgcGl4ZWxzCiAgICBwcm90ZWN0ZWQgJHliYXNlPTA7IC8vIEJhcnMgc3RhcnQgYXQgMAogICAgcHJvdGVjdGVkICRhbGlnbj0iY2VudGVyIjsKICAgIHByb3RlY3RlZCAkYmFyX3NoYWRvdz1mYWxzZTsKICAgIHByb3RlY3RlZCAkYmFyX3NoYWRvd19jb2xvcj0iYmxhY2siOwogICAgcHJvdGVjdGVkICRiYXJfc2hhZG93X2hzaXplPTMsJGJhcl9zaGFkb3dfdnNpemU9MzsKICAgIHByb3RlY3RlZCAkYmFyXzNkPWZhbHNlOwogICAgcHJvdGVjdGVkICRiYXJfM2RfaHNpemU9MywkYmFyXzNkX3ZzaXplPTM7CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIENPTlNUUlVDVE9SCiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkZGF0YXksJGRhdGF4PWZhbHNlKSB7CiAgICAgICAgcGFyZW50OjpfX2NvbnN0cnVjdCgkZGF0YXksJGRhdGF4KTsKICAgICAgICArKyR0aGlzLT5udW1wb2ludHM7CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgLy8gU2V0IGEgZHJvcCBzaGFkb3cgZm9yIHRoZSBiYXIgKG9yIHJhdGhlciBhbiAidXAtcmlnaHQiIHNoYWRvdykKICAgIGZ1bmN0aW9uIFNldFNoYWRvdygkYUNvbG9yPSJibGFjayIsJGFIU2l6ZT0zLCRhVlNpemU9MywkYVNob3c9dHJ1ZSkgewogICAgICAgICR0aGlzLT5iYXJfc2hhZG93PSRhU2hvdzsKICAgICAgICAkdGhpcy0+YmFyX3NoYWRvd19jb2xvcj0kYUNvbG9yOwogICAgICAgICR0aGlzLT5iYXJfc2hhZG93X3ZzaXplPSRhVlNpemU7CiAgICAgICAgJHRoaXMtPmJhcl9zaGFkb3dfaHNpemU9JGFIU2l6ZTsKCiAgICAgICAgLy8gQWRqdXN0IHRoZSB2YWx1ZSBtYXJnaW4gdG8gY29tcGVuc2F0ZSBmb3Igc2hhZG93CiAgICAgICAgJHRoaXMtPnZhbHVlLT5tYXJnaW4gKz0gJGFWU2l6ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXQzRCgkYUhTaXplPTMsJGFWU2l6ZT0zLCRhU2hvdz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmJhcl8zZD0kYVNob3c7CiAgICAgICAgJHRoaXMtPmJhcl8zZF92c2l6ZT0kYVZTaXplOwogICAgICAgICR0aGlzLT5iYXJfM2RfaHNpemU9JGFIU2l6ZTsKCiAgICAgICAgJHRoaXMtPnZhbHVlLT5tYXJnaW4gKz0gJGFWU2l6ZTsKICAgIH0KCiAgICAvLyBERVBSRUNBVEVEIHVzZSBTZXRZQmFzZSBpbnN0ZWFkCiAgICBmdW5jdGlvbiBTZXRZTWluKCRhWVN0YXJ0VmFsdWUpIHsKICAgICAgICAvL2RpZSgiSnBHcmFwaCBFcnJvcjogRGVwcmVjYXRlZCBmdW5jdGlvbiBTZXRZTWluLiBVc2UgU2V0WUJhc2UoKSBpbnN0ZWFkLiIpOwogICAgICAgICR0aGlzLT55YmFzZT0kYVlTdGFydFZhbHVlOwogICAgfQoKICAgIC8vIFNwZWNpZnkgdGhlIGJhc2UgdmFsdWUgZm9yIHRoZSBiYXJzCiAgICBmdW5jdGlvbiBTZXRZQmFzZSgkYVlTdGFydFZhbHVlKSB7CiAgICAgICAgJHRoaXMtPnliYXNlPSRhWVN0YXJ0VmFsdWU7CiAgICB9CgogICAgLy8gVGhlIG1ldGhvZCB3aWxsIHRha2UgdGhlIHNwZWNpZmllZCBwYXR0ZXJuIGFucmUKICAgIC8vIHJldHVybiBhIHBhdHRlcm4gaW5kZXggdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgb3JpZ2luYWwKICAgIC8vIHBhdHRlcm0gYmVpbmcgcm90YXRlZCA5MCBkZWdyZWVlcy4gVGhpcyBpcyBuZWVkZWQgd2hlbiBwbG90dGluCiAgICAvLyBIb3Jpem9udGFsIGJhcnMKICAgIGZ1bmN0aW9uIFJvdGF0ZVBhdHRlcm4oJGFQYXQsJGFSb3RhdGU9dHJ1ZSkgewogICAgICAgICRyb3RhdGUgPSBhcnJheSgxID0+IDIsIDIgPT4gMSwgMyA9PiAzLCA0ID0+IDUsIDUgPT4gNCwgNiA9PiA2LCA3ID0+IDcsIDggPT4gOCk7CiAgICAgICAgaWYoICRhUm90YXRlICkgewogICAgICAgICAgICByZXR1cm4gJHJvdGF0ZVskYVBhdF07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gJGFQYXQ7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIExlZ2VuZCgkZ3JhcGgpIHsKICAgICAgICBpZiggJHRoaXMtPmdyYWQgJiYgJHRoaXMtPmxlZ2VuZCE9IiIgJiYgISR0aGlzLT5maWxsICkgewogICAgICAgICAgICAkY29sb3I9YXJyYXkoJHRoaXMtPmdyYWRfZnJvbWNvbG9yLCR0aGlzLT5ncmFkX3RvY29sb3IpOwogICAgICAgICAgICAvLyBJbiBvcmRlciB0byBkaWZmZXJlbnRpYXRlIGJldHdlZW4gZ3JhZGllbnRzIGFuZCBjb29vcnMgc3BlY2lmaWVkIGFzIGFuIFJHQiB0cmlwbGUKICAgICAgICAgICAgJGdyYXBoLT5sZWdlbmQtPkFkZCgkdGhpcy0+bGVnZW5kLCRjb2xvciwiIiwtJHRoaXMtPmdyYWRfc3R5bGUsCiAgICAgICAgICAgICR0aGlzLT5sZWdlbmRjc2ltdGFyZ2V0LCR0aGlzLT5sZWdlbmRjc2ltYWx0LCR0aGlzLT5sZWdlbmRjc2ltd2ludGFyZ2V0KTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkdGhpcy0+bGVnZW5kIT0iIiAmJiAoJHRoaXMtPmlQYXR0ZXJuID4gLTEgfHwgaXNfYXJyYXkoJHRoaXMtPmlQYXR0ZXJuKSkgKSB7CiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkdGhpcy0+aVBhdHRlcm4pICkgewogICAgICAgICAgICAgICAgJHAxID0gJHRoaXMtPlJvdGF0ZVBhdHRlcm4oICR0aGlzLT5pUGF0dGVyblswXSwgJGdyYXBoLT5pbWctPmEgPT0gOTAgKTsKICAgICAgICAgICAgICAgICRwMiA9ICR0aGlzLT5pUGF0dGVybkNvbG9yWzBdOwogICAgICAgICAgICAgICAgJHAzID0gJHRoaXMtPmlQYXR0ZXJuRGVuc2l0eVswXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRwMSA9ICR0aGlzLT5Sb3RhdGVQYXR0ZXJuKCAkdGhpcy0+aVBhdHRlcm4sICRncmFwaC0+aW1nLT5hID09IDkwICk7CiAgICAgICAgICAgICAgICAkcDIgPSAkdGhpcy0+aVBhdHRlcm5Db2xvcjsKICAgICAgICAgICAgICAgICRwMyA9ICR0aGlzLT5pUGF0dGVybkRlbnNpdHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoICRwMyA8IDkwICkgJHAzICs9IDU7CiAgICAgICAgICAgICRjb2xvciA9IGFycmF5KCRwMSwkcDIsJHAzLCR0aGlzLT5maWxsX2NvbG9yKTsKICAgICAgICAgICAgLy8gQSBrbHVkZ2U6IFRvbyBtYXJrIHRoYXQgd2UgYWRkIGEgcGF0dGVybiB3ZSB1c2UgYSB0eXBlIHZhbHVlIG9mIDwgMTAwCiAgICAgICAgICAgICRncmFwaC0+bGVnZW5kLT5BZGQoJHRoaXMtPmxlZ2VuZCwkY29sb3IsIiIsLTEwMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bGVnZW5kY3NpbXRhcmdldCwkdGhpcy0+bGVnZW5kY3NpbWFsdCwkdGhpcy0+bGVnZW5kY3NpbXdpbnRhcmdldCk7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggJHRoaXMtPmZpbGxfY29sb3IgJiYgJHRoaXMtPmxlZ2VuZCE9IiIgKSB7CiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkdGhpcy0+ZmlsbF9jb2xvcikgKSB7CiAgICAgICAgICAgICAgICAkZ3JhcGgtPmxlZ2VuZC0+QWRkKCR0aGlzLT5sZWdlbmQsJHRoaXMtPmZpbGxfY29sb3JbMF0sIiIsMCwKICAgICAgICAgICAgICAgICR0aGlzLT5sZWdlbmRjc2ltdGFyZ2V0LCR0aGlzLT5sZWdlbmRjc2ltYWx0LCR0aGlzLT5sZWdlbmRjc2ltd2ludGFyZ2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRncmFwaC0+bGVnZW5kLT5BZGQoJHRoaXMtPmxlZ2VuZCwkdGhpcy0+ZmlsbF9jb2xvciwiIiwwLAogICAgICAgICAgICAgICAgJHRoaXMtPmxlZ2VuZGNzaW10YXJnZXQsJHRoaXMtPmxlZ2VuZGNzaW1hbHQsJHRoaXMtPmxlZ2VuZGNzaW13aW50YXJnZXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIEdldHMgY2FsbGVkIGJlZm9yZSBhbnkgYXhpcyBhcmUgc3Ryb2tlZAogICAgZnVuY3Rpb24gUHJlU3Ryb2tlQWRqdXN0KCRncmFwaCkgewogICAgICAgIHBhcmVudDo6UHJlU3Ryb2tlQWRqdXN0KCRncmFwaCk7CgogICAgICAgIC8vIElmIHdlIGFyZSB1c2luZyBhIGxvZyBZLXNjYWxlIHdlIHdhbnQgdGhlIGJhc2UgdG8gYmUgYXQgdGhlCiAgICAgICAgLy8gbWluaW11bSBZLXZhbHVlIHVubGVzcyB0aGUgdXNlciBoYXZlIHNwZWNpZmljYWxseSBzZXQgc29tZSBvdGhlcgogICAgICAgIC8vIHZhbHVlIHRoYW4gdGhlIGRlZmF1bHQuCiAgICAgICAgaWYoIHN1YnN0cigkZ3JhcGgtPmF4dHlwZSwtMywzKT09ImxvZyIgJiYgJHRoaXMtPnliYXNlPT0wICkKICAgICAgICAkdGhpcy0+eWJhc2UgPSAkZ3JhcGgtPnlheGlzLT5zY2FsZS0+R2V0TWluVmFsKCk7CgogICAgICAgIC8vIEZvciBhICJ0ZXh0IiBYLWF4aXMgc2NhbGUgd2Ugd2lsbCBhZGp1c3QgdGhlCiAgICAgICAgLy8gZGlzcGxheSBvZiB0aGUgYmFycyBhIGxpdHRsZSBiaXQuCiAgICAgICAgaWYoIHN1YnN0cigkZ3JhcGgtPmF4dHlwZSwwLDMpPT0idGV4IiApIHsKICAgICAgICAgICAgLy8gUG9zaXRpb24gdGhlIHRpY2tzIGJldHdlZW4gdGhlIGJhcnMKICAgICAgICAgICAgJGdyYXBoLT54YXhpcy0+c2NhbGUtPnRpY2tzLT5TZXRYTGFiZWxPZmZzZXQoMC41LDApOwoKICAgICAgICAgICAgLy8gQ2VudGVyIHRoZSBiYXJzCiAgICAgICAgICAgIGlmKCAkdGhpcy0+YWJzd2lkdGggPiAtMSApIHsKICAgICAgICAgICAgICAgICRncmFwaC0+U2V0VGV4dFNjYWxlQWJzQ2VudGVyT2ZmKCR0aGlzLT5hYnN3aWR0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmFsaWduID09ICJjZW50ZXIiICkKICAgICAgICAgICAgICAgICRncmFwaC0+U2V0VGV4dFNjYWxlT2ZmKDAuNS0kdGhpcy0+d2lkdGgvMik7CiAgICAgICAgICAgICAgICBlbHNlaWYoICR0aGlzLT5hbGlnbiA9PSAicmlnaHQiICkKICAgICAgICAgICAgICAgICRncmFwaC0+U2V0VGV4dFNjYWxlT2ZmKDEtJHRoaXMtPndpZHRoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoICgkdGhpcyBpbnN0YW5jZW9mIEFjY0JhclBsb3QpIHx8ICgkdGhpcyBpbnN0YW5jZW9mIEdyb3VwQmFyUGxvdCkgKSB7CiAgICAgICAgICAgIC8vIFdlIG9ubHkgc2V0IGFuIGFic29sdXRlIHdpZHRoIGZvciBsaW5lYXIgYW5kIGludCBzY2FsZQogICAgICAgICAgICAvLyBmb3IgdGV4dCBzY2FsZSB0aGUgd2lkdGggd2lsbCBiZSBzZXQgdG8gYSBmcmFjdGlvbiBvZgogICAgICAgICAgICAvLyB0aGUgbWFqc3RlcCB3aWR0aC4KICAgICAgICAgICAgaWYoICR0aGlzLT5hYnN3aWR0aCA9PSAtMSApIHsKICAgICAgICAgICAgICAgIC8vIE5vdCBzZXQKICAgICAgICAgICAgICAgIC8vIHNldCB3aWR0aCB0byBhIHZpc3VhYmxlIHNlbnNpYmxlIGRlZmF1bHQKICAgICAgICAgICAgICAgICR0aGlzLT5hYnN3aWR0aCA9ICRncmFwaC0+aW1nLT5wbG90d2lkdGgvKDIqJHRoaXMtPm51bXBvaW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gTWluKCkgewogICAgICAgICRtID0gcGFyZW50OjpNaW4oKTsKICAgICAgICBpZiggJG1bMV0gPj0gJHRoaXMtPnliYXNlICkgJG1bMV0gPSAkdGhpcy0+eWJhc2U7CiAgICAgICAgcmV0dXJuICRtOwogICAgfQoKICAgIGZ1bmN0aW9uIE1heCgpIHsKICAgICAgICAkbSA9IHBhcmVudDo6TWF4KCk7CiAgICAgICAgaWYoICRtWzFdIDw9ICR0aGlzLT55YmFzZSApICRtWzFdID0gJHRoaXMtPnliYXNlOwogICAgICAgIHJldHVybiAkbTsKICAgIH0KCiAgICAvLyBTcGVjaWZ5IHdpZHRoIGFzIGZyYWN0aW9ucyBvZiB0aGUgbWFqb3Igc3RlcG8gc2l6ZQogICAgZnVuY3Rpb24gU2V0V2lkdGgoJGFXaWR0aCkgewogICAgICAgIGlmKCAkYVdpZHRoID4gMSApIHsKICAgICAgICAgICAgLy8gSW50ZXJwcmV0IHRoaXMgYXMgYWJzb2x1dGUgd2lkdGgKICAgICAgICAgICAgJHRoaXMtPmFic3dpZHRoPSRhV2lkdGg7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+d2lkdGg9JGFXaWR0aDsKICAgICAgICB9CiAgICB9CgogICAgLy8gU3BlY2lmeSB3aWR0aCBpbiBhYnNvbHV0ZSBwaXhlbHMuIElmIHNwZWNpZmllZCB0aGlzCiAgICAvLyBvdmVycmlkZXMgU2V0V2lkdGgoKQogICAgZnVuY3Rpb24gU2V0QWJzV2lkdGgoJGFXaWR0aCkgewogICAgICAgICR0aGlzLT5hYnN3aWR0aD0kYVdpZHRoOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEFsaWduKCRhQWxpZ24pIHsKICAgICAgICAkdGhpcy0+YWxpZ249JGFBbGlnbjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXROb0ZpbGwoKSB7CiAgICAgICAgJHRoaXMtPmdyYWQgPSBmYWxzZTsKICAgICAgICAkdGhpcy0+ZmlsbF9jb2xvcj1mYWxzZTsKICAgICAgICAkdGhpcy0+ZmlsbD1mYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRGaWxsQ29sb3IoJGFDb2xvcikgewogICAgICAgIC8vIERvIGFuIGV4dHJhIGVycm9yIGNoZWNrIGlmIHRoZSBjb2xvciBpcyBzcGVjaWZpZWQgYXMgYW4gUkdCIGFycmF5IHRyaXBsZQogICAgICAgIC8vIEluIHRoYXQgY2FzZSBjb252ZXJ0IGl0IHRvIGEgaGV4IHN0cmluZyBzaW5jZSBpdCB3aWxsIG90aGVyd2lzZSBiZQogICAgICAgIC8vIGludGVycHJldGF0ZWQgYXMgYW4gYXJyYXkgb2YgY29sb3JzIGZvciBlYWNoIGluZGl2aWR1YWwgYmFyLgoKICAgICAgICAkYUNvbG9yID0gUkdCOjp0cnlIZXhDb252ZXJzaW9uKCRhQ29sb3IpOwogICAgICAgICR0aGlzLT5maWxsID0gdHJ1ZSA7CiAgICAgICAgJHRoaXMtPmZpbGxfY29sb3I9JGFDb2xvcjsKCiAgICB9CgogICAgZnVuY3Rpb24gU2V0RmlsbEdyYWRpZW50KCRhRnJvbUNvbG9yLCRhVG9Db2xvcj1udWxsLCRhU3R5bGU9bnVsbCkgewogICAgICAgICR0aGlzLT5ncmFkID0gdHJ1ZTsKICAgICAgICAkdGhpcy0+Z3JhZF9mcm9tY29sb3IgPSAkYUZyb21Db2xvcjsKICAgICAgICAkdGhpcy0+Z3JhZF90b2NvbG9yICAgPSAkYVRvQ29sb3I7CiAgICAgICAgJHRoaXMtPmdyYWRfc3R5bGUgICAgID0gJGFTdHlsZTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRWYWx1ZVBvcygkYVBvcykgewogICAgICAgICR0aGlzLT52YWx1ZXBvcyA9ICRhUG9zOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFBhdHRlcm4oJGFQYXR0ZXJuLCAkYUNvbG9yPSdibGFjaycpewogICAgICAgIGlmKCBpc19hcnJheSgkYVBhdHRlcm4pICkgewogICAgICAgICAgICAkbiA9IGNvdW50KCRhUGF0dGVybik7CiAgICAgICAgICAgICR0aGlzLT5pUGF0dGVybiA9IGFycmF5KCk7CiAgICAgICAgICAgICR0aGlzLT5pUGF0dGVybkRlbnNpdHkgPSBhcnJheSgpOwogICAgICAgICAgICBpZiggaXNfYXJyYXkoJGFDb2xvcikgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+aVBhdHRlcm5Db2xvciA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiggY291bnQoJGFDb2xvcikgIT0gJG4gKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjAwMSk7Ly8oJ05VbWJlciBvZiBjb2xvcnMgaXMgbm90IHRoZSBzYW1lIGFzIHRoZSBudW1iZXIgb2YgcGF0dGVybnMgaW4gQmFyUGxvdDo6U2V0UGF0dGVybigpJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+aVBhdHRlcm5Db2xvciA9ICRhQ29sb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAgICAgJHRoaXMtPl9TZXRQYXR0ZXJuSGVscGVyKCRhUGF0dGVyblskaV0sICR0aGlzLT5pUGF0dGVyblskaV0sICR0aGlzLT5pUGF0dGVybkRlbnNpdHlbJGldKTsKICAgICAgICAgICAgICAgIGlmKCBpc19hcnJheSgkYUNvbG9yKSApIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aVBhdHRlcm5Db2xvclskaV0gPSAkYUNvbG9yWyRpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPl9TZXRQYXR0ZXJuSGVscGVyKCRhUGF0dGVybiwgJHRoaXMtPmlQYXR0ZXJuLCAkdGhpcy0+aVBhdHRlcm5EZW5zaXR5KTsKICAgICAgICAgICAgJHRoaXMtPmlQYXR0ZXJuQ29sb3IgPSAkYUNvbG9yOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfU2V0UGF0dGVybkhlbHBlcigkYVBhdHRlcm4sICYkYVBhdHRlcm5WYWx1ZSwgJiRhRGVuc2l0eSl7CiAgICAgICAgc3dpdGNoKCAkYVBhdHRlcm4gKSB7CiAgICAgICAgICAgIGNhc2UgUEFUVEVSTl9ESUFHMToKICAgICAgICAgICAgICAgICRhUGF0dGVyblZhbHVlPSAxOwogICAgICAgICAgICAgICAgJGFEZW5zaXR5ID0gOTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQQVRURVJOX0RJQUcyOgogICAgICAgICAgICAgICAgJGFQYXR0ZXJuVmFsdWU9IDE7CiAgICAgICAgICAgICAgICAkYURlbnNpdHkgPSA3ODsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFBBVFRFUk5fRElBRzM6CiAgICAgICAgICAgICAgICAkYVBhdHRlcm5WYWx1ZT0gMjsKICAgICAgICAgICAgICAgICRhRGVuc2l0eSA9IDkyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEFUVEVSTl9ESUFHNDoKICAgICAgICAgICAgICAgICRhUGF0dGVyblZhbHVlPSAyOwogICAgICAgICAgICAgICAgJGFEZW5zaXR5ID0gNzg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQQVRURVJOX0NST1NTMToKICAgICAgICAgICAgICAgICRhUGF0dGVyblZhbHVlPSA4OwogICAgICAgICAgICAgICAgJGFEZW5zaXR5ID0gOTA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQQVRURVJOX0NST1NTMjoKICAgICAgICAgICAgICAgICRhUGF0dGVyblZhbHVlPSA4OwogICAgICAgICAgICAgICAgJGFEZW5zaXR5ID0gNzg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQQVRURVJOX0NST1NTMzoKICAgICAgICAgICAgICAgICRhUGF0dGVyblZhbHVlPSA4OwogICAgICAgICAgICAgICAgJGFEZW5zaXR5ID0gNjU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQQVRURVJOX0NST1NTNDoKICAgICAgICAgICAgICAgICRhUGF0dGVyblZhbHVlPSA3OwogICAgICAgICAgICAgICAgJGFEZW5zaXR5ID0gOTA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQQVRURVJOX1NUUklQRTE6CiAgICAgICAgICAgICAgICAkYVBhdHRlcm5WYWx1ZT0gNTsKICAgICAgICAgICAgICAgICRhRGVuc2l0eSA9IDk0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEFUVEVSTl9TVFJJUEUyOgogICAgICAgICAgICAgICAgJGFQYXR0ZXJuVmFsdWU9IDU7CiAgICAgICAgICAgICAgICAkYURlbnNpdHkgPSA4NTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjAwMik7CiAgICAgICAgICAgICAgICAvLygnVW5rbm93biBwYXR0ZXJuIHNwZWNpZmllZCBpbiBjYWxsIHRvIEJhclBsb3Q6OlNldFBhdHRlcm4oKScpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2UoJGltZywkeHNjYWxlLCR5c2NhbGUpIHsKCiAgICAgICAgJG51bXBvaW50cyA9IGNvdW50KCR0aGlzLT5jb29yZHNbMF0pOwogICAgICAgIGlmKCBpc3NldCgkdGhpcy0+Y29vcmRzWzFdKSApIHsKICAgICAgICAgICAgaWYoIGNvdW50KCR0aGlzLT5jb29yZHNbMV0pIT0kbnVtcG9pbnRzICkgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjAwMyxjb3VudCgkdGhpcy0+Y29vcmRzWzFdKSwkbnVtcG9pbnRzKTsKICAgICAgICAgICAgLy8iTnVtYmVyIG9mIFggYW5kIFkgcG9pbnRzIGFyZSBub3QgZXF1YWwuIE51bWJlciBvZiBYLXBvaW50czoiLmNvdW50KCR0aGlzLT5jb29yZHNbMV0pLiJOdW1iZXIgb2YgWS1wb2ludHM6JG51bXBvaW50cyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGV4aXN0X3ggPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkZXhpc3RfeCA9IGZhbHNlOwogICAgICAgIH0KCgogICAgICAgICRudW1iYXJzPWNvdW50KCR0aGlzLT5jb29yZHNbMF0pOwoKICAgICAgICAvLyBVc2UgR2V0TWluVmFsKCkgaW5zdGVhZCBvZiBzY2FsZVswXSBkaXJlY3RseSBzaW5jZSBpbiB0aGUgY2FzZQogICAgICAgIC8vIG9mIGxvZyBzY2FsZSB3ZSBnZXQgYSBjb3JyZWN0IHZhbHVlLiBMb2cgc2NhbGVzIHdpbGwgaGF2ZSBuZWdhdGl2ZQogICAgICAgIC8vIHZhbHVlcyBmb3IgdmFsdWVzIDwgMSB3aGlsZSBzdGlsbCBub3QgcmVwcmVzZW50aW5nIG5lZ2F0aXZlIG51bWJlcnMuCiAgICAgICAgaWYoICR5c2NhbGUtPkdldE1pblZhbCgpID49IDAgKQogICAgICAgICR6cD0keXNjYWxlLT5zY2FsZV9hYnNbMF07CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR6cD0keXNjYWxlLT5UcmFuc2xhdGUoMCk7CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPmFic3dpZHRoID4gLTEgKSB7CiAgICAgICAgICAgICRhYnN3aWR0aD0kdGhpcy0+YWJzd2lkdGg7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkYWJzd2lkdGg9cm91bmQoJHRoaXMtPndpZHRoKiR4c2NhbGUtPnNjYWxlX2ZhY3RvciwwKTsKICAgICAgICB9CgogICAgICAgIC8vIENvdW50IHBvbnRldGlhbCBwYXR0ZXJuIGFycmF5IHRvIGF2b2lkIGRvaW5nIHRoZSBjb3VudCBmb3IgZWFjaCBpdGVyYXRpb24KICAgICAgICBpZiggaXNfYXJyYXkoJHRoaXMtPmlQYXR0ZXJuKSApIHsKICAgICAgICAgICAgJG5wID0gY291bnQoJHRoaXMtPmlQYXR0ZXJuKTsKICAgICAgICB9CgogICAgICAgICRncmFkID0gbnVsbDsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbnVtYmFyczsgKyskaSkgewoKICAgICAgICAgICAgLy8gSWYgdmFsdWUgaXMgTlVMTCwgb3IgMCB0aGVuIGRvbid0IGRyYXcgYSBiYXIgYXQgYWxsCiAgICAgICAgICAgIGlmICgkdGhpcy0+Y29vcmRzWzBdWyRpXSA9PT0gbnVsbCB8fCAkdGhpcy0+Y29vcmRzWzBdWyRpXSA9PT0gJycgKQogICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGlmKCAkZXhpc3RfeCApIHsKICAgICAgICAgICAgICAgICR4PSR0aGlzLT5jb29yZHNbMV1bJGldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHg9JGk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR4PSR4c2NhbGUtPlRyYW5zbGF0ZSgkeCk7CgogICAgICAgICAgICAvLyBDb21tZW50IE5vdGU6IFRoaXMgY29uZnVzZXMgdGhlIHBvc2l0aW9uaW5nIHdoZW4gdXNpbmcgYWNjIHRvZ2V0aGVyIHdpdGgKICAgICAgICAgICAgLy8gZ3JvdXBlZCBiYXJzLiBXb3JrYXJvdW5kIGZvciBmaXhpbmcgIzE5MQogICAgICAgICAgICAvKgogICAgICAgICAgICBpZiggISR4c2NhbGUtPnRleHRzY2FsZSApIHsKICAgICAgICAgICAgaWYoJHRoaXMtPmFsaWduPT0iY2VudGVyIikKICAgICAgICAgICAgJHggLT0gJGFic3dpZHRoLzI7CiAgICAgICAgICAgIGVsc2VpZigkdGhpcy0+YWxpZ249PSJyaWdodCIpCiAgICAgICAgICAgICR4IC09ICRhYnN3aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICAqLwogICAgICAgICAgICAvLyBTdHJva2UgZmlsbCBjb2xvciBhbmQgZmlsbCBncmFkaWVudAogICAgICAgICAgICAkcHRzPWFycmF5KAogICAgICAgICAgICAkeCwkenAsCiAgICAgICAgICAgICR4LCR5c2NhbGUtPlRyYW5zbGF0ZSgkdGhpcy0+Y29vcmRzWzBdWyRpXSksCiAgICAgICAgICAgICR4KyRhYnN3aWR0aCwkeXNjYWxlLT5UcmFuc2xhdGUoJHRoaXMtPmNvb3Jkc1swXVskaV0pLAogICAgICAgICAgICAkeCskYWJzd2lkdGgsJHpwKTsKICAgICAgICAgICAgaWYoICR0aGlzLT5ncmFkICkgewogICAgICAgICAgICAgICAgaWYoICRncmFkID09PSBudWxsICkgewogICAgICAgICAgICAgICAgICAgICRncmFkID0gbmV3IEdyYWRpZW50KCRpbWcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoIGlzX2FycmF5KCR0aGlzLT5ncmFkX2Zyb21jb2xvcikgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGZpcnN0IGFyZ3VtZW50IChncmFkX2Zyb21jb2xvcikgY2FuIGJlIGVpdGhlciBhbiBhcnJheSBvciBhIHNpbmdsZSBjb2xvci4gSWYgaXQgaXMgYW4gYXJyYXkKICAgICAgICAgICAgICAgICAgICAvLyB0aGVuIHdlIGhhdmUgdHdvIGNob2ljZXMuIEl0IGNhbiBlaXRoZXIgYSkgYmUgYSBzaW5nbGUgY29sb3Igc3BlY2lmaWVkIGFzIGFuIFJHQiB0cmlwbGUgb3IgaXQgY2FuIGJlCiAgICAgICAgICAgICAgICAgICAgLy8gYW4gYXJyYXkgdG8gc3BlY2lmeSBib3RoIChmcm9tLCB0byBzdHlsZSkgZm9yIGVhY2ggaW5kaXZpZHVhbCBiYXIuIFRoZSB3YXkgdG8ga25vdyB0aGUgZGlmZmVyZW5jZSBpcwogICAgICAgICAgICAgICAgICAgIC8vIHRvIGludmVzdGdhdGUgdGhlIGZpcnN0IGVsZW1lbnQuIElmIHRoaXMgZWxlbWVudCBpcyBhbiBpbnRlZ2VyIFswLDI1NV0gdGhlbiB3ZSBhc3N1bWUgaXQgaXMgYW4gUkdCCiAgICAgICAgICAgICAgICAgICAgLy8gdHJpcGxlLgogICAgICAgICAgICAgICAgICAgICRuZyA9IGNvdW50KCR0aGlzLT5ncmFkX2Zyb21jb2xvcik7CiAgICAgICAgICAgICAgICAgICAgaWYoICRuZyA9PT0gMyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGlzX251bWVyaWMoJHRoaXMtPmdyYWRfZnJvbWNvbG9yWzBdKSAmJiAkdGhpcy0+Z3JhZF9mcm9tY29sb3JbMF0gPiAwICYmICR0aGlzLT5ncmFkX2Zyb21jb2xvclswXSA8IDI1NiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJHQiBUcmlwbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tY29sb3IgPSAkdGhpcy0+Z3JhZF9mcm9tY29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9jb2xvciA9ICR0aGlzLT5ncmFkX3RvY29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3R5bGUgPSAkdGhpcy0+Z3JhZF9zdHlsZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tY29sb3IgPSAkdGhpcy0+Z3JhZF9mcm9tY29sb3JbJGkgJSAkbmddWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvY29sb3IgPSAkdGhpcy0+Z3JhZF9mcm9tY29sb3JbJGkgJSAkbmddWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlID0gJHRoaXMtPmdyYWRfZnJvbWNvbG9yWyRpICUgJG5nXVsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGZyb21jb2xvciA9ICR0aGlzLT5ncmFkX2Zyb21jb2xvclskaSAlICRuZ11bMF07CiAgICAgICAgICAgICAgICAgICAgICAgICR0b2NvbG9yID0gJHRoaXMtPmdyYWRfZnJvbWNvbG9yWyRpICUgJG5nXVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlID0gJHRoaXMtPmdyYWRfZnJvbWNvbG9yWyRpICUgJG5nXVsyXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGdyYWQtPkZpbGxlZFJlY3RhbmdsZSgkcHRzWzJdLCRwdHNbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcHRzWzZdLCRwdHNbN10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZnJvbWNvbG9yLCR0b2NvbG9yLCRzdHlsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkZ3JhZC0+RmlsbGVkUmVjdGFuZ2xlKCRwdHNbMl0sJHB0c1szXSwKICAgICAgICAgICAgICAgICAgICAkcHRzWzZdLCRwdHNbN10sCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmdyYWRfZnJvbWNvbG9yLCR0aGlzLT5ncmFkX3RvY29sb3IsJHRoaXMtPmdyYWRfc3R5bGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggIWVtcHR5KCR0aGlzLT5maWxsX2NvbG9yKSApIHsKICAgICAgICAgICAgICAgIGlmKGlzX2FycmF5KCR0aGlzLT5maWxsX2NvbG9yKSkgewogICAgICAgICAgICAgICAgICAgICRpbWctPlB1c2hDb2xvcigkdGhpcy0+ZmlsbF9jb2xvclskaSAlIGNvdW50KCR0aGlzLT5maWxsX2NvbG9yKV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkaW1nLT5QdXNoQ29sb3IoJHRoaXMtPmZpbGxfY29sb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGltZy0+RmlsbGVkUG9seWdvbigkcHRzKTsKICAgICAgICAgICAgICAgICRpbWctPlBvcENvbG9yKCk7CiAgICAgICAgICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9rb2tvcmFoZW4gcmVjdGFuZ2xlIHBvbHlnb24vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgICAvLyBSZW1lbWJlciB2YWx1ZSBvZiB0aGlzIGJhcgogICAgICAgICAgICAkdmFsPSR0aGlzLT5jb29yZHNbMF1bJGldOwoKICAgICAgICAgICAgaWYoICFlbXB0eSgkdmFsKSAmJiAhaXNfbnVtZXJpYygkdmFsKSApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIwMDQsJGksJHZhbCk7CiAgICAgICAgICAgICAgICAvLydBbGwgdmFsdWVzIGZvciBhIGJhcnBsb3QgbXVzdCBiZSBudW1lcmljLiBZb3UgaGF2ZSBzcGVjaWZpZWQgdmFsdWVbJy4kaS4nXSA9PSBcJycuJHZhbC4nXCcnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBzaGFkb3cKICAgICAgICAgICAgaWYoICR0aGlzLT5iYXJfc2hhZG93ICYmICR2YWwgIT0gMCkgewoKICAgICAgICAgICAgICAgICRzc2ggPSAkdGhpcy0+YmFyX3NoYWRvd19oc2l6ZTsKICAgICAgICAgICAgICAgICRzc3YgPSAkdGhpcy0+YmFyX3NoYWRvd192c2l6ZTsKICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBwb2ludHMgdG8gY3JlYXRlIGEgInVwcGVyLXJpZ2h0IiBzaGFkb3cKICAgICAgICAgICAgICAgIGlmKCAkdmFsID4gMCApIHsKICAgICAgICAgICAgICAgICAgICAkc3BbMF09JHB0c1s2XTsgICRzcFsxXT0kcHRzWzddOwogICAgICAgICAgICAgICAgICAgICRzcFsyXT0kcHRzWzRdOyAgJHNwWzNdPSRwdHNbNV07CiAgICAgICAgICAgICAgICAgICAgJHNwWzRdPSRwdHNbMl07ICAkc3BbNV09JHB0c1szXTsKICAgICAgICAgICAgICAgICAgICAkc3BbNl09JHB0c1syXSskc3NoOyAkc3BbN109JHB0c1szXS0kc3N2OwogICAgICAgICAgICAgICAgICAgICRzcFs4XT0kcHRzWzRdKyRzc2g7ICRzcFs5XT0kcHRzWzVdLSRzc3Y7CiAgICAgICAgICAgICAgICAgICAgJHNwWzEwXT0kcHRzWzZdKyRzc2g7ICRzcFsxMV09JHB0c1s3XS0kc3N2OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmKCAkdmFsIDwgMCApIHsKICAgICAgICAgICAgICAgICAgICAkc3BbMF09JHB0c1s0XTsgICRzcFsxXT0kcHRzWzVdOwogICAgICAgICAgICAgICAgICAgICRzcFsyXT0kcHRzWzZdOyAgJHNwWzNdPSRwdHNbN107CiAgICAgICAgICAgICAgICAgICAgJHNwWzRdPSRwdHNbMF07ICAkc3BbNV09JHB0c1sxXTsKICAgICAgICAgICAgICAgICAgICAkc3BbNl09JHB0c1swXSskc3NoOyAkc3BbN109JHB0c1sxXS0kc3N2OwogICAgICAgICAgICAgICAgICAgICRzcFs4XT0kcHRzWzZdKyRzc2g7ICRzcFs5XT0kcHRzWzddLSRzc3Y7CiAgICAgICAgICAgICAgICAgICAgJHNwWzEwXT0kcHRzWzRdKyRzc2g7ICRzcFsxMV09JHB0c1s1XS0kc3N2OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoIGlzX2FycmF5KCR0aGlzLT5iYXJfc2hhZG93X2NvbG9yKSApIHsKICAgICAgICAgICAgICAgICAgICAkbnVtY29sb3JzID0gY291bnQoJHRoaXMtPmJhcl9zaGFkb3dfY29sb3IpOwogICAgICAgICAgICAgICAgICAgIGlmKCAkbnVtY29sb3JzID09IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIwMDUpOy8vKCdZb3UgaGF2ZSBzcGVjaWZpZWQgYW4gZW1wdHkgYXJyYXkgZm9yIHNoYWRvdyBjb2xvcnMgaW4gdGhlIGJhciBwbG90LicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkaW1nLT5QdXNoQ29sb3IoJHRoaXMtPmJhcl9zaGFkb3dfY29sb3JbJGkgJSAkbnVtY29sb3JzXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkaW1nLT5QdXNoQ29sb3IoJHRoaXMtPmJhcl9zaGFkb3dfY29sb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGltZy0+RmlsbGVkUG9seWdvbigkc3ApOwogICAgICAgICAgICAgICAgJGltZy0+UG9wQ29sb3IoKTsKCiAgICAgICAgICAgIH0gZWxzZWlmKCAkdGhpcy0+YmFyXzNkICYmICR2YWwgIT0gMCkgewogICAgICAgICAgICAgIC8vIERldGVybWluZSB0aGUgM0QKCiAgICAgICAgICAgICAgICAkc3NoID0gJHRoaXMtPmJhcl8zZF9oc2l6ZTsKICAgICAgICAgICAgICAgICRzc3YgPSAkdGhpcy0+YmFyXzNkX3ZzaXplOwoKICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBwb2ludHMgdG8gY3JlYXRlIGEgInVwcGVyLXJpZ2h0IiBzaGFkb3cKICAgICAgICAgICAgICAgIGlmKCAkdmFsID4gMCApIHsKICAgICAgICAgICAgICAgICAgICAkc3AxWzBdPSRwdHNbNl07ICAkc3AxWzFdPSRwdHNbN107CiAgICAgICAgICAgICAgICAgICAgJHNwMVsyXT0kcHRzWzRdOyAgJHNwMVszXT0kcHRzWzVdOwogICAgICAgICAgICAgICAgICAgICRzcDFbNF09JHB0c1s0XSskc3NoOyAkc3AxWzVdPSRwdHNbNV0tJHNzdjsKICAgICAgICAgICAgICAgICAgICAkc3AxWzZdPSRwdHNbNl0rJHNzaDsgJHNwMVs3XT0kcHRzWzddLSRzc3Y7CgogICAgICAgICAgICAgICAgICAgICRzcDJbMF09JHB0c1s0XTsgICRzcDJbMV09JHB0c1s1XTsKICAgICAgICAgICAgICAgICAgICAkc3AyWzJdPSRwdHNbMl07ICAkc3AyWzNdPSRwdHNbM107CiAgICAgICAgICAgICAgICAgICAgJHNwMls0XT0kcHRzWzJdKyRzc2g7ICRzcDJbNV09JHB0c1szXS0kc3N2OwogICAgICAgICAgICAgICAgICAgICRzcDJbNl09JHB0c1s0XSskc3NoOyAkc3AyWzddPSRwdHNbNV0tJHNzdjsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoICR2YWwgPCAwICkgewogICAgICAgICAgICAgICAgICAgICRzcDFbMF09JHB0c1s0XTsgICRzcDFbMV09JHB0c1s1XTsKICAgICAgICAgICAgICAgICAgICAkc3AxWzJdPSRwdHNbNl07ICAkc3AxWzNdPSRwdHNbN107CiAgICAgICAgICAgICAgICAgICAgJHNwMVs0XT0kcHRzWzZdKyRzc2g7ICRzcDFbNV09JHB0c1s3XS0kc3N2OwogICAgICAgICAgICAgICAgICAgICRzcDFbNl09JHB0c1s0XSskc3NoOyAkc3AxWzddPSRwdHNbNV0tJHNzdjsKCiAgICAgICAgICAgICAgICAgICAgJHNwMlswXT0kcHRzWzZdOyAgJHNwMlsxXT0kcHRzWzddOwogICAgICAgICAgICAgICAgICAgICRzcDJbMl09JHB0c1swXTsgICRzcDJbM109JHB0c1sxXTsKICAgICAgICAgICAgICAgICAgICAkc3AyWzRdPSRwdHNbMF0rJHNzaDsgJHNwMls1XT0kcHRzWzFdLSRzc3Y7CiAgICAgICAgICAgICAgICAgICAgJHNwMls2XT0kcHRzWzZdKyRzc2g7ICRzcDJbN109JHB0c1s3XS0kc3N2OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRiYXNlX2NvbG9yID0gJHRoaXMtPmZpbGxfY29sb3I7CgogICAgICAgICAgICAgICAgJGltZy0+UHVzaENvbG9yKCRiYXNlX2NvbG9yIC4gJzowLjcnKTsKICAgICAgICAgICAgICAgICRpbWctPkZpbGxlZFBvbHlnb24oJHNwMSk7CiAgICAgICAgICAgICAgICAkaW1nLT5Qb3BDb2xvcigpOwoKICAgICAgICAgICAgICAgICRpbWctPlB1c2hDb2xvcigkYmFzZV9jb2xvciAuICc6MS4xJyk7CiAgICAgICAgICAgICAgICAkaW1nLT5GaWxsZWRQb2x5Z29uKCRzcDIpOwogICAgICAgICAgICAgICAgJGltZy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU3Ryb2tlIHRoZSBwYXR0ZXJuCiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkdGhpcy0+aVBhdHRlcm4pICkgewogICAgICAgICAgICAgICAgJGYgPSBuZXcgUmVjdFBhdHRlcm5GYWN0b3J5KCk7CiAgICAgICAgICAgICAgICBpZiggaXNfYXJyYXkoJHRoaXMtPmlQYXR0ZXJuQ29sb3IpICkgewogICAgICAgICAgICAgICAgICAgICRwY29sb3IgPSAkdGhpcy0+aVBhdHRlcm5Db2xvclskaSAlICRucF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkcGNvbG9yID0gJHRoaXMtPmlQYXR0ZXJuQ29sb3I7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkcHJlY3QgPSAkZi0+Q3JlYXRlKCR0aGlzLT5pUGF0dGVyblskaSAlICRucF0sJHBjb2xvciwxKTsKICAgICAgICAgICAgICAgICRwcmVjdC0+U2V0RGVuc2l0eSgkdGhpcy0+aVBhdHRlcm5EZW5zaXR5WyRpICUgJG5wXSk7CgogICAgICAgICAgICAgICAgaWYoICR2YWwgPCAwICkgewogICAgICAgICAgICAgICAgICAgICRyeCA9ICRwdHNbMF07CiAgICAgICAgICAgICAgICAgICAgJHJ5ID0gJHB0c1sxXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRyeCA9ICRwdHNbMl07CiAgICAgICAgICAgICAgICAgICAgJHJ5ID0gJHB0c1szXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR3aWR0aCA9IGFicygkcHRzWzRdLSRwdHNbMF0pKzE7CiAgICAgICAgICAgICAgICAkaGVpZ2h0ID0gYWJzKCRwdHNbMV0tJHB0c1szXSkrMTsKICAgICAgICAgICAgICAgICRwcmVjdC0+U2V0UG9zKG5ldyBSZWN0YW5nbGUoJHJ4LCRyeSwkd2lkdGgsJGhlaWdodCkpOwogICAgICAgICAgICAgICAgJHByZWN0LT5TdHJva2UoJGltZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmlQYXR0ZXJuID4gLTEgKSB7CiAgICAgICAgICAgICAgICAgICAgJGYgPSBuZXcgUmVjdFBhdHRlcm5GYWN0b3J5KCk7CiAgICAgICAgICAgICAgICAgICAgJHByZWN0ID0gJGYtPkNyZWF0ZSgkdGhpcy0+aVBhdHRlcm4sJHRoaXMtPmlQYXR0ZXJuQ29sb3IsMSk7CiAgICAgICAgICAgICAgICAgICAgJHByZWN0LT5TZXREZW5zaXR5KCR0aGlzLT5pUGF0dGVybkRlbnNpdHkpOwogICAgICAgICAgICAgICAgICAgIGlmKCAkdmFsIDwgMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJ4ID0gJHB0c1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJ5ID0gJHB0c1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyeCA9ICRwdHNbMl07CiAgICAgICAgICAgICAgICAgICAgICAgICRyeSA9ICRwdHNbM107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR3aWR0aCA9IGFicygkcHRzWzRdLSRwdHNbMF0pKzE7CiAgICAgICAgICAgICAgICAgICAgJGhlaWdodCA9IGFicygkcHRzWzFdLSRwdHNbM10pKzE7CiAgICAgICAgICAgICAgICAgICAgJHByZWN0LT5TZXRQb3MobmV3IFJlY3RhbmdsZSgkcngsJHJ5LCR3aWR0aCwkaGVpZ2h0KSk7CiAgICAgICAgICAgICAgICAgICAgJHByZWN0LT5TdHJva2UoJGltZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFN0cm9rZSB0aGUgb3V0bGluZSBvZiB0aGUgYmFyCiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkdGhpcy0+Y29sb3IpICkgewogICAgICAgICAgICAgICAgJGltZy0+U2V0Q29sb3IoJHRoaXMtPmNvbG9yWyRpICUgY291bnQoJHRoaXMtPmNvbG9yKV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGltZy0+U2V0Q29sb3IoJHRoaXMtPmNvbG9yKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHB0c1tdID0gJHB0c1swXTsKICAgICAgICAgICAgJHB0c1tdID0gJHB0c1sxXTsKCiAgICAgICAgICAgIGlmKCAkdGhpcy0+d2VpZ2h0ID4gMCApIHsKICAgICAgICAgICAgICAgICRpbWctPlNldExpbmVXZWlnaHQoJHRoaXMtPndlaWdodCk7CiAgICAgICAgICAgICAgICAkaW1nLT5Qb2x5Z29uKCRwdHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEZXRlcm1pbmUgaG93IHRvIGJlc3QgcG9zaXRpb24gdGhlIHZhbHVlcyBvZiB0aGUgaW5kaXZpZHVhbCBiYXJzCiAgICAgICAgICAgICR4PSRwdHNbMl0rKCRwdHNbNF0tJHB0c1syXSkvMjsKICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TZXRNYXJnaW4oNSk7CgogICAgICAgICAgICBpZiggJHRoaXMtPnZhbHVlcG9zPT0ndG9wJyApIHsKICAgICAgICAgICAgICAgICR5PSRwdHNbM107CiAgICAgICAgICAgICAgICBpZiggJGltZy0+YSA9PT0gOTAgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoICR2YWwgPCAwICkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldEFsaWduKCdyaWdodCcsJ2NlbnRlcicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TZXRBbGlnbignbGVmdCcsJ2NlbnRlcicpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiggJHZhbCA8IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U2V0TWFyZ2luKC01KTsKICAgICAgICAgICAgICAgICAgICAgICAgJHk9JHB0c1sxXTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TZXRBbGlnbignY2VudGVyJywnYm90dG9tJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldEFsaWduKCdjZW50ZXInLCdib3R0b20nKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TdHJva2UoJGltZywkdmFsLCR4LCR5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICR0aGlzLT52YWx1ZXBvcz09J21heCcgKSB7CiAgICAgICAgICAgICAgICAkeT0kcHRzWzNdOwogICAgICAgICAgICAgICAgaWYoICRpbWctPmEgPT09IDkwICkgewogICAgICAgICAgICAgICAgICAgIGlmKCAkdmFsIDwgMCApCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TZXRBbGlnbignbGVmdCcsJ2NlbnRlcicpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldEFsaWduKCdyaWdodCcsJ2NlbnRlcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYoICR2YWwgPCAwICkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldEFsaWduKCdjZW50ZXInLCdib3R0b20nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U2V0QWxpZ24oJ2NlbnRlcicsJ3RvcCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U2V0TWFyZ2luKC01KTsKICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U3Ryb2tlKCRpbWcsJHZhbCwkeCwkeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCAkdGhpcy0+dmFsdWVwb3M9PSdjZW50ZXInICkgewogICAgICAgICAgICAgICAgJHkgPSAoJHB0c1szXSArICRwdHNbMV0pLzI7CiAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldEFsaWduKCdjZW50ZXInLCdjZW50ZXInKTsKICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U2V0TWFyZ2luKDApOwogICAgICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TdHJva2UoJGltZywkdmFsLCR4LCR5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICR0aGlzLT52YWx1ZXBvcz09J2JvdHRvbScgfHwgJHRoaXMtPnZhbHVlcG9zPT0nbWluJyApIHsKICAgICAgICAgICAgICAgICR5PSRwdHNbMV07CiAgICAgICAgICAgICAgICBpZiggJGltZy0+YSA9PT0gOTAgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoICR2YWwgPCAwICkKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldEFsaWduKCdyaWdodCcsJ2NlbnRlcicpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldEFsaWduKCdsZWZ0JywnY2VudGVyJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlNldE1hcmdpbigzKTsKICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U3Ryb2tlKCRpbWcsJHZhbCwkeCwkeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyMDA2LCR0aGlzLT52YWx1ZXBvcyk7CiAgICAgICAgICAgICAgICAvLydVbmtub3duIHBvc2l0aW9uIGZvciB2YWx1ZXMgb24gYmFycyA6Jy4kdGhpcy0+dmFsdWVwb3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgY2xpZW50IHNpZGUgaW1hZ2UgbWFwCiAgICAgICAgICAgICRycHRzID0gJGltZy0+QXJyUm90YXRlKCRwdHMpOwogICAgICAgICAgICAkY3NpbWNvb3JkPXJvdW5kKCRycHRzWzBdKS4iLCAiLnJvdW5kKCRycHRzWzFdKTsKICAgICAgICAgICAgZm9yKCAkaj0xOyAkaiA8IDQ7ICsrJGopewogICAgICAgICAgICAgICAgJGNzaW1jb29yZCAuPSAiLCAiLnJvdW5kKCRycHRzWzIqJGpdKS4iLCAiLnJvdW5kKCRycHRzWzIqJGorMV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAhZW1wdHkoJHRoaXMtPmNzaW10YXJnZXRzWyRpXSkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICc8YXJlYSBzaGFwZT0icG9seSIgY29vcmRzPSInLiRjc2ltY29vcmQuJyIgJzsKICAgICAgICAgICAgICAgICR0aGlzLT5jc2ltYXJlYXMgLj0gIiBocmVmPVwiIi5odG1sZW50aXRpZXMoJHRoaXMtPmNzaW10YXJnZXRzWyRpXSkuIlwiIjsKCiAgICAgICAgICAgICAgICBpZiggIWVtcHR5KCR0aGlzLT5jc2ltd2ludGFyZ2V0c1skaV0pICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jc2ltYXJlYXMgLj0gIiB0YXJnZXQ9XCIiLiR0aGlzLT5jc2ltd2ludGFyZ2V0c1skaV0uIlwiICI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHN2YWw9Jyc7CiAgICAgICAgICAgICAgICBpZiggIWVtcHR5KCR0aGlzLT5jc2ltYWx0c1skaV0pICkgewogICAgICAgICAgICAgICAgICAgICRzdmFsPXNwcmludGYoJHRoaXMtPmNzaW1hbHRzWyRpXSwkdGhpcy0+Y29vcmRzWzBdWyRpXSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNzaW1hcmVhcyAuPSAiIHRpdGxlPVwiJHN2YWxcIiBhbHQ9XCIkc3ZhbFwiICI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICIgLz5cbiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0gLy8gQ2xhc3MKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIEdyb3VwQmFyUGxvdAovLyBEZXNjcmlwdGlvbjogUHJvZHVjZSBncm91cGVkIGJhciBwbG90cwovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjbGFzcyBHcm91cEJhclBsb3QgZXh0ZW5kcyBCYXJQbG90IHsKICAgIHB1YmxpYyAkcGxvdHM7IAogICAgcHJpdmF0ZSAkbmJycGxvdHM9MDsKICAgIC8vLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBDT05TVFJVQ1RPUgogICAgZnVuY3Rpb24gR3JvdXBCYXJQbG90KCRwbG90cykgewogICAgICAgICR0aGlzLT53aWR0aD0wLjc7CiAgICAgICAgJHRoaXMtPnBsb3RzID0gJHBsb3RzOwogICAgICAgICR0aGlzLT5uYnJwbG90cyA9IGNvdW50KCRwbG90cyk7CiAgICAgICAgaWYoICR0aGlzLT5uYnJwbG90cyA8IDEgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIwMDcpOy8vKCdDYW5ub3QgY3JlYXRlIEdyb3VwQmFyUGxvdCBmcm9tIGVtcHR5IHBsb3QgYXJyYXkuJyk7CiAgICAgICAgfQogICAgICAgIGZvcigkaT0wOyAkaSA8ICR0aGlzLT5uYnJwbG90czsgKyskaSApIHsKICAgICAgICAgICAgaWYoIGVtcHR5KCR0aGlzLT5wbG90c1skaV0pIHx8ICFpc3NldCgkdGhpcy0+cGxvdHNbJGldKSApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIwMDgsJGkpOy8vKCJHcm91cCBiYXIgcGxvdCBlbGVtZW50IG5iciAkaSBpcyB1bmRlZmluZWQgb3IgZW1wdHkuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPm51bXBvaW50cyA9ICRwbG90c1swXS0+bnVtcG9pbnRzOwogICAgICAgICR0aGlzLT53aWR0aD0wLjc7CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICBmdW5jdGlvbiBMZWdlbmQoJGdyYXBoKSB7CiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+cGxvdHMpOwogICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpKSB7CiAgICAgICAgICAgICRjID0gZ2V0X2NsYXNzKCR0aGlzLT5wbG90c1skaV0pOwogICAgICAgICAgICBpZiggISgkdGhpcy0+cGxvdHNbJGldIGluc3RhbmNlb2YgQmFyUGxvdCkgKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyMDA5LCRjKTsKICAgICAgICAgICAgICAgIC8vKCdPbmUgb2YgdGhlIG9iamVjdHMgc3VibWl0dGVkIHRvIEdyb3VwQmFyIGlzIG5vdCBhIEJhclBsb3QuIE1ha2Ugc3VyZSB0aGF0IHlvdSBjcmVhdGUgdGhlIEdyb3VwIEJhciBwbG90IGZyb20gYW4gYXJyYXkgb2YgQmFyUGxvdCBvciBBY2NCYXJQbG90IG9iamVjdHMuIChDbGFzcyA9ICcuJGMuJyknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT5Eb0xlZ2VuZCgkZ3JhcGgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBNaW4oKSB7CiAgICAgICAgbGlzdCgkeG1pbiwkeW1pbikgPSAkdGhpcy0+cGxvdHNbMF0tPk1pbigpOwogICAgICAgICRuID0gY291bnQoJHRoaXMtPnBsb3RzKTsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSkgewogICAgICAgICAgICBsaXN0KCR4bSwkeW0pID0gJHRoaXMtPnBsb3RzWyRpXS0+TWluKCk7CiAgICAgICAgICAgICR4bWluID0gbWF4KCR4bWluLCR4bSk7CiAgICAgICAgICAgICR5bWluID0gbWluKCR5bWluLCR5bSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheSgkeG1pbiwkeW1pbik7CiAgICB9CgogICAgZnVuY3Rpb24gTWF4KCkgewogICAgICAgIGxpc3QoJHhtYXgsJHltYXgpID0gJHRoaXMtPnBsb3RzWzBdLT5NYXgoKTsKICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT5wbG90cyk7CiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG47ICsrJGkpIHsKICAgICAgICAgICAgbGlzdCgkeG0sJHltKSA9ICR0aGlzLT5wbG90c1skaV0tPk1heCgpOwogICAgICAgICAgICAkeG1heCA9IG1heCgkeG1heCwkeG0pOwogICAgICAgICAgICAkeW1heCA9IG1heCgkeW1heCwkeW0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyYXkoJHhtYXgsJHltYXgpOwogICAgfQoKICAgIGZ1bmN0aW9uIEdldENTSU1hcmVhcygpIHsKICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT5wbG90cyk7CiAgICAgICAgJGNzaW1hcmVhcz0nJzsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSkgewogICAgICAgICAgICAkY3NpbWFyZWFzIC49ICR0aGlzLT5wbG90c1skaV0tPmNzaW1hcmVhczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRjc2ltYXJlYXM7CiAgICB9CgogICAgLy8gU3Ryb2tlIGFsbCB0aGUgYmFycyBuZXh0IHRvIGVhY2ggb3RoZXIKICAgIGZ1bmN0aW9uIFN0cm9rZSgkaW1nLCR4c2NhbGUsJHlzY2FsZSkgewogICAgICAgICR0bXA9JHhzY2FsZS0+b2ZmOwogICAgICAgICRuID0gY291bnQoJHRoaXMtPnBsb3RzKTsKICAgICAgICAkc3Vid2lkdGggPSAkdGhpcy0+d2lkdGgvJHRoaXMtPm5icnBsb3RzIDsKCiAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT55bWluPSR0aGlzLT55YmFzZTsKICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+U2V0V2lkdGgoJHN1YndpZHRoKTsKCiAgICAgICAgICAgIC8vIElmIHRoZSBjbGllbnQgaGF2ZSB1c2VkIFNldFRleHRUaWNrSW50ZXJ2YWwoKSB0aGVuCiAgICAgICAgICAgIC8vIG1ham9yX3N0ZXAgd2lsbCBiZSA+IDEgYW5kIHRoZSBwb3NpdGlvbmluZyB3aWxsIGZhaWwuCiAgICAgICAgICAgIC8vIElmIHdlIGFzc3VtZSBpdCBpcyBhbHdheXMgb25lIHRoZSBwb3NpdGlvbmluZyB3aWxsIHdvcmsKICAgICAgICAgICAgLy8gZmluZSB3aXRoIGEgdGV4dCBzY2FsZSBidXQgdGhpcyB3aWxsIG5vdCB3b3JrIHdpdGgKICAgICAgICAgICAgLy8gYXJiaXRyYXJ5IGxpbmVhciBzY2FsZQogICAgICAgICAgICAkeHNjYWxlLT5vZmYgPSAkdG1wKyRpKnJvdW5kKCR4c2NhbGUtPnNjYWxlX2ZhY3RvciogJHN1YndpZHRoKTsKICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+U3Ryb2tlKCRpbWcsJHhzY2FsZSwkeXNjYWxlKTsKICAgICAgICB9CiAgICAgICAgJHhzY2FsZS0+b2ZmPSR0bXA7CiAgICB9Cn0gLy8gQ2xhc3MKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIEFjY0JhclBsb3QKLy8gRGVzY3JpcHRpb246IFByb2R1Y2UgYWNjdW11bGF0ZWQgYmFyIHBsb3RzCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIEFjY0JhclBsb3QgZXh0ZW5kcyBCYXJQbG90IHsKICAgIHB1YmxpYyAkcGxvdHM9bnVsbDsKICAgIHByaXZhdGUgJG5icnBsb3RzPTA7CiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ09OU1RSVUNUT1IKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRwbG90cykgewogICAgICAgICR0aGlzLT5wbG90cyA9ICRwbG90czsKICAgICAgICAkdGhpcy0+bmJycGxvdHMgPSBjb3VudCgkcGxvdHMpOwogICAgICAgIGlmKCAkdGhpcy0+bmJycGxvdHMgPCAxICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyMDEwKTsvLygnQ2Fubm90IGNyZWF0ZSBBY2NCYXJQbG90IGZyb20gZW1wdHkgcGxvdCBhcnJheS4nKTsKICAgICAgICB9CiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJHRoaXMtPm5icnBsb3RzOyArKyRpICkgewogICAgICAgICAgICBpZiggZW1wdHkoJHRoaXMtPnBsb3RzWyRpXSkgfHwgIWlzc2V0KCR0aGlzLT5wbG90c1skaV0pICkgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjAxMSwkaSk7Ly8oIkFjYyBiYXIgcGxvdCBlbGVtZW50IG5iciAkaSBpcyB1bmRlZmluZWQgb3IgZW1wdHkuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFdlIGNhbiBvbmx5IGFsbG93IGluZGl2aWR1YWwgcGxvc3Qgd2hpY2ggZG8gbm90IGhhdmUgc3BlY2lmaWVkIFgtcG9zaXRpb25zCiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJHRoaXMtPm5icnBsb3RzOyArKyRpICkgewogICAgICAgICAgICBpZiggIWVtcHR5KCR0aGlzLT5wbG90c1skaV0tPmNvb3Jkc1sxXSkgKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyMDE1KTsKICAgICAgICAgICAgICAgIC8vJ0luZGl2aWR1YWwgYmFyIHBsb3RzIGluIGFuIEFjY0JhclBsb3Qgb3IgR3JvdXBCYXJQbG90IGNhbiBub3QgaGF2ZSBzcGVjaWZpZWQgWC1wb3NpdGlvbnMuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFVzZSAwIHdlaWdodCBieSBkZWZhdWx0IHdoaWNoIG1lYW5zIHRoYXQgdGhlIGluZGl2aWR1YWwgYmFyCiAgICAgICAgLy8gd2VpZ2h0cyB3aWxsIGJlIHVzZWQgcGVyIHBhcnQgbiB0aGUgYWNjdW11bGF0ZWQgYmFyCiAgICAgICAgJHRoaXMtPlNldFdlaWdodCgwKTsKCiAgICAgICAgJHRoaXMtPm51bXBvaW50cyA9ICRwbG90c1swXS0+bnVtcG9pbnRzOwogICAgICAgICR0aGlzLT52YWx1ZSA9IG5ldyBEaXNwbGF5VmFsdWUoKTsKICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIExlZ2VuZCgkZ3JhcGgpIHsKICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT5wbG90cyk7CiAgICAgICAgZm9yKCAkaT0kbi0xOyAkaSA+PSAwOyAtLSRpICkgewogICAgICAgICAgICAkYyA9IGdldF9jbGFzcygkdGhpcy0+cGxvdHNbJGldKTsKICAgICAgICAgICAgaWYoICEoJHRoaXMtPnBsb3RzWyRpXSBpbnN0YW5jZW9mIEJhclBsb3QpICkgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjAxMiwkYyk7CiAgICAgICAgICAgICAgICAvLygnT25lIG9mIHRoZSBvYmplY3RzIHN1Ym1pdHRlZCB0byBBY2NCYXIgaXMgbm90IGEgQmFyUGxvdC4gTWFrZSBzdXJlIHRoYXQgeW91IGNyZWF0ZSB0aGUgQWNjQmFyIHBsb3QgZnJvbSBhbiBhcnJheSBvZiBCYXJQbG90IG9iamVjdHMuKENsYXNzPScuJGMuJyknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT5Eb0xlZ2VuZCgkZ3JhcGgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBNYXgoKSB7CiAgICAgICAgbGlzdCgkeG1heCkgPSAkdGhpcy0+cGxvdHNbMF0tPk1heCgpOwogICAgICAgICRubWF4PTA7CiAgICAgICAgZm9yKCRpPTA7ICRpIDwgY291bnQoJHRoaXMtPnBsb3RzKTsgKyskaSkgewogICAgICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT5wbG90c1skaV0tPmNvb3Jkc1swXSk7CiAgICAgICAgICAgICRubWF4ID0gbWF4KCRubWF4LCRuKTsKICAgICAgICAgICAgbGlzdCgkeCkgPSAkdGhpcy0+cGxvdHNbJGldLT5NYXgoKTsKICAgICAgICAgICAgJHhtYXggPSBtYXgoJHhtYXgsJHgpOwogICAgICAgIH0KICAgICAgICBmb3IoICRpID0gMDsgJGkgPCAkbm1heDsgJGkrKyApIHsKICAgICAgICAgICAgLy8gR2V0IHktdmFsdWUgZm9yIGJhciAkaSBieSBhZGRpbmcgdGhlCiAgICAgICAgICAgIC8vIGluZGl2aWR1YWwgYmFycyBmcm9tIGFsbCB0aGUgcGxvdHMgYWRkZWQuCiAgICAgICAgICAgIC8vIEl0IHdvdWxkIGJlIHdyb25nIHRvIGp1c3QgYWRkIHRoZQogICAgICAgICAgICAvLyBpbmRpdmlkdWFsIHBsb3RzIG1heCB5LXZhbHVlIHNpbmNlIHRoYXQKICAgICAgICAgICAgLy8gd291bGQgaW4gbW9zdCBjYXNlcyBnaXZlIHRvIGxhcmdlIHktdmFsdWUuCiAgICAgICAgICAgICR5PTA7CiAgICAgICAgICAgIGlmKCAhaXNzZXQoJHRoaXMtPnBsb3RzWzBdLT5jb29yZHNbMF1bJGldKSApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIwMTQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAkdGhpcy0+cGxvdHNbMF0tPmNvb3Jkc1swXVskaV0gPiAwICkKICAgICAgICAgICAgJHk9JHRoaXMtPnBsb3RzWzBdLT5jb29yZHNbMF1bJGldOwogICAgICAgICAgICBmb3IoICRqID0gMTsgJGogPCAkdGhpcy0+bmJycGxvdHM7ICRqKysgKSB7CiAgICAgICAgICAgICAgICBpZiggIWlzc2V0KCR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV0pICkgewogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIwMTQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV0gPiAwICkKICAgICAgICAgICAgICAgICR5ICs9ICR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHltYXhbJGldID0gJHk7CiAgICAgICAgfQogICAgICAgICR5bWF4ID0gbWF4KCR5bWF4KTsKCiAgICAgICAgLy8gQmFyIGFsd2F5cyBzdGFydCBhdCBiYXNlbGluZQogICAgICAgIGlmKCAkeW1heCA8PSAkdGhpcy0+eWJhc2UgKQogICAgICAgICR5bWF4ID0gJHRoaXMtPnliYXNlOwogICAgICAgIHJldHVybiBhcnJheSgkeG1heCwkeW1heCk7CiAgICB9CgogICAgZnVuY3Rpb24gTWluKCkgewogICAgICAgICRubWF4PTA7CiAgICAgICAgbGlzdCgkeG1pbiwkeXNldG1pbikgPSAkdGhpcy0+cGxvdHNbMF0tPk1pbigpOwogICAgICAgIGZvcigkaT0wOyAkaSA8IGNvdW50KCR0aGlzLT5wbG90cyk7ICsrJGkpIHsKICAgICAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+cGxvdHNbJGldLT5jb29yZHNbMF0pOwogICAgICAgICAgICAkbm1heCA9IG1heCgkbm1heCwkbik7CiAgICAgICAgICAgIGxpc3QoJHgsJHkpID0gJHRoaXMtPnBsb3RzWyRpXS0+TWluKCk7CiAgICAgICAgICAgICR4bWluID0gTWluKCR4bWluLCR4KTsKICAgICAgICAgICAgJHlzZXRtaW4gPSBNaW4oJHksJHlzZXRtaW4pOwogICAgICAgIH0KICAgICAgICBmb3IoICRpID0gMDsgJGkgPCAkbm1heDsgJGkrKyApIHsKICAgICAgICAgICAgLy8gR2V0IHktdmFsdWUgZm9yIGJhciAkaSBieSBhZGRpbmcgdGhlCiAgICAgICAgICAgIC8vIGluZGl2aWR1YWwgYmFycyBmcm9tIGFsbCB0aGUgcGxvdHMgYWRkZWQuCiAgICAgICAgICAgIC8vIEl0IHdvdWxkIGJlIHdyb25nIHRvIGp1c3QgYWRkIHRoZQogICAgICAgICAgICAvLyBpbmRpdmlkdWFsIHBsb3RzIG1heCB5LXZhbHVlIHNpbmNlIHRoYXQKICAgICAgICAgICAgLy8gd291bGQgaW4gbW9zdCBjYXNlcyBnaXZlIHRvIGxhcmdlIHktdmFsdWUuCiAgICAgICAgICAgICR5PTA7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+cGxvdHNbMF0tPmNvb3Jkc1swXVskaV0gPCAwICkKICAgICAgICAgICAgJHk9JHRoaXMtPnBsb3RzWzBdLT5jb29yZHNbMF1bJGldOwogICAgICAgICAgICBmb3IoICRqID0gMTsgJGogPCAkdGhpcy0+bmJycGxvdHM7ICRqKysgKSB7CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnBsb3RzWyRqXS0+Y29vcmRzWzBdWyRpXSA8IDAgKQogICAgICAgICAgICAgICAgJHkgKz0gJHRoaXMtPnBsb3RzWyAkaiBdLT5jb29yZHNbMF1bJGldOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR5bWluWyRpXSA9ICR5OwogICAgICAgIH0KICAgICAgICAkeW1pbiA9IE1pbigkeXNldG1pbixNaW4oJHltaW4pKTsKICAgICAgICAvLyBCYXIgYWx3YXlzIHN0YXJ0IGF0IGJhc2VsaW5lCiAgICAgICAgaWYoICR5bWluID49ICR0aGlzLT55YmFzZSApCiAgICAgICAgJHltaW4gPSAkdGhpcy0+eWJhc2U7CiAgICAgICAgcmV0dXJuIGFycmF5KCR4bWluLCR5bWluKTsKICAgIH0KCiAgICAvLyBTdHJva2UgYWNjIGJhciBwbG90CiAgICBmdW5jdGlvbiBTdHJva2UoJGltZywkeHNjYWxlLCR5c2NhbGUpIHsKICAgICAgICAkcGF0dGVybj1OVUxMOwogICAgICAgICRpbWctPlNldExpbmVXZWlnaHQoJHRoaXMtPndlaWdodCk7CiAgICAgICAgJGdyYWQ9bnVsbDsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkdGhpcy0+bnVtcG9pbnRzLTE7ICRpKyspIHsKICAgICAgICAgICAgJGFjY3kgPSAwOwogICAgICAgICAgICAkYWNjeV9uZWcgPSAwOwogICAgICAgICAgICBmb3IoJGo9MDsgJGogPCAkdGhpcy0+bmJycGxvdHM7ICsrJGogKSB7CiAgICAgICAgICAgICAgICAkaW1nLT5TZXRDb2xvcigkdGhpcy0+cGxvdHNbJGpdLT5jb2xvcik7CgogICAgICAgICAgICAgICAgaWYgKCAkdGhpcy0+cGxvdHNbJGpdLT5jb29yZHNbMF1bJGldID49IDApIHsKICAgICAgICAgICAgICAgICAgICAkeXQ9JHlzY2FsZS0+VHJhbnNsYXRlKCR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV0rJGFjY3kpOwogICAgICAgICAgICAgICAgICAgICRhY2N5dD0keXNjYWxlLT5UcmFuc2xhdGUoJGFjY3kpOwogICAgICAgICAgICAgICAgICAgICRhY2N5Kz0kdGhpcy0+cGxvdHNbJGpdLT5jb29yZHNbMF1bJGldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy9pZiAoICR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV0gPCAwIHx8ICRhY2N5X25lZyA8IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgJHl0PSR5c2NhbGUtPlRyYW5zbGF0ZSgkdGhpcy0+cGxvdHNbJGpdLT5jb29yZHNbMF1bJGldKyRhY2N5X25lZyk7CiAgICAgICAgICAgICAgICAgICAgJGFjY3l0PSR5c2NhbGUtPlRyYW5zbGF0ZSgkYWNjeV9uZWcpOwogICAgICAgICAgICAgICAgICAgICRhY2N5X25lZys9JHRoaXMtPnBsb3RzWyRqXS0+Y29vcmRzWzBdWyRpXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkeHQ9JHhzY2FsZS0+VHJhbnNsYXRlKCRpKTsKCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmFic3dpZHRoID4gLTEgKSB7CiAgICAgICAgICAgICAgICAgICAgJGFic3dpZHRoPSR0aGlzLT5hYnN3aWR0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRhYnN3aWR0aD1yb3VuZCgkdGhpcy0+d2lkdGgqJHhzY2FsZS0+c2NhbGVfZmFjdG9yLDApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRwdHM9YXJyYXkoJHh0LCRhY2N5dCwkeHQsJHl0LCR4dCskYWJzd2lkdGgsJHl0LCR4dCskYWJzd2lkdGgsJGFjY3l0KTsKCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmJhcl9zaGFkb3cgKSB7CiAgICAgICAgICAgICAgICAgICAgJHNzaCA9ICR0aGlzLT5iYXJfc2hhZG93X2hzaXplOwogICAgICAgICAgICAgICAgICAgICRzc3YgPSAkdGhpcy0+YmFyX3NoYWRvd192c2l6ZTsKCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbXVzdCBhbHNvIGRpZmZlciBpZiB3ZSBhcmUgYSBwb3NpdGl2ZSBvciBuZWdhdGl2ZSBiYXIuCiAgICAgICAgICAgICAgICAgICAgaWYoICRqID09PSAwICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGdldHMgZXh0cmEgY29tcGxpY2F0ZWQgc2luY2Ugd2UgaGF2ZSB0bwogICAgICAgICAgICAgICAgICAgICAgICAvLyBzZWUgYWxsIHBsb3RzIHRvIHNlZSBpZiB3ZSBhcmUgbmVnYXRpdmUuIEl0IGNvdWxkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciBleGFtcGxlIGJlIHRoYXQgYWxsIHBsb3RzIGFyZSAwIHVudGlsIHRoZSB2ZXJ5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxhc3Qgb25lLiBXZSB0aGVyZWZvcmUgbmVlZCB0byBzYXZlIHRoZSBpbml0aWFsIHNldHVwCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciBib3RoIHRoZSBuZWdhdGl2ZSBhbmQgcG9zaXRpdmUgY2FzZQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW4gY2FzZSB0aGUgZmluYWwgYmFyIGlzIHBvc2l0aXZlCiAgICAgICAgICAgICAgICAgICAgICAgICRzcFswXT0kcHRzWzZdKzE7ICRzcFsxXT0kcHRzWzddOwogICAgICAgICAgICAgICAgICAgICAgICAkc3BbMl09JHB0c1s2XSskc3NoOyAkc3BbM109JHB0c1s3XS0kc3N2OwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW4gY2FzZSB0aGUgZmluYWwgYmFyIGlzIG5lZ2F0aXZlCiAgICAgICAgICAgICAgICAgICAgICAgICRuc3BbMF09JHB0c1swXTsgJG5zcFsxXT0kcHRzWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAkbnNwWzJdPSRwdHNbMF0rJHNzaDsgJG5zcFszXT0kcHRzWzFdLSRzc3Y7CiAgICAgICAgICAgICAgICAgICAgICAgICRuc3BbNF09JHB0c1s2XSskc3NoOyAkbnNwWzVdPSRwdHNbN10tJHNzdjsKICAgICAgICAgICAgICAgICAgICAgICAgJG5zcFsxMF09JHB0c1s2XSsxOyAkbnNwWzExXT0kcHRzWzddOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoICRqID09PSAkdGhpcy0+bmJycGxvdHMtMSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyB0aGUgbGFzdCBwbG90IG9mIHRoZSBiYXIgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSB0b3RhbCB2YWx1ZSBpcyBsYXJnZXIgdGhhbiAwIHRoZW4gd2UKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBzaGFkb3cuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBpc19hcnJheSgkdGhpcy0+YmFyX3NoYWRvd19jb2xvcikgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbnVtY29sb3JzID0gY291bnQoJHRoaXMtPmJhcl9zaGFkb3dfY29sb3IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoICRudW1jb2xvcnMgPT0gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyMDEzKTsvLygnWW91IGhhdmUgc3BlY2lmaWVkIGFuIGVtcHR5IGFycmF5IGZvciBzaGFkb3cgY29sb3JzIGluIHRoZSBiYXIgcGxvdC4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWctPlB1c2hDb2xvcigkdGhpcy0+YmFyX3NoYWRvd19jb2xvclskaSAlICRudW1jb2xvcnNdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWctPlB1c2hDb2xvcigkdGhpcy0+YmFyX3NoYWRvd19jb2xvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkYWNjeSA+IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3BbNF09JHB0c1s0XSskc3NoOyAkc3BbNV09JHB0c1s1XS0kc3N2OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwWzZdPSRwdHNbMl0rJHNzaDsgJHNwWzddPSRwdHNbM10tJHNzdjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzcFs4XT0kcHRzWzJdOyAkc3BbOV09JHB0c1szXS0xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwWzEwXT0kcHRzWzRdKzE7ICRzcFsxMV09JHB0c1s1XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWctPkZpbGxlZFBvbHlnb24oJHNwLDQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiggJGFjY3lfbmVnIDwgMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuc3BbNl09JHB0c1s0XSskc3NoOyAkbnNwWzddPSRwdHNbNV0tJHNzdjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuc3BbOF09JHB0c1s0XSsxOyAkbnNwWzldPSRwdHNbNV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1nLT5GaWxsZWRQb2x5Z29uKCRuc3AsNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGltZy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgIC8vIElmIHZhbHVlIGlzIE5VTEwgb3IgMCwgdGhlbiBkb24ndCBkcmF3IGEgYmFyIGF0IGFsbAogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV0gPT0gMCApIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkICkgewogICAgICAgICAgICAgICAgICAgIGlmKCAkZ3JhZCA9PT0gbnVsbCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGdyYWQgPSBuZXcgR3JhZGllbnQoJGltZyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKCBpc19hcnJheSgkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX2Zyb21jb2xvcikgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBmaXJzdCBhcmd1bWVudCAoZ3JhZF9mcm9tY29sb3IpIGNhbiBiZSBlaXRoZXIgYW4gYXJyYXkgb3IgYSBzaW5nbGUgY29sb3IuIElmIGl0IGlzIGFuIGFycmF5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gd2UgaGF2ZSB0d28gY2hvaWNlcy4gSXQgY2FuIGVpdGhlciBhKSBiZSBhIHNpbmdsZSBjb2xvciBzcGVjaWZpZWQgYXMgYW4gUkdCIHRyaXBsZSBvciBpdCBjYW4gYmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW4gYXJyYXkgdG8gc3BlY2lmeSBib3RoIChmcm9tLCB0byBzdHlsZSkgZm9yIGVhY2ggaW5kaXZpZHVhbCBiYXIuIFRoZSB3YXkgdG8ga25vdyB0aGUgZGlmZmVyZW5jZSBpcwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0byBpbnZlc3RnYXRlIHRoZSBmaXJzdCBlbGVtZW50LiBJZiB0aGlzIGVsZW1lbnQgaXMgYW4gaW50ZWdlciBbMCwyNTVdIHRoZW4gd2UgYXNzdW1lIGl0IGlzIGFuIFJHQgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0cmlwbGUuCiAgICAgICAgICAgICAgICAgICAgICAgICRuZyA9IGNvdW50KCR0aGlzLT5wbG90c1skal0tPmdyYWRfZnJvbWNvbG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICRuZyA9PT0gMyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBpc19udW1lcmljKCR0aGlzLT5wbG90c1skal0tPmdyYWRfZnJvbWNvbG9yWzBdKSAmJiAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX2Zyb21jb2xvclswXSA+IDAgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRqXS0+Z3JhZF9mcm9tY29sb3JbMF0gPCAyNTYgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUkdCIFRyaXBsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tY29sb3IgPSAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX2Zyb21jb2xvcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9jb2xvciA9ICR0aGlzLT5wbG90c1skal0tPmdyYWRfdG9jb2xvcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3R5bGUgPSAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX3N0eWxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZyb21jb2xvciA9ICR0aGlzLT5wbG90c1skal0tPmdyYWRfZnJvbWNvbG9yWyRpICUgJG5nXVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdG9jb2xvciA9ICR0aGlzLT5wbG90c1skal0tPmdyYWRfZnJvbWNvbG9yWyRpICUgJG5nXVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3R5bGUgPSAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX2Zyb21jb2xvclskaSAlICRuZ11bMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZnJvbWNvbG9yID0gJHRoaXMtPnBsb3RzWyRqXS0+Z3JhZF9mcm9tY29sb3JbJGkgJSAkbmddWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvY29sb3IgPSAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX2Zyb21jb2xvclskaSAlICRuZ11bMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3R5bGUgPSAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX2Zyb21jb2xvclskaSAlICRuZ11bMl07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGdyYWQtPkZpbGxlZFJlY3RhbmdsZSgkcHRzWzJdLCRwdHNbM10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHB0c1s2XSwkcHRzWzddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmcm9tY29sb3IsJHRvY29sb3IsJHN0eWxlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRncmFkLT5GaWxsZWRSZWN0YW5nbGUoJHB0c1syXSwkcHRzWzNdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwdHNbNl0sJHB0c1s3XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX2Zyb21jb2xvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGpdLT5ncmFkX3RvY29sb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRqXS0+Z3JhZF9zdHlsZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNfYXJyYXkoJHRoaXMtPnBsb3RzWyRqXS0+ZmlsbF9jb2xvcikgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRudW1jb2xvcnMgPSBjb3VudCgkdGhpcy0+cGxvdHNbJGpdLT5maWxsX2NvbG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGxjb2xvciA9ICR0aGlzLT5wbG90c1skal0tPmZpbGxfY29sb3JbJGkgJSAkbnVtY29sb3JzXTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGJhciBpcyBzcGVjaWZpZWQgdG8gYmUgbm9uIGZpbGxlZCB0aGVuIHRoZSBmaWxsIGNvbG9yIGlzIGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkZmlsbGNvbG9yICE9PSBmYWxzZSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbWctPlNldENvbG9yKCR0aGlzLT5wbG90c1skal0tPmZpbGxfY29sb3JbJGkgJSAkbnVtY29sb3JzXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxsY29sb3IgPSAkdGhpcy0+cGxvdHNbJGpdLT5maWxsX2NvbG9yOwogICAgICAgICAgICAgICAgICAgICAgICBpZiggJGZpbGxjb2xvciAhPT0gZmFsc2UgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1nLT5TZXRDb2xvcigkdGhpcy0+cGxvdHNbJGpdLT5maWxsX2NvbG9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiggJGZpbGxjb2xvciAhPT0gZmFsc2UgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbWctPkZpbGxlZFBvbHlnb24oJHB0cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRpbWctPlNldENvbG9yKCR0aGlzLT5wbG90c1skal0tPmNvbG9yKTsKCiAgICAgICAgICAgICAgICAvLyBTdHJva2UgdGhlIHBhdHRlcm4KICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+cGxvdHNbJGpdLT5pUGF0dGVybiA+IC0xICkgewogICAgICAgICAgICAgICAgICAgIGlmKCAkcGF0dGVybj09PU5VTEwgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gbmV3IFJlY3RQYXR0ZXJuRmFjdG9yeSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJHByZWN0ID0gJHBhdHRlcm4tPkNyZWF0ZSgkdGhpcy0+cGxvdHNbJGpdLT5pUGF0dGVybiwkdGhpcy0+cGxvdHNbJGpdLT5pUGF0dGVybkNvbG9yLDEpOwogICAgICAgICAgICAgICAgICAgICRwcmVjdC0+U2V0RGVuc2l0eSgkdGhpcy0+cGxvdHNbJGpdLT5pUGF0dGVybkRlbnNpdHkpOwogICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+cGxvdHNbJGpdLT5jb29yZHNbMF1bJGldIDwgMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJ4ID0gJHB0c1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgJHJ5ID0gJHB0c1sxXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyeCA9ICRwdHNbMl07CiAgICAgICAgICAgICAgICAgICAgICAgICRyeSA9ICRwdHNbM107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICR3aWR0aCA9IGFicygkcHRzWzRdLSRwdHNbMF0pKzE7CiAgICAgICAgICAgICAgICAgICAgJGhlaWdodCA9IGFicygkcHRzWzFdLSRwdHNbM10pKzE7CiAgICAgICAgICAgICAgICAgICAgJHByZWN0LT5TZXRQb3MobmV3IFJlY3RhbmdsZSgkcngsJHJ5LCR3aWR0aCwkaGVpZ2h0KSk7CiAgICAgICAgICAgICAgICAgICAgJHByZWN0LT5TdHJva2UoJGltZyk7CiAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgIC8vIENTSU0gYXJyYXkKCiAgICAgICAgICAgICAgICBpZiggJGkgPCBjb3VudCgkdGhpcy0+cGxvdHNbJGpdLT5jc2ltdGFyZ2V0cykgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBjbGllbnQgc2lkZSBpbWFnZSBtYXAKICAgICAgICAgICAgICAgICAgICAkcnB0cyA9ICRpbWctPkFyclJvdGF0ZSgkcHRzKTsKICAgICAgICAgICAgICAgICAgICAkY3NpbWNvb3JkPXJvdW5kKCRycHRzWzBdKS4iLCAiLnJvdW5kKCRycHRzWzFdKTsKICAgICAgICAgICAgICAgICAgICBmb3IoICRrPTE7ICRrIDwgNDsgKyskayl7CiAgICAgICAgICAgICAgICAgICAgICAgICRjc2ltY29vcmQgLj0gIiwgIi5yb3VuZCgkcnB0c1syKiRrXSkuIiwgIi5yb3VuZCgkcnB0c1syKiRrKzFdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoICEgZW1wdHkoJHRoaXMtPnBsb3RzWyRqXS0+Y3NpbXRhcmdldHNbJGldKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNzaW1hcmVhcy49ICc8YXJlYSBzaGFwZT0icG9seSIgY29vcmRzPSInLiRjc2ltY29vcmQuJyIgJzsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNzaW1hcmVhcy49ICIgaHJlZj1cIiIuJHRoaXMtPnBsb3RzWyRqXS0+Y3NpbXRhcmdldHNbJGldLiJcIiAiOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICEgZW1wdHkoJHRoaXMtPnBsb3RzWyRqXS0+Y3NpbXdpbnRhcmdldHNbJGldKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5jc2ltYXJlYXMuPSAiIHRhcmdldD1cIiIuJHRoaXMtPnBsb3RzWyRqXS0+Y3NpbXdpbnRhcmdldHNbJGldLiJcIiAiOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkc3ZhbD0nJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICFlbXB0eSgkdGhpcy0+cGxvdHNbJGpdLT5jc2ltYWx0c1skaV0pICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN2YWw9c3ByaW50ZigkdGhpcy0+cGxvdHNbJGpdLT5jc2ltYWx0c1skaV0sJHRoaXMtPnBsb3RzWyRqXS0+Y29vcmRzWzBdWyRpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICIgdGl0bGU9XCIkc3ZhbFwiICI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNzaW1hcmVhcyAuPSAiIGFsdD1cIiRzdmFsXCIgLz5cbiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRwdHNbXSA9ICRwdHNbMF07CiAgICAgICAgICAgICAgICAkcHRzW10gPSAkcHRzWzFdOwogICAgICAgICAgICAgICAgJGltZy0+U2V0TGluZVdlaWdodCgkdGhpcy0+cGxvdHNbJGpdLT53ZWlnaHQpOwogICAgICAgICAgICAgICAgJGltZy0+UG9seWdvbigkcHRzKTsKICAgICAgICAgICAgICAgICRpbWctPlNldExpbmVXZWlnaHQoMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERhdyBwb3RlbnRpYWwgYmFyIGFyb3VuZCB0aGUgZW50aXJlIGFjY2JhciBiYXIKICAgICAgICAgICAgaWYoICR0aGlzLT53ZWlnaHQgPiAwICkgewogICAgICAgICAgICAgICAgJHk9JHlzY2FsZS0+VHJhbnNsYXRlKDApOwogICAgICAgICAgICAgICAgJGltZy0+U2V0Q29sb3IoJHRoaXMtPmNvbG9yKTsKICAgICAgICAgICAgICAgICRpbWctPlNldExpbmVXZWlnaHQoJHRoaXMtPndlaWdodCk7CiAgICAgICAgICAgICAgICAkaW1nLT5SZWN0YW5nbGUoJHB0c1swXSwkeSwkcHRzWzZdLCRwdHNbNV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmF3IGxhYmVscyBmb3IgZWFjaCBhY2MuYmFyCgogICAgICAgICAgICAkeD0kcHRzWzJdKygkcHRzWzRdLSRwdHNbMl0pLzI7CiAgICAgICAgICAgIGlmKCR0aGlzLT5iYXJfc2hhZG93KSAkeCArPSAkc3NoOwoKICAgICAgICAgICAgLy8gRmlyc3Qgc3Ryb2tlIHRoZSBhY2N1bXVsYXRlZCB2YWx1ZSBmb3IgdGhlIGVudGlyZSBiYXIKICAgICAgICAgICAgLy8gVGhpcyB2YWx1ZSBpcyBhbHdheXMgcGxhY2VkIGF0IHRoZSB0b3AvYm90dG9tIG9mIHRoZSBiYXJzCiAgICAgICAgICAgIGlmKCAkYWNjeV9uZWcgPCAwICkgewogICAgICAgICAgICAgICAgJHk9JHlzY2FsZS0+VHJhbnNsYXRlKCRhY2N5X25lZyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlN0cm9rZSgkaW1nLCRhY2N5X25lZywkeCwkeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkeT0keXNjYWxlLT5UcmFuc2xhdGUoJGFjY3kpOwogICAgICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TdHJva2UoJGltZywkYWNjeSwkeCwkeSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRhY2N5ID0gMDsKICAgICAgICAgICAgJGFjY3lfbmVnID0gMDsKICAgICAgICAgICAgZm9yKCRqPTA7ICRqIDwgJHRoaXMtPm5icnBsb3RzOyArKyRqICkgewoKICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHByaW50IDAgdmFsdWVzIGluIGFuIGFjY3VtdWxhdGVkIGJhciBwbG90CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnBsb3RzWyRqXS0+Y29vcmRzWzBdWyRpXSA9PSAwICkgY29udGludWU7CgogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHl0PSR5c2NhbGUtPlRyYW5zbGF0ZSgkdGhpcy0+cGxvdHNbJGpdLT5jb29yZHNbMF1bJGldKyRhY2N5KTsKICAgICAgICAgICAgICAgICAgICAkYWNjeXQ9JHlzY2FsZS0+VHJhbnNsYXRlKCRhY2N5KTsKICAgICAgICAgICAgICAgICAgICBpZiggICR0aGlzLT5wbG90c1skal0tPnZhbHVlcG9zPT0nY2VudGVyJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHkgPSAkYWNjeXQtKCRhY2N5dC0keXQpLzI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWVwb3M9PSdib3R0b20nICkgewogICAgICAgICAgICAgICAgICAgICAgICAkeSA9ICRhY2N5dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7IC8vIHRvcCBvciBtYXgKICAgICAgICAgICAgICAgICAgICAgICAgJHkgPSAkYWNjeXQtKCRhY2N5dC0keXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkYWNjeSs9JHRoaXMtPnBsb3RzWyRqXS0+Y29vcmRzWzBdWyRpXTsKICAgICAgICAgICAgICAgICAgICBpZiggICR0aGlzLT5wbG90c1skal0tPnZhbHVlcG9zPT0nY2VudGVyJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWUtPlNldEFsaWduKCJjZW50ZXIiLCJjZW50ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWUtPlNldE1hcmdpbigwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZWlmKCAkdGhpcy0+cGxvdHNbJGpdLT52YWx1ZXBvcz09J2JvdHRvbScgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skal0tPnZhbHVlLT5TZXRBbGlnbignY2VudGVyJywnYm90dG9tJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skal0tPnZhbHVlLT5TZXRNYXJnaW4oMik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGpdLT52YWx1ZS0+U2V0QWxpZ24oJ2NlbnRlcicsJ3RvcCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGpdLT52YWx1ZS0+U2V0TWFyZ2luKDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHl0PSR5c2NhbGUtPlRyYW5zbGF0ZSgkdGhpcy0+cGxvdHNbJGpdLT5jb29yZHNbMF1bJGldKyRhY2N5X25lZyk7CiAgICAgICAgICAgICAgICAgICAgJGFjY3l0PSR5c2NhbGUtPlRyYW5zbGF0ZSgkYWNjeV9uZWcpOwogICAgICAgICAgICAgICAgICAgICRhY2N5X25lZys9JHRoaXMtPnBsb3RzWyRqXS0+Y29vcmRzWzBdWyRpXTsKICAgICAgICAgICAgICAgICAgICBpZiggICR0aGlzLT5wbG90c1skal0tPnZhbHVlcG9zPT0nY2VudGVyJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHkgPSAkYWNjeXQtKCRhY2N5dC0keXQpLzI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWVwb3M9PSdib3R0b20nICkgewogICAgICAgICAgICAgICAgICAgICAgICAkeSA9ICRhY2N5dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR5ID0gJGFjY3l0LSgkYWNjeXQtJHl0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoICAkdGhpcy0+cGxvdHNbJGpdLT52YWx1ZXBvcz09J2NlbnRlcicgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skal0tPnZhbHVlLT5TZXRBbGlnbigiY2VudGVyIiwiY2VudGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skal0tPnZhbHVlLT5TZXRNYXJnaW4oMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWVwb3M9PSdib3R0b20nICkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGpdLT52YWx1ZS0+U2V0QWxpZ24oJ2NlbnRlcicsJGo9PTAgPyAnYm90dG9tJzondG9wJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skal0tPnZhbHVlLT5TZXRNYXJnaW4oLTIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWUtPlNldEFsaWduKCdjZW50ZXInLCdib3R0b20nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWUtPlNldE1hcmdpbigtMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRqXS0+dmFsdWUtPlN0cm9rZSgkaW1nLCR0aGlzLT5wbG90c1skal0tPmNvb3Jkc1swXVskaV0sJHgsJHkpOwogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfSAvLyBDbGFzcwoKLyogRU9GICovCj8+Cg==",
    "size": "47332"
}