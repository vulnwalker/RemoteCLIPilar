{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Writer\/Excel5\/Worksheet.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKgogKiBQSFBFeGNlbF9Xcml0ZXJfRXhjZWw1X1dvcmtzaGVldAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKICogdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBCiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsX1dyaXRlcl9FeGNlbDUKICogQGNvcHlyaWdodCAgQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbCAoaHR0cDovL3d3dy5jb2RlcGxleC5jb20vUEhQRXhjZWwpCiAqIEBsaWNlbnNlICAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9vbGQtbGljZW5zZXMvbGdwbC0yLjEudHh0ICAgIExHUEwKICogQHZlcnNpb24gICAgIyNWRVJTSU9OIyMsICMjREFURSMjCiAqLwoKLy8gT3JpZ2luYWwgZmlsZSBoZWFkZXIgb2YgUEVBUjo6U3ByZWFkc2hlZXRfRXhjZWxfV3JpdGVyX1dvcmtzaGVldCAodXNlZCBhcyB0aGUgYmFzZSBmb3IgdGhpcyBjbGFzcyk6Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIC8qCi8vICogIE1vZHVsZSB3cml0dGVuL3BvcnRlZCBieSBYYXZpZXIgTm9ndWVyIDx4bm9ndWVyQHJlemVicmEuY29tPgovLyAqCi8vICogIFRoZSBtYWpvcml0eSBvZiB0aGlzIGlzIF9OT1RfIG15IGNvZGUuICBJIHNpbXBseSBwb3J0ZWQgaXQgZnJvbSB0aGUKLy8gKiAgUEVSTCBTcHJlYWRzaGVldDo6V3JpdGVFeGNlbCBtb2R1bGUuCi8vICoKLy8gKiAgVGhlIGF1dGhvciBvZiB0aGUgU3ByZWFkc2hlZXQ6OldyaXRlRXhjZWwgbW9kdWxlIGlzIEpvaG4gTWNOYW1hcmEKLy8gKiAgPGptY25hbWFyYUBjcGFuLm9yZz4KLy8gKgovLyAqICBJIF9ET18gbWFpbnRhaW4gdGhpcyBjb2RlLCBhbmQgSm9obiBNY05hbWFyYSBoYXMgbm90aGluZyB0byBkbyB3aXRoIHRoZQovLyAqICBwb3J0aW5nIG9mIHRoaXMgY29kZSB0byBQSFAuICBBbnkgcXVlc3Rpb25zIGRpcmVjdGx5IHJlbGF0ZWQgdG8gdGhpcwovLyAqICBjbGFzcyBsaWJyYXJ5IHNob3VsZCBiZSBkaXJlY3RlZCB0byBtZS4KLy8gKgovLyAqICBMaWNlbnNlIEluZm9ybWF0aW9uOgovLyAqCi8vICogICAgU3ByZWFkc2hlZXRfRXhjZWxfV3JpdGVyOiAgQSBsaWJyYXJ5IGZvciBnZW5lcmF0aW5nIEV4Y2VsIFNwcmVhZHNoZWV0cwovLyAqICAgIENvcHlyaWdodCAoYykgMjAwMi0yMDAzIFhhdmllciBOb2d1ZXIgeG5vZ3VlckByZXplYnJhLmNvbQovLyAqCi8vICogICAgVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcgovLyAqICAgIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKLy8gKiAgICBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKLy8gKiAgICB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KLy8gKgovLyAqICAgIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAovLyAqICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCi8vICogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKLy8gKiAgICBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgovLyAqCi8vICogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwovLyAqICAgIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKLy8gKiAgICBGb3VuZGF0aW9uLCBJbmMuLCA1OSBUZW1wbGUgUGxhY2UsIFN1aXRlIDMzMCwgQm9zdG9uLCBNQSAgMDIxMTEtMTMwNyAgVVNBCi8vICovCmNsYXNzIFBIUEV4Y2VsX1dyaXRlcl9FeGNlbDVfV29ya3NoZWV0IGV4dGVuZHMgUEhQRXhjZWxfV3JpdGVyX0V4Y2VsNV9CSUZGd3JpdGVyCnsKICAgIC8qKgogICAgICogRm9ybXVsYSBwYXJzZXIKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX1dyaXRlcl9FeGNlbDVfUGFyc2VyCiAgICAgKi8KICAgIHByaXZhdGUgJHBhcnNlcjsKCiAgICAvKioKICAgICAqIE1heGltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgZm9yIGEgc3RyaW5nIChMQUJFTCByZWNvcmQgaW4gQklGRjUpCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqLwogICAgcHJpdmF0ZSAkeGxzU3RyaW5nTWF4TGVuZ3RoOwoKICAgIC8qKgogICAgICogQXJyYXkgY29udGFpbmluZyBmb3JtYXQgaW5mb3JtYXRpb24gZm9yIGNvbHVtbnMKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkY29sdW1uSW5mbzsKCiAgICAvKioKICAgICAqIEFycmF5IGNvbnRhaW5pbmcgdGhlIHNlbGVjdGVkIGFyZWEgZm9yIHRoZSB3b3Jrc2hlZXQKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkc2VsZWN0aW9uOwoKICAgIC8qKgogICAgICogVGhlIGFjdGl2ZSBwYW5lIGZvciB0aGUgd29ya3NoZWV0CiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqLwogICAgcHJpdmF0ZSAkYWN0aXZlUGFuZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIG91dGxpbmUuCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqLwogICAgcHJpdmF0ZSAkb3V0bGluZU9uOwoKICAgIC8qKgogICAgICogQXV0byBvdXRsaW5lIHN0eWxlcy4KICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwcml2YXRlICRvdXRsaW5lU3R5bGU7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGhhdmUgb3V0bGluZSBzdW1tYXJ5IGJlbG93LgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHByaXZhdGUgJG91dGxpbmVCZWxvdzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gaGF2ZSBvdXRsaW5lIHN1bW1hcnkgYXQgdGhlIHJpZ2h0LgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHByaXZhdGUgJG91dGxpbmVSaWdodDsKCiAgICAvKioKICAgICAqIFJlZmVyZW5jZSB0byB0aGUgdG90YWwgbnVtYmVyIG9mIHN0cmluZ3MgaW4gdGhlIHdvcmtib29rCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqLwogICAgcHJpdmF0ZSAkc3RyaW5nVG90YWw7CgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2UgdG8gdGhlIG51bWJlciBvZiB1bmlxdWUgc3RyaW5ncyBpbiB0aGUgd29ya2Jvb2sKICAgICAqIEB2YXIgaW50ZWdlcgogICAgICovCiAgICBwcml2YXRlICRzdHJpbmdVbmlxdWU7CgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2UgdG8gdGhlIGFycmF5IGNvbnRhaW5pbmcgYWxsIHRoZSB1bmlxdWUgc3RyaW5ncyBpbiB0aGUgd29ya2Jvb2sKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkc3RyaW5nVGFibGU7CgogICAgLyoqCiAgICAgKiBDb2xvciBjYWNoZQogICAgICovCiAgICBwcml2YXRlICRjb2xvcnM7CgogICAgLyoqCiAgICAgKiBJbmRleCBvZiBmaXJzdCB1c2VkIHJvdyAoYXQgbGVhc3QgMCkKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHByaXZhdGUgJGZpcnN0Um93SW5kZXg7CgogICAgLyoqCiAgICAgKiBJbmRleCBvZiBsYXN0IHVzZWQgcm93LiAobm8gdXNlZCByb3dzIG1lYW5zIC0xKQogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJpdmF0ZSAkbGFzdFJvd0luZGV4OwoKICAgIC8qKgogICAgICogSW5kZXggb2YgZmlyc3QgdXNlZCBjb2x1bW4gKGF0IGxlYXN0IDApCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBwcml2YXRlICRmaXJzdENvbHVtbkluZGV4OwoKICAgIC8qKgogICAgICogSW5kZXggb2YgbGFzdCB1c2VkIGNvbHVtbiAobm8gdXNlZCBjb2x1bW5zIG1lYW5zIC0xKQogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJpdmF0ZSAkbGFzdENvbHVtbkluZGV4OwoKICAgIC8qKgogICAgICogU2hlZXQgb2JqZWN0CiAgICAgKiBAdmFyIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgJHBocFNoZWV0OwoKICAgIC8qKgogICAgICogQ291bnQgY2VsbCBzdHlsZSBYZnMKICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBwcml2YXRlICRjb3VudENlbGxTdHlsZVhmczsKCiAgICAvKioKICAgICAqIEVzY2hlciBvYmplY3QgY29ycmVzcG9uZGluZyB0byBNU09EUkFXSU5HCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9TaGFyZWRfRXNjaGVyCiAgICAgKi8KICAgIHByaXZhdGUgJGVzY2hlcjsKCiAgICAvKioKICAgICAqIEFycmF5IG9mIGZvbnQgaGFzaGVzIGFzc29jaWF0ZWQgdG8gRk9OVCByZWNvcmRzIGluZGV4CiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwdWJsaWMgJGZvbnRIYXNoSW5kZXg7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICoKICAgICAqIEBwYXJhbSBpbnQgICAgICAgICYkc3RyX3RvdGFsICAgICAgICBUb3RhbCBudW1iZXIgb2Ygc3RyaW5ncwogICAgICogQHBhcmFtIGludCAgICAgICAgJiRzdHJfdW5pcXVlICAgIFRvdGFsIG51bWJlciBvZiB1bmlxdWUgc3RyaW5ncwogICAgICogQHBhcmFtIGFycmF5ICAgICAgICAmJHN0cl90YWJsZSAgICAgICAgU3RyaW5nIFRhYmxlCiAgICAgKiBAcGFyYW0gYXJyYXkgICAgICAgICYkY29sb3JzICAgICAgICBDb2xvdXIgVGFibGUKICAgICAqIEBwYXJhbSBtaXhlZCAgICAgICAgJHBhcnNlciAgICAgICAgICAgIFRoZSBmb3JtdWxhIHBhcnNlciBjcmVhdGVkIGZvciB0aGUgV29ya2Jvb2sKICAgICAqIEBwYXJhbSBib29sZWFuICAgICRwcmVDYWxjdWxhdGVGb3JtdWxhcyAgICBGbGFnIGluZGljYXRpbmcgd2hldGhlciBmb3JtdWxhcyBzaG91bGQgYmUgY2FsY3VsYXRlZCBvciBqdXN0IHdyaXR0ZW4KICAgICAqIEBwYXJhbSBzdHJpbmcgICAgJHBocFNoZWV0ICAgICAgICBUaGUgd29ya3NoZWV0IHRvIHdyaXRlCiAgICAgKiBAcGFyYW0gUEhQRXhjZWxfV29ya3NoZWV0ICRwaHBTaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJiRzdHJfdG90YWwsICYkc3RyX3VuaXF1ZSwgJiRzdHJfdGFibGUsICYkY29sb3JzLCAkcGFyc2VyLCAkcHJlQ2FsY3VsYXRlRm9ybXVsYXMsICRwaHBTaGVldCkKICAgIHsKICAgICAgICAvLyBJdCBuZWVkcyB0byBjYWxsIGl0cyBwYXJlbnQncyBjb25zdHJ1Y3RvciBleHBsaWNpdGx5CiAgICAgICAgcGFyZW50OjpfX2NvbnN0cnVjdCgpOwoKICAgICAgICAvLyBjaGFuZ2UgQklGRndyaXRlciBsaW1pdCBmb3IgQ09OVElOVUUgcmVjb3JkcwovLyAgICAgICAgJHRoaXMtPl9saW1pdCA9IDgyMjQ7CgoKICAgICAgICAkdGhpcy0+X3ByZUNhbGN1bGF0ZUZvcm11bGFzID0gJHByZUNhbGN1bGF0ZUZvcm11bGFzOwogICAgICAgICR0aGlzLT5zdHJpbmdUb3RhbCAgICAgICAgPSAmJHN0cl90b3RhbDsKICAgICAgICAkdGhpcy0+c3RyaW5nVW5pcXVlICAgICAgICA9ICYkc3RyX3VuaXF1ZTsKICAgICAgICAkdGhpcy0+c3RyaW5nVGFibGUgICAgICAgID0gJiRzdHJfdGFibGU7CiAgICAgICAgJHRoaXMtPmNvbG9ycyAgICAgICAgICAgID0gJiRjb2xvcnM7CiAgICAgICAgJHRoaXMtPnBhcnNlciAgICAgICAgICAgID0gJHBhcnNlcjsKCiAgICAgICAgJHRoaXMtPnBocFNoZWV0ID0gJHBocFNoZWV0OwoKICAgICAgICAvLyR0aGlzLT5leHRfc2hlZXRzICAgICAgICA9IGFycmF5KCk7CiAgICAgICAgLy8kdGhpcy0+b2Zmc2V0ICAgICAgICAgICAgPSAwOwogICAgICAgICR0aGlzLT54bHNTdHJpbmdNYXhMZW5ndGggPSAyNTU7CiAgICAgICAgJHRoaXMtPmNvbHVtbkluZm8gID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+c2VsZWN0aW9uICAgPSBhcnJheSgwLDAsMCwwKTsKICAgICAgICAkdGhpcy0+YWN0aXZlUGFuZSAgPSAzOwoKICAgICAgICAkdGhpcy0+X3ByaW50X2hlYWRlcnMgPSAwOwoKICAgICAgICAkdGhpcy0+b3V0bGluZVN0eWxlICA9IDA7CiAgICAgICAgJHRoaXMtPm91dGxpbmVCZWxvdyAgPSAxOwogICAgICAgICR0aGlzLT5vdXRsaW5lUmlnaHQgID0gMTsKICAgICAgICAkdGhpcy0+b3V0bGluZU9uICAgICA9IDE7CgogICAgICAgICR0aGlzLT5mb250SGFzaEluZGV4ID0gYXJyYXkoKTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIHZhbHVlcyBmb3IgRElNRU5TSU9OUyByZWNvcmQKICAgICAgICAkbWluUiA9IDE7CiAgICAgICAgJG1pbkMgPSAnQSc7CgogICAgICAgICRtYXhSICA9ICR0aGlzLT5waHBTaGVldC0+Z2V0SGlnaGVzdFJvdygpOwogICAgICAgICRtYXhDID0gJHRoaXMtPnBocFNoZWV0LT5nZXRIaWdoZXN0Q29sdW1uKCk7CgogICAgICAgIC8vIERldGVybWluZSBsb3dlc3QgYW5kIGhpZ2hlc3QgY29sdW1uIGFuZCByb3cKLy8gICAgICAgICR0aGlzLT5maXJzdFJvd0luZGV4ID0gKCRtaW5SID4gNjU1MzUpID8gNjU1MzUgOiAkbWluUjsKICAgICAgICAkdGhpcy0+bGFzdFJvd0luZGV4ID0gKCRtYXhSID4gNjU1MzUpID8gNjU1MzUgOiAkbWF4UiA7CgogICAgICAgICR0aGlzLT5maXJzdENvbHVtbkluZGV4ID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRtaW5DKTsKICAgICAgICAkdGhpcy0+bGFzdENvbHVtbkluZGV4ICA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkbWF4Qyk7CgovLyAgICAgICAgaWYgKCR0aGlzLT5maXJzdENvbHVtbkluZGV4ID4gMjU1KSAkdGhpcy0+Zmlyc3RDb2x1bW5JbmRleCA9IDI1NTsKICAgICAgICBpZiAoJHRoaXMtPmxhc3RDb2x1bW5JbmRleCA+IDI1NSkgewogICAgICAgICAgICAkdGhpcy0+bGFzdENvbHVtbkluZGV4ID0gMjU1OwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmNvdW50Q2VsbFN0eWxlWGZzID0gY291bnQoJHBocFNoZWV0LT5nZXRQYXJlbnQoKS0+Z2V0Q2VsbFN0eWxlWGZDb2xsZWN0aW9uKCkpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGRhdGEgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgd29ya2Jvb2sgKG5vdGUgdGhlIHJldmVyc2Ugb3JkZXIpCiAgICAgKiBhbmQgdG8gdGhlIGVuZCBvZiB0aGUgd29ya2Jvb2suCiAgICAgKgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBzZWUgUEhQRXhjZWxfV3JpdGVyX0V4Y2VsNV9Xb3JrYm9vazo6c3RvcmVXb3JrYm9vaygpCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbG9zZSgpCiAgICB7CiAgICAgICAgJHBocFNoZWV0ID0gJHRoaXMtPnBocFNoZWV0OwoKICAgICAgICAkbnVtX3NoZWV0cyA9ICRwaHBTaGVldC0+Z2V0UGFyZW50KCktPmdldFNoZWV0Q291bnQoKTsKCiAgICAgICAgLy8gV3JpdGUgQk9GIHJlY29yZAogICAgICAgICR0aGlzLT5zdG9yZUJvZigweDAwMTApOwoKICAgICAgICAvLyBXcml0ZSBQUklOVEhFQURFUlMKICAgICAgICAkdGhpcy0+d3JpdGVQcmludEhlYWRlcnMoKTsKCiAgICAgICAgLy8gV3JpdGUgUFJJTlRHUklETElORVMKICAgICAgICAkdGhpcy0+d3JpdGVQcmludEdyaWRsaW5lcygpOwoKICAgICAgICAvLyBXcml0ZSBHUklEU0VUCiAgICAgICAgJHRoaXMtPndyaXRlR3JpZHNldCgpOwoKICAgICAgICAvLyBDYWxjdWxhdGUgY29sdW1uIHdpZHRocwogICAgICAgICRwaHBTaGVldC0+Y2FsY3VsYXRlQ29sdW1uV2lkdGhzKCk7CgogICAgICAgIC8vIENvbHVtbiBkaW1lbnNpb25zCiAgICAgICAgaWYgKCgkZGVmYXVsdFdpZHRoID0gJHBocFNoZWV0LT5nZXREZWZhdWx0Q29sdW1uRGltZW5zaW9uKCktPmdldFdpZHRoKCkpIDwgMCkgewogICAgICAgICAgICAkZGVmYXVsdFdpZHRoID0gUEhQRXhjZWxfU2hhcmVkX0ZvbnQ6OmdldERlZmF1bHRDb2x1bW5XaWR0aEJ5Rm9udCgkcGhwU2hlZXQtPmdldFBhcmVudCgpLT5nZXREZWZhdWx0U3R5bGUoKS0+Z2V0Rm9udCgpKTsKICAgICAgICB9CgogICAgICAgICRjb2x1bW5EaW1lbnNpb25zID0gJHBocFNoZWV0LT5nZXRDb2x1bW5EaW1lbnNpb25zKCk7CiAgICAgICAgJG1heENvbCA9ICR0aGlzLT5sYXN0Q29sdW1uSW5kZXggLTE7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDw9ICRtYXhDb2w7ICsrJGkpIHsKICAgICAgICAgICAgJGhpZGRlbiA9IDA7CiAgICAgICAgICAgICRsZXZlbCA9IDA7CiAgICAgICAgICAgICR4ZkluZGV4ID0gMTU7IC8vIHRoZXJlIGFyZSAxNSBjZWxsIHN0eWxlIFhmcwoKICAgICAgICAgICAgJHdpZHRoID0gJGRlZmF1bHRXaWR0aDsKCiAgICAgICAgICAgICRjb2x1bW5MZXR0ZXIgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGkpOwogICAgICAgICAgICBpZiAoaXNzZXQoJGNvbHVtbkRpbWVuc2lvbnNbJGNvbHVtbkxldHRlcl0pKSB7CiAgICAgICAgICAgICAgICAkY29sdW1uRGltZW5zaW9uID0gJGNvbHVtbkRpbWVuc2lvbnNbJGNvbHVtbkxldHRlcl07CiAgICAgICAgICAgICAgICBpZiAoJGNvbHVtbkRpbWVuc2lvbi0+Z2V0V2lkdGgoKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHdpZHRoID0gJGNvbHVtbkRpbWVuc2lvbi0+Z2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRoaWRkZW4gPSAkY29sdW1uRGltZW5zaW9uLT5nZXRWaXNpYmxlKCkgPyAwIDogMTsKICAgICAgICAgICAgICAgICRsZXZlbCA9ICRjb2x1bW5EaW1lbnNpb24tPmdldE91dGxpbmVMZXZlbCgpOwogICAgICAgICAgICAgICAgJHhmSW5kZXggPSAkY29sdW1uRGltZW5zaW9uLT5nZXRYZkluZGV4KCkgKyAxNTsgLy8gdGhlcmUgYXJlIDE1IGNlbGwgc3R5bGUgWGZzCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENvbXBvbmVudHMgb2YgY29sdW1uSW5mbzoKICAgICAgICAgICAgLy8gJGZpcnN0Y29sIGZpcnN0IGNvbHVtbiBvbiB0aGUgcmFuZ2UKICAgICAgICAgICAgLy8gJGxhc3Rjb2wgIGxhc3QgY29sdW1uIG9uIHRoZSByYW5nZQogICAgICAgICAgICAvLyAkd2lkdGggICAgd2lkdGggdG8gc2V0CiAgICAgICAgICAgIC8vICR4ZkluZGV4ICBUaGUgb3B0aW9uYWwgY2VsbCBzdHlsZSBYZiBpbmRleCB0byBhcHBseSB0byB0aGUgY29sdW1ucwogICAgICAgICAgICAvLyAkaGlkZGVuICAgVGhlIG9wdGlvbmFsIGhpZGRlbiBhdHJpYnV0ZQogICAgICAgICAgICAvLyAkbGV2ZWwgICAgVGhlIG9wdGlvbmFsIG91dGxpbmUgbGV2ZWwKICAgICAgICAgICAgJHRoaXMtPmNvbHVtbkluZm9bXSA9IGFycmF5KCRpLCAkaSwgJHdpZHRoLCAkeGZJbmRleCwgJGhpZGRlbiwgJGxldmVsKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIEdVVFMKICAgICAgICAkdGhpcy0+d3JpdGVHdXRzKCk7CgogICAgICAgIC8vIFdyaXRlIERFRkFVTFRST1dIRUlHSFQKICAgICAgICAkdGhpcy0+d3JpdGVEZWZhdWx0Um93SGVpZ2h0KCk7CiAgICAgICAgLy8gV3JpdGUgV1NCT09MCiAgICAgICAgJHRoaXMtPndyaXRlV3Nib29sKCk7CiAgICAgICAgLy8gV3JpdGUgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgcGFnZSBicmVha3MKICAgICAgICAkdGhpcy0+d3JpdGVCcmVha3MoKTsKICAgICAgICAvLyBXcml0ZSBwYWdlIGhlYWRlcgogICAgICAgICR0aGlzLT53cml0ZUhlYWRlcigpOwogICAgICAgIC8vIFdyaXRlIHBhZ2UgZm9vdGVyCiAgICAgICAgJHRoaXMtPndyaXRlRm9vdGVyKCk7CiAgICAgICAgLy8gV3JpdGUgcGFnZSBob3Jpem9udGFsIGNlbnRlcmluZwogICAgICAgICR0aGlzLT53cml0ZUhjZW50ZXIoKTsKICAgICAgICAvLyBXcml0ZSBwYWdlIHZlcnRpY2FsIGNlbnRlcmluZwogICAgICAgICR0aGlzLT53cml0ZVZjZW50ZXIoKTsKICAgICAgICAvLyBXcml0ZSBsZWZ0IG1hcmdpbgogICAgICAgICR0aGlzLT53cml0ZU1hcmdpbkxlZnQoKTsKICAgICAgICAvLyBXcml0ZSByaWdodCBtYXJnaW4KICAgICAgICAkdGhpcy0+d3JpdGVNYXJnaW5SaWdodCgpOwogICAgICAgIC8vIFdyaXRlIHRvcCBtYXJnaW4KICAgICAgICAkdGhpcy0+d3JpdGVNYXJnaW5Ub3AoKTsKICAgICAgICAvLyBXcml0ZSBib3R0b20gbWFyZ2luCiAgICAgICAgJHRoaXMtPndyaXRlTWFyZ2luQm90dG9tKCk7CiAgICAgICAgLy8gV3JpdGUgcGFnZSBzZXR1cAogICAgICAgICR0aGlzLT53cml0ZVNldHVwKCk7CiAgICAgICAgLy8gV3JpdGUgc2hlZXQgcHJvdGVjdGlvbgogICAgICAgICR0aGlzLT53cml0ZVByb3RlY3QoKTsKICAgICAgICAvLyBXcml0ZSBTQ0VOUFJPVEVDVAogICAgICAgICR0aGlzLT53cml0ZVNjZW5Qcm90ZWN0KCk7CiAgICAgICAgLy8gV3JpdGUgT0JKRUNUUFJPVEVDVAogICAgICAgICR0aGlzLT53cml0ZU9iamVjdFByb3RlY3QoKTsKICAgICAgICAvLyBXcml0ZSBzaGVldCBwYXNzd29yZAogICAgICAgICR0aGlzLT53cml0ZVBhc3N3b3JkKCk7CiAgICAgICAgLy8gV3JpdGUgREVGQ09MV0lEVEggcmVjb3JkCiAgICAgICAgJHRoaXMtPndyaXRlRGVmY29sKCk7CgogICAgICAgIC8vIFdyaXRlIHRoZSBDT0xJTkZPIHJlY29yZHMgaWYgdGhleSBleGlzdAogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPmNvbHVtbkluZm8pKSB7CiAgICAgICAgICAgICRjb2xjb3VudCA9IGNvdW50KCR0aGlzLT5jb2x1bW5JbmZvKTsKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGNvbGNvdW50OyArKyRpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVDb2xpbmZvKCR0aGlzLT5jb2x1bW5JbmZvWyRpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJGF1dG9GaWx0ZXJSYW5nZSA9ICRwaHBTaGVldC0+Z2V0QXV0b0ZpbHRlcigpLT5nZXRSYW5nZSgpOwogICAgICAgIGlmICghZW1wdHkoJGF1dG9GaWx0ZXJSYW5nZSkpIHsKICAgICAgICAgICAgLy8gV3JpdGUgQVVUT0ZJTFRFUklORk8KICAgICAgICAgICAgJHRoaXMtPndyaXRlQXV0b0ZpbHRlckluZm8oKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIHNoZWV0IGRpbWVuc2lvbnMKICAgICAgICAkdGhpcy0+d3JpdGVEaW1lbnNpb25zKCk7CgogICAgICAgIC8vIFJvdyBkaW1lbnNpb25zCiAgICAgICAgZm9yZWFjaCAoJHBocFNoZWV0LT5nZXRSb3dEaW1lbnNpb25zKCkgYXMgJHJvd0RpbWVuc2lvbikgewogICAgICAgICAgICAkeGZJbmRleCA9ICRyb3dEaW1lbnNpb24tPmdldFhmSW5kZXgoKSArIDE1OyAvLyB0aGVyZSBhcmUgMTUgY2VsbFhmcwogICAgICAgICAgICAkdGhpcy0+d3JpdGVSb3coJHJvd0RpbWVuc2lvbi0+Z2V0Um93SW5kZXgoKSAtIDEsICRyb3dEaW1lbnNpb24tPmdldFJvd0hlaWdodCgpLCAkeGZJbmRleCwgKCRyb3dEaW1lbnNpb24tPmdldFZpc2libGUoKSA\/ICcwJyA6ICcxJyksICRyb3dEaW1lbnNpb24tPmdldE91dGxpbmVMZXZlbCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIENlbGxzCiAgICAgICAgZm9yZWFjaCAoJHBocFNoZWV0LT5nZXRDZWxsQ29sbGVjdGlvbigpIGFzICRjZWxsSUQpIHsKICAgICAgICAgICAgJGNlbGwgPSAkcGhwU2hlZXQtPmdldENlbGwoJGNlbGxJRCk7CiAgICAgICAgICAgICRyb3cgPSAkY2VsbC0+Z2V0Um93KCkgLSAxOwogICAgICAgICAgICAkY29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRjZWxsLT5nZXRDb2x1bW4oKSkgLSAxOwoKICAgICAgICAgICAgLy8gRG9uJ3QgYnJlYWsgRXhjZWwhCi8vICAgICAgICAgICAgaWYgKCRyb3cgKyAxID4gNjU1MzYgb3IgJGNvbHVtbiArIDEgPiAyNTYpIHsKICAgICAgICAgICAgaWYgKCRyb3cgPiA2NTUzNSB8fCAkY29sdW1uID4gMjU1KSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gV3JpdGUgY2VsbCB2YWx1ZQogICAgICAgICAgICAkeGZJbmRleCA9ICRjZWxsLT5nZXRYZkluZGV4KCkgKyAxNTsgLy8gdGhlcmUgYXJlIDE1IGNlbGwgc3R5bGUgWGZzCgogICAgICAgICAgICAkY1ZhbCA9ICRjZWxsLT5nZXRWYWx1ZSgpOwogICAgICAgICAgICBpZiAoJGNWYWwgaW5zdGFuY2VvZiBQSFBFeGNlbF9SaWNoVGV4dCkgewogICAgICAgICAgICAgICAgLy8gJHRoaXMtPndyaXRlU3RyaW5nKCRyb3csICRjb2x1bW4sICRjVmFsLT5nZXRQbGFpblRleHQoKSwgJHhmSW5kZXgpOwogICAgICAgICAgICAgICAgJGFycmNSdW4gPSBhcnJheSgpOwogICAgICAgICAgICAgICAgJHN0cl9sZW4gPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb3VudENoYXJhY3RlcnMoJGNWYWwtPmdldFBsYWluVGV4dCgpLCAnVVRGLTgnKTsKICAgICAgICAgICAgICAgICRzdHJfcG9zID0gMDsKICAgICAgICAgICAgICAgICRlbGVtZW50cyA9ICRjVmFsLT5nZXRSaWNoVGV4dEVsZW1lbnRzKCk7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkZWxlbWVudHMgYXMgJGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBGT05UIEluZGV4CiAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVtZW50IGluc3RhbmNlb2YgUEhQRXhjZWxfUmljaFRleHRfUnVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdHJfZm9udGlkeCA9ICR0aGlzLT5mb250SGFzaEluZGV4WyRlbGVtZW50LT5nZXRGb250KCktPmdldEhhc2hDb2RlKCldOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdHJfZm9udGlkeCA9IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRhcnJjUnVuW10gPSBhcnJheSgnc3RybGVuJyA9PiAkc3RyX3BvcywgJ2ZvbnRpZHgnID0+ICRzdHJfZm9udGlkeCk7CiAgICAgICAgICAgICAgICAgICAgLy8gUG9zaXRpb24gRlJPTQogICAgICAgICAgICAgICAgICAgICRzdHJfcG9zICs9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkNvdW50Q2hhcmFjdGVycygkZWxlbWVudC0+Z2V0VGV4dCgpLCAnVVRGLTgnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZVJpY2hUZXh0U3RyaW5nKCRyb3csICRjb2x1bW4sICRjVmFsLT5nZXRQbGFpblRleHQoKSwgJHhmSW5kZXgsICRhcnJjUnVuKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoJGNlbGwtPmdldERhdGF0eXBlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfU1RSSU5HOgogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVHlwZTo6VFlQRV9OVUxMOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNWYWwgPT09ICcnIHx8ICRjVmFsID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVCbGFuaygkcm93LCAkY29sdW1uLCAkeGZJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVTdHJpbmcoJHJvdywgJGNvbHVtbiwgJGNWYWwsICR4ZkluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTUVSSUM6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZU51bWJlcigkcm93LCAkY29sdW1uLCAkY1ZhbCwgJHhmSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX0ZPUk1VTEE6CiAgICAgICAgICAgICAgICAgICAgICAgICRjYWxjdWxhdGVkVmFsdWUgPSAkdGhpcy0+X3ByZUNhbGN1bGF0ZUZvcm11bGFzID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsLT5nZXRDYWxjdWxhdGVkVmFsdWUoKSA6IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZUZvcm11bGEoJHJvdywgJGNvbHVtbiwgJGNWYWwsICR4ZkluZGV4LCAkY2FsY3VsYXRlZFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVHlwZTo6VFlQRV9CT09MOgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVCb29sRXJyKCRyb3csICRjb2x1bW4sICRjVmFsLCAwLCAkeGZJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfRVJST1I6CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT53cml0ZUJvb2xFcnIoJHJvdywgJGNvbHVtbiwgc2VsZjo6bWFwRXJyb3JDb2RlKCRjVmFsKSwgMSwgJHhmSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEFwcGVuZAogICAgICAgICR0aGlzLT53cml0ZU1zb0RyYXdpbmcoKTsKCiAgICAgICAgLy8gV3JpdGUgV0lORE9XMiByZWNvcmQKICAgICAgICAkdGhpcy0+d3JpdGVXaW5kb3cyKCk7CgogICAgICAgIC8vIFdyaXRlIFBMViByZWNvcmQKICAgICAgICAkdGhpcy0+d3JpdGVQYWdlTGF5b3V0VmlldygpOwoKICAgICAgICAvLyBXcml0ZSBaT09NIHJlY29yZAogICAgICAgICR0aGlzLT53cml0ZVpvb20oKTsKICAgICAgICBpZiAoJHBocFNoZWV0LT5nZXRGcmVlemVQYW5lKCkpIHsKICAgICAgICAgICAgJHRoaXMtPndyaXRlUGFuZXMoKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIFNFTEVDVElPTiByZWNvcmQKICAgICAgICAkdGhpcy0+d3JpdGVTZWxlY3Rpb24oKTsKCiAgICAgICAgLy8gV3JpdGUgTWVyZ2VkQ2VsbHNUYWJsZSBSZWNvcmQKICAgICAgICAkdGhpcy0+d3JpdGVNZXJnZWRDZWxscygpOwoKICAgICAgICAvLyBIeXBlcmxpbmtzCiAgICAgICAgZm9yZWFjaCAoJHBocFNoZWV0LT5nZXRIeXBlckxpbmtDb2xsZWN0aW9uKCkgYXMgJGNvb3JkaW5hdGUgPT4gJGh5cGVybGluaykgewogICAgICAgICAgICBsaXN0KCRjb2x1bW4sICRyb3cpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJGNvb3JkaW5hdGUpOwoKICAgICAgICAgICAgJHVybCA9ICRoeXBlcmxpbmstPmdldFVybCgpOwoKICAgICAgICAgICAgaWYgKHN0cnBvcygkdXJsLCAnc2hlZXQ6Ly8nKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIC8vIGludGVybmFsIHRvIGN1cnJlbnQgd29ya2Jvb2sKICAgICAgICAgICAgICAgICR1cmwgPSBzdHJfcmVwbGFjZSgnc2hlZXQ6Ly8nLCAnaW50ZXJuYWw6JywgJHVybCk7CgogICAgICAgICAgICB9IGVsc2VpZiAocHJlZ19tYXRjaCgnL14oaHR0cDp8aHR0cHM6fGZ0cDp8bWFpbHRvOikvJywgJHVybCkpIHsKICAgICAgICAgICAgICAgIC8vIFVSTAogICAgICAgICAgICAgICAgLy8gJHVybCA9ICR1cmw7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gZXh0ZXJuYWwgKGxvY2FsIGZpbGUpCiAgICAgICAgICAgICAgICAkdXJsID0gJ2V4dGVybmFsOicgLiAkdXJsOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGhpcy0+d3JpdGVVcmwoJHJvdyAtIDEsIFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkY29sdW1uKSAtIDEsICR1cmwpOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPndyaXRlRGF0YVZhbGlkaXR5KCk7CiAgICAgICAgJHRoaXMtPndyaXRlU2hlZXRMYXlvdXQoKTsKCiAgICAgICAgLy8gV3JpdGUgU0hFRVRQUk9URUNUSU9OIHJlY29yZAogICAgICAgICR0aGlzLT53cml0ZVNoZWV0UHJvdGVjdGlvbigpOwogICAgICAgICR0aGlzLT53cml0ZVJhbmdlUHJvdGVjdGlvbigpOwoKICAgICAgICAkYXJyQ29uZGl0aW9uYWxTdHlsZXMgPSAkcGhwU2hlZXQtPmdldENvbmRpdGlvbmFsU3R5bGVzQ29sbGVjdGlvbigpOwogICAgICAgIGlmICghZW1wdHkoJGFyckNvbmRpdGlvbmFsU3R5bGVzKSkgewogICAgICAgICAgICAkYXJyQ29uZGl0aW9uYWwgPSBhcnJheSgpOwogICAgICAgICAgICAvLyBAdG9kbyBDRlJ1bGUgJiBDRkhlYWRlcgogICAgICAgICAgICAvLyBXcml0ZSBDRkhFQURFUiByZWNvcmQKICAgICAgICAgICAgJHRoaXMtPndyaXRlQ0ZIZWFkZXIoKTsKICAgICAgICAgICAgLy8gV3JpdGUgQ29uZGl0aW9uYWxGb3JtYXR0aW5nVGFibGUgcmVjb3JkcwogICAgICAgICAgICBmb3JlYWNoICgkYXJyQ29uZGl0aW9uYWxTdHlsZXMgYXMgJGNlbGxDb29yZGluYXRlID0+ICRjb25kaXRpb25hbFN0eWxlcykgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGNvbmRpdGlvbmFsU3R5bGVzIGFzICRjb25kaXRpb25hbCkgewogICAgICAgICAgICAgICAgICAgIGlmICgkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvblR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0VYUFJFU1NJT04KICAgICAgICAgICAgICAgICAgICAgICAgfHwgJGNvbmRpdGlvbmFsLT5nZXRDb25kaXRpb25UeXBlKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6OkNPTkRJVElPTl9DRUxMSVMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbl9hcnJheSgkY29uZGl0aW9uYWwtPmdldEhhc2hDb2RlKCksICRhcnJDb25kaXRpb25hbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcnJDb25kaXRpb25hbFtdID0gJGNvbmRpdGlvbmFsLT5nZXRIYXNoQ29kZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV3JpdGUgQ0ZSVUxFIHJlY29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPndyaXRlQ0ZSdWxlKCRjb25kaXRpb25hbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICR0aGlzLT5zdG9yZUVvZigpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgYSBjZWxsIHJhbmdlIGFkZHJlc3MgaW4gQklGRjgKICAgICAqIGFsd2F5cyBmaXhlZCByYW5nZQogICAgICogU2VlIHNlY3Rpb24gMi41LjE0IGluIE9wZW5PZmZpY2Uub3JnJ3MgRG9jdW1lbnRhdGlvbiBvZiB0aGUgTWljcm9zb2Z0IEV4Y2VsIEZpbGUgRm9ybWF0CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcmFuZ2UgRS5nLiAnQTEnIG9yICdBMTpCNicKICAgICAqIEByZXR1cm4gc3RyaW5nIEJpbmFyeSBkYXRhCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVCSUZGOENlbGxSYW5nZUFkZHJlc3NGaXhlZCgkcmFuZ2UgPSAnQTEnKQogICAgewogICAgICAgICRleHBsb2RlcyA9IGV4cGxvZGUoJzonLCAkcmFuZ2UpOwoKICAgICAgICAvLyBleHRyYWN0IGZpcnN0IGNlbGwsIGUuZy4gJ0ExJwogICAgICAgICRmaXJzdENlbGwgPSAkZXhwbG9kZXNbMF07CgogICAgICAgIC8vIGV4dHJhY3QgbGFzdCBjZWxsLCBlLmcuICdCNicKICAgICAgICBpZiAoY291bnQoJGV4cGxvZGVzKSA9PSAxKSB7CiAgICAgICAgICAgICRsYXN0Q2VsbCA9ICRmaXJzdENlbGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGxhc3RDZWxsID0gJGV4cGxvZGVzWzFdOwogICAgICAgIH0KCiAgICAgICAgJGZpcnN0Q2VsbENvb3JkaW5hdGVzID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJGZpcnN0Q2VsbCk7IC8vIGUuZy4gYXJyYXkoMCwgMSkKICAgICAgICAkbGFzdENlbGxDb29yZGluYXRlcyAgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkbGFzdENlbGwpOyAgLy8gZS5nLiBhcnJheSgxLCA2KQoKICAgICAgICByZXR1cm4gcGFjaygndnZ2dicsICRmaXJzdENlbGxDb29yZGluYXRlc1sxXSAtIDEsICRsYXN0Q2VsbENvb3JkaW5hdGVzWzFdIC0gMSwgUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRmaXJzdENlbGxDb29yZGluYXRlc1swXSkgLSAxLCBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGxhc3RDZWxsQ29vcmRpbmF0ZXNbMF0pIC0gMSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXRyaWV2ZXMgZGF0YSBmcm9tIG1lbW9yeSBpbiBvbmUgY2h1bmssIG9yIGZyb20gZGlzayBpbiAkYnVmZmVyCiAgICAgKiBzaXplZCBjaHVua3MuCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGRhdGEKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldERhdGEoKQogICAgewogICAgICAgICRidWZmZXIgPSA0MDk2OwoKICAgICAgICAvLyBSZXR1cm4gZGF0YSBzdG9yZWQgaW4gbWVtb3J5CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fZGF0YSkpIHsKICAgICAgICAgICAgJHRtcCAgID0gJHRoaXMtPl9kYXRhOwogICAgICAgICAgICB1bnNldCgkdGhpcy0+X2RhdGEpOwogICAgICAgICAgICByZXR1cm4gJHRtcDsKICAgICAgICB9CiAgICAgICAgLy8gTm8gZGF0YSB0byByZXR1cm4KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIG9wdGlvbiB0byBwcmludCB0aGUgcm93IGFuZCBjb2x1bW4gaGVhZGVycyBvbiB0aGUgcHJpbnRlZCBwYWdlLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkcHJpbnQgV2hldGhlciB0byBwcmludCB0aGUgaGVhZGVycyBvciBub3QuIERlZmF1bHRzIHRvIDEgKHByaW50KS4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHByaW50Um93Q29sSGVhZGVycygkcHJpbnQgPSAxKQogICAgewogICAgICAgICR0aGlzLT5fcHJpbnRfaGVhZGVycyA9ICRwcmludDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIHNldHMgdGhlIHByb3BlcnRpZXMgZm9yIG91dGxpbmluZyBhbmQgZ3JvdXBpbmcuIFRoZSBkZWZhdWx0cwogICAgICogY29ycmVzcG9uZCB0byBFeGNlbCdzIGRlZmF1bHRzLgogICAgICoKICAgICAqIEBwYXJhbSBib29sICR2aXNpYmxlCiAgICAgKiBAcGFyYW0gYm9vbCAkc3ltYm9sc19iZWxvdwogICAgICogQHBhcmFtIGJvb2wgJHN5bWJvbHNfcmlnaHQKICAgICAqIEBwYXJhbSBib29sICRhdXRvX3N0eWxlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRPdXRsaW5lKCR2aXNpYmxlID0gdHJ1ZSwgJHN5bWJvbHNfYmVsb3cgPSB0cnVlLCAkc3ltYm9sc19yaWdodCA9IHRydWUsICRhdXRvX3N0eWxlID0gZmFsc2UpCiAgICB7CiAgICAgICAgJHRoaXMtPm91dGxpbmVPbiAgICA9ICR2aXNpYmxlOwogICAgICAgICR0aGlzLT5vdXRsaW5lQmVsb3cgPSAkc3ltYm9sc19iZWxvdzsKICAgICAgICAkdGhpcy0+b3V0bGluZVJpZ2h0ID0gJHN5bWJvbHNfcmlnaHQ7CiAgICAgICAgJHRoaXMtPm91dGxpbmVTdHlsZSA9ICRhdXRvX3N0eWxlOwoKICAgICAgICAvLyBFbnN1cmUgdGhpcyBpcyBhIGJvb2xlYW4gdmFsZSBmb3IgV2luZG93MgogICAgICAgIGlmICgkdGhpcy0+b3V0bGluZU9uKSB7CiAgICAgICAgICAgICR0aGlzLT5vdXRsaW5lT24gPSAxOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIGEgZG91YmxlIHRvIHRoZSBzcGVjaWZpZWQgcm93IGFuZCBjb2x1bW4gKHplcm8gaW5kZXhlZCkuCiAgICAgKiBBbiBpbnRlZ2VyIGNhbiBiZSB3cml0dGVuIGFzIGEgZG91YmxlLiBFeGNlbCB3aWxsIGRpc3BsYXkgYW4KICAgICAqIGludGVnZXIuICRmb3JtYXQgaXMgb3B0aW9uYWwuCiAgICAgKgogICAgICogUmV0dXJucyAgMCA6IG5vcm1hbCB0ZXJtaW5hdGlvbgogICAgICogICAgICAgICAtMiA6IHJvdyBvciBjb2x1bW4gb3V0IG9mIHJhbmdlCiAgICAgKgogICAgICogQHBhcmFtIGludGVnZXIgJHJvdyAgICBaZXJvIGluZGV4ZWQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sICAgIFplcm8gaW5kZXhlZCBjb2x1bW4KICAgICAqIEBwYXJhbSBmbG9hdCAgICRudW0gICAgVGhlIG51bWJlciB0byB3cml0ZQogICAgICogQHBhcmFtIG1peGVkICAgJHhmSW5kZXggVGhlIG9wdGlvbmFsIFhGIGZvcm1hdAogICAgICogQHJldHVybiBpbnRlZ2VyCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVOdW1iZXIoJHJvdywgJGNvbCwgJG51bSwgJHhmSW5kZXgpCiAgICB7CiAgICAgICAgJHJlY29yZCAgICA9IDB4MDIwMzsgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICA9IDB4MDAwRTsgICAgICAgICAgICAgICAgIC8vIE51bWJlciBvZiBieXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGhlYWRlciAgICAgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgICA9IHBhY2soInZ2diIsICRyb3csICRjb2wsICR4ZkluZGV4KTsKICAgICAgICAkeGxfZG91YmxlICAgID0gcGFjaygiZCIsICRudW0pOwogICAgICAgIGlmIChzZWxmOjpnZXRCeXRlT3JkZXIoKSkgeyAvLyBpZiBpdCdzIEJpZyBFbmRpYW4KICAgICAgICAgICAgJHhsX2RvdWJsZSA9IHN0cnJldigkeGxfZG91YmxlKTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlci4kZGF0YS4keGxfZG91YmxlKTsKICAgICAgICByZXR1cm4oMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBhIExBQkVMU1NUIHJlY29yZCBvciBhIExBQkVMIHJlY29yZC4gV2hpY2ggb25lIGRlcGVuZHMgb24gQklGRiB2ZXJzaW9uCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcm93IFJvdyBpbmRleCAoMC1iYXNlZCkKICAgICAqIEBwYXJhbSBpbnQgJGNvbCBDb2x1bW4gaW5kZXggKDAtYmFzZWQpCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgVGhlIHN0cmluZwogICAgICogQHBhcmFtIGludCAkeGZJbmRleCBJbmRleCB0byBYRiByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVN0cmluZygkcm93LCAkY29sLCAkc3RyLCAkeGZJbmRleCkKICAgIHsKICAgICAgICAkdGhpcy0+d3JpdGVMYWJlbFNzdCgkcm93LCAkY29sLCAkc3RyLCAkeGZJbmRleCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBhIExBQkVMU1NUIHJlY29yZCBvciBhIExBQkVMIHJlY29yZC4gV2hpY2ggb25lIGRlcGVuZHMgb24gQklGRiB2ZXJzaW9uCiAgICAgKiBJdCBkaWZmZXJzIGZyb20gd3JpdGVTdHJpbmcgYnkgdGhlIHdyaXRpbmcgb2YgcmljaCB0ZXh0IHN0cmluZ3MuCiAgICAgKiBAcGFyYW0gaW50ICRyb3cgUm93IGluZGV4ICgwLWJhc2VkKQogICAgICogQHBhcmFtIGludCAkY29sIENvbHVtbiBpbmRleCAoMC1iYXNlZCkKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciBUaGUgc3RyaW5nCiAgICAgKiBAcGFyYW0gbWl4ZWQgICAkeGZJbmRleCBUaGUgWEYgZm9ybWF0IGluZGV4IGZvciB0aGUgY2VsbAogICAgICogQHBhcmFtIGFycmF5ICRhcnJjUnVuIEluZGV4IHRvIEZvbnQgcmVjb3JkIGFuZCBjaGFyYWN0ZXJzIGJlZ2lubmluZwogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlUmljaFRleHRTdHJpbmcoJHJvdywgJGNvbCwgJHN0ciwgJHhmSW5kZXgsICRhcnJjUnVuKQogICAgewogICAgICAgICRyZWNvcmQgICAgPSAweDAwRkQ7ICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICA9IDB4MDAwQTsgICAgICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CiAgICAgICAgJHN0ciA9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OlVURjh0b0JJRkY4VW5pY29kZVNob3J0KCRzdHIsICRhcnJjUnVuKTsKCiAgICAgICAgLyogY2hlY2sgaWYgc3RyaW5nIGlzIGFscmVhZHkgcHJlc2VudCAqLwogICAgICAgIGlmICghaXNzZXQoJHRoaXMtPnN0cmluZ1RhYmxlWyRzdHJdKSkgewogICAgICAgICAgICAkdGhpcy0+c3RyaW5nVGFibGVbJHN0cl0gPSAkdGhpcy0+c3RyaW5nVW5pcXVlKys7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5zdHJpbmdUb3RhbCsrOwoKICAgICAgICAkaGVhZGVyICAgID0gcGFjaygndnYnLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICA9IHBhY2soJ3Z2dlYnLCAkcm93LCAkY29sLCAkeGZJbmRleCwgJHRoaXMtPnN0cmluZ1RhYmxlWyRzdHJdKTsKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIuJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgYSBzdHJpbmcgdG8gdGhlIHNwZWNpZmllZCByb3cgYW5kIGNvbHVtbiAoemVybyBpbmRleGVkKS4KICAgICAqIE5PVEU6IHRoZXJlIGlzIGFuIEV4Y2VsIDUgZGVmaW5lZCBsaW1pdCBvZiAyNTUgY2hhcmFjdGVycy4KICAgICAqICRmb3JtYXQgaXMgb3B0aW9uYWwuCiAgICAgKiBSZXR1cm5zICAwIDogbm9ybWFsIHRlcm1pbmF0aW9uCiAgICAgKiAgICAgICAgIC0yIDogcm93IG9yIGNvbHVtbiBvdXQgb2YgcmFuZ2UKICAgICAqICAgICAgICAgLTMgOiBsb25nIHN0cmluZyB0cnVuY2F0ZWQgdG8gMjU1IGNoYXJzCiAgICAgKgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyb3cgICAgWmVybyBpbmRleGVkIHJvdwogICAgICogQHBhcmFtIGludGVnZXIgJGNvbCAgICBaZXJvIGluZGV4ZWQgY29sdW1uCiAgICAgKiBAcGFyYW0gc3RyaW5nICAkc3RyICAgIFRoZSBzdHJpbmcgdG8gd3JpdGUKICAgICAqIEBwYXJhbSBtaXhlZCAgICR4ZkluZGV4IFRoZSBYRiBmb3JtYXQgaW5kZXggZm9yIHRoZSBjZWxsCiAgICAgKiBAcmV0dXJuIGludGVnZXIKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZUxhYmVsKCRyb3csICRjb2wsICRzdHIsICR4ZkluZGV4KQogICAgewogICAgICAgICRzdHJsZW4gICAgPSBzdHJsZW4oJHN0cik7CiAgICAgICAgJHJlY29yZCAgICA9IDB4MDIwNDsgICAgICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICAgID0gMHgwMDA4ICsgJHN0cmxlbjsgICAgICAgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJHN0cl9lcnJvciA9IDA7CgogICAgICAgIGlmICgkc3RybGVuID4gJHRoaXMtPnhsc1N0cmluZ01heExlbmd0aCkgeyAvLyBMQUJFTCBtdXN0IGJlIDwgMjU1IGNoYXJzCiAgICAgICAgICAgICRzdHIgICAgPSBzdWJzdHIoJHN0ciwgMCwgJHRoaXMtPnhsc1N0cmluZ01heExlbmd0aCk7CiAgICAgICAgICAgICRsZW5ndGggICAgPSAweDAwMDggKyAkdGhpcy0+eGxzU3RyaW5nTWF4TGVuZ3RoOwogICAgICAgICAgICAkc3RybGVuICAgID0gJHRoaXMtPnhsc1N0cmluZ01heExlbmd0aDsKICAgICAgICAgICAgJHN0cl9lcnJvciA9IC0zOwogICAgICAgIH0KCiAgICAgICAgJGhlYWRlciAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgPSBwYWNrKCJ2dnZ2IiwgJHJvdywgJGNvbCwgJHhmSW5kZXgsICRzdHJsZW4pOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhIC4gJHN0cik7CiAgICAgICAgcmV0dXJuKCRzdHJfZXJyb3IpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgYSBzdHJpbmcgdG8gdGhlIHNwZWNpZmllZCByb3cgYW5kIGNvbHVtbiAoemVybyBpbmRleGVkKS4KICAgICAqIFRoaXMgaXMgdGhlIEJJRkY4IHZlcnNpb24gKG5vIDI1NSBjaGFycyBsaW1pdCkuCiAgICAgKiAkZm9ybWF0IGlzIG9wdGlvbmFsLgogICAgICogUmV0dXJucyAgMCA6IG5vcm1hbCB0ZXJtaW5hdGlvbgogICAgICogICAgICAgICAtMiA6IHJvdyBvciBjb2x1bW4gb3V0IG9mIHJhbmdlCiAgICAgKiAgICAgICAgIC0zIDogbG9uZyBzdHJpbmcgdHJ1bmNhdGVkIHRvIDI1NSBjaGFycwogICAgICoKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkcm93ICAgIFplcm8gaW5kZXhlZCByb3cKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRjb2wgICAgWmVybyBpbmRleGVkIGNvbHVtbgogICAgICogQHBhcmFtIHN0cmluZyAgJHN0ciAgICBUaGUgc3RyaW5nIHRvIHdyaXRlCiAgICAgKiBAcGFyYW0gbWl4ZWQgICAkeGZJbmRleCBUaGUgWEYgZm9ybWF0IGluZGV4IGZvciB0aGUgY2VsbAogICAgICogQHJldHVybiBpbnRlZ2VyCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVMYWJlbFNzdCgkcm93LCAkY29sLCAkc3RyLCAkeGZJbmRleCkKICAgIHsKICAgICAgICAkcmVjb3JkICAgID0gMHgwMEZEOyAgICAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgPSAweDAwMEE7ICAgICAgICAgICAgICAgICAgIC8vIEJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAkc3RyID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6VVRGOHRvQklGRjhVbmljb2RlTG9uZygkc3RyKTsKCiAgICAgICAgLyogY2hlY2sgaWYgc3RyaW5nIGlzIGFscmVhZHkgcHJlc2VudCAqLwogICAgICAgIGlmICghaXNzZXQoJHRoaXMtPnN0cmluZ1RhYmxlWyRzdHJdKSkgewogICAgICAgICAgICAkdGhpcy0+c3RyaW5nVGFibGVbJHN0cl0gPSAkdGhpcy0+c3RyaW5nVW5pcXVlKys7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5zdHJpbmdUb3RhbCsrOwoKICAgICAgICAkaGVhZGVyICAgID0gcGFjaygndnYnLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICA9IHBhY2soJ3Z2dlYnLCAkcm93LCAkY29sLCAkeGZJbmRleCwgJHRoaXMtPnN0cmluZ1RhYmxlWyRzdHJdKTsKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIuJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGVzIGEgbm90ZSBhc3NvY2lhdGVkIHdpdGggdGhlIGNlbGwgZ2l2ZW4gYnkgdGhlIHJvdyBhbmQgY29sdW1uLgogICAgICogTk9URSByZWNvcmRzIGRvbid0IGhhdmUgYSBsZW5ndGggbGltaXQuCiAgICAgKgogICAgICogQHBhcmFtIGludGVnZXIgJHJvdyAgICBaZXJvIGluZGV4ZWQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sICAgIFplcm8gaW5kZXhlZCBjb2x1bW4KICAgICAqIEBwYXJhbSBzdHJpbmcgICRub3RlICAgVGhlIG5vdGUgdG8gd3JpdGUKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZU5vdGUoJHJvdywgJGNvbCwgJG5vdGUpCiAgICB7CiAgICAgICAgJG5vdGVfbGVuZ3RoICAgID0gc3RybGVuKCRub3RlKTsKICAgICAgICAkcmVjb3JkICAgICAgICAgICAgPSAweDAwMUM7ICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbWF4X2xlbmd0aCAgICAgICAgPSAyMDQ4OyAgICAgICAgICAgICAgICAvLyBNYXhpbXVuIGxlbmd0aCBmb3IgYSBOT1RFIHJlY29yZAoKICAgICAgICAvLyBMZW5ndGggZm9yIHRoaXMgcmVjb3JkIGlzIG5vIG1vcmUgdGhhbiAyMDQ4ICsgNgogICAgICAgICRsZW5ndGggICAgPSAweDAwMDYgKyBtaW4oJG5vdGVfbGVuZ3RoLCAyMDQ4KTsKICAgICAgICAkaGVhZGVyICAgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICA9IHBhY2soInZ2diIsICRyb3csICRjb2wsICRub3RlX2xlbmd0aCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEgLiBzdWJzdHIoJG5vdGUsIDAsIDIwNDgpKTsKCiAgICAgICAgZm9yICgkaSA9ICRtYXhfbGVuZ3RoOyAkaSA8ICRub3RlX2xlbmd0aDsgJGkgKz0gJG1heF9sZW5ndGgpIHsKICAgICAgICAgICAgJGNodW5rICA9IHN1YnN0cigkbm90ZSwgJGksICRtYXhfbGVuZ3RoKTsKICAgICAgICAgICAgJGxlbmd0aCA9IDB4MDAwNiArIHN0cmxlbigkY2h1bmspOwogICAgICAgICAgICAkaGVhZGVyID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAgICAgJGRhdGEgICA9IHBhY2soInZ2diIsIC0xLCAwLCBzdHJsZW4oJGNodW5rKSk7CiAgICAgICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlci4kZGF0YS4kY2h1bmspOwogICAgICAgIH0KICAgICAgICByZXR1cm4oMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBhIGJsYW5rIGNlbGwgdG8gdGhlIHNwZWNpZmllZCByb3cgYW5kIGNvbHVtbiAoemVybyBpbmRleGVkKS4KICAgICAqIEEgYmxhbmsgY2VsbCBpcyB1c2VkIHRvIHNwZWNpZnkgZm9ybWF0dGluZyB3aXRob3V0IGFkZGluZyBhIHN0cmluZwogICAgICogb3IgYSBudW1iZXIuCiAgICAgKgogICAgICogQSBibGFuayBjZWxsIHdpdGhvdXQgYSBmb3JtYXQgc2VydmVzIG5vIHB1cnBvc2UuIFRoZXJlZm9yZSwgd2UgZG9uJ3Qgd3JpdGUKICAgICAqIGEgQkxBTksgcmVjb3JkIHVubGVzcyBhIGZvcm1hdCBpcyBzcGVjaWZpZWQuCiAgICAgKgogICAgICogUmV0dXJucyAgMCA6IG5vcm1hbCB0ZXJtaW5hdGlvbiAoaW5jbHVkaW5nIG5vIGZvcm1hdCkKICAgICAqICAgICAgICAgLTEgOiBpbnN1ZmZpY2llbnQgbnVtYmVyIG9mIGFyZ3VtZW50cwogICAgICogICAgICAgICAtMiA6IHJvdyBvciBjb2x1bW4gb3V0IG9mIHJhbmdlCiAgICAgKgogICAgICogQHBhcmFtIGludGVnZXIgJHJvdyAgICBaZXJvIGluZGV4ZWQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sICAgIFplcm8gaW5kZXhlZCBjb2x1bW4KICAgICAqIEBwYXJhbSBtaXhlZCAgICR4ZkluZGV4IFRoZSBYRiBmb3JtYXQgaW5kZXgKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHdyaXRlQmxhbmsoJHJvdywgJGNvbCwgJHhmSW5kZXgpCiAgICB7CiAgICAgICAgJHJlY29yZCAgICA9IDB4MDIwMTsgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICA9IDB4MDAwNjsgICAgICAgICAgICAgICAgIC8vIE51bWJlciBvZiBieXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGhlYWRlciAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICA9IHBhY2soInZ2diIsICRyb3csICRjb2wsICR4ZkluZGV4KTsKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkZGF0YSk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBhIGJvb2xlYW4gb3IgYW4gZXJyb3IgdHlwZSB0byB0aGUgc3BlY2lmaWVkIHJvdyBhbmQgY29sdW1uICh6ZXJvIGluZGV4ZWQpCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcm93IFJvdyBpbmRleCAoMC1iYXNlZCkKICAgICAqIEBwYXJhbSBpbnQgJGNvbCBDb2x1bW4gaW5kZXggKDAtYmFzZWQpCiAgICAgKiBAcGFyYW0gaW50ICR2YWx1ZQogICAgICogQHBhcmFtIGJvb2xlYW4gJGlzRXJyb3IgRXJyb3Igb3IgQm9vbGVhbj8KICAgICAqIEBwYXJhbSBpbnQgJHhmSW5kZXgKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZUJvb2xFcnIoJHJvdywgJGNvbCwgJHZhbHVlLCAkaXNFcnJvciwgJHhmSW5kZXgpCiAgICB7CiAgICAgICAgJHJlY29yZCA9IDB4MDIwNTsKICAgICAgICAkbGVuZ3RoID0gODsKCiAgICAgICAgJGhlYWRlciAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICA9IHBhY2soInZ2dkNDIiwgJHJvdywgJGNvbCwgJHhmSW5kZXgsICR2YWx1ZSwgJGlzRXJyb3IpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIGEgZm9ybXVsYSB0byB0aGUgc3BlY2lmaWVkIHJvdyBhbmQgY29sdW1uICh6ZXJvIGluZGV4ZWQpLgogICAgICogVGhlIHRleHR1YWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZvcm11bGEgaXMgcGFzc2VkIHRvIHRoZSBwYXJzZXIgaW4KICAgICAqIFBhcnNlci5waHAgd2hpY2ggcmV0dXJucyBhIHBhY2tlZCBiaW5hcnkgc3RyaW5nLgogICAgICoKICAgICAqIFJldHVybnMgIDAgOiBub3JtYWwgdGVybWluYXRpb24KICAgICAqICAgICAgICAgLTEgOiBmb3JtdWxhIGVycm9ycyAoYmFkIGZvcm11bGEpCiAgICAgKiAgICAgICAgIC0yIDogcm93IG9yIGNvbHVtbiBvdXQgb2YgcmFuZ2UKICAgICAqCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkcm93ICAgICBaZXJvIGluZGV4ZWQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sICAgICBaZXJvIGluZGV4ZWQgY29sdW1uCiAgICAgKiBAcGFyYW0gc3RyaW5nICAkZm9ybXVsYSBUaGUgZm9ybXVsYSB0ZXh0IHN0cmluZwogICAgICogQHBhcmFtIG1peGVkICAgJHhmSW5kZXggIFRoZSBYRiBmb3JtYXQgaW5kZXgKICAgICAqIEBwYXJhbSBtaXhlZCAgICRjYWxjdWxhdGVkVmFsdWUgIENhbGN1bGF0ZWQgdmFsdWUKICAgICAqIEByZXR1cm4gaW50ZWdlcgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlRm9ybXVsYSgkcm93LCAkY29sLCAkZm9ybXVsYSwgJHhmSW5kZXgsICRjYWxjdWxhdGVkVmFsdWUpCiAgICB7CiAgICAgICAgJHJlY29yZCAgICA9IDB4MDAwNjsgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCgogICAgICAgIC8vIEluaXRpYWxpemUgcG9zc2libGUgYWRkaXRpb25hbCB2YWx1ZSBmb3IgU1RSSU5HIHJlY29yZCB0aGF0IHNob3VsZCBiZSB3cml0dGVuIGFmdGVyIHRoZSBGT1JNVUxBIHJlY29yZD8KICAgICAgICAkc3RyaW5nVmFsdWUgPSBudWxsOwoKICAgICAgICAvLyBjYWxjdWxhdGVkIHZhbHVlCiAgICAgICAgaWYgKGlzc2V0KCRjYWxjdWxhdGVkVmFsdWUpKSB7CiAgICAgICAgICAgIC8vIFNpbmNlIHdlIGNhbid0IHlldCBnZXQgdGhlIGRhdGEgdHlwZSBvZiB0aGUgY2FsY3VsYXRlZCB2YWx1ZSwKICAgICAgICAgICAgLy8gd2UgdXNlIGJlc3QgZWZmb3J0IHRvIGRldGVybWluZSBkYXRhIHR5cGUKICAgICAgICAgICAgaWYgKGlzX2Jvb2woJGNhbGN1bGF0ZWRWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIC8vIEJvb2xlYW4gdmFsdWUKICAgICAgICAgICAgICAgICRudW0gPSBwYWNrKCdDQ0N2Q3YnLCAweDAxLCAweDAwLCAoaW50KSRjYWxjdWxhdGVkVmFsdWUsIDB4MDAsIDB4MDAsIDB4RkZGRik7CiAgICAgICAgICAgIH0gZWxzZWlmIChpc19pbnQoJGNhbGN1bGF0ZWRWYWx1ZSkgfHwgaXNfZmxvYXQoJGNhbGN1bGF0ZWRWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIC8vIE51bWVyaWMgdmFsdWUKICAgICAgICAgICAgICAgICRudW0gPSBwYWNrKCdkJywgJGNhbGN1bGF0ZWRWYWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZWlmIChpc19zdHJpbmcoJGNhbGN1bGF0ZWRWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKCRjYWxjdWxhdGVkVmFsdWUsIFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OmdldEVycm9yQ29kZXMoKSkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFcnJvciB2YWx1ZQogICAgICAgICAgICAgICAgICAgICRudW0gPSBwYWNrKCdDQ0N2Q3YnLCAweDAyLCAweDAwLCBzZWxmOjptYXBFcnJvckNvZGUoJGNhbGN1bGF0ZWRWYWx1ZSksIDB4MDAsIDB4MDAsIDB4RkZGRik7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGNhbGN1bGF0ZWRWYWx1ZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFbXB0eSBzdHJpbmcgKGFuZCBCSUZGOCkKICAgICAgICAgICAgICAgICAgICAkbnVtID0gcGFjaygnQ0NDdkN2JywgMHgwMywgMHgwMCwgMHgwMCwgMHgwMCwgMHgwMCwgMHhGRkZGKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTm9uLWVtcHR5IHN0cmluZyB2YWx1ZSAob3IgZW1wdHkgc3RyaW5nIEJJRkY1KQogICAgICAgICAgICAgICAgICAgICRzdHJpbmdWYWx1ZSA9ICRjYWxjdWxhdGVkVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgJG51bSA9IHBhY2soJ0NDQ3ZDdicsIDB4MDAsIDB4MDAsIDB4MDAsIDB4MDAsIDB4MDAsIDB4RkZGRik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBXZSBhcmUgcmVhbGx5IG5vdCBzdXBwb3NlZCB0byByZWFjaCBoZXJlCiAgICAgICAgICAgICAgICAkbnVtID0gcGFjaygnZCcsIDB4MDApOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJG51bSA9IHBhY2soJ2QnLCAweDAwKTsKICAgICAgICB9CgogICAgICAgICRncmJpdCAgICAgICAgPSAweDAzOyAgICAgICAgICAgICAgICAvLyBPcHRpb24gZmxhZ3MKICAgICAgICAkdW5rbm93biAgICA9IDB4MDAwMDsgICAgICAgICAgICAvLyBNdXN0IGJlIHplcm8KCiAgICAgICAgLy8gU3RyaXAgdGhlICc9JyBvciAnQCcgc2lnbiBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBmb3JtdWxhIHN0cmluZwogICAgICAgIGlmICgkZm9ybXVsYXswfSA9PSAnPScpIHsKICAgICAgICAgICAgJGZvcm11bGEgPSBzdWJzdHIoJGZvcm11bGEsIDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVycm9yIGhhbmRsaW5nCiAgICAgICAgICAgICR0aGlzLT53cml0ZVN0cmluZygkcm93LCAkY29sLCAnVW5yZWNvZ25pc2VkIGNoYXJhY3RlciBmb3IgZm9ybXVsYScpOwogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQoKICAgICAgICAvLyBQYXJzZSB0aGUgZm9ybXVsYSB1c2luZyB0aGUgcGFyc2VyIGluIFBhcnNlci5waHAKICAgICAgICB0cnkgewogICAgICAgICAgICAkZXJyb3IgPSAkdGhpcy0+cGFyc2VyLT5wYXJzZSgkZm9ybXVsYSk7CiAgICAgICAgICAgICRmb3JtdWxhID0gJHRoaXMtPnBhcnNlci0+dG9SZXZlcnNlUG9saXNoKCk7CgogICAgICAgICAgICAkZm9ybWxlbiAgICA9IHN0cmxlbigkZm9ybXVsYSk7ICAgIC8vIExlbmd0aCBvZiB0aGUgYmluYXJ5IHN0cmluZwogICAgICAgICAgICAkbGVuZ3RoICAgICA9IDB4MTYgKyAkZm9ybWxlbjsgICAgIC8vIExlbmd0aCBvZiB0aGUgcmVjb3JkIGRhdGEKCiAgICAgICAgICAgICRoZWFkZXIgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwoKICAgICAgICAgICAgJGRhdGEgICAgICA9IHBhY2soInZ2diIsICRyb3csICRjb2wsICR4ZkluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICAuICRudW0KICAgICAgICAgICAgICAgICAgICAgICAgLiBwYWNrKCJ2VnYiLCAkZ3JiaXQsICR1bmtub3duLCAkZm9ybWxlbik7CiAgICAgICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhIC4gJGZvcm11bGEpOwoKICAgICAgICAgICAgLy8gQXBwZW5kIGFsc28gYSBTVFJJTkcgcmVjb3JkIGlmIG5lY2Vzc2FyeQogICAgICAgICAgICBpZiAoJHN0cmluZ1ZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+d3JpdGVTdHJpbmdSZWNvcmQoJHN0cmluZ1ZhbHVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAgIH0gY2F0Y2ggKFBIUEV4Y2VsX0V4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAvLyBkbyBub3RoaW5nCiAgICAgICAgfQoKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIGEgU1RSSU5HIHJlY29yZC4gVGhpcwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZ1ZhbHVlCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVTdHJpbmdSZWNvcmQoJHN0cmluZ1ZhbHVlKQogICAgewogICAgICAgICRyZWNvcmQgPSAweDAyMDc7ICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRkYXRhID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6VVRGOHRvQklGRjhVbmljb2RlTG9uZygkc3RyaW5nVmFsdWUpOwoKICAgICAgICAkbGVuZ3RoID0gc3RybGVuKCRkYXRhKTsKICAgICAgICAkaGVhZGVyID0gcGFjaygndnYnLCAkcmVjb3JkLCAkbGVuZ3RoKTsKCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgYSBoeXBlcmxpbmsuCiAgICAgKiBUaGlzIGlzIGNvbXByaXNlZCBvZiB0d28gZWxlbWVudHM6IHRoZSB2aXNpYmxlIGxhYmVsIGFuZAogICAgICogdGhlIGludmlzaWJsZSBsaW5rLiBUaGUgdmlzaWJsZSBsYWJlbCBpcyB0aGUgc2FtZSBhcyB0aGUgbGluayB1bmxlc3MgYW4KICAgICAqIGFsdGVybmF0aXZlIHN0cmluZyBpcyBzcGVjaWZpZWQuIFRoZSBsYWJlbCBpcyB3cml0dGVuIHVzaW5nIHRoZQogICAgICogd3JpdGVTdHJpbmcoKSBtZXRob2QuIFRoZXJlZm9yZSB0aGUgMjU1IGNoYXJhY3RlcnMgc3RyaW5nIGxpbWl0IGFwcGxpZXMuCiAgICAgKiAkc3RyaW5nIGFuZCAkZm9ybWF0IGFyZSBvcHRpb25hbC4KICAgICAqCiAgICAgKiBUaGUgaHlwZXJsaW5rIGNhbiBiZSB0byBhIGh0dHAsIGZ0cCwgbWFpbCwgaW50ZXJuYWwgc2hlZXQgKG5vdCB5ZXQpLCBvciBleHRlcm5hbAogICAgICogZGlyZWN0b3J5IHVybC4KICAgICAqCiAgICAgKiBSZXR1cm5zICAwIDogbm9ybWFsIHRlcm1pbmF0aW9uCiAgICAgKiAgICAgICAgIC0yIDogcm93IG9yIGNvbHVtbiBvdXQgb2YgcmFuZ2UKICAgICAqICAgICAgICAgLTMgOiBsb25nIHN0cmluZyB0cnVuY2F0ZWQgdG8gMjU1IGNoYXJzCiAgICAgKgogICAgICogQHBhcmFtIGludGVnZXIgJHJvdyAgICBSb3cKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRjb2wgICAgQ29sdW1uCiAgICAgKiBAcGFyYW0gc3RyaW5nICAkdXJsICAgIFVSTCBzdHJpbmcKICAgICAqIEByZXR1cm4gaW50ZWdlcgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlVXJsKCRyb3csICRjb2wsICR1cmwpCiAgICB7CiAgICAgICAgLy8gQWRkIHN0YXJ0IHJvdyBhbmQgY29sIHRvIGFyZyBsaXN0CiAgICAgICAgcmV0dXJuKCR0aGlzLT53cml0ZVVybFJhbmdlKCRyb3csICRjb2wsICRyb3csICRjb2wsICR1cmwpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgaXMgdGhlIG1vcmUgZ2VuZXJhbCBmb3JtIG9mIHdyaXRlVXJsKCkuIEl0IGFsbG93cyBhIGh5cGVybGluayB0byBiZQogICAgICogd3JpdHRlbiB0byBhIHJhbmdlIG9mIGNlbGxzLiBUaGlzIGZ1bmN0aW9uIGFsc28gZGVjaWRlcyB0aGUgdHlwZSBvZiBoeXBlcmxpbmsKICAgICAqIHRvIGJlIHdyaXR0ZW4uIFRoZXNlIGFyZSBlaXRoZXIsIFdlYiAoaHR0cCwgZnRwLCBtYWlsdG8pLCBJbnRlcm5hbAogICAgICogKFNoZWV0MSFBMSkgb3IgZXh0ZXJuYWwgKCdjOlx0ZW1wXGZvby54bHMjU2hlZXQxIUExJykuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAc2VlIHdyaXRlVXJsKCkKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyb3cxICAgU3RhcnQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sMSAgIFN0YXJ0IGNvbHVtbgogICAgICogQHBhcmFtIGludGVnZXIgJHJvdzIgICBFbmQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sMiAgIEVuZCBjb2x1bW4KICAgICAqIEBwYXJhbSBzdHJpbmcgICR1cmwgICAgVVJMIHN0cmluZwogICAgICogQHJldHVybiBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB3cml0ZVVybFJhbmdlKCRyb3cxLCAkY29sMSwgJHJvdzIsICRjb2wyLCAkdXJsKQogICAgewogICAgICAgIC8vIENoZWNrIGZvciBpbnRlcm5hbC9leHRlcm5hbCBzaGVldCBsaW5rcyBvciBkZWZhdWx0IHRvIHdlYiBsaW5rCiAgICAgICAgaWYgKHByZWdfbWF0Y2goJ1teaW50ZXJuYWw6XScsICR1cmwpKSB7CiAgICAgICAgICAgIHJldHVybigkdGhpcy0+d3JpdGVVcmxJbnRlcm5hbCgkcm93MSwgJGNvbDEsICRyb3cyLCAkY29sMiwgJHVybCkpOwogICAgICAgIH0KICAgICAgICBpZiAocHJlZ19tYXRjaCgnW15leHRlcm5hbDpdJywgJHVybCkpIHsKICAgICAgICAgICAgcmV0dXJuKCR0aGlzLT53cml0ZVVybEV4dGVybmFsKCRyb3cxLCAkY29sMSwgJHJvdzIsICRjb2wyLCAkdXJsKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybigkdGhpcy0+d3JpdGVVcmxXZWIoJHJvdzEsICRjb2wxLCAkcm93MiwgJGNvbDIsICR1cmwpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFVzZWQgdG8gd3JpdGUgaHR0cCwgZnRwIGFuZCBtYWlsdG8gaHlwZXJsaW5rcy4KICAgICAqIFRoZSBsaW5rIHR5cGUgKCRvcHRpb25zKSBpcyAweDAzIGlzIHRoZSBzYW1lIGFzIGFic29sdXRlIGRpciByZWYgd2l0aG91dAogICAgICogc2hlZXQuIEhvd2V2ZXIgaXQgaXMgZGlmZmVyZW50aWF0ZWQgYnkgdGhlICR1bmtub3duMiBkYXRhIHN0cmVhbS4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBzZWUgd3JpdGVVcmwoKQogICAgICogQHBhcmFtIGludGVnZXIgJHJvdzEgICBTdGFydCByb3cKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRjb2wxICAgU3RhcnQgY29sdW1uCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkcm93MiAgIEVuZCByb3cKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRjb2wyICAgRW5kIGNvbHVtbgogICAgICogQHBhcmFtIHN0cmluZyAgJHVybCAgICBVUkwgc3RyaW5nCiAgICAgKiBAcmV0dXJuIGludGVnZXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHdyaXRlVXJsV2ViKCRyb3cxLCAkY29sMSwgJHJvdzIsICRjb2wyLCAkdXJsKQogICAgewogICAgICAgICRyZWNvcmQgICAgICA9IDB4MDFCODsgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICAgID0gMHgwMDAwMDsgICAgICAgICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgIC8vIFBhY2sgdGhlIHVuZG9jdW1lbnRlZCBwYXJ0cyBvZiB0aGUgaHlwZXJsaW5rIHN0cmVhbQogICAgICAgICR1bmtub3duMSAgICA9IHBhY2soIkgqIiwgIkQwQzlFQTc5RjlCQUNFMTE4QzgyMDBBQTAwNEJBOTBCMDIwMDAwMDAiKTsKICAgICAgICAkdW5rbm93bjIgICAgPSBwYWNrKCJIKiIsICJFMEM5RUE3OUY5QkFDRTExOEM4MjAwQUEwMDRCQTkwQiIpOwoKICAgICAgICAvLyBQYWNrIHRoZSBvcHRpb24gZmxhZ3MKICAgICAgICAkb3B0aW9ucyAgICAgPSBwYWNrKCJWIiwgMHgwMyk7CgogICAgICAgIC8vIENvbnZlcnQgVVJMIHRvIGEgbnVsbCB0ZXJtaW5hdGVkIHdjaGFyIHN0cmluZwogICAgICAgICR1cmwgICAgICAgICA9IGpvaW4oIlwwIiwgcHJlZ19zcGxpdCgiJyciLCAkdXJsLCAtMSwgUFJFR19TUExJVF9OT19FTVBUWSkpOwogICAgICAgICR1cmwgICAgICAgICA9ICR1cmwgLiAiXDBcMFwwIjsKCiAgICAgICAgLy8gUGFjayB0aGUgbGVuZ3RoIG9mIHRoZSBVUkwKICAgICAgICAkdXJsX2xlbiAgICAgPSBwYWNrKCJWIiwgc3RybGVuKCR1cmwpKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBkYXRhIGxlbmd0aAogICAgICAgICRsZW5ndGggICAgICA9IDB4MzQgKyBzdHJsZW4oJHVybCk7CgogICAgICAgIC8vIFBhY2sgdGhlIGhlYWRlciBkYXRhCiAgICAgICAgJGhlYWRlciAgICAgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICAgICAgPSBwYWNrKCJ2dnZ2IiwgJHJvdzEsICRyb3cyLCAkY29sMSwgJGNvbDIpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgcGFja2VkIGRhdGEKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkZGF0YSAuCiAgICAgICAgICAgICAgICAgICAgICAgJHVua25vd24xIC4gJG9wdGlvbnMgLgogICAgICAgICAgICAgICAgICAgICAgICR1bmtub3duMiAuICR1cmxfbGVuIC4gJHVybCk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBVc2VkIHRvIHdyaXRlIGludGVybmFsIHJlZmVyZW5jZSBoeXBlcmxpbmtzIHN1Y2ggYXMgIlNoZWV0MSFBMSIuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAc2VlIHdyaXRlVXJsKCkKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyb3cxICAgU3RhcnQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sMSAgIFN0YXJ0IGNvbHVtbgogICAgICogQHBhcmFtIGludGVnZXIgJHJvdzIgICBFbmQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sMiAgIEVuZCBjb2x1bW4KICAgICAqIEBwYXJhbSBzdHJpbmcgICR1cmwgICAgVVJMIHN0cmluZwogICAgICogQHJldHVybiBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB3cml0ZVVybEludGVybmFsKCRyb3cxLCAkY29sMSwgJHJvdzIsICRjb2wyLCAkdXJsKQogICAgewogICAgICAgICRyZWNvcmQgICAgICA9IDB4MDFCODsgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICAgID0gMHgwMDAwMDsgICAgICAgICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgIC8vIFN0cmlwIFVSTCB0eXBlCiAgICAgICAgJHVybCA9IHByZWdfcmVwbGFjZSgnL15pbnRlcm5hbDovJywgJycsICR1cmwpOwoKICAgICAgICAvLyBQYWNrIHRoZSB1bmRvY3VtZW50ZWQgcGFydHMgb2YgdGhlIGh5cGVybGluayBzdHJlYW0KICAgICAgICAkdW5rbm93bjEgICAgPSBwYWNrKCJIKiIsICJEMEM5RUE3OUY5QkFDRTExOEM4MjAwQUEwMDRCQTkwQjAyMDAwMDAwIik7CgogICAgICAgIC8vIFBhY2sgdGhlIG9wdGlvbiBmbGFncwogICAgICAgICRvcHRpb25zICAgICA9IHBhY2soIlYiLCAweDA4KTsKCiAgICAgICAgLy8gQ29udmVydCB0aGUgVVJMIHR5cGUgYW5kIHRvIGEgbnVsbCB0ZXJtaW5hdGVkIHdjaGFyIHN0cmluZwogICAgICAgICR1cmwgLj0gIlwwIjsKCiAgICAgICAgLy8gY2hhcmFjdGVyIGNvdW50CiAgICAgICAgJHVybF9sZW4gPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb3VudENoYXJhY3RlcnMoJHVybCk7CiAgICAgICAgJHVybF9sZW4gPSBwYWNrKCdWJywgJHVybF9sZW4pOwoKICAgICAgICAkdXJsID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q29udmVydEVuY29kaW5nKCR1cmwsICdVVEYtMTZMRScsICdVVEYtOCcpOwoKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGRhdGEgbGVuZ3RoCiAgICAgICAgJGxlbmd0aCAgICAgID0gMHgyNCArIHN0cmxlbigkdXJsKTsKCiAgICAgICAgLy8gUGFjayB0aGUgaGVhZGVyIGRhdGEKICAgICAgICAkaGVhZGVyICAgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgICA9IHBhY2soInZ2dnYiLCAkcm93MSwgJHJvdzIsICRjb2wxLCAkY29sMik7CgogICAgICAgIC8vIFdyaXRlIHRoZSBwYWNrZWQgZGF0YQogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhIC4KICAgICAgICAgICAgICAgICAgICAgICAkdW5rbm93bjEgLiAkb3B0aW9ucyAuCiAgICAgICAgICAgICAgICAgICAgICAgJHVybF9sZW4gLiAkdXJsKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIGxpbmtzIHRvIGV4dGVybmFsIGRpcmVjdG9yeSBuYW1lcyBzdWNoIGFzICdjOlxmb28ueGxzJywKICAgICAqIGM6XGZvby54bHMjU2hlZXQxIUExJywgJy4uLy4uL2Zvby54bHMnLiBhbmQgJy4uLy4uL2Zvby54bHMjU2hlZXQxIUExJy4KICAgICAqCiAgICAgKiBOb3RlOiBFeGNlbCB3cml0ZXMgc29tZSByZWxhdGl2ZSBsaW5rcyB3aXRoIHRoZSAkZGlyX2xvbmcgc3RyaW5nLiBXZSBpZ25vcmUKICAgICAqIHRoZXNlIGNhc2VzIGZvciB0aGUgc2FrZSBvZiBzaW1wbGVyIGNvZGUuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAc2VlIHdyaXRlVXJsKCkKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyb3cxICAgU3RhcnQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sMSAgIFN0YXJ0IGNvbHVtbgogICAgICogQHBhcmFtIGludGVnZXIgJHJvdzIgICBFbmQgcm93CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sMiAgIEVuZCBjb2x1bW4KICAgICAqIEBwYXJhbSBzdHJpbmcgICR1cmwgICAgVVJMIHN0cmluZwogICAgICogQHJldHVybiBpbnRlZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB3cml0ZVVybEV4dGVybmFsKCRyb3cxLCAkY29sMSwgJHJvdzIsICRjb2wyLCAkdXJsKQogICAgewogICAgICAgIC8vIE5ldHdvcmsgZHJpdmVzIGFyZSBkaWZmZXJlbnQuIFdlIHdpbGwgaGFuZGxlIHRoZW0gc2VwYXJhdGVseQogICAgICAgIC8vIE1TL05vdmVsbCBuZXR3b3JrIGRyaXZlcyBhbmQgc2hhcmVzIHN0YXJ0IHdpdGggXFwKICAgICAgICBpZiAocHJlZ19tYXRjaCgnW15leHRlcm5hbDpcXFxcXScsICR1cmwpKSB7CiAgICAgICAgICAgIHJldHVybjsgLy8oJHRoaXMtPndyaXRlVXJsRXh0ZXJuYWxfbmV0KCRyb3cxLCAkY29sMSwgJHJvdzIsICRjb2wyLCAkdXJsLCAkc3RyLCAkZm9ybWF0KSk7CiAgICAgICAgfQoKICAgICAgICAkcmVjb3JkICAgICAgPSAweDAxQjg7ICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICA9IDB4MDAwMDA7ICAgICAgICAgICAgICAgICAgICAgIC8vIEJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAvLyBTdHJpcCBVUkwgdHlwZSBhbmQgY2hhbmdlIFVuaXggZGlyIHNlcGFyYXRvciB0byBEb3Mgc3R5bGUgKGlmIG5lZWRlZCkKICAgICAgICAvLwogICAgICAgICR1cmwgPSBwcmVnX3JlcGxhY2UoJy9eZXh0ZXJuYWw6LycsICcnLCAkdXJsKTsKICAgICAgICAkdXJsID0gcHJlZ19yZXBsYWNlKCcvXC8vJywgIlxcIiwgJHVybCk7CgogICAgICAgIC8vIERldGVybWluZSBpZiB0aGUgbGluayBpcyByZWxhdGl2ZSBvciBhYnNvbHV0ZToKICAgICAgICAvLyAgIHJlbGF0aXZlIGlmIGxpbmsgY29udGFpbnMgbm8gZGlyIHNlcGFyYXRvciwgInNvbWVmaWxlLnhscyIKICAgICAgICAvLyAgIHJlbGF0aXZlIGlmIGxpbmsgc3RhcnRzIHdpdGggdXAtZGlyLCAiLi5cLi5cc29tZWZpbGUueGxzIgogICAgICAgIC8vICAgb3RoZXJ3aXNlLCBhYnNvbHV0ZQoKICAgICAgICAkYWJzb2x1dGUgPSAweDAwOyAvLyByZWxhdGl2ZSBwYXRoCiAgICAgICAgaWYgKHByZWdfbWF0Y2goJy9eW0EtWl06LycsICR1cmwpKSB7CiAgICAgICAgICAgICRhYnNvbHV0ZSA9IDB4MDI7IC8vIGFic29sdXRlIHBhdGggb24gV2luZG93cywgZS5nLiBDOlwuLi4KICAgICAgICB9CiAgICAgICAgJGxpbmtfdHlwZSAgICAgICAgICAgICAgID0gMHgwMSB8ICRhYnNvbHV0ZTsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBsaW5rIGNvbnRhaW5zIGEgc2hlZXQgcmVmZXJlbmNlIGFuZCBjaGFuZ2Ugc29tZSBvZiB0aGUKICAgICAgICAvLyBwYXJhbWV0ZXJzIGFjY29yZGluZ2x5LgogICAgICAgIC8vIFNwbGl0IHRoZSBkaXIgbmFtZSBhbmQgc2hlZXQgbmFtZSAoaWYgaXQgZXhpc3RzKQogICAgICAgICRkaXJfbG9uZyA9ICR1cmw7CiAgICAgICAgaWYgKHByZWdfbWF0Y2goIi9cIy8iLCAkdXJsKSkgewogICAgICAgICAgICAkbGlua190eXBlIHw9IDB4MDg7CiAgICAgICAgfQoKCiAgICAgICAgLy8gUGFjayB0aGUgbGluayB0eXBlCiAgICAgICAgJGxpbmtfdHlwZSAgID0gcGFjaygiViIsICRsaW5rX3R5cGUpOwoKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHVwLWxldmVsIGRpciBjb3VudCBlLmcuLiAoLi5cLi5cLi5cID09IDMpCiAgICAgICAgJHVwX2NvdW50ICAgID0gcHJlZ19tYXRjaF9hbGwoIi9cLlwuXFxcLyIsICRkaXJfbG9uZywgJHVzZWxlc3MpOwogICAgICAgICR1cF9jb3VudCAgICA9IHBhY2soInYiLCAkdXBfY291bnQpOwoKICAgICAgICAvLyBTdG9yZSB0aGUgc2hvcnQgZG9zIGRpciBuYW1lIChudWxsIHRlcm1pbmF0ZWQpCiAgICAgICAgJGRpcl9zaG9ydCAgID0gcHJlZ19yZXBsYWNlKCIvXC5cLlxcXC8iLCAnJywgJGRpcl9sb25nKSAuICJcMCI7CgogICAgICAgIC8vIFN0b3JlIHRoZSBsb25nIGRpciBuYW1lIGFzIGEgd2NoYXIgc3RyaW5nIChub24tbnVsbCB0ZXJtaW5hdGVkKQogICAgICAgICRkaXJfbG9uZyAgICAgICA9ICRkaXJfbG9uZyAuICJcMCI7CgogICAgICAgIC8vIFBhY2sgdGhlIGxlbmd0aHMgb2YgdGhlIGRpciBzdHJpbmdzCiAgICAgICAgJGRpcl9zaG9ydF9sZW4gPSBwYWNrKCJWIiwgc3RybGVuKCRkaXJfc2hvcnQpKTsKICAgICAgICAkZGlyX2xvbmdfbGVuICA9IHBhY2soIlYiLCBzdHJsZW4oJGRpcl9sb25nKSk7CiAgICAgICAgJHN0cmVhbV9sZW4gICAgPSBwYWNrKCJWIiwgMCk7IC8vc3RybGVuKCRkaXJfbG9uZykgKyAweDA2KTsKCiAgICAgICAgLy8gUGFjayB0aGUgdW5kb2N1bWVudGVkIHBhcnRzIG9mIHRoZSBoeXBlcmxpbmsgc3RyZWFtCiAgICAgICAgJHVua25vd24xID0gcGFjaygiSCoiLCAnRDBDOUVBNzlGOUJBQ0UxMThDODIwMEFBMDA0QkE5MEIwMjAwMDAwMCcpOwogICAgICAgICR1bmtub3duMiA9IHBhY2soIkgqIiwgJzAzMDMwMDAwMDAwMDAwMDBDMDAwMDAwMDAwMDAwMDQ2Jyk7CiAgICAgICAgJHVua25vd24zID0gcGFjaygiSCoiLCAnRkZGRkFEREUwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAnKTsKICAgICAgICAkdW5rbm93bjQgPSBwYWNrKCJ2IiwgMHgwMyk7CgogICAgICAgIC8vIFBhY2sgdGhlIG1haW4gZGF0YSBzdHJlYW0KICAgICAgICAkZGF0YSAgICAgICAgPSBwYWNrKCJ2dnZ2IiwgJHJvdzEsICRyb3cyLCAkY29sMSwgJGNvbDIpIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkdW5rbm93bjEgICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkbGlua190eXBlICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkdW5rbm93bjIgICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkdXBfY291bnQgICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlyX3Nob3J0X2xlbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlyX3Nob3J0ICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkdW5rbm93bjMgICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RyZWFtX2xlbiAgIDsvKi4KICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlyX2xvbmdfbGVuIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkdW5rbm93bjQgICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlyX2xvbmcgICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hlZXRfbGVuICAgIC4KICAgICAgICAgICAgICAgICAgICAgICAgICAkc2hlZXQgICAgICAgIDsqLwoKICAgICAgICAvLyBQYWNrIHRoZSBoZWFkZXIgZGF0YQogICAgICAgICRsZW5ndGggICA9IHN0cmxlbigkZGF0YSk7CiAgICAgICAgJGhlYWRlciAgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKCiAgICAgICAgLy8gV3JpdGUgdGhlIHBhY2tlZCBkYXRhCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyLiAkZGF0YSk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIHNldCB0aGUgaGVpZ2h0IGFuZCBmb3JtYXQgZm9yIGEgcm93LgogICAgICoKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyb3cgICAgVGhlIHJvdyB0byBzZXQKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRoZWlnaHQgSGVpZ2h0IHdlIGFyZSBnaXZpbmcgdG8gdGhlIHJvdy4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgVXNlIG51bGwgdG8gc2V0IFhGIHdpdGhvdXQgc2V0dGluZyBoZWlnaHQKICAgICAqIEBwYXJhbSBpbnRlZ2VyICR4ZkluZGV4ICBUaGUgb3B0aW9uYWwgY2VsbCBzdHlsZSBYZiBpbmRleCB0byBhcHBseSB0byB0aGUgY29sdW1ucwogICAgICogQHBhcmFtIGJvb2wgICAgJGhpZGRlbiBUaGUgb3B0aW9uYWwgaGlkZGVuIGF0dHJpYnV0ZQogICAgICogQHBhcmFtIGludGVnZXIgJGxldmVsICBUaGUgb3B0aW9uYWwgb3V0bGluZSBsZXZlbCBmb3Igcm93LCBpbiByYW5nZSBbMCw3XQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlUm93KCRyb3csICRoZWlnaHQsICR4ZkluZGV4LCAkaGlkZGVuID0gZmFsc2UsICRsZXZlbCA9IDApCiAgICB7CiAgICAgICAgJHJlY29yZCAgICAgID0gMHgwMjA4OyAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICAgID0gMHgwMDEwOyAgICAgICAgICAgICAgIC8vIE51bWJlciBvZiBieXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGNvbE1pYyAgICAgID0gMHgwMDAwOyAgICAgICAgICAgICAgIC8vIEZpcnN0IGRlZmluZWQgY29sdW1uCiAgICAgICAgJGNvbE1hYyAgICAgID0gMHgwMDAwOyAgICAgICAgICAgICAgIC8vIExhc3QgZGVmaW5lZCBjb2x1bW4KICAgICAgICAkaXJ3TWFjICAgICAgPSAweDAwMDA7ICAgICAgICAgICAgICAgLy8gVXNlZCBieSBFeGNlbCB0byBvcHRpbWlzZSBsb2FkaW5nCiAgICAgICAgJHJlc2VydmVkICAgID0gMHgwMDAwOyAgICAgICAgICAgICAgIC8vIFJlc2VydmVkCiAgICAgICAgJGdyYml0ICAgICAgID0gMHgwMDAwOyAgICAgICAgICAgICAgIC8vIE9wdGlvbiBmbGFncwogICAgICAgICRpeGZlICAgICAgICA9ICR4ZkluZGV4OwoKICAgICAgICBpZiAoJGhlaWdodCA8IDApIHsKICAgICAgICAgICAgJGhlaWdodCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBVc2Ugd3JpdGVSb3coJHJvdywgbnVsbCwgJFhGKSB0byBzZXQgWEYgZm9ybWF0IHdpdGhvdXQgc2V0dGluZyBoZWlnaHQKICAgICAgICBpZiAoJGhlaWdodCAhPSBudWxsKSB7CiAgICAgICAgICAgICRtaXlSdyA9ICRoZWlnaHQgKiAyMDsgIC8vIHJvdyBoZWlnaHQKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkbWl5UncgPSAweGZmOyAgICAgICAgICAvLyBkZWZhdWx0IHJvdyBoZWlnaHQgaXMgMjU2CiAgICAgICAgfQoKICAgICAgICAvLyBTZXQgdGhlIG9wdGlvbnMgZmxhZ3MuIGZVbnN5bmNlZCBpcyB1c2VkIHRvIHNob3cgdGhhdCB0aGUgZm9udCBhbmQgcm93CiAgICAgICAgLy8gaGVpZ2h0cyBhcmUgbm90IGNvbXBhdGlibGUuIFRoaXMgaXMgdXN1YWxseSB0aGUgY2FzZSBmb3IgV3JpdGVFeGNlbC4KICAgICAgICAvLyBUaGUgY29sbGFwc2VkIGZsYWcgMHgxMCBkb2Vzbid0IHNlZW0gdG8gYmUgdXNlZCB0byBpbmRpY2F0ZSB0aGF0IGEgcm93CiAgICAgICAgLy8gaXMgY29sbGFwc2VkLiBJbnN0ZWFkIGl0IGlzIHVzZWQgdG8gaW5kaWNhdGUgdGhhdCB0aGUgcHJldmlvdXMgcm93IGlzCiAgICAgICAgLy8gY29sbGFwc2VkLiBUaGUgemVybyBoZWlnaHQgZmxhZywgMHgyMCwgaXMgdXNlZCB0byBjb2xsYXBzZSBhIHJvdy4KCiAgICAgICAgJGdyYml0IHw9ICRsZXZlbDsKICAgICAgICBpZiAoJGhpZGRlbikgewogICAgICAgICAgICAkZ3JiaXQgfD0gMHgwMDMwOwogICAgICAgIH0KICAgICAgICBpZiAoJGhlaWdodCAhPT0gbnVsbCkgewogICAgICAgICAgICAkZ3JiaXQgfD0gMHgwMDQwOyAvLyBmVW5zeW5jZWQKICAgICAgICB9CiAgICAgICAgaWYgKCR4ZkluZGV4ICE9PSAweEYpIHsKICAgICAgICAgICAgJGdyYml0IHw9IDB4MDA4MDsKICAgICAgICB9CiAgICAgICAgJGdyYml0IHw9IDB4MDEwMDsKCiAgICAgICAgJGhlYWRlciAgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICAgPSBwYWNrKCJ2dnZ2dnZ2diIsICRyb3csICRjb2xNaWMsICRjb2xNYWMsICRtaXlSdywgJGlyd01hYywgJHJlc2VydmVkLCAkZ3JiaXQsICRpeGZlKTsKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIuJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGVzIEV4Y2VsIERJTUVOU0lPTlMgdG8gZGVmaW5lIHRoZSBhcmVhIGluIHdoaWNoIHRoZXJlIGlzIGRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVEaW1lbnNpb25zKCkKICAgIHsKICAgICAgICAkcmVjb3JkID0gMHgwMjAwOyAvLyBSZWNvcmQgaWRlbnRpZmllcgoKICAgICAgICAkbGVuZ3RoID0gMHgwMDBFOwogICAgICAgICRkYXRhID0gcGFjaygnVlZ2dnYnLCAkdGhpcy0+Zmlyc3RSb3dJbmRleCwgJHRoaXMtPmxhc3RSb3dJbmRleCArIDEsICR0aGlzLT5maXJzdENvbHVtbkluZGV4LCAkdGhpcy0+bGFzdENvbHVtbkluZGV4ICsgMSwgMHgwMDAwKTsgLy8gcmVzZXJ2ZWQKCiAgICAgICAgJGhlYWRlciA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyLiRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIEJJRkYgcmVjb3JkIFdpbmRvdzIuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVXaW5kb3cyKCkKICAgIHsKICAgICAgICAkcmVjb3JkICAgICAgICAgPSAweDAyM0U7ICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICAgICA9IDB4MDAxMjsKCiAgICAgICAgJGdyYml0ICAgICAgICAgID0gMHgwMEI2OyAgICAgLy8gT3B0aW9uIGZsYWdzCiAgICAgICAgJHJ3VG9wICAgICAgICAgID0gMHgwMDAwOyAgICAgLy8gVG9wIHJvdyB2aXNpYmxlIGluIHdpbmRvdwogICAgICAgICRjb2xMZWZ0ICAgICAgICA9IDB4MDAwMDsgICAgIC8vIExlZnRtb3N0IGNvbHVtbiB2aXNpYmxlIGluIHdpbmRvdwoKCiAgICAgICAgLy8gVGhlIG9wdGlvbnMgZmxhZ3MgdGhhdCBjb21wcmlzZSAkZ3JiaXQKICAgICAgICAkZkRzcEZtbGEgICAgICAgPSAwOyAgICAgICAgICAgICAgICAgICAgIC8vIDAgLSBiaXQKICAgICAgICAkZkRzcEdyaWQgICAgICAgPSAkdGhpcy0+cGhwU2hlZXQtPmdldFNob3dHcmlkbGluZXMoKSA\/IDEgOiAwOyAvLyAxCiAgICAgICAgJGZEc3BSd0NvbCAgICAgID0gJHRoaXMtPnBocFNoZWV0LT5nZXRTaG93Um93Q29sSGVhZGVycygpID8gMSA6IDA7IC8vIDIKICAgICAgICAkZkZyb3plbiAgICAgICAgPSAkdGhpcy0+cGhwU2hlZXQtPmdldEZyZWV6ZVBhbmUoKSA\/IDEgOiAwOyAgICAgICAgLy8gMwogICAgICAgICRmRHNwWmVyb3MgICAgICA9IDE7ICAgICAgICAgICAgICAgICAgICAgLy8gNAogICAgICAgICRmRGVmYXVsdEhkciAgICA9IDE7ICAgICAgICAgICAgICAgICAgICAgLy8gNQogICAgICAgICRmQXJhYmljICAgICAgICA9ICR0aGlzLT5waHBTaGVldC0+Z2V0UmlnaHRUb0xlZnQoKSA\/IDEgOiAwOyAvLyA2CiAgICAgICAgJGZEc3BHdXRzICAgICAgID0gJHRoaXMtPm91dGxpbmVPbjsgICAgLy8gNwogICAgICAgICRmRnJvemVuTm9TcGxpdCA9IDA7ICAgICAgICAgICAgICAgICAgICAgLy8gMCAtIGJpdAogICAgICAgIC8vIG5vIHN1cHBvcnQgaW4gUEhQRXhjZWwgZm9yIHNlbGVjdGVkIHNoZWV0LCB0aGVyZWZvcmUgc2hlZXQgaXMgb25seSBzZWxlY3RlZCBpZiBpdCBpcyB0aGUgYWN0aXZlIHNoZWV0CiAgICAgICAgJGZTZWxlY3RlZCAgICAgID0gKCR0aGlzLT5waHBTaGVldCA9PT0gJHRoaXMtPnBocFNoZWV0LT5nZXRQYXJlbnQoKS0+Z2V0QWN0aXZlU2hlZXQoKSkgPyAxIDogMDsKICAgICAgICAkZlBhZ2VkICAgICAgICAgPSAxOyAgICAgICAgICAgICAgICAgICAgIC8vIDIKICAgICAgICAkZlBhZ2VCcmVha1ByZXZpZXcgPSAkdGhpcy0+cGhwU2hlZXQtPmdldFNoZWV0VmlldygpLT5nZXRWaWV3KCkgPT09IFBIUEV4Y2VsX1dvcmtzaGVldF9TaGVldFZpZXc6OlNIRUVUVklFV19QQUdFX0JSRUFLX1BSRVZJRVc7CgogICAgICAgICRncmJpdCAgICAgICAgICAgICA9ICRmRHNwRm1sYTsKICAgICAgICAkZ3JiaXQgICAgICAgICAgICB8PSAkZkRzcEdyaWQgICAgICAgPDwgMTsKICAgICAgICAkZ3JiaXQgICAgICAgICAgICB8PSAkZkRzcFJ3Q29sICAgICAgIDw8IDI7CiAgICAgICAgJGdyYml0ICAgICAgICAgICAgfD0gJGZGcm96ZW4gICAgICAgICAgIDw8IDM7CiAgICAgICAgJGdyYml0ICAgICAgICAgICAgfD0gJGZEc3BaZXJvcyAgICAgICA8PCA0OwogICAgICAgICRncmJpdCAgICAgICAgICAgIHw9ICRmRGVmYXVsdEhkciAgICAgICA8PCA1OwogICAgICAgICRncmJpdCAgICAgICAgICAgIHw9ICRmQXJhYmljICAgICAgICAgICA8PCA2OwogICAgICAgICRncmJpdCAgICAgICAgICAgIHw9ICRmRHNwR3V0cyAgICAgICA8PCA3OwogICAgICAgICRncmJpdCAgICAgICAgICAgIHw9ICRmRnJvemVuTm9TcGxpdCA8PCA4OwogICAgICAgICRncmJpdCAgICAgICAgICAgIHw9ICRmU2VsZWN0ZWQgICAgICAgPDwgOTsKICAgICAgICAkZ3JiaXQgICAgICAgICAgICB8PSAkZlBhZ2VkICAgICAgICAgICA8PCAxMDsKICAgICAgICAkZ3JiaXQgICAgICAgICAgICB8PSAkZlBhZ2VCcmVha1ByZXZpZXcgPDwgMTE7CgogICAgICAgICRoZWFkZXIgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICA9IHBhY2soInZ2diIsICRncmJpdCwgJHJ3VG9wLCAkY29sTGVmdCk7CgogICAgICAgIC8vIEZJWE1FICEhIQogICAgICAgICRyZ2JIZHIgICAgICAgPSAweDAwNDA7IC8vIFJvdy9jb2x1bW4gaGVhZGluZyBhbmQgZ3JpZGxpbmUgY29sb3IgaW5kZXgKICAgICAgICAkem9vbV9mYWN0b3JfcGFnZV9icmVhayA9ICgkZlBhZ2VCcmVha1ByZXZpZXcgPyAkdGhpcy0+cGhwU2hlZXQtPmdldFNoZWV0VmlldygpLT5nZXRab29tU2NhbGUoKSA6IDB4MDAwMCk7CiAgICAgICAgJHpvb21fZmFjdG9yX25vcm1hbCA9ICAkdGhpcy0+cGhwU2hlZXQtPmdldFNoZWV0VmlldygpLT5nZXRab29tU2NhbGVOb3JtYWwoKTsKCiAgICAgICAgJGRhdGEgLj0gcGFjaygidnZ2dlYiLCAkcmdiSGRyLCAweDAwMDAsICR6b29tX2ZhY3Rvcl9wYWdlX2JyZWFrLCAkem9vbV9mYWN0b3Jfbm9ybWFsLCAweDAwMDAwMDAwKTsKCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyLiRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIEJJRkYgcmVjb3JkIERFRkFVTFRST1dIRUlHSFQuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVEZWZhdWx0Um93SGVpZ2h0KCkKICAgIHsKICAgICAgICAkZGVmYXVsdFJvd0hlaWdodCA9ICR0aGlzLT5waHBTaGVldC0+Z2V0RGVmYXVsdFJvd0RpbWVuc2lvbigpLT5nZXRSb3dIZWlnaHQoKTsKCiAgICAgICAgaWYgKCRkZWZhdWx0Um93SGVpZ2h0IDwgMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBjb252ZXJ0IHRvIHR3aXBzCiAgICAgICAgJGRlZmF1bHRSb3dIZWlnaHQgPSAoaW50KSAyMCAqICRkZWZhdWx0Um93SGVpZ2h0OwoKICAgICAgICAkcmVjb3JkICAgPSAweDAyMjU7ICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICAgPSAweDAwMDQ7ICAgICAgLy8gTnVtYmVyIG9mIGJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAkaGVhZGVyICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICA9IHBhY2soInZ2IiwgMSwgJGRlZmF1bHRSb3dIZWlnaHQpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIEJJRkYgcmVjb3JkIERFRkNPTFdJRFRIIGlmIENPTElORk8gcmVjb3JkcyBhcmUgaW4gdXNlLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlRGVmY29sKCkKICAgIHsKICAgICAgICAkZGVmYXVsdENvbFdpZHRoID0gODsKCiAgICAgICAgJHJlY29yZCAgID0gMHgwMDU1OyAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgID0gMHgwMDAyOyAgICAgIC8vIE51bWJlciBvZiBieXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGhlYWRlciA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgPSBwYWNrKCJ2IiwgJGRlZmF1bHRDb2xXaWR0aCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgQklGRiByZWNvcmQgQ09MSU5GTyB0byBkZWZpbmUgY29sdW1uIHdpZHRocwogICAgICoKICAgICAqIE5vdGU6IFRoZSBTREsgc2F5cyB0aGUgcmVjb3JkIGxlbmd0aCBpcyAweDBCIGJ1dCBFeGNlbCB3cml0ZXMgYSAweDBDCiAgICAgKiBsZW5ndGggcmVjb3JkLgogICAgICoKICAgICAqIEBwYXJhbSBhcnJheSAkY29sX2FycmF5IFRoaXMgaXMgdGhlIG9ubHkgcGFyYW1ldGVyIHJlY2VpdmVkIGFuZCBpcyBjb21wb3NlZCBvZiB0aGUgZm9sbG93aW5nOgogICAgICogICAgICAgICAgICAgICAgMCA9PiBGaXJzdCBmb3JtYXR0ZWQgY29sdW1uLAogICAgICogICAgICAgICAgICAgICAgMSA9PiBMYXN0IGZvcm1hdHRlZCBjb2x1bW4sCiAgICAgKiAgICAgICAgICAgICAgICAyID0+IENvbCB3aWR0aCAoOC40MyBpcyBFeGNlbCBkZWZhdWx0KSwKICAgICAqICAgICAgICAgICAgICAgIDMgPT4gVGhlIG9wdGlvbmFsIFhGIGZvcm1hdCBvZiB0aGUgY29sdW1uLAogICAgICogICAgICAgICAgICAgICAgNCA9PiBPcHRpb24gZmxhZ3MuCiAgICAgKiAgICAgICAgICAgICAgICA1ID0+IE9wdGlvbmFsIG91dGxpbmUgbGV2ZWwKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZUNvbGluZm8oJGNvbF9hcnJheSkKICAgIHsKICAgICAgICBpZiAoaXNzZXQoJGNvbF9hcnJheVswXSkpIHsKICAgICAgICAgICAgJGNvbEZpcnN0ID0gJGNvbF9hcnJheVswXTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRjb2xfYXJyYXlbMV0pKSB7CiAgICAgICAgICAgICRjb2xMYXN0ID0gJGNvbF9hcnJheVsxXTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRjb2xfYXJyYXlbMl0pKSB7CiAgICAgICAgICAgICRjb2xkeCA9ICRjb2xfYXJyYXlbMl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGNvbGR4ID0gOC40MzsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCRjb2xfYXJyYXlbM10pKSB7CiAgICAgICAgICAgICR4ZkluZGV4ID0gJGNvbF9hcnJheVszXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkeGZJbmRleCA9IDE1OwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJGNvbF9hcnJheVs0XSkpIHsKICAgICAgICAgICAgJGdyYml0ID0gJGNvbF9hcnJheVs0XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkZ3JiaXQgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJGNvbF9hcnJheVs1XSkpIHsKICAgICAgICAgICAgJGxldmVsID0gJGNvbF9hcnJheVs1XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkbGV2ZWwgPSAwOwogICAgICAgIH0KICAgICAgICAkcmVjb3JkICAgPSAweDAwN0Q7ICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgID0gMHgwMDBDOyAgICAgICAgICAvLyBOdW1iZXIgb2YgYnl0ZXMgdG8gZm9sbG93CgogICAgICAgICRjb2xkeCAgICo9IDI1NjsgICAgICAgICAgICAgLy8gQ29udmVydCB0byB1bml0cyBvZiAxLzI1NiBvZiBhIGNoYXIKCiAgICAgICAgJGl4ZmUgICAgID0gJHhmSW5kZXg7CiAgICAgICAgJHJlc2VydmVkID0gMHgwMDAwOyAgICAgICAgICAgIC8vIFJlc2VydmVkCgogICAgICAgICRsZXZlbCA9IG1heCgwLCBtaW4oJGxldmVsLCA3KSk7CiAgICAgICAgJGdyYml0IHw9ICRsZXZlbCA8PCA4OwoKICAgICAgICAkaGVhZGVyICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICA9IHBhY2soInZ2dnZ2diIsICRjb2xGaXJzdCwgJGNvbExhc3QsICRjb2xkeCwgJGl4ZmUsICRncmJpdCwgJHJlc2VydmVkKTsKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIuJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgQklGRiByZWNvcmQgU0VMRUNUSU9OLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlU2VsZWN0aW9uKCkKICAgIHsKICAgICAgICAvLyBsb29rIHVwIHRoZSBzZWxlY3RlZCBjZWxsIHJhbmdlCiAgICAgICAgJHNlbGVjdGVkQ2VsbHMgPSAkdGhpcy0+cGhwU2hlZXQtPmdldFNlbGVjdGVkQ2VsbHMoKTsKICAgICAgICAkc2VsZWN0ZWRDZWxscyA9IFBIUEV4Y2VsX0NlbGw6OnNwbGl0UmFuZ2UoJHRoaXMtPnBocFNoZWV0LT5nZXRTZWxlY3RlZENlbGxzKCkpOwogICAgICAgICRzZWxlY3RlZENlbGxzID0gJHNlbGVjdGVkQ2VsbHNbMF07CiAgICAgICAgaWYgKGNvdW50KCRzZWxlY3RlZENlbGxzKSA9PSAyKSB7CiAgICAgICAgICAgIGxpc3QoJGZpcnN0LCAkbGFzdCkgPSAkc2VsZWN0ZWRDZWxsczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkZmlyc3QgPSAkc2VsZWN0ZWRDZWxsc1swXTsKICAgICAgICAgICAgJGxhc3QgID0gJHNlbGVjdGVkQ2VsbHNbMF07CiAgICAgICAgfQoKICAgICAgICBsaXN0KCRjb2xGaXJzdCwgJHJ3Rmlyc3QpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJGZpcnN0KTsKICAgICAgICAkY29sRmlyc3QgPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNvbEZpcnN0KSAtIDE7IC8vIGJhc2UgMCBjb2x1bW4gaW5kZXgKICAgICAgICAtLSRyd0ZpcnN0OyAvLyBiYXNlIDAgcm93IGluZGV4CgogICAgICAgIGxpc3QoJGNvbExhc3QsICRyd0xhc3QpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJGxhc3QpOwogICAgICAgICRjb2xMYXN0ID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRjb2xMYXN0KSAtIDE7IC8vIGJhc2UgMCBjb2x1bW4gaW5kZXgKICAgICAgICAtLSRyd0xhc3Q7IC8vIGJhc2UgMCByb3cgaW5kZXgKCiAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGFyZSBub3Qgb3V0IG9mIGJvdW5kcwogICAgICAgICRjb2xGaXJzdCA9IG1pbigkY29sRmlyc3QsIDI1NSk7CiAgICAgICAgJGNvbExhc3QgID0gbWluKCRjb2xMYXN0LCAyNTUpOwoKICAgICAgICAkcndGaXJzdCA9IG1pbigkcndGaXJzdCwgNjU1MzUpOwogICAgICAgICRyd0xhc3QgID0gbWluKCRyd0xhc3QsIDY1NTM1KTsKCiAgICAgICAgJHJlY29yZCAgID0gMHgwMDFEOyAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgID0gMHgwMDBGOyAgICAgICAgICAgICAgICAgIC8vIE51bWJlciBvZiBieXRlcyB0byBmb2xsb3cKCiAgICAgICAgJHBubiAgICAgID0gJHRoaXMtPmFjdGl2ZVBhbmU7ICAgICAvLyBQYW5lIHBvc2l0aW9uCiAgICAgICAgJHJ3QWN0ICAgID0gJHJ3Rmlyc3Q7ICAgICAgICAgICAgICAgIC8vIEFjdGl2ZSByb3cKICAgICAgICAkY29sQWN0ICAgPSAkY29sRmlyc3Q7ICAgICAgICAgICAgICAgLy8gQWN0aXZlIGNvbHVtbgogICAgICAgICRpcmVmQWN0ICA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAvLyBBY3RpdmUgY2VsbCByZWYKICAgICAgICAkY3JlZiAgICAgPSAxOyAgICAgICAgICAgICAgICAgICAgICAgLy8gTnVtYmVyIG9mIHJlZnMKCiAgICAgICAgaWYgKCFpc3NldCgkcndMYXN0KSkgewogICAgICAgICAgICAkcndMYXN0ICAgPSAkcndGaXJzdDsgICAgICAgLy8gTGFzdCAgcm93IGluIHJlZmVyZW5jZQogICAgICAgIH0KICAgICAgICBpZiAoIWlzc2V0KCRjb2xMYXN0KSkgewogICAgICAgICAgICAkY29sTGFzdCAgPSAkY29sRmlyc3Q7ICAgICAgLy8gTGFzdCAgY29sIGluIHJlZmVyZW5jZQogICAgICAgIH0KCiAgICAgICAgLy8gU3dhcCBsYXN0IHJvdy9jb2wgZm9yIGZpcnN0IHJvdy9jb2wgYXMgbmVjZXNzYXJ5CiAgICAgICAgaWYgKCRyd0ZpcnN0ID4gJHJ3TGFzdCkgewogICAgICAgICAgICBsaXN0KCRyd0ZpcnN0LCAkcndMYXN0KSA9IGFycmF5KCRyd0xhc3QsICRyd0ZpcnN0KTsKICAgICAgICB9CgogICAgICAgIGlmICgkY29sRmlyc3QgPiAkY29sTGFzdCkgewogICAgICAgICAgICBsaXN0KCRjb2xGaXJzdCwgJGNvbExhc3QpID0gYXJyYXkoJGNvbExhc3QsICRjb2xGaXJzdCk7CiAgICAgICAgfQoKICAgICAgICAkaGVhZGVyICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICA9IHBhY2soIkN2dnZ2dnZDQyIsICRwbm4sICRyd0FjdCwgJGNvbEFjdCwgJGlyZWZBY3QsICRjcmVmLCAkcndGaXJzdCwgJHJ3TGFzdCwgJGNvbEZpcnN0LCAkY29sTGFzdCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIE1FUkdFRENFTExTIHJlY29yZHMgZm9yIGFsbCByYW5nZXMgb2YgbWVyZ2VkIGNlbGxzCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVNZXJnZWRDZWxscygpCiAgICB7CiAgICAgICAgJG1lcmdlQ2VsbHMgPSAkdGhpcy0+cGhwU2hlZXQtPmdldE1lcmdlQ2VsbHMoKTsKICAgICAgICAkY291bnRNZXJnZUNlbGxzID0gY291bnQoJG1lcmdlQ2VsbHMpOwoKICAgICAgICBpZiAoJGNvdW50TWVyZ2VDZWxscyA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG1heGltdW0gYWxsb3dlZCBudW1iZXIgb2YgbWVyZ2VkIGNlbGxzIHBlciByZWNvcmQKICAgICAgICAkbWF4Q291bnRNZXJnZUNlbGxzUGVyUmVjb3JkID0gMTAyNzsKCiAgICAgICAgLy8gcmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkcmVjb3JkID0gMHgwMEU1OwoKICAgICAgICAvLyBjb3VudGVyIGZvciB0b3RhbCBudW1iZXIgb2YgbWVyZ2VkIGNlbGxzIHRyZWF0ZWQgc28gZmFyIGJ5IHRoZSB3cml0ZXIKICAgICAgICAkaSA9IDA7CgogICAgICAgIC8vIGNvdW50ZXIgZm9yIG51bWJlciBvZiBtZXJnZWQgY2VsbHMgd3JpdHRlbiBpbiByZWNvcmQgY3VycmVudGx5IGJlaW5nIHdyaXR0ZW4KICAgICAgICAkaiA9IDA7CgogICAgICAgIC8vIGluaXRpYWxpemUgcmVjb3JkIGRhdGEKICAgICAgICAkcmVjb3JkRGF0YSA9ICcnOwoKICAgICAgICAvLyBsb29wIHRocm91Z2ggdGhlIG1lcmdlZCBjZWxscwogICAgICAgIGZvcmVhY2ggKCRtZXJnZUNlbGxzIGFzICRtZXJnZUNlbGwpIHsKICAgICAgICAgICAgKyskaTsKICAgICAgICAgICAgKyskajsKCiAgICAgICAgICAgIC8vIGV4dHJhY3QgdGhlIHJvdyBhbmQgY29sdW1uIGluZGV4ZXMKICAgICAgICAgICAgJHJhbmdlID0gUEhQRXhjZWxfQ2VsbDo6c3BsaXRSYW5nZSgkbWVyZ2VDZWxsKTsKICAgICAgICAgICAgbGlzdCgkZmlyc3QsICRsYXN0KSA9ICRyYW5nZVswXTsKICAgICAgICAgICAgbGlzdCgkZmlyc3RDb2x1bW4sICRmaXJzdFJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkZmlyc3QpOwogICAgICAgICAgICBsaXN0KCRsYXN0Q29sdW1uLCAkbGFzdFJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkbGFzdCk7CgogICAgICAgICAgICAkcmVjb3JkRGF0YSAuPSBwYWNrKCd2dnZ2JywgJGZpcnN0Um93IC0gMSwgJGxhc3RSb3cgLSAxLCBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGZpcnN0Q29sdW1uKSAtIDEsIFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkbGFzdENvbHVtbikgLSAxKTsKCiAgICAgICAgICAgIC8vIGZsdXNoIHJlY29yZCBpZiB3ZSBoYXZlIHJlYWNoZWQgbGltaXQgZm9yIG51bWJlciBvZiBtZXJnZWQgY2VsbHMsIG9yIHJlYWNoZWQgZmluYWwgbWVyZ2VkIGNlbGwKICAgICAgICAgICAgaWYgKCRqID09ICRtYXhDb3VudE1lcmdlQ2VsbHNQZXJSZWNvcmQgb3IgJGkgPT0gJGNvdW50TWVyZ2VDZWxscykgewogICAgICAgICAgICAgICAgJHJlY29yZERhdGEgPSBwYWNrKCd2JywgJGopIC4gJHJlY29yZERhdGE7CiAgICAgICAgICAgICAgICAkbGVuZ3RoID0gc3RybGVuKCRyZWNvcmREYXRhKTsKICAgICAgICAgICAgICAgICRoZWFkZXIgPSBwYWNrKCd2dicsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJHJlY29yZERhdGEpOwoKICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemUgZm9yIG5leHQgcmVjb3JkLCBpZiBhbnkKICAgICAgICAgICAgICAgICRyZWNvcmREYXRhID0gJyc7CiAgICAgICAgICAgICAgICAkaiA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBTSEVFVExBWU9VVCByZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVNoZWV0TGF5b3V0KCkKICAgIHsKICAgICAgICBpZiAoISR0aGlzLT5waHBTaGVldC0+aXNUYWJDb2xvclNldCgpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICRyZWNvcmREYXRhID0gcGFjaygKICAgICAgICAgICAgJ3Z2VlZWdnYnLAogICAgICAgICAgICAweDA4NjIsCiAgICAgICAgICAgIDB4MDAwMCwgLy8gdW51c2VkCiAgICAgICAgICAgIDB4MDAwMDAwMDAsIC8vIHVudXNlZAogICAgICAgICAgICAweDAwMDAwMDAwLCAvLyB1bnVzZWQKICAgICAgICAgICAgMHgwMDAwMDAxNCwgLy8gc2l6ZSBvZiByZWNvcmQgZGF0YQogICAgICAgICAgICAkdGhpcy0+Y29sb3JzWyR0aGlzLT5waHBTaGVldC0+Z2V0VGFiQ29sb3IoKS0+Z2V0UkdCKCldLCAvLyBjb2xvciBpbmRleAogICAgICAgICAgICAweDAwMDAgICAgICAgIC8vIHVudXNlZAogICAgICAgICk7CgogICAgICAgICRsZW5ndGggPSBzdHJsZW4oJHJlY29yZERhdGEpOwoKICAgICAgICAkcmVjb3JkID0gMHgwODYyOyAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRoZWFkZXIgPSBwYWNrKCd2dicsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRyZWNvcmREYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIFNIRUVUUFJPVEVDVElPTgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlU2hlZXRQcm90ZWN0aW9uKCkKICAgIHsKICAgICAgICAvLyByZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRyZWNvcmQgPSAweDA4Njc7CgogICAgICAgIC8vIHByZXBhcmUgb3B0aW9ucwogICAgICAgICRvcHRpb25zICA9ICAgKGludCkgISR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRPYmplY3RzKCkKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0U2NlbmFyaW9zKCkgICAgICAgICAgIDw8IDEKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0Rm9ybWF0Q2VsbHMoKSAgICAgICAgIDw8IDIKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0Rm9ybWF0Q29sdW1ucygpICAgICAgIDw8IDMKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0Rm9ybWF0Um93cygpICAgICAgICAgIDw8IDQKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0SW5zZXJ0Q29sdW1ucygpICAgICAgIDw8IDUKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0SW5zZXJ0Um93cygpICAgICAgICAgIDw8IDYKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0SW5zZXJ0SHlwZXJsaW5rcygpICAgIDw8IDcKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0RGVsZXRlQ29sdW1ucygpICAgICAgIDw8IDgKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0RGVsZXRlUm93cygpICAgICAgICAgIDw8IDkKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0U2VsZWN0TG9ja2VkQ2VsbHMoKSAgIDw8IDEwCiAgICAgICAgICAgICAgICAgICAgfCAoaW50KSAhJHRoaXMtPnBocFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPmdldFNvcnQoKSAgICAgICAgICAgICAgICA8PCAxMQogICAgICAgICAgICAgICAgICAgIHwgKGludCkgISR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRBdXRvRmlsdGVyKCkgICAgICAgICAgPDwgMTIKICAgICAgICAgICAgICAgICAgICB8IChpbnQpICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0UGl2b3RUYWJsZXMoKSAgICAgICAgIDw8IDEzCiAgICAgICAgICAgICAgICAgICAgfCAoaW50KSAhJHRoaXMtPnBocFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPmdldFNlbGVjdFVubG9ja2VkQ2VsbHMoKSA8PCAxNCA7CgogICAgICAgIC8vIHJlY29yZCBkYXRhCiAgICAgICAgJHJlY29yZERhdGEgPSBwYWNrKAogICAgICAgICAgICAndlZWQ1ZWdnYnLAogICAgICAgICAgICAweDA4NjcsIC8vIHJlcGVhdGVkIHJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgICAgIDB4MDAwMCwgLy8gbm90IHVzZWQKICAgICAgICAgICAgMHgwMDAwLCAvLyBub3QgdXNlZAogICAgICAgICAgICAweDAwLCAvLyBub3QgdXNlZAogICAgICAgICAgICAweDAxMDAwMjAwLCAvLyB1bmtub3duIGRhdGEKICAgICAgICAgICAgMHhGRkZGRkZGRiwgLy8gdW5rbm93biBkYXRhCiAgICAgICAgICAgICRvcHRpb25zLCAvLyBvcHRpb25zCiAgICAgICAgICAgIDB4MDAwMCAvLyBub3QgdXNlZAogICAgICAgICk7CgogICAgICAgICRsZW5ndGggPSBzdHJsZW4oJHJlY29yZERhdGEpOwogICAgICAgICRoZWFkZXIgPSBwYWNrKCd2dicsICRyZWNvcmQsICRsZW5ndGgpOwoKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkcmVjb3JkRGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBCSUZGIHJlY29yZCBSQU5HRVBST1RFQ1RJT04KICAgICAqCiAgICAgKiBPcGVub2ZmaWNlLm9yZydzIERvY3VtZW50YWlvbiBvZiB0aGUgTWljcm9zb2Z0IEV4Y2VsIEZpbGUgRm9ybWF0IHVzZXMgdGVybSBSQU5HRVBST1RFQ1RJT04gZm9yIHRoZXNlIHJlY29yZHMKICAgICAqIE1pY3Jvc29mdCBPZmZpY2UgRXhjZWwgOTctMjAwNyBCaW5hcnkgRmlsZSBGb3JtYXQgU3BlY2lmaWNhdGlvbiB1c2VzIHRlcm0gRkVBVCBmb3IgdGhlc2UgcmVjb3JkcwogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlUmFuZ2VQcm90ZWN0aW9uKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3RlZENlbGxzKCkgYXMgJHJhbmdlID0+ICRwYXNzd29yZCkgewogICAgICAgICAgICAvLyBudW1iZXIgb2YgcmFuZ2VzLCBlLmcuICdBMTpCMyBDMjA6RDI1JwogICAgICAgICAgICAkY2VsbFJhbmdlcyA9IGV4cGxvZGUoJyAnLCAkcmFuZ2UpOwogICAgICAgICAgICAkY3JlZiA9IGNvdW50KCRjZWxsUmFuZ2VzKTsKCiAgICAgICAgICAgICRyZWNvcmREYXRhID0gcGFjaygKICAgICAgICAgICAgICAgICd2dlZWdkNWdlZ2JywKICAgICAgICAgICAgICAgIDB4MDg2OCwKICAgICAgICAgICAgICAgIDB4MDAsCiAgICAgICAgICAgICAgICAweDAwMDAsCiAgICAgICAgICAgICAgICAweDAwMDAsCiAgICAgICAgICAgICAgICAweDAyLAogICAgICAgICAgICAgICAgMHgwLAogICAgICAgICAgICAgICAgMHgwMDAwLAogICAgICAgICAgICAgICAgJGNyZWYsCiAgICAgICAgICAgICAgICAweDAwMDAsCiAgICAgICAgICAgICAgICAweDAwCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBmb3JlYWNoICgkY2VsbFJhbmdlcyBhcyAkY2VsbFJhbmdlKSB7CiAgICAgICAgICAgICAgICAkcmVjb3JkRGF0YSAuPSAkdGhpcy0+d3JpdGVCSUZGOENlbGxSYW5nZUFkZHJlc3NGaXhlZCgkY2VsbFJhbmdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gdGhlIHJnYkZlYXQgc3RydWN0dXJlCiAgICAgICAgICAgICRyZWNvcmREYXRhIC49IHBhY2soCiAgICAgICAgICAgICAgICAnVlYnLAogICAgICAgICAgICAgICAgMHgwMDAwLAogICAgICAgICAgICAgICAgaGV4ZGVjKCRwYXNzd29yZCkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRyZWNvcmREYXRhIC49IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OlVURjh0b0JJRkY4VW5pY29kZUxvbmcoJ3AnIC4gbWQ1KCRyZWNvcmREYXRhKSk7CgogICAgICAgICAgICAkbGVuZ3RoID0gc3RybGVuKCRyZWNvcmREYXRhKTsKCiAgICAgICAgICAgICRyZWNvcmQgPSAweDA4Njg7ICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICAgICAkaGVhZGVyID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJHJlY29yZERhdGEpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIEJJRkYgcmVjb3JkIEVYVEVSTkNPVU5UIHRvIGluZGljYXRlIHRoZSBudW1iZXIgb2YgZXh0ZXJuYWwgc2hlZXQKICAgICAqIHJlZmVyZW5jZXMgaW4gYSB3b3Jrc2hlZXQuCiAgICAgKgogICAgICogRXhjZWwgb25seSBzdG9yZXMgcmVmZXJlbmNlcyB0byBleHRlcm5hbCBzaGVldHMgdGhhdCBhcmUgdXNlZCBpbiBmb3JtdWxhcy4KICAgICAqIEZvciBzaW1wbGljaXR5IHdlIHN0b3JlIHJlZmVyZW5jZXMgdG8gYWxsIHRoZSBzaGVldHMgaW4gdGhlIHdvcmtib29rCiAgICAgKiByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhleSBhcmUgdXNlZCBvciBub3QuIFRoaXMgcmVkdWNlcyB0aGUgb3ZlcmFsbAogICAgICogY29tcGxleGl0eSBhbmQgZWxpbWluYXRlcyB0aGUgbmVlZCBmb3IgYSB0d28gd2F5IGRpYWxvZ3VlIGJldHdlZW4gdGhlIGZvcm11bGEKICAgICAqIHBhcnNlciB0aGUgd29ya3NoZWV0IG9iamVjdHMuCiAgICAgKgogICAgICogQHBhcmFtIGludGVnZXIgJGNvdW50IFRoZSBudW1iZXIgb2YgZXh0ZXJuYWwgc2hlZXQgcmVmZXJlbmNlcyBpbiB0aGlzIHdvcmtzaGVldAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlRXh0ZXJuY291bnQoJGNvdW50KQogICAgewogICAgICAgICRyZWNvcmQgPSAweDAwMTY7ICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCA9IDB4MDAwMjsgICAgICAgICAgLy8gTnVtYmVyIG9mIGJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAkaGVhZGVyID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgID0gcGFjaygidiIsICRjb3VudCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGVzIHRoZSBFeGNlbCBCSUZGIEVYVEVSTlNIRUVUIHJlY29yZC4gVGhlc2UgcmVmZXJlbmNlcyBhcmUgdXNlZCBieQogICAgICogZm9ybXVsYXMuIEEgZm9ybXVsYSByZWZlcmVuY2VzIGEgc2hlZXQgbmFtZSB2aWEgYW4gaW5kZXguIFNpbmNlIHdlIHN0b3JlIGEKICAgICAqIHJlZmVyZW5jZSB0byBhbGwgb2YgdGhlIGV4dGVybmFsIHdvcmtzaGVldHMgdGhlIEVYVEVSTlNIRUVUIGluZGV4IGlzIHRoZSBzYW1lCiAgICAgKiBhcyB0aGUgd29ya3NoZWV0IGluZGV4LgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHNoZWV0bmFtZSBUaGUgbmFtZSBvZiBhIGV4dGVybmFsIHdvcmtzaGVldAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlRXh0ZXJuc2hlZXQoJHNoZWV0bmFtZSkKICAgIHsKICAgICAgICAkcmVjb3JkICAgID0gMHgwMDE3OyAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCgogICAgICAgIC8vIFJlZmVyZW5jZXMgdG8gdGhlIGN1cnJlbnQgc2hlZXQgYXJlIGVuY29kZWQgZGlmZmVyZW50bHkgdG8gcmVmZXJlbmNlcyB0bwogICAgICAgIC8vIGV4dGVybmFsIHNoZWV0cy4KICAgICAgICAvLwogICAgICAgIGlmICgkdGhpcy0+cGhwU2hlZXQtPmdldFRpdGxlKCkgPT0gJHNoZWV0bmFtZSkgewogICAgICAgICAgICAkc2hlZXRuYW1lID0gJyc7CiAgICAgICAgICAgICRsZW5ndGggICAgPSAweDAyOyAgLy8gVGhlIGZvbGxvd2luZyAyIGJ5dGVzCiAgICAgICAgICAgICRjY2ggICAgICAgPSAxOyAgICAgLy8gVGhlIGZvbGxvd2luZyBieXRlCiAgICAgICAgICAgICRyZ2NoICAgICAgPSAweDAyOyAgLy8gU2VsZiByZWZlcmVuY2UKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkbGVuZ3RoICAgID0gMHgwMiArIHN0cmxlbigkc2hlZXRuYW1lKTsKICAgICAgICAgICAgJGNjaCAgICAgICA9IHN0cmxlbigkc2hlZXRuYW1lKTsKICAgICAgICAgICAgJHJnY2ggICAgICA9IDB4MDM7ICAvLyBSZWZlcmVuY2UgdG8gYSBzaGVldCBpbiB0aGUgY3VycmVudCB3b3JrYm9vawogICAgICAgIH0KCiAgICAgICAgJGhlYWRlciA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICA9IHBhY2soIkNDIiwgJGNjaCwgJHJnY2gpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhIC4gJHNoZWV0bmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZXMgdGhlIEV4Y2VsIEJJRkYgUEFORSByZWNvcmQuCiAgICAgKiBUaGUgcGFuZXMgY2FuIGVpdGhlciBiZSBmcm96ZW4gb3IgdGhhd2VkICh1bmZyb3plbikuCiAgICAgKiBGcm96ZW4gcGFuZXMgYXJlIHNwZWNpZmllZCBpbiB0ZXJtcyBvZiBhbiBpbnRlZ2VyIG51bWJlciBvZiByb3dzIGFuZCBjb2x1bW5zLgogICAgICogVGhhd2VkIHBhbmVzIGFyZSBzcGVjaWZpZWQgaW4gdGVybXMgb2YgRXhjZWwncyB1bml0cyBmb3Igcm93cyBhbmQgY29sdW1ucy4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVBhbmVzKCkKICAgIHsKICAgICAgICAkcGFuZXMgPSBhcnJheSgpOwogICAgICAgIGlmICgkZnJlZXplUGFuZSA9ICR0aGlzLT5waHBTaGVldC0+Z2V0RnJlZXplUGFuZSgpKSB7CiAgICAgICAgICAgIGxpc3QoJGNvbHVtbiwgJHJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkZnJlZXplUGFuZSk7CiAgICAgICAgICAgICRwYW5lc1swXSA9ICRyb3cgLSAxOwogICAgICAgICAgICAkcGFuZXNbMV0gPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNvbHVtbikgLSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHRoYXcgcGFuZXMKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgJHkgICAgICAgPSBpc3NldCgkcGFuZXNbMF0pID8gJHBhbmVzWzBdIDogbnVsbDsKICAgICAgICAkeCAgICAgICA9IGlzc2V0KCRwYW5lc1sxXSkgPyAkcGFuZXNbMV0gOiBudWxsOwogICAgICAgICRyd1RvcCAgID0gaXNzZXQoJHBhbmVzWzJdKSA\/ICRwYW5lc1syXSA6IG51bGw7CiAgICAgICAgJGNvbExlZnQgPSBpc3NldCgkcGFuZXNbM10pID8gJHBhbmVzWzNdIDogbnVsbDsKICAgICAgICBpZiAoY291bnQoJHBhbmVzKSA+IDQpIHsgLy8gaWYgQWN0aXZlIHBhbmUgd2FzIHJlY2VpdmVkCiAgICAgICAgICAgICRwbm5BY3QgPSAkcGFuZXNbNF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHBubkFjdCA9IG51bGw7CiAgICAgICAgfQogICAgICAgICRyZWNvcmQgID0gMHgwMDQxOyAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggID0gMHgwMDBBOyAgICAgICAvLyBOdW1iZXIgb2YgYnl0ZXMgdG8gZm9sbG93CgogICAgICAgIC8vIENvZGUgc3BlY2lmaWMgdG8gZnJvemVuIG9yIHRoYXdlZCBwYW5lcy4KICAgICAgICBpZiAoJHRoaXMtPnBocFNoZWV0LT5nZXRGcmVlemVQYW5lKCkpIHsKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgdmFsdWVzIGZvciAkcndUb3AgYW5kICRjb2xMZWZ0CiAgICAgICAgICAgIGlmICghaXNzZXQoJHJ3VG9wKSkgewogICAgICAgICAgICAgICAgJHJ3VG9wICAgPSAkeTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzc2V0KCRjb2xMZWZ0KSkgewogICAgICAgICAgICAgICAgJGNvbExlZnQgPSAkeDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHZhbHVlcyBmb3IgJHJ3VG9wIGFuZCAkY29sTGVmdAogICAgICAgICAgICBpZiAoIWlzc2V0KCRyd1RvcCkpIHsKICAgICAgICAgICAgICAgICRyd1RvcCAgID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzc2V0KCRjb2xMZWZ0KSkgewogICAgICAgICAgICAgICAgJGNvbExlZnQgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDb252ZXJ0IEV4Y2VsJ3Mgcm93IGFuZCBjb2x1bW4gdW5pdHMgdG8gdGhlIGludGVybmFsIHVuaXRzLgogICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCByb3cgaGVpZ2h0IGlzIDEyLjc1CiAgICAgICAgICAgIC8vIFRoZSBkZWZhdWx0IGNvbHVtbiB3aWR0aCBpcyA4LjQzCiAgICAgICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgc2xvcGUgYW5kIGludGVyc2VjdGlvbiB2YWx1ZXMgd2VyZSBpbnRlcnBvbGF0ZWQuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgICR5ID0gMjAqJHkgKyAyNTU7CiAgICAgICAgICAgICR4ID0gMTEzLjg3OSokeCArIDM5MDsKICAgICAgICB9CgoKICAgICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggcGFuZSBzaG91bGQgYmUgYWN0aXZlLiBUaGVyZSBpcyBhbHNvIHRoZSB1bmRvY3VtZW50ZWQKICAgICAgICAvLyBvcHRpb24gdG8gb3ZlcnJpZGUgdGhpcyBzaG91bGQgaXQgYmUgbmVjZXNzYXJ5OiBtYXkgYmUgcmVtb3ZlZCBsYXRlci4KICAgICAgICAvLwogICAgICAgIGlmICghaXNzZXQoJHBubkFjdCkpIHsKICAgICAgICAgICAgaWYgKCR4ICE9IDAgJiYgJHkgIT0gMCkgewogICAgICAgICAgICAgICAgJHBubkFjdCA9IDA7IC8vIEJvdHRvbSByaWdodAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkeCAhPSAwICYmICR5ID09IDApIHsKICAgICAgICAgICAgICAgICRwbm5BY3QgPSAxOyAvLyBUb3AgcmlnaHQKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHggPT0gMCAmJiAkeSAhPSAwKSB7CiAgICAgICAgICAgICAgICAkcG5uQWN0ID0gMjsgLy8gQm90dG9tIGxlZnQKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHggPT0gMCAmJiAkeSA9PSAwKSB7CiAgICAgICAgICAgICAgICAkcG5uQWN0ID0gMzsgLy8gVG9wIGxlZnQKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmFjdGl2ZVBhbmUgPSAkcG5uQWN0OyAvLyBVc2VkIGluIHdyaXRlU2VsZWN0aW9uCgogICAgICAgICRoZWFkZXIgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhID0gcGFjaygidnZ2dnYiLCAkeCwgJHksICRyd1RvcCwgJGNvbExlZnQsICRwbm5BY3QpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBwYWdlIHNldHVwIFNFVFVQIEJJRkYgcmVjb3JkLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlU2V0dXAoKQogICAgewogICAgICAgICRyZWNvcmQgICAgICAgPSAweDAwQTE7ICAgICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICAgICAgID0gMHgwMDIyOyAgICAgICAgICAgICAgICAgIC8vIE51bWJlciBvZiBieXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGlQYXBlclNpemUgICA9ICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPmdldFBhcGVyU2l6ZSgpOyAgICAvLyBQYXBlciBzaXplCgogICAgICAgICRpU2NhbGUgPSAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRTY2FsZSgpID8KICAgICAgICAgICAgJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0U2NhbGUoKSA6IDEwMDsgICAvLyBQcmludCBzY2FsaW5nIGZhY3RvcgoKICAgICAgICAkaVBhZ2VTdGFydCAgID0gMHgwMTsgICAgICAgICAgICAgICAgIC8vIFN0YXJ0aW5nIHBhZ2UgbnVtYmVyCiAgICAgICAgJGlGaXRXaWR0aCAgICA9IChpbnQpICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPmdldEZpdFRvV2lkdGgoKTsgICAgLy8gRml0IHRvIG51bWJlciBvZiBwYWdlcyB3aWRlCiAgICAgICAgJGlGaXRIZWlnaHQgICAgPSAoaW50KSAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRGaXRUb0hlaWdodCgpOyAgICAvLyBGaXQgdG8gbnVtYmVyIG9mIHBhZ2VzIGhpZ2gKICAgICAgICAkZ3JiaXQgICAgICAgID0gMHgwMDsgICAgICAgICAgICAgICAgIC8vIE9wdGlvbiBmbGFncwogICAgICAgICRpUmVzICAgICAgICAgPSAweDAyNTg7ICAgICAgICAgICAgICAgLy8gUHJpbnQgcmVzb2x1dGlvbgogICAgICAgICRpVlJlcyAgICAgICAgPSAweDAyNTg7ICAgICAgICAgICAgICAgLy8gVmVydGljYWwgcHJpbnQgcmVzb2x1dGlvbgoKICAgICAgICAkbnVtSGRyICAgICAgID0gJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlTWFyZ2lucygpLT5nZXRIZWFkZXIoKTsgIC8vIEhlYWRlciBNYXJnaW4KCiAgICAgICAgJG51bUZ0ciAgICAgICA9ICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZU1hcmdpbnMoKS0+Z2V0Rm9vdGVyKCk7ICAgLy8gRm9vdGVyIE1hcmdpbgogICAgICAgICRpQ29waWVzICAgICAgPSAweDAxOyAgICAgICAgICAgICAgICAgLy8gTnVtYmVyIG9mIGNvcGllcwoKICAgICAgICAkZkxlZnRUb1JpZ2h0ID0gMHgwOyAgICAgICAgICAgICAgICAgICAgIC8vIFByaW50IG92ZXIgdGhlbiBkb3duCgogICAgICAgIC8vIFBhZ2Ugb3JpZW50YXRpb24KICAgICAgICAkZkxhbmRzY2FwZSA9ICgkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRPcmllbnRhdGlvbigpID09IFBIUEV4Y2VsX1dvcmtzaGVldF9QYWdlU2V0dXA6Ok9SSUVOVEFUSU9OX0xBTkRTQ0FQRSkgPwogICAgICAgICAgICAweDAgOiAweDE7CgogICAgICAgICRmTm9QbHMgICAgICAgPSAweDA7ICAgICAgICAgICAgICAgICAgICAgLy8gU2V0dXAgbm90IHJlYWQgZnJvbSBwcmludGVyCiAgICAgICAgJGZOb0NvbG9yICAgICA9IDB4MDsgICAgICAgICAgICAgICAgICAgICAvLyBQcmludCBibGFjayBhbmQgd2hpdGUKICAgICAgICAkZkRyYWZ0ICAgICAgID0gMHgwOyAgICAgICAgICAgICAgICAgICAgIC8vIFByaW50IGRyYWZ0IHF1YWxpdHkKICAgICAgICAkZk5vdGVzICAgICAgID0gMHgwOyAgICAgICAgICAgICAgICAgICAgIC8vIFByaW50IG5vdGVzCiAgICAgICAgJGZOb09yaWVudCAgICA9IDB4MDsgICAgICAgICAgICAgICAgICAgICAvLyBPcmllbnRhdGlvbiBub3Qgc2V0CiAgICAgICAgJGZVc2VQYWdlICAgICA9IDB4MDsgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgY3VzdG9tIHN0YXJ0aW5nIHBhZ2UKCiAgICAgICAgJGdyYml0ICAgICAgICAgICA9ICRmTGVmdFRvUmlnaHQ7CiAgICAgICAgJGdyYml0ICAgICAgICAgIHw9ICRmTGFuZHNjYXBlICAgIDw8IDE7CiAgICAgICAgJGdyYml0ICAgICAgICAgIHw9ICRmTm9QbHMgICAgICAgIDw8IDI7CiAgICAgICAgJGdyYml0ICAgICAgICAgIHw9ICRmTm9Db2xvciAgICAgIDw8IDM7CiAgICAgICAgJGdyYml0ICAgICAgICAgIHw9ICRmRHJhZnQgICAgICAgIDw8IDQ7CiAgICAgICAgJGdyYml0ICAgICAgICAgIHw9ICRmTm90ZXMgICAgICAgIDw8IDU7CiAgICAgICAgJGdyYml0ICAgICAgICAgIHw9ICRmTm9PcmllbnQgICAgIDw8IDY7CiAgICAgICAgJGdyYml0ICAgICAgICAgIHw9ICRmVXNlUGFnZSAgICAgIDw8IDc7CgogICAgICAgICRudW1IZHIgPSBwYWNrKCJkIiwgJG51bUhkcik7CiAgICAgICAgJG51bUZ0ciA9IHBhY2soImQiLCAkbnVtRnRyKTsKICAgICAgICBpZiAoc2VsZjo6Z2V0Qnl0ZU9yZGVyKCkpIHsgLy8gaWYgaXQncyBCaWcgRW5kaWFuCiAgICAgICAgICAgICRudW1IZHIgPSBzdHJyZXYoJG51bUhkcik7CiAgICAgICAgICAgICRudW1GdHIgPSBzdHJyZXYoJG51bUZ0cik7CiAgICAgICAgfQoKICAgICAgICAkaGVhZGVyID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YTEgID0gcGFjaygidnZ2dnZ2dnYiLCAkaVBhcGVyU2l6ZSwgJGlTY2FsZSwgJGlQYWdlU3RhcnQsICRpRml0V2lkdGgsICRpRml0SGVpZ2h0LCAkZ3JiaXQsICRpUmVzLCAkaVZSZXMpOwogICAgICAgICRkYXRhMiAgPSAkbnVtSGRyLiRudW1GdHI7CiAgICAgICAgJGRhdGEzICA9IHBhY2soInYiLCAkaUNvcGllcyk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGExIC4gJGRhdGEyIC4gJGRhdGEzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBoZWFkZXIgY2FwdGlvbiBCSUZGIHJlY29yZC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZUhlYWRlcigpCiAgICB7CiAgICAgICAgJHJlY29yZCAgPSAweDAwMTQ7ICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKCiAgICAgICAgLyogcmVtb3ZpbmcgZm9yIG5vdwogICAgICAgIC8vIG5lZWQgdG8gZml4IGNoYXJhY3RlciBjb3VudCAobXVsdGlieXRlISkKICAgICAgICBpZiAoc3RybGVuKCR0aGlzLT5waHBTaGVldC0+Z2V0SGVhZGVyRm9vdGVyKCktPmdldE9kZEhlYWRlcigpKSA8PSAyNTUpIHsKICAgICAgICAgICAgJHN0ciAgICAgID0gJHRoaXMtPnBocFNoZWV0LT5nZXRIZWFkZXJGb290ZXIoKS0+Z2V0T2RkSGVhZGVyKCk7ICAgICAgIC8vIGhlYWRlciBzdHJpbmcKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc3RyID0gJyc7CiAgICAgICAgfQogICAgICAgICovCgogICAgICAgICRyZWNvcmREYXRhID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6VVRGOHRvQklGRjhVbmljb2RlTG9uZygkdGhpcy0+cGhwU2hlZXQtPmdldEhlYWRlckZvb3RlcigpLT5nZXRPZGRIZWFkZXIoKSk7CiAgICAgICAgJGxlbmd0aCA9IHN0cmxlbigkcmVjb3JkRGF0YSk7CgogICAgICAgICRoZWFkZXIgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CgogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRyZWNvcmREYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBmb290ZXIgY2FwdGlvbiBCSUZGIHJlY29yZC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZUZvb3RlcigpCiAgICB7CiAgICAgICAgJHJlY29yZCAgPSAweDAwMTU7ICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKCiAgICAgICAgLyogcmVtb3ZpbmcgZm9yIG5vdwogICAgICAgIC8vIG5lZWQgdG8gZml4IGNoYXJhY3RlciBjb3VudCAobXVsdGlieXRlISkKICAgICAgICBpZiAoc3RybGVuKCR0aGlzLT5waHBTaGVldC0+Z2V0SGVhZGVyRm9vdGVyKCktPmdldE9kZEZvb3RlcigpKSA8PSAyNTUpIHsKICAgICAgICAgICAgJHN0ciA9ICR0aGlzLT5waHBTaGVldC0+Z2V0SGVhZGVyRm9vdGVyKCktPmdldE9kZEZvb3RlcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzdHIgPSAnJzsKICAgICAgICB9CiAgICAgICAgKi8KCiAgICAgICAgJHJlY29yZERhdGEgPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpVVEY4dG9CSUZGOFVuaWNvZGVMb25nKCR0aGlzLT5waHBTaGVldC0+Z2V0SGVhZGVyRm9vdGVyKCktPmdldE9kZEZvb3RlcigpKTsKICAgICAgICAkbGVuZ3RoID0gc3RybGVuKCRyZWNvcmREYXRhKTsKCiAgICAgICAgJGhlYWRlciAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CgogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRyZWNvcmREYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBob3Jpem9udGFsIGNlbnRlcmluZyBIQ0VOVEVSIEJJRkYgcmVjb3JkLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlSGNlbnRlcigpCiAgICB7CiAgICAgICAgJHJlY29yZCAgID0gMHgwMDgzOyAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICAgPSAweDAwMDI7ICAgICAgICAgICAgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGZIQ2VudGVyID0gJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlU2V0dXAoKS0+Z2V0SG9yaXpvbnRhbENlbnRlcmVkKCkgPyAxIDogMDsgICAgIC8vIEhvcml6b250YWwgY2VudGVyaW5nCgogICAgICAgICRoZWFkZXIgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgPSBwYWNrKCJ2IiwgJGZIQ2VudGVyKTsKCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyLiRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSB2ZXJ0aWNhbCBjZW50ZXJpbmcgVkNFTlRFUiBCSUZGIHJlY29yZC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVZjZW50ZXIoKQogICAgewogICAgICAgICRyZWNvcmQgICA9IDB4MDA4NDsgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgID0gMHgwMDAyOyAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICRmVkNlbnRlciA9ICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZVNldHVwKCktPmdldFZlcnRpY2FsQ2VudGVyZWQoKSA\/IDEgOiAwOyAgICAgLy8gSG9yaXpvbnRhbCBjZW50ZXJpbmcKCiAgICAgICAgJGhlYWRlciAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICA9IHBhY2soInYiLCAkZlZDZW50ZXIpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBMRUZUTUFSR0lOIEJJRkYgcmVjb3JkLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlTWFyZ2luTGVmdCgpCiAgICB7CiAgICAgICAgJHJlY29yZCAgPSAweDAwMjY7ICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgPSAweDAwMDg7ICAgICAgICAgICAgICAgICAgIC8vIEJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAkbWFyZ2luICA9ICR0aGlzLT5waHBTaGVldC0+Z2V0UGFnZU1hcmdpbnMoKS0+Z2V0TGVmdCgpOyAgICAgLy8gTWFyZ2luIGluIGluY2hlcwoKICAgICAgICAkaGVhZGVyICAgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICAgID0gcGFjaygiZCIsICRtYXJnaW4pOwogICAgICAgIGlmIChzZWxmOjpnZXRCeXRlT3JkZXIoKSkgeyAvLyBpZiBpdCdzIEJpZyBFbmRpYW4KICAgICAgICAgICAgJGRhdGEgPSBzdHJyZXYoJGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIFJJR0hUTUFSR0lOIEJJRkYgcmVjb3JkLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlTWFyZ2luUmlnaHQoKQogICAgewogICAgICAgICRyZWNvcmQgID0gMHgwMDI3OyAgICAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggID0gMHgwMDA4OyAgICAgICAgICAgICAgICAgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJG1hcmdpbiAgPSAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPmdldFJpZ2h0KCk7ICAgICAvLyBNYXJnaW4gaW4gaW5jaGVzCgogICAgICAgICRoZWFkZXIgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgPSBwYWNrKCJkIiwgJG1hcmdpbik7CiAgICAgICAgaWYgKHNlbGY6OmdldEJ5dGVPcmRlcigpKSB7IC8vIGlmIGl0J3MgQmlnIEVuZGlhbgogICAgICAgICAgICAkZGF0YSA9IHN0cnJldigkZGF0YSk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9yZSB0aGUgVE9QTUFSR0lOIEJJRkYgcmVjb3JkLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlTWFyZ2luVG9wKCkKICAgIHsKICAgICAgICAkcmVjb3JkICA9IDB4MDAyODsgICAgICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICA9IDB4MDAwODsgICAgICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICRtYXJnaW4gID0gJHRoaXMtPnBocFNoZWV0LT5nZXRQYWdlTWFyZ2lucygpLT5nZXRUb3AoKTsgICAgIC8vIE1hcmdpbiBpbiBpbmNoZXMKCiAgICAgICAgJGhlYWRlciAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICA9IHBhY2soImQiLCAkbWFyZ2luKTsKICAgICAgICBpZiAoc2VsZjo6Z2V0Qnl0ZU9yZGVyKCkpIHsgLy8gaWYgaXQncyBCaWcgRW5kaWFuCiAgICAgICAgICAgICRkYXRhID0gc3RycmV2KCRkYXRhKTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSBCT1RUT01NQVJHSU4gQklGRiByZWNvcmQuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVNYXJnaW5Cb3R0b20oKQogICAgewogICAgICAgICRyZWNvcmQgID0gMHgwMDI5OyAgICAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggID0gMHgwMDA4OyAgICAgICAgICAgICAgICAgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJG1hcmdpbiAgPSAkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPmdldEJvdHRvbSgpOyAgICAgLy8gTWFyZ2luIGluIGluY2hlcwoKICAgICAgICAkaGVhZGVyICAgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAkZGF0YSAgICAgID0gcGFjaygiZCIsICRtYXJnaW4pOwogICAgICAgIGlmIChzZWxmOjpnZXRCeXRlT3JkZXIoKSkgeyAvLyBpZiBpdCdzIEJpZyBFbmRpYW4KICAgICAgICAgICAgJGRhdGEgPSBzdHJyZXYoJGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIFBSSU5USEVBREVSUyBCSUZGIHJlY29yZC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVByaW50SGVhZGVycygpCiAgICB7CiAgICAgICAgJHJlY29yZCAgICAgID0gMHgwMDJhOyAgICAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICA9IDB4MDAwMjsgICAgICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICRmUHJpbnRSd0NvbCA9ICR0aGlzLT5fcHJpbnRfaGVhZGVyczsgICAgIC8vIEJvb2xlYW4gZmxhZwoKICAgICAgICAkaGVhZGVyICAgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgICA9IHBhY2soInYiLCAkZlByaW50UndDb2wpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBQUklOVEdSSURMSU5FUyBCSUZGIHJlY29yZC4gTXVzdCBiZSB1c2VkIGluIGNvbmp1bmN0aW9uIHdpdGggdGhlCiAgICAgKiBHUklEU0VUIHJlY29yZC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVByaW50R3JpZGxpbmVzKCkKICAgIHsKICAgICAgICAkcmVjb3JkICAgICAgPSAweDAwMmI7ICAgICAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICA9IDB4MDAwMjsgICAgICAgICAgICAgICAgICAgIC8vIEJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAkZlByaW50R3JpZCAgPSAkdGhpcy0+cGhwU2hlZXQtPmdldFByaW50R3JpZGxpbmVzKCkgPyAxIDogMDsgICAgLy8gQm9vbGVhbiBmbGFnCgogICAgICAgICRoZWFkZXIgICAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICA9IHBhY2soInYiLCAkZlByaW50R3JpZCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIEdSSURTRVQgQklGRiByZWNvcmQuIE11c3QgYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIHRoZQogICAgICogUFJJTlRHUklETElORVMgcmVjb3JkLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlR3JpZHNldCgpCiAgICB7CiAgICAgICAgJHJlY29yZCAgICAgID0gMHgwMDgyOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICAgID0gMHgwMDAyOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAkZkdyaWRTZXQgICAgPSAhJHRoaXMtPnBocFNoZWV0LT5nZXRQcmludEdyaWRsaW5lcygpOyAgICAgLy8gQm9vbGVhbiBmbGFnCgogICAgICAgICRoZWFkZXIgICAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICAgID0gcGFjaygidiIsICRmR3JpZFNldCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIEFVVE9GSUxURVJJTkZPIEJJRkYgcmVjb3JkLiBUaGlzIGlzIHVzZWQgdG8gY29uZmlndXJlIHRoZSBudW1iZXIgb2YgYXV0b2ZpbHRlciBzZWxlY3QgdXNlZCBpbiB0aGUgc2hlZXQuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVBdXRvRmlsdGVySW5mbygpCiAgICB7CiAgICAgICAgJHJlY29yZCAgICAgID0gMHgwMDlEOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICAgID0gMHgwMDAyOyAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJ5dGVzIHRvIGZvbGxvdwoKICAgICAgICAkcmFuZ2VCb3VuZHMgPSBQSFBFeGNlbF9DZWxsOjpyYW5nZUJvdW5kYXJpZXMoJHRoaXMtPnBocFNoZWV0LT5nZXRBdXRvRmlsdGVyKCktPmdldFJhbmdlKCkpOwogICAgICAgICRpTnVtRmlsdGVycyA9IDEgKyAkcmFuZ2VCb3VuZHNbMV1bMF0gLSAkcmFuZ2VCb3VuZHNbMF1bMF07CgogICAgICAgICRoZWFkZXIgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgID0gcGFjaygidiIsICRpTnVtRmlsdGVycyk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIEdVVFMgQklGRiByZWNvcmQuIFRoaXMgaXMgdXNlZCB0byBjb25maWd1cmUgdGhlIGd1dHRlciBtYXJnaW5zCiAgICAgKiB3aGVyZSBFeGNlbCBvdXRsaW5lIHN5bWJvbHMgYXJlIGRpc3BsYXllZC4gVGhlIHZpc2liaWxpdHkgb2YgdGhlIGd1dHRlcnMgaXMKICAgICAqIGNvbnRyb2xsZWQgYnkgYSBmbGFnIGluIFdTQk9PTC4KICAgICAqCiAgICAgKiBAc2VlIHdyaXRlV3Nib29sKCkKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZUd1dHMoKQogICAgewogICAgICAgICRyZWNvcmQgICAgICA9IDB4MDA4MDsgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICA9IDB4MDAwODsgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGR4UndHdXQgICAgID0gMHgwMDAwOyAgIC8vIFNpemUgb2Ygcm93IGd1dHRlcgogICAgICAgICRkeENvbEd1dCAgICA9IDB4MDAwMDsgICAvLyBTaXplIG9mIGNvbCBndXR0ZXIKCiAgICAgICAgLy8gZGV0ZXJtaW5lIG1heGltdW0gcm93IG91dGxpbmUgbGV2ZWwKICAgICAgICAkbWF4Um93T3V0bGluZUxldmVsID0gMDsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+cGhwU2hlZXQtPmdldFJvd0RpbWVuc2lvbnMoKSBhcyAkcm93RGltZW5zaW9uKSB7CiAgICAgICAgICAgICRtYXhSb3dPdXRsaW5lTGV2ZWwgPSBtYXgoJG1heFJvd091dGxpbmVMZXZlbCwgJHJvd0RpbWVuc2lvbi0+Z2V0T3V0bGluZUxldmVsKCkpOwogICAgICAgIH0KCiAgICAgICAgJGNvbF9sZXZlbCAgID0gMDsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBtYXhpbXVtIGNvbHVtbiBvdXRsaW5lIGxldmVsLiBUaGUgZXF1aXZhbGVudCBjYWxjdWxhdGlvbgogICAgICAgIC8vIGZvciB0aGUgcm93IG91dGxpbmUgbGV2ZWwgaXMgY2FycmllZCBvdXQgaW4gd3JpdGVSb3coKS4KICAgICAgICAkY29sY291bnQgPSBjb3VudCgkdGhpcy0+Y29sdW1uSW5mbyk7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGNvbGNvdW50OyArKyRpKSB7CiAgICAgICAgICAgICRjb2xfbGV2ZWwgPSBtYXgoJHRoaXMtPmNvbHVtbkluZm9bJGldWzVdLCAkY29sX2xldmVsKTsKICAgICAgICB9CgogICAgICAgIC8vIFNldCB0aGUgbGltaXRzIGZvciB0aGUgb3V0bGluZSBsZXZlbHMgKDAgPD0geCA8PSA3KS4KICAgICAgICAkY29sX2xldmVsID0gbWF4KDAsIG1pbigkY29sX2xldmVsLCA3KSk7CgogICAgICAgIC8vIFRoZSBkaXNwbGF5ZWQgbGV2ZWwgaXMgb25lIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IG91dGxpbmUgbGV2ZWxzCiAgICAgICAgaWYgKCRtYXhSb3dPdXRsaW5lTGV2ZWwpIHsKICAgICAgICAgICAgKyskbWF4Um93T3V0bGluZUxldmVsOwogICAgICAgIH0KICAgICAgICBpZiAoJGNvbF9sZXZlbCkgewogICAgICAgICAgICArKyRjb2xfbGV2ZWw7CiAgICAgICAgfQoKICAgICAgICAkaGVhZGVyICAgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgICA9IHBhY2soInZ2dnYiLCAkZHhSd0d1dCwgJGR4Q29sR3V0LCAkbWF4Um93T3V0bGluZUxldmVsLCAkY29sX2xldmVsKTsKCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyLiRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSBXU0JPT0wgQklGRiByZWNvcmQsIG1haW5seSBmb3IgZml0LXRvLXBhZ2UuIFVzZWQgaW4gY29uanVuY3Rpb24KICAgICAqIHdpdGggdGhlIFNFVFVQIHJlY29yZC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVdzYm9vbCgpCiAgICB7CiAgICAgICAgJHJlY29yZCAgICAgID0gMHgwMDgxOyAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgJGxlbmd0aCAgICAgID0gMHgwMDAyOyAgIC8vIEJ5dGVzIHRvIGZvbGxvdwogICAgICAgICRncmJpdCAgICAgICA9IDB4MDAwMDsKCiAgICAgICAgLy8gVGhlIG9ubHkgb3B0aW9uIHRoYXQgaXMgb2YgaW50ZXJlc3QgaXMgdGhlIGZsYWcgZm9yIGZpdCB0byBwYWdlLiBTbyB3ZQogICAgICAgIC8vIHNldCBhbGwgdGhlIG9wdGlvbnMgaW4gb25lIGdvLgogICAgICAgIC8vCiAgICAgICAgLy8gU2V0IHRoZSBvcHRpb24gZmxhZ3MKICAgICAgICAkZ3JiaXQgfD0gMHgwMDAxOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEF1dG8gcGFnZSBicmVha3MgdmlzaWJsZQogICAgICAgIGlmICgkdGhpcy0+b3V0bGluZVN0eWxlKSB7CiAgICAgICAgICAgICRncmJpdCB8PSAweDAwMjA7IC8vIEF1dG8gb3V0bGluZSBzdHlsZXMKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5waHBTaGVldC0+Z2V0U2hvd1N1bW1hcnlCZWxvdygpKSB7CiAgICAgICAgICAgICRncmJpdCB8PSAweDAwNDA7IC8vIE91dGxpbmUgc3VtbWFyeSBiZWxvdwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPnBocFNoZWV0LT5nZXRTaG93U3VtbWFyeVJpZ2h0KCkpIHsKICAgICAgICAgICAgJGdyYml0IHw9IDB4MDA4MDsgLy8gT3V0bGluZSBzdW1tYXJ5IHJpZ2h0CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+cGhwU2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5nZXRGaXRUb1BhZ2UoKSkgewogICAgICAgICAgICAkZ3JiaXQgfD0gMHgwMTAwOyAvLyBQYWdlIHNldHVwIGZpdCB0byBwYWdlCiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+b3V0bGluZU9uKSB7CiAgICAgICAgICAgICRncmJpdCB8PSAweDA0MDA7IC8vIE91dGxpbmUgc3ltYm9scyBkaXNwbGF5ZWQKICAgICAgICB9CgogICAgICAgICRoZWFkZXIgICAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICAgID0gcGFjaygidiIsICRncmJpdCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgdGhlIEhPUklaT05UQUxQQUdFQlJFQUtTIGFuZCBWRVJUSUNBTFBBR0VCUkVBS1MgQklGRiByZWNvcmRzLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlQnJlYWtzKCkKICAgIHsKICAgICAgICAvLyBpbml0aWFsaXplCiAgICAgICAgJHZicmVha3MgPSBhcnJheSgpOwogICAgICAgICRoYnJlYWtzID0gYXJyYXkoKTsKCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnBocFNoZWV0LT5nZXRCcmVha3MoKSBhcyAkY2VsbCA9PiAkYnJlYWtUeXBlKSB7CiAgICAgICAgICAgIC8vIEZldGNoIGNvb3JkaW5hdGVzCiAgICAgICAgICAgICRjb29yZGluYXRlcyA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRjZWxsKTsKCiAgICAgICAgICAgIC8vIERlY2lkZSB3aGF0IHRvIGRvIGJ5IHRoZSB0eXBlIG9mIGJyZWFrCiAgICAgICAgICAgIHN3aXRjaCAoJGJyZWFrVHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLX0NPTFVNTjoKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdG8gbGlzdCBvZiB2ZXJ0aWNhbCBicmVha3MKICAgICAgICAgICAgICAgICAgICAkdmJyZWFrc1tdID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRjb29yZGluYXRlc1swXSkgLSAxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLX1JPVzoKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdG8gbGlzdCBvZiBob3Jpem9udGFsIGJyZWFrcwogICAgICAgICAgICAgICAgICAgICRoYnJlYWtzW10gPSAkY29vcmRpbmF0ZXNbMV07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldDo6QlJFQUtfTk9ORToKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgLy8gTm90aGluZyB0byBkbwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL2hvcml6b250YWwgcGFnZSBicmVha3MKICAgICAgICBpZiAoIWVtcHR5KCRoYnJlYWtzKSkgewogICAgICAgICAgICAvLyBTb3J0IGFuZCBmaWx0ZXIgYXJyYXkgb2YgcGFnZSBicmVha3MKICAgICAgICAgICAgc29ydCgkaGJyZWFrcywgU09SVF9OVU1FUklDKTsKICAgICAgICAgICAgaWYgKCRoYnJlYWtzWzBdID09IDApIHsgLy8gZG9uJ3QgdXNlIGZpcnN0IGJyZWFrIGlmIGl0J3MgMAogICAgICAgICAgICAgICAgYXJyYXlfc2hpZnQoJGhicmVha3MpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkcmVjb3JkICA9IDB4MDAxYjsgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICAgICAkY2JyayAgICA9IGNvdW50KCRoYnJlYWtzKTsgICAgICAgLy8gTnVtYmVyIG9mIHBhZ2UgYnJlYWtzCiAgICAgICAgICAgICRsZW5ndGggID0gMiArIDYgKiAkY2JyazsgICAgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgICAgICRoZWFkZXIgID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKICAgICAgICAgICAgJGRhdGEgICAgPSBwYWNrKCJ2IiwgJGNicmspOwoKICAgICAgICAgICAgLy8gQXBwZW5kIGVhY2ggcGFnZSBicmVhawogICAgICAgICAgICBmb3JlYWNoICgkaGJyZWFrcyBhcyAkaGJyZWFrKSB7CiAgICAgICAgICAgICAgICAkZGF0YSAuPSBwYWNrKCJ2dnYiLCAkaGJyZWFrLCAweDAwMDAsIDB4MDBmZik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgICAgICB9CgogICAgICAgIC8vIHZlcnRpY2FsIHBhZ2UgYnJlYWtzCiAgICAgICAgaWYgKCFlbXB0eSgkdmJyZWFrcykpIHsKICAgICAgICAgICAgLy8gMTAwMCB2ZXJ0aWNhbCBwYWdlYnJlYWtzIGFwcGVhcnMgdG8gYmUgYW4gaW50ZXJuYWwgRXhjZWwgNSBsaW1pdC4KICAgICAgICAgICAgLy8gSXQgaXMgc2xpZ2h0bHkgaGlnaGVyIGluIEV4Y2VsIDk3LzIwMCwgYXBwcm94LiAxMDI2CiAgICAgICAgICAgICR2YnJlYWtzID0gYXJyYXlfc2xpY2UoJHZicmVha3MsIDAsIDEwMDApOwoKICAgICAgICAgICAgLy8gU29ydCBhbmQgZmlsdGVyIGFycmF5IG9mIHBhZ2UgYnJlYWtzCiAgICAgICAgICAgIHNvcnQoJHZicmVha3MsIFNPUlRfTlVNRVJJQyk7CiAgICAgICAgICAgIGlmICgkdmJyZWFrc1swXSA9PSAwKSB7IC8vIGRvbid0IHVzZSBmaXJzdCBicmVhayBpZiBpdCdzIDAKICAgICAgICAgICAgICAgIGFycmF5X3NoaWZ0KCR2YnJlYWtzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHJlY29yZCAgPSAweDAwMWE7ICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAgICAgJGNicmsgICAgPSBjb3VudCgkdmJyZWFrcyk7ICAgICAgIC8vIE51bWJlciBvZiBwYWdlIGJyZWFrcwogICAgICAgICAgICAkbGVuZ3RoICA9IDIgKyA2ICogJGNicms7ICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICAgICAkaGVhZGVyICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgICAgICRkYXRhICAgID0gcGFjaygidiIsICRjYnJrKTsKCiAgICAgICAgICAgIC8vIEFwcGVuZCBlYWNoIHBhZ2UgYnJlYWsKICAgICAgICAgICAgZm9yZWFjaCAoJHZicmVha3MgYXMgJHZicmVhaykgewogICAgICAgICAgICAgICAgJGRhdGEgLj0gcGFjaygidnZ2IiwgJHZicmVhaywgMHgwMDAwLCAweGZmZmYpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkZGF0YSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBCaWZmIFBST1RFQ1QgcmVjb3JkIHRvIGluZGljYXRlIHRoYXQgdGhlIHdvcmtzaGVldCBpcyBwcm90ZWN0ZWQuCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVQcm90ZWN0KCkKICAgIHsKICAgICAgICAvLyBFeGl0IHVubGVzcyBzaGVldCBwcm90ZWN0aW9uIGhhcyBiZWVuIHNwZWNpZmllZAogICAgICAgIGlmICghJHRoaXMtPnBocFNoZWV0LT5nZXRQcm90ZWN0aW9uKCktPmdldFNoZWV0KCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgJHJlY29yZCAgICAgID0gMHgwMDEyOyAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICA9IDB4MDAwMjsgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICRmTG9jayAgICAgID0gMTsgICAgLy8gV29ya3NoZWV0IGlzIHByb3RlY3RlZAoKICAgICAgICAkaGVhZGVyICAgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgPSBwYWNrKCJ2IiwgJGZMb2NrKTsKCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyLiRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIFNDRU5QUk9URUNUCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVTY2VuUHJvdGVjdCgpCiAgICB7CiAgICAgICAgLy8gRXhpdCBpZiBzaGVldCBwcm90ZWN0aW9uIGlzIG5vdCBhY3RpdmUKICAgICAgICBpZiAoISR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRTaGVldCgpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIEV4aXQgaWYgc2NlbmFyaW9zIGFyZSBub3QgcHJvdGVjdGVkCiAgICAgICAgaWYgKCEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0U2NlbmFyaW9zKCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgJHJlY29yZCA9IDB4MDBERDsgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoID0gMHgwMDAyOyAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGhlYWRlciA9IHBhY2soJ3Z2JywgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgPSBwYWNrKCd2JywgMSk7CgogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIE9CSkVDVFBST1RFQ1QKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZU9iamVjdFByb3RlY3QoKQogICAgewogICAgICAgIC8vIEV4aXQgaWYgc2hlZXQgcHJvdGVjdGlvbiBpcyBub3QgYWN0aXZlCiAgICAgICAgaWYgKCEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0U2hlZXQoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBFeGl0IGlmIG9iamVjdHMgYXJlIG5vdCBwcm90ZWN0ZWQKICAgICAgICBpZiAoISR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRPYmplY3RzKCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgJHJlY29yZCA9IDB4MDA2MzsgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoID0gMHgwMDAyOyAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGhlYWRlciA9IHBhY2soJ3Z2JywgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgPSBwYWNrKCd2JywgMSk7CgogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIHRoZSB3b3Jrc2hlZXQgUEFTU1dPUkQgcmVjb3JkLgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlUGFzc3dvcmQoKQogICAgewogICAgICAgIC8vIEV4aXQgdW5sZXNzIHNoZWV0IHByb3RlY3Rpb24gYW5kIHBhc3N3b3JkIGhhdmUgYmVlbiBzcGVjaWZpZWQKICAgICAgICBpZiAoISR0aGlzLT5waHBTaGVldC0+Z2V0UHJvdGVjdGlvbigpLT5nZXRTaGVldCgpIHx8ICEkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0UGFzc3dvcmQoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAkcmVjb3JkICAgICAgPSAweDAwMTM7ICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICAgICAgPSAweDAwMDI7ICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICR3UGFzc3dvcmQgICA9IGhleGRlYygkdGhpcy0+cGhwU2hlZXQtPmdldFByb3RlY3Rpb24oKS0+Z2V0UGFzc3dvcmQoKSk7ICAgICAvLyBFbmNvZGVkIHBhc3N3b3JkCgogICAgICAgICRoZWFkZXIgICAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICAgID0gcGFjaygidiIsICR3UGFzc3dvcmQpOwoKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnNlcnQgYSAyNGJpdCBiaXRtYXAgaW1hZ2UgaW4gYSB3b3Jrc2hlZXQuCiAgICAgKgogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyb3cgICAgIFRoZSByb3cgd2UgYXJlIGdvaW5nIHRvIGluc2VydCB0aGUgYml0bWFwIGludG8KICAgICAqIEBwYXJhbSBpbnRlZ2VyICRjb2wgICAgIFRoZSBjb2x1bW4gd2UgYXJlIGdvaW5nIHRvIGluc2VydCB0aGUgYml0bWFwIGludG8KICAgICAqIEBwYXJhbSBtaXhlZCAgICRiaXRtYXAgIFRoZSBiaXRtYXAgZmlsZW5hbWUgb3IgR0QtaW1hZ2UgcmVzb3VyY2UKICAgICAqIEBwYXJhbSBpbnRlZ2VyICR4ICAgICAgIFRoZSBob3Jpem9udGFsIHBvc2l0aW9uIChvZmZzZXQpIG9mIHRoZSBpbWFnZSBpbnNpZGUgdGhlIGNlbGwuCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkeSAgICAgICBUaGUgdmVydGljYWwgcG9zaXRpb24gKG9mZnNldCkgb2YgdGhlIGltYWdlIGluc2lkZSB0aGUgY2VsbC4KICAgICAqIEBwYXJhbSBmbG9hdCAgICRzY2FsZV94IFRoZSBob3Jpem9udGFsIHNjYWxlCiAgICAgKiBAcGFyYW0gZmxvYXQgICAkc2NhbGVfeSBUaGUgdmVydGljYWwgc2NhbGUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGluc2VydEJpdG1hcCgkcm93LCAkY29sLCAkYml0bWFwLCAkeCA9IDAsICR5ID0gMCwgJHNjYWxlX3ggPSAxLCAkc2NhbGVfeSA9IDEpCiAgICB7CiAgICAgICAgJGJpdG1hcF9hcnJheSA9IChpc19yZXNvdXJjZSgkYml0bWFwKSA\/ICR0aGlzLT5wcm9jZXNzQml0bWFwR2QoJGJpdG1hcCkgOiAkdGhpcy0+cHJvY2Vzc0JpdG1hcCgkYml0bWFwKSk7CiAgICAgICAgbGlzdCgkd2lkdGgsICRoZWlnaHQsICRzaXplLCAkZGF0YSkgPSAkYml0bWFwX2FycmF5OyAvLyR0aGlzLT5wcm9jZXNzQml0bWFwKCRiaXRtYXApOwoKICAgICAgICAvLyBTY2FsZSB0aGUgZnJhbWUgb2YgdGhlIGltYWdlLgogICAgICAgICR3aWR0aCAgKj0gJHNjYWxlX3g7CiAgICAgICAgJGhlaWdodCAqPSAkc2NhbGVfeTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSB2ZXJ0aWNlcyBvZiB0aGUgaW1hZ2UgYW5kIHdyaXRlIHRoZSBPQkogcmVjb3JkCiAgICAgICAgJHRoaXMtPnBvc2l0aW9uSW1hZ2UoJGNvbCwgJHJvdywgJHgsICR5LCAkd2lkdGgsICRoZWlnaHQpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgSU1EQVRBIHJlY29yZCB0byBzdG9yZSB0aGUgYml0bWFwIGRhdGEKICAgICAgICAkcmVjb3JkICAgICAgPSAweDAwN2Y7CiAgICAgICAgJGxlbmd0aCAgICAgID0gOCArICRzaXplOwogICAgICAgICRjZiAgICAgICAgICA9IDB4MDk7CiAgICAgICAgJGVudiAgICAgICAgID0gMHgwMTsKICAgICAgICAkbGNiICAgICAgICAgPSAkc2l6ZTsKCiAgICAgICAgJGhlYWRlciAgICAgID0gcGFjaygidnZ2dlYiLCAkcmVjb3JkLCAkbGVuZ3RoLCAkY2YsICRlbnYsICRsY2IpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlci4kZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIHZlcnRpY2VzIHRoYXQgZGVmaW5lIHRoZSBwb3NpdGlvbiBvZiB0aGUgaW1hZ2UgYXMgcmVxdWlyZWQgYnkKICAgICAqIHRoZSBPQkogcmVjb3JkLgogICAgICoKICAgICAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0rCiAgICAgKiAgICAgICAgIHwgICAgIEEgICAgICB8ICAgICAgQiAgICAgfAogICAgICogICArLS0tLS0rLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLSsKICAgICAqICAgfCAgICAgfCh4MSx5MSkgICAgIHwgICAgICAgICAgICB8CiAgICAgKiAgIHwgIDEgIHwoQTEpLl9fX19fX198X19fX19fICAgICAgfAogICAgICogICB8ICAgICB8ICAgIHwgICAgICAgICAgICAgIHwgICAgIHwKICAgICAqICAgfCAgICAgfCAgICB8ICAgICAgICAgICAgICB8ICAgICB8CiAgICAgKiAgICstLS0tLSstLS0tfCAgICBCSVRNQVAgICAgfC0tLS0tKwogICAgICogICB8ICAgICB8ICAgIHwgICAgICAgICAgICAgIHwgICAgIHwKICAgICAqICAgfCAgMiAgfCAgICB8X19fX19fX19fX19fX18uICAgICB8CiAgICAgKiAgIHwgICAgIHwgICAgICAgICAgICB8ICAgICAgICAoQjIpfAogICAgICogICB8ICAgICB8ICAgICAgICAgICAgfCAgICAgKHgyLHkyKXwKICAgICAqICAgKy0tLS0gKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0rCiAgICAgKgogICAgICogRXhhbXBsZSBvZiBhIGJpdG1hcCB0aGF0IGNvdmVycyBzb21lIG9mIHRoZSBhcmVhIGZyb20gY2VsbCBBMSB0byBjZWxsIEIyLgogICAgICoKICAgICAqIEJhc2VkIG9uIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBiaXRtYXAgd2UgbmVlZCB0byBjYWxjdWxhdGUgOCB2YXJzOgogICAgICogICAgICRjb2xfc3RhcnQsICRyb3dfc3RhcnQsICRjb2xfZW5kLCAkcm93X2VuZCwgJHgxLCAkeTEsICR4MiwgJHkyLgogICAgICogVGhlIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIGNlbGxzIGFyZSBhbHNvIHZhcmlhYmxlIGFuZCBoYXZlIHRvIGJlIHRha2VuIGludG8KICAgICAqIGFjY291bnQuCiAgICAgKiBUaGUgdmFsdWVzIG9mICRjb2xfc3RhcnQgYW5kICRyb3dfc3RhcnQgYXJlIHBhc3NlZCBpbiBmcm9tIHRoZSBjYWxsaW5nCiAgICAgKiBmdW5jdGlvbi4gVGhlIHZhbHVlcyBvZiAkY29sX2VuZCBhbmQgJHJvd19lbmQgYXJlIGNhbGN1bGF0ZWQgYnkgc3VidHJhY3RpbmcKICAgICAqIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBiaXRtYXAgZnJvbSB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUKICAgICAqIHVuZGVybHlpbmcgY2VsbHMuCiAgICAgKiBUaGUgdmVydGljZXMgYXJlIGV4cHJlc3NlZCBhcyBhIHBlcmNlbnRhZ2Ugb2YgdGhlIHVuZGVybHlpbmcgY2VsbCB3aWR0aCBhcwogICAgICogZm9sbG93cyAocmhzIHZhbHVlcyBhcmUgaW4gcGl4ZWxzKToKICAgICAqCiAgICAgKiAgICAgICB4MSA9IFggLyBXICoxMDI0CiAgICAgKiAgICAgICB5MSA9IFkgLyBIICoyNTYKICAgICAqICAgICAgIHgyID0gKFgtMSkgLyBXICoxMDI0CiAgICAgKiAgICAgICB5MiA9IChZLTEpIC8gSCAqMjU2CiAgICAgKgogICAgICogICAgICAgV2hlcmU6ICBYIGlzIGRpc3RhbmNlIGZyb20gdGhlIGxlZnQgc2lkZSBvZiB0aGUgdW5kZXJseWluZyBjZWxsCiAgICAgKiAgICAgICAgICAgICAgIFkgaXMgZGlzdGFuY2UgZnJvbSB0aGUgdG9wIG9mIHRoZSB1bmRlcmx5aW5nIGNlbGwKICAgICAqICAgICAgICAgICAgICAgVyBpcyB0aGUgd2lkdGggb2YgdGhlIGNlbGwKICAgICAqICAgICAgICAgICAgICAgSCBpcyB0aGUgaGVpZ2h0IG9mIHRoZSBjZWxsCiAgICAgKiBUaGUgU0RLIGluY29ycmVjdGx5IHN0YXRlcyB0aGF0IHRoZSBoZWlnaHQgc2hvdWxkIGJlIGV4cHJlc3NlZCBhcyBhCiAgICAgKiAgICAgICAgcGVyY2VudGFnZSBvZiAxMDI0LgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQHBhcmFtIGludGVnZXIgJGNvbF9zdGFydCBDb2wgY29udGFpbmluZyB1cHBlciBsZWZ0IGNvcm5lciBvZiBvYmplY3QKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyb3dfc3RhcnQgUm93IGNvbnRhaW5pbmcgdG9wIGxlZnQgY29ybmVyIG9mIG9iamVjdAogICAgICogQHBhcmFtIGludGVnZXIgJHgxICAgICAgICBEaXN0YW5jZSB0byBsZWZ0IHNpZGUgb2Ygb2JqZWN0CiAgICAgKiBAcGFyYW0gaW50ZWdlciAkeTEgICAgICAgIERpc3RhbmNlIHRvIHRvcCBvZiBvYmplY3QKICAgICAqIEBwYXJhbSBpbnRlZ2VyICR3aWR0aCAgICAgV2lkdGggb2YgaW1hZ2UgZnJhbWUKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRoZWlnaHQgICAgSGVpZ2h0IG9mIGltYWdlIGZyYW1lCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwb3NpdGlvbkltYWdlKCRjb2xfc3RhcnQsICRyb3dfc3RhcnQsICR4MSwgJHkxLCAkd2lkdGgsICRoZWlnaHQpCiAgICB7CiAgICAgICAgLy8gSW5pdGlhbGlzZSBlbmQgY2VsbCB0byB0aGUgc2FtZSBhcyB0aGUgc3RhcnQgY2VsbAogICAgICAgICRjb2xfZW5kICAgID0gJGNvbF9zdGFydDsgIC8vIENvbCBjb250YWluaW5nIGxvd2VyIHJpZ2h0IGNvcm5lciBvZiBvYmplY3QKICAgICAgICAkcm93X2VuZCAgICA9ICRyb3dfc3RhcnQ7ICAvLyBSb3cgY29udGFpbmluZyBib3R0b20gcmlnaHQgY29ybmVyIG9mIG9iamVjdAoKICAgICAgICAvLyBaZXJvIHRoZSBzcGVjaWZpZWQgb2Zmc2V0IGlmIGdyZWF0ZXIgdGhhbiB0aGUgY2VsbCBkaW1lbnNpb25zCiAgICAgICAgaWYgKCR4MSA+PSBQSFBFeGNlbF9TaGFyZWRfRXhjZWw1OjpzaXplQ29sKCR0aGlzLT5waHBTaGVldCwgUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjb2xfc3RhcnQpKSkgewogICAgICAgICAgICAkeDEgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoJHkxID49IFBIUEV4Y2VsX1NoYXJlZF9FeGNlbDU6OnNpemVSb3coJHRoaXMtPnBocFNoZWV0LCAkcm93X3N0YXJ0ICsgMSkpIHsKICAgICAgICAgICAgJHkxID0gMDsKICAgICAgICB9CgogICAgICAgICR3aWR0aCAgICAgID0gJHdpZHRoICArICR4MSAtMTsKICAgICAgICAkaGVpZ2h0ICAgICA9ICRoZWlnaHQgKyAkeTEgLTE7CgogICAgICAgIC8vIFN1YnRyYWN0IHRoZSB1bmRlcmx5aW5nIGNlbGwgd2lkdGhzIHRvIGZpbmQgdGhlIGVuZCBjZWxsIG9mIHRoZSBpbWFnZQogICAgICAgIHdoaWxlICgkd2lkdGggPj0gUEhQRXhjZWxfU2hhcmVkX0V4Y2VsNTo6c2l6ZUNvbCgkdGhpcy0+cGhwU2hlZXQsIFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkY29sX2VuZCkpKSB7CiAgICAgICAgICAgICR3aWR0aCAtPSBQSFBFeGNlbF9TaGFyZWRfRXhjZWw1OjpzaXplQ29sKCR0aGlzLT5waHBTaGVldCwgUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjb2xfZW5kKSk7CiAgICAgICAgICAgICsrJGNvbF9lbmQ7CiAgICAgICAgfQoKICAgICAgICAvLyBTdWJ0cmFjdCB0aGUgdW5kZXJseWluZyBjZWxsIGhlaWdodHMgdG8gZmluZCB0aGUgZW5kIGNlbGwgb2YgdGhlIGltYWdlCiAgICAgICAgd2hpbGUgKCRoZWlnaHQgPj0gUEhQRXhjZWxfU2hhcmVkX0V4Y2VsNTo6c2l6ZVJvdygkdGhpcy0+cGhwU2hlZXQsICRyb3dfZW5kICsgMSkpIHsKICAgICAgICAgICAgJGhlaWdodCAtPSBQSFBFeGNlbF9TaGFyZWRfRXhjZWw1OjpzaXplUm93KCR0aGlzLT5waHBTaGVldCwgJHJvd19lbmQgKyAxKTsKICAgICAgICAgICAgKyskcm93X2VuZDsKICAgICAgICB9CgogICAgICAgIC8vIEJpdG1hcCBpc24ndCBhbGxvd2VkIHRvIHN0YXJ0IG9yIGZpbmlzaCBpbiBhIGhpZGRlbiBjZWxsLCBpLmUuIGEgY2VsbAogICAgICAgIC8vIHdpdGggemVybyBlaWdodCBvciB3aWR0aC4KICAgICAgICAvLwogICAgICAgIGlmIChQSFBFeGNlbF9TaGFyZWRfRXhjZWw1OjpzaXplQ29sKCR0aGlzLT5waHBTaGVldCwgUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjb2xfc3RhcnQpKSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKFBIUEV4Y2VsX1NoYXJlZF9FeGNlbDU6OnNpemVDb2woJHRoaXMtPnBocFNoZWV0LCBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbF9lbmQpKSAgID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoUEhQRXhjZWxfU2hhcmVkX0V4Y2VsNTo6c2l6ZVJvdygkdGhpcy0+cGhwU2hlZXQsICRyb3dfc3RhcnQgKyAxKSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKFBIUEV4Y2VsX1NoYXJlZF9FeGNlbDU6OnNpemVSb3coJHRoaXMtPnBocFNoZWV0LCAkcm93X2VuZCArIDEpICAgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBDb252ZXJ0IHRoZSBwaXhlbCB2YWx1ZXMgdG8gdGhlIHBlcmNlbnRhZ2UgdmFsdWUgZXhwZWN0ZWQgYnkgRXhjZWwKICAgICAgICAkeDEgPSAkeDEgICAgIC8gUEhQRXhjZWxfU2hhcmVkX0V4Y2VsNTo6c2l6ZUNvbCgkdGhpcy0+cGhwU2hlZXQsIFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkY29sX3N0YXJ0KSkgICAqIDEwMjQ7CiAgICAgICAgJHkxID0gJHkxICAgICAvIFBIUEV4Y2VsX1NoYXJlZF9FeGNlbDU6OnNpemVSb3coJHRoaXMtPnBocFNoZWV0LCAkcm93X3N0YXJ0ICsgMSkgICAqICAyNTY7CiAgICAgICAgJHgyID0gJHdpZHRoICAvIFBIUEV4Y2VsX1NoYXJlZF9FeGNlbDU6OnNpemVDb2woJHRoaXMtPnBocFNoZWV0LCBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbF9lbmQpKSAgICAgKiAxMDI0OyAvLyBEaXN0YW5jZSB0byByaWdodCBzaWRlIG9mIG9iamVjdAogICAgICAgICR5MiA9ICRoZWlnaHQgLyBQSFBFeGNlbF9TaGFyZWRfRXhjZWw1OjpzaXplUm93KCR0aGlzLT5waHBTaGVldCwgJHJvd19lbmQgKyAxKSAgICAgKiAgMjU2OyAvLyBEaXN0YW5jZSB0byBib3R0b20gb2Ygb2JqZWN0CgogICAgICAgICR0aGlzLT53cml0ZU9ialBpY3R1cmUoJGNvbF9zdGFydCwgJHgxLCAkcm93X3N0YXJ0LCAkeTEsICRjb2xfZW5kLCAkeDIsICRyb3dfZW5kLCAkeTIpOwogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIE9CSiByZWNvcmQgdGhhdCBwcmVjZWRlcyBhbiBJTURBVEEgcmVjb3JkLiBUaGlzIGNvdWxkIGJlIGdlbmVyYWxpc2UKICAgICAqIHRvIHN1cHBvcnQgb3RoZXIgRXhjZWwgb2JqZWN0cy4KICAgICAqCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkY29sTCBDb2x1bW4gY29udGFpbmluZyB1cHBlciBsZWZ0IGNvcm5lciBvZiBvYmplY3QKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRkeEwgIERpc3RhbmNlIGZyb20gbGVmdCBzaWRlIG9mIGNlbGwKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRyd1QgIFJvdyBjb250YWluaW5nIHRvcCBsZWZ0IGNvcm5lciBvZiBvYmplY3QKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRkeVQgIERpc3RhbmNlIGZyb20gdG9wIG9mIGNlbGwKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRjb2xSIENvbHVtbiBjb250YWluaW5nIGxvd2VyIHJpZ2h0IGNvcm5lciBvZiBvYmplY3QKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRkeFIgIERpc3RhbmNlIGZyb20gcmlnaHQgb2YgY2VsbAogICAgICogQHBhcmFtIGludGVnZXIgJHJ3QiAgUm93IGNvbnRhaW5pbmcgYm90dG9tIHJpZ2h0IGNvcm5lciBvZiBvYmplY3QKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRkeUIgIERpc3RhbmNlIGZyb20gYm90dG9tIG9mIGNlbGwKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZU9ialBpY3R1cmUoJGNvbEwsICRkeEwsICRyd1QsICRkeVQsICRjb2xSLCAkZHhSLCAkcndCLCAkZHlCKQogICAgewogICAgICAgICRyZWNvcmQgICAgICA9IDB4MDA1ZDsgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICA9IDB4MDAzYzsgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJGNPYmogICAgICAgID0gMHgwMDAxOyAgIC8vIENvdW50IG9mIG9iamVjdHMgaW4gZmlsZSAoc2V0IHRvIDEpCiAgICAgICAgJE9UICAgICAgICAgID0gMHgwMDA4OyAgIC8vIE9iamVjdCB0eXBlLiA4ID0gUGljdHVyZQogICAgICAgICRpZCAgICAgICAgICA9IDB4MDAwMTsgICAvLyBPYmplY3QgSUQKICAgICAgICAkZ3JiaXQgICAgICAgPSAweDA2MTQ7ICAgLy8gT3B0aW9uIGZsYWdzCgogICAgICAgICRjYk1hY3JvICAgICA9IDB4MDAwMDsgICAvLyBMZW5ndGggb2YgRk1MQSBzdHJ1Y3R1cmUKICAgICAgICAkUmVzZXJ2ZWQxICAgPSAweDAwMDA7ICAgLy8gUmVzZXJ2ZWQKICAgICAgICAkUmVzZXJ2ZWQyICAgPSAweDAwMDA7ICAgLy8gUmVzZXJ2ZWQKCiAgICAgICAgJGljdkJhY2sgICAgID0gMHgwOTsgICAgIC8vIEJhY2tncm91bmQgY29sb3VyCiAgICAgICAgJGljdkZvcmUgICAgID0gMHgwOTsgICAgIC8vIEZvcmVncm91bmQgY29sb3VyCiAgICAgICAgJGZscyAgICAgICAgID0gMHgwMDsgICAgIC8vIEZpbGwgcGF0dGVybgogICAgICAgICRmQXV0byAgICAgICA9IDB4MDA7ICAgICAvLyBBdXRvbWF0aWMgZmlsbAogICAgICAgICRpY3YgICAgICAgICA9IDB4MDg7ICAgICAvLyBMaW5lIGNvbG91cgogICAgICAgICRsbnMgICAgICAgICA9IDB4ZmY7ICAgICAvLyBMaW5lIHN0eWxlCiAgICAgICAgJGxudyAgICAgICAgID0gMHgwMTsgICAgIC8vIExpbmUgd2VpZ2h0CiAgICAgICAgJGZBdXRvQiAgICAgID0gMHgwMDsgICAgIC8vIEF1dG9tYXRpYyBib3JkZXIKICAgICAgICAkZnJzICAgICAgICAgPSAweDAwMDA7ICAgLy8gRnJhbWUgc3R5bGUKICAgICAgICAkY2YgICAgICAgICAgPSAweDAwMDk7ICAgLy8gSW1hZ2UgZm9ybWF0LCA5ID0gYml0bWFwCiAgICAgICAgJFJlc2VydmVkMyAgID0gMHgwMDAwOyAgIC8vIFJlc2VydmVkCiAgICAgICAgJGNiUGljdEZtbGEgID0gMHgwMDAwOyAgIC8vIExlbmd0aCBvZiBGTUxBIHN0cnVjdHVyZQogICAgICAgICRSZXNlcnZlZDQgICA9IDB4MDAwMDsgICAvLyBSZXNlcnZlZAogICAgICAgICRncmJpdDIgICAgICA9IDB4MDAwMTsgICAvLyBPcHRpb24gZmxhZ3MKICAgICAgICAkUmVzZXJ2ZWQ1ICAgPSAweDAwMDA7ICAgLy8gUmVzZXJ2ZWQKCgogICAgICAgICRoZWFkZXIgICAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICAgID0gcGFjaygiViIsICRjT2JqKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJE9UKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJGlkKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJGdyYml0KTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJGNvbEwpOwogICAgICAgICRkYXRhICAgICAgIC49IHBhY2soInYiLCAkZHhMKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJHJ3VCk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygidiIsICRkeVQpOwogICAgICAgICRkYXRhICAgICAgIC49IHBhY2soInYiLCAkY29sUik7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygidiIsICRkeFIpOwogICAgICAgICRkYXRhICAgICAgIC49IHBhY2soInYiLCAkcndCKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJGR5Qik7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygidiIsICRjYk1hY3JvKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJWIiwgJFJlc2VydmVkMSk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygidiIsICRSZXNlcnZlZDIpOwogICAgICAgICRkYXRhICAgICAgIC49IHBhY2soIkMiLCAkaWN2QmFjayk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygiQyIsICRpY3ZGb3JlKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJDIiwgJGZscyk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygiQyIsICRmQXV0byk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygiQyIsICRpY3YpOwogICAgICAgICRkYXRhICAgICAgIC49IHBhY2soIkMiLCAkbG5zKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJDIiwgJGxudyk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygiQyIsICRmQXV0b0IpOwogICAgICAgICRkYXRhICAgICAgIC49IHBhY2soInYiLCAkZnJzKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJWIiwgJGNmKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJFJlc2VydmVkMyk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygidiIsICRjYlBpY3RGbWxhKTsKICAgICAgICAkZGF0YSAgICAgICAuPSBwYWNrKCJ2IiwgJFJlc2VydmVkNCk7CiAgICAgICAgJGRhdGEgICAgICAgLj0gcGFjaygidiIsICRncmJpdDIpOwogICAgICAgICRkYXRhICAgICAgIC49IHBhY2soIlYiLCAkUmVzZXJ2ZWQ1KTsKCiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCBhIEdELWltYWdlIGludG8gdGhlIGludGVybmFsIGZvcm1hdC4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBwYXJhbSByZXNvdXJjZSAkaW1hZ2UgVGhlIGltYWdlIHRvIHByb2Nlc3MKICAgICAqIEByZXR1cm4gYXJyYXkgQXJyYXkgd2l0aCBkYXRhIGFuZCBwcm9wZXJ0aWVzIG9mIHRoZSBiaXRtYXAKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHByb2Nlc3NCaXRtYXBHZCgkaW1hZ2UpCiAgICB7CiAgICAgICAgJHdpZHRoID0gaW1hZ2VzeCgkaW1hZ2UpOwogICAgICAgICRoZWlnaHQgPSBpbWFnZXN5KCRpbWFnZSk7CgogICAgICAgICRkYXRhID0gcGFjaygiVnZ2dnYiLCAweDAwMGMsICR3aWR0aCwgJGhlaWdodCwgMHgwMSwgMHgxOCk7CiAgICAgICAgZm9yICgkaj0kaGVpZ2h0OyAkai0tOykgewogICAgICAgICAgICBmb3IgKCRpPTA7ICRpIDwgJHdpZHRoOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkY29sb3IgPSBpbWFnZWNvbG9yc2ZvcmluZGV4KCRpbWFnZSwgaW1hZ2Vjb2xvcmF0KCRpbWFnZSwgJGksICRqKSk7CiAgICAgICAgICAgICAgICBmb3JlYWNoIChhcnJheSgicmVkIiwgImdyZWVuIiwgImJsdWUiKSBhcyAka2V5KSB7CiAgICAgICAgICAgICAgICAgICAgJGNvbG9yWyRrZXldID0gJGNvbG9yWyRrZXldICsgcm91bmQoKDI1NSAtICRjb2xvclska2V5XSkgKiAkY29sb3JbImFscGhhIl0gLyAxMjcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGRhdGEgLj0gY2hyKCRjb2xvclsiYmx1ZSJdKSAuIGNocigkY29sb3JbImdyZWVuIl0pIC4gY2hyKCRjb2xvclsicmVkIl0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgzKiR3aWR0aCAlIDQpIHsKICAgICAgICAgICAgICAgICRkYXRhIC49IHN0cl9yZXBlYXQoIlx4MDAiLCA0IC0gMyokd2lkdGggJSA0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFycmF5KCR3aWR0aCwgJGhlaWdodCwgc3RybGVuKCRkYXRhKSwgJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydCBhIDI0IGJpdCBiaXRtYXAgaW50byB0aGUgbW9kaWZpZWQgaW50ZXJuYWwgZm9ybWF0IHVzZWQgYnkgV2luZG93cy4KICAgICAqIFRoaXMgaXMgZGVzY3JpYmVkIGluIEJJVE1BUENPUkVIRUFERVIgYW5kIEJJVE1BUENPUkVJTkZPIHN0cnVjdHVyZXMgaW4gdGhlCiAgICAgKiBNU0ROIGxpYnJhcnkuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRiaXRtYXAgVGhlIGJpdG1hcCB0byBwcm9jZXNzCiAgICAgKiBAcmV0dXJuIGFycmF5IEFycmF5IHdpdGggZGF0YSBhbmQgcHJvcGVydGllcyBvZiB0aGUgYml0bWFwCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9jZXNzQml0bWFwKCRiaXRtYXApCiAgICB7CiAgICAgICAgLy8gT3BlbiBmaWxlLgogICAgICAgICRibXBfZmQgPSBAZm9wZW4oJGJpdG1hcCwgInJiIik7CiAgICAgICAgaWYgKCEkYm1wX2ZkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCJDb3VsZG4ndCBpbXBvcnQgJGJpdG1hcCIpOwogICAgICAgIH0KCiAgICAgICAgLy8gU2x1cnAgdGhlIGZpbGUgaW50byBhIHN0cmluZy4KICAgICAgICAkZGF0YSA9IGZyZWFkKCRibXBfZmQsIGZpbGVzaXplKCRiaXRtYXApKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgZmlsZSBpcyBiaWcgZW5vdWdoIHRvIGJlIGEgYml0bWFwLgogICAgICAgIGlmIChzdHJsZW4oJGRhdGEpIDw9IDB4MzYpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24oIiRiaXRtYXAgZG9lc24ndCBjb250YWluIGVub3VnaCBkYXRhLlxuIik7CiAgICAgICAgfQoKICAgICAgICAvLyBUaGUgZmlyc3QgMiBieXRlcyBhcmUgdXNlZCB0byBpZGVudGlmeSB0aGUgYml0bWFwLgogICAgICAgICRpZGVudGl0eSA9IHVucGFjaygiQTJpZGVudCIsICRkYXRhKTsKICAgICAgICBpZiAoJGlkZW50aXR5WydpZGVudCddICE9ICJCTSIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24oIiRiaXRtYXAgZG9lc24ndCBhcHBlYXIgdG8gYmUgYSB2YWxpZCBiaXRtYXAgaW1hZ2UuXG4iKTsKICAgICAgICB9CgogICAgICAgIC8vIFJlbW92ZSBiaXRtYXAgZGF0YTogSUQuCiAgICAgICAgJGRhdGEgPSBzdWJzdHIoJGRhdGEsIDIpOwoKICAgICAgICAvLyBSZWFkIGFuZCByZW1vdmUgdGhlIGJpdG1hcCBzaXplLiBUaGlzIGlzIG1vcmUgcmVsaWFibGUgdGhhbiByZWFkaW5nCiAgICAgICAgLy8gdGhlIGRhdGEgc2l6ZSBhdCBvZmZzZXQgMHgyMi4KICAgICAgICAvLwogICAgICAgICRzaXplX2FycmF5ICAgPSB1bnBhY2soIlZzYSIsIHN1YnN0cigkZGF0YSwgMCwgNCkpOwogICAgICAgICRzaXplICAgPSAkc2l6ZV9hcnJheVsnc2EnXTsKICAgICAgICAkZGF0YSAgID0gc3Vic3RyKCRkYXRhLCA0KTsKICAgICAgICAkc2l6ZSAgLT0gMHgzNjsgLy8gU3VidHJhY3Qgc2l6ZSBvZiBiaXRtYXAgaGVhZGVyLgogICAgICAgICRzaXplICArPSAweDBDOyAvLyBBZGQgc2l6ZSBvZiBCSUZGIGhlYWRlci4KCiAgICAgICAgLy8gUmVtb3ZlIGJpdG1hcCBkYXRhOiByZXNlcnZlZCwgb2Zmc2V0LCBoZWFkZXIgbGVuZ3RoLgogICAgICAgICRkYXRhID0gc3Vic3RyKCRkYXRhLCAxMik7CgogICAgICAgIC8vIFJlYWQgYW5kIHJlbW92ZSB0aGUgYml0bWFwIHdpZHRoIGFuZCBoZWlnaHQuIFZlcmlmeSB0aGUgc2l6ZXMuCiAgICAgICAgJHdpZHRoX2FuZF9oZWlnaHQgPSB1bnBhY2soIlYyIiwgc3Vic3RyKCRkYXRhLCAwLCA4KSk7CiAgICAgICAgJHdpZHRoICA9ICR3aWR0aF9hbmRfaGVpZ2h0WzFdOwogICAgICAgICRoZWlnaHQgPSAkd2lkdGhfYW5kX2hlaWdodFsyXTsKICAgICAgICAkZGF0YSAgID0gc3Vic3RyKCRkYXRhLCA4KTsKICAgICAgICBpZiAoJHdpZHRoID4gMHhGRkZGKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCIkYml0bWFwOiBsYXJnZXN0IGltYWdlIHdpZHRoIHN1cHBvcnRlZCBpcyA2NWsuXG4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKCRoZWlnaHQgPiAweEZGRkYpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24oIiRiaXRtYXA6IGxhcmdlc3QgaW1hZ2UgaGVpZ2h0IHN1cHBvcnRlZCBpcyA2NWsuXG4iKTsKICAgICAgICB9CgogICAgICAgIC8vIFJlYWQgYW5kIHJlbW92ZSB0aGUgYml0bWFwIHBsYW5lcyBhbmQgYnBwIGRhdGEuIFZlcmlmeSB0aGVtLgogICAgICAgICRwbGFuZXNfYW5kX2JpdGNvdW50ID0gdW5wYWNrKCJ2MiIsIHN1YnN0cigkZGF0YSwgMCwgNCkpOwogICAgICAgICRkYXRhID0gc3Vic3RyKCRkYXRhLCA0KTsKICAgICAgICBpZiAoJHBsYW5lc19hbmRfYml0Y291bnRbMl0gIT0gMjQpIHsgLy8gQml0Y291bnQKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24oIiRiaXRtYXAgaXNuJ3QgYSAyNGJpdCB0cnVlIGNvbG9yIGJpdG1hcC5cbiIpOwogICAgICAgIH0KICAgICAgICBpZiAoJHBsYW5lc19hbmRfYml0Y291bnRbMV0gIT0gMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbigiJGJpdG1hcDogb25seSAxIHBsYW5lIHN1cHBvcnRlZCBpbiBiaXRtYXAgaW1hZ2UuXG4iKTsKICAgICAgICB9CgogICAgICAgIC8vIFJlYWQgYW5kIHJlbW92ZSB0aGUgYml0bWFwIGNvbXByZXNzaW9uLiBWZXJpZnkgY29tcHJlc3Npb24uCiAgICAgICAgJGNvbXByZXNzaW9uID0gdW5wYWNrKCJWY29tcCIsIHN1YnN0cigkZGF0YSwgMCwgNCkpOwogICAgICAgICRkYXRhID0gc3Vic3RyKCRkYXRhLCA0KTsKCiAgICAgICAgLy8kY29tcHJlc3Npb24gPSAwOwogICAgICAgIGlmICgkY29tcHJlc3Npb25bJ2NvbXAnXSAhPSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCIkYml0bWFwOiBjb21wcmVzc2lvbiBub3Qgc3VwcG9ydGVkIGluIGJpdG1hcCBpbWFnZS5cbiIpOwogICAgICAgIH0KCiAgICAgICAgLy8gUmVtb3ZlIGJpdG1hcCBkYXRhOiBkYXRhIHNpemUsIGhyZXMsIHZyZXMsIGNvbG91cnMsIGltcC4gY29sb3Vycy4KICAgICAgICAkZGF0YSA9IHN1YnN0cigkZGF0YSwgMjApOwoKICAgICAgICAvLyBBZGQgdGhlIEJJVE1BUENPUkVIRUFERVIgZGF0YQogICAgICAgICRoZWFkZXIgID0gcGFjaygiVnZ2dnYiLCAweDAwMGMsICR3aWR0aCwgJGhlaWdodCwgMHgwMSwgMHgxOCk7CiAgICAgICAgJGRhdGEgICAgPSAkaGVhZGVyIC4gJGRhdGE7CgogICAgICAgIHJldHVybiAoYXJyYXkoJHdpZHRoLCAkaGVpZ2h0LCAkc2l6ZSwgJGRhdGEpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIHRoZSB3aW5kb3cgem9vbSBmYWN0b3IuIFRoaXMgc2hvdWxkIGJlIGEgcmVkdWNlZCBmcmFjdGlvbiBidXQgZm9yCiAgICAgKiBzaW1wbGljaXR5IHdlIHdpbGwgc3RvcmUgYWxsIGZyYWN0aW9ucyB3aXRoIGEgbnVtZXJhdG9yIG9mIDEwMC4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVpvb20oKQogICAgewogICAgICAgIC8vIElmIHNjYWxlIGlzIDEwMCB3ZSBkb24ndCBuZWVkIHRvIHdyaXRlIGEgcmVjb3JkCiAgICAgICAgaWYgKCR0aGlzLT5waHBTaGVldC0+Z2V0U2hlZXRWaWV3KCktPmdldFpvb21TY2FsZSgpID09IDEwMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAkcmVjb3JkICAgICAgPSAweDAwQTA7ICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICAgICAgPSAweDAwMDQ7ICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICRoZWFkZXIgICAgICA9IHBhY2soInZ2IiwgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgJGRhdGEgICAgICAgID0gcGFjaygidnYiLCAkdGhpcy0+cGhwU2hlZXQtPmdldFNoZWV0VmlldygpLT5nZXRab29tU2NhbGUoKSwgMTAwKTsKICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkZGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgRXNjaGVyIG9iamVjdAogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfU2hhcmVkX0VzY2hlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RXNjaGVyKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmVzY2hlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBFc2NoZXIgb2JqZWN0CiAgICAgKgogICAgICogQHBhcmFtIFBIUEV4Y2VsX1NoYXJlZF9Fc2NoZXIgJHBWYWx1ZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0RXNjaGVyKFBIUEV4Y2VsX1NoYXJlZF9Fc2NoZXIgJHBWYWx1ZSA9IG51bGwpCiAgICB7CiAgICAgICAgJHRoaXMtPmVzY2hlciA9ICRwVmFsdWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBNU09EUkFXSU5HIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlTXNvRHJhd2luZygpCiAgICB7CiAgICAgICAgLy8gd3JpdGUgdGhlIEVzY2hlciBzdHJlYW0gaWYgbmVjZXNzYXJ5CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5lc2NoZXIpKSB7CiAgICAgICAgICAgICR3cml0ZXIgPSBuZXcgUEhQRXhjZWxfV3JpdGVyX0V4Y2VsNV9Fc2NoZXIoJHRoaXMtPmVzY2hlcik7CiAgICAgICAgICAgICRkYXRhID0gJHdyaXRlci0+Y2xvc2UoKTsKICAgICAgICAgICAgJHNwT2Zmc2V0cyA9ICR3cml0ZXItPmdldFNwT2Zmc2V0cygpOwogICAgICAgICAgICAkc3BUeXBlcyA9ICR3cml0ZXItPmdldFNwVHlwZXMoKTsKICAgICAgICAgICAgLy8gd3JpdGUgdGhlIG5lY2Nlc2FyeSBNU09EUkFXSU5HLCBPQkogcmVjb3JkcwoKICAgICAgICAgICAgLy8gc3BsaXQgdGhlIEVzY2hlciBzdHJlYW0KICAgICAgICAgICAgJHNwT2Zmc2V0c1swXSA9IDA7CiAgICAgICAgICAgICRubSA9IGNvdW50KCRzcE9mZnNldHMpIC0gMTsgLy8gbnVtYmVyIG9mIHNoYXBlcyBleGNsdWRpbmcgZmlyc3Qgc2hhcGUKICAgICAgICAgICAgZm9yICgkaSA9IDE7ICRpIDw9ICRubTsgKyskaSkgewogICAgICAgICAgICAgICAgLy8gTVNPRFJBV0lORyByZWNvcmQKICAgICAgICAgICAgICAgICRyZWNvcmQgPSAweDAwRUM7ICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKCiAgICAgICAgICAgICAgICAvLyBjaHVuayBvZiBFc2NoZXIgc3RyZWFtIGZvciBvbmUgc2hhcGUKICAgICAgICAgICAgICAgICRkYXRhQ2h1bmsgPSBzdWJzdHIoJGRhdGEsICRzcE9mZnNldHNbJGkgLTFdLCAkc3BPZmZzZXRzWyRpXSAtICRzcE9mZnNldHNbJGkgLSAxXSk7CgogICAgICAgICAgICAgICAgJGxlbmd0aCA9IHN0cmxlbigkZGF0YUNodW5rKTsKICAgICAgICAgICAgICAgICRoZWFkZXIgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwoKICAgICAgICAgICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhQ2h1bmspOwoKICAgICAgICAgICAgICAgIC8vIE9CSiByZWNvcmQKICAgICAgICAgICAgICAgICRyZWNvcmQgPSAweDAwNUQ7IC8vIHJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgICAgICAgICAkb2JqRGF0YSA9ICcnOwoKICAgICAgICAgICAgICAgIC8vIGZ0Q21vCiAgICAgICAgICAgICAgICBpZiAoJHNwVHlwZXNbJGldID09IDB4MDBDOSkgewogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBmdENtbyAoY29tbW9uIG9iamVjdCBkYXRhKSBzdWJvYmplY3QKICAgICAgICAgICAgICAgICAgICAkb2JqRGF0YSAuPQogICAgICAgICAgICAgICAgICAgICAgICBwYWNrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Z2dnZ2VlZWJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4MDAxNSwgLy8gMHgwMDE1ID0gZnRDbW8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4MDAxMiwgLy8gbGVuZ3RoIG9mIGZ0Q21vIGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4MDAxNCwgLy8gb2JqZWN0IHR5cGUsIDB4MDAxNCA9IGZpbHRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGksIC8vIG9iamVjdCBpZCBudW1iZXIsIEV4Y2VsIHNlZW1zIHRvIHVzZSAxLWJhc2VkIGluZGV4LCBsb2NhbCBmb3IgdGhlIHNoZWV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDIxMDEsIC8vIG9wdGlvbiBmbGFncywgMHgyMDAxIGlzIHdoYXQgT3Blbk9mZmljZS5vcmcgdXNlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwgLy8gcmVzZXJ2ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIC8vIHJlc2VydmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwICAvLyByZXNlcnZlZAogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgZnRTYnMgU2Nyb2xsIGJhciBzdWJvYmplY3QKICAgICAgICAgICAgICAgICAgICAkb2JqRGF0YSAuPSBwYWNrKCd2dicsIDB4MDBDLCAweDAwMTQpOwogICAgICAgICAgICAgICAgICAgICRvYmpEYXRhIC49IHBhY2soJ0gqJywgJzAwMDAwMDAwMDAwMDAwMDA2NDAwMDEwMDBBMDAwMDAwMTAwMDAxMDAnKTsKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgZnRMYnNEYXRhIChMaXN0IGJveCBkYXRhKSBzdWJvYmplY3QKICAgICAgICAgICAgICAgICAgICAkb2JqRGF0YSAuPSBwYWNrKCd2dicsIDB4MDAxMywgMHgxRkVFKTsKICAgICAgICAgICAgICAgICAgICAkb2JqRGF0YSAuPSBwYWNrKCdIKicsICcwMDAwMDAwMDAxMDAwMTAzMDAwMDAyMDAwODAwNTcwMCcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBBZGQgZnRDbW8gKGNvbW1vbiBvYmplY3QgZGF0YSkgc3Vib2JqZWN0CiAgICAgICAgICAgICAgICAgICAgJG9iakRhdGEgLj0KICAgICAgICAgICAgICAgICAgICAgICAgcGFjaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2dnZ2dlZWVicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDAwMTUsIC8vIDB4MDAxNSA9IGZ0Q21vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDAwMTIsIC8vIGxlbmd0aCBvZiBmdENtbyBkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAweDAwMDgsIC8vIG9iamVjdCB0eXBlLCAweDAwMDggPSBwaWN0dXJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaSwgLy8gb2JqZWN0IGlkIG51bWJlciwgRXhjZWwgc2VlbXMgdG8gdXNlIDEtYmFzZWQgaW5kZXgsIGxvY2FsIGZvciB0aGUgc2hlZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDB4NjAxMSwgLy8gb3B0aW9uIGZsYWdzLCAweDYwMTEgaXMgd2hhdCBPcGVuT2ZmaWNlLm9yZyB1c2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCAvLyByZXNlcnZlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwgLy8gcmVzZXJ2ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAgIC8vIHJlc2VydmVkCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gZnRFbmQKICAgICAgICAgICAgICAgICRvYmpEYXRhIC49CiAgICAgICAgICAgICAgICAgICAgcGFjaygKICAgICAgICAgICAgICAgICAgICAgICAgJ3Z2JywKICAgICAgICAgICAgICAgICAgICAgICAgMHgwMDAwLCAvLyAweDAwMDAgPSBmdEVuZAogICAgICAgICAgICAgICAgICAgICAgICAweDAwMDAgIC8vIGxlbmd0aCBvZiBmdEVuZCBkYXRhCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAkbGVuZ3RoID0gc3RybGVuKCRvYmpEYXRhKTsKICAgICAgICAgICAgICAgICRoZWFkZXIgPSBwYWNrKCd2dicsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJG9iakRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgdGhlIERBVEFWQUxJREFUSU9OUyBhbmQgREFUQVZBTElEQVRJT04gcmVjb3Jkcy4KICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZURhdGFWYWxpZGl0eSgpCiAgICB7CiAgICAgICAgLy8gRGF0YXZhbGlkYXRpb24gY29sbGVjdGlvbgogICAgICAgICRkYXRhVmFsaWRhdGlvbkNvbGxlY3Rpb24gPSAkdGhpcy0+cGhwU2hlZXQtPmdldERhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbigpOwoKICAgICAgICAvLyBXcml0ZSBkYXRhIHZhbGlkYXRpb25zPwogICAgICAgIGlmICghZW1wdHkoJGRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbikpIHsKICAgICAgICAgICAgLy8gREFUQVZBTElEQVRJT05TIHJlY29yZAogICAgICAgICAgICAkcmVjb3JkID0gMHgwMUIyOyAgICAgIC8vIFJlY29yZCBpZGVudGlmaWVyCiAgICAgICAgICAgICRsZW5ndGggPSAweDAwMTI7ICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICAgICAkZ3JiaXQgID0gMHgwMDAwOyAgICAgICAvLyBQcm9tcHQgYm94IGF0IGNlbGwsIG5vIGNhY2hlZCB2YWxpZGl0eSBkYXRhIGF0IERWIHJlY29yZHMKICAgICAgICAgICAgJGhvclBvcyA9IDB4MDAwMDAwMDA7ICAvLyBIb3Jpem9udGFsIHBvc2l0aW9uIG9mIHByb21wdCBib3gsIGlmIGZpeGVkIHBvc2l0aW9uCiAgICAgICAgICAgICR2ZXJQb3MgPSAweDAwMDAwMDAwOyAgLy8gVmVydGljYWwgcG9zaXRpb24gb2YgcHJvbXB0IGJveCwgaWYgZml4ZWQgcG9zaXRpb24KICAgICAgICAgICAgJG9iaklkICA9IDB4RkZGRkZGRkY7ICAvLyBPYmplY3QgaWRlbnRpZmllciBvZiBkcm9wIGRvd24gYXJyb3cgb2JqZWN0LCBvciAtMSBpZiBub3QgdmlzaWJsZQoKICAgICAgICAgICAgJGhlYWRlciA9IHBhY2soJ3Z2JywgJHJlY29yZCwgJGxlbmd0aCk7CiAgICAgICAgICAgICRkYXRhICAgPSBwYWNrKCd2VlZWVicsICRncmJpdCwgJGhvclBvcywgJHZlclBvcywgJG9iaklkLCBjb3VudCgkZGF0YVZhbGlkYXRpb25Db2xsZWN0aW9uKSk7CiAgICAgICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlci4kZGF0YSk7CgogICAgICAgICAgICAvLyBEQVRBVkFMSURBVElPTiByZWNvcmRzCiAgICAgICAgICAgICRyZWNvcmQgPSAweDAxQkU7ICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgoKICAgICAgICAgICAgZm9yZWFjaCAoJGRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbiBhcyAkY2VsbENvb3JkaW5hdGUgPT4gJGRhdGFWYWxpZGF0aW9uKSB7CiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplIHJlY29yZCBkYXRhCiAgICAgICAgICAgICAgICAkZGF0YSA9ICcnOwoKICAgICAgICAgICAgICAgIC8vIG9wdGlvbnMKICAgICAgICAgICAgICAgICRvcHRpb25zID0gMHgwMDAwMDAwMDsKCiAgICAgICAgICAgICAgICAvLyBkYXRhIHR5cGUKICAgICAgICAgICAgICAgICR0eXBlID0gJGRhdGFWYWxpZGF0aW9uLT5nZXRUeXBlKCk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKCR0eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX05PTkU6CiAgICAgICAgICAgICAgICAgICAgICAgICR0eXBlID0gMHgwMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpUWVBFX1dIT0xFOgogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IDB4MDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6VFlQRV9ERUNJTUFMOgogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IDB4MDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6VFlQRV9MSVNUOgogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IDB4MDM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6VFlQRV9EQVRFOgogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IDB4MDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6VFlQRV9USU1FOgogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IDB4MDU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6VFlQRV9URVhUTEVOR1RIOgogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IDB4MDY7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6VFlQRV9DVVNUT006CiAgICAgICAgICAgICAgICAgICAgICAgICR0eXBlID0gMHgwNzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb3B0aW9ucyB8PSAkdHlwZSA8PCAwOwoKICAgICAgICAgICAgICAgIC8vIGVycm9yIHN0eWxlCiAgICAgICAgICAgICAgICAkZXJyb3JTdHlsZSA9ICRkYXRhVmFsaWRhdGlvbi0+Z2V0VHlwZSgpOwogICAgICAgICAgICAgICAgc3dpdGNoICgkZXJyb3JTdHlsZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6U1RZTEVfU1RPUDoKICAgICAgICAgICAgICAgICAgICAgICAgJGVycm9yU3R5bGUgPSAweDAwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246OlNUWUxFX1dBUk5JTkc6CiAgICAgICAgICAgICAgICAgICAgICAgICRlcnJvclN0eWxlID0gMHgwMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpTVFlMRV9JTkZPUk1BVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAgJGVycm9yU3R5bGUgPSAweDAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRvcHRpb25zIHw9ICRlcnJvclN0eWxlIDw8IDQ7CgogICAgICAgICAgICAgICAgLy8gZXhwbGljaXQgZm9ybXVsYT8KICAgICAgICAgICAgICAgIGlmICgkdHlwZSA9PSAweDAzICYmIHByZWdfbWF0Y2goJy9eXCIuKlwiJC8nLCAkZGF0YVZhbGlkYXRpb24tPmdldEZvcm11bGExKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnMgfD0gMHgwMSA8PCA3OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGVtcHR5IGNlbGxzIGFsbG93ZWQKICAgICAgICAgICAgICAgICRvcHRpb25zIHw9ICRkYXRhVmFsaWRhdGlvbi0+Z2V0QWxsb3dCbGFuaygpIDw8IDg7CgogICAgICAgICAgICAgICAgLy8gc2hvdyBkcm9wIGRvd24KICAgICAgICAgICAgICAgICRvcHRpb25zIHw9ICghJGRhdGFWYWxpZGF0aW9uLT5nZXRTaG93RHJvcERvd24oKSkgPDwgOTsKCiAgICAgICAgICAgICAgICAvLyBzaG93IGlucHV0IG1lc3NhZ2UKICAgICAgICAgICAgICAgICRvcHRpb25zIHw9ICRkYXRhVmFsaWRhdGlvbi0+Z2V0U2hvd0lucHV0TWVzc2FnZSgpIDw8IDE4OwoKICAgICAgICAgICAgICAgIC8vIHNob3cgZXJyb3IgbWVzc2FnZQogICAgICAgICAgICAgICAgJG9wdGlvbnMgfD0gJGRhdGFWYWxpZGF0aW9uLT5nZXRTaG93RXJyb3JNZXNzYWdlKCkgPDwgMTk7CgogICAgICAgICAgICAgICAgLy8gY29uZGl0aW9uIG9wZXJhdG9yCiAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSAkZGF0YVZhbGlkYXRpb24tPmdldE9wZXJhdG9yKCk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRvcGVyYXRvcikgewogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbjo6T1BFUkFUT1JfQkVUV0VFTjoKICAgICAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yID0gMHgwMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpPUEVSQVRPUl9OT1RCRVRXRUVOOgogICAgICAgICAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSAweDAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246Ok9QRVJBVE9SX0VRVUFMOgogICAgICAgICAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSAweDAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246Ok9QRVJBVE9SX05PVEVRVUFMOgogICAgICAgICAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSAweDAzOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246Ok9QRVJBVE9SX0dSRUFURVJUSEFOOgogICAgICAgICAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSAweDA0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246Ok9QRVJBVE9SX0xFU1NUSEFOOgogICAgICAgICAgICAgICAgICAgICAgICAkb3BlcmF0b3IgPSAweDA1OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb246Ok9QRVJBVE9SX0dSRUFURVJUSEFOT1JFUVVBTDoKICAgICAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yID0gMHgwNjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uOjpPUEVSQVRPUl9MRVNTVEhBTk9SRVFVQUw6CiAgICAgICAgICAgICAgICAgICAgICAgICRvcGVyYXRvciA9IDB4MDc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG9wdGlvbnMgfD0gJG9wZXJhdG9yIDw8IDIwOwoKICAgICAgICAgICAgICAgICRkYXRhICAgICAgICA9IHBhY2soJ1YnLCAkb3B0aW9ucyk7CgogICAgICAgICAgICAgICAgLy8gcHJvbXB0IHRpdGxlCiAgICAgICAgICAgICAgICAkcHJvbXB0VGl0bGUgPSAkZGF0YVZhbGlkYXRpb24tPmdldFByb21wdFRpdGxlKCkgIT09ICcnID8KICAgICAgICAgICAgICAgICAgICAkZGF0YVZhbGlkYXRpb24tPmdldFByb21wdFRpdGxlKCkgOiBjaHIoMCk7CiAgICAgICAgICAgICAgICAkZGF0YSAuPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpVVEY4dG9CSUZGOFVuaWNvZGVMb25nKCRwcm9tcHRUaXRsZSk7CgogICAgICAgICAgICAgICAgLy8gZXJyb3IgdGl0bGUKICAgICAgICAgICAgICAgICRlcnJvclRpdGxlID0gJGRhdGFWYWxpZGF0aW9uLT5nZXRFcnJvclRpdGxlKCkgIT09ICcnID8KICAgICAgICAgICAgICAgICAgICAkZGF0YVZhbGlkYXRpb24tPmdldEVycm9yVGl0bGUoKSA6IGNocigwKTsKICAgICAgICAgICAgICAgICRkYXRhIC49IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OlVURjh0b0JJRkY4VW5pY29kZUxvbmcoJGVycm9yVGl0bGUpOwoKICAgICAgICAgICAgICAgIC8vIHByb21wdCB0ZXh0CiAgICAgICAgICAgICAgICAkcHJvbXB0ID0gJGRhdGFWYWxpZGF0aW9uLT5nZXRQcm9tcHQoKSAhPT0gJycgPwogICAgICAgICAgICAgICAgICAgICRkYXRhVmFsaWRhdGlvbi0+Z2V0UHJvbXB0KCkgOiBjaHIoMCk7CiAgICAgICAgICAgICAgICAkZGF0YSAuPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpVVEY4dG9CSUZGOFVuaWNvZGVMb25nKCRwcm9tcHQpOwoKICAgICAgICAgICAgICAgIC8vIGVycm9yIHRleHQKICAgICAgICAgICAgICAgICRlcnJvciA9ICRkYXRhVmFsaWRhdGlvbi0+Z2V0RXJyb3IoKSAhPT0gJycgPwogICAgICAgICAgICAgICAgICAgICRkYXRhVmFsaWRhdGlvbi0+Z2V0RXJyb3IoKSA6IGNocigwKTsKICAgICAgICAgICAgICAgICRkYXRhIC49IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OlVURjh0b0JJRkY4VW5pY29kZUxvbmcoJGVycm9yKTsKCiAgICAgICAgICAgICAgICAvLyBmb3JtdWxhIDEKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgJGZvcm11bGExID0gJGRhdGFWYWxpZGF0aW9uLT5nZXRGb3JtdWxhMSgpOwogICAgICAgICAgICAgICAgICAgIGlmICgkdHlwZSA9PSAweDAzKSB7IC8vIGxpc3QgdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAkZm9ybXVsYTEgPSBzdHJfcmVwbGFjZSgnLCcsIGNocigwKSwgJGZvcm11bGExKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnBhcnNlci0+cGFyc2UoJGZvcm11bGExKTsKICAgICAgICAgICAgICAgICAgICAkZm9ybXVsYTEgPSAkdGhpcy0+cGFyc2VyLT50b1JldmVyc2VQb2xpc2goKTsKICAgICAgICAgICAgICAgICAgICAkc3oxID0gc3RybGVuKCRmb3JtdWxhMSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChQSFBFeGNlbF9FeGNlcHRpb24gJGUpIHsKICAgICAgICAgICAgICAgICAgICAkc3oxID0gMDsKICAgICAgICAgICAgICAgICAgICAkZm9ybXVsYTEgPSAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRkYXRhIC49IHBhY2soJ3Z2JywgJHN6MSwgMHgwMDAwKTsKICAgICAgICAgICAgICAgICRkYXRhIC49ICRmb3JtdWxhMTsKCiAgICAgICAgICAgICAgICAvLyBmb3JtdWxhIDIKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgJGZvcm11bGEyID0gJGRhdGFWYWxpZGF0aW9uLT5nZXRGb3JtdWxhMigpOwogICAgICAgICAgICAgICAgICAgIGlmICgkZm9ybXVsYTIgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCdObyBmb3JtdWxhMicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGFyc2VyLT5wYXJzZSgkZm9ybXVsYTIpOwogICAgICAgICAgICAgICAgICAgICRmb3JtdWxhMiA9ICR0aGlzLT5wYXJzZXItPnRvUmV2ZXJzZVBvbGlzaCgpOwogICAgICAgICAgICAgICAgICAgICRzejIgPSBzdHJsZW4oJGZvcm11bGEyKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFBIUEV4Y2VsX0V4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAgICAgICAgICRzejIgPSAwOwogICAgICAgICAgICAgICAgICAgICRmb3JtdWxhMiA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGRhdGEgLj0gcGFjaygndnYnLCAkc3oyLCAweDAwMDApOwogICAgICAgICAgICAgICAgJGRhdGEgLj0gJGZvcm11bGEyOwoKICAgICAgICAgICAgICAgIC8vIGNlbGwgcmFuZ2UgYWRkcmVzcyBsaXN0CiAgICAgICAgICAgICAgICAkZGF0YSAuPSBwYWNrKCd2JywgMHgwMDAxKTsKICAgICAgICAgICAgICAgICRkYXRhIC49ICR0aGlzLT53cml0ZUJJRkY4Q2VsbFJhbmdlQWRkcmVzc0ZpeGVkKCRjZWxsQ29vcmRpbmF0ZSk7CgogICAgICAgICAgICAgICAgJGxlbmd0aCA9IHN0cmxlbigkZGF0YSk7CiAgICAgICAgICAgICAgICAkaGVhZGVyID0gcGFjaygidnYiLCAkcmVjb3JkLCAkbGVuZ3RoKTsKCiAgICAgICAgICAgICAgICAkdGhpcy0+YXBwZW5kKCRoZWFkZXIgLiAkZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgRXJyb3IgY29kZQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVycm9yQ29kZQogICAgICogQHJldHVybiBpbnQKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gbWFwRXJyb3JDb2RlKCRlcnJvckNvZGUpCiAgICB7CiAgICAgICAgc3dpdGNoICgkZXJyb3JDb2RlKSB7CiAgICAgICAgICAgIGNhc2UgJyNOVUxMISc6CiAgICAgICAgICAgICAgICByZXR1cm4gMHgwMDsKICAgICAgICAgICAgY2FzZSAnI0RJVi8wISc6CiAgICAgICAgICAgICAgICByZXR1cm4gMHgwNzsKICAgICAgICAgICAgY2FzZSAnI1ZBTFVFISc6CiAgICAgICAgICAgICAgICByZXR1cm4gMHgwRjsKICAgICAgICAgICAgY2FzZSAnI1JFRiEnOgogICAgICAgICAgICAgICAgcmV0dXJuIDB4MTc7CiAgICAgICAgICAgIGNhc2UgJyNOQU1FPyc6CiAgICAgICAgICAgICAgICByZXR1cm4gMHgxRDsKICAgICAgICAgICAgY2FzZSAnI05VTSEnOgogICAgICAgICAgICAgICAgcmV0dXJuIDB4MjQ7CiAgICAgICAgICAgIGNhc2UgJyNOL0EnOgogICAgICAgICAgICAgICAgcmV0dXJuIDB4MkE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIFBMViBSZWNvcmQKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiB3cml0ZVBhZ2VMYXlvdXRWaWV3KCkKICAgIHsKICAgICAgICAkcmVjb3JkICAgICAgPSAweDA4OEI7ICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKICAgICAgICAkbGVuZ3RoICAgICAgPSAweDAwMTA7ICAgICAgICAgICAgICAgLy8gQnl0ZXMgdG8gZm9sbG93CgogICAgICAgICRydCAgICAgICAgID0gMHgwODhCOyAvLyAyCiAgICAgICAgJGdyYml0RnJ0ICAgPSAweDAwMDA7IC8vIDIKICAgICAgICAkcmVzZXJ2ZWQgICA9IDB4MDAwMDAwMDAwMDAwMDAwMDsgLy8gOAogICAgICAgICR3U2NhbHZlUExWID0gJHRoaXMtPnBocFNoZWV0LT5nZXRTaGVldFZpZXcoKS0+Z2V0Wm9vbVNjYWxlKCk7IC8vIDIKCiAgICAgICAgLy8gVGhlIG9wdGlvbnMgZmxhZ3MgdGhhdCBjb21wcmlzZSAkZ3JiaXQKICAgICAgICBpZiAoJHRoaXMtPnBocFNoZWV0LT5nZXRTaGVldFZpZXcoKS0+Z2V0VmlldygpID09IFBIUEV4Y2VsX1dvcmtzaGVldF9TaGVldFZpZXc6OlNIRUVUVklFV19QQUdFX0xBWU9VVCkgewogICAgICAgICAgICAkZlBhZ2VMYXlvdXRWaWV3ICAgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRmUGFnZUxheW91dFZpZXcgICA9IDA7CiAgICAgICAgfQogICAgICAgICRmUnVsZXJWaXNpYmxlICAgICA9IDA7CiAgICAgICAgJGZXaGl0ZXNwYWNlSGlkZGVuID0gMDsKCiAgICAgICAgJGdyYml0ICAgICAgPSAkZlBhZ2VMYXlvdXRWaWV3OyAvLyAyCiAgICAgICAgJGdyYml0ICAgICAgICB8PSAkZlJ1bGVyVmlzaWJsZSAgICAgICA8PCAxOwogICAgICAgICRncmJpdCAgICAgICAgfD0gJGZXaGl0ZXNwYWNlSGlkZGVuICA8PCAzOwoKICAgICAgICAkaGVhZGVyICAgICAgPSBwYWNrKCJ2diIsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgPSBwYWNrKCJ2dlZWdnYiLCAkcnQsICRncmJpdEZydCwgMHgwMDAwMDAwMCwgMHgwMDAwMDAwMCwgJHdTY2FsdmVQTFYsICRncmJpdCk7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogV3JpdGUgQ0ZSdWxlIFJlY29yZAogICAgICogQHBhcmFtIFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsICRjb25kaXRpb25hbAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlQ0ZSdWxlKFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsICRjb25kaXRpb25hbCkKICAgIHsKICAgICAgICAkcmVjb3JkICAgICAgPSAweDAxQjE7ICAgICAgICAgICAgICAgLy8gUmVjb3JkIGlkZW50aWZpZXIKCiAgICAgICAgLy8gJHR5cGUgOiBUeXBlIG9mIHRoZSBDRgogICAgICAgIC8vICRvcGVyYXRvclR5cGUgOiBDb21wYXJpc29uIG9wZXJhdG9yCiAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fRVhQUkVTU0lPTikgewogICAgICAgICAgICAkdHlwZSA9IDB4MDI7CiAgICAgICAgICAgICRvcGVyYXRvclR5cGUgPSAweDAwOwogICAgICAgIH0gZWxzZWlmICgkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvblR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0NFTExJUykgewogICAgICAgICAgICAkdHlwZSA9IDB4MDE7CgogICAgICAgICAgICBzd2l0Y2ggKCRjb25kaXRpb25hbC0+Z2V0T3BlcmF0b3JUeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6Ok9QRVJBVE9SX05PTkU6CiAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yVHlwZSA9IDB4MDA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpPUEVSQVRPUl9FUVVBTDoKICAgICAgICAgICAgICAgICAgICAkb3BlcmF0b3JUeXBlID0gMHgwMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6Ok9QRVJBVE9SX0dSRUFURVJUSEFOOgogICAgICAgICAgICAgICAgICAgICRvcGVyYXRvclR5cGUgPSAweDA1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6T1BFUkFUT1JfR1JFQVRFUlRIQU5PUkVRVUFMOgogICAgICAgICAgICAgICAgICAgICRvcGVyYXRvclR5cGUgPSAweDA3OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6T1BFUkFUT1JfTEVTU1RIQU46CiAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yVHlwZSA9IDB4MDY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpPUEVSQVRPUl9MRVNTVEhBTk9SRVFVQUw6CiAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yVHlwZSA9IDB4MDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpPUEVSQVRPUl9OT1RFUVVBTDoKICAgICAgICAgICAgICAgICAgICAkb3BlcmF0b3JUeXBlID0gMHgwNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6Ok9QRVJBVE9SX0JFVFdFRU46CiAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yVHlwZSA9IDB4MDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgLy8gbm90IE9QRVJBVE9SX05PVEJFVFdFRU4gMHgwMgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAkc3pWYWx1ZTEgOiBzaXplIG9mIHRoZSBmb3JtdWxhIGRhdGEgZm9yIGZpcnN0IHZhbHVlIG9yIGZvcm11bGEKICAgICAgICAvLyAkc3pWYWx1ZTIgOiBzaXplIG9mIHRoZSBmb3JtdWxhIGRhdGEgZm9yIHNlY29uZCB2YWx1ZSBvciBmb3JtdWxhCiAgICAgICAgJGFyckNvbmRpdGlvbnMgPSAkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvbnMoKTsKICAgICAgICAkbnVtQ29uZGl0aW9ucyA9IHNpemVvZigkYXJyQ29uZGl0aW9ucyk7CiAgICAgICAgaWYgKCRudW1Db25kaXRpb25zID09IDEpIHsKICAgICAgICAgICAgJHN6VmFsdWUxID0gKCRhcnJDb25kaXRpb25zWzBdIDw9IDY1NTM1ID8gMyA6IDB4MDAwMCk7CiAgICAgICAgICAgICRzelZhbHVlMiA9IDB4MDAwMDsKICAgICAgICAgICAgJG9wZXJhbmQxID0gcGFjaygnQ3YnLCAweDFFLCAkYXJyQ29uZGl0aW9uc1swXSk7CiAgICAgICAgICAgICRvcGVyYW5kMiA9IG51bGw7CiAgICAgICAgfSBlbHNlaWYgKCRudW1Db25kaXRpb25zID09IDIgJiYgKCRjb25kaXRpb25hbC0+Z2V0T3BlcmF0b3JUeXBlKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWw6Ok9QRVJBVE9SX0JFVFdFRU4pKSB7CiAgICAgICAgICAgICRzelZhbHVlMSA9ICgkYXJyQ29uZGl0aW9uc1swXSA8PSA2NTUzNSA\/IDMgOiAweDAwMDApOwogICAgICAgICAgICAkc3pWYWx1ZTIgPSAoJGFyckNvbmRpdGlvbnNbMV0gPD0gNjU1MzUgPyAzIDogMHgwMDAwKTsKICAgICAgICAgICAgJG9wZXJhbmQxID0gcGFjaygnQ3YnLCAweDFFLCAkYXJyQ29uZGl0aW9uc1swXSk7CiAgICAgICAgICAgICRvcGVyYW5kMiA9IHBhY2soJ0N2JywgMHgxRSwgJGFyckNvbmRpdGlvbnNbMV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzelZhbHVlMSA9IDB4MDAwMDsKICAgICAgICAgICAgJHN6VmFsdWUyID0gMHgwMDAwOwogICAgICAgICAgICAkb3BlcmFuZDEgPSBudWxsOwogICAgICAgICAgICAkb3BlcmFuZDIgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gJGZsYWdzIDogT3B0aW9uIGZsYWdzCiAgICAgICAgLy8gQWxpZ25tZW50CiAgICAgICAgJGJBbGlnbkh6ID0gKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0QWxpZ25tZW50KCktPmdldEhvcml6b250YWwoKSA9PSBudWxsID8gMSA6IDApOwogICAgICAgICRiQWxpZ25WdCA9ICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEFsaWdubWVudCgpLT5nZXRWZXJ0aWNhbCgpID09IG51bGwgPyAxIDogMCk7CiAgICAgICAgJGJBbGlnbldyYXBUeCA9ICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEFsaWdubWVudCgpLT5nZXRXcmFwVGV4dCgpID09IGZhbHNlID8gMSA6IDApOwogICAgICAgICRiVHhSb3RhdGlvbiA9ICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEFsaWdubWVudCgpLT5nZXRUZXh0Um90YXRpb24oKSA9PSBudWxsID8gMSA6IDApOwogICAgICAgICRiSW5kZW50ID0gKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0QWxpZ25tZW50KCktPmdldEluZGVudCgpID09IDAgPyAxIDogMCk7CiAgICAgICAgJGJTaHJpbmtUb0ZpdCA9ICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEFsaWdubWVudCgpLT5nZXRTaHJpbmtUb0ZpdCgpID09IGZhbHNlID8gMSA6IDApOwogICAgICAgIGlmICgkYkFsaWduSHogPT0gMCB8fCAkYkFsaWduVnQgPT0gMCB8fCAkYkFsaWduV3JhcFR4ID09IDAgfHwgJGJUeFJvdGF0aW9uID09IDAgfHwgJGJJbmRlbnQgPT0gMCB8fCAkYlNocmlua1RvRml0ID09IDApIHsKICAgICAgICAgICAgJGJGb3JtYXRBbGlnbiA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGJGb3JtYXRBbGlnbiA9IDA7CiAgICAgICAgfQogICAgICAgIC8vIFByb3RlY3Rpb24KICAgICAgICAkYlByb3RMb2NrZWQgPSAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRQcm90ZWN0aW9uKCktPmdldExvY2tlZCgpID09IG51bGwgPyAxIDogMCk7CiAgICAgICAgJGJQcm90SGlkZGVuID0gKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0UHJvdGVjdGlvbigpLT5nZXRIaWRkZW4oKSA9PSBudWxsID8gMSA6IDApOwogICAgICAgIGlmICgkYlByb3RMb2NrZWQgPT0gMCB8fCAkYlByb3RIaWRkZW4gPT0gMCkgewogICAgICAgICAgICAkYkZvcm1hdFByb3QgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRiRm9ybWF0UHJvdCA9IDA7CiAgICAgICAgfQogICAgICAgIC8vIEJvcmRlcgogICAgICAgICRiQm9yZGVyTGVmdCA9ICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEJvcmRlcnMoKS0+Z2V0TGVmdCgpLT5nZXRDb2xvcigpLT5nZXRBUkdCKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29sb3I6OkNPTE9SX0JMQUNLCiAgICAgICAgICAgICAgICAgICAgICAgICYmICRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Qm9yZGVycygpLT5nZXRMZWZ0KCktPmdldEJvcmRlclN0eWxlKCkgPT0gUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTk9ORSA\/IDEgOiAwKTsKICAgICAgICAkYkJvcmRlclJpZ2h0ID0gKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Qm9yZGVycygpLT5nZXRSaWdodCgpLT5nZXRDb2xvcigpLT5nZXRBUkdCKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29sb3I6OkNPTE9SX0JMQUNLCiAgICAgICAgICAgICAgICAgICAgICAgICYmICRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Qm9yZGVycygpLT5nZXRSaWdodCgpLT5nZXRCb3JkZXJTdHlsZSgpID09IFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX05PTkUgPyAxIDogMCk7CiAgICAgICAgJGJCb3JkZXJUb3AgPSAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRCb3JkZXJzKCktPmdldFRvcCgpLT5nZXRDb2xvcigpLT5nZXRBUkdCKCkgPT0gUEhQRXhjZWxfU3R5bGVfQ29sb3I6OkNPTE9SX0JMQUNLCiAgICAgICAgICAgICAgICAgICAgICAgICYmICRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Qm9yZGVycygpLT5nZXRUb3AoKS0+Z2V0Qm9yZGVyU3R5bGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9OT05FID8gMSA6IDApOwogICAgICAgICRiQm9yZGVyQm90dG9tID0gKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Qm9yZGVycygpLT5nZXRCb3R0b20oKS0+Z2V0Q29sb3IoKS0+Z2V0QVJHQigpID09IFBIUEV4Y2VsX1N0eWxlX0NvbG9yOjpDT0xPUl9CTEFDSwogICAgICAgICAgICAgICAgICAgICAgICAmJiAkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEJvcmRlcnMoKS0+Z2V0Qm90dG9tKCktPmdldEJvcmRlclN0eWxlKCkgPT0gUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTk9ORSA\/IDEgOiAwKTsKICAgICAgICBpZiAoJGJCb3JkZXJMZWZ0ID09IDAgfHwgJGJCb3JkZXJSaWdodCA9PSAwIHx8ICRiQm9yZGVyVG9wID09IDAgfHwgJGJCb3JkZXJCb3R0b20gPT0gMCkgewogICAgICAgICAgICAkYkZvcm1hdEJvcmRlciA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGJGb3JtYXRCb3JkZXIgPSAwOwogICAgICAgIH0KICAgICAgICAvLyBQYXR0ZXJuCiAgICAgICAgJGJGaWxsU3R5bGUgPSAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGaWxsKCktPmdldEZpbGxUeXBlKCkgPT0gbnVsbCA\/IDAgOiAxKTsKICAgICAgICAkYkZpbGxDb2xvciA9ICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZpbGwoKS0+Z2V0U3RhcnRDb2xvcigpLT5nZXRBUkdCKCkgPT0gbnVsbCA\/IDAgOiAxKTsKICAgICAgICAkYkZpbGxDb2xvckJnID0gKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0RmlsbCgpLT5nZXRFbmRDb2xvcigpLT5nZXRBUkdCKCkgPT0gbnVsbCA\/IDAgOiAxKTsKICAgICAgICBpZiAoJGJGaWxsU3R5bGUgPT0gMCB8fCAkYkZpbGxDb2xvciA9PSAwIHx8ICRiRmlsbENvbG9yQmcgPT0gMCkgewogICAgICAgICAgICAkYkZvcm1hdEZpbGwgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRiRm9ybWF0RmlsbCA9IDA7CiAgICAgICAgfQogICAgICAgIC8vIEZvbnQKICAgICAgICBpZiAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGb250KCktPmdldE5hbWUoKSAhPSBudWxsCiAgICAgICAgICAgIHx8ICRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Rm9udCgpLT5nZXRTaXplKCkgIT0gbnVsbAogICAgICAgICAgICB8fCAkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0Qm9sZCgpICE9IG51bGwKICAgICAgICAgICAgfHwgJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGb250KCktPmdldEl0YWxpYygpICE9IG51bGwKICAgICAgICAgICAgfHwgJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGb250KCktPmdldFN1cGVyU2NyaXB0KCkgIT0gbnVsbAogICAgICAgICAgICB8fCAkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0U3ViU2NyaXB0KCkgIT0gbnVsbAogICAgICAgICAgICB8fCAkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0VW5kZXJsaW5lKCkgIT0gbnVsbAogICAgICAgICAgICB8fCAkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0U3RyaWtldGhyb3VnaCgpICE9IG51bGwKICAgICAgICAgICAgfHwgJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGb250KCktPmdldENvbG9yKCktPmdldEFSR0IoKSAhPSBudWxsKSB7CiAgICAgICAgICAgICRiRm9ybWF0Rm9udCA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGJGb3JtYXRGb250ID0gMDsKICAgICAgICB9CiAgICAgICAgLy8gQWxpZ25tZW50CiAgICAgICAgJGZsYWdzID0gMDsKICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gJGJBbGlnbkh6ICAgICAgPyAweDAwMDAwMDAxIDogMCk7CiAgICAgICAgJGZsYWdzIHw9ICgxID09ICRiQWxpZ25WdCAgICAgID8gMHgwMDAwMDAwMiA6IDApOwogICAgICAgICRmbGFncyB8PSAoMSA9PSAkYkFsaWduV3JhcFR4ICA\/IDB4MDAwMDAwMDQgOiAwKTsKICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gJGJUeFJvdGF0aW9uICAgPyAweDAwMDAwMDA4IDogMCk7CiAgICAgICAgLy8gSnVzdGlmeSBsYXN0IGxpbmUgZmxhZwogICAgICAgICRmbGFncyB8PSAoMSA9PSAxICAgICAgICAgICAgICA\/IDB4MDAwMDAwMTAgOiAwKTsKICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gJGJJbmRlbnQgICAgICAgPyAweDAwMDAwMDIwIDogMCk7CiAgICAgICAgJGZsYWdzIHw9ICgxID09ICRiU2hyaW5rVG9GaXQgID8gMHgwMDAwMDA0MCA6IDApOwogICAgICAgIC8vIERlZmF1bHQKICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gMSAgICAgICAgICAgICAgPyAweDAwMDAwMDgwIDogMCk7CiAgICAgICAgLy8gUHJvdGVjdGlvbgogICAgICAgICRmbGFncyB8PSAoMSA9PSAkYlByb3RMb2NrZWQgICA\/IDB4MDAwMDAxMDAgOiAwKTsKICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gJGJQcm90SGlkZGVuICAgPyAweDAwMDAwMjAwIDogMCk7CiAgICAgICAgLy8gQm9yZGVyCiAgICAgICAgJGZsYWdzIHw9ICgxID09ICRiQm9yZGVyTGVmdCAgID8gMHgwMDAwMDQwMCA6IDApOwogICAgICAgICRmbGFncyB8PSAoMSA9PSAkYkJvcmRlclJpZ2h0ICA\/IDB4MDAwMDA4MDAgOiAwKTsKICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gJGJCb3JkZXJUb3AgICAgPyAweDAwMDAxMDAwIDogMCk7CiAgICAgICAgJGZsYWdzIHw9ICgxID09ICRiQm9yZGVyQm90dG9tID8gMHgwMDAwMjAwMCA6IDApOwogICAgICAgICRmbGFncyB8PSAoMSA9PSAxICAgICAgICAgICAgICA\/IDB4MDAwMDQwMDAgOiAwKTsgLy8gVG9wIGxlZnQgdG8gQm90dG9tIHJpZ2h0IGJvcmRlcgogICAgICAgICRmbGFncyB8PSAoMSA9PSAxICAgICAgICAgICAgICA\/IDB4MDAwMDgwMDAgOiAwKTsgLy8gQm90dG9tIGxlZnQgdG8gVG9wIHJpZ2h0IGJvcmRlcgogICAgICAgIC8vIFBhdHRlcm4KICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gJGJGaWxsU3R5bGUgICAgPyAweDAwMDEwMDAwIDogMCk7CiAgICAgICAgJGZsYWdzIHw9ICgxID09ICRiRmlsbENvbG9yICAgID8gMHgwMDAyMDAwMCA6IDApOwogICAgICAgICRmbGFncyB8PSAoMSA9PSAkYkZpbGxDb2xvckJnICA\/IDB4MDAwNDAwMDAgOiAwKTsKICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gMSAgICAgICAgICAgICAgPyAweDAwMzgwMDAwIDogMCk7CiAgICAgICAgLy8gRm9udAogICAgICAgICRmbGFncyB8PSAoMSA9PSAkYkZvcm1hdEZvbnQgICA\/IDB4MDQwMDAwMDAgOiAwKTsKICAgICAgICAvLyBBbGlnbm1lbnQ6CiAgICAgICAgJGZsYWdzIHw9ICgxID09ICRiRm9ybWF0QWxpZ24gID8gMHgwODAwMDAwMCA6IDApOwogICAgICAgIC8vIEJvcmRlcgogICAgICAgICRmbGFncyB8PSAoMSA9PSAkYkZvcm1hdEJvcmRlciA\/IDB4MTAwMDAwMDAgOiAwKTsKICAgICAgICAvLyBQYXR0ZXJuCiAgICAgICAgJGZsYWdzIHw9ICgxID09ICRiRm9ybWF0RmlsbCAgID8gMHgyMDAwMDAwMCA6IDApOwogICAgICAgIC8vIFByb3RlY3Rpb24KICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gJGJGb3JtYXRQcm90ICAgPyAweDQwMDAwMDAwIDogMCk7CiAgICAgICAgLy8gVGV4dCBkaXJlY3Rpb24KICAgICAgICAkZmxhZ3MgfD0gKDEgPT0gMCAgICAgICAgICAgICAgPyAweDgwMDAwMDAwIDogMCk7CgogICAgICAgIC8vIERhdGEgQmxvY2tzCiAgICAgICAgaWYgKCRiRm9ybWF0Rm9udCA9PSAxKSB7CiAgICAgICAgICAgIC8vIEZvbnQgTmFtZQogICAgICAgICAgICBpZiAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGb250KCktPmdldE5hbWUoKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAkZGF0YUJsb2NrRm9udCA9ICBwYWNrKCdWVlZWVlZWVicsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDApOwogICAgICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygnVlZWVlZWVlYnLCAweDAwMDAwMDAwLCAweDAwMDAwMDAwLCAweDAwMDAwMDAwLCAweDAwMDAwMDAwLCAweDAwMDAwMDAwLCAweDAwMDAwMDAwLCAweDAwMDAwMDAwLCAweDAwMDAwMDAwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRkYXRhQmxvY2tGb250ID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6VVRGOHRvQklGRjhVbmljb2RlTG9uZygkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0TmFtZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBGb250IFNpemUKICAgICAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Rm9udCgpLT5nZXRTaXplKCkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygnVicsIDIwICogMTEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygnVicsIDIwICogJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGb250KCktPmdldFNpemUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRm9udCBPcHRpb25zCiAgICAgICAgICAgICRkYXRhQmxvY2tGb250IC49IHBhY2soJ1YnLCAwKTsKICAgICAgICAgICAgLy8gRm9udCB3ZWlnaHQKICAgICAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Rm9udCgpLT5nZXRCb2xkKCkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygndicsIDB4MDJCQyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCd2JywgMHgwMTkwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBFc2NhcGVtZW50IHR5cGUKICAgICAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Rm9udCgpLT5nZXRTdWJTY3JpcHQoKSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCd2JywgMHgwMik7CiAgICAgICAgICAgICAgICAkZm9udEVzY2FwZW1lbnQgPSAwOwogICAgICAgICAgICB9IGVsc2VpZiAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGb250KCktPmdldFN1cGVyU2NyaXB0KCkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygndicsIDB4MDEpOwogICAgICAgICAgICAgICAgJGZvbnRFc2NhcGVtZW50ID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRkYXRhQmxvY2tGb250IC49IHBhY2soJ3YnLCAweDAwKTsKICAgICAgICAgICAgICAgICRmb250RXNjYXBlbWVudCA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gVW5kZXJsaW5lIHR5cGUKICAgICAgICAgICAgc3dpdGNoICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0VW5kZXJsaW5lKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRm9udDo6VU5ERVJMSU5FX05PTkU6CiAgICAgICAgICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygnQycsIDB4MDApOwogICAgICAgICAgICAgICAgICAgICRmb250VW5kZXJsaW5lID0gMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRm9udDo6VU5ERVJMSU5FX0RPVUJMRToKICAgICAgICAgICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCdDJywgMHgwMik7CiAgICAgICAgICAgICAgICAgICAgJGZvbnRVbmRlcmxpbmUgPSAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Gb250OjpVTkRFUkxJTkVfRE9VQkxFQUNDT1VOVElORzoKICAgICAgICAgICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCdDJywgMHgyMik7CiAgICAgICAgICAgICAgICAgICAgJGZvbnRVbmRlcmxpbmUgPSAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Gb250OjpVTkRFUkxJTkVfU0lOR0xFOgogICAgICAgICAgICAgICAgICAgICRkYXRhQmxvY2tGb250IC49IHBhY2soJ0MnLCAweDAxKTsKICAgICAgICAgICAgICAgICAgICAkZm9udFVuZGVybGluZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0ZvbnQ6OlVOREVSTElORV9TSU5HTEVBQ0NPVU5USU5HOgogICAgICAgICAgICAgICAgICAgICRkYXRhQmxvY2tGb250IC49IHBhY2soJ0MnLCAweDIxKTsKICAgICAgICAgICAgICAgICAgICAkZm9udFVuZGVybGluZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OiAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCdDJywgMHgwMCk7CiAgICAgICAgICAgICAgICAgICAgJGZvbnRVbmRlcmxpbmUgPSAxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIE5vdCB1c2VkICgzKQogICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCd2QycsIDB4MDAwMCwgMHgwMCk7CiAgICAgICAgICAgIC8vIEZvbnQgY29sb3IgaW5kZXgKICAgICAgICAgICAgc3dpdGNoICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0Q29sb3IoKS0+Z2V0UkdCKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGMDAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwQTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwRkYwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwQjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDBGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwQzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkYwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGMDBGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwMDAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwODAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwODAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwMDA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwODA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0MwQzBDMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwODA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxNzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5OTlGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5MzM2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkZDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxQTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxQjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzY2MDA2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxQzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGODA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwNjZDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDQ0NGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgxRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGMDBGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkYwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwMDA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwMDAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwODA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDBGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyNzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwQ0NGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDRkZDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyQTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkY5OSc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyQjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5Q0NGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyQzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGOTlDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDOTlGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGQ0M5OSc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgyRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzNjZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzQ0NDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5Q0MwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGQ0MwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGOTkwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGNjYwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzY2NjY5OSc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk2OTY5Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzNzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMzM2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzOTk2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMzMwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzQTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzMzMwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzQjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5MzMwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzQzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5MzM2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzMzM5OSc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzMzMzMyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgzRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4ID0gMHgwMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCdWJywgJGNvbG9ySWR4KTsKICAgICAgICAgICAgLy8gTm90IHVzZWQgKDQpCiAgICAgICAgICAgICRkYXRhQmxvY2tGb250IC49IHBhY2soJ1YnLCAweDAwMDAwMDAwKTsKICAgICAgICAgICAgLy8gT3B0aW9ucyBmbGFncyBmb3IgbW9kaWZpZWQgZm9udCBhdHRyaWJ1dGVzCiAgICAgICAgICAgICRvcHRpb25zRmxhZ3MgPSAwOwogICAgICAgICAgICAkb3B0aW9uc0ZsYWdzQm9sZCA9ICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZvbnQoKS0+Z2V0Qm9sZCgpID09IG51bGwgPyAxIDogMCk7CiAgICAgICAgICAgICRvcHRpb25zRmxhZ3MgfD0gKDEgPT0gJG9wdGlvbnNGbGFnc0JvbGQgID8gMHgwMDAwMDAwMiA6IDApOwogICAgICAgICAgICAkb3B0aW9uc0ZsYWdzIHw9ICgxID09IDEgICAgICAgICAgICAgICAgICA\/IDB4MDAwMDAwMDggOiAwKTsKICAgICAgICAgICAgJG9wdGlvbnNGbGFncyB8PSAoMSA9PSAxICAgICAgICAgICAgICAgICAgPyAweDAwMDAwMDEwIDogMCk7CiAgICAgICAgICAgICRvcHRpb25zRmxhZ3MgfD0gKDEgPT0gMCAgICAgICAgICAgICAgICAgID8gMHgwMDAwMDAyMCA6IDApOwogICAgICAgICAgICAkb3B0aW9uc0ZsYWdzIHw9ICgxID09IDEgICAgICAgICAgICAgICAgICA\/IDB4MDAwMDAwODAgOiAwKTsKICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygnVicsICRvcHRpb25zRmxhZ3MpOwogICAgICAgICAgICAvLyBFc2NhcGVtZW50IHR5cGUKICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygnVicsICRmb250RXNjYXBlbWVudCk7CiAgICAgICAgICAgIC8vIFVuZGVybGluZSB0eXBlCiAgICAgICAgICAgICRkYXRhQmxvY2tGb250IC49IHBhY2soJ1YnLCAkZm9udFVuZGVybGluZSk7CiAgICAgICAgICAgIC8vIEFsd2F5cwogICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCdWJywgMHgwMDAwMDAwMCk7CiAgICAgICAgICAgIC8vIEFsd2F5cwogICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCdWJywgMHgwMDAwMDAwMCk7CiAgICAgICAgICAgIC8vIE5vdCB1c2VkICg4KQogICAgICAgICAgICAkZGF0YUJsb2NrRm9udCAuPSBwYWNrKCdWVicsIDB4MDAwMDAwMDAsIDB4MDAwMDAwMDApOwogICAgICAgICAgICAvLyBBbHdheXMKICAgICAgICAgICAgJGRhdGFCbG9ja0ZvbnQgLj0gcGFjaygndicsIDB4MDAwMSk7CiAgICAgICAgfQogICAgICAgIGlmICgkYkZvcm1hdEFsaWduID09IDEpIHsKICAgICAgICAgICAgJGJsb2NrQWxpZ24gPSAwOwogICAgICAgICAgICAvLyBBbGlnbm1lbnQgYW5kIHRleHQgYnJlYWsKICAgICAgICAgICAgc3dpdGNoICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEFsaWdubWVudCgpLT5nZXRIb3Jpem9udGFsKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0dFTkVSQUw6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrQWxpZ24gPSAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfTEVGVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tBbGlnbiA9IDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6SE9SSVpPTlRBTF9SSUdIVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tBbGlnbiA9IDM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6SE9SSVpPTlRBTF9DRU5URVI6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrQWxpZ24gPSAyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfQ0VOVEVSX0NPTlRJTlVPVVM6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrQWxpZ24gPSA2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfSlVTVElGWToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tBbGlnbiA9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0QWxpZ25tZW50KCktPmdldFdyYXBUZXh0KCkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgJGJsb2NrQWxpZ24gfD0gMSA8PCAzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGJsb2NrQWxpZ24gfD0gMCA8PCAzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN3aXRjaCAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRBbGlnbm1lbnQoKS0+Z2V0VmVydGljYWwoKSkgewogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OlZFUlRJQ0FMX0JPVFRPTToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tBbGlnbiA9IDIgPDwgNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpWRVJUSUNBTF9UT1A6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrQWxpZ24gPSAwIDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfQ0VOVEVSOgogICAgICAgICAgICAgICAgICAgICRibG9ja0FsaWduID0gMSA8PCA0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OlZFUlRJQ0FMX0pVU1RJRlk6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrQWxpZ24gPSAzIDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGJsb2NrQWxpZ24gfD0gMCA8PCA3OwoKICAgICAgICAgICAgLy8gVGV4dCByb3RhdGlvbiBhbmdsZQogICAgICAgICAgICAkYmxvY2tSb3RhdGlvbiA9ICRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0QWxpZ25tZW50KCktPmdldFRleHRSb3RhdGlvbigpOwoKICAgICAgICAgICAgLy8gSW5kZW50YXRpb24KICAgICAgICAgICAgJGJsb2NrSW5kZW50ID0gJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRBbGlnbm1lbnQoKS0+Z2V0SW5kZW50KCk7CiAgICAgICAgICAgIGlmICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEFsaWdubWVudCgpLT5nZXRTaHJpbmtUb0ZpdCgpID09IHRydWUpIHsKICAgICAgICAgICAgICAgICRibG9ja0luZGVudCB8PSAxIDw8IDQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkYmxvY2tJbmRlbnQgfD0gMCA8PCA0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICRibG9ja0luZGVudCB8PSAwIDw8IDY7CgogICAgICAgICAgICAvLyBSZWxhdGl2ZSBpbmRlbnRhdGlvbgogICAgICAgICAgICAkYmxvY2tJbmRlbnRSZWxhdGl2ZSA9IDI1NTsKCiAgICAgICAgICAgICRkYXRhQmxvY2tBbGlnbiA9IHBhY2soJ0NDdnZ2JywgJGJsb2NrQWxpZ24sICRibG9ja1JvdGF0aW9uLCAkYmxvY2tJbmRlbnQsICRibG9ja0luZGVudFJlbGF0aXZlLCAweDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoJGJGb3JtYXRCb3JkZXIgPT0gMSkgewogICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgPSAwOwogICAgICAgICAgICBzd2l0Y2ggKCRjb25kaXRpb25hbC0+Z2V0U3R5bGUoKS0+Z2V0Qm9yZGVycygpLT5nZXRMZWZ0KCktPmdldEJvcmRlclN0eWxlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTk9ORToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfVEhJTjoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDAyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRUQ6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RPVFRFRDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfVEhJQ0s6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RPVUJMRToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfSEFJUjoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwNzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNREFTSEVEOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA5OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9NRURJVU1EQVNIRE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRE9URE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDBCOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9NRURJVU1EQVNIRE9URE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDBDOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9TTEFOVERBU0hET1Q6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MEQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEJvcmRlcnMoKS0+Z2V0UmlnaHQoKS0+Z2V0Qm9yZGVyU3R5bGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9OT05FOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDAwIDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX1RISU46CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDEgPDwgNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDAyIDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RBU0hFRDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwMyA8PCA0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9ET1RURUQ6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDQgPDwgNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfVEhJQ0s6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDUgPDwgNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfRE9VQkxFOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA2IDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0hBSVI6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDcgPDwgNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNREFTSEVEOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA4IDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RBU0hET1Q6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDkgPDwgNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNREFTSERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwQSA8PCA0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRE9URE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDBCIDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hET1RET1Q6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MEMgPDwgNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfU0xBTlREQVNIRE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDBEIDw8IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEJvcmRlcnMoKS0+Z2V0VG9wKCktPmdldEJvcmRlclN0eWxlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTk9ORToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwMCA8PCA4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9USElOOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDAxIDw8IDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwMiA8PCA4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRUQ6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDMgPDwgODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfRE9UVEVEOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA0IDw8IDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX1RISUNLOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA1IDw8IDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RPVUJMRToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwNiA8PCA4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9IQUlSOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA3IDw8IDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hFRDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwOCA8PCA4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA5IDw8IDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hET1Q6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MEEgPDwgODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfREFTSERPVERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwQiA8PCA4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9NRURJVU1EQVNIRE9URE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDBDIDw8IDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX1NMQU5UREFTSERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwRCA8PCA4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN3aXRjaCAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRCb3JkZXJzKCktPmdldEJvdHRvbSgpLT5nZXRCb3JkZXJTdHlsZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX05PTkU6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDAgPDwgMTI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX1RISU46CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDEgPDwgMTI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwMiA8PCAxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfREFTSEVEOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDAzIDw8IDEyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9ET1RURUQ6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDQgPDwgMTI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX1RISUNLOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDA1IDw8IDEyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9ET1VCTEU6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDYgPDwgMTI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0hBSVI6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrTGluZVN0eWxlIHw9IDB4MDcgPDwgMTI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hFRDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwOCA8PCAxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfREFTSERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwOSA8PCAxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNREFTSERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwQSA8PCAxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfREFTSERPVERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwQiA8PCAxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNREFTSERPVERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tMaW5lU3R5bGUgfD0gMHgwQyA8PCAxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfU0xBTlREQVNIRE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0xpbmVTdHlsZSB8PSAweDBEIDw8IDEyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vQHRvZG8gd3JpdGVDRlJ1bGUoKSA9PiAkYmxvY2tMaW5lU3R5bGUgPT4gSW5kZXggQ29sb3IgZm9yIGxlZnQgbGluZQogICAgICAgICAgICAvL0B0b2RvIHdyaXRlQ0ZSdWxlKCkgPT4gJGJsb2NrTGluZVN0eWxlID0+IEluZGV4IENvbG9yIGZvciByaWdodCBsaW5lCiAgICAgICAgICAgIC8vQHRvZG8gd3JpdGVDRlJ1bGUoKSA9PiAkYmxvY2tMaW5lU3R5bGUgPT4gVG9wLWxlZnQgdG8gYm90dG9tLXJpZ2h0IG9uL29mZgogICAgICAgICAgICAvL0B0b2RvIHdyaXRlQ0ZSdWxlKCkgPT4gJGJsb2NrTGluZVN0eWxlID0+IEJvdHRvbS1sZWZ0IHRvIHRvcC1yaWdodCBvbi9vZmYKICAgICAgICAgICAgJGJsb2NrQ29sb3IgPSAwOwogICAgICAgICAgICAvL0B0b2RvIHdyaXRlQ0ZSdWxlKCkgPT4gJGJsb2NrQ29sb3IgPT4gSW5kZXggQ29sb3IgZm9yIHRvcCBsaW5lCiAgICAgICAgICAgIC8vQHRvZG8gd3JpdGVDRlJ1bGUoKSA9PiAkYmxvY2tDb2xvciA9PiBJbmRleCBDb2xvciBmb3IgYm90dG9tIGxpbmUKICAgICAgICAgICAgLy9AdG9kbyB3cml0ZUNGUnVsZSgpID0+ICRibG9ja0NvbG9yID0+IEluZGV4IENvbG9yIGZvciBkaWFnb25hbCBsaW5lCiAgICAgICAgICAgIHN3aXRjaCAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRCb3JkZXJzKCktPmdldERpYWdvbmFsKCktPmdldEJvcmRlclN0eWxlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTk9ORToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tDb2xvciB8PSAweDAwIDw8IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9USElOOgogICAgICAgICAgICAgICAgICAgICRibG9ja0NvbG9yIHw9IDB4MDEgPDwgMjE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tDb2xvciB8PSAweDAyIDw8IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRUQ6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrQ29sb3IgfD0gMHgwMyA8PCAyMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfRE9UVEVEOgogICAgICAgICAgICAgICAgICAgICRibG9ja0NvbG9yIHw9IDB4MDQgPDwgMjE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX1RISUNLOgogICAgICAgICAgICAgICAgICAgICRibG9ja0NvbG9yIHw9IDB4MDUgPDwgMjE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RPVUJMRToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tDb2xvciB8PSAweDA2IDw8IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9IQUlSOgogICAgICAgICAgICAgICAgICAgICRibG9ja0NvbG9yIHw9IDB4MDcgPDwgMjE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hFRDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tDb2xvciB8PSAweDA4IDw8IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9EQVNIRE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0NvbG9yIHw9IDB4MDkgPDwgMjE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hET1Q6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrQ29sb3IgfD0gMHgwQSA8PCAyMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfREFTSERPVERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tDb2xvciB8PSAweDBCIDw8IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9NRURJVU1EQVNIRE9URE9UOgogICAgICAgICAgICAgICAgICAgICRibG9ja0NvbG9yIHw9IDB4MEMgPDwgMjE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX1NMQU5UREFTSERPVDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tDb2xvciB8PSAweDBEIDw8IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRkYXRhQmxvY2tCb3JkZXIgPSBwYWNrKCd2dicsICRibG9ja0xpbmVTdHlsZSwgJGJsb2NrQ29sb3IpOwogICAgICAgIH0KICAgICAgICBpZiAoJGJGb3JtYXRGaWxsID09IDEpIHsKICAgICAgICAgICAgLy8gRmlsbCBQYXRlcm4gU3R5bGUKICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDA7CiAgICAgICAgICAgIHN3aXRjaCAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGaWxsKCktPmdldEZpbGxUeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9OT05FOgogICAgICAgICAgICAgICAgICAgICRibG9ja0ZpbGxQYXR0ZXJuU3R5bGUgPSAweDAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX1NPTElEOgogICAgICAgICAgICAgICAgICAgICRibG9ja0ZpbGxQYXR0ZXJuU3R5bGUgPSAweDAxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX1BBVFRFUk5fTUVESVVNR1JBWToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgwMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9QQVRURVJOX0RBUktHUkFZOgogICAgICAgICAgICAgICAgICAgICRibG9ja0ZpbGxQYXR0ZXJuU3R5bGUgPSAweDAzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX1BBVFRFUk5fTElHSFRHUkFZOgogICAgICAgICAgICAgICAgICAgICRibG9ja0ZpbGxQYXR0ZXJuU3R5bGUgPSAweDA0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX1BBVFRFUk5fREFSS0hPUklaT05UQUw6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDB4MDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0ZpbGw6OkZJTExfUEFUVEVSTl9EQVJLVkVSVElDQUw6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDB4MDY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0ZpbGw6OkZJTExfUEFUVEVSTl9EQVJLRE9XTjoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgwNzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9QQVRURVJOX0RBUktVUDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgwODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9QQVRURVJOX0RBUktHUklEOgogICAgICAgICAgICAgICAgICAgICRibG9ja0ZpbGxQYXR0ZXJuU3R5bGUgPSAweDA5OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX1BBVFRFUk5fREFSS1RSRUxMSVM6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDB4MEE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0ZpbGw6OkZJTExfUEFUVEVSTl9MSUdIVEhPUklaT05UQUw6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDB4MEI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0ZpbGw6OkZJTExfUEFUVEVSTl9MSUdIVFZFUlRJQ0FMOgogICAgICAgICAgICAgICAgICAgICRibG9ja0ZpbGxQYXR0ZXJuU3R5bGUgPSAweDBDOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX1BBVFRFUk5fTElHSFRET1dOOgogICAgICAgICAgICAgICAgICAgICRibG9ja0ZpbGxQYXR0ZXJuU3R5bGUgPSAweDBEOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX1BBVFRFUk5fTElHSFRVUDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgwRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9QQVRURVJOX0xJR0hUR1JJRDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgwRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9QQVRURVJOX0xJR0hUVFJFTExJUzoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgxMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9QQVRURVJOX0dSQVkxMjU6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDB4MTE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0ZpbGw6OkZJTExfUEFUVEVSTl9HUkFZMDYyNToKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfRmlsbDo6RklMTF9HUkFESUVOVF9MSU5FQVI6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDB4MDA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7ICAgIC8vIGRvZXMgbm90IGV4aXN0IGluIEJJRkY4CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0ZpbGw6OkZJTExfR1JBRElFTlRfUEFUSDoKICAgICAgICAgICAgICAgICAgICAkYmxvY2tGaWxsUGF0dGVyblN0eWxlID0gMHgwMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsgICAgLy8gZG9lcyBub3QgZXhpc3QgaW4gQklGRjgKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSA9IDB4MDA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQ29sb3IKICAgICAgICAgICAgc3dpdGNoICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldEZpbGwoKS0+Z2V0U3RhcnRDb2xvcigpLT5nZXRSR0IoKSkgewogICAgICAgICAgICAgICAgY2FzZSAnMDAwMDAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MDg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRkZGRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgwOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGMDAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDBGRjAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MEI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDAwRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgwQzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkYwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDBEOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkYwMEZGJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MEU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMEZGRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgwRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwMDAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDEwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDA4MDAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MTE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDAwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwODAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDEzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnODAwMDgwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MTQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDgwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgxNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0MwQzBDMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDE2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnODA4MDgwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MTc7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc5OTk5RkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgxODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5MzM2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDE5OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkZGRkNDJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MUE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdDQ0ZGRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgxQjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzY2MDA2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDFDOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkY4MDgwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MUQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDY2Q0MnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgxRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDQ0NGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDFGOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDAwMDgwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MjA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRjAwRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgyMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkYwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDIyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDBGRkZGJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MjM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc4MDAwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgyNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwMDAwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDI1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDA4MDgwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MjY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDAwRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgyNzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwQ0NGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDI4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnQ0NGRkZGJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4Mjk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdDQ0ZGQ0MnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgyQTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkY5OSc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDJCOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnOTlDQ0ZGJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MkM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRjk5Q0MnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgyRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDOTlGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDJFOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkZDQzk5JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MkY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICczMzY2RkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgzMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzQ0NDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDMxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnOTlDQzAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MzI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRkNDMDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgzMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGOTkwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDM0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkY2NjAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4MzU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc2NjY2OTknOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgzNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk2OTY5Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDM3OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDAzMzY2JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4Mzg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICczMzk5NjYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgzOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMzMwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDNBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMzMzMzAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4M0I7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc5OTMzMDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgzQzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5MzM2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDNEOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMzMzMzk5JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhCZyA9IDB4M0U7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICczMzMzMzMnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEJnID0gMHgzRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4QmcgPSAweDQxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEZnIENvbG9yCiAgICAgICAgICAgIHN3aXRjaCAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRGaWxsKCktPmdldEVuZENvbG9yKCktPmdldFJHQigpKSB7CiAgICAgICAgICAgICAgICBjYXNlICcwMDAwMDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgwODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDA5OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkYwMDAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MEE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMEZGMDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgwQjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDBGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDBDOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkZGRjAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MEQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRjAwRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgwRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDBGOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnODAwMDAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MTA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDgwMDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgxMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDEyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnODA4MDAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MTM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc4MDAwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgxNDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwODA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDE1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnQzBDMEMwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MTY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc4MDgwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgxNzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5OTlGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDE4OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnOTkzMzY2JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MTk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRkZGQ0MnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgxQTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDRkZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDFCOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnNjYwMDY2JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MUM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRjgwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgxRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwNjZDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDFFOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnQ0NDQ0ZGJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MUY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDAwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgyMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGMDBGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkZGRjAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MjI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMEZGRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgyMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzgwMDA4MCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDI0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnODAwMDAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MjU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDgwODAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgyNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzAwMDBGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDI3OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDBDQ0ZGJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4Mjg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdDQ0ZGRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgyOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0NDRkZDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDJBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkZGRjk5JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MkI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc5OUNDRkYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgyQzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGOTlDQyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDJEOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnQ0M5OUZGJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MkU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRkNDOTknOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgyRjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzNjZGRic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDMwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMzNDQ0NDJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MzE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICc5OUNDMDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgzMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZGQ0MwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDMzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnRkY5OTAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4MzQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdGRjY2MDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgzNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzY2NjY5OSc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDM2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnOTY5Njk2JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4Mzc7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICcwMDMzNjYnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgzODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzOTk2Nic6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDM5OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnMDAzMzAwJzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4M0E7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICczMzMzMDAnOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgzQjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzk5MzMwMCc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDNDOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnOTkzMzY2JzoKICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4M0Q7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICczMzMzOTknOgogICAgICAgICAgICAgICAgICAgICRjb2xvcklkeEZnID0gMHgzRTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJzMzMzMzMyc6CiAgICAgICAgICAgICAgICAgICAgJGNvbG9ySWR4RmcgPSAweDNGOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sb3JJZHhGZyA9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGRhdGFCbG9ja0ZpbGwgPSBwYWNrKCd2JywgJGJsb2NrRmlsbFBhdHRlcm5TdHlsZSk7CiAgICAgICAgICAgICRkYXRhQmxvY2tGaWxsIC49IHBhY2soJ3YnLCAkY29sb3JJZHhGZyB8ICgkY29sb3JJZHhCZyA8PCA3KSk7CiAgICAgICAgfQogICAgICAgIGlmICgkYkZvcm1hdFByb3QgPT0gMSkgewogICAgICAgICAgICAkZGF0YUJsb2NrUHJvdGVjdGlvbiA9IDA7CiAgICAgICAgICAgIGlmICgkY29uZGl0aW9uYWwtPmdldFN0eWxlKCktPmdldFByb3RlY3Rpb24oKS0+Z2V0TG9ja2VkKCkgPT0gUEhQRXhjZWxfU3R5bGVfUHJvdGVjdGlvbjo6UFJPVEVDVElPTl9QUk9URUNURUQpIHsKICAgICAgICAgICAgICAgICRkYXRhQmxvY2tQcm90ZWN0aW9uID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJGNvbmRpdGlvbmFsLT5nZXRTdHlsZSgpLT5nZXRQcm90ZWN0aW9uKCktPmdldEhpZGRlbigpID09IFBIUEV4Y2VsX1N0eWxlX1Byb3RlY3Rpb246OlBST1RFQ1RJT05fUFJPVEVDVEVEKSB7CiAgICAgICAgICAgICAgICAkZGF0YUJsb2NrUHJvdGVjdGlvbiA9IDEgPDwgMTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJGRhdGEgICAgICA9IHBhY2soJ0NDdnZWdicsICR0eXBlLCAkb3BlcmF0b3JUeXBlLCAkc3pWYWx1ZTEsICRzelZhbHVlMiwgJGZsYWdzLCAweDAwMDApOwogICAgICAgIGlmICgkYkZvcm1hdEZvbnQgPT0gMSkgeyAvLyBCbG9jayBGb3JtYXR0aW5nIDogT0sKICAgICAgICAgICAgJGRhdGEgLj0gJGRhdGFCbG9ja0ZvbnQ7CiAgICAgICAgfQogICAgICAgIGlmICgkYkZvcm1hdEFsaWduID09IDEpIHsKICAgICAgICAgICAgJGRhdGEgLj0gJGRhdGFCbG9ja0FsaWduOwogICAgICAgIH0KICAgICAgICBpZiAoJGJGb3JtYXRCb3JkZXIgPT0gMSkgewogICAgICAgICAgICAkZGF0YSAuPSAkZGF0YUJsb2NrQm9yZGVyOwogICAgICAgIH0KICAgICAgICBpZiAoJGJGb3JtYXRGaWxsID09IDEpIHsgLy8gQmxvY2sgRm9ybWF0dGluZyA6IE9LCiAgICAgICAgICAgICRkYXRhIC49ICRkYXRhQmxvY2tGaWxsOwogICAgICAgIH0KICAgICAgICBpZiAoJGJGb3JtYXRQcm90ID09IDEpIHsKICAgICAgICAgICAgJGRhdGEgLj0gJGRhdGFCbG9ja1Byb3RlY3Rpb247CiAgICAgICAgfQogICAgICAgIGlmICghaXNfbnVsbCgkb3BlcmFuZDEpKSB7CiAgICAgICAgICAgICRkYXRhIC49ICRvcGVyYW5kMTsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc19udWxsKCRvcGVyYW5kMikpIHsKICAgICAgICAgICAgJGRhdGEgLj0gJG9wZXJhbmQyOwogICAgICAgIH0KICAgICAgICAkaGVhZGVyICAgICAgPSBwYWNrKCd2dicsICRyZWNvcmQsIHN0cmxlbigkZGF0YSkpOwogICAgICAgICR0aGlzLT5hcHBlbmQoJGhlYWRlciAuICRkYXRhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIENGSGVhZGVyIHJlY29yZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIHdyaXRlQ0ZIZWFkZXIoKQogICAgewogICAgICAgICRyZWNvcmQgICAgICA9IDB4MDFCMDsgICAgICAgICAgICAgICAvLyBSZWNvcmQgaWRlbnRpZmllcgogICAgICAgICRsZW5ndGggICAgICA9IDB4MDAxNjsgICAgICAgICAgICAgICAvLyBCeXRlcyB0byBmb2xsb3cKCiAgICAgICAgJG51bUNvbHVtbk1pbiA9IG51bGw7CiAgICAgICAgJG51bUNvbHVtbk1heCA9IG51bGw7CiAgICAgICAgJG51bVJvd01pbiA9IG51bGw7CiAgICAgICAgJG51bVJvd01heCA9IG51bGw7CiAgICAgICAgJGFyckNvbmRpdGlvbmFsID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+cGhwU2hlZXQtPmdldENvbmRpdGlvbmFsU3R5bGVzQ29sbGVjdGlvbigpIGFzICRjZWxsQ29vcmRpbmF0ZSA9PiAkY29uZGl0aW9uYWxTdHlsZXMpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGNvbmRpdGlvbmFsU3R5bGVzIGFzICRjb25kaXRpb25hbCkgewogICAgICAgICAgICAgICAgaWYgKCRjb25kaXRpb25hbC0+Z2V0Q29uZGl0aW9uVHlwZSgpID09IFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsOjpDT05ESVRJT05fRVhQUkVTU0lPTgogICAgICAgICAgICAgICAgICAgICAgICB8fCAkY29uZGl0aW9uYWwtPmdldENvbmRpdGlvblR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbDo6Q09ORElUSU9OX0NFTExJUykgewogICAgICAgICAgICAgICAgICAgIGlmICghaW5fYXJyYXkoJGNvbmRpdGlvbmFsLT5nZXRIYXNoQ29kZSgpLCAkYXJyQ29uZGl0aW9uYWwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcnJDb25kaXRpb25hbFtdID0gJGNvbmRpdGlvbmFsLT5nZXRIYXNoQ29kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBDZWxscwogICAgICAgICAgICAgICAgICAgICRhcnJDb29yZCA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRjZWxsQ29vcmRpbmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc19udW1lcmljKCRhcnJDb29yZFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFyckNvb3JkWzBdID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRhcnJDb29yZFswXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChpc19udWxsKCRudW1Db2x1bW5NaW4pIHx8ICgkbnVtQ29sdW1uTWluID4gJGFyckNvb3JkWzBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbnVtQ29sdW1uTWluID0gJGFyckNvb3JkWzBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNfbnVsbCgkbnVtQ29sdW1uTWF4KSB8fCAoJG51bUNvbHVtbk1heCA8ICRhcnJDb29yZFswXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG51bUNvbHVtbk1heCA9ICRhcnJDb29yZFswXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX251bGwoJG51bVJvd01pbikgfHwgKCRudW1Sb3dNaW4gPiAkYXJyQ29vcmRbMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRudW1Sb3dNaW4gPSAkYXJyQ29vcmRbMV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChpc19udWxsKCRudW1Sb3dNYXgpIHx8ICgkbnVtUm93TWF4IDwgJGFyckNvb3JkWzFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbnVtUm93TWF4ID0gJGFyckNvb3JkWzFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkbmVlZFJlZHJhdyA9IDE7CiAgICAgICAgJGNlbGxSYW5nZSA9IHBhY2soJ3Z2dnYnLCAkbnVtUm93TWluLTEsICRudW1Sb3dNYXgtMSwgJG51bUNvbHVtbk1pbi0xLCAkbnVtQ29sdW1uTWF4LTEpOwoKICAgICAgICAkaGVhZGVyICAgICAgPSBwYWNrKCd2dicsICRyZWNvcmQsICRsZW5ndGgpOwogICAgICAgICRkYXRhICAgICAgPSBwYWNrKCd2dicsIGNvdW50KCRhcnJDb25kaXRpb25hbCksICRuZWVkUmVkcmF3KTsKICAgICAgICAkZGF0YSAgICAgLj0gJGNlbGxSYW5nZTsKICAgICAgICAkZGF0YSAgICAgLj0gcGFjaygndicsIDB4MDAwMSk7CiAgICAgICAgJGRhdGEgICAgIC49ICRjZWxsUmFuZ2U7CiAgICAgICAgJHRoaXMtPmFwcGVuZCgkaGVhZGVyIC4gJGRhdGEpOwogICAgfQp9Cg==",
    "size": "160405"
}