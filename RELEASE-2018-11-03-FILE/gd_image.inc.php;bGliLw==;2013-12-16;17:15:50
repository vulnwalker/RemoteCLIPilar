{
    "namaFile": "lib\/gd_image.inc.php",
    "lastUpdate": "2013-12-16+17:15:50.00",
    "contentFile": "PD9waHANCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi8vIEZpbGU6CUdEX0lNQUdFLklOQy5QSFANCi8vIERlc2NyaXB0aW9uOglQSFAgR3JhcGggUGxvdHRpbmcgbGlicmFyeS4gTG93IGxldmVsIGltYWdlIGRyYXdpbmcgcm91dGluZXMNCi8vIENyZWF0ZWQ6IAkyMDAxLTAxLTA4LCByZWZhY3RvcmVkIDIwMDgtMDMtMjkNCi8vIFZlcjoJCSRJZCQNCi8vDQovLyBDb3B5cmlnaHQgKGMpIEFkaXR1cyBDb25zdWx0aW5nLiBBbGwgcmlnaHRzIHJlc2VydmVkLg0KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KCQ0KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi8vIENMQVNTIEltYWdlDQovLyBEZXNjcmlwdGlvbjogV3JhcHBlciBjbGFzcyB3aXRoIHNvbWUgZ29vZGllcyB0byBmb3JtIHRoZQ0KLy8gSW50ZXJmYWNlIHRvIGxvdyBsZXZlbCBpbWFnZSBkcmF3aW5nIHJvdXRpbmVzLg0KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCmNsYXNzIEltYWdlIHsNCiAgICBwdWJsaWMgJGxlZnRfbWFyZ2luPTMwLCRyaWdodF9tYXJnaW49MzAsJHRvcF9tYXJnaW49MjAsJGJvdHRvbV9tYXJnaW49MzA7DQogICAgcHVibGljICRpbWc9bnVsbDsNCiAgICBwdWJsaWMgJHBsb3R3aWR0aD0wLCRwbG90aGVpZ2h0PTA7DQogICAgcHVibGljICR3aWR0aD0wLCAkaGVpZ2h0PTA7DQogICAgcHVibGljICRyZ2I9bnVsbDsNCiAgICBwdWJsaWMgJGN1cnJlbnRfY29sb3IsJGN1cnJlbnRfY29sb3JfbmFtZTsNCiAgICBwdWJsaWMgJGxpbmVfd2VpZ2h0PTEsICRsaW5lX3N0eWxlPUxJTkVTVFlMRV9TT0xJRDsJDQogICAgcHVibGljICRpbWdfZm9ybWF0Ow0KICAgIHByb3RlY3RlZCAkZXhwaXJlZD10cnVlOw0KICAgIHByb3RlY3RlZCAkbGFzdHg9MCwgJGxhc3R5PTA7DQogICAgcHJvdGVjdGVkICRvYnNfbGlzdD1hcnJheSgpOw0KICAgIHByb3RlY3RlZCAkZm9udF9zaXplPTEyLCRmb250X2ZhbWlseT1GRl9GT05UMSwgJGZvbnRfc3R5bGU9RlNfTk9STUFMOw0KICAgIHByb3RlY3RlZCAkZm9udF9maWxlPScnOw0KICAgIHByb3RlY3RlZCAkdGV4dF9oYWxpZ249ImxlZnQiLCR0ZXh0X3ZhbGlnbj0iYm90dG9tIjsNCiAgICBwcm90ZWN0ZWQgJHR0Zj1udWxsOw0KICAgIHByb3RlY3RlZCAkdXNlX2FudGlfYWxpYXNpbmc9ZmFsc2U7DQogICAgcHJvdGVjdGVkICRxdWFsaXR5PW51bGw7DQogICAgcHJvdGVjdGVkICRjb2xvcnN0YWNrPWFycmF5KCksJGNvbG9yc3RhY2tpZHg9MDsNCiAgICBwcm90ZWN0ZWQgJGNhbnZhc2NvbG9yID0gJ3doaXRlJyA7DQogICAgcHJvdGVjdGVkICRsYW5nY29udiA9IG51bGwgOw0KICAgIHByb3RlY3RlZCAkaUludGVybGFjZT1mYWxzZTsNCiAgICAvLy0tLS0tLS0tLS0tLS0tLQ0KICAgIC8vIENPTlNUUlVDVE9SDQogICAgZnVuY3Rpb24gSW1hZ2UoJGFXaWR0aCwkYUhlaWdodCwkYUZvcm1hdD1ERUZBVUxUX0dGT1JNQVQsJGFTZXRBdXRvTWFyZ2luPXRydWUpIHsNCgkkdGhpcy0+Q3JlYXRlSW1nQ2FudmFzKCRhV2lkdGgsJGFIZWlnaHQpOw0KCWlmKCAkYVNldEF1dG9NYXJnaW4gKQ0KCSAgICAkdGhpcy0+U2V0QXV0b01hcmdpbigpOwkJDQoNCglpZiggISR0aGlzLT5TZXRJbWdGb3JtYXQoJGFGb3JtYXQpICkgew0KCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA4MSwkYUZvcm1hdCk7Ly8oIkpwR3JhcGg6IFNlbGVjdGVkIGdyYXBoaWMgZm9ybWF0IGlzIGVpdGhlciBub3Qgc3VwcG9ydGVkIG9yIHVua25vd24gWyRhRm9ybWF0XSIpOw0KCX0NCgkkdGhpcy0+dHRmID0gbmV3IFRURigpOw0KCSR0aGlzLT5sYW5nY29udiA9IG5ldyBMYW5ndWFnZUNvbnYoKTsNCiAgICB9DQoNCiAgICAvLyBFbmFibGUgaW50ZXJsYWNpbmcgaW4gaW1hZ2VzDQogICAgZnVuY3Rpb24gU2V0SW50ZXJsYWNlKCRhRmxnPXRydWUpIHsNCgkkdGhpcy0+aUludGVybGFjZT0kYUZsZzsNCiAgICB9DQoNCiAgICAvLyBTaG91bGQgd2UgdXNlIGFudGktYWxpYXNpbmcuIE5vdGU6IFRoaXMgcmVhbGx5IHNsb3dzIGRvd24gZ3JhcGhpY3MhDQogICAgZnVuY3Rpb24gU2V0QW50aUFsaWFzaW5nKCRhRmxnPXRydWUpIHsNCgkkdGhpcy0+dXNlX2FudGlfYWxpYXNpbmcgPSAkYUZsZzsNCglpZiggZnVuY3Rpb25fZXhpc3RzKCdpbWFnZWFudGlhbGlhcycpICkgew0KCSAgICBpbWFnZWFudGlhbGlhcygkdGhpcy0+aW1nLCRhRmxnKTsNCgl9DQoJZWxzZSB7DQoJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTI4KTsvLygnVGhlIGZ1bmN0aW9uIGltYWdlYW50aWFsaWFzKCkgaXMgbm90IGF2YWlsYWJsZSBpbiB5b3VyIFBIUCBpbnN0YWxsYXRpb24uIFVzZSB0aGUgR0QgdmVyc2lvbiB0aGF0IGNvbWVzIHdpdGggUEhQIGFuZCBub3QgdGhlIHN0YW5kYWxvbmUgdmVyc2lvbi4nKQ0KCX0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBDcmVhdGVSYXdDYW52YXMoJGFXaWR0aD0wLCRhSGVpZ2h0PTApIHsNCglpZiggJGFXaWR0aCA8PSAxIHx8ICRhSGVpZ2h0IDw9IDEgKSB7DQoJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDgyLCRhV2lkdGgsJGFIZWlnaHQpOy8vKCJJbGxlZ2FsIHNpemVzIHNwZWNpZmllZCBmb3Igd2lkdGggb3IgaGVpZ2h0IHdoZW4gY3JlYXRpbmcgYW4gaW1hZ2UsICh3aWR0aD0kYVdpZHRoLCBoZWlnaHQ9JGFIZWlnaHQpIik7DQoJfQ0KDQoJaWYoIFVTRV9UUlVFQ09MT1IgKSB7DQoJICAgICR0aGlzLT5pbWcgPSBAaW1hZ2VjcmVhdGV0cnVlY29sb3IoJGFXaWR0aCwgJGFIZWlnaHQpOw0KCSAgICBpZiggJHRoaXMtPmltZyA8IDEgKSB7DQoJCUpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTI2KTsNCgkJLy9kaWUoIkNhbid0IGNyZWF0ZSB0cnVlY29sb3IgaW1hZ2UuIENoZWNrIHRoYXQgeW91IHJlYWxseSBoYXZlIEdEMiBsaWJyYXJ5IGluc3RhbGxlZC4iKTsNCgkgICAgfQ0KCSAgICAkdGhpcy0+U2V0QWxwaGFCbGVuZGluZygpOw0KCX0gZWxzZSB7DQoJICAgICR0aGlzLT5pbWcgPSBAaW1hZ2VjcmVhdGUoJGFXaWR0aCwgJGFIZWlnaHQpOwkNCgkgICAgaWYoICR0aGlzLT5pbWcgPCAxICkgew0KCQlKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEyNik7DQoJCS8vZGllKCI8Yj5KcEdyYXBoIEVycm9yOjwvYj4gQ2FuJ3QgY3JlYXRlIGltYWdlLiBDaGVjayB0aGF0IHlvdSByZWFsbHkgaGF2ZSB0aGUgR0QgbGlicmFyeSBpbnN0YWxsZWQuIik7DQoJICAgIH0NCgl9DQoNCglpZiggJHRoaXMtPmlJbnRlcmxhY2UgKSB7DQoJICAgIGltYWdlaW50ZXJsYWNlKCR0aGlzLT5pbWcsMSk7DQoJfQ0KCWlmKCAkdGhpcy0+cmdiICE9IG51bGwgKSANCgkgICAgJHRoaXMtPnJnYi0+aW1nID0gJHRoaXMtPmltZyA7DQoJZWxzZQ0KCSAgICAkdGhpcy0+cmdiID0gbmV3IFJHQigkdGhpcy0+aW1nKTsJCQkJDQogICAgfQ0KDQogICAgZnVuY3Rpb24gQ2xvbmVDYW52YXNIKCkgew0KCSRvbGRpbWFnZSA9ICR0aGlzLT5pbWc7DQoJJHRoaXMtPkNyZWF0ZVJhd0NhbnZhcygkdGhpcy0+d2lkdGgsJHRoaXMtPmhlaWdodCk7DQoJaW1hZ2Vjb3B5KCR0aGlzLT5pbWcsJG9sZGltYWdlLDAsMCwwLDAsJHRoaXMtPndpZHRoLCR0aGlzLT5oZWlnaHQpOw0KCXJldHVybiAkb2xkaW1hZ2U7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIENyZWF0ZUltZ0NhbnZhcygkYVdpZHRoPTAsJGFIZWlnaHQ9MCkgew0KDQoJJG9sZCA9IGFycmF5KCR0aGlzLT5pbWcsJHRoaXMtPndpZHRoLCR0aGlzLT5oZWlnaHQpOw0KCQ0KCSRhV2lkdGggPSByb3VuZCgkYVdpZHRoKTsNCgkkYUhlaWdodCA9IHJvdW5kKCRhSGVpZ2h0KTsNCg0KCSR0aGlzLT53aWR0aD0kYVdpZHRoOw0KCSR0aGlzLT5oZWlnaHQ9JGFIZWlnaHQ7CQkNCg0KCQ0KCWlmKCAkYVdpZHRoPT0wIHx8ICRhSGVpZ2h0PT0wICkgew0KCSAgICAvLyBXZSB3aWxsIHNldCB0aGUgZmluYWwgc2l6ZSBsYXRlci4gDQoJICAgIC8vIE5vdGU6IFRoZSBzaXplIG11c3QgYmUgc3BlY2lmaWVkIGJlZm9yZSBhbnkgb3RoZXINCgkgICAgLy8gaW1nIHJvdXRpbmVzIHRoYXQgc3Ryb2tlIGFueXRoaW5nIGFyZSBjYWxsZWQuDQoJICAgICR0aGlzLT5pbWcgPSBudWxsOw0KCSAgICAkdGhpcy0+cmdiID0gbnVsbDsNCgkgICAgcmV0dXJuICRvbGQ7DQoJfQ0KCQ0KCSR0aGlzLT5DcmVhdGVSYXdDYW52YXMoJGFXaWR0aCwkYUhlaWdodCk7DQoJLy8gU2V0IGNhbnZhcyBjb2xvciAod2lsbCBhbHNvIGJlIHRoZSBiYWNrZ3JvdW5kIGNvbG9yIGZvciBhIA0KCS8vIGEgcGFsbGV0dCBpbWFnZQ0KCSR0aGlzLT5TZXRDb2xvcigkdGhpcy0+Y2FudmFzY29sb3IpOwkNCgkkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKDAsMCwkYVdpZHRoLCRhSGVpZ2h0KTsNCg0KCXJldHVybiAkb2xkIDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBDb3B5Q2FudmFzSCgkYVRvSGRsLCRhRnJvbUhkbCwkYVRvWCwkYVRvWSwkYUZyb21YLCRhRnJvbVksJGFXaWR0aCwkYUhlaWdodCwkYXc9LTEsJGFoPS0xKSB7DQoJaWYoICRhdyA9PT0gLTEgKSB7DQoJICAgICRhdyA9ICRhV2lkdGg7DQoJICAgICRhaCA9ICRhSGVpZ2h0Ow0KCSAgICAkZiA9ICdpbWFnZWNvcHlyZXNpemVkJzsNCgl9DQoJZWxzZSB7DQoJICAgICRmID0gJ2ltYWdlY29weXJlc2FtcGxlZCc7DQoJfQ0KCSRmKCRhVG9IZGwsJGFGcm9tSGRsLCRhVG9YLCRhVG9ZLCRhRnJvbVgsJGFGcm9tWSwgJGFXaWR0aCwkYUhlaWdodCwkYXcsJGFoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBDb3B5KCRmcm9tSW1nLCR0b1gsJHRvWSwkZnJvbVgsJGZyb21ZLCR0b1dpZHRoLCR0b0hlaWdodCwkZnJvbVdpZHRoPS0xLCRmcm9tSGVpZ2h0PS0xKSB7DQoJJHRoaXMtPkNvcHlDYW52YXNIKCR0aGlzLT5pbWcsJGZyb21JbWcsJHRvWCwkdG9ZLCRmcm9tWCwkZnJvbVksDQoJCQkgICAkdG9XaWR0aCwkdG9IZWlnaHQsJGZyb21XaWR0aCwkZnJvbUhlaWdodCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gQ29weU1lcmdlKCRmcm9tSW1nLCR0b1gsJHRvWSwkZnJvbVgsJGZyb21ZLCR0b1dpZHRoLCR0b0hlaWdodCwkZnJvbVdpZHRoPS0xLCRmcm9tSGVpZ2h0PS0xLCRhTWl4PTEwMCkgew0KCWlmKCAkYU1peCA9PSAxMDAgKSB7DQoJICAgICR0aGlzLT5Db3B5Q2FudmFzSCgkdGhpcy0+aW1nLCRmcm9tSW1nLA0KCQkJICAgICAgICR0b1gsJHRvWSwkZnJvbVgsJGZyb21ZLCR0b1dpZHRoLCR0b0hlaWdodCwkZnJvbVdpZHRoLCRmcm9tSGVpZ2h0KTsNCgl9DQoJZWxzZSB7DQoJICAgIGlmKCAoJGZyb21XaWR0aCAgIT0gLTEgJiYgKCRmcm9tV2lkdGggIT0gJHRvV2lkdGgpKSAgfHwNCgkJKCRmcm9tSGVpZ2h0ICE9IC0xICYmICgkZnJvbUhlaWdodCAhPSAkZnJvbUhlaWdodCkpICkgew0KCQkvLyBDcmVhdGUgYSBuZXcgY2FudmFzIHRoYXQgd2lsbCBob2xkIHRoZSByZS1zY2FsZWQgb3JpZ2luYWwgZnJvbSBpbWFnZQ0KCQlpZiggJHRvV2lkdGggPD0gMSB8fCAkdG9IZWlnaHQgPD0gMSApIHsNCgkJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDgzKTsvLygnSWxsZWdhbCBpbWFnZSBzaXplIHdoZW4gY29weWluZyBpbWFnZS4gU2l6ZSBmb3IgY29waWVkIHRvIGltYWdlIGlzIDEgcGl4ZWwgb3IgbGVzcy4nKTsNCgkJfQ0KCQlpZiggVVNFX1RSVUVDT0xPUiApIHsNCgkJICAgICR0bXBpbWcgPSBAaW1hZ2VjcmVhdGV0cnVlY29sb3IoJHRvV2lkdGgsICR0b0hlaWdodCk7DQoJCX0gZWxzZSB7DQoJCSAgICAkdG1waW1nID0gQGltYWdlY3JlYXRlKCR0b1dpZHRoLCAkdG9IZWlnaHQpOwkNCgkJfQkgICAgDQoJCWlmKCAkdG1waW1nIDwgMSApIHsNCgkJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDg0KTsvLygnRmFpbGVkIHRvIGNyZWF0ZSB0ZW1wb3JhcnkgR0QgY2FudmFzLiBPdXQgb2YgbWVtb3J5ID8nKTsNCgkJfQ0KCQkkdGhpcy0+Q29weUNhbnZhc0goJHRtcGltZywkZnJvbUltZywwLDAsMCwwLA0KCQkJCSAgICR0b1dpZHRoLCR0b0hlaWdodCwkZnJvbVdpZHRoLCRmcm9tSGVpZ2h0KTsNCgkJJGZyb21JbWcgPSAkdG1waW1nOw0KCSAgICB9DQoJICAgIGltYWdlY29weW1lcmdlKCR0aGlzLT5pbWcsJGZyb21JbWcsJHRvWCwkdG9ZLCRmcm9tWCwkZnJvbVksJHRvV2lkdGgsJHRvSGVpZ2h0LCRhTWl4KTsNCgl9DQogICAgfQ0KDQogICAgc3RhdGljIGZ1bmN0aW9uIEdldFdpZHRoKCRhSW1nPW51bGwpIHsNCglpZiggJGFJbWcgPT09IG51bGwgKSANCgkgICAgJGFJbWcgPSAkdGhpcy0+aW1nOw0KCXJldHVybiBpbWFnZXN4KCRhSW1nKTsNCiAgICB9DQoNCiAgICBzdGF0aWMgZnVuY3Rpb24gR2V0SGVpZ2h0KCRhSW1nPW51bGwpIHsNCglpZiggJGFJbWcgPT09IG51bGwgKSANCgkgICAgJGFJbWcgPSAkdGhpcy0+aW1nOw0KCXJldHVybiBpbWFnZXN5KCRhSW1nKTsNCiAgICB9DQogICAgDQogICAgc3RhdGljIGZ1bmN0aW9uIENyZWF0ZUZyb21TdHJpbmcoJGFTdHIpIHsNCgkkaW1nID0gaW1hZ2VjcmVhdGVmcm9tc3RyaW5nKCRhU3RyKTsNCglpZiggJGltZyA9PT0gZmFsc2UgKSB7DQoJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDg1KTsvLygnQW4gaW1hZ2UgY2FuIG5vdCBiZSBjcmVhdGVkIGZyb20gdGhlIHN1cHBsaWVkIHN0cmluZy4gSXQgaXMgZWl0aGVyIGluIGEgZm9ybWF0IG5vdCBzdXBwb3J0ZWQgb3IgdGhlIHN0cmluZyBpcyByZXByZXNlbnRpbmcgYW4gY29ycnVwdCBpbWFnZS4nKTsNCgl9DQoJcmV0dXJuICRpbWc7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU2V0Q2FudmFzSCgkYUhkbCkgew0KCSR0aGlzLT5pbWcgPSAkYUhkbDsNCgkkdGhpcy0+cmdiLT5pbWcgPSAkYUhkbDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBTZXRDYW52YXNDb2xvcigkYUNvbG9yKSB7DQoJJHRoaXMtPmNhbnZhc2NvbG9yID0gJGFDb2xvciA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU2V0QWxwaGFCbGVuZGluZygkYUZsZz10cnVlKSB7DQoJSW1hZ2VBbHBoYUJsZW5kaW5nKCR0aGlzLT5pbWcsJGFGbGcpOw0KICAgIH0NCg0KCQ0KICAgIGZ1bmN0aW9uIFNldEF1dG9NYXJnaW4oKSB7CQ0KCUdMT0JBTCAkZ0pwZ0JyYW5kVGltaW5nOw0KCSRtaW5fYm09NTsNCgkvKg0KCWlmKCAkZ0pwZ0JyYW5kVGltaW5nICkNCgkgICAgJG1pbl9ibT0xNTsJCQ0KCSovDQoJJGxtID0gbWluKDQwLCR0aGlzLT53aWR0aC83KTsNCgkkcm0gPSBtaW4oMjAsJHRoaXMtPndpZHRoLzEwKTsNCgkkdG0gPSBtYXgoNSwkdGhpcy0+aGVpZ2h0LzcpOw0KCSRibSA9IG1heCgkbWluX2JtLCR0aGlzLT5oZWlnaHQvNyk7DQoJJHRoaXMtPlNldE1hcmdpbigkbG0sJHJtLCR0bSwkYm0pOwkJDQogICAgfQ0KDQoJCQkJDQogICAgLy8tLS0tLS0tLS0tLS0tLS0NCiAgICAvLyBQVUJMSUMgTUVUSE9EUwkNCgkNCiAgICBmdW5jdGlvbiBTZXRGb250KCRmYW1pbHksJHN0eWxlPUZTX05PUk1BTCwkc2l6ZT0xMCkgew0KCSR0aGlzLT5mb250X2ZhbWlseT0kZmFtaWx5Ow0KCSR0aGlzLT5mb250X3N0eWxlPSRzdHlsZTsNCgkkdGhpcy0+Zm9udF9zaXplPSRzaXplOw0KCSR0aGlzLT5mb250X2ZpbGU9Jyc7DQoJaWYoICgkdGhpcy0+Zm9udF9mYW1pbHk9PUZGX0ZPTlQxIHx8ICR0aGlzLT5mb250X2ZhbWlseT09RkZfRk9OVDIpICYmICR0aGlzLT5mb250X3N0eWxlPT1GU19CT0xEICl7DQoJICAgICsrJHRoaXMtPmZvbnRfZmFtaWx5Ow0KCX0NCglpZiggJHRoaXMtPmZvbnRfZmFtaWx5ID4gRkZfRk9OVDIrMSApIHsgLy8gQSBUVEYgZm9udCBzbyBnZXQgdGhlIGZvbnQgZmlsZQ0KDQoJICAgIC8vIENoZWNrIHRoYXQgdGhpcyBQSFAgaGFzIHN1cHBvcnQgZm9yIFRURiBmb250cw0KCSAgICBpZiggIWZ1bmN0aW9uX2V4aXN0cygnaW1hZ2V0dGZiYm94JykgKSB7DQoJCUpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDg3KTsvLygnVGhpcyBQSFAgYnVpbGQgaGFzIG5vdCBiZWVuIGNvbmZpZ3VyZWQgd2l0aCBUVEYgc3VwcG9ydC4gWW91IG5lZWQgdG8gcmVjb21waWxlIHlvdXIgUEhQIGluc3RhbGxhdGlvbiB3aXRoIEZyZWVUeXBlIHN1cHBvcnQuJyk7DQoJICAgIH0NCgkgICAgJHRoaXMtPmZvbnRfZmlsZSA9ICR0aGlzLT50dGYtPkZpbGUoJHRoaXMtPmZvbnRfZmFtaWx5LCR0aGlzLT5mb250X3N0eWxlKTsNCgl9DQogICAgfQ0KDQogICAgLy8gR2V0IHRoZSBzcGVjaWZpYyBoZWlnaHQgZm9yIGEgdGV4dCBzdHJpbmcNCiAgICBmdW5jdGlvbiBHZXRUZXh0SGVpZ2h0KCR0eHQ9IiIsJGFuZ2xlPTApIHsNCgkkdG1wID0gc3BsaXQoIlxuIiwkdHh0KTsNCgkkbiA9IGNvdW50KCR0bXApOw0KCSRtPTA7DQoJZm9yKCRpPTA7ICRpPCAkbjsgKyskaSkNCgkgICAgJG0gPSBtYXgoJG0sc3RybGVuKCR0bXBbJGldKSk7DQoNCglpZiggJHRoaXMtPmZvbnRfZmFtaWx5IDw9IEZGX0ZPTlQyKzEgKSB7DQoJICAgIGlmKCAkYW5nbGU9PTAgKSB7DQoJCSRoID0gaW1hZ2Vmb250aGVpZ2h0KCR0aGlzLT5mb250X2ZhbWlseSk7DQoJCWlmKCAkaCA9PT0gZmFsc2UgKSB7DQoJCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA4OCk7Ly8oJ1lvdSBoYXZlIGEgbWlzY29uZmlndXJlZCBHRCBmb250IHN1cHBvcnQuIFRoZSBjYWxsIHRvIGltYWdlZm9udHdpZHRoKCkgZmFpbHMuJyk7DQoJCX0NCg0KCQlyZXR1cm4gJG4qJGg7DQoJICAgIH0NCgkgICAgZWxzZSB7DQoJCSR3ID0gQGltYWdlZm9udHdpZHRoKCR0aGlzLT5mb250X2ZhbWlseSk7DQoJCWlmKCAkdyA9PT0gZmFsc2UgKSB7DQoJCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA4OCk7Ly8oJ1lvdSBoYXZlIGEgbWlzY29uZmlndXJlZCBHRCBmb250IHN1cHBvcnQuIFRoZSBjYWxsIHRvIGltYWdlZm9udHdpZHRoKCkgZmFpbHMuJyk7DQoJCX0NCg0KCQlyZXR1cm4gJG0qJHc7DQoJICAgIH0NCgl9DQoJZWxzZSB7DQoJICAgICRiYm94ID0gJHRoaXMtPkdldFRURkJCb3goJHR4dCwkYW5nbGUpOw0KCSAgICByZXR1cm4gJGJib3hbMV0tJGJib3hbNV07DQoJfQ0KICAgIH0NCgkNCiAgICAvLyBFc3RpbWF0ZSBmb250IGhlaWdodA0KICAgIGZ1bmN0aW9uIEdldEZvbnRIZWlnaHQoJGFuZ2xlPTApIHsNCgkkdHh0ID0gIlhPTWciOw0KCXJldHVybiAkdGhpcy0+R2V0VGV4dEhlaWdodCgkdHh0LCRhbmdsZSk7DQogICAgfQ0KCQ0KICAgIC8vIEFwcHJveGltYXRlIGZvbnQgd2lkdGggd2l0aCB3aWR0aCBvZiBsZXR0ZXIgIk8iDQogICAgZnVuY3Rpb24gR2V0Rm9udFdpZHRoKCRhbmdsZT0wKSB7DQoJJHR4dCA9ICdPJzsNCglyZXR1cm4gJHRoaXMtPkdldFRleHRXaWR0aCgkdHh0LCRhbmdsZSk7DQogICAgfQ0KCQ0KICAgIC8vIEdldCBhY3R1YWwgd2lkdGggb2YgdGV4dCBpbiBhYnNvbHV0ZSBwaXhlbHMNCiAgICBmdW5jdGlvbiBHZXRUZXh0V2lkdGgoJHR4dCwkYW5nbGU9MCkgew0KDQoJJHRtcCA9IHNwbGl0KCJcbiIsJHR4dCk7DQoJJG4gPSBjb3VudCgkdG1wKTsNCglpZiggJHRoaXMtPmZvbnRfZmFtaWx5IDw9IEZGX0ZPTlQyKzEgKSB7DQoNCgkgICAgJG09MDsNCgkgICAgZm9yKCRpPTA7ICRpIDwgJG47ICsrJGkpIHsNCgkJJGw9c3RybGVuKCR0bXBbJGldKTsNCgkJaWYoICRsID4gJG0gKSB7DQoJCSAgICAkbSA9ICRsOw0KCQl9DQoJICAgIH0NCg0KCSAgICBpZiggJGFuZ2xlPT0wICkgew0KCQkkdyA9IEBpbWFnZWZvbnR3aWR0aCgkdGhpcy0+Zm9udF9mYW1pbHkpOw0KCQlpZiggJHcgPT09IGZhbHNlICkgew0KCQkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwODgpOy8vKCdZb3UgaGF2ZSBhIG1pc2NvbmZpZ3VyZWQgR0QgZm9udCBzdXBwb3J0LiBUaGUgY2FsbCB0byBpbWFnZWZvbnR3aWR0aCgpIGZhaWxzLicpOw0KCQl9DQoJCXJldHVybiAkbSokdzsNCgkgICAgfQ0KCSAgICBlbHNlIHsNCgkJLy8gOTAgZGVncmVlcyBpbnRlcm5hbCBzbyBoZWlnaHQgYmVjb21lcyB3aWR0aA0KCQkkaCA9IEBpbWFnZWZvbnRoZWlnaHQoJHRoaXMtPmZvbnRfZmFtaWx5KTsgDQoJCWlmKCAkaCA9PT0gZmFsc2UgKSB7DQoJCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA4OSk7Ly8oJ1lvdSBoYXZlIGEgbWlzY29uZmlndXJlZCBHRCBmb250IHN1cHBvcnQuIFRoZSBjYWxsIHRvIGltYWdlZm9udGhlaWdodCgpIGZhaWxzLicpOw0KCQl9DQoJCXJldHVybiAkbiokaDsNCgkgICAgfQ0KCX0NCgllbHNlIHsNCgkgICAgLy8gRm9yIFRURiBmb250cyB3ZSBtdXN0IHdhbGsgdGhyb3VnaCBhIGxpbmVzIGFuZCBmaW5kIHRoZSANCgkgICAgLy8gd2lkZXN0IG9uZSB3aGljaCB3ZSB1c2UgYXMgdGhlIHdpZHRoIG9mIHRoZSBtdWx0aS1saW5lDQoJICAgIC8vIHBhcmFncmFwaA0KCSAgICAkbT0wOw0KCSAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7DQoJCSRiYm94ID0gJHRoaXMtPkdldFRURkJCb3goJHRtcFskaV0sJGFuZ2xlKTsNCgkJJG1tID0gICRiYm94WzJdIC0gJGJib3hbMF07DQoJCWlmKCAkbW0gPiAkbSApIA0KCQkgICAgJG0gPSAkbW07DQoJICAgIH0NCgkgICAgcmV0dXJuICRtOw0KCX0NCiAgICB9DQoJDQogICAgLy8gRHJhdyB0ZXh0IHdpdGggYSBib3ggYXJvdW5kIGl0DQogICAgZnVuY3Rpb24gU3Ryb2tlQm94ZWRUZXh0KCR4LCR5LCR0eHQsJGRpcj0wLCRmY29sb3I9IndoaXRlIiwkYmNvbG9yPSJibGFjayIsDQoJCQkgICAgICRzaGFkb3djb2xvcj1mYWxzZSwkcGFyYWdyYXBoX2FsaWduPSJsZWZ0IiwNCgkJCSAgICAgJHhtYXJnPTYsJHltYXJnPTQsJGNvcm5lcnJhZGl1cz0wLCRkcm9wd2lkdGg9Mykgew0KDQoJaWYoICFpc19udW1lcmljKCRkaXIpICkgew0KCSAgICBpZiggJGRpcj09ImgiICkgJGRpcj0wOw0KCSAgICBlbHNlaWYoICRkaXI9PSJ2IiApICRkaXI9OTA7DQoJICAgIGVsc2UgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwOTAsJGRpcik7Ly8oIiBVbmtub3duIGRpcmVjdGlvbiBzcGVjaWZpZWQgaW4gY2FsbCB0byBTdHJva2VCb3hlZFRleHQoKSBbJGRpcl0iKTsNCgl9DQoJCQ0KCWlmKCAkdGhpcy0+Zm9udF9mYW1pbHkgPj0gRkZfRk9OVDAgJiYgJHRoaXMtPmZvbnRfZmFtaWx5IDw9IEZGX0ZPTlQyKzEpIHsJDQoJICAgICR3aWR0aD0kdGhpcy0+R2V0VGV4dFdpZHRoKCR0eHQsJGRpcikgOw0KCSAgICAkaGVpZ2h0PSR0aGlzLT5HZXRUZXh0SGVpZ2h0KCR0eHQsJGRpcikgOw0KCX0NCgllbHNlIHsNCgkgICAgJHdpZHRoPSR0aGlzLT5HZXRCQm94V2lkdGgoJHR4dCwkZGlyKSA7DQoJICAgICRoZWlnaHQ9JHRoaXMtPkdldEJCb3hIZWlnaHQoJHR4dCwkZGlyKSA7DQoJfQ0KDQoJJGhlaWdodCArPSAyKiR5bWFyZzsNCgkkd2lkdGggICs9IDIqJHhtYXJnOw0KDQoJaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09InJpZ2h0IiApICR4IC09ICR3aWR0aDsNCgllbHNlaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09ImNlbnRlciIgKSAkeCAtPSAkd2lkdGgvMjsNCglpZiggJHRoaXMtPnRleHRfdmFsaWduPT0iYm90dG9tIiApICR5IC09ICRoZWlnaHQ7DQoJZWxzZWlmKCAkdGhpcy0+dGV4dF92YWxpZ249PSJjZW50ZXIiICkgJHkgLT0gJGhlaWdodC8yOw0KCQ0KCSRvbGRhID0gJHRoaXMtPlNldEFuZ2xlKDApOw0KDQoJaWYoICRzaGFkb3djb2xvciApIHsNCgkgICAgJHRoaXMtPlB1c2hDb2xvcigkc2hhZG93Y29sb3IpOw0KCSAgICAkdGhpcy0+RmlsbGVkUm91bmRlZFJlY3RhbmdsZSgkeC0keG1hcmcrJGRyb3B3aWR0aCwkeS0keW1hcmcrJGRyb3B3aWR0aCwNCgkJCQkJICAkeCskd2lkdGgrJGRyb3B3aWR0aCwkeSskaGVpZ2h0LSR5bWFyZyskZHJvcHdpZHRoLA0KCQkJCQkgICRjb3JuZXJyYWRpdXMpOw0KCSAgICAkdGhpcy0+UG9wQ29sb3IoKTsNCgkgICAgJHRoaXMtPlB1c2hDb2xvcigkZmNvbG9yKTsNCgkgICAgJHRoaXMtPkZpbGxlZFJvdW5kZWRSZWN0YW5nbGUoJHgtJHhtYXJnLCR5LSR5bWFyZywNCgkJCQkJICAkeCskd2lkdGgsJHkrJGhlaWdodC0keW1hcmcsDQoJCQkJCSAgJGNvcm5lcnJhZGl1cyk7CQkNCgkgICAgJHRoaXMtPlBvcENvbG9yKCk7DQoJICAgICR0aGlzLT5QdXNoQ29sb3IoJGJjb2xvcik7DQoJICAgICR0aGlzLT5Sb3VuZGVkUmVjdGFuZ2xlKCR4LSR4bWFyZywkeS0keW1hcmcsDQoJCQkJICAgICR4KyR3aWR0aCwkeSskaGVpZ2h0LSR5bWFyZywkY29ybmVycmFkaXVzKTsNCgkgICAgJHRoaXMtPlBvcENvbG9yKCk7DQoJfQ0KCWVsc2Ugew0KCSAgICBpZiggJGZjb2xvciApIHsNCgkJJG9jPSR0aGlzLT5jdXJyZW50X2NvbG9yOw0KCQkkdGhpcy0+U2V0Q29sb3IoJGZjb2xvcik7DQoJCSR0aGlzLT5GaWxsZWRSb3VuZGVkUmVjdGFuZ2xlKCR4LSR4bWFyZywkeS0keW1hcmcsJHgrJHdpZHRoLCR5KyRoZWlnaHQtJHltYXJnLCRjb3JuZXJyYWRpdXMpOw0KCQkkdGhpcy0+Y3VycmVudF9jb2xvcj0kb2M7DQoJICAgIH0NCgkgICAgaWYoICRiY29sb3IgKSB7DQoJCSRvYz0kdGhpcy0+Y3VycmVudF9jb2xvcjsNCgkJJHRoaXMtPlNldENvbG9yKCRiY29sb3IpOwkJCQ0KCQkkdGhpcy0+Um91bmRlZFJlY3RhbmdsZSgkeC0keG1hcmcsJHktJHltYXJnLCR4KyR3aWR0aCwkeSskaGVpZ2h0LSR5bWFyZywkY29ybmVycmFkaXVzKTsNCgkJJHRoaXMtPmN1cnJlbnRfY29sb3I9JG9jOwkJCQ0KCSAgICB9DQoJfQ0KCQkNCgkkaD0kdGhpcy0+dGV4dF9oYWxpZ247DQoJJHY9JHRoaXMtPnRleHRfdmFsaWduOw0KCSR0aGlzLT5TZXRUZXh0QWxpZ24oImxlZnQiLCJ0b3AiKTsNCgkkdGhpcy0+U3Ryb2tlVGV4dCgkeCwgJHksICR0eHQsICRkaXIsICRwYXJhZ3JhcGhfYWxpZ24pOw0KCSRiYiA9IGFycmF5KCR4LSR4bWFyZywkeSskaGVpZ2h0LSR5bWFyZywkeCskd2lkdGgsJHkrJGhlaWdodC0keW1hcmcsDQoJCSAgICAkeCskd2lkdGgsJHktJHltYXJnLCR4LSR4bWFyZywkeS0keW1hcmcpOw0KCSR0aGlzLT5TZXRUZXh0QWxpZ24oJGgsJHYpOw0KDQoJJHRoaXMtPlNldEFuZ2xlKCRvbGRhKTsNCg0KCXJldHVybiAkYmI7DQogICAgfQ0KDQogICAgLy8gU2V0IHRleHQgYWxpZ25tZW50CQ0KICAgIGZ1bmN0aW9uIFNldFRleHRBbGlnbigkaGFsaWduLCR2YWxpZ249ImJvdHRvbSIpIHsNCgkkdGhpcy0+dGV4dF9oYWxpZ249JGhhbGlnbjsNCgkkdGhpcy0+dGV4dF92YWxpZ249JHZhbGlnbjsNCiAgICB9DQoJDQoNCiAgICBmdW5jdGlvbiBfU3Ryb2tlQnVpbHRpbkZvbnQoJHgsJHksJHR4dCwkZGlyPTAsJHBhcmFncmFwaF9hbGlnbj0ibGVmdCIsJiRhQm91bmRpbmdCb3gsJGFEZWJ1Zz1mYWxzZSkgew0KDQoJaWYoIGlzX251bWVyaWMoJGRpcikgJiYgJGRpciE9OTAgJiYgJGRpciE9MCkgDQoJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDkxKTsvLygiIEludGVybmFsIGZvbnQgZG9lcyBub3Qgc3VwcG9ydCBkcmF3aW5nIHRleHQgYXQgYXJiaXRyYXJ5IGFuZ2xlLiBVc2UgVFRGIGZvbnRzIGluc3RlYWQuIik7DQoNCgkkaD0kdGhpcy0+R2V0VGV4dEhlaWdodCgkdHh0KTsNCgkkZmg9JHRoaXMtPkdldEZvbnRIZWlnaHQoKTsNCgkkdz0kdGhpcy0+R2V0VGV4dFdpZHRoKCR0eHQpOw0KCQ0KCWlmKCAkdGhpcy0+dGV4dF9oYWxpZ249PSJyaWdodCIpIAkJCQkNCgkgICAgJHggLT0gJGRpcj09MCA\/ICR3IDogJGg7DQoJZWxzZWlmKCAkdGhpcy0+dGV4dF9oYWxpZ249PSJjZW50ZXIiICkgew0KCSAgICAvLyBGb3IgY2VudGVyIHdlIHN1YnRyYWN0IDEgcGl4ZWwgc2luY2UgdGhpcyBtYWtlcyB0aGUgbWlkZGxlDQoJICAgIC8vIGJlIHByZWZlY3RseSBpbiB0aGUgbWlkZGxlDQoJICAgICR4IC09ICRkaXI9PTAgPyAkdy8yLTEgOiAkaC8yOw0KCX0NCglpZiggJHRoaXMtPnRleHRfdmFsaWduPT0idG9wIiApDQoJICAgICR5ICs9ICRkaXI9PTAgPyAkaCA6ICR3Ow0KCWVsc2VpZiggJHRoaXMtPnRleHRfdmFsaWduPT0iY2VudGVyIiApIAkJCQkNCgkgICAgJHkgKz0gJGRpcj09MCA\/ICRoLzIgOiAkdy8yOw0KCQ0KCWlmKCAkZGlyPT05MCApIHsNCgkgICAgaW1hZ2VzdHJpbmd1cCgkdGhpcy0+aW1nLCR0aGlzLT5mb250X2ZhbWlseSwkeCwkeSwkdHh0LCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCgkgICAgJGFCb3VuZGluZ0JveCA9IGFycmF5KHJvdW5kKCR4KSxyb3VuZCgkeSkscm91bmQoJHgpLHJvdW5kKCR5LSR3KSxyb3VuZCgkeCskaCkscm91bmQoJHktJHcpLHJvdW5kKCR4KyRoKSxyb3VuZCgkeSkpOw0KICAgICAgICAgICAgaWYoICRhRGVidWcgKSB7DQoJCS8vIERyYXcgYm91bmRpbmcgYm94DQoJCSR0aGlzLT5QdXNoQ29sb3IoJ2dyZWVuJyk7DQoJCSR0aGlzLT5Qb2x5Z29uKCRhQm91bmRpbmdCb3gsdHJ1ZSk7DQoJCSR0aGlzLT5Qb3BDb2xvcigpOw0KCSAgICB9DQoJfQ0KCWVsc2Ugew0KCSAgICBpZiggZXJlZygiXG4iLCR0eHQpICkgeyANCgkJJHRtcCA9IHNwbGl0KCJcbiIsJHR4dCk7DQoJCWZvcigkaT0wOyAkaSA8IGNvdW50KCR0bXApOyArKyRpKSB7DQoJCSAgICAkdzEgPSAkdGhpcy0+R2V0VGV4dFdpZHRoKCR0bXBbJGldKTsNCgkJICAgIGlmKCAkcGFyYWdyYXBoX2FsaWduPT0ibGVmdCIgKSB7DQoJCQlpbWFnZXN0cmluZygkdGhpcy0+aW1nLCR0aGlzLT5mb250X2ZhbWlseSwkeCwkeS0kaCsxKyRpKiRmaCwkdG1wWyRpXSwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQoJCSAgICB9DQoJCSAgICBlbHNlaWYoICRwYXJhZ3JhcGhfYWxpZ249PSJyaWdodCIgKSB7DQoJCQlpbWFnZXN0cmluZygkdGhpcy0+aW1nLCR0aGlzLT5mb250X2ZhbWlseSwkeCsoJHctJHcxKSwNCgkJCQkgICAgJHktJGgrMSskaSokZmgsJHRtcFskaV0sJHRoaXMtPmN1cnJlbnRfY29sb3IpOw0KCQkgICAgfQ0KCQkgICAgZWxzZSB7DQoJCQlpbWFnZXN0cmluZygkdGhpcy0+aW1nLCR0aGlzLT5mb250X2ZhbWlseSwkeCskdy8yLSR3MS8yLA0KCQkJCSAgICAkeS0kaCsxKyRpKiRmaCwkdG1wWyRpXSwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQoJCSAgICB9DQoJCX0NCgkgICAgfSANCgkgICAgZWxzZSB7DQoJCS8vUHV0IHRoZSB0ZXh0DQoJCWltYWdlc3RyaW5nKCR0aGlzLT5pbWcsJHRoaXMtPmZvbnRfZmFtaWx5LCR4LCR5LSRoKzEsJHR4dCwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQoJICAgIH0NCiAgICAgICAgICAgIGlmKCAkYURlYnVnICkgew0KCQkvLyBEcmF3IHRoZSBib3VuZGluZyByZWN0YW5nbGUgYW5kIHRoZSBib3VuZGluZyBib3gNCgkJJHAxID0gYXJyYXkocm91bmQoJHgpLHJvdW5kKCR5KSxyb3VuZCgkeCkscm91bmQoJHktJGgpLHJvdW5kKCR4KyR3KSxyb3VuZCgkeS0kaCkscm91bmQoJHgrJHcpLHJvdW5kKCR5KSk7DQoJCQ0KCQkvLyBEcmF3IGJvdW5kaW5nIGJveA0KCQkkdGhpcy0+UHVzaENvbG9yKCdncmVlbicpOw0KCQkkdGhpcy0+UG9seWdvbigkcDEsdHJ1ZSk7DQoJCSR0aGlzLT5Qb3BDb2xvcigpOw0KDQogICAgICAgICAgICB9DQoJICAgICRhQm91bmRpbmdCb3g9YXJyYXkocm91bmQoJHgpLHJvdW5kKCR5KSxyb3VuZCgkeCkscm91bmQoJHktJGgpLHJvdW5kKCR4KyR3KSxyb3VuZCgkeS0kaCkscm91bmQoJHgrJHcpLHJvdW5kKCR5KSk7DQoJfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEFkZFR4dENSKCRhVHh0KSB7DQoJLy8gSWYgdGhlIHVzZXIgaGFzIGp1c3Qgc3BlY2lmaWVkIGEgJ1xuJw0KCS8vIGluc3RlYWQgb2YgJ1xuXHQnIHdlIGhhdmUgdG8gYWRkICdccicgc2luY2UNCgkvLyB0aGUgd2lkdGggd2lsbCBiZSB0b28gbXVjaHkgb3RoZXJ3aXNlIHNpbmNlIHdoZW4NCgkvLyB3ZSBwcmludCB3ZSBzdHJva2UgdGhlIGluZGl2aWR1YWxseSBsaW5lcyBieSBoYW5kLg0KCSRlID0gZXhwbG9kZSgiXG4iLCRhVHh0KTsNCgkkbiA9IGNvdW50KCRlKTsNCglmb3IoJGk9MDsgJGk8JG47ICsrJGkpIHsNCgkgICAgJGVbJGldPXN0cl9yZXBsYWNlKCJcciIsIiIsJGVbJGldKTsNCgl9DQoJcmV0dXJuIGltcGxvZGUoIlxuXHIiLCRlKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBHZXRUVEZCQm94KCRhVHh0LCRhQW5nbGU9MCkgew0KCSRiYm94ID0gQEltYWdlVFRGQkJveCgkdGhpcy0+Zm9udF9zaXplLCRhQW5nbGUsJHRoaXMtPmZvbnRfZmlsZSwkYVR4dCk7DQoJaWYoICRiYm94ID09PSBmYWxzZSApIHsNCgkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwOTIsJHRoaXMtPmZvbnRfZmlsZSk7DQovLygiVGhlcmUgaXMgZWl0aGVyIGEgY29uZmlndXJhdGlvbiBwcm9ibGVtIHdpdGggVHJ1ZVR5cGUgb3IgYSBwcm9ibGVtIHJlYWRpbmcgZm9udCBmaWxlICgiLiR0aGlzLT5mb250X2ZpbGUuIikuIE1ha2Ugc3VyZSBmaWxlIGV4aXN0cyBhbmQgaXMgaW4gYSByZWFkYWJsZSBwbGFjZSBmb3IgdGhlIEhUVFAgcHJvY2Vzcy4gKElmICdiYXNlZGlyJyByZXN0cmljdGlvbiBpcyBlbmFibGVkIGluIFBIUCB0aGVuIHRoZSBmb250IGZpbGUgbXVzdCBiZSBsb2NhdGVkIGluIHRoZSBkb2N1bWVudCByb290LikuIEl0IG1pZ2h0IGFsc28gYmUgYSB3cm9uZ2x5IGluc3RhbGxlZCBGcmVlVHlwZSBsaWJyYXJ5LiBUcnkgdXBwZ3JhZGluZyB0byBhdCBsZWFzdCBGcmVlVHlwZSAyLjEuMTMgYW5kIHJlY29tcGlsZSBHRCB3aXRoIHRoZSBjb3JyZWN0IHNldHVwIHNvIGl0IGNhbiBmaW5kIHRoZSBuZXcgRlQgbGlicmFyeS4iKTsNCgl9DQoJcmV0dXJuICRiYm94Ow0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEdldEJCb3hUVEYoJGFUeHQsJGFBbmdsZT0wKSB7DQoJLy8gTm9ybWFsaXplIHRoZSBib3VuZGluZyBib3ggdG8gYmVjb21lIGEgbWluaW11bQ0KCS8vIGVuc2NyaWJpbmcgcmVjdGFuZ2xlDQoNCgkkYVR4dCA9ICR0aGlzLT5BZGRUeHRDUigkYVR4dCk7DQoNCglpZiggIWlzX3JlYWRhYmxlKCR0aGlzLT5mb250X2ZpbGUpICkgew0KCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5MywkdGhpcy0+Zm9udF9maWxlKTsNCi8vKCdDYW4gbm90IHJlYWQgZm9udCBmaWxlICgnLiR0aGlzLT5mb250X2ZpbGUuJykgaW4gY2FsbCB0byBJbWFnZTo6R2V0QkJveFRURi4gUGxlYXNlIG1ha2Ugc3VyZSB0aGF0IHlvdSBoYXZlIHNldCBhIGZvbnQgYmVmb3JlIGNhbGxpbmcgdGhpcyBtZXRob2QgYW5kIHRoYXQgdGhlIGZvbnQgaXMgaW5zdGFsbGVkIGluIHRoZSBUVEYgZGlyZWN0b3J5LicpOw0KCX0NCgkkYmJveCA9ICR0aGlzLT5HZXRUVEZCQm94KCRhVHh0LCRhQW5nbGUpOw0KDQoJaWYoICRhQW5nbGU9PTAgKSANCgkgICAgcmV0dXJuICRiYm94Ow0KCWlmKCAkYUFuZ2xlID49IDAgKSB7DQoJICAgIGlmKCAgJGFBbmdsZSA8PSA5MCApIHsgLy88PTAJCQ0KCQkkYmJveCA9IGFycmF5KCRiYm94WzZdLCRiYm94WzFdLCRiYm94WzJdLCRiYm94WzFdLA0KCQkJICAgICAgJGJib3hbMl0sJGJib3hbNV0sJGJib3hbNl0sJGJib3hbNV0pOw0KCSAgICB9DQoJICAgIGVsc2VpZiggICRhQW5nbGUgPD0gMTgwICkgeyAvLzw9IDINCgkJJGJib3ggPSBhcnJheSgkYmJveFs0XSwkYmJveFs3XSwkYmJveFswXSwkYmJveFs3XSwNCgkJCSAgICAgICRiYm94WzBdLCRiYm94WzNdLCRiYm94WzRdLCRiYm94WzNdKTsNCgkgICAgfQ0KCSAgICBlbHNlaWYoICAkYUFuZ2xlIDw9IDI3MCApICB7IC8vPD0gMw0KCQkkYmJveCA9IGFycmF5KCRiYm94WzJdLCRiYm94WzVdLCRiYm94WzZdLCRiYm94WzVdLA0KCQkJICAgICAgJGJib3hbNl0sJGJib3hbMV0sJGJib3hbMl0sJGJib3hbMV0pOw0KCSAgICB9DQoJICAgIGVsc2Ugew0KCQkkYmJveCA9IGFycmF5KCRiYm94WzBdLCRiYm94WzNdLCRiYm94WzRdLCRiYm94WzNdLA0KCQkJICAgICAgJGJib3hbNF0sJGJib3hbN10sJGJib3hbMF0sJGJib3hbN10pOw0KCSAgICB9DQoJfQ0KCWVsc2VpZiggICRhQW5nbGUgPCAwICkgew0KCSAgICBpZiggJGFBbmdsZSA8PSAtMjcwICkgeyAvLyA8PSAtMw0KCQkkYmJveCA9IGFycmF5KCRiYm94WzZdLCRiYm94WzFdLCRiYm94WzJdLCRiYm94WzFdLA0KCQkJICAgICAgJGJib3hbMl0sJGJib3hbNV0sJGJib3hbNl0sJGJib3hbNV0pOw0KCSAgICB9DQoJICAgIGVsc2VpZiggJGFBbmdsZSA8PSAtMTgwICkgeyAvLyA8PSAtMg0KCQkkYmJveCA9IGFycmF5KCRiYm94WzBdLCRiYm94WzNdLCRiYm94WzRdLCRiYm94WzNdLA0KCQkJICAgICAgJGJib3hbNF0sJGJib3hbN10sJGJib3hbMF0sJGJib3hbN10pOw0KCSAgICB9DQoJICAgIGVsc2VpZiggJGFBbmdsZSA8PSAtOTAgKSB7IC8vIDw9IC0xDQoJCSRiYm94ID0gYXJyYXkoJGJib3hbMl0sJGJib3hbNV0sJGJib3hbNl0sJGJib3hbNV0sDQoJCQkgICAgICAkYmJveFs2XSwkYmJveFsxXSwkYmJveFsyXSwkYmJveFsxXSk7DQoJICAgIH0NCgkgICAgZWxzZSB7DQoJCSRiYm94ID0gYXJyYXkoJGJib3hbMF0sJGJib3hbM10sJGJib3hbNF0sJGJib3hbM10sDQoJCQkgICAgICAkYmJveFs0XSwkYmJveFs3XSwkYmJveFswXSwkYmJveFs3XSk7DQoJICAgIH0NCgl9CQ0KCXJldHVybiAkYmJveDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBHZXRCQm94SGVpZ2h0KCRhVHh0LCRhQW5nbGU9MCkgew0KCSRib3ggPSAkdGhpcy0+R2V0QkJveFRURigkYVR4dCwkYUFuZ2xlKTsNCglyZXR1cm4gJGJveFsxXS0kYm94WzddKzE7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gR2V0QkJveFdpZHRoKCRhVHh0LCRhQW5nbGU9MCkgew0KCSRib3ggPSAkdGhpcy0+R2V0QkJveFRURigkYVR4dCwkYUFuZ2xlKTsNCglyZXR1cm4gJGJveFsyXS0kYm94WzBdKzE7CQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIF9TdHJva2VUVEYoJHgsJHksJHR4dCwkZGlyPTAsJHBhcmFncmFwaF9hbGlnbj0ibGVmdCIsJiRhQm91bmRpbmdCb3gsJGRlYnVnPWZhbHNlKSB7DQoNCgkvLyBTZXR1cG8gZGVmYXVsdCBpbnRlciBsaW5lIG1hcmdpbiBmb3IgcGFyYWdyYXBocyB0bw0KCS8vIDI1JSBvZiB0aGUgZm9udCBoZWlnaHQuDQoJJENvbnN0TGluZVNwYWNpbmcgPSAwLjI1IDsNCg0KCS8vIFJlbWVtYmVyIHRoZSBhbmNob3IgcG9pbnQgYmVmb3JlIGFkanVzdG1lbnQNCglpZiggJGRlYnVnICkgew0KCSAgICAkb3g9JHg7DQoJICAgICRveT0keTsNCgl9DQoNCglpZiggIWVyZWcoIlxuIiwkdHh0KSB8fCAoJGRpcj4wICYmIGVyZWcoIlxuIiwkdHh0KSkgKSB7DQoJICAgIC8vIEZvcm1hdCBhIHNpbmdsZSBsaW5lDQoNCgkgICAgJHR4dCA9ICR0aGlzLT5BZGRUeHRDUigkdHh0KTsNCg0KCSAgICAkYmJveD0kdGhpcy0+R2V0QkJveFRURigkdHh0LCRkaXIpOw0KCSAgICANCgkgICAgLy8gQWxpZ24geCx5IG90IGxvd2VyIGxlZnQgY29ybmVyIG9mIGJib3gNCgkgICAgJHggLT0gJGJib3hbMF07DQoJICAgICR5IC09ICRiYm94WzFdOw0KDQoJICAgIC8vIE5vdGUgdG8gc2VsZjogInRvcGFuY2hvciIgaXMgZGVwcmVjYXRlZCBhZnRlciB3ZSBjaGFuZ2VkIHRoZQ0KCSAgICAvLyBib3B1bmRpbmcgYm94IHN0dWZmLiANCgkgICAgaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09InJpZ2h0IiB8fCAkdGhpcy0+dGV4dF9oYWxpZ249PSJ0b3BhbmNob3IiICkgDQoJCSR4IC09ICRiYm94WzJdLSRiYm94WzBdOw0KCSAgICBlbHNlaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09ImNlbnRlciIgKSAkeCAtPSAoJGJib3hbMl0tJGJib3hbMF0pLzI7IA0KCSAgICANCgkgICAgaWYoICR0aGlzLT50ZXh0X3ZhbGlnbj09InRvcCIgKSAkeSArPSBhYnMoJGJib3hbNV0pKyRiYm94WzFdOw0KCSAgICBlbHNlaWYoICR0aGlzLT50ZXh0X3ZhbGlnbj09ImNlbnRlciIgKSAkeSAtPSAoJGJib3hbNV0tJGJib3hbMV0pLzI7IA0KDQoJICAgIEltYWdlVFRGVGV4dCAoJHRoaXMtPmltZywgJHRoaXMtPmZvbnRfc2l6ZSwgJGRpciwgJHgsICR5LCANCgkJCSAgJHRoaXMtPmN1cnJlbnRfY29sb3IsJHRoaXMtPmZvbnRfZmlsZSwkdHh0KTsgDQoNCgkgICAgLy8gQ2FsY3VsYXRlIGFuZCByZXR1cm4gdGhlIGNvLW9yZGluYXRlcyBmb3IgdGhlIGJvdW5kaW5nIGJveA0KCSAgICAkYm94PUBJbWFnZVRURkJCb3goJHRoaXMtPmZvbnRfc2l6ZSwkZGlyLCR0aGlzLT5mb250X2ZpbGUsJHR4dCk7DQoJICAgICRwMSA9IGFycmF5KCk7DQoNCg0KCSAgICBmb3IoJGk9MDsgJGkgPCA0OyArKyRpKSB7DQoJCSRwMVtdID0gcm91bmQoJGJveFskaSoyXSskeCk7DQoJCSRwMVtdID0gcm91bmQoJGJveFskaSoyKzFdKyR5KTsNCgkgICAgfQ0KCSAgICAkYUJvdW5kaW5nQm94ID0gJHAxOw0KDQoJICAgIC8vIERlYnVnZ2luZyBjb2RlIHRvIGhpZ2hsaWdodCB0aGUgYm9uZGluZyBib3ggYW5kIGJvdW5kaW5nIHJlY3RhbmdsZQ0KCSAgICAvLyBGb3IgdGV4dCBhdCAwIGRlZ3JlZXMgdGhlIGJvdW5kaW5nIGJveCBhbmQgYm91bmRpbmcgcmVjdGFuZ2xlIGFyZSB0aGUNCgkgICAgLy8gc2FtZQ0KICAgICAgICAgICAgaWYoICRkZWJ1ZyApIHsNCgkJLy8gRHJhdyB0aGUgYm91bmRpbmcgcmVjdGFuZ2xlIGFuZCB0aGUgYm91bmRpbmcgYm94DQoJCSRib3g9QEltYWdlVFRGQkJveCgkdGhpcy0+Zm9udF9zaXplLCRkaXIsJHRoaXMtPmZvbnRfZmlsZSwkdHh0KTsNCgkJJHAgPSBhcnJheSgpOw0KCQkkcDEgPSBhcnJheSgpOw0KCQlmb3IoJGk9MDsgJGkgPCA0OyArKyRpKSB7DQoJCSAgICAkcFtdID0gJGJib3hbJGkqMl0rJHg7DQoJCSAgICAkcFtdID0gJGJib3hbJGkqMisxXSskeTsNCgkJICAgICRwMVtdID0gJGJveFskaSoyXSskeDsNCgkJICAgICRwMVtdID0gJGJveFskaSoyKzFdKyR5Ow0KCQl9DQoNCgkJLy8gRHJhdyBib3VuZGluZyBib3gNCgkJJHRoaXMtPlB1c2hDb2xvcignZ3JlZW4nKTsNCgkJJHRoaXMtPlBvbHlnb24oJHAxLHRydWUpOw0KCQkkdGhpcy0+UG9wQ29sb3IoKTsNCgkJDQoJCS8vIERyYXcgYm91bmRpbmcgcmVjdGFuZ2xlDQoJCSR0aGlzLT5QdXNoQ29sb3IoJ2RhcmtncmVlbicpOw0KCQkkdGhpcy0+UG9seWdvbigkcCx0cnVlKTsNCgkJJHRoaXMtPlBvcENvbG9yKCk7DQoJCQ0KCQkvLyBEcmF3IGEgY3Jvc3MgYXQgdGhlIGFuY2hvciBwb2ludA0KCQkkdGhpcy0+UHVzaENvbG9yKCdyZWQnKTsNCgkJJHRoaXMtPkxpbmUoJG94LTE1LCRveSwkb3grMTUsJG95KTsNCgkJJHRoaXMtPkxpbmUoJG94LCRveS0xNSwkb3gsJG95KzE1KTsNCgkJJHRoaXMtPlBvcENvbG9yKCk7DQogICAgICAgICAgICB9DQoJfQ0KCWVsc2Ugew0KCSAgICAvLyBGb3JtYXQgYSB0ZXh0IHBhcmFncmFwaA0KCSAgICAkZmg9JHRoaXMtPkdldEZvbnRIZWlnaHQoKTsNCg0KCSAgICAvLyBMaW5lIG1hcmdpbiBpcyAyNSUgb2YgZm9udCBoZWlnaHQNCgkgICAgJGxpbmVtYXJnaW49cm91bmQoJGZoKiRDb25zdExpbmVTcGFjaW5nKTsNCgkgICAgJGZoICs9ICRsaW5lbWFyZ2luOw0KCSAgICAkdz0kdGhpcy0+R2V0VGV4dFdpZHRoKCR0eHQpOw0KDQoJICAgICR5IC09ICRsaW5lbWFyZ2luLzI7DQoJICAgICR0bXAgPSBzcGxpdCgiXG4iLCR0eHQpOw0KCSAgICAkbmwgPSBjb3VudCgkdG1wKTsNCgkgICAgJGggPSAkbmwgKiAkZmg7DQoNCgkgICAgaWYoICR0aGlzLT50ZXh0X2hhbGlnbj09InJpZ2h0IikgCQkJCQ0KCQkkeCAtPSAkZGlyPT0wID8gJHcgOiAkaDsNCgkgICAgZWxzZWlmKCAkdGhpcy0+dGV4dF9oYWxpZ249PSJjZW50ZXIiICkgew0KCQkkeCAtPSAkZGlyPT0wID8gJHcvMiA6ICRoLzI7DQoJICAgIH0NCgkgICAgDQoJICAgIGlmKCAkdGhpcy0+dGV4dF92YWxpZ249PSJ0b3AiICkNCgkJJHkgKz0JJGRpcj09MCA\/ICRoIDogJHc7DQoJICAgIGVsc2VpZiggJHRoaXMtPnRleHRfdmFsaWduPT0iY2VudGVyIiApIAkJCQkNCgkJJHkgKz0JJGRpcj09MCA\/ICRoLzIgOiAkdy8yOw0KDQoJICAgIC8vIEhlcmUgY29tZXMgYSB0cmlja3kgYml0LiANCgkgICAgLy8gU2luY2Ugd2UgaGF2ZSB0byBnaXZlIHRoZSBwb3NpdGlvbiBmb3IgdGhlIHN0cmluZyBhdCB0aGUNCgkgICAgLy8gYmFzZWxpbmUgdGhpcyBtZWFucyB0aGFodCB0ZXh0IHdpbGwgbW92ZSBzbGlnaHRseSB1cA0KCSAgICAvLyBhbmQgZG93biBkZXBlbmRpbmcgb24gYW55IG9mIGl0J3MgY2hhcmFjdGVyIGRlc2NlbmQgYmVsb3cNCgkgICAgLy8gdGhlIGJhc2VsaW5lLCBmb3IgZXhhbXBsZSBhICdnJy4gVG8gYWRqdXN0IHRoZSBZLXBvc2l0aW9uDQoJICAgIC8vIHdlIHRoZXJlZm9yZSBhZGp1c3QgdGhlIHRleHQgd2l0aCB0aGUgYmFzZWxpbmUgWS1vZmZzZXQNCgkgICAgLy8gYXMgdXNlZCBmb3IgdGhlIGN1cnJlbnQgZm9udCBhbmQgc2l6ZS4gVGhpcyB3aWxsIGtlZXAgdGhlDQoJICAgIC8vIGJhc2VsaW5lIGF0IGEgZml4ZWQgcG9zaXRvbmVkIGRpc3JlZ2FyZGluZyB0aGUgYWN0dWFsIA0KCSAgICAvLyBjaGFyYWN0ZXJzIGluIHRoZSBzdHJpbmcuIA0KCSAgICAkc3RhbmRhcmRib3ggPSAkdGhpcy0+R2V0VFRGQkJveCgnR2cnLCRkaXIpOw0KCSAgICAkeWFkaiA9ICRzdGFuZGFyZGJveFsxXTsNCgkgICAgJHhhZGogPSAkc3RhbmRhcmRib3hbMF07DQoJICAgICRhQm91bmRpbmdCb3ggPSBhcnJheSgpOw0KCSAgICBmb3IoJGk9MDsgJGkgPCAkbmw7ICsrJGkpIHsNCgkJJHdsID0gJHRoaXMtPkdldFRleHRXaWR0aCgkdG1wWyRpXSk7DQoJCSRiYm94ID0gJHRoaXMtPkdldFRURkJCb3goJHRtcFskaV0sJGRpcik7DQoJCWlmKCAkcGFyYWdyYXBoX2FsaWduPT0ibGVmdCIgKSB7DQoJCSAgICAkeGwgPSAkeDsgDQoJCX0NCgkJZWxzZWlmKCAkcGFyYWdyYXBoX2FsaWduPT0icmlnaHQiICkgew0KCQkgICAgJHhsID0gJHggKyAoJHctJHdsKTsNCgkJfQ0KCQllbHNlIHsNCgkJICAgIC8vIENlbnRlcg0KCQkgICAgJHhsID0gJHggKyAkdy8yIC0gJHdsLzIgOw0KCQl9DQoNCgkJJHhsIC09ICRiYm94WzBdOw0KCQkkeWwgPSAkeSAtICR5YWRqOyANCgkJJHhsID0gJHhsIC0gJHhhZGo7IA0KCQlJbWFnZVRURlRleHQgKCR0aGlzLT5pbWcsICR0aGlzLT5mb250X3NpemUsICRkaXIsIA0KCQkJICAgICAgJHhsLCAkeWwtKCRoLSRmaCkrJGZoKiRpLA0KCQkJICAgICAgJHRoaXMtPmN1cnJlbnRfY29sb3IsJHRoaXMtPmZvbnRfZmlsZSwkdG1wWyRpXSk7IA0KDQoJCWlmKCAkZGVidWcgICkgew0KCQkgICAgLy8gRHJhdyB0aGUgYm91bmRpbmcgcmVjdGFuZ2xlIGFyb3VuZCBlYWNoIGxpbmUNCgkJICAgICRib3g9QEltYWdlVFRGQkJveCgkdGhpcy0+Zm9udF9zaXplLCRkaXIsJHRoaXMtPmZvbnRfZmlsZSwkdG1wWyRpXSk7DQoJCSAgICAkcCA9IGFycmF5KCk7DQoJCSAgICBmb3IoJGo9MDsgJGogPCA0OyArKyRqKSB7DQoJCQkkcFtdID0gJGJib3hbJGoqMl0rJHhsOw0KCQkJJHBbXSA9ICRiYm94WyRqKjIrMV0rJHlsLSgkaC0kZmgpKyRmaCokaTsNCgkJICAgIH0NCgkJICAgIA0KCQkgICAgLy8gRHJhdyBib3VuZGluZyByZWN0YW5nbGUNCgkJICAgICR0aGlzLT5QdXNoQ29sb3IoJ2RhcmtncmVlbicpOw0KCQkgICAgJHRoaXMtPlBvbHlnb24oJHAsdHJ1ZSk7DQoJCSAgICAkdGhpcy0+UG9wQ29sb3IoKTsNCgkJfQ0KCSAgICB9DQoNCgkgICAgLy8gR2V0IHRoZSBib3VuZGluZyBib3gNCgkgICAgJGJib3ggPSAkdGhpcy0+R2V0QkJveFRURigkdHh0LCRkaXIpOw0KCSAgICBmb3IoJGo9MDsgJGogPCA0OyArKyRqKSB7DQoJCSRiYm94WyRqKjJdKz0gcm91bmQoJHgpOw0KCQkkYmJveFskaioyKzFdKz0gcm91bmQoJHkgLSAoJGgtJGZoKSAtICR5YWRqKTsNCgkgICAgfQ0KCSAgICAkYUJvdW5kaW5nQm94ID0gJGJib3g7DQoNCgkgICAgaWYoICRkZWJ1ZyApIHsJDQoJCS8vIERyYXcgYSBjcm9zcyBhdCB0aGUgYW5jaG9yIHBvaW50DQoJCSR0aGlzLT5QdXNoQ29sb3IoJ3JlZCcpOw0KCQkkdGhpcy0+TGluZSgkb3gtMjUsJG95LCRveCsyNSwkb3kpOw0KCQkkdGhpcy0+TGluZSgkb3gsJG95LTI1LCRveCwkb3krMjUpOw0KCQkkdGhpcy0+UG9wQ29sb3IoKTsNCgkgICAgfQ0KDQoJfQ0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBTdHJva2VUZXh0KCR4LCR5LCR0eHQsJGRpcj0wLCRwYXJhZ3JhcGhfYWxpZ249ImxlZnQiLCRkZWJ1Zz1mYWxzZSkgew0KDQoJJHggPSByb3VuZCgkeCk7DQoJJHkgPSByb3VuZCgkeSk7DQoNCgkvLyBEbyBzcGVjaWFsIGxhbmd1YWdlIGVuY29kaW5nDQoJJHR4dCA9ICR0aGlzLT5sYW5nY29udi0+Q29udmVydCgkdHh0LCR0aGlzLT5mb250X2ZhbWlseSk7DQoNCglpZiggIWlzX251bWVyaWMoJGRpcikgKQ0KCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5NCk7Ly8oIiBEaXJlY3Rpb24gZm9yIHRleHQgbW9zdCBiZSBnaXZlbiBhcyBhbiBhbmdsZSBiZXR3ZWVuIDAgYW5kIDkwLiIpOw0KCQkJDQoJaWYoICR0aGlzLT5mb250X2ZhbWlseSA+PSBGRl9GT05UMCAmJiAkdGhpcy0+Zm9udF9mYW1pbHkgPD0gRkZfRk9OVDIrMSkgewkNCgkgICAgJHRoaXMtPl9TdHJva2VCdWlsdGluRm9udCgkeCwkeSwkdHh0LCRkaXIsJHBhcmFncmFwaF9hbGlnbiwkYm91bmRpbmdib3gsJGRlYnVnKTsNCgl9DQoJZWxzZWlmKCR0aGlzLT5mb250X2ZhbWlseSA+PSBfRklSU1RfRk9OVCAmJiAkdGhpcy0+Zm9udF9mYW1pbHkgPD0gX0xBU1RfRk9OVCkgIHsNCgkgICAgJHRoaXMtPl9TdHJva2VUVEYoJHgsJHksJHR4dCwkZGlyLCRwYXJhZ3JhcGhfYWxpZ24sJGJvdW5kaW5nYm94LCRkZWJ1Zyk7DQoJfQ0KCWVsc2UNCgkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwOTUpOy8vKCIgVW5rbm93biBmb250IGZvbnQgZmFtaWx5IHNwZWNpZmljYXRpb24uICIpOw0KCXJldHVybiAkYm91bmRpbmdib3g7DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIFNldE1hcmdpbigkbG0sJHJtLCR0bSwkYm0pIHsNCgkkdGhpcy0+bGVmdF9tYXJnaW49JGxtOw0KCSR0aGlzLT5yaWdodF9tYXJnaW49JHJtOw0KCSR0aGlzLT50b3BfbWFyZ2luPSR0bTsNCgkkdGhpcy0+Ym90dG9tX21hcmdpbj0kYm07DQoJJHRoaXMtPnBsb3R3aWR0aD0kdGhpcy0+d2lkdGggLSAkdGhpcy0+bGVmdF9tYXJnaW4tJHRoaXMtPnJpZ2h0X21hcmdpbiA7IA0KCSR0aGlzLT5wbG90aGVpZ2h0PSR0aGlzLT5oZWlnaHQgLSAkdGhpcy0+dG9wX21hcmdpbi0kdGhpcy0+Ym90dG9tX21hcmdpbiA7DQoJaWYoICR0aGlzLT53aWR0aCAgPiAwICYmICR0aGlzLT5oZWlnaHQgPiAwICkgew0KCSAgICBpZiggJHRoaXMtPnBsb3R3aWR0aCA8IDAgIHx8ICR0aGlzLT5wbG90aGVpZ2h0IDwgMCApDQoJCUpwR3JhcGhFcnJvcjo6cmFpc2UoIlRvIHNtYWxsIHBsb3QgYXJlYS4gKCRsbSwkcm0sJHRtLCRibSA6ICR0aGlzLT5wbG90d2lkdGggeCAkdGhpcy0+cGxvdGhlaWdodCkuIFdpdGggdGhlIGdpdmVuIGltYWdlIHNpemUgYW5kIG1hcmdpbnMgdGhlcmUgaXMgdG8gbGl0dGxlIHNwYWNlIGxlZnQgZm9yIHRoZSBwbG90LiBJbmNyZWFzZSB0aGUgcGxvdCBzaXplIG9yIHJlZHVjZSB0aGUgbWFyZ2lucy4iKTsNCgl9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU2V0VHJhbnNwYXJlbnQoJGNvbG9yKSB7DQoJaW1hZ2Vjb2xvcnRyYW5zcGFyZW50ICgkdGhpcy0+aW1nLCR0aGlzLT5yZ2ItPmFsbG9jYXRlKCRjb2xvcikpOw0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBTZXRDb2xvcigkY29sb3IsJGFBbHBoYT0wKSB7DQoJJHRoaXMtPmN1cnJlbnRfY29sb3JfbmFtZSA9ICRjb2xvcjsNCgkkdGhpcy0+Y3VycmVudF9jb2xvcj0kdGhpcy0+cmdiLT5hbGxvY2F0ZSgkY29sb3IsJGFBbHBoYSk7DQoJaWYoICR0aGlzLT5jdXJyZW50X2NvbG9yID09IC0xICkgew0KCSAgICAkdGM9aW1hZ2Vjb2xvcnN0b3RhbCgkdGhpcy0+aW1nKTsNCgkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwOTYpOw0KLy8oIkNhbid0IGFsbG9jYXRlIGFueSBtb3JlIGNvbG9ycy4gSW1hZ2UgaGFzIGFscmVhZHkgYWxsb2NhdGVkIG1heGltdW0gb2YgPGI+JHRjIGNvbG9yczwvYj4uIFRoaXMgbWlnaHQgaGFwcGVuIGlmIHlvdSBoYXZlIGFudGktYWxpYXNpbmcgdHVybmVkIG9uIHRvZ2V0aGVyIHdpdGggYSBiYWNrZ3JvdW5kIGltYWdlIG9yIHBlcmhhcHMgZ3JhZGllbnQgZmlsbCBzaW5jZSB0aGlzIHJlcXVpcmVzIG1hbnksIG1hbnkgY29sb3JzLiBUcnkgdG8gdHVybiBvZmYgYW50aS1hbGlhc2luZy4gSWYgdGhlcmUgaXMgc3RpbGwgYSBwcm9ibGVtIHRyeSBkb3duZ3JhZGluZyB0aGUgcXVhbGl0eSBvZiB0aGUgYmFja2dyb3VuZCBpbWFnZSB0byB1c2UgYSBzbWFsbGVyIHBhbGxldGUgdG8gbGVhdmUgc29tZSBlbnRyaWVzIGZvciB5b3VyIGdyYXBocy4gWW91IHNob3VsZCB0cnkgdG8gbGltaXQgdGhlIG51bWJlciBvZiBjb2xvcnMgaW4geW91ciBiYWNrZ3JvdW5kIGltYWdlIHRvIDY0LiBJZiB0aGVyZSBpcyBzdGlsbCBwcm9ibGVtIHNldCB0aGUgY29uc3RhbnQgREVGSU5FKFwiVVNFX0FQUFJPWF9DT0xPUlNcIix0cnVlKTsgaW4ganBncmFwaC5waHAgVGhpcyB3aWxsIHVzZSBhcHByb3hpbWF0aXZlIGNvbG9ycyB3aGVuIHRoZSBwYWxldHRlIGlzIGZ1bGwuIFVuZm9ydHVuYXRlbHkgdGhlcmUgaXMgbm90IG11Y2ggSnBHcmFwaCBjYW4gZG8gYWJvdXQgdGhpcyBzaW5jZSB0aGUgcGFsZXR0ZSBzaXplIGlzIGEgbGltaXRhdGlvbiBvZiBjdXJyZW50IGdyYXBoaWMgZm9ybWF0IGFuZCB3aGF0IHRoZSB1bmRlcmx5aW5nIEdEIGxpYnJhcnkgc3VwcHBvcnRzLiIpOyANCgl9DQoJcmV0dXJuICR0aGlzLT5jdXJyZW50X2NvbG9yOw0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBQdXNoQ29sb3IoJGNvbG9yKSB7DQoJaWYoICRjb2xvciAhPSAiIiApIHsNCgkgICAgJHRoaXMtPmNvbG9yc3RhY2tbJHRoaXMtPmNvbG9yc3RhY2tpZHhdPSR0aGlzLT5jdXJyZW50X2NvbG9yX25hbWU7DQoJICAgICR0aGlzLT5jb2xvcnN0YWNrWyR0aGlzLT5jb2xvcnN0YWNraWR4KzFdPSR0aGlzLT5jdXJyZW50X2NvbG9yOw0KCSAgICAkdGhpcy0+Y29sb3JzdGFja2lkeCs9MjsNCgkgICAgJHRoaXMtPlNldENvbG9yKCRjb2xvcik7DQoJfQ0KCWVsc2Ugew0KCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5Nyk7Ly8oIkNvbG9yIHNwZWNpZmllZCBhcyBlbXB0eSBzdHJpbmcgaW4gUHVzaENvbG9yKCkuIik7DQoJfQ0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBQb3BDb2xvcigpIHsNCglpZigkdGhpcy0+Y29sb3JzdGFja2lkeDwxKQ0KCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA5OCk7Ly8oIiBOZWdhdGl2ZSBDb2xvciBzdGFjayBpbmRleC4gVW5tYXRjaGVkIGNhbGwgdG8gUG9wQ29sb3IoKSIpOw0KCSR0aGlzLT5jdXJyZW50X2NvbG9yPSR0aGlzLT5jb2xvcnN0YWNrWy0tJHRoaXMtPmNvbG9yc3RhY2tpZHhdOw0KCSR0aGlzLT5jdXJyZW50X2NvbG9yX25hbWU9JHRoaXMtPmNvbG9yc3RhY2tbLS0kdGhpcy0+Y29sb3JzdGFja2lkeF07DQogICAgfQ0KCQ0KCQ0KICAgIGZ1bmN0aW9uIFNldExpbmVXZWlnaHQoJHdlaWdodCkgew0KCWltYWdlc2V0dGhpY2tuZXNzKCR0aGlzLT5pbWcsJHdlaWdodCk7DQoJJHRoaXMtPmxpbmVfd2VpZ2h0ID0gJHdlaWdodDsNCiAgICB9DQoJDQogICAgZnVuY3Rpb24gU2V0U3RhcnRQb2ludCgkeCwkeSkgew0KCSR0aGlzLT5sYXN0eD1yb3VuZCgkeCk7DQoJJHRoaXMtPmxhc3R5PXJvdW5kKCR5KTsNCiAgICB9DQoJDQogICAgZnVuY3Rpb24gQXJjKCRjeCwkY3ksJHcsJGgsJHMsJGUpIHsNCgkvLyBHRCBBcmMgZG9lc24ndCBsaWtlIG5lZ2F0aXZlIGFuZ2xlcw0KCXdoaWxlKCAkcyA8IDApICRzICs9IDM2MDsNCgl3aGlsZSggJGUgPCAwKSAkZSArPSAzNjA7DQogICAgCQ0KCWltYWdlYXJjKCR0aGlzLT5pbWcscm91bmQoJGN4KSxyb3VuZCgkY3kpLHJvdW5kKCR3KSxyb3VuZCgkaCksDQoJCSAkcywkZSwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIEZpbGxlZEFyYygkeGMsJHljLCR3LCRoLCRzLCRlLCRzdHlsZT0nJykgew0KCXdoaWxlKCAkcyA8IDAgKSAkcyArPSAzNjA7DQoJd2hpbGUoICRlIDwgMCApICRlICs9IDM2MDsNCglpZiggJHN0eWxlPT0nJyApIA0KCSAgICAkc3R5bGU9SU1HX0FSQ19QSUU7DQoJaWYoIGFicygkcy0kZSkgPiAwLjAwMSApIHsNCgkgICAgaW1hZ2VmaWxsZWRhcmMoJHRoaXMtPmltZyxyb3VuZCgkeGMpLHJvdW5kKCR5Yykscm91bmQoJHcpLHJvdW5kKCRoKSwNCgkJCSAgIHJvdW5kKCRzKSxyb3VuZCgkZSksJHRoaXMtPmN1cnJlbnRfY29sb3IsJHN0eWxlKTsNCgl9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRmlsbGVkQ2FrZVNsaWNlKCRjeCwkY3ksJHcsJGgsJHMsJGUpIHsNCgkkdGhpcy0+Q2FrZVNsaWNlKCRjeCwkY3ksJHcsJGgsJHMsJGUsJHRoaXMtPmN1cnJlbnRfY29sb3JfbmFtZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gQ2FrZVNsaWNlKCR4YywkeWMsJHcsJGgsJHMsJGUsJGZpbGxjb2xvcj0iIiwkYXJjY29sb3I9IiIpIHsNCgkkcyA9IHJvdW5kKCRzKTsgJGUgPSByb3VuZCgkZSk7DQoJJHcgPSByb3VuZCgkdyk7ICRoID0gcm91bmQoJGgpOw0KCSR4YyA9IHJvdW5kKCR4Yyk7ICR5YyA9IHJvdW5kKCR5Yyk7DQoJaWYoICRzID09JGUgKSB7DQoJICAgIC8vIEEgZnVsbCBjaXJjbGUuIFdlIGRyYXcgdGhpcyBhIHBsYWluIGNpcmNsZQ0KCSAgICAkdGhpcy0+UHVzaENvbG9yKCRmaWxsY29sb3IpOw0KCSAgICBpbWFnZWZpbGxlZGVsbGlwc2UoJHRoaXMtPmltZywkeGMsJHljLDIqJHcsMiokaCwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQoJICAgICR0aGlzLT5Qb3BDb2xvcigpOw0KCSAgICAkdGhpcy0+UHVzaENvbG9yKCRhcmNjb2xvcik7DQoJICAgIGltYWdlZWxsaXBzZSgkdGhpcy0+aW1nLCR4YywkeWMsMiokdywyKiRoLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCgkgICAgJHRoaXMtPkxpbmUoJHhjLCR5Yyxjb3MoJHMqTV9QSS8xODApKiR3KyR4YywkeWMrc2luKCRzKk1fUEkvMTgwKSokaCk7DQoJICAgICR0aGlzLT5Qb3BDb2xvcigpOw0KCX0NCgllbHNlIHsNCgkgICAgJHRoaXMtPlB1c2hDb2xvcigkZmlsbGNvbG9yKTsNCgkgICAgJHRoaXMtPkZpbGxlZEFyYygkeGMsJHljLDIqJHcsMiokaCwkcywkZSk7DQoJICAgICR0aGlzLT5Qb3BDb2xvcigpOw0KCSAgICBpZiggJGFyY2NvbG9yICE9ICIiICkgew0KCQkkdGhpcy0+UHVzaENvbG9yKCRhcmNjb2xvcik7DQoJCS8vIFdlIGFkZCAyIHBpeGVscyB0byBtYWtlIHRoZSBBcmMoKSBiZXR0ZXIgYWxpZ25lZCB3aXRoDQoJCS8vIHRoZSBmaWxsZWQgYXJjLiANCgkJaW1hZ2VmaWxsZWRhcmMoJHRoaXMtPmltZywkeGMsJHljLDIqJHcsMiokaCwkcywkZSwkdGhpcy0+Y3VycmVudF9jb2xvcixJTUdfQVJDX05PRklMTCB8IElNR19BUkNfRURHRUQgKSA7DQoJCSR0aGlzLT5Qb3BDb2xvcigpOw0KCSAgICB9DQoJfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEVsbGlwc2UoJHhjLCR5YywkdywkaCkgew0KCSR0aGlzLT5BcmMoJHhjLCR5YywkdywkaCwwLDM2MCk7DQogICAgfQ0KCQkJDQogICAgZnVuY3Rpb24gQ2lyY2xlKCR4YywkeWMsJHIpIHsNCglpbWFnZWVsbGlwc2UoJHRoaXMtPmltZyxyb3VuZCgkeGMpLHJvdW5kKCR5YyksJHIqMiwkcioyLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCiAgICB9DQoJDQogICAgZnVuY3Rpb24gRmlsbGVkQ2lyY2xlKCR4YywkeWMsJHIpIHsNCglpbWFnZWZpbGxlZGVsbGlwc2UoJHRoaXMtPmltZyxyb3VuZCgkeGMpLHJvdW5kKCR5YyksMiokciwyKiRyLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCiAgICB9DQoJDQogICAgLy8gTGluZWFyIENvbG9yIEludGVyUG9sYXRpb24NCiAgICBmdW5jdGlvbiBsaXAoJGYsJHQsJHApIHsNCgkkcCA9IHJvdW5kKCRwLDEpOw0KCSRyID0gJGZbMF0gKyAoJHRbMF0tJGZbMF0pKiRwOw0KCSRnID0gJGZbMV0gKyAoJHRbMV0tJGZbMV0pKiRwOw0KCSRiID0gJGZbMl0gKyAoJHRbMl0tJGZbMl0pKiRwOw0KCXJldHVybiBhcnJheSgkciwkZywkYik7DQogICAgfQ0KDQogICAgLy8gU2V0IGxpbmUgc3R5bGUgZGFzaGVkLCBkb3R0ZWQgZXRjDQogICAgZnVuY3Rpb24gU2V0TGluZVN0eWxlKCRzKSB7DQoJaWYoIGlzX251bWVyaWMoJHMpICkgew0KCSAgICBpZiggJHM8MSB8fCAkcz40ICkgDQoJCUpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTAxLCRzKTsvLygiIElsbGVnYWwgbnVtZXJpYyBhcmd1bWVudCB0byBTZXRMaW5lU3R5bGUoKTogKCRzKSIpOw0KCX0NCgllbHNlaWYoIGlzX3N0cmluZygkcykgKSB7DQoJICAgIGlmKCAkcyA9PSAic29saWQiICkgJHM9MTsNCgkgICAgZWxzZWlmKCAkcyA9PSAiZG90dGVkIiApICRzPTI7DQoJICAgIGVsc2VpZiggJHMgPT0gImRhc2hlZCIgKSAkcz0zOw0KCSAgICBlbHNlaWYoICRzID09ICJsb25nZGFzaGVkIiApICRzPTQ7DQoJICAgIGVsc2UgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMDIsJHMpOy8vKCIgSWxsZWdhbCBzdHJpbmcgYXJndW1lbnQgdG8gU2V0TGluZVN0eWxlKCk6ICRzIik7DQoJfQ0KCWVsc2UgeyANCgkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMDMsJHMpOy8vKCIgSWxsZWdhbCBhcmd1bWVudCB0byBTZXRMaW5lU3R5bGUgJHMiKTsNCgl9DQoJJG9sZCA9ICR0aGlzLT5saW5lX3N0eWxlOw0KCSR0aGlzLT5saW5lX3N0eWxlPSRzOw0KCXJldHVybiAkb2xkOw0KICAgIH0NCgkNCiAgICAvLyBTYW1lIGFzIExpbmUgYnV0IHRha2UgdGhlIGxpbmVfc3R5bGUgaW50byBhY2NvdW50DQogICAgZnVuY3Rpb24gU3R5bGVMaW5lKCR4MSwkeTEsJHgyLCR5MiwkYVN0eWxlPScnKSB7DQoJaWYoICR0aGlzLT5saW5lX3dlaWdodCA8PSAwICkNCgkgICAgcmV0dXJuOw0KDQoJaWYoICRhU3R5bGUgPT09ICcnICkgew0KCSAgICAkYVN0eWxlID0gJHRoaXMtPmxpbmVfc3R5bGU7DQoJfQ0KDQoJLy8gQWRkIGVycm9yIGNoZWNrIHNpbmNlIGRhc2hlZCBsaW5lIHdpbGwgb25seSB3b3JrIGlmIGFudGktYWxpYXMgaXMgZGlzYWJsZWQNCgkvLyB0aGlzIGlzIGEgbGltaXRhdGlvbiBpbiBHRA0KDQoJc3dpdGNoKCAkYVN0eWxlICkgew0KCSAgICBjYXNlIDE6Ly8gU29saWQNCgkJJHRoaXMtPkxpbmUoJHgxLCR5MSwkeDIsJHkyKTsNCgkJYnJlYWs7DQoJICAgIGNhc2UgMjogLy8gRG90dGVkDQoJCSR0aGlzLT5EYXNoZWRMaW5lKCR4MSwkeTEsJHgyLCR5MiwyLDYpOw0KCQlicmVhazsNCgkgICAgY2FzZSAzOiAvLyBEYXNoZWQNCgkJJHRoaXMtPkRhc2hlZExpbmUoJHgxLCR5MSwkeDIsJHkyLDUsOSk7DQoJCWJyZWFrOw0KCSAgICBjYXNlIDQ6IC8vIExvbmdkYXNoZXMNCgkJJHRoaXMtPkRhc2hlZExpbmUoJHgxLCR5MSwkeDIsJHkyLDksMTMpOw0KCQlicmVhazsNCgkgICAgZGVmYXVsdDoNCgkJSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMDQsJHRoaXMtPmxpbmVfc3R5bGUpOy8vKCIgVW5rbm93biBsaW5lIHN0eWxlOiAkdGhpcy0+bGluZV9zdHlsZSAiKTsNCgkJYnJlYWs7DQoJfQ0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBEYXNoZWRMaW5lKCR4MSwkeTEsJHgyLCR5MiwkZGFzaF9sZW5ndGg9MSwkZGFzaF9zcGFjZT00KSB7DQoNCglpZiggJHRoaXMtPmxpbmVfd2VpZ2h0IDw9IDAgKQ0KCSAgICByZXR1cm47DQoNCgkvLyBBZGQgZXJyb3IgY2hlY2sgdG8gbWFrZSBzdXJlIGFudGktYWxpYXMgaXMgbm90IGVuYWJsZWQuDQoJLy8gRGFzaGVkIGxpbmUgZG9lcyBub3Qgd29yayB3aXRoIGFudGktYWxpYXMgZW5hYmxlZC4gVGhpcyANCgkvLyBpcyBhIGxpbWl0YXRpb24gaW4gR0QuDQoJaWYoICR0aGlzLT51c2VfYW50aV9hbGlhc2luZyApIHsNCgkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMjkpOyAvLyBBbnRpLWFsaWFzIGNhbiBub3QgYmUgdXNlZCB3aXRoIGRhc2hlZCBsaW5lcy4gUGxlYXNlIGRpc2FibGUgYW50aS1hbGlhcyBvciB1c2Ugc29saWQgbGluZXMuIA0KCX0NCgkNCg0KCSR4MSA9IHJvdW5kKCR4MSk7DQoJJHgyID0gcm91bmQoJHgyKTsNCgkkeTEgPSByb3VuZCgkeTEpOw0KCSR5MiA9IHJvdW5kKCR5Mik7DQoNCgkkc3R5bGUgPSBhcnJheV9maWxsKDAsJGRhc2hfbGVuZ3RoLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCgkkc3R5bGUgPSBhcnJheV9wYWQoJHN0eWxlLCRkYXNoX3NwYWNlLElNR19DT0xPUl9UUkFOU1BBUkVOVCk7DQoJaW1hZ2VzZXRzdHlsZSgkdGhpcy0+aW1nLCAkc3R5bGUpOw0KCWltYWdlbGluZSgkdGhpcy0+aW1nLCAkeDEsICR5MSwgJHgyLCAkeTIsIElNR19DT0xPUl9TVFlMRUQpOw0KCSR0aGlzLT5sYXN0eD0keDI7ICR0aGlzLT5sYXN0eT0keTI7CQkNCiAgICB9IA0KDQogICAgZnVuY3Rpb24gTGluZSgkeDEsJHkxLCR4MiwkeTIpIHsNCg0KCWlmKCAkdGhpcy0+bGluZV93ZWlnaHQgPD0gMCApDQoJICAgIHJldHVybjsNCg0KCSR4MSA9IHJvdW5kKCR4MSk7DQoJJHgyID0gcm91bmQoJHgyKTsNCgkkeTEgPSByb3VuZCgkeTEpOw0KCSR5MiA9IHJvdW5kKCR5Mik7DQoNCglpbWFnZWxpbmUoJHRoaXMtPmltZywkeDEsJHkxLCR4MiwkeTIsJHRoaXMtPmN1cnJlbnRfY29sb3IpOw0KCSR0aGlzLT5sYXN0eD0keDI7ICR0aGlzLT5sYXN0eT0keTI7CQkNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBQb2x5Z29uKCRwLCRjbG9zZWQ9RkFMU0UsJGZhc3Q9RkFMU0UpIHsNCg0KCWlmKCAkdGhpcy0+bGluZV93ZWlnaHQgPD0gMCApIA0KCSAgICByZXR1cm47DQoNCgkkbj1jb3VudCgkcCk7DQoJJG9sZHggPSAkcFswXTsNCgkkb2xkeSA9ICRwWzFdOw0KCWlmKCAkZmFzdCApIHsNCgkgICAgZm9yKCAkaT0yOyAkaSA8ICRuOyAkaSs9MiApIHsNCgkJaW1hZ2VsaW5lKCR0aGlzLT5pbWcsJG9sZHgsJG9sZHksJHBbJGldLCRwWyRpKzFdLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCgkJJG9sZHggPSAkcFskaV07DQoJCSRvbGR5ID0gJHBbJGkrMV07DQoJICAgIH0NCgkgICAgaWYoICRjbG9zZWQgKSB7DQoJCWltYWdlbGluZSgkdGhpcy0+aW1nLCRwWyRuKjItMl0sJHBbJG4qMi0xXSwkcFswXSwkcFsxXSwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQoJICAgIH0NCgl9DQoJZWxzZSB7DQoJICAgIGZvciggJGk9MjsgJGkgPCAkbjsgJGkrPTIgKSB7DQoJCSR0aGlzLT5TdHlsZUxpbmUoJG9sZHgsJG9sZHksJHBbJGldLCRwWyRpKzFdKTsNCgkJJG9sZHggPSAkcFskaV07DQoJCSRvbGR5ID0gJHBbJGkrMV07DQoJICAgIH0NCgkgICAgaWYoICRjbG9zZWQgKQ0KCQkkdGhpcy0+U3R5bGVMaW5lKCRvbGR4LCRvbGR5LCRwWzBdLCRwWzFdKTsNCgl9DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIEZpbGxlZFBvbHlnb24oJHB0cykgew0KCSRuPWNvdW50KCRwdHMpOw0KCWlmKCAkbiA9PSAwICkgew0KCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEwNSk7Ly8oJ05VTEwgZGF0YSBzcGVjaWZpZWQgZm9yIGEgZmlsbGVkIHBvbHlnb24uIENoZWNrIHRoYXQgeW91ciBkYXRhIGlzIG5vdCBOVUxMLicpOw0KCX0NCglmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSkgDQoJICAgICRwdHNbJGldID0gcm91bmQoJHB0c1skaV0pOw0KCWltYWdlZmlsbGVkcG9seWdvbigkdGhpcy0+aW1nLCRwdHMsY291bnQoJHB0cykvMiwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIFJlY3RhbmdsZSgkeGwsJHl1LCR4ciwkeWwpIHsNCgkkdGhpcy0+UG9seWdvbihhcnJheSgkeGwsJHl1LCR4ciwkeXUsJHhyLCR5bCwkeGwsJHlsLCR4bCwkeXUpKTsNCiAgICB9DQoJDQogICAgZnVuY3Rpb24gRmlsbGVkUmVjdGFuZ2xlKCR4bCwkeXUsJHhyLCR5bCkgew0KCSR0aGlzLT5GaWxsZWRQb2x5Z29uKGFycmF5KCR4bCwkeXUsJHhyLCR5dSwkeHIsJHlsLCR4bCwkeWwpKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBGaWxsZWRSZWN0YW5nbGUyKCR4bCwkeXUsJHhyLCR5bCwkY29sb3IxLCRjb2xvcjIsJHN0eWxlPTEpIHsNCgkvLyBGaWxsIGEgcmVjdGFuZ2xlIHdpdGggbGluZXMgb2YgdHdvIGNvbG9ycw0KCWlmKCAkc3R5bGU9PT0xICkgew0KCSAgICAvLyBIb3Jpem9udGFsIHN0cmlwZQ0KCSAgICBpZiggJHlsIDwgJHl1ICkgew0KCQkkdCA9ICR5bDsgJHlsPSR5dTsgJHl1PSR0Ow0KCSAgICB9DQoJICAgIGZvciggJHk9JHl1OyAkeSA8PSAkeWw7ICsrJHkpIHsNCgkJJHRoaXMtPlNldENvbG9yKCRjb2xvcjEpOw0KCQkkdGhpcy0+TGluZSgkeGwsJHksJHhyLCR5KTsNCgkJKyskeTsNCgkJJHRoaXMtPlNldENvbG9yKCRjb2xvcjIpOw0KCQkkdGhpcy0+TGluZSgkeGwsJHksJHhyLCR5KTsNCgkgICAgfQ0KCX0NCgllbHNlIHsNCgkgICAgaWYoICR4bCA8ICR4bCApIHsNCgkJJHQgPSAkeGw7ICR4bD0keHI7ICR4cj0kdDsNCgkgICAgfQ0KCSAgICBmb3IoICR4PSR4bDsgJHggPD0gJHhyOyArKyR4KSB7DQoJCSR0aGlzLT5TZXRDb2xvcigkY29sb3IxKTsNCgkJJHRoaXMtPkxpbmUoJHgsJHl1LCR4LCR5bCk7DQoJCSsrJHg7DQoJCSR0aGlzLT5TZXRDb2xvcigkY29sb3IyKTsNCgkJJHRoaXMtPkxpbmUoJHgsJHl1LCR4LCR5bCk7DQoJICAgIH0NCgl9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU2hhZG93UmVjdGFuZ2xlKCR4bCwkeXUsJHhyLCR5bCwkZmNvbG9yPWZhbHNlLCRzaGFkb3dfd2lkdGg9Mywkc2hhZG93X2NvbG9yPWFycmF5KDEwMiwxMDIsMTAyKSkgew0KCS8vIFRoaXMgaXMgY29tcGxpY2F0ZWQgYnkgdGhlIGZhY3QgdGhhdCB3ZSBtdXN0IGFsc28gaGFuZGxlIHRoZSBjYXNlIHdoZXJlDQogICAgICAgIC8vIHRoZSByZWFjdGFuZ2xlIGhhcyBubyBmaWxsIGNvbG9yDQoJJHRoaXMtPlB1c2hDb2xvcigkc2hhZG93X2NvbG9yKTsNCgkkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4ci0kc2hhZG93X3dpZHRoLCR5dSskc2hhZG93X3dpZHRoLCR4ciwkeWwtJHNoYWRvd193aWR0aC0xKTsNCgkkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4bCskc2hhZG93X3dpZHRoLCR5bC0kc2hhZG93X3dpZHRoLCR4ciwkeWwpOw0KCS8vJHRoaXMtPkZpbGxlZFJlY3RhbmdsZSgkeGwrJHNoYWRvd193aWR0aCwkeXUrJHNoYWRvd193aWR0aCwkeHIsJHlsKTsNCgkkdGhpcy0+UG9wQ29sb3IoKTsNCglpZiggJGZjb2xvcj09ZmFsc2UgKQ0KCSAgICAkdGhpcy0+UmVjdGFuZ2xlKCR4bCwkeXUsJHhyLSRzaGFkb3dfd2lkdGgtMSwkeWwtJHNoYWRvd193aWR0aC0xKTsNCgllbHNlIHsJCQ0KCSAgICAkdGhpcy0+UHVzaENvbG9yKCRmY29sb3IpOw0KCSAgICAkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4bCwkeXUsJHhyLSRzaGFkb3dfd2lkdGgtMSwkeWwtJHNoYWRvd193aWR0aC0xKTsNCgkgICAgJHRoaXMtPlBvcENvbG9yKCk7DQoJICAgICR0aGlzLT5SZWN0YW5nbGUoJHhsLCR5dSwkeHItJHNoYWRvd193aWR0aC0xLCR5bC0kc2hhZG93X3dpZHRoLTEpOw0KCX0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBGaWxsZWRSb3VuZGVkUmVjdGFuZ2xlKCR4dCwkeXQsJHhyLCR5bCwkcj01KSB7DQoJaWYoICRyPT0wICkgew0KCSAgICAkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4dCwkeXQsJHhyLCR5bCk7DQoJICAgIHJldHVybjsNCgl9DQoNCgkvLyBUbyBhdm9pZCBvdmVybGFwcGluZyBmaWxsaW5ncyAod2hpY2ggd2lsbCBsb29rIHN0cmFuZ2UNCgkvLyB3aGVuIGFscGhhYmxlbmRpbmcgaXMgZW5hYmxlZCkgd2UgaGF2ZSBubyBjaG9pY2UgYnV0IA0KCS8vIHRvIGZpbGwgdGhlIGZpdmUgZGlzdGluY3QgYXJlYXMgb25lIGJ5IG9uZS4NCgkNCgkvLyBDZW50ZXIgc3F1YXJlDQoJJHRoaXMtPkZpbGxlZFJlY3RhbmdsZSgkeHQrJHIsJHl0KyRyLCR4ci0kciwkeWwtJHIpOw0KCS8vIFRvcCBiYW5kDQoJJHRoaXMtPkZpbGxlZFJlY3RhbmdsZSgkeHQrJHIsJHl0LCR4ci0kciwkeXQrJHItMSk7DQoJLy8gQm90dG9tIGJhbmQNCgkkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4dCskciwkeWwtJHIrMSwkeHItJHIsJHlsKTsNCgkvLyBMZWZ0IGJhbmQNCgkkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4dCwkeXQrJHIrMSwkeHQrJHItMSwkeWwtJHIpOw0KCS8vIFJpZ2h0IGJhbmQNCgkkdGhpcy0+RmlsbGVkUmVjdGFuZ2xlKCR4ci0kcisxLCR5dCskciwkeHIsJHlsLSRyKTsNCg0KCS8vIFRvcGxlZnQgJiBUb3ByaWdodCBhcmMNCgkkdGhpcy0+RmlsbGVkQXJjKCR4dCskciwkeXQrJHIsJHIqMiwkcioyLDE4MCwyNzApOw0KCSR0aGlzLT5GaWxsZWRBcmMoJHhyLSRyLCR5dCskciwkcioyLCRyKjIsMjcwLDM2MCk7DQoNCgkvLyBCb3R0b21sZWZ0ICYgQm90dG9tIHJpZ2h0IGFyYw0KCSR0aGlzLT5GaWxsZWRBcmMoJHh0KyRyLCR5bC0kciwkcioyLCRyKjIsOTAsMTgwKTsNCgkkdGhpcy0+RmlsbGVkQXJjKCR4ci0kciwkeWwtJHIsJHIqMiwkcioyLDAsOTApOw0KDQogICAgfQ0KDQogICAgZnVuY3Rpb24gUm91bmRlZFJlY3RhbmdsZSgkeHQsJHl0LCR4ciwkeWwsJHI9NSkgeyAgICANCg0KCWlmKCAkcj09MCApIHsNCgkgICAgJHRoaXMtPlJlY3RhbmdsZSgkeHQsJHl0LCR4ciwkeWwpOw0KCSAgICByZXR1cm47DQoJfQ0KDQoJLy8gVG9wICYgQm90dG9tIGxpbmUNCgkkdGhpcy0+TGluZSgkeHQrJHIsJHl0LCR4ci0kciwkeXQpOw0KCSR0aGlzLT5MaW5lKCR4dCskciwkeWwsJHhyLSRyLCR5bCk7DQoNCgkvLyBMZWZ0ICYgUmlnaHQgbGluZQ0KCSR0aGlzLT5MaW5lKCR4dCwkeXQrJHIsJHh0LCR5bC0kcik7DQoJJHRoaXMtPkxpbmUoJHhyLCR5dCskciwkeHIsJHlsLSRyKTsNCg0KCS8vIFRvcGxlZnQgJiBUb3ByaWdodCBhcmMNCgkkdGhpcy0+QXJjKCR4dCskciwkeXQrJHIsJHIqMiwkcioyLDE4MCwyNzApOw0KCSR0aGlzLT5BcmMoJHhyLSRyLCR5dCskciwkcioyLCRyKjIsMjcwLDM2MCk7DQoNCgkvLyBCb3R0b21sZWZ0ICYgQm90dG9tcmlnaHQgYXJjDQoJJHRoaXMtPkFyYygkeHQrJHIsJHlsLSRyLCRyKjIsJHIqMiw5MCwxODApOw0KCSR0aGlzLT5BcmMoJHhyLSRyLCR5bC0kciwkcioyLCRyKjIsMCw5MCk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRmlsbGVkQmV2ZWwoJHgxLCR5MSwkeDIsJHkyLCRkZXB0aD0yLCRjb2xvcjE9J3doaXRlQDAuNCcsJGNvbG9yMj0nZGFya2dyYXlAMC40Jykgew0KCSR0aGlzLT5GaWxsZWRSZWN0YW5nbGUoJHgxLCR5MSwkeDIsJHkyKTsNCgkkdGhpcy0+QmV2ZWwoJHgxLCR5MSwkeDIsJHkyLCRkZXB0aCwkY29sb3IxLCRjb2xvcjIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEJldmVsKCR4MSwkeTEsJHgyLCR5MiwkZGVwdGg9MiwkY29sb3IxPSd3aGl0ZUAwLjQnLCRjb2xvcjI9J2JsYWNrQDAuNScpIHsNCgkkdGhpcy0+UHVzaENvbG9yKCRjb2xvcjEpOw0KCWZvciggJGk9MDsgJGkgPCAkZGVwdGg7ICsrJGkgKSB7DQoJICAgICR0aGlzLT5MaW5lKCR4MSskaSwkeTErJGksJHgxKyRpLCR5Mi0kaSk7DQoJICAgICR0aGlzLT5MaW5lKCR4MSskaSwkeTErJGksJHgyLSRpLCR5MSskaSk7DQoJfQ0KCSR0aGlzLT5Qb3BDb2xvcigpOw0KCQ0KCSR0aGlzLT5QdXNoQ29sb3IoJGNvbG9yMik7DQoJZm9yKCAkaT0wOyAkaSA8ICRkZXB0aDsgKyskaSApIHsNCgkgICAgJHRoaXMtPkxpbmUoJHgxKyRpLCR5Mi0kaSwkeDItJGksJHkyLSRpKTsNCgkgICAgJHRoaXMtPkxpbmUoJHgyLSRpLCR5MSskaSwkeDItJGksJHkyLSRpLTEpOw0KCX0NCgkkdGhpcy0+UG9wQ29sb3IoKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBTdHlsZUxpbmVUbygkeCwkeSkgew0KCSR0aGlzLT5TdHlsZUxpbmUoJHRoaXMtPmxhc3R4LCR0aGlzLT5sYXN0eSwkeCwkeSk7DQoJJHRoaXMtPmxhc3R4PSR4Ow0KCSR0aGlzLT5sYXN0eT0keTsNCiAgICB9DQoJDQogICAgZnVuY3Rpb24gTGluZVRvKCR4LCR5KSB7DQoJJHRoaXMtPkxpbmUoJHRoaXMtPmxhc3R4LCR0aGlzLT5sYXN0eSwkeCwkeSk7DQoJJHRoaXMtPmxhc3R4PSR4Ow0KCSR0aGlzLT5sYXN0eT0keTsNCiAgICB9DQoJDQogICAgZnVuY3Rpb24gUG9pbnQoJHgsJHkpIHsNCglpbWFnZXNldHBpeGVsKCR0aGlzLT5pbWcscm91bmQoJHgpLHJvdW5kKCR5KSwkdGhpcy0+Y3VycmVudF9jb2xvcik7DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIEZpbGwoJHgsJHkpIHsNCglpbWFnZWZpbGwoJHRoaXMtPmltZyxyb3VuZCgkeCkscm91bmQoJHkpLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBGaWxsVG9Cb3JkZXIoJHgsJHksJGFCb3JkQ29sb3IpIHsNCgkkYmMgPSAkdGhpcy0+cmdiLT5hbGxvY2F0ZSgkYUJvcmRDb2xvcik7DQoJaWYoICRiYyA9PSAtMSApIHsNCgkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMDYpOy8vKCdJbWFnZTo6RmlsbFRvQm9yZGVyIDogQ2FuIG5vdCBhbGxvY2F0ZSBtb3JlIGNvbG9ycycpOw0KCX0NCglpbWFnZWZpbGx0b2JvcmRlcigkdGhpcy0+aW1nLHJvdW5kKCR4KSxyb3VuZCgkeSksJGJjLCR0aGlzLT5jdXJyZW50X2NvbG9yKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBTZXRFeHBpcmVkKCRhRmxnPXRydWUpIHsNCgkkdGhpcy0+ZXhwaXJlZCA9ICRhRmxnOw0KICAgIH0NCgkNCiAgICAvLyBHZW5lcmF0ZSBpbWFnZSBoZWFkZXINCiAgICBmdW5jdGlvbiBIZWFkZXJzKCkgew0KCQ0KCS8vIEluIGNhc2Ugd2UgYXJlIHJ1bm5pbmcgZnJvbSB0aGUgY29tbWFuZCBsaW5lIHdpdGggdGhlIGNsaWVudCB2ZXJzaW9uIG9mDQoJLy8gUEhQIHdlIGNhbid0IHNlbmQgYW55IGhlYWRlcnMuDQoJJHNhcGkgPSBwaHBfc2FwaV9uYW1lKCk7DQoJaWYoICRzYXBpID09ICdjbGknICkNCgkgICAgcmV0dXJuOw0KDQoJLy8gVGhlc2UgcGFyYW1ldGVycyBhcmUgc2V0IGJ5IGhlYWRlcnNfc2VudCgpIGJ1dCB0aGV5IG1pZ2h0IGNhdXNlDQoJLy8gYW4gdW5kZWZpbmVkIHZhcmlhYmxlIGVycm9yIHVubGVzcyB0aGV5IGFyZSBpbml0aWxpemVkDQoJJGZpbGU9Jyc7DQoJJGxpbmVubz0nJzsNCglpZiggaGVhZGVyc19zZW50KCRmaWxlLCRsaW5lbm8pICkgew0KCSAgICAkZmlsZT1iYXNlbmFtZSgkZmlsZSk7CSAgICANCgkgICAgJHQgPSBuZXcgRXJyTXNnVGV4dCgpOw0KCSAgICAkbXNnID0gJHQtPkdldCgxMCwkZmlsZSwkbGluZW5vKTsNCgkgICAgZGllKCRtc2cpOw0KCX0JDQoJDQoJaWYgKCR0aGlzLT5leHBpcmVkKSB7DQoJICAgIGhlYWRlcigiRXhwaXJlczogTW9uLCAyNiBKdWwgMTk5NyAwNTowMDowMCBHTVQiKTsNCgkgICAgaGVhZGVyKCJMYXN0LU1vZGlmaWVkOiAiIC4gZ21kYXRlKCJELCBkIE0gWSBIOmk6cyIpIC4gIkdNVCIpOw0KCSAgICBoZWFkZXIoIkNhY2hlLUNvbnRyb2w6IG5vLWNhY2hlLCBtdXN0LXJldmFsaWRhdGUiKTsNCgkgICAgaGVhZGVyKCJQcmFnbWE6IG5vLWNhY2hlIik7DQoJfQ0KCWhlYWRlcigiQ29udGVudC10eXBlOiBpbWFnZS8kdGhpcy0+aW1nX2Zvcm1hdCIpOw0KICAgIH0NCg0KICAgIC8vIEFkanVzdCBpbWFnZSBxdWFsaXR5IGZvciBmb3JtYXRzIHRoYXQgYWxsb3cgdGhpcw0KICAgIGZ1bmN0aW9uIFNldFF1YWxpdHkoJHEpIHsNCgkkdGhpcy0+cXVhbGl0eSA9ICRxOw0KICAgIH0NCgkNCiAgICAvLyBTdHJlYW0gaW1hZ2UgdG8gYnJvd3NlciBvciB0byBmaWxlDQogICAgZnVuY3Rpb24gU3RyZWFtKCRhRmlsZT0iIikgew0KCSRmdW5jPSJpbWFnZSIuJHRoaXMtPmltZ19mb3JtYXQ7DQoJaWYoICR0aGlzLT5pbWdfZm9ybWF0PT0ianBlZyIgJiYgJHRoaXMtPnF1YWxpdHkgIT0gbnVsbCApIHsNCgkgICAgJHJlcyA9IEAkZnVuYygkdGhpcy0+aW1nLCRhRmlsZSwkdGhpcy0+cXVhbGl0eSk7DQoJfQ0KCWVsc2Ugew0KCSAgICBpZiggJGFGaWxlICE9ICIiICkgew0KCQkkcmVzID0gQCRmdW5jKCR0aGlzLT5pbWcsJGFGaWxlKTsNCgkJaWYoICEkcmVzICkNCgkJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTA3LCRhRmlsZSk7Ly8oIkNhbid0IHdyaXRlIHRvIGZpbGUgJyRhRmlsZScuIENoZWNrIHRoYXQgdGhlIHByb2Nlc3MgcnVubmluZyBQSFAgaGFzIGVub3VnaCBwZXJtaXNzaW9uLiIpOw0KCSAgICB9DQoJICAgIGVsc2Ugew0KCQkkcmVzID0gQCRmdW5jKCR0aGlzLT5pbWcpOw0KCQlpZiggISRyZXMgKQ0KCQkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMDgpOy8vKCJDYW4ndCBzdHJlYW0gaW1hZ2UuIFRoaXMgaXMgbW9zdCBsaWtlbHkgZHVlIHRvIGEgZmF1bHR5IFBIUC9HRCBzZXR1cC4gVHJ5IHRvIHJlY29tcGlsZSBQSFAgYW5kIHVzZSB0aGUgYnVpbHQtaW4gR0QgbGlicmFyeSB0aGF0IGNvbWVzIHdpdGggUEhQLiIpOw0KCQkNCgkgICAgfQ0KCX0NCiAgICB9DQoJCQ0KICAgIC8vIENsZWFyIHJlc291cmNlIHRpZGUgdXAgYnkgaW1hZ2UNCiAgICBmdW5jdGlvbiBEZXN0cm95KCkgew0KCWltYWdlZGVzdHJveSgkdGhpcy0+aW1nKTsNCiAgICB9DQoJDQogICAgLy8gU3BlY2lmeSBpbWFnZSBmb3JtYXQuIE5vdGUgZGVwZW5kaW5nIG9uIHlvdXIgaW5zdGFsbGF0aW9uDQogICAgLy8gb2YgUEhQIG5vdCBhbGwgZm9ybWF0cyBtYXkgYmUgc3VwcG9ydGVkLg0KICAgIGZ1bmN0aW9uIFNldEltZ0Zvcm1hdCgkYUZvcm1hdCwkYVF1YWxpdHk9NzUpIHsJCQ0KCSR0aGlzLT5xdWFsaXR5ID0gJGFRdWFsaXR5Ow0KCSRhRm9ybWF0ID0gc3RydG9sb3dlcigkYUZvcm1hdCk7DQoJJHRzdCA9IHRydWU7DQoJJHN1cHBvcnRlZCA9IGltYWdldHlwZXMoKTsNCglpZiggJGFGb3JtYXQ9PSJhdXRvIiApIHsNCgkgICAgaWYoICRzdXBwb3J0ZWQgJiBJTUdfUE5HICkNCgkJJHRoaXMtPmltZ19mb3JtYXQ9InBuZyI7DQoJICAgIGVsc2VpZiggJHN1cHBvcnRlZCAmIElNR19KUEcgKQ0KCQkkdGhpcy0+aW1nX2Zvcm1hdD0ianBlZyI7DQoJICAgIGVsc2VpZiggJHN1cHBvcnRlZCAmIElNR19HSUYgKQ0KCQkkdGhpcy0+aW1nX2Zvcm1hdD0iZ2lmIjsNCgkgICAgZWxzZWlmKCAkc3VwcG9ydGVkICYgSU1HX1dCTVAgKQ0KCQkkdGhpcy0+aW1nX2Zvcm1hdD0id2JtcCI7DQoJICAgIGVsc2VpZiggJHN1cHBvcnRlZCAmIElNR19YUE0gKQ0KCQkkdGhpcy0+aW1nX2Zvcm1hdD0ieHBtIjsNCgkgICAgZWxzZQ0KCQlKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEwOSk7Ly8oIllvdXIgUEhQIChhbmQgR0QtbGliKSBpbnN0YWxsYXRpb24gZG9lcyBub3QgYXBwZWFyIHRvIHN1cHBvcnQgYW55IGtub3duIGdyYXBoaWMgZm9ybWF0cy4gWW91IG5lZWQgdG8gZmlyc3QgbWFrZSBzdXJlIEdEIGlzIGNvbXBpbGVkIGFzIGEgbW9kdWxlIHRvIFBIUC4gSWYgeW91IGFsc28gd2FudCB0byB1c2UgSlBFRyBpbWFnZXMgeW91IG11c3QgZ2V0IHRoZSBKUEVHIGxpYnJhcnkuIFBsZWFzZSBzZWUgdGhlIFBIUCBkb2NzIGZvciBkZXRhaWxzLiIpOw0KCQkJCQ0KCSAgICByZXR1cm4gdHJ1ZTsNCgl9DQoJZWxzZSB7DQoJICAgIGlmKCAkYUZvcm1hdD09ImpwZWciIHx8ICRhRm9ybWF0PT0icG5nIiB8fCAkYUZvcm1hdD09ImdpZiIgKSB7DQoJCWlmKCAkYUZvcm1hdD09ImpwZWciICYmICEoJHN1cHBvcnRlZCAmIElNR19KUEcpICkNCgkJICAgICR0c3Q9ZmFsc2U7DQoJCWVsc2VpZiggJGFGb3JtYXQ9PSJwbmciICYmICEoJHN1cHBvcnRlZCAmIElNR19QTkcpICkgDQoJCSAgICAkdHN0PWZhbHNlOw0KCQllbHNlaWYoICRhRm9ybWF0PT0iZ2lmIiAmJiAhKCRzdXBwb3J0ZWQgJiBJTUdfR0lGKSApIAkNCgkJICAgICR0c3Q9ZmFsc2U7DQoJCWVsc2VpZiggJGFGb3JtYXQ9PSJ3Ym1wIiAmJiAhKCRzdXBwb3J0ZWQgJiBJTUdfV0JNUCkgKSAJDQoJCSAgICAkdHN0PWZhbHNlOw0KCQllbHNlaWYoICRhRm9ybWF0PT0ieHBtIiAmJiAhKCRzdXBwb3J0ZWQgJiBJTUdfWFBNKSApIAkNCgkJICAgICR0c3Q9ZmFsc2U7DQoJCWVsc2Ugew0KCQkgICAgJHRoaXMtPmltZ19mb3JtYXQ9JGFGb3JtYXQ7DQoJCSAgICByZXR1cm4gdHJ1ZTsNCgkJfQ0KCSAgICB9DQoJICAgIGVsc2UgDQoJCSR0c3Q9ZmFsc2U7DQoJICAgIGlmKCAhJHRzdCApDQoJCUpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTEwLCRhRm9ybWF0KTsvLygiIFlvdXIgUEhQIGluc3RhbGxhdGlvbiBkb2VzIG5vdCBzdXBwb3J0IHRoZSBjaG9zZW4gZ3JhcGhpYyBmb3JtYXQ6ICRhRm9ybWF0Iik7DQoJfQ0KICAgIH0JDQp9IC8vIENMQVNTDQoNCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQovLyBDTEFTUyBSb3RJbWFnZQ0KLy8gRGVzY3JpcHRpb246IEV4YWN0bHkgYXMgSW1hZ2UgYnV0IGRyYXdzIHRoZSBpbWFnZSBhdA0KLy8gYSBzcGVjaWZpZWQgYW5nbGUgYXJvdW5kIGEgc3BlY2lmaWVkIHJvdGF0aW9uIHBvaW50Lg0KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCmNsYXNzIFJvdEltYWdlIGV4dGVuZHMgSW1hZ2Ugew0KICAgIHB1YmxpYyAkYT0wOw0KICAgIHB1YmxpYyAkZHg9MCwkZHk9MCwkdHJhbnN4PTAsJHRyYW5zeT0wOyANCiAgICBwcml2YXRlICRtPWFycmF5KCk7DQoJDQogICAgZnVuY3Rpb24gUm90SW1hZ2UoJGFXaWR0aCwkYUhlaWdodCwkYT0wLCRhRm9ybWF0PURFRkFVTFRfR0ZPUk1BVCwkYVNldEF1dG9NYXJnaW49dHJ1ZSkgew0KCSR0aGlzLT5JbWFnZSgkYVdpZHRoLCRhSGVpZ2h0LCRhRm9ybWF0LCRhU2V0QXV0b01hcmdpbik7DQoJJHRoaXMtPmR4PSR0aGlzLT5sZWZ0X21hcmdpbiskdGhpcy0+cGxvdHdpZHRoLzI7DQoJJHRoaXMtPmR5PSR0aGlzLT50b3BfbWFyZ2luKyR0aGlzLT5wbG90aGVpZ2h0LzI7DQoJJHRoaXMtPlNldEFuZ2xlKCRhKTsJDQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIFNldENlbnRlcigkZHgsJGR5KSB7DQoJJG9sZF9keCA9ICR0aGlzLT5keDsNCgkkb2xkX2R5ID0gJHRoaXMtPmR5Ow0KCSR0aGlzLT5keD0kZHg7DQoJJHRoaXMtPmR5PSRkeTsNCgkkdGhpcy0+U2V0QW5nbGUoJHRoaXMtPmEpOw0KCXJldHVybiBhcnJheSgkb2xkX2R4LCRvbGRfZHkpOw0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBTZXRUcmFuc2xhdGlvbigkZHgsJGR5KSB7DQoJJG9sZCA9IGFycmF5KCR0aGlzLT50cmFuc3gsJHRoaXMtPnRyYW5zeSk7DQoJJHRoaXMtPnRyYW5zeCA9ICRkeDsNCgkkdGhpcy0+dHJhbnN5ID0gJGR5Ow0KCXJldHVybiAkb2xkOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIFVwZGF0ZVJvdE1hdHJpY2UoKSAgew0KCSRhID0gJHRoaXMtPmE7DQoJJGEgKj0gTV9QSS8xODA7DQoJJHNhPXNpbigkYSk7ICRjYT1jb3MoJGEpOwkJDQoJLy8gQ3JlYXRlIHRoZSByb3RhdGlvbiBtYXRyaXgNCgkkdGhpcy0+bVswXVswXSA9ICRjYTsNCgkkdGhpcy0+bVswXVsxXSA9IC0kc2E7DQoJJHRoaXMtPm1bMF1bMl0gPSAkdGhpcy0+ZHgqKDEtJGNhKSArICRzYSokdGhpcy0+ZHkgOw0KCSR0aGlzLT5tWzFdWzBdID0gJHNhOw0KCSR0aGlzLT5tWzFdWzFdID0gJGNhOw0KCSR0aGlzLT5tWzFdWzJdID0gJHRoaXMtPmR5KigxLSRjYSkgLSAkc2EqJHRoaXMtPmR4IDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBTZXRBbmdsZSgkYSkgew0KCSR0bXAgPSAkdGhpcy0+YTsNCgkkdGhpcy0+YSA9ICRhOw0KCSR0aGlzLT5VcGRhdGVSb3RNYXRyaWNlKCk7DQoJcmV0dXJuICR0bXA7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gQ2lyY2xlKCR4YywkeWMsJHIpIHsNCglsaXN0KCR4YywkeWMpID0gJHRoaXMtPlJvdGF0ZSgkeGMsJHljKTsNCglwYXJlbnQ6OkNpcmNsZSgkeGMsJHljLCRyKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBGaWxsZWRDaXJjbGUoJHhjLCR5Yywkcikgew0KCWxpc3QoJHhjLCR5YykgPSAkdGhpcy0+Um90YXRlKCR4YywkeWMpOw0KCXBhcmVudDo6RmlsbGVkQ2lyY2xlKCR4YywkeWMsJHIpOw0KICAgIH0NCg0KCQ0KICAgIGZ1bmN0aW9uIEFyYygkeGMsJHljLCR3LCRoLCRzLCRlKSB7DQoJbGlzdCgkeGMsJHljKSA9ICR0aGlzLT5Sb3RhdGUoJHhjLCR5Yyk7DQoJJHMgKz0gJHRoaXMtPmE7DQoJJGUgKz0gJHRoaXMtPmE7DQoJcGFyZW50OjpBcmMoJHhjLCR5YywkdywkaCwkcywkZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gRmlsbGVkQXJjKCR4YywkeWMsJHcsJGgsJHMsJGUsJHN0eWxlPScnKSB7DQoJbGlzdCgkeGMsJHljKSA9ICR0aGlzLT5Sb3RhdGUoJHhjLCR5Yyk7DQoJJHMgKz0gJHRoaXMtPmE7DQoJJGUgKz0gJHRoaXMtPmE7DQoJcGFyZW50OjpGaWxsZWRBcmMoJHhjLCR5YywkdywkaCwkcywkZSk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gU2V0TWFyZ2luKCRsbSwkcm0sJHRtLCRibSkgew0KCXBhcmVudDo6U2V0TWFyZ2luKCRsbSwkcm0sJHRtLCRibSk7DQoJJHRoaXMtPmR4PSR0aGlzLT5sZWZ0X21hcmdpbiskdGhpcy0+cGxvdHdpZHRoLzI7DQoJJHRoaXMtPmR5PSR0aGlzLT50b3BfbWFyZ2luKyR0aGlzLT5wbG90aGVpZ2h0LzI7DQoJJHRoaXMtPlVwZGF0ZVJvdE1hdHJpY2UoKTsNCiAgICB9DQoJDQogICAgZnVuY3Rpb24gUm90YXRlKCR4LCR5KSB7DQoJLy8gT3B0aW1pemF0aW9uLiBJZ25vcmUgcm90YXRpb24gaWYgQW5nbGU9PTAgfHwgQW5nbGU9PTM2MA0KCWlmKCAkdGhpcy0+YSA9PSAwIHx8ICR0aGlzLT5hID09IDM2MCApIHsNCgkgICAgcmV0dXJuIGFycmF5KCR4ICsgJHRoaXMtPnRyYW5zeCwgJHkgKyAkdGhpcy0+dHJhbnN5ICk7DQoJfQ0KCWVsc2Ugew0KCSAgICAkeDE9cm91bmQoJHRoaXMtPm1bMF1bMF0qJHggKyAkdGhpcy0+bVswXVsxXSokeSwxKSArICR0aGlzLT5tWzBdWzJdICsgJHRoaXMtPnRyYW5zeDsNCgkgICAgJHkxPXJvdW5kKCR0aGlzLT5tWzFdWzBdKiR4ICsgJHRoaXMtPm1bMV1bMV0qJHksMSkgKyAkdGhpcy0+bVsxXVsyXSArICR0aGlzLT50cmFuc3k7DQoJICAgIHJldHVybiBhcnJheSgkeDEsJHkxKTsNCgl9DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIENvcHlNZXJnZSgkZnJvbUltZywkdG9YLCR0b1ksJGZyb21YLCRmcm9tWSwkdG9XaWR0aCwkdG9IZWlnaHQsJGZyb21XaWR0aD0tMSwkZnJvbUhlaWdodD0tMSwkYU1peD0xMDApIHsNCglsaXN0KCR0b1gsJHRvWSkgPSAkdGhpcy0+Um90YXRlKCR0b1gsJHRvWSk7DQoJcGFyZW50OjpDb3B5TWVyZ2UoJGZyb21JbWcsJHRvWCwkdG9ZLCRmcm9tWCwkZnJvbVksJHRvV2lkdGgsJHRvSGVpZ2h0LCRmcm9tV2lkdGgsJGZyb21IZWlnaHQsJGFNaXgpOw0KDQogICAgfQ0KDQogICAgZnVuY3Rpb24gQXJyUm90YXRlKCRwbnRzKSB7DQoJJG4gPSBjb3VudCgkcG50cyktMTsNCglmb3IoJGk9MDsgJGkgPCAkbjsgJGkrPTIpIHsNCgkgICAgbGlzdCAoJHgsJHkpID0gJHRoaXMtPlJvdGF0ZSgkcG50c1skaV0sJHBudHNbJGkrMV0pOw0KCSAgICAkcG50c1skaV0gPSAkeDsgJHBudHNbJGkrMV0gPSAkeTsNCgl9DQoJcmV0dXJuICRwbnRzOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIERhc2hlZExpbmUoJHgxLCR5MSwkeDIsJHkyLCRkYXNoX2xlbmd0aD0xLCRkYXNoX3NwYWNlPTQpIHsNCglsaXN0KCR4MSwkeTEpID0gJHRoaXMtPlJvdGF0ZSgkeDEsJHkxKTsNCglsaXN0KCR4MiwkeTIpID0gJHRoaXMtPlJvdGF0ZSgkeDIsJHkyKTsNCglwYXJlbnQ6OkRhc2hlZExpbmUoJHgxLCR5MSwkeDIsJHkyLCRkYXNoX2xlbmd0aCwkZGFzaF9zcGFjZSk7DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIExpbmUoJHgxLCR5MSwkeDIsJHkyKSB7DQoJbGlzdCgkeDEsJHkxKSA9ICR0aGlzLT5Sb3RhdGUoJHgxLCR5MSk7DQoJbGlzdCgkeDIsJHkyKSA9ICR0aGlzLT5Sb3RhdGUoJHgyLCR5Mik7DQoJcGFyZW50OjpMaW5lKCR4MSwkeTEsJHgyLCR5Mik7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gUmVjdGFuZ2xlKCR4MSwkeTEsJHgyLCR5Mikgew0KCS8vIFJlY3RhbmdsZSB1c2VzIExpbmUoKSBzbyBpdCB3aWxsIGJlIHJvdGF0ZWQgdGhyb3VnaCB0aGF0IGNhbGwNCglwYXJlbnQ6OlJlY3RhbmdsZSgkeDEsJHkxLCR4MiwkeTIpOw0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBGaWxsZWRSZWN0YW5nbGUoJHgxLCR5MSwkeDIsJHkyKSB7DQoJaWYoICR5MT09JHkyIHx8ICR4MT09JHgyICkNCgkgICAgJHRoaXMtPkxpbmUoJHgxLCR5MSwkeDIsJHkyKTsNCgllbHNlIA0KCSAgICAkdGhpcy0+RmlsbGVkUG9seWdvbihhcnJheSgkeDEsJHkxLCR4MiwkeTEsJHgyLCR5MiwkeDEsJHkyKSk7DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIFBvbHlnb24oJHBudHMsJGNsb3NlZD1GQUxTRSwkZmFzdD1GQUxTRSkgew0KCS8vIFBvbHlnb24gdXNlcyBMaW5lKCkgc28gaXQgd2lsbCBiZSByb3RhdGVkIHRocm91Z2ggdGhhdCBjYWxsIHVubGVzcw0KCS8vIGZhc3QgZHJhd2luZyByb3V0aW5lcyBhcmUgdXNlZCBpbiB3aGljaCBjYXNlIGEgcm90YXRlIGlzIG5lZWRlZA0KCWlmKCAkZmFzdCApIHsNCgkgICAgcGFyZW50OjpQb2x5Z29uKCR0aGlzLT5BcnJSb3RhdGUoJHBudHMpKTsNCgl9DQoJZWxzZQ0KCSAgICBwYXJlbnQ6OlBvbHlnb24oJHBudHMsJGNsb3NlZCwkZmFzdCk7DQogICAgfQ0KCQ0KICAgIGZ1bmN0aW9uIEZpbGxlZFBvbHlnb24oJHBudHMpIHsNCglwYXJlbnQ6OkZpbGxlZFBvbHlnb24oJHRoaXMtPkFyclJvdGF0ZSgkcG50cykpOw0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBQb2ludCgkeCwkeSkgew0KCWxpc3QoJHhwLCR5cCkgPSAkdGhpcy0+Um90YXRlKCR4LCR5KTsNCglwYXJlbnQ6OlBvaW50KCR4cCwkeXApOw0KICAgIH0NCgkNCiAgICBmdW5jdGlvbiBTdHJva2VUZXh0KCR4LCR5LCR0eHQsJGRpcj0wLCRwYXJhZ3JhcGhfYWxpZ249ImxlZnQiLCRkZWJ1Zz1mYWxzZSkgew0KCWxpc3QoJHhwLCR5cCkgPSAkdGhpcy0+Um90YXRlKCR4LCR5KTsNCglyZXR1cm4gcGFyZW50OjpTdHJva2VUZXh0KCR4cCwkeXAsJHR4dCwkZGlyLCRwYXJhZ3JhcGhfYWxpZ24sJGRlYnVnKTsNCiAgICB9DQp9DQoNCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQovLyBDTEFTUyBJbWdTdHJlYW1DYWNoZQ0KLy8gRGVzY3JpcHRpb246IEhhbmRsZSBjYWNoaW5nIG9mIGdyYXBocyB0byBmaWxlcw0KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCmNsYXNzIEltZ1N0cmVhbUNhY2hlIHsNCiAgICBwcml2YXRlICRjYWNoZV9kaXIsICRpbWc9bnVsbCwgJHRpbWVvdXQ9MDsgCS8vIEluZmluaXRlIHRpbWVvdXQNCiAgICAvLy0tLS0tLS0tLS0tLS0tLQ0KICAgIC8vIENPTlNUUlVDVE9SDQogICAgZnVuY3Rpb24gSW1nU3RyZWFtQ2FjaGUoJGFJbWcsICRhQ2FjaGVEaXI9Q0FDSEVfRElSKSB7DQoJJHRoaXMtPmltZyA9ICRhSW1nOw0KCSR0aGlzLT5jYWNoZV9kaXIgPSAkYUNhY2hlRGlyOw0KICAgIH0NCg0KLy8tLS0tLS0tLS0tLS0tLS0NCi8vIFBVQkxJQyBNRVRIT0RTCQ0KDQogICAgLy8gU3BlY2lmeSBhIHRpbWVvdXQgKGluIG1pbnV0ZXMpIGZvciB0aGUgZmlsZS4gSWYgdGhlIGZpbGUgaXMgb2xkZXIgdGhlbiB0aGUNCiAgICAvLyB0aW1lb3V0IHZhbHVlIGl0IHdpbGwgYmUgb3ZlcndyaXR0ZW4gd2l0aCBhIG5ld2VyIHZlcnNpb24uDQogICAgLy8gSWYgdGltZW91dCBpcyBzZXQgdG8gMCB0aGlzIGlzIHRoZSBzYW1lIGFzIGluZmluaXRlIGxhcmdlIHRpbWVvdXQgYW5kIGlmDQogICAgLy8gdGltZW91dCBpcyBzZXQgdG8gLTEgdGhpcyBpcyB0aGUgc2FtZSBhcyBpbmZpbml0ZSBzbWFsbCB0aW1lb3V0DQogICAgZnVuY3Rpb24gU2V0VGltZW91dCgkYVRpbWVvdXQpIHsNCgkkdGhpcy0+dGltZW91dD0kYVRpbWVvdXQ7CQ0KICAgIH0NCgkNCiAgICAvLyBPdXRwdXQgaW1hZ2UgdG8gYnJvd3NlciBhbmQgYWxzbyB3cml0ZSBpdCB0byB0aGUgY2FjaGUNCiAgICBmdW5jdGlvbiBQdXRBbmRTdHJlYW0oJGFJbWFnZSwkYUNhY2hlRmlsZU5hbWUsJGFJbmxpbmUsJGFTdHJva2VGaWxlTmFtZSkgew0KCS8vIFNvbWUgZGVidWdnaW5nIGNvZGUgdG8gYnJhbmQgdGhlIGltYWdlIHdpdGggbnVtYmUgb2YgY29sb3JzDQoJLy8gdXNlZA0KCUdMT0JBTCAkZ0pwZ0JyYW5kVGltaW5nOw0KDQoJaWYoICRnSnBnQnJhbmRUaW1pbmcgKSB7DQoJICAgIGdsb2JhbCAkdGltOw0KCSAgICAkdD0kdGltLT5Qb3AoKS8xMDAwLjA7DQoJICAgICRjPSRhSW1hZ2UtPlNldENvbG9yKCJibGFjayIpOw0KCSAgICAkdD1zcHJpbnRmKEJSQU5EX1RJTUVfRk9STUFULHJvdW5kKCR0LDMpKTsNCgkgICAgaW1hZ2VzdHJpbmcoJHRoaXMtPmltZy0+aW1nLDIsNSwkdGhpcy0+aW1nLT5oZWlnaHQtMjAsJHQsJGMpOwkJCQ0KCX0NCg0KCS8vIENoZWNrIGlmIHdlIHNob3VsZCBzdHJva2UgdGhlIGltYWdlIHRvIGFuIGFyYml0cmFyeSBmaWxlDQoJaWYoIF9GT1JDRV9JTUdUT0ZJTEUgKSB7DQoJICAgICRhU3Ryb2tlRmlsZU5hbWUgPSBfRk9SQ0VfSU1HRElSLkdlbkltZ05hbWUoKTsNCgl9DQoNCglpZiggJGFTdHJva2VGaWxlTmFtZSE9IiIgKSB7DQoJICAgIGlmKCAkYVN0cm9rZUZpbGVOYW1lID09ICJhdXRvIiApDQoJCSRhU3Ryb2tlRmlsZU5hbWUgPSBHZW5JbWdOYW1lKCk7DQoJICAgIGlmKCBmaWxlX2V4aXN0cygkYVN0cm9rZUZpbGVOYW1lKSApIHsNCgkJLy8gRGVsZXRlIHRoZSBvbGQgZmlsZQ0KCQlpZiggIUB1bmxpbmsoJGFTdHJva2VGaWxlTmFtZSkgKQ0KCQkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTEsJGFTdHJva2VGaWxlTmFtZSk7Ly8oIiBDYW4ndCBkZWxldGUgY2FjaGVkIGltYWdlICRhU3Ryb2tlRmlsZU5hbWUuIFBlcm1pc3Npb24gcHJvYmxlbT8iKTsNCgkgICAgfQ0KCSAgICAkYUltYWdlLT5TdHJlYW0oJGFTdHJva2VGaWxlTmFtZSk7DQoJICAgIHJldHVybjsNCgl9DQoNCglpZiggJGFDYWNoZUZpbGVOYW1lICE9ICIiICYmIFVTRV9DQUNIRSkgew0KDQoJICAgICRhQ2FjaGVGaWxlTmFtZSA9ICR0aGlzLT5jYWNoZV9kaXIgLiAkYUNhY2hlRmlsZU5hbWU7DQoJICAgIGlmKCBmaWxlX2V4aXN0cygkYUNhY2hlRmlsZU5hbWUpICkgew0KCQlpZiggISRhSW5saW5lICkgew0KCQkgICAgLy8gSWYgd2UgYXJlIGdlbmVyYXRpbmcgaW1hZ2Ugb2ZmLWxpbmUgKGp1c3Qgd3JpdGluZyB0byB0aGUgY2FjaGUpDQoJCSAgICAvLyBhbmQgdGhlIGZpbGUgZXhpc3RzIGFuZCBpcyBzdGlsbCB2YWxpZCAobm8gdGltZW91dCkNCgkJICAgIC8vIHRoZW4gZG8gbm90aGluZywganVzdCByZXR1cm4uDQoJCSAgICAkZGlmZj10aW1lKCktZmlsZW10aW1lKCRhQ2FjaGVGaWxlTmFtZSk7DQoJCSAgICBpZiggJGRpZmYgPCAwICkNCgkJCUpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTEyLCRhQ2FjaGVGaWxlTmFtZSk7Ly8oIiBDYWNoZWQgaW1hZ2VmaWxlICgkYUNhY2hlRmlsZU5hbWUpIGhhcyBmaWxlIGRhdGUgaW4gdGhlIGZ1dHVyZSEhIik7DQoJCSAgICBpZiggJHRoaXMtPnRpbWVvdXQ+MCAmJiAoJGRpZmYgPD0gJHRoaXMtPnRpbWVvdXQqNjApICkgDQoJCQlyZXR1cm47CQkNCgkJfQkJCQ0KCQlpZiggIUB1bmxpbmsoJGFDYWNoZUZpbGVOYW1lKSApDQoJCSAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTExMywkYVN0cm9rZUZpbGVOYW1lKTsvLygiIENhbid0IGRlbGV0ZSBjYWNoZWQgaW1hZ2UgJGFTdHJva2VGaWxlTmFtZS4gUGVybWlzc2lvbiBwcm9ibGVtPyIpOw0KCQkkYUltYWdlLT5TdHJlYW0oJGFDYWNoZUZpbGVOYW1lKTsJDQoJICAgIH0NCgkgICAgZWxzZSB7DQoJCSR0aGlzLT5NYWtlRGlycyhkaXJuYW1lKCRhQ2FjaGVGaWxlTmFtZSkpOw0KCQlpZiggIWlzX3dyaXRlYWJsZShkaXJuYW1lKCRhQ2FjaGVGaWxlTmFtZSkpICkgew0KCQkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTQsJGFDYWNoZUZpbGVOYW1lKTsvLygnUEhQIGhhcyBub3QgZW5vdWdoIHBlcm1pc3Npb25zIHRvIHdyaXRlIHRvIHRoZSBjYWNoZSBmaWxlICcuJGFDYWNoZUZpbGVOYW1lLicuIFBsZWFzZSBtYWtlIHN1cmUgdGhhdCB0aGUgdXNlciBydW5uaW5nIFBIUCBoYXMgd3JpdGUgcGVybWlzc2lvbiBmb3IgdGhpcyBmaWxlIGlmIHlvdSB3YW4gdG8gdXNlIHRoZSBjYWNoZSBzeXN0ZW0gd2l0aCBKcEdyYXBoLicpOw0KCQl9DQoJCSRhSW1hZ2UtPlN0cmVhbSgkYUNhY2hlRmlsZU5hbWUpOw0KCSAgICB9DQoJCQkNCgkgICAgJHJlcz10cnVlOw0KCSAgICAvLyBTZXQgZ3JvdXAgdG8gc3BlY2lmaWVkDQoJICAgIGlmKCBDQUNIRV9GSUxFX0dST1VQICE9ICIiICkNCgkJJHJlcyA9IEBjaGdycCgkYUNhY2hlRmlsZU5hbWUsQ0FDSEVfRklMRV9HUk9VUCk7DQoJICAgIGlmKCBDQUNIRV9GSUxFX01PRCAhPSAiIiApDQoJCSRyZXMgPSBAY2htb2QoJGFDYWNoZUZpbGVOYW1lLENBQ0hFX0ZJTEVfTU9EKTsNCgkgICAgaWYoICEkcmVzICkNCgkJSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTUsJGFTdHJva2VGaWxlTmFtZSk7Ly8oIiBDYW4ndCBzZXQgcGVybWlzc2lvbiBmb3IgY2FjaGVkIGltYWdlICRhU3Ryb2tlRmlsZU5hbWUuIFBlcm1pc3Npb24gcHJvYmxlbT8iKTsNCgkJCQ0KCSAgICAkYUltYWdlLT5EZXN0cm95KCk7DQoJICAgIGlmKCAkYUlubGluZSApIHsNCgkJaWYgKCRmaCA9IEBmb3BlbigkYUNhY2hlRmlsZU5hbWUsICJyYiIpICkgew0KCQkgICAgJHRoaXMtPmltZy0+SGVhZGVycygpOw0KCQkgICAgZnBhc3N0aHJ1KCRmaCk7DQoJCSAgICByZXR1cm47DQoJCX0NCgkJZWxzZQ0KCQkgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTYsJGFGaWxlKTsvLygiIENhbnQgb3BlbiBmaWxlIGZyb20gY2FjaGUgWyRhRmlsZV0iKTsgDQoJICAgIH0NCgl9DQoJZWxzZWlmKCAkYUlubGluZSApIHsNCgkgICAgJHRoaXMtPmltZy0+SGVhZGVycygpOwkgCQkNCgkgICAgJGFJbWFnZS0+U3RyZWFtKCk7CQ0KCSAgICByZXR1cm47DQoJfQ0KICAgIH0NCgkNCiAgICAvLyBDaGVjayBpZiBhIGdpdmVuIGltYWdlIGlzIGluIGNhY2hlIGFuZCBpbiB0aGF0IGNhc2UNCiAgICAvLyBwYXNzIGl0IGRpcmVjdGx5IG9uIHRvIHdlYiBicm93c2VyLiBSZXR1cm4gZmFsc2UgaWYgdGhlDQogICAgLy8gaW1hZ2UgZmlsZSBkb2Vzbid0IGV4aXN0IG9yIGV4aXN0cyBidXQgaXMgdG8gb2xkDQogICAgZnVuY3Rpb24gR2V0QW5kU3RyZWFtKCRhQ2FjaGVGaWxlTmFtZSkgew0KCSRhQ2FjaGVGaWxlTmFtZSA9ICR0aGlzLT5jYWNoZV9kaXIuJGFDYWNoZUZpbGVOYW1lOwkJIA0KCWlmICggVVNFX0NBQ0hFICYmIGZpbGVfZXhpc3RzKCRhQ2FjaGVGaWxlTmFtZSkgJiYgJHRoaXMtPnRpbWVvdXQ+PTAgKSB7DQoJICAgICRkaWZmPXRpbWUoKS1maWxlbXRpbWUoJGFDYWNoZUZpbGVOYW1lKTsNCgkgICAgaWYoICR0aGlzLT50aW1lb3V0PjAgJiYgKCRkaWZmID4gJHRoaXMtPnRpbWVvdXQqNjApICkgew0KCQlyZXR1cm4gZmFsc2U7CQkNCgkgICAgfQ0KCSAgICBlbHNlIHsNCgkJaWYgKCRmaCA9IEBmb3BlbigkYUNhY2hlRmlsZU5hbWUsICJyYiIpKSB7DQoJCSAgICAkdGhpcy0+aW1nLT5IZWFkZXJzKCk7DQoJCSAgICBmcGFzc3RocnUoJGZoKTsNCgkJICAgIHJldHVybiB0cnVlOw0KCQl9DQoJCWVsc2UNCgkJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTE3LCRhQ2FjaGVGaWxlTmFtZSk7Ly8oIiBDYW4ndCBvcGVuIGNhY2hlZCBpbWFnZSBcIiRhQ2FjaGVGaWxlTmFtZVwiIGZvciByZWFkaW5nLiIpOw0KCSAgICB9DQoJfSANCglyZXR1cm4gZmFsc2U7DQogICAgfQ0KCQ0KICAgIC8vLS0tLS0tLS0tLS0tLS0tDQogICAgLy8gUFJJVkFURSBNRVRIT0RTCQ0KICAgIC8vIENyZWF0ZSBhbGwgbmVjZXNzYXJ5IGRpcmVjdG9yaWVzIGluIGEgcGF0aA0KICAgIGZ1bmN0aW9uIE1ha2VEaXJzKCRhRmlsZSkgew0KCSRkaXJzID0gYXJyYXkoKTsNCgl3aGlsZSAoICEoZmlsZV9leGlzdHMoJGFGaWxlKSkgKSB7DQoJICAgICRkaXJzW10gPSAkYUZpbGU7DQoJICAgICRhRmlsZSA9IGRpcm5hbWUoJGFGaWxlKTsNCgl9DQoJZm9yICgkaSA9IHNpemVvZigkZGlycyktMTsgJGk+PTA7ICRpLS0pIHsNCgkgICAgaWYoISBAbWtkaXIoJGRpcnNbJGldLDA3NzcpICkNCgkJSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMTgsJGFGaWxlKTsvLygiIENhbid0IGNyZWF0ZSBkaXJlY3RvcnkgJGFGaWxlLiBNYWtlIHN1cmUgUEhQIGhhcyB3cml0ZSBwZXJtaXNzaW9uIHRvIHRoaXMgZGlyZWN0b3J5LiIpOw0KCSAgICAvLyBXZSBhbHNvIHNwZWNpZnkgbW9kZSBoZXJlIGFmdGVyIHdlIGhhdmUgY2hhbmdlZCBncm91cC4gDQoJICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IGlmIEFwYWNoZSB1c2VyIGRvZXNuJ3QgYmVsb25nIHRoZQ0KCSAgICAvLyBkZWZhdWx0IGdyb3VwIGFuZCBoZW5jZSBjYW4ndCBzcGVjaWZ5IGdyb3VwIHBlcm1pc3Npb24NCgkgICAgLy8gaW4gdGhlIHByZXZpb3VzIG1rZGlyKCkgY2FsbA0KCSAgICBpZiggQ0FDSEVfRklMRV9HUk9VUCAhPSAiIiApIHsNCgkJJHJlcz10cnVlOw0KCQkkcmVzID1AY2hncnAoJGRpcnNbJGldLENBQ0hFX0ZJTEVfR1JPVVApOw0KCQkkcmVzID0gQGNobW9kKCRkaXJzWyRpXSwwNzc3KTsNCgkJaWYoICEkcmVzICkNCgkJICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTE5LCRhRmlsZSk7Ly8oIiBDYW4ndCBzZXQgcGVybWlzc2lvbnMgZm9yICRhRmlsZS4gUGVybWlzc2lvbiBwcm9ibGVtcz8iKTsNCgkgICAgfQ0KCX0NCglyZXR1cm4gdHJ1ZTsNCiAgICB9CQ0KfSAvLyBDTEFTUyBDYWNoZQ0KDQoNCj8+DQo=",
    "size": "51935"
}