{
    "namaFile": "js\/jscalendar-1.0\/calendar.js",
    "lastUpdate": "2015-09-12+15:26:35.09",
    "contentFile": "LyogIENvcHlyaWdodCBNaWhhaSBCYXpvbiwgMjAwMi0yMDA1ICB8ICB3d3cuYmF6b24ubmV0L21pc2hvbw0KICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAqDQogKiBUaGUgREhUTUwgQ2FsZW5kYXIsIHZlcnNpb24gMS4wICJJdCBpcyBoYXBwZW5pbmcgYWdhaW4iDQogKg0KICogRGV0YWlscyBhbmQgbGF0ZXN0IHZlcnNpb24gYXQ6DQogKiB3d3cuZHluYXJjaC5jb20vcHJvamVjdHMvY2FsZW5kYXINCiAqDQogKiBUaGlzIHNjcmlwdCBpcyBkZXZlbG9wZWQgYnkgRHluYXJjaC5jb20uICBWaXNpdCB1cyBhdCB3d3cuZHluYXJjaC5jb20uDQogKg0KICogVGhpcyBzY3JpcHQgaXMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZS4NCiAqIFJlYWQgdGhlIGVudGlyZSBsaWNlbnNlIHRleHQgaGVyZTogaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbA0KICovDQoNCi8vICRJZDogY2FsZW5kYXIuanMsdiAxLjUxIDIwMDUvMDMvMDcgMTY6NDQ6MzEgbWlzaG9vIEV4cCAkDQoNCi8qKiBUaGUgQ2FsZW5kYXIgb2JqZWN0IGNvbnN0cnVjdG9yLiAqLw0KQ2FsZW5kYXIgPSBmdW5jdGlvbiAoZmlyc3REYXlPZldlZWssIGRhdGVTdHIsIG9uU2VsZWN0ZWQsIG9uQ2xvc2UpIHsNCgkvLyBtZW1iZXIgdmFyaWFibGVzDQoJdGhpcy5hY3RpdmVEaXYgPSBudWxsOw0KCXRoaXMuY3VycmVudERhdGVFbCA9IG51bGw7DQoJdGhpcy5nZXREYXRlU3RhdHVzID0gbnVsbDsNCgl0aGlzLmdldERhdGVUb29sVGlwID0gbnVsbDsNCgl0aGlzLmdldERhdGVUZXh0ID0gbnVsbDsNCgl0aGlzLnRpbWVvdXQgPSBudWxsOw0KCXRoaXMub25TZWxlY3RlZCA9IG9uU2VsZWN0ZWQgfHwgbnVsbDsNCgl0aGlzLm9uQ2xvc2UgPSBvbkNsb3NlIHx8IG51bGw7DQoJdGhpcy5kcmFnZ2luZyA9IGZhbHNlOw0KCXRoaXMuaGlkZGVuID0gZmFsc2U7DQoJdGhpcy5taW5ZZWFyID0gMTk3MDsNCgl0aGlzLm1heFllYXIgPSAyMDUwOw0KCXRoaXMuZGF0ZUZvcm1hdCA9IENhbGVuZGFyLl9UVFsiREVGX0RBVEVfRk9STUFUIl07DQoJdGhpcy50dERhdGVGb3JtYXQgPSBDYWxlbmRhci5fVFRbIlRUX0RBVEVfRk9STUFUIl07DQoJdGhpcy5pc1BvcHVwID0gdHJ1ZTsNCgl0aGlzLndlZWtOdW1iZXJzID0gdHJ1ZTsNCgl0aGlzLmZpcnN0RGF5T2ZXZWVrID0gdHlwZW9mIGZpcnN0RGF5T2ZXZWVrID09ICJudW1iZXIiID8gZmlyc3REYXlPZldlZWsgOiBDYWxlbmRhci5fRkQ7IC8vIDAgZm9yIFN1bmRheSwgMSBmb3IgTW9uZGF5LCBldGMuDQoJdGhpcy5zaG93c090aGVyTW9udGhzID0gZmFsc2U7DQoJdGhpcy5kYXRlU3RyID0gZGF0ZVN0cjsNCgl0aGlzLmFyX2RheXMgPSBudWxsOw0KCXRoaXMuc2hvd3NUaW1lID0gZmFsc2U7DQoJdGhpcy50aW1lMjQgPSB0cnVlOw0KCXRoaXMueWVhclN0ZXAgPSAyOw0KCXRoaXMuaGlsaXRlVG9kYXkgPSB0cnVlOw0KCXRoaXMubXVsdGlwbGUgPSBudWxsOw0KCS8vIEhUTUwgZWxlbWVudHMNCgl0aGlzLnRhYmxlID0gbnVsbDsNCgl0aGlzLmVsZW1lbnQgPSBudWxsOw0KCXRoaXMudGJvZHkgPSBudWxsOw0KCXRoaXMuZmlyc3RkYXluYW1lID0gbnVsbDsNCgkvLyBDb21ibyBib3hlcw0KCXRoaXMubW9udGhzQ29tYm8gPSBudWxsOw0KCXRoaXMueWVhcnNDb21ibyA9IG51bGw7DQoJdGhpcy5oaWxpdGVkTW9udGggPSBudWxsOw0KCXRoaXMuYWN0aXZlTW9udGggPSBudWxsOw0KCXRoaXMuaGlsaXRlZFllYXIgPSBudWxsOw0KCXRoaXMuYWN0aXZlWWVhciA9IG51bGw7DQoJLy8gSW5mb3JtYXRpb24NCgl0aGlzLmRhdGVDbGlja2VkID0gZmFsc2U7DQoNCgkvLyBvbmUtdGltZSBpbml0aWFsaXphdGlvbnMNCglpZiAodHlwZW9mIENhbGVuZGFyLl9TRE4gPT0gInVuZGVmaW5lZCIpIHsNCgkJLy8gdGFibGUgb2Ygc2hvcnQgZGF5IG5hbWVzDQoJCWlmICh0eXBlb2YgQ2FsZW5kYXIuX1NETl9sZW4gPT0gInVuZGVmaW5lZCIpDQoJCQlDYWxlbmRhci5fU0ROX2xlbiA9IDM7DQoJCXZhciBhciA9IG5ldyBBcnJheSgpOw0KCQlmb3IgKHZhciBpID0gODsgaSA+IDA7KSB7DQoJCQlhclstLWldID0gQ2FsZW5kYXIuX0ROW2ldLnN1YnN0cigwLCBDYWxlbmRhci5fU0ROX2xlbik7DQoJCX0NCgkJQ2FsZW5kYXIuX1NETiA9IGFyOw0KCQkvLyB0YWJsZSBvZiBzaG9ydCBtb250aCBuYW1lcw0KCQlpZiAodHlwZW9mIENhbGVuZGFyLl9TTU5fbGVuID09ICJ1bmRlZmluZWQiKQ0KCQkJQ2FsZW5kYXIuX1NNTl9sZW4gPSAzOw0KCQlhciA9IG5ldyBBcnJheSgpOw0KCQlmb3IgKHZhciBpID0gMTI7IGkgPiAwOykgew0KCQkJYXJbLS1pXSA9IENhbGVuZGFyLl9NTltpXS5zdWJzdHIoMCwgQ2FsZW5kYXIuX1NNTl9sZW4pOw0KCQl9DQoJCUNhbGVuZGFyLl9TTU4gPSBhcjsNCgl9DQp9Ow0KDQovLyAqKiBjb25zdGFudHMNCg0KLy8vICJzdGF0aWMiLCBuZWVkZWQgZm9yIGV2ZW50IGhhbmRsZXJzLg0KQ2FsZW5kYXIuX0MgPSBudWxsOw0KDQovLy8gZGV0ZWN0IGEgc3BlY2lhbCBjYXNlIG9mICJ3ZWIgYnJvd3NlciINCkNhbGVuZGFyLmlzX2llID0gKCAvbXNpZS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYNCgkJICAgIS9vcGVyYS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgKTsNCg0KQ2FsZW5kYXIuaXNfaWU1ID0gKCBDYWxlbmRhci5pc19pZSAmJiAvbXNpZSA1XC4wL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSApOw0KDQovLy8gZGV0ZWN0IE9wZXJhIGJyb3dzZXINCkNhbGVuZGFyLmlzX29wZXJhID0gL29wZXJhL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsNCg0KLy8vIGRldGVjdCBLSFRNTC1iYXNlZCBicm93c2Vycw0KQ2FsZW5kYXIuaXNfa2h0bWwgPSAvS29ucXVlcm9yfFNhZmFyaXxLSFRNTC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7DQoNCi8vIEJFR0lOOiBVVElMSVRZIEZVTkNUSU9OUzsgYmV3YXJlIHRoYXQgdGhlc2UgbWlnaHQgYmUgbW92ZWQgaW50byBhIHNlcGFyYXRlDQovLyAgICAgICAgbGlicmFyeSwgYXQgc29tZSBwb2ludC4NCg0KQ2FsZW5kYXIuZ2V0QWJzb2x1dGVQb3MgPSBmdW5jdGlvbihlbCkgew0KCXZhciBTTCA9IDAsIFNUID0gMDsNCgl2YXIgaXNfZGl2ID0gL15kaXYkL2kudGVzdChlbC50YWdOYW1lKTsNCglpZiAoaXNfZGl2ICYmIGVsLnNjcm9sbExlZnQpDQoJCVNMID0gZWwuc2Nyb2xsTGVmdDsNCglpZiAoaXNfZGl2ICYmIGVsLnNjcm9sbFRvcCkNCgkJU1QgPSBlbC5zY3JvbGxUb3A7DQoJdmFyIHIgPSB7IHg6IGVsLm9mZnNldExlZnQgLSBTTCwgeTogZWwub2Zmc2V0VG9wIC0gU1QgfTsNCglpZiAoZWwub2Zmc2V0UGFyZW50KSB7DQoJCXZhciB0bXAgPSB0aGlzLmdldEFic29sdXRlUG9zKGVsLm9mZnNldFBhcmVudCk7DQoJCXIueCArPSB0bXAueDsNCgkJci55ICs9IHRtcC55Ow0KCX0NCglyZXR1cm4gcjsNCn07DQoNCkNhbGVuZGFyLmlzUmVsYXRlZCA9IGZ1bmN0aW9uIChlbCwgZXZ0KSB7DQoJdmFyIHJlbGF0ZWQgPSBldnQucmVsYXRlZFRhcmdldDsNCglpZiAoIXJlbGF0ZWQpIHsNCgkJdmFyIHR5cGUgPSBldnQudHlwZTsNCgkJaWYgKHR5cGUgPT0gIm1vdXNlb3ZlciIpIHsNCgkJCXJlbGF0ZWQgPSBldnQuZnJvbUVsZW1lbnQ7DQoJCX0gZWxzZSBpZiAodHlwZSA9PSAibW91c2VvdXQiKSB7DQoJCQlyZWxhdGVkID0gZXZ0LnRvRWxlbWVudDsNCgkJfQ0KCX0NCgl3aGlsZSAocmVsYXRlZCkgew0KCQlpZiAocmVsYXRlZCA9PSBlbCkgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgkJcmVsYXRlZCA9IHJlbGF0ZWQucGFyZW50Tm9kZTsNCgl9DQoJcmV0dXJuIGZhbHNlOw0KfTsNCg0KQ2FsZW5kYXIucmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbihlbCwgY2xhc3NOYW1lKSB7DQoJaWYgKCEoZWwgJiYgZWwuY2xhc3NOYW1lKSkgew0KCQlyZXR1cm47DQoJfQ0KCXZhciBjbHMgPSBlbC5jbGFzc05hbWUuc3BsaXQoIiAiKTsNCgl2YXIgYXIgPSBuZXcgQXJyYXkoKTsNCglmb3IgKHZhciBpID0gY2xzLmxlbmd0aDsgaSA+IDA7KSB7DQoJCWlmIChjbHNbLS1pXSAhPSBjbGFzc05hbWUpIHsNCgkJCWFyW2FyLmxlbmd0aF0gPSBjbHNbaV07DQoJCX0NCgl9DQoJZWwuY2xhc3NOYW1lID0gYXIuam9pbigiICIpOw0KfTsNCg0KQ2FsZW5kYXIuYWRkQ2xhc3MgPSBmdW5jdGlvbihlbCwgY2xhc3NOYW1lKSB7DQoJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsIGNsYXNzTmFtZSk7DQoJZWwuY2xhc3NOYW1lICs9ICIgIiArIGNsYXNzTmFtZTsNCn07DQoNCi8vIEZJWE1FOiB0aGUgZm9sbG93aW5nIDIgZnVuY3Rpb25zIHRvdGFsbHkgc3VjaywgYXJlIHVzZWxlc3MgYW5kIHNob3VsZCBiZSByZXBsYWNlZCBpbW1lZGlhdGVseS4NCkNhbGVuZGFyLmdldEVsZW1lbnQgPSBmdW5jdGlvbihldikgew0KCXZhciBmID0gQ2FsZW5kYXIuaXNfaWUgPyB3aW5kb3cuZXZlbnQuc3JjRWxlbWVudCA6IGV2LmN1cnJlbnRUYXJnZXQ7DQoJd2hpbGUgKGYubm9kZVR5cGUgIT0gMSB8fCAvXmRpdiQvaS50ZXN0KGYudGFnTmFtZSkpDQoJCWYgPSBmLnBhcmVudE5vZGU7DQoJcmV0dXJuIGY7DQp9Ow0KDQpDYWxlbmRhci5nZXRUYXJnZXRFbGVtZW50ID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgZiA9IENhbGVuZGFyLmlzX2llID8gd2luZG93LmV2ZW50LnNyY0VsZW1lbnQgOiBldi50YXJnZXQ7DQoJd2hpbGUgKGYubm9kZVR5cGUgIT0gMSkNCgkJZiA9IGYucGFyZW50Tm9kZTsNCglyZXR1cm4gZjsNCn07DQoNCkNhbGVuZGFyLnN0b3BFdmVudCA9IGZ1bmN0aW9uKGV2KSB7DQoJZXYgfHwgKGV2ID0gd2luZG93LmV2ZW50KTsNCglpZiAoQ2FsZW5kYXIuaXNfaWUpIHsNCgkJZXYuY2FuY2VsQnViYmxlID0gdHJ1ZTsNCgkJZXYucmV0dXJuVmFsdWUgPSBmYWxzZTsNCgl9IGVsc2Ugew0KCQlldi5wcmV2ZW50RGVmYXVsdCgpOw0KCQlldi5zdG9wUHJvcGFnYXRpb24oKTsNCgl9DQoJcmV0dXJuIGZhbHNlOw0KfTsNCg0KQ2FsZW5kYXIuYWRkRXZlbnQgPSBmdW5jdGlvbihlbCwgZXZuYW1lLCBmdW5jKSB7DQoJaWYgKGVsLmF0dGFjaEV2ZW50KSB7IC8vIElFDQoJCWVsLmF0dGFjaEV2ZW50KCJvbiIgKyBldm5hbWUsIGZ1bmMpOw0KCX0gZWxzZSBpZiAoZWwuYWRkRXZlbnRMaXN0ZW5lcikgeyAvLyBHZWNrbyAvIFczQw0KCQllbC5hZGRFdmVudExpc3RlbmVyKGV2bmFtZSwgZnVuYywgdHJ1ZSk7DQoJfSBlbHNlIHsNCgkJZWxbIm9uIiArIGV2bmFtZV0gPSBmdW5jOw0KCX0NCn07DQoNCkNhbGVuZGFyLnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oZWwsIGV2bmFtZSwgZnVuYykgew0KCWlmIChlbC5kZXRhY2hFdmVudCkgeyAvLyBJRQ0KCQllbC5kZXRhY2hFdmVudCgib24iICsgZXZuYW1lLCBmdW5jKTsNCgl9IGVsc2UgaWYgKGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsgLy8gR2Vja28gLyBXM0MNCgkJZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihldm5hbWUsIGZ1bmMsIHRydWUpOw0KCX0gZWxzZSB7DQoJCWVsWyJvbiIgKyBldm5hbWVdID0gbnVsbDsNCgl9DQp9Ow0KDQpDYWxlbmRhci5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24odHlwZSwgcGFyZW50KSB7DQoJdmFyIGVsID0gbnVsbDsNCglpZiAoZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKSB7DQoJCS8vIHVzZSB0aGUgWEhUTUwgbmFtZXNwYWNlOyBJRSB3b24ndCBub3JtYWxseSBnZXQgaGVyZSB1bmxlc3MNCgkJLy8gX3RoZXlfICJmaXgiIHRoZSBET00yIGltcGxlbWVudGF0aW9uLg0KCQllbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIsIHR5cGUpOw0KCX0gZWxzZSB7DQoJCWVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTsNCgl9DQoJaWYgKHR5cGVvZiBwYXJlbnQgIT0gInVuZGVmaW5lZCIpIHsNCgkJcGFyZW50LmFwcGVuZENoaWxkKGVsKTsNCgl9DQoJcmV0dXJuIGVsOw0KfTsNCg0KLy8gRU5EOiBVVElMSVRZIEZVTkNUSU9OUw0KDQovLyBCRUdJTjogQ0FMRU5EQVIgU1RBVElDIEZVTkNUSU9OUw0KDQovKiogSW50ZXJuYWwgLS0gYWRkcyBhIHNldCBvZiBldmVudHMgdG8gbWFrZSBzb21lIGVsZW1lbnQgYmVoYXZlIGxpa2UgYSBidXR0b24uICovDQpDYWxlbmRhci5fYWRkX2V2cyA9IGZ1bmN0aW9uKGVsKSB7DQoJd2l0aCAoQ2FsZW5kYXIpIHsNCgkJYWRkRXZlbnQoZWwsICJtb3VzZW92ZXIiLCBkYXlNb3VzZU92ZXIpOw0KCQlhZGRFdmVudChlbCwgIm1vdXNlZG93biIsIGRheU1vdXNlRG93bik7DQoJCWFkZEV2ZW50KGVsLCAibW91c2VvdXQiLCBkYXlNb3VzZU91dCk7DQoJCWlmIChpc19pZSkgew0KCQkJYWRkRXZlbnQoZWwsICJkYmxjbGljayIsIGRheU1vdXNlRGJsQ2xpY2spOw0KCQkJZWwuc2V0QXR0cmlidXRlKCJ1bnNlbGVjdGFibGUiLCB0cnVlKTsNCgkJfQ0KCX0NCn07DQoNCkNhbGVuZGFyLmZpbmRNb250aCA9IGZ1bmN0aW9uKGVsKSB7DQoJaWYgKHR5cGVvZiBlbC5tb250aCAhPSAidW5kZWZpbmVkIikgew0KCQlyZXR1cm4gZWw7DQoJfSBlbHNlIGlmICh0eXBlb2YgZWwucGFyZW50Tm9kZS5tb250aCAhPSAidW5kZWZpbmVkIikgew0KCQlyZXR1cm4gZWwucGFyZW50Tm9kZTsNCgl9DQoJcmV0dXJuIG51bGw7DQp9Ow0KDQpDYWxlbmRhci5maW5kWWVhciA9IGZ1bmN0aW9uKGVsKSB7DQoJaWYgKHR5cGVvZiBlbC55ZWFyICE9ICJ1bmRlZmluZWQiKSB7DQoJCXJldHVybiBlbDsNCgl9IGVsc2UgaWYgKHR5cGVvZiBlbC5wYXJlbnROb2RlLnllYXIgIT0gInVuZGVmaW5lZCIpIHsNCgkJcmV0dXJuIGVsLnBhcmVudE5vZGU7DQoJfQ0KCXJldHVybiBudWxsOw0KfTsNCg0KQ2FsZW5kYXIuc2hvd01vbnRoc0NvbWJvID0gZnVuY3Rpb24gKCkgew0KCXZhciBjYWwgPSBDYWxlbmRhci5fQzsNCglpZiAoIWNhbCkgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCXZhciBjYWwgPSBjYWw7DQoJdmFyIGNkID0gY2FsLmFjdGl2ZURpdjsNCgl2YXIgbWMgPSBjYWwubW9udGhzQ29tYm87DQoJaWYgKGNhbC5oaWxpdGVkTW9udGgpIHsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmhpbGl0ZWRNb250aCwgImhpbGl0ZSIpOw0KCX0NCglpZiAoY2FsLmFjdGl2ZU1vbnRoKSB7DQoJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5hY3RpdmVNb250aCwgImFjdGl2ZSIpOw0KCX0NCgl2YXIgbW9uID0gY2FsLm1vbnRoc0NvbWJvLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJkaXYiKVtjYWwuZGF0ZS5nZXRNb250aCgpXTsNCglDYWxlbmRhci5hZGRDbGFzcyhtb24sICJhY3RpdmUiKTsNCgljYWwuYWN0aXZlTW9udGggPSBtb247DQoJdmFyIHMgPSBtYy5zdHlsZTsNCglzLmRpc3BsYXkgPSAiYmxvY2siOw0KCWlmIChjZC5uYXZ0eXBlIDwgMCkNCgkJcy5sZWZ0ID0gY2Qub2Zmc2V0TGVmdCArICJweCI7DQoJZWxzZSB7DQoJCXZhciBtY3cgPSBtYy5vZmZzZXRXaWR0aDsNCgkJaWYgKHR5cGVvZiBtY3cgPT0gInVuZGVmaW5lZCIpDQoJCQkvLyBLb25xdWVyb3IgYnJhaW4tZGVhZCB0ZWNobmlxdWVzDQoJCQltY3cgPSA1MDsNCgkJcy5sZWZ0ID0gKGNkLm9mZnNldExlZnQgKyBjZC5vZmZzZXRXaWR0aCAtIG1jdykgKyAicHgiOw0KCX0NCglzLnRvcCA9IChjZC5vZmZzZXRUb3AgKyBjZC5vZmZzZXRIZWlnaHQpICsgInB4IjsNCn07DQoNCkNhbGVuZGFyLnNob3dZZWFyc0NvbWJvID0gZnVuY3Rpb24gKGZ3ZCkgew0KCXZhciBjYWwgPSBDYWxlbmRhci5fQzsNCglpZiAoIWNhbCkgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCXZhciBjYWwgPSBjYWw7DQoJdmFyIGNkID0gY2FsLmFjdGl2ZURpdjsNCgl2YXIgeWMgPSBjYWwueWVhcnNDb21ibzsNCglpZiAoY2FsLmhpbGl0ZWRZZWFyKSB7DQoJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5oaWxpdGVkWWVhciwgImhpbGl0ZSIpOw0KCX0NCglpZiAoY2FsLmFjdGl2ZVllYXIpIHsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmFjdGl2ZVllYXIsICJhY3RpdmUiKTsNCgl9DQoJY2FsLmFjdGl2ZVllYXIgPSBudWxsOw0KCXZhciBZID0gY2FsLmRhdGUuZ2V0RnVsbFllYXIoKSArIChmd2QgPyAxIDogLTEpOw0KCXZhciB5ciA9IHljLmZpcnN0Q2hpbGQ7DQoJdmFyIHNob3cgPSBmYWxzZTsNCglmb3IgKHZhciBpID0gMTI7IGkgPiAwOyAtLWkpIHsNCgkJaWYgKFkgPj0gY2FsLm1pblllYXIgJiYgWSA8PSBjYWwubWF4WWVhcikgew0KCQkJeXIuaW5uZXJIVE1MID0gWTsNCgkJCXlyLnllYXIgPSBZOw0KCQkJeXIuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQlzaG93ID0gdHJ1ZTsNCgkJfSBlbHNlIHsNCgkJCXlyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCX0NCgkJeXIgPSB5ci5uZXh0U2libGluZzsNCgkJWSArPSBmd2QgPyBjYWwueWVhclN0ZXAgOiAtY2FsLnllYXJTdGVwOw0KCX0NCglpZiAoc2hvdykgew0KCQl2YXIgcyA9IHljLnN0eWxlOw0KCQlzLmRpc3BsYXkgPSAiYmxvY2siOw0KCQlpZiAoY2QubmF2dHlwZSA8IDApDQoJCQlzLmxlZnQgPSBjZC5vZmZzZXRMZWZ0ICsgInB4IjsNCgkJZWxzZSB7DQoJCQl2YXIgeWN3ID0geWMub2Zmc2V0V2lkdGg7DQoJCQlpZiAodHlwZW9mIHljdyA9PSAidW5kZWZpbmVkIikNCgkJCQkvLyBLb25xdWVyb3IgYnJhaW4tZGVhZCB0ZWNobmlxdWVzDQoJCQkJeWN3ID0gNTA7DQoJCQlzLmxlZnQgPSAoY2Qub2Zmc2V0TGVmdCArIGNkLm9mZnNldFdpZHRoIC0geWN3KSArICJweCI7DQoJCX0NCgkJcy50b3AgPSAoY2Qub2Zmc2V0VG9wICsgY2Qub2Zmc2V0SGVpZ2h0KSArICJweCI7DQoJfQ0KfTsNCg0KLy8gZXZlbnQgaGFuZGxlcnMNCg0KQ2FsZW5kYXIudGFibGVNb3VzZVVwID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgY2FsID0gQ2FsZW5kYXIuX0M7DQoJaWYgKCFjYWwpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCglpZiAoY2FsLnRpbWVvdXQpIHsNCgkJY2xlYXJUaW1lb3V0KGNhbC50aW1lb3V0KTsNCgl9DQoJdmFyIGVsID0gY2FsLmFjdGl2ZURpdjsNCglpZiAoIWVsKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJdmFyIHRhcmdldCA9IENhbGVuZGFyLmdldFRhcmdldEVsZW1lbnQoZXYpOw0KCWV2IHx8IChldiA9IHdpbmRvdy5ldmVudCk7DQoJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsICJhY3RpdmUiKTsNCglpZiAodGFyZ2V0ID09IGVsIHx8IHRhcmdldC5wYXJlbnROb2RlID09IGVsKSB7DQoJCUNhbGVuZGFyLmNlbGxDbGljayhlbCwgZXYpOw0KCX0NCgl2YXIgbW9uID0gQ2FsZW5kYXIuZmluZE1vbnRoKHRhcmdldCk7DQoJdmFyIGRhdGUgPSBudWxsOw0KCWlmIChtb24pIHsNCgkJZGF0ZSA9IG5ldyBEYXRlKGNhbC5kYXRlKTsNCgkJaWYgKG1vbi5tb250aCAhPSBkYXRlLmdldE1vbnRoKCkpIHsNCgkJCWRhdGUuc2V0TW9udGgobW9uLm1vbnRoKTsNCgkJCWNhbC5zZXREYXRlKGRhdGUpOw0KCQkJY2FsLmRhdGVDbGlja2VkID0gZmFsc2U7DQoJCQljYWwuY2FsbEhhbmRsZXIoKTsNCgkJfQ0KCX0gZWxzZSB7DQoJCXZhciB5ZWFyID0gQ2FsZW5kYXIuZmluZFllYXIodGFyZ2V0KTsNCgkJaWYgKHllYXIpIHsNCgkJCWRhdGUgPSBuZXcgRGF0ZShjYWwuZGF0ZSk7DQoJCQlpZiAoeWVhci55ZWFyICE9IGRhdGUuZ2V0RnVsbFllYXIoKSkgew0KCQkJCWRhdGUuc2V0RnVsbFllYXIoeWVhci55ZWFyKTsNCgkJCQljYWwuc2V0RGF0ZShkYXRlKTsNCgkJCQljYWwuZGF0ZUNsaWNrZWQgPSBmYWxzZTsNCgkJCQljYWwuY2FsbEhhbmRsZXIoKTsNCgkJCX0NCgkJfQ0KCX0NCgl3aXRoIChDYWxlbmRhcikgew0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNldXAiLCB0YWJsZU1vdXNlVXApOw0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNlb3ZlciIsIHRhYmxlTW91c2VPdmVyKTsNCgkJcmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJtb3VzZW1vdmUiLCB0YWJsZU1vdXNlT3Zlcik7DQoJCWNhbC5faGlkZUNvbWJvcygpOw0KCQlfQyA9IG51bGw7DQoJCXJldHVybiBzdG9wRXZlbnQoZXYpOw0KCX0NCn07DQoNCkNhbGVuZGFyLnRhYmxlTW91c2VPdmVyID0gZnVuY3Rpb24gKGV2KSB7DQoJdmFyIGNhbCA9IENhbGVuZGFyLl9DOw0KCWlmICghY2FsKSB7DQoJCXJldHVybjsNCgl9DQoJdmFyIGVsID0gY2FsLmFjdGl2ZURpdjsNCgl2YXIgdGFyZ2V0ID0gQ2FsZW5kYXIuZ2V0VGFyZ2V0RWxlbWVudChldik7DQoJaWYgKHRhcmdldCA9PSBlbCB8fCB0YXJnZXQucGFyZW50Tm9kZSA9PSBlbCkgew0KCQlDYWxlbmRhci5hZGRDbGFzcyhlbCwgImhpbGl0ZSBhY3RpdmUiKTsNCgkJQ2FsZW5kYXIuYWRkQ2xhc3MoZWwucGFyZW50Tm9kZSwgInJvd2hpbGl0ZSIpOw0KCX0gZWxzZSB7DQoJCWlmICh0eXBlb2YgZWwubmF2dHlwZSA9PSAidW5kZWZpbmVkIiB8fCAoZWwubmF2dHlwZSAhPSA1MCAmJiAoZWwubmF2dHlwZSA9PSAwIHx8IE1hdGguYWJzKGVsLm5hdnR5cGUpID4gMikpKQ0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsICJhY3RpdmUiKTsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsICJoaWxpdGUiKTsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwucGFyZW50Tm9kZSwgInJvd2hpbGl0ZSIpOw0KCX0NCglldiB8fCAoZXYgPSB3aW5kb3cuZXZlbnQpOw0KCWlmIChlbC5uYXZ0eXBlID09IDUwICYmIHRhcmdldCAhPSBlbCkgew0KCQl2YXIgcG9zID0gQ2FsZW5kYXIuZ2V0QWJzb2x1dGVQb3MoZWwpOw0KCQl2YXIgdyA9IGVsLm9mZnNldFdpZHRoOw0KCQl2YXIgeCA9IGV2LmNsaWVudFg7DQoJCXZhciBkeDsNCgkJdmFyIGRlY3JlYXNlID0gdHJ1ZTsNCgkJaWYgKHggPiBwb3MueCArIHcpIHsNCgkJCWR4ID0geCAtIHBvcy54IC0gdzsNCgkJCWRlY3JlYXNlID0gZmFsc2U7DQoJCX0gZWxzZQ0KCQkJZHggPSBwb3MueCAtIHg7DQoNCgkJaWYgKGR4IDwgMCkgZHggPSAwOw0KCQl2YXIgcmFuZ2UgPSBlbC5fcmFuZ2U7DQoJCXZhciBjdXJyZW50ID0gZWwuX2N1cnJlbnQ7DQoJCXZhciBjb3VudCA9IE1hdGguZmxvb3IoZHggLyAxMCkgJSByYW5nZS5sZW5ndGg7DQoJCWZvciAodmFyIGkgPSByYW5nZS5sZW5ndGg7IC0taSA+PSAwOykNCgkJCWlmIChyYW5nZVtpXSA9PSBjdXJyZW50KQ0KCQkJCWJyZWFrOw0KCQl3aGlsZSAoY291bnQtLSA+IDApDQoJCQlpZiAoZGVjcmVhc2UpIHsNCgkJCQlpZiAoLS1pIDwgMCkNCgkJCQkJaSA9IHJhbmdlLmxlbmd0aCAtIDE7DQoJCQl9IGVsc2UgaWYgKCArK2kgPj0gcmFuZ2UubGVuZ3RoICkNCgkJCQlpID0gMDsNCgkJdmFyIG5ld3ZhbCA9IHJhbmdlW2ldOw0KCQllbC5pbm5lckhUTUwgPSBuZXd2YWw7DQoNCgkJY2FsLm9uVXBkYXRlVGltZSgpOw0KCX0NCgl2YXIgbW9uID0gQ2FsZW5kYXIuZmluZE1vbnRoKHRhcmdldCk7DQoJaWYgKG1vbikgew0KCQlpZiAobW9uLm1vbnRoICE9IGNhbC5kYXRlLmdldE1vbnRoKCkpIHsNCgkJCWlmIChjYWwuaGlsaXRlZE1vbnRoKSB7DQoJCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmhpbGl0ZWRNb250aCwgImhpbGl0ZSIpOw0KCQkJfQ0KCQkJQ2FsZW5kYXIuYWRkQ2xhc3MobW9uLCAiaGlsaXRlIik7DQoJCQljYWwuaGlsaXRlZE1vbnRoID0gbW9uOw0KCQl9IGVsc2UgaWYgKGNhbC5oaWxpdGVkTW9udGgpIHsNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5oaWxpdGVkTW9udGgsICJoaWxpdGUiKTsNCgkJfQ0KCX0gZWxzZSB7DQoJCWlmIChjYWwuaGlsaXRlZE1vbnRoKSB7DQoJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZE1vbnRoLCAiaGlsaXRlIik7DQoJCX0NCgkJdmFyIHllYXIgPSBDYWxlbmRhci5maW5kWWVhcih0YXJnZXQpOw0KCQlpZiAoeWVhcikgew0KCQkJaWYgKHllYXIueWVhciAhPSBjYWwuZGF0ZS5nZXRGdWxsWWVhcigpKSB7DQoJCQkJaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZFllYXIsICJoaWxpdGUiKTsNCgkJCQl9DQoJCQkJQ2FsZW5kYXIuYWRkQ2xhc3MoeWVhciwgImhpbGl0ZSIpOw0KCQkJCWNhbC5oaWxpdGVkWWVhciA9IHllYXI7DQoJCQl9IGVsc2UgaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5oaWxpdGVkWWVhciwgImhpbGl0ZSIpOw0KCQkJfQ0KCQl9IGVsc2UgaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmhpbGl0ZWRZZWFyLCAiaGlsaXRlIik7DQoJCX0NCgl9DQoJcmV0dXJuIENhbGVuZGFyLnN0b3BFdmVudChldik7DQp9Ow0KDQpDYWxlbmRhci50YWJsZU1vdXNlRG93biA9IGZ1bmN0aW9uIChldikgew0KCWlmIChDYWxlbmRhci5nZXRUYXJnZXRFbGVtZW50KGV2KSA9PSBDYWxlbmRhci5nZXRFbGVtZW50KGV2KSkgew0KCQlyZXR1cm4gQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCgl9DQp9Ow0KDQpDYWxlbmRhci5jYWxEcmFnSXQgPSBmdW5jdGlvbiAoZXYpIHsNCgl2YXIgY2FsID0gQ2FsZW5kYXIuX0M7DQoJaWYgKCEoY2FsICYmIGNhbC5kcmFnZ2luZykpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgcG9zWDsNCgl2YXIgcG9zWTsNCglpZiAoQ2FsZW5kYXIuaXNfaWUpIHsNCgkJcG9zWSA9IHdpbmRvdy5ldmVudC5jbGllbnRZICsgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7DQoJCXBvc1ggPSB3aW5kb3cuZXZlbnQuY2xpZW50WCArIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDsNCgl9IGVsc2Ugew0KCQlwb3NYID0gZXYucGFnZVg7DQoJCXBvc1kgPSBldi5wYWdlWTsNCgl9DQoJY2FsLmhpZGVTaG93Q292ZXJlZCgpOw0KCXZhciBzdCA9IGNhbC5lbGVtZW50LnN0eWxlOw0KCXN0LmxlZnQgPSAocG9zWCAtIGNhbC54T2ZmcykgKyAicHgiOw0KCXN0LnRvcCA9IChwb3NZIC0gY2FsLnlPZmZzKSArICJweCI7DQoJcmV0dXJuIENhbGVuZGFyLnN0b3BFdmVudChldik7DQp9Ow0KDQpDYWxlbmRhci5jYWxEcmFnRW5kID0gZnVuY3Rpb24gKGV2KSB7DQoJdmFyIGNhbCA9IENhbGVuZGFyLl9DOw0KCWlmICghY2FsKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJY2FsLmRyYWdnaW5nID0gZmFsc2U7DQoJd2l0aCAoQ2FsZW5kYXIpIHsNCgkJcmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJtb3VzZW1vdmUiLCBjYWxEcmFnSXQpOw0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNldXAiLCBjYWxEcmFnRW5kKTsNCgkJdGFibGVNb3VzZVVwKGV2KTsNCgl9DQoJY2FsLmhpZGVTaG93Q292ZXJlZCgpOw0KfTsNCg0KQ2FsZW5kYXIuZGF5TW91c2VEb3duID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgZWwgPSBDYWxlbmRhci5nZXRFbGVtZW50KGV2KTsNCglpZiAoZWwuZGlzYWJsZWQpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgY2FsID0gZWwuY2FsZW5kYXI7DQoJY2FsLmFjdGl2ZURpdiA9IGVsOw0KCUNhbGVuZGFyLl9DID0gY2FsOw0KCWlmIChlbC5uYXZ0eXBlICE9IDMwMCkgd2l0aCAoQ2FsZW5kYXIpIHsNCgkJaWYgKGVsLm5hdnR5cGUgPT0gNTApIHsNCgkJCWVsLl9jdXJyZW50ID0gZWwuaW5uZXJIVE1MOw0KCQkJYWRkRXZlbnQoZG9jdW1lbnQsICJtb3VzZW1vdmUiLCB0YWJsZU1vdXNlT3Zlcik7DQoJCX0gZWxzZQ0KCQkJYWRkRXZlbnQoZG9jdW1lbnQsIENhbGVuZGFyLmlzX2llNSA\/ICJtb3VzZW1vdmUiIDogIm1vdXNlb3ZlciIsIHRhYmxlTW91c2VPdmVyKTsNCgkJYWRkQ2xhc3MoZWwsICJoaWxpdGUgYWN0aXZlIik7DQoJCWFkZEV2ZW50KGRvY3VtZW50LCAibW91c2V1cCIsIHRhYmxlTW91c2VVcCk7DQoJfSBlbHNlIGlmIChjYWwuaXNQb3B1cCkgew0KCQljYWwuX2RyYWdTdGFydChldik7DQoJfQ0KCWlmIChlbC5uYXZ0eXBlID09IC0xIHx8IGVsLm5hdnR5cGUgPT0gMSkgew0KCQlpZiAoY2FsLnRpbWVvdXQpIGNsZWFyVGltZW91dChjYWwudGltZW91dCk7DQoJCWNhbC50aW1lb3V0ID0gc2V0VGltZW91dCgiQ2FsZW5kYXIuc2hvd01vbnRoc0NvbWJvKCkiLCAyNTApOw0KCX0gZWxzZSBpZiAoZWwubmF2dHlwZSA9PSAtMiB8fCBlbC5uYXZ0eXBlID09IDIpIHsNCgkJaWYgKGNhbC50aW1lb3V0KSBjbGVhclRpbWVvdXQoY2FsLnRpbWVvdXQpOw0KCQljYWwudGltZW91dCA9IHNldFRpbWVvdXQoKGVsLm5hdnR5cGUgPiAwKSA\/ICJDYWxlbmRhci5zaG93WWVhcnNDb21ibyh0cnVlKSIgOiAiQ2FsZW5kYXIuc2hvd1llYXJzQ29tYm8oZmFsc2UpIiwgMjUwKTsNCgl9IGVsc2Ugew0KCQljYWwudGltZW91dCA9IG51bGw7DQoJfQ0KCXJldHVybiBDYWxlbmRhci5zdG9wRXZlbnQoZXYpOw0KfTsNCg0KQ2FsZW5kYXIuZGF5TW91c2VEYmxDbGljayA9IGZ1bmN0aW9uKGV2KSB7DQoJQ2FsZW5kYXIuY2VsbENsaWNrKENhbGVuZGFyLmdldEVsZW1lbnQoZXYpLCBldiB8fCB3aW5kb3cuZXZlbnQpOw0KCWlmIChDYWxlbmRhci5pc19pZSkgew0KCQlkb2N1bWVudC5zZWxlY3Rpb24uZW1wdHkoKTsNCgl9DQp9Ow0KDQpDYWxlbmRhci5kYXlNb3VzZU92ZXIgPSBmdW5jdGlvbihldikgew0KCXZhciBlbCA9IENhbGVuZGFyLmdldEVsZW1lbnQoZXYpOw0KCWlmIChDYWxlbmRhci5pc1JlbGF0ZWQoZWwsIGV2KSB8fCBDYWxlbmRhci5fQyB8fCBlbC5kaXNhYmxlZCkgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCWlmIChlbC50dGlwKSB7DQoJCWlmIChlbC50dGlwLnN1YnN0cigwLCAxKSA9PSAiXyIpIHsNCgkJCWVsLnR0aXAgPSBlbC5jYWxkYXRlLnByaW50KGVsLmNhbGVuZGFyLnR0RGF0ZUZvcm1hdCkgKyBlbC50dGlwLnN1YnN0cigxKTsNCgkJfQ0KCQllbC5jYWxlbmRhci50b29sdGlwcy5pbm5lckhUTUwgPSBlbC50dGlwOw0KCX0NCglpZiAoZWwubmF2dHlwZSAhPSAzMDApIHsNCgkJQ2FsZW5kYXIuYWRkQ2xhc3MoZWwsICJoaWxpdGUiKTsNCgkJaWYgKGVsLmNhbGRhdGUpIHsNCgkJCUNhbGVuZGFyLmFkZENsYXNzKGVsLnBhcmVudE5vZGUsICJyb3doaWxpdGUiKTsNCgkJfQ0KCX0NCglyZXR1cm4gQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCn07DQoNCkNhbGVuZGFyLmRheU1vdXNlT3V0ID0gZnVuY3Rpb24oZXYpIHsNCgl3aXRoIChDYWxlbmRhcikgew0KCQl2YXIgZWwgPSBnZXRFbGVtZW50KGV2KTsNCgkJaWYgKGlzUmVsYXRlZChlbCwgZXYpIHx8IF9DIHx8IGVsLmRpc2FibGVkKQ0KCQkJcmV0dXJuIGZhbHNlOw0KCQlyZW1vdmVDbGFzcyhlbCwgImhpbGl0ZSIpOw0KCQlpZiAoZWwuY2FsZGF0ZSkNCgkJCXJlbW92ZUNsYXNzKGVsLnBhcmVudE5vZGUsICJyb3doaWxpdGUiKTsNCgkJaWYgKGVsLmNhbGVuZGFyKQ0KCQkJZWwuY2FsZW5kYXIudG9vbHRpcHMuaW5uZXJIVE1MID0gX1RUWyJTRUxfREFURSJdOw0KCQlyZXR1cm4gc3RvcEV2ZW50KGV2KTsNCgl9DQp9Ow0KDQovKioNCiAqICBBIGdlbmVyaWMgImNsaWNrIiBoYW5kbGVyIDopIGhhbmRsZXMgYWxsIHR5cGVzIG9mIGJ1dHRvbnMgZGVmaW5lZCBpbiB0aGlzDQogKiAgY2FsZW5kYXIuDQogKi8NCkNhbGVuZGFyLmNlbGxDbGljayA9IGZ1bmN0aW9uKGVsLCBldikgew0KCXZhciBjYWwgPSBlbC5jYWxlbmRhcjsNCgl2YXIgY2xvc2luZyA9IGZhbHNlOw0KCXZhciBuZXdkYXRlID0gZmFsc2U7DQoJdmFyIGRhdGUgPSBudWxsOw0KCWlmICh0eXBlb2YgZWwubmF2dHlwZSA9PSAidW5kZWZpbmVkIikgew0KCQlpZiAoY2FsLmN1cnJlbnREYXRlRWwpIHsNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5jdXJyZW50RGF0ZUVsLCAic2VsZWN0ZWQiKTsNCgkJCUNhbGVuZGFyLmFkZENsYXNzKGVsLCAic2VsZWN0ZWQiKTsNCgkJCWNsb3NpbmcgPSAoY2FsLmN1cnJlbnREYXRlRWwgPT0gZWwpOw0KCQkJaWYgKCFjbG9zaW5nKSB7DQoJCQkJY2FsLmN1cnJlbnREYXRlRWwgPSBlbDsNCgkJCX0NCgkJfQ0KCQljYWwuZGF0ZS5zZXREYXRlT25seShlbC5jYWxkYXRlKTsNCgkJZGF0ZSA9IGNhbC5kYXRlOw0KCQl2YXIgb3RoZXJfbW9udGggPSAhKGNhbC5kYXRlQ2xpY2tlZCA9ICFlbC5vdGhlck1vbnRoKTsNCgkJaWYgKCFvdGhlcl9tb250aCAmJiAhY2FsLmN1cnJlbnREYXRlRWwpDQoJCQljYWwuX3RvZ2dsZU11bHRpcGxlRGF0ZShuZXcgRGF0ZShkYXRlKSk7DQoJCWVsc2UNCgkJCW5ld2RhdGUgPSAhZWwuZGlzYWJsZWQ7DQoJCS8vIGEgZGF0ZSB3YXMgY2xpY2tlZA0KCQlpZiAob3RoZXJfbW9udGgpDQoJCQljYWwuX2luaXQoY2FsLmZpcnN0RGF5T2ZXZWVrLCBkYXRlKTsNCgl9IGVsc2Ugew0KCQlpZiAoZWwubmF2dHlwZSA9PSAyMDApIHsNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGVsLCAiaGlsaXRlIik7DQoJCQljYWwuY2FsbENsb3NlSGFuZGxlcigpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCWRhdGUgPSBuZXcgRGF0ZShjYWwuZGF0ZSk7DQoJCWlmIChlbC5uYXZ0eXBlID09IDApDQoJCQlkYXRlLnNldERhdGVPbmx5KG5ldyBEYXRlKCkpOyAvLyBUT0RBWQ0KCQkvLyB1bmxlc3MgInRvZGF5IiB3YXMgY2xpY2tlZCwgd2UgYXNzdW1lIG5vIGRhdGUgd2FzIGNsaWNrZWQgc28NCgkJLy8gdGhlIHNlbGVjdGVkIGhhbmRsZXIgd2lsbCBrbm93IG5vdCB0byBjbG9zZSB0aGUgY2FsZW5hciB3aGVuDQoJCS8vIGluIHNpbmdsZS1jbGljayBtb2RlLg0KCQkvLyBjYWwuZGF0ZUNsaWNrZWQgPSAoZWwubmF2dHlwZSA9PSAwKTsNCgkJY2FsLmRhdGVDbGlja2VkID0gZmFsc2U7DQoJCXZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOw0KCQl2YXIgbW9uID0gZGF0ZS5nZXRNb250aCgpOw0KCQlmdW5jdGlvbiBzZXRNb250aChtKSB7DQoJCQl2YXIgZGF5ID0gZGF0ZS5nZXREYXRlKCk7DQoJCQl2YXIgbWF4ID0gZGF0ZS5nZXRNb250aERheXMobSk7DQoJCQlpZiAoZGF5ID4gbWF4KSB7DQoJCQkJZGF0ZS5zZXREYXRlKG1heCk7DQoJCQl9DQoJCQlkYXRlLnNldE1vbnRoKG0pOw0KCQl9Ow0KCQlzd2l0Y2ggKGVsLm5hdnR5cGUpIHsNCgkJICAgIGNhc2UgNDAwOg0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsICJoaWxpdGUiKTsNCgkJCXZhciB0ZXh0ID0gQ2FsZW5kYXIuX1RUWyJBQk9VVCJdOw0KCQkJaWYgKHR5cGVvZiB0ZXh0ICE9ICJ1bmRlZmluZWQiKSB7DQoJCQkJdGV4dCArPSBjYWwuc2hvd3NUaW1lID8gQ2FsZW5kYXIuX1RUWyJBQk9VVF9USU1FIl0gOiAiIjsNCgkJCX0gZWxzZSB7DQoJCQkJLy8gRklYTUU6IHRoaXMgc2hvdWxkIGJlIHJlbW92ZWQgYXMgc29vbiBhcyBsYW5nIGZpbGVzIGdldCB1cGRhdGVkIQ0KCQkJCXRleHQgPSAiSGVscCBhbmQgYWJvdXQgYm94IHRleHQgaXMgbm90IHRyYW5zbGF0ZWQgaW50byB0aGlzIGxhbmd1YWdlLlxuIiArDQoJCQkJCSJJZiB5b3Uga25vdyB0aGlzIGxhbmd1YWdlIGFuZCB5b3UgZmVlbCBnZW5lcm91cyBwbGVhc2UgdXBkYXRlXG4iICsNCgkJCQkJInRoZSBjb3JyZXNwb25kaW5nIGZpbGUgaW4gXCJsYW5nXCIgc3ViZGlyIHRvIG1hdGNoIGNhbGVuZGFyLWVuLmpzXG4iICsNCgkJCQkJImFuZCBzZW5kIGl0IGJhY2sgdG8gPG1paGFpX2Jhem9uQHlhaG9vLmNvbT4gdG8gZ2V0IGl0IGludG8gdGhlIGRpc3RyaWJ1dGlvbiAgOy0pXG5cbiIgKw0KCQkJCQkiVGhhbmsgeW91IVxuIiArDQoJCQkJCSJodHRwOi8vZHluYXJjaC5jb20vbWlzaG9vL2NhbGVuZGFyLmVwbFxuIjsNCgkJCX0NCgkJCWFsZXJ0KHRleHQpOw0KCQkJcmV0dXJuOw0KCQkgICAgY2FzZSAtMjoNCgkJCWlmICh5ZWFyID4gY2FsLm1pblllYXIpIHsNCgkJCQlkYXRlLnNldEZ1bGxZZWFyKHllYXIgLSAxKTsNCgkJCX0NCgkJCWJyZWFrOw0KCQkgICAgY2FzZSAtMToNCgkJCWlmIChtb24gPiAwKSB7DQoJCQkJc2V0TW9udGgobW9uIC0gMSk7DQoJCQl9IGVsc2UgaWYgKHllYXItLSA+IGNhbC5taW5ZZWFyKSB7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyKTsNCgkJCQlzZXRNb250aCgxMSk7DQoJCQl9DQoJCQlicmVhazsNCgkJICAgIGNhc2UgMToNCgkJCWlmIChtb24gPCAxMSkgew0KCQkJCXNldE1vbnRoKG1vbiArIDEpOw0KCQkJfSBlbHNlIGlmICh5ZWFyIDwgY2FsLm1heFllYXIpIHsNCgkJCQlkYXRlLnNldEZ1bGxZZWFyKHllYXIgKyAxKTsNCgkJCQlzZXRNb250aCgwKTsNCgkJCX0NCgkJCWJyZWFrOw0KCQkgICAgY2FzZSAyOg0KCQkJaWYgKHllYXIgPCBjYWwubWF4WWVhcikgew0KCQkJCWRhdGUuc2V0RnVsbFllYXIoeWVhciArIDEpOw0KCQkJfQ0KCQkJYnJlYWs7DQoJCSAgICBjYXNlIDEwMDoNCgkJCWNhbC5zZXRGaXJzdERheU9mV2VlayhlbC5mZG93KTsNCgkJCXJldHVybjsNCgkJICAgIGNhc2UgNTA6DQoJCQl2YXIgcmFuZ2UgPSBlbC5fcmFuZ2U7DQoJCQl2YXIgY3VycmVudCA9IGVsLmlubmVySFRNTDsNCgkJCWZvciAodmFyIGkgPSByYW5nZS5sZW5ndGg7IC0taSA+PSAwOykNCgkJCQlpZiAocmFuZ2VbaV0gPT0gY3VycmVudCkNCgkJCQkJYnJlYWs7DQoJCQlpZiAoZXYgJiYgZXYuc2hpZnRLZXkpIHsNCgkJCQlpZiAoLS1pIDwgMCkNCgkJCQkJaSA9IHJhbmdlLmxlbmd0aCAtIDE7DQoJCQl9IGVsc2UgaWYgKCArK2kgPj0gcmFuZ2UubGVuZ3RoICkNCgkJCQlpID0gMDsNCgkJCXZhciBuZXd2YWwgPSByYW5nZVtpXTsNCgkJCWVsLmlubmVySFRNTCA9IG5ld3ZhbDsNCgkJCWNhbC5vblVwZGF0ZVRpbWUoKTsNCgkJCXJldHVybjsNCgkJICAgIGNhc2UgMDoNCgkJCS8vIFRPREFZIHdpbGwgYnJpbmcgdXMgaGVyZQ0KCQkJaWYgKCh0eXBlb2YgY2FsLmdldERhdGVTdGF0dXMgPT0gImZ1bmN0aW9uIikgJiYNCgkJCSAgICBjYWwuZ2V0RGF0ZVN0YXR1cyhkYXRlLCBkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSwgZGF0ZS5nZXREYXRlKCkpKSB7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQkJYnJlYWs7DQoJCX0NCgkJaWYgKCFkYXRlLmVxdWFsc1RvKGNhbC5kYXRlKSkgew0KCQkJY2FsLnNldERhdGUoZGF0ZSk7DQoJCQluZXdkYXRlID0gdHJ1ZTsNCgkJfSBlbHNlIGlmIChlbC5uYXZ0eXBlID09IDApDQoJCQluZXdkYXRlID0gY2xvc2luZyA9IHRydWU7DQoJfQ0KCWlmIChuZXdkYXRlKSB7DQoJCWV2ICYmIGNhbC5jYWxsSGFuZGxlcigpOw0KCX0NCglpZiAoY2xvc2luZykgew0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgImhpbGl0ZSIpOw0KCQlldiAmJiBjYWwuY2FsbENsb3NlSGFuZGxlcigpOw0KCX0NCn07DQoNCi8vIEVORDogQ0FMRU5EQVIgU1RBVElDIEZVTkNUSU9OUw0KDQovLyBCRUdJTjogQ0FMRU5EQVIgT0JKRUNUIEZVTkNUSU9OUw0KDQovKioNCiAqICBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgdGhlIGNhbGVuZGFyIGluc2lkZSB0aGUgZ2l2ZW4gcGFyZW50LiAgSWYgX3BhciBpcw0KICogIG51bGwgdGhhbiBpdCBjcmVhdGVzIGEgcG9wdXAgY2FsZW5kYXIgaW5zaWRlIHRoZSBCT0RZIGVsZW1lbnQuICBJZiBfcGFyIGlzDQogKiAgYW4gZWxlbWVudCwgYmUgaXQgQk9EWSwgdGhlbiBpdCBjcmVhdGVzIGEgbm9uLXBvcHVwIGNhbGVuZGFyIChzdGlsbA0KICogIGhpZGRlbikuICBTb21lIHByb3BlcnRpZXMgbmVlZCB0byBiZSBzZXQgYmVmb3JlIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi4NCiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChfcGFyKSB7DQoJdmFyIHBhcmVudCA9IG51bGw7DQoJaWYgKCEgX3Bhcikgew0KCQkvLyBkZWZhdWx0IHBhcmVudCBpcyB0aGUgZG9jdW1lbnQgYm9keSwgaW4gd2hpY2ggY2FzZSB3ZSBjcmVhdGUNCgkJLy8gYSBwb3B1cCBjYWxlbmRhci4NCgkJcGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsNCgkJdGhpcy5pc1BvcHVwID0gdHJ1ZTsNCgl9IGVsc2Ugew0KCQlwYXJlbnQgPSBfcGFyOw0KCQl0aGlzLmlzUG9wdXAgPSBmYWxzZTsNCgl9DQoJdGhpcy5kYXRlID0gdGhpcy5kYXRlU3RyID8gbmV3IERhdGUodGhpcy5kYXRlU3RyKSA6IG5ldyBEYXRlKCk7DQoNCgl2YXIgdGFibGUgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpOw0KCXRoaXMudGFibGUgPSB0YWJsZTsNCgl0YWJsZS5jZWxsU3BhY2luZyA9IDA7DQoJdGFibGUuY2VsbFBhZGRpbmcgPSAwOw0KCXRhYmxlLmNhbGVuZGFyID0gdGhpczsNCglDYWxlbmRhci5hZGRFdmVudCh0YWJsZSwgIm1vdXNlZG93biIsIENhbGVuZGFyLnRhYmxlTW91c2VEb3duKTsNCg0KCXZhciBkaXYgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgl0aGlzLmVsZW1lbnQgPSBkaXY7DQoJZGl2LmNsYXNzTmFtZSA9ICJjYWxlbmRhciI7DQoJaWYgKHRoaXMuaXNQb3B1cCkgew0KCQlkaXYuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KCQlkaXYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgl9DQoJZGl2LmFwcGVuZENoaWxkKHRhYmxlKTsNCg0KCXZhciB0aGVhZCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRoZWFkIiwgdGFibGUpOw0KCXZhciBjZWxsID0gbnVsbDsNCgl2YXIgcm93ID0gbnVsbDsNCg0KCXZhciBjYWwgPSB0aGlzOw0KCXZhciBoaCA9IGZ1bmN0aW9uICh0ZXh0LCBjcywgbmF2dHlwZSkgew0KCQljZWxsID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidGQiLCByb3cpOw0KCQljZWxsLmNvbFNwYW4gPSBjczsNCgkJY2VsbC5jbGFzc05hbWUgPSAiYnV0dG9uIjsNCgkJaWYgKG5hdnR5cGUgIT0gMCAmJiBNYXRoLmFicyhuYXZ0eXBlKSA8PSAyKQ0KCQkJY2VsbC5jbGFzc05hbWUgKz0gIiBuYXYiOw0KCQlDYWxlbmRhci5fYWRkX2V2cyhjZWxsKTsNCgkJY2VsbC5jYWxlbmRhciA9IGNhbDsNCgkJY2VsbC5uYXZ0eXBlID0gbmF2dHlwZTsNCgkJY2VsbC5pbm5lckhUTUwgPSAiPGRpdiB1bnNlbGVjdGFibGU9J29uJz4iICsgdGV4dCArICI8L2Rpdj4iOw0KCQlyZXR1cm4gY2VsbDsNCgl9Ow0KDQoJcm93ID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidHIiLCB0aGVhZCk7DQoJdmFyIHRpdGxlX2xlbmd0aCA9IDY7DQoJKHRoaXMuaXNQb3B1cCkgJiYgLS10aXRsZV9sZW5ndGg7DQoJKHRoaXMud2Vla051bWJlcnMpICYmICsrdGl0bGVfbGVuZ3RoOw0KDQoJaGgoIj8iLCAxLCA0MDApLnR0aXAgPSBDYWxlbmRhci5fVFRbIklORk8iXTsNCgl0aGlzLnRpdGxlID0gaGgoIiIsIHRpdGxlX2xlbmd0aCwgMzAwKTsNCgl0aGlzLnRpdGxlLmNsYXNzTmFtZSA9ICJ0aXRsZSI7DQoJaWYgKHRoaXMuaXNQb3B1cCkgew0KCQl0aGlzLnRpdGxlLnR0aXAgPSBDYWxlbmRhci5fVFRbIkRSQUdfVE9fTU9WRSJdOw0KCQl0aGlzLnRpdGxlLnN0eWxlLmN1cnNvciA9ICJtb3ZlIjsNCgkJaGgoIiYjeDAwZDc7IiwgMSwgMjAwKS50dGlwID0gQ2FsZW5kYXIuX1RUWyJDTE9TRSJdOw0KCX0NCg0KCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGhlYWQpOw0KCXJvdy5jbGFzc05hbWUgPSAiaGVhZHJvdyI7DQoNCgl0aGlzLl9uYXZfcHkgPSBoaCgiJiN4MDBhYjsiLCAxLCAtMik7DQoJdGhpcy5fbmF2X3B5LnR0aXAgPSBDYWxlbmRhci5fVFRbIlBSRVZfWUVBUiJdOw0KDQoJdGhpcy5fbmF2X3BtID0gaGgoIiYjeDIwMzk7IiwgMSwgLTEpOw0KCXRoaXMuX25hdl9wbS50dGlwID0gQ2FsZW5kYXIuX1RUWyJQUkVWX01PTlRIIl07DQoNCgl0aGlzLl9uYXZfbm93ID0gaGgoQ2FsZW5kYXIuX1RUWyJUT0RBWSJdLCB0aGlzLndlZWtOdW1iZXJzID8gNCA6IDMsIDApOw0KCXRoaXMuX25hdl9ub3cudHRpcCA9IENhbGVuZGFyLl9UVFsiR09fVE9EQVkiXTsNCg0KCXRoaXMuX25hdl9ubSA9IGhoKCImI3gyMDNhOyIsIDEsIDEpOw0KCXRoaXMuX25hdl9ubS50dGlwID0gQ2FsZW5kYXIuX1RUWyJORVhUX01PTlRIIl07DQoNCgl0aGlzLl9uYXZfbnkgPSBoaCgiJiN4MDBiYjsiLCAxLCAyKTsNCgl0aGlzLl9uYXZfbnkudHRpcCA9IENhbGVuZGFyLl9UVFsiTkVYVF9ZRUFSIl07DQoNCgkvLyBkYXkgbmFtZXMNCglyb3cgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ciIsIHRoZWFkKTsNCglyb3cuY2xhc3NOYW1lID0gImRheW5hbWVzIjsNCglpZiAodGhpcy53ZWVrTnVtYmVycykgew0KCQljZWxsID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidGQiLCByb3cpOw0KCQljZWxsLmNsYXNzTmFtZSA9ICJuYW1lIHduIjsNCgkJY2VsbC5pbm5lckhUTUwgPSBDYWxlbmRhci5fVFRbIldLIl07DQoJfQ0KCWZvciAodmFyIGkgPSA3OyBpID4gMDsgLS1pKSB7DQoJCWNlbGwgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ZCIsIHJvdyk7DQoJCWlmICghaSkgew0KCQkJY2VsbC5uYXZ0eXBlID0gMTAwOw0KCQkJY2VsbC5jYWxlbmRhciA9IHRoaXM7DQoJCQlDYWxlbmRhci5fYWRkX2V2cyhjZWxsKTsNCgkJfQ0KCX0NCgl0aGlzLmZpcnN0ZGF5bmFtZSA9ICh0aGlzLndlZWtOdW1iZXJzKSA\/IHJvdy5maXJzdENoaWxkLm5leHRTaWJsaW5nIDogcm93LmZpcnN0Q2hpbGQ7DQoJdGhpcy5fZGlzcGxheVdlZWtkYXlzKCk7DQoNCgl2YXIgdGJvZHkgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0Ym9keSIsIHRhYmxlKTsNCgl0aGlzLnRib2R5ID0gdGJvZHk7DQoNCglmb3IgKGkgPSA2OyBpID4gMDsgLS1pKSB7DQoJCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGJvZHkpOw0KCQlpZiAodGhpcy53ZWVrTnVtYmVycykgew0KCQkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJfQ0KCQlmb3IgKHZhciBqID0gNzsgaiA+IDA7IC0taikgew0KCQkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJCWNlbGwuY2FsZW5kYXIgPSB0aGlzOw0KCQkJQ2FsZW5kYXIuX2FkZF9ldnMoY2VsbCk7DQoJCX0NCgl9DQoNCglpZiAodGhpcy5zaG93c1RpbWUpIHsNCgkJcm93ID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidHIiLCB0Ym9keSk7DQoJCXJvdy5jbGFzc05hbWUgPSAidGltZSI7DQoNCgkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJY2VsbC5jbGFzc05hbWUgPSAidGltZSI7DQoJCWNlbGwuY29sU3BhbiA9IDI7DQoJCWNlbGwuaW5uZXJIVE1MID0gQ2FsZW5kYXIuX1RUWyJUSU1FIl0gfHwgIiZuYnNwOyI7DQoNCgkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJY2VsbC5jbGFzc05hbWUgPSAidGltZSI7DQoJCWNlbGwuY29sU3BhbiA9IHRoaXMud2Vla051bWJlcnMgPyA0IDogMzsNCg0KCQkoZnVuY3Rpb24oKXsNCgkJCWZ1bmN0aW9uIG1ha2VUaW1lUGFydChjbGFzc05hbWUsIGluaXQsIHJhbmdlX3N0YXJ0LCByYW5nZV9lbmQpIHsNCgkJCQl2YXIgcGFydCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBjZWxsKTsNCgkJCQlwYXJ0LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsNCgkJCQlwYXJ0LmlubmVySFRNTCA9IGluaXQ7DQoJCQkJcGFydC5jYWxlbmRhciA9IGNhbDsNCgkJCQlwYXJ0LnR0aXAgPSBDYWxlbmRhci5fVFRbIlRJTUVfUEFSVCJdOw0KCQkJCXBhcnQubmF2dHlwZSA9IDUwOw0KCQkJCXBhcnQuX3JhbmdlID0gW107DQoJCQkJaWYgKHR5cGVvZiByYW5nZV9zdGFydCAhPSAibnVtYmVyIikNCgkJCQkJcGFydC5fcmFuZ2UgPSByYW5nZV9zdGFydDsNCgkJCQllbHNlIHsNCgkJCQkJZm9yICh2YXIgaSA9IHJhbmdlX3N0YXJ0OyBpIDw9IHJhbmdlX2VuZDsgKytpKSB7DQoJCQkJCQl2YXIgdHh0Ow0KCQkJCQkJaWYgKGkgPCAxMCAmJiByYW5nZV9lbmQgPj0gMTApIHR4dCA9ICcwJyArIGk7DQoJCQkJCQllbHNlIHR4dCA9ICcnICsgaTsNCgkJCQkJCXBhcnQuX3JhbmdlW3BhcnQuX3JhbmdlLmxlbmd0aF0gPSB0eHQ7DQoJCQkJCX0NCgkJCQl9DQoJCQkJQ2FsZW5kYXIuX2FkZF9ldnMocGFydCk7DQoJCQkJcmV0dXJuIHBhcnQ7DQoJCQl9Ow0KCQkJdmFyIGhycyA9IGNhbC5kYXRlLmdldEhvdXJzKCk7DQoJCQl2YXIgbWlucyA9IGNhbC5kYXRlLmdldE1pbnV0ZXMoKTsNCgkJCXZhciB0MTIgPSAhY2FsLnRpbWUyNDsNCgkJCXZhciBwbSA9IChocnMgPiAxMik7DQoJCQlpZiAodDEyICYmIHBtKSBocnMgLT0gMTI7DQoJCQl2YXIgSCA9IG1ha2VUaW1lUGFydCgiaG91ciIsIGhycywgdDEyID8gMSA6IDAsIHQxMiA\/IDEyIDogMjMpOw0KCQkJdmFyIHNwYW4gPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJzcGFuIiwgY2VsbCk7DQoJCQlzcGFuLmlubmVySFRNTCA9ICI6IjsNCgkJCXNwYW4uY2xhc3NOYW1lID0gImNvbG9uIjsNCgkJCXZhciBNID0gbWFrZVRpbWVQYXJ0KCJtaW51dGUiLCBtaW5zLCAwLCA1OSk7DQoJCQl2YXIgQVAgPSBudWxsOw0KCQkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJCWNlbGwuY2xhc3NOYW1lID0gInRpbWUiOw0KCQkJY2VsbC5jb2xTcGFuID0gMjsNCgkJCWlmICh0MTIpDQoJCQkJQVAgPSBtYWtlVGltZVBhcnQoImFtcG0iLCBwbSA\/ICJwbSIgOiAiYW0iLCBbImFtIiwgInBtIl0pOw0KCQkJZWxzZQ0KCQkJCWNlbGwuaW5uZXJIVE1MID0gIiZuYnNwOyI7DQoNCgkJCWNhbC5vblNldFRpbWUgPSBmdW5jdGlvbigpIHsNCgkJCQl2YXIgcG0sIGhycyA9IHRoaXMuZGF0ZS5nZXRIb3VycygpLA0KCQkJCQltaW5zID0gdGhpcy5kYXRlLmdldE1pbnV0ZXMoKTsNCgkJCQlpZiAodDEyKSB7DQoJCQkJCXBtID0gKGhycyA+PSAxMik7DQoJCQkJCWlmIChwbSkgaHJzIC09IDEyOw0KCQkJCQlpZiAoaHJzID09IDApIGhycyA9IDEyOw0KCQkJCQlBUC5pbm5lckhUTUwgPSBwbSA\/ICJwbSIgOiAiYW0iOw0KCQkJCX0NCgkJCQlILmlubmVySFRNTCA9IChocnMgPCAxMCkgPyAoIjAiICsgaHJzKSA6IGhyczsNCgkJCQlNLmlubmVySFRNTCA9IChtaW5zIDwgMTApID8gKCIwIiArIG1pbnMpIDogbWluczsNCgkJCX07DQoNCgkJCWNhbC5vblVwZGF0ZVRpbWUgPSBmdW5jdGlvbigpIHsNCgkJCQl2YXIgZGF0ZSA9IHRoaXMuZGF0ZTsNCgkJCQl2YXIgaCA9IHBhcnNlSW50KEguaW5uZXJIVE1MLCAxMCk7DQoJCQkJaWYgKHQxMikgew0KCQkJCQlpZiAoL3BtL2kudGVzdChBUC5pbm5lckhUTUwpICYmIGggPCAxMikNCgkJCQkJCWggKz0gMTI7DQoJCQkJCWVsc2UgaWYgKC9hbS9pLnRlc3QoQVAuaW5uZXJIVE1MKSAmJiBoID09IDEyKQ0KCQkJCQkJaCA9IDA7DQoJCQkJfQ0KCQkJCXZhciBkID0gZGF0ZS5nZXREYXRlKCk7DQoJCQkJdmFyIG0gPSBkYXRlLmdldE1vbnRoKCk7DQoJCQkJdmFyIHkgPSBkYXRlLmdldEZ1bGxZZWFyKCk7DQoJCQkJZGF0ZS5zZXRIb3VycyhoKTsNCgkJCQlkYXRlLnNldE1pbnV0ZXMocGFyc2VJbnQoTS5pbm5lckhUTUwsIDEwKSk7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5KTsNCgkJCQlkYXRlLnNldE1vbnRoKG0pOw0KCQkJCWRhdGUuc2V0RGF0ZShkKTsNCgkJCQl0aGlzLmRhdGVDbGlja2VkID0gZmFsc2U7DQoJCQkJdGhpcy5jYWxsSGFuZGxlcigpOw0KCQkJfTsNCgkJfSkoKTsNCgl9IGVsc2Ugew0KCQl0aGlzLm9uU2V0VGltZSA9IHRoaXMub25VcGRhdGVUaW1lID0gZnVuY3Rpb24oKSB7fTsNCgl9DQoNCgl2YXIgdGZvb3QgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0Zm9vdCIsIHRhYmxlKTsNCg0KCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGZvb3QpOw0KCXJvdy5jbGFzc05hbWUgPSAiZm9vdHJvdyI7DQoNCgljZWxsID0gaGgoQ2FsZW5kYXIuX1RUWyJTRUxfREFURSJdLCB0aGlzLndlZWtOdW1iZXJzID8gOCA6IDcsIDMwMCk7DQoJY2VsbC5jbGFzc05hbWUgPSAidHRpcCI7DQoJaWYgKHRoaXMuaXNQb3B1cCkgew0KCQljZWxsLnR0aXAgPSBDYWxlbmRhci5fVFRbIkRSQUdfVE9fTU9WRSJdOw0KCQljZWxsLnN0eWxlLmN1cnNvciA9ICJtb3ZlIjsNCgl9DQoJdGhpcy50b29sdGlwcyA9IGNlbGw7DQoNCglkaXYgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiLCB0aGlzLmVsZW1lbnQpOw0KCXRoaXMubW9udGhzQ29tYm8gPSBkaXY7DQoJZGl2LmNsYXNzTmFtZSA9ICJjb21ibyI7DQoJZm9yIChpID0gMDsgaSA8IENhbGVuZGFyLl9NTi5sZW5ndGg7ICsraSkgew0KCQl2YXIgbW4gPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJbW4uY2xhc3NOYW1lID0gQ2FsZW5kYXIuaXNfaWUgPyAibGFiZWwtSUVmaXgiIDogImxhYmVsIjsNCgkJbW4ubW9udGggPSBpOw0KCQltbi5pbm5lckhUTUwgPSBDYWxlbmRhci5fU01OW2ldOw0KCQlkaXYuYXBwZW5kQ2hpbGQobW4pOw0KCX0NCg0KCWRpdiA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoImRpdiIsIHRoaXMuZWxlbWVudCk7DQoJdGhpcy55ZWFyc0NvbWJvID0gZGl2Ow0KCWRpdi5jbGFzc05hbWUgPSAiY29tYm8iOw0KCWZvciAoaSA9IDEyOyBpID4gMDsgLS1pKSB7DQoJCXZhciB5ciA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQl5ci5jbGFzc05hbWUgPSBDYWxlbmRhci5pc19pZSA\/ICJsYWJlbC1JRWZpeCIgOiAibGFiZWwiOw0KCQlkaXYuYXBwZW5kQ2hpbGQoeXIpOw0KCX0NCg0KCXRoaXMuX2luaXQodGhpcy5maXJzdERheU9mV2VlaywgdGhpcy5kYXRlKTsNCglwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTsNCn07DQoNCi8qKiBrZXlib2FyZCBuYXZpZ2F0aW9uLCBvbmx5IGZvciBwb3B1cCBjYWxlbmRhcnMgKi8NCkNhbGVuZGFyLl9rZXlFdmVudCA9IGZ1bmN0aW9uKGV2KSB7DQoJdmFyIGNhbCA9IHdpbmRvdy5fZHluYXJjaF9wb3B1cENhbGVuZGFyOw0KCWlmICghY2FsIHx8IGNhbC5tdWx0aXBsZSkNCgkJcmV0dXJuIGZhbHNlOw0KCShDYWxlbmRhci5pc19pZSkgJiYgKGV2ID0gd2luZG93LmV2ZW50KTsNCgl2YXIgYWN0ID0gKENhbGVuZGFyLmlzX2llIHx8IGV2LnR5cGUgPT0gImtleXByZXNzIiksDQoJCUsgPSBldi5rZXlDb2RlOw0KCWlmIChldi5jdHJsS2V5KSB7DQoJCXN3aXRjaCAoSykgew0KCQkgICAgY2FzZSAzNzogLy8gS0VZIGxlZnQNCgkJCWFjdCAmJiBDYWxlbmRhci5jZWxsQ2xpY2soY2FsLl9uYXZfcG0pOw0KCQkJYnJlYWs7DQoJCSAgICBjYXNlIDM4OiAvLyBLRVkgdXANCgkJCWFjdCAmJiBDYWxlbmRhci5jZWxsQ2xpY2soY2FsLl9uYXZfcHkpOw0KCQkJYnJlYWs7DQoJCSAgICBjYXNlIDM5OiAvLyBLRVkgcmlnaHQNCgkJCWFjdCAmJiBDYWxlbmRhci5jZWxsQ2xpY2soY2FsLl9uYXZfbm0pOw0KCQkJYnJlYWs7DQoJCSAgICBjYXNlIDQwOiAvLyBLRVkgZG93bg0KCQkJYWN0ICYmIENhbGVuZGFyLmNlbGxDbGljayhjYWwuX25hdl9ueSk7DQoJCQlicmVhazsNCgkJICAgIGRlZmF1bHQ6DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCgl9IGVsc2Ugc3dpdGNoIChLKSB7DQoJICAgIGNhc2UgMzI6IC8vIEtFWSBzcGFjZSAobm93KQ0KCQlDYWxlbmRhci5jZWxsQ2xpY2soY2FsLl9uYXZfbm93KTsNCgkJYnJlYWs7DQoJICAgIGNhc2UgMjc6IC8vIEtFWSBlc2MNCgkJYWN0ICYmIGNhbC5jYWxsQ2xvc2VIYW5kbGVyKCk7DQoJCWJyZWFrOw0KCSAgICBjYXNlIDM3OiAvLyBLRVkgbGVmdA0KCSAgICBjYXNlIDM4OiAvLyBLRVkgdXANCgkgICAgY2FzZSAzOTogLy8gS0VZIHJpZ2h0DQoJICAgIGNhc2UgNDA6IC8vIEtFWSBkb3duDQoJCWlmIChhY3QpIHsNCgkJCXZhciBwcmV2LCB4LCB5LCBuZSwgZWwsIHN0ZXA7DQoJCQlwcmV2ID0gSyA9PSAzNyB8fCBLID09IDM4Ow0KCQkJc3RlcCA9IChLID09IDM3IHx8IEsgPT0gMzkpID8gMSA6IDc7DQoJCQlmdW5jdGlvbiBzZXRWYXJzKCkgew0KCQkJCWVsID0gY2FsLmN1cnJlbnREYXRlRWw7DQoJCQkJdmFyIHAgPSBlbC5wb3M7DQoJCQkJeCA9IHAgJiAxNTsNCgkJCQl5ID0gcCA+PiA0Ow0KCQkJCW5lID0gY2FsLmFyX2RheXNbeV1beF07DQoJCQl9O3NldFZhcnMoKTsNCgkJCWZ1bmN0aW9uIHByZXZNb250aCgpIHsNCgkJCQl2YXIgZGF0ZSA9IG5ldyBEYXRlKGNhbC5kYXRlKTsNCgkJCQlkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSBzdGVwKTsNCgkJCQljYWwuc2V0RGF0ZShkYXRlKTsNCgkJCX07DQoJCQlmdW5jdGlvbiBuZXh0TW9udGgoKSB7DQoJCQkJdmFyIGRhdGUgPSBuZXcgRGF0ZShjYWwuZGF0ZSk7DQoJCQkJZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgc3RlcCk7DQoJCQkJY2FsLnNldERhdGUoZGF0ZSk7DQoJCQl9Ow0KCQkJd2hpbGUgKDEpIHsNCgkJCQlzd2l0Y2ggKEspIHsNCgkJCQkgICAgY2FzZSAzNzogLy8gS0VZIGxlZnQNCgkJCQkJaWYgKC0teCA+PSAwKQ0KCQkJCQkJbmUgPSBjYWwuYXJfZGF5c1t5XVt4XTsNCgkJCQkJZWxzZSB7DQoJCQkJCQl4ID0gNjsNCgkJCQkJCUsgPSAzODsNCgkJCQkJCWNvbnRpbnVlOw0KCQkJCQl9DQoJCQkJCWJyZWFrOw0KCQkJCSAgICBjYXNlIDM4OiAvLyBLRVkgdXANCgkJCQkJaWYgKC0teSA+PSAwKQ0KCQkJCQkJbmUgPSBjYWwuYXJfZGF5c1t5XVt4XTsNCgkJCQkJZWxzZSB7DQoJCQkJCQlwcmV2TW9udGgoKTsNCgkJCQkJCXNldFZhcnMoKTsNCgkJCQkJfQ0KCQkJCQlicmVhazsNCgkJCQkgICAgY2FzZSAzOTogLy8gS0VZIHJpZ2h0DQoJCQkJCWlmICgrK3ggPCA3KQ0KCQkJCQkJbmUgPSBjYWwuYXJfZGF5c1t5XVt4XTsNCgkJCQkJZWxzZSB7DQoJCQkJCQl4ID0gMDsNCgkJCQkJCUsgPSA0MDsNCgkJCQkJCWNvbnRpbnVlOw0KCQkJCQl9DQoJCQkJCWJyZWFrOw0KCQkJCSAgICBjYXNlIDQwOiAvLyBLRVkgZG93bg0KCQkJCQlpZiAoKyt5IDwgY2FsLmFyX2RheXMubGVuZ3RoKQ0KCQkJCQkJbmUgPSBjYWwuYXJfZGF5c1t5XVt4XTsNCgkJCQkJZWxzZSB7DQoJCQkJCQluZXh0TW9udGgoKTsNCgkJCQkJCXNldFZhcnMoKTsNCgkJCQkJfQ0KCQkJCQlicmVhazsNCgkJCQl9DQoJCQkJYnJlYWs7DQoJCQl9DQoJCQlpZiAobmUpIHsNCgkJCQlpZiAoIW5lLmRpc2FibGVkKQ0KCQkJCQlDYWxlbmRhci5jZWxsQ2xpY2sobmUpOw0KCQkJCWVsc2UgaWYgKHByZXYpDQoJCQkJCXByZXZNb250aCgpOw0KCQkJCWVsc2UNCgkJCQkJbmV4dE1vbnRoKCk7DQoJCQl9DQoJCX0NCgkJYnJlYWs7DQoJICAgIGNhc2UgMTM6IC8vIEtFWSBlbnRlcg0KCQlpZiAoYWN0KQ0KCQkJQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5jdXJyZW50RGF0ZUVsLCBldik7DQoJCWJyZWFrOw0KCSAgICBkZWZhdWx0Og0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCXJldHVybiBDYWxlbmRhci5zdG9wRXZlbnQoZXYpOw0KfTsNCg0KLyoqDQogKiAgKFJFKUluaXRpYWxpemVzIHRoZSBjYWxlbmRhciB0byB0aGUgZ2l2ZW4gZGF0ZSBhbmQgZmlyc3REYXlPZldlZWsNCiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24gKGZpcnN0RGF5T2ZXZWVrLCBkYXRlKSB7DQoJdmFyIHRvZGF5ID0gbmV3IERhdGUoKSwNCgkJVFkgPSB0b2RheS5nZXRGdWxsWWVhcigpLA0KCQlUTSA9IHRvZGF5LmdldE1vbnRoKCksDQoJCVREID0gdG9kYXkuZ2V0RGF0ZSgpOw0KCXRoaXMudGFibGUuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOw0KCXZhciB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOw0KCWlmICh5ZWFyIDwgdGhpcy5taW5ZZWFyKSB7DQoJCXllYXIgPSB0aGlzLm1pblllYXI7DQoJCWRhdGUuc2V0RnVsbFllYXIoeWVhcik7DQoJfSBlbHNlIGlmICh5ZWFyID4gdGhpcy5tYXhZZWFyKSB7DQoJCXllYXIgPSB0aGlzLm1heFllYXI7DQoJCWRhdGUuc2V0RnVsbFllYXIoeWVhcik7DQoJfQ0KCXRoaXMuZmlyc3REYXlPZldlZWsgPSBmaXJzdERheU9mV2VlazsNCgl0aGlzLmRhdGUgPSBuZXcgRGF0ZShkYXRlKTsNCgl2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7DQoJdmFyIG1kYXkgPSBkYXRlLmdldERhdGUoKTsNCgl2YXIgbm9fZGF5cyA9IGRhdGUuZ2V0TW9udGhEYXlzKCk7DQoNCgkvLyBjYWxlbmRhciB2b29kb28gZm9yIGNvbXB1dGluZyB0aGUgZmlyc3QgZGF5IHRoYXQgd291bGQgYWN0dWFsbHkgYmUNCgkvLyBkaXNwbGF5ZWQgaW4gdGhlIGNhbGVuZGFyLCBldmVuIGlmIGl0J3MgZnJvbSB0aGUgcHJldmlvdXMgbW9udGguDQoJLy8gV0FSTklORzogdGhpcyBpcyBtYWdpYy4gOy0pDQoJZGF0ZS5zZXREYXRlKDEpOw0KCXZhciBkYXkxID0gKGRhdGUuZ2V0RGF5KCkgLSB0aGlzLmZpcnN0RGF5T2ZXZWVrKSAlIDc7DQoJaWYgKGRheTEgPCAwKQ0KCQlkYXkxICs9IDc7DQoJZGF0ZS5zZXREYXRlKC1kYXkxKTsNCglkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyAxKTsNCg0KCXZhciByb3cgPSB0aGlzLnRib2R5LmZpcnN0Q2hpbGQ7DQoJdmFyIE1OID0gQ2FsZW5kYXIuX1NNTlttb250aF07DQoJdmFyIGFyX2RheXMgPSB0aGlzLmFyX2RheXMgPSBuZXcgQXJyYXkoKTsNCgl2YXIgd2Vla2VuZCA9IENhbGVuZGFyLl9UVFsiV0VFS0VORCJdOw0KCXZhciBkYXRlcyA9IHRoaXMubXVsdGlwbGUgPyAodGhpcy5kYXRlc0NlbGxzID0ge30pIDogbnVsbDsNCglmb3IgKHZhciBpID0gMDsgaSA8IDY7ICsraSwgcm93ID0gcm93Lm5leHRTaWJsaW5nKSB7DQoJCXZhciBjZWxsID0gcm93LmZpcnN0Q2hpbGQ7DQoJCWlmICh0aGlzLndlZWtOdW1iZXJzKSB7DQoJCQljZWxsLmNsYXNzTmFtZSA9ICJkYXkgd24iOw0KCQkJY2VsbC5pbm5lckhUTUwgPSBkYXRlLmdldFdlZWtOdW1iZXIoKTsNCgkJCWNlbGwgPSBjZWxsLm5leHRTaWJsaW5nOw0KCQl9DQoJCXJvdy5jbGFzc05hbWUgPSAiZGF5c3JvdyI7DQoJCXZhciBoYXNkYXlzID0gZmFsc2UsIGlkYXksIGRwb3MgPSBhcl9kYXlzW2ldID0gW107DQoJCWZvciAodmFyIGogPSAwOyBqIDwgNzsgKytqLCBjZWxsID0gY2VsbC5uZXh0U2libGluZywgZGF0ZS5zZXREYXRlKGlkYXkgKyAxKSkgew0KCQkJaWRheSA9IGRhdGUuZ2V0RGF0ZSgpOw0KCQkJdmFyIHdkYXkgPSBkYXRlLmdldERheSgpOw0KCQkJY2VsbC5jbGFzc05hbWUgPSAiZGF5IjsNCgkJCWNlbGwucG9zID0gaSA8PCA0IHwgajsNCgkJCWRwb3Nbal0gPSBjZWxsOw0KCQkJdmFyIGN1cnJlbnRfbW9udGggPSAoZGF0ZS5nZXRNb250aCgpID09IG1vbnRoKTsNCgkJCWlmICghY3VycmVudF9tb250aCkgew0KCQkJCWlmICh0aGlzLnNob3dzT3RoZXJNb250aHMpIHsNCgkJCQkJY2VsbC5jbGFzc05hbWUgKz0gIiBvdGhlcm1vbnRoIjsNCgkJCQkJY2VsbC5vdGhlck1vbnRoID0gdHJ1ZTsNCgkJCQl9IGVsc2Ugew0KCQkJCQljZWxsLmNsYXNzTmFtZSA9ICJlbXB0eWNlbGwiOw0KCQkJCQljZWxsLmlubmVySFRNTCA9ICImbmJzcDsiOw0KCQkJCQljZWxsLmRpc2FibGVkID0gdHJ1ZTsNCgkJCQkJY29udGludWU7DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQljZWxsLm90aGVyTW9udGggPSBmYWxzZTsNCgkJCQloYXNkYXlzID0gdHJ1ZTsNCgkJCX0NCgkJCWNlbGwuZGlzYWJsZWQgPSBmYWxzZTsNCgkJCWNlbGwuaW5uZXJIVE1MID0gdGhpcy5nZXREYXRlVGV4dCA\/IHRoaXMuZ2V0RGF0ZVRleHQoZGF0ZSwgaWRheSkgOiBpZGF5Ow0KCQkJaWYgKGRhdGVzKQ0KCQkJCWRhdGVzW2RhdGUucHJpbnQoIiVZJW0lZCIpXSA9IGNlbGw7DQoJCQlpZiAodGhpcy5nZXREYXRlU3RhdHVzKSB7DQoJCQkJdmFyIHN0YXR1cyA9IHRoaXMuZ2V0RGF0ZVN0YXR1cyhkYXRlLCB5ZWFyLCBtb250aCwgaWRheSk7DQoJCQkJaWYgKHRoaXMuZ2V0RGF0ZVRvb2xUaXApIHsNCgkJCQkJdmFyIHRvb2xUaXAgPSB0aGlzLmdldERhdGVUb29sVGlwKGRhdGUsIHllYXIsIG1vbnRoLCBpZGF5KTsNCgkJCQkJaWYgKHRvb2xUaXApDQoJCQkJCQljZWxsLnRpdGxlID0gdG9vbFRpcDsNCgkJCQl9DQoJCQkJaWYgKHN0YXR1cyA9PT0gdHJ1ZSkgew0KCQkJCQljZWxsLmNsYXNzTmFtZSArPSAiIGRpc2FibGVkIjsNCgkJCQkJY2VsbC5kaXNhYmxlZCA9IHRydWU7DQoJCQkJfSBlbHNlIHsNCgkJCQkJaWYgKC9kaXNhYmxlZC9pLnRlc3Qoc3RhdHVzKSkNCgkJCQkJCWNlbGwuZGlzYWJsZWQgPSB0cnVlOw0KCQkJCQljZWxsLmNsYXNzTmFtZSArPSAiICIgKyBzdGF0dXM7DQoJCQkJfQ0KCQkJfQ0KCQkJaWYgKCFjZWxsLmRpc2FibGVkKSB7DQoJCQkJY2VsbC5jYWxkYXRlID0gbmV3IERhdGUoZGF0ZSk7DQoJCQkJY2VsbC50dGlwID0gIl8iOw0KCQkJCWlmICghdGhpcy5tdWx0aXBsZSAmJiBjdXJyZW50X21vbnRoDQoJCQkJICAgICYmIGlkYXkgPT0gbWRheSAmJiB0aGlzLmhpbGl0ZVRvZGF5KSB7DQoJCQkJCWNlbGwuY2xhc3NOYW1lICs9ICIgc2VsZWN0ZWQiOw0KCQkJCQl0aGlzLmN1cnJlbnREYXRlRWwgPSBjZWxsOw0KCQkJCX0NCgkJCQlpZiAoZGF0ZS5nZXRGdWxsWWVhcigpID09IFRZICYmDQoJCQkJICAgIGRhdGUuZ2V0TW9udGgoKSA9PSBUTSAmJg0KCQkJCSAgICBpZGF5ID09IFREKSB7DQoJCQkJCWNlbGwuY2xhc3NOYW1lICs9ICIgdG9kYXkiOw0KCQkJCQljZWxsLnR0aXAgKz0gQ2FsZW5kYXIuX1RUWyJQQVJUX1RPREFZIl07DQoJCQkJfQ0KCQkJCWlmICh3ZWVrZW5kLmluZGV4T2Yod2RheS50b1N0cmluZygpKSAhPSAtMSkNCgkJCQkJY2VsbC5jbGFzc05hbWUgKz0gY2VsbC5vdGhlck1vbnRoID8gIiBvd2Vla2VuZCIgOiAiIHdlZWtlbmQiOw0KCQkJfQ0KCQl9DQoJCWlmICghKGhhc2RheXMgfHwgdGhpcy5zaG93c090aGVyTW9udGhzKSkNCgkJCXJvdy5jbGFzc05hbWUgPSAiZW1wdHlyb3ciOw0KCX0NCgl0aGlzLnRpdGxlLmlubmVySFRNTCA9IENhbGVuZGFyLl9NTlttb250aF0gKyAiLCAiICsgeWVhcjsNCgl0aGlzLm9uU2V0VGltZSgpOw0KCXRoaXMudGFibGUuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsNCgl0aGlzLl9pbml0TXVsdGlwbGVEYXRlcygpOw0KCS8vIFBST0ZJTEUNCgkvLyB0aGlzLnRvb2x0aXBzLmlubmVySFRNTCA9ICJHZW5lcmF0ZWQgaW4gIiArICgobmV3IERhdGUoKSkgLSB0b2RheSkgKyAiIG1zIjsNCn07DQoNCkNhbGVuZGFyLnByb3RvdHlwZS5faW5pdE11bHRpcGxlRGF0ZXMgPSBmdW5jdGlvbigpIHsNCglpZiAodGhpcy5tdWx0aXBsZSkgew0KCQlmb3IgKHZhciBpIGluIHRoaXMubXVsdGlwbGUpIHsNCgkJCXZhciBjZWxsID0gdGhpcy5kYXRlc0NlbGxzW2ldOw0KCQkJdmFyIGQgPSB0aGlzLm11bHRpcGxlW2ldOw0KCQkJaWYgKCFkKQ0KCQkJCWNvbnRpbnVlOw0KCQkJaWYgKGNlbGwpDQoJCQkJY2VsbC5jbGFzc05hbWUgKz0gIiBzZWxlY3RlZCI7DQoJCX0NCgl9DQp9Ow0KDQpDYWxlbmRhci5wcm90b3R5cGUuX3RvZ2dsZU11bHRpcGxlRGF0ZSA9IGZ1bmN0aW9uKGRhdGUpIHsNCglpZiAodGhpcy5tdWx0aXBsZSkgew0KCQl2YXIgZHMgPSBkYXRlLnByaW50KCIlWSVtJWQiKTsNCgkJdmFyIGNlbGwgPSB0aGlzLmRhdGVzQ2VsbHNbZHNdOw0KCQlpZiAoY2VsbCkgew0KCQkJdmFyIGQgPSB0aGlzLm11bHRpcGxlW2RzXTsNCgkJCWlmICghZCkgew0KCQkJCUNhbGVuZGFyLmFkZENsYXNzKGNlbGwsICJzZWxlY3RlZCIpOw0KCQkJCXRoaXMubXVsdGlwbGVbZHNdID0gZGF0ZTsNCgkJCX0gZWxzZSB7DQoJCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2VsbCwgInNlbGVjdGVkIik7DQoJCQkJZGVsZXRlIHRoaXMubXVsdGlwbGVbZHNdOw0KCQkJfQ0KCQl9DQoJfQ0KfTsNCg0KQ2FsZW5kYXIucHJvdG90eXBlLnNldERhdGVUb29sVGlwSGFuZGxlciA9IGZ1bmN0aW9uICh1bmFyeUZ1bmN0aW9uKSB7DQoJdGhpcy5nZXREYXRlVG9vbFRpcCA9IHVuYXJ5RnVuY3Rpb247DQp9Ow0KDQovKioNCiAqICBDYWxscyBfaW5pdCBmdW5jdGlvbiBhYm92ZSBmb3IgZ29pbmcgdG8gYSBjZXJ0YWluIGRhdGUgKGJ1dCBvbmx5IGlmIHRoZQ0KICogIGRhdGUgaXMgZGlmZmVyZW50IHRoYW4gdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBvbmUpLg0KICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7DQoJaWYgKCFkYXRlLmVxdWFsc1RvKHRoaXMuZGF0ZSkpIHsNCgkJdGhpcy5faW5pdCh0aGlzLmZpcnN0RGF5T2ZXZWVrLCBkYXRlKTsNCgl9DQp9Ow0KDQovKioNCiAqICBSZWZyZXNoZXMgdGhlIGNhbGVuZGFyLiAgVXNlZnVsIGlmIHRoZSAiZGlzYWJsZWRIYW5kbGVyIiBmdW5jdGlvbiBpcw0KICogIGR5bmFtaWMsIG1lYW5pbmcgdGhhdCB0aGUgbGlzdCBvZiBkaXNhYmxlZCBkYXRlIGNhbiBjaGFuZ2UgYXQgcnVudGltZS4NCiAqICBKdXN0ICogY2FsbCB0aGlzIGZ1bmN0aW9uIGlmIHlvdSB0aGluayB0aGF0IHRoZSBsaXN0IG9mIGRpc2FibGVkIGRhdGVzDQogKiAgc2hvdWxkICogY2hhbmdlLg0KICovDQpDYWxlbmRhci5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHsNCgl0aGlzLl9pbml0KHRoaXMuZmlyc3REYXlPZldlZWssIHRoaXMuZGF0ZSk7DQp9Ow0KDQovKiogTW9kaWZpZXMgdGhlICJmaXJzdERheU9mV2VlayIgcGFyYW1ldGVyIChwYXNzIDAgZm9yIFN5bmRheSwgMSBmb3IgTW9uZGF5LCBldGMuKS4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zZXRGaXJzdERheU9mV2VlayA9IGZ1bmN0aW9uIChmaXJzdERheU9mV2Vlaykgew0KCXRoaXMuX2luaXQoZmlyc3REYXlPZldlZWssIHRoaXMuZGF0ZSk7DQoJdGhpcy5fZGlzcGxheVdlZWtkYXlzKCk7DQp9Ow0KDQovKioNCiAqICBBbGxvd3MgY3VzdG9taXphdGlvbiBvZiB3aGF0IGRhdGVzIGFyZSBlbmFibGVkLiAgVGhlICJ1bmFyeUZ1bmN0aW9uIg0KICogIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24gb2JqZWN0IHRoYXQgcmVjZWl2ZXMgdGhlIGRhdGUgKGFzIGEgSlMgRGF0ZQ0KICogIG9iamVjdCkgYW5kIHJldHVybnMgYSBib29sZWFuIHZhbHVlLiAgSWYgdGhlIHJldHVybmVkIHZhbHVlIGlzIHRydWUgdGhlbg0KICogIHRoZSBwYXNzZWQgZGF0ZSB3aWxsIGJlIG1hcmtlZCBhcyBkaXNhYmxlZC4NCiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnNldERhdGVTdGF0dXNIYW5kbGVyID0gQ2FsZW5kYXIucHJvdG90eXBlLnNldERpc2FibGVkSGFuZGxlciA9IGZ1bmN0aW9uICh1bmFyeUZ1bmN0aW9uKSB7DQoJdGhpcy5nZXREYXRlU3RhdHVzID0gdW5hcnlGdW5jdGlvbjsNCn07DQoNCi8qKiBDdXN0b21pemF0aW9uIG9mIGFsbG93ZWQgeWVhciByYW5nZSBmb3IgdGhlIGNhbGVuZGFyLiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnNldFJhbmdlID0gZnVuY3Rpb24gKGEsIHopIHsNCgl0aGlzLm1pblllYXIgPSBhOw0KCXRoaXMubWF4WWVhciA9IHo7DQp9Ow0KDQovKiogQ2FsbHMgdGhlIGZpcnN0IHVzZXIgaGFuZGxlciAoc2VsZWN0ZWRIYW5kbGVyKS4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5jYWxsSGFuZGxlciA9IGZ1bmN0aW9uICgpIHsNCglpZiAodGhpcy5vblNlbGVjdGVkKSB7DQoJCXRoaXMub25TZWxlY3RlZCh0aGlzLCB0aGlzLmRhdGUucHJpbnQodGhpcy5kYXRlRm9ybWF0KSk7DQoJfQ0KfTsNCg0KLyoqIENhbGxzIHRoZSBzZWNvbmQgdXNlciBoYW5kbGVyIChjbG9zZUhhbmRsZXIpLiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLmNhbGxDbG9zZUhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7DQoJaWYgKHRoaXMub25DbG9zZSkgew0KCQl0aGlzLm9uQ2xvc2UodGhpcyk7DQoJfQ0KCXRoaXMuaGlkZVNob3dDb3ZlcmVkKCk7DQp9Ow0KDQovKiogUmVtb3ZlcyB0aGUgY2FsZW5kYXIgb2JqZWN0IGZyb20gdGhlIERPTSB0cmVlIGFuZCBkZXN0cm95cyBpdC4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgew0KCXZhciBlbCA9IHRoaXMuZWxlbWVudC5wYXJlbnROb2RlOw0KCWVsLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7DQoJQ2FsZW5kYXIuX0MgPSBudWxsOw0KCXdpbmRvdy5fZHluYXJjaF9wb3B1cENhbGVuZGFyID0gbnVsbDsNCn07DQoNCi8qKg0KICogIE1vdmVzIHRoZSBjYWxlbmRhciBlbGVtZW50IHRvIGEgZGlmZmVyZW50IHNlY3Rpb24gaW4gdGhlIERPTSB0cmVlIChjaGFuZ2VzDQogKiAgaXRzIHBhcmVudCkuDQogKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5yZXBhcmVudCA9IGZ1bmN0aW9uIChuZXdfcGFyZW50KSB7DQoJdmFyIGVsID0gdGhpcy5lbGVtZW50Ow0KCWVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpOw0KCW5ld19wYXJlbnQuYXBwZW5kQ2hpbGQoZWwpOw0KfTsNCg0KLy8gVGhpcyBnZXRzIGNhbGxlZCB3aGVuIHRoZSB1c2VyIHByZXNzZXMgYSBtb3VzZSBidXR0b24gYW55d2hlcmUgaW4gdGhlDQovLyBkb2N1bWVudCwgaWYgdGhlIGNhbGVuZGFyIGlzIHNob3duLiAgSWYgdGhlIGNsaWNrIHdhcyBvdXRzaWRlIHRoZSBvcGVuDQovLyBjYWxlbmRhciB0aGlzIGZ1bmN0aW9uIGNsb3NlcyBpdC4NCkNhbGVuZGFyLl9jaGVja0NhbGVuZGFyID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgY2FsZW5kYXIgPSB3aW5kb3cuX2R5bmFyY2hfcG9wdXBDYWxlbmRhcjsNCglpZiAoIWNhbGVuZGFyKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJdmFyIGVsID0gQ2FsZW5kYXIuaXNfaWUgPyBDYWxlbmRhci5nZXRFbGVtZW50KGV2KSA6IENhbGVuZGFyLmdldFRhcmdldEVsZW1lbnQoZXYpOw0KCWZvciAoOyBlbCAhPSBudWxsICYmIGVsICE9IGNhbGVuZGFyLmVsZW1lbnQ7IGVsID0gZWwucGFyZW50Tm9kZSk7DQoJaWYgKGVsID09IG51bGwpIHsNCgkJLy8gY2FsbHMgY2xvc2VIYW5kbGVyIHdoaWNoIHNob3VsZCBoaWRlIHRoZSBjYWxlbmRhci4NCgkJd2luZG93Ll9keW5hcmNoX3BvcHVwQ2FsZW5kYXIuY2FsbENsb3NlSGFuZGxlcigpOw0KCQlyZXR1cm4gQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCgl9DQp9Ow0KDQovKiogU2hvd3MgdGhlIGNhbGVuZGFyLiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7DQoJdmFyIHJvd3MgPSB0aGlzLnRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ciIpOw0KCWZvciAodmFyIGkgPSByb3dzLmxlbmd0aDsgaSA+IDA7KSB7DQoJCXZhciByb3cgPSByb3dzWy0taV07DQoJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKHJvdywgInJvd2hpbGl0ZSIpOw0KCQl2YXIgY2VsbHMgPSByb3cuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRkIik7DQoJCWZvciAodmFyIGogPSBjZWxscy5sZW5ndGg7IGogPiAwOykgew0KCQkJdmFyIGNlbGwgPSBjZWxsc1stLWpdOw0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2VsbCwgImhpbGl0ZSIpOw0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2VsbCwgImFjdGl2ZSIpOw0KCQl9DQoJfQ0KCXRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgl0aGlzLmhpZGRlbiA9IGZhbHNlOw0KCWlmICh0aGlzLmlzUG9wdXApIHsNCgkJd2luZG93Ll9keW5hcmNoX3BvcHVwQ2FsZW5kYXIgPSB0aGlzOw0KCQlDYWxlbmRhci5hZGRFdmVudChkb2N1bWVudCwgImtleWRvd24iLCBDYWxlbmRhci5fa2V5RXZlbnQpOw0KCQlDYWxlbmRhci5hZGRFdmVudChkb2N1bWVudCwgImtleXByZXNzIiwgQ2FsZW5kYXIuX2tleUV2ZW50KTsNCgkJQ2FsZW5kYXIuYWRkRXZlbnQoZG9jdW1lbnQsICJtb3VzZWRvd24iLCBDYWxlbmRhci5fY2hlY2tDYWxlbmRhcik7DQoJfQ0KCXRoaXMuaGlkZVNob3dDb3ZlcmVkKCk7DQp9Ow0KDQovKioNCiAqICBIaWRlcyB0aGUgY2FsZW5kYXIuICBBbHNvIHJlbW92ZXMgYW55ICJoaWxpdGUiIGZyb20gdGhlIGNsYXNzIG9mIGFueSBURA0KICogIGVsZW1lbnQuDQogKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgew0KCWlmICh0aGlzLmlzUG9wdXApIHsNCgkJQ2FsZW5kYXIucmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJrZXlkb3duIiwgQ2FsZW5kYXIuX2tleUV2ZW50KTsNCgkJQ2FsZW5kYXIucmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJrZXlwcmVzcyIsIENhbGVuZGFyLl9rZXlFdmVudCk7DQoJCUNhbGVuZGFyLnJlbW92ZUV2ZW50KGRvY3VtZW50LCAibW91c2Vkb3duIiwgQ2FsZW5kYXIuX2NoZWNrQ2FsZW5kYXIpOw0KCX0NCgl0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgl0aGlzLmhpZGRlbiA9IHRydWU7DQoJdGhpcy5oaWRlU2hvd0NvdmVyZWQoKTsNCn07DQoNCi8qKg0KICogIFNob3dzIHRoZSBjYWxlbmRhciBhdCBhIGdpdmVuIGFic29sdXRlIHBvc2l0aW9uIChiZXdhcmUgdGhhdCwgZGVwZW5kaW5nIG9uDQogKiAgdGhlIGNhbGVuZGFyIGVsZW1lbnQgc3R5bGUgLS0gcG9zaXRpb24gcHJvcGVydHkgLS0gdGhpcyBtaWdodCBiZSByZWxhdGl2ZQ0KICogIHRvIHRoZSBwYXJlbnQncyBjb250YWluaW5nIHJlY3RhbmdsZSkuDQogKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zaG93QXQgPSBmdW5jdGlvbiAoeCwgeSkgew0KCXZhciBzID0gdGhpcy5lbGVtZW50LnN0eWxlOw0KCXMubGVmdCA9IHggKyAicHgiOw0KCXMudG9wID0geSArICJweCI7DQoJdGhpcy5zaG93KCk7DQp9Ow0KDQovKiogU2hvd3MgdGhlIGNhbGVuZGFyIG5lYXIgYSBnaXZlbiBlbGVtZW50LiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnNob3dBdEVsZW1lbnQgPSBmdW5jdGlvbiAoZWwsIG9wdHMpIHsNCgl2YXIgc2VsZiA9IHRoaXM7DQoJdmFyIHAgPSBDYWxlbmRhci5nZXRBYnNvbHV0ZVBvcyhlbCk7DQoJaWYgKCFvcHRzIHx8IHR5cGVvZiBvcHRzICE9ICJzdHJpbmciKSB7DQoJCXRoaXMuc2hvd0F0KHAueCwgcC55ICsgZWwub2Zmc2V0SGVpZ2h0KTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KCWZ1bmN0aW9uIGZpeFBvc2l0aW9uKGJveCkgew0KCQlpZiAoYm94LnggPCAwKQ0KCQkJYm94LnggPSAwOw0KCQlpZiAoYm94LnkgPCAwKQ0KCQkJYm94LnkgPSAwOw0KCQl2YXIgY3AgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJdmFyIHMgPSBjcC5zdHlsZTsNCgkJcy5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7DQoJCXMucmlnaHQgPSBzLmJvdHRvbSA9IHMud2lkdGggPSBzLmhlaWdodCA9ICIwcHgiOw0KCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNwKTsNCgkJdmFyIGJyID0gQ2FsZW5kYXIuZ2V0QWJzb2x1dGVQb3MoY3ApOw0KCQlkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGNwKTsNCgkJaWYgKENhbGVuZGFyLmlzX2llKSB7DQoJCQlici55ICs9IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOw0KCQkJYnIueCArPSBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQ7DQoJCX0gZWxzZSB7DQoJCQlici55ICs9IHdpbmRvdy5zY3JvbGxZOw0KCQkJYnIueCArPSB3aW5kb3cuc2Nyb2xsWDsNCgkJfQ0KCQl2YXIgdG1wID0gYm94LnggKyBib3gud2lkdGggLSBici54Ow0KCQlpZiAodG1wID4gMCkgYm94LnggLT0gdG1wOw0KCQl0bXAgPSBib3gueSArIGJveC5oZWlnaHQgLSBici55Ow0KCQlpZiAodG1wID4gMCkgYm94LnkgLT0gdG1wOw0KCX07DQoJdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KCUNhbGVuZGFyLmNvbnRpbnVhdGlvbl9mb3JfdGhlX2Z1Y2tpbmdfa2h0bWxfYnJvd3NlciA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgdyA9IHNlbGYuZWxlbWVudC5vZmZzZXRXaWR0aDsNCgkJdmFyIGggPSBzZWxmLmVsZW1lbnQub2Zmc2V0SGVpZ2h0Ow0KCQlzZWxmLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJdmFyIHZhbGlnbiA9IG9wdHMuc3Vic3RyKDAsIDEpOw0KCQl2YXIgaGFsaWduID0gImwiOw0KCQlpZiAob3B0cy5sZW5ndGggPiAxKSB7DQoJCQloYWxpZ24gPSBvcHRzLnN1YnN0cigxLCAxKTsNCgkJfQ0KCQkvLyB2ZXJ0aWNhbCBhbGlnbm1lbnQNCgkJc3dpdGNoICh2YWxpZ24pIHsNCgkJICAgIGNhc2UgIlQiOiBwLnkgLT0gaDsgYnJlYWs7DQoJCSAgICBjYXNlICJCIjogcC55ICs9IGVsLm9mZnNldEhlaWdodDsgYnJlYWs7DQoJCSAgICBjYXNlICJDIjogcC55ICs9IChlbC5vZmZzZXRIZWlnaHQgLSBoKSAvIDI7IGJyZWFrOw0KCQkgICAgY2FzZSAidCI6IHAueSArPSBlbC5vZmZzZXRIZWlnaHQgLSBoOyBicmVhazsNCgkJICAgIGNhc2UgImIiOiBicmVhazsgLy8gYWxyZWFkeSB0aGVyZQ0KCQl9DQoJCS8vIGhvcml6b250YWwgYWxpZ25tZW50DQoJCXN3aXRjaCAoaGFsaWduKSB7DQoJCSAgICBjYXNlICJMIjogcC54IC09IHc7IGJyZWFrOw0KCQkgICAgY2FzZSAiUiI6IHAueCArPSBlbC5vZmZzZXRXaWR0aDsgYnJlYWs7DQoJCSAgICBjYXNlICJDIjogcC54ICs9IChlbC5vZmZzZXRXaWR0aCAtIHcpIC8gMjsgYnJlYWs7DQoJCSAgICBjYXNlICJsIjogcC54ICs9IGVsLm9mZnNldFdpZHRoIC0gdzsgYnJlYWs7DQoJCSAgICBjYXNlICJyIjogYnJlYWs7IC8vIGFscmVhZHkgdGhlcmUNCgkJfQ0KCQlwLndpZHRoID0gdzsNCgkJcC5oZWlnaHQgPSBoICsgNDA7DQoJCXNlbGYubW9udGhzQ29tYm8uc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJZml4UG9zaXRpb24ocCk7DQoJCXNlbGYuc2hvd0F0KHAueCwgcC55KTsNCgl9Ow0KCWlmIChDYWxlbmRhci5pc19raHRtbCkNCgkJc2V0VGltZW91dCgiQ2FsZW5kYXIuY29udGludWF0aW9uX2Zvcl90aGVfZnVja2luZ19raHRtbF9icm93c2VyKCkiLCAxMCk7DQoJZWxzZQ0KCQlDYWxlbmRhci5jb250aW51YXRpb25fZm9yX3RoZV9mdWNraW5nX2todG1sX2Jyb3dzZXIoKTsNCn07DQoNCi8qKiBDdXN0b21pemVzIHRoZSBkYXRlIGZvcm1hdC4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zZXREYXRlRm9ybWF0ID0gZnVuY3Rpb24gKHN0cikgew0KCXRoaXMuZGF0ZUZvcm1hdCA9IHN0cjsNCn07DQoNCi8qKiBDdXN0b21pemVzIHRoZSB0b29sdGlwIGRhdGUgZm9ybWF0LiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnNldFR0RGF0ZUZvcm1hdCA9IGZ1bmN0aW9uIChzdHIpIHsNCgl0aGlzLnR0RGF0ZUZvcm1hdCA9IHN0cjsNCn07DQoNCi8qKg0KICogIFRyaWVzIHRvIGlkZW50aWZ5IHRoZSBkYXRlIHJlcHJlc2VudGVkIGluIGEgc3RyaW5nLiAgSWYgc3VjY2Vzc2Z1bCBpdCBhbHNvDQogKiAgY2FsbHMgdGhpcy5zZXREYXRlIHdoaWNoIG1vdmVzIHRoZSBjYWxlbmRhciB0byB0aGUgZ2l2ZW4gZGF0ZS4NCiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnBhcnNlRGF0ZSA9IGZ1bmN0aW9uKHN0ciwgZm10KSB7DQoJaWYgKCFmbXQpDQoJCWZtdCA9IHRoaXMuZGF0ZUZvcm1hdDsNCgl0aGlzLnNldERhdGUoRGF0ZS5wYXJzZURhdGUoc3RyLCBmbXQpKTsNCn07DQoNCkNhbGVuZGFyLnByb3RvdHlwZS5oaWRlU2hvd0NvdmVyZWQgPSBmdW5jdGlvbiAoKSB7DQoJaWYgKCFDYWxlbmRhci5pc19pZSAmJiAhQ2FsZW5kYXIuaXNfb3BlcmEpDQoJCXJldHVybjsNCglmdW5jdGlvbiBnZXRWaXNpYihvYmopew0KCQl2YXIgdmFsdWUgPSBvYmouc3R5bGUudmlzaWJpbGl0eTsNCgkJaWYgKCF2YWx1ZSkgew0KCQkJaWYgKGRvY3VtZW50LmRlZmF1bHRWaWV3ICYmIHR5cGVvZiAoZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSkgPT0gImZ1bmN0aW9uIikgeyAvLyBHZWNrbywgVzNDDQoJCQkJaWYgKCFDYWxlbmRhci5pc19raHRtbCkNCgkJCQkJdmFsdWUgPSBkb2N1bWVudC5kZWZhdWx0Vmlldy4NCgkJCQkJCWdldENvbXB1dGVkU3R5bGUob2JqLCAiIikuZ2V0UHJvcGVydHlWYWx1ZSgidmlzaWJpbGl0eSIpOw0KCQkJCWVsc2UNCgkJCQkJdmFsdWUgPSAnJzsNCgkJCX0gZWxzZSBpZiAob2JqLmN1cnJlbnRTdHlsZSkgeyAvLyBJRQ0KCQkJCXZhbHVlID0gb2JqLmN1cnJlbnRTdHlsZS52aXNpYmlsaXR5Ow0KCQkJfSBlbHNlDQoJCQkJdmFsdWUgPSAnJzsNCgkJfQ0KCQlyZXR1cm4gdmFsdWU7DQoJfTsNCg0KCXZhciB0YWdzID0gbmV3IEFycmF5KCJhcHBsZXQiLCAiaWZyYW1lIiwgInNlbGVjdCIpOw0KCXZhciBlbCA9IHRoaXMuZWxlbWVudDsNCg0KCXZhciBwID0gQ2FsZW5kYXIuZ2V0QWJzb2x1dGVQb3MoZWwpOw0KCXZhciBFWDEgPSBwLng7DQoJdmFyIEVYMiA9IGVsLm9mZnNldFdpZHRoICsgRVgxOw0KCXZhciBFWTEgPSBwLnk7DQoJdmFyIEVZMiA9IGVsLm9mZnNldEhlaWdodCArIEVZMTsNCg0KCWZvciAodmFyIGsgPSB0YWdzLmxlbmd0aDsgayA+IDA7ICkgew0KCQl2YXIgYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdzWy0ta10pOw0KCQl2YXIgY2MgPSBudWxsOw0KDQoJCWZvciAodmFyIGkgPSBhci5sZW5ndGg7IGkgPiAwOykgew0KCQkJY2MgPSBhclstLWldOw0KDQoJCQlwID0gQ2FsZW5kYXIuZ2V0QWJzb2x1dGVQb3MoY2MpOw0KCQkJdmFyIENYMSA9IHAueDsNCgkJCXZhciBDWDIgPSBjYy5vZmZzZXRXaWR0aCArIENYMTsNCgkJCXZhciBDWTEgPSBwLnk7DQoJCQl2YXIgQ1kyID0gY2Mub2Zmc2V0SGVpZ2h0ICsgQ1kxOw0KDQoJCQlpZiAodGhpcy5oaWRkZW4gfHwgKENYMSA+IEVYMikgfHwgKENYMiA8IEVYMSkgfHwgKENZMSA+IEVZMikgfHwgKENZMiA8IEVZMSkpIHsNCgkJCQlpZiAoIWNjLl9fbXNoX3NhdmVfdmlzaWJpbGl0eSkgew0KCQkJCQljYy5fX21zaF9zYXZlX3Zpc2liaWxpdHkgPSBnZXRWaXNpYihjYyk7DQoJCQkJfQ0KCQkJCWNjLnN0eWxlLnZpc2liaWxpdHkgPSBjYy5fX21zaF9zYXZlX3Zpc2liaWxpdHk7DQoJCQl9IGVsc2Ugew0KCQkJCWlmICghY2MuX19tc2hfc2F2ZV92aXNpYmlsaXR5KSB7DQoJCQkJCWNjLl9fbXNoX3NhdmVfdmlzaWJpbGl0eSA9IGdldFZpc2liKGNjKTsNCgkJCQl9DQoJCQkJY2Muc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOw0KCQkJfQ0KCQl9DQoJfQ0KfTsNCg0KLyoqIEludGVybmFsIGZ1bmN0aW9uOyBpdCBkaXNwbGF5cyB0aGUgYmFyIHdpdGggdGhlIG5hbWVzIG9mIHRoZSB3ZWVrZGF5LiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLl9kaXNwbGF5V2Vla2RheXMgPSBmdW5jdGlvbiAoKSB7DQoJdmFyIGZkb3cgPSB0aGlzLmZpcnN0RGF5T2ZXZWVrOw0KCXZhciBjZWxsID0gdGhpcy5maXJzdGRheW5hbWU7DQoJdmFyIHdlZWtlbmQgPSBDYWxlbmRhci5fVFRbIldFRUtFTkQiXTsNCglmb3IgKHZhciBpID0gMDsgaSA8IDc7ICsraSkgew0KCQljZWxsLmNsYXNzTmFtZSA9ICJkYXkgbmFtZSI7DQoJCXZhciByZWFsZGF5ID0gKGkgKyBmZG93KSAlIDc7DQoJCWlmIChpKSB7DQoJCQljZWxsLnR0aXAgPSBDYWxlbmRhci5fVFRbIkRBWV9GSVJTVCJdLnJlcGxhY2UoIiVzIiwgQ2FsZW5kYXIuX0ROW3JlYWxkYXldKTsNCgkJCWNlbGwubmF2dHlwZSA9IDEwMDsNCgkJCWNlbGwuY2FsZW5kYXIgPSB0aGlzOw0KCQkJY2VsbC5mZG93ID0gcmVhbGRheTsNCgkJCUNhbGVuZGFyLl9hZGRfZXZzKGNlbGwpOw0KCQl9DQoJCWlmICh3ZWVrZW5kLmluZGV4T2YocmVhbGRheS50b1N0cmluZygpKSAhPSAtMSkgew0KCQkJQ2FsZW5kYXIuYWRkQ2xhc3MoY2VsbCwgIndlZWtlbmQiKTsNCgkJfQ0KCQljZWxsLmlubmVySFRNTCA9IENhbGVuZGFyLl9TRE5bKGkgKyBmZG93KSAlIDddOw0KCQljZWxsID0gY2VsbC5uZXh0U2libGluZzsNCgl9DQp9Ow0KDQovKiogSW50ZXJuYWwgZnVuY3Rpb24uICBIaWRlcyBhbGwgY29tYm8gYm94ZXMgdGhhdCBtaWdodCBiZSBkaXNwbGF5ZWQuICovDQpDYWxlbmRhci5wcm90b3R5cGUuX2hpZGVDb21ib3MgPSBmdW5jdGlvbiAoKSB7DQoJdGhpcy5tb250aHNDb21iby5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCXRoaXMueWVhcnNDb21iby5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KfTsNCg0KLyoqIEludGVybmFsIGZ1bmN0aW9uLiAgU3RhcnRzIGRyYWdnaW5nIHRoZSBlbGVtZW50LiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLl9kcmFnU3RhcnQgPSBmdW5jdGlvbiAoZXYpIHsNCglpZiAodGhpcy5kcmFnZ2luZykgew0KCQlyZXR1cm47DQoJfQ0KCXRoaXMuZHJhZ2dpbmcgPSB0cnVlOw0KCXZhciBwb3NYOw0KCXZhciBwb3NZOw0KCWlmIChDYWxlbmRhci5pc19pZSkgew0KCQlwb3NZID0gd2luZG93LmV2ZW50LmNsaWVudFkgKyBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsNCgkJcG9zWCA9IHdpbmRvdy5ldmVudC5jbGllbnRYICsgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0Ow0KCX0gZWxzZSB7DQoJCXBvc1kgPSBldi5jbGllbnRZICsgd2luZG93LnNjcm9sbFk7DQoJCXBvc1ggPSBldi5jbGllbnRYICsgd2luZG93LnNjcm9sbFg7DQoJfQ0KCXZhciBzdCA9IHRoaXMuZWxlbWVudC5zdHlsZTsNCgl0aGlzLnhPZmZzID0gcG9zWCAtIHBhcnNlSW50KHN0LmxlZnQpOw0KCXRoaXMueU9mZnMgPSBwb3NZIC0gcGFyc2VJbnQoc3QudG9wKTsNCgl3aXRoIChDYWxlbmRhcikgew0KCQlhZGRFdmVudChkb2N1bWVudCwgIm1vdXNlbW92ZSIsIGNhbERyYWdJdCk7DQoJCWFkZEV2ZW50KGRvY3VtZW50LCAibW91c2V1cCIsIGNhbERyYWdFbmQpOw0KCX0NCn07DQoNCi8vIEJFR0lOOiBEQVRFIE9CSkVDVCBQQVRDSEVTDQoNCi8qKiBBZGRzIHRoZSBudW1iZXIgb2YgZGF5cyBhcnJheSB0byB0aGUgRGF0ZSBvYmplY3QuICovDQpEYXRlLl9NRCA9IG5ldyBBcnJheSgzMSwyOCwzMSwzMCwzMSwzMCwzMSwzMSwzMCwzMSwzMCwzMSk7DQoNCi8qKiBDb25zdGFudHMgdXNlZCBmb3IgdGltZSBjb21wdXRhdGlvbnMgKi8NCkRhdGUuU0VDT05EID0gMTAwMCAvKiBtaWxsaXNlY29uZHMgKi87DQpEYXRlLk1JTlVURSA9IDYwICogRGF0ZS5TRUNPTkQ7DQpEYXRlLkhPVVIgICA9IDYwICogRGF0ZS5NSU5VVEU7DQpEYXRlLkRBWSAgICA9IDI0ICogRGF0ZS5IT1VSOw0KRGF0ZS5XRUVLICAgPSAgNyAqIERhdGUuREFZOw0KDQpEYXRlLnBhcnNlRGF0ZSA9IGZ1bmN0aW9uKHN0ciwgZm10KSB7DQoJdmFyIHRvZGF5ID0gbmV3IERhdGUoKTsNCgl2YXIgeSA9IDA7DQoJdmFyIG0gPSAtMTsNCgl2YXIgZCA9IDA7DQoJdmFyIGEgPSBzdHIuc3BsaXQoL1xXKy8pOw0KCXZhciBiID0gZm10Lm1hdGNoKC8lLi9nKTsNCgl2YXIgaSA9IDAsIGogPSAwOw0KCXZhciBociA9IDA7DQoJdmFyIG1pbiA9IDA7DQoJZm9yIChpID0gMDsgaSA8IGEubGVuZ3RoOyArK2kpIHsNCgkJaWYgKCFhW2ldKQ0KCQkJY29udGludWU7DQoJCXN3aXRjaCAoYltpXSkgew0KCQkgICAgY2FzZSAiJWQiOg0KCQkgICAgY2FzZSAiJWUiOg0KCQkJZCA9IHBhcnNlSW50KGFbaV0sIDEwKTsNCgkJCWJyZWFrOw0KDQoJCSAgICBjYXNlICIlbSI6DQoJCQltID0gcGFyc2VJbnQoYVtpXSwgMTApIC0gMTsNCgkJCWJyZWFrOw0KDQoJCSAgICBjYXNlICIlWSI6DQoJCSAgICBjYXNlICIleSI6DQoJCQl5ID0gcGFyc2VJbnQoYVtpXSwgMTApOw0KCQkJKHkgPCAxMDApICYmICh5ICs9ICh5ID4gMjkpID8gMTkwMCA6IDIwMDApOw0KCQkJYnJlYWs7DQoNCgkJICAgIGNhc2UgIiViIjoNCgkJICAgIGNhc2UgIiVCIjoNCgkJCWZvciAoaiA9IDA7IGogPCAxMjsgKytqKSB7DQoJCQkJaWYgKENhbGVuZGFyLl9NTltqXS5zdWJzdHIoMCwgYVtpXS5sZW5ndGgpLnRvTG93ZXJDYXNlKCkgPT0gYVtpXS50b0xvd2VyQ2FzZSgpKSB7IG0gPSBqOyBicmVhazsgfQ0KCQkJfQ0KCQkJYnJlYWs7DQoNCgkJICAgIGNhc2UgIiVIIjoNCgkJICAgIGNhc2UgIiVJIjoNCgkJICAgIGNhc2UgIiVrIjoNCgkJICAgIGNhc2UgIiVsIjoNCgkJCWhyID0gcGFyc2VJbnQoYVtpXSwgMTApOw0KCQkJYnJlYWs7DQoNCgkJICAgIGNhc2UgIiVQIjoNCgkJICAgIGNhc2UgIiVwIjoNCgkJCWlmICgvcG0vaS50ZXN0KGFbaV0pICYmIGhyIDwgMTIpDQoJCQkJaHIgKz0gMTI7DQoJCQllbHNlIGlmICgvYW0vaS50ZXN0KGFbaV0pICYmIGhyID49IDEyKQ0KCQkJCWhyIC09IDEyOw0KCQkJYnJlYWs7DQoNCgkJICAgIGNhc2UgIiVNIjoNCgkJCW1pbiA9IHBhcnNlSW50KGFbaV0sIDEwKTsNCgkJCWJyZWFrOw0KCQl9DQoJfQ0KCWlmIChpc05hTih5KSkgeSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7DQoJaWYgKGlzTmFOKG0pKSBtID0gdG9kYXkuZ2V0TW9udGgoKTsNCglpZiAoaXNOYU4oZCkpIGQgPSB0b2RheS5nZXREYXRlKCk7DQoJaWYgKGlzTmFOKGhyKSkgaHIgPSB0b2RheS5nZXRIb3VycygpOw0KCWlmIChpc05hTihtaW4pKSBtaW4gPSB0b2RheS5nZXRNaW51dGVzKCk7DQoJaWYgKHkgIT0gMCAmJiBtICE9IC0xICYmIGQgIT0gMCkNCgkJcmV0dXJuIG5ldyBEYXRlKHksIG0sIGQsIGhyLCBtaW4sIDApOw0KCXkgPSAwOyBtID0gLTE7IGQgPSAwOw0KCWZvciAoaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKSB7DQoJCWlmIChhW2ldLnNlYXJjaCgvW2EtekEtWl0rLykgIT0gLTEpIHsNCgkJCXZhciB0ID0gLTE7DQoJCQlmb3IgKGogPSAwOyBqIDwgMTI7ICsraikgew0KCQkJCWlmIChDYWxlbmRhci5fTU5bal0uc3Vic3RyKDAsIGFbaV0ubGVuZ3RoKS50b0xvd2VyQ2FzZSgpID09IGFbaV0udG9Mb3dlckNhc2UoKSkgeyB0ID0gajsgYnJlYWs7IH0NCgkJCX0NCgkJCWlmICh0ICE9IC0xKSB7DQoJCQkJaWYgKG0gIT0gLTEpIHsNCgkJCQkJZCA9IG0rMTsNCgkJCQl9DQoJCQkJbSA9IHQ7DQoJCQl9DQoJCX0gZWxzZSBpZiAocGFyc2VJbnQoYVtpXSwgMTApIDw9IDEyICYmIG0gPT0gLTEpIHsNCgkJCW0gPSBhW2ldLTE7DQoJCX0gZWxzZSBpZiAocGFyc2VJbnQoYVtpXSwgMTApID4gMzEgJiYgeSA9PSAwKSB7DQoJCQl5ID0gcGFyc2VJbnQoYVtpXSwgMTApOw0KCQkJKHkgPCAxMDApICYmICh5ICs9ICh5ID4gMjkpID8gMTkwMCA6IDIwMDApOw0KCQl9IGVsc2UgaWYgKGQgPT0gMCkgew0KCQkJZCA9IGFbaV07DQoJCX0NCgl9DQoJaWYgKHkgPT0gMCkNCgkJeSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7DQoJaWYgKG0gIT0gLTEgJiYgZCAhPSAwKQ0KCQlyZXR1cm4gbmV3IERhdGUoeSwgbSwgZCwgaHIsIG1pbiwgMCk7DQoJcmV0dXJuIHRvZGF5Ow0KfTsNCg0KLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiBkYXlzIGluIHRoZSBjdXJyZW50IG1vbnRoICovDQpEYXRlLnByb3RvdHlwZS5nZXRNb250aERheXMgPSBmdW5jdGlvbihtb250aCkgew0KCXZhciB5ZWFyID0gdGhpcy5nZXRGdWxsWWVhcigpOw0KCWlmICh0eXBlb2YgbW9udGggPT0gInVuZGVmaW5lZCIpIHsNCgkJbW9udGggPSB0aGlzLmdldE1vbnRoKCk7DQoJfQ0KCWlmICgoKDAgPT0gKHllYXIlNCkpICYmICggKDAgIT0gKHllYXIlMTAwKSkgfHwgKDAgPT0gKHllYXIlNDAwKSkpKSAmJiBtb250aCA9PSAxKSB7DQoJCXJldHVybiAyOTsNCgl9IGVsc2Ugew0KCQlyZXR1cm4gRGF0ZS5fTURbbW9udGhdOw0KCX0NCn07DQoNCi8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZGF5IGluIHRoZSB5ZWFyLiAqLw0KRGF0ZS5wcm90b3R5cGUuZ2V0RGF5T2ZZZWFyID0gZnVuY3Rpb24oKSB7DQoJdmFyIG5vdyA9IG5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSwgdGhpcy5nZXRNb250aCgpLCB0aGlzLmdldERhdGUoKSwgMCwgMCwgMCk7DQoJdmFyIHRoZW4gPSBuZXcgRGF0ZSh0aGlzLmdldEZ1bGxZZWFyKCksIDAsIDAsIDAsIDAsIDApOw0KCXZhciB0aW1lID0gbm93IC0gdGhlbjsNCglyZXR1cm4gTWF0aC5mbG9vcih0aW1lIC8gRGF0ZS5EQVkpOw0KfTsNCg0KLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgd2VlayBpbiB5ZWFyLCBhcyBkZWZpbmVkIGluIElTTyA4NjAxLiAqLw0KRGF0ZS5wcm90b3R5cGUuZ2V0V2Vla051bWJlciA9IGZ1bmN0aW9uKCkgew0KCXZhciBkID0gbmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLCB0aGlzLmdldE1vbnRoKCksIHRoaXMuZ2V0RGF0ZSgpLCAwLCAwLCAwKTsNCgl2YXIgRG9XID0gZC5nZXREYXkoKTsNCglkLnNldERhdGUoZC5nZXREYXRlKCkgLSAoRG9XICsgNikgJSA3ICsgMyk7IC8vIE5lYXJlc3QgVGh1DQoJdmFyIG1zID0gZC52YWx1ZU9mKCk7IC8vIEdNVA0KCWQuc2V0TW9udGgoMCk7DQoJZC5zZXREYXRlKDQpOyAvLyBUaHUgaW4gV2VlayAxDQoJcmV0dXJuIE1hdGgucm91bmQoKG1zIC0gZC52YWx1ZU9mKCkpIC8gKDcgKiA4NjRlNSkpICsgMTsNCn07DQoNCi8qKiBDaGVja3MgZGF0ZSBhbmQgdGltZSBlcXVhbGl0eSAqLw0KRGF0ZS5wcm90b3R5cGUuZXF1YWxzVG8gPSBmdW5jdGlvbihkYXRlKSB7DQoJcmV0dXJuICgodGhpcy5nZXRGdWxsWWVhcigpID09IGRhdGUuZ2V0RnVsbFllYXIoKSkgJiYNCgkJKHRoaXMuZ2V0TW9udGgoKSA9PSBkYXRlLmdldE1vbnRoKCkpICYmDQoJCSh0aGlzLmdldERhdGUoKSA9PSBkYXRlLmdldERhdGUoKSkgJiYNCgkJKHRoaXMuZ2V0SG91cnMoKSA9PSBkYXRlLmdldEhvdXJzKCkpICYmDQoJCSh0aGlzLmdldE1pbnV0ZXMoKSA9PSBkYXRlLmdldE1pbnV0ZXMoKSkpOw0KfTsNCg0KLyoqIFNldCBvbmx5IHRoZSB5ZWFyLCBtb250aCwgZGF0ZSBwYXJ0cyAoa2VlcCBleGlzdGluZyB0aW1lKSAqLw0KRGF0ZS5wcm90b3R5cGUuc2V0RGF0ZU9ubHkgPSBmdW5jdGlvbihkYXRlKSB7DQoJdmFyIHRtcCA9IG5ldyBEYXRlKGRhdGUpOw0KCXRoaXMuc2V0RGF0ZSgxKTsNCgl0aGlzLnNldEZ1bGxZZWFyKHRtcC5nZXRGdWxsWWVhcigpKTsNCgl0aGlzLnNldE1vbnRoKHRtcC5nZXRNb250aCgpKTsNCgl0aGlzLnNldERhdGUodG1wLmdldERhdGUoKSk7DQp9Ow0KDQovKiogUHJpbnRzIHRoZSBkYXRlIGluIGEgc3RyaW5nIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gZm9ybWF0LiAqLw0KRGF0ZS5wcm90b3R5cGUucHJpbnQgPSBmdW5jdGlvbiAoc3RyKSB7DQoJdmFyIG0gPSB0aGlzLmdldE1vbnRoKCk7DQoJdmFyIGQgPSB0aGlzLmdldERhdGUoKTsNCgl2YXIgeSA9IHRoaXMuZ2V0RnVsbFllYXIoKTsNCgl2YXIgd24gPSB0aGlzLmdldFdlZWtOdW1iZXIoKTsNCgl2YXIgdyA9IHRoaXMuZ2V0RGF5KCk7DQoJdmFyIHMgPSB7fTsNCgl2YXIgaHIgPSB0aGlzLmdldEhvdXJzKCk7DQoJdmFyIHBtID0gKGhyID49IDEyKTsNCgl2YXIgaXIgPSAocG0pID8gKGhyIC0gMTIpIDogaHI7DQoJdmFyIGR5ID0gdGhpcy5nZXREYXlPZlllYXIoKTsNCglpZiAoaXIgPT0gMCkNCgkJaXIgPSAxMjsNCgl2YXIgbWluID0gdGhpcy5nZXRNaW51dGVzKCk7DQoJdmFyIHNlYyA9IHRoaXMuZ2V0U2Vjb25kcygpOw0KCXNbIiVhIl0gPSBDYWxlbmRhci5fU0ROW3ddOyAvLyBhYmJyZXZpYXRlZCB3ZWVrZGF5IG5hbWUgW0ZJWE1FOiBJMThOXQ0KCXNbIiVBIl0gPSBDYWxlbmRhci5fRE5bd107IC8vIGZ1bGwgd2Vla2RheSBuYW1lDQoJc1siJWIiXSA9IENhbGVuZGFyLl9TTU5bbV07IC8vIGFiYnJldmlhdGVkIG1vbnRoIG5hbWUgW0ZJWE1FOiBJMThOXQ0KCXNbIiVCIl0gPSBDYWxlbmRhci5fTU5bbV07IC8vIGZ1bGwgbW9udGggbmFtZQ0KCS8vIEZJWE1FOiAlYyA6IHByZWZlcnJlZCBkYXRlIGFuZCB0aW1lIHJlcHJlc2VudGF0aW9uIGZvciB0aGUgY3VycmVudCBsb2NhbGUNCglzWyIlQyJdID0gMSArIE1hdGguZmxvb3IoeSAvIDEwMCk7IC8vIHRoZSBjZW50dXJ5IG51bWJlcg0KCXNbIiVkIl0gPSAoZCA8IDEwKSA\/ICgiMCIgKyBkKSA6IGQ7IC8vIHRoZSBkYXkgb2YgdGhlIG1vbnRoIChyYW5nZSAwMSB0byAzMSkNCglzWyIlZSJdID0gZDsgLy8gdGhlIGRheSBvZiB0aGUgbW9udGggKHJhbmdlIDEgdG8gMzEpDQoJLy8gRklYTUU6ICVEIDogYW1lcmljYW4gZGF0ZSBzdHlsZTogJW0vJWQvJXkNCgkvLyBGSVhNRTogJUUsICVGLCAlRywgJWcsICVoIChtYW4gc3RyZnRpbWUpDQoJc1siJUgiXSA9IChociA8IDEwKSA\/ICgiMCIgKyBocikgOiBocjsgLy8gaG91ciwgcmFuZ2UgMDAgdG8gMjMgKDI0aCBmb3JtYXQpDQoJc1siJUkiXSA9IChpciA8IDEwKSA\/ICgiMCIgKyBpcikgOiBpcjsgLy8gaG91ciwgcmFuZ2UgMDEgdG8gMTIgKDEyaCBmb3JtYXQpDQoJc1siJWoiXSA9IChkeSA8IDEwMCkgPyAoKGR5IDwgMTApID8gKCIwMCIgKyBkeSkgOiAoIjAiICsgZHkpKSA6IGR5OyAvLyBkYXkgb2YgdGhlIHllYXIgKHJhbmdlIDAwMSB0byAzNjYpDQoJc1siJWsiXSA9IGhyOwkJLy8gaG91ciwgcmFuZ2UgMCB0byAyMyAoMjRoIGZvcm1hdCkNCglzWyIlbCJdID0gaXI7CQkvLyBob3VyLCByYW5nZSAxIHRvIDEyICgxMmggZm9ybWF0KQ0KCXNbIiVtIl0gPSAobSA8IDkpID8gKCIwIiArICgxK20pKSA6ICgxK20pOyAvLyBtb250aCwgcmFuZ2UgMDEgdG8gMTINCglzWyIlTSJdID0gKG1pbiA8IDEwKSA\/ICgiMCIgKyBtaW4pIDogbWluOyAvLyBtaW51dGUsIHJhbmdlIDAwIHRvIDU5DQoJc1siJW4iXSA9ICJcbiI7CQkvLyBhIG5ld2xpbmUgY2hhcmFjdGVyDQoJc1siJXAiXSA9IHBtID8gIlBNIiA6ICJBTSI7DQoJc1siJVAiXSA9IHBtID8gInBtIiA6ICJhbSI7DQoJLy8gRklYTUU6ICVyIDogdGhlIHRpbWUgaW4gYW0vcG0gbm90YXRpb24gJUk6JU06JVMgJXANCgkvLyBGSVhNRTogJVIgOiB0aGUgdGltZSBpbiAyNC1ob3VyIG5vdGF0aW9uICVIOiVNDQoJc1siJXMiXSA9IE1hdGguZmxvb3IodGhpcy5nZXRUaW1lKCkgLyAxMDAwKTsNCglzWyIlUyJdID0gKHNlYyA8IDEwKSA\/ICgiMCIgKyBzZWMpIDogc2VjOyAvLyBzZWNvbmRzLCByYW5nZSAwMCB0byA1OQ0KCXNbIiV0Il0gPSAiXHQiOwkJLy8gYSB0YWIgY2hhcmFjdGVyDQoJLy8gRklYTUU6ICVUIDogdGhlIHRpbWUgaW4gMjQtaG91ciBub3RhdGlvbiAoJUg6JU06JVMpDQoJc1siJVUiXSA9IHNbIiVXIl0gPSBzWyIlViJdID0gKHduIDwgMTApID8gKCIwIiArIHduKSA6IHduOw0KCXNbIiV1Il0gPSB3ICsgMTsJLy8gdGhlIGRheSBvZiB0aGUgd2VlayAocmFuZ2UgMSB0byA3LCAxID0gTU9OKQ0KCXNbIiV3Il0gPSB3OwkJLy8gdGhlIGRheSBvZiB0aGUgd2VlayAocmFuZ2UgMCB0byA2LCAwID0gU1VOKQ0KCS8vIEZJWE1FOiAleCA6IHByZWZlcnJlZCBkYXRlIHJlcHJlc2VudGF0aW9uIGZvciB0aGUgY3VycmVudCBsb2NhbGUgd2l0aG91dCB0aGUgdGltZQ0KCS8vIEZJWE1FOiAlWCA6IHByZWZlcnJlZCB0aW1lIHJlcHJlc2VudGF0aW9uIGZvciB0aGUgY3VycmVudCBsb2NhbGUgd2l0aG91dCB0aGUgZGF0ZQ0KCXNbIiV5Il0gPSAoJycgKyB5KS5zdWJzdHIoMiwgMik7IC8vIHllYXIgd2l0aG91dCB0aGUgY2VudHVyeSAocmFuZ2UgMDAgdG8gOTkpDQoJc1siJVkiXSA9IHk7CQkvLyB5ZWFyIHdpdGggdGhlIGNlbnR1cnkNCglzWyIlJSJdID0gIiUiOwkJLy8gYSBsaXRlcmFsICclJyBjaGFyYWN0ZXINCg0KCXZhciByZSA9IC8lLi9nOw0KCWlmICghQ2FsZW5kYXIuaXNfaWU1ICYmICFDYWxlbmRhci5pc19raHRtbCkNCgkJcmV0dXJuIHN0ci5yZXBsYWNlKHJlLCBmdW5jdGlvbiAocGFyKSB7IHJldHVybiBzW3Bhcl0gfHwgcGFyOyB9KTsNCg0KCXZhciBhID0gc3RyLm1hdGNoKHJlKTsNCglmb3IgKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHsNCgkJdmFyIHRtcCA9IHNbYVtpXV07DQoJCWlmICh0bXApIHsNCgkJCXJlID0gbmV3IFJlZ0V4cChhW2ldLCAnZycpOw0KCQkJc3RyID0gc3RyLnJlcGxhY2UocmUsIHRtcCk7DQoJCX0NCgl9DQoNCglyZXR1cm4gc3RyOw0KfTsNCg0KRGF0ZS5wcm90b3R5cGUuX19tc2hfb2xkU2V0RnVsbFllYXIgPSBEYXRlLnByb3RvdHlwZS5zZXRGdWxsWWVhcjsNCkRhdGUucHJvdG90eXBlLnNldEZ1bGxZZWFyID0gZnVuY3Rpb24oeSkgew0KCXZhciBkID0gbmV3IERhdGUodGhpcyk7DQoJZC5fX21zaF9vbGRTZXRGdWxsWWVhcih5KTsNCglpZiAoZC5nZXRNb250aCgpICE9IHRoaXMuZ2V0TW9udGgoKSkNCgkJdGhpcy5zZXREYXRlKDI4KTsNCgl0aGlzLl9fbXNoX29sZFNldEZ1bGxZZWFyKHkpOw0KfTsNCg0KLy8gRU5EOiBEQVRFIE9CSkVDVCBQQVRDSEVTDQoNCg0KLy8gZ2xvYmFsIG9iamVjdCB0aGF0IHJlbWVtYmVycyB0aGUgY2FsZW5kYXINCndpbmRvdy5fZHluYXJjaF9wb3B1cENhbGVuZGFyID0gbnVsbDsNCg==",
    "size": "51043"
}