{
    "namaFile": "pages\/admin\/menu\/assets\/js\/libs\/d3\/d3.v2.js",
    "lastUpdate": "2018-03-22+14:20:04.85",
    "contentFile": "KGZ1bmN0aW9uKCkgewogIGZ1bmN0aW9uIGQzX2NsYXNzKGN0b3IsIHByb3BlcnRpZXMpIHsKICAgIHRyeSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGN0b3IucHJvdG90eXBlLCBrZXksIHsKICAgICAgICAgIHZhbHVlOiBwcm9wZXJ0aWVzW2tleV0sCiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGN0b3IucHJvdG90eXBlID0gcHJvcGVydGllczsKICAgIH0KICB9CiAgZnVuY3Rpb24gZDNfYXJyYXlDb3B5KHBzZXVkb2FycmF5KSB7CiAgICB2YXIgaSA9IC0xLCBuID0gcHNldWRvYXJyYXkubGVuZ3RoLCBhcnJheSA9IFtdOwogICAgd2hpbGUgKCsraSA8IG4pIGFycmF5LnB1c2gocHNldWRvYXJyYXlbaV0pOwogICAgcmV0dXJuIGFycmF5OwogIH0KICBmdW5jdGlvbiBkM19hcnJheVNsaWNlKHBzZXVkb2FycmF5KSB7CiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwocHNldWRvYXJyYXkpOwogIH0KICBmdW5jdGlvbiBkM19NYXAoKSB7fQogIGZ1bmN0aW9uIGQzX2lkZW50aXR5KGQpIHsKICAgIHJldHVybiBkOwogIH0KICBmdW5jdGlvbiBkM190aGlzKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfQogIGZ1bmN0aW9uIGQzX3RydWUoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gZDNfZnVuY3Rvcih2KSB7CiAgICByZXR1cm4gdHlwZW9mIHYgPT09ICJmdW5jdGlvbiIgPyB2IDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB2OwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfcmViaW5kKHRhcmdldCwgc291cmNlLCBtZXRob2QpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHZhbHVlID0gbWV0aG9kLmFwcGx5KHNvdXJjZSwgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyB0YXJnZXQgOiB2YWx1ZTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX251bWJlcih4KSB7CiAgICByZXR1cm4geCAhPSBudWxsICYmICFpc05hTih4KTsKICB9CiAgZnVuY3Rpb24gZDNfemlwTGVuZ3RoKGQpIHsKICAgIHJldHVybiBkLmxlbmd0aDsKICB9CiAgZnVuY3Rpb24gZDNfc3BsaXR0ZXIoZCkgewogICAgcmV0dXJuIGQgPT0gbnVsbDsKICB9CiAgZnVuY3Rpb24gZDNfY29sbGFwc2UocykgewogICAgcmV0dXJuIHMudHJpbSgpLnJlcGxhY2UoL1xzKy9nLCAiICIpOwogIH0KICBmdW5jdGlvbiBkM19yYW5nZV9pbnRlZ2VyU2NhbGUoeCkgewogICAgdmFyIGsgPSAxOwogICAgd2hpbGUgKHggKiBrICUgMSkgayAqPSAxMDsKICAgIHJldHVybiBrOwogIH0KICBmdW5jdGlvbiBkM19kaXNwYXRjaCgpIHt9CiAgZnVuY3Rpb24gZDNfZGlzcGF0Y2hfZXZlbnQoZGlzcGF0Y2gpIHsKICAgIGZ1bmN0aW9uIGV2ZW50KCkgewogICAgICB2YXIgeiA9IGxpc3RlbmVycywgaSA9IC0xLCBuID0gei5sZW5ndGgsIGw7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAobCA9IHpbaV0ub24pIGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGRpc3BhdGNoOwogICAgfQogICAgdmFyIGxpc3RlbmVycyA9IFtdLCBsaXN0ZW5lckJ5TmFtZSA9IG5ldyBkM19NYXA7CiAgICBldmVudC5vbiA9IGZ1bmN0aW9uKG5hbWUsIGxpc3RlbmVyKSB7CiAgICAgIHZhciBsID0gbGlzdGVuZXJCeU5hbWUuZ2V0KG5hbWUpLCBpOwogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHJldHVybiBsICYmIGwub247CiAgICAgIGlmIChsKSB7CiAgICAgICAgbC5vbiA9IG51bGw7CiAgICAgICAgbGlzdGVuZXJzID0gbGlzdGVuZXJzLnNsaWNlKDAsIGkgPSBsaXN0ZW5lcnMuaW5kZXhPZihsKSkuY29uY2F0KGxpc3RlbmVycy5zbGljZShpICsgMSkpOwogICAgICAgIGxpc3RlbmVyQnlOYW1lLnJlbW92ZShuYW1lKTsKICAgICAgfQogICAgICBpZiAobGlzdGVuZXIpIGxpc3RlbmVycy5wdXNoKGxpc3RlbmVyQnlOYW1lLnNldChuYW1lLCB7CiAgICAgICAgb246IGxpc3RlbmVyCiAgICAgIH0pKTsKICAgICAgcmV0dXJuIGRpc3BhdGNoOwogICAgfTsKICAgIHJldHVybiBldmVudDsKICB9CiAgZnVuY3Rpb24gZDNfZm9ybWF0X3ByZWNpc2lvbih4LCBwKSB7CiAgICByZXR1cm4gcCAtICh4ID8gMSArIE1hdGguZmxvb3IoTWF0aC5sb2coeCArIE1hdGgucG93KDEwLCAxICsgTWF0aC5mbG9vcihNYXRoLmxvZyh4KSAvIE1hdGguTE4xMCkgLSBwKSkgLyBNYXRoLkxOMTApIDogMSk7CiAgfQogIGZ1bmN0aW9uIGQzX2Zvcm1hdF90eXBlRGVmYXVsdCh4KSB7CiAgICByZXR1cm4geCArICIiOwogIH0KICBmdW5jdGlvbiBkM19mb3JtYXRfZ3JvdXAodmFsdWUpIHsKICAgIHZhciBpID0gdmFsdWUubGFzdEluZGV4T2YoIi4iKSwgZiA9IGkgPj0gMCA\/IHZhbHVlLnN1YnN0cmluZyhpKSA6IChpID0gdmFsdWUubGVuZ3RoLCAiIiksIHQgPSBbXTsKICAgIHdoaWxlIChpID4gMCkgdC5wdXNoKHZhbHVlLnN1YnN0cmluZyhpIC09IDMsIGkgKyAzKSk7CiAgICByZXR1cm4gdC5yZXZlcnNlKCkuam9pbigiLCIpICsgZjsKICB9CiAgZnVuY3Rpb24gZDNfZm9ybWF0UHJlZml4KGQsIGkpIHsKICAgIHZhciBrID0gTWF0aC5wb3coMTAsIE1hdGguYWJzKDggLSBpKSAqIDMpOwogICAgcmV0dXJuIHsKICAgICAgc2NhbGU6IGkgPiA4ID8gZnVuY3Rpb24oZCkgewogICAgICAgIHJldHVybiBkIC8gazsKICAgICAgfSA6IGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gZCAqIGs7CiAgICAgIH0sCiAgICAgIHN5bWJvbDogZAogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9jbGFtcChmKSB7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gdCA8PSAwID8gMCA6IHQgPj0gMSA\/IDEgOiBmKHQpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9yZXZlcnNlKGYpIHsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiAxIC0gZigxIC0gdCk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19lYXNlX3JlZmxlY3QoZikgewogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIC41ICogKHQgPCAuNSA\/IGYoMiAqIHQpIDogMiAtIGYoMiAtIDIgKiB0KSk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19lYXNlX2lkZW50aXR5KHQpIHsKICAgIHJldHVybiB0OwogIH0KICBmdW5jdGlvbiBkM19lYXNlX3BvbHkoZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIE1hdGgucG93KHQsIGUpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9zaW4odCkgewogICAgcmV0dXJuIDEgLSBNYXRoLmNvcyh0ICogTWF0aC5QSSAvIDIpOwogIH0KICBmdW5jdGlvbiBkM19lYXNlX2V4cCh0KSB7CiAgICByZXR1cm4gTWF0aC5wb3coMiwgMTAgKiAodCAtIDEpKTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9jaXJjbGUodCkgewogICAgcmV0dXJuIDEgLSBNYXRoLnNxcnQoMSAtIHQgKiB0KTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9lbGFzdGljKGEsIHApIHsKICAgIHZhciBzOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSBwID0gLjQ1OwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKSB7CiAgICAgIGEgPSAxOwogICAgICBzID0gcCAvIDQ7CiAgICB9IGVsc2UgcyA9IHAgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKDEgLyBhKTsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiAxICsgYSAqIE1hdGgucG93KDIsIDEwICogLXQpICogTWF0aC5zaW4oKHQgLSBzKSAqIDIgKiBNYXRoLlBJIC8gcCk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19lYXNlX2JhY2socykgewogICAgaWYgKCFzKSBzID0gMS43MDE1ODsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiB0ICogdCAqICgocyArIDEpICogdCAtIHMpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZWFzZV9ib3VuY2UodCkgewogICAgcmV0dXJuIHQgPCAxIC8gMi43NSA\/IDcuNTYyNSAqIHQgKiB0IDogdCA8IDIgLyAyLjc1ID8gNy41NjI1ICogKHQgLT0gMS41IC8gMi43NSkgKiB0ICsgLjc1IDogdCA8IDIuNSAvIDIuNzUgPyA3LjU2MjUgKiAodCAtPSAyLjI1IC8gMi43NSkgKiB0ICsgLjkzNzUgOiA3LjU2MjUgKiAodCAtPSAyLjYyNSAvIDIuNzUpICogdCArIC45ODQzNzU7CiAgfQogIGZ1bmN0aW9uIGQzX2V2ZW50Q2FuY2VsKCkgewogICAgZDMuZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICBkMy5ldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogIH0KICBmdW5jdGlvbiBkM19ldmVudFNvdXJjZSgpIHsKICAgIHZhciBlID0gZDMuZXZlbnQsIHM7CiAgICB3aGlsZSAocyA9IGUuc291cmNlRXZlbnQpIGUgPSBzOwogICAgcmV0dXJuIGU7CiAgfQogIGZ1bmN0aW9uIGQzX2V2ZW50RGlzcGF0Y2godGFyZ2V0KSB7CiAgICB2YXIgZGlzcGF0Y2ggPSBuZXcgZDNfZGlzcGF0Y2gsIGkgPSAwLCBuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBkaXNwYXRjaFthcmd1bWVudHNbaV1dID0gZDNfZGlzcGF0Y2hfZXZlbnQoZGlzcGF0Y2gpOwogICAgZGlzcGF0Y2gub2YgPSBmdW5jdGlvbih0aGl6LCBhcmd1bWVudHopIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUxKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciBlMCA9IGUxLnNvdXJjZUV2ZW50ID0gZDMuZXZlbnQ7CiAgICAgICAgICBlMS50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICBkMy5ldmVudCA9IGUxOwogICAgICAgICAgZGlzcGF0Y2hbZTEudHlwZV0uYXBwbHkodGhpeiwgYXJndW1lbnR6KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgZDMuZXZlbnQgPSBlMDsKICAgICAgICB9CiAgICAgIH07CiAgICB9OwogICAgcmV0dXJuIGRpc3BhdGNoOwogIH0KICBmdW5jdGlvbiBkM190cmFuc2Zvcm0obSkgewogICAgdmFyIHIwID0gWyBtLmEsIG0uYiBdLCByMSA9IFsgbS5jLCBtLmQgXSwga3ggPSBkM190cmFuc2Zvcm1Ob3JtYWxpemUocjApLCBreiA9IGQzX3RyYW5zZm9ybURvdChyMCwgcjEpLCBreSA9IGQzX3RyYW5zZm9ybU5vcm1hbGl6ZShkM190cmFuc2Zvcm1Db21iaW5lKHIxLCByMCwgLWt6KSkgfHwgMDsKICAgIGlmIChyMFswXSAqIHIxWzFdIDwgcjFbMF0gKiByMFsxXSkgewogICAgICByMFswXSAqPSAtMTsKICAgICAgcjBbMV0gKj0gLTE7CiAgICAgIGt4ICo9IC0xOwogICAgICBreiAqPSAtMTsKICAgIH0KICAgIHRoaXMucm90YXRlID0gKGt4ID8gTWF0aC5hdGFuMihyMFsxXSwgcjBbMF0pIDogTWF0aC5hdGFuMigtcjFbMF0sIHIxWzFdKSkgKiBkM190cmFuc2Zvcm1EZWdyZWVzOwogICAgdGhpcy50cmFuc2xhdGUgPSBbIG0uZSwgbS5mIF07CiAgICB0aGlzLnNjYWxlID0gWyBreCwga3kgXTsKICAgIHRoaXMuc2tldyA9IGt5ID8gTWF0aC5hdGFuMihreiwga3kpICogZDNfdHJhbnNmb3JtRGVncmVlcyA6IDA7CiAgfQogIGZ1bmN0aW9uIGQzX3RyYW5zZm9ybURvdChhLCBiKSB7CiAgICByZXR1cm4gYVswXSAqIGJbMF0gKyBhWzFdICogYlsxXTsKICB9CiAgZnVuY3Rpb24gZDNfdHJhbnNmb3JtTm9ybWFsaXplKGEpIHsKICAgIHZhciBrID0gTWF0aC5zcXJ0KGQzX3RyYW5zZm9ybURvdChhLCBhKSk7CiAgICBpZiAoaykgewogICAgICBhWzBdIC89IGs7CiAgICAgIGFbMV0gLz0gazsKICAgIH0KICAgIHJldHVybiBrOwogIH0KICBmdW5jdGlvbiBkM190cmFuc2Zvcm1Db21iaW5lKGEsIGIsIGspIHsKICAgIGFbMF0gKz0gayAqIGJbMF07CiAgICBhWzFdICs9IGsgKiBiWzFdOwogICAgcmV0dXJuIGE7CiAgfQogIGZ1bmN0aW9uIGQzX2ludGVycG9sYXRlQnlOYW1lKG5hbWUpIHsKICAgIHJldHVybiBuYW1lID09ICJ0cmFuc2Zvcm0iID8gZDMuaW50ZXJwb2xhdGVUcmFuc2Zvcm0gOiBkMy5pbnRlcnBvbGF0ZTsKICB9CiAgZnVuY3Rpb24gZDNfdW5pbnRlcnBvbGF0ZU51bWJlcihhLCBiKSB7CiAgICBiID0gYiAtIChhID0gK2EpID8gMSAvIChiIC0gYSkgOiAwOwogICAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuICh4IC0gYSkgKiBiOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfdW5pbnRlcnBvbGF0ZUNsYW1wKGEsIGIpIHsKICAgIGIgPSBiIC0gKGEgPSArYSkgPyAxIC8gKGIgLSBhKSA6IDA7CiAgICByZXR1cm4gZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgKHggLSBhKSAqIGIpKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX0NvbG9yKCkge30KICBmdW5jdGlvbiBkM19yZ2IociwgZywgYikgewogICAgcmV0dXJuIG5ldyBkM19SZ2IociwgZywgYik7CiAgfQogIGZ1bmN0aW9uIGQzX1JnYihyLCBnLCBiKSB7CiAgICB0aGlzLnIgPSByOwogICAgdGhpcy5nID0gZzsKICAgIHRoaXMuYiA9IGI7CiAgfQogIGZ1bmN0aW9uIGQzX3JnYl9oZXgodikgewogICAgcmV0dXJuIHYgPCAxNiA\/ICIwIiArIE1hdGgubWF4KDAsIHYpLnRvU3RyaW5nKDE2KSA6IE1hdGgubWluKDI1NSwgdikudG9TdHJpbmcoMTYpOwogIH0KICBmdW5jdGlvbiBkM19yZ2JfcGFyc2UoZm9ybWF0LCByZ2IsIGhzbCkgewogICAgdmFyIHIgPSAwLCBnID0gMCwgYiA9IDAsIG0xLCBtMiwgbmFtZTsKICAgIG0xID0gLyhbYS16XSspXCgoLiopXCkvaS5leGVjKGZvcm1hdCk7CiAgICBpZiAobTEpIHsKICAgICAgbTIgPSBtMVsyXS5zcGxpdCgiLCIpOwogICAgICBzd2l0Y2ggKG0xWzFdKSB7CiAgICAgICBjYXNlICJoc2wiOgogICAgICAgIHsKICAgICAgICAgIHJldHVybiBoc2wocGFyc2VGbG9hdChtMlswXSksIHBhcnNlRmxvYXQobTJbMV0pIC8gMTAwLCBwYXJzZUZsb2F0KG0yWzJdKSAvIDEwMCk7CiAgICAgICAgfQogICAgICAgY2FzZSAicmdiIjoKICAgICAgICB7CiAgICAgICAgICByZXR1cm4gcmdiKGQzX3JnYl9wYXJzZU51bWJlcihtMlswXSksIGQzX3JnYl9wYXJzZU51bWJlcihtMlsxXSksIGQzX3JnYl9wYXJzZU51bWJlcihtMlsyXSkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG5hbWUgPSBkM19yZ2JfbmFtZXMuZ2V0KGZvcm1hdCkpIHJldHVybiByZ2IobmFtZS5yLCBuYW1lLmcsIG5hbWUuYik7CiAgICBpZiAoZm9ybWF0ICE9IG51bGwgJiYgZm9ybWF0LmNoYXJBdCgwKSA9PT0gIiMiKSB7CiAgICAgIGlmIChmb3JtYXQubGVuZ3RoID09PSA0KSB7CiAgICAgICAgciA9IGZvcm1hdC5jaGFyQXQoMSk7CiAgICAgICAgciArPSByOwogICAgICAgIGcgPSBmb3JtYXQuY2hhckF0KDIpOwogICAgICAgIGcgKz0gZzsKICAgICAgICBiID0gZm9ybWF0LmNoYXJBdCgzKTsKICAgICAgICBiICs9IGI7CiAgICAgIH0gZWxzZSBpZiAoZm9ybWF0Lmxlbmd0aCA9PT0gNykgewogICAgICAgIHIgPSBmb3JtYXQuc3Vic3RyaW5nKDEsIDMpOwogICAgICAgIGcgPSBmb3JtYXQuc3Vic3RyaW5nKDMsIDUpOwogICAgICAgIGIgPSBmb3JtYXQuc3Vic3RyaW5nKDUsIDcpOwogICAgICB9CiAgICAgIHIgPSBwYXJzZUludChyLCAxNik7CiAgICAgIGcgPSBwYXJzZUludChnLCAxNik7CiAgICAgIGIgPSBwYXJzZUludChiLCAxNik7CiAgICB9CiAgICByZXR1cm4gcmdiKHIsIGcsIGIpOwogIH0KICBmdW5jdGlvbiBkM19yZ2JfaHNsKHIsIGcsIGIpIHsKICAgIHZhciBtaW4gPSBNYXRoLm1pbihyIC89IDI1NSwgZyAvPSAyNTUsIGIgLz0gMjU1KSwgbWF4ID0gTWF0aC5tYXgociwgZywgYiksIGQgPSBtYXggLSBtaW4sIGgsIHMsIGwgPSAobWF4ICsgbWluKSAvIDI7CiAgICBpZiAoZCkgewogICAgICBzID0gbCA8IC41ID8gZCAvIChtYXggKyBtaW4pIDogZCAvICgyIC0gbWF4IC0gbWluKTsKICAgICAgaWYgKHIgPT0gbWF4KSBoID0gKGcgLSBiKSAvIGQgKyAoZyA8IGIgPyA2IDogMCk7IGVsc2UgaWYgKGcgPT0gbWF4KSBoID0gKGIgLSByKSAvIGQgKyAyOyBlbHNlIGggPSAociAtIGcpIC8gZCArIDQ7CiAgICAgIGggKj0gNjA7CiAgICB9IGVsc2UgewogICAgICBzID0gaCA9IDA7CiAgICB9CiAgICByZXR1cm4gZDNfaHNsKGgsIHMsIGwpOwogIH0KICBmdW5jdGlvbiBkM19yZ2JfbGFiKHIsIGcsIGIpIHsKICAgIHIgPSBkM19yZ2JfeHl6KHIpOwogICAgZyA9IGQzX3JnYl94eXooZyk7CiAgICBiID0gZDNfcmdiX3h5eihiKTsKICAgIHZhciB4ID0gZDNfeHl6X2xhYigoLjQxMjQ1NjQgKiByICsgLjM1NzU3NjEgKiBnICsgLjE4MDQzNzUgKiBiKSAvIGQzX2xhYl9YKSwgeSA9IGQzX3h5el9sYWIoKC4yMTI2NzI5ICogciArIC43MTUxNTIyICogZyArIC4wNzIxNzUgKiBiKSAvIGQzX2xhYl9ZKSwgeiA9IGQzX3h5el9sYWIoKC4wMTkzMzM5ICogciArIC4xMTkxOTIgKiBnICsgLjk1MDMwNDEgKiBiKSAvIGQzX2xhYl9aKTsKICAgIHJldHVybiBkM19sYWIoMTE2ICogeSAtIDE2LCA1MDAgKiAoeCAtIHkpLCAyMDAgKiAoeSAtIHopKTsKICB9CiAgZnVuY3Rpb24gZDNfcmdiX3h5eihyKSB7CiAgICByZXR1cm4gKHIgLz0gMjU1KSA8PSAuMDQwNDUgPyByIC8gMTIuOTIgOiBNYXRoLnBvdygociArIC4wNTUpIC8gMS4wNTUsIDIuNCk7CiAgfQogIGZ1bmN0aW9uIGQzX3JnYl9wYXJzZU51bWJlcihjKSB7CiAgICB2YXIgZiA9IHBhcnNlRmxvYXQoYyk7CiAgICByZXR1cm4gYy5jaGFyQXQoYy5sZW5ndGggLSAxKSA9PT0gIiUiID8gTWF0aC5yb3VuZChmICogMi41NSkgOiBmOwogIH0KICBmdW5jdGlvbiBkM19oc2woaCwgcywgbCkgewogICAgcmV0dXJuIG5ldyBkM19Ic2woaCwgcywgbCk7CiAgfQogIGZ1bmN0aW9uIGQzX0hzbChoLCBzLCBsKSB7CiAgICB0aGlzLmggPSBoOwogICAgdGhpcy5zID0gczsKICAgIHRoaXMubCA9IGw7CiAgfQogIGZ1bmN0aW9uIGQzX2hzbF9yZ2IoaCwgcywgbCkgewogICAgZnVuY3Rpb24gdihoKSB7CiAgICAgIGlmIChoID4gMzYwKSBoIC09IDM2MDsgZWxzZSBpZiAoaCA8IDApIGggKz0gMzYwOwogICAgICBpZiAoaCA8IDYwKSByZXR1cm4gbTEgKyAobTIgLSBtMSkgKiBoIC8gNjA7CiAgICAgIGlmIChoIDwgMTgwKSByZXR1cm4gbTI7CiAgICAgIGlmIChoIDwgMjQwKSByZXR1cm4gbTEgKyAobTIgLSBtMSkgKiAoMjQwIC0gaCkgLyA2MDsKICAgICAgcmV0dXJuIG0xOwogICAgfQogICAgZnVuY3Rpb24gdnYoaCkgewogICAgICByZXR1cm4gTWF0aC5yb3VuZCh2KGgpICogMjU1KTsKICAgIH0KICAgIHZhciBtMSwgbTI7CiAgICBoID0gaCAlIDM2MDsKICAgIGlmIChoIDwgMCkgaCArPSAzNjA7CiAgICBzID0gcyA8IDAgPyAwIDogcyA+IDEgPyAxIDogczsKICAgIGwgPSBsIDwgMCA\/IDAgOiBsID4gMSA\/IDEgOiBsOwogICAgbTIgPSBsIDw9IC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzOwogICAgbTEgPSAyICogbCAtIG0yOwogICAgcmV0dXJuIGQzX3JnYih2dihoICsgMTIwKSwgdnYoaCksIHZ2KGggLSAxMjApKTsKICB9CiAgZnVuY3Rpb24gZDNfaGNsKGgsIGMsIGwpIHsKICAgIHJldHVybiBuZXcgZDNfSGNsKGgsIGMsIGwpOwogIH0KICBmdW5jdGlvbiBkM19IY2woaCwgYywgbCkgewogICAgdGhpcy5oID0gaDsKICAgIHRoaXMuYyA9IGM7CiAgICB0aGlzLmwgPSBsOwogIH0KICBmdW5jdGlvbiBkM19oY2xfbGFiKGgsIGMsIGwpIHsKICAgIHJldHVybiBkM19sYWIobCwgTWF0aC5jb3MoaCAqPSBNYXRoLlBJIC8gMTgwKSAqIGMsIE1hdGguc2luKGgpICogYyk7CiAgfQogIGZ1bmN0aW9uIGQzX2xhYihsLCBhLCBiKSB7CiAgICByZXR1cm4gbmV3IGQzX0xhYihsLCBhLCBiKTsKICB9CiAgZnVuY3Rpb24gZDNfTGFiKGwsIGEsIGIpIHsKICAgIHRoaXMubCA9IGw7CiAgICB0aGlzLmEgPSBhOwogICAgdGhpcy5iID0gYjsKICB9CiAgZnVuY3Rpb24gZDNfbGFiX3JnYihsLCBhLCBiKSB7CiAgICB2YXIgeSA9IChsICsgMTYpIC8gMTE2LCB4ID0geSArIGEgLyA1MDAsIHogPSB5IC0gYiAvIDIwMDsKICAgIHggPSBkM19sYWJfeHl6KHgpICogZDNfbGFiX1g7CiAgICB5ID0gZDNfbGFiX3h5eih5KSAqIGQzX2xhYl9ZOwogICAgeiA9IGQzX2xhYl94eXooeikgKiBkM19sYWJfWjsKICAgIHJldHVybiBkM19yZ2IoZDNfeHl6X3JnYigzLjI0MDQ1NDIgKiB4IC0gMS41MzcxMzg1ICogeSAtIC40OTg1MzE0ICogeiksIGQzX3h5el9yZ2IoLS45NjkyNjYgKiB4ICsgMS44NzYwMTA4ICogeSArIC4wNDE1NTYgKiB6KSwgZDNfeHl6X3JnYiguMDU1NjQzNCAqIHggLSAuMjA0MDI1OSAqIHkgKyAxLjA1NzIyNTIgKiB6KSk7CiAgfQogIGZ1bmN0aW9uIGQzX2xhYl9oY2wobCwgYSwgYikgewogICAgcmV0dXJuIGQzX2hjbChNYXRoLmF0YW4yKGIsIGEpIC8gTWF0aC5QSSAqIDE4MCwgTWF0aC5zcXJ0KGEgKiBhICsgYiAqIGIpLCBsKTsKICB9CiAgZnVuY3Rpb24gZDNfbGFiX3h5eih4KSB7CiAgICByZXR1cm4geCA+IC4yMDY4OTMwMzQgPyB4ICogeCAqIHggOiAoeCAtIDQgLyAyOSkgLyA3Ljc4NzAzNzsKICB9CiAgZnVuY3Rpb24gZDNfeHl6X2xhYih4KSB7CiAgICByZXR1cm4geCA+IC4wMDg4NTYgPyBNYXRoLnBvdyh4LCAxIC8gMykgOiA3Ljc4NzAzNyAqIHggKyA0IC8gMjk7CiAgfQogIGZ1bmN0aW9uIGQzX3h5el9yZ2IocikgewogICAgcmV0dXJuIE1hdGgucm91bmQoMjU1ICogKHIgPD0gLjAwMzA0ID8gMTIuOTIgKiByIDogMS4wNTUgKiBNYXRoLnBvdyhyLCAxIC8gMi40KSAtIC4wNTUpKTsKICB9CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uKGdyb3VwcykgewogICAgZDNfYXJyYXlTdWJjbGFzcyhncm91cHMsIGQzX3NlbGVjdGlvblByb3RvdHlwZSk7CiAgICByZXR1cm4gZ3JvdXBzOwogIH0KICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fc2VsZWN0b3Ioc2VsZWN0b3IpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NlbGVjdChzZWxlY3RvciwgdGhpcyk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fc2VsZWN0b3JBbGwoc2VsZWN0b3IpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NlbGVjdEFsbChzZWxlY3RvciwgdGhpcyk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fYXR0cihuYW1lLCB2YWx1ZSkgewogICAgZnVuY3Rpb24gYXR0ck51bGwoKSB7CiAgICAgIHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ck51bGxOUygpIHsKICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsKTsKICAgIH0KICAgIGZ1bmN0aW9uIGF0dHJDb25zdGFudCgpIHsKICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ckNvbnN0YW50TlMoKSB7CiAgICAgIHRoaXMuc2V0QXR0cmlidXRlTlMobmFtZS5zcGFjZSwgbmFtZS5sb2NhbCwgdmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ckZ1bmN0aW9uKCkgewogICAgICB2YXIgeCA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIGlmICh4ID09IG51bGwpIHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUpOyBlbHNlIHRoaXMuc2V0QXR0cmlidXRlKG5hbWUsIHgpOwogICAgfQogICAgZnVuY3Rpb24gYXR0ckZ1bmN0aW9uTlMoKSB7CiAgICAgIHZhciB4ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaWYgKHggPT0gbnVsbCkgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsKTsgZWxzZSB0aGlzLnNldEF0dHJpYnV0ZU5TKG5hbWUuc3BhY2UsIG5hbWUubG9jYWwsIHgpOwogICAgfQogICAgbmFtZSA9IGQzLm5zLnF1YWxpZnkobmFtZSk7CiAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA\/IG5hbWUubG9jYWwgPyBhdHRyTnVsbE5TIDogYXR0ck51bGwgOiB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIgPyBuYW1lLmxvY2FsID8gYXR0ckZ1bmN0aW9uTlMgOiBhdHRyRnVuY3Rpb24gOiBuYW1lLmxvY2FsID8gYXR0ckNvbnN0YW50TlMgOiBhdHRyQ29uc3RhbnQ7CiAgfQogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9jbGFzc2VkUmUobmFtZSkgewogICAgcmV0dXJuIG5ldyBSZWdFeHAoIig\/Ol58XFxzKykiICsgZDMucmVxdW90ZShuYW1lKSArICIoPzpcXHMrfCQpIiwgImciKTsKICB9CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2NsYXNzZWQobmFtZSwgdmFsdWUpIHsKICAgIGZ1bmN0aW9uIGNsYXNzZWRDb25zdGFudCgpIHsKICAgICAgdmFyIGkgPSAtMTsKICAgICAgd2hpbGUgKCsraSA8IG4pIG5hbWVbaV0odGhpcywgdmFsdWUpOwogICAgfQogICAgZnVuY3Rpb24gY2xhc3NlZEZ1bmN0aW9uKCkgewogICAgICB2YXIgaSA9IC0xLCB4ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgd2hpbGUgKCsraSA8IG4pIG5hbWVbaV0odGhpcywgeCk7CiAgICB9CiAgICBuYW1lID0gbmFtZS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcChkM19zZWxlY3Rpb25fY2xhc3NlZE5hbWUpOwogICAgdmFyIG4gPSBuYW1lLmxlbmd0aDsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIgPyBjbGFzc2VkRnVuY3Rpb24gOiBjbGFzc2VkQ29uc3RhbnQ7CiAgfQogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9jbGFzc2VkTmFtZShuYW1lKSB7CiAgICB2YXIgcmUgPSBkM19zZWxlY3Rpb25fY2xhc3NlZFJlKG5hbWUpOwogICAgcmV0dXJuIGZ1bmN0aW9uKG5vZGUsIHZhbHVlKSB7CiAgICAgIGlmIChjID0gbm9kZS5jbGFzc0xpc3QpIHJldHVybiB2YWx1ZSA\/IGMuYWRkKG5hbWUpIDogYy5yZW1vdmUobmFtZSk7CiAgICAgIHZhciBjID0gbm9kZS5jbGFzc05hbWUsIGNiID0gYy5iYXNlVmFsICE9IG51bGwsIGN2ID0gY2IgPyBjLmJhc2VWYWwgOiBjOwogICAgICBpZiAodmFsdWUpIHsKICAgICAgICByZS5sYXN0SW5kZXggPSAwOwogICAgICAgIGlmICghcmUudGVzdChjdikpIHsKICAgICAgICAgIGN2ID0gZDNfY29sbGFwc2UoY3YgKyAiICIgKyBuYW1lKTsKICAgICAgICAgIGlmIChjYikgYy5iYXNlVmFsID0gY3Y7IGVsc2Ugbm9kZS5jbGFzc05hbWUgPSBjdjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY3YpIHsKICAgICAgICBjdiA9IGQzX2NvbGxhcHNlKGN2LnJlcGxhY2UocmUsICIgIikpOwogICAgICAgIGlmIChjYikgYy5iYXNlVmFsID0gY3Y7IGVsc2Ugbm9kZS5jbGFzc05hbWUgPSBjdjsKICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX3N0eWxlKG5hbWUsIHZhbHVlLCBwcmlvcml0eSkgewogICAgZnVuY3Rpb24gc3R5bGVOdWxsKCkgewogICAgICB0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KG5hbWUpOwogICAgfQogICAgZnVuY3Rpb24gc3R5bGVDb25zdGFudCgpIHsKICAgICAgdGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuYW1lLCB2YWx1ZSwgcHJpb3JpdHkpOwogICAgfQogICAgZnVuY3Rpb24gc3R5bGVGdW5jdGlvbigpIHsKICAgICAgdmFyIHggPSB2YWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBpZiAoeCA9PSBudWxsKSB0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KG5hbWUpOyBlbHNlIHRoaXMuc3R5bGUuc2V0UHJvcGVydHkobmFtZSwgeCwgcHJpb3JpdHkpOwogICAgfQogICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyBzdHlsZU51bGwgOiB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIgPyBzdHlsZUZ1bmN0aW9uIDogc3R5bGVDb25zdGFudDsKICB9CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX3Byb3BlcnR5KG5hbWUsIHZhbHVlKSB7CiAgICBmdW5jdGlvbiBwcm9wZXJ0eU51bGwoKSB7CiAgICAgIGRlbGV0ZSB0aGlzW25hbWVdOwogICAgfQogICAgZnVuY3Rpb24gcHJvcGVydHlDb25zdGFudCgpIHsKICAgICAgdGhpc1tuYW1lXSA9IHZhbHVlOwogICAgfQogICAgZnVuY3Rpb24gcHJvcGVydHlGdW5jdGlvbigpIHsKICAgICAgdmFyIHggPSB2YWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBpZiAoeCA9PSBudWxsKSBkZWxldGUgdGhpc1tuYW1lXTsgZWxzZSB0aGlzW25hbWVdID0geDsKICAgIH0KICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gcHJvcGVydHlOdWxsIDogdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iID8gcHJvcGVydHlGdW5jdGlvbiA6IHByb3BlcnR5Q29uc3RhbnQ7CiAgfQogIGZ1bmN0aW9uIGQzX3NlbGVjdGlvbl9kYXRhTm9kZShkYXRhKSB7CiAgICByZXR1cm4gewogICAgICBfX2RhdGFfXzogZGF0YQogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2ZpbHRlcihzZWxlY3RvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2VsZWN0TWF0Y2hlcyh0aGlzLCBzZWxlY3Rvcik7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fc29ydENvbXBhcmF0b3IoY29tcGFyYXRvcikgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSBjb21wYXJhdG9yID0gZDMuYXNjZW5kaW5nOwogICAgcmV0dXJuIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuIGNvbXBhcmF0b3IoYSAmJiBhLl9fZGF0YV9fLCBiICYmIGIuX19kYXRhX18pOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX29uKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSB7CiAgICBmdW5jdGlvbiBvblJlbW92ZSgpIHsKICAgICAgdmFyIHdyYXBwZXIgPSB0aGlzW25hbWVdOwogICAgICBpZiAod3JhcHBlcikgewogICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCB3cmFwcGVyLCB3cmFwcGVyLiQpOwogICAgICAgIGRlbGV0ZSB0aGlzW25hbWVdOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBvbkFkZCgpIHsKICAgICAgZnVuY3Rpb24gd3JhcHBlcihlKSB7CiAgICAgICAgdmFyIG8gPSBkMy5ldmVudDsKICAgICAgICBkMy5ldmVudCA9IGU7CiAgICAgICAgYXJnc1swXSA9IG5vZGUuX19kYXRhX187CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGxpc3RlbmVyLmFwcGx5KG5vZGUsIGFyZ3MpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBkMy5ldmVudCA9IG87CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBub2RlID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsKICAgICAgb25SZW1vdmUuY2FsbCh0aGlzKTsKICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKHR5cGUsIHRoaXNbbmFtZV0gPSB3cmFwcGVyLCB3cmFwcGVyLiQgPSBjYXB0dXJlKTsKICAgICAgd3JhcHBlci5fID0gbGlzdGVuZXI7CiAgICB9CiAgICB2YXIgbmFtZSA9ICJfX29uIiArIHR5cGUsIGkgPSB0eXBlLmluZGV4T2YoIi4iKTsKICAgIGlmIChpID4gMCkgdHlwZSA9IHR5cGUuc3Vic3RyaW5nKDAsIGkpOwogICAgcmV0dXJuIGxpc3RlbmVyID8gb25BZGQgOiBvblJlbW92ZTsKICB9CiAgZnVuY3Rpb24gZDNfc2VsZWN0aW9uX2VhY2goZ3JvdXBzLCBjYWxsYmFjaykgewogICAgZm9yICh2YXIgaiA9IDAsIG0gPSBncm91cHMubGVuZ3RoOyBqIDwgbTsgaisrKSB7CiAgICAgIGZvciAodmFyIGdyb3VwID0gZ3JvdXBzW2pdLCBpID0gMCwgbiA9IGdyb3VwLmxlbmd0aCwgbm9kZTsgaSA8IG47IGkrKykgewogICAgICAgIGlmIChub2RlID0gZ3JvdXBbaV0pIGNhbGxiYWNrKG5vZGUsIGksIGopOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZ3JvdXBzOwogIH0KICBmdW5jdGlvbiBkM19zZWxlY3Rpb25fZW50ZXIoc2VsZWN0aW9uKSB7CiAgICBkM19hcnJheVN1YmNsYXNzKHNlbGVjdGlvbiwgZDNfc2VsZWN0aW9uX2VudGVyUHJvdG90eXBlKTsKICAgIHJldHVybiBzZWxlY3Rpb247CiAgfQogIGZ1bmN0aW9uIGQzX3RyYW5zaXRpb24oZ3JvdXBzLCBpZCwgdGltZSkgewogICAgZDNfYXJyYXlTdWJjbGFzcyhncm91cHMsIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUpOwogICAgdmFyIHR3ZWVucyA9IG5ldyBkM19NYXAsIGV2ZW50ID0gZDMuZGlzcGF0Y2goInN0YXJ0IiwgImVuZCIpLCBlYXNlID0gZDNfdHJhbnNpdGlvbkVhc2U7CiAgICBncm91cHMuaWQgPSBpZDsKICAgIGdyb3Vwcy50aW1lID0gdGltZTsKICAgIGdyb3Vwcy50d2VlbiA9IGZ1bmN0aW9uKG5hbWUsIHR3ZWVuKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgcmV0dXJuIHR3ZWVucy5nZXQobmFtZSk7CiAgICAgIGlmICh0d2VlbiA9PSBudWxsKSB0d2VlbnMucmVtb3ZlKG5hbWUpOyBlbHNlIHR3ZWVucy5zZXQobmFtZSwgdHdlZW4pOwogICAgICByZXR1cm4gZ3JvdXBzOwogICAgfTsKICAgIGdyb3Vwcy5lYXNlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZWFzZTsKICAgICAgZWFzZSA9IHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIiA\/IHZhbHVlIDogZDMuZWFzZS5hcHBseShkMywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGdyb3VwczsKICAgIH07CiAgICBncm91cHMuZWFjaCA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgcmV0dXJuIGQzX3RyYW5zaXRpb25fZWFjaC5jYWxsKGdyb3VwcywgdHlwZSk7CiAgICAgIGV2ZW50Lm9uKHR5cGUsIGxpc3RlbmVyKTsKICAgICAgcmV0dXJuIGdyb3VwczsKICAgIH07CiAgICBkMy50aW1lcihmdW5jdGlvbihlbGFwc2VkKSB7CiAgICAgIHJldHVybiBkM19zZWxlY3Rpb25fZWFjaChncm91cHMsIGZ1bmN0aW9uKG5vZGUsIGksIGopIHsKICAgICAgICBmdW5jdGlvbiBzdGFydChlbGFwc2VkKSB7CiAgICAgICAgICBpZiAobG9jay5hY3RpdmUgPiBpZCkgcmV0dXJuIHN0b3AoKTsKICAgICAgICAgIGxvY2suYWN0aXZlID0gaWQ7CiAgICAgICAgICB0d2VlbnMuZm9yRWFjaChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSA9IHZhbHVlLmNhbGwobm9kZSwgZCwgaSkpIHsKICAgICAgICAgICAgICB0d2VlbmVkLnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGV2ZW50LnN0YXJ0LmNhbGwobm9kZSwgZCwgaSk7CiAgICAgICAgICBpZiAoIXRpY2soZWxhcHNlZCkpIGQzLnRpbWVyKHRpY2ssIDAsIHRpbWUpOwogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRpY2soZWxhcHNlZCkgewogICAgICAgICAgaWYgKGxvY2suYWN0aXZlICE9PSBpZCkgcmV0dXJuIHN0b3AoKTsKICAgICAgICAgIHZhciB0ID0gKGVsYXBzZWQgLSBkZWxheSkgLyBkdXJhdGlvbiwgZSA9IGVhc2UodCksIG4gPSB0d2VlbmVkLmxlbmd0aDsKICAgICAgICAgIHdoaWxlIChuID4gMCkgewogICAgICAgICAgICB0d2VlbmVkWy0tbl0uY2FsbChub2RlLCBlKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0ID49IDEpIHsKICAgICAgICAgICAgc3RvcCgpOwogICAgICAgICAgICBkM190cmFuc2l0aW9uSWQgPSBpZDsKICAgICAgICAgICAgZXZlbnQuZW5kLmNhbGwobm9kZSwgZCwgaSk7CiAgICAgICAgICAgIGQzX3RyYW5zaXRpb25JZCA9IDA7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzdG9wKCkgewogICAgICAgICAgaWYgKCEtLWxvY2suY291bnQpIGRlbGV0ZSBub2RlLl9fdHJhbnNpdGlvbl9fOwogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIHZhciB0d2VlbmVkID0gW10sIGRlbGF5ID0gbm9kZS5kZWxheSwgZHVyYXRpb24gPSBub2RlLmR1cmF0aW9uLCBsb2NrID0gKG5vZGUgPSBub2RlLm5vZGUpLl9fdHJhbnNpdGlvbl9fIHx8IChub2RlLl9fdHJhbnNpdGlvbl9fID0gewogICAgICAgICAgYWN0aXZlOiAwLAogICAgICAgICAgY291bnQ6IDAKICAgICAgICB9KSwgZCA9IG5vZGUuX19kYXRhX187CiAgICAgICAgKytsb2NrLmNvdW50OwogICAgICAgIGRlbGF5IDw9IGVsYXBzZWQgPyBzdGFydChlbGFwc2VkKSA6IGQzLnRpbWVyKHN0YXJ0LCBkZWxheSwgdGltZSk7CiAgICAgIH0pOwogICAgfSwgMCwgdGltZSk7CiAgICByZXR1cm4gZ3JvdXBzOwogIH0KICBmdW5jdGlvbiBkM190cmFuc2l0aW9uX2VhY2goY2FsbGJhY2spIHsKICAgIHZhciBpZCA9IGQzX3RyYW5zaXRpb25JZCwgZWFzZSA9IGQzX3RyYW5zaXRpb25FYXNlLCBkZWxheSA9IGQzX3RyYW5zaXRpb25EZWxheSwgZHVyYXRpb24gPSBkM190cmFuc2l0aW9uRHVyYXRpb247CiAgICBkM190cmFuc2l0aW9uSWQgPSB0aGlzLmlkOwogICAgZDNfdHJhbnNpdGlvbkVhc2UgPSB0aGlzLmVhc2UoKTsKICAgIGQzX3NlbGVjdGlvbl9lYWNoKHRoaXMsIGZ1bmN0aW9uKG5vZGUsIGksIGopIHsKICAgICAgZDNfdHJhbnNpdGlvbkRlbGF5ID0gbm9kZS5kZWxheTsKICAgICAgZDNfdHJhbnNpdGlvbkR1cmF0aW9uID0gbm9kZS5kdXJhdGlvbjsKICAgICAgY2FsbGJhY2suY2FsbChub2RlID0gbm9kZS5ub2RlLCBub2RlLl9fZGF0YV9fLCBpLCBqKTsKICAgIH0pOwogICAgZDNfdHJhbnNpdGlvbklkID0gaWQ7CiAgICBkM190cmFuc2l0aW9uRWFzZSA9IGVhc2U7CiAgICBkM190cmFuc2l0aW9uRGVsYXkgPSBkZWxheTsKICAgIGQzX3RyYW5zaXRpb25EdXJhdGlvbiA9IGR1cmF0aW9uOwogICAgcmV0dXJuIHRoaXM7CiAgfQogIGZ1bmN0aW9uIGQzX3R3ZWVuTnVsbChkLCBpLCBhKSB7CiAgICByZXR1cm4gYSAhPSAiIiAmJiBkM190d2VlblJlbW92ZTsKICB9CiAgZnVuY3Rpb24gZDNfdHdlZW5CeU5hbWUoYiwgbmFtZSkgewogICAgcmV0dXJuIGQzLnR3ZWVuKGIsIGQzX2ludGVycG9sYXRlQnlOYW1lKG5hbWUpKTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZXJfc3RlcCgpIHsKICAgIHZhciBlbGFwc2VkLCBub3cgPSBEYXRlLm5vdygpLCB0MSA9IGQzX3RpbWVyX3F1ZXVlOwogICAgd2hpbGUgKHQxKSB7CiAgICAgIGVsYXBzZWQgPSBub3cgLSB0MS50aGVuOwogICAgICBpZiAoZWxhcHNlZCA+PSB0MS5kZWxheSkgdDEuZmx1c2ggPSB0MS5jYWxsYmFjayhlbGFwc2VkKTsKICAgICAgdDEgPSB0MS5uZXh0OwogICAgfQogICAgdmFyIGRlbGF5ID0gZDNfdGltZXJfZmx1c2goKSAtIG5vdzsKICAgIGlmIChkZWxheSA+IDI0KSB7CiAgICAgIGlmIChpc0Zpbml0ZShkZWxheSkpIHsKICAgICAgICBjbGVhclRpbWVvdXQoZDNfdGltZXJfdGltZW91dCk7CiAgICAgICAgZDNfdGltZXJfdGltZW91dCA9IHNldFRpbWVvdXQoZDNfdGltZXJfc3RlcCwgZGVsYXkpOwogICAgICB9CiAgICAgIGQzX3RpbWVyX2ludGVydmFsID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGQzX3RpbWVyX2ludGVydmFsID0gMTsKICAgICAgZDNfdGltZXJfZnJhbWUoZDNfdGltZXJfc3RlcCk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVyX2ZsdXNoKCkgewogICAgdmFyIHQwID0gbnVsbCwgdDEgPSBkM190aW1lcl9xdWV1ZSwgdGhlbiA9IEluZmluaXR5OwogICAgd2hpbGUgKHQxKSB7CiAgICAgIGlmICh0MS5mbHVzaCkgewogICAgICAgIGRlbGV0ZSBkM190aW1lcl9ieUlkW3QxLmNhbGxiYWNrLmlkXTsKICAgICAgICB0MSA9IHQwID8gdDAubmV4dCA9IHQxLm5leHQgOiBkM190aW1lcl9xdWV1ZSA9IHQxLm5leHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhlbiA9IE1hdGgubWluKHRoZW4sIHQxLnRoZW4gKyB0MS5kZWxheSk7CiAgICAgICAgdDEgPSAodDAgPSB0MSkubmV4dDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoZW47CiAgfQogIGZ1bmN0aW9uIGQzX21vdXNlUG9pbnQoY29udGFpbmVyLCBlKSB7CiAgICB2YXIgc3ZnID0gY29udGFpbmVyLm93bmVyU1ZHRWxlbWVudCB8fCBjb250YWluZXI7CiAgICBpZiAoc3ZnLmNyZWF0ZVNWR1BvaW50KSB7CiAgICAgIHZhciBwb2ludCA9IHN2Zy5jcmVhdGVTVkdQb2ludCgpOwogICAgICBpZiAoZDNfbW91c2VfYnVnNDQwODMgPCAwICYmICh3aW5kb3cuc2Nyb2xsWCB8fCB3aW5kb3cuc2Nyb2xsWSkpIHsKICAgICAgICBzdmcgPSBkMy5zZWxlY3QoZG9jdW1lbnQuYm9keSkuYXBwZW5kKCJzdmciKS5zdHlsZSgicG9zaXRpb24iLCAiYWJzb2x1dGUiKS5zdHlsZSgidG9wIiwgMCkuc3R5bGUoImxlZnQiLCAwKTsKICAgICAgICB2YXIgY3RtID0gc3ZnWzBdWzBdLmdldFNjcmVlbkNUTSgpOwogICAgICAgIGQzX21vdXNlX2J1ZzQ0MDgzID0gIShjdG0uZiB8fCBjdG0uZSk7CiAgICAgICAgc3ZnLnJlbW92ZSgpOwogICAgICB9CiAgICAgIGlmIChkM19tb3VzZV9idWc0NDA4MykgewogICAgICAgIHBvaW50LnggPSBlLnBhZ2VYOwogICAgICAgIHBvaW50LnkgPSBlLnBhZ2VZOwogICAgICB9IGVsc2UgewogICAgICAgIHBvaW50LnggPSBlLmNsaWVudFg7CiAgICAgICAgcG9pbnQueSA9IGUuY2xpZW50WTsKICAgICAgfQogICAgICBwb2ludCA9IHBvaW50Lm1hdHJpeFRyYW5zZm9ybShjb250YWluZXIuZ2V0U2NyZWVuQ1RNKCkuaW52ZXJzZSgpKTsKICAgICAgcmV0dXJuIFsgcG9pbnQueCwgcG9pbnQueSBdOwogICAgfQogICAgdmFyIHJlY3QgPSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICByZXR1cm4gWyBlLmNsaWVudFggLSByZWN0LmxlZnQgLSBjb250YWluZXIuY2xpZW50TGVmdCwgZS5jbGllbnRZIC0gcmVjdC50b3AgLSBjb250YWluZXIuY2xpZW50VG9wIF07CiAgfQogIGZ1bmN0aW9uIGQzX25vb3AoKSB7fQogIGZ1bmN0aW9uIGQzX3NjYWxlRXh0ZW50KGRvbWFpbikgewogICAgdmFyIHN0YXJ0ID0gZG9tYWluWzBdLCBzdG9wID0gZG9tYWluW2RvbWFpbi5sZW5ndGggLSAxXTsKICAgIHJldHVybiBzdGFydCA8IHN0b3AgPyBbIHN0YXJ0LCBzdG9wIF0gOiBbIHN0b3AsIHN0YXJ0IF07CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlUmFuZ2Uoc2NhbGUpIHsKICAgIHJldHVybiBzY2FsZS5yYW5nZUV4dGVudCA\/IHNjYWxlLnJhbmdlRXh0ZW50KCkgOiBkM19zY2FsZUV4dGVudChzY2FsZS5yYW5nZSgpKTsKICB9CiAgZnVuY3Rpb24gZDNfc2NhbGVfbmljZShkb21haW4sIG5pY2UpIHsKICAgIHZhciBpMCA9IDAsIGkxID0gZG9tYWluLmxlbmd0aCAtIDEsIHgwID0gZG9tYWluW2kwXSwgeDEgPSBkb21haW5baTFdLCBkeDsKICAgIGlmICh4MSA8IHgwKSB7CiAgICAgIGR4ID0gaTAsIGkwID0gaTEsIGkxID0gZHg7CiAgICAgIGR4ID0geDAsIHgwID0geDEsIHgxID0gZHg7CiAgICB9CiAgICBpZiAobmljZSA9IG5pY2UoeDEgLSB4MCkpIHsKICAgICAgZG9tYWluW2kwXSA9IG5pY2UuZmxvb3IoeDApOwogICAgICBkb21haW5baTFdID0gbmljZS5jZWlsKHgxKTsKICAgIH0KICAgIHJldHVybiBkb21haW47CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX25pY2VEZWZhdWx0KCkgewogICAgcmV0dXJuIE1hdGg7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhcihkb21haW4sIHJhbmdlLCBpbnRlcnBvbGF0ZSwgY2xhbXApIHsKICAgIGZ1bmN0aW9uIHJlc2NhbGUoKSB7CiAgICAgIHZhciBsaW5lYXIgPSBNYXRoLm1pbihkb21haW4ubGVuZ3RoLCByYW5nZS5sZW5ndGgpID4gMiA\/IGQzX3NjYWxlX3BvbHlsaW5lYXIgOiBkM19zY2FsZV9iaWxpbmVhciwgdW5pbnRlcnBvbGF0ZSA9IGNsYW1wID8gZDNfdW5pbnRlcnBvbGF0ZUNsYW1wIDogZDNfdW5pbnRlcnBvbGF0ZU51bWJlcjsKICAgICAgb3V0cHV0ID0gbGluZWFyKGRvbWFpbiwgcmFuZ2UsIHVuaW50ZXJwb2xhdGUsIGludGVycG9sYXRlKTsKICAgICAgaW5wdXQgPSBsaW5lYXIocmFuZ2UsIGRvbWFpbiwgdW5pbnRlcnBvbGF0ZSwgZDMuaW50ZXJwb2xhdGUpOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiBvdXRwdXQoeCk7CiAgICB9CiAgICB2YXIgb3V0cHV0LCBpbnB1dDsKICAgIHNjYWxlLmludmVydCA9IGZ1bmN0aW9uKHkpIHsKICAgICAgcmV0dXJuIGlucHV0KHkpOwogICAgfTsKICAgIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZG9tYWluOwogICAgICBkb21haW4gPSB4Lm1hcChOdW1iZXIpOwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLnJhbmdlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYW5nZTsKICAgICAgcmFuZ2UgPSB4OwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLnJhbmdlUm91bmQgPSBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiBzY2FsZS5yYW5nZSh4KS5pbnRlcnBvbGF0ZShkMy5pbnRlcnBvbGF0ZVJvdW5kKTsKICAgIH07CiAgICBzY2FsZS5jbGFtcCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2xhbXA7CiAgICAgIGNsYW1wID0geDsKICAgICAgcmV0dXJuIHJlc2NhbGUoKTsKICAgIH07CiAgICBzY2FsZS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gaW50ZXJwb2xhdGU7CiAgICAgIGludGVycG9sYXRlID0geDsKICAgICAgcmV0dXJuIHJlc2NhbGUoKTsKICAgIH07CiAgICBzY2FsZS50aWNrcyA9IGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhclRpY2tzKGRvbWFpbiwgbSk7CiAgICB9OwogICAgc2NhbGUudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhclRpY2tGb3JtYXQoZG9tYWluLCBtKTsKICAgIH07CiAgICBzY2FsZS5uaWNlID0gZnVuY3Rpb24oKSB7CiAgICAgIGQzX3NjYWxlX25pY2UoZG9tYWluLCBkM19zY2FsZV9saW5lYXJOaWNlKTsKICAgICAgcmV0dXJuIHJlc2NhbGUoKTsKICAgIH07CiAgICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19zY2FsZV9saW5lYXIoZG9tYWluLCByYW5nZSwgaW50ZXJwb2xhdGUsIGNsYW1wKTsKICAgIH07CiAgICByZXR1cm4gcmVzY2FsZSgpOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9saW5lYXJSZWJpbmQoc2NhbGUsIGxpbmVhcikgewogICAgcmV0dXJuIGQzLnJlYmluZChzY2FsZSwgbGluZWFyLCAicmFuZ2UiLCAicmFuZ2VSb3VuZCIsICJpbnRlcnBvbGF0ZSIsICJjbGFtcCIpOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9saW5lYXJOaWNlKGR4KSB7CiAgICBkeCA9IE1hdGgucG93KDEwLCBNYXRoLnJvdW5kKE1hdGgubG9nKGR4KSAvIE1hdGguTE4xMCkgLSAxKTsKICAgIHJldHVybiBkeCAmJiB7CiAgICAgIGZsb29yOiBmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoeCAvIGR4KSAqIGR4OwogICAgICB9LAogICAgICBjZWlsOiBmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuIE1hdGguY2VpbCh4IC8gZHgpICogZHg7CiAgICAgIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX2xpbmVhclRpY2tSYW5nZShkb21haW4sIG0pIHsKICAgIHZhciBleHRlbnQgPSBkM19zY2FsZUV4dGVudChkb21haW4pLCBzcGFuID0gZXh0ZW50WzFdIC0gZXh0ZW50WzBdLCBzdGVwID0gTWF0aC5wb3coMTAsIE1hdGguZmxvb3IoTWF0aC5sb2coc3BhbiAvIG0pIC8gTWF0aC5MTjEwKSksIGVyciA9IG0gLyBzcGFuICogc3RlcDsKICAgIGlmIChlcnIgPD0gLjE1KSBzdGVwICo9IDEwOyBlbHNlIGlmIChlcnIgPD0gLjM1KSBzdGVwICo9IDU7IGVsc2UgaWYgKGVyciA8PSAuNzUpIHN0ZXAgKj0gMjsKICAgIGV4dGVudFswXSA9IE1hdGguY2VpbChleHRlbnRbMF0gLyBzdGVwKSAqIHN0ZXA7CiAgICBleHRlbnRbMV0gPSBNYXRoLmZsb29yKGV4dGVudFsxXSAvIHN0ZXApICogc3RlcCArIHN0ZXAgKiAuNTsKICAgIGV4dGVudFsyXSA9IHN0ZXA7CiAgICByZXR1cm4gZXh0ZW50OwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9saW5lYXJUaWNrcyhkb21haW4sIG0pIHsKICAgIHJldHVybiBkMy5yYW5nZS5hcHBseShkMywgZDNfc2NhbGVfbGluZWFyVGlja1JhbmdlKGRvbWFpbiwgbSkpOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9saW5lYXJUaWNrRm9ybWF0KGRvbWFpbiwgbSkgewogICAgcmV0dXJuIGQzLmZvcm1hdCgiLC4iICsgTWF0aC5tYXgoMCwgLU1hdGguZmxvb3IoTWF0aC5sb2coZDNfc2NhbGVfbGluZWFyVGlja1JhbmdlKGRvbWFpbiwgbSlbMl0pIC8gTWF0aC5MTjEwICsgLjAxKSkgKyAiZiIpOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9iaWxpbmVhcihkb21haW4sIHJhbmdlLCB1bmludGVycG9sYXRlLCBpbnRlcnBvbGF0ZSkgewogICAgdmFyIHUgPSB1bmludGVycG9sYXRlKGRvbWFpblswXSwgZG9tYWluWzFdKSwgaSA9IGludGVycG9sYXRlKHJhbmdlWzBdLCByYW5nZVsxXSk7CiAgICByZXR1cm4gZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gaSh1KHgpKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX3BvbHlsaW5lYXIoZG9tYWluLCByYW5nZSwgdW5pbnRlcnBvbGF0ZSwgaW50ZXJwb2xhdGUpIHsKICAgIHZhciB1ID0gW10sIGkgPSBbXSwgaiA9IDAsIGsgPSBNYXRoLm1pbihkb21haW4ubGVuZ3RoLCByYW5nZS5sZW5ndGgpIC0gMTsKICAgIGlmIChkb21haW5ba10gPCBkb21haW5bMF0pIHsKICAgICAgZG9tYWluID0gZG9tYWluLnNsaWNlKCkucmV2ZXJzZSgpOwogICAgICByYW5nZSA9IHJhbmdlLnNsaWNlKCkucmV2ZXJzZSgpOwogICAgfQogICAgd2hpbGUgKCsraiA8PSBrKSB7CiAgICAgIHUucHVzaCh1bmludGVycG9sYXRlKGRvbWFpbltqIC0gMV0sIGRvbWFpbltqXSkpOwogICAgICBpLnB1c2goaW50ZXJwb2xhdGUocmFuZ2VbaiAtIDFdLCByYW5nZVtqXSkpOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKHgpIHsKICAgICAgdmFyIGogPSBkMy5iaXNlY3QoZG9tYWluLCB4LCAxLCBrKSAtIDE7CiAgICAgIHJldHVybiBpW2pdKHVbal0oeCkpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfc2NhbGVfbG9nKGxpbmVhciwgbG9nKSB7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiBsaW5lYXIobG9nKHgpKTsKICAgIH0KICAgIHZhciBwb3cgPSBsb2cucG93OwogICAgc2NhbGUuaW52ZXJ0ID0gZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4gcG93KGxpbmVhci5pbnZlcnQoeCkpOwogICAgfTsKICAgIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbGluZWFyLmRvbWFpbigpLm1hcChwb3cpOwogICAgICBsb2cgPSB4WzBdIDwgMCA\/IGQzX3NjYWxlX2xvZ24gOiBkM19zY2FsZV9sb2dwOwogICAgICBwb3cgPSBsb2cucG93OwogICAgICBsaW5lYXIuZG9tYWluKHgubWFwKGxvZykpOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUubmljZSA9IGZ1bmN0aW9uKCkgewogICAgICBsaW5lYXIuZG9tYWluKGQzX3NjYWxlX25pY2UobGluZWFyLmRvbWFpbigpLCBkM19zY2FsZV9uaWNlRGVmYXVsdCkpOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUudGlja3MgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGV4dGVudCA9IGQzX3NjYWxlRXh0ZW50KGxpbmVhci5kb21haW4oKSksIHRpY2tzID0gW107CiAgICAgIGlmIChleHRlbnQuZXZlcnkoaXNGaW5pdGUpKSB7CiAgICAgICAgdmFyIGkgPSBNYXRoLmZsb29yKGV4dGVudFswXSksIGogPSBNYXRoLmNlaWwoZXh0ZW50WzFdKSwgdSA9IHBvdyhleHRlbnRbMF0pLCB2ID0gcG93KGV4dGVudFsxXSk7CiAgICAgICAgaWYgKGxvZyA9PT0gZDNfc2NhbGVfbG9nbikgewogICAgICAgICAgdGlja3MucHVzaChwb3coaSkpOwogICAgICAgICAgZm9yICg7IGkrKyA8IGo7ICkgZm9yICh2YXIgayA9IDk7IGsgPiAwOyBrLS0pIHRpY2tzLnB1c2gocG93KGkpICogayk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAoOyBpIDwgajsgaSsrKSBmb3IgKHZhciBrID0gMTsgayA8IDEwOyBrKyspIHRpY2tzLnB1c2gocG93KGkpICogayk7CiAgICAgICAgICB0aWNrcy5wdXNoKHBvdyhpKSk7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IHRpY2tzW2ldIDwgdTsgaSsrKSB7fQogICAgICAgIGZvciAoaiA9IHRpY2tzLmxlbmd0aDsgdGlja3NbaiAtIDFdID4gdjsgai0tKSB7fQogICAgICAgIHRpY2tzID0gdGlja3Muc2xpY2UoaSwgaik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRpY2tzOwogICAgfTsKICAgIHNjYWxlLnRpY2tGb3JtYXQgPSBmdW5jdGlvbihuLCBmb3JtYXQpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSBmb3JtYXQgPSBkM19zY2FsZV9sb2dGb3JtYXQ7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMSkgcmV0dXJuIGZvcm1hdDsKICAgICAgdmFyIGsgPSBNYXRoLm1heCguMSwgbiAvIHNjYWxlLnRpY2tzKCkubGVuZ3RoKSwgZiA9IGxvZyA9PT0gZDNfc2NhbGVfbG9nbiA\/IChlID0gLTFlLTEyLCBNYXRoLmZsb29yKSA6IChlID0gMWUtMTIsIE1hdGguY2VpbCksIGU7CiAgICAgIHJldHVybiBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIGQgLyBwb3coZihsb2coZCkgKyBlKSkgPD0gayA\/IGZvcm1hdChkKSA6ICIiOwogICAgICB9OwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX2xvZyhsaW5lYXIuY29weSgpLCBsb2cpOwogICAgfTsKICAgIHJldHVybiBkM19zY2FsZV9saW5lYXJSZWJpbmQoc2NhbGUsIGxpbmVhcik7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX2xvZ3AoeCkgewogICAgcmV0dXJuIE1hdGgubG9nKHggPCAwID8gMCA6IHgpIC8gTWF0aC5MTjEwOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9sb2duKHgpIHsKICAgIHJldHVybiAtTWF0aC5sb2coeCA+IDAgPyAwIDogLXgpIC8gTWF0aC5MTjEwOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9wb3cobGluZWFyLCBleHBvbmVudCkgewogICAgZnVuY3Rpb24gc2NhbGUoeCkgewogICAgICByZXR1cm4gbGluZWFyKHBvd3AoeCkpOwogICAgfQogICAgdmFyIHBvd3AgPSBkM19zY2FsZV9wb3dQb3coZXhwb25lbnQpLCBwb3diID0gZDNfc2NhbGVfcG93UG93KDEgLyBleHBvbmVudCk7CiAgICBzY2FsZS5pbnZlcnQgPSBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiBwb3diKGxpbmVhci5pbnZlcnQoeCkpOwogICAgfTsKICAgIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbGluZWFyLmRvbWFpbigpLm1hcChwb3diKTsKICAgICAgbGluZWFyLmRvbWFpbih4Lm1hcChwb3dwKSk7CiAgICAgIHJldHVybiBzY2FsZTsKICAgIH07CiAgICBzY2FsZS50aWNrcyA9IGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX2xpbmVhclRpY2tzKHNjYWxlLmRvbWFpbigpLCBtKTsKICAgIH07CiAgICBzY2FsZS50aWNrRm9ybWF0ID0gZnVuY3Rpb24obSkgewogICAgICByZXR1cm4gZDNfc2NhbGVfbGluZWFyVGlja0Zvcm1hdChzY2FsZS5kb21haW4oKSwgbSk7CiAgICB9OwogICAgc2NhbGUubmljZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc2NhbGUuZG9tYWluKGQzX3NjYWxlX25pY2Uoc2NhbGUuZG9tYWluKCksIGQzX3NjYWxlX2xpbmVhck5pY2UpKTsKICAgIH07CiAgICBzY2FsZS5leHBvbmVudCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZXhwb25lbnQ7CiAgICAgIHZhciBkb21haW4gPSBzY2FsZS5kb21haW4oKTsKICAgICAgcG93cCA9IGQzX3NjYWxlX3Bvd1BvdyhleHBvbmVudCA9IHgpOwogICAgICBwb3diID0gZDNfc2NhbGVfcG93UG93KDEgLyBleHBvbmVudCk7CiAgICAgIHJldHVybiBzY2FsZS5kb21haW4oZG9tYWluKTsKICAgIH07CiAgICBzY2FsZS5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19zY2FsZV9wb3cobGluZWFyLmNvcHkoKSwgZXhwb25lbnQpOwogICAgfTsKICAgIHJldHVybiBkM19zY2FsZV9saW5lYXJSZWJpbmQoc2NhbGUsIGxpbmVhcik7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX3Bvd1BvdyhlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oeCkgewogICAgICByZXR1cm4geCA8IDAgPyAtTWF0aC5wb3coLXgsIGUpIDogTWF0aC5wb3coeCwgZSk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9vcmRpbmFsKGRvbWFpbiwgcmFuZ2VyKSB7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiByYW5nZVsoKGluZGV4LmdldCh4KSB8fCBpbmRleC5zZXQoeCwgZG9tYWluLnB1c2goeCkpKSAtIDEpICUgcmFuZ2UubGVuZ3RoXTsKICAgIH0KICAgIGZ1bmN0aW9uIHN0ZXBzKHN0YXJ0LCBzdGVwKSB7CiAgICAgIHJldHVybiBkMy5yYW5nZShkb21haW4ubGVuZ3RoKS5tYXAoZnVuY3Rpb24oaSkgewogICAgICAgIHJldHVybiBzdGFydCArIHN0ZXAgKiBpOwogICAgICB9KTsKICAgIH0KICAgIHZhciBpbmRleCwgcmFuZ2UsIHJhbmdlQmFuZDsKICAgIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZG9tYWluOwogICAgICBkb21haW4gPSBbXTsKICAgICAgaW5kZXggPSBuZXcgZDNfTWFwOwogICAgICB2YXIgaSA9IC0xLCBuID0geC5sZW5ndGgsIHhpOwogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKCFpbmRleC5oYXMoeGkgPSB4W2ldKSkgaW5kZXguc2V0KHhpLCBkb21haW4ucHVzaCh4aSkpOwogICAgICByZXR1cm4gc2NhbGVbcmFuZ2VyLnRdLmFwcGx5KHNjYWxlLCByYW5nZXIuYSk7CiAgICB9OwogICAgc2NhbGUucmFuZ2UgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHJhbmdlOwogICAgICByYW5nZSA9IHg7CiAgICAgIHJhbmdlQmFuZCA9IDA7CiAgICAgIHJhbmdlciA9IHsKICAgICAgICB0OiAicmFuZ2UiLAogICAgICAgIGE6IGFyZ3VtZW50cwogICAgICB9OwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUucmFuZ2VQb2ludHMgPSBmdW5jdGlvbih4LCBwYWRkaW5nKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgcGFkZGluZyA9IDA7CiAgICAgIHZhciBzdGFydCA9IHhbMF0sIHN0b3AgPSB4WzFdLCBzdGVwID0gKHN0b3AgLSBzdGFydCkgLyAoTWF0aC5tYXgoMSwgZG9tYWluLmxlbmd0aCAtIDEpICsgcGFkZGluZyk7CiAgICAgIHJhbmdlID0gc3RlcHMoZG9tYWluLmxlbmd0aCA8IDIgPyAoc3RhcnQgKyBzdG9wKSAvIDIgOiBzdGFydCArIHN0ZXAgKiBwYWRkaW5nIC8gMiwgc3RlcCk7CiAgICAgIHJhbmdlQmFuZCA9IDA7CiAgICAgIHJhbmdlciA9IHsKICAgICAgICB0OiAicmFuZ2VQb2ludHMiLAogICAgICAgIGE6IGFyZ3VtZW50cwogICAgICB9OwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUucmFuZ2VCYW5kcyA9IGZ1bmN0aW9uKHgsIHBhZGRpbmcsIG91dGVyUGFkZGluZykgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHBhZGRpbmcgPSAwOwogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIG91dGVyUGFkZGluZyA9IHBhZGRpbmc7CiAgICAgIHZhciByZXZlcnNlID0geFsxXSA8IHhbMF0sIHN0YXJ0ID0geFtyZXZlcnNlIC0gMF0sIHN0b3AgPSB4WzEgLSByZXZlcnNlXSwgc3RlcCA9IChzdG9wIC0gc3RhcnQpIC8gKGRvbWFpbi5sZW5ndGggLSBwYWRkaW5nICsgMiAqIG91dGVyUGFkZGluZyk7CiAgICAgIHJhbmdlID0gc3RlcHMoc3RhcnQgKyBzdGVwICogb3V0ZXJQYWRkaW5nLCBzdGVwKTsKICAgICAgaWYgKHJldmVyc2UpIHJhbmdlLnJldmVyc2UoKTsKICAgICAgcmFuZ2VCYW5kID0gc3RlcCAqICgxIC0gcGFkZGluZyk7CiAgICAgIHJhbmdlciA9IHsKICAgICAgICB0OiAicmFuZ2VCYW5kcyIsCiAgICAgICAgYTogYXJndW1lbnRzCiAgICAgIH07CiAgICAgIHJldHVybiBzY2FsZTsKICAgIH07CiAgICBzY2FsZS5yYW5nZVJvdW5kQmFuZHMgPSBmdW5jdGlvbih4LCBwYWRkaW5nLCBvdXRlclBhZGRpbmcpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSBwYWRkaW5nID0gMDsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSBvdXRlclBhZGRpbmcgPSBwYWRkaW5nOwogICAgICB2YXIgcmV2ZXJzZSA9IHhbMV0gPCB4WzBdLCBzdGFydCA9IHhbcmV2ZXJzZSAtIDBdLCBzdG9wID0geFsxIC0gcmV2ZXJzZV0sIHN0ZXAgPSBNYXRoLmZsb29yKChzdG9wIC0gc3RhcnQpIC8gKGRvbWFpbi5sZW5ndGggLSBwYWRkaW5nICsgMiAqIG91dGVyUGFkZGluZykpLCBlcnJvciA9IHN0b3AgLSBzdGFydCAtIChkb21haW4ubGVuZ3RoIC0gcGFkZGluZykgKiBzdGVwOwogICAgICByYW5nZSA9IHN0ZXBzKHN0YXJ0ICsgTWF0aC5yb3VuZChlcnJvciAvIDIpLCBzdGVwKTsKICAgICAgaWYgKHJldmVyc2UpIHJhbmdlLnJldmVyc2UoKTsKICAgICAgcmFuZ2VCYW5kID0gTWF0aC5yb3VuZChzdGVwICogKDEgLSBwYWRkaW5nKSk7CiAgICAgIHJhbmdlciA9IHsKICAgICAgICB0OiAicmFuZ2VSb3VuZEJhbmRzIiwKICAgICAgICBhOiBhcmd1bWVudHMKICAgICAgfTsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLnJhbmdlQmFuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcmFuZ2VCYW5kOwogICAgfTsKICAgIHNjYWxlLnJhbmdlRXh0ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19zY2FsZUV4dGVudChyYW5nZXIuYVswXSk7CiAgICB9OwogICAgc2NhbGUuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfb3JkaW5hbChkb21haW4sIHJhbmdlcik7CiAgICB9OwogICAgcmV0dXJuIHNjYWxlLmRvbWFpbihkb21haW4pOwogIH0KICBmdW5jdGlvbiBkM19zY2FsZV9xdWFudGlsZShkb21haW4sIHJhbmdlKSB7CiAgICBmdW5jdGlvbiByZXNjYWxlKCkgewogICAgICB2YXIgayA9IDAsIG4gPSBkb21haW4ubGVuZ3RoLCBxID0gcmFuZ2UubGVuZ3RoOwogICAgICB0aHJlc2hvbGRzID0gW107CiAgICAgIHdoaWxlICgrK2sgPCBxKSB0aHJlc2hvbGRzW2sgLSAxXSA9IGQzLnF1YW50aWxlKGRvbWFpbiwgayAvIHEpOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIGlmIChpc05hTih4ID0gK3gpKSByZXR1cm4gTmFOOwogICAgICByZXR1cm4gcmFuZ2VbZDMuYmlzZWN0KHRocmVzaG9sZHMsIHgpXTsKICAgIH0KICAgIHZhciB0aHJlc2hvbGRzOwogICAgc2NhbGUuZG9tYWluID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkb21haW47CiAgICAgIGRvbWFpbiA9IHguZmlsdGVyKGZ1bmN0aW9uKGQpIHsKICAgICAgICByZXR1cm4gIWlzTmFOKGQpOwogICAgICB9KS5zb3J0KGQzLmFzY2VuZGluZyk7CiAgICAgIHJldHVybiByZXNjYWxlKCk7CiAgICB9OwogICAgc2NhbGUucmFuZ2UgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHJhbmdlOwogICAgICByYW5nZSA9IHg7CiAgICAgIHJldHVybiByZXNjYWxlKCk7CiAgICB9OwogICAgc2NhbGUucXVhbnRpbGVzID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aHJlc2hvbGRzOwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX3F1YW50aWxlKGRvbWFpbiwgcmFuZ2UpOwogICAgfTsKICAgIHJldHVybiByZXNjYWxlKCk7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX3F1YW50aXplKHgwLCB4MSwgcmFuZ2UpIHsKICAgIGZ1bmN0aW9uIHNjYWxlKHgpIHsKICAgICAgcmV0dXJuIHJhbmdlW01hdGgubWF4KDAsIE1hdGgubWluKGksIE1hdGguZmxvb3Ioa3ggKiAoeCAtIHgwKSkpKV07CiAgICB9CiAgICBmdW5jdGlvbiByZXNjYWxlKCkgewogICAgICBreCA9IHJhbmdlLmxlbmd0aCAvICh4MSAtIHgwKTsKICAgICAgaSA9IHJhbmdlLmxlbmd0aCAtIDE7CiAgICAgIHJldHVybiBzY2FsZTsKICAgIH0KICAgIHZhciBreCwgaTsKICAgIHNjYWxlLmRvbWFpbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gWyB4MCwgeDEgXTsKICAgICAgeDAgPSAreFswXTsKICAgICAgeDEgPSAreFt4Lmxlbmd0aCAtIDFdOwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLnJhbmdlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYW5nZTsKICAgICAgcmFuZ2UgPSB4OwogICAgICByZXR1cm4gcmVzY2FsZSgpOwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3NjYWxlX3F1YW50aXplKHgwLCB4MSwgcmFuZ2UpOwogICAgfTsKICAgIHJldHVybiByZXNjYWxlKCk7CiAgfQogIGZ1bmN0aW9uIGQzX3NjYWxlX3RocmVzaG9sZChkb21haW4sIHJhbmdlKSB7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiByYW5nZVtkMy5iaXNlY3QoZG9tYWluLCB4KV07CiAgICB9CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbjsKICAgICAgZG9tYWluID0gXzsKICAgICAgcmV0dXJuIHNjYWxlOwogICAgfTsKICAgIHNjYWxlLnJhbmdlID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYW5nZTsKICAgICAgcmFuZ2UgPSBfOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfdGhyZXNob2xkKGRvbWFpbiwgcmFuZ2UpOwogICAgfTsKICAgIHJldHVybiBzY2FsZTsKICB9CiAgZnVuY3Rpb24gZDNfc2NhbGVfaWRlbnRpdHkoZG9tYWluKSB7CiAgICBmdW5jdGlvbiBpZGVudGl0eSh4KSB7CiAgICAgIHJldHVybiAreDsKICAgIH0KICAgIGlkZW50aXR5LmludmVydCA9IGlkZW50aXR5OwogICAgaWRlbnRpdHkuZG9tYWluID0gaWRlbnRpdHkucmFuZ2UgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRvbWFpbjsKICAgICAgZG9tYWluID0geC5tYXAoaWRlbnRpdHkpOwogICAgICByZXR1cm4gaWRlbnRpdHk7CiAgICB9OwogICAgaWRlbnRpdHkudGlja3MgPSBmdW5jdGlvbihtKSB7CiAgICAgIHJldHVybiBkM19zY2FsZV9saW5lYXJUaWNrcyhkb21haW4sIG0pOwogICAgfTsKICAgIGlkZW50aXR5LnRpY2tGb3JtYXQgPSBmdW5jdGlvbihtKSB7CiAgICAgIHJldHVybiBkM19zY2FsZV9saW5lYXJUaWNrRm9ybWF0KGRvbWFpbiwgbSk7CiAgICB9OwogICAgaWRlbnRpdHkuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfc2NhbGVfaWRlbnRpdHkoZG9tYWluKTsKICAgIH07CiAgICByZXR1cm4gaWRlbnRpdHk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19hcmNJbm5lclJhZGl1cyhkKSB7CiAgICByZXR1cm4gZC5pbm5lclJhZGl1czsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2FyY091dGVyUmFkaXVzKGQpIHsKICAgIHJldHVybiBkLm91dGVyUmFkaXVzOwogIH0KICBmdW5jdGlvbiBkM19zdmdfYXJjU3RhcnRBbmdsZShkKSB7CiAgICByZXR1cm4gZC5zdGFydEFuZ2xlOwogIH0KICBmdW5jdGlvbiBkM19zdmdfYXJjRW5kQW5nbGUoZCkgewogICAgcmV0dXJuIGQuZW5kQW5nbGU7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lKHByb2plY3Rpb24pIHsKICAgIGZ1bmN0aW9uIGxpbmUoZGF0YSkgewogICAgICBmdW5jdGlvbiBzZWdtZW50KCkgewogICAgICAgIHNlZ21lbnRzLnB1c2goIk0iLCBpbnRlcnBvbGF0ZShwcm9qZWN0aW9uKHBvaW50cyksIHRlbnNpb24pKTsKICAgICAgfQogICAgICB2YXIgc2VnbWVudHMgPSBbXSwgcG9pbnRzID0gW10sIGkgPSAtMSwgbiA9IGRhdGEubGVuZ3RoLCBkLCBmeCA9IGQzX2Z1bmN0b3IoeCksIGZ5ID0gZDNfZnVuY3Rvcih5KTsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAoZGVmaW5lZC5jYWxsKHRoaXMsIGQgPSBkYXRhW2ldLCBpKSkgewogICAgICAgICAgcG9pbnRzLnB1c2goWyArZnguY2FsbCh0aGlzLCBkLCBpKSwgK2Z5LmNhbGwodGhpcywgZCwgaSkgXSk7CiAgICAgICAgfSBlbHNlIGlmIChwb2ludHMubGVuZ3RoKSB7CiAgICAgICAgICBzZWdtZW50KCk7CiAgICAgICAgICBwb2ludHMgPSBbXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHBvaW50cy5sZW5ndGgpIHNlZ21lbnQoKTsKICAgICAgcmV0dXJuIHNlZ21lbnRzLmxlbmd0aCA\/IHNlZ21lbnRzLmpvaW4oIiIpIDogbnVsbDsKICAgIH0KICAgIHZhciB4ID0gZDNfc3ZnX2xpbmVYLCB5ID0gZDNfc3ZnX2xpbmVZLCBkZWZpbmVkID0gZDNfdHJ1ZSwgaW50ZXJwb2xhdGUgPSBkM19zdmdfbGluZUxpbmVhciwgaW50ZXJwb2xhdGVLZXkgPSBpbnRlcnBvbGF0ZS5rZXksIHRlbnNpb24gPSAuNzsKICAgIGxpbmUueCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDsKICAgICAgeCA9IF87CiAgICAgIHJldHVybiBsaW5lOwogICAgfTsKICAgIGxpbmUueSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geTsKICAgICAgeSA9IF87CiAgICAgIHJldHVybiBsaW5lOwogICAgfTsKICAgIGxpbmUuZGVmaW5lZCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZGVmaW5lZDsKICAgICAgZGVmaW5lZCA9IF87CiAgICAgIHJldHVybiBsaW5lOwogICAgfTsKICAgIGxpbmUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGludGVycG9sYXRlS2V5OwogICAgICBpZiAodHlwZW9mIF8gPT09ICJmdW5jdGlvbiIpIGludGVycG9sYXRlS2V5ID0gaW50ZXJwb2xhdGUgPSBfOyBlbHNlIGludGVycG9sYXRlS2V5ID0gKGludGVycG9sYXRlID0gZDNfc3ZnX2xpbmVJbnRlcnBvbGF0b3JzLmdldChfKSB8fCBkM19zdmdfbGluZUxpbmVhcikua2V5OwogICAgICByZXR1cm4gbGluZTsKICAgIH07CiAgICBsaW5lLnRlbnNpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRlbnNpb247CiAgICAgIHRlbnNpb24gPSBfOwogICAgICByZXR1cm4gbGluZTsKICAgIH07CiAgICByZXR1cm4gbGluZTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVYKGQpIHsKICAgIHJldHVybiBkWzBdOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZVkoZCkgewogICAgcmV0dXJuIGRbMV07CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lTGluZWFyKHBvaW50cykgewogICAgcmV0dXJuIHBvaW50cy5qb2luKCJMIik7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lTGluZWFyQ2xvc2VkKHBvaW50cykgewogICAgcmV0dXJuIGQzX3N2Z19saW5lTGluZWFyKHBvaW50cykgKyAiWiI7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lU3RlcEJlZm9yZShwb2ludHMpIHsKICAgIHZhciBpID0gMCwgbiA9IHBvaW50cy5sZW5ndGgsIHAgPSBwb2ludHNbMF0sIHBhdGggPSBbIHBbMF0sICIsIiwgcFsxXSBdOwogICAgd2hpbGUgKCsraSA8IG4pIHBhdGgucHVzaCgiViIsIChwID0gcG9pbnRzW2ldKVsxXSwgIkgiLCBwWzBdKTsKICAgIHJldHVybiBwYXRoLmpvaW4oIiIpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZVN0ZXBBZnRlcihwb2ludHMpIHsKICAgIHZhciBpID0gMCwgbiA9IHBvaW50cy5sZW5ndGgsIHAgPSBwb2ludHNbMF0sIHBhdGggPSBbIHBbMF0sICIsIiwgcFsxXSBdOwogICAgd2hpbGUgKCsraSA8IG4pIHBhdGgucHVzaCgiSCIsIChwID0gcG9pbnRzW2ldKVswXSwgIlYiLCBwWzFdKTsKICAgIHJldHVybiBwYXRoLmpvaW4oIiIpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUNhcmRpbmFsT3Blbihwb2ludHMsIHRlbnNpb24pIHsKICAgIHJldHVybiBwb2ludHMubGVuZ3RoIDwgNCA\/IGQzX3N2Z19saW5lTGluZWFyKHBvaW50cykgOiBwb2ludHNbMV0gKyBkM19zdmdfbGluZUhlcm1pdGUocG9pbnRzLnNsaWNlKDEsIHBvaW50cy5sZW5ndGggLSAxKSwgZDNfc3ZnX2xpbmVDYXJkaW5hbFRhbmdlbnRzKHBvaW50cywgdGVuc2lvbikpOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUNhcmRpbmFsQ2xvc2VkKHBvaW50cywgdGVuc2lvbikgewogICAgcmV0dXJuIHBvaW50cy5sZW5ndGggPCAzID8gZDNfc3ZnX2xpbmVMaW5lYXIocG9pbnRzKSA6IHBvaW50c1swXSArIGQzX3N2Z19saW5lSGVybWl0ZSgocG9pbnRzLnB1c2gocG9pbnRzWzBdKSwgcG9pbnRzKSwgZDNfc3ZnX2xpbmVDYXJkaW5hbFRhbmdlbnRzKFsgcG9pbnRzW3BvaW50cy5sZW5ndGggLSAyXSBdLmNvbmNhdChwb2ludHMsIFsgcG9pbnRzWzFdIF0pLCB0ZW5zaW9uKSk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lQ2FyZGluYWwocG9pbnRzLCB0ZW5zaW9uLCBjbG9zZWQpIHsKICAgIHJldHVybiBwb2ludHMubGVuZ3RoIDwgMyA\/IGQzX3N2Z19saW5lTGluZWFyKHBvaW50cykgOiBwb2ludHNbMF0gKyBkM19zdmdfbGluZUhlcm1pdGUocG9pbnRzLCBkM19zdmdfbGluZUNhcmRpbmFsVGFuZ2VudHMocG9pbnRzLCB0ZW5zaW9uKSk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lSGVybWl0ZShwb2ludHMsIHRhbmdlbnRzKSB7CiAgICBpZiAodGFuZ2VudHMubGVuZ3RoIDwgMSB8fCBwb2ludHMubGVuZ3RoICE9IHRhbmdlbnRzLmxlbmd0aCAmJiBwb2ludHMubGVuZ3RoICE9IHRhbmdlbnRzLmxlbmd0aCArIDIpIHsKICAgICAgcmV0dXJuIGQzX3N2Z19saW5lTGluZWFyKHBvaW50cyk7CiAgICB9CiAgICB2YXIgcXVhZCA9IHBvaW50cy5sZW5ndGggIT0gdGFuZ2VudHMubGVuZ3RoLCBwYXRoID0gIiIsIHAwID0gcG9pbnRzWzBdLCBwID0gcG9pbnRzWzFdLCB0MCA9IHRhbmdlbnRzWzBdLCB0ID0gdDAsIHBpID0gMTsKICAgIGlmIChxdWFkKSB7CiAgICAgIHBhdGggKz0gIlEiICsgKHBbMF0gLSB0MFswXSAqIDIgLyAzKSArICIsIiArIChwWzFdIC0gdDBbMV0gKiAyIC8gMykgKyAiLCIgKyBwWzBdICsgIiwiICsgcFsxXTsKICAgICAgcDAgPSBwb2ludHNbMV07CiAgICAgIHBpID0gMjsKICAgIH0KICAgIGlmICh0YW5nZW50cy5sZW5ndGggPiAxKSB7CiAgICAgIHQgPSB0YW5nZW50c1sxXTsKICAgICAgcCA9IHBvaW50c1twaV07CiAgICAgIHBpKys7CiAgICAgIHBhdGggKz0gIkMiICsgKHAwWzBdICsgdDBbMF0pICsgIiwiICsgKHAwWzFdICsgdDBbMV0pICsgIiwiICsgKHBbMF0gLSB0WzBdKSArICIsIiArIChwWzFdIC0gdFsxXSkgKyAiLCIgKyBwWzBdICsgIiwiICsgcFsxXTsKICAgICAgZm9yICh2YXIgaSA9IDI7IGkgPCB0YW5nZW50cy5sZW5ndGg7IGkrKywgcGkrKykgewogICAgICAgIHAgPSBwb2ludHNbcGldOwogICAgICAgIHQgPSB0YW5nZW50c1tpXTsKICAgICAgICBwYXRoICs9ICJTIiArIChwWzBdIC0gdFswXSkgKyAiLCIgKyAocFsxXSAtIHRbMV0pICsgIiwiICsgcFswXSArICIsIiArIHBbMV07CiAgICAgIH0KICAgIH0KICAgIGlmIChxdWFkKSB7CiAgICAgIHZhciBscCA9IHBvaW50c1twaV07CiAgICAgIHBhdGggKz0gIlEiICsgKHBbMF0gKyB0WzBdICogMiAvIDMpICsgIiwiICsgKHBbMV0gKyB0WzFdICogMiAvIDMpICsgIiwiICsgbHBbMF0gKyAiLCIgKyBscFsxXTsKICAgIH0KICAgIHJldHVybiBwYXRoOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUNhcmRpbmFsVGFuZ2VudHMocG9pbnRzLCB0ZW5zaW9uKSB7CiAgICB2YXIgdGFuZ2VudHMgPSBbXSwgYSA9ICgxIC0gdGVuc2lvbikgLyAyLCBwMCwgcDEgPSBwb2ludHNbMF0sIHAyID0gcG9pbnRzWzFdLCBpID0gMSwgbiA9IHBvaW50cy5sZW5ndGg7CiAgICB3aGlsZSAoKytpIDwgbikgewogICAgICBwMCA9IHAxOwogICAgICBwMSA9IHAyOwogICAgICBwMiA9IHBvaW50c1tpXTsKICAgICAgdGFuZ2VudHMucHVzaChbIGEgKiAocDJbMF0gLSBwMFswXSksIGEgKiAocDJbMV0gLSBwMFsxXSkgXSk7CiAgICB9CiAgICByZXR1cm4gdGFuZ2VudHM7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lQmFzaXMocG9pbnRzKSB7CiAgICBpZiAocG9pbnRzLmxlbmd0aCA8IDMpIHJldHVybiBkM19zdmdfbGluZUxpbmVhcihwb2ludHMpOwogICAgdmFyIGkgPSAxLCBuID0gcG9pbnRzLmxlbmd0aCwgcGkgPSBwb2ludHNbMF0sIHgwID0gcGlbMF0sIHkwID0gcGlbMV0sIHB4ID0gWyB4MCwgeDAsIHgwLCAocGkgPSBwb2ludHNbMV0pWzBdIF0sIHB5ID0gWyB5MCwgeTAsIHkwLCBwaVsxXSBdLCBwYXRoID0gWyB4MCwgIiwiLCB5MCBdOwogICAgZDNfc3ZnX2xpbmVCYXNpc0JlemllcihwYXRoLCBweCwgcHkpOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgcGkgPSBwb2ludHNbaV07CiAgICAgIHB4LnNoaWZ0KCk7CiAgICAgIHB4LnB1c2gocGlbMF0pOwogICAgICBweS5zaGlmdCgpOwogICAgICBweS5wdXNoKHBpWzFdKTsKICAgICAgZDNfc3ZnX2xpbmVCYXNpc0JlemllcihwYXRoLCBweCwgcHkpOwogICAgfQogICAgaSA9IC0xOwogICAgd2hpbGUgKCsraSA8IDIpIHsKICAgICAgcHguc2hpZnQoKTsKICAgICAgcHgucHVzaChwaVswXSk7CiAgICAgIHB5LnNoaWZ0KCk7CiAgICAgIHB5LnB1c2gocGlbMV0pOwogICAgICBkM19zdmdfbGluZUJhc2lzQmV6aWVyKHBhdGgsIHB4LCBweSk7CiAgICB9CiAgICByZXR1cm4gcGF0aC5qb2luKCIiKTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVCYXNpc09wZW4ocG9pbnRzKSB7CiAgICBpZiAocG9pbnRzLmxlbmd0aCA8IDQpIHJldHVybiBkM19zdmdfbGluZUxpbmVhcihwb2ludHMpOwogICAgdmFyIHBhdGggPSBbXSwgaSA9IC0xLCBuID0gcG9pbnRzLmxlbmd0aCwgcGksIHB4ID0gWyAwIF0sIHB5ID0gWyAwIF07CiAgICB3aGlsZSAoKytpIDwgMykgewogICAgICBwaSA9IHBvaW50c1tpXTsKICAgICAgcHgucHVzaChwaVswXSk7CiAgICAgIHB5LnB1c2gocGlbMV0pOwogICAgfQogICAgcGF0aC5wdXNoKGQzX3N2Z19saW5lRG90NChkM19zdmdfbGluZUJhc2lzQmV6aWVyMywgcHgpICsgIiwiICsgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCBweSkpOwogICAgLS1pOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgcGkgPSBwb2ludHNbaV07CiAgICAgIHB4LnNoaWZ0KCk7CiAgICAgIHB4LnB1c2gocGlbMF0pOwogICAgICBweS5zaGlmdCgpOwogICAgICBweS5wdXNoKHBpWzFdKTsKICAgICAgZDNfc3ZnX2xpbmVCYXNpc0JlemllcihwYXRoLCBweCwgcHkpOwogICAgfQogICAgcmV0dXJuIHBhdGguam9pbigiIik7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lQmFzaXNDbG9zZWQocG9pbnRzKSB7CiAgICB2YXIgcGF0aCwgaSA9IC0xLCBuID0gcG9pbnRzLmxlbmd0aCwgbSA9IG4gKyA0LCBwaSwgcHggPSBbXSwgcHkgPSBbXTsKICAgIHdoaWxlICgrK2kgPCA0KSB7CiAgICAgIHBpID0gcG9pbnRzW2kgJSBuXTsKICAgICAgcHgucHVzaChwaVswXSk7CiAgICAgIHB5LnB1c2gocGlbMV0pOwogICAgfQogICAgcGF0aCA9IFsgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCBweCksICIsIiwgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCBweSkgXTsKICAgIC0taTsKICAgIHdoaWxlICgrK2kgPCBtKSB7CiAgICAgIHBpID0gcG9pbnRzW2kgJSBuXTsKICAgICAgcHguc2hpZnQoKTsKICAgICAgcHgucHVzaChwaVswXSk7CiAgICAgIHB5LnNoaWZ0KCk7CiAgICAgIHB5LnB1c2gocGlbMV0pOwogICAgICBkM19zdmdfbGluZUJhc2lzQmV6aWVyKHBhdGgsIHB4LCBweSk7CiAgICB9CiAgICByZXR1cm4gcGF0aC5qb2luKCIiKTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVCdW5kbGUocG9pbnRzLCB0ZW5zaW9uKSB7CiAgICB2YXIgbiA9IHBvaW50cy5sZW5ndGggLSAxOwogICAgaWYgKG4pIHsKICAgICAgdmFyIHgwID0gcG9pbnRzWzBdWzBdLCB5MCA9IHBvaW50c1swXVsxXSwgZHggPSBwb2ludHNbbl1bMF0gLSB4MCwgZHkgPSBwb2ludHNbbl1bMV0gLSB5MCwgaSA9IC0xLCBwLCB0OwogICAgICB3aGlsZSAoKytpIDw9IG4pIHsKICAgICAgICBwID0gcG9pbnRzW2ldOwogICAgICAgIHQgPSBpIC8gbjsKICAgICAgICBwWzBdID0gdGVuc2lvbiAqIHBbMF0gKyAoMSAtIHRlbnNpb24pICogKHgwICsgdCAqIGR4KTsKICAgICAgICBwWzFdID0gdGVuc2lvbiAqIHBbMV0gKyAoMSAtIHRlbnNpb24pICogKHkwICsgdCAqIGR5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3N2Z19saW5lQmFzaXMocG9pbnRzKTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVEb3Q0KGEsIGIpIHsKICAgIHJldHVybiBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdICsgYVsyXSAqIGJbMl0gKyBhWzNdICogYlszXTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVCYXNpc0JlemllcihwYXRoLCB4LCB5KSB7CiAgICBwYXRoLnB1c2goIkMiLCBkM19zdmdfbGluZURvdDQoZDNfc3ZnX2xpbmVCYXNpc0JlemllcjEsIHgpLCAiLCIsIGQzX3N2Z19saW5lRG90NChkM19zdmdfbGluZUJhc2lzQmV6aWVyMSwgeSksICIsIiwgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIyLCB4KSwgIiwiLCBkM19zdmdfbGluZURvdDQoZDNfc3ZnX2xpbmVCYXNpc0JlemllcjIsIHkpLCAiLCIsIGQzX3N2Z19saW5lRG90NChkM19zdmdfbGluZUJhc2lzQmV6aWVyMywgeCksICIsIiwgZDNfc3ZnX2xpbmVEb3Q0KGQzX3N2Z19saW5lQmFzaXNCZXppZXIzLCB5KSk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lU2xvcGUocDAsIHAxKSB7CiAgICByZXR1cm4gKHAxWzFdIC0gcDBbMV0pIC8gKHAxWzBdIC0gcDBbMF0pOwogIH0KICBmdW5jdGlvbiBkM19zdmdfbGluZUZpbml0ZURpZmZlcmVuY2VzKHBvaW50cykgewogICAgdmFyIGkgPSAwLCBqID0gcG9pbnRzLmxlbmd0aCAtIDEsIG0gPSBbXSwgcDAgPSBwb2ludHNbMF0sIHAxID0gcG9pbnRzWzFdLCBkID0gbVswXSA9IGQzX3N2Z19saW5lU2xvcGUocDAsIHAxKTsKICAgIHdoaWxlICgrK2kgPCBqKSB7CiAgICAgIG1baV0gPSAoZCArIChkID0gZDNfc3ZnX2xpbmVTbG9wZShwMCA9IHAxLCBwMSA9IHBvaW50c1tpICsgMV0pKSkgLyAyOwogICAgfQogICAgbVtpXSA9IGQ7CiAgICByZXR1cm4gbTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVNb25vdG9uZVRhbmdlbnRzKHBvaW50cykgewogICAgdmFyIHRhbmdlbnRzID0gW10sIGQsIGEsIGIsIHMsIG0gPSBkM19zdmdfbGluZUZpbml0ZURpZmZlcmVuY2VzKHBvaW50cyksIGkgPSAtMSwgaiA9IHBvaW50cy5sZW5ndGggLSAxOwogICAgd2hpbGUgKCsraSA8IGopIHsKICAgICAgZCA9IGQzX3N2Z19saW5lU2xvcGUocG9pbnRzW2ldLCBwb2ludHNbaSArIDFdKTsKICAgICAgaWYgKE1hdGguYWJzKGQpIDwgMWUtNikgewogICAgICAgIG1baV0gPSBtW2kgKyAxXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYSA9IG1baV0gLyBkOwogICAgICAgIGIgPSBtW2kgKyAxXSAvIGQ7CiAgICAgICAgcyA9IGEgKiBhICsgYiAqIGI7CiAgICAgICAgaWYgKHMgPiA5KSB7CiAgICAgICAgICBzID0gZCAqIDMgLyBNYXRoLnNxcnQocyk7CiAgICAgICAgICBtW2ldID0gcyAqIGE7CiAgICAgICAgICBtW2kgKyAxXSA9IHMgKiBiOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaSA9IC0xOwogICAgd2hpbGUgKCsraSA8PSBqKSB7CiAgICAgIHMgPSAocG9pbnRzW01hdGgubWluKGosIGkgKyAxKV1bMF0gLSBwb2ludHNbTWF0aC5tYXgoMCwgaSAtIDEpXVswXSkgLyAoNiAqICgxICsgbVtpXSAqIG1baV0pKTsKICAgICAgdGFuZ2VudHMucHVzaChbIHMgfHwgMCwgbVtpXSAqIHMgfHwgMCBdKTsKICAgIH0KICAgIHJldHVybiB0YW5nZW50czsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2xpbmVNb25vdG9uZShwb2ludHMpIHsKICAgIHJldHVybiBwb2ludHMubGVuZ3RoIDwgMyA\/IGQzX3N2Z19saW5lTGluZWFyKHBvaW50cykgOiBwb2ludHNbMF0gKyBkM19zdmdfbGluZUhlcm1pdGUocG9pbnRzLCBkM19zdmdfbGluZU1vbm90b25lVGFuZ2VudHMocG9pbnRzKSk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19saW5lUmFkaWFsKHBvaW50cykgewogICAgdmFyIHBvaW50LCBpID0gLTEsIG4gPSBwb2ludHMubGVuZ3RoLCByLCBhOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgcG9pbnQgPSBwb2ludHNbaV07CiAgICAgIHIgPSBwb2ludFswXTsKICAgICAgYSA9IHBvaW50WzFdICsgZDNfc3ZnX2FyY09mZnNldDsKICAgICAgcG9pbnRbMF0gPSByICogTWF0aC5jb3MoYSk7CiAgICAgIHBvaW50WzFdID0gciAqIE1hdGguc2luKGEpOwogICAgfQogICAgcmV0dXJuIHBvaW50czsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2FyZWEocHJvamVjdGlvbikgewogICAgZnVuY3Rpb24gYXJlYShkYXRhKSB7CiAgICAgIGZ1bmN0aW9uIHNlZ21lbnQoKSB7CiAgICAgICAgc2VnbWVudHMucHVzaCgiTSIsIGludGVycG9sYXRlKHByb2plY3Rpb24ocG9pbnRzMSksIHRlbnNpb24pLCBMLCBpbnRlcnBvbGF0ZVJldmVyc2UocHJvamVjdGlvbihwb2ludHMwLnJldmVyc2UoKSksIHRlbnNpb24pLCAiWiIpOwogICAgICB9CiAgICAgIHZhciBzZWdtZW50cyA9IFtdLCBwb2ludHMwID0gW10sIHBvaW50czEgPSBbXSwgaSA9IC0xLCBuID0gZGF0YS5sZW5ndGgsIGQsIGZ4MCA9IGQzX2Z1bmN0b3IoeDApLCBmeTAgPSBkM19mdW5jdG9yKHkwKSwgZngxID0geDAgPT09IHgxID8gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHg7CiAgICAgIH0gOiBkM19mdW5jdG9yKHgxKSwgZnkxID0geTAgPT09IHkxID8gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHk7CiAgICAgIH0gOiBkM19mdW5jdG9yKHkxKSwgeCwgeTsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAoZGVmaW5lZC5jYWxsKHRoaXMsIGQgPSBkYXRhW2ldLCBpKSkgewogICAgICAgICAgcG9pbnRzMC5wdXNoKFsgeCA9ICtmeDAuY2FsbCh0aGlzLCBkLCBpKSwgeSA9ICtmeTAuY2FsbCh0aGlzLCBkLCBpKSBdKTsKICAgICAgICAgIHBvaW50czEucHVzaChbICtmeDEuY2FsbCh0aGlzLCBkLCBpKSwgK2Z5MS5jYWxsKHRoaXMsIGQsIGkpIF0pOwogICAgICAgIH0gZWxzZSBpZiAocG9pbnRzMC5sZW5ndGgpIHsKICAgICAgICAgIHNlZ21lbnQoKTsKICAgICAgICAgIHBvaW50czAgPSBbXTsKICAgICAgICAgIHBvaW50czEgPSBbXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHBvaW50czAubGVuZ3RoKSBzZWdtZW50KCk7CiAgICAgIHJldHVybiBzZWdtZW50cy5sZW5ndGggPyBzZWdtZW50cy5qb2luKCIiKSA6IG51bGw7CiAgICB9CiAgICB2YXIgeDAgPSBkM19zdmdfbGluZVgsIHgxID0gZDNfc3ZnX2xpbmVYLCB5MCA9IDAsIHkxID0gZDNfc3ZnX2xpbmVZLCBkZWZpbmVkID0gZDNfdHJ1ZSwgaW50ZXJwb2xhdGUgPSBkM19zdmdfbGluZUxpbmVhciwgaW50ZXJwb2xhdGVLZXkgPSBpbnRlcnBvbGF0ZS5rZXksIGludGVycG9sYXRlUmV2ZXJzZSA9IGludGVycG9sYXRlLCBMID0gIkwiLCB0ZW5zaW9uID0gLjc7CiAgICBhcmVhLnggPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHgxOwogICAgICB4MCA9IHgxID0gXzsKICAgICAgcmV0dXJuIGFyZWE7CiAgICB9OwogICAgYXJlYS54MCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDA7CiAgICAgIHgwID0gXzsKICAgICAgcmV0dXJuIGFyZWE7CiAgICB9OwogICAgYXJlYS54MSA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDE7CiAgICAgIHgxID0gXzsKICAgICAgcmV0dXJuIGFyZWE7CiAgICB9OwogICAgYXJlYS55ID0gZnVuY3Rpb24oXykgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB5MTsKICAgICAgeTAgPSB5MSA9IF87CiAgICAgIHJldHVybiBhcmVhOwogICAgfTsKICAgIGFyZWEueTAgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHkwOwogICAgICB5MCA9IF87CiAgICAgIHJldHVybiBhcmVhOwogICAgfTsKICAgIGFyZWEueTEgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHkxOwogICAgICB5MSA9IF87CiAgICAgIHJldHVybiBhcmVhOwogICAgfTsKICAgIGFyZWEuZGVmaW5lZCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZGVmaW5lZDsKICAgICAgZGVmaW5lZCA9IF87CiAgICAgIHJldHVybiBhcmVhOwogICAgfTsKICAgIGFyZWEuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGludGVycG9sYXRlS2V5OwogICAgICBpZiAodHlwZW9mIF8gPT09ICJmdW5jdGlvbiIpIGludGVycG9sYXRlS2V5ID0gaW50ZXJwb2xhdGUgPSBfOyBlbHNlIGludGVycG9sYXRlS2V5ID0gKGludGVycG9sYXRlID0gZDNfc3ZnX2xpbmVJbnRlcnBvbGF0b3JzLmdldChfKSB8fCBkM19zdmdfbGluZUxpbmVhcikua2V5OwogICAgICBpbnRlcnBvbGF0ZVJldmVyc2UgPSBpbnRlcnBvbGF0ZS5yZXZlcnNlIHx8IGludGVycG9sYXRlOwogICAgICBMID0gaW50ZXJwb2xhdGUuY2xvc2VkID8gIk0iIDogIkwiOwogICAgICByZXR1cm4gYXJlYTsKICAgIH07CiAgICBhcmVhLnRlbnNpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRlbnNpb247CiAgICAgIHRlbnNpb24gPSBfOwogICAgICByZXR1cm4gYXJlYTsKICAgIH07CiAgICByZXR1cm4gYXJlYTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2Nob3JkU291cmNlKGQpIHsKICAgIHJldHVybiBkLnNvdXJjZTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2Nob3JkVGFyZ2V0KGQpIHsKICAgIHJldHVybiBkLnRhcmdldDsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2Nob3JkUmFkaXVzKGQpIHsKICAgIHJldHVybiBkLnJhZGl1czsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2Nob3JkU3RhcnRBbmdsZShkKSB7CiAgICByZXR1cm4gZC5zdGFydEFuZ2xlOwogIH0KICBmdW5jdGlvbiBkM19zdmdfY2hvcmRFbmRBbmdsZShkKSB7CiAgICByZXR1cm4gZC5lbmRBbmdsZTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2RpYWdvbmFsUHJvamVjdGlvbihkKSB7CiAgICByZXR1cm4gWyBkLngsIGQueSBdOwogIH0KICBmdW5jdGlvbiBkM19zdmdfZGlhZ29uYWxSYWRpYWxQcm9qZWN0aW9uKHByb2plY3Rpb24pIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGQgPSBwcm9qZWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHIgPSBkWzBdLCBhID0gZFsxXSArIGQzX3N2Z19hcmNPZmZzZXQ7CiAgICAgIHJldHVybiBbIHIgKiBNYXRoLmNvcyhhKSwgciAqIE1hdGguc2luKGEpIF07CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19zdmdfc3ltYm9sU2l6ZSgpIHsKICAgIHJldHVybiA2NDsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX3N5bWJvbFR5cGUoKSB7CiAgICByZXR1cm4gImNpcmNsZSI7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19zeW1ib2xDaXJjbGUoc2l6ZSkgewogICAgdmFyIHIgPSBNYXRoLnNxcnQoc2l6ZSAvIE1hdGguUEkpOwogICAgcmV0dXJuICJNMCwiICsgciArICJBIiArIHIgKyAiLCIgKyByICsgIiAwIDEsMSAwLCIgKyAtciArICJBIiArIHIgKyAiLCIgKyByICsgIiAwIDEsMSAwLCIgKyByICsgIloiOwogIH0KICBmdW5jdGlvbiBkM19zdmdfYXhpc1goc2VsZWN0aW9uLCB4KSB7CiAgICBzZWxlY3Rpb24uYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gInRyYW5zbGF0ZSgiICsgeChkKSArICIsMCkiOwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGQzX3N2Z19heGlzWShzZWxlY3Rpb24sIHkpIHsKICAgIHNlbGVjdGlvbi5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiAidHJhbnNsYXRlKDAsIiArIHkoZCkgKyAiKSI7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gZDNfc3ZnX2F4aXNTdWJkaXZpZGUoc2NhbGUsIHRpY2tzLCBtKSB7CiAgICBzdWJ0aWNrcyA9IFtdOwogICAgaWYgKG0gJiYgdGlja3MubGVuZ3RoID4gMSkgewogICAgICB2YXIgZXh0ZW50ID0gZDNfc2NhbGVFeHRlbnQoc2NhbGUuZG9tYWluKCkpLCBzdWJ0aWNrcywgaSA9IC0xLCBuID0gdGlja3MubGVuZ3RoLCBkID0gKHRpY2tzWzFdIC0gdGlja3NbMF0pIC8gKyttLCBqLCB2OwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGZvciAoaiA9IG07IC0taiA+IDA7ICkgewogICAgICAgICAgaWYgKCh2ID0gK3RpY2tzW2ldIC0gaiAqIGQpID49IGV4dGVudFswXSkgewogICAgICAgICAgICBzdWJ0aWNrcy5wdXNoKHYpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKC0taSwgaiA9IDA7ICsraiA8IG0gJiYgKHYgPSArdGlja3NbaV0gKyBqICogZCkgPCBleHRlbnRbMV07ICkgewogICAgICAgIHN1YnRpY2tzLnB1c2godik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdWJ0aWNrczsKICB9CiAgZnVuY3Rpb24gZDNfYmVoYXZpb3Jfem9vbURlbHRhKCkgewogICAgaWYgKCFkM19iZWhhdmlvcl96b29tRGl2KSB7CiAgICAgIGQzX2JlaGF2aW9yX3pvb21EaXYgPSBkMy5zZWxlY3QoImJvZHkiKS5hcHBlbmQoImRpdiIpLnN0eWxlKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpLnN0eWxlKCJ0b3AiLCAwKS5zdHlsZSgiaGVpZ2h0IiwgMCkuc3R5bGUoIndpZHRoIiwgMCkuc3R5bGUoIm92ZXJmbG93LXkiLCAic2Nyb2xsIikuYXBwZW5kKCJkaXYiKS5zdHlsZSgiaGVpZ2h0IiwgIjIwMDBweCIpLm5vZGUoKS5wYXJlbnROb2RlOwogICAgfQogICAgdmFyIGUgPSBkMy5ldmVudCwgZGVsdGE7CiAgICB0cnkgewogICAgICBkM19iZWhhdmlvcl96b29tRGl2LnNjcm9sbFRvcCA9IDFlMzsKICAgICAgZDNfYmVoYXZpb3Jfem9vbURpdi5kaXNwYXRjaEV2ZW50KGUpOwogICAgICBkZWx0YSA9IDFlMyAtIGQzX2JlaGF2aW9yX3pvb21EaXYuc2Nyb2xsVG9wOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgZGVsdGEgPSBlLndoZWVsRGVsdGEgfHwgLWUuZGV0YWlsICogNTsKICAgIH0KICAgIHJldHVybiBkZWx0YTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2J1bmRsZVBhdGgobGluaykgewogICAgdmFyIHN0YXJ0ID0gbGluay5zb3VyY2UsIGVuZCA9IGxpbmsudGFyZ2V0LCBsY2EgPSBkM19sYXlvdXRfYnVuZGxlTGVhc3RDb21tb25BbmNlc3RvcihzdGFydCwgZW5kKSwgcG9pbnRzID0gWyBzdGFydCBdOwogICAgd2hpbGUgKHN0YXJ0ICE9PSBsY2EpIHsKICAgICAgc3RhcnQgPSBzdGFydC5wYXJlbnQ7CiAgICAgIHBvaW50cy5wdXNoKHN0YXJ0KTsKICAgIH0KICAgIHZhciBrID0gcG9pbnRzLmxlbmd0aDsKICAgIHdoaWxlIChlbmQgIT09IGxjYSkgewogICAgICBwb2ludHMuc3BsaWNlKGssIDAsIGVuZCk7CiAgICAgIGVuZCA9IGVuZC5wYXJlbnQ7CiAgICB9CiAgICByZXR1cm4gcG9pbnRzOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfYnVuZGxlQW5jZXN0b3JzKG5vZGUpIHsKICAgIHZhciBhbmNlc3RvcnMgPSBbXSwgcGFyZW50ID0gbm9kZS5wYXJlbnQ7CiAgICB3aGlsZSAocGFyZW50ICE9IG51bGwpIHsKICAgICAgYW5jZXN0b3JzLnB1c2gobm9kZSk7CiAgICAgIG5vZGUgPSBwYXJlbnQ7CiAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7CiAgICB9CiAgICBhbmNlc3RvcnMucHVzaChub2RlKTsKICAgIHJldHVybiBhbmNlc3RvcnM7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9idW5kbGVMZWFzdENvbW1vbkFuY2VzdG9yKGEsIGIpIHsKICAgIGlmIChhID09PSBiKSByZXR1cm4gYTsKICAgIHZhciBhTm9kZXMgPSBkM19sYXlvdXRfYnVuZGxlQW5jZXN0b3JzKGEpLCBiTm9kZXMgPSBkM19sYXlvdXRfYnVuZGxlQW5jZXN0b3JzKGIpLCBhTm9kZSA9IGFOb2Rlcy5wb3AoKSwgYk5vZGUgPSBiTm9kZXMucG9wKCksIHNoYXJlZE5vZGUgPSBudWxsOwogICAgd2hpbGUgKGFOb2RlID09PSBiTm9kZSkgewogICAgICBzaGFyZWROb2RlID0gYU5vZGU7CiAgICAgIGFOb2RlID0gYU5vZGVzLnBvcCgpOwogICAgICBiTm9kZSA9IGJOb2Rlcy5wb3AoKTsKICAgIH0KICAgIHJldHVybiBzaGFyZWROb2RlOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfZm9yY2VEcmFnc3RhcnQoZCkgewogICAgZC5maXhlZCB8PSAyOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfZm9yY2VEcmFnZW5kKGQpIHsKICAgIGQuZml4ZWQgJj0gMTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2ZvcmNlTW91c2VvdmVyKGQpIHsKICAgIGQuZml4ZWQgfD0gNDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2ZvcmNlTW91c2VvdXQoZCkgewogICAgZC5maXhlZCAmPSAzOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfZm9yY2VBY2N1bXVsYXRlKHF1YWQsIGFscGhhLCBjaGFyZ2VzKSB7CiAgICB2YXIgY3ggPSAwLCBjeSA9IDA7CiAgICBxdWFkLmNoYXJnZSA9IDA7CiAgICBpZiAoIXF1YWQubGVhZikgewogICAgICB2YXIgbm9kZXMgPSBxdWFkLm5vZGVzLCBuID0gbm9kZXMubGVuZ3RoLCBpID0gLTEsIGM7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgYyA9IG5vZGVzW2ldOwogICAgICAgIGlmIChjID09IG51bGwpIGNvbnRpbnVlOwogICAgICAgIGQzX2xheW91dF9mb3JjZUFjY3VtdWxhdGUoYywgYWxwaGEsIGNoYXJnZXMpOwogICAgICAgIHF1YWQuY2hhcmdlICs9IGMuY2hhcmdlOwogICAgICAgIGN4ICs9IGMuY2hhcmdlICogYy5jeDsKICAgICAgICBjeSArPSBjLmNoYXJnZSAqIGMuY3k7CiAgICAgIH0KICAgIH0KICAgIGlmIChxdWFkLnBvaW50KSB7CiAgICAgIGlmICghcXVhZC5sZWFmKSB7CiAgICAgICAgcXVhZC5wb2ludC54ICs9IE1hdGgucmFuZG9tKCkgLSAuNTsKICAgICAgICBxdWFkLnBvaW50LnkgKz0gTWF0aC5yYW5kb20oKSAtIC41OwogICAgICB9CiAgICAgIHZhciBrID0gYWxwaGEgKiBjaGFyZ2VzW3F1YWQucG9pbnQuaW5kZXhdOwogICAgICBxdWFkLmNoYXJnZSArPSBxdWFkLnBvaW50Q2hhcmdlID0gazsKICAgICAgY3ggKz0gayAqIHF1YWQucG9pbnQueDsKICAgICAgY3kgKz0gayAqIHF1YWQucG9pbnQueTsKICAgIH0KICAgIHF1YWQuY3ggPSBjeCAvIHF1YWQuY2hhcmdlOwogICAgcXVhZC5jeSA9IGN5IC8gcXVhZC5jaGFyZ2U7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9mb3JjZUxpbmtEaXN0YW5jZShsaW5rKSB7CiAgICByZXR1cm4gMjA7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9mb3JjZUxpbmtTdHJlbmd0aChsaW5rKSB7CiAgICByZXR1cm4gMTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrWChkKSB7CiAgICByZXR1cm4gZC54OwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfc3RhY2tZKGQpIHsKICAgIHJldHVybiBkLnk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9zdGFja091dChkLCB5MCwgeSkgewogICAgZC55MCA9IHkwOwogICAgZC55ID0geTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrT3JkZXJEZWZhdWx0KGRhdGEpIHsKICAgIHJldHVybiBkMy5yYW5nZShkYXRhLmxlbmd0aCk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9zdGFja09mZnNldFplcm8oZGF0YSkgewogICAgdmFyIGogPSAtMSwgbSA9IGRhdGFbMF0ubGVuZ3RoLCB5MCA9IFtdOwogICAgd2hpbGUgKCsraiA8IG0pIHkwW2pdID0gMDsKICAgIHJldHVybiB5MDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrTWF4SW5kZXgoYXJyYXkpIHsKICAgIHZhciBpID0gMSwgaiA9IDAsIHYgPSBhcnJheVswXVsxXSwgaywgbiA9IGFycmF5Lmxlbmd0aDsKICAgIGZvciAoOyBpIDwgbjsgKytpKSB7CiAgICAgIGlmICgoayA9IGFycmF5W2ldWzFdKSA+IHYpIHsKICAgICAgICBqID0gaTsKICAgICAgICB2ID0gazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGo7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9zdGFja1JlZHVjZVN1bShkKSB7CiAgICByZXR1cm4gZC5yZWR1Y2UoZDNfbGF5b3V0X3N0YWNrU3VtLCAwKTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3N0YWNrU3VtKHAsIGQpIHsKICAgIHJldHVybiBwICsgZFsxXTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2hpc3RvZ3JhbUJpblN0dXJnZXMocmFuZ2UsIHZhbHVlcykgewogICAgcmV0dXJuIGQzX2xheW91dF9oaXN0b2dyYW1CaW5GaXhlZChyYW5nZSwgTWF0aC5jZWlsKE1hdGgubG9nKHZhbHVlcy5sZW5ndGgpIC8gTWF0aC5MTjIgKyAxKSk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9oaXN0b2dyYW1CaW5GaXhlZChyYW5nZSwgbikgewogICAgdmFyIHggPSAtMSwgYiA9ICtyYW5nZVswXSwgbSA9IChyYW5nZVsxXSAtIGIpIC8gbiwgZiA9IFtdOwogICAgd2hpbGUgKCsreCA8PSBuKSBmW3hdID0gbSAqIHggKyBiOwogICAgcmV0dXJuIGY7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9oaXN0b2dyYW1SYW5nZSh2YWx1ZXMpIHsKICAgIHJldHVybiBbIGQzLm1pbih2YWx1ZXMpLCBkMy5tYXgodmFsdWVzKSBdOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfaGllcmFyY2h5UmViaW5kKG9iamVjdCwgaGllcmFyY2h5KSB7CiAgICBkMy5yZWJpbmQob2JqZWN0LCBoaWVyYXJjaHksICJzb3J0IiwgImNoaWxkcmVuIiwgInZhbHVlIik7CiAgICBvYmplY3QubGlua3MgPSBkM19sYXlvdXRfaGllcmFyY2h5TGlua3M7CiAgICBvYmplY3Qubm9kZXMgPSBmdW5jdGlvbihkKSB7CiAgICAgIGQzX2xheW91dF9oaWVyYXJjaHlJbmxpbmUgPSB0cnVlOwogICAgICByZXR1cm4gKG9iamVjdC5ub2RlcyA9IG9iamVjdCkoZCk7CiAgICB9OwogICAgcmV0dXJuIG9iamVjdDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2hpZXJhcmNoeUNoaWxkcmVuKGQpIHsKICAgIHJldHVybiBkLmNoaWxkcmVuOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfaGllcmFyY2h5VmFsdWUoZCkgewogICAgcmV0dXJuIGQudmFsdWU7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9oaWVyYXJjaHlTb3J0KGEsIGIpIHsKICAgIHJldHVybiBiLnZhbHVlIC0gYS52YWx1ZTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2hpZXJhcmNoeUxpbmtzKG5vZGVzKSB7CiAgICByZXR1cm4gZDMubWVyZ2Uobm9kZXMubWFwKGZ1bmN0aW9uKHBhcmVudCkgewogICAgICByZXR1cm4gKHBhcmVudC5jaGlsZHJlbiB8fCBbXSkubWFwKGZ1bmN0aW9uKGNoaWxkKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHNvdXJjZTogcGFyZW50LAogICAgICAgICAgdGFyZ2V0OiBjaGlsZAogICAgICAgIH07CiAgICAgIH0pOwogICAgfSkpOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja1NvcnQoYSwgYikgewogICAgcmV0dXJuIGEudmFsdWUgLSBiLnZhbHVlOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja0luc2VydChhLCBiKSB7CiAgICB2YXIgYyA9IGEuX3BhY2tfbmV4dDsKICAgIGEuX3BhY2tfbmV4dCA9IGI7CiAgICBiLl9wYWNrX3ByZXYgPSBhOwogICAgYi5fcGFja19uZXh0ID0gYzsKICAgIGMuX3BhY2tfcHJldiA9IGI7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9wYWNrU3BsaWNlKGEsIGIpIHsKICAgIGEuX3BhY2tfbmV4dCA9IGI7CiAgICBiLl9wYWNrX3ByZXYgPSBhOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja0ludGVyc2VjdHMoYSwgYikgewogICAgdmFyIGR4ID0gYi54IC0gYS54LCBkeSA9IGIueSAtIGEueSwgZHIgPSBhLnIgKyBiLnI7CiAgICByZXR1cm4gZHIgKiBkciAtIGR4ICogZHggLSBkeSAqIGR5ID4gLjAwMTsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3BhY2tTaWJsaW5ncyhub2RlKSB7CiAgICBmdW5jdGlvbiBib3VuZChub2RlKSB7CiAgICAgIHhNaW4gPSBNYXRoLm1pbihub2RlLnggLSBub2RlLnIsIHhNaW4pOwogICAgICB4TWF4ID0gTWF0aC5tYXgobm9kZS54ICsgbm9kZS5yLCB4TWF4KTsKICAgICAgeU1pbiA9IE1hdGgubWluKG5vZGUueSAtIG5vZGUuciwgeU1pbik7CiAgICAgIHlNYXggPSBNYXRoLm1heChub2RlLnkgKyBub2RlLnIsIHlNYXgpOwogICAgfQogICAgaWYgKCEobm9kZXMgPSBub2RlLmNoaWxkcmVuKSB8fCAhKG4gPSBub2Rlcy5sZW5ndGgpKSByZXR1cm47CiAgICB2YXIgbm9kZXMsIHhNaW4gPSBJbmZpbml0eSwgeE1heCA9IC1JbmZpbml0eSwgeU1pbiA9IEluZmluaXR5LCB5TWF4ID0gLUluZmluaXR5LCBhLCBiLCBjLCBpLCBqLCBrLCBuOwogICAgbm9kZXMuZm9yRWFjaChkM19sYXlvdXRfcGFja0xpbmspOwogICAgYSA9IG5vZGVzWzBdOwogICAgYS54ID0gLWEucjsKICAgIGEueSA9IDA7CiAgICBib3VuZChhKTsKICAgIGlmIChuID4gMSkgewogICAgICBiID0gbm9kZXNbMV07CiAgICAgIGIueCA9IGIucjsKICAgICAgYi55ID0gMDsKICAgICAgYm91bmQoYik7CiAgICAgIGlmIChuID4gMikgewogICAgICAgIGMgPSBub2Rlc1syXTsKICAgICAgICBkM19sYXlvdXRfcGFja1BsYWNlKGEsIGIsIGMpOwogICAgICAgIGJvdW5kKGMpOwogICAgICAgIGQzX2xheW91dF9wYWNrSW5zZXJ0KGEsIGMpOwogICAgICAgIGEuX3BhY2tfcHJldiA9IGM7CiAgICAgICAgZDNfbGF5b3V0X3BhY2tJbnNlcnQoYywgYik7CiAgICAgICAgYiA9IGEuX3BhY2tfbmV4dDsKICAgICAgICBmb3IgKGkgPSAzOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBkM19sYXlvdXRfcGFja1BsYWNlKGEsIGIsIGMgPSBub2Rlc1tpXSk7CiAgICAgICAgICB2YXIgaXNlY3QgPSAwLCBzMSA9IDEsIHMyID0gMTsKICAgICAgICAgIGZvciAoaiA9IGIuX3BhY2tfbmV4dDsgaiAhPT0gYjsgaiA9IGouX3BhY2tfbmV4dCwgczErKykgewogICAgICAgICAgICBpZiAoZDNfbGF5b3V0X3BhY2tJbnRlcnNlY3RzKGosIGMpKSB7CiAgICAgICAgICAgICAgaXNlY3QgPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNlY3QgPT0gMSkgewogICAgICAgICAgICBmb3IgKGsgPSBhLl9wYWNrX3ByZXY7IGsgIT09IGouX3BhY2tfcHJldjsgayA9IGsuX3BhY2tfcHJldiwgczIrKykgewogICAgICAgICAgICAgIGlmIChkM19sYXlvdXRfcGFja0ludGVyc2VjdHMoaywgYykpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzZWN0KSB7CiAgICAgICAgICAgIGlmIChzMSA8IHMyIHx8IHMxID09IHMyICYmIGIuciA8IGEucikgZDNfbGF5b3V0X3BhY2tTcGxpY2UoYSwgYiA9IGopOyBlbHNlIGQzX2xheW91dF9wYWNrU3BsaWNlKGEgPSBrLCBiKTsKICAgICAgICAgICAgaS0tOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZDNfbGF5b3V0X3BhY2tJbnNlcnQoYSwgYyk7CiAgICAgICAgICAgIGIgPSBjOwogICAgICAgICAgICBib3VuZChjKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHZhciBjeCA9ICh4TWluICsgeE1heCkgLyAyLCBjeSA9ICh5TWluICsgeU1heCkgLyAyLCBjciA9IDA7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgIGMgPSBub2Rlc1tpXTsKICAgICAgYy54IC09IGN4OwogICAgICBjLnkgLT0gY3k7CiAgICAgIGNyID0gTWF0aC5tYXgoY3IsIGMuciArIE1hdGguc3FydChjLnggKiBjLnggKyBjLnkgKiBjLnkpKTsKICAgIH0KICAgIG5vZGUuciA9IGNyOwogICAgbm9kZXMuZm9yRWFjaChkM19sYXlvdXRfcGFja1VubGluayk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9wYWNrTGluayhub2RlKSB7CiAgICBub2RlLl9wYWNrX25leHQgPSBub2RlLl9wYWNrX3ByZXYgPSBub2RlOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfcGFja1VubGluayhub2RlKSB7CiAgICBkZWxldGUgbm9kZS5fcGFja19uZXh0OwogICAgZGVsZXRlIG5vZGUuX3BhY2tfcHJldjsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3BhY2tUcmFuc2Zvcm0obm9kZSwgeCwgeSwgaykgewogICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgIG5vZGUueCA9IHggKz0gayAqIG5vZGUueDsKICAgIG5vZGUueSA9IHkgKz0gayAqIG5vZGUueTsKICAgIG5vZGUuciAqPSBrOwogICAgaWYgKGNoaWxkcmVuKSB7CiAgICAgIHZhciBpID0gLTEsIG4gPSBjaGlsZHJlbi5sZW5ndGg7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBkM19sYXlvdXRfcGFja1RyYW5zZm9ybShjaGlsZHJlbltpXSwgeCwgeSwgayk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9wYWNrUGxhY2UoYSwgYiwgYykgewogICAgdmFyIGRiID0gYS5yICsgYy5yLCBkeCA9IGIueCAtIGEueCwgZHkgPSBiLnkgLSBhLnk7CiAgICBpZiAoZGIgJiYgKGR4IHx8IGR5KSkgewogICAgICB2YXIgZGEgPSBiLnIgKyBjLnIsIGRjID0gZHggKiBkeCArIGR5ICogZHk7CiAgICAgIGRhICo9IGRhOwogICAgICBkYiAqPSBkYjsKICAgICAgdmFyIHggPSAuNSArIChkYiAtIGRhKSAvICgyICogZGMpLCB5ID0gTWF0aC5zcXJ0KE1hdGgubWF4KDAsIDIgKiBkYSAqIChkYiArIGRjKSAtIChkYiAtPSBkYykgKiBkYiAtIGRhICogZGEpKSAvICgyICogZGMpOwogICAgICBjLnggPSBhLnggKyB4ICogZHggKyB5ICogZHk7CiAgICAgIGMueSA9IGEueSArIHggKiBkeSAtIHkgKiBkeDsKICAgIH0gZWxzZSB7CiAgICAgIGMueCA9IGEueCArIGRiOwogICAgICBjLnkgPSBhLnk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9jbHVzdGVyWShjaGlsZHJlbikgewogICAgcmV0dXJuIDEgKyBkMy5tYXgoY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7CiAgICAgIHJldHVybiBjaGlsZC55OwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9jbHVzdGVyWChjaGlsZHJlbikgewogICAgcmV0dXJuIGNoaWxkcmVuLnJlZHVjZShmdW5jdGlvbih4LCBjaGlsZCkgewogICAgICByZXR1cm4geCArIGNoaWxkLng7CiAgICB9LCAwKSAvIGNoaWxkcmVuLmxlbmd0aDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X2NsdXN0ZXJMZWZ0KG5vZGUpIHsKICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47CiAgICByZXR1cm4gY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoID8gZDNfbGF5b3V0X2NsdXN0ZXJMZWZ0KGNoaWxkcmVuWzBdKSA6IG5vZGU7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF9jbHVzdGVyUmlnaHQobm9kZSkgewogICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbiwgbjsKICAgIHJldHVybiBjaGlsZHJlbiAmJiAobiA9IGNoaWxkcmVuLmxlbmd0aCkgPyBkM19sYXlvdXRfY2x1c3RlclJpZ2h0KGNoaWxkcmVuW24gLSAxXSkgOiBub2RlOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfdHJlZVNlcGFyYXRpb24oYSwgYikgewogICAgcmV0dXJuIGEucGFyZW50ID09IGIucGFyZW50ID8gMSA6IDI7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlTGVmdChub2RlKSB7CiAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgcmV0dXJuIGNoaWxkcmVuICYmIGNoaWxkcmVuLmxlbmd0aCA\/IGNoaWxkcmVuWzBdIDogbm9kZS5fdHJlZS50aHJlYWQ7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlUmlnaHQobm9kZSkgewogICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbiwgbjsKICAgIHJldHVybiBjaGlsZHJlbiAmJiAobiA9IGNoaWxkcmVuLmxlbmd0aCkgPyBjaGlsZHJlbltuIC0gMV0gOiBub2RlLl90cmVlLnRocmVhZDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3RyZWVTZWFyY2gobm9kZSwgY29tcGFyZSkgewogICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgIGlmIChjaGlsZHJlbiAmJiAobiA9IGNoaWxkcmVuLmxlbmd0aCkpIHsKICAgICAgdmFyIGNoaWxkLCBuLCBpID0gLTE7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgaWYgKGNvbXBhcmUoY2hpbGQgPSBkM19sYXlvdXRfdHJlZVNlYXJjaChjaGlsZHJlbltpXSwgY29tcGFyZSksIG5vZGUpID4gMCkgewogICAgICAgICAgbm9kZSA9IGNoaWxkOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIG5vZGU7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlUmlnaHRtb3N0KGEsIGIpIHsKICAgIHJldHVybiBhLnggLSBiLng7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlTGVmdG1vc3QoYSwgYikgewogICAgcmV0dXJuIGIueCAtIGEueDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3RyZWVEZWVwZXN0KGEsIGIpIHsKICAgIHJldHVybiBhLmRlcHRoIC0gYi5kZXB0aDsKICB9CiAgZnVuY3Rpb24gZDNfbGF5b3V0X3RyZWVWaXNpdEFmdGVyKG5vZGUsIGNhbGxiYWNrKSB7CiAgICBmdW5jdGlvbiB2aXNpdChub2RlLCBwcmV2aW91c1NpYmxpbmcpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgICAgaWYgKGNoaWxkcmVuICYmIChuID0gY2hpbGRyZW4ubGVuZ3RoKSkgewogICAgICAgIHZhciBjaGlsZCwgcHJldmlvdXNDaGlsZCA9IG51bGwsIGkgPSAtMSwgbjsKICAgICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgY2hpbGQgPSBjaGlsZHJlbltpXTsKICAgICAgICAgIHZpc2l0KGNoaWxkLCBwcmV2aW91c0NoaWxkKTsKICAgICAgICAgIHByZXZpb3VzQ2hpbGQgPSBjaGlsZDsKICAgICAgICB9CiAgICAgIH0KICAgICAgY2FsbGJhY2sobm9kZSwgcHJldmlvdXNTaWJsaW5nKTsKICAgIH0KICAgIHZpc2l0KG5vZGUsIG51bGwpOwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfdHJlZVNoaWZ0KG5vZGUpIHsKICAgIHZhciBzaGlmdCA9IDAsIGNoYW5nZSA9IDAsIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbiwgaSA9IGNoaWxkcmVuLmxlbmd0aCwgY2hpbGQ7CiAgICB3aGlsZSAoLS1pID49IDApIHsKICAgICAgY2hpbGQgPSBjaGlsZHJlbltpXS5fdHJlZTsKICAgICAgY2hpbGQucHJlbGltICs9IHNoaWZ0OwogICAgICBjaGlsZC5tb2QgKz0gc2hpZnQ7CiAgICAgIHNoaWZ0ICs9IGNoaWxkLnNoaWZ0ICsgKGNoYW5nZSArPSBjaGlsZC5jaGFuZ2UpOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfdHJlZU1vdmUoYW5jZXN0b3IsIG5vZGUsIHNoaWZ0KSB7CiAgICBhbmNlc3RvciA9IGFuY2VzdG9yLl90cmVlOwogICAgbm9kZSA9IG5vZGUuX3RyZWU7CiAgICB2YXIgY2hhbmdlID0gc2hpZnQgLyAobm9kZS5udW1iZXIgLSBhbmNlc3Rvci5udW1iZXIpOwogICAgYW5jZXN0b3IuY2hhbmdlICs9IGNoYW5nZTsKICAgIG5vZGUuY2hhbmdlIC09IGNoYW5nZTsKICAgIG5vZGUuc2hpZnQgKz0gc2hpZnQ7CiAgICBub2RlLnByZWxpbSArPSBzaGlmdDsKICAgIG5vZGUubW9kICs9IHNoaWZ0OwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfdHJlZUFuY2VzdG9yKHZpbSwgbm9kZSwgYW5jZXN0b3IpIHsKICAgIHJldHVybiB2aW0uX3RyZWUuYW5jZXN0b3IucGFyZW50ID09IG5vZGUucGFyZW50ID8gdmltLl90cmVlLmFuY2VzdG9yIDogYW5jZXN0b3I7CiAgfQogIGZ1bmN0aW9uIGQzX2xheW91dF90cmVlbWFwUGFkTnVsbChub2RlKSB7CiAgICByZXR1cm4gewogICAgICB4OiBub2RlLngsCiAgICAgIHk6IG5vZGUueSwKICAgICAgZHg6IG5vZGUuZHgsCiAgICAgIGR5OiBub2RlLmR5CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM19sYXlvdXRfdHJlZW1hcFBhZChub2RlLCBwYWRkaW5nKSB7CiAgICB2YXIgeCA9IG5vZGUueCArIHBhZGRpbmdbM10sIHkgPSBub2RlLnkgKyBwYWRkaW5nWzBdLCBkeCA9IG5vZGUuZHggLSBwYWRkaW5nWzFdIC0gcGFkZGluZ1szXSwgZHkgPSBub2RlLmR5IC0gcGFkZGluZ1swXSAtIHBhZGRpbmdbMl07CiAgICBpZiAoZHggPCAwKSB7CiAgICAgIHggKz0gZHggLyAyOwogICAgICBkeCA9IDA7CiAgICB9CiAgICBpZiAoZHkgPCAwKSB7CiAgICAgIHkgKz0gZHkgLyAyOwogICAgICBkeSA9IDA7CiAgICB9CiAgICByZXR1cm4gewogICAgICB4OiB4LAogICAgICB5OiB5LAogICAgICBkeDogZHgsCiAgICAgIGR5OiBkeQogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfZHN2KGRlbGltaXRlciwgbWltZVR5cGUpIHsKICAgIGZ1bmN0aW9uIGRzdih1cmwsIGNhbGxiYWNrKSB7CiAgICAgIGQzLnRleHQodXJsLCBtaW1lVHlwZSwgZnVuY3Rpb24odGV4dCkgewogICAgICAgIGNhbGxiYWNrKHRleHQgJiYgZHN2LnBhcnNlKHRleHQpKTsKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBmb3JtYXRSb3cocm93KSB7CiAgICAgIHJldHVybiByb3cubWFwKGZvcm1hdFZhbHVlKS5qb2luKGRlbGltaXRlcik7CiAgICB9CiAgICBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh0ZXh0KSB7CiAgICAgIHJldHVybiByZUZvcm1hdC50ZXN0KHRleHQpID8gJyInICsgdGV4dC5yZXBsYWNlKC9cIi9nLCAnIiInKSArICciJyA6IHRleHQ7CiAgICB9CiAgICB2YXIgcmVQYXJzZSA9IG5ldyBSZWdFeHAoIlxyXG58WyIgKyBkZWxpbWl0ZXIgKyAiXHJcbl0iLCAiZyIpLCByZUZvcm1hdCA9IG5ldyBSZWdFeHAoJ1siJyArIGRlbGltaXRlciArICJcbl0iKSwgZGVsaW1pdGVyQ29kZSA9IGRlbGltaXRlci5jaGFyQ29kZUF0KDApOwogICAgZHN2LnBhcnNlID0gZnVuY3Rpb24odGV4dCkgewogICAgICB2YXIgaGVhZGVyOwogICAgICByZXR1cm4gZHN2LnBhcnNlUm93cyh0ZXh0LCBmdW5jdGlvbihyb3csIGkpIHsKICAgICAgICBpZiAoaSkgewogICAgICAgICAgdmFyIG8gPSB7fSwgaiA9IC0xLCBtID0gaGVhZGVyLmxlbmd0aDsKICAgICAgICAgIHdoaWxlICgrK2ogPCBtKSBvW2hlYWRlcltqXV0gPSByb3dbal07CiAgICAgICAgICByZXR1cm4gbzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaGVhZGVyID0gcm93OwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICBkc3YucGFyc2VSb3dzID0gZnVuY3Rpb24odGV4dCwgZikgewogICAgICBmdW5jdGlvbiB0b2tlbigpIHsKICAgICAgICBpZiAocmVQYXJzZS5sYXN0SW5kZXggPj0gdGV4dC5sZW5ndGgpIHJldHVybiBFT0Y7CiAgICAgICAgaWYgKGVvbCkgewogICAgICAgICAgZW9sID0gZmFsc2U7CiAgICAgICAgICByZXR1cm4gRU9MOwogICAgICAgIH0KICAgICAgICB2YXIgaiA9IHJlUGFyc2UubGFzdEluZGV4OwogICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoaikgPT09IDM0KSB7CiAgICAgICAgICB2YXIgaSA9IGo7CiAgICAgICAgICB3aGlsZSAoaSsrIDwgdGV4dC5sZW5ndGgpIHsKICAgICAgICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChpKSA9PT0gMzQpIHsKICAgICAgICAgICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KGkgKyAxKSAhPT0gMzQpIGJyZWFrOwogICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmVQYXJzZS5sYXN0SW5kZXggPSBpICsgMjsKICAgICAgICAgIHZhciBjID0gdGV4dC5jaGFyQ29kZUF0KGkgKyAxKTsKICAgICAgICAgIGlmIChjID09PSAxMykgewogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KGkgKyAyKSA9PT0gMTApIHJlUGFyc2UubGFzdEluZGV4Kys7CiAgICAgICAgICB9IGVsc2UgaWYgKGMgPT09IDEwKSB7CiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHJpbmcoaiArIDEsIGkpLnJlcGxhY2UoLyIiL2csICciJyk7CiAgICAgICAgfQogICAgICAgIHZhciBtID0gcmVQYXJzZS5leGVjKHRleHQpOwogICAgICAgIGlmIChtKSB7CiAgICAgICAgICBlb2wgPSBtWzBdLmNoYXJDb2RlQXQoMCkgIT09IGRlbGltaXRlckNvZGU7CiAgICAgICAgICByZXR1cm4gdGV4dC5zdWJzdHJpbmcoaiwgbS5pbmRleCk7CiAgICAgICAgfQogICAgICAgIHJlUGFyc2UubGFzdEluZGV4ID0gdGV4dC5sZW5ndGg7CiAgICAgICAgcmV0dXJuIHRleHQuc3Vic3RyaW5nKGopOwogICAgICB9CiAgICAgIHZhciBFT0wgPSB7fSwgRU9GID0ge30sIHJvd3MgPSBbXSwgbiA9IDAsIHQsIGVvbDsKICAgICAgcmVQYXJzZS5sYXN0SW5kZXggPSAwOwogICAgICB3aGlsZSAoKHQgPSB0b2tlbigpKSAhPT0gRU9GKSB7CiAgICAgICAgdmFyIGEgPSBbXTsKICAgICAgICB3aGlsZSAodCAhPT0gRU9MICYmIHQgIT09IEVPRikgewogICAgICAgICAgYS5wdXNoKHQpOwogICAgICAgICAgdCA9IHRva2VuKCk7CiAgICAgICAgfQogICAgICAgIGlmIChmICYmICEoYSA9IGYoYSwgbisrKSkpIGNvbnRpbnVlOwogICAgICAgIHJvd3MucHVzaChhKTsKICAgICAgfQogICAgICByZXR1cm4gcm93czsKICAgIH07CiAgICBkc3YuZm9ybWF0ID0gZnVuY3Rpb24ocm93cykgewogICAgICByZXR1cm4gcm93cy5tYXAoZm9ybWF0Um93KS5qb2luKCJcbiIpOwogICAgfTsKICAgIHJldHVybiBkc3Y7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb190eXBlKHR5cGVzLCBkZWZhdWx0VmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgcmV0dXJuIG9iamVjdCAmJiB0eXBlcy5oYXNPd25Qcm9wZXJ0eShvYmplY3QudHlwZSkgPyB0eXBlc1tvYmplY3QudHlwZV0ob2JqZWN0KSA6IGRlZmF1bHRWYWx1ZTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3BhdGhfY2lyY2xlKHJhZGl1cykgewogICAgcmV0dXJuICJtMCwiICsgcmFkaXVzICsgImEiICsgcmFkaXVzICsgIiwiICsgcmFkaXVzICsgIiAwIDEsMSAwLCIgKyAtMiAqIHJhZGl1cyArICJhIiArIHJhZGl1cyArICIsIiArIHJhZGl1cyArICIgMCAxLDEgMCwiICsgKzIgKiByYWRpdXMgKyAieiI7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19ib3VuZHMobywgZikgewogICAgaWYgKGQzX2dlb19ib3VuZHNUeXBlcy5oYXNPd25Qcm9wZXJ0eShvLnR5cGUpKSBkM19nZW9fYm91bmRzVHlwZXNbby50eXBlXShvLCBmKTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2JvdW5kc0ZlYXR1cmUobywgZikgewogICAgZDNfZ2VvX2JvdW5kcyhvLmdlb21ldHJ5LCBmKTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2JvdW5kc0ZlYXR1cmVDb2xsZWN0aW9uKG8sIGYpIHsKICAgIGZvciAodmFyIGEgPSBvLmZlYXR1cmVzLCBpID0gMCwgbiA9IGEubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIGQzX2dlb19ib3VuZHMoYVtpXS5nZW9tZXRyeSwgZik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGQzX2dlb19ib3VuZHNHZW9tZXRyeUNvbGxlY3Rpb24obywgZikgewogICAgZm9yICh2YXIgYSA9IG8uZ2VvbWV0cmllcywgaSA9IDAsIG4gPSBhLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICBkM19nZW9fYm91bmRzKGFbaV0sIGYpOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fYm91bmRzTGluZVN0cmluZyhvLCBmKSB7CiAgICBmb3IgKHZhciBhID0gby5jb29yZGluYXRlcywgaSA9IDAsIG4gPSBhLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICBmLmFwcGx5KG51bGwsIGFbaV0pOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fYm91bmRzTXVsdGlMaW5lU3RyaW5nKG8sIGYpIHsKICAgIGZvciAodmFyIGEgPSBvLmNvb3JkaW5hdGVzLCBpID0gMCwgbiA9IGEubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIGZvciAodmFyIGIgPSBhW2ldLCBqID0gMCwgbSA9IGIubGVuZ3RoOyBqIDwgbTsgaisrKSB7CiAgICAgICAgZi5hcHBseShudWxsLCBiW2pdKTsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fYm91bmRzTXVsdGlQb2x5Z29uKG8sIGYpIHsKICAgIGZvciAodmFyIGEgPSBvLmNvb3JkaW5hdGVzLCBpID0gMCwgbiA9IGEubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIGZvciAodmFyIGIgPSBhW2ldWzBdLCBqID0gMCwgbSA9IGIubGVuZ3RoOyBqIDwgbTsgaisrKSB7CiAgICAgICAgZi5hcHBseShudWxsLCBiW2pdKTsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9fYm91bmRzUG9pbnQobywgZikgewogICAgZi5hcHBseShudWxsLCBvLmNvb3JkaW5hdGVzKTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2JvdW5kc1BvbHlnb24obywgZikgewogICAgZm9yICh2YXIgYSA9IG8uY29vcmRpbmF0ZXNbMF0sIGkgPSAwLCBuID0gYS5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgZi5hcHBseShudWxsLCBhW2ldKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2dyZWF0QXJjU291cmNlKGQpIHsKICAgIHJldHVybiBkLnNvdXJjZTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2dyZWF0QXJjVGFyZ2V0KGQpIHsKICAgIHJldHVybiBkLnRhcmdldDsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvX2dyZWF0QXJjSW50ZXJwb2xhdG9yKCkgewogICAgZnVuY3Rpb24gaW50ZXJwb2xhdGUodCkgewogICAgICB2YXIgQiA9IE1hdGguc2luKHQgKj0gZCkgKiBrLCBBID0gTWF0aC5zaW4oZCAtIHQpICogaywgeCA9IEEgKiBreDAgKyBCICoga3gxLCB5ID0gQSAqIGt5MCArIEIgKiBreTEsIHogPSBBICogc3kwICsgQiAqIHN5MTsKICAgICAgcmV0dXJuIFsgTWF0aC5hdGFuMih5LCB4KSAvIGQzX2dlb19yYWRpYW5zLCBNYXRoLmF0YW4yKHosIE1hdGguc3FydCh4ICogeCArIHkgKiB5KSkgLyBkM19nZW9fcmFkaWFucyBdOwogICAgfQogICAgdmFyIHgwLCB5MCwgY3kwLCBzeTAsIGt4MCwga3kwLCB4MSwgeTEsIGN5MSwgc3kxLCBreDEsIGt5MSwgZCwgazsKICAgIGludGVycG9sYXRlLmRpc3RhbmNlID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChkID09IG51bGwpIGsgPSAxIC8gTWF0aC5zaW4oZCA9IE1hdGguYWNvcyhNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgc3kwICogc3kxICsgY3kwICogY3kxICogTWF0aC5jb3MoeDEgLSB4MCkpKSkpOwogICAgICByZXR1cm4gZDsKICAgIH07CiAgICBpbnRlcnBvbGF0ZS5zb3VyY2UgPSBmdW5jdGlvbihfKSB7CiAgICAgIHZhciBjeDAgPSBNYXRoLmNvcyh4MCA9IF9bMF0gKiBkM19nZW9fcmFkaWFucyksIHN4MCA9IE1hdGguc2luKHgwKTsKICAgICAgY3kwID0gTWF0aC5jb3MoeTAgPSBfWzFdICogZDNfZ2VvX3JhZGlhbnMpOwogICAgICBzeTAgPSBNYXRoLnNpbih5MCk7CiAgICAgIGt4MCA9IGN5MCAqIGN4MDsKICAgICAga3kwID0gY3kwICogc3gwOwogICAgICBkID0gbnVsbDsKICAgICAgcmV0dXJuIGludGVycG9sYXRlOwogICAgfTsKICAgIGludGVycG9sYXRlLnRhcmdldCA9IGZ1bmN0aW9uKF8pIHsKICAgICAgdmFyIGN4MSA9IE1hdGguY29zKHgxID0gX1swXSAqIGQzX2dlb19yYWRpYW5zKSwgc3gxID0gTWF0aC5zaW4oeDEpOwogICAgICBjeTEgPSBNYXRoLmNvcyh5MSA9IF9bMV0gKiBkM19nZW9fcmFkaWFucyk7CiAgICAgIHN5MSA9IE1hdGguc2luKHkxKTsKICAgICAga3gxID0gY3kxICogY3gxOwogICAgICBreTEgPSBjeTEgKiBzeDE7CiAgICAgIGQgPSBudWxsOwogICAgICByZXR1cm4gaW50ZXJwb2xhdGU7CiAgICB9OwogICAgcmV0dXJuIGludGVycG9sYXRlOwogIH0KICBmdW5jdGlvbiBkM19nZW9fZ3JlYXRBcmNJbnRlcnBvbGF0ZShhLCBiKSB7CiAgICB2YXIgaSA9IGQzX2dlb19ncmVhdEFyY0ludGVycG9sYXRvcigpLnNvdXJjZShhKS50YXJnZXQoYik7CiAgICBpLmRpc3RhbmNlKCk7CiAgICByZXR1cm4gaTsKICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV9jb250b3VyU3RhcnQoZ3JpZCkgewogICAgdmFyIHggPSAwLCB5ID0gMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmIChncmlkKHgsIHkpKSB7CiAgICAgICAgcmV0dXJuIFsgeCwgeSBdOwogICAgICB9CiAgICAgIGlmICh4ID09PSAwKSB7CiAgICAgICAgeCA9IHkgKyAxOwogICAgICAgIHkgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHggPSB4IC0gMTsKICAgICAgICB5ID0geSArIDE7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gZDNfZ2VvbV9odWxsQ0NXKGkxLCBpMiwgaTMsIHYpIHsKICAgIHZhciB0LCBhLCBiLCBjLCBkLCBlLCBmOwogICAgdCA9IHZbaTFdOwogICAgYSA9IHRbMF07CiAgICBiID0gdFsxXTsKICAgIHQgPSB2W2kyXTsKICAgIGMgPSB0WzBdOwogICAgZCA9IHRbMV07CiAgICB0ID0gdltpM107CiAgICBlID0gdFswXTsKICAgIGYgPSB0WzFdOwogICAgcmV0dXJuIChmIC0gYikgKiAoYyAtIGEpIC0gKGQgLSBiKSAqIChlIC0gYSkgPiAwOwogIH0KICBmdW5jdGlvbiBkM19nZW9tX3BvbHlnb25JbnNpZGUocCwgYSwgYikgewogICAgcmV0dXJuIChiWzBdIC0gYVswXSkgKiAocFsxXSAtIGFbMV0pIDwgKGJbMV0gLSBhWzFdKSAqIChwWzBdIC0gYVswXSk7CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fcG9seWdvbkludGVyc2VjdChjLCBkLCBhLCBiKSB7CiAgICB2YXIgeDEgPSBjWzBdLCB4MiA9IGRbMF0sIHgzID0gYVswXSwgeDQgPSBiWzBdLCB5MSA9IGNbMV0sIHkyID0gZFsxXSwgeTMgPSBhWzFdLCB5NCA9IGJbMV0sIHgxMyA9IHgxIC0geDMsIHgyMSA9IHgyIC0geDEsIHg0MyA9IHg0IC0geDMsIHkxMyA9IHkxIC0geTMsIHkyMSA9IHkyIC0geTEsIHk0MyA9IHk0IC0geTMsIHVhID0gKHg0MyAqIHkxMyAtIHk0MyAqIHgxMykgLyAoeTQzICogeDIxIC0geDQzICogeTIxKTsKICAgIHJldHVybiBbIHgxICsgdWEgKiB4MjEsIHkxICsgdWEgKiB5MjEgXTsKICB9CiAgZnVuY3Rpb24gZDNfdm9yb25vaV90ZXNzZWxsYXRlKHZlcnRpY2VzLCBjYWxsYmFjaykgewogICAgdmFyIFNpdGVzID0gewogICAgICBsaXN0OiB2ZXJ0aWNlcy5tYXAoZnVuY3Rpb24odiwgaSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpbmRleDogaSwKICAgICAgICAgIHg6IHZbMF0sCiAgICAgICAgICB5OiB2WzFdCiAgICAgICAgfTsKICAgICAgfSkuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEueSA8IGIueSA\/IC0xIDogYS55ID4gYi55ID8gMSA6IGEueCA8IGIueCA\/IC0xIDogYS54ID4gYi54ID8gMSA6IDA7CiAgICAgIH0pLAogICAgICBib3R0b21TaXRlOiBudWxsCiAgICB9OwogICAgdmFyIEVkZ2VMaXN0ID0gewogICAgICBsaXN0OiBbXSwKICAgICAgbGVmdEVuZDogbnVsbCwKICAgICAgcmlnaHRFbmQ6IG51bGwsCiAgICAgIGluaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIEVkZ2VMaXN0LmxlZnRFbmQgPSBFZGdlTGlzdC5jcmVhdGVIYWxmRWRnZShudWxsLCAibCIpOwogICAgICAgIEVkZ2VMaXN0LnJpZ2h0RW5kID0gRWRnZUxpc3QuY3JlYXRlSGFsZkVkZ2UobnVsbCwgImwiKTsKICAgICAgICBFZGdlTGlzdC5sZWZ0RW5kLnIgPSBFZGdlTGlzdC5yaWdodEVuZDsKICAgICAgICBFZGdlTGlzdC5yaWdodEVuZC5sID0gRWRnZUxpc3QubGVmdEVuZDsKICAgICAgICBFZGdlTGlzdC5saXN0LnVuc2hpZnQoRWRnZUxpc3QubGVmdEVuZCwgRWRnZUxpc3QucmlnaHRFbmQpOwogICAgICB9LAogICAgICBjcmVhdGVIYWxmRWRnZTogZnVuY3Rpb24oZWRnZSwgc2lkZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBlZGdlOiBlZGdlLAogICAgICAgICAgc2lkZTogc2lkZSwKICAgICAgICAgIHZlcnRleDogbnVsbCwKICAgICAgICAgIGw6IG51bGwsCiAgICAgICAgICByOiBudWxsCiAgICAgICAgfTsKICAgICAgfSwKICAgICAgaW5zZXJ0OiBmdW5jdGlvbihsYiwgaGUpIHsKICAgICAgICBoZS5sID0gbGI7CiAgICAgICAgaGUuciA9IGxiLnI7CiAgICAgICAgbGIuci5sID0gaGU7CiAgICAgICAgbGIuciA9IGhlOwogICAgICB9LAogICAgICBsZWZ0Qm91bmQ6IGZ1bmN0aW9uKHApIHsKICAgICAgICB2YXIgaGUgPSBFZGdlTGlzdC5sZWZ0RW5kOwogICAgICAgIGRvIHsKICAgICAgICAgIGhlID0gaGUucjsKICAgICAgICB9IHdoaWxlIChoZSAhPSBFZGdlTGlzdC5yaWdodEVuZCAmJiBHZW9tLnJpZ2h0T2YoaGUsIHApKTsKICAgICAgICBoZSA9IGhlLmw7CiAgICAgICAgcmV0dXJuIGhlOwogICAgICB9LAogICAgICBkZWw6IGZ1bmN0aW9uKGhlKSB7CiAgICAgICAgaGUubC5yID0gaGUucjsKICAgICAgICBoZS5yLmwgPSBoZS5sOwogICAgICAgIGhlLmVkZ2UgPSBudWxsOwogICAgICB9LAogICAgICByaWdodDogZnVuY3Rpb24oaGUpIHsKICAgICAgICByZXR1cm4gaGUucjsKICAgICAgfSwKICAgICAgbGVmdDogZnVuY3Rpb24oaGUpIHsKICAgICAgICByZXR1cm4gaGUubDsKICAgICAgfSwKICAgICAgbGVmdFJlZ2lvbjogZnVuY3Rpb24oaGUpIHsKICAgICAgICByZXR1cm4gaGUuZWRnZSA9PSBudWxsID8gU2l0ZXMuYm90dG9tU2l0ZSA6IGhlLmVkZ2UucmVnaW9uW2hlLnNpZGVdOwogICAgICB9LAogICAgICByaWdodFJlZ2lvbjogZnVuY3Rpb24oaGUpIHsKICAgICAgICByZXR1cm4gaGUuZWRnZSA9PSBudWxsID8gU2l0ZXMuYm90dG9tU2l0ZSA6IGhlLmVkZ2UucmVnaW9uW2QzX3Zvcm9ub2lfb3Bwb3NpdGVbaGUuc2lkZV1dOwogICAgICB9CiAgICB9OwogICAgdmFyIEdlb20gPSB7CiAgICAgIGJpc2VjdDogZnVuY3Rpb24oczEsIHMyKSB7CiAgICAgICAgdmFyIG5ld0VkZ2UgPSB7CiAgICAgICAgICByZWdpb246IHsKICAgICAgICAgICAgbDogczEsCiAgICAgICAgICAgIHI6IHMyCiAgICAgICAgICB9LAogICAgICAgICAgZXA6IHsKICAgICAgICAgICAgbDogbnVsbCwKICAgICAgICAgICAgcjogbnVsbAogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdmFyIGR4ID0gczIueCAtIHMxLngsIGR5ID0gczIueSAtIHMxLnksIGFkeCA9IGR4ID4gMCA\/IGR4IDogLWR4LCBhZHkgPSBkeSA+IDAgPyBkeSA6IC1keTsKICAgICAgICBuZXdFZGdlLmMgPSBzMS54ICogZHggKyBzMS55ICogZHkgKyAoZHggKiBkeCArIGR5ICogZHkpICogLjU7CiAgICAgICAgaWYgKGFkeCA+IGFkeSkgewogICAgICAgICAgbmV3RWRnZS5hID0gMTsKICAgICAgICAgIG5ld0VkZ2UuYiA9IGR5IC8gZHg7CiAgICAgICAgICBuZXdFZGdlLmMgLz0gZHg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5ld0VkZ2UuYiA9IDE7CiAgICAgICAgICBuZXdFZGdlLmEgPSBkeCAvIGR5OwogICAgICAgICAgbmV3RWRnZS5jIC89IGR5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3RWRnZTsKICAgICAgfSwKICAgICAgaW50ZXJzZWN0OiBmdW5jdGlvbihlbDEsIGVsMikgewogICAgICAgIHZhciBlMSA9IGVsMS5lZGdlLCBlMiA9IGVsMi5lZGdlOwogICAgICAgIGlmICghZTEgfHwgIWUyIHx8IGUxLnJlZ2lvbi5yID09IGUyLnJlZ2lvbi5yKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIGQgPSBlMS5hICogZTIuYiAtIGUxLmIgKiBlMi5hOwogICAgICAgIGlmIChNYXRoLmFicyhkKSA8IDFlLTEwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIHhpbnQgPSAoZTEuYyAqIGUyLmIgLSBlMi5jICogZTEuYikgLyBkLCB5aW50ID0gKGUyLmMgKiBlMS5hIC0gZTEuYyAqIGUyLmEpIC8gZCwgZTFyID0gZTEucmVnaW9uLnIsIGUyciA9IGUyLnJlZ2lvbi5yLCBlbCwgZTsKICAgICAgICBpZiAoZTFyLnkgPCBlMnIueSB8fCBlMXIueSA9PSBlMnIueSAmJiBlMXIueCA8IGUyci54KSB7CiAgICAgICAgICBlbCA9IGVsMTsKICAgICAgICAgIGUgPSBlMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWwgPSBlbDI7CiAgICAgICAgICBlID0gZTI7CiAgICAgICAgfQogICAgICAgIHZhciByaWdodE9mU2l0ZSA9IHhpbnQgPj0gZS5yZWdpb24uci54OwogICAgICAgIGlmIChyaWdodE9mU2l0ZSAmJiBlbC5zaWRlID09PSAibCIgfHwgIXJpZ2h0T2ZTaXRlICYmIGVsLnNpZGUgPT09ICJyIikgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICB4OiB4aW50LAogICAgICAgICAgeTogeWludAogICAgICAgIH07CiAgICAgIH0sCiAgICAgIHJpZ2h0T2Y6IGZ1bmN0aW9uKGhlLCBwKSB7CiAgICAgICAgdmFyIGUgPSBoZS5lZGdlLCB0b3BzaXRlID0gZS5yZWdpb24uciwgcmlnaHRPZlNpdGUgPSBwLnggPiB0b3BzaXRlLng7CiAgICAgICAgaWYgKHJpZ2h0T2ZTaXRlICYmIGhlLnNpZGUgPT09ICJsIikgewogICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGlmICghcmlnaHRPZlNpdGUgJiYgaGUuc2lkZSA9PT0gInIiKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgaWYgKGUuYSA9PT0gMSkgewogICAgICAgICAgdmFyIGR5cCA9IHAueSAtIHRvcHNpdGUueSwgZHhwID0gcC54IC0gdG9wc2l0ZS54LCBmYXN0ID0gMCwgYWJvdmUgPSAwOwogICAgICAgICAgaWYgKCFyaWdodE9mU2l0ZSAmJiBlLmIgPCAwIHx8IHJpZ2h0T2ZTaXRlICYmIGUuYiA+PSAwKSB7CiAgICAgICAgICAgIGFib3ZlID0gZmFzdCA9IGR5cCA+PSBlLmIgKiBkeHA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhYm92ZSA9IHAueCArIHAueSAqIGUuYiA+IGUuYzsKICAgICAgICAgICAgaWYgKGUuYiA8IDApIHsKICAgICAgICAgICAgICBhYm92ZSA9ICFhYm92ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWFib3ZlKSB7CiAgICAgICAgICAgICAgZmFzdCA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghZmFzdCkgewogICAgICAgICAgICB2YXIgZHhzID0gdG9wc2l0ZS54IC0gZS5yZWdpb24ubC54OwogICAgICAgICAgICBhYm92ZSA9IGUuYiAqIChkeHAgKiBkeHAgLSBkeXAgKiBkeXApIDwgZHhzICogZHlwICogKDEgKyAyICogZHhwIC8gZHhzICsgZS5iICogZS5iKTsKICAgICAgICAgICAgaWYgKGUuYiA8IDApIHsKICAgICAgICAgICAgICBhYm92ZSA9ICFhYm92ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgeWwgPSBlLmMgLSBlLmEgKiBwLngsIHQxID0gcC55IC0geWwsIHQyID0gcC54IC0gdG9wc2l0ZS54LCB0MyA9IHlsIC0gdG9wc2l0ZS55OwogICAgICAgICAgYWJvdmUgPSB0MSAqIHQxID4gdDIgKiB0MiArIHQzICogdDM7CiAgICAgICAgfQogICAgICAgIHJldHVybiBoZS5zaWRlID09PSAibCIgPyBhYm92ZSA6ICFhYm92ZTsKICAgICAgfSwKICAgICAgZW5kUG9pbnQ6IGZ1bmN0aW9uKGVkZ2UsIHNpZGUsIHNpdGUpIHsKICAgICAgICBlZGdlLmVwW3NpZGVdID0gc2l0ZTsKICAgICAgICBpZiAoIWVkZ2UuZXBbZDNfdm9yb25vaV9vcHBvc2l0ZVtzaWRlXV0pIHJldHVybjsKICAgICAgICBjYWxsYmFjayhlZGdlKTsKICAgICAgfSwKICAgICAgZGlzdGFuY2U6IGZ1bmN0aW9uKHMsIHQpIHsKICAgICAgICB2YXIgZHggPSBzLnggLSB0LngsIGR5ID0gcy55IC0gdC55OwogICAgICAgIHJldHVybiBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICB9CiAgICB9OwogICAgdmFyIEV2ZW50UXVldWUgPSB7CiAgICAgIGxpc3Q6IFtdLAogICAgICBpbnNlcnQ6IGZ1bmN0aW9uKGhlLCBzaXRlLCBvZmZzZXQpIHsKICAgICAgICBoZS52ZXJ0ZXggPSBzaXRlOwogICAgICAgIGhlLnlzdGFyID0gc2l0ZS55ICsgb2Zmc2V0OwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsaXN0ID0gRXZlbnRRdWV1ZS5saXN0LCBsID0gbGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIHZhciBuZXh0ID0gbGlzdFtpXTsKICAgICAgICAgIGlmIChoZS55c3RhciA+IG5leHQueXN0YXIgfHwgaGUueXN0YXIgPT0gbmV4dC55c3RhciAmJiBzaXRlLnggPiBuZXh0LnZlcnRleC54KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxpc3Quc3BsaWNlKGksIDAsIGhlKTsKICAgICAgfSwKICAgICAgZGVsOiBmdW5jdGlvbihoZSkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBscyA9IEV2ZW50UXVldWUubGlzdCwgbCA9IGxzLmxlbmd0aDsgaSA8IGwgJiYgbHNbaV0gIT0gaGU7ICsraSkge30KICAgICAgICBscy5zcGxpY2UoaSwgMSk7CiAgICAgIH0sCiAgICAgIGVtcHR5OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gRXZlbnRRdWV1ZS5saXN0Lmxlbmd0aCA9PT0gMDsKICAgICAgfSwKICAgICAgbmV4dEV2ZW50OiBmdW5jdGlvbihoZSkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBscyA9IEV2ZW50UXVldWUubGlzdCwgbCA9IGxzLmxlbmd0aDsgaSA8IGw7ICsraSkgewogICAgICAgICAgaWYgKGxzW2ldID09IGhlKSByZXR1cm4gbHNbaSArIDFdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSwKICAgICAgbWluOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZWxlbSA9IEV2ZW50UXVldWUubGlzdFswXTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgeDogZWxlbS52ZXJ0ZXgueCwKICAgICAgICAgIHk6IGVsZW0ueXN0YXIKICAgICAgICB9OwogICAgICB9LAogICAgICBleHRyYWN0TWluOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gRXZlbnRRdWV1ZS5saXN0LnNoaWZ0KCk7CiAgICAgIH0KICAgIH07CiAgICBFZGdlTGlzdC5pbml0KCk7CiAgICBTaXRlcy5ib3R0b21TaXRlID0gU2l0ZXMubGlzdC5zaGlmdCgpOwogICAgdmFyIG5ld1NpdGUgPSBTaXRlcy5saXN0LnNoaWZ0KCksIG5ld0ludFN0YXI7CiAgICB2YXIgbGJuZCwgcmJuZCwgbGxibmQsIHJyYm5kLCBiaXNlY3RvcjsKICAgIHZhciBib3QsIHRvcCwgdGVtcCwgcCwgdjsKICAgIHZhciBlLCBwbTsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmICghRXZlbnRRdWV1ZS5lbXB0eSgpKSB7CiAgICAgICAgbmV3SW50U3RhciA9IEV2ZW50UXVldWUubWluKCk7CiAgICAgIH0KICAgICAgaWYgKG5ld1NpdGUgJiYgKEV2ZW50UXVldWUuZW1wdHkoKSB8fCBuZXdTaXRlLnkgPCBuZXdJbnRTdGFyLnkgfHwgbmV3U2l0ZS55ID09IG5ld0ludFN0YXIueSAmJiBuZXdTaXRlLnggPCBuZXdJbnRTdGFyLngpKSB7CiAgICAgICAgbGJuZCA9IEVkZ2VMaXN0LmxlZnRCb3VuZChuZXdTaXRlKTsKICAgICAgICByYm5kID0gRWRnZUxpc3QucmlnaHQobGJuZCk7CiAgICAgICAgYm90ID0gRWRnZUxpc3QucmlnaHRSZWdpb24obGJuZCk7CiAgICAgICAgZSA9IEdlb20uYmlzZWN0KGJvdCwgbmV3U2l0ZSk7CiAgICAgICAgYmlzZWN0b3IgPSBFZGdlTGlzdC5jcmVhdGVIYWxmRWRnZShlLCAibCIpOwogICAgICAgIEVkZ2VMaXN0Lmluc2VydChsYm5kLCBiaXNlY3Rvcik7CiAgICAgICAgcCA9IEdlb20uaW50ZXJzZWN0KGxibmQsIGJpc2VjdG9yKTsKICAgICAgICBpZiAocCkgewogICAgICAgICAgRXZlbnRRdWV1ZS5kZWwobGJuZCk7CiAgICAgICAgICBFdmVudFF1ZXVlLmluc2VydChsYm5kLCBwLCBHZW9tLmRpc3RhbmNlKHAsIG5ld1NpdGUpKTsKICAgICAgICB9CiAgICAgICAgbGJuZCA9IGJpc2VjdG9yOwogICAgICAgIGJpc2VjdG9yID0gRWRnZUxpc3QuY3JlYXRlSGFsZkVkZ2UoZSwgInIiKTsKICAgICAgICBFZGdlTGlzdC5pbnNlcnQobGJuZCwgYmlzZWN0b3IpOwogICAgICAgIHAgPSBHZW9tLmludGVyc2VjdChiaXNlY3RvciwgcmJuZCk7CiAgICAgICAgaWYgKHApIHsKICAgICAgICAgIEV2ZW50UXVldWUuaW5zZXJ0KGJpc2VjdG9yLCBwLCBHZW9tLmRpc3RhbmNlKHAsIG5ld1NpdGUpKTsKICAgICAgICB9CiAgICAgICAgbmV3U2l0ZSA9IFNpdGVzLmxpc3Quc2hpZnQoKTsKICAgICAgfSBlbHNlIGlmICghRXZlbnRRdWV1ZS5lbXB0eSgpKSB7CiAgICAgICAgbGJuZCA9IEV2ZW50UXVldWUuZXh0cmFjdE1pbigpOwogICAgICAgIGxsYm5kID0gRWRnZUxpc3QubGVmdChsYm5kKTsKICAgICAgICByYm5kID0gRWRnZUxpc3QucmlnaHQobGJuZCk7CiAgICAgICAgcnJibmQgPSBFZGdlTGlzdC5yaWdodChyYm5kKTsKICAgICAgICBib3QgPSBFZGdlTGlzdC5sZWZ0UmVnaW9uKGxibmQpOwogICAgICAgIHRvcCA9IEVkZ2VMaXN0LnJpZ2h0UmVnaW9uKHJibmQpOwogICAgICAgIHYgPSBsYm5kLnZlcnRleDsKICAgICAgICBHZW9tLmVuZFBvaW50KGxibmQuZWRnZSwgbGJuZC5zaWRlLCB2KTsKICAgICAgICBHZW9tLmVuZFBvaW50KHJibmQuZWRnZSwgcmJuZC5zaWRlLCB2KTsKICAgICAgICBFZGdlTGlzdC5kZWwobGJuZCk7CiAgICAgICAgRXZlbnRRdWV1ZS5kZWwocmJuZCk7CiAgICAgICAgRWRnZUxpc3QuZGVsKHJibmQpOwogICAgICAgIHBtID0gImwiOwogICAgICAgIGlmIChib3QueSA+IHRvcC55KSB7CiAgICAgICAgICB0ZW1wID0gYm90OwogICAgICAgICAgYm90ID0gdG9wOwogICAgICAgICAgdG9wID0gdGVtcDsKICAgICAgICAgIHBtID0gInIiOwogICAgICAgIH0KICAgICAgICBlID0gR2VvbS5iaXNlY3QoYm90LCB0b3ApOwogICAgICAgIGJpc2VjdG9yID0gRWRnZUxpc3QuY3JlYXRlSGFsZkVkZ2UoZSwgcG0pOwogICAgICAgIEVkZ2VMaXN0Lmluc2VydChsbGJuZCwgYmlzZWN0b3IpOwogICAgICAgIEdlb20uZW5kUG9pbnQoZSwgZDNfdm9yb25vaV9vcHBvc2l0ZVtwbV0sIHYpOwogICAgICAgIHAgPSBHZW9tLmludGVyc2VjdChsbGJuZCwgYmlzZWN0b3IpOwogICAgICAgIGlmIChwKSB7CiAgICAgICAgICBFdmVudFF1ZXVlLmRlbChsbGJuZCk7CiAgICAgICAgICBFdmVudFF1ZXVlLmluc2VydChsbGJuZCwgcCwgR2VvbS5kaXN0YW5jZShwLCBib3QpKTsKICAgICAgICB9CiAgICAgICAgcCA9IEdlb20uaW50ZXJzZWN0KGJpc2VjdG9yLCBycmJuZCk7CiAgICAgICAgaWYgKHApIHsKICAgICAgICAgIEV2ZW50UXVldWUuaW5zZXJ0KGJpc2VjdG9yLCBwLCBHZW9tLmRpc3RhbmNlKHAsIGJvdCkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgZm9yIChsYm5kID0gRWRnZUxpc3QucmlnaHQoRWRnZUxpc3QubGVmdEVuZCk7IGxibmQgIT0gRWRnZUxpc3QucmlnaHRFbmQ7IGxibmQgPSBFZGdlTGlzdC5yaWdodChsYm5kKSkgewogICAgICBjYWxsYmFjayhsYm5kLmVkZ2UpOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9tX3F1YWR0cmVlTm9kZSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxlYWY6IHRydWUsCiAgICAgIG5vZGVzOiBbXSwKICAgICAgcG9pbnQ6IG51bGwKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBub2RlLCB4MSwgeTEsIHgyLCB5MikgewogICAgaWYgKCFmKG5vZGUsIHgxLCB5MSwgeDIsIHkyKSkgewogICAgICB2YXIgc3ggPSAoeDEgKyB4MikgKiAuNSwgc3kgPSAoeTEgKyB5MikgKiAuNSwgY2hpbGRyZW4gPSBub2RlLm5vZGVzOwogICAgICBpZiAoY2hpbGRyZW5bMF0pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblswXSwgeDEsIHkxLCBzeCwgc3kpOwogICAgICBpZiAoY2hpbGRyZW5bMV0pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblsxXSwgc3gsIHkxLCB4Miwgc3kpOwogICAgICBpZiAoY2hpbGRyZW5bMl0pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblsyXSwgeDEsIHN5LCBzeCwgeTIpOwogICAgICBpZiAoY2hpbGRyZW5bM10pIGQzX2dlb21fcXVhZHRyZWVWaXNpdChmLCBjaGlsZHJlblszXSwgc3gsIHN5LCB4MiwgeTIpOwogICAgfQogIH0KICBmdW5jdGlvbiBkM19nZW9tX3F1YWR0cmVlUG9pbnQocCkgewogICAgcmV0dXJuIHsKICAgICAgeDogcFswXSwKICAgICAgeTogcFsxXQogICAgfTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV91dGMoKSB7CiAgICB0aGlzLl8gPSBuZXcgRGF0ZShhcmd1bWVudHMubGVuZ3RoID4gMSA\/IERhdGUuVVRDLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBhcmd1bWVudHNbMF0pOwogIH0KICBmdW5jdGlvbiBkM190aW1lX2Zvcm1hdEFiYnJldmlhdGUobmFtZSkgewogICAgcmV0dXJuIG5hbWUuc3Vic3RyaW5nKDAsIDMpOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlKGRhdGUsIHRlbXBsYXRlLCBzdHJpbmcsIGopIHsKICAgIHZhciBjLCBwLCBpID0gMCwgbiA9IHRlbXBsYXRlLmxlbmd0aCwgbSA9IHN0cmluZy5sZW5ndGg7CiAgICB3aGlsZSAoaSA8IG4pIHsKICAgICAgaWYgKGogPj0gbSkgcmV0dXJuIC0xOwogICAgICBjID0gdGVtcGxhdGUuY2hhckNvZGVBdChpKyspOwogICAgICBpZiAoYyA9PSAzNykgewogICAgICAgIHAgPSBkM190aW1lX3BhcnNlcnNbdGVtcGxhdGUuY2hhckF0KGkrKyldOwogICAgICAgIGlmICghcCB8fCAoaiA9IHAoZGF0ZSwgc3RyaW5nLCBqKSkgPCAwKSByZXR1cm4gLTE7CiAgICAgIH0gZWxzZSBpZiAoYyAhPSBzdHJpbmcuY2hhckNvZGVBdChqKyspKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gajsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9mb3JtYXRSZShuYW1lcykgewogICAgcmV0dXJuIG5ldyBSZWdFeHAoIl4oPzoiICsgbmFtZXMubWFwKGQzLnJlcXVvdGUpLmpvaW4oInwiKSArICIpIiwgImkiKTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9mb3JtYXRMb29rdXAobmFtZXMpIHsKICAgIHZhciBtYXAgPSBuZXcgZDNfTWFwLCBpID0gLTEsIG4gPSBuYW1lcy5sZW5ndGg7CiAgICB3aGlsZSAoKytpIDwgbikgbWFwLnNldChuYW1lc1tpXS50b0xvd2VyQ2FzZSgpLCBpKTsKICAgIHJldHVybiBtYXA7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VXZWVrZGF5QWJicmV2KGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9kYXlBYmJyZXZSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX2RheUFiYnJldlJlLmV4ZWMoc3RyaW5nLnN1YnN0cmluZyhpKSk7CiAgICByZXR1cm4gbiA\/IGkgKz0gblswXS5sZW5ndGggOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVdlZWtkYXkoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX2RheVJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfZGF5UmUuZXhlYyhzdHJpbmcuc3Vic3RyaW5nKGkpKTsKICAgIHJldHVybiBuID8gaSArPSBuWzBdLmxlbmd0aCA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlTW9udGhBYmJyZXYoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX21vbnRoQWJicmV2UmUubGFzdEluZGV4ID0gMDsKICAgIHZhciBuID0gZDNfdGltZV9tb250aEFiYnJldlJlLmV4ZWMoc3RyaW5nLnN1YnN0cmluZyhpKSk7CiAgICByZXR1cm4gbiA\/IChkYXRlLm0gPSBkM190aW1lX21vbnRoQWJicmV2TG9va3VwLmdldChuWzBdLnRvTG93ZXJDYXNlKCkpLCBpICs9IG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlTW9udGgoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX21vbnRoUmUubGFzdEluZGV4ID0gMDsKICAgIHZhciBuID0gZDNfdGltZV9tb250aFJlLmV4ZWMoc3RyaW5nLnN1YnN0cmluZyhpKSk7CiAgICByZXR1cm4gbiA\/IChkYXRlLm0gPSBkM190aW1lX21vbnRoTG9va3VwLmdldChuWzBdLnRvTG93ZXJDYXNlKCkpLCBpICs9IG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlTG9jYWxlRnVsbChkYXRlLCBzdHJpbmcsIGkpIHsKICAgIHJldHVybiBkM190aW1lX3BhcnNlKGRhdGUsIGQzX3RpbWVfZm9ybWF0cy5jLnRvU3RyaW5nKCksIHN0cmluZywgaSk7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VMb2NhbGVEYXRlKGRhdGUsIHN0cmluZywgaSkgewogICAgcmV0dXJuIGQzX3RpbWVfcGFyc2UoZGF0ZSwgZDNfdGltZV9mb3JtYXRzLngudG9TdHJpbmcoKSwgc3RyaW5nLCBpKTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZUxvY2FsZVRpbWUoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICByZXR1cm4gZDNfdGltZV9wYXJzZShkYXRlLCBkM190aW1lX2Zvcm1hdHMuWC50b1N0cmluZygpLCBzdHJpbmcsIGkpOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlRnVsbFllYXIoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc3Vic3RyaW5nKGksIGkgKyA0KSk7CiAgICByZXR1cm4gbiA\/IChkYXRlLnkgPSArblswXSwgaSArPSBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVllYXIoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc3Vic3RyaW5nKGksIGkgKyAyKSk7CiAgICByZXR1cm4gbiA\/IChkYXRlLnkgPSBkM190aW1lX2V4cGFuZFllYXIoK25bMF0pLCBpICs9IG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX2V4cGFuZFllYXIoZCkgewogICAgcmV0dXJuIGQgKyAoZCA+IDY4ID8gMTkwMCA6IDJlMyk7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VNb250aE51bWJlcihkYXRlLCBzdHJpbmcsIGkpIHsKICAgIGQzX3RpbWVfbnVtYmVyUmUubGFzdEluZGV4ID0gMDsKICAgIHZhciBuID0gZDNfdGltZV9udW1iZXJSZS5leGVjKHN0cmluZy5zdWJzdHJpbmcoaSwgaSArIDIpKTsKICAgIHJldHVybiBuID8gKGRhdGUubSA9IG5bMF0gLSAxLCBpICs9IG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlRGF5KGRhdGUsIHN0cmluZywgaSkgewogICAgZDNfdGltZV9udW1iZXJSZS5sYXN0SW5kZXggPSAwOwogICAgdmFyIG4gPSBkM190aW1lX251bWJlclJlLmV4ZWMoc3RyaW5nLnN1YnN0cmluZyhpLCBpICsgMikpOwogICAgcmV0dXJuIG4gPyAoZGF0ZS5kID0gK25bMF0sIGkgKz0gblswXS5sZW5ndGgpIDogLTE7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfcGFyc2VIb3VyMjQoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc3Vic3RyaW5nKGksIGkgKyAyKSk7CiAgICByZXR1cm4gbiA\/IChkYXRlLkggPSArblswXSwgaSArPSBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZU1pbnV0ZXMoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc3Vic3RyaW5nKGksIGkgKyAyKSk7CiAgICByZXR1cm4gbiA\/IChkYXRlLk0gPSArblswXSwgaSArPSBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZVNlY29uZHMoZGF0ZSwgc3RyaW5nLCBpKSB7CiAgICBkM190aW1lX251bWJlclJlLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbiA9IGQzX3RpbWVfbnVtYmVyUmUuZXhlYyhzdHJpbmcuc3Vic3RyaW5nKGksIGkgKyAyKSk7CiAgICByZXR1cm4gbiA\/IChkYXRlLlMgPSArblswXSwgaSArPSBuWzBdLmxlbmd0aCkgOiAtMTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9wYXJzZU1pbGxpc2Vjb25kcyhkYXRlLCBzdHJpbmcsIGkpIHsKICAgIGQzX3RpbWVfbnVtYmVyUmUubGFzdEluZGV4ID0gMDsKICAgIHZhciBuID0gZDNfdGltZV9udW1iZXJSZS5leGVjKHN0cmluZy5zdWJzdHJpbmcoaSwgaSArIDMpKTsKICAgIHJldHVybiBuID8gKGRhdGUuTCA9ICtuWzBdLCBpICs9IG5bMF0ubGVuZ3RoKSA6IC0xOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3BhcnNlQW1QbShkYXRlLCBzdHJpbmcsIGkpIHsKICAgIHZhciBuID0gZDNfdGltZV9hbVBtTG9va3VwLmdldChzdHJpbmcuc3Vic3RyaW5nKGksIGkgKz0gMikudG9Mb3dlckNhc2UoKSk7CiAgICByZXR1cm4gbiA9PSBudWxsID8gLTEgOiAoZGF0ZS5wID0gbiwgaSk7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfem9uZShkKSB7CiAgICB2YXIgeiA9IGQuZ2V0VGltZXpvbmVPZmZzZXQoKSwgenMgPSB6ID4gMCA\/ICItIiA6ICIrIiwgemggPSB+fihNYXRoLmFicyh6KSAvIDYwKSwgem0gPSBNYXRoLmFicyh6KSAlIDYwOwogICAgcmV0dXJuIHpzICsgZDNfdGltZV96ZmlsbDIoemgpICsgZDNfdGltZV96ZmlsbDIoem0pOwogIH0KICBmdW5jdGlvbiBkM190aW1lX2Zvcm1hdElzb05hdGl2ZShkYXRlKSB7CiAgICByZXR1cm4gZGF0ZS50b0lTT1N0cmluZygpOwogIH0KICBmdW5jdGlvbiBkM190aW1lX2ludGVydmFsKGxvY2FsLCBzdGVwLCBudW1iZXIpIHsKICAgIGZ1bmN0aW9uIHJvdW5kKGRhdGUpIHsKICAgICAgdmFyIGQwID0gbG9jYWwoZGF0ZSksIGQxID0gb2Zmc2V0KGQwLCAxKTsKICAgICAgcmV0dXJuIGRhdGUgLSBkMCA8IGQxIC0gZGF0ZSA\/IGQwIDogZDE7CiAgICB9CiAgICBmdW5jdGlvbiBjZWlsKGRhdGUpIHsKICAgICAgc3RlcChkYXRlID0gbG9jYWwobmV3IGQzX3RpbWUoZGF0ZSAtIDEpKSwgMSk7CiAgICAgIHJldHVybiBkYXRlOwogICAgfQogICAgZnVuY3Rpb24gb2Zmc2V0KGRhdGUsIGspIHsKICAgICAgc3RlcChkYXRlID0gbmV3IGQzX3RpbWUoK2RhdGUpLCBrKTsKICAgICAgcmV0dXJuIGRhdGU7CiAgICB9CiAgICBmdW5jdGlvbiByYW5nZSh0MCwgdDEsIGR0KSB7CiAgICAgIHZhciB0aW1lID0gY2VpbCh0MCksIHRpbWVzID0gW107CiAgICAgIGlmIChkdCA+IDEpIHsKICAgICAgICB3aGlsZSAodGltZSA8IHQxKSB7CiAgICAgICAgICBpZiAoIShudW1iZXIodGltZSkgJSBkdCkpIHRpbWVzLnB1c2gobmV3IERhdGUoK3RpbWUpKTsKICAgICAgICAgIHN0ZXAodGltZSwgMSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHdoaWxlICh0aW1lIDwgdDEpIHRpbWVzLnB1c2gobmV3IERhdGUoK3RpbWUpKSwgc3RlcCh0aW1lLCAxKTsKICAgICAgfQogICAgICByZXR1cm4gdGltZXM7CiAgICB9CiAgICBmdW5jdGlvbiByYW5nZV91dGModDAsIHQxLCBkdCkgewogICAgICB0cnkgewogICAgICAgIGQzX3RpbWUgPSBkM190aW1lX3V0YzsKICAgICAgICB2YXIgdXRjID0gbmV3IGQzX3RpbWVfdXRjOwogICAgICAgIHV0Yy5fID0gdDA7CiAgICAgICAgcmV0dXJuIHJhbmdlKHV0YywgdDEsIGR0KTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBkM190aW1lID0gRGF0ZTsKICAgICAgfQogICAgfQogICAgbG9jYWwuZmxvb3IgPSBsb2NhbDsKICAgIGxvY2FsLnJvdW5kID0gcm91bmQ7CiAgICBsb2NhbC5jZWlsID0gY2VpbDsKICAgIGxvY2FsLm9mZnNldCA9IG9mZnNldDsKICAgIGxvY2FsLnJhbmdlID0gcmFuZ2U7CiAgICB2YXIgdXRjID0gbG9jYWwudXRjID0gZDNfdGltZV9pbnRlcnZhbF91dGMobG9jYWwpOwogICAgdXRjLmZsb29yID0gdXRjOwogICAgdXRjLnJvdW5kID0gZDNfdGltZV9pbnRlcnZhbF91dGMocm91bmQpOwogICAgdXRjLmNlaWwgPSBkM190aW1lX2ludGVydmFsX3V0YyhjZWlsKTsKICAgIHV0Yy5vZmZzZXQgPSBkM190aW1lX2ludGVydmFsX3V0YyhvZmZzZXQpOwogICAgdXRjLnJhbmdlID0gcmFuZ2VfdXRjOwogICAgcmV0dXJuIGxvY2FsOwogIH0KICBmdW5jdGlvbiBkM190aW1lX2ludGVydmFsX3V0YyhtZXRob2QpIHsKICAgIHJldHVybiBmdW5jdGlvbihkYXRlLCBrKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZDNfdGltZSA9IGQzX3RpbWVfdXRjOwogICAgICAgIHZhciB1dGMgPSBuZXcgZDNfdGltZV91dGM7CiAgICAgICAgdXRjLl8gPSBkYXRlOwogICAgICAgIHJldHVybiBtZXRob2QodXRjLCBrKS5fOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGQzX3RpbWUgPSBEYXRlOwogICAgICB9CiAgICB9OwogIH0KICBmdW5jdGlvbiBkM190aW1lX3NjYWxlKGxpbmVhciwgbWV0aG9kcywgZm9ybWF0KSB7CiAgICBmdW5jdGlvbiBzY2FsZSh4KSB7CiAgICAgIHJldHVybiBsaW5lYXIoeCk7CiAgICB9CiAgICBzY2FsZS5pbnZlcnQgPSBmdW5jdGlvbih4KSB7CiAgICAgIHJldHVybiBkM190aW1lX3NjYWxlRGF0ZShsaW5lYXIuaW52ZXJ0KHgpKTsKICAgIH07CiAgICBzY2FsZS5kb21haW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGxpbmVhci5kb21haW4oKS5tYXAoZDNfdGltZV9zY2FsZURhdGUpOwogICAgICBsaW5lYXIuZG9tYWluKHgpOwogICAgICByZXR1cm4gc2NhbGU7CiAgICB9OwogICAgc2NhbGUubmljZSA9IGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIHNjYWxlLmRvbWFpbihkM19zY2FsZV9uaWNlKHNjYWxlLmRvbWFpbigpLCBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbTsKICAgICAgfSkpOwogICAgfTsKICAgIHNjYWxlLnRpY2tzID0gZnVuY3Rpb24obSwgaykgewogICAgICB2YXIgZXh0ZW50ID0gZDNfdGltZV9zY2FsZUV4dGVudChzY2FsZS5kb21haW4oKSk7CiAgICAgIGlmICh0eXBlb2YgbSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgIHZhciBzcGFuID0gZXh0ZW50WzFdIC0gZXh0ZW50WzBdLCB0YXJnZXQgPSBzcGFuIC8gbSwgaSA9IGQzLmJpc2VjdChkM190aW1lX3NjYWxlU3RlcHMsIHRhcmdldCk7CiAgICAgICAgaWYgKGkgPT0gZDNfdGltZV9zY2FsZVN0ZXBzLmxlbmd0aCkgcmV0dXJuIG1ldGhvZHMueWVhcihleHRlbnQsIG0pOwogICAgICAgIGlmICghaSkgcmV0dXJuIGxpbmVhci50aWNrcyhtKS5tYXAoZDNfdGltZV9zY2FsZURhdGUpOwogICAgICAgIGlmIChNYXRoLmxvZyh0YXJnZXQgLyBkM190aW1lX3NjYWxlU3RlcHNbaSAtIDFdKSA8IE1hdGgubG9nKGQzX3RpbWVfc2NhbGVTdGVwc1tpXSAvIHRhcmdldCkpIC0taTsKICAgICAgICBtID0gbWV0aG9kc1tpXTsKICAgICAgICBrID0gbVsxXTsKICAgICAgICBtID0gbVswXS5yYW5nZTsKICAgICAgfQogICAgICByZXR1cm4gbShleHRlbnRbMF0sIG5ldyBEYXRlKCtleHRlbnRbMV0gKyAxKSwgayk7CiAgICB9OwogICAgc2NhbGUudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZm9ybWF0OwogICAgfTsKICAgIHNjYWxlLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfc2NhbGUobGluZWFyLmNvcHkoKSwgbWV0aG9kcywgZm9ybWF0KTsKICAgIH07CiAgICByZXR1cm4gZDMucmViaW5kKHNjYWxlLCBsaW5lYXIsICJyYW5nZSIsICJyYW5nZVJvdW5kIiwgImludGVycG9sYXRlIiwgImNsYW1wIik7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfc2NhbGVFeHRlbnQoZG9tYWluKSB7CiAgICB2YXIgc3RhcnQgPSBkb21haW5bMF0sIHN0b3AgPSBkb21haW5bZG9tYWluLmxlbmd0aCAtIDFdOwogICAgcmV0dXJuIHN0YXJ0IDwgc3RvcCA\/IFsgc3RhcnQsIHN0b3AgXSA6IFsgc3RvcCwgc3RhcnQgXTsKICB9CiAgZnVuY3Rpb24gZDNfdGltZV9zY2FsZURhdGUodCkgewogICAgcmV0dXJuIG5ldyBEYXRlKHQpOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3NjYWxlRm9ybWF0KGZvcm1hdHMpIHsKICAgIHJldHVybiBmdW5jdGlvbihkYXRlKSB7CiAgICAgIHZhciBpID0gZm9ybWF0cy5sZW5ndGggLSAxLCBmID0gZm9ybWF0c1tpXTsKICAgICAgd2hpbGUgKCFmWzFdKGRhdGUpKSBmID0gZm9ybWF0c1stLWldOwogICAgICByZXR1cm4gZlswXShkYXRlKTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfc2NhbGVTZXRZZWFyKHkpIHsKICAgIHZhciBkID0gbmV3IERhdGUoeSwgMCwgMSk7CiAgICBkLnNldEZ1bGxZZWFyKHkpOwogICAgcmV0dXJuIGQ7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfc2NhbGVHZXRZZWFyKGQpIHsKICAgIHZhciB5ID0gZC5nZXRGdWxsWWVhcigpLCBkMCA9IGQzX3RpbWVfc2NhbGVTZXRZZWFyKHkpLCBkMSA9IGQzX3RpbWVfc2NhbGVTZXRZZWFyKHkgKyAxKTsKICAgIHJldHVybiB5ICsgKGQgLSBkMCkgLyAoZDEgLSBkMCk7CiAgfQogIGZ1bmN0aW9uIGQzX3RpbWVfc2NhbGVVVENTZXRZZWFyKHkpIHsKICAgIHZhciBkID0gbmV3IERhdGUoRGF0ZS5VVEMoeSwgMCwgMSkpOwogICAgZC5zZXRVVENGdWxsWWVhcih5KTsKICAgIHJldHVybiBkOwogIH0KICBmdW5jdGlvbiBkM190aW1lX3NjYWxlVVRDR2V0WWVhcihkKSB7CiAgICB2YXIgeSA9IGQuZ2V0VVRDRnVsbFllYXIoKSwgZDAgPSBkM190aW1lX3NjYWxlVVRDU2V0WWVhcih5KSwgZDEgPSBkM190aW1lX3NjYWxlVVRDU2V0WWVhcih5ICsgMSk7CiAgICByZXR1cm4geSArIChkIC0gZDApIC8gKGQxIC0gZDApOwogIH0KICBpZiAoIURhdGUubm93KSBEYXRlLm5vdyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICsobmV3IERhdGUpOwogIH07CiAgdHJ5IHsKICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLnNldFByb3BlcnR5KCJvcGFjaXR5IiwgMCwgIiIpOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICB2YXIgZDNfc3R5bGVfcHJvdG90eXBlID0gQ1NTU3R5bGVEZWNsYXJhdGlvbi5wcm90b3R5cGUsIGQzX3N0eWxlX3NldFByb3BlcnR5ID0gZDNfc3R5bGVfcHJvdG90eXBlLnNldFByb3BlcnR5OwogICAgZDNfc3R5bGVfcHJvdG90eXBlLnNldFByb3BlcnR5ID0gZnVuY3Rpb24obmFtZSwgdmFsdWUsIHByaW9yaXR5KSB7CiAgICAgIGQzX3N0eWxlX3NldFByb3BlcnR5LmNhbGwodGhpcywgbmFtZSwgdmFsdWUgKyAiIiwgcHJpb3JpdHkpOwogICAgfTsKICB9CiAgZDMgPSB7CiAgICB2ZXJzaW9uOiAiMi4xMC4zIgogIH07CiAgdmFyIGQzX2FycmF5ID0gZDNfYXJyYXlTbGljZTsKICB0cnkgewogICAgZDNfYXJyYXkoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMpWzBdLm5vZGVUeXBlOwogIH0gY2F0Y2ggKGUpIHsKICAgIGQzX2FycmF5ID0gZDNfYXJyYXlDb3B5OwogIH0KICB2YXIgZDNfYXJyYXlTdWJjbGFzcyA9IFtdLl9fcHJvdG9fXyA\/IGZ1bmN0aW9uKGFycmF5LCBwcm90b3R5cGUpIHsKICAgIGFycmF5Ll9fcHJvdG9fXyA9IHByb3RvdHlwZTsKICB9IDogZnVuY3Rpb24oYXJyYXksIHByb3RvdHlwZSkgewogICAgZm9yICh2YXIgcHJvcGVydHkgaW4gcHJvdG90eXBlKSBhcnJheVtwcm9wZXJ0eV0gPSBwcm90b3R5cGVbcHJvcGVydHldOwogIH07CiAgZDMubWFwID0gZnVuY3Rpb24ob2JqZWN0KSB7CiAgICB2YXIgbWFwID0gbmV3IGQzX01hcDsKICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIG1hcC5zZXQoa2V5LCBvYmplY3Rba2V5XSk7CiAgICByZXR1cm4gbWFwOwogIH07CiAgZDNfY2xhc3MoZDNfTWFwLCB7CiAgICBoYXM6IGZ1bmN0aW9uKGtleSkgewogICAgICByZXR1cm4gZDNfbWFwX3ByZWZpeCArIGtleSBpbiB0aGlzOwogICAgfSwKICAgIGdldDogZnVuY3Rpb24oa2V5KSB7CiAgICAgIHJldHVybiB0aGlzW2QzX21hcF9wcmVmaXggKyBrZXldOwogICAgfSwKICAgIHNldDogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICByZXR1cm4gdGhpc1tkM19tYXBfcHJlZml4ICsga2V5XSA9IHZhbHVlOwogICAgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24oa2V5KSB7CiAgICAgIGtleSA9IGQzX21hcF9wcmVmaXggKyBrZXk7CiAgICAgIHJldHVybiBrZXkgaW4gdGhpcyAmJiBkZWxldGUgdGhpc1trZXldOwogICAgfSwKICAgIGtleXM6IGZ1bmN0aW9uKCkgewogICAgICB2YXIga2V5cyA9IFtdOwogICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgIH0pOwogICAgICByZXR1cm4ga2V5czsKICAgIH0sCiAgICB2YWx1ZXM6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdmFsdWVzID0gW107CiAgICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgICAgdmFsdWVzLnB1c2godmFsdWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHZhbHVlczsKICAgIH0sCiAgICBlbnRyaWVzOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGVudHJpZXMgPSBbXTsKICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICBlbnRyaWVzLnB1c2goewogICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBlbnRyaWVzOwogICAgfSwKICAgIGZvckVhY2g6IGZ1bmN0aW9uKGYpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMpIHsKICAgICAgICBpZiAoa2V5LmNoYXJDb2RlQXQoMCkgPT09IGQzX21hcF9wcmVmaXhDb2RlKSB7CiAgICAgICAgICBmLmNhbGwodGhpcywga2V5LnN1YnN0cmluZygxKSwgdGhpc1trZXldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9KTsKICB2YXIgZDNfbWFwX3ByZWZpeCA9ICJcMCIsIGQzX21hcF9wcmVmaXhDb2RlID0gZDNfbWFwX3ByZWZpeC5jaGFyQ29kZUF0KDApOwogIGQzLmZ1bmN0b3IgPSBkM19mdW5jdG9yOwogIGQzLnJlYmluZCA9IGZ1bmN0aW9uKHRhcmdldCwgc291cmNlKSB7CiAgICB2YXIgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoLCBtZXRob2Q7CiAgICB3aGlsZSAoKytpIDwgbikgdGFyZ2V0W21ldGhvZCA9IGFyZ3VtZW50c1tpXV0gPSBkM19yZWJpbmQodGFyZ2V0LCBzb3VyY2UsIHNvdXJjZVttZXRob2RdKTsKICAgIHJldHVybiB0YXJnZXQ7CiAgfTsKICBkMy5hc2NlbmRpbmcgPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IGEgPj0gYiA\/IDAgOiBOYU47CiAgfTsKICBkMy5kZXNjZW5kaW5nID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGIgPCBhID8gLTEgOiBiID4gYSA\/IDEgOiBiID49IGEgPyAwIDogTmFOOwogIH07CiAgZDMubWVhbiA9IGZ1bmN0aW9uKGFycmF5LCBmKSB7CiAgICB2YXIgbiA9IGFycmF5Lmxlbmd0aCwgYSwgbSA9IDAsIGkgPSAtMSwgaiA9IDA7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKGQzX251bWJlcihhID0gYXJyYXlbaV0pKSBtICs9IChhIC0gbSkgLyArK2o7CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKGQzX251bWJlcihhID0gZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpKSBtICs9IChhIC0gbSkgLyArK2o7CiAgICB9CiAgICByZXR1cm4gaiA\/IG0gOiB1bmRlZmluZWQ7CiAgfTsKICBkMy5tZWRpYW4gPSBmdW5jdGlvbihhcnJheSwgZikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSBhcnJheSA9IGFycmF5Lm1hcChmKTsKICAgIGFycmF5ID0gYXJyYXkuZmlsdGVyKGQzX251bWJlcik7CiAgICByZXR1cm4gYXJyYXkubGVuZ3RoID8gZDMucXVhbnRpbGUoYXJyYXkuc29ydChkMy5hc2NlbmRpbmcpLCAuNSkgOiB1bmRlZmluZWQ7CiAgfTsKICBkMy5taW4gPSBmdW5jdGlvbihhcnJheSwgZikgewogICAgdmFyIGkgPSAtMSwgbiA9IGFycmF5Lmxlbmd0aCwgYSwgYjsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHdoaWxlICgrK2kgPCBuICYmICgoYSA9IGFycmF5W2ldKSA9PSBudWxsIHx8IGEgIT0gYSkpIGEgPSB1bmRlZmluZWQ7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoKGIgPSBhcnJheVtpXSkgIT0gbnVsbCAmJiBhID4gYikgYSA9IGI7CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbiAmJiAoKGEgPSBmLmNhbGwoYXJyYXksIGFycmF5W2ldLCBpKSkgPT0gbnVsbCB8fCBhICE9IGEpKSBhID0gdW5kZWZpbmVkOwogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKChiID0gZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpICE9IG51bGwgJiYgYSA+IGIpIGEgPSBiOwogICAgfQogICAgcmV0dXJuIGE7CiAgfTsKICBkMy5tYXggPSBmdW5jdGlvbihhcnJheSwgZikgewogICAgdmFyIGkgPSAtMSwgbiA9IGFycmF5Lmxlbmd0aCwgYSwgYjsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHdoaWxlICgrK2kgPCBuICYmICgoYSA9IGFycmF5W2ldKSA9PSBudWxsIHx8IGEgIT0gYSkpIGEgPSB1bmRlZmluZWQ7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoKGIgPSBhcnJheVtpXSkgIT0gbnVsbCAmJiBiID4gYSkgYSA9IGI7CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbiAmJiAoKGEgPSBmLmNhbGwoYXJyYXksIGFycmF5W2ldLCBpKSkgPT0gbnVsbCB8fCBhICE9IGEpKSBhID0gdW5kZWZpbmVkOwogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKChiID0gZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpICE9IG51bGwgJiYgYiA+IGEpIGEgPSBiOwogICAgfQogICAgcmV0dXJuIGE7CiAgfTsKICBkMy5leHRlbnQgPSBmdW5jdGlvbihhcnJheSwgZikgewogICAgdmFyIGkgPSAtMSwgbiA9IGFycmF5Lmxlbmd0aCwgYSwgYiwgYzsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHdoaWxlICgrK2kgPCBuICYmICgoYSA9IGMgPSBhcnJheVtpXSkgPT0gbnVsbCB8fCBhICE9IGEpKSBhID0gYyA9IHVuZGVmaW5lZDsKICAgICAgd2hpbGUgKCsraSA8IG4pIGlmICgoYiA9IGFycmF5W2ldKSAhPSBudWxsKSB7CiAgICAgICAgaWYgKGEgPiBiKSBhID0gYjsKICAgICAgICBpZiAoYyA8IGIpIGMgPSBiOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbiAmJiAoKGEgPSBjID0gZi5jYWxsKGFycmF5LCBhcnJheVtpXSwgaSkpID09IG51bGwgfHwgYSAhPSBhKSkgYSA9IHVuZGVmaW5lZDsKICAgICAgd2hpbGUgKCsraSA8IG4pIGlmICgoYiA9IGYuY2FsbChhcnJheSwgYXJyYXlbaV0sIGkpKSAhPSBudWxsKSB7CiAgICAgICAgaWYgKGEgPiBiKSBhID0gYjsKICAgICAgICBpZiAoYyA8IGIpIGMgPSBiOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gWyBhLCBjIF07CiAgfTsKICBkMy5yYW5kb20gPSB7CiAgICBub3JtYWw6IGZ1bmN0aW9uKMK1LCDPgykgewogICAgICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIGlmIChuIDwgMikgz4MgPSAxOwogICAgICBpZiAobiA8IDEpIMK1ID0gMDsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB4LCB5LCByOwogICAgICAgIGRvIHsKICAgICAgICAgIHggPSBNYXRoLnJhbmRvbSgpICogMiAtIDE7CiAgICAgICAgICB5ID0gTWF0aC5yYW5kb20oKSAqIDIgLSAxOwogICAgICAgICAgciA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgfSB3aGlsZSAoIXIgfHwgciA+IDEpOwogICAgICAgIHJldHVybiDCtSArIM+DICogeCAqIE1hdGguc3FydCgtMiAqIE1hdGgubG9nKHIpIC8gcik7CiAgICAgIH07CiAgICB9LAogICAgbG9nTm9ybWFsOiBmdW5jdGlvbijCtSwgz4MpIHsKICAgICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICBpZiAobiA8IDIpIM+DID0gMTsKICAgICAgaWYgKG4gPCAxKSDCtSA9IDA7CiAgICAgIHZhciByYW5kb20gPSBkMy5yYW5kb20ubm9ybWFsKCk7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gTWF0aC5leHAowrUgKyDPgyAqIHJhbmRvbSgpKTsKICAgICAgfTsKICAgIH0sCiAgICBpcndpbkhhbGw6IGZ1bmN0aW9uKG0pIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIHMgPSAwLCBqID0gMDsgaiA8IG07IGorKykgcyArPSBNYXRoLnJhbmRvbSgpOwogICAgICAgIHJldHVybiBzIC8gbTsKICAgICAgfTsKICAgIH0KICB9OwogIGQzLnN1bSA9IGZ1bmN0aW9uKGFycmF5LCBmKSB7CiAgICB2YXIgcyA9IDAsIG4gPSBhcnJheS5sZW5ndGgsIGEsIGkgPSAtMTsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoIWlzTmFOKGEgPSArYXJyYXlbaV0pKSBzICs9IGE7CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoKytpIDwgbikgaWYgKCFpc05hTihhID0gK2YuY2FsbChhcnJheSwgYXJyYXlbaV0sIGkpKSkgcyArPSBhOwogICAgfQogICAgcmV0dXJuIHM7CiAgfTsKICBkMy5xdWFudGlsZSA9IGZ1bmN0aW9uKHZhbHVlcywgcCkgewogICAgdmFyIEggPSAodmFsdWVzLmxlbmd0aCAtIDEpICogcCArIDEsIGggPSBNYXRoLmZsb29yKEgpLCB2ID0gdmFsdWVzW2ggLSAxXSwgZSA9IEggLSBoOwogICAgcmV0dXJuIGUgPyB2ICsgZSAqICh2YWx1ZXNbaF0gLSB2KSA6IHY7CiAgfTsKICBkMy50cmFuc3Bvc2UgPSBmdW5jdGlvbihtYXRyaXgpIHsKICAgIHJldHVybiBkMy56aXAuYXBwbHkoZDMsIG1hdHJpeCk7CiAgfTsKICBkMy56aXAgPSBmdW5jdGlvbigpIHsKICAgIGlmICghKG4gPSBhcmd1bWVudHMubGVuZ3RoKSkgcmV0dXJuIFtdOwogICAgZm9yICh2YXIgaSA9IC0xLCBtID0gZDMubWluKGFyZ3VtZW50cywgZDNfemlwTGVuZ3RoKSwgemlwcyA9IG5ldyBBcnJheShtKTsgKytpIDwgbTsgKSB7CiAgICAgIGZvciAodmFyIGogPSAtMSwgbiwgemlwID0gemlwc1tpXSA9IG5ldyBBcnJheShuKTsgKytqIDwgbjsgKSB7CiAgICAgICAgemlwW2pdID0gYXJndW1lbnRzW2pdW2ldOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gemlwczsKICB9OwogIGQzLmJpc2VjdG9yID0gZnVuY3Rpb24oZikgewogICAgcmV0dXJuIHsKICAgICAgbGVmdDogZnVuY3Rpb24oYSwgeCwgbG8sIGhpKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSBsbyA9IDA7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCA0KSBoaSA9IGEubGVuZ3RoOwogICAgICAgIHdoaWxlIChsbyA8IGhpKSB7CiAgICAgICAgICB2YXIgbWlkID0gbG8gKyBoaSA+Pj4gMTsKICAgICAgICAgIGlmIChmLmNhbGwoYSwgYVttaWRdLCBtaWQpIDwgeCkgbG8gPSBtaWQgKyAxOyBlbHNlIGhpID0gbWlkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbG87CiAgICAgIH0sCiAgICAgIHJpZ2h0OiBmdW5jdGlvbihhLCB4LCBsbywgaGkpIHsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIGxvID0gMDsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDQpIGhpID0gYS5sZW5ndGg7CiAgICAgICAgd2hpbGUgKGxvIDwgaGkpIHsKICAgICAgICAgIHZhciBtaWQgPSBsbyArIGhpID4+PiAxOwogICAgICAgICAgaWYgKHggPCBmLmNhbGwoYSwgYVttaWRdLCBtaWQpKSBoaSA9IG1pZDsgZWxzZSBsbyA9IG1pZCArIDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsbzsKICAgICAgfQogICAgfTsKICB9OwogIHZhciBkM19iaXNlY3RvciA9IGQzLmJpc2VjdG9yKGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiBkOwogIH0pOwogIGQzLmJpc2VjdExlZnQgPSBkM19iaXNlY3Rvci5sZWZ0OwogIGQzLmJpc2VjdCA9IGQzLmJpc2VjdFJpZ2h0ID0gZDNfYmlzZWN0b3IucmlnaHQ7CiAgZDMuZmlyc3QgPSBmdW5jdGlvbihhcnJheSwgZikgewogICAgdmFyIGkgPSAwLCBuID0gYXJyYXkubGVuZ3RoLCBhID0gYXJyYXlbMF0sIGI7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgZiA9IGQzLmFzY2VuZGluZzsKICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgIGlmIChmLmNhbGwoYXJyYXksIGEsIGIgPSBhcnJheVtpXSkgPiAwKSB7CiAgICAgICAgYSA9IGI7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhOwogIH07CiAgZDMubGFzdCA9IGZ1bmN0aW9uKGFycmF5LCBmKSB7CiAgICB2YXIgaSA9IDAsIG4gPSBhcnJheS5sZW5ndGgsIGEgPSBhcnJheVswXSwgYjsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSBmID0gZDMuYXNjZW5kaW5nOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgaWYgKGYuY2FsbChhcnJheSwgYSwgYiA9IGFycmF5W2ldKSA8PSAwKSB7CiAgICAgICAgYSA9IGI7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhOwogIH07CiAgZDMubmVzdCA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gbWFwKGFycmF5LCBkZXB0aCkgewogICAgICBpZiAoZGVwdGggPj0ga2V5cy5sZW5ndGgpIHJldHVybiByb2xsdXAgPyByb2xsdXAuY2FsbChuZXN0LCBhcnJheSkgOiBzb3J0VmFsdWVzID8gYXJyYXkuc29ydChzb3J0VmFsdWVzKSA6IGFycmF5OwogICAgICB2YXIgaSA9IC0xLCBuID0gYXJyYXkubGVuZ3RoLCBrZXkgPSBrZXlzW2RlcHRoKytdLCBrZXlWYWx1ZSwgb2JqZWN0LCB2YWx1ZXNCeUtleSA9IG5ldyBkM19NYXAsIHZhbHVlcywgbyA9IHt9OwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGlmICh2YWx1ZXMgPSB2YWx1ZXNCeUtleS5nZXQoa2V5VmFsdWUgPSBrZXkob2JqZWN0ID0gYXJyYXlbaV0pKSkgewogICAgICAgICAgdmFsdWVzLnB1c2gob2JqZWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFsdWVzQnlLZXkuc2V0KGtleVZhbHVlLCBbIG9iamVjdCBdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFsdWVzQnlLZXkuZm9yRWFjaChmdW5jdGlvbihrZXlWYWx1ZSwgdmFsdWVzKSB7CiAgICAgICAgb1trZXlWYWx1ZV0gPSBtYXAodmFsdWVzLCBkZXB0aCk7CiAgICAgIH0pOwogICAgICByZXR1cm4gbzsKICAgIH0KICAgIGZ1bmN0aW9uIGVudHJpZXMobWFwLCBkZXB0aCkgewogICAgICBpZiAoZGVwdGggPj0ga2V5cy5sZW5ndGgpIHJldHVybiBtYXA7CiAgICAgIHZhciBhID0gW10sIHNvcnRLZXkgPSBzb3J0S2V5c1tkZXB0aCsrXSwga2V5OwogICAgICBmb3IgKGtleSBpbiBtYXApIHsKICAgICAgICBhLnB1c2goewogICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICB2YWx1ZXM6IGVudHJpZXMobWFwW2tleV0sIGRlcHRoKQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChzb3J0S2V5KSBhLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBzb3J0S2V5KGEua2V5LCBiLmtleSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gYTsKICAgIH0KICAgIHZhciBuZXN0ID0ge30sIGtleXMgPSBbXSwgc29ydEtleXMgPSBbXSwgc29ydFZhbHVlcywgcm9sbHVwOwogICAgbmVzdC5tYXAgPSBmdW5jdGlvbihhcnJheSkgewogICAgICByZXR1cm4gbWFwKGFycmF5LCAwKTsKICAgIH07CiAgICBuZXN0LmVudHJpZXMgPSBmdW5jdGlvbihhcnJheSkgewogICAgICByZXR1cm4gZW50cmllcyhtYXAoYXJyYXksIDApLCAwKTsKICAgIH07CiAgICBuZXN0LmtleSA9IGZ1bmN0aW9uKGQpIHsKICAgICAga2V5cy5wdXNoKGQpOwogICAgICByZXR1cm4gbmVzdDsKICAgIH07CiAgICBuZXN0LnNvcnRLZXlzID0gZnVuY3Rpb24ob3JkZXIpIHsKICAgICAgc29ydEtleXNba2V5cy5sZW5ndGggLSAxXSA9IG9yZGVyOwogICAgICByZXR1cm4gbmVzdDsKICAgIH07CiAgICBuZXN0LnNvcnRWYWx1ZXMgPSBmdW5jdGlvbihvcmRlcikgewogICAgICBzb3J0VmFsdWVzID0gb3JkZXI7CiAgICAgIHJldHVybiBuZXN0OwogICAgfTsKICAgIG5lc3Qucm9sbHVwID0gZnVuY3Rpb24oZikgewogICAgICByb2xsdXAgPSBmOwogICAgICByZXR1cm4gbmVzdDsKICAgIH07CiAgICByZXR1cm4gbmVzdDsKICB9OwogIGQzLmtleXMgPSBmdW5jdGlvbihtYXApIHsKICAgIHZhciBrZXlzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gbWFwKSBrZXlzLnB1c2goa2V5KTsKICAgIHJldHVybiBrZXlzOwogIH07CiAgZDMudmFsdWVzID0gZnVuY3Rpb24obWFwKSB7CiAgICB2YXIgdmFsdWVzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gbWFwKSB2YWx1ZXMucHVzaChtYXBba2V5XSk7CiAgICByZXR1cm4gdmFsdWVzOwogIH07CiAgZDMuZW50cmllcyA9IGZ1bmN0aW9uKG1hcCkgewogICAgdmFyIGVudHJpZXMgPSBbXTsKICAgIGZvciAodmFyIGtleSBpbiBtYXApIGVudHJpZXMucHVzaCh7CiAgICAgIGtleToga2V5LAogICAgICB2YWx1ZTogbWFwW2tleV0KICAgIH0pOwogICAgcmV0dXJuIGVudHJpZXM7CiAgfTsKICBkMy5wZXJtdXRlID0gZnVuY3Rpb24oYXJyYXksIGluZGV4ZXMpIHsKICAgIHZhciBwZXJtdXRlcyA9IFtdLCBpID0gLTEsIG4gPSBpbmRleGVzLmxlbmd0aDsKICAgIHdoaWxlICgrK2kgPCBuKSBwZXJtdXRlc1tpXSA9IGFycmF5W2luZGV4ZXNbaV1dOwogICAgcmV0dXJuIHBlcm11dGVzOwogIH07CiAgZDMubWVyZ2UgPSBmdW5jdGlvbihhcnJheXMpIHsKICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBhcnJheXMpOwogIH07CiAgZDMuc3BsaXQgPSBmdW5jdGlvbihhcnJheSwgZikgewogICAgdmFyIGFycmF5cyA9IFtdLCB2YWx1ZXMgPSBbXSwgdmFsdWUsIGkgPSAtMSwgbiA9IGFycmF5Lmxlbmd0aDsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgZiA9IGQzX3NwbGl0dGVyOwogICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgaWYgKGYuY2FsbCh2YWx1ZXMsIHZhbHVlID0gYXJyYXlbaV0sIGkpKSB7CiAgICAgICAgdmFsdWVzID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF2YWx1ZXMubGVuZ3RoKSBhcnJheXMucHVzaCh2YWx1ZXMpOwogICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGFycmF5czsKICB9OwogIGQzLnJhbmdlID0gZnVuY3Rpb24oc3RhcnQsIHN0b3AsIHN0ZXApIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykgewogICAgICBzdGVwID0gMTsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7CiAgICAgICAgc3RvcCA9IHN0YXJ0OwogICAgICAgIHN0YXJ0ID0gMDsKICAgICAgfQogICAgfQogICAgaWYgKChzdG9wIC0gc3RhcnQpIC8gc3RlcCA9PT0gSW5maW5pdHkpIHRocm93IG5ldyBFcnJvcigiaW5maW5pdGUgcmFuZ2UiKTsKICAgIHZhciByYW5nZSA9IFtdLCBrID0gZDNfcmFuZ2VfaW50ZWdlclNjYWxlKE1hdGguYWJzKHN0ZXApKSwgaSA9IC0xLCBqOwogICAgc3RhcnQgKj0gaywgc3RvcCAqPSBrLCBzdGVwICo9IGs7CiAgICBpZiAoc3RlcCA8IDApIHdoaWxlICgoaiA9IHN0YXJ0ICsgc3RlcCAqICsraSkgPiBzdG9wKSByYW5nZS5wdXNoKGogLyBrKTsgZWxzZSB3aGlsZSAoKGogPSBzdGFydCArIHN0ZXAgKiArK2kpIDwgc3RvcCkgcmFuZ2UucHVzaChqIC8gayk7CiAgICByZXR1cm4gcmFuZ2U7CiAgfTsKICBkMy5yZXF1b3RlID0gZnVuY3Rpb24ocykgewogICAgcmV0dXJuIHMucmVwbGFjZShkM19yZXF1b3RlX3JlLCAiXFwkJiIpOwogIH07CiAgdmFyIGQzX3JlcXVvdGVfcmUgPSAvW1xcXF5cJFwqXCtcP1x8XFtcXVwoXClcLlx7XH1dL2c7CiAgZDMucm91bmQgPSBmdW5jdGlvbih4LCBuKSB7CiAgICByZXR1cm4gbiA\/IE1hdGgucm91bmQoeCAqIChuID0gTWF0aC5wb3coMTAsIG4pKSkgLyBuIDogTWF0aC5yb3VuZCh4KTsKICB9OwogIGQzLnhociA9IGZ1bmN0aW9uKHVybCwgbWltZSwgY2FsbGJhY2spIHsKICAgIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3Q7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIGNhbGxiYWNrID0gbWltZSwgbWltZSA9IG51bGw7IGVsc2UgaWYgKG1pbWUgJiYgcmVxLm92ZXJyaWRlTWltZVR5cGUpIHJlcS5vdmVycmlkZU1pbWVUeXBlKG1pbWUpOwogICAgcmVxLm9wZW4oIkdFVCIsIHVybCwgdHJ1ZSk7CiAgICBpZiAobWltZSkgcmVxLnNldFJlcXVlc3RIZWFkZXIoIkFjY2VwdCIsIG1pbWUpOwogICAgcmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAocmVxLnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICB2YXIgcyA9IHJlcS5zdGF0dXM7CiAgICAgICAgY2FsbGJhY2soIXMgJiYgcmVxLnJlc3BvbnNlIHx8IHMgPj0gMjAwICYmIHMgPCAzMDAgfHwgcyA9PT0gMzA0ID8gcmVxIDogbnVsbCk7CiAgICAgIH0KICAgIH07CiAgICByZXEuc2VuZChudWxsKTsKICB9OwogIGQzLnRleHQgPSBmdW5jdGlvbih1cmwsIG1pbWUsIGNhbGxiYWNrKSB7CiAgICBmdW5jdGlvbiByZWFkeShyZXEpIHsKICAgICAgY2FsbGJhY2socmVxICYmIHJlcS5yZXNwb25zZVRleHQpOwogICAgfQogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSB7CiAgICAgIGNhbGxiYWNrID0gbWltZTsKICAgICAgbWltZSA9IG51bGw7CiAgICB9CiAgICBkMy54aHIodXJsLCBtaW1lLCByZWFkeSk7CiAgfTsKICBkMy5qc29uID0gZnVuY3Rpb24odXJsLCBjYWxsYmFjaykgewogICAgZDMudGV4dCh1cmwsICJhcHBsaWNhdGlvbi9qc29uIiwgZnVuY3Rpb24odGV4dCkgewogICAgICBjYWxsYmFjayh0ZXh0ID8gSlNPTi5wYXJzZSh0ZXh0KSA6IG51bGwpOwogICAgfSk7CiAgfTsKICBkMy5odG1sID0gZnVuY3Rpb24odXJsLCBjYWxsYmFjaykgewogICAgZDMudGV4dCh1cmwsICJ0ZXh0L2h0bWwiLCBmdW5jdGlvbih0ZXh0KSB7CiAgICAgIGlmICh0ZXh0ICE9IG51bGwpIHsKICAgICAgICB2YXIgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpOwogICAgICAgIHJhbmdlLnNlbGVjdE5vZGUoZG9jdW1lbnQuYm9keSk7CiAgICAgICAgdGV4dCA9IHJhbmdlLmNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudCh0ZXh0KTsKICAgICAgfQogICAgICBjYWxsYmFjayh0ZXh0KTsKICAgIH0pOwogIH07CiAgZDMueG1sID0gZnVuY3Rpb24odXJsLCBtaW1lLCBjYWxsYmFjaykgewogICAgZnVuY3Rpb24gcmVhZHkocmVxKSB7CiAgICAgIGNhbGxiYWNrKHJlcSAmJiByZXEucmVzcG9uc2VYTUwpOwogICAgfQogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSB7CiAgICAgIGNhbGxiYWNrID0gbWltZTsKICAgICAgbWltZSA9IG51bGw7CiAgICB9CiAgICBkMy54aHIodXJsLCBtaW1lLCByZWFkeSk7CiAgfTsKICB2YXIgZDNfbnNQcmVmaXggPSB7CiAgICBzdmc6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsCiAgICB4aHRtbDogImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLAogICAgeGxpbms6ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwKICAgIHhtbDogImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIsCiAgICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvIgogIH07CiAgZDMubnMgPSB7CiAgICBwcmVmaXg6IGQzX25zUHJlZml4LAogICAgcXVhbGlmeTogZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgaSA9IG5hbWUuaW5kZXhPZigiOiIpLCBwcmVmaXggPSBuYW1lOwogICAgICBpZiAoaSA+PSAwKSB7CiAgICAgICAgcHJlZml4ID0gbmFtZS5zdWJzdHJpbmcoMCwgaSk7CiAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKGkgKyAxKTsKICAgICAgfQogICAgICByZXR1cm4gZDNfbnNQcmVmaXguaGFzT3duUHJvcGVydHkocHJlZml4KSA\/IHsKICAgICAgICBzcGFjZTogZDNfbnNQcmVmaXhbcHJlZml4XSwKICAgICAgICBsb2NhbDogbmFtZQogICAgICB9IDogbmFtZTsKICAgIH0KICB9OwogIGQzLmRpc3BhdGNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZGlzcGF0Y2ggPSBuZXcgZDNfZGlzcGF0Y2gsIGkgPSAtMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICB3aGlsZSAoKytpIDwgbikgZGlzcGF0Y2hbYXJndW1lbnRzW2ldXSA9IGQzX2Rpc3BhdGNoX2V2ZW50KGRpc3BhdGNoKTsKICAgIHJldHVybiBkaXNwYXRjaDsKICB9OwogIGQzX2Rpc3BhdGNoLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7CiAgICB2YXIgaSA9IHR5cGUuaW5kZXhPZigiLiIpLCBuYW1lID0gIiI7CiAgICBpZiAoaSA+IDApIHsKICAgICAgbmFtZSA9IHR5cGUuc3Vic3RyaW5nKGkgKyAxKTsKICAgICAgdHlwZSA9IHR5cGUuc3Vic3RyaW5nKDAsIGkpOwogICAgfQogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8gdGhpc1t0eXBlXS5vbihuYW1lKSA6IHRoaXNbdHlwZV0ub24obmFtZSwgbGlzdGVuZXIpOwogIH07CiAgZDMuZm9ybWF0ID0gZnVuY3Rpb24oc3BlY2lmaWVyKSB7CiAgICB2YXIgbWF0Y2ggPSBkM19mb3JtYXRfcmUuZXhlYyhzcGVjaWZpZXIpLCBmaWxsID0gbWF0Y2hbMV0gfHwgIiAiLCBzaWduID0gbWF0Y2hbM10gfHwgIiIsIHpmaWxsID0gbWF0Y2hbNV0sIHdpZHRoID0gK21hdGNoWzZdLCBjb21tYSA9IG1hdGNoWzddLCBwcmVjaXNpb24gPSBtYXRjaFs4XSwgdHlwZSA9IG1hdGNoWzldLCBzY2FsZSA9IDEsIHN1ZmZpeCA9ICIiLCBpbnRlZ2VyID0gZmFsc2U7CiAgICBpZiAocHJlY2lzaW9uKSBwcmVjaXNpb24gPSArcHJlY2lzaW9uLnN1YnN0cmluZygxKTsKICAgIGlmICh6ZmlsbCkgewogICAgICBmaWxsID0gIjAiOwogICAgICBpZiAoY29tbWEpIHdpZHRoIC09IE1hdGguZmxvb3IoKHdpZHRoIC0gMSkgLyA0KTsKICAgIH0KICAgIHN3aXRjaCAodHlwZSkgewogICAgIGNhc2UgIm4iOgogICAgICBjb21tYSA9IHRydWU7CiAgICAgIHR5cGUgPSAiZyI7CiAgICAgIGJyZWFrOwogICAgIGNhc2UgIiUiOgogICAgICBzY2FsZSA9IDEwMDsKICAgICAgc3VmZml4ID0gIiUiOwogICAgICB0eXBlID0gImYiOwogICAgICBicmVhazsKICAgICBjYXNlICJwIjoKICAgICAgc2NhbGUgPSAxMDA7CiAgICAgIHN1ZmZpeCA9ICIlIjsKICAgICAgdHlwZSA9ICJyIjsKICAgICAgYnJlYWs7CiAgICAgY2FzZSAiZCI6CiAgICAgIGludGVnZXIgPSB0cnVlOwogICAgICBwcmVjaXNpb24gPSAwOwogICAgICBicmVhazsKICAgICBjYXNlICJzIjoKICAgICAgc2NhbGUgPSAtMTsKICAgICAgdHlwZSA9ICJyIjsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAodHlwZSA9PSAiciIgJiYgIXByZWNpc2lvbikgdHlwZSA9ICJnIjsKICAgIHR5cGUgPSBkM19mb3JtYXRfdHlwZXMuZ2V0KHR5cGUpIHx8IGQzX2Zvcm1hdF90eXBlRGVmYXVsdDsKICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoaW50ZWdlciAmJiB2YWx1ZSAlIDEpIHJldHVybiAiIjsKICAgICAgdmFyIG5lZ2F0aXZlID0gdmFsdWUgPCAwICYmICh2YWx1ZSA9IC12YWx1ZSkgPyAiLSIgOiBzaWduOwogICAgICBpZiAoc2NhbGUgPCAwKSB7CiAgICAgICAgdmFyIHByZWZpeCA9IGQzLmZvcm1hdFByZWZpeCh2YWx1ZSwgcHJlY2lzaW9uKTsKICAgICAgICB2YWx1ZSA9IHByZWZpeC5zY2FsZSh2YWx1ZSk7CiAgICAgICAgc3VmZml4ID0gcHJlZml4LnN5bWJvbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWx1ZSAqPSBzY2FsZTsKICAgICAgfQogICAgICB2YWx1ZSA9IHR5cGUodmFsdWUsIHByZWNpc2lvbik7CiAgICAgIGlmICh6ZmlsbCkgewogICAgICAgIHZhciBsZW5ndGggPSB2YWx1ZS5sZW5ndGggKyBuZWdhdGl2ZS5sZW5ndGg7CiAgICAgICAgaWYgKGxlbmd0aCA8IHdpZHRoKSB2YWx1ZSA9IChuZXcgQXJyYXkod2lkdGggLSBsZW5ndGggKyAxKSkuam9pbihmaWxsKSArIHZhbHVlOwogICAgICAgIGlmIChjb21tYSkgdmFsdWUgPSBkM19mb3JtYXRfZ3JvdXAodmFsdWUpOwogICAgICAgIHZhbHVlID0gbmVnYXRpdmUgKyB2YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoY29tbWEpIHZhbHVlID0gZDNfZm9ybWF0X2dyb3VwKHZhbHVlKTsKICAgICAgICB2YWx1ZSA9IG5lZ2F0aXZlICsgdmFsdWU7CiAgICAgICAgdmFyIGxlbmd0aCA9IHZhbHVlLmxlbmd0aDsKICAgICAgICBpZiAobGVuZ3RoIDwgd2lkdGgpIHZhbHVlID0gKG5ldyBBcnJheSh3aWR0aCAtIGxlbmd0aCArIDEpKS5qb2luKGZpbGwpICsgdmFsdWU7CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbHVlICsgc3VmZml4OwogICAgfTsKICB9OwogIHZhciBkM19mb3JtYXRfcmUgPSAvKD86KFtee10pPyhbPD49Xl0pKT8oWytcLSBdKT8oIyk\/KDApPyhbMC05XSspPygsKT8oXC5bMC05XSspPyhbYS16QS1aJV0pPy87CiAgdmFyIGQzX2Zvcm1hdF90eXBlcyA9IGQzLm1hcCh7CiAgICBnOiBmdW5jdGlvbih4LCBwKSB7CiAgICAgIHJldHVybiB4LnRvUHJlY2lzaW9uKHApOwogICAgfSwKICAgIGU6IGZ1bmN0aW9uKHgsIHApIHsKICAgICAgcmV0dXJuIHgudG9FeHBvbmVudGlhbChwKTsKICAgIH0sCiAgICBmOiBmdW5jdGlvbih4LCBwKSB7CiAgICAgIHJldHVybiB4LnRvRml4ZWQocCk7CiAgICB9LAogICAgcjogZnVuY3Rpb24oeCwgcCkgewogICAgICByZXR1cm4gZDMucm91bmQoeCwgcCA9IGQzX2Zvcm1hdF9wcmVjaXNpb24oeCwgcCkpLnRvRml4ZWQoTWF0aC5tYXgoMCwgTWF0aC5taW4oMjAsIHApKSk7CiAgICB9CiAgfSk7CiAgdmFyIGQzX2Zvcm1hdFByZWZpeGVzID0gWyAieSIsICJ6IiwgImEiLCAiZiIsICJwIiwgIm4iLCAizrwiLCAibSIsICIiLCAiayIsICJNIiwgIkciLCAiVCIsICJQIiwgIkUiLCAiWiIsICJZIiBdLm1hcChkM19mb3JtYXRQcmVmaXgpOwogIGQzLmZvcm1hdFByZWZpeCA9IGZ1bmN0aW9uKHZhbHVlLCBwcmVjaXNpb24pIHsKICAgIHZhciBpID0gMDsKICAgIGlmICh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPCAwKSB2YWx1ZSAqPSAtMTsKICAgICAgaWYgKHByZWNpc2lvbikgdmFsdWUgPSBkMy5yb3VuZCh2YWx1ZSwgZDNfZm9ybWF0X3ByZWNpc2lvbih2YWx1ZSwgcHJlY2lzaW9uKSk7CiAgICAgIGkgPSAxICsgTWF0aC5mbG9vcigxZS0xMiArIE1hdGgubG9nKHZhbHVlKSAvIE1hdGguTE4xMCk7CiAgICAgIGkgPSBNYXRoLm1heCgtMjQsIE1hdGgubWluKDI0LCBNYXRoLmZsb29yKChpIDw9IDAgPyBpICsgMSA6IGkgLSAxKSAvIDMpICogMykpOwogICAgfQogICAgcmV0dXJuIGQzX2Zvcm1hdFByZWZpeGVzWzggKyBpIC8gM107CiAgfTsKICB2YXIgZDNfZWFzZV9xdWFkID0gZDNfZWFzZV9wb2x5KDIpLCBkM19lYXNlX2N1YmljID0gZDNfZWFzZV9wb2x5KDMpLCBkM19lYXNlX2RlZmF1bHQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19lYXNlX2lkZW50aXR5OwogIH07CiAgdmFyIGQzX2Vhc2UgPSBkMy5tYXAoewogICAgbGluZWFyOiBkM19lYXNlX2RlZmF1bHQsCiAgICBwb2x5OiBkM19lYXNlX3BvbHksCiAgICBxdWFkOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX2Vhc2VfcXVhZDsKICAgIH0sCiAgICBjdWJpYzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19lYXNlX2N1YmljOwogICAgfSwKICAgIHNpbjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19lYXNlX3NpbjsKICAgIH0sCiAgICBleHA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZDNfZWFzZV9leHA7CiAgICB9LAogICAgY2lyY2xlOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGQzX2Vhc2VfY2lyY2xlOwogICAgfSwKICAgIGVsYXN0aWM6IGQzX2Vhc2VfZWxhc3RpYywKICAgIGJhY2s6IGQzX2Vhc2VfYmFjaywKICAgIGJvdW5jZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkM19lYXNlX2JvdW5jZTsKICAgIH0KICB9KTsKICB2YXIgZDNfZWFzZV9tb2RlID0gZDMubWFwKHsKICAgICJpbiI6IGQzX2Vhc2VfaWRlbnRpdHksCiAgICBvdXQ6IGQzX2Vhc2VfcmV2ZXJzZSwKICAgICJpbi1vdXQiOiBkM19lYXNlX3JlZmxlY3QsCiAgICAib3V0LWluIjogZnVuY3Rpb24oZikgewogICAgICByZXR1cm4gZDNfZWFzZV9yZWZsZWN0KGQzX2Vhc2VfcmV2ZXJzZShmKSk7CiAgICB9CiAgfSk7CiAgZDMuZWFzZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIHZhciBpID0gbmFtZS5pbmRleE9mKCItIiksIHQgPSBpID49IDAgPyBuYW1lLnN1YnN0cmluZygwLCBpKSA6IG5hbWUsIG0gPSBpID49IDAgPyBuYW1lLnN1YnN0cmluZyhpICsgMSkgOiAiaW4iOwogICAgdCA9IGQzX2Vhc2UuZ2V0KHQpIHx8IGQzX2Vhc2VfZGVmYXVsdDsKICAgIG0gPSBkM19lYXNlX21vZGUuZ2V0KG0pIHx8IGQzX2Vhc2VfaWRlbnRpdHk7CiAgICByZXR1cm4gZDNfZWFzZV9jbGFtcChtKHQuYXBwbHkobnVsbCwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkpKTsKICB9OwogIGQzLmV2ZW50ID0gbnVsbDsKICBkMy50cmFuc2Zvcm0gPSBmdW5jdGlvbihzdHJpbmcpIHsKICAgIHZhciBnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKGQzLm5zLnByZWZpeC5zdmcsICJnIik7CiAgICByZXR1cm4gKGQzLnRyYW5zZm9ybSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgICBnLnNldEF0dHJpYnV0ZSgidHJhbnNmb3JtIiwgc3RyaW5nKTsKICAgICAgdmFyIHQgPSBnLnRyYW5zZm9ybS5iYXNlVmFsLmNvbnNvbGlkYXRlKCk7CiAgICAgIHJldHVybiBuZXcgZDNfdHJhbnNmb3JtKHQgPyB0Lm1hdHJpeCA6IGQzX3RyYW5zZm9ybUlkZW50aXR5KTsKICAgIH0pKHN0cmluZyk7CiAgfTsKICBkM190cmFuc2Zvcm0ucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gInRyYW5zbGF0ZSgiICsgdGhpcy50cmFuc2xhdGUgKyAiKXJvdGF0ZSgiICsgdGhpcy5yb3RhdGUgKyAiKXNrZXdYKCIgKyB0aGlzLnNrZXcgKyAiKXNjYWxlKCIgKyB0aGlzLnNjYWxlICsgIikiOwogIH07CiAgdmFyIGQzX3RyYW5zZm9ybURlZ3JlZXMgPSAxODAgLyBNYXRoLlBJLCBkM190cmFuc2Zvcm1JZGVudGl0eSA9IHsKICAgIGE6IDEsCiAgICBiOiAwLAogICAgYzogMCwKICAgIGQ6IDEsCiAgICBlOiAwLAogICAgZjogMAogIH07CiAgZDMuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICB2YXIgaSA9IGQzLmludGVycG9sYXRvcnMubGVuZ3RoLCBmOwogICAgd2hpbGUgKC0taSA+PSAwICYmICEoZiA9IGQzLmludGVycG9sYXRvcnNbaV0oYSwgYikpKSA7CiAgICByZXR1cm4gZjsKICB9OwogIGQzLmludGVycG9sYXRlTnVtYmVyID0gZnVuY3Rpb24oYSwgYikgewogICAgYiAtPSBhOwogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIGEgKyBiICogdDsKICAgIH07CiAgfTsKICBkMy5pbnRlcnBvbGF0ZVJvdW5kID0gZnVuY3Rpb24oYSwgYikgewogICAgYiAtPSBhOwogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIE1hdGgucm91bmQoYSArIGIgKiB0KTsKICAgIH07CiAgfTsKICBkMy5pbnRlcnBvbGF0ZVN0cmluZyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciBtLCBpLCBqLCBzMCA9IDAsIHMxID0gMCwgcyA9IFtdLCBxID0gW10sIG4sIG87CiAgICBkM19pbnRlcnBvbGF0ZV9udW1iZXIubGFzdEluZGV4ID0gMDsKICAgIGZvciAoaSA9IDA7IG0gPSBkM19pbnRlcnBvbGF0ZV9udW1iZXIuZXhlYyhiKTsgKytpKSB7CiAgICAgIGlmIChtLmluZGV4KSBzLnB1c2goYi5zdWJzdHJpbmcoczAsIHMxID0gbS5pbmRleCkpOwogICAgICBxLnB1c2goewogICAgICAgIGk6IHMubGVuZ3RoLAogICAgICAgIHg6IG1bMF0KICAgICAgfSk7CiAgICAgIHMucHVzaChudWxsKTsKICAgICAgczAgPSBkM19pbnRlcnBvbGF0ZV9udW1iZXIubGFzdEluZGV4OwogICAgfQogICAgaWYgKHMwIDwgYi5sZW5ndGgpIHMucHVzaChiLnN1YnN0cmluZyhzMCkpOwogICAgZm9yIChpID0gMCwgbiA9IHEubGVuZ3RoOyAobSA9IGQzX2ludGVycG9sYXRlX251bWJlci5leGVjKGEpKSAmJiBpIDwgbjsgKytpKSB7CiAgICAgIG8gPSBxW2ldOwogICAgICBpZiAoby54ID09IG1bMF0pIHsKICAgICAgICBpZiAoby5pKSB7CiAgICAgICAgICBpZiAoc1tvLmkgKyAxXSA9PSBudWxsKSB7CiAgICAgICAgICAgIHNbby5pIC0gMV0gKz0gby54OwogICAgICAgICAgICBzLnNwbGljZShvLmksIDEpOwogICAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IG47ICsraikgcVtqXS5pLS07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzW28uaSAtIDFdICs9IG8ueCArIHNbby5pICsgMV07CiAgICAgICAgICAgIHMuc3BsaWNlKG8uaSwgMik7CiAgICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgbjsgKytqKSBxW2pdLmkgLT0gMjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHNbby5pICsgMV0gPT0gbnVsbCkgewogICAgICAgICAgICBzW28uaV0gPSBvLng7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzW28uaV0gPSBvLnggKyBzW28uaSArIDFdOwogICAgICAgICAgICBzLnNwbGljZShvLmkgKyAxLCAxKTsKICAgICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBuOyArK2opIHFbal0uaS0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBxLnNwbGljZShpLCAxKTsKICAgICAgICBuLS07CiAgICAgICAgaS0tOwogICAgICB9IGVsc2UgewogICAgICAgIG8ueCA9IGQzLmludGVycG9sYXRlTnVtYmVyKHBhcnNlRmxvYXQobVswXSksIHBhcnNlRmxvYXQoby54KSk7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChpIDwgbikgewogICAgICBvID0gcS5wb3AoKTsKICAgICAgaWYgKHNbby5pICsgMV0gPT0gbnVsbCkgewogICAgICAgIHNbby5pXSA9IG8ueDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzW28uaV0gPSBvLnggKyBzW28uaSArIDFdOwogICAgICAgIHMuc3BsaWNlKG8uaSArIDEsIDEpOwogICAgICB9CiAgICAgIG4tLTsKICAgIH0KICAgIGlmIChzLmxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm4gc1swXSA9PSBudWxsID8gcVswXS54IDogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGI7CiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSBzWyhvID0gcVtpXSkuaV0gPSBvLngodCk7CiAgICAgIHJldHVybiBzLmpvaW4oIiIpOwogICAgfTsKICB9OwogIGQzLmludGVycG9sYXRlVHJhbnNmb3JtID0gZnVuY3Rpb24oYSwgYikgewogICAgdmFyIHMgPSBbXSwgcSA9IFtdLCBuLCBBID0gZDMudHJhbnNmb3JtKGEpLCBCID0gZDMudHJhbnNmb3JtKGIpLCB0YSA9IEEudHJhbnNsYXRlLCB0YiA9IEIudHJhbnNsYXRlLCByYSA9IEEucm90YXRlLCByYiA9IEIucm90YXRlLCB3YSA9IEEuc2tldywgd2IgPSBCLnNrZXcsIGthID0gQS5zY2FsZSwga2IgPSBCLnNjYWxlOwogICAgaWYgKHRhWzBdICE9IHRiWzBdIHx8IHRhWzFdICE9IHRiWzFdKSB7CiAgICAgIHMucHVzaCgidHJhbnNsYXRlKCIsIG51bGwsICIsIiwgbnVsbCwgIikiKTsKICAgICAgcS5wdXNoKHsKICAgICAgICBpOiAxLAogICAgICAgIHg6IGQzLmludGVycG9sYXRlTnVtYmVyKHRhWzBdLCB0YlswXSkKICAgICAgfSwgewogICAgICAgIGk6IDMsCiAgICAgICAgeDogZDMuaW50ZXJwb2xhdGVOdW1iZXIodGFbMV0sIHRiWzFdKQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAodGJbMF0gfHwgdGJbMV0pIHsKICAgICAgcy5wdXNoKCJ0cmFuc2xhdGUoIiArIHRiICsgIikiKTsKICAgIH0gZWxzZSB7CiAgICAgIHMucHVzaCgiIik7CiAgICB9CiAgICBpZiAocmEgIT0gcmIpIHsKICAgICAgaWYgKHJhIC0gcmIgPiAxODApIHJiICs9IDM2MDsgZWxzZSBpZiAocmIgLSByYSA+IDE4MCkgcmEgKz0gMzYwOwogICAgICBxLnB1c2goewogICAgICAgIGk6IHMucHVzaChzLnBvcCgpICsgInJvdGF0ZSgiLCBudWxsLCAiKSIpIC0gMiwKICAgICAgICB4OiBkMy5pbnRlcnBvbGF0ZU51bWJlcihyYSwgcmIpCiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChyYikgewogICAgICBzLnB1c2gocy5wb3AoKSArICJyb3RhdGUoIiArIHJiICsgIikiKTsKICAgIH0KICAgIGlmICh3YSAhPSB3YikgewogICAgICBxLnB1c2goewogICAgICAgIGk6IHMucHVzaChzLnBvcCgpICsgInNrZXdYKCIsIG51bGwsICIpIikgLSAyLAogICAgICAgIHg6IGQzLmludGVycG9sYXRlTnVtYmVyKHdhLCB3YikKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHdiKSB7CiAgICAgIHMucHVzaChzLnBvcCgpICsgInNrZXdYKCIgKyB3YiArICIpIik7CiAgICB9CiAgICBpZiAoa2FbMF0gIT0ga2JbMF0gfHwga2FbMV0gIT0ga2JbMV0pIHsKICAgICAgbiA9IHMucHVzaChzLnBvcCgpICsgInNjYWxlKCIsIG51bGwsICIsIiwgbnVsbCwgIikiKTsKICAgICAgcS5wdXNoKHsKICAgICAgICBpOiBuIC0gNCwKICAgICAgICB4OiBkMy5pbnRlcnBvbGF0ZU51bWJlcihrYVswXSwga2JbMF0pCiAgICAgIH0sIHsKICAgICAgICBpOiBuIC0gMiwKICAgICAgICB4OiBkMy5pbnRlcnBvbGF0ZU51bWJlcihrYVsxXSwga2JbMV0pCiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChrYlswXSAhPSAxIHx8IGtiWzFdICE9IDEpIHsKICAgICAgcy5wdXNoKHMucG9wKCkgKyAic2NhbGUoIiArIGtiICsgIikiKTsKICAgIH0KICAgIG4gPSBxLmxlbmd0aDsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHZhciBpID0gLTEsIG87CiAgICAgIHdoaWxlICgrK2kgPCBuKSBzWyhvID0gcVtpXSkuaV0gPSBvLngodCk7CiAgICAgIHJldHVybiBzLmpvaW4oIiIpOwogICAgfTsKICB9OwogIGQzLmludGVycG9sYXRlUmdiID0gZnVuY3Rpb24oYSwgYikgewogICAgYSA9IGQzLnJnYihhKTsKICAgIGIgPSBkMy5yZ2IoYik7CiAgICB2YXIgYXIgPSBhLnIsIGFnID0gYS5nLCBhYiA9IGEuYiwgYnIgPSBiLnIgLSBhciwgYmcgPSBiLmcgLSBhZywgYmIgPSBiLmIgLSBhYjsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiAiIyIgKyBkM19yZ2JfaGV4KE1hdGgucm91bmQoYXIgKyBiciAqIHQpKSArIGQzX3JnYl9oZXgoTWF0aC5yb3VuZChhZyArIGJnICogdCkpICsgZDNfcmdiX2hleChNYXRoLnJvdW5kKGFiICsgYmIgKiB0KSk7CiAgICB9OwogIH07CiAgZDMuaW50ZXJwb2xhdGVIc2wgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBhID0gZDMuaHNsKGEpOwogICAgYiA9IGQzLmhzbChiKTsKICAgIHZhciBoMCA9IGEuaCwgczAgPSBhLnMsIGwwID0gYS5sLCBoMSA9IGIuaCAtIGgwLCBzMSA9IGIucyAtIHMwLCBsMSA9IGIubCAtIGwwOwogICAgaWYgKGgxID4gMTgwKSBoMSAtPSAzNjA7IGVsc2UgaWYgKGgxIDwgLTE4MCkgaDEgKz0gMzYwOwogICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIGQzX2hzbF9yZ2IoaDAgKyBoMSAqIHQsIHMwICsgczEgKiB0LCBsMCArIGwxICogdCkgKyAiIjsKICAgIH07CiAgfTsKICBkMy5pbnRlcnBvbGF0ZUxhYiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGEgPSBkMy5sYWIoYSk7CiAgICBiID0gZDMubGFiKGIpOwogICAgdmFyIGFsID0gYS5sLCBhYSA9IGEuYSwgYWIgPSBhLmIsIGJsID0gYi5sIC0gYWwsIGJhID0gYi5hIC0gYWEsIGJiID0gYi5iIC0gYWI7CiAgICByZXR1cm4gZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gZDNfbGFiX3JnYihhbCArIGJsICogdCwgYWEgKyBiYSAqIHQsIGFiICsgYmIgKiB0KSArICIiOwogICAgfTsKICB9OwogIGQzLmludGVycG9sYXRlSGNsID0gZnVuY3Rpb24oYSwgYikgewogICAgYSA9IGQzLmhjbChhKTsKICAgIGIgPSBkMy5oY2woYik7CiAgICB2YXIgYWggPSBhLmgsIGFjID0gYS5jLCBhbCA9IGEubCwgYmggPSBiLmggLSBhaCwgYmMgPSBiLmMgLSBhYywgYmwgPSBiLmwgLSBhbDsKICAgIGlmIChiaCA+IDE4MCkgYmggLT0gMzYwOyBlbHNlIGlmIChiaCA8IC0xODApIGJoICs9IDM2MDsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIHJldHVybiBkM19oY2xfbGFiKGFoICsgYmggKiB0LCBhYyArIGJjICogdCwgYWwgKyBibCAqIHQpICsgIiI7CiAgICB9OwogIH07CiAgZDMuaW50ZXJwb2xhdGVBcnJheSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciB4ID0gW10sIGMgPSBbXSwgbmEgPSBhLmxlbmd0aCwgbmIgPSBiLmxlbmd0aCwgbjAgPSBNYXRoLm1pbihhLmxlbmd0aCwgYi5sZW5ndGgpLCBpOwogICAgZm9yIChpID0gMDsgaSA8IG4wOyArK2kpIHgucHVzaChkMy5pbnRlcnBvbGF0ZShhW2ldLCBiW2ldKSk7CiAgICBmb3IgKDsgaSA8IG5hOyArK2kpIGNbaV0gPSBhW2ldOwogICAgZm9yICg7IGkgPCBuYjsgKytpKSBjW2ldID0gYltpXTsKICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBuMDsgKytpKSBjW2ldID0geFtpXSh0KTsKICAgICAgcmV0dXJuIGM7CiAgICB9OwogIH07CiAgZDMuaW50ZXJwb2xhdGVPYmplY3QgPSBmdW5jdGlvbihhLCBiKSB7CiAgICB2YXIgaSA9IHt9LCBjID0ge30sIGs7CiAgICBmb3IgKGsgaW4gYSkgewogICAgICBpZiAoayBpbiBiKSB7CiAgICAgICAgaVtrXSA9IGQzX2ludGVycG9sYXRlQnlOYW1lKGspKGFba10sIGJba10pOwogICAgICB9IGVsc2UgewogICAgICAgIGNba10gPSBhW2tdOwogICAgICB9CiAgICB9CiAgICBmb3IgKGsgaW4gYikgewogICAgICBpZiAoIShrIGluIGEpKSB7CiAgICAgICAgY1trXSA9IGJba107CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmdW5jdGlvbih0KSB7CiAgICAgIGZvciAoayBpbiBpKSBjW2tdID0gaVtrXSh0KTsKICAgICAgcmV0dXJuIGM7CiAgICB9OwogIH07CiAgdmFyIGQzX2ludGVycG9sYXRlX251bWJlciA9IC9bLStdPyg\/OlxkK1wuP1xkKnxcLj9cZCspKD86W2VFXVstK10\/XGQrKT8vZzsKICBkMy5pbnRlcnBvbGF0b3JzID0gWyBkMy5pbnRlcnBvbGF0ZU9iamVjdCwgZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGIgaW5zdGFuY2VvZiBBcnJheSAmJiBkMy5pbnRlcnBvbGF0ZUFycmF5KGEsIGIpOwogIH0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiAodHlwZW9mIGEgPT09ICJzdHJpbmciIHx8IHR5cGVvZiBiID09PSAic3RyaW5nIikgJiYgZDMuaW50ZXJwb2xhdGVTdHJpbmcoYSArICIiLCBiICsgIiIpOwogIH0sIGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiAodHlwZW9mIGIgPT09ICJzdHJpbmciID8gZDNfcmdiX25hbWVzLmhhcyhiKSB8fCAvXigjfHJnYlwofGhzbFwoKS8udGVzdChiKSA6IGIgaW5zdGFuY2VvZiBkM19Db2xvcikgJiYgZDMuaW50ZXJwb2xhdGVSZ2IoYSwgYik7CiAgfSwgZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuICFpc05hTihhID0gK2EpICYmICFpc05hTihiID0gK2IpICYmIGQzLmludGVycG9sYXRlTnVtYmVyKGEsIGIpOwogIH0gXTsKICBkM19Db2xvci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnJnYigpICsgIiI7CiAgfTsKICBkMy5yZ2IgPSBmdW5jdGlvbihyLCBnLCBiKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA\/IHIgaW5zdGFuY2VvZiBkM19SZ2IgPyBkM19yZ2Ioci5yLCByLmcsIHIuYikgOiBkM19yZ2JfcGFyc2UoIiIgKyByLCBkM19yZ2IsIGQzX2hzbF9yZ2IpIDogZDNfcmdiKH5+ciwgfn5nLCB+fmIpOwogIH07CiAgdmFyIGQzX3JnYlByb3RvdHlwZSA9IGQzX1JnYi5wcm90b3R5cGUgPSBuZXcgZDNfQ29sb3I7CiAgZDNfcmdiUHJvdG90eXBlLmJyaWdodGVyID0gZnVuY3Rpb24oaykgewogICAgayA9IE1hdGgucG93KC43LCBhcmd1bWVudHMubGVuZ3RoID8gayA6IDEpOwogICAgdmFyIHIgPSB0aGlzLnIsIGcgPSB0aGlzLmcsIGIgPSB0aGlzLmIsIGkgPSAzMDsKICAgIGlmICghciAmJiAhZyAmJiAhYikgcmV0dXJuIGQzX3JnYihpLCBpLCBpKTsKICAgIGlmIChyICYmIHIgPCBpKSByID0gaTsKICAgIGlmIChnICYmIGcgPCBpKSBnID0gaTsKICAgIGlmIChiICYmIGIgPCBpKSBiID0gaTsKICAgIHJldHVybiBkM19yZ2IoTWF0aC5taW4oMjU1LCBNYXRoLmZsb29yKHIgLyBrKSksIE1hdGgubWluKDI1NSwgTWF0aC5mbG9vcihnIC8gaykpLCBNYXRoLm1pbigyNTUsIE1hdGguZmxvb3IoYiAvIGspKSk7CiAgfTsKICBkM19yZ2JQcm90b3R5cGUuZGFya2VyID0gZnVuY3Rpb24oaykgewogICAgayA9IE1hdGgucG93KC43LCBhcmd1bWVudHMubGVuZ3RoID8gayA6IDEpOwogICAgcmV0dXJuIGQzX3JnYihNYXRoLmZsb29yKGsgKiB0aGlzLnIpLCBNYXRoLmZsb29yKGsgKiB0aGlzLmcpLCBNYXRoLmZsb29yKGsgKiB0aGlzLmIpKTsKICB9OwogIGQzX3JnYlByb3RvdHlwZS5oc2wgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19yZ2JfaHNsKHRoaXMuciwgdGhpcy5nLCB0aGlzLmIpOwogIH07CiAgZDNfcmdiUHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gIiMiICsgZDNfcmdiX2hleCh0aGlzLnIpICsgZDNfcmdiX2hleCh0aGlzLmcpICsgZDNfcmdiX2hleCh0aGlzLmIpOwogIH07CiAgdmFyIGQzX3JnYl9uYW1lcyA9IGQzLm1hcCh7CiAgICBhbGljZWJsdWU6ICIjZjBmOGZmIiwKICAgIGFudGlxdWV3aGl0ZTogIiNmYWViZDciLAogICAgYXF1YTogIiMwMGZmZmYiLAogICAgYXF1YW1hcmluZTogIiM3ZmZmZDQiLAogICAgYXp1cmU6ICIjZjBmZmZmIiwKICAgIGJlaWdlOiAiI2Y1ZjVkYyIsCiAgICBiaXNxdWU6ICIjZmZlNGM0IiwKICAgIGJsYWNrOiAiIzAwMDAwMCIsCiAgICBibGFuY2hlZGFsbW9uZDogIiNmZmViY2QiLAogICAgYmx1ZTogIiMwMDAwZmYiLAogICAgYmx1ZXZpb2xldDogIiM4YTJiZTIiLAogICAgYnJvd246ICIjYTUyYTJhIiwKICAgIGJ1cmx5d29vZDogIiNkZWI4ODciLAogICAgY2FkZXRibHVlOiAiIzVmOWVhMCIsCiAgICBjaGFydHJldXNlOiAiIzdmZmYwMCIsCiAgICBjaG9jb2xhdGU6ICIjZDI2OTFlIiwKICAgIGNvcmFsOiAiI2ZmN2Y1MCIsCiAgICBjb3JuZmxvd2VyYmx1ZTogIiM2NDk1ZWQiLAogICAgY29ybnNpbGs6ICIjZmZmOGRjIiwKICAgIGNyaW1zb246ICIjZGMxNDNjIiwKICAgIGN5YW46ICIjMDBmZmZmIiwKICAgIGRhcmtibHVlOiAiIzAwMDA4YiIsCiAgICBkYXJrY3lhbjogIiMwMDhiOGIiLAogICAgZGFya2dvbGRlbnJvZDogIiNiODg2MGIiLAogICAgZGFya2dyYXk6ICIjYTlhOWE5IiwKICAgIGRhcmtncmVlbjogIiMwMDY0MDAiLAogICAgZGFya2dyZXk6ICIjYTlhOWE5IiwKICAgIGRhcmtraGFraTogIiNiZGI3NmIiLAogICAgZGFya21hZ2VudGE6ICIjOGIwMDhiIiwKICAgIGRhcmtvbGl2ZWdyZWVuOiAiIzU1NmIyZiIsCiAgICBkYXJrb3JhbmdlOiAiI2ZmOGMwMCIsCiAgICBkYXJrb3JjaGlkOiAiIzk5MzJjYyIsCiAgICBkYXJrcmVkOiAiIzhiMDAwMCIsCiAgICBkYXJrc2FsbW9uOiAiI2U5OTY3YSIsCiAgICBkYXJrc2VhZ3JlZW46ICIjOGZiYzhmIiwKICAgIGRhcmtzbGF0ZWJsdWU6ICIjNDgzZDhiIiwKICAgIGRhcmtzbGF0ZWdyYXk6ICIjMmY0ZjRmIiwKICAgIGRhcmtzbGF0ZWdyZXk6ICIjMmY0ZjRmIiwKICAgIGRhcmt0dXJxdW9pc2U6ICIjMDBjZWQxIiwKICAgIGRhcmt2aW9sZXQ6ICIjOTQwMGQzIiwKICAgIGRlZXBwaW5rOiAiI2ZmMTQ5MyIsCiAgICBkZWVwc2t5Ymx1ZTogIiMwMGJmZmYiLAogICAgZGltZ3JheTogIiM2OTY5NjkiLAogICAgZGltZ3JleTogIiM2OTY5NjkiLAogICAgZG9kZ2VyYmx1ZTogIiMxZTkwZmYiLAogICAgZmlyZWJyaWNrOiAiI2IyMjIyMiIsCiAgICBmbG9yYWx3aGl0ZTogIiNmZmZhZjAiLAogICAgZm9yZXN0Z3JlZW46ICIjMjI4YjIyIiwKICAgIGZ1Y2hzaWE6ICIjZmYwMGZmIiwKICAgIGdhaW5zYm9ybzogIiNkY2RjZGMiLAogICAgZ2hvc3R3aGl0ZTogIiNmOGY4ZmYiLAogICAgZ29sZDogIiNmZmQ3MDAiLAogICAgZ29sZGVucm9kOiAiI2RhYTUyMCIsCiAgICBncmF5OiAiIzgwODA4MCIsCiAgICBncmVlbjogIiMwMDgwMDAiLAogICAgZ3JlZW55ZWxsb3c6ICIjYWRmZjJmIiwKICAgIGdyZXk6ICIjODA4MDgwIiwKICAgIGhvbmV5ZGV3OiAiI2YwZmZmMCIsCiAgICBob3RwaW5rOiAiI2ZmNjliNCIsCiAgICBpbmRpYW5yZWQ6ICIjY2Q1YzVjIiwKICAgIGluZGlnbzogIiM0YjAwODIiLAogICAgaXZvcnk6ICIjZmZmZmYwIiwKICAgIGtoYWtpOiAiI2YwZTY4YyIsCiAgICBsYXZlbmRlcjogIiNlNmU2ZmEiLAogICAgbGF2ZW5kZXJibHVzaDogIiNmZmYwZjUiLAogICAgbGF3bmdyZWVuOiAiIzdjZmMwMCIsCiAgICBsZW1vbmNoaWZmb246ICIjZmZmYWNkIiwKICAgIGxpZ2h0Ymx1ZTogIiNhZGQ4ZTYiLAogICAgbGlnaHRjb3JhbDogIiNmMDgwODAiLAogICAgbGlnaHRjeWFuOiAiI2UwZmZmZiIsCiAgICBsaWdodGdvbGRlbnJvZHllbGxvdzogIiNmYWZhZDIiLAogICAgbGlnaHRncmF5OiAiI2QzZDNkMyIsCiAgICBsaWdodGdyZWVuOiAiIzkwZWU5MCIsCiAgICBsaWdodGdyZXk6ICIjZDNkM2QzIiwKICAgIGxpZ2h0cGluazogIiNmZmI2YzEiLAogICAgbGlnaHRzYWxtb246ICIjZmZhMDdhIiwKICAgIGxpZ2h0c2VhZ3JlZW46ICIjMjBiMmFhIiwKICAgIGxpZ2h0c2t5Ymx1ZTogIiM4N2NlZmEiLAogICAgbGlnaHRzbGF0ZWdyYXk6ICIjNzc4ODk5IiwKICAgIGxpZ2h0c2xhdGVncmV5OiAiIzc3ODg5OSIsCiAgICBsaWdodHN0ZWVsYmx1ZTogIiNiMGM0ZGUiLAogICAgbGlnaHR5ZWxsb3c6ICIjZmZmZmUwIiwKICAgIGxpbWU6ICIjMDBmZjAwIiwKICAgIGxpbWVncmVlbjogIiMzMmNkMzIiLAogICAgbGluZW46ICIjZmFmMGU2IiwKICAgIG1hZ2VudGE6ICIjZmYwMGZmIiwKICAgIG1hcm9vbjogIiM4MDAwMDAiLAogICAgbWVkaXVtYXF1YW1hcmluZTogIiM2NmNkYWEiLAogICAgbWVkaXVtYmx1ZTogIiMwMDAwY2QiLAogICAgbWVkaXVtb3JjaGlkOiAiI2JhNTVkMyIsCiAgICBtZWRpdW1wdXJwbGU6ICIjOTM3MGRiIiwKICAgIG1lZGl1bXNlYWdyZWVuOiAiIzNjYjM3MSIsCiAgICBtZWRpdW1zbGF0ZWJsdWU6ICIjN2I2OGVlIiwKICAgIG1lZGl1bXNwcmluZ2dyZWVuOiAiIzAwZmE5YSIsCiAgICBtZWRpdW10dXJxdW9pc2U6ICIjNDhkMWNjIiwKICAgIG1lZGl1bXZpb2xldHJlZDogIiNjNzE1ODUiLAogICAgbWlkbmlnaHRibHVlOiAiIzE5MTk3MCIsCiAgICBtaW50Y3JlYW06ICIjZjVmZmZhIiwKICAgIG1pc3R5cm9zZTogIiNmZmU0ZTEiLAogICAgbW9jY2FzaW46ICIjZmZlNGI1IiwKICAgIG5hdmFqb3doaXRlOiAiI2ZmZGVhZCIsCiAgICBuYXZ5OiAiIzAwMDA4MCIsCiAgICBvbGRsYWNlOiAiI2ZkZjVlNiIsCiAgICBvbGl2ZTogIiM4MDgwMDAiLAogICAgb2xpdmVkcmFiOiAiIzZiOGUyMyIsCiAgICBvcmFuZ2U6ICIjZmZhNTAwIiwKICAgIG9yYW5nZXJlZDogIiNmZjQ1MDAiLAogICAgb3JjaGlkOiAiI2RhNzBkNiIsCiAgICBwYWxlZ29sZGVucm9kOiAiI2VlZThhYSIsCiAgICBwYWxlZ3JlZW46ICIjOThmYjk4IiwKICAgIHBhbGV0dXJxdW9pc2U6ICIjYWZlZWVlIiwKICAgIHBhbGV2aW9sZXRyZWQ6ICIjZGI3MDkzIiwKICAgIHBhcGF5YXdoaXA6ICIjZmZlZmQ1IiwKICAgIHBlYWNocHVmZjogIiNmZmRhYjkiLAogICAgcGVydTogIiNjZDg1M2YiLAogICAgcGluazogIiNmZmMwY2IiLAogICAgcGx1bTogIiNkZGEwZGQiLAogICAgcG93ZGVyYmx1ZTogIiNiMGUwZTYiLAogICAgcHVycGxlOiAiIzgwMDA4MCIsCiAgICByZWQ6ICIjZmYwMDAwIiwKICAgIHJvc3licm93bjogIiNiYzhmOGYiLAogICAgcm95YWxibHVlOiAiIzQxNjllMSIsCiAgICBzYWRkbGVicm93bjogIiM4YjQ1MTMiLAogICAgc2FsbW9uOiAiI2ZhODA3MiIsCiAgICBzYW5keWJyb3duOiAiI2Y0YTQ2MCIsCiAgICBzZWFncmVlbjogIiMyZThiNTciLAogICAgc2Vhc2hlbGw6ICIjZmZmNWVlIiwKICAgIHNpZW5uYTogIiNhMDUyMmQiLAogICAgc2lsdmVyOiAiI2MwYzBjMCIsCiAgICBza3libHVlOiAiIzg3Y2VlYiIsCiAgICBzbGF0ZWJsdWU6ICIjNmE1YWNkIiwKICAgIHNsYXRlZ3JheTogIiM3MDgwOTAiLAogICAgc2xhdGVncmV5OiAiIzcwODA5MCIsCiAgICBzbm93OiAiI2ZmZmFmYSIsCiAgICBzcHJpbmdncmVlbjogIiMwMGZmN2YiLAogICAgc3RlZWxibHVlOiAiIzQ2ODJiNCIsCiAgICB0YW46ICIjZDJiNDhjIiwKICAgIHRlYWw6ICIjMDA4MDgwIiwKICAgIHRoaXN0bGU6ICIjZDhiZmQ4IiwKICAgIHRvbWF0bzogIiNmZjYzNDciLAogICAgdHVycXVvaXNlOiAiIzQwZTBkMCIsCiAgICB2aW9sZXQ6ICIjZWU4MmVlIiwKICAgIHdoZWF0OiAiI2Y1ZGViMyIsCiAgICB3aGl0ZTogIiNmZmZmZmYiLAogICAgd2hpdGVzbW9rZTogIiNmNWY1ZjUiLAogICAgeWVsbG93OiAiI2ZmZmYwMCIsCiAgICB5ZWxsb3dncmVlbjogIiM5YWNkMzIiCiAgfSk7CiAgZDNfcmdiX25hbWVzLmZvckVhY2goZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgZDNfcmdiX25hbWVzLnNldChrZXksIGQzX3JnYl9wYXJzZSh2YWx1ZSwgZDNfcmdiLCBkM19oc2xfcmdiKSk7CiAgfSk7CiAgZDMuaHNsID0gZnVuY3Rpb24oaCwgcywgbCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBoIGluc3RhbmNlb2YgZDNfSHNsID8gZDNfaHNsKGguaCwgaC5zLCBoLmwpIDogZDNfcmdiX3BhcnNlKCIiICsgaCwgZDNfcmdiX2hzbCwgZDNfaHNsKSA6IGQzX2hzbCgraCwgK3MsICtsKTsKICB9OwogIHZhciBkM19oc2xQcm90b3R5cGUgPSBkM19Ic2wucHJvdG90eXBlID0gbmV3IGQzX0NvbG9yOwogIGQzX2hzbFByb3RvdHlwZS5icmlnaHRlciA9IGZ1bmN0aW9uKGspIHsKICAgIGsgPSBNYXRoLnBvdyguNywgYXJndW1lbnRzLmxlbmd0aCA\/IGsgOiAxKTsKICAgIHJldHVybiBkM19oc2wodGhpcy5oLCB0aGlzLnMsIHRoaXMubCAvIGspOwogIH07CiAgZDNfaHNsUHJvdG90eXBlLmRhcmtlciA9IGZ1bmN0aW9uKGspIHsKICAgIGsgPSBNYXRoLnBvdyguNywgYXJndW1lbnRzLmxlbmd0aCA\/IGsgOiAxKTsKICAgIHJldHVybiBkM19oc2wodGhpcy5oLCB0aGlzLnMsIGsgKiB0aGlzLmwpOwogIH07CiAgZDNfaHNsUHJvdG90eXBlLnJnYiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX2hzbF9yZ2IodGhpcy5oLCB0aGlzLnMsIHRoaXMubCk7CiAgfTsKICBkMy5oY2wgPSBmdW5jdGlvbihoLCBjLCBsKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA9PT0gMSA\/IGggaW5zdGFuY2VvZiBkM19IY2wgPyBkM19oY2woaC5oLCBoLmMsIGgubCkgOiBoIGluc3RhbmNlb2YgZDNfTGFiID8gZDNfbGFiX2hjbChoLmwsIGguYSwgaC5iKSA6IGQzX2xhYl9oY2woKGggPSBkM19yZ2JfbGFiKChoID0gZDMucmdiKGgpKS5yLCBoLmcsIGguYikpLmwsIGguYSwgaC5iKSA6IGQzX2hjbCgraCwgK2MsICtsKTsKICB9OwogIHZhciBkM19oY2xQcm90b3R5cGUgPSBkM19IY2wucHJvdG90eXBlID0gbmV3IGQzX0NvbG9yOwogIGQzX2hjbFByb3RvdHlwZS5icmlnaHRlciA9IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBkM19oY2wodGhpcy5oLCB0aGlzLmMsIE1hdGgubWluKDEwMCwgdGhpcy5sICsgZDNfbGFiX0sgKiAoYXJndW1lbnRzLmxlbmd0aCA\/IGsgOiAxKSkpOwogIH07CiAgZDNfaGNsUHJvdG90eXBlLmRhcmtlciA9IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBkM19oY2wodGhpcy5oLCB0aGlzLmMsIE1hdGgubWF4KDAsIHRoaXMubCAtIGQzX2xhYl9LICogKGFyZ3VtZW50cy5sZW5ndGggPyBrIDogMSkpKTsKICB9OwogIGQzX2hjbFByb3RvdHlwZS5yZ2IgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19oY2xfbGFiKHRoaXMuaCwgdGhpcy5jLCB0aGlzLmwpLnJnYigpOwogIH07CiAgZDMubGFiID0gZnVuY3Rpb24obCwgYSwgYikgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyBsIGluc3RhbmNlb2YgZDNfTGFiID8gZDNfbGFiKGwubCwgbC5hLCBsLmIpIDogbCBpbnN0YW5jZW9mIGQzX0hjbCA\/IGQzX2hjbF9sYWIobC5sLCBsLmMsIGwuaCkgOiBkM19yZ2JfbGFiKChsID0gZDMucmdiKGwpKS5yLCBsLmcsIGwuYikgOiBkM19sYWIoK2wsICthLCArYik7CiAgfTsKICB2YXIgZDNfbGFiX0sgPSAxODsKICB2YXIgZDNfbGFiX1ggPSAuOTUwNDcsIGQzX2xhYl9ZID0gMSwgZDNfbGFiX1ogPSAxLjA4ODgzOwogIHZhciBkM19sYWJQcm90b3R5cGUgPSBkM19MYWIucHJvdG90eXBlID0gbmV3IGQzX0NvbG9yOwogIGQzX2xhYlByb3RvdHlwZS5icmlnaHRlciA9IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBkM19sYWIoTWF0aC5taW4oMTAwLCB0aGlzLmwgKyBkM19sYWJfSyAqIChhcmd1bWVudHMubGVuZ3RoID8gayA6IDEpKSwgdGhpcy5hLCB0aGlzLmIpOwogIH07CiAgZDNfbGFiUHJvdG90eXBlLmRhcmtlciA9IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBkM19sYWIoTWF0aC5tYXgoMCwgdGhpcy5sIC0gZDNfbGFiX0sgKiAoYXJndW1lbnRzLmxlbmd0aCA\/IGsgOiAxKSksIHRoaXMuYSwgdGhpcy5iKTsKICB9OwogIGQzX2xhYlByb3RvdHlwZS5yZ2IgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19sYWJfcmdiKHRoaXMubCwgdGhpcy5hLCB0aGlzLmIpOwogIH07CiAgdmFyIGQzX3NlbGVjdCA9IGZ1bmN0aW9uKHMsIG4pIHsKICAgIHJldHVybiBuLnF1ZXJ5U2VsZWN0b3Iocyk7CiAgfSwgZDNfc2VsZWN0QWxsID0gZnVuY3Rpb24ocywgbikgewogICAgcmV0dXJuIG4ucXVlcnlTZWxlY3RvckFsbChzKTsKICB9LCBkM19zZWxlY3RSb290ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBkM19zZWxlY3RNYXRjaGVyID0gZDNfc2VsZWN0Um9vdC5tYXRjaGVzU2VsZWN0b3IgfHwgZDNfc2VsZWN0Um9vdC53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwgZDNfc2VsZWN0Um9vdC5tb3pNYXRjaGVzU2VsZWN0b3IgfHwgZDNfc2VsZWN0Um9vdC5tc01hdGNoZXNTZWxlY3RvciB8fCBkM19zZWxlY3RSb290Lm9NYXRjaGVzU2VsZWN0b3IsIGQzX3NlbGVjdE1hdGNoZXMgPSBmdW5jdGlvbihuLCBzKSB7CiAgICByZXR1cm4gZDNfc2VsZWN0TWF0Y2hlci5jYWxsKG4sIHMpOwogIH07CiAgaWYgKHR5cGVvZiBTaXp6bGUgPT09ICJmdW5jdGlvbiIpIHsKICAgIGQzX3NlbGVjdCA9IGZ1bmN0aW9uKHMsIG4pIHsKICAgICAgcmV0dXJuIFNpenpsZShzLCBuKVswXSB8fCBudWxsOwogICAgfTsKICAgIGQzX3NlbGVjdEFsbCA9IGZ1bmN0aW9uKHMsIG4pIHsKICAgICAgcmV0dXJuIFNpenpsZS51bmlxdWVTb3J0KFNpenpsZShzLCBuKSk7CiAgICB9OwogICAgZDNfc2VsZWN0TWF0Y2hlcyA9IFNpenpsZS5tYXRjaGVzU2VsZWN0b3I7CiAgfQogIHZhciBkM19zZWxlY3Rpb25Qcm90b3R5cGUgPSBbXTsKICBkMy5zZWxlY3Rpb24gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zZWxlY3Rpb25Sb290OwogIH07CiAgZDMuc2VsZWN0aW9uLnByb3RvdHlwZSA9IGQzX3NlbGVjdGlvblByb3RvdHlwZTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgIHZhciBzdWJncm91cHMgPSBbXSwgc3ViZ3JvdXAsIHN1Ym5vZGUsIGdyb3VwLCBub2RlOwogICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gImZ1bmN0aW9uIikgc2VsZWN0b3IgPSBkM19zZWxlY3Rpb25fc2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgZm9yICh2YXIgaiA9IC0xLCBtID0gdGhpcy5sZW5ndGg7ICsraiA8IG07ICkgewogICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgc3ViZ3JvdXAucGFyZW50Tm9kZSA9IChncm91cCA9IHRoaXNbal0pLnBhcmVudE5vZGU7CiAgICAgIGZvciAodmFyIGkgPSAtMSwgbiA9IGdyb3VwLmxlbmd0aDsgKytpIDwgbjsgKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgc3ViZ3JvdXAucHVzaChzdWJub2RlID0gc2VsZWN0b3IuY2FsbChub2RlLCBub2RlLl9fZGF0YV9fLCBpKSk7CiAgICAgICAgICBpZiAoc3Vibm9kZSAmJiAiX19kYXRhX18iIGluIG5vZGUpIHN1Ym5vZGUuX19kYXRhX18gPSBub2RlLl9fZGF0YV9fOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdWJncm91cC5wdXNoKG51bGwpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3NlbGVjdGlvbihzdWJncm91cHMpOwogIH07CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLnNlbGVjdEFsbCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICB2YXIgc3ViZ3JvdXBzID0gW10sIHN1Ymdyb3VwLCBub2RlOwogICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gImZ1bmN0aW9uIikgc2VsZWN0b3IgPSBkM19zZWxlY3Rpb25fc2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgZm9yICh2YXIgaiA9IC0xLCBtID0gdGhpcy5sZW5ndGg7ICsraiA8IG07ICkgewogICAgICBmb3IgKHZhciBncm91cCA9IHRoaXNbal0sIGkgPSAtMSwgbiA9IGdyb3VwLmxlbmd0aDsgKytpIDwgbjsgKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgc3ViZ3JvdXBzLnB1c2goc3ViZ3JvdXAgPSBkM19hcnJheShzZWxlY3Rvci5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGkpKSk7CiAgICAgICAgICBzdWJncm91cC5wYXJlbnROb2RlID0gbm9kZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkM19zZWxlY3Rpb24oc3ViZ3JvdXBzKTsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5hdHRyID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5vZGUoKTsKICAgICAgICBuYW1lID0gZDMubnMucXVhbGlmeShuYW1lKTsKICAgICAgICByZXR1cm4gbmFtZS5sb2NhbCA\/IG5vZGUuZ2V0QXR0cmlidXRlTlMobmFtZS5zcGFjZSwgbmFtZS5sb2NhbCkgOiBub2RlLmdldEF0dHJpYnV0ZShuYW1lKTsKICAgICAgfQogICAgICBmb3IgKHZhbHVlIGluIG5hbWUpIHRoaXMuZWFjaChkM19zZWxlY3Rpb25fYXR0cih2YWx1ZSwgbmFtZVt2YWx1ZV0pKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByZXR1cm4gdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9hdHRyKG5hbWUsIHZhbHVlKSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuY2xhc3NlZCA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgICAgaWYgKHR5cGVvZiBuYW1lID09PSAic3RyaW5nIikgewogICAgICAgIHZhciBub2RlID0gdGhpcy5ub2RlKCksIG4gPSAobmFtZSA9IG5hbWUudHJpbSgpLnNwbGl0KC9efFxzKy9nKSkubGVuZ3RoLCBpID0gLTE7CiAgICAgICAgaWYgKHZhbHVlID0gbm9kZS5jbGFzc0xpc3QpIHsKICAgICAgICAgIHdoaWxlICgrK2kgPCBuKSBpZiAoIXZhbHVlLmNvbnRhaW5zKG5hbWVbaV0pKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbHVlID0gbm9kZS5jbGFzc05hbWU7CiAgICAgICAgICBpZiAodmFsdWUuYmFzZVZhbCAhPSBudWxsKSB2YWx1ZSA9IHZhbHVlLmJhc2VWYWw7CiAgICAgICAgICB3aGlsZSAoKytpIDwgbikgaWYgKCFkM19zZWxlY3Rpb25fY2xhc3NlZFJlKG5hbWVbaV0pLnRlc3QodmFsdWUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZvciAodmFsdWUgaW4gbmFtZSkgdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9jbGFzc2VkKHZhbHVlLCBuYW1lW3ZhbHVlXSkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJldHVybiB0aGlzLmVhY2goZDNfc2VsZWN0aW9uX2NsYXNzZWQobmFtZSwgdmFsdWUpKTsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5zdHlsZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlLCBwcmlvcml0eSkgewogICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgaWYgKG4gPCAzKSB7CiAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIpIHsKICAgICAgICBpZiAobiA8IDIpIHZhbHVlID0gIiI7CiAgICAgICAgZm9yIChwcmlvcml0eSBpbiBuYW1lKSB0aGlzLmVhY2goZDNfc2VsZWN0aW9uX3N0eWxlKHByaW9yaXR5LCBuYW1lW3ByaW9yaXR5XSwgdmFsdWUpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBpZiAobiA8IDIpIHJldHVybiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLm5vZGUoKSwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuYW1lKTsKICAgICAgcHJpb3JpdHkgPSAiIjsKICAgIH0KICAgIHJldHVybiB0aGlzLmVhY2goZDNfc2VsZWN0aW9uX3N0eWxlKG5hbWUsIHZhbHVlLCBwcmlvcml0eSkpOwogIH07CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLnByb3BlcnR5ID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSByZXR1cm4gdGhpcy5ub2RlKClbbmFtZV07CiAgICAgIGZvciAodmFsdWUgaW4gbmFtZSkgdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9wcm9wZXJ0eSh2YWx1ZSwgbmFtZVt2YWx1ZV0pKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByZXR1cm4gdGhpcy5lYWNoKGQzX3NlbGVjdGlvbl9wcm9wZXJ0eShuYW1lLCB2YWx1ZSkpOwogIH07CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLnRleHQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAxID8gdGhpcy5ub2RlKCkudGV4dENvbnRlbnQgOiB0aGlzLmVhY2godHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iID8gZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy50ZXh0Q29udGVudCA9IHYgPT0gbnVsbCA\/ICIiIDogdjsKICAgIH0gOiB2YWx1ZSA9PSBudWxsID8gZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMudGV4dENvbnRlbnQgPSAiIjsKICAgIH0gOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy50ZXh0Q29udGVudCA9IHZhbHVlOwogICAgfSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuaHRtbCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA8IDEgPyB0aGlzLm5vZGUoKS5pbm5lckhUTUwgOiB0aGlzLmVhY2godHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iID8gZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2ID0gdmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgdGhpcy5pbm5lckhUTUwgPSB2ID09IG51bGwgPyAiIiA6IHY7CiAgICB9IDogdmFsdWUgPT0gbnVsbCA\/IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmlubmVySFRNTCA9ICIiOwogICAgfSA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmlubmVySFRNTCA9IHZhbHVlOwogICAgfSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24obmFtZSkgewogICAgZnVuY3Rpb24gYXBwZW5kKCkgewogICAgICByZXR1cm4gdGhpcy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5uYW1lc3BhY2VVUkksIG5hbWUpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFwcGVuZE5TKCkgewogICAgICByZXR1cm4gdGhpcy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMobmFtZS5zcGFjZSwgbmFtZS5sb2NhbCkpOwogICAgfQogICAgbmFtZSA9IGQzLm5zLnF1YWxpZnkobmFtZSk7CiAgICByZXR1cm4gdGhpcy5zZWxlY3QobmFtZS5sb2NhbCA\/IGFwcGVuZE5TIDogYXBwZW5kKTsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbihuYW1lLCBiZWZvcmUpIHsKICAgIGZ1bmN0aW9uIGluc2VydCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0QmVmb3JlKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyh0aGlzLm5hbWVzcGFjZVVSSSwgbmFtZSksIGQzX3NlbGVjdChiZWZvcmUsIHRoaXMpKTsKICAgIH0KICAgIGZ1bmN0aW9uIGluc2VydE5TKCkgewogICAgICByZXR1cm4gdGhpcy5pbnNlcnRCZWZvcmUoZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWUuc3BhY2UsIG5hbWUubG9jYWwpLCBkM19zZWxlY3QoYmVmb3JlLCB0aGlzKSk7CiAgICB9CiAgICBuYW1lID0gZDMubnMucXVhbGlmeShuYW1lKTsKICAgIHJldHVybiB0aGlzLnNlbGVjdChuYW1lLmxvY2FsID8gaW5zZXJ0TlMgOiBpbnNlcnQpOwogIH07CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgaWYgKHBhcmVudCkgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMpOwogICAgfSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuZGF0YSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgIGZ1bmN0aW9uIGJpbmQoZ3JvdXAsIGdyb3VwRGF0YSkgewogICAgICB2YXIgaSwgbiA9IGdyb3VwLmxlbmd0aCwgbSA9IGdyb3VwRGF0YS5sZW5ndGgsIG4wID0gTWF0aC5taW4obiwgbSksIG4xID0gTWF0aC5tYXgobiwgbSksIHVwZGF0ZU5vZGVzID0gW10sIGVudGVyTm9kZXMgPSBbXSwgZXhpdE5vZGVzID0gW10sIG5vZGUsIG5vZGVEYXRhOwogICAgICBpZiAoa2V5KSB7CiAgICAgICAgdmFyIG5vZGVCeUtleVZhbHVlID0gbmV3IGQzX01hcCwga2V5VmFsdWVzID0gW10sIGtleVZhbHVlLCBqID0gZ3JvdXBEYXRhLmxlbmd0aDsKICAgICAgICBmb3IgKGkgPSAtMTsgKytpIDwgbjsgKSB7CiAgICAgICAgICBrZXlWYWx1ZSA9IGtleS5jYWxsKG5vZGUgPSBncm91cFtpXSwgbm9kZS5fX2RhdGFfXywgaSk7CiAgICAgICAgICBpZiAobm9kZUJ5S2V5VmFsdWUuaGFzKGtleVZhbHVlKSkgewogICAgICAgICAgICBleGl0Tm9kZXNbaisrXSA9IG5vZGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBub2RlQnlLZXlWYWx1ZS5zZXQoa2V5VmFsdWUsIG5vZGUpOwogICAgICAgICAgfQogICAgICAgICAga2V5VmFsdWVzLnB1c2goa2V5VmFsdWUpOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSAtMTsgKytpIDwgbTsgKSB7CiAgICAgICAgICBrZXlWYWx1ZSA9IGtleS5jYWxsKGdyb3VwRGF0YSwgbm9kZURhdGEgPSBncm91cERhdGFbaV0sIGkpOwogICAgICAgICAgaWYgKG5vZGVCeUtleVZhbHVlLmhhcyhrZXlWYWx1ZSkpIHsKICAgICAgICAgICAgdXBkYXRlTm9kZXNbaV0gPSBub2RlID0gbm9kZUJ5S2V5VmFsdWUuZ2V0KGtleVZhbHVlKTsKICAgICAgICAgICAgbm9kZS5fX2RhdGFfXyA9IG5vZGVEYXRhOwogICAgICAgICAgICBlbnRlck5vZGVzW2ldID0gZXhpdE5vZGVzW2ldID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVudGVyTm9kZXNbaV0gPSBkM19zZWxlY3Rpb25fZGF0YU5vZGUobm9kZURhdGEpOwogICAgICAgICAgICB1cGRhdGVOb2Rlc1tpXSA9IGV4aXROb2Rlc1tpXSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBub2RlQnlLZXlWYWx1ZS5yZW1vdmUoa2V5VmFsdWUpOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSAtMTsgKytpIDwgbjsgKSB7CiAgICAgICAgICBpZiAobm9kZUJ5S2V5VmFsdWUuaGFzKGtleVZhbHVlc1tpXSkpIHsKICAgICAgICAgICAgZXhpdE5vZGVzW2ldID0gZ3JvdXBbaV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSA9IC0xOyArK2kgPCBuMDsgKSB7CiAgICAgICAgICBub2RlID0gZ3JvdXBbaV07CiAgICAgICAgICBub2RlRGF0YSA9IGdyb3VwRGF0YVtpXTsKICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIG5vZGUuX19kYXRhX18gPSBub2RlRGF0YTsKICAgICAgICAgICAgdXBkYXRlTm9kZXNbaV0gPSBub2RlOwogICAgICAgICAgICBlbnRlck5vZGVzW2ldID0gZXhpdE5vZGVzW2ldID0gbnVsbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVudGVyTm9kZXNbaV0gPSBkM19zZWxlY3Rpb25fZGF0YU5vZGUobm9kZURhdGEpOwogICAgICAgICAgICB1cGRhdGVOb2Rlc1tpXSA9IGV4aXROb2Rlc1tpXSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoOyBpIDwgbTsgKytpKSB7CiAgICAgICAgICBlbnRlck5vZGVzW2ldID0gZDNfc2VsZWN0aW9uX2RhdGFOb2RlKGdyb3VwRGF0YVtpXSk7CiAgICAgICAgICB1cGRhdGVOb2Rlc1tpXSA9IGV4aXROb2Rlc1tpXSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGZvciAoOyBpIDwgbjE7ICsraSkgewogICAgICAgICAgZXhpdE5vZGVzW2ldID0gZ3JvdXBbaV07CiAgICAgICAgICBlbnRlck5vZGVzW2ldID0gdXBkYXRlTm9kZXNbaV0gPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICBlbnRlck5vZGVzLnVwZGF0ZSA9IHVwZGF0ZU5vZGVzOwogICAgICBlbnRlck5vZGVzLnBhcmVudE5vZGUgPSB1cGRhdGVOb2Rlcy5wYXJlbnROb2RlID0gZXhpdE5vZGVzLnBhcmVudE5vZGUgPSBncm91cC5wYXJlbnROb2RlOwogICAgICBlbnRlci5wdXNoKGVudGVyTm9kZXMpOwogICAgICB1cGRhdGUucHVzaCh1cGRhdGVOb2Rlcyk7CiAgICAgIGV4aXQucHVzaChleGl0Tm9kZXMpOwogICAgfQogICAgdmFyIGkgPSAtMSwgbiA9IHRoaXMubGVuZ3RoLCBncm91cCwgbm9kZTsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICB2YWx1ZSA9IG5ldyBBcnJheShuID0gKGdyb3VwID0gdGhpc1swXSkubGVuZ3RoKTsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAobm9kZSA9IGdyb3VwW2ldKSB7CiAgICAgICAgICB2YWx1ZVtpXSA9IG5vZGUuX19kYXRhX187CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHZhciBlbnRlciA9IGQzX3NlbGVjdGlvbl9lbnRlcihbXSksIHVwZGF0ZSA9IGQzX3NlbGVjdGlvbihbXSksIGV4aXQgPSBkM19zZWxlY3Rpb24oW10pOwogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIikgewogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGJpbmQoZ3JvdXAgPSB0aGlzW2ldLCB2YWx1ZS5jYWxsKGdyb3VwLCBncm91cC5wYXJlbnROb2RlLl9fZGF0YV9fLCBpKSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgYmluZChncm91cCA9IHRoaXNbaV0sIHZhbHVlKTsKICAgICAgfQogICAgfQogICAgdXBkYXRlLmVudGVyID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBlbnRlcjsKICAgIH07CiAgICB1cGRhdGUuZXhpdCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZXhpdDsKICAgIH07CiAgICByZXR1cm4gdXBkYXRlOwogIH07CiAgZDNfc2VsZWN0aW9uUHJvdG90eXBlLmRhdHVtID0gZDNfc2VsZWN0aW9uUHJvdG90eXBlLm1hcCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA8IDEgPyB0aGlzLnByb3BlcnR5KCJfX2RhdGFfXyIpIDogdGhpcy5wcm9wZXJ0eSgiX19kYXRhX18iLCB2YWx1ZSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24oZmlsdGVyKSB7CiAgICB2YXIgc3ViZ3JvdXBzID0gW10sIHN1Ymdyb3VwLCBncm91cCwgbm9kZTsKICAgIGlmICh0eXBlb2YgZmlsdGVyICE9PSAiZnVuY3Rpb24iKSBmaWx0ZXIgPSBkM19zZWxlY3Rpb25fZmlsdGVyKGZpbHRlcik7CiAgICBmb3IgKHZhciBqID0gMCwgbSA9IHRoaXMubGVuZ3RoOyBqIDwgbTsgaisrKSB7CiAgICAgIHN1Ymdyb3Vwcy5wdXNoKHN1Ymdyb3VwID0gW10pOwogICAgICBzdWJncm91cC5wYXJlbnROb2RlID0gKGdyb3VwID0gdGhpc1tqXSkucGFyZW50Tm9kZTsKICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBncm91cC5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICBpZiAoKG5vZGUgPSBncm91cFtpXSkgJiYgZmlsdGVyLmNhbGwobm9kZSwgbm9kZS5fX2RhdGFfXywgaSkpIHsKICAgICAgICAgIHN1Ymdyb3VwLnB1c2gobm9kZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gZDNfc2VsZWN0aW9uKHN1Ymdyb3Vwcyk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUub3JkZXIgPSBmdW5jdGlvbigpIHsKICAgIGZvciAodmFyIGogPSAtMSwgbSA9IHRoaXMubGVuZ3RoOyArK2ogPCBtOyApIHsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gZ3JvdXAubGVuZ3RoIC0gMSwgbmV4dCA9IGdyb3VwW2ldLCBub2RlOyAtLWkgPj0gMDsgKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgaWYgKG5leHQgJiYgbmV4dCAhPT0gbm9kZS5uZXh0U2libGluZykgbmV4dC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBuZXh0KTsKICAgICAgICAgIG5leHQgPSBub2RlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuc29ydCA9IGZ1bmN0aW9uKGNvbXBhcmF0b3IpIHsKICAgIGNvbXBhcmF0b3IgPSBkM19zZWxlY3Rpb25fc29ydENvbXBhcmF0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIGZvciAodmFyIGogPSAtMSwgbSA9IHRoaXMubGVuZ3RoOyArK2ogPCBtOyApIHRoaXNbal0uc29ydChjb21wYXJhdG9yKTsKICAgIHJldHVybiB0aGlzLm9yZGVyKCk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUub24gPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSkgewogICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgaWYgKG4gPCAzKSB7CiAgICAgIGlmICh0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgICBpZiAobiA8IDIpIGxpc3RlbmVyID0gZmFsc2U7CiAgICAgICAgZm9yIChjYXB0dXJlIGluIHR5cGUpIHRoaXMuZWFjaChkM19zZWxlY3Rpb25fb24oY2FwdHVyZSwgdHlwZVtjYXB0dXJlXSwgbGlzdGVuZXIpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBpZiAobiA8IDIpIHJldHVybiAobiA9IHRoaXMubm9kZSgpWyJfX29uIiArIHR5cGVdKSAmJiBuLl87CiAgICAgIGNhcHR1cmUgPSBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0aGlzLmVhY2goZDNfc2VsZWN0aW9uX29uKHR5cGUsIGxpc3RlbmVyLCBjYXB0dXJlKSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuZWFjaCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICByZXR1cm4gZDNfc2VsZWN0aW9uX2VhY2godGhpcywgZnVuY3Rpb24obm9kZSwgaSwgaikgewogICAgICBjYWxsYmFjay5jYWxsKG5vZGUsIG5vZGUuX19kYXRhX18sIGksIGopOwogICAgfSk7CiAgfTsKICBkM19zZWxlY3Rpb25Qcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICBjYWxsYmFjay5hcHBseSh0aGlzLCAoYXJndW1lbnRzWzBdID0gdGhpcywgYXJndW1lbnRzKSk7CiAgICByZXR1cm4gdGhpczsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5lbXB0eSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICF0aGlzLm5vZGUoKTsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIGZvciAodmFyIGogPSAwLCBtID0gdGhpcy5sZW5ndGg7IGogPCBtOyBqKyspIHsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gMCwgbiA9IGdyb3VwLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgIHZhciBub2RlID0gZ3JvdXBbaV07CiAgICAgICAgaWYgKG5vZGUpIHJldHVybiBub2RlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9OwogIGQzX3NlbGVjdGlvblByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgc3ViZ3JvdXBzID0gW10sIHN1Ymdyb3VwLCBub2RlOwogICAgZm9yICh2YXIgaiA9IC0xLCBtID0gdGhpcy5sZW5ndGg7ICsraiA8IG07ICkgewogICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gLTEsIG4gPSBncm91cC5sZW5ndGg7ICsraSA8IG47ICkgewogICAgICAgIHN1Ymdyb3VwLnB1c2goKG5vZGUgPSBncm91cFtpXSkgPyB7CiAgICAgICAgICBub2RlOiBub2RlLAogICAgICAgICAgZGVsYXk6IGQzX3RyYW5zaXRpb25EZWxheSwKICAgICAgICAgIGR1cmF0aW9uOiBkM190cmFuc2l0aW9uRHVyYXRpb24KICAgICAgICB9IDogbnVsbCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkM190cmFuc2l0aW9uKHN1Ymdyb3VwcywgZDNfdHJhbnNpdGlvbklkIHx8ICsrZDNfdHJhbnNpdGlvbk5leHRJZCwgRGF0ZS5ub3coKSk7CiAgfTsKICB2YXIgZDNfc2VsZWN0aW9uUm9vdCA9IGQzX3NlbGVjdGlvbihbIFsgZG9jdW1lbnQgXSBdKTsKICBkM19zZWxlY3Rpb25Sb290WzBdLnBhcmVudE5vZGUgPSBkM19zZWxlY3RSb290OwogIGQzLnNlbGVjdCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICByZXR1cm4gdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiA\/IGQzX3NlbGVjdGlvblJvb3Quc2VsZWN0KHNlbGVjdG9yKSA6IGQzX3NlbGVjdGlvbihbIFsgc2VsZWN0b3IgXSBdKTsKICB9OwogIGQzLnNlbGVjdEFsbCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICByZXR1cm4gdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiA\/IGQzX3NlbGVjdGlvblJvb3Quc2VsZWN0QWxsKHNlbGVjdG9yKSA6IGQzX3NlbGVjdGlvbihbIGQzX2FycmF5KHNlbGVjdG9yKSBdKTsKICB9OwogIHZhciBkM19zZWxlY3Rpb25fZW50ZXJQcm90b3R5cGUgPSBbXTsKICBkMy5zZWxlY3Rpb24uZW50ZXIgPSBkM19zZWxlY3Rpb25fZW50ZXI7CiAgZDMuc2VsZWN0aW9uLmVudGVyLnByb3RvdHlwZSA9IGQzX3NlbGVjdGlvbl9lbnRlclByb3RvdHlwZTsKICBkM19zZWxlY3Rpb25fZW50ZXJQcm90b3R5cGUuYXBwZW5kID0gZDNfc2VsZWN0aW9uUHJvdG90eXBlLmFwcGVuZDsKICBkM19zZWxlY3Rpb25fZW50ZXJQcm90b3R5cGUuaW5zZXJ0ID0gZDNfc2VsZWN0aW9uUHJvdG90eXBlLmluc2VydDsKICBkM19zZWxlY3Rpb25fZW50ZXJQcm90b3R5cGUuZW1wdHkgPSBkM19zZWxlY3Rpb25Qcm90b3R5cGUuZW1wdHk7CiAgZDNfc2VsZWN0aW9uX2VudGVyUHJvdG90eXBlLm5vZGUgPSBkM19zZWxlY3Rpb25Qcm90b3R5cGUubm9kZTsKICBkM19zZWxlY3Rpb25fZW50ZXJQcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgIHZhciBzdWJncm91cHMgPSBbXSwgc3ViZ3JvdXAsIHN1Ym5vZGUsIHVwZ3JvdXAsIGdyb3VwLCBub2RlOwogICAgZm9yICh2YXIgaiA9IC0xLCBtID0gdGhpcy5sZW5ndGg7ICsraiA8IG07ICkgewogICAgICB1cGdyb3VwID0gKGdyb3VwID0gdGhpc1tqXSkudXBkYXRlOwogICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgc3ViZ3JvdXAucGFyZW50Tm9kZSA9IGdyb3VwLnBhcmVudE5vZGU7CiAgICAgIGZvciAodmFyIGkgPSAtMSwgbiA9IGdyb3VwLmxlbmd0aDsgKytpIDwgbjsgKSB7CiAgICAgICAgaWYgKG5vZGUgPSBncm91cFtpXSkgewogICAgICAgICAgc3ViZ3JvdXAucHVzaCh1cGdyb3VwW2ldID0gc3Vibm9kZSA9IHNlbGVjdG9yLmNhbGwoZ3JvdXAucGFyZW50Tm9kZSwgbm9kZS5fX2RhdGFfXywgaSkpOwogICAgICAgICAgc3Vibm9kZS5fX2RhdGFfXyA9IG5vZGUuX19kYXRhX187CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1Ymdyb3VwLnB1c2gobnVsbCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gZDNfc2VsZWN0aW9uKHN1Ymdyb3Vwcyk7CiAgfTsKICB2YXIgZDNfdHJhbnNpdGlvblByb3RvdHlwZSA9IFtdLCBkM190cmFuc2l0aW9uTmV4dElkID0gMCwgZDNfdHJhbnNpdGlvbklkID0gMCwgZDNfdHJhbnNpdGlvbkRlZmF1bHREZWxheSA9IDAsIGQzX3RyYW5zaXRpb25EZWZhdWx0RHVyYXRpb24gPSAyNTAsIGQzX3RyYW5zaXRpb25EZWZhdWx0RWFzZSA9IGQzLmVhc2UoImN1YmljLWluLW91dCIpLCBkM190cmFuc2l0aW9uRGVsYXkgPSBkM190cmFuc2l0aW9uRGVmYXVsdERlbGF5LCBkM190cmFuc2l0aW9uRHVyYXRpb24gPSBkM190cmFuc2l0aW9uRGVmYXVsdER1cmF0aW9uLCBkM190cmFuc2l0aW9uRWFzZSA9IGQzX3RyYW5zaXRpb25EZWZhdWx0RWFzZTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLmNhbGwgPSBkM19zZWxlY3Rpb25Qcm90b3R5cGUuY2FsbDsKICBkMy50cmFuc2l0aW9uID0gZnVuY3Rpb24oc2VsZWN0aW9uKSB7CiAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA\/IGQzX3RyYW5zaXRpb25JZCA\/IHNlbGVjdGlvbi50cmFuc2l0aW9uKCkgOiBzZWxlY3Rpb24gOiBkM19zZWxlY3Rpb25Sb290LnRyYW5zaXRpb24oKTsKICB9OwogIGQzLnRyYW5zaXRpb24ucHJvdG90eXBlID0gZDNfdHJhbnNpdGlvblByb3RvdHlwZTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICB2YXIgc3ViZ3JvdXBzID0gW10sIHN1Ymdyb3VwLCBzdWJub2RlLCBub2RlOwogICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gImZ1bmN0aW9uIikgc2VsZWN0b3IgPSBkM19zZWxlY3Rpb25fc2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgZm9yICh2YXIgaiA9IC0xLCBtID0gdGhpcy5sZW5ndGg7ICsraiA8IG07ICkgewogICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gLTEsIG4gPSBncm91cC5sZW5ndGg7ICsraSA8IG47ICkgewogICAgICAgIGlmICgobm9kZSA9IGdyb3VwW2ldKSAmJiAoc3Vibm9kZSA9IHNlbGVjdG9yLmNhbGwobm9kZS5ub2RlLCBub2RlLm5vZGUuX19kYXRhX18sIGkpKSkgewogICAgICAgICAgaWYgKCJfX2RhdGFfXyIgaW4gbm9kZS5ub2RlKSBzdWJub2RlLl9fZGF0YV9fID0gbm9kZS5ub2RlLl9fZGF0YV9fOwogICAgICAgICAgc3ViZ3JvdXAucHVzaCh7CiAgICAgICAgICAgIG5vZGU6IHN1Ym5vZGUsCiAgICAgICAgICAgIGRlbGF5OiBub2RlLmRlbGF5LAogICAgICAgICAgICBkdXJhdGlvbjogbm9kZS5kdXJhdGlvbgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1Ymdyb3VwLnB1c2gobnVsbCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gZDNfdHJhbnNpdGlvbihzdWJncm91cHMsIHRoaXMuaWQsIHRoaXMudGltZSkuZWFzZSh0aGlzLmVhc2UoKSk7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLnNlbGVjdEFsbCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICB2YXIgc3ViZ3JvdXBzID0gW10sIHN1Ymdyb3VwLCBzdWJub2Rlcywgbm9kZTsKICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09ICJmdW5jdGlvbiIpIHNlbGVjdG9yID0gZDNfc2VsZWN0aW9uX3NlbGVjdG9yQWxsKHNlbGVjdG9yKTsKICAgIGZvciAodmFyIGogPSAtMSwgbSA9IHRoaXMubGVuZ3RoOyArK2ogPCBtOyApIHsKICAgICAgZm9yICh2YXIgZ3JvdXAgPSB0aGlzW2pdLCBpID0gLTEsIG4gPSBncm91cC5sZW5ndGg7ICsraSA8IG47ICkgewogICAgICAgIGlmIChub2RlID0gZ3JvdXBbaV0pIHsKICAgICAgICAgIHN1Ym5vZGVzID0gc2VsZWN0b3IuY2FsbChub2RlLm5vZGUsIG5vZGUubm9kZS5fX2RhdGFfXywgaSk7CiAgICAgICAgICBzdWJncm91cHMucHVzaChzdWJncm91cCA9IFtdKTsKICAgICAgICAgIGZvciAodmFyIGsgPSAtMSwgbyA9IHN1Ym5vZGVzLmxlbmd0aDsgKytrIDwgbzsgKSB7CiAgICAgICAgICAgIHN1Ymdyb3VwLnB1c2goewogICAgICAgICAgICAgIG5vZGU6IHN1Ym5vZGVzW2tdLAogICAgICAgICAgICAgIGRlbGF5OiBub2RlLmRlbGF5LAogICAgICAgICAgICAgIGR1cmF0aW9uOiBub2RlLmR1cmF0aW9uCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3RyYW5zaXRpb24oc3ViZ3JvdXBzLCB0aGlzLmlkLCB0aGlzLnRpbWUpLmVhc2UodGhpcy5lYXNlKCkpOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXIpIHsKICAgIHZhciBzdWJncm91cHMgPSBbXSwgc3ViZ3JvdXAsIGdyb3VwLCBub2RlOwogICAgaWYgKHR5cGVvZiBmaWx0ZXIgIT09ICJmdW5jdGlvbiIpIGZpbHRlciA9IGQzX3NlbGVjdGlvbl9maWx0ZXIoZmlsdGVyKTsKICAgIGZvciAodmFyIGogPSAwLCBtID0gdGhpcy5sZW5ndGg7IGogPCBtOyBqKyspIHsKICAgICAgc3ViZ3JvdXBzLnB1c2goc3ViZ3JvdXAgPSBbXSk7CiAgICAgIGZvciAodmFyIGdyb3VwID0gdGhpc1tqXSwgaSA9IDAsIG4gPSBncm91cC5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICBpZiAoKG5vZGUgPSBncm91cFtpXSkgJiYgZmlsdGVyLmNhbGwobm9kZS5ub2RlLCBub2RlLm5vZGUuX19kYXRhX18sIGkpKSB7CiAgICAgICAgICBzdWJncm91cC5wdXNoKG5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGQzX3RyYW5zaXRpb24oc3ViZ3JvdXBzLCB0aGlzLmlkLCB0aGlzLnRpbWUpLmVhc2UodGhpcy5lYXNlKCkpOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5hdHRyID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgICBmb3IgKHZhbHVlIGluIG5hbWUpIHRoaXMuYXR0clR3ZWVuKHZhbHVlLCBkM190d2VlbkJ5TmFtZShuYW1lW3ZhbHVlXSwgdmFsdWUpKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICByZXR1cm4gdGhpcy5hdHRyVHdlZW4obmFtZSwgZDNfdHdlZW5CeU5hbWUodmFsdWUsIG5hbWUpKTsKICB9OwogIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUuYXR0clR3ZWVuID0gZnVuY3Rpb24obmFtZU5TLCB0d2VlbikgewogICAgZnVuY3Rpb24gYXR0clR3ZWVuKGQsIGkpIHsKICAgICAgdmFyIGYgPSB0d2Vlbi5jYWxsKHRoaXMsIGQsIGksIHRoaXMuZ2V0QXR0cmlidXRlKG5hbWUpKTsKICAgICAgcmV0dXJuIGYgPT09IGQzX3R3ZWVuUmVtb3ZlID8gKHRoaXMucmVtb3ZlQXR0cmlidXRlKG5hbWUpLCBudWxsKSA6IGYgJiYgZnVuY3Rpb24odCkgewogICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKG5hbWUsIGYodCkpOwogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gYXR0clR3ZWVuTlMoZCwgaSkgewogICAgICB2YXIgZiA9IHR3ZWVuLmNhbGwodGhpcywgZCwgaSwgdGhpcy5nZXRBdHRyaWJ1dGVOUyhuYW1lLnNwYWNlLCBuYW1lLmxvY2FsKSk7CiAgICAgIHJldHVybiBmID09PSBkM190d2VlblJlbW92ZSA\/ICh0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKG5hbWUuc3BhY2UsIG5hbWUubG9jYWwpLCBudWxsKSA6IGYgJiYgZnVuY3Rpb24odCkgewogICAgICAgIHRoaXMuc2V0QXR0cmlidXRlTlMobmFtZS5zcGFjZSwgbmFtZS5sb2NhbCwgZih0KSk7CiAgICAgIH07CiAgICB9CiAgICB2YXIgbmFtZSA9IGQzLm5zLnF1YWxpZnkobmFtZU5TKTsKICAgIHJldHVybiB0aGlzLnR3ZWVuKCJhdHRyLiIgKyBuYW1lTlMsIG5hbWUubG9jYWwgPyBhdHRyVHdlZW5OUyA6IGF0dHJUd2Vlbik7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLnN0eWxlID0gZnVuY3Rpb24obmFtZSwgdmFsdWUsIHByaW9yaXR5KSB7CiAgICB2YXIgbiA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICBpZiAobiA8IDMpIHsKICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSAic3RyaW5nIikgewogICAgICAgIGlmIChuIDwgMikgdmFsdWUgPSAiIjsKICAgICAgICBmb3IgKHByaW9yaXR5IGluIG5hbWUpIHRoaXMuc3R5bGVUd2Vlbihwcmlvcml0eSwgZDNfdHdlZW5CeU5hbWUobmFtZVtwcmlvcml0eV0sIHByaW9yaXR5KSwgdmFsdWUpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHByaW9yaXR5ID0gIiI7CiAgICB9CiAgICByZXR1cm4gdGhpcy5zdHlsZVR3ZWVuKG5hbWUsIGQzX3R3ZWVuQnlOYW1lKHZhbHVlLCBuYW1lKSwgcHJpb3JpdHkpOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS5zdHlsZVR3ZWVuID0gZnVuY3Rpb24obmFtZSwgdHdlZW4sIHByaW9yaXR5KSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIHByaW9yaXR5ID0gIiI7CiAgICByZXR1cm4gdGhpcy50d2Vlbigic3R5bGUuIiArIG5hbWUsIGZ1bmN0aW9uKGQsIGkpIHsKICAgICAgdmFyIGYgPSB0d2Vlbi5jYWxsKHRoaXMsIGQsIGksIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMsIG51bGwpLmdldFByb3BlcnR5VmFsdWUobmFtZSkpOwogICAgICByZXR1cm4gZiA9PT0gZDNfdHdlZW5SZW1vdmUgPyAodGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuYW1lKSwgbnVsbCkgOiBmICYmIGZ1bmN0aW9uKHQpIHsKICAgICAgICB0aGlzLnN0eWxlLnNldFByb3BlcnR5KG5hbWUsIGYodCksIHByaW9yaXR5KTsKICAgICAgfTsKICAgIH0pOwogIH07CiAgZDNfdHJhbnNpdGlvblByb3RvdHlwZS50ZXh0ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB0aGlzLnR3ZWVuKCJ0ZXh0IiwgZnVuY3Rpb24oZCwgaSkgewogICAgICB0aGlzLnRleHRDb250ZW50ID0gdHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iID8gdmFsdWUuY2FsbCh0aGlzLCBkLCBpKSA6IHZhbHVlOwogICAgfSk7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuZWFjaCgiZW5kLnRyYW5zaXRpb24iLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIHA7CiAgICAgIGlmICghdGhpcy5fX3RyYW5zaXRpb25fXyAmJiAocCA9IHRoaXMucGFyZW50Tm9kZSkpIHAucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICB9KTsKICB9OwogIGQzX3RyYW5zaXRpb25Qcm90b3R5cGUuZGVsYXkgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIGQzX3NlbGVjdGlvbl9lYWNoKHRoaXMsIHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIiA\/IGZ1bmN0aW9uKG5vZGUsIGksIGopIHsKICAgICAgbm9kZS5kZWxheSA9IHZhbHVlLmNhbGwobm9kZSA9IG5vZGUubm9kZSwgbm9kZS5fX2RhdGFfXywgaSwgaikgfCAwOwogICAgfSA6ICh2YWx1ZSA9IHZhbHVlIHwgMCwgZnVuY3Rpb24obm9kZSkgewogICAgICBub2RlLmRlbGF5ID0gdmFsdWU7CiAgICB9KSk7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLmR1cmF0aW9uID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBkM19zZWxlY3Rpb25fZWFjaCh0aGlzLCB0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIgPyBmdW5jdGlvbihub2RlLCBpLCBqKSB7CiAgICAgIG5vZGUuZHVyYXRpb24gPSBNYXRoLm1heCgxLCB2YWx1ZS5jYWxsKG5vZGUgPSBub2RlLm5vZGUsIG5vZGUuX19kYXRhX18sIGksIGopIHwgMCk7CiAgICB9IDogKHZhbHVlID0gTWF0aC5tYXgoMSwgdmFsdWUgfCAwKSwgZnVuY3Rpb24obm9kZSkgewogICAgICBub2RlLmR1cmF0aW9uID0gdmFsdWU7CiAgICB9KSk7CiAgfTsKICBkM190cmFuc2l0aW9uUHJvdG90eXBlLnRyYW5zaXRpb24gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnNlbGVjdChkM190aGlzKTsKICB9OwogIGQzLnR3ZWVuID0gZnVuY3Rpb24oYiwgaW50ZXJwb2xhdGUpIHsKICAgIGZ1bmN0aW9uIHR3ZWVuRnVuY3Rpb24oZCwgaSwgYSkgewogICAgICB2YXIgdiA9IGIuY2FsbCh0aGlzLCBkLCBpKTsKICAgICAgcmV0dXJuIHYgPT0gbnVsbCA\/IGEgIT0gIiIgJiYgZDNfdHdlZW5SZW1vdmUgOiBhICE9IHYgJiYgaW50ZXJwb2xhdGUoYSwgdiArICIiKTsKICAgIH0KICAgIGZ1bmN0aW9uIHR3ZWVuU3RyaW5nKGQsIGksIGEpIHsKICAgICAgcmV0dXJuIGEgIT0gYiAmJiBpbnRlcnBvbGF0ZShhLCBiKTsKICAgIH0KICAgIHJldHVybiB0eXBlb2YgYiA9PT0gImZ1bmN0aW9uIiA\/IHR3ZWVuRnVuY3Rpb24gOiBiID09IG51bGwgPyBkM190d2Vlbk51bGwgOiAoYiArPSAiIiwgdHdlZW5TdHJpbmcpOwogIH07CiAgdmFyIGQzX3R3ZWVuUmVtb3ZlID0ge307CiAgdmFyIGQzX3RpbWVyX2lkID0gMCwgZDNfdGltZXJfYnlJZCA9IHt9LCBkM190aW1lcl9xdWV1ZSA9IG51bGwsIGQzX3RpbWVyX2ludGVydmFsLCBkM190aW1lcl90aW1lb3V0OwogIGQzLnRpbWVyID0gZnVuY3Rpb24oY2FsbGJhY2ssIGRlbGF5LCB0aGVuKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIHsKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSBkZWxheSA9IDA7IGVsc2UgaWYgKCFpc0Zpbml0ZShkZWxheSkpIHJldHVybjsKICAgICAgdGhlbiA9IERhdGUubm93KCk7CiAgICB9CiAgICB2YXIgdGltZXIgPSBkM190aW1lcl9ieUlkW2NhbGxiYWNrLmlkXTsKICAgIGlmICh0aW1lciAmJiB0aW1lci5jYWxsYmFjayA9PT0gY2FsbGJhY2spIHsKICAgICAgdGltZXIudGhlbiA9IHRoZW47CiAgICAgIHRpbWVyLmRlbGF5ID0gZGVsYXk7CiAgICB9IGVsc2UgZDNfdGltZXJfYnlJZFtjYWxsYmFjay5pZCA9ICsrZDNfdGltZXJfaWRdID0gZDNfdGltZXJfcXVldWUgPSB7CiAgICAgIGNhbGxiYWNrOiBjYWxsYmFjaywKICAgICAgdGhlbjogdGhlbiwKICAgICAgZGVsYXk6IGRlbGF5LAogICAgICBuZXh0OiBkM190aW1lcl9xdWV1ZQogICAgfTsKICAgIGlmICghZDNfdGltZXJfaW50ZXJ2YWwpIHsKICAgICAgZDNfdGltZXJfdGltZW91dCA9IGNsZWFyVGltZW91dChkM190aW1lcl90aW1lb3V0KTsKICAgICAgZDNfdGltZXJfaW50ZXJ2YWwgPSAxOwogICAgICBkM190aW1lcl9mcmFtZShkM190aW1lcl9zdGVwKTsKICAgIH0KICB9OwogIGQzLnRpbWVyLmZsdXNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZWxhcHNlZCwgbm93ID0gRGF0ZS5ub3coKSwgdDEgPSBkM190aW1lcl9xdWV1ZTsKICAgIHdoaWxlICh0MSkgewogICAgICBlbGFwc2VkID0gbm93IC0gdDEudGhlbjsKICAgICAgaWYgKCF0MS5kZWxheSkgdDEuZmx1c2ggPSB0MS5jYWxsYmFjayhlbGFwc2VkKTsKICAgICAgdDEgPSB0MS5uZXh0OwogICAgfQogICAgZDNfdGltZXJfZmx1c2goKTsKICB9OwogIHZhciBkM190aW1lcl9mcmFtZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbihjYWxsYmFjaykgewogICAgc2V0VGltZW91dChjYWxsYmFjaywgMTcpOwogIH07CiAgZDMubW91c2UgPSBmdW5jdGlvbihjb250YWluZXIpIHsKICAgIHJldHVybiBkM19tb3VzZVBvaW50KGNvbnRhaW5lciwgZDNfZXZlbnRTb3VyY2UoKSk7CiAgfTsKICB2YXIgZDNfbW91c2VfYnVnNDQwODMgPSAvV2ViS2l0Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpID8gLTEgOiAwOwogIGQzLnRvdWNoZXMgPSBmdW5jdGlvbihjb250YWluZXIsIHRvdWNoZXMpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikgdG91Y2hlcyA9IGQzX2V2ZW50U291cmNlKCkudG91Y2hlczsKICAgIHJldHVybiB0b3VjaGVzID8gZDNfYXJyYXkodG91Y2hlcykubWFwKGZ1bmN0aW9uKHRvdWNoKSB7CiAgICAgIHZhciBwb2ludCA9IGQzX21vdXNlUG9pbnQoY29udGFpbmVyLCB0b3VjaCk7CiAgICAgIHBvaW50LmlkZW50aWZpZXIgPSB0b3VjaC5pZGVudGlmaWVyOwogICAgICByZXR1cm4gcG9pbnQ7CiAgICB9KSA6IFtdOwogIH07CiAgZDMuc2NhbGUgPSB7fTsKICBkMy5zY2FsZS5saW5lYXIgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zY2FsZV9saW5lYXIoWyAwLCAxIF0sIFsgMCwgMSBdLCBkMy5pbnRlcnBvbGF0ZSwgZmFsc2UpOwogIH07CiAgZDMuc2NhbGUubG9nID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfc2NhbGVfbG9nKGQzLnNjYWxlLmxpbmVhcigpLCBkM19zY2FsZV9sb2dwKTsKICB9OwogIHZhciBkM19zY2FsZV9sb2dGb3JtYXQgPSBkMy5mb3JtYXQoIi4wZSIpOwogIGQzX3NjYWxlX2xvZ3AucG93ID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIE1hdGgucG93KDEwLCB4KTsKICB9OwogIGQzX3NjYWxlX2xvZ24ucG93ID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIC1NYXRoLnBvdygxMCwgLXgpOwogIH07CiAgZDMuc2NhbGUucG93ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfc2NhbGVfcG93KGQzLnNjYWxlLmxpbmVhcigpLCAxKTsKICB9OwogIGQzLnNjYWxlLnNxcnQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkMy5zY2FsZS5wb3coKS5leHBvbmVudCguNSk7CiAgfTsKICBkMy5zY2FsZS5vcmRpbmFsID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfc2NhbGVfb3JkaW5hbChbXSwgewogICAgICB0OiAicmFuZ2UiLAogICAgICBhOiBbIFtdIF0KICAgIH0pOwogIH07CiAgZDMuc2NhbGUuY2F0ZWdvcnkxMCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzLnNjYWxlLm9yZGluYWwoKS5yYW5nZShkM19jYXRlZ29yeTEwKTsKICB9OwogIGQzLnNjYWxlLmNhdGVnb3J5MjAgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkMy5zY2FsZS5vcmRpbmFsKCkucmFuZ2UoZDNfY2F0ZWdvcnkyMCk7CiAgfTsKICBkMy5zY2FsZS5jYXRlZ29yeTIwYiA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzLnNjYWxlLm9yZGluYWwoKS5yYW5nZShkM19jYXRlZ29yeTIwYik7CiAgfTsKICBkMy5zY2FsZS5jYXRlZ29yeTIwYyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzLnNjYWxlLm9yZGluYWwoKS5yYW5nZShkM19jYXRlZ29yeTIwYyk7CiAgfTsKICB2YXIgZDNfY2F0ZWdvcnkxMCA9IFsgIiMxZjc3YjQiLCAiI2ZmN2YwZSIsICIjMmNhMDJjIiwgIiNkNjI3MjgiLCAiIzk0NjdiZCIsICIjOGM1NjRiIiwgIiNlMzc3YzIiLCAiIzdmN2Y3ZiIsICIjYmNiZDIyIiwgIiMxN2JlY2YiIF07CiAgdmFyIGQzX2NhdGVnb3J5MjAgPSBbICIjMWY3N2I0IiwgIiNhZWM3ZTgiLCAiI2ZmN2YwZSIsICIjZmZiYjc4IiwgIiMyY2EwMmMiLCAiIzk4ZGY4YSIsICIjZDYyNzI4IiwgIiNmZjk4OTYiLCAiIzk0NjdiZCIsICIjYzViMGQ1IiwgIiM4YzU2NGIiLCAiI2M0OWM5NCIsICIjZTM3N2MyIiwgIiNmN2I2ZDIiLCAiIzdmN2Y3ZiIsICIjYzdjN2M3IiwgIiNiY2JkMjIiLCAiI2RiZGI4ZCIsICIjMTdiZWNmIiwgIiM5ZWRhZTUiIF07CiAgdmFyIGQzX2NhdGVnb3J5MjBiID0gWyAiIzM5M2I3OSIsICIjNTI1NGEzIiwgIiM2YjZlY2YiLCAiIzljOWVkZSIsICIjNjM3OTM5IiwgIiM4Y2EyNTIiLCAiI2I1Y2Y2YiIsICIjY2VkYjljIiwgIiM4YzZkMzEiLCAiI2JkOWUzOSIsICIjZTdiYTUyIiwgIiNlN2NiOTQiLCAiIzg0M2MzOSIsICIjYWQ0OTRhIiwgIiNkNjYxNmIiLCAiI2U3OTY5YyIsICIjN2I0MTczIiwgIiNhNTUxOTQiLCAiI2NlNmRiZCIsICIjZGU5ZWQ2IiBdOwogIHZhciBkM19jYXRlZ29yeTIwYyA9IFsgIiMzMTgyYmQiLCAiIzZiYWVkNiIsICIjOWVjYWUxIiwgIiNjNmRiZWYiLCAiI2U2NTUwZCIsICIjZmQ4ZDNjIiwgIiNmZGFlNmIiLCAiI2ZkZDBhMiIsICIjMzFhMzU0IiwgIiM3NGM0NzYiLCAiI2ExZDk5YiIsICIjYzdlOWMwIiwgIiM3NTZiYjEiLCAiIzllOWFjOCIsICIjYmNiZGRjIiwgIiNkYWRhZWIiLCAiIzYzNjM2MyIsICIjOTY5Njk2IiwgIiNiZGJkYmQiLCAiI2Q5ZDlkOSIgXTsKICBkMy5zY2FsZS5xdWFudGlsZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX3NjYWxlX3F1YW50aWxlKFtdLCBbXSk7CiAgfTsKICBkMy5zY2FsZS5xdWFudGl6ZSA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX3NjYWxlX3F1YW50aXplKDAsIDEsIFsgMCwgMSBdKTsKICB9OwogIGQzLnNjYWxlLnRocmVzaG9sZCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX3NjYWxlX3RocmVzaG9sZChbIC41IF0sIFsgMCwgMSBdKTsKICB9OwogIGQzLnNjYWxlLmlkZW50aXR5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfc2NhbGVfaWRlbnRpdHkoWyAwLCAxIF0pOwogIH07CiAgZDMuc3ZnID0ge307CiAgZDMuc3ZnLmFyYyA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gYXJjKCkgewogICAgICB2YXIgcjAgPSBpbm5lclJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCByMSA9IG91dGVyUmFkaXVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGEwID0gc3RhcnRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpICsgZDNfc3ZnX2FyY09mZnNldCwgYTEgPSBlbmRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpICsgZDNfc3ZnX2FyY09mZnNldCwgZGEgPSAoYTEgPCBhMCAmJiAoZGEgPSBhMCwgYTAgPSBhMSwgYTEgPSBkYSksIGExIC0gYTApLCBkZiA9IGRhIDwgTWF0aC5QSSA\/ICIwIiA6ICIxIiwgYzAgPSBNYXRoLmNvcyhhMCksIHMwID0gTWF0aC5zaW4oYTApLCBjMSA9IE1hdGguY29zKGExKSwgczEgPSBNYXRoLnNpbihhMSk7CiAgICAgIHJldHVybiBkYSA+PSBkM19zdmdfYXJjTWF4ID8gcjAgPyAiTTAsIiArIHIxICsgIkEiICsgcjEgKyAiLCIgKyByMSArICIgMCAxLDEgMCwiICsgLXIxICsgIkEiICsgcjEgKyAiLCIgKyByMSArICIgMCAxLDEgMCwiICsgcjEgKyAiTTAsIiArIHIwICsgIkEiICsgcjAgKyAiLCIgKyByMCArICIgMCAxLDAgMCwiICsgLXIwICsgIkEiICsgcjAgKyAiLCIgKyByMCArICIgMCAxLDAgMCwiICsgcjAgKyAiWiIgOiAiTTAsIiArIHIxICsgIkEiICsgcjEgKyAiLCIgKyByMSArICIgMCAxLDEgMCwiICsgLXIxICsgIkEiICsgcjEgKyAiLCIgKyByMSArICIgMCAxLDEgMCwiICsgcjEgKyAiWiIgOiByMCA\/ICJNIiArIHIxICogYzAgKyAiLCIgKyByMSAqIHMwICsgIkEiICsgcjEgKyAiLCIgKyByMSArICIgMCAiICsgZGYgKyAiLDEgIiArIHIxICogYzEgKyAiLCIgKyByMSAqIHMxICsgIkwiICsgcjAgKiBjMSArICIsIiArIHIwICogczEgKyAiQSIgKyByMCArICIsIiArIHIwICsgIiAwICIgKyBkZiArICIsMCAiICsgcjAgKiBjMCArICIsIiArIHIwICogczAgKyAiWiIgOiAiTSIgKyByMSAqIGMwICsgIiwiICsgcjEgKiBzMCArICJBIiArIHIxICsgIiwiICsgcjEgKyAiIDAgIiArIGRmICsgIiwxICIgKyByMSAqIGMxICsgIiwiICsgcjEgKiBzMSArICJMMCwwIiArICJaIjsKICAgIH0KICAgIHZhciBpbm5lclJhZGl1cyA9IGQzX3N2Z19hcmNJbm5lclJhZGl1cywgb3V0ZXJSYWRpdXMgPSBkM19zdmdfYXJjT3V0ZXJSYWRpdXMsIHN0YXJ0QW5nbGUgPSBkM19zdmdfYXJjU3RhcnRBbmdsZSwgZW5kQW5nbGUgPSBkM19zdmdfYXJjRW5kQW5nbGU7CiAgICBhcmMuaW5uZXJSYWRpdXMgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGlubmVyUmFkaXVzOwogICAgICBpbm5lclJhZGl1cyA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBhcmM7CiAgICB9OwogICAgYXJjLm91dGVyUmFkaXVzID0gZnVuY3Rpb24odikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvdXRlclJhZGl1czsKICAgICAgb3V0ZXJSYWRpdXMgPSBkM19mdW5jdG9yKHYpOwogICAgICByZXR1cm4gYXJjOwogICAgfTsKICAgIGFyYy5zdGFydEFuZ2xlID0gZnVuY3Rpb24odikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzdGFydEFuZ2xlOwogICAgICBzdGFydEFuZ2xlID0gZDNfZnVuY3Rvcih2KTsKICAgICAgcmV0dXJuIGFyYzsKICAgIH07CiAgICBhcmMuZW5kQW5nbGUgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGVuZEFuZ2xlOwogICAgICBlbmRBbmdsZSA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBhcmM7CiAgICB9OwogICAgYXJjLmNlbnRyb2lkID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciByID0gKGlubmVyUmFkaXVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgKyBvdXRlclJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSAvIDIsIGEgPSAoc3RhcnRBbmdsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpICsgZW5kQW5nbGUuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgLyAyICsgZDNfc3ZnX2FyY09mZnNldDsKICAgICAgcmV0dXJuIFsgTWF0aC5jb3MoYSkgKiByLCBNYXRoLnNpbihhKSAqIHIgXTsKICAgIH07CiAgICByZXR1cm4gYXJjOwogIH07CiAgdmFyIGQzX3N2Z19hcmNPZmZzZXQgPSAtTWF0aC5QSSAvIDIsIGQzX3N2Z19hcmNNYXggPSAyICogTWF0aC5QSSAtIDFlLTY7CiAgZDMuc3ZnLmxpbmUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM19zdmdfbGluZShkM19pZGVudGl0eSk7CiAgfTsKICB2YXIgZDNfc3ZnX2xpbmVJbnRlcnBvbGF0b3JzID0gZDMubWFwKHsKICAgIGxpbmVhcjogZDNfc3ZnX2xpbmVMaW5lYXIsCiAgICAibGluZWFyLWNsb3NlZCI6IGQzX3N2Z19saW5lTGluZWFyQ2xvc2VkLAogICAgInN0ZXAtYmVmb3JlIjogZDNfc3ZnX2xpbmVTdGVwQmVmb3JlLAogICAgInN0ZXAtYWZ0ZXIiOiBkM19zdmdfbGluZVN0ZXBBZnRlciwKICAgIGJhc2lzOiBkM19zdmdfbGluZUJhc2lzLAogICAgImJhc2lzLW9wZW4iOiBkM19zdmdfbGluZUJhc2lzT3BlbiwKICAgICJiYXNpcy1jbG9zZWQiOiBkM19zdmdfbGluZUJhc2lzQ2xvc2VkLAogICAgYnVuZGxlOiBkM19zdmdfbGluZUJ1bmRsZSwKICAgIGNhcmRpbmFsOiBkM19zdmdfbGluZUNhcmRpbmFsLAogICAgImNhcmRpbmFsLW9wZW4iOiBkM19zdmdfbGluZUNhcmRpbmFsT3BlbiwKICAgICJjYXJkaW5hbC1jbG9zZWQiOiBkM19zdmdfbGluZUNhcmRpbmFsQ2xvc2VkLAogICAgbW9ub3RvbmU6IGQzX3N2Z19saW5lTW9ub3RvbmUKICB9KTsKICBkM19zdmdfbGluZUludGVycG9sYXRvcnMuZm9yRWFjaChmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICB2YWx1ZS5rZXkgPSBrZXk7CiAgICB2YWx1ZS5jbG9zZWQgPSAvLWNsb3NlZCQvLnRlc3Qoa2V5KTsKICB9KTsKICB2YXIgZDNfc3ZnX2xpbmVCYXNpc0JlemllcjEgPSBbIDAsIDIgLyAzLCAxIC8gMywgMCBdLCBkM19zdmdfbGluZUJhc2lzQmV6aWVyMiA9IFsgMCwgMSAvIDMsIDIgLyAzLCAwIF0sIGQzX3N2Z19saW5lQmFzaXNCZXppZXIzID0gWyAwLCAxIC8gNiwgMiAvIDMsIDEgLyA2IF07CiAgZDMuc3ZnLmxpbmUucmFkaWFsID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbGluZSA9IGQzX3N2Z19saW5lKGQzX3N2Z19saW5lUmFkaWFsKTsKICAgIGxpbmUucmFkaXVzID0gbGluZS54LCBkZWxldGUgbGluZS54OwogICAgbGluZS5hbmdsZSA9IGxpbmUueSwgZGVsZXRlIGxpbmUueTsKICAgIHJldHVybiBsaW5lOwogIH07CiAgZDNfc3ZnX2xpbmVTdGVwQmVmb3JlLnJldmVyc2UgPSBkM19zdmdfbGluZVN0ZXBBZnRlcjsKICBkM19zdmdfbGluZVN0ZXBBZnRlci5yZXZlcnNlID0gZDNfc3ZnX2xpbmVTdGVwQmVmb3JlOwogIGQzLnN2Zy5hcmVhID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZDNfc3ZnX2FyZWEoZDNfaWRlbnRpdHkpOwogIH07CiAgZDMuc3ZnLmFyZWEucmFkaWFsID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJlYSA9IGQzX3N2Z19hcmVhKGQzX3N2Z19saW5lUmFkaWFsKTsKICAgIGFyZWEucmFkaXVzID0gYXJlYS54LCBkZWxldGUgYXJlYS54OwogICAgYXJlYS5pbm5lclJhZGl1cyA9IGFyZWEueDAsIGRlbGV0ZSBhcmVhLngwOwogICAgYXJlYS5vdXRlclJhZGl1cyA9IGFyZWEueDEsIGRlbGV0ZSBhcmVhLngxOwogICAgYXJlYS5hbmdsZSA9IGFyZWEueSwgZGVsZXRlIGFyZWEueTsKICAgIGFyZWEuc3RhcnRBbmdsZSA9IGFyZWEueTAsIGRlbGV0ZSBhcmVhLnkwOwogICAgYXJlYS5lbmRBbmdsZSA9IGFyZWEueTEsIGRlbGV0ZSBhcmVhLnkxOwogICAgcmV0dXJuIGFyZWE7CiAgfTsKICBkMy5zdmcuY2hvcmQgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGNob3JkKGQsIGkpIHsKICAgICAgdmFyIHMgPSBzdWJncm91cCh0aGlzLCBzb3VyY2UsIGQsIGkpLCB0ID0gc3ViZ3JvdXAodGhpcywgdGFyZ2V0LCBkLCBpKTsKICAgICAgcmV0dXJuICJNIiArIHMucDAgKyBhcmMocy5yLCBzLnAxLCBzLmExIC0gcy5hMCkgKyAoZXF1YWxzKHMsIHQpID8gY3VydmUocy5yLCBzLnAxLCBzLnIsIHMucDApIDogY3VydmUocy5yLCBzLnAxLCB0LnIsIHQucDApICsgYXJjKHQuciwgdC5wMSwgdC5hMSAtIHQuYTApICsgY3VydmUodC5yLCB0LnAxLCBzLnIsIHMucDApKSArICJaIjsKICAgIH0KICAgIGZ1bmN0aW9uIHN1Ymdyb3VwKHNlbGYsIGYsIGQsIGkpIHsKICAgICAgdmFyIHN1Ymdyb3VwID0gZi5jYWxsKHNlbGYsIGQsIGkpLCByID0gcmFkaXVzLmNhbGwoc2VsZiwgc3ViZ3JvdXAsIGkpLCBhMCA9IHN0YXJ0QW5nbGUuY2FsbChzZWxmLCBzdWJncm91cCwgaSkgKyBkM19zdmdfYXJjT2Zmc2V0LCBhMSA9IGVuZEFuZ2xlLmNhbGwoc2VsZiwgc3ViZ3JvdXAsIGkpICsgZDNfc3ZnX2FyY09mZnNldDsKICAgICAgcmV0dXJuIHsKICAgICAgICByOiByLAogICAgICAgIGEwOiBhMCwKICAgICAgICBhMTogYTEsCiAgICAgICAgcDA6IFsgciAqIE1hdGguY29zKGEwKSwgciAqIE1hdGguc2luKGEwKSBdLAogICAgICAgIHAxOiBbIHIgKiBNYXRoLmNvcyhhMSksIHIgKiBNYXRoLnNpbihhMSkgXQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gZXF1YWxzKGEsIGIpIHsKICAgICAgcmV0dXJuIGEuYTAgPT0gYi5hMCAmJiBhLmExID09IGIuYTE7CiAgICB9CiAgICBmdW5jdGlvbiBhcmMociwgcCwgYSkgewogICAgICByZXR1cm4gIkEiICsgciArICIsIiArIHIgKyAiIDAgIiArICsoYSA+IE1hdGguUEkpICsgIiwxICIgKyBwOwogICAgfQogICAgZnVuY3Rpb24gY3VydmUocjAsIHAwLCByMSwgcDEpIHsKICAgICAgcmV0dXJuICJRIDAsMCAiICsgcDE7CiAgICB9CiAgICB2YXIgc291cmNlID0gZDNfc3ZnX2Nob3JkU291cmNlLCB0YXJnZXQgPSBkM19zdmdfY2hvcmRUYXJnZXQsIHJhZGl1cyA9IGQzX3N2Z19jaG9yZFJhZGl1cywgc3RhcnRBbmdsZSA9IGQzX3N2Z19hcmNTdGFydEFuZ2xlLCBlbmRBbmdsZSA9IGQzX3N2Z19hcmNFbmRBbmdsZTsKICAgIGNob3JkLnJhZGl1cyA9IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gcmFkaXVzOwogICAgICByYWRpdXMgPSBkM19mdW5jdG9yKHYpOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQuc291cmNlID0gZnVuY3Rpb24odikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzb3VyY2U7CiAgICAgIHNvdXJjZSA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBjaG9yZDsKICAgIH07CiAgICBjaG9yZC50YXJnZXQgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRhcmdldDsKICAgICAgdGFyZ2V0ID0gZDNfZnVuY3Rvcih2KTsKICAgICAgcmV0dXJuIGNob3JkOwogICAgfTsKICAgIGNob3JkLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHN0YXJ0QW5nbGU7CiAgICAgIHN0YXJ0QW5nbGUgPSBkM19mdW5jdG9yKHYpOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQuZW5kQW5nbGUgPSBmdW5jdGlvbih2KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGVuZEFuZ2xlOwogICAgICBlbmRBbmdsZSA9IGQzX2Z1bmN0b3Iodik7CiAgICAgIHJldHVybiBjaG9yZDsKICAgIH07CiAgICByZXR1cm4gY2hvcmQ7CiAgfTsKICBkMy5zdmcuZGlhZ29uYWwgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGRpYWdvbmFsKGQsIGkpIHsKICAgICAgdmFyIHAwID0gc291cmNlLmNhbGwodGhpcywgZCwgaSksIHAzID0gdGFyZ2V0LmNhbGwodGhpcywgZCwgaSksIG0gPSAocDAueSArIHAzLnkpIC8gMiwgcCA9IFsgcDAsIHsKICAgICAgICB4OiBwMC54LAogICAgICAgIHk6IG0KICAgICAgfSwgewogICAgICAgIHg6IHAzLngsCiAgICAgICAgeTogbQogICAgICB9LCBwMyBdOwogICAgICBwID0gcC5tYXAocHJvamVjdGlvbik7CiAgICAgIHJldHVybiAiTSIgKyBwWzBdICsgIkMiICsgcFsxXSArICIgIiArIHBbMl0gKyAiICIgKyBwWzNdOwogICAgfQogICAgdmFyIHNvdXJjZSA9IGQzX3N2Z19jaG9yZFNvdXJjZSwgdGFyZ2V0ID0gZDNfc3ZnX2Nob3JkVGFyZ2V0LCBwcm9qZWN0aW9uID0gZDNfc3ZnX2RpYWdvbmFsUHJvamVjdGlvbjsKICAgIGRpYWdvbmFsLnNvdXJjZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc291cmNlOwogICAgICBzb3VyY2UgPSBkM19mdW5jdG9yKHgpOwogICAgICByZXR1cm4gZGlhZ29uYWw7CiAgICB9OwogICAgZGlhZ29uYWwudGFyZ2V0ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0YXJnZXQ7CiAgICAgIHRhcmdldCA9IGQzX2Z1bmN0b3IoeCk7CiAgICAgIHJldHVybiBkaWFnb25hbDsKICAgIH07CiAgICBkaWFnb25hbC5wcm9qZWN0aW9uID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBwcm9qZWN0aW9uOwogICAgICBwcm9qZWN0aW9uID0geDsKICAgICAgcmV0dXJuIGRpYWdvbmFsOwogICAgfTsKICAgIHJldHVybiBkaWFnb25hbDsKICB9OwogIGQzLnN2Zy5kaWFnb25hbC5yYWRpYWwgPSBmdW5jdGlvbigpIHsKICAgIHZhciBkaWFnb25hbCA9IGQzLnN2Zy5kaWFnb25hbCgpLCBwcm9qZWN0aW9uID0gZDNfc3ZnX2RpYWdvbmFsUHJvamVjdGlvbiwgcHJvamVjdGlvbl8gPSBkaWFnb25hbC5wcm9qZWN0aW9uOwogICAgZGlhZ29uYWwucHJvamVjdGlvbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBwcm9qZWN0aW9uXyhkM19zdmdfZGlhZ29uYWxSYWRpYWxQcm9qZWN0aW9uKHByb2plY3Rpb24gPSB4KSkgOiBwcm9qZWN0aW9uOwogICAgfTsKICAgIHJldHVybiBkaWFnb25hbDsKICB9OwogIGQzLnN2Zy5tb3VzZSA9IGQzLm1vdXNlOwogIGQzLnN2Zy50b3VjaGVzID0gZDMudG91Y2hlczsKICBkMy5zdmcuc3ltYm9sID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBzeW1ib2woZCwgaSkgewogICAgICByZXR1cm4gKGQzX3N2Z19zeW1ib2xzLmdldCh0eXBlLmNhbGwodGhpcywgZCwgaSkpIHx8IGQzX3N2Z19zeW1ib2xDaXJjbGUpKHNpemUuY2FsbCh0aGlzLCBkLCBpKSk7CiAgICB9CiAgICB2YXIgdHlwZSA9IGQzX3N2Z19zeW1ib2xUeXBlLCBzaXplID0gZDNfc3ZnX3N5bWJvbFNpemU7CiAgICBzeW1ib2wudHlwZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdHlwZTsKICAgICAgdHlwZSA9IGQzX2Z1bmN0b3IoeCk7CiAgICAgIHJldHVybiBzeW1ib2w7CiAgICB9OwogICAgc3ltYm9sLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNpemU7CiAgICAgIHNpemUgPSBkM19mdW5jdG9yKHgpOwogICAgICByZXR1cm4gc3ltYm9sOwogICAgfTsKICAgIHJldHVybiBzeW1ib2w7CiAgfTsKICB2YXIgZDNfc3ZnX3N5bWJvbHMgPSBkMy5tYXAoewogICAgY2lyY2xlOiBkM19zdmdfc3ltYm9sQ2lyY2xlLAogICAgY3Jvc3M6IGZ1bmN0aW9uKHNpemUpIHsKICAgICAgdmFyIHIgPSBNYXRoLnNxcnQoc2l6ZSAvIDUpIC8gMjsKICAgICAgcmV0dXJuICJNIiArIC0zICogciArICIsIiArIC1yICsgIkgiICsgLXIgKyAiViIgKyAtMyAqIHIgKyAiSCIgKyByICsgIlYiICsgLXIgKyAiSCIgKyAzICogciArICJWIiArIHIgKyAiSCIgKyByICsgIlYiICsgMyAqIHIgKyAiSCIgKyAtciArICJWIiArIHIgKyAiSCIgKyAtMyAqIHIgKyAiWiI7CiAgICB9LAogICAgZGlhbW9uZDogZnVuY3Rpb24oc2l6ZSkgewogICAgICB2YXIgcnkgPSBNYXRoLnNxcnQoc2l6ZSAvICgyICogZDNfc3ZnX3N5bWJvbFRhbjMwKSksIHJ4ID0gcnkgKiBkM19zdmdfc3ltYm9sVGFuMzA7CiAgICAgIHJldHVybiAiTTAsIiArIC1yeSArICJMIiArIHJ4ICsgIiwwIiArICIgMCwiICsgcnkgKyAiICIgKyAtcnggKyAiLDAiICsgIloiOwogICAgfSwKICAgIHNxdWFyZTogZnVuY3Rpb24oc2l6ZSkgewogICAgICB2YXIgciA9IE1hdGguc3FydChzaXplKSAvIDI7CiAgICAgIHJldHVybiAiTSIgKyAtciArICIsIiArIC1yICsgIkwiICsgciArICIsIiArIC1yICsgIiAiICsgciArICIsIiArIHIgKyAiICIgKyAtciArICIsIiArIHIgKyAiWiI7CiAgICB9LAogICAgInRyaWFuZ2xlLWRvd24iOiBmdW5jdGlvbihzaXplKSB7CiAgICAgIHZhciByeCA9IE1hdGguc3FydChzaXplIC8gZDNfc3ZnX3N5bWJvbFNxcnQzKSwgcnkgPSByeCAqIGQzX3N2Z19zeW1ib2xTcXJ0MyAvIDI7CiAgICAgIHJldHVybiAiTTAsIiArIHJ5ICsgIkwiICsgcnggKyAiLCIgKyAtcnkgKyAiICIgKyAtcnggKyAiLCIgKyAtcnkgKyAiWiI7CiAgICB9LAogICAgInRyaWFuZ2xlLXVwIjogZnVuY3Rpb24oc2l6ZSkgewogICAgICB2YXIgcnggPSBNYXRoLnNxcnQoc2l6ZSAvIGQzX3N2Z19zeW1ib2xTcXJ0MyksIHJ5ID0gcnggKiBkM19zdmdfc3ltYm9sU3FydDMgLyAyOwogICAgICByZXR1cm4gIk0wLCIgKyAtcnkgKyAiTCIgKyByeCArICIsIiArIHJ5ICsgIiAiICsgLXJ4ICsgIiwiICsgcnkgKyAiWiI7CiAgICB9CiAgfSk7CiAgZDMuc3ZnLnN5bWJvbFR5cGVzID0gZDNfc3ZnX3N5bWJvbHMua2V5cygpOwogIHZhciBkM19zdmdfc3ltYm9sU3FydDMgPSBNYXRoLnNxcnQoMyksIGQzX3N2Z19zeW1ib2xUYW4zMCA9IE1hdGgudGFuKDMwICogTWF0aC5QSSAvIDE4MCk7CiAgZDMuc3ZnLmF4aXMgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGF4aXMoZykgewogICAgICBnLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGcgPSBkMy5zZWxlY3QodGhpcyk7CiAgICAgICAgdmFyIHRpY2tzID0gdGlja1ZhbHVlcyA9PSBudWxsID8gc2NhbGUudGlja3MgPyBzY2FsZS50aWNrcy5hcHBseShzY2FsZSwgdGlja0FyZ3VtZW50c18pIDogc2NhbGUuZG9tYWluKCkgOiB0aWNrVmFsdWVzLCB0aWNrRm9ybWF0ID0gdGlja0Zvcm1hdF8gPT0gbnVsbCA\/IHNjYWxlLnRpY2tGb3JtYXQgPyBzY2FsZS50aWNrRm9ybWF0LmFwcGx5KHNjYWxlLCB0aWNrQXJndW1lbnRzXykgOiBTdHJpbmcgOiB0aWNrRm9ybWF0XzsKICAgICAgICB2YXIgc3VidGlja3MgPSBkM19zdmdfYXhpc1N1YmRpdmlkZShzY2FsZSwgdGlja3MsIHRpY2tTdWJkaXZpZGUpLCBzdWJ0aWNrID0gZy5zZWxlY3RBbGwoIi5taW5vciIpLmRhdGEoc3VidGlja3MsIFN0cmluZyksIHN1YnRpY2tFbnRlciA9IHN1YnRpY2suZW50ZXIoKS5pbnNlcnQoImxpbmUiLCAiZyIpLmF0dHIoImNsYXNzIiwgInRpY2sgbWlub3IiKS5zdHlsZSgib3BhY2l0eSIsIDFlLTYpLCBzdWJ0aWNrRXhpdCA9IGQzLnRyYW5zaXRpb24oc3VidGljay5leGl0KCkpLnN0eWxlKCJvcGFjaXR5IiwgMWUtNikucmVtb3ZlKCksIHN1YnRpY2tVcGRhdGUgPSBkMy50cmFuc2l0aW9uKHN1YnRpY2spLnN0eWxlKCJvcGFjaXR5IiwgMSk7CiAgICAgICAgdmFyIHRpY2sgPSBnLnNlbGVjdEFsbCgiZyIpLmRhdGEodGlja3MsIFN0cmluZyksIHRpY2tFbnRlciA9IHRpY2suZW50ZXIoKS5pbnNlcnQoImciLCAicGF0aCIpLnN0eWxlKCJvcGFjaXR5IiwgMWUtNiksIHRpY2tFeGl0ID0gZDMudHJhbnNpdGlvbih0aWNrLmV4aXQoKSkuc3R5bGUoIm9wYWNpdHkiLCAxZS02KS5yZW1vdmUoKSwgdGlja1VwZGF0ZSA9IGQzLnRyYW5zaXRpb24odGljaykuc3R5bGUoIm9wYWNpdHkiLCAxKSwgdGlja1RyYW5zZm9ybTsKICAgICAgICB2YXIgcmFuZ2UgPSBkM19zY2FsZVJhbmdlKHNjYWxlKSwgcGF0aCA9IGcuc2VsZWN0QWxsKCIuZG9tYWluIikuZGF0YShbIDAgXSksIHBhdGhFbnRlciA9IHBhdGguZW50ZXIoKS5hcHBlbmQoInBhdGgiKS5hdHRyKCJjbGFzcyIsICJkb21haW4iKSwgcGF0aFVwZGF0ZSA9IGQzLnRyYW5zaXRpb24ocGF0aCk7CiAgICAgICAgdmFyIHNjYWxlMSA9IHNjYWxlLmNvcHkoKSwgc2NhbGUwID0gdGhpcy5fX2NoYXJ0X18gfHwgc2NhbGUxOwogICAgICAgIHRoaXMuX19jaGFydF9fID0gc2NhbGUxOwogICAgICAgIHRpY2tFbnRlci5hcHBlbmQoImxpbmUiKS5hdHRyKCJjbGFzcyIsICJ0aWNrIik7CiAgICAgICAgdGlja0VudGVyLmFwcGVuZCgidGV4dCIpOwogICAgICAgIHZhciBsaW5lRW50ZXIgPSB0aWNrRW50ZXIuc2VsZWN0KCJsaW5lIiksIGxpbmVVcGRhdGUgPSB0aWNrVXBkYXRlLnNlbGVjdCgibGluZSIpLCB0ZXh0ID0gdGljay5zZWxlY3QoInRleHQiKS50ZXh0KHRpY2tGb3JtYXQpLCB0ZXh0RW50ZXIgPSB0aWNrRW50ZXIuc2VsZWN0KCJ0ZXh0IiksIHRleHRVcGRhdGUgPSB0aWNrVXBkYXRlLnNlbGVjdCgidGV4dCIpOwogICAgICAgIHN3aXRjaCAob3JpZW50KSB7CiAgICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICB7CiAgICAgICAgICAgIHRpY2tUcmFuc2Zvcm0gPSBkM19zdmdfYXhpc1g7CiAgICAgICAgICAgIHN1YnRpY2tFbnRlci5hdHRyKCJ5MiIsIHRpY2tNaW5vclNpemUpOwogICAgICAgICAgICBzdWJ0aWNrVXBkYXRlLmF0dHIoIngyIiwgMCkuYXR0cigieTIiLCB0aWNrTWlub3JTaXplKTsKICAgICAgICAgICAgbGluZUVudGVyLmF0dHIoInkyIiwgdGlja01ham9yU2l6ZSk7CiAgICAgICAgICAgIHRleHRFbnRlci5hdHRyKCJ5IiwgTWF0aC5tYXgodGlja01ham9yU2l6ZSwgMCkgKyB0aWNrUGFkZGluZyk7CiAgICAgICAgICAgIGxpbmVVcGRhdGUuYXR0cigieDIiLCAwKS5hdHRyKCJ5MiIsIHRpY2tNYWpvclNpemUpOwogICAgICAgICAgICB0ZXh0VXBkYXRlLmF0dHIoIngiLCAwKS5hdHRyKCJ5IiwgTWF0aC5tYXgodGlja01ham9yU2l6ZSwgMCkgKyB0aWNrUGFkZGluZyk7CiAgICAgICAgICAgIHRleHQuYXR0cigiZHkiLCAiLjcxZW0iKS5hdHRyKCJ0ZXh0LWFuY2hvciIsICJtaWRkbGUiKTsKICAgICAgICAgICAgcGF0aFVwZGF0ZS5hdHRyKCJkIiwgIk0iICsgcmFuZ2VbMF0gKyAiLCIgKyB0aWNrRW5kU2l6ZSArICJWMEgiICsgcmFuZ2VbMV0gKyAiViIgKyB0aWNrRW5kU2l6ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgICAgewogICAgICAgICAgICB0aWNrVHJhbnNmb3JtID0gZDNfc3ZnX2F4aXNYOwogICAgICAgICAgICBzdWJ0aWNrRW50ZXIuYXR0cigieTIiLCAtdGlja01pbm9yU2l6ZSk7CiAgICAgICAgICAgIHN1YnRpY2tVcGRhdGUuYXR0cigieDIiLCAwKS5hdHRyKCJ5MiIsIC10aWNrTWlub3JTaXplKTsKICAgICAgICAgICAgbGluZUVudGVyLmF0dHIoInkyIiwgLXRpY2tNYWpvclNpemUpOwogICAgICAgICAgICB0ZXh0RW50ZXIuYXR0cigieSIsIC0oTWF0aC5tYXgodGlja01ham9yU2l6ZSwgMCkgKyB0aWNrUGFkZGluZykpOwogICAgICAgICAgICBsaW5lVXBkYXRlLmF0dHIoIngyIiwgMCkuYXR0cigieTIiLCAtdGlja01ham9yU2l6ZSk7CiAgICAgICAgICAgIHRleHRVcGRhdGUuYXR0cigieCIsIDApLmF0dHIoInkiLCAtKE1hdGgubWF4KHRpY2tNYWpvclNpemUsIDApICsgdGlja1BhZGRpbmcpKTsKICAgICAgICAgICAgdGV4dC5hdHRyKCJkeSIsICIwZW0iKS5hdHRyKCJ0ZXh0LWFuY2hvciIsICJtaWRkbGUiKTsKICAgICAgICAgICAgcGF0aFVwZGF0ZS5hdHRyKCJkIiwgIk0iICsgcmFuZ2VbMF0gKyAiLCIgKyAtdGlja0VuZFNpemUgKyAiVjBIIiArIHJhbmdlWzFdICsgIlYiICsgLXRpY2tFbmRTaXplKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgICAgewogICAgICAgICAgICB0aWNrVHJhbnNmb3JtID0gZDNfc3ZnX2F4aXNZOwogICAgICAgICAgICBzdWJ0aWNrRW50ZXIuYXR0cigieDIiLCAtdGlja01pbm9yU2l6ZSk7CiAgICAgICAgICAgIHN1YnRpY2tVcGRhdGUuYXR0cigieDIiLCAtdGlja01pbm9yU2l6ZSkuYXR0cigieTIiLCAwKTsKICAgICAgICAgICAgbGluZUVudGVyLmF0dHIoIngyIiwgLXRpY2tNYWpvclNpemUpOwogICAgICAgICAgICB0ZXh0RW50ZXIuYXR0cigieCIsIC0oTWF0aC5tYXgodGlja01ham9yU2l6ZSwgMCkgKyB0aWNrUGFkZGluZykpOwogICAgICAgICAgICBsaW5lVXBkYXRlLmF0dHIoIngyIiwgLXRpY2tNYWpvclNpemUpLmF0dHIoInkyIiwgMCk7CiAgICAgICAgICAgIHRleHRVcGRhdGUuYXR0cigieCIsIC0oTWF0aC5tYXgodGlja01ham9yU2l6ZSwgMCkgKyB0aWNrUGFkZGluZykpLmF0dHIoInkiLCAwKTsKICAgICAgICAgICAgdGV4dC5hdHRyKCJkeSIsICIuMzJlbSIpLmF0dHIoInRleHQtYW5jaG9yIiwgImVuZCIpOwogICAgICAgICAgICBwYXRoVXBkYXRlLmF0dHIoImQiLCAiTSIgKyAtdGlja0VuZFNpemUgKyAiLCIgKyByYW5nZVswXSArICJIMFYiICsgcmFuZ2VbMV0gKyAiSCIgKyAtdGlja0VuZFNpemUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgICAgewogICAgICAgICAgICB0aWNrVHJhbnNmb3JtID0gZDNfc3ZnX2F4aXNZOwogICAgICAgICAgICBzdWJ0aWNrRW50ZXIuYXR0cigieDIiLCB0aWNrTWlub3JTaXplKTsKICAgICAgICAgICAgc3VidGlja1VwZGF0ZS5hdHRyKCJ4MiIsIHRpY2tNaW5vclNpemUpLmF0dHIoInkyIiwgMCk7CiAgICAgICAgICAgIGxpbmVFbnRlci5hdHRyKCJ4MiIsIHRpY2tNYWpvclNpemUpOwogICAgICAgICAgICB0ZXh0RW50ZXIuYXR0cigieCIsIE1hdGgubWF4KHRpY2tNYWpvclNpemUsIDApICsgdGlja1BhZGRpbmcpOwogICAgICAgICAgICBsaW5lVXBkYXRlLmF0dHIoIngyIiwgdGlja01ham9yU2l6ZSkuYXR0cigieTIiLCAwKTsKICAgICAgICAgICAgdGV4dFVwZGF0ZS5hdHRyKCJ4IiwgTWF0aC5tYXgodGlja01ham9yU2l6ZSwgMCkgKyB0aWNrUGFkZGluZykuYXR0cigieSIsIDApOwogICAgICAgICAgICB0ZXh0LmF0dHIoImR5IiwgIi4zMmVtIikuYXR0cigidGV4dC1hbmNob3IiLCAic3RhcnQiKTsKICAgICAgICAgICAgcGF0aFVwZGF0ZS5hdHRyKCJkIiwgIk0iICsgdGlja0VuZFNpemUgKyAiLCIgKyByYW5nZVswXSArICJIMFYiICsgcmFuZ2VbMV0gKyAiSCIgKyB0aWNrRW5kU2l6ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc2NhbGUudGlja3MpIHsKICAgICAgICAgIHRpY2tFbnRlci5jYWxsKHRpY2tUcmFuc2Zvcm0sIHNjYWxlMCk7CiAgICAgICAgICB0aWNrVXBkYXRlLmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUxKTsKICAgICAgICAgIHRpY2tFeGl0LmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUxKTsKICAgICAgICAgIHN1YnRpY2tFbnRlci5jYWxsKHRpY2tUcmFuc2Zvcm0sIHNjYWxlMCk7CiAgICAgICAgICBzdWJ0aWNrVXBkYXRlLmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUxKTsKICAgICAgICAgIHN1YnRpY2tFeGl0LmNhbGwodGlja1RyYW5zZm9ybSwgc2NhbGUxKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGR4ID0gc2NhbGUxLnJhbmdlQmFuZCgpIC8gMiwgeCA9IGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgcmV0dXJuIHNjYWxlMShkKSArIGR4OwogICAgICAgICAgfTsKICAgICAgICAgIHRpY2tFbnRlci5jYWxsKHRpY2tUcmFuc2Zvcm0sIHgpOwogICAgICAgICAgdGlja1VwZGF0ZS5jYWxsKHRpY2tUcmFuc2Zvcm0sIHgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICB2YXIgc2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKSwgb3JpZW50ID0gImJvdHRvbSIsIHRpY2tNYWpvclNpemUgPSA2LCB0aWNrTWlub3JTaXplID0gNiwgdGlja0VuZFNpemUgPSA2LCB0aWNrUGFkZGluZyA9IDMsIHRpY2tBcmd1bWVudHNfID0gWyAxMCBdLCB0aWNrVmFsdWVzID0gbnVsbCwgdGlja0Zvcm1hdF8sIHRpY2tTdWJkaXZpZGUgPSAwOwogICAgYXhpcy5zY2FsZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2NhbGU7CiAgICAgIHNjYWxlID0geDsKICAgICAgcmV0dXJuIGF4aXM7CiAgICB9OwogICAgYXhpcy5vcmllbnQgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG9yaWVudDsKICAgICAgb3JpZW50ID0geDsKICAgICAgcmV0dXJuIGF4aXM7CiAgICB9OwogICAgYXhpcy50aWNrcyA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aWNrQXJndW1lbnRzXzsKICAgICAgdGlja0FyZ3VtZW50c18gPSBhcmd1bWVudHM7CiAgICAgIHJldHVybiBheGlzOwogICAgfTsKICAgIGF4aXMudGlja1ZhbHVlcyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGlja1ZhbHVlczsKICAgICAgdGlja1ZhbHVlcyA9IHg7CiAgICAgIHJldHVybiBheGlzOwogICAgfTsKICAgIGF4aXMudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGlja0Zvcm1hdF87CiAgICAgIHRpY2tGb3JtYXRfID0geDsKICAgICAgcmV0dXJuIGF4aXM7CiAgICB9OwogICAgYXhpcy50aWNrU2l6ZSA9IGZ1bmN0aW9uKHgsIHksIHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGlja01ham9yU2l6ZTsKICAgICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKICAgICAgdGlja01ham9yU2l6ZSA9ICt4OwogICAgICB0aWNrTWlub3JTaXplID0gbiA+IDEgPyAreSA6IHRpY2tNYWpvclNpemU7CiAgICAgIHRpY2tFbmRTaXplID0gbiA+IDAgPyArYXJndW1lbnRzW25dIDogdGlja01ham9yU2l6ZTsKICAgICAgcmV0dXJuIGF4aXM7CiAgICB9OwogICAgYXhpcy50aWNrUGFkZGluZyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGlja1BhZGRpbmc7CiAgICAgIHRpY2tQYWRkaW5nID0gK3g7CiAgICAgIHJldHVybiBheGlzOwogICAgfTsKICAgIGF4aXMudGlja1N1YmRpdmlkZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGlja1N1YmRpdmlkZTsKICAgICAgdGlja1N1YmRpdmlkZSA9ICt4OwogICAgICByZXR1cm4gYXhpczsKICAgIH07CiAgICByZXR1cm4gYXhpczsKICB9OwogIGQzLnN2Zy5icnVzaCA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gYnJ1c2goZykgewogICAgICBnLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGcgPSBkMy5zZWxlY3QodGhpcyksIGJnID0gZy5zZWxlY3RBbGwoIi5iYWNrZ3JvdW5kIikuZGF0YShbIDAgXSksIGZnID0gZy5zZWxlY3RBbGwoIi5leHRlbnQiKS5kYXRhKFsgMCBdKSwgdHogPSBnLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLmRhdGEocmVzaXplcywgU3RyaW5nKSwgZTsKICAgICAgICBnLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsICJhbGwiKS5vbigibW91c2Vkb3duLmJydXNoIiwgYnJ1c2hzdGFydCkub24oInRvdWNoc3RhcnQuYnJ1c2giLCBicnVzaHN0YXJ0KTsKICAgICAgICBiZy5lbnRlcigpLmFwcGVuZCgicmVjdCIpLmF0dHIoImNsYXNzIiwgImJhY2tncm91bmQiKS5zdHlsZSgidmlzaWJpbGl0eSIsICJoaWRkZW4iKS5zdHlsZSgiY3Vyc29yIiwgImNyb3NzaGFpciIpOwogICAgICAgIGZnLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCAiZXh0ZW50Iikuc3R5bGUoImN1cnNvciIsICJtb3ZlIik7CiAgICAgICAgdHouZW50ZXIoKS5hcHBlbmQoImciKS5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgIHJldHVybiAicmVzaXplICIgKyBkOwogICAgICAgIH0pLnN0eWxlKCJjdXJzb3IiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gZDNfc3ZnX2JydXNoQ3Vyc29yW2RdOwogICAgICAgIH0pLmFwcGVuZCgicmVjdCIpLmF0dHIoIngiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gL1tld10kLy50ZXN0KGQpID8gLTMgOiBudWxsOwogICAgICAgIH0pLmF0dHIoInkiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gL15bbnNdLy50ZXN0KGQpID8gLTMgOiBudWxsOwogICAgICAgIH0pLmF0dHIoIndpZHRoIiwgNikuYXR0cigiaGVpZ2h0IiwgNikuc3R5bGUoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgdHouc3R5bGUoImRpc3BsYXkiLCBicnVzaC5lbXB0eSgpID8gIm5vbmUiIDogbnVsbCk7CiAgICAgICAgdHouZXhpdCgpLnJlbW92ZSgpOwogICAgICAgIGlmICh4KSB7CiAgICAgICAgICBlID0gZDNfc2NhbGVSYW5nZSh4KTsKICAgICAgICAgIGJnLmF0dHIoIngiLCBlWzBdKS5hdHRyKCJ3aWR0aCIsIGVbMV0gLSBlWzBdKTsKICAgICAgICAgIHJlZHJhd1goZyk7CiAgICAgICAgfQogICAgICAgIGlmICh5KSB7CiAgICAgICAgICBlID0gZDNfc2NhbGVSYW5nZSh5KTsKICAgICAgICAgIGJnLmF0dHIoInkiLCBlWzBdKS5hdHRyKCJoZWlnaHQiLCBlWzFdIC0gZVswXSk7CiAgICAgICAgICByZWRyYXdZKGcpOwogICAgICAgIH0KICAgICAgICByZWRyYXcoZyk7CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gcmVkcmF3KGcpIHsKICAgICAgZy5zZWxlY3RBbGwoIi5yZXNpemUiKS5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoIiArIGV4dGVudFsrL2UkLy50ZXN0KGQpXVswXSArICIsIiArIGV4dGVudFsrL15zLy50ZXN0KGQpXVsxXSArICIpIjsKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiByZWRyYXdYKGcpIHsKICAgICAgZy5zZWxlY3QoIi5leHRlbnQiKS5hdHRyKCJ4IiwgZXh0ZW50WzBdWzBdKTsKICAgICAgZy5zZWxlY3RBbGwoIi5leHRlbnQsLm4+cmVjdCwucz5yZWN0IikuYXR0cigid2lkdGgiLCBleHRlbnRbMV1bMF0gLSBleHRlbnRbMF1bMF0pOwogICAgfQogICAgZnVuY3Rpb24gcmVkcmF3WShnKSB7CiAgICAgIGcuc2VsZWN0KCIuZXh0ZW50IikuYXR0cigieSIsIGV4dGVudFswXVsxXSk7CiAgICAgIGcuc2VsZWN0QWxsKCIuZXh0ZW50LC5lPnJlY3QsLnc+cmVjdCIpLmF0dHIoImhlaWdodCIsIGV4dGVudFsxXVsxXSAtIGV4dGVudFswXVsxXSk7CiAgICB9CiAgICBmdW5jdGlvbiBicnVzaHN0YXJ0KCkgewogICAgICBmdW5jdGlvbiBtb3VzZSgpIHsKICAgICAgICB2YXIgdG91Y2hlcyA9IGQzLmV2ZW50LmNoYW5nZWRUb3VjaGVzOwogICAgICAgIHJldHVybiB0b3VjaGVzID8gZDMudG91Y2hlcyh0YXJnZXQsIHRvdWNoZXMpWzBdIDogZDMubW91c2UodGFyZ2V0KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBrZXlkb3duKCkgewogICAgICAgIGlmIChkMy5ldmVudC5rZXlDb2RlID09IDMyKSB7CiAgICAgICAgICBpZiAoIWRyYWdnaW5nKSB7CiAgICAgICAgICAgIGNlbnRlciA9IG51bGw7CiAgICAgICAgICAgIG9yaWdpblswXSAtPSBleHRlbnRbMV1bMF07CiAgICAgICAgICAgIG9yaWdpblsxXSAtPSBleHRlbnRbMV1bMV07CiAgICAgICAgICAgIGRyYWdnaW5nID0gMjsKICAgICAgICAgIH0KICAgICAgICAgIGQzX2V2ZW50Q2FuY2VsKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGtleXVwKCkgewogICAgICAgIGlmIChkMy5ldmVudC5rZXlDb2RlID09IDMyICYmIGRyYWdnaW5nID09IDIpIHsKICAgICAgICAgIG9yaWdpblswXSArPSBleHRlbnRbMV1bMF07CiAgICAgICAgICBvcmlnaW5bMV0gKz0gZXh0ZW50WzFdWzFdOwogICAgICAgICAgZHJhZ2dpbmcgPSAwOwogICAgICAgICAgZDNfZXZlbnRDYW5jZWwoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnJ1c2htb3ZlKCkgewogICAgICAgIHZhciBwb2ludCA9IG1vdXNlKCksIG1vdmVkID0gZmFsc2U7CiAgICAgICAgaWYgKG9mZnNldCkgewogICAgICAgICAgcG9pbnRbMF0gKz0gb2Zmc2V0WzBdOwogICAgICAgICAgcG9pbnRbMV0gKz0gb2Zmc2V0WzFdOwogICAgICAgIH0KICAgICAgICBpZiAoIWRyYWdnaW5nKSB7CiAgICAgICAgICBpZiAoZDMuZXZlbnQuYWx0S2V5KSB7CiAgICAgICAgICAgIGlmICghY2VudGVyKSBjZW50ZXIgPSBbIChleHRlbnRbMF1bMF0gKyBleHRlbnRbMV1bMF0pIC8gMiwgKGV4dGVudFswXVsxXSArIGV4dGVudFsxXVsxXSkgLyAyIF07CiAgICAgICAgICAgIG9yaWdpblswXSA9IGV4dGVudFsrKHBvaW50WzBdIDwgY2VudGVyWzBdKV1bMF07CiAgICAgICAgICAgIG9yaWdpblsxXSA9IGV4dGVudFsrKHBvaW50WzFdIDwgY2VudGVyWzFdKV1bMV07CiAgICAgICAgICB9IGVsc2UgY2VudGVyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc2l6aW5nWCAmJiBtb3ZlMShwb2ludCwgeCwgMCkpIHsKICAgICAgICAgIHJlZHJhd1goZyk7CiAgICAgICAgICBtb3ZlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChyZXNpemluZ1kgJiYgbW92ZTEocG9pbnQsIHksIDEpKSB7CiAgICAgICAgICByZWRyYXdZKGcpOwogICAgICAgICAgbW92ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAobW92ZWQpIHsKICAgICAgICAgIHJlZHJhdyhnKTsKICAgICAgICAgIGV2ZW50Xyh7CiAgICAgICAgICAgIHR5cGU6ICJicnVzaCIsCiAgICAgICAgICAgIG1vZGU6IGRyYWdnaW5nID8gIm1vdmUiIDogInJlc2l6ZSIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBtb3ZlMShwb2ludCwgc2NhbGUsIGkpIHsKICAgICAgICB2YXIgcmFuZ2UgPSBkM19zY2FsZVJhbmdlKHNjYWxlKSwgcjAgPSByYW5nZVswXSwgcjEgPSByYW5nZVsxXSwgcG9zaXRpb24gPSBvcmlnaW5baV0sIHNpemUgPSBleHRlbnRbMV1baV0gLSBleHRlbnRbMF1baV0sIG1pbiwgbWF4OwogICAgICAgIGlmIChkcmFnZ2luZykgewogICAgICAgICAgcjAgLT0gcG9zaXRpb247CiAgICAgICAgICByMSAtPSBzaXplICsgcG9zaXRpb247CiAgICAgICAgfQogICAgICAgIG1pbiA9IE1hdGgubWF4KHIwLCBNYXRoLm1pbihyMSwgcG9pbnRbaV0pKTsKICAgICAgICBpZiAoZHJhZ2dpbmcpIHsKICAgICAgICAgIG1heCA9IChtaW4gKz0gcG9zaXRpb24pICsgc2l6ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGNlbnRlcikgcG9zaXRpb24gPSBNYXRoLm1heChyMCwgTWF0aC5taW4ocjEsIDIgKiBjZW50ZXJbaV0gLSBtaW4pKTsKICAgICAgICAgIGlmIChwb3NpdGlvbiA8IG1pbikgewogICAgICAgICAgICBtYXggPSBtaW47CiAgICAgICAgICAgIG1pbiA9IHBvc2l0aW9uOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWF4ID0gcG9zaXRpb247CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChleHRlbnRbMF1baV0gIT09IG1pbiB8fCBleHRlbnRbMV1baV0gIT09IG1heCkgewogICAgICAgICAgZXh0ZW50RG9tYWluID0gbnVsbDsKICAgICAgICAgIGV4dGVudFswXVtpXSA9IG1pbjsKICAgICAgICAgIGV4dGVudFsxXVtpXSA9IG1heDsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBicnVzaGVuZCgpIHsKICAgICAgICBicnVzaG1vdmUoKTsKICAgICAgICBnLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsICJhbGwiKS5zZWxlY3RBbGwoIi5yZXNpemUiKS5zdHlsZSgiZGlzcGxheSIsIGJydXNoLmVtcHR5KCkgPyAibm9uZSIgOiBudWxsKTsKICAgICAgICBkMy5zZWxlY3QoImJvZHkiKS5zdHlsZSgiY3Vyc29yIiwgbnVsbCk7CiAgICAgICAgdy5vbigibW91c2Vtb3ZlLmJydXNoIiwgbnVsbCkub24oIm1vdXNldXAuYnJ1c2giLCBudWxsKS5vbigidG91Y2htb3ZlLmJydXNoIiwgbnVsbCkub24oInRvdWNoZW5kLmJydXNoIiwgbnVsbCkub24oImtleWRvd24uYnJ1c2giLCBudWxsKS5vbigia2V5dXAuYnJ1c2giLCBudWxsKTsKICAgICAgICBldmVudF8oewogICAgICAgICAgdHlwZTogImJydXNoZW5kIgogICAgICAgIH0pOwogICAgICAgIGQzX2V2ZW50Q2FuY2VsKCk7CiAgICAgIH0KICAgICAgdmFyIHRhcmdldCA9IHRoaXMsIGV2ZW50VGFyZ2V0ID0gZDMuc2VsZWN0KGQzLmV2ZW50LnRhcmdldCksIGV2ZW50XyA9IGV2ZW50Lm9mKHRhcmdldCwgYXJndW1lbnRzKSwgZyA9IGQzLnNlbGVjdCh0YXJnZXQpLCByZXNpemluZyA9IGV2ZW50VGFyZ2V0LmRhdHVtKCksIHJlc2l6aW5nWCA9ICEvXihufHMpJC8udGVzdChyZXNpemluZykgJiYgeCwgcmVzaXppbmdZID0gIS9eKGV8dykkLy50ZXN0KHJlc2l6aW5nKSAmJiB5LCBkcmFnZ2luZyA9IGV2ZW50VGFyZ2V0LmNsYXNzZWQoImV4dGVudCIpLCBjZW50ZXIsIG9yaWdpbiA9IG1vdXNlKCksIG9mZnNldDsKICAgICAgdmFyIHcgPSBkMy5zZWxlY3Qod2luZG93KS5vbigibW91c2Vtb3ZlLmJydXNoIiwgYnJ1c2htb3ZlKS5vbigibW91c2V1cC5icnVzaCIsIGJydXNoZW5kKS5vbigidG91Y2htb3ZlLmJydXNoIiwgYnJ1c2htb3ZlKS5vbigidG91Y2hlbmQuYnJ1c2giLCBicnVzaGVuZCkub24oImtleWRvd24uYnJ1c2giLCBrZXlkb3duKS5vbigia2V5dXAuYnJ1c2giLCBrZXl1cCk7CiAgICAgIGlmIChkcmFnZ2luZykgewogICAgICAgIG9yaWdpblswXSA9IGV4dGVudFswXVswXSAtIG9yaWdpblswXTsKICAgICAgICBvcmlnaW5bMV0gPSBleHRlbnRbMF1bMV0gLSBvcmlnaW5bMV07CiAgICAgIH0gZWxzZSBpZiAocmVzaXppbmcpIHsKICAgICAgICB2YXIgZXggPSArL3ckLy50ZXN0KHJlc2l6aW5nKSwgZXkgPSArL15uLy50ZXN0KHJlc2l6aW5nKTsKICAgICAgICBvZmZzZXQgPSBbIGV4dGVudFsxIC0gZXhdWzBdIC0gb3JpZ2luWzBdLCBleHRlbnRbMSAtIGV5XVsxXSAtIG9yaWdpblsxXSBdOwogICAgICAgIG9yaWdpblswXSA9IGV4dGVudFtleF1bMF07CiAgICAgICAgb3JpZ2luWzFdID0gZXh0ZW50W2V5XVsxXTsKICAgICAgfSBlbHNlIGlmIChkMy5ldmVudC5hbHRLZXkpIGNlbnRlciA9IG9yaWdpbi5zbGljZSgpOwogICAgICBnLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsICJub25lIikuc2VsZWN0QWxsKCIucmVzaXplIikuc3R5bGUoImRpc3BsYXkiLCBudWxsKTsKICAgICAgZDMuc2VsZWN0KCJib2R5Iikuc3R5bGUoImN1cnNvciIsIGV2ZW50VGFyZ2V0LnN0eWxlKCJjdXJzb3IiKSk7CiAgICAgIGV2ZW50Xyh7CiAgICAgICAgdHlwZTogImJydXNoc3RhcnQiCiAgICAgIH0pOwogICAgICBicnVzaG1vdmUoKTsKICAgICAgZDNfZXZlbnRDYW5jZWwoKTsKICAgIH0KICAgIHZhciBldmVudCA9IGQzX2V2ZW50RGlzcGF0Y2goYnJ1c2gsICJicnVzaHN0YXJ0IiwgImJydXNoIiwgImJydXNoZW5kIiksIHggPSBudWxsLCB5ID0gbnVsbCwgcmVzaXplcyA9IGQzX3N2Z19icnVzaFJlc2l6ZXNbMF0sIGV4dGVudCA9IFsgWyAwLCAwIF0sIFsgMCwgMCBdIF0sIGV4dGVudERvbWFpbjsKICAgIGJydXNoLnggPSBmdW5jdGlvbih6KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHg7CiAgICAgIHggPSB6OwogICAgICByZXNpemVzID0gZDNfc3ZnX2JydXNoUmVzaXplc1sheCA8PCAxIHwgIXldOwogICAgICByZXR1cm4gYnJ1c2g7CiAgICB9OwogICAgYnJ1c2gueSA9IGZ1bmN0aW9uKHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geTsKICAgICAgeSA9IHo7CiAgICAgIHJlc2l6ZXMgPSBkM19zdmdfYnJ1c2hSZXNpemVzWyF4IDw8IDEgfCAheV07CiAgICAgIHJldHVybiBicnVzaDsKICAgIH07CiAgICBicnVzaC5leHRlbnQgPSBmdW5jdGlvbih6KSB7CiAgICAgIHZhciB4MCwgeDEsIHkwLCB5MSwgdDsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgeiA9IGV4dGVudERvbWFpbiB8fCBleHRlbnQ7CiAgICAgICAgaWYgKHgpIHsKICAgICAgICAgIHgwID0gelswXVswXSwgeDEgPSB6WzFdWzBdOwogICAgICAgICAgaWYgKCFleHRlbnREb21haW4pIHsKICAgICAgICAgICAgeDAgPSBleHRlbnRbMF1bMF0sIHgxID0gZXh0ZW50WzFdWzBdOwogICAgICAgICAgICBpZiAoeC5pbnZlcnQpIHgwID0geC5pbnZlcnQoeDApLCB4MSA9IHguaW52ZXJ0KHgxKTsKICAgICAgICAgICAgaWYgKHgxIDwgeDApIHQgPSB4MCwgeDAgPSB4MSwgeDEgPSB0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoeSkgewogICAgICAgICAgeTAgPSB6WzBdWzFdLCB5MSA9IHpbMV1bMV07CiAgICAgICAgICBpZiAoIWV4dGVudERvbWFpbikgewogICAgICAgICAgICB5MCA9IGV4dGVudFswXVsxXSwgeTEgPSBleHRlbnRbMV1bMV07CiAgICAgICAgICAgIGlmICh5LmludmVydCkgeTAgPSB5LmludmVydCh5MCksIHkxID0geS5pbnZlcnQoeTEpOwogICAgICAgICAgICBpZiAoeTEgPCB5MCkgdCA9IHkwLCB5MCA9IHkxLCB5MSA9IHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB4ICYmIHkgPyBbIFsgeDAsIHkwIF0sIFsgeDEsIHkxIF0gXSA6IHggPyBbIHgwLCB4MSBdIDogeSAmJiBbIHkwLCB5MSBdOwogICAgICB9CiAgICAgIGV4dGVudERvbWFpbiA9IFsgWyAwLCAwIF0sIFsgMCwgMCBdIF07CiAgICAgIGlmICh4KSB7CiAgICAgICAgeDAgPSB6WzBdLCB4MSA9IHpbMV07CiAgICAgICAgaWYgKHkpIHgwID0geDBbMF0sIHgxID0geDFbMF07CiAgICAgICAgZXh0ZW50RG9tYWluWzBdWzBdID0geDAsIGV4dGVudERvbWFpblsxXVswXSA9IHgxOwogICAgICAgIGlmICh4LmludmVydCkgeDAgPSB4KHgwKSwgeDEgPSB4KHgxKTsKICAgICAgICBpZiAoeDEgPCB4MCkgdCA9IHgwLCB4MCA9IHgxLCB4MSA9IHQ7CiAgICAgICAgZXh0ZW50WzBdWzBdID0geDAgfCAwLCBleHRlbnRbMV1bMF0gPSB4MSB8IDA7CiAgICAgIH0KICAgICAgaWYgKHkpIHsKICAgICAgICB5MCA9IHpbMF0sIHkxID0gelsxXTsKICAgICAgICBpZiAoeCkgeTAgPSB5MFsxXSwgeTEgPSB5MVsxXTsKICAgICAgICBleHRlbnREb21haW5bMF1bMV0gPSB5MCwgZXh0ZW50RG9tYWluWzFdWzFdID0geTE7CiAgICAgICAgaWYgKHkuaW52ZXJ0KSB5MCA9IHkoeTApLCB5MSA9IHkoeTEpOwogICAgICAgIGlmICh5MSA8IHkwKSB0ID0geTAsIHkwID0geTEsIHkxID0gdDsKICAgICAgICBleHRlbnRbMF1bMV0gPSB5MCB8IDAsIGV4dGVudFsxXVsxXSA9IHkxIHwgMDsKICAgICAgfQogICAgICByZXR1cm4gYnJ1c2g7CiAgICB9OwogICAgYnJ1c2guY2xlYXIgPSBmdW5jdGlvbigpIHsKICAgICAgZXh0ZW50RG9tYWluID0gbnVsbDsKICAgICAgZXh0ZW50WzBdWzBdID0gZXh0ZW50WzBdWzFdID0gZXh0ZW50WzFdWzBdID0gZXh0ZW50WzFdWzFdID0gMDsKICAgICAgcmV0dXJuIGJydXNoOwogICAgfTsKICAgIGJydXNoLmVtcHR5ID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB4ICYmIGV4dGVudFswXVswXSA9PT0gZXh0ZW50WzFdWzBdIHx8IHkgJiYgZXh0ZW50WzBdWzFdID09PSBleHRlbnRbMV1bMV07CiAgICB9OwogICAgcmV0dXJuIGQzLnJlYmluZChicnVzaCwgZXZlbnQsICJvbiIpOwogIH07CiAgdmFyIGQzX3N2Z19icnVzaEN1cnNvciA9IHsKICAgIG46ICJucy1yZXNpemUiLAogICAgZTogImV3LXJlc2l6ZSIsCiAgICBzOiAibnMtcmVzaXplIiwKICAgIHc6ICJldy1yZXNpemUiLAogICAgbnc6ICJud3NlLXJlc2l6ZSIsCiAgICBuZTogIm5lc3ctcmVzaXplIiwKICAgIHNlOiAibndzZS1yZXNpemUiLAogICAgc3c6ICJuZXN3LXJlc2l6ZSIKICB9OwogIHZhciBkM19zdmdfYnJ1c2hSZXNpemVzID0gWyBbICJuIiwgImUiLCAicyIsICJ3IiwgIm53IiwgIm5lIiwgInNlIiwgInN3IiBdLCBbICJlIiwgInciIF0sIFsgIm4iLCAicyIgXSwgW10gXTsKICBkMy5iZWhhdmlvciA9IHt9OwogIGQzLmJlaGF2aW9yLmRyYWcgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGRyYWcoKSB7CiAgICAgIHRoaXMub24oIm1vdXNlZG93bi5kcmFnIiwgbW91c2Vkb3duKS5vbigidG91Y2hzdGFydC5kcmFnIiwgbW91c2Vkb3duKTsKICAgIH0KICAgIGZ1bmN0aW9uIG1vdXNlZG93bigpIHsKICAgICAgZnVuY3Rpb24gcG9pbnQoKSB7CiAgICAgICAgdmFyIHAgPSB0YXJnZXQucGFyZW50Tm9kZTsKICAgICAgICByZXR1cm4gdG91Y2hJZCA\/IGQzLnRvdWNoZXMocCkuZmlsdGVyKGZ1bmN0aW9uKHApIHsKICAgICAgICAgIHJldHVybiBwLmlkZW50aWZpZXIgPT09IHRvdWNoSWQ7CiAgICAgICAgfSlbMF0gOiBkMy5tb3VzZShwKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkcmFnbW92ZSgpIHsKICAgICAgICBpZiAoIXRhcmdldC5wYXJlbnROb2RlKSByZXR1cm4gZHJhZ2VuZCgpOwogICAgICAgIHZhciBwID0gcG9pbnQoKSwgZHggPSBwWzBdIC0gb3JpZ2luX1swXSwgZHkgPSBwWzFdIC0gb3JpZ2luX1sxXTsKICAgICAgICBtb3ZlZCB8PSBkeCB8IGR5OwogICAgICAgIG9yaWdpbl8gPSBwOwogICAgICAgIGQzX2V2ZW50Q2FuY2VsKCk7CiAgICAgICAgZXZlbnRfKHsKICAgICAgICAgIHR5cGU6ICJkcmFnIiwKICAgICAgICAgIHg6IHBbMF0gKyBvZmZzZXRbMF0sCiAgICAgICAgICB5OiBwWzFdICsgb2Zmc2V0WzFdLAogICAgICAgICAgZHg6IGR4LAogICAgICAgICAgZHk6IGR5CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZHJhZ2VuZCgpIHsKICAgICAgICBldmVudF8oewogICAgICAgICAgdHlwZTogImRyYWdlbmQiCiAgICAgICAgfSk7CiAgICAgICAgaWYgKG1vdmVkKSB7CiAgICAgICAgICBkM19ldmVudENhbmNlbCgpOwogICAgICAgICAgaWYgKGQzLmV2ZW50LnRhcmdldCA9PT0gZXZlbnRUYXJnZXQpIHcub24oImNsaWNrLmRyYWciLCBjbGljaywgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIHcub24odG91Y2hJZCA\/ICJ0b3VjaG1vdmUuZHJhZy0iICsgdG91Y2hJZCA6ICJtb3VzZW1vdmUuZHJhZyIsIG51bGwpLm9uKHRvdWNoSWQgPyAidG91Y2hlbmQuZHJhZy0iICsgdG91Y2hJZCA6ICJtb3VzZXVwLmRyYWciLCBudWxsKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjbGljaygpIHsKICAgICAgICBkM19ldmVudENhbmNlbCgpOwogICAgICAgIHcub24oImNsaWNrLmRyYWciLCBudWxsKTsKICAgICAgfQogICAgICB2YXIgdGFyZ2V0ID0gdGhpcywgZXZlbnRfID0gZXZlbnQub2YodGFyZ2V0LCBhcmd1bWVudHMpLCBldmVudFRhcmdldCA9IGQzLmV2ZW50LnRhcmdldCwgdG91Y2hJZCA9IGQzLmV2ZW50LnRvdWNoZXMgJiYgZDMuZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllciwgb2Zmc2V0LCBvcmlnaW5fID0gcG9pbnQoKSwgbW92ZWQgPSAwOwogICAgICB2YXIgdyA9IGQzLnNlbGVjdCh3aW5kb3cpLm9uKHRvdWNoSWQgPyAidG91Y2htb3ZlLmRyYWctIiArIHRvdWNoSWQgOiAibW91c2Vtb3ZlLmRyYWciLCBkcmFnbW92ZSkub24odG91Y2hJZCA\/ICJ0b3VjaGVuZC5kcmFnLSIgKyB0b3VjaElkIDogIm1vdXNldXAuZHJhZyIsIGRyYWdlbmQsIHRydWUpOwogICAgICBpZiAob3JpZ2luKSB7CiAgICAgICAgb2Zmc2V0ID0gb3JpZ2luLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgICAgICBvZmZzZXQgPSBbIG9mZnNldC54IC0gb3JpZ2luX1swXSwgb2Zmc2V0LnkgLSBvcmlnaW5fWzFdIF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2Zmc2V0ID0gWyAwLCAwIF07CiAgICAgIH0KICAgICAgaWYgKCF0b3VjaElkKSBkM19ldmVudENhbmNlbCgpOwogICAgICBldmVudF8oewogICAgICAgIHR5cGU6ICJkcmFnc3RhcnQiCiAgICAgIH0pOwogICAgfQogICAgdmFyIGV2ZW50ID0gZDNfZXZlbnREaXNwYXRjaChkcmFnLCAiZHJhZyIsICJkcmFnc3RhcnQiLCAiZHJhZ2VuZCIpLCBvcmlnaW4gPSBudWxsOwogICAgZHJhZy5vcmlnaW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG9yaWdpbjsKICAgICAgb3JpZ2luID0geDsKICAgICAgcmV0dXJuIGRyYWc7CiAgICB9OwogICAgcmV0dXJuIGQzLnJlYmluZChkcmFnLCBldmVudCwgIm9uIik7CiAgfTsKICBkMy5iZWhhdmlvci56b29tID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiB6b29tKCkgewogICAgICB0aGlzLm9uKCJtb3VzZWRvd24uem9vbSIsIG1vdXNlZG93bikub24oIm1vdXNld2hlZWwuem9vbSIsIG1vdXNld2hlZWwpLm9uKCJtb3VzZW1vdmUuem9vbSIsIG1vdXNlbW92ZSkub24oIkRPTU1vdXNlU2Nyb2xsLnpvb20iLCBtb3VzZXdoZWVsKS5vbigiZGJsY2xpY2suem9vbSIsIGRibGNsaWNrKS5vbigidG91Y2hzdGFydC56b29tIiwgdG91Y2hzdGFydCkub24oInRvdWNobW92ZS56b29tIiwgdG91Y2htb3ZlKS5vbigidG91Y2hlbmQuem9vbSIsIHRvdWNoc3RhcnQpOwogICAgfQogICAgZnVuY3Rpb24gbG9jYXRpb24ocCkgewogICAgICByZXR1cm4gWyAocFswXSAtIHRyYW5zbGF0ZVswXSkgLyBzY2FsZSwgKHBbMV0gLSB0cmFuc2xhdGVbMV0pIC8gc2NhbGUgXTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvaW50KGwpIHsKICAgICAgcmV0dXJuIFsgbFswXSAqIHNjYWxlICsgdHJhbnNsYXRlWzBdLCBsWzFdICogc2NhbGUgKyB0cmFuc2xhdGVbMV0gXTsKICAgIH0KICAgIGZ1bmN0aW9uIHNjYWxlVG8ocykgewogICAgICBzY2FsZSA9IE1hdGgubWF4KHNjYWxlRXh0ZW50WzBdLCBNYXRoLm1pbihzY2FsZUV4dGVudFsxXSwgcykpOwogICAgfQogICAgZnVuY3Rpb24gdHJhbnNsYXRlVG8ocCwgbCkgewogICAgICBsID0gcG9pbnQobCk7CiAgICAgIHRyYW5zbGF0ZVswXSArPSBwWzBdIC0gbFswXTsKICAgICAgdHJhbnNsYXRlWzFdICs9IHBbMV0gLSBsWzFdOwogICAgfQogICAgZnVuY3Rpb24gZGlzcGF0Y2goZXZlbnQpIHsKICAgICAgaWYgKHgxKSB4MS5kb21haW4oeDAucmFuZ2UoKS5tYXAoZnVuY3Rpb24oeCkgewogICAgICAgIHJldHVybiAoeCAtIHRyYW5zbGF0ZVswXSkgLyBzY2FsZTsKICAgICAgfSkubWFwKHgwLmludmVydCkpOwogICAgICBpZiAoeTEpIHkxLmRvbWFpbih5MC5yYW5nZSgpLm1hcChmdW5jdGlvbih5KSB7CiAgICAgICAgcmV0dXJuICh5IC0gdHJhbnNsYXRlWzFdKSAvIHNjYWxlOwogICAgICB9KS5tYXAoeTAuaW52ZXJ0KSk7CiAgICAgIGQzLmV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2ZW50KHsKICAgICAgICB0eXBlOiAiem9vbSIsCiAgICAgICAgc2NhbGU6IHNjYWxlLAogICAgICAgIHRyYW5zbGF0ZTogdHJhbnNsYXRlCiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gbW91c2Vkb3duKCkgewogICAgICBmdW5jdGlvbiBtb3VzZW1vdmUoKSB7CiAgICAgICAgbW92ZWQgPSAxOwogICAgICAgIHRyYW5zbGF0ZVRvKGQzLm1vdXNlKHRhcmdldCksIGwpOwogICAgICAgIGRpc3BhdGNoKGV2ZW50Xyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbW91c2V1cCgpIHsKICAgICAgICBpZiAobW92ZWQpIGQzX2V2ZW50Q2FuY2VsKCk7CiAgICAgICAgdy5vbigibW91c2Vtb3ZlLnpvb20iLCBudWxsKS5vbigibW91c2V1cC56b29tIiwgbnVsbCk7CiAgICAgICAgaWYgKG1vdmVkICYmIGQzLmV2ZW50LnRhcmdldCA9PT0gZXZlbnRUYXJnZXQpIHcub24oImNsaWNrLnpvb20iLCBjbGljaywgdHJ1ZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2xpY2soKSB7CiAgICAgICAgZDNfZXZlbnRDYW5jZWwoKTsKICAgICAgICB3Lm9uKCJjbGljay56b29tIiwgbnVsbCk7CiAgICAgIH0KICAgICAgdmFyIHRhcmdldCA9IHRoaXMsIGV2ZW50XyA9IGV2ZW50Lm9mKHRhcmdldCwgYXJndW1lbnRzKSwgZXZlbnRUYXJnZXQgPSBkMy5ldmVudC50YXJnZXQsIG1vdmVkID0gMCwgdyA9IGQzLnNlbGVjdCh3aW5kb3cpLm9uKCJtb3VzZW1vdmUuem9vbSIsIG1vdXNlbW92ZSkub24oIm1vdXNldXAuem9vbSIsIG1vdXNldXApLCBsID0gbG9jYXRpb24oZDMubW91c2UodGFyZ2V0KSk7CiAgICAgIHdpbmRvdy5mb2N1cygpOwogICAgICBkM19ldmVudENhbmNlbCgpOwogICAgfQogICAgZnVuY3Rpb24gbW91c2V3aGVlbCgpIHsKICAgICAgaWYgKCF0cmFuc2xhdGUwKSB0cmFuc2xhdGUwID0gbG9jYXRpb24oZDMubW91c2UodGhpcykpOwogICAgICBzY2FsZVRvKE1hdGgucG93KDIsIGQzX2JlaGF2aW9yX3pvb21EZWx0YSgpICogLjAwMikgKiBzY2FsZSk7CiAgICAgIHRyYW5zbGF0ZVRvKGQzLm1vdXNlKHRoaXMpLCB0cmFuc2xhdGUwKTsKICAgICAgZGlzcGF0Y2goZXZlbnQub2YodGhpcywgYXJndW1lbnRzKSk7CiAgICB9CiAgICBmdW5jdGlvbiBtb3VzZW1vdmUoKSB7CiAgICAgIHRyYW5zbGF0ZTAgPSBudWxsOwogICAgfQogICAgZnVuY3Rpb24gZGJsY2xpY2soKSB7CiAgICAgIHZhciBwID0gZDMubW91c2UodGhpcyksIGwgPSBsb2NhdGlvbihwKTsKICAgICAgc2NhbGVUbyhkMy5ldmVudC5zaGlmdEtleSA\/IHNjYWxlIC8gMiA6IHNjYWxlICogMik7CiAgICAgIHRyYW5zbGF0ZVRvKHAsIGwpOwogICAgICBkaXNwYXRjaChldmVudC5vZih0aGlzLCBhcmd1bWVudHMpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHRvdWNoc3RhcnQoKSB7CiAgICAgIHZhciB0b3VjaGVzID0gZDMudG91Y2hlcyh0aGlzKSwgbm93ID0gRGF0ZS5ub3coKTsKICAgICAgc2NhbGUwID0gc2NhbGU7CiAgICAgIHRyYW5zbGF0ZTAgPSB7fTsKICAgICAgdG91Y2hlcy5mb3JFYWNoKGZ1bmN0aW9uKHQpIHsKICAgICAgICB0cmFuc2xhdGUwW3QuaWRlbnRpZmllcl0gPSBsb2NhdGlvbih0KTsKICAgICAgfSk7CiAgICAgIGQzX2V2ZW50Q2FuY2VsKCk7CiAgICAgIGlmICh0b3VjaGVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgIGlmIChub3cgLSB0b3VjaHRpbWUgPCA1MDApIHsKICAgICAgICAgIHZhciBwID0gdG91Y2hlc1swXSwgbCA9IGxvY2F0aW9uKHRvdWNoZXNbMF0pOwogICAgICAgICAgc2NhbGVUbyhzY2FsZSAqIDIpOwogICAgICAgICAgdHJhbnNsYXRlVG8ocCwgbCk7CiAgICAgICAgICBkaXNwYXRjaChldmVudC5vZih0aGlzLCBhcmd1bWVudHMpKTsKICAgICAgICB9CiAgICAgICAgdG91Y2h0aW1lID0gbm93OwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB0b3VjaG1vdmUoKSB7CiAgICAgIHZhciB0b3VjaGVzID0gZDMudG91Y2hlcyh0aGlzKSwgcDAgPSB0b3VjaGVzWzBdLCBsMCA9IHRyYW5zbGF0ZTBbcDAuaWRlbnRpZmllcl07CiAgICAgIGlmIChwMSA9IHRvdWNoZXNbMV0pIHsKICAgICAgICB2YXIgcDEsIGwxID0gdHJhbnNsYXRlMFtwMS5pZGVudGlmaWVyXTsKICAgICAgICBwMCA9IFsgKHAwWzBdICsgcDFbMF0pIC8gMiwgKHAwWzFdICsgcDFbMV0pIC8gMiBdOwogICAgICAgIGwwID0gWyAobDBbMF0gKyBsMVswXSkgLyAyLCAobDBbMV0gKyBsMVsxXSkgLyAyIF07CiAgICAgICAgc2NhbGVUbyhkMy5ldmVudC5zY2FsZSAqIHNjYWxlMCk7CiAgICAgIH0KICAgICAgdHJhbnNsYXRlVG8ocDAsIGwwKTsKICAgICAgdG91Y2h0aW1lID0gbnVsbDsKICAgICAgZGlzcGF0Y2goZXZlbnQub2YodGhpcywgYXJndW1lbnRzKSk7CiAgICB9CiAgICB2YXIgdHJhbnNsYXRlID0gWyAwLCAwIF0sIHRyYW5zbGF0ZTAsIHNjYWxlID0gMSwgc2NhbGUwLCBzY2FsZUV4dGVudCA9IGQzX2JlaGF2aW9yX3pvb21JbmZpbml0eSwgZXZlbnQgPSBkM19ldmVudERpc3BhdGNoKHpvb20sICJ6b29tIiksIHgwLCB4MSwgeTAsIHkxLCB0b3VjaHRpbWU7CiAgICB6b29tLnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdHJhbnNsYXRlOwogICAgICB0cmFuc2xhdGUgPSB4Lm1hcChOdW1iZXIpOwogICAgICByZXR1cm4gem9vbTsKICAgIH07CiAgICB6b29tLnNjYWxlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzY2FsZTsKICAgICAgc2NhbGUgPSAreDsKICAgICAgcmV0dXJuIHpvb207CiAgICB9OwogICAgem9vbS5zY2FsZUV4dGVudCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2NhbGVFeHRlbnQ7CiAgICAgIHNjYWxlRXh0ZW50ID0geCA9PSBudWxsID8gZDNfYmVoYXZpb3Jfem9vbUluZmluaXR5IDogeC5tYXAoTnVtYmVyKTsKICAgICAgcmV0dXJuIHpvb207CiAgICB9OwogICAgem9vbS54ID0gZnVuY3Rpb24oeikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB4MTsKICAgICAgeDEgPSB6OwogICAgICB4MCA9IHouY29weSgpOwogICAgICByZXR1cm4gem9vbTsKICAgIH07CiAgICB6b29tLnkgPSBmdW5jdGlvbih6KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHkxOwogICAgICB5MSA9IHo7CiAgICAgIHkwID0gei5jb3B5KCk7CiAgICAgIHJldHVybiB6b29tOwogICAgfTsKICAgIHJldHVybiBkMy5yZWJpbmQoem9vbSwgZXZlbnQsICJvbiIpOwogIH07CiAgdmFyIGQzX2JlaGF2aW9yX3pvb21EaXYsIGQzX2JlaGF2aW9yX3pvb21JbmZpbml0eSA9IFsgMCwgSW5maW5pdHkgXTsKICBkMy5sYXlvdXQgPSB7fTsKICBkMy5sYXlvdXQuYnVuZGxlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gZnVuY3Rpb24obGlua3MpIHsKICAgICAgdmFyIHBhdGhzID0gW10sIGkgPSAtMSwgbiA9IGxpbmtzLmxlbmd0aDsKICAgICAgd2hpbGUgKCsraSA8IG4pIHBhdGhzLnB1c2goZDNfbGF5b3V0X2J1bmRsZVBhdGgobGlua3NbaV0pKTsKICAgICAgcmV0dXJuIHBhdGhzOwogICAgfTsKICB9OwogIGQzLmxheW91dC5jaG9yZCA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gcmVsYXlvdXQoKSB7CiAgICAgIHZhciBzdWJncm91cHMgPSB7fSwgZ3JvdXBTdW1zID0gW10sIGdyb3VwSW5kZXggPSBkMy5yYW5nZShuKSwgc3ViZ3JvdXBJbmRleCA9IFtdLCBrLCB4LCB4MCwgaSwgajsKICAgICAgY2hvcmRzID0gW107CiAgICAgIGdyb3VwcyA9IFtdOwogICAgICBrID0gMCwgaSA9IC0xOwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIHggPSAwLCBqID0gLTE7CiAgICAgICAgd2hpbGUgKCsraiA8IG4pIHsKICAgICAgICAgIHggKz0gbWF0cml4W2ldW2pdOwogICAgICAgIH0KICAgICAgICBncm91cFN1bXMucHVzaCh4KTsKICAgICAgICBzdWJncm91cEluZGV4LnB1c2goZDMucmFuZ2UobikpOwogICAgICAgIGsgKz0geDsKICAgICAgfQogICAgICBpZiAoc29ydEdyb3VwcykgewogICAgICAgIGdyb3VwSW5kZXguc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICByZXR1cm4gc29ydEdyb3Vwcyhncm91cFN1bXNbYV0sIGdyb3VwU3Vtc1tiXSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKHNvcnRTdWJncm91cHMpIHsKICAgICAgICBzdWJncm91cEluZGV4LmZvckVhY2goZnVuY3Rpb24oZCwgaSkgewogICAgICAgICAgZC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIHNvcnRTdWJncm91cHMobWF0cml4W2ldW2FdLCBtYXRyaXhbaV1bYl0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgayA9ICgyICogTWF0aC5QSSAtIHBhZGRpbmcgKiBuKSAvIGs7CiAgICAgIHggPSAwLCBpID0gLTE7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgeDAgPSB4LCBqID0gLTE7CiAgICAgICAgd2hpbGUgKCsraiA8IG4pIHsKICAgICAgICAgIHZhciBkaSA9IGdyb3VwSW5kZXhbaV0sIGRqID0gc3ViZ3JvdXBJbmRleFtkaV1bal0sIHYgPSBtYXRyaXhbZGldW2RqXSwgYTAgPSB4LCBhMSA9IHggKz0gdiAqIGs7CiAgICAgICAgICBzdWJncm91cHNbZGkgKyAiLSIgKyBkal0gPSB7CiAgICAgICAgICAgIGluZGV4OiBkaSwKICAgICAgICAgICAgc3ViaW5kZXg6IGRqLAogICAgICAgICAgICBzdGFydEFuZ2xlOiBhMCwKICAgICAgICAgICAgZW5kQW5nbGU6IGExLAogICAgICAgICAgICB2YWx1ZTogdgogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZ3JvdXBzW2RpXSA9IHsKICAgICAgICAgIGluZGV4OiBkaSwKICAgICAgICAgIHN0YXJ0QW5nbGU6IHgwLAogICAgICAgICAgZW5kQW5nbGU6IHgsCiAgICAgICAgICB2YWx1ZTogKHggLSB4MCkgLyBrCiAgICAgICAgfTsKICAgICAgICB4ICs9IHBhZGRpbmc7CiAgICAgIH0KICAgICAgaSA9IC0xOwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIGogPSBpIC0gMTsKICAgICAgICB3aGlsZSAoKytqIDwgbikgewogICAgICAgICAgdmFyIHNvdXJjZSA9IHN1Ymdyb3Vwc1tpICsgIi0iICsgal0sIHRhcmdldCA9IHN1Ymdyb3Vwc1tqICsgIi0iICsgaV07CiAgICAgICAgICBpZiAoc291cmNlLnZhbHVlIHx8IHRhcmdldC52YWx1ZSkgewogICAgICAgICAgICBjaG9yZHMucHVzaChzb3VyY2UudmFsdWUgPCB0YXJnZXQudmFsdWUgPyB7CiAgICAgICAgICAgICAgc291cmNlOiB0YXJnZXQsCiAgICAgICAgICAgICAgdGFyZ2V0OiBzb3VyY2UKICAgICAgICAgICAgfSA6IHsKICAgICAgICAgICAgICBzb3VyY2U6IHNvdXJjZSwKICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHNvcnRDaG9yZHMpIHJlc29ydCgpOwogICAgfQogICAgZnVuY3Rpb24gcmVzb3J0KCkgewogICAgICBjaG9yZHMuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIHNvcnRDaG9yZHMoKGEuc291cmNlLnZhbHVlICsgYS50YXJnZXQudmFsdWUpIC8gMiwgKGIuc291cmNlLnZhbHVlICsgYi50YXJnZXQudmFsdWUpIC8gMik7CiAgICAgIH0pOwogICAgfQogICAgdmFyIGNob3JkID0ge30sIGNob3JkcywgZ3JvdXBzLCBtYXRyaXgsIG4sIHBhZGRpbmcgPSAwLCBzb3J0R3JvdXBzLCBzb3J0U3ViZ3JvdXBzLCBzb3J0Q2hvcmRzOwogICAgY2hvcmQubWF0cml4ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBtYXRyaXg7CiAgICAgIG4gPSAobWF0cml4ID0geCkgJiYgbWF0cml4Lmxlbmd0aDsKICAgICAgY2hvcmRzID0gZ3JvdXBzID0gbnVsbDsKICAgICAgcmV0dXJuIGNob3JkOwogICAgfTsKICAgIGNob3JkLnBhZGRpbmcgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHBhZGRpbmc7CiAgICAgIHBhZGRpbmcgPSB4OwogICAgICBjaG9yZHMgPSBncm91cHMgPSBudWxsOwogICAgICByZXR1cm4gY2hvcmQ7CiAgICB9OwogICAgY2hvcmQuc29ydEdyb3VwcyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc29ydEdyb3VwczsKICAgICAgc29ydEdyb3VwcyA9IHg7CiAgICAgIGNob3JkcyA9IGdyb3VwcyA9IG51bGw7CiAgICAgIHJldHVybiBjaG9yZDsKICAgIH07CiAgICBjaG9yZC5zb3J0U3ViZ3JvdXBzID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzb3J0U3ViZ3JvdXBzOwogICAgICBzb3J0U3ViZ3JvdXBzID0geDsKICAgICAgY2hvcmRzID0gbnVsbDsKICAgICAgcmV0dXJuIGNob3JkOwogICAgfTsKICAgIGNob3JkLnNvcnRDaG9yZHMgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNvcnRDaG9yZHM7CiAgICAgIHNvcnRDaG9yZHMgPSB4OwogICAgICBpZiAoY2hvcmRzKSByZXNvcnQoKTsKICAgICAgcmV0dXJuIGNob3JkOwogICAgfTsKICAgIGNob3JkLmNob3JkcyA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIWNob3JkcykgcmVsYXlvdXQoKTsKICAgICAgcmV0dXJuIGNob3JkczsKICAgIH07CiAgICBjaG9yZC5ncm91cHMgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCFncm91cHMpIHJlbGF5b3V0KCk7CiAgICAgIHJldHVybiBncm91cHM7CiAgICB9OwogICAgcmV0dXJuIGNob3JkOwogIH07CiAgZDMubGF5b3V0LmZvcmNlID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiByZXB1bHNlKG5vZGUpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKHF1YWQsIHgxLCB5MSwgeDIsIHkyKSB7CiAgICAgICAgaWYgKHF1YWQucG9pbnQgIT09IG5vZGUpIHsKICAgICAgICAgIHZhciBkeCA9IHF1YWQuY3ggLSBub2RlLngsIGR5ID0gcXVhZC5jeSAtIG5vZGUueSwgZG4gPSAxIC8gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgIGlmICgoeDIgLSB4MSkgKiBkbiA8IHRoZXRhKSB7CiAgICAgICAgICAgIHZhciBrID0gcXVhZC5jaGFyZ2UgKiBkbiAqIGRuOwogICAgICAgICAgICBub2RlLnB4IC09IGR4ICogazsKICAgICAgICAgICAgbm9kZS5weSAtPSBkeSAqIGs7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHF1YWQucG9pbnQgJiYgaXNGaW5pdGUoZG4pKSB7CiAgICAgICAgICAgIHZhciBrID0gcXVhZC5wb2ludENoYXJnZSAqIGRuICogZG47CiAgICAgICAgICAgIG5vZGUucHggLT0gZHggKiBrOwogICAgICAgICAgICBub2RlLnB5IC09IGR5ICogazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICFxdWFkLmNoYXJnZTsKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGRyYWdtb3ZlKGQpIHsKICAgICAgZC5weCA9IGQzLmV2ZW50Lng7CiAgICAgIGQucHkgPSBkMy5ldmVudC55OwogICAgICBmb3JjZS5yZXN1bWUoKTsKICAgIH0KICAgIHZhciBmb3JjZSA9IHt9LCBldmVudCA9IGQzLmRpc3BhdGNoKCJzdGFydCIsICJ0aWNrIiwgImVuZCIpLCBzaXplID0gWyAxLCAxIF0sIGRyYWcsIGFscGhhLCBmcmljdGlvbiA9IC45LCBsaW5rRGlzdGFuY2UgPSBkM19sYXlvdXRfZm9yY2VMaW5rRGlzdGFuY2UsIGxpbmtTdHJlbmd0aCA9IGQzX2xheW91dF9mb3JjZUxpbmtTdHJlbmd0aCwgY2hhcmdlID0gLTMwLCBncmF2aXR5ID0gLjEsIHRoZXRhID0gLjgsIGludGVydmFsLCBub2RlcyA9IFtdLCBsaW5rcyA9IFtdLCBkaXN0YW5jZXMsIHN0cmVuZ3RocywgY2hhcmdlczsKICAgIGZvcmNlLnRpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKChhbHBoYSAqPSAuOTkpIDwgLjAwNSkgewogICAgICAgIGV2ZW50LmVuZCh7CiAgICAgICAgICB0eXBlOiAiZW5kIiwKICAgICAgICAgIGFscGhhOiBhbHBoYSA9IDAKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICB2YXIgbiA9IG5vZGVzLmxlbmd0aCwgbSA9IGxpbmtzLmxlbmd0aCwgcSwgaSwgbywgcywgdCwgbCwgaywgeCwgeTsKICAgICAgZm9yIChpID0gMDsgaSA8IG07ICsraSkgewogICAgICAgIG8gPSBsaW5rc1tpXTsKICAgICAgICBzID0gby5zb3VyY2U7CiAgICAgICAgdCA9IG8udGFyZ2V0OwogICAgICAgIHggPSB0LnggLSBzLng7CiAgICAgICAgeSA9IHQueSAtIHMueTsKICAgICAgICBpZiAobCA9IHggKiB4ICsgeSAqIHkpIHsKICAgICAgICAgIGwgPSBhbHBoYSAqIHN0cmVuZ3Roc1tpXSAqICgobCA9IE1hdGguc3FydChsKSkgLSBkaXN0YW5jZXNbaV0pIC8gbDsKICAgICAgICAgIHggKj0gbDsKICAgICAgICAgIHkgKj0gbDsKICAgICAgICAgIHQueCAtPSB4ICogKGsgPSBzLndlaWdodCAvICh0LndlaWdodCArIHMud2VpZ2h0KSk7CiAgICAgICAgICB0LnkgLT0geSAqIGs7CiAgICAgICAgICBzLnggKz0geCAqIChrID0gMSAtIGspOwogICAgICAgICAgcy55ICs9IHkgKiBrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoayA9IGFscGhhICogZ3Jhdml0eSkgewogICAgICAgIHggPSBzaXplWzBdIC8gMjsKICAgICAgICB5ID0gc2l6ZVsxXSAvIDI7CiAgICAgICAgaSA9IC0xOwogICAgICAgIGlmIChrKSB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgbyA9IG5vZGVzW2ldOwogICAgICAgICAgby54ICs9ICh4IC0gby54KSAqIGs7CiAgICAgICAgICBvLnkgKz0gKHkgLSBvLnkpICogazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGNoYXJnZSkgewogICAgICAgIGQzX2xheW91dF9mb3JjZUFjY3VtdWxhdGUocSA9IGQzLmdlb20ucXVhZHRyZWUobm9kZXMpLCBhbHBoYSwgY2hhcmdlcyk7CiAgICAgICAgaSA9IC0xOwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICBpZiAoIShvID0gbm9kZXNbaV0pLmZpeGVkKSB7CiAgICAgICAgICAgIHEudmlzaXQocmVwdWxzZShvKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGkgPSAtMTsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBvID0gbm9kZXNbaV07CiAgICAgICAgaWYgKG8uZml4ZWQpIHsKICAgICAgICAgIG8ueCA9IG8ucHg7CiAgICAgICAgICBvLnkgPSBvLnB5OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvLnggLT0gKG8ucHggLSAoby5weCA9IG8ueCkpICogZnJpY3Rpb247CiAgICAgICAgICBvLnkgLT0gKG8ucHkgLSAoby5weSA9IG8ueSkpICogZnJpY3Rpb247CiAgICAgICAgfQogICAgICB9CiAgICAgIGV2ZW50LnRpY2soewogICAgICAgIHR5cGU6ICJ0aWNrIiwKICAgICAgICBhbHBoYTogYWxwaGEKICAgICAgfSk7CiAgICB9OwogICAgZm9yY2Uubm9kZXMgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG5vZGVzOwogICAgICBub2RlcyA9IHg7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5saW5rcyA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbGlua3M7CiAgICAgIGxpbmtzID0geDsKICAgICAgcmV0dXJuIGZvcmNlOwogICAgfTsKICAgIGZvcmNlLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNpemU7CiAgICAgIHNpemUgPSB4OwogICAgICByZXR1cm4gZm9yY2U7CiAgICB9OwogICAgZm9yY2UubGlua0Rpc3RhbmNlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBsaW5rRGlzdGFuY2U7CiAgICAgIGxpbmtEaXN0YW5jZSA9IGQzX2Z1bmN0b3IoeCk7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5kaXN0YW5jZSA9IGZvcmNlLmxpbmtEaXN0YW5jZTsKICAgIGZvcmNlLmxpbmtTdHJlbmd0aCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbGlua1N0cmVuZ3RoOwogICAgICBsaW5rU3RyZW5ndGggPSBkM19mdW5jdG9yKHgpOwogICAgICByZXR1cm4gZm9yY2U7CiAgICB9OwogICAgZm9yY2UuZnJpY3Rpb24gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGZyaWN0aW9uOwogICAgICBmcmljdGlvbiA9IHg7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5jaGFyZ2UgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGNoYXJnZTsKICAgICAgY2hhcmdlID0gdHlwZW9mIHggPT09ICJmdW5jdGlvbiIgPyB4IDogK3g7CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5ncmF2aXR5ID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBncmF2aXR5OwogICAgICBncmF2aXR5ID0geDsKICAgICAgcmV0dXJuIGZvcmNlOwogICAgfTsKICAgIGZvcmNlLnRoZXRhID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0aGV0YTsKICAgICAgdGhldGEgPSB4OwogICAgICByZXR1cm4gZm9yY2U7CiAgICB9OwogICAgZm9yY2UuYWxwaGEgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGFscGhhOwogICAgICBpZiAoYWxwaGEpIHsKICAgICAgICBpZiAoeCA+IDApIGFscGhhID0geDsgZWxzZSBhbHBoYSA9IDA7CiAgICAgIH0gZWxzZSBpZiAoeCA+IDApIHsKICAgICAgICBldmVudC5zdGFydCh7CiAgICAgICAgICB0eXBlOiAic3RhcnQiLAogICAgICAgICAgYWxwaGE6IGFscGhhID0geAogICAgICAgIH0pOwogICAgICAgIGQzLnRpbWVyKGZvcmNlLnRpY2spOwogICAgICB9CiAgICAgIHJldHVybiBmb3JjZTsKICAgIH07CiAgICBmb3JjZS5zdGFydCA9IGZ1bmN0aW9uKCkgewogICAgICBmdW5jdGlvbiBwb3NpdGlvbihkaW1lbnNpb24sIHNpemUpIHsKICAgICAgICB2YXIgbmVpZ2hib3JzID0gbmVpZ2hib3IoaSksIGogPSAtMSwgbSA9IG5laWdoYm9ycy5sZW5ndGgsIHg7CiAgICAgICAgd2hpbGUgKCsraiA8IG0pIGlmICghaXNOYU4oeCA9IG5laWdoYm9yc1tqXVtkaW1lbnNpb25dKSkgcmV0dXJuIHg7CiAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgKiBzaXplOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG5laWdoYm9yKCkgewogICAgICAgIGlmICghbmVpZ2hib3JzKSB7CiAgICAgICAgICBuZWlnaGJvcnMgPSBbXTsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBuOyArK2opIHsKICAgICAgICAgICAgbmVpZ2hib3JzW2pdID0gW107CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICAgICAgICAgIHZhciBvID0gbGlua3Nbal07CiAgICAgICAgICAgIG5laWdoYm9yc1tvLnNvdXJjZS5pbmRleF0ucHVzaChvLnRhcmdldCk7CiAgICAgICAgICAgIG5laWdoYm9yc1tvLnRhcmdldC5pbmRleF0ucHVzaChvLnNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZWlnaGJvcnNbaV07CiAgICAgIH0KICAgICAgdmFyIGksIGosIG4gPSBub2Rlcy5sZW5ndGgsIG0gPSBsaW5rcy5sZW5ndGgsIHcgPSBzaXplWzBdLCBoID0gc2l6ZVsxXSwgbmVpZ2hib3JzLCBvOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgICAgKG8gPSBub2Rlc1tpXSkuaW5kZXggPSBpOwogICAgICAgIG8ud2VpZ2h0ID0gMDsKICAgICAgfQogICAgICBkaXN0YW5jZXMgPSBbXTsKICAgICAgc3RyZW5ndGhzID0gW107CiAgICAgIGZvciAoaSA9IDA7IGkgPCBtOyArK2kpIHsKICAgICAgICBvID0gbGlua3NbaV07CiAgICAgICAgaWYgKHR5cGVvZiBvLnNvdXJjZSA9PSAibnVtYmVyIikgby5zb3VyY2UgPSBub2Rlc1tvLnNvdXJjZV07CiAgICAgICAgaWYgKHR5cGVvZiBvLnRhcmdldCA9PSAibnVtYmVyIikgby50YXJnZXQgPSBub2Rlc1tvLnRhcmdldF07CiAgICAgICAgZGlzdGFuY2VzW2ldID0gbGlua0Rpc3RhbmNlLmNhbGwodGhpcywgbywgaSk7CiAgICAgICAgc3RyZW5ndGhzW2ldID0gbGlua1N0cmVuZ3RoLmNhbGwodGhpcywgbywgaSk7CiAgICAgICAgKytvLnNvdXJjZS53ZWlnaHQ7CiAgICAgICAgKytvLnRhcmdldC53ZWlnaHQ7CiAgICAgIH0KICAgICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICAgIG8gPSBub2Rlc1tpXTsKICAgICAgICBpZiAoaXNOYU4oby54KSkgby54ID0gcG9zaXRpb24oIngiLCB3KTsKICAgICAgICBpZiAoaXNOYU4oby55KSkgby55ID0gcG9zaXRpb24oInkiLCBoKTsKICAgICAgICBpZiAoaXNOYU4oby5weCkpIG8ucHggPSBvLng7CiAgICAgICAgaWYgKGlzTmFOKG8ucHkpKSBvLnB5ID0gby55OwogICAgICB9CiAgICAgIGNoYXJnZXMgPSBbXTsKICAgICAgaWYgKHR5cGVvZiBjaGFyZ2UgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgICAgICBjaGFyZ2VzW2ldID0gK2NoYXJnZS5jYWxsKHRoaXMsIG5vZGVzW2ldLCBpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IG47ICsraSkgewogICAgICAgICAgY2hhcmdlc1tpXSA9IGNoYXJnZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZvcmNlLnJlc3VtZSgpOwogICAgfTsKICAgIGZvcmNlLnJlc3VtZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZm9yY2UuYWxwaGEoLjEpOwogICAgfTsKICAgIGZvcmNlLnN0b3AgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGZvcmNlLmFscGhhKDApOwogICAgfTsKICAgIGZvcmNlLmRyYWcgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCFkcmFnKSBkcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpLm9yaWdpbihkM19pZGVudGl0eSkub24oImRyYWdzdGFydCIsIGQzX2xheW91dF9mb3JjZURyYWdzdGFydCkub24oImRyYWciLCBkcmFnbW92ZSkub24oImRyYWdlbmQiLCBkM19sYXlvdXRfZm9yY2VEcmFnZW5kKTsKICAgICAgdGhpcy5vbigibW91c2VvdmVyLmZvcmNlIiwgZDNfbGF5b3V0X2ZvcmNlTW91c2VvdmVyKS5vbigibW91c2VvdXQuZm9yY2UiLCBkM19sYXlvdXRfZm9yY2VNb3VzZW91dCkuY2FsbChkcmFnKTsKICAgIH07CiAgICByZXR1cm4gZDMucmViaW5kKGZvcmNlLCBldmVudCwgIm9uIik7CiAgfTsKICBkMy5sYXlvdXQucGFydGl0aW9uID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBwb3NpdGlvbihub2RlLCB4LCBkeCwgZHkpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgICAgbm9kZS54ID0geDsKICAgICAgbm9kZS55ID0gbm9kZS5kZXB0aCAqIGR5OwogICAgICBub2RlLmR4ID0gZHg7CiAgICAgIG5vZGUuZHkgPSBkeTsKICAgICAgaWYgKGNoaWxkcmVuICYmIChuID0gY2hpbGRyZW4ubGVuZ3RoKSkgewogICAgICAgIHZhciBpID0gLTEsIG4sIGMsIGQ7CiAgICAgICAgZHggPSBub2RlLnZhbHVlID8gZHggLyBub2RlLnZhbHVlIDogMDsKICAgICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgcG9zaXRpb24oYyA9IGNoaWxkcmVuW2ldLCB4LCBkID0gYy52YWx1ZSAqIGR4LCBkeSk7CiAgICAgICAgICB4ICs9IGQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBkZXB0aChub2RlKSB7CiAgICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW4sIGQgPSAwOwogICAgICBpZiAoY2hpbGRyZW4gJiYgKG4gPSBjaGlsZHJlbi5sZW5ndGgpKSB7CiAgICAgICAgdmFyIGkgPSAtMSwgbjsKICAgICAgICB3aGlsZSAoKytpIDwgbikgZCA9IE1hdGgubWF4KGQsIGRlcHRoKGNoaWxkcmVuW2ldKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIDEgKyBkOwogICAgfQogICAgZnVuY3Rpb24gcGFydGl0aW9uKGQsIGkpIHsKICAgICAgdmFyIG5vZGVzID0gaGllcmFyY2h5LmNhbGwodGhpcywgZCwgaSk7CiAgICAgIHBvc2l0aW9uKG5vZGVzWzBdLCAwLCBzaXplWzBdLCBzaXplWzFdIC8gZGVwdGgobm9kZXNbMF0pKTsKICAgICAgcmV0dXJuIG5vZGVzOwogICAgfQogICAgdmFyIGhpZXJhcmNoeSA9IGQzLmxheW91dC5oaWVyYXJjaHkoKSwgc2l6ZSA9IFsgMSwgMSBdOwogICAgcGFydGl0aW9uLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNpemU7CiAgICAgIHNpemUgPSB4OwogICAgICByZXR1cm4gcGFydGl0aW9uOwogICAgfTsKICAgIHJldHVybiBkM19sYXlvdXRfaGllcmFyY2h5UmViaW5kKHBhcnRpdGlvbiwgaGllcmFyY2h5KTsKICB9OwogIGQzLmxheW91dC5waWUgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIHBpZShkYXRhLCBpKSB7CiAgICAgIHZhciB2YWx1ZXMgPSBkYXRhLm1hcChmdW5jdGlvbihkLCBpKSB7CiAgICAgICAgcmV0dXJuICt2YWx1ZS5jYWxsKHBpZSwgZCwgaSk7CiAgICAgIH0pOwogICAgICB2YXIgYSA9ICsodHlwZW9mIHN0YXJ0QW5nbGUgPT09ICJmdW5jdGlvbiIgPyBzdGFydEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBzdGFydEFuZ2xlKTsKICAgICAgdmFyIGsgPSAoKHR5cGVvZiBlbmRBbmdsZSA9PT0gImZ1bmN0aW9uIiA\/IGVuZEFuZ2xlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBlbmRBbmdsZSkgLSBzdGFydEFuZ2xlKSAvIGQzLnN1bSh2YWx1ZXMpOwogICAgICB2YXIgaW5kZXggPSBkMy5yYW5nZShkYXRhLmxlbmd0aCk7CiAgICAgIGlmIChzb3J0ICE9IG51bGwpIGluZGV4LnNvcnQoc29ydCA9PT0gZDNfbGF5b3V0X3BpZVNvcnRCeVZhbHVlID8gZnVuY3Rpb24oaSwgaikgewogICAgICAgIHJldHVybiB2YWx1ZXNbal0gLSB2YWx1ZXNbaV07CiAgICAgIH0gOiBmdW5jdGlvbihpLCBqKSB7CiAgICAgICAgcmV0dXJuIHNvcnQoZGF0YVtpXSwgZGF0YVtqXSk7CiAgICAgIH0pOwogICAgICB2YXIgYXJjcyA9IFtdOwogICAgICBpbmRleC5mb3JFYWNoKGZ1bmN0aW9uKGkpIHsKICAgICAgICB2YXIgZDsKICAgICAgICBhcmNzW2ldID0gewogICAgICAgICAgZGF0YTogZGF0YVtpXSwKICAgICAgICAgIHZhbHVlOiBkID0gdmFsdWVzW2ldLAogICAgICAgICAgc3RhcnRBbmdsZTogYSwKICAgICAgICAgIGVuZEFuZ2xlOiBhICs9IGQgKiBrCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiBhcmNzOwogICAgfQogICAgdmFyIHZhbHVlID0gTnVtYmVyLCBzb3J0ID0gZDNfbGF5b3V0X3BpZVNvcnRCeVZhbHVlLCBzdGFydEFuZ2xlID0gMCwgZW5kQW5nbGUgPSAyICogTWF0aC5QSTsKICAgIHBpZS52YWx1ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdmFsdWU7CiAgICAgIHZhbHVlID0geDsKICAgICAgcmV0dXJuIHBpZTsKICAgIH07CiAgICBwaWUuc29ydCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc29ydDsKICAgICAgc29ydCA9IHg7CiAgICAgIHJldHVybiBwaWU7CiAgICB9OwogICAgcGllLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHN0YXJ0QW5nbGU7CiAgICAgIHN0YXJ0QW5nbGUgPSB4OwogICAgICByZXR1cm4gcGllOwogICAgfTsKICAgIHBpZS5lbmRBbmdsZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZW5kQW5nbGU7CiAgICAgIGVuZEFuZ2xlID0geDsKICAgICAgcmV0dXJuIHBpZTsKICAgIH07CiAgICByZXR1cm4gcGllOwogIH07CiAgdmFyIGQzX2xheW91dF9waWVTb3J0QnlWYWx1ZSA9IHt9OwogIGQzLmxheW91dC5zdGFjayA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gc3RhY2soZGF0YSwgaW5kZXgpIHsKICAgICAgdmFyIHNlcmllcyA9IGRhdGEubWFwKGZ1bmN0aW9uKGQsIGkpIHsKICAgICAgICByZXR1cm4gdmFsdWVzLmNhbGwoc3RhY2ssIGQsIGkpOwogICAgICB9KTsKICAgICAgdmFyIHBvaW50cyA9IHNlcmllcy5tYXAoZnVuY3Rpb24oZCwgaSkgewogICAgICAgIHJldHVybiBkLm1hcChmdW5jdGlvbih2LCBpKSB7CiAgICAgICAgICByZXR1cm4gWyB4LmNhbGwoc3RhY2ssIHYsIGkpLCB5LmNhbGwoc3RhY2ssIHYsIGkpIF07CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB2YXIgb3JkZXJzID0gb3JkZXIuY2FsbChzdGFjaywgcG9pbnRzLCBpbmRleCk7CiAgICAgIHNlcmllcyA9IGQzLnBlcm11dGUoc2VyaWVzLCBvcmRlcnMpOwogICAgICBwb2ludHMgPSBkMy5wZXJtdXRlKHBvaW50cywgb3JkZXJzKTsKICAgICAgdmFyIG9mZnNldHMgPSBvZmZzZXQuY2FsbChzdGFjaywgcG9pbnRzLCBpbmRleCk7CiAgICAgIHZhciBuID0gc2VyaWVzLmxlbmd0aCwgbSA9IHNlcmllc1swXS5sZW5ndGgsIGksIGosIG87CiAgICAgIGZvciAoaiA9IDA7IGogPCBtOyArK2opIHsKICAgICAgICBvdXQuY2FsbChzdGFjaywgc2VyaWVzWzBdW2pdLCBvID0gb2Zmc2V0c1tqXSwgcG9pbnRzWzBdW2pdWzFdKTsKICAgICAgICBmb3IgKGkgPSAxOyBpIDwgbjsgKytpKSB7CiAgICAgICAgICBvdXQuY2FsbChzdGFjaywgc2VyaWVzW2ldW2pdLCBvICs9IHBvaW50c1tpIC0gMV1bal1bMV0sIHBvaW50c1tpXVtqXVsxXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgdmFyIHZhbHVlcyA9IGQzX2lkZW50aXR5LCBvcmRlciA9IGQzX2xheW91dF9zdGFja09yZGVyRGVmYXVsdCwgb2Zmc2V0ID0gZDNfbGF5b3V0X3N0YWNrT2Zmc2V0WmVybywgb3V0ID0gZDNfbGF5b3V0X3N0YWNrT3V0LCB4ID0gZDNfbGF5b3V0X3N0YWNrWCwgeSA9IGQzX2xheW91dF9zdGFja1k7CiAgICBzdGFjay52YWx1ZXMgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZhbHVlczsKICAgICAgdmFsdWVzID0geDsKICAgICAgcmV0dXJuIHN0YWNrOwogICAgfTsKICAgIHN0YWNrLm9yZGVyID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvcmRlcjsKICAgICAgb3JkZXIgPSB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA\/IHggOiBkM19sYXlvdXRfc3RhY2tPcmRlcnMuZ2V0KHgpIHx8IGQzX2xheW91dF9zdGFja09yZGVyRGVmYXVsdDsKICAgICAgcmV0dXJuIHN0YWNrOwogICAgfTsKICAgIHN0YWNrLm9mZnNldCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gb2Zmc2V0OwogICAgICBvZmZzZXQgPSB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIiA\/IHggOiBkM19sYXlvdXRfc3RhY2tPZmZzZXRzLmdldCh4KSB8fCBkM19sYXlvdXRfc3RhY2tPZmZzZXRaZXJvOwogICAgICByZXR1cm4gc3RhY2s7CiAgICB9OwogICAgc3RhY2sueCA9IGZ1bmN0aW9uKHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4geDsKICAgICAgeCA9IHo7CiAgICAgIHJldHVybiBzdGFjazsKICAgIH07CiAgICBzdGFjay55ID0gZnVuY3Rpb24oeikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB5OwogICAgICB5ID0gejsKICAgICAgcmV0dXJuIHN0YWNrOwogICAgfTsKICAgIHN0YWNrLm91dCA9IGZ1bmN0aW9uKHopIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gb3V0OwogICAgICBvdXQgPSB6OwogICAgICByZXR1cm4gc3RhY2s7CiAgICB9OwogICAgcmV0dXJuIHN0YWNrOwogIH07CiAgdmFyIGQzX2xheW91dF9zdGFja09yZGVycyA9IGQzLm1hcCh7CiAgICAiaW5zaWRlLW91dCI6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgdmFyIG4gPSBkYXRhLmxlbmd0aCwgaSwgaiwgbWF4ID0gZGF0YS5tYXAoZDNfbGF5b3V0X3N0YWNrTWF4SW5kZXgpLCBzdW1zID0gZGF0YS5tYXAoZDNfbGF5b3V0X3N0YWNrUmVkdWNlU3VtKSwgaW5kZXggPSBkMy5yYW5nZShuKS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gbWF4W2FdIC0gbWF4W2JdOwogICAgICB9KSwgdG9wID0gMCwgYm90dG9tID0gMCwgdG9wcyA9IFtdLCBib3R0b21zID0gW107CiAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgICBqID0gaW5kZXhbaV07CiAgICAgICAgaWYgKHRvcCA8IGJvdHRvbSkgewogICAgICAgICAgdG9wICs9IHN1bXNbal07CiAgICAgICAgICB0b3BzLnB1c2goaik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJvdHRvbSArPSBzdW1zW2pdOwogICAgICAgICAgYm90dG9tcy5wdXNoKGopOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gYm90dG9tcy5yZXZlcnNlKCkuY29uY2F0KHRvcHMpOwogICAgfSwKICAgIHJldmVyc2U6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIGQzLnJhbmdlKGRhdGEubGVuZ3RoKS5yZXZlcnNlKCk7CiAgICB9LAogICAgImRlZmF1bHQiOiBkM19sYXlvdXRfc3RhY2tPcmRlckRlZmF1bHQKICB9KTsKICB2YXIgZDNfbGF5b3V0X3N0YWNrT2Zmc2V0cyA9IGQzLm1hcCh7CiAgICBzaWxob3VldHRlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHZhciBuID0gZGF0YS5sZW5ndGgsIG0gPSBkYXRhWzBdLmxlbmd0aCwgc3VtcyA9IFtdLCBtYXggPSAwLCBpLCBqLCBvLCB5MCA9IFtdOwogICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB7CiAgICAgICAgZm9yIChpID0gMCwgbyA9IDA7IGkgPCBuOyBpKyspIG8gKz0gZGF0YVtpXVtqXVsxXTsKICAgICAgICBpZiAobyA+IG1heCkgbWF4ID0gbzsKICAgICAgICBzdW1zLnB1c2gobyk7CiAgICAgIH0KICAgICAgZm9yIChqID0gMDsgaiA8IG07ICsraikgewogICAgICAgIHkwW2pdID0gKG1heCAtIHN1bXNbal0pIC8gMjsKICAgICAgfQogICAgICByZXR1cm4geTA7CiAgICB9LAogICAgd2lnZ2xlOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgIHZhciBuID0gZGF0YS5sZW5ndGgsIHggPSBkYXRhWzBdLCBtID0geC5sZW5ndGgsIG1heCA9IDAsIGksIGosIGssIHMxLCBzMiwgczMsIGR4LCBvLCBvMCwgeTAgPSBbXTsKICAgICAgeTBbMF0gPSBvID0gbzAgPSAwOwogICAgICBmb3IgKGogPSAxOyBqIDwgbTsgKytqKSB7CiAgICAgICAgZm9yIChpID0gMCwgczEgPSAwOyBpIDwgbjsgKytpKSBzMSArPSBkYXRhW2ldW2pdWzFdOwogICAgICAgIGZvciAoaSA9IDAsIHMyID0gMCwgZHggPSB4W2pdWzBdIC0geFtqIC0gMV1bMF07IGkgPCBuOyArK2kpIHsKICAgICAgICAgIGZvciAoayA9IDAsIHMzID0gKGRhdGFbaV1bal1bMV0gLSBkYXRhW2ldW2ogLSAxXVsxXSkgLyAoMiAqIGR4KTsgayA8IGk7ICsraykgewogICAgICAgICAgICBzMyArPSAoZGF0YVtrXVtqXVsxXSAtIGRhdGFba11baiAtIDFdWzFdKSAvIGR4OwogICAgICAgICAgfQogICAgICAgICAgczIgKz0gczMgKiBkYXRhW2ldW2pdWzFdOwogICAgICAgIH0KICAgICAgICB5MFtqXSA9IG8gLT0gczEgPyBzMiAvIHMxICogZHggOiAwOwogICAgICAgIGlmIChvIDwgbzApIG8wID0gbzsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB5MFtqXSAtPSBvMDsKICAgICAgcmV0dXJuIHkwOwogICAgfSwKICAgIGV4cGFuZDogZnVuY3Rpb24oZGF0YSkgewogICAgICB2YXIgbiA9IGRhdGEubGVuZ3RoLCBtID0gZGF0YVswXS5sZW5ndGgsIGsgPSAxIC8gbiwgaSwgaiwgbywgeTAgPSBbXTsKICAgICAgZm9yIChqID0gMDsgaiA8IG07ICsraikgewogICAgICAgIGZvciAoaSA9IDAsIG8gPSAwOyBpIDwgbjsgaSsrKSBvICs9IGRhdGFbaV1bal1bMV07CiAgICAgICAgaWYgKG8pIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIGRhdGFbaV1bal1bMV0gLz0gbzsgZWxzZSBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSBkYXRhW2ldW2pdWzFdID0gazsKICAgICAgfQogICAgICBmb3IgKGogPSAwOyBqIDwgbTsgKytqKSB5MFtqXSA9IDA7CiAgICAgIHJldHVybiB5MDsKICAgIH0sCiAgICB6ZXJvOiBkM19sYXlvdXRfc3RhY2tPZmZzZXRaZXJvCiAgfSk7CiAgZDMubGF5b3V0Lmhpc3RvZ3JhbSA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gaGlzdG9ncmFtKGRhdGEsIGkpIHsKICAgICAgdmFyIGJpbnMgPSBbXSwgdmFsdWVzID0gZGF0YS5tYXAodmFsdWVyLCB0aGlzKSwgcmFuZ2UgPSByYW5nZXIuY2FsbCh0aGlzLCB2YWx1ZXMsIGkpLCB0aHJlc2hvbGRzID0gYmlubmVyLmNhbGwodGhpcywgcmFuZ2UsIHZhbHVlcywgaSksIGJpbiwgaSA9IC0xLCBuID0gdmFsdWVzLmxlbmd0aCwgbSA9IHRocmVzaG9sZHMubGVuZ3RoIC0gMSwgayA9IGZyZXF1ZW5jeSA\/IDEgOiAxIC8gbiwgeDsKICAgICAgd2hpbGUgKCsraSA8IG0pIHsKICAgICAgICBiaW4gPSBiaW5zW2ldID0gW107CiAgICAgICAgYmluLmR4ID0gdGhyZXNob2xkc1tpICsgMV0gLSAoYmluLnggPSB0aHJlc2hvbGRzW2ldKTsKICAgICAgICBiaW4ueSA9IDA7CiAgICAgIH0KICAgICAgaWYgKG0gPiAwKSB7CiAgICAgICAgaSA9IC0xOwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICB4ID0gdmFsdWVzW2ldOwogICAgICAgICAgaWYgKHggPj0gcmFuZ2VbMF0gJiYgeCA8PSByYW5nZVsxXSkgewogICAgICAgICAgICBiaW4gPSBiaW5zW2QzLmJpc2VjdCh0aHJlc2hvbGRzLCB4LCAxLCBtKSAtIDFdOwogICAgICAgICAgICBiaW4ueSArPSBrOwogICAgICAgICAgICBiaW4ucHVzaChkYXRhW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGJpbnM7CiAgICB9CiAgICB2YXIgZnJlcXVlbmN5ID0gdHJ1ZSwgdmFsdWVyID0gTnVtYmVyLCByYW5nZXIgPSBkM19sYXlvdXRfaGlzdG9ncmFtUmFuZ2UsIGJpbm5lciA9IGQzX2xheW91dF9oaXN0b2dyYW1CaW5TdHVyZ2VzOwogICAgaGlzdG9ncmFtLnZhbHVlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB2YWx1ZXI7CiAgICAgIHZhbHVlciA9IHg7CiAgICAgIHJldHVybiBoaXN0b2dyYW07CiAgICB9OwogICAgaGlzdG9ncmFtLnJhbmdlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYW5nZXI7CiAgICAgIHJhbmdlciA9IGQzX2Z1bmN0b3IoeCk7CiAgICAgIHJldHVybiBoaXN0b2dyYW07CiAgICB9OwogICAgaGlzdG9ncmFtLmJpbnMgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGJpbm5lcjsKICAgICAgYmlubmVyID0gdHlwZW9mIHggPT09ICJudW1iZXIiID8gZnVuY3Rpb24ocmFuZ2UpIHsKICAgICAgICByZXR1cm4gZDNfbGF5b3V0X2hpc3RvZ3JhbUJpbkZpeGVkKHJhbmdlLCB4KTsKICAgICAgfSA6IGQzX2Z1bmN0b3IoeCk7CiAgICAgIHJldHVybiBoaXN0b2dyYW07CiAgICB9OwogICAgaGlzdG9ncmFtLmZyZXF1ZW5jeSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gZnJlcXVlbmN5OwogICAgICBmcmVxdWVuY3kgPSAhIXg7CiAgICAgIHJldHVybiBoaXN0b2dyYW07CiAgICB9OwogICAgcmV0dXJuIGhpc3RvZ3JhbTsKICB9OwogIGQzLmxheW91dC5oaWVyYXJjaHkgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIHJlY3Vyc2UoZGF0YSwgZGVwdGgsIG5vZGVzKSB7CiAgICAgIHZhciBjaGlsZHMgPSBjaGlsZHJlbi5jYWxsKGhpZXJhcmNoeSwgZGF0YSwgZGVwdGgpLCBub2RlID0gZDNfbGF5b3V0X2hpZXJhcmNoeUlubGluZSA\/IGRhdGEgOiB7CiAgICAgICAgZGF0YTogZGF0YQogICAgICB9OwogICAgICBub2RlLmRlcHRoID0gZGVwdGg7CiAgICAgIG5vZGVzLnB1c2gobm9kZSk7CiAgICAgIGlmIChjaGlsZHMgJiYgKG4gPSBjaGlsZHMubGVuZ3RoKSkgewogICAgICAgIHZhciBpID0gLTEsIG4sIGMgPSBub2RlLmNoaWxkcmVuID0gW10sIHYgPSAwLCBqID0gZGVwdGggKyAxLCBkOwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICBkID0gcmVjdXJzZShjaGlsZHNbaV0sIGosIG5vZGVzKTsKICAgICAgICAgIGQucGFyZW50ID0gbm9kZTsKICAgICAgICAgIGMucHVzaChkKTsKICAgICAgICAgIHYgKz0gZC52YWx1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHNvcnQpIGMuc29ydChzb3J0KTsKICAgICAgICBpZiAodmFsdWUpIG5vZGUudmFsdWUgPSB2OwogICAgICB9IGVsc2UgaWYgKHZhbHVlKSB7CiAgICAgICAgbm9kZS52YWx1ZSA9ICt2YWx1ZS5jYWxsKGhpZXJhcmNoeSwgZGF0YSwgZGVwdGgpIHx8IDA7CiAgICAgIH0KICAgICAgcmV0dXJuIG5vZGU7CiAgICB9CiAgICBmdW5jdGlvbiByZXZhbHVlKG5vZGUsIGRlcHRoKSB7CiAgICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW4sIHYgPSAwOwogICAgICBpZiAoY2hpbGRyZW4gJiYgKG4gPSBjaGlsZHJlbi5sZW5ndGgpKSB7CiAgICAgICAgdmFyIGkgPSAtMSwgbiwgaiA9IGRlcHRoICsgMTsKICAgICAgICB3aGlsZSAoKytpIDwgbikgdiArPSByZXZhbHVlKGNoaWxkcmVuW2ldLCBqKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSkgewogICAgICAgIHYgPSArdmFsdWUuY2FsbChoaWVyYXJjaHksIGQzX2xheW91dF9oaWVyYXJjaHlJbmxpbmUgPyBub2RlIDogbm9kZS5kYXRhLCBkZXB0aCkgfHwgMDsKICAgICAgfQogICAgICBpZiAodmFsdWUpIG5vZGUudmFsdWUgPSB2OwogICAgICByZXR1cm4gdjsKICAgIH0KICAgIGZ1bmN0aW9uIGhpZXJhcmNoeShkKSB7CiAgICAgIHZhciBub2RlcyA9IFtdOwogICAgICByZWN1cnNlKGQsIDAsIG5vZGVzKTsKICAgICAgcmV0dXJuIG5vZGVzOwogICAgfQogICAgdmFyIHNvcnQgPSBkM19sYXlvdXRfaGllcmFyY2h5U29ydCwgY2hpbGRyZW4gPSBkM19sYXlvdXRfaGllcmFyY2h5Q2hpbGRyZW4sIHZhbHVlID0gZDNfbGF5b3V0X2hpZXJhcmNoeVZhbHVlOwogICAgaGllcmFyY2h5LnNvcnQgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNvcnQ7CiAgICAgIHNvcnQgPSB4OwogICAgICByZXR1cm4gaGllcmFyY2h5OwogICAgfTsKICAgIGhpZXJhcmNoeS5jaGlsZHJlbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gY2hpbGRyZW47CiAgICAgIGNoaWxkcmVuID0geDsKICAgICAgcmV0dXJuIGhpZXJhcmNoeTsKICAgIH07CiAgICBoaWVyYXJjaHkudmFsdWUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHZhbHVlOwogICAgICB2YWx1ZSA9IHg7CiAgICAgIHJldHVybiBoaWVyYXJjaHk7CiAgICB9OwogICAgaGllcmFyY2h5LnJldmFsdWUgPSBmdW5jdGlvbihyb290KSB7CiAgICAgIHJldmFsdWUocm9vdCwgMCk7CiAgICAgIHJldHVybiByb290OwogICAgfTsKICAgIHJldHVybiBoaWVyYXJjaHk7CiAgfTsKICB2YXIgZDNfbGF5b3V0X2hpZXJhcmNoeUlubGluZSA9IGZhbHNlOwogIGQzLmxheW91dC5wYWNrID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBwYWNrKGQsIGkpIHsKICAgICAgdmFyIG5vZGVzID0gaGllcmFyY2h5LmNhbGwodGhpcywgZCwgaSksIHJvb3QgPSBub2Rlc1swXTsKICAgICAgcm9vdC54ID0gMDsKICAgICAgcm9vdC55ID0gMDsKICAgICAgZDNfbGF5b3V0X3RyZWVWaXNpdEFmdGVyKHJvb3QsIGZ1bmN0aW9uKGQpIHsKICAgICAgICBkLnIgPSBNYXRoLnNxcnQoZC52YWx1ZSk7CiAgICAgIH0pOwogICAgICBkM19sYXlvdXRfdHJlZVZpc2l0QWZ0ZXIocm9vdCwgZDNfbGF5b3V0X3BhY2tTaWJsaW5ncyk7CiAgICAgIHZhciB3ID0gc2l6ZVswXSwgaCA9IHNpemVbMV0sIGsgPSBNYXRoLm1heCgyICogcm9vdC5yIC8gdywgMiAqIHJvb3QuciAvIGgpOwogICAgICBpZiAocGFkZGluZyA+IDApIHsKICAgICAgICB2YXIgZHIgPSBwYWRkaW5nICogayAvIDI7CiAgICAgICAgZDNfbGF5b3V0X3RyZWVWaXNpdEFmdGVyKHJvb3QsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgIGQuciArPSBkcjsKICAgICAgICB9KTsKICAgICAgICBkM19sYXlvdXRfdHJlZVZpc2l0QWZ0ZXIocm9vdCwgZDNfbGF5b3V0X3BhY2tTaWJsaW5ncyk7CiAgICAgICAgZDNfbGF5b3V0X3RyZWVWaXNpdEFmdGVyKHJvb3QsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgIGQuciAtPSBkcjsKICAgICAgICB9KTsKICAgICAgICBrID0gTWF0aC5tYXgoMiAqIHJvb3QuciAvIHcsIDIgKiByb290LnIgLyBoKTsKICAgICAgfQogICAgICBkM19sYXlvdXRfcGFja1RyYW5zZm9ybShyb290LCB3IC8gMiwgaCAvIDIsIDEgLyBrKTsKICAgICAgcmV0dXJuIG5vZGVzOwogICAgfQogICAgdmFyIGhpZXJhcmNoeSA9IGQzLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KGQzX2xheW91dF9wYWNrU29ydCksIHBhZGRpbmcgPSAwLCBzaXplID0gWyAxLCAxIF07CiAgICBwYWNrLnNpemUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNpemU7CiAgICAgIHNpemUgPSB4OwogICAgICByZXR1cm4gcGFjazsKICAgIH07CiAgICBwYWNrLnBhZGRpbmcgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHBhZGRpbmc7CiAgICAgIHBhZGRpbmcgPSArXzsKICAgICAgcmV0dXJuIHBhY2s7CiAgICB9OwogICAgcmV0dXJuIGQzX2xheW91dF9oaWVyYXJjaHlSZWJpbmQocGFjaywgaGllcmFyY2h5KTsKICB9OwogIGQzLmxheW91dC5jbHVzdGVyID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBjbHVzdGVyKGQsIGkpIHsKICAgICAgdmFyIG5vZGVzID0gaGllcmFyY2h5LmNhbGwodGhpcywgZCwgaSksIHJvb3QgPSBub2Rlc1swXSwgcHJldmlvdXNOb2RlLCB4ID0gMCwga3gsIGt5OwogICAgICBkM19sYXlvdXRfdHJlZVZpc2l0QWZ0ZXIocm9vdCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47CiAgICAgICAgaWYgKGNoaWxkcmVuICYmIGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgbm9kZS54ID0gZDNfbGF5b3V0X2NsdXN0ZXJYKGNoaWxkcmVuKTsKICAgICAgICAgIG5vZGUueSA9IGQzX2xheW91dF9jbHVzdGVyWShjaGlsZHJlbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5vZGUueCA9IHByZXZpb3VzTm9kZSA\/IHggKz0gc2VwYXJhdGlvbihub2RlLCBwcmV2aW91c05vZGUpIDogMDsKICAgICAgICAgIG5vZGUueSA9IDA7CiAgICAgICAgICBwcmV2aW91c05vZGUgPSBub2RlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciBsZWZ0ID0gZDNfbGF5b3V0X2NsdXN0ZXJMZWZ0KHJvb3QpLCByaWdodCA9IGQzX2xheW91dF9jbHVzdGVyUmlnaHQocm9vdCksIHgwID0gbGVmdC54IC0gc2VwYXJhdGlvbihsZWZ0LCByaWdodCkgLyAyLCB4MSA9IHJpZ2h0LnggKyBzZXBhcmF0aW9uKHJpZ2h0LCBsZWZ0KSAvIDI7CiAgICAgIGQzX2xheW91dF90cmVlVmlzaXRBZnRlcihyb290LCBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgbm9kZS54ID0gKG5vZGUueCAtIHgwKSAvICh4MSAtIHgwKSAqIHNpemVbMF07CiAgICAgICAgbm9kZS55ID0gKDEgLSAocm9vdC55ID8gbm9kZS55IC8gcm9vdC55IDogMSkpICogc2l6ZVsxXTsKICAgICAgfSk7CiAgICAgIHJldHVybiBub2RlczsKICAgIH0KICAgIHZhciBoaWVyYXJjaHkgPSBkMy5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChudWxsKS52YWx1ZShudWxsKSwgc2VwYXJhdGlvbiA9IGQzX2xheW91dF90cmVlU2VwYXJhdGlvbiwgc2l6ZSA9IFsgMSwgMSBdOwogICAgY2x1c3Rlci5zZXBhcmF0aW9uID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZXBhcmF0aW9uOwogICAgICBzZXBhcmF0aW9uID0geDsKICAgICAgcmV0dXJuIGNsdXN0ZXI7CiAgICB9OwogICAgY2x1c3Rlci5zaXplID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzaXplOwogICAgICBzaXplID0geDsKICAgICAgcmV0dXJuIGNsdXN0ZXI7CiAgICB9OwogICAgcmV0dXJuIGQzX2xheW91dF9oaWVyYXJjaHlSZWJpbmQoY2x1c3RlciwgaGllcmFyY2h5KTsKICB9OwogIGQzLmxheW91dC50cmVlID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiB0cmVlKGQsIGkpIHsKICAgICAgZnVuY3Rpb24gZmlyc3RXYWxrKG5vZGUsIHByZXZpb3VzU2libGluZykgewogICAgICAgIHZhciBjaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW4sIGxheW91dCA9IG5vZGUuX3RyZWU7CiAgICAgICAgaWYgKGNoaWxkcmVuICYmIChuID0gY2hpbGRyZW4ubGVuZ3RoKSkgewogICAgICAgICAgdmFyIG4sIGZpcnN0Q2hpbGQgPSBjaGlsZHJlblswXSwgcHJldmlvdXNDaGlsZCwgYW5jZXN0b3IgPSBmaXJzdENoaWxkLCBjaGlsZCwgaSA9IC0xOwogICAgICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICAgICAgY2hpbGQgPSBjaGlsZHJlbltpXTsKICAgICAgICAgICAgZmlyc3RXYWxrKGNoaWxkLCBwcmV2aW91c0NoaWxkKTsKICAgICAgICAgICAgYW5jZXN0b3IgPSBhcHBvcnRpb24oY2hpbGQsIHByZXZpb3VzQ2hpbGQsIGFuY2VzdG9yKTsKICAgICAgICAgICAgcHJldmlvdXNDaGlsZCA9IGNoaWxkOwogICAgICAgICAgfQogICAgICAgICAgZDNfbGF5b3V0X3RyZWVTaGlmdChub2RlKTsKICAgICAgICAgIHZhciBtaWRwb2ludCA9IC41ICogKGZpcnN0Q2hpbGQuX3RyZWUucHJlbGltICsgY2hpbGQuX3RyZWUucHJlbGltKTsKICAgICAgICAgIGlmIChwcmV2aW91c1NpYmxpbmcpIHsKICAgICAgICAgICAgbGF5b3V0LnByZWxpbSA9IHByZXZpb3VzU2libGluZy5fdHJlZS5wcmVsaW0gKyBzZXBhcmF0aW9uKG5vZGUsIHByZXZpb3VzU2libGluZyk7CiAgICAgICAgICAgIGxheW91dC5tb2QgPSBsYXlvdXQucHJlbGltIC0gbWlkcG9pbnQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsYXlvdXQucHJlbGltID0gbWlkcG9pbnQ7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwcmV2aW91c1NpYmxpbmcpIHsKICAgICAgICAgICAgbGF5b3V0LnByZWxpbSA9IHByZXZpb3VzU2libGluZy5fdHJlZS5wcmVsaW0gKyBzZXBhcmF0aW9uKG5vZGUsIHByZXZpb3VzU2libGluZyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHNlY29uZFdhbGsobm9kZSwgeCkgewogICAgICAgIG5vZGUueCA9IG5vZGUuX3RyZWUucHJlbGltICsgeDsKICAgICAgICB2YXIgY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuOwogICAgICAgIGlmIChjaGlsZHJlbiAmJiAobiA9IGNoaWxkcmVuLmxlbmd0aCkpIHsKICAgICAgICAgIHZhciBpID0gLTEsIG47CiAgICAgICAgICB4ICs9IG5vZGUuX3RyZWUubW9kOwogICAgICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICAgICAgc2Vjb25kV2FsayhjaGlsZHJlbltpXSwgeCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFwcG9ydGlvbihub2RlLCBwcmV2aW91c1NpYmxpbmcsIGFuY2VzdG9yKSB7CiAgICAgICAgaWYgKHByZXZpb3VzU2libGluZykgewogICAgICAgICAgdmFyIHZpcCA9IG5vZGUsIHZvcCA9IG5vZGUsIHZpbSA9IHByZXZpb3VzU2libGluZywgdm9tID0gbm9kZS5wYXJlbnQuY2hpbGRyZW5bMF0sIHNpcCA9IHZpcC5fdHJlZS5tb2QsIHNvcCA9IHZvcC5fdHJlZS5tb2QsIHNpbSA9IHZpbS5fdHJlZS5tb2QsIHNvbSA9IHZvbS5fdHJlZS5tb2QsIHNoaWZ0OwogICAgICAgICAgd2hpbGUgKHZpbSA9IGQzX2xheW91dF90cmVlUmlnaHQodmltKSwgdmlwID0gZDNfbGF5b3V0X3RyZWVMZWZ0KHZpcCksIHZpbSAmJiB2aXApIHsKICAgICAgICAgICAgdm9tID0gZDNfbGF5b3V0X3RyZWVMZWZ0KHZvbSk7CiAgICAgICAgICAgIHZvcCA9IGQzX2xheW91dF90cmVlUmlnaHQodm9wKTsKICAgICAgICAgICAgdm9wLl90cmVlLmFuY2VzdG9yID0gbm9kZTsKICAgICAgICAgICAgc2hpZnQgPSB2aW0uX3RyZWUucHJlbGltICsgc2ltIC0gdmlwLl90cmVlLnByZWxpbSAtIHNpcCArIHNlcGFyYXRpb24odmltLCB2aXApOwogICAgICAgICAgICBpZiAoc2hpZnQgPiAwKSB7CiAgICAgICAgICAgICAgZDNfbGF5b3V0X3RyZWVNb3ZlKGQzX2xheW91dF90cmVlQW5jZXN0b3IodmltLCBub2RlLCBhbmNlc3RvciksIG5vZGUsIHNoaWZ0KTsKICAgICAgICAgICAgICBzaXAgKz0gc2hpZnQ7CiAgICAgICAgICAgICAgc29wICs9IHNoaWZ0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNpbSArPSB2aW0uX3RyZWUubW9kOwogICAgICAgICAgICBzaXAgKz0gdmlwLl90cmVlLm1vZDsKICAgICAgICAgICAgc29tICs9IHZvbS5fdHJlZS5tb2Q7CiAgICAgICAgICAgIHNvcCArPSB2b3AuX3RyZWUubW9kOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZpbSAmJiAhZDNfbGF5b3V0X3RyZWVSaWdodCh2b3ApKSB7CiAgICAgICAgICAgIHZvcC5fdHJlZS50aHJlYWQgPSB2aW07CiAgICAgICAgICAgIHZvcC5fdHJlZS5tb2QgKz0gc2ltIC0gc29wOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHZpcCAmJiAhZDNfbGF5b3V0X3RyZWVMZWZ0KHZvbSkpIHsKICAgICAgICAgICAgdm9tLl90cmVlLnRocmVhZCA9IHZpcDsKICAgICAgICAgICAgdm9tLl90cmVlLm1vZCArPSBzaXAgLSBzb207CiAgICAgICAgICAgIGFuY2VzdG9yID0gbm9kZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFuY2VzdG9yOwogICAgICB9CiAgICAgIHZhciBub2RlcyA9IGhpZXJhcmNoeS5jYWxsKHRoaXMsIGQsIGkpLCByb290ID0gbm9kZXNbMF07CiAgICAgIGQzX2xheW91dF90cmVlVmlzaXRBZnRlcihyb290LCBmdW5jdGlvbihub2RlLCBwcmV2aW91c1NpYmxpbmcpIHsKICAgICAgICBub2RlLl90cmVlID0gewogICAgICAgICAgYW5jZXN0b3I6IG5vZGUsCiAgICAgICAgICBwcmVsaW06IDAsCiAgICAgICAgICBtb2Q6IDAsCiAgICAgICAgICBjaGFuZ2U6IDAsCiAgICAgICAgICBzaGlmdDogMCwKICAgICAgICAgIG51bWJlcjogcHJldmlvdXNTaWJsaW5nID8gcHJldmlvdXNTaWJsaW5nLl90cmVlLm51bWJlciArIDEgOiAwCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIGZpcnN0V2Fsayhyb290KTsKICAgICAgc2Vjb25kV2Fsayhyb290LCAtcm9vdC5fdHJlZS5wcmVsaW0pOwogICAgICB2YXIgbGVmdCA9IGQzX2xheW91dF90cmVlU2VhcmNoKHJvb3QsIGQzX2xheW91dF90cmVlTGVmdG1vc3QpLCByaWdodCA9IGQzX2xheW91dF90cmVlU2VhcmNoKHJvb3QsIGQzX2xheW91dF90cmVlUmlnaHRtb3N0KSwgZGVlcCA9IGQzX2xheW91dF90cmVlU2VhcmNoKHJvb3QsIGQzX2xheW91dF90cmVlRGVlcGVzdCksIHgwID0gbGVmdC54IC0gc2VwYXJhdGlvbihsZWZ0LCByaWdodCkgLyAyLCB4MSA9IHJpZ2h0LnggKyBzZXBhcmF0aW9uKHJpZ2h0LCBsZWZ0KSAvIDIsIHkxID0gZGVlcC5kZXB0aCB8fCAxOwogICAgICBkM19sYXlvdXRfdHJlZVZpc2l0QWZ0ZXIocm9vdCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgIG5vZGUueCA9IChub2RlLnggLSB4MCkgLyAoeDEgLSB4MCkgKiBzaXplWzBdOwogICAgICAgIG5vZGUueSA9IG5vZGUuZGVwdGggLyB5MSAqIHNpemVbMV07CiAgICAgICAgZGVsZXRlIG5vZGUuX3RyZWU7CiAgICAgIH0pOwogICAgICByZXR1cm4gbm9kZXM7CiAgICB9CiAgICB2YXIgaGllcmFyY2h5ID0gZDMubGF5b3V0LmhpZXJhcmNoeSgpLnNvcnQobnVsbCkudmFsdWUobnVsbCksIHNlcGFyYXRpb24gPSBkM19sYXlvdXRfdHJlZVNlcGFyYXRpb24sIHNpemUgPSBbIDEsIDEgXTsKICAgIHRyZWUuc2VwYXJhdGlvbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VwYXJhdGlvbjsKICAgICAgc2VwYXJhdGlvbiA9IHg7CiAgICAgIHJldHVybiB0cmVlOwogICAgfTsKICAgIHRyZWUuc2l6ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2l6ZTsKICAgICAgc2l6ZSA9IHg7CiAgICAgIHJldHVybiB0cmVlOwogICAgfTsKICAgIHJldHVybiBkM19sYXlvdXRfaGllcmFyY2h5UmViaW5kKHRyZWUsIGhpZXJhcmNoeSk7CiAgfTsKICBkMy5sYXlvdXQudHJlZW1hcCA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gc2NhbGUoY2hpbGRyZW4sIGspIHsKICAgICAgdmFyIGkgPSAtMSwgbiA9IGNoaWxkcmVuLmxlbmd0aCwgY2hpbGQsIGFyZWE7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgYXJlYSA9IChjaGlsZCA9IGNoaWxkcmVuW2ldKS52YWx1ZSAqIChrIDwgMCA\/IDAgOiBrKTsKICAgICAgICBjaGlsZC5hcmVhID0gaXNOYU4oYXJlYSkgfHwgYXJlYSA8PSAwID8gMCA6IGFyZWE7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHNxdWFyaWZ5KG5vZGUpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgICAgaWYgKGNoaWxkcmVuICYmIGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHZhciByZWN0ID0gcGFkKG5vZGUpLCByb3cgPSBbXSwgcmVtYWluaW5nID0gY2hpbGRyZW4uc2xpY2UoKSwgY2hpbGQsIGJlc3QgPSBJbmZpbml0eSwgc2NvcmUsIHUgPSBNYXRoLm1pbihyZWN0LmR4LCByZWN0LmR5KSwgbjsKICAgICAgICBzY2FsZShyZW1haW5pbmcsIHJlY3QuZHggKiByZWN0LmR5IC8gbm9kZS52YWx1ZSk7CiAgICAgICAgcm93LmFyZWEgPSAwOwogICAgICAgIHdoaWxlICgobiA9IHJlbWFpbmluZy5sZW5ndGgpID4gMCkgewogICAgICAgICAgcm93LnB1c2goY2hpbGQgPSByZW1haW5pbmdbbiAtIDFdKTsKICAgICAgICAgIHJvdy5hcmVhICs9IGNoaWxkLmFyZWE7CiAgICAgICAgICBpZiAoKHNjb3JlID0gd29yc3Qocm93LCB1KSkgPD0gYmVzdCkgewogICAgICAgICAgICByZW1haW5pbmcucG9wKCk7CiAgICAgICAgICAgIGJlc3QgPSBzY29yZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvdy5hcmVhIC09IHJvdy5wb3AoKS5hcmVhOwogICAgICAgICAgICBwb3NpdGlvbihyb3csIHUsIHJlY3QsIGZhbHNlKTsKICAgICAgICAgICAgdSA9IE1hdGgubWluKHJlY3QuZHgsIHJlY3QuZHkpOwogICAgICAgICAgICByb3cubGVuZ3RoID0gcm93LmFyZWEgPSAwOwogICAgICAgICAgICBiZXN0ID0gSW5maW5pdHk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChyb3cubGVuZ3RoKSB7CiAgICAgICAgICBwb3NpdGlvbihyb3csIHUsIHJlY3QsIHRydWUpOwogICAgICAgICAgcm93Lmxlbmd0aCA9IHJvdy5hcmVhID0gMDsKICAgICAgICB9CiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChzcXVhcmlmeSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHN0aWNraWZ5KG5vZGUpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbjsKICAgICAgaWYgKGNoaWxkcmVuICYmIGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHZhciByZWN0ID0gcGFkKG5vZGUpLCByZW1haW5pbmcgPSBjaGlsZHJlbi5zbGljZSgpLCBjaGlsZCwgcm93ID0gW107CiAgICAgICAgc2NhbGUocmVtYWluaW5nLCByZWN0LmR4ICogcmVjdC5keSAvIG5vZGUudmFsdWUpOwogICAgICAgIHJvdy5hcmVhID0gMDsKICAgICAgICB3aGlsZSAoY2hpbGQgPSByZW1haW5pbmcucG9wKCkpIHsKICAgICAgICAgIHJvdy5wdXNoKGNoaWxkKTsKICAgICAgICAgIHJvdy5hcmVhICs9IGNoaWxkLmFyZWE7CiAgICAgICAgICBpZiAoY2hpbGQueiAhPSBudWxsKSB7CiAgICAgICAgICAgIHBvc2l0aW9uKHJvdywgY2hpbGQueiA\/IHJlY3QuZHggOiByZWN0LmR5LCByZWN0LCAhcmVtYWluaW5nLmxlbmd0aCk7CiAgICAgICAgICAgIHJvdy5sZW5ndGggPSByb3cuYXJlYSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuLmZvckVhY2goc3RpY2tpZnkpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB3b3JzdChyb3csIHUpIHsKICAgICAgdmFyIHMgPSByb3cuYXJlYSwgciwgcm1heCA9IDAsIHJtaW4gPSBJbmZpbml0eSwgaSA9IC0xLCBuID0gcm93Lmxlbmd0aDsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAoIShyID0gcm93W2ldLmFyZWEpKSBjb250aW51ZTsKICAgICAgICBpZiAociA8IHJtaW4pIHJtaW4gPSByOwogICAgICAgIGlmIChyID4gcm1heCkgcm1heCA9IHI7CiAgICAgIH0KICAgICAgcyAqPSBzOwogICAgICB1ICo9IHU7CiAgICAgIHJldHVybiBzID8gTWF0aC5tYXgodSAqIHJtYXggKiByYXRpbyAvIHMsIHMgLyAodSAqIHJtaW4gKiByYXRpbykpIDogSW5maW5pdHk7CiAgICB9CiAgICBmdW5jdGlvbiBwb3NpdGlvbihyb3csIHUsIHJlY3QsIGZsdXNoKSB7CiAgICAgIHZhciBpID0gLTEsIG4gPSByb3cubGVuZ3RoLCB4ID0gcmVjdC54LCB5ID0gcmVjdC55LCB2ID0gdSA\/IHJvdW5kKHJvdy5hcmVhIC8gdSkgOiAwLCBvOwogICAgICBpZiAodSA9PSByZWN0LmR4KSB7CiAgICAgICAgaWYgKGZsdXNoIHx8IHYgPiByZWN0LmR5KSB2ID0gcmVjdC5keTsKICAgICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgbyA9IHJvd1tpXTsKICAgICAgICAgIG8ueCA9IHg7CiAgICAgICAgICBvLnkgPSB5OwogICAgICAgICAgby5keSA9IHY7CiAgICAgICAgICB4ICs9IG8uZHggPSBNYXRoLm1pbihyZWN0LnggKyByZWN0LmR4IC0geCwgdiA\/IHJvdW5kKG8uYXJlYSAvIHYpIDogMCk7CiAgICAgICAgfQogICAgICAgIG8ueiA9IHRydWU7CiAgICAgICAgby5keCArPSByZWN0LnggKyByZWN0LmR4IC0geDsKICAgICAgICByZWN0LnkgKz0gdjsKICAgICAgICByZWN0LmR5IC09IHY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGZsdXNoIHx8IHYgPiByZWN0LmR4KSB2ID0gcmVjdC5keDsKICAgICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgbyA9IHJvd1tpXTsKICAgICAgICAgIG8ueCA9IHg7CiAgICAgICAgICBvLnkgPSB5OwogICAgICAgICAgby5keCA9IHY7CiAgICAgICAgICB5ICs9IG8uZHkgPSBNYXRoLm1pbihyZWN0LnkgKyByZWN0LmR5IC0geSwgdiA\/IHJvdW5kKG8uYXJlYSAvIHYpIDogMCk7CiAgICAgICAgfQogICAgICAgIG8ueiA9IGZhbHNlOwogICAgICAgIG8uZHkgKz0gcmVjdC55ICsgcmVjdC5keSAtIHk7CiAgICAgICAgcmVjdC54ICs9IHY7CiAgICAgICAgcmVjdC5keCAtPSB2OwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB0cmVlbWFwKGQpIHsKICAgICAgdmFyIG5vZGVzID0gc3RpY2tpZXMgfHwgaGllcmFyY2h5KGQpLCByb290ID0gbm9kZXNbMF07CiAgICAgIHJvb3QueCA9IDA7CiAgICAgIHJvb3QueSA9IDA7CiAgICAgIHJvb3QuZHggPSBzaXplWzBdOwogICAgICByb290LmR5ID0gc2l6ZVsxXTsKICAgICAgaWYgKHN0aWNraWVzKSBoaWVyYXJjaHkucmV2YWx1ZShyb290KTsKICAgICAgc2NhbGUoWyByb290IF0sIHJvb3QuZHggKiByb290LmR5IC8gcm9vdC52YWx1ZSk7CiAgICAgIChzdGlja2llcyA\/IHN0aWNraWZ5IDogc3F1YXJpZnkpKHJvb3QpOwogICAgICBpZiAoc3RpY2t5KSBzdGlja2llcyA9IG5vZGVzOwogICAgICByZXR1cm4gbm9kZXM7CiAgICB9CiAgICB2YXIgaGllcmFyY2h5ID0gZDMubGF5b3V0LmhpZXJhcmNoeSgpLCByb3VuZCA9IE1hdGgucm91bmQsIHNpemUgPSBbIDEsIDEgXSwgcGFkZGluZyA9IG51bGwsIHBhZCA9IGQzX2xheW91dF90cmVlbWFwUGFkTnVsbCwgc3RpY2t5ID0gZmFsc2UsIHN0aWNraWVzLCByYXRpbyA9IC41ICogKDEgKyBNYXRoLnNxcnQoNSkpOwogICAgdHJlZW1hcC5zaXplID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzaXplOwogICAgICBzaXplID0geDsKICAgICAgcmV0dXJuIHRyZWVtYXA7CiAgICB9OwogICAgdHJlZW1hcC5wYWRkaW5nID0gZnVuY3Rpb24oeCkgewogICAgICBmdW5jdGlvbiBwYWRGdW5jdGlvbihub2RlKSB7CiAgICAgICAgdmFyIHAgPSB4LmNhbGwodHJlZW1hcCwgbm9kZSwgbm9kZS5kZXB0aCk7CiAgICAgICAgcmV0dXJuIHAgPT0gbnVsbCA\/IGQzX2xheW91dF90cmVlbWFwUGFkTnVsbChub2RlKSA6IGQzX2xheW91dF90cmVlbWFwUGFkKG5vZGUsIHR5cGVvZiBwID09PSAibnVtYmVyIiA\/IFsgcCwgcCwgcCwgcCBdIDogcCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcGFkQ29uc3RhbnQobm9kZSkgewogICAgICAgIHJldHVybiBkM19sYXlvdXRfdHJlZW1hcFBhZChub2RlLCB4KTsKICAgICAgfQogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBwYWRkaW5nOwogICAgICB2YXIgdHlwZTsKICAgICAgcGFkID0gKHBhZGRpbmcgPSB4KSA9PSBudWxsID8gZDNfbGF5b3V0X3RyZWVtYXBQYWROdWxsIDogKHR5cGUgPSB0eXBlb2YgeCkgPT09ICJmdW5jdGlvbiIgPyBwYWRGdW5jdGlvbiA6IHR5cGUgPT09ICJudW1iZXIiID8gKHggPSBbIHgsIHgsIHgsIHggXSwgcGFkQ29uc3RhbnQpIDogcGFkQ29uc3RhbnQ7CiAgICAgIHJldHVybiB0cmVlbWFwOwogICAgfTsKICAgIHRyZWVtYXAucm91bmQgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHJvdW5kICE9IE51bWJlcjsKICAgICAgcm91bmQgPSB4ID8gTWF0aC5yb3VuZCA6IE51bWJlcjsKICAgICAgcmV0dXJuIHRyZWVtYXA7CiAgICB9OwogICAgdHJlZW1hcC5zdGlja3kgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHN0aWNreTsKICAgICAgc3RpY2t5ID0geDsKICAgICAgc3RpY2tpZXMgPSBudWxsOwogICAgICByZXR1cm4gdHJlZW1hcDsKICAgIH07CiAgICB0cmVlbWFwLnJhdGlvID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiByYXRpbzsKICAgICAgcmF0aW8gPSB4OwogICAgICByZXR1cm4gdHJlZW1hcDsKICAgIH07CiAgICByZXR1cm4gZDNfbGF5b3V0X2hpZXJhcmNoeVJlYmluZCh0cmVlbWFwLCBoaWVyYXJjaHkpOwogIH07CiAgZDMuY3N2ID0gZDNfZHN2KCIsIiwgInRleHQvY3N2Iik7CiAgZDMudHN2ID0gZDNfZHN2KCIJIiwgInRleHQvdGFiLXNlcGFyYXRlZC12YWx1ZXMiKTsKICBkMy5nZW8gPSB7fTsKICB2YXIgZDNfZ2VvX3JhZGlhbnMgPSBNYXRoLlBJIC8gMTgwOwogIGQzLmdlby5hemltdXRoYWwgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGF6aW11dGhhbChjb29yZGluYXRlcykgewogICAgICB2YXIgeDEgPSBjb29yZGluYXRlc1swXSAqIGQzX2dlb19yYWRpYW5zIC0geDAsIHkxID0gY29vcmRpbmF0ZXNbMV0gKiBkM19nZW9fcmFkaWFucywgY3gxID0gTWF0aC5jb3MoeDEpLCBzeDEgPSBNYXRoLnNpbih4MSksIGN5MSA9IE1hdGguY29zKHkxKSwgc3kxID0gTWF0aC5zaW4oeTEpLCBjYyA9IG1vZGUgIT09ICJvcnRob2dyYXBoaWMiID8gc3kwICogc3kxICsgY3kwICogY3kxICogY3gxIDogbnVsbCwgYywgayA9IG1vZGUgPT09ICJzdGVyZW9ncmFwaGljIiA\/IDEgLyAoMSArIGNjKSA6IG1vZGUgPT09ICJnbm9tb25pYyIgPyAxIC8gY2MgOiBtb2RlID09PSAiZXF1aWRpc3RhbnQiID8gKGMgPSBNYXRoLmFjb3MoY2MpLCBjID8gYyAvIE1hdGguc2luKGMpIDogMCkgOiBtb2RlID09PSAiZXF1YWxhcmVhIiA\/IE1hdGguc3FydCgyIC8gKDEgKyBjYykpIDogMSwgeCA9IGsgKiBjeTEgKiBzeDEsIHkgPSBrICogKHN5MCAqIGN5MSAqIGN4MSAtIGN5MCAqIHN5MSk7CiAgICAgIHJldHVybiBbIHNjYWxlICogeCArIHRyYW5zbGF0ZVswXSwgc2NhbGUgKiB5ICsgdHJhbnNsYXRlWzFdIF07CiAgICB9CiAgICB2YXIgbW9kZSA9ICJvcnRob2dyYXBoaWMiLCBvcmlnaW4sIHNjYWxlID0gMjAwLCB0cmFuc2xhdGUgPSBbIDQ4MCwgMjUwIF0sIHgwLCB5MCwgY3kwLCBzeTA7CiAgICBhemltdXRoYWwuaW52ZXJ0ID0gZnVuY3Rpb24oY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIHggPSAoY29vcmRpbmF0ZXNbMF0gLSB0cmFuc2xhdGVbMF0pIC8gc2NhbGUsIHkgPSAoY29vcmRpbmF0ZXNbMV0gLSB0cmFuc2xhdGVbMV0pIC8gc2NhbGUsIHAgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSksIGMgPSBtb2RlID09PSAic3RlcmVvZ3JhcGhpYyIgPyAyICogTWF0aC5hdGFuKHApIDogbW9kZSA9PT0gImdub21vbmljIiA\/IE1hdGguYXRhbihwKSA6IG1vZGUgPT09ICJlcXVpZGlzdGFudCIgPyBwIDogbW9kZSA9PT0gImVxdWFsYXJlYSIgPyAyICogTWF0aC5hc2luKC41ICogcCkgOiBNYXRoLmFzaW4ocCksIHNjID0gTWF0aC5zaW4oYyksIGNjID0gTWF0aC5jb3MoYyk7CiAgICAgIHJldHVybiBbICh4MCArIE1hdGguYXRhbjIoeCAqIHNjLCBwICogY3kwICogY2MgKyB5ICogc3kwICogc2MpKSAvIGQzX2dlb19yYWRpYW5zLCBNYXRoLmFzaW4oY2MgKiBzeTAgLSAocCA\/IHkgKiBzYyAqIGN5MCAvIHAgOiAwKSkgLyBkM19nZW9fcmFkaWFucyBdOwogICAgfTsKICAgIGF6aW11dGhhbC5tb2RlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBtb2RlOwogICAgICBtb2RlID0geCArICIiOwogICAgICByZXR1cm4gYXppbXV0aGFsOwogICAgfTsKICAgIGF6aW11dGhhbC5vcmlnaW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIG9yaWdpbjsKICAgICAgb3JpZ2luID0geDsKICAgICAgeDAgPSBvcmlnaW5bMF0gKiBkM19nZW9fcmFkaWFuczsKICAgICAgeTAgPSBvcmlnaW5bMV0gKiBkM19nZW9fcmFkaWFuczsKICAgICAgY3kwID0gTWF0aC5jb3MoeTApOwogICAgICBzeTAgPSBNYXRoLnNpbih5MCk7CiAgICAgIHJldHVybiBhemltdXRoYWw7CiAgICB9OwogICAgYXppbXV0aGFsLnNjYWxlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzY2FsZTsKICAgICAgc2NhbGUgPSAreDsKICAgICAgcmV0dXJuIGF6aW11dGhhbDsKICAgIH07CiAgICBhemltdXRoYWwudHJhbnNsYXRlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0cmFuc2xhdGU7CiAgICAgIHRyYW5zbGF0ZSA9IFsgK3hbMF0sICt4WzFdIF07CiAgICAgIHJldHVybiBhemltdXRoYWw7CiAgICB9OwogICAgcmV0dXJuIGF6aW11dGhhbC5vcmlnaW4oWyAwLCAwIF0pOwogIH07CiAgZDMuZ2VvLmFsYmVycyA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gYWxiZXJzKGNvb3JkaW5hdGVzKSB7CiAgICAgIHZhciB0ID0gbiAqIChkM19nZW9fcmFkaWFucyAqIGNvb3JkaW5hdGVzWzBdIC0gbG5nMCksIHAgPSBNYXRoLnNxcnQoQyAtIDIgKiBuICogTWF0aC5zaW4oZDNfZ2VvX3JhZGlhbnMgKiBjb29yZGluYXRlc1sxXSkpIC8gbjsKICAgICAgcmV0dXJuIFsgc2NhbGUgKiBwICogTWF0aC5zaW4odCkgKyB0cmFuc2xhdGVbMF0sIHNjYWxlICogKHAgKiBNYXRoLmNvcyh0KSAtIHAwKSArIHRyYW5zbGF0ZVsxXSBdOwogICAgfQogICAgZnVuY3Rpb24gcmVsb2FkKCkgewogICAgICB2YXIgcGhpMSA9IGQzX2dlb19yYWRpYW5zICogcGFyYWxsZWxzWzBdLCBwaGkyID0gZDNfZ2VvX3JhZGlhbnMgKiBwYXJhbGxlbHNbMV0sIGxhdDAgPSBkM19nZW9fcmFkaWFucyAqIG9yaWdpblsxXSwgcyA9IE1hdGguc2luKHBoaTEpLCBjID0gTWF0aC5jb3MocGhpMSk7CiAgICAgIGxuZzAgPSBkM19nZW9fcmFkaWFucyAqIG9yaWdpblswXTsKICAgICAgbiA9IC41ICogKHMgKyBNYXRoLnNpbihwaGkyKSk7CiAgICAgIEMgPSBjICogYyArIDIgKiBuICogczsKICAgICAgcDAgPSBNYXRoLnNxcnQoQyAtIDIgKiBuICogTWF0aC5zaW4obGF0MCkpIC8gbjsKICAgICAgcmV0dXJuIGFsYmVyczsKICAgIH0KICAgIHZhciBvcmlnaW4gPSBbIC05OCwgMzggXSwgcGFyYWxsZWxzID0gWyAyOS41LCA0NS41IF0sIHNjYWxlID0gMWUzLCB0cmFuc2xhdGUgPSBbIDQ4MCwgMjUwIF0sIGxuZzAsIG4sIEMsIHAwOwogICAgYWxiZXJzLmludmVydCA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzKSB7CiAgICAgIHZhciB4ID0gKGNvb3JkaW5hdGVzWzBdIC0gdHJhbnNsYXRlWzBdKSAvIHNjYWxlLCB5ID0gKGNvb3JkaW5hdGVzWzFdIC0gdHJhbnNsYXRlWzFdKSAvIHNjYWxlLCBwMHkgPSBwMCArIHksIHQgPSBNYXRoLmF0YW4yKHgsIHAweSksIHAgPSBNYXRoLnNxcnQoeCAqIHggKyBwMHkgKiBwMHkpOwogICAgICByZXR1cm4gWyAobG5nMCArIHQgLyBuKSAvIGQzX2dlb19yYWRpYW5zLCBNYXRoLmFzaW4oKEMgLSBwICogcCAqIG4gKiBuKSAvICgyICogbikpIC8gZDNfZ2VvX3JhZGlhbnMgXTsKICAgIH07CiAgICBhbGJlcnMub3JpZ2luID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvcmlnaW47CiAgICAgIG9yaWdpbiA9IFsgK3hbMF0sICt4WzFdIF07CiAgICAgIHJldHVybiByZWxvYWQoKTsKICAgIH07CiAgICBhbGJlcnMucGFyYWxsZWxzID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBwYXJhbGxlbHM7CiAgICAgIHBhcmFsbGVscyA9IFsgK3hbMF0sICt4WzFdIF07CiAgICAgIHJldHVybiByZWxvYWQoKTsKICAgIH07CiAgICBhbGJlcnMuc2NhbGUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNjYWxlOwogICAgICBzY2FsZSA9ICt4OwogICAgICByZXR1cm4gYWxiZXJzOwogICAgfTsKICAgIGFsYmVycy50cmFuc2xhdGUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRyYW5zbGF0ZTsKICAgICAgdHJhbnNsYXRlID0gWyAreFswXSwgK3hbMV0gXTsKICAgICAgcmV0dXJuIGFsYmVyczsKICAgIH07CiAgICByZXR1cm4gcmVsb2FkKCk7CiAgfTsKICBkMy5nZW8uYWxiZXJzVXNhID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBhbGJlcnNVc2EoY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIGxvbiA9IGNvb3JkaW5hdGVzWzBdLCBsYXQgPSBjb29yZGluYXRlc1sxXTsKICAgICAgcmV0dXJuIChsYXQgPiA1MCA\/IGFsYXNrYSA6IGxvbiA8IC0xNDAgPyBoYXdhaWkgOiBsYXQgPCAyMSA\/IHB1ZXJ0b1JpY28gOiBsb3dlcjQ4KShjb29yZGluYXRlcyk7CiAgICB9CiAgICB2YXIgbG93ZXI0OCA9IGQzLmdlby5hbGJlcnMoKTsKICAgIHZhciBhbGFza2EgPSBkMy5nZW8uYWxiZXJzKCkub3JpZ2luKFsgLTE2MCwgNjAgXSkucGFyYWxsZWxzKFsgNTUsIDY1IF0pOwogICAgdmFyIGhhd2FpaSA9IGQzLmdlby5hbGJlcnMoKS5vcmlnaW4oWyAtMTYwLCAyMCBdKS5wYXJhbGxlbHMoWyA4LCAxOCBdKTsKICAgIHZhciBwdWVydG9SaWNvID0gZDMuZ2VvLmFsYmVycygpLm9yaWdpbihbIC02MCwgMTAgXSkucGFyYWxsZWxzKFsgOCwgMTggXSk7CiAgICBhbGJlcnNVc2Euc2NhbGUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGxvd2VyNDguc2NhbGUoKTsKICAgICAgbG93ZXI0OC5zY2FsZSh4KTsKICAgICAgYWxhc2thLnNjYWxlKHggKiAuNik7CiAgICAgIGhhd2FpaS5zY2FsZSh4KTsKICAgICAgcHVlcnRvUmljby5zY2FsZSh4ICogMS41KTsKICAgICAgcmV0dXJuIGFsYmVyc1VzYS50cmFuc2xhdGUobG93ZXI0OC50cmFuc2xhdGUoKSk7CiAgICB9OwogICAgYWxiZXJzVXNhLnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gbG93ZXI0OC50cmFuc2xhdGUoKTsKICAgICAgdmFyIGR6ID0gbG93ZXI0OC5zY2FsZSgpIC8gMWUzLCBkeCA9IHhbMF0sIGR5ID0geFsxXTsKICAgICAgbG93ZXI0OC50cmFuc2xhdGUoeCk7CiAgICAgIGFsYXNrYS50cmFuc2xhdGUoWyBkeCAtIDQwMCAqIGR6LCBkeSArIDE3MCAqIGR6IF0pOwogICAgICBoYXdhaWkudHJhbnNsYXRlKFsgZHggLSAxOTAgKiBkeiwgZHkgKyAyMDAgKiBkeiBdKTsKICAgICAgcHVlcnRvUmljby50cmFuc2xhdGUoWyBkeCArIDU4MCAqIGR6LCBkeSArIDQzMCAqIGR6IF0pOwogICAgICByZXR1cm4gYWxiZXJzVXNhOwogICAgfTsKICAgIHJldHVybiBhbGJlcnNVc2Euc2NhbGUobG93ZXI0OC5zY2FsZSgpKTsKICB9OwogIGQzLmdlby5ib25uZSA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gYm9ubmUoY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIHggPSBjb29yZGluYXRlc1swXSAqIGQzX2dlb19yYWRpYW5zIC0geDAsIHkgPSBjb29yZGluYXRlc1sxXSAqIGQzX2dlb19yYWRpYW5zIC0geTA7CiAgICAgIGlmICh5MSkgewogICAgICAgIHZhciBwID0gYzEgKyB5MSAtIHksIEUgPSB4ICogTWF0aC5jb3MoeSkgLyBwOwogICAgICAgIHggPSBwICogTWF0aC5zaW4oRSk7CiAgICAgICAgeSA9IHAgKiBNYXRoLmNvcyhFKSAtIGMxOwogICAgICB9IGVsc2UgewogICAgICAgIHggKj0gTWF0aC5jb3MoeSk7CiAgICAgICAgeSAqPSAtMTsKICAgICAgfQogICAgICByZXR1cm4gWyBzY2FsZSAqIHggKyB0cmFuc2xhdGVbMF0sIHNjYWxlICogeSArIHRyYW5zbGF0ZVsxXSBdOwogICAgfQogICAgdmFyIHNjYWxlID0gMjAwLCB0cmFuc2xhdGUgPSBbIDQ4MCwgMjUwIF0sIHgwLCB5MCwgeTEsIGMxOwogICAgYm9ubmUuaW52ZXJ0ID0gZnVuY3Rpb24oY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIHggPSAoY29vcmRpbmF0ZXNbMF0gLSB0cmFuc2xhdGVbMF0pIC8gc2NhbGUsIHkgPSAoY29vcmRpbmF0ZXNbMV0gLSB0cmFuc2xhdGVbMV0pIC8gc2NhbGU7CiAgICAgIGlmICh5MSkgewogICAgICAgIHZhciBjID0gYzEgKyB5LCBwID0gTWF0aC5zcXJ0KHggKiB4ICsgYyAqIGMpOwogICAgICAgIHkgPSBjMSArIHkxIC0gcDsKICAgICAgICB4ID0geDAgKyBwICogTWF0aC5hdGFuMih4LCBjKSAvIE1hdGguY29zKHkpOwogICAgICB9IGVsc2UgewogICAgICAgIHkgKj0gLTE7CiAgICAgICAgeCAvPSBNYXRoLmNvcyh5KTsKICAgICAgfQogICAgICByZXR1cm4gWyB4IC8gZDNfZ2VvX3JhZGlhbnMsIHkgLyBkM19nZW9fcmFkaWFucyBdOwogICAgfTsKICAgIGJvbm5lLnBhcmFsbGVsID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB5MSAvIGQzX2dlb19yYWRpYW5zOwogICAgICBjMSA9IDEgLyBNYXRoLnRhbih5MSA9IHggKiBkM19nZW9fcmFkaWFucyk7CiAgICAgIHJldHVybiBib25uZTsKICAgIH07CiAgICBib25uZS5vcmlnaW4gPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFsgeDAgLyBkM19nZW9fcmFkaWFucywgeTAgLyBkM19nZW9fcmFkaWFucyBdOwogICAgICB4MCA9IHhbMF0gKiBkM19nZW9fcmFkaWFuczsKICAgICAgeTAgPSB4WzFdICogZDNfZ2VvX3JhZGlhbnM7CiAgICAgIHJldHVybiBib25uZTsKICAgIH07CiAgICBib25uZS5zY2FsZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2NhbGU7CiAgICAgIHNjYWxlID0gK3g7CiAgICAgIHJldHVybiBib25uZTsKICAgIH07CiAgICBib25uZS50cmFuc2xhdGUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRyYW5zbGF0ZTsKICAgICAgdHJhbnNsYXRlID0gWyAreFswXSwgK3hbMV0gXTsKICAgICAgcmV0dXJuIGJvbm5lOwogICAgfTsKICAgIHJldHVybiBib25uZS5vcmlnaW4oWyAwLCAwIF0pLnBhcmFsbGVsKDQ1KTsKICB9OwogIGQzLmdlby5lcXVpcmVjdGFuZ3VsYXIgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGVxdWlyZWN0YW5ndWxhcihjb29yZGluYXRlcykgewogICAgICB2YXIgeCA9IGNvb3JkaW5hdGVzWzBdIC8gMzYwLCB5ID0gLWNvb3JkaW5hdGVzWzFdIC8gMzYwOwogICAgICByZXR1cm4gWyBzY2FsZSAqIHggKyB0cmFuc2xhdGVbMF0sIHNjYWxlICogeSArIHRyYW5zbGF0ZVsxXSBdOwogICAgfQogICAgdmFyIHNjYWxlID0gNTAwLCB0cmFuc2xhdGUgPSBbIDQ4MCwgMjUwIF07CiAgICBlcXVpcmVjdGFuZ3VsYXIuaW52ZXJ0ID0gZnVuY3Rpb24oY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIHggPSAoY29vcmRpbmF0ZXNbMF0gLSB0cmFuc2xhdGVbMF0pIC8gc2NhbGUsIHkgPSAoY29vcmRpbmF0ZXNbMV0gLSB0cmFuc2xhdGVbMV0pIC8gc2NhbGU7CiAgICAgIHJldHVybiBbIDM2MCAqIHgsIC0zNjAgKiB5IF07CiAgICB9OwogICAgZXF1aXJlY3Rhbmd1bGFyLnNjYWxlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzY2FsZTsKICAgICAgc2NhbGUgPSAreDsKICAgICAgcmV0dXJuIGVxdWlyZWN0YW5ndWxhcjsKICAgIH07CiAgICBlcXVpcmVjdGFuZ3VsYXIudHJhbnNsYXRlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiB0cmFuc2xhdGU7CiAgICAgIHRyYW5zbGF0ZSA9IFsgK3hbMF0sICt4WzFdIF07CiAgICAgIHJldHVybiBlcXVpcmVjdGFuZ3VsYXI7CiAgICB9OwogICAgcmV0dXJuIGVxdWlyZWN0YW5ndWxhcjsKICB9OwogIGQzLmdlby5tZXJjYXRvciA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gbWVyY2F0b3IoY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIHggPSBjb29yZGluYXRlc1swXSAvIDM2MCwgeSA9IC0oTWF0aC5sb2coTWF0aC50YW4oTWF0aC5QSSAvIDQgKyBjb29yZGluYXRlc1sxXSAqIGQzX2dlb19yYWRpYW5zIC8gMikpIC8gZDNfZ2VvX3JhZGlhbnMpIC8gMzYwOwogICAgICByZXR1cm4gWyBzY2FsZSAqIHggKyB0cmFuc2xhdGVbMF0sIHNjYWxlICogTWF0aC5tYXgoLS41LCBNYXRoLm1pbiguNSwgeSkpICsgdHJhbnNsYXRlWzFdIF07CiAgICB9CiAgICB2YXIgc2NhbGUgPSA1MDAsIHRyYW5zbGF0ZSA9IFsgNDgwLCAyNTAgXTsKICAgIG1lcmNhdG9yLmludmVydCA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzKSB7CiAgICAgIHZhciB4ID0gKGNvb3JkaW5hdGVzWzBdIC0gdHJhbnNsYXRlWzBdKSAvIHNjYWxlLCB5ID0gKGNvb3JkaW5hdGVzWzFdIC0gdHJhbnNsYXRlWzFdKSAvIHNjYWxlOwogICAgICByZXR1cm4gWyAzNjAgKiB4LCAyICogTWF0aC5hdGFuKE1hdGguZXhwKC0zNjAgKiB5ICogZDNfZ2VvX3JhZGlhbnMpKSAvIGQzX2dlb19yYWRpYW5zIC0gOTAgXTsKICAgIH07CiAgICBtZXJjYXRvci5zY2FsZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2NhbGU7CiAgICAgIHNjYWxlID0gK3g7CiAgICAgIHJldHVybiBtZXJjYXRvcjsKICAgIH07CiAgICBtZXJjYXRvci50cmFuc2xhdGUgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRyYW5zbGF0ZTsKICAgICAgdHJhbnNsYXRlID0gWyAreFswXSwgK3hbMV0gXTsKICAgICAgcmV0dXJuIG1lcmNhdG9yOwogICAgfTsKICAgIHJldHVybiBtZXJjYXRvcjsKICB9OwogIGQzLmdlby5wYXRoID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBwYXRoKGQsIGkpIHsKICAgICAgaWYgKHR5cGVvZiBwb2ludFJhZGl1cyA9PT0gImZ1bmN0aW9uIikgcG9pbnRDaXJjbGUgPSBkM19wYXRoX2NpcmNsZShwb2ludFJhZGl1cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgICAgcGF0aFR5cGUoZCk7CiAgICAgIHZhciByZXN1bHQgPSBidWZmZXIubGVuZ3RoID8gYnVmZmVyLmpvaW4oIiIpIDogbnVsbDsKICAgICAgYnVmZmVyID0gW107CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICBmdW5jdGlvbiBwcm9qZWN0KGNvb3JkaW5hdGVzKSB7CiAgICAgIHJldHVybiBwcm9qZWN0aW9uKGNvb3JkaW5hdGVzKS5qb2luKCIsIik7CiAgICB9CiAgICBmdW5jdGlvbiBwb2x5Z29uQXJlYShjb29yZGluYXRlcykgewogICAgICB2YXIgc3VtID0gYXJlYShjb29yZGluYXRlc1swXSksIGkgPSAwLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICB3aGlsZSAoKytpIDwgbikgc3VtIC09IGFyZWEoY29vcmRpbmF0ZXNbaV0pOwogICAgICByZXR1cm4gc3VtOwogICAgfQogICAgZnVuY3Rpb24gcG9seWdvbkNlbnRyb2lkKGNvb3JkaW5hdGVzKSB7CiAgICAgIHZhciBwb2x5Z29uID0gZDMuZ2VvbS5wb2x5Z29uKGNvb3JkaW5hdGVzWzBdLm1hcChwcm9qZWN0aW9uKSksIGFyZWEgPSBwb2x5Z29uLmFyZWEoKSwgY2VudHJvaWQgPSBwb2x5Z29uLmNlbnRyb2lkKGFyZWEgPCAwID8gKGFyZWEgKj0gLTEsIDEpIDogLTEpLCB4ID0gY2VudHJvaWRbMF0sIHkgPSBjZW50cm9pZFsxXSwgeiA9IGFyZWEsIGkgPSAwLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgIHBvbHlnb24gPSBkMy5nZW9tLnBvbHlnb24oY29vcmRpbmF0ZXNbaV0ubWFwKHByb2plY3Rpb24pKTsKICAgICAgICBhcmVhID0gcG9seWdvbi5hcmVhKCk7CiAgICAgICAgY2VudHJvaWQgPSBwb2x5Z29uLmNlbnRyb2lkKGFyZWEgPCAwID8gKGFyZWEgKj0gLTEsIDEpIDogLTEpOwogICAgICAgIHggLT0gY2VudHJvaWRbMF07CiAgICAgICAgeSAtPSBjZW50cm9pZFsxXTsKICAgICAgICB6IC09IGFyZWE7CiAgICAgIH0KICAgICAgcmV0dXJuIFsgeCwgeSwgNiAqIHogXTsKICAgIH0KICAgIGZ1bmN0aW9uIGFyZWEoY29vcmRpbmF0ZXMpIHsKICAgICAgcmV0dXJuIE1hdGguYWJzKGQzLmdlb20ucG9seWdvbihjb29yZGluYXRlcy5tYXAocHJvamVjdGlvbikpLmFyZWEoKSk7CiAgICB9CiAgICB2YXIgcG9pbnRSYWRpdXMgPSA0LjUsIHBvaW50Q2lyY2xlID0gZDNfcGF0aF9jaXJjbGUocG9pbnRSYWRpdXMpLCBwcm9qZWN0aW9uID0gZDMuZ2VvLmFsYmVyc1VzYSgpLCBidWZmZXIgPSBbXTsKICAgIHZhciBwYXRoVHlwZSA9IGQzX2dlb190eXBlKHsKICAgICAgRmVhdHVyZUNvbGxlY3Rpb246IGZ1bmN0aW9uKG8pIHsKICAgICAgICB2YXIgZmVhdHVyZXMgPSBvLmZlYXR1cmVzLCBpID0gLTEsIG4gPSBmZWF0dXJlcy5sZW5ndGg7CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIGJ1ZmZlci5wdXNoKHBhdGhUeXBlKGZlYXR1cmVzW2ldLmdlb21ldHJ5KSk7CiAgICAgIH0sCiAgICAgIEZlYXR1cmU6IGZ1bmN0aW9uKG8pIHsKICAgICAgICBwYXRoVHlwZShvLmdlb21ldHJ5KTsKICAgICAgfSwKICAgICAgUG9pbnQ6IGZ1bmN0aW9uKG8pIHsKICAgICAgICBidWZmZXIucHVzaCgiTSIsIHByb2plY3Qoby5jb29yZGluYXRlcyksIHBvaW50Q2lyY2xlKTsKICAgICAgfSwKICAgICAgTXVsdGlQb2ludDogZnVuY3Rpb24obykgewogICAgICAgIHZhciBjb29yZGluYXRlcyA9IG8uY29vcmRpbmF0ZXMsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aDsKICAgICAgICB3aGlsZSAoKytpIDwgbikgYnVmZmVyLnB1c2goIk0iLCBwcm9qZWN0KGNvb3JkaW5hdGVzW2ldKSwgcG9pbnRDaXJjbGUpOwogICAgICB9LAogICAgICBMaW5lU3RyaW5nOiBmdW5jdGlvbihvKSB7CiAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gby5jb29yZGluYXRlcywgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICAgIGJ1ZmZlci5wdXNoKCJNIik7CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIGJ1ZmZlci5wdXNoKHByb2plY3QoY29vcmRpbmF0ZXNbaV0pLCAiTCIpOwogICAgICAgIGJ1ZmZlci5wb3AoKTsKICAgICAgfSwKICAgICAgTXVsdGlMaW5lU3RyaW5nOiBmdW5jdGlvbihvKSB7CiAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gby5jb29yZGluYXRlcywgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoLCBzdWJjb29yZGluYXRlcywgaiwgbTsKICAgICAgICB3aGlsZSAoKytpIDwgbikgewogICAgICAgICAgc3ViY29vcmRpbmF0ZXMgPSBjb29yZGluYXRlc1tpXTsKICAgICAgICAgIGogPSAtMTsKICAgICAgICAgIG0gPSBzdWJjb29yZGluYXRlcy5sZW5ndGg7CiAgICAgICAgICBidWZmZXIucHVzaCgiTSIpOwogICAgICAgICAgd2hpbGUgKCsraiA8IG0pIGJ1ZmZlci5wdXNoKHByb2plY3Qoc3ViY29vcmRpbmF0ZXNbal0pLCAiTCIpOwogICAgICAgICAgYnVmZmVyLnBvcCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgUG9seWdvbjogZnVuY3Rpb24obykgewogICAgICAgIHZhciBjb29yZGluYXRlcyA9IG8uY29vcmRpbmF0ZXMsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aCwgc3ViY29vcmRpbmF0ZXMsIGosIG07CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICAgIHN1YmNvb3JkaW5hdGVzID0gY29vcmRpbmF0ZXNbaV07CiAgICAgICAgICBqID0gLTE7CiAgICAgICAgICBpZiAoKG0gPSBzdWJjb29yZGluYXRlcy5sZW5ndGggLSAxKSA+IDApIHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goIk0iKTsKICAgICAgICAgICAgd2hpbGUgKCsraiA8IG0pIGJ1ZmZlci5wdXNoKHByb2plY3Qoc3ViY29vcmRpbmF0ZXNbal0pLCAiTCIpOwogICAgICAgICAgICBidWZmZXJbYnVmZmVyLmxlbmd0aCAtIDFdID0gIloiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgTXVsdGlQb2x5Z29uOiBmdW5jdGlvbihvKSB7CiAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gby5jb29yZGluYXRlcywgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoLCBzdWJjb29yZGluYXRlcywgaiwgbSwgc3Vic3ViY29vcmRpbmF0ZXMsIGssIHA7CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICAgIHN1YmNvb3JkaW5hdGVzID0gY29vcmRpbmF0ZXNbaV07CiAgICAgICAgICBqID0gLTE7CiAgICAgICAgICBtID0gc3ViY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICAgICAgd2hpbGUgKCsraiA8IG0pIHsKICAgICAgICAgICAgc3Vic3ViY29vcmRpbmF0ZXMgPSBzdWJjb29yZGluYXRlc1tqXTsKICAgICAgICAgICAgayA9IC0xOwogICAgICAgICAgICBpZiAoKHAgPSBzdWJzdWJjb29yZGluYXRlcy5sZW5ndGggLSAxKSA+IDApIHsKICAgICAgICAgICAgICBidWZmZXIucHVzaCgiTSIpOwogICAgICAgICAgICAgIHdoaWxlICgrK2sgPCBwKSBidWZmZXIucHVzaChwcm9qZWN0KHN1YnN1YmNvb3JkaW5hdGVzW2tdKSwgIkwiKTsKICAgICAgICAgICAgICBidWZmZXJbYnVmZmVyLmxlbmd0aCAtIDFdID0gIloiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBHZW9tZXRyeUNvbGxlY3Rpb246IGZ1bmN0aW9uKG8pIHsKICAgICAgICB2YXIgZ2VvbWV0cmllcyA9IG8uZ2VvbWV0cmllcywgaSA9IC0xLCBuID0gZ2VvbWV0cmllcy5sZW5ndGg7CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIGJ1ZmZlci5wdXNoKHBhdGhUeXBlKGdlb21ldHJpZXNbaV0pKTsKICAgICAgfQogICAgfSk7CiAgICB2YXIgYXJlYVR5cGUgPSBwYXRoLmFyZWEgPSBkM19nZW9fdHlwZSh7CiAgICAgIEZlYXR1cmVDb2xsZWN0aW9uOiBmdW5jdGlvbihvKSB7CiAgICAgICAgdmFyIGFyZWEgPSAwLCBmZWF0dXJlcyA9IG8uZmVhdHVyZXMsIGkgPSAtMSwgbiA9IGZlYXR1cmVzLmxlbmd0aDsKICAgICAgICB3aGlsZSAoKytpIDwgbikgYXJlYSArPSBhcmVhVHlwZShmZWF0dXJlc1tpXSk7CiAgICAgICAgcmV0dXJuIGFyZWE7CiAgICAgIH0sCiAgICAgIEZlYXR1cmU6IGZ1bmN0aW9uKG8pIHsKICAgICAgICByZXR1cm4gYXJlYVR5cGUoby5nZW9tZXRyeSk7CiAgICAgIH0sCiAgICAgIFBvbHlnb246IGZ1bmN0aW9uKG8pIHsKICAgICAgICByZXR1cm4gcG9seWdvbkFyZWEoby5jb29yZGluYXRlcyk7CiAgICAgIH0sCiAgICAgIE11bHRpUG9seWdvbjogZnVuY3Rpb24obykgewogICAgICAgIHZhciBzdW0gPSAwLCBjb29yZGluYXRlcyA9IG8uY29vcmRpbmF0ZXMsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aDsKICAgICAgICB3aGlsZSAoKytpIDwgbikgc3VtICs9IHBvbHlnb25BcmVhKGNvb3JkaW5hdGVzW2ldKTsKICAgICAgICByZXR1cm4gc3VtOwogICAgICB9LAogICAgICBHZW9tZXRyeUNvbGxlY3Rpb246IGZ1bmN0aW9uKG8pIHsKICAgICAgICB2YXIgc3VtID0gMCwgZ2VvbWV0cmllcyA9IG8uZ2VvbWV0cmllcywgaSA9IC0xLCBuID0gZ2VvbWV0cmllcy5sZW5ndGg7CiAgICAgICAgd2hpbGUgKCsraSA8IG4pIHN1bSArPSBhcmVhVHlwZShnZW9tZXRyaWVzW2ldKTsKICAgICAgICByZXR1cm4gc3VtOwogICAgICB9CiAgICB9LCAwKTsKICAgIHZhciBjZW50cm9pZFR5cGUgPSBwYXRoLmNlbnRyb2lkID0gZDNfZ2VvX3R5cGUoewogICAgICBGZWF0dXJlOiBmdW5jdGlvbihvKSB7CiAgICAgICAgcmV0dXJuIGNlbnRyb2lkVHlwZShvLmdlb21ldHJ5KTsKICAgICAgfSwKICAgICAgUG9seWdvbjogZnVuY3Rpb24obykgewogICAgICAgIHZhciBjZW50cm9pZCA9IHBvbHlnb25DZW50cm9pZChvLmNvb3JkaW5hdGVzKTsKICAgICAgICByZXR1cm4gWyBjZW50cm9pZFswXSAvIGNlbnRyb2lkWzJdLCBjZW50cm9pZFsxXSAvIGNlbnRyb2lkWzJdIF07CiAgICAgIH0sCiAgICAgIE11bHRpUG9seWdvbjogZnVuY3Rpb24obykgewogICAgICAgIHZhciBhcmVhID0gMCwgY29vcmRpbmF0ZXMgPSBvLmNvb3JkaW5hdGVzLCBjZW50cm9pZCwgeCA9IDAsIHkgPSAwLCB6ID0gMCwgaSA9IC0xLCBuID0gY29vcmRpbmF0ZXMubGVuZ3RoOwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICBjZW50cm9pZCA9IHBvbHlnb25DZW50cm9pZChjb29yZGluYXRlc1tpXSk7CiAgICAgICAgICB4ICs9IGNlbnRyb2lkWzBdOwogICAgICAgICAgeSArPSBjZW50cm9pZFsxXTsKICAgICAgICAgIHogKz0gY2VudHJvaWRbMl07CiAgICAgICAgfQogICAgICAgIHJldHVybiBbIHggLyB6LCB5IC8geiBdOwogICAgICB9CiAgICB9KTsKICAgIHBhdGgucHJvamVjdGlvbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgcHJvamVjdGlvbiA9IHg7CiAgICAgIHJldHVybiBwYXRoOwogICAgfTsKICAgIHBhdGgucG9pbnRSYWRpdXMgPSBmdW5jdGlvbih4KSB7CiAgICAgIGlmICh0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIikgcG9pbnRSYWRpdXMgPSB4OyBlbHNlIHsKICAgICAgICBwb2ludFJhZGl1cyA9ICt4OwogICAgICAgIHBvaW50Q2lyY2xlID0gZDNfcGF0aF9jaXJjbGUocG9pbnRSYWRpdXMpOwogICAgICB9CiAgICAgIHJldHVybiBwYXRoOwogICAgfTsKICAgIHJldHVybiBwYXRoOwogIH07CiAgZDMuZ2VvLmJvdW5kcyA9IGZ1bmN0aW9uKGZlYXR1cmUpIHsKICAgIHZhciBsZWZ0ID0gSW5maW5pdHksIGJvdHRvbSA9IEluZmluaXR5LCByaWdodCA9IC1JbmZpbml0eSwgdG9wID0gLUluZmluaXR5OwogICAgZDNfZ2VvX2JvdW5kcyhmZWF0dXJlLCBmdW5jdGlvbih4LCB5KSB7CiAgICAgIGlmICh4IDwgbGVmdCkgbGVmdCA9IHg7CiAgICAgIGlmICh4ID4gcmlnaHQpIHJpZ2h0ID0geDsKICAgICAgaWYgKHkgPCBib3R0b20pIGJvdHRvbSA9IHk7CiAgICAgIGlmICh5ID4gdG9wKSB0b3AgPSB5OwogICAgfSk7CiAgICByZXR1cm4gWyBbIGxlZnQsIGJvdHRvbSBdLCBbIHJpZ2h0LCB0b3AgXSBdOwogIH07CiAgdmFyIGQzX2dlb19ib3VuZHNUeXBlcyA9IHsKICAgIEZlYXR1cmU6IGQzX2dlb19ib3VuZHNGZWF0dXJlLAogICAgRmVhdHVyZUNvbGxlY3Rpb246IGQzX2dlb19ib3VuZHNGZWF0dXJlQ29sbGVjdGlvbiwKICAgIEdlb21ldHJ5Q29sbGVjdGlvbjogZDNfZ2VvX2JvdW5kc0dlb21ldHJ5Q29sbGVjdGlvbiwKICAgIExpbmVTdHJpbmc6IGQzX2dlb19ib3VuZHNMaW5lU3RyaW5nLAogICAgTXVsdGlMaW5lU3RyaW5nOiBkM19nZW9fYm91bmRzTXVsdGlMaW5lU3RyaW5nLAogICAgTXVsdGlQb2ludDogZDNfZ2VvX2JvdW5kc0xpbmVTdHJpbmcsCiAgICBNdWx0aVBvbHlnb246IGQzX2dlb19ib3VuZHNNdWx0aVBvbHlnb24sCiAgICBQb2ludDogZDNfZ2VvX2JvdW5kc1BvaW50LAogICAgUG9seWdvbjogZDNfZ2VvX2JvdW5kc1BvbHlnb24KICB9OwogIGQzLmdlby5jaXJjbGUgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGNpcmNsZSgpIHt9CiAgICBmdW5jdGlvbiB2aXNpYmxlKHBvaW50KSB7CiAgICAgIHJldHVybiBhcmMuZGlzdGFuY2UocG9pbnQpIDwgcmFkaWFuczsKICAgIH0KICAgIGZ1bmN0aW9uIGNsaXAoY29vcmRpbmF0ZXMpIHsKICAgICAgdmFyIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aCwgY2xpcHBlZCA9IFtdLCBwMCwgcDEsIHAyLCBkMCwgZDE7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgZDEgPSBhcmMuZGlzdGFuY2UocDIgPSBjb29yZGluYXRlc1tpXSk7CiAgICAgICAgaWYgKGQxIDwgcmFkaWFucykgewogICAgICAgICAgaWYgKHAxKSBjbGlwcGVkLnB1c2goZDNfZ2VvX2dyZWF0QXJjSW50ZXJwb2xhdGUocDEsIHAyKSgoZDAgLSByYWRpYW5zKSAvIChkMCAtIGQxKSkpOwogICAgICAgICAgY2xpcHBlZC5wdXNoKHAyKTsKICAgICAgICAgIHAwID0gcDEgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwMSA9IHAyOwogICAgICAgICAgaWYgKCFwMCAmJiBjbGlwcGVkLmxlbmd0aCkgewogICAgICAgICAgICBjbGlwcGVkLnB1c2goZDNfZ2VvX2dyZWF0QXJjSW50ZXJwb2xhdGUoY2xpcHBlZFtjbGlwcGVkLmxlbmd0aCAtIDFdLCBwMSkoKHJhZGlhbnMgLSBkMCkgLyAoZDEgLSBkMCkpKTsKICAgICAgICAgICAgcDAgPSBwMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZDAgPSBkMTsKICAgICAgfQogICAgICBwMCA9IGNvb3JkaW5hdGVzWzBdOwogICAgICBwMSA9IGNsaXBwZWRbMF07CiAgICAgIGlmIChwMSAmJiBwMlswXSA9PT0gcDBbMF0gJiYgcDJbMV0gPT09IHAwWzFdICYmICEocDJbMF0gPT09IHAxWzBdICYmIHAyWzFdID09PSBwMVsxXSkpIHsKICAgICAgICBjbGlwcGVkLnB1c2gocDEpOwogICAgICB9CiAgICAgIHJldHVybiByZXNhbXBsZShjbGlwcGVkKTsKICAgIH0KICAgIGZ1bmN0aW9uIHJlc2FtcGxlKGNvb3JkaW5hdGVzKSB7CiAgICAgIHZhciBpID0gMCwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aCwgaiwgbSwgcmVzYW1wbGVkID0gbiA\/IFsgY29vcmRpbmF0ZXNbMF0gXSA6IGNvb3JkaW5hdGVzLCByZXNhbXBsZXMsIG9yaWdpbiA9IGFyYy5zb3VyY2UoKTsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICByZXNhbXBsZXMgPSBhcmMuc291cmNlKGNvb3JkaW5hdGVzW2kgLSAxXSkoY29vcmRpbmF0ZXNbaV0pLmNvb3JkaW5hdGVzOwogICAgICAgIGZvciAoaiA9IDAsIG0gPSByZXNhbXBsZXMubGVuZ3RoOyArK2ogPCBtOyApIHJlc2FtcGxlZC5wdXNoKHJlc2FtcGxlc1tqXSk7CiAgICAgIH0KICAgICAgYXJjLnNvdXJjZShvcmlnaW4pOwogICAgICByZXR1cm4gcmVzYW1wbGVkOwogICAgfQogICAgdmFyIG9yaWdpbiA9IFsgMCwgMCBdLCBkZWdyZWVzID0gOTAgLSAuMDEsIHJhZGlhbnMgPSBkZWdyZWVzICogZDNfZ2VvX3JhZGlhbnMsIGFyYyA9IGQzLmdlby5ncmVhdEFyYygpLnNvdXJjZShvcmlnaW4pLnRhcmdldChkM19pZGVudGl0eSk7CiAgICBjaXJjbGUuY2xpcCA9IGZ1bmN0aW9uKGQpIHsKICAgICAgaWYgKHR5cGVvZiBvcmlnaW4gPT09ICJmdW5jdGlvbiIpIGFyYy5zb3VyY2Uob3JpZ2luLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICByZXR1cm4gY2xpcFR5cGUoZCkgfHwgbnVsbDsKICAgIH07CiAgICB2YXIgY2xpcFR5cGUgPSBkM19nZW9fdHlwZSh7CiAgICAgIEZlYXR1cmVDb2xsZWN0aW9uOiBmdW5jdGlvbihvKSB7CiAgICAgICAgdmFyIGZlYXR1cmVzID0gby5mZWF0dXJlcy5tYXAoY2xpcFR5cGUpLmZpbHRlcihkM19pZGVudGl0eSk7CiAgICAgICAgcmV0dXJuIGZlYXR1cmVzICYmIChvID0gT2JqZWN0LmNyZWF0ZShvKSwgby5mZWF0dXJlcyA9IGZlYXR1cmVzLCBvKTsKICAgICAgfSwKICAgICAgRmVhdHVyZTogZnVuY3Rpb24obykgewogICAgICAgIHZhciBnZW9tZXRyeSA9IGNsaXBUeXBlKG8uZ2VvbWV0cnkpOwogICAgICAgIHJldHVybiBnZW9tZXRyeSAmJiAobyA9IE9iamVjdC5jcmVhdGUobyksIG8uZ2VvbWV0cnkgPSBnZW9tZXRyeSwgbyk7CiAgICAgIH0sCiAgICAgIFBvaW50OiBmdW5jdGlvbihvKSB7CiAgICAgICAgcmV0dXJuIHZpc2libGUoby5jb29yZGluYXRlcykgJiYgbzsKICAgICAgfSwKICAgICAgTXVsdGlQb2ludDogZnVuY3Rpb24obykgewogICAgICAgIHZhciBjb29yZGluYXRlcyA9IG8uY29vcmRpbmF0ZXMuZmlsdGVyKHZpc2libGUpOwogICAgICAgIHJldHVybiBjb29yZGluYXRlcy5sZW5ndGggJiYgewogICAgICAgICAgdHlwZTogby50eXBlLAogICAgICAgICAgY29vcmRpbmF0ZXM6IGNvb3JkaW5hdGVzCiAgICAgICAgfTsKICAgICAgfSwKICAgICAgTGluZVN0cmluZzogZnVuY3Rpb24obykgewogICAgICAgIHZhciBjb29yZGluYXRlcyA9IGNsaXAoby5jb29yZGluYXRlcyk7CiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzLmxlbmd0aCAmJiAobyA9IE9iamVjdC5jcmVhdGUobyksIG8uY29vcmRpbmF0ZXMgPSBjb29yZGluYXRlcywgbyk7CiAgICAgIH0sCiAgICAgIE11bHRpTGluZVN0cmluZzogZnVuY3Rpb24obykgewogICAgICAgIHZhciBjb29yZGluYXRlcyA9IG8uY29vcmRpbmF0ZXMubWFwKGNsaXApLmZpbHRlcihmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gZC5sZW5ndGg7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzLmxlbmd0aCAmJiAobyA9IE9iamVjdC5jcmVhdGUobyksIG8uY29vcmRpbmF0ZXMgPSBjb29yZGluYXRlcywgbyk7CiAgICAgIH0sCiAgICAgIFBvbHlnb246IGZ1bmN0aW9uKG8pIHsKICAgICAgICB2YXIgY29vcmRpbmF0ZXMgPSBvLmNvb3JkaW5hdGVzLm1hcChjbGlwKTsKICAgICAgICByZXR1cm4gY29vcmRpbmF0ZXNbMF0ubGVuZ3RoICYmIChvID0gT2JqZWN0LmNyZWF0ZShvKSwgby5jb29yZGluYXRlcyA9IGNvb3JkaW5hdGVzLCBvKTsKICAgICAgfSwKICAgICAgTXVsdGlQb2x5Z29uOiBmdW5jdGlvbihvKSB7CiAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gby5jb29yZGluYXRlcy5tYXAoZnVuY3Rpb24oZCkgewogICAgICAgICAgcmV0dXJuIGQubWFwKGNsaXApOwogICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbihkKSB7CiAgICAgICAgICByZXR1cm4gZFswXS5sZW5ndGg7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNvb3JkaW5hdGVzLmxlbmd0aCAmJiAobyA9IE9iamVjdC5jcmVhdGUobyksIG8uY29vcmRpbmF0ZXMgPSBjb29yZGluYXRlcywgbyk7CiAgICAgIH0sCiAgICAgIEdlb21ldHJ5Q29sbGVjdGlvbjogZnVuY3Rpb24obykgewogICAgICAgIHZhciBnZW9tZXRyaWVzID0gby5nZW9tZXRyaWVzLm1hcChjbGlwVHlwZSkuZmlsdGVyKGQzX2lkZW50aXR5KTsKICAgICAgICByZXR1cm4gZ2VvbWV0cmllcy5sZW5ndGggJiYgKG8gPSBPYmplY3QuY3JlYXRlKG8pLCBvLmdlb21ldHJpZXMgPSBnZW9tZXRyaWVzLCBvKTsKICAgICAgfQogICAgfSk7CiAgICBjaXJjbGUub3JpZ2luID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvcmlnaW47CiAgICAgIG9yaWdpbiA9IHg7CiAgICAgIGlmICh0eXBlb2Ygb3JpZ2luICE9PSAiZnVuY3Rpb24iKSBhcmMuc291cmNlKG9yaWdpbik7CiAgICAgIHJldHVybiBjaXJjbGU7CiAgICB9OwogICAgY2lyY2xlLmFuZ2xlID0gZnVuY3Rpb24oeCkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkZWdyZWVzOwogICAgICByYWRpYW5zID0gKGRlZ3JlZXMgPSAreCkgKiBkM19nZW9fcmFkaWFuczsKICAgICAgcmV0dXJuIGNpcmNsZTsKICAgIH07CiAgICByZXR1cm4gZDMucmViaW5kKGNpcmNsZSwgYXJjLCAicHJlY2lzaW9uIik7CiAgfTsKICBkMy5nZW8uZ3JlYXRBcmMgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGdyZWF0QXJjKCkgewogICAgICB2YXIgZCA9IGdyZWF0QXJjLmRpc3RhbmNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHQgPSAwLCBkdCA9IHByZWNpc2lvbiAvIGQsIGNvb3JkaW5hdGVzID0gWyBwMCBdOwogICAgICB3aGlsZSAoKHQgKz0gZHQpIDwgMSkgY29vcmRpbmF0ZXMucHVzaChpbnRlcnBvbGF0ZSh0KSk7CiAgICAgIGNvb3JkaW5hdGVzLnB1c2gocDEpOwogICAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICJMaW5lU3RyaW5nIiwKICAgICAgICBjb29yZGluYXRlczogY29vcmRpbmF0ZXMKICAgICAgfTsKICAgIH0KICAgIHZhciBzb3VyY2UgPSBkM19nZW9fZ3JlYXRBcmNTb3VyY2UsIHAwLCB0YXJnZXQgPSBkM19nZW9fZ3JlYXRBcmNUYXJnZXQsIHAxLCBwcmVjaXNpb24gPSA2ICogZDNfZ2VvX3JhZGlhbnMsIGludGVycG9sYXRlID0gZDNfZ2VvX2dyZWF0QXJjSW50ZXJwb2xhdG9yKCk7CiAgICBncmVhdEFyYy5kaXN0YW5jZSA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAodHlwZW9mIHNvdXJjZSA9PT0gImZ1bmN0aW9uIikgaW50ZXJwb2xhdGUuc291cmNlKHAwID0gc291cmNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gImZ1bmN0aW9uIikgaW50ZXJwb2xhdGUudGFyZ2V0KHAxID0gdGFyZ2V0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpOwogICAgICByZXR1cm4gaW50ZXJwb2xhdGUuZGlzdGFuY2UoKTsKICAgIH07CiAgICBncmVhdEFyYy5zb3VyY2UgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNvdXJjZTsKICAgICAgc291cmNlID0gXzsKICAgICAgaWYgKHR5cGVvZiBzb3VyY2UgIT09ICJmdW5jdGlvbiIpIGludGVycG9sYXRlLnNvdXJjZShwMCA9IHNvdXJjZSk7CiAgICAgIHJldHVybiBncmVhdEFyYzsKICAgIH07CiAgICBncmVhdEFyYy50YXJnZXQgPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHRhcmdldDsKICAgICAgdGFyZ2V0ID0gXzsKICAgICAgaWYgKHR5cGVvZiB0YXJnZXQgIT09ICJmdW5jdGlvbiIpIGludGVycG9sYXRlLnRhcmdldChwMSA9IHRhcmdldCk7CiAgICAgIHJldHVybiBncmVhdEFyYzsKICAgIH07CiAgICBncmVhdEFyYy5wcmVjaXNpb24gPSBmdW5jdGlvbihfKSB7CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHByZWNpc2lvbiAvIGQzX2dlb19yYWRpYW5zOwogICAgICBwcmVjaXNpb24gPSBfICogZDNfZ2VvX3JhZGlhbnM7CiAgICAgIHJldHVybiBncmVhdEFyYzsKICAgIH07CiAgICByZXR1cm4gZ3JlYXRBcmM7CiAgfTsKICBkMy5nZW8uZ3JlYXRDaXJjbGUgPSBkMy5nZW8uY2lyY2xlOwogIGQzLmdlb20gPSB7fTsKICBkMy5nZW9tLmNvbnRvdXIgPSBmdW5jdGlvbihncmlkLCBzdGFydCkgewogICAgdmFyIHMgPSBzdGFydCB8fCBkM19nZW9tX2NvbnRvdXJTdGFydChncmlkKSwgYyA9IFtdLCB4ID0gc1swXSwgeSA9IHNbMV0sIGR4ID0gMCwgZHkgPSAwLCBwZHggPSBOYU4sIHBkeSA9IE5hTiwgaSA9IDA7CiAgICBkbyB7CiAgICAgIGkgPSAwOwogICAgICBpZiAoZ3JpZCh4IC0gMSwgeSAtIDEpKSBpICs9IDE7CiAgICAgIGlmIChncmlkKHgsIHkgLSAxKSkgaSArPSAyOwogICAgICBpZiAoZ3JpZCh4IC0gMSwgeSkpIGkgKz0gNDsKICAgICAgaWYgKGdyaWQoeCwgeSkpIGkgKz0gODsKICAgICAgaWYgKGkgPT09IDYpIHsKICAgICAgICBkeCA9IHBkeSA9PT0gLTEgPyAtMSA6IDE7CiAgICAgICAgZHkgPSAwOwogICAgICB9IGVsc2UgaWYgKGkgPT09IDkpIHsKICAgICAgICBkeCA9IDA7CiAgICAgICAgZHkgPSBwZHggPT09IDEgPyAtMSA6IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZHggPSBkM19nZW9tX2NvbnRvdXJEeFtpXTsKICAgICAgICBkeSA9IGQzX2dlb21fY29udG91ckR5W2ldOwogICAgICB9CiAgICAgIGlmIChkeCAhPSBwZHggJiYgZHkgIT0gcGR5KSB7CiAgICAgICAgYy5wdXNoKFsgeCwgeSBdKTsKICAgICAgICBwZHggPSBkeDsKICAgICAgICBwZHkgPSBkeTsKICAgICAgfQogICAgICB4ICs9IGR4OwogICAgICB5ICs9IGR5OwogICAgfSB3aGlsZSAoc1swXSAhPSB4IHx8IHNbMV0gIT0geSk7CiAgICByZXR1cm4gYzsKICB9OwogIHZhciBkM19nZW9tX2NvbnRvdXJEeCA9IFsgMSwgMCwgMSwgMSwgLTEsIDAsIC0xLCAxLCAwLCAwLCAwLCAwLCAtMSwgMCwgLTEsIE5hTiBdLCBkM19nZW9tX2NvbnRvdXJEeSA9IFsgMCwgLTEsIDAsIDAsIDAsIC0xLCAwLCAwLCAxLCAtMSwgMSwgMSwgMCwgLTEsIDAsIE5hTiBdOwogIGQzLmdlb20uaHVsbCA9IGZ1bmN0aW9uKHZlcnRpY2VzKSB7CiAgICBpZiAodmVydGljZXMubGVuZ3RoIDwgMykgcmV0dXJuIFtdOwogICAgdmFyIGxlbiA9IHZlcnRpY2VzLmxlbmd0aCwgcGxlbiA9IGxlbiAtIDEsIHBvaW50cyA9IFtdLCBzdGFjayA9IFtdLCBpLCBqLCBoID0gMCwgeDEsIHkxLCB4MiwgeTIsIHUsIHYsIGEsIHNwOwogICAgZm9yIChpID0gMTsgaSA8IGxlbjsgKytpKSB7CiAgICAgIGlmICh2ZXJ0aWNlc1tpXVsxXSA8IHZlcnRpY2VzW2hdWzFdKSB7CiAgICAgICAgaCA9IGk7CiAgICAgIH0gZWxzZSBpZiAodmVydGljZXNbaV1bMV0gPT0gdmVydGljZXNbaF1bMV0pIHsKICAgICAgICBoID0gdmVydGljZXNbaV1bMF0gPCB2ZXJ0aWNlc1toXVswXSA\/IGkgOiBoOwogICAgICB9CiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyArK2kpIHsKICAgICAgaWYgKGkgPT09IGgpIGNvbnRpbnVlOwogICAgICB5MSA9IHZlcnRpY2VzW2ldWzFdIC0gdmVydGljZXNbaF1bMV07CiAgICAgIHgxID0gdmVydGljZXNbaV1bMF0gLSB2ZXJ0aWNlc1toXVswXTsKICAgICAgcG9pbnRzLnB1c2goewogICAgICAgIGFuZ2xlOiBNYXRoLmF0YW4yKHkxLCB4MSksCiAgICAgICAgaW5kZXg6IGkKICAgICAgfSk7CiAgICB9CiAgICBwb2ludHMuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgIHJldHVybiBhLmFuZ2xlIC0gYi5hbmdsZTsKICAgIH0pOwogICAgYSA9IHBvaW50c1swXS5hbmdsZTsKICAgIHYgPSBwb2ludHNbMF0uaW5kZXg7CiAgICB1ID0gMDsKICAgIGZvciAoaSA9IDE7IGkgPCBwbGVuOyArK2kpIHsKICAgICAgaiA9IHBvaW50c1tpXS5pbmRleDsKICAgICAgaWYgKGEgPT0gcG9pbnRzW2ldLmFuZ2xlKSB7CiAgICAgICAgeDEgPSB2ZXJ0aWNlc1t2XVswXSAtIHZlcnRpY2VzW2hdWzBdOwogICAgICAgIHkxID0gdmVydGljZXNbdl1bMV0gLSB2ZXJ0aWNlc1toXVsxXTsKICAgICAgICB4MiA9IHZlcnRpY2VzW2pdWzBdIC0gdmVydGljZXNbaF1bMF07CiAgICAgICAgeTIgPSB2ZXJ0aWNlc1tqXVsxXSAtIHZlcnRpY2VzW2hdWzFdOwogICAgICAgIGlmICh4MSAqIHgxICsgeTEgKiB5MSA+PSB4MiAqIHgyICsgeTIgKiB5MikgewogICAgICAgICAgcG9pbnRzW2ldLmluZGV4ID0gLTE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBvaW50c1t1XS5pbmRleCA9IC0xOwogICAgICAgICAgYSA9IHBvaW50c1tpXS5hbmdsZTsKICAgICAgICAgIHUgPSBpOwogICAgICAgICAgdiA9IGo7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGEgPSBwb2ludHNbaV0uYW5nbGU7CiAgICAgICAgdSA9IGk7CiAgICAgICAgdiA9IGo7CiAgICAgIH0KICAgIH0KICAgIHN0YWNrLnB1c2goaCk7CiAgICBmb3IgKGkgPSAwLCBqID0gMDsgaSA8IDI7ICsraikgewogICAgICBpZiAocG9pbnRzW2pdLmluZGV4ICE9PSAtMSkgewogICAgICAgIHN0YWNrLnB1c2gocG9pbnRzW2pdLmluZGV4KTsKICAgICAgICBpKys7CiAgICAgIH0KICAgIH0KICAgIHNwID0gc3RhY2subGVuZ3RoOwogICAgZm9yICg7IGogPCBwbGVuOyArK2opIHsKICAgICAgaWYgKHBvaW50c1tqXS5pbmRleCA9PT0gLTEpIGNvbnRpbnVlOwogICAgICB3aGlsZSAoIWQzX2dlb21faHVsbENDVyhzdGFja1tzcCAtIDJdLCBzdGFja1tzcCAtIDFdLCBwb2ludHNbal0uaW5kZXgsIHZlcnRpY2VzKSkgewogICAgICAgIC0tc3A7CiAgICAgIH0KICAgICAgc3RhY2tbc3ArK10gPSBwb2ludHNbal0uaW5kZXg7CiAgICB9CiAgICB2YXIgcG9seSA9IFtdOwogICAgZm9yIChpID0gMDsgaSA8IHNwOyArK2kpIHsKICAgICAgcG9seS5wdXNoKHZlcnRpY2VzW3N0YWNrW2ldXSk7CiAgICB9CiAgICByZXR1cm4gcG9seTsKICB9OwogIGQzLmdlb20ucG9seWdvbiA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzKSB7CiAgICBjb29yZGluYXRlcy5hcmVhID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBpID0gMCwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aCwgYSA9IGNvb3JkaW5hdGVzW24gLSAxXVswXSAqIGNvb3JkaW5hdGVzWzBdWzFdLCBiID0gY29vcmRpbmF0ZXNbbiAtIDFdWzFdICogY29vcmRpbmF0ZXNbMF1bMF07CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgYSArPSBjb29yZGluYXRlc1tpIC0gMV1bMF0gKiBjb29yZGluYXRlc1tpXVsxXTsKICAgICAgICBiICs9IGNvb3JkaW5hdGVzW2kgLSAxXVsxXSAqIGNvb3JkaW5hdGVzW2ldWzBdOwogICAgICB9CiAgICAgIHJldHVybiAoYiAtIGEpICogLjU7CiAgICB9OwogICAgY29vcmRpbmF0ZXMuY2VudHJvaWQgPSBmdW5jdGlvbihrKSB7CiAgICAgIHZhciBpID0gLTEsIG4gPSBjb29yZGluYXRlcy5sZW5ndGgsIHggPSAwLCB5ID0gMCwgYSwgYiA9IGNvb3JkaW5hdGVzW24gLSAxXSwgYzsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSBrID0gLTEgLyAoNiAqIGNvb3JkaW5hdGVzLmFyZWEoKSk7CiAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgYSA9IGI7CiAgICAgICAgYiA9IGNvb3JkaW5hdGVzW2ldOwogICAgICAgIGMgPSBhWzBdICogYlsxXSAtIGJbMF0gKiBhWzFdOwogICAgICAgIHggKz0gKGFbMF0gKyBiWzBdKSAqIGM7CiAgICAgICAgeSArPSAoYVsxXSArIGJbMV0pICogYzsKICAgICAgfQogICAgICByZXR1cm4gWyB4ICogaywgeSAqIGsgXTsKICAgIH07CiAgICBjb29yZGluYXRlcy5jbGlwID0gZnVuY3Rpb24oc3ViamVjdCkgewogICAgICB2YXIgaW5wdXQsIGkgPSAtMSwgbiA9IGNvb3JkaW5hdGVzLmxlbmd0aCwgaiwgbSwgYSA9IGNvb3JkaW5hdGVzW24gLSAxXSwgYiwgYywgZDsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpbnB1dCA9IHN1YmplY3Quc2xpY2UoKTsKICAgICAgICBzdWJqZWN0Lmxlbmd0aCA9IDA7CiAgICAgICAgYiA9IGNvb3JkaW5hdGVzW2ldOwogICAgICAgIGMgPSBpbnB1dFsobSA9IGlucHV0Lmxlbmd0aCkgLSAxXTsKICAgICAgICBqID0gLTE7CiAgICAgICAgd2hpbGUgKCsraiA8IG0pIHsKICAgICAgICAgIGQgPSBpbnB1dFtqXTsKICAgICAgICAgIGlmIChkM19nZW9tX3BvbHlnb25JbnNpZGUoZCwgYSwgYikpIHsKICAgICAgICAgICAgaWYgKCFkM19nZW9tX3BvbHlnb25JbnNpZGUoYywgYSwgYikpIHsKICAgICAgICAgICAgICBzdWJqZWN0LnB1c2goZDNfZ2VvbV9wb2x5Z29uSW50ZXJzZWN0KGMsIGQsIGEsIGIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWJqZWN0LnB1c2goZCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGQzX2dlb21fcG9seWdvbkluc2lkZShjLCBhLCBiKSkgewogICAgICAgICAgICBzdWJqZWN0LnB1c2goZDNfZ2VvbV9wb2x5Z29uSW50ZXJzZWN0KGMsIGQsIGEsIGIpKTsKICAgICAgICAgIH0KICAgICAgICAgIGMgPSBkOwogICAgICAgIH0KICAgICAgICBhID0gYjsKICAgICAgfQogICAgICByZXR1cm4gc3ViamVjdDsKICAgIH07CiAgICByZXR1cm4gY29vcmRpbmF0ZXM7CiAgfTsKICBkMy5nZW9tLnZvcm9ub2kgPSBmdW5jdGlvbih2ZXJ0aWNlcykgewogICAgdmFyIHBvbHlnb25zID0gdmVydGljZXMubWFwKGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gW107CiAgICB9KTsKICAgIGQzX3Zvcm9ub2lfdGVzc2VsbGF0ZSh2ZXJ0aWNlcywgZnVuY3Rpb24oZSkgewogICAgICB2YXIgczEsIHMyLCB4MSwgeDIsIHkxLCB5MjsKICAgICAgaWYgKGUuYSA9PT0gMSAmJiBlLmIgPj0gMCkgewogICAgICAgIHMxID0gZS5lcC5yOwogICAgICAgIHMyID0gZS5lcC5sOwogICAgICB9IGVsc2UgewogICAgICAgIHMxID0gZS5lcC5sOwogICAgICAgIHMyID0gZS5lcC5yOwogICAgICB9CiAgICAgIGlmIChlLmEgPT09IDEpIHsKICAgICAgICB5MSA9IHMxID8gczEueSA6IC0xZTY7CiAgICAgICAgeDEgPSBlLmMgLSBlLmIgKiB5MTsKICAgICAgICB5MiA9IHMyID8gczIueSA6IDFlNjsKICAgICAgICB4MiA9IGUuYyAtIGUuYiAqIHkyOwogICAgICB9IGVsc2UgewogICAgICAgIHgxID0gczEgPyBzMS54IDogLTFlNjsKICAgICAgICB5MSA9IGUuYyAtIGUuYSAqIHgxOwogICAgICAgIHgyID0gczIgPyBzMi54IDogMWU2OwogICAgICAgIHkyID0gZS5jIC0gZS5hICogeDI7CiAgICAgIH0KICAgICAgdmFyIHYxID0gWyB4MSwgeTEgXSwgdjIgPSBbIHgyLCB5MiBdOwogICAgICBwb2x5Z29uc1tlLnJlZ2lvbi5sLmluZGV4XS5wdXNoKHYxLCB2Mik7CiAgICAgIHBvbHlnb25zW2UucmVnaW9uLnIuaW5kZXhdLnB1c2godjEsIHYyKTsKICAgIH0pOwogICAgcmV0dXJuIHBvbHlnb25zLm1hcChmdW5jdGlvbihwb2x5Z29uLCBpKSB7CiAgICAgIHZhciBjeCA9IHZlcnRpY2VzW2ldWzBdLCBjeSA9IHZlcnRpY2VzW2ldWzFdOwogICAgICBwb2x5Z29uLmZvckVhY2goZnVuY3Rpb24odikgewogICAgICAgIHYuYW5nbGUgPSBNYXRoLmF0YW4yKHZbMF0gLSBjeCwgdlsxXSAtIGN5KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBwb2x5Z29uLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgIHJldHVybiBhLmFuZ2xlIC0gYi5hbmdsZTsKICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uKGQsIGkpIHsKICAgICAgICByZXR1cm4gIWkgfHwgZC5hbmdsZSAtIHBvbHlnb25baSAtIDFdLmFuZ2xlID4gMWUtMTA7CiAgICAgIH0pOwogICAgfSk7CiAgfTsKICB2YXIgZDNfdm9yb25vaV9vcHBvc2l0ZSA9IHsKICAgIGw6ICJyIiwKICAgIHI6ICJsIgogIH07CiAgZDMuZ2VvbS5kZWxhdW5heSA9IGZ1bmN0aW9uKHZlcnRpY2VzKSB7CiAgICB2YXIgZWRnZXMgPSB2ZXJ0aWNlcy5tYXAoZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0pLCB0cmlhbmdsZXMgPSBbXTsKICAgIGQzX3Zvcm9ub2lfdGVzc2VsbGF0ZSh2ZXJ0aWNlcywgZnVuY3Rpb24oZSkgewogICAgICBlZGdlc1tlLnJlZ2lvbi5sLmluZGV4XS5wdXNoKHZlcnRpY2VzW2UucmVnaW9uLnIuaW5kZXhdKTsKICAgIH0pOwogICAgZWRnZXMuZm9yRWFjaChmdW5jdGlvbihlZGdlLCBpKSB7CiAgICAgIHZhciB2ID0gdmVydGljZXNbaV0sIGN4ID0gdlswXSwgY3kgPSB2WzFdOwogICAgICBlZGdlLmZvckVhY2goZnVuY3Rpb24odikgewogICAgICAgIHYuYW5nbGUgPSBNYXRoLmF0YW4yKHZbMF0gLSBjeCwgdlsxXSAtIGN5KTsKICAgICAgfSk7CiAgICAgIGVkZ2Uuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuYW5nbGUgLSBiLmFuZ2xlOwogICAgICB9KTsKICAgICAgZm9yICh2YXIgaiA9IDAsIG0gPSBlZGdlLmxlbmd0aCAtIDE7IGogPCBtOyBqKyspIHsKICAgICAgICB0cmlhbmdsZXMucHVzaChbIHYsIGVkZ2Vbal0sIGVkZ2VbaiArIDFdIF0pOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB0cmlhbmdsZXM7CiAgfTsKICBkMy5nZW9tLnF1YWR0cmVlID0gZnVuY3Rpb24ocG9pbnRzLCB4MSwgeTEsIHgyLCB5MikgewogICAgZnVuY3Rpb24gaW5zZXJ0KG4sIHAsIHgxLCB5MSwgeDIsIHkyKSB7CiAgICAgIGlmIChpc05hTihwLngpIHx8IGlzTmFOKHAueSkpIHJldHVybjsKICAgICAgaWYgKG4ubGVhZikgewogICAgICAgIHZhciB2ID0gbi5wb2ludDsKICAgICAgICBpZiAodikgewogICAgICAgICAgaWYgKE1hdGguYWJzKHYueCAtIHAueCkgKyBNYXRoLmFicyh2LnkgLSBwLnkpIDwgLjAxKSB7CiAgICAgICAgICAgIGluc2VydENoaWxkKG4sIHAsIHgxLCB5MSwgeDIsIHkyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG4ucG9pbnQgPSBudWxsOwogICAgICAgICAgICBpbnNlcnRDaGlsZChuLCB2LCB4MSwgeTEsIHgyLCB5Mik7CiAgICAgICAgICAgIGluc2VydENoaWxkKG4sIHAsIHgxLCB5MSwgeDIsIHkyKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbi5wb2ludCA9IHA7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGluc2VydENoaWxkKG4sIHAsIHgxLCB5MSwgeDIsIHkyKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaW5zZXJ0Q2hpbGQobiwgcCwgeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgdmFyIHN4ID0gKHgxICsgeDIpICogLjUsIHN5ID0gKHkxICsgeTIpICogLjUsIHJpZ2h0ID0gcC54ID49IHN4LCBib3R0b20gPSBwLnkgPj0gc3ksIGkgPSAoYm90dG9tIDw8IDEpICsgcmlnaHQ7CiAgICAgIG4ubGVhZiA9IGZhbHNlOwogICAgICBuID0gbi5ub2Rlc1tpXSB8fCAobi5ub2Rlc1tpXSA9IGQzX2dlb21fcXVhZHRyZWVOb2RlKCkpOwogICAgICBpZiAocmlnaHQpIHgxID0gc3g7IGVsc2UgeDIgPSBzeDsKICAgICAgaWYgKGJvdHRvbSkgeTEgPSBzeTsgZWxzZSB5MiA9IHN5OwogICAgICBpbnNlcnQobiwgcCwgeDEsIHkxLCB4MiwgeTIpOwogICAgfQogICAgdmFyIHAsIGkgPSAtMSwgbiA9IHBvaW50cy5sZW5ndGg7CiAgICBpZiAobiAmJiBpc05hTihwb2ludHNbMF0ueCkpIHBvaW50cyA9IHBvaW50cy5tYXAoZDNfZ2VvbV9xdWFkdHJlZVBvaW50KTsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgNSkgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMykgewogICAgICAgIHkyID0geDIgPSB5MTsKICAgICAgICB5MSA9IHgxOwogICAgICB9IGVsc2UgewogICAgICAgIHgxID0geTEgPSBJbmZpbml0eTsKICAgICAgICB4MiA9IHkyID0gLUluZmluaXR5OwogICAgICAgIHdoaWxlICgrK2kgPCBuKSB7CiAgICAgICAgICBwID0gcG9pbnRzW2ldOwogICAgICAgICAgaWYgKHAueCA8IHgxKSB4MSA9IHAueDsKICAgICAgICAgIGlmIChwLnkgPCB5MSkgeTEgPSBwLnk7CiAgICAgICAgICBpZiAocC54ID4geDIpIHgyID0gcC54OwogICAgICAgICAgaWYgKHAueSA+IHkyKSB5MiA9IHAueTsKICAgICAgICB9CiAgICAgICAgdmFyIGR4ID0geDIgLSB4MSwgZHkgPSB5MiAtIHkxOwogICAgICAgIGlmIChkeCA+IGR5KSB5MiA9IHkxICsgZHg7IGVsc2UgeDIgPSB4MSArIGR5OwogICAgICB9CiAgICB9CiAgICB2YXIgcm9vdCA9IGQzX2dlb21fcXVhZHRyZWVOb2RlKCk7CiAgICByb290LmFkZCA9IGZ1bmN0aW9uKHApIHsKICAgICAgaW5zZXJ0KHJvb3QsIHAsIHgxLCB5MSwgeDIsIHkyKTsKICAgIH07CiAgICByb290LnZpc2l0ID0gZnVuY3Rpb24oZikgewogICAgICBkM19nZW9tX3F1YWR0cmVlVmlzaXQoZiwgcm9vdCwgeDEsIHkxLCB4MiwgeTIpOwogICAgfTsKICAgIHBvaW50cy5mb3JFYWNoKHJvb3QuYWRkKTsKICAgIHJldHVybiByb290OwogIH07CiAgZDMudGltZSA9IHt9OwogIHZhciBkM190aW1lID0gRGF0ZSwgZDNfdGltZV9kYXlTeW1ib2xzID0gWyAiU3VuZGF5IiwgIk1vbmRheSIsICJUdWVzZGF5IiwgIldlZG5lc2RheSIsICJUaHVyc2RheSIsICJGcmlkYXkiLCAiU2F0dXJkYXkiIF07CiAgZDNfdGltZV91dGMucHJvdG90eXBlID0gewogICAgZ2V0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl8uZ2V0VVRDRGF0ZSgpOwogICAgfSwKICAgIGdldERheTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl8uZ2V0VVRDRGF5KCk7CiAgICB9LAogICAgZ2V0RnVsbFllYXI6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLmdldFVUQ0Z1bGxZZWFyKCk7CiAgICB9LAogICAgZ2V0SG91cnM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLmdldFVUQ0hvdXJzKCk7CiAgICB9LAogICAgZ2V0TWlsbGlzZWNvbmRzOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuXy5nZXRVVENNaWxsaXNlY29uZHMoKTsKICAgIH0sCiAgICBnZXRNaW51dGVzOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuXy5nZXRVVENNaW51dGVzKCk7CiAgICB9LAogICAgZ2V0TW9udGg6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLmdldFVUQ01vbnRoKCk7CiAgICB9LAogICAgZ2V0U2Vjb25kczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl8uZ2V0VVRDU2Vjb25kcygpOwogICAgfSwKICAgIGdldFRpbWU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLmdldFRpbWUoKTsKICAgIH0sCiAgICBnZXRUaW1lem9uZU9mZnNldDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAwOwogICAgfSwKICAgIHZhbHVlT2Y6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fLnZhbHVlT2YoKTsKICAgIH0sCiAgICBzZXREYXRlOiBmdW5jdGlvbigpIHsKICAgICAgZDNfdGltZV9wcm90b3R5cGUuc2V0VVRDRGF0ZS5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICB9LAogICAgc2V0RGF5OiBmdW5jdGlvbigpIHsKICAgICAgZDNfdGltZV9wcm90b3R5cGUuc2V0VVRDRGF5LmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICAgIH0sCiAgICBzZXRGdWxsWWVhcjogZnVuY3Rpb24oKSB7CiAgICAgIGQzX3RpbWVfcHJvdG90eXBlLnNldFVUQ0Z1bGxZZWFyLmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICAgIH0sCiAgICBzZXRIb3VyczogZnVuY3Rpb24oKSB7CiAgICAgIGQzX3RpbWVfcHJvdG90eXBlLnNldFVUQ0hvdXJzLmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICAgIH0sCiAgICBzZXRNaWxsaXNlY29uZHM6IGZ1bmN0aW9uKCkgewogICAgICBkM190aW1lX3Byb3RvdHlwZS5zZXRVVENNaWxsaXNlY29uZHMuYXBwbHkodGhpcy5fLCBhcmd1bWVudHMpOwogICAgfSwKICAgIHNldE1pbnV0ZXM6IGZ1bmN0aW9uKCkgewogICAgICBkM190aW1lX3Byb3RvdHlwZS5zZXRVVENNaW51dGVzLmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICAgIH0sCiAgICBzZXRNb250aDogZnVuY3Rpb24oKSB7CiAgICAgIGQzX3RpbWVfcHJvdG90eXBlLnNldFVUQ01vbnRoLmFwcGx5KHRoaXMuXywgYXJndW1lbnRzKTsKICAgIH0sCiAgICBzZXRTZWNvbmRzOiBmdW5jdGlvbigpIHsKICAgICAgZDNfdGltZV9wcm90b3R5cGUuc2V0VVRDU2Vjb25kcy5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICB9LAogICAgc2V0VGltZTogZnVuY3Rpb24oKSB7CiAgICAgIGQzX3RpbWVfcHJvdG90eXBlLnNldFRpbWUuYXBwbHkodGhpcy5fLCBhcmd1bWVudHMpOwogICAgfQogIH07CiAgdmFyIGQzX3RpbWVfcHJvdG90eXBlID0gRGF0ZS5wcm90b3R5cGU7CiAgdmFyIGQzX3RpbWVfZm9ybWF0RGF0ZVRpbWUgPSAiJWEgJWIgJWUgJUg6JU06JVMgJVkiLCBkM190aW1lX2Zvcm1hdERhdGUgPSAiJW0vJWQvJXkiLCBkM190aW1lX2Zvcm1hdFRpbWUgPSAiJUg6JU06JVMiOwogIHZhciBkM190aW1lX2RheXMgPSBkM190aW1lX2RheVN5bWJvbHMsIGQzX3RpbWVfZGF5QWJicmV2aWF0aW9ucyA9IGQzX3RpbWVfZGF5cy5tYXAoZDNfdGltZV9mb3JtYXRBYmJyZXZpYXRlKSwgZDNfdGltZV9tb250aHMgPSBbICJKYW51YXJ5IiwgIkZlYnJ1YXJ5IiwgIk1hcmNoIiwgIkFwcmlsIiwgIk1heSIsICJKdW5lIiwgIkp1bHkiLCAiQXVndXN0IiwgIlNlcHRlbWJlciIsICJPY3RvYmVyIiwgIk5vdmVtYmVyIiwgIkRlY2VtYmVyIiBdLCBkM190aW1lX21vbnRoQWJicmV2aWF0aW9ucyA9IGQzX3RpbWVfbW9udGhzLm1hcChkM190aW1lX2Zvcm1hdEFiYnJldmlhdGUpOwogIGQzLnRpbWUuZm9ybWF0ID0gZnVuY3Rpb24odGVtcGxhdGUpIHsKICAgIGZ1bmN0aW9uIGZvcm1hdChkYXRlKSB7CiAgICAgIHZhciBzdHJpbmcgPSBbXSwgaSA9IC0xLCBqID0gMCwgYywgZjsKICAgICAgd2hpbGUgKCsraSA8IG4pIHsKICAgICAgICBpZiAodGVtcGxhdGUuY2hhckNvZGVBdChpKSA9PSAzNykgewogICAgICAgICAgc3RyaW5nLnB1c2godGVtcGxhdGUuc3Vic3RyaW5nKGosIGkpLCAoZiA9IGQzX3RpbWVfZm9ybWF0c1tjID0gdGVtcGxhdGUuY2hhckF0KCsraSldKSA\/IGYoZGF0ZSkgOiBjKTsKICAgICAgICAgIGogPSBpICsgMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3RyaW5nLnB1c2godGVtcGxhdGUuc3Vic3RyaW5nKGosIGkpKTsKICAgICAgcmV0dXJuIHN0cmluZy5qb2luKCIiKTsKICAgIH0KICAgIHZhciBuID0gdGVtcGxhdGUubGVuZ3RoOwogICAgZm9ybWF0LnBhcnNlID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIHZhciBkID0gewogICAgICAgIHk6IDE5MDAsCiAgICAgICAgbTogMCwKICAgICAgICBkOiAxLAogICAgICAgIEg6IDAsCiAgICAgICAgTTogMCwKICAgICAgICBTOiAwLAogICAgICAgIEw6IDAKICAgICAgfSwgaSA9IGQzX3RpbWVfcGFyc2UoZCwgdGVtcGxhdGUsIHN0cmluZywgMCk7CiAgICAgIGlmIChpICE9IHN0cmluZy5sZW5ndGgpIHJldHVybiBudWxsOwogICAgICBpZiAoInAiIGluIGQpIGQuSCA9IGQuSCAlIDEyICsgZC5wICogMTI7CiAgICAgIHZhciBkYXRlID0gbmV3IGQzX3RpbWU7CiAgICAgIGRhdGUuc2V0RnVsbFllYXIoZC55LCBkLm0sIGQuZCk7CiAgICAgIGRhdGUuc2V0SG91cnMoZC5ILCBkLk0sIGQuUywgZC5MKTsKICAgICAgcmV0dXJuIGRhdGU7CiAgICB9OwogICAgZm9ybWF0LnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0ZW1wbGF0ZTsKICAgIH07CiAgICByZXR1cm4gZm9ybWF0OwogIH07CiAgdmFyIGQzX3RpbWVfemZpbGwyID0gZDMuZm9ybWF0KCIwMmQiKSwgZDNfdGltZV96ZmlsbDMgPSBkMy5mb3JtYXQoIjAzZCIpLCBkM190aW1lX3pmaWxsNCA9IGQzLmZvcm1hdCgiMDRkIiksIGQzX3RpbWVfc2ZpbGwyID0gZDMuZm9ybWF0KCIyZCIpOwogIHZhciBkM190aW1lX2RheVJlID0gZDNfdGltZV9mb3JtYXRSZShkM190aW1lX2RheXMpLCBkM190aW1lX2RheUFiYnJldlJlID0gZDNfdGltZV9mb3JtYXRSZShkM190aW1lX2RheUFiYnJldmlhdGlvbnMpLCBkM190aW1lX21vbnRoUmUgPSBkM190aW1lX2Zvcm1hdFJlKGQzX3RpbWVfbW9udGhzKSwgZDNfdGltZV9tb250aExvb2t1cCA9IGQzX3RpbWVfZm9ybWF0TG9va3VwKGQzX3RpbWVfbW9udGhzKSwgZDNfdGltZV9tb250aEFiYnJldlJlID0gZDNfdGltZV9mb3JtYXRSZShkM190aW1lX21vbnRoQWJicmV2aWF0aW9ucyksIGQzX3RpbWVfbW9udGhBYmJyZXZMb29rdXAgPSBkM190aW1lX2Zvcm1hdExvb2t1cChkM190aW1lX21vbnRoQWJicmV2aWF0aW9ucyk7CiAgdmFyIGQzX3RpbWVfZm9ybWF0cyA9IHsKICAgIGE6IGZ1bmN0aW9uKGQpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfZGF5QWJicmV2aWF0aW9uc1tkLmdldERheSgpXTsKICAgIH0sCiAgICBBOiBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkM190aW1lX2RheXNbZC5nZXREYXkoKV07CiAgICB9LAogICAgYjogZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gZDNfdGltZV9tb250aEFiYnJldmlhdGlvbnNbZC5nZXRNb250aCgpXTsKICAgIH0sCiAgICBCOiBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkM190aW1lX21vbnRoc1tkLmdldE1vbnRoKCldOwogICAgfSwKICAgIGM6IGQzLnRpbWUuZm9ybWF0KGQzX3RpbWVfZm9ybWF0RGF0ZVRpbWUpLAogICAgZDogZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gZDNfdGltZV96ZmlsbDIoZC5nZXREYXRlKCkpOwogICAgfSwKICAgIGU6IGZ1bmN0aW9uKGQpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfc2ZpbGwyKGQuZ2V0RGF0ZSgpKTsKICAgIH0sCiAgICBIOiBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkM190aW1lX3pmaWxsMihkLmdldEhvdXJzKCkpOwogICAgfSwKICAgIEk6IGZ1bmN0aW9uKGQpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfemZpbGwyKGQuZ2V0SG91cnMoKSAlIDEyIHx8IDEyKTsKICAgIH0sCiAgICBqOiBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkM190aW1lX3pmaWxsMygxICsgZDMudGltZS5kYXlPZlllYXIoZCkpOwogICAgfSwKICAgIEw6IGZ1bmN0aW9uKGQpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfemZpbGwzKGQuZ2V0TWlsbGlzZWNvbmRzKCkpOwogICAgfSwKICAgIG06IGZ1bmN0aW9uKGQpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfemZpbGwyKGQuZ2V0TW9udGgoKSArIDEpOwogICAgfSwKICAgIE06IGZ1bmN0aW9uKGQpIHsKICAgICAgcmV0dXJuIGQzX3RpbWVfemZpbGwyKGQuZ2V0TWludXRlcygpKTsKICAgIH0sCiAgICBwOiBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkLmdldEhvdXJzKCkgPj0gMTIgPyAiUE0iIDogIkFNIjsKICAgIH0sCiAgICBTOiBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkM190aW1lX3pmaWxsMihkLmdldFNlY29uZHMoKSk7CiAgICB9LAogICAgVTogZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gZDNfdGltZV96ZmlsbDIoZDMudGltZS5zdW5kYXlPZlllYXIoZCkpOwogICAgfSwKICAgIHc6IGZ1bmN0aW9uKGQpIHsKICAgICAgcmV0dXJuIGQuZ2V0RGF5KCk7CiAgICB9LAogICAgVzogZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gZDNfdGltZV96ZmlsbDIoZDMudGltZS5tb25kYXlPZlllYXIoZCkpOwogICAgfSwKICAgIHg6IGQzLnRpbWUuZm9ybWF0KGQzX3RpbWVfZm9ybWF0RGF0ZSksCiAgICBYOiBkMy50aW1lLmZvcm1hdChkM190aW1lX2Zvcm1hdFRpbWUpLAogICAgeTogZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gZDNfdGltZV96ZmlsbDIoZC5nZXRGdWxsWWVhcigpICUgMTAwKTsKICAgIH0sCiAgICBZOiBmdW5jdGlvbihkKSB7CiAgICAgIHJldHVybiBkM190aW1lX3pmaWxsNChkLmdldEZ1bGxZZWFyKCkgJSAxZTQpOwogICAgfSwKICAgIFo6IGQzX3RpbWVfem9uZSwKICAgICIlIjogZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gIiUiOwogICAgfQogIH07CiAgdmFyIGQzX3RpbWVfcGFyc2VycyA9IHsKICAgIGE6IGQzX3RpbWVfcGFyc2VXZWVrZGF5QWJicmV2LAogICAgQTogZDNfdGltZV9wYXJzZVdlZWtkYXksCiAgICBiOiBkM190aW1lX3BhcnNlTW9udGhBYmJyZXYsCiAgICBCOiBkM190aW1lX3BhcnNlTW9udGgsCiAgICBjOiBkM190aW1lX3BhcnNlTG9jYWxlRnVsbCwKICAgIGQ6IGQzX3RpbWVfcGFyc2VEYXksCiAgICBlOiBkM190aW1lX3BhcnNlRGF5LAogICAgSDogZDNfdGltZV9wYXJzZUhvdXIyNCwKICAgIEk6IGQzX3RpbWVfcGFyc2VIb3VyMjQsCiAgICBMOiBkM190aW1lX3BhcnNlTWlsbGlzZWNvbmRzLAogICAgbTogZDNfdGltZV9wYXJzZU1vbnRoTnVtYmVyLAogICAgTTogZDNfdGltZV9wYXJzZU1pbnV0ZXMsCiAgICBwOiBkM190aW1lX3BhcnNlQW1QbSwKICAgIFM6IGQzX3RpbWVfcGFyc2VTZWNvbmRzLAogICAgeDogZDNfdGltZV9wYXJzZUxvY2FsZURhdGUsCiAgICBYOiBkM190aW1lX3BhcnNlTG9jYWxlVGltZSwKICAgIHk6IGQzX3RpbWVfcGFyc2VZZWFyLAogICAgWTogZDNfdGltZV9wYXJzZUZ1bGxZZWFyCiAgfTsKICB2YXIgZDNfdGltZV9udW1iZXJSZSA9IC9eXHMqXGQrLzsKICB2YXIgZDNfdGltZV9hbVBtTG9va3VwID0gZDMubWFwKHsKICAgIGFtOiAwLAogICAgcG06IDEKICB9KTsKICBkMy50aW1lLmZvcm1hdC51dGMgPSBmdW5jdGlvbih0ZW1wbGF0ZSkgewogICAgZnVuY3Rpb24gZm9ybWF0KGRhdGUpIHsKICAgICAgdHJ5IHsKICAgICAgICBkM190aW1lID0gZDNfdGltZV91dGM7CiAgICAgICAgdmFyIHV0YyA9IG5ldyBkM190aW1lOwogICAgICAgIHV0Yy5fID0gZGF0ZTsKICAgICAgICByZXR1cm4gbG9jYWwodXRjKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBkM190aW1lID0gRGF0ZTsKICAgICAgfQogICAgfQogICAgdmFyIGxvY2FsID0gZDMudGltZS5mb3JtYXQodGVtcGxhdGUpOwogICAgZm9ybWF0LnBhcnNlID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZDNfdGltZSA9IGQzX3RpbWVfdXRjOwogICAgICAgIHZhciBkYXRlID0gbG9jYWwucGFyc2Uoc3RyaW5nKTsKICAgICAgICByZXR1cm4gZGF0ZSAmJiBkYXRlLl87CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgZDNfdGltZSA9IERhdGU7CiAgICAgIH0KICAgIH07CiAgICBmb3JtYXQudG9TdHJpbmcgPSBsb2NhbC50b1N0cmluZzsKICAgIHJldHVybiBmb3JtYXQ7CiAgfTsKICB2YXIgZDNfdGltZV9mb3JtYXRJc28gPSBkMy50aW1lLmZvcm1hdC51dGMoIiVZLSVtLSVkVCVIOiVNOiVTLiVMWiIpOwogIGQzLnRpbWUuZm9ybWF0LmlzbyA9IERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nID8gZDNfdGltZV9mb3JtYXRJc29OYXRpdmUgOiBkM190aW1lX2Zvcm1hdElzbzsKICBkM190aW1lX2Zvcm1hdElzb05hdGl2ZS5wYXJzZSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShzdHJpbmcpOwogICAgcmV0dXJuIGlzTmFOKGRhdGUpID8gbnVsbCA6IGRhdGU7CiAgfTsKICBkM190aW1lX2Zvcm1hdElzb05hdGl2ZS50b1N0cmluZyA9IGQzX3RpbWVfZm9ybWF0SXNvLnRvU3RyaW5nOwogIGQzLnRpbWUuc2Vjb25kID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICByZXR1cm4gbmV3IGQzX3RpbWUoTWF0aC5mbG9vcihkYXRlIC8gMWUzKSAqIDFlMyk7CiAgfSwgZnVuY3Rpb24oZGF0ZSwgb2Zmc2V0KSB7CiAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyBNYXRoLmZsb29yKG9mZnNldCkgKiAxZTMpOwogIH0sIGZ1bmN0aW9uKGRhdGUpIHsKICAgIHJldHVybiBkYXRlLmdldFNlY29uZHMoKTsKICB9KTsKICBkMy50aW1lLnNlY29uZHMgPSBkMy50aW1lLnNlY29uZC5yYW5nZTsKICBkMy50aW1lLnNlY29uZHMudXRjID0gZDMudGltZS5zZWNvbmQudXRjLnJhbmdlOwogIGQzLnRpbWUubWludXRlID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICByZXR1cm4gbmV3IGQzX3RpbWUoTWF0aC5mbG9vcihkYXRlIC8gNmU0KSAqIDZlNCk7CiAgfSwgZnVuY3Rpb24oZGF0ZSwgb2Zmc2V0KSB7CiAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyBNYXRoLmZsb29yKG9mZnNldCkgKiA2ZTQpOwogIH0sIGZ1bmN0aW9uKGRhdGUpIHsKICAgIHJldHVybiBkYXRlLmdldE1pbnV0ZXMoKTsKICB9KTsKICBkMy50aW1lLm1pbnV0ZXMgPSBkMy50aW1lLm1pbnV0ZS5yYW5nZTsKICBkMy50aW1lLm1pbnV0ZXMudXRjID0gZDMudGltZS5taW51dGUudXRjLnJhbmdlOwogIGQzLnRpbWUuaG91ciA9IGQzX3RpbWVfaW50ZXJ2YWwoZnVuY3Rpb24oZGF0ZSkgewogICAgdmFyIHRpbWV6b25lID0gZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpIC8gNjA7CiAgICByZXR1cm4gbmV3IGQzX3RpbWUoKE1hdGguZmxvb3IoZGF0ZSAvIDM2ZTUgLSB0aW1lem9uZSkgKyB0aW1lem9uZSkgKiAzNmU1KTsKICB9LCBmdW5jdGlvbihkYXRlLCBvZmZzZXQpIHsKICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIE1hdGguZmxvb3Iob2Zmc2V0KSAqIDM2ZTUpOwogIH0sIGZ1bmN0aW9uKGRhdGUpIHsKICAgIHJldHVybiBkYXRlLmdldEhvdXJzKCk7CiAgfSk7CiAgZDMudGltZS5ob3VycyA9IGQzLnRpbWUuaG91ci5yYW5nZTsKICBkMy50aW1lLmhvdXJzLnV0YyA9IGQzLnRpbWUuaG91ci51dGMucmFuZ2U7CiAgZDMudGltZS5kYXkgPSBkM190aW1lX2ludGVydmFsKGZ1bmN0aW9uKGRhdGUpIHsKICAgIHZhciBkYXkgPSBuZXcgZDNfdGltZSgxOTcwLCAwKTsKICAgIGRheS5zZXRGdWxsWWVhcihkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSwgZGF0ZS5nZXREYXRlKCkpOwogICAgcmV0dXJuIGRheTsKICB9LCBmdW5jdGlvbihkYXRlLCBvZmZzZXQpIHsKICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIG9mZnNldCk7CiAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGRhdGUuZ2V0RGF0ZSgpIC0gMTsKICB9KTsKICBkMy50aW1lLmRheXMgPSBkMy50aW1lLmRheS5yYW5nZTsKICBkMy50aW1lLmRheXMudXRjID0gZDMudGltZS5kYXkudXRjLnJhbmdlOwogIGQzLnRpbWUuZGF5T2ZZZWFyID0gZnVuY3Rpb24oZGF0ZSkgewogICAgdmFyIHllYXIgPSBkMy50aW1lLnllYXIoZGF0ZSk7CiAgICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZSAtIHllYXIgLSAoZGF0ZS5nZXRUaW1lem9uZU9mZnNldCgpIC0geWVhci5nZXRUaW1lem9uZU9mZnNldCgpKSAqIDZlNCkgLyA4NjRlNSk7CiAgfTsKICBkM190aW1lX2RheVN5bWJvbHMuZm9yRWFjaChmdW5jdGlvbihkYXksIGkpIHsKICAgIGRheSA9IGRheS50b0xvd2VyQ2FzZSgpOwogICAgaSA9IDcgLSBpOwogICAgdmFyIGludGVydmFsID0gZDMudGltZVtkYXldID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICAgIChkYXRlID0gZDMudGltZS5kYXkoZGF0ZSkpLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSAoZGF0ZS5nZXREYXkoKSArIGkpICUgNyk7CiAgICAgIHJldHVybiBkYXRlOwogICAgfSwgZnVuY3Rpb24oZGF0ZSwgb2Zmc2V0KSB7CiAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIE1hdGguZmxvb3Iob2Zmc2V0KSAqIDcpOwogICAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgICB2YXIgZGF5ID0gZDMudGltZS55ZWFyKGRhdGUpLmdldERheSgpOwogICAgICByZXR1cm4gTWF0aC5mbG9vcigoZDMudGltZS5kYXlPZlllYXIoZGF0ZSkgKyAoZGF5ICsgaSkgJSA3KSAvIDcpIC0gKGRheSAhPT0gaSk7CiAgICB9KTsKICAgIGQzLnRpbWVbZGF5ICsgInMiXSA9IGludGVydmFsLnJhbmdlOwogICAgZDMudGltZVtkYXkgKyAicyJdLnV0YyA9IGludGVydmFsLnV0Yy5yYW5nZTsKICAgIGQzLnRpbWVbZGF5ICsgIk9mWWVhciJdID0gZnVuY3Rpb24oZGF0ZSkgewogICAgICB2YXIgZGF5ID0gZDMudGltZS55ZWFyKGRhdGUpLmdldERheSgpOwogICAgICByZXR1cm4gTWF0aC5mbG9vcigoZDMudGltZS5kYXlPZlllYXIoZGF0ZSkgKyAoZGF5ICsgaSkgJSA3KSAvIDcpOwogICAgfTsKICB9KTsKICBkMy50aW1lLndlZWsgPSBkMy50aW1lLnN1bmRheTsKICBkMy50aW1lLndlZWtzID0gZDMudGltZS5zdW5kYXkucmFuZ2U7CiAgZDMudGltZS53ZWVrcy51dGMgPSBkMy50aW1lLnN1bmRheS51dGMucmFuZ2U7CiAgZDMudGltZS53ZWVrT2ZZZWFyID0gZDMudGltZS5zdW5kYXlPZlllYXI7CiAgZDMudGltZS5tb250aCA9IGQzX3RpbWVfaW50ZXJ2YWwoZnVuY3Rpb24oZGF0ZSkgewogICAgZGF0ZSA9IGQzLnRpbWUuZGF5KGRhdGUpOwogICAgZGF0ZS5zZXREYXRlKDEpOwogICAgcmV0dXJuIGRhdGU7CiAgfSwgZnVuY3Rpb24oZGF0ZSwgb2Zmc2V0KSB7CiAgICBkYXRlLnNldE1vbnRoKGRhdGUuZ2V0TW9udGgoKSArIG9mZnNldCk7CiAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGRhdGUuZ2V0TW9udGgoKTsKICB9KTsKICBkMy50aW1lLm1vbnRocyA9IGQzLnRpbWUubW9udGgucmFuZ2U7CiAgZDMudGltZS5tb250aHMudXRjID0gZDMudGltZS5tb250aC51dGMucmFuZ2U7CiAgZDMudGltZS55ZWFyID0gZDNfdGltZV9pbnRlcnZhbChmdW5jdGlvbihkYXRlKSB7CiAgICBkYXRlID0gZDMudGltZS5kYXkoZGF0ZSk7CiAgICBkYXRlLnNldE1vbnRoKDAsIDEpOwogICAgcmV0dXJuIGRhdGU7CiAgfSwgZnVuY3Rpb24oZGF0ZSwgb2Zmc2V0KSB7CiAgICBkYXRlLnNldEZ1bGxZZWFyKGRhdGUuZ2V0RnVsbFllYXIoKSArIG9mZnNldCk7CiAgfSwgZnVuY3Rpb24oZGF0ZSkgewogICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKTsKICB9KTsKICBkMy50aW1lLnllYXJzID0gZDMudGltZS55ZWFyLnJhbmdlOwogIGQzLnRpbWUueWVhcnMudXRjID0gZDMudGltZS55ZWFyLnV0Yy5yYW5nZTsKICB2YXIgZDNfdGltZV9zY2FsZVN0ZXBzID0gWyAxZTMsIDVlMywgMTVlMywgM2U0LCA2ZTQsIDNlNSwgOWU1LCAxOGU1LCAzNmU1LCAxMDhlNSwgMjE2ZTUsIDQzMmU1LCA4NjRlNSwgMTcyOGU1LCA2MDQ4ZTUsIDI1OTJlNiwgNzc3NmU2LCAzMTUzNmU2IF07CiAgdmFyIGQzX3RpbWVfc2NhbGVMb2NhbE1ldGhvZHMgPSBbIFsgZDMudGltZS5zZWNvbmQsIDEgXSwgWyBkMy50aW1lLnNlY29uZCwgNSBdLCBbIGQzLnRpbWUuc2Vjb25kLCAxNSBdLCBbIGQzLnRpbWUuc2Vjb25kLCAzMCBdLCBbIGQzLnRpbWUubWludXRlLCAxIF0sIFsgZDMudGltZS5taW51dGUsIDUgXSwgWyBkMy50aW1lLm1pbnV0ZSwgMTUgXSwgWyBkMy50aW1lLm1pbnV0ZSwgMzAgXSwgWyBkMy50aW1lLmhvdXIsIDEgXSwgWyBkMy50aW1lLmhvdXIsIDMgXSwgWyBkMy50aW1lLmhvdXIsIDYgXSwgWyBkMy50aW1lLmhvdXIsIDEyIF0sIFsgZDMudGltZS5kYXksIDEgXSwgWyBkMy50aW1lLmRheSwgMiBdLCBbIGQzLnRpbWUud2VlaywgMSBdLCBbIGQzLnRpbWUubW9udGgsIDEgXSwgWyBkMy50aW1lLm1vbnRoLCAzIF0sIFsgZDMudGltZS55ZWFyLCAxIF0gXTsKICB2YXIgZDNfdGltZV9zY2FsZUxvY2FsRm9ybWF0cyA9IFsgWyBkMy50aW1lLmZvcm1hdCgiJVkiKSwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIHRydWU7CiAgfSBdLCBbIGQzLnRpbWUuZm9ybWF0KCIlQiIpLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRNb250aCgpOwogIH0gXSwgWyBkMy50aW1lLmZvcm1hdCgiJWIgJWQiKSwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0RGF0ZSgpICE9IDE7CiAgfSBdLCBbIGQzLnRpbWUuZm9ybWF0KCIlYSAlZCIpLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXREYXkoKSAmJiBkLmdldERhdGUoKSAhPSAxOwogIH0gXSwgWyBkMy50aW1lLmZvcm1hdCgiJUkgJXAiKSwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0SG91cnMoKTsKICB9IF0sIFsgZDMudGltZS5mb3JtYXQoIiVJOiVNIiksIGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiBkLmdldE1pbnV0ZXMoKTsKICB9IF0sIFsgZDMudGltZS5mb3JtYXQoIjolUyIpLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRTZWNvbmRzKCk7CiAgfSBdLCBbIGQzLnRpbWUuZm9ybWF0KCIuJUwiKSwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0TWlsbGlzZWNvbmRzKCk7CiAgfSBdIF07CiAgdmFyIGQzX3RpbWVfc2NhbGVMaW5lYXIgPSBkMy5zY2FsZS5saW5lYXIoKSwgZDNfdGltZV9zY2FsZUxvY2FsRm9ybWF0ID0gZDNfdGltZV9zY2FsZUZvcm1hdChkM190aW1lX3NjYWxlTG9jYWxGb3JtYXRzKTsKICBkM190aW1lX3NjYWxlTG9jYWxNZXRob2RzLnllYXIgPSBmdW5jdGlvbihleHRlbnQsIG0pIHsKICAgIHJldHVybiBkM190aW1lX3NjYWxlTGluZWFyLmRvbWFpbihleHRlbnQubWFwKGQzX3RpbWVfc2NhbGVHZXRZZWFyKSkudGlja3MobSkubWFwKGQzX3RpbWVfc2NhbGVTZXRZZWFyKTsKICB9OwogIGQzLnRpbWUuc2NhbGUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBkM190aW1lX3NjYWxlKGQzLnNjYWxlLmxpbmVhcigpLCBkM190aW1lX3NjYWxlTG9jYWxNZXRob2RzLCBkM190aW1lX3NjYWxlTG9jYWxGb3JtYXQpOwogIH07CiAgdmFyIGQzX3RpbWVfc2NhbGVVVENNZXRob2RzID0gZDNfdGltZV9zY2FsZUxvY2FsTWV0aG9kcy5tYXAoZnVuY3Rpb24obSkgewogICAgcmV0dXJuIFsgbVswXS51dGMsIG1bMV0gXTsKICB9KTsKICB2YXIgZDNfdGltZV9zY2FsZVVUQ0Zvcm1hdHMgPSBbIFsgZDMudGltZS5mb3JtYXQudXRjKCIlWSIpLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9IF0sIFsgZDMudGltZS5mb3JtYXQudXRjKCIlQiIpLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRVVENNb250aCgpOwogIH0gXSwgWyBkMy50aW1lLmZvcm1hdC51dGMoIiViICVkIiksIGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiBkLmdldFVUQ0RhdGUoKSAhPSAxOwogIH0gXSwgWyBkMy50aW1lLmZvcm1hdC51dGMoIiVhICVkIiksIGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiBkLmdldFVUQ0RheSgpICYmIGQuZ2V0VVRDRGF0ZSgpICE9IDE7CiAgfSBdLCBbIGQzLnRpbWUuZm9ybWF0LnV0YygiJUkgJXAiKSwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0VVRDSG91cnMoKTsKICB9IF0sIFsgZDMudGltZS5mb3JtYXQudXRjKCIlSTolTSIpLCBmdW5jdGlvbihkKSB7CiAgICByZXR1cm4gZC5nZXRVVENNaW51dGVzKCk7CiAgfSBdLCBbIGQzLnRpbWUuZm9ybWF0LnV0YygiOiVTIiksIGZ1bmN0aW9uKGQpIHsKICAgIHJldHVybiBkLmdldFVUQ1NlY29uZHMoKTsKICB9IF0sIFsgZDMudGltZS5mb3JtYXQudXRjKCIuJUwiKSwgZnVuY3Rpb24oZCkgewogICAgcmV0dXJuIGQuZ2V0VVRDTWlsbGlzZWNvbmRzKCk7CiAgfSBdIF07CiAgdmFyIGQzX3RpbWVfc2NhbGVVVENGb3JtYXQgPSBkM190aW1lX3NjYWxlRm9ybWF0KGQzX3RpbWVfc2NhbGVVVENGb3JtYXRzKTsKICBkM190aW1lX3NjYWxlVVRDTWV0aG9kcy55ZWFyID0gZnVuY3Rpb24oZXh0ZW50LCBtKSB7CiAgICByZXR1cm4gZDNfdGltZV9zY2FsZUxpbmVhci5kb21haW4oZXh0ZW50Lm1hcChkM190aW1lX3NjYWxlVVRDR2V0WWVhcikpLnRpY2tzKG0pLm1hcChkM190aW1lX3NjYWxlVVRDU2V0WWVhcik7CiAgfTsKICBkMy50aW1lLnNjYWxlLnV0YyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGQzX3RpbWVfc2NhbGUoZDMuc2NhbGUubGluZWFyKCksIGQzX3RpbWVfc2NhbGVVVENNZXRob2RzLCBkM190aW1lX3NjYWxlVVRDRm9ybWF0KTsKICB9Owp9KSgpOw==",
    "size": "239674"
}