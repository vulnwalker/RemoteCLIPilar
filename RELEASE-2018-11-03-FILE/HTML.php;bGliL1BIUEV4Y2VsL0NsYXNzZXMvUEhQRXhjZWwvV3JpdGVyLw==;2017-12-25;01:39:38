{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Writer\/HTML.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKgogKiBQSFBFeGNlbF9Xcml0ZXJfSFRNTAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKICogdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBCiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsX1dyaXRlcl9IVE1MCiAqIEBjb3B5cmlnaHQgIENvcHlyaWdodCAoYykgMjAwNiAtIDIwMTUgUEhQRXhjZWwgKGh0dHA6Ly93d3cuY29kZXBsZXguY29tL1BIUEV4Y2VsKQogKiBAbGljZW5zZSAgICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvb2xkLWxpY2Vuc2VzL2xncGwtMi4xLnR4dCAgICBMR1BMCiAqIEB2ZXJzaW9uICAgICMjVkVSU0lPTiMjLCAjI0RBVEUjIwogKi8KY2xhc3MgUEhQRXhjZWxfV3JpdGVyX0hUTUwgZXh0ZW5kcyBQSFBFeGNlbF9Xcml0ZXJfQWJzdHJhY3QgaW1wbGVtZW50cyBQSFBFeGNlbF9Xcml0ZXJfSVdyaXRlcgp7CiAgICAvKioKICAgICAqIFBIUEV4Y2VsIG9iamVjdAogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWwKICAgICAqLwogICAgcHJvdGVjdGVkICRwaHBFeGNlbDsKCiAgICAvKioKICAgICAqIFNoZWV0IGluZGV4IHRvIHdyaXRlCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJpdmF0ZSAkc2hlZXRJbmRleCA9IDA7CgogICAgLyoqCiAgICAgKiBJbWFnZXMgcm9vdAogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByaXZhdGUgJGltYWdlc1Jvb3QgPSAnLic7CgogICAgLyoqCiAgICAgKiBlbWJlZCBpbWFnZXMsIG9yIGxpbmsgdG8gaW1hZ2VzCiAgICAgKgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHByaXZhdGUgJGVtYmVkSW1hZ2VzID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBVc2UgaW5saW5lIENTUz8KICAgICAqCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSAkdXNlSW5saW5lQ3NzID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBDU1Mgc3R5bGVzCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcml2YXRlICRjc3NTdHlsZXM7CgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBjb2x1bW4gd2lkdGhzIGluIHBvaW50cwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkY29sdW1uV2lkdGhzOwoKICAgIC8qKgogICAgICogRGVmYXVsdCBmb250CiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9TdHlsZV9Gb250CiAgICAgKi8KICAgIHByaXZhdGUgJGRlZmF1bHRGb250OwoKICAgIC8qKgogICAgICogRmxhZyB3aGV0aGVyIHNwYW5zIGhhdmUgYmVlbiBjYWxjdWxhdGVkCiAgICAgKgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHByaXZhdGUgJHNwYW5zQXJlQ2FsY3VsYXRlZCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogRXhjZWwgY2VsbHMgdGhhdCBzaG91bGQgbm90IGJlIHdyaXR0ZW4gYXMgSFRNTCBjZWxscwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkaXNTcGFubmVkQ2VsbCA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBFeGNlbCBjZWxscyB0aGF0IGFyZSB1cHBlci1sZWZ0IGNvcm5lciBpbiBhIGNlbGwgbWVyZ2UKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJGlzQmFzZUNlbGwgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogRXhjZWwgcm93cyB0aGF0IHNob3VsZCBub3QgYmUgd3JpdHRlbiBhcyBIVE1MIHJvd3MKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJGlzU3Bhbm5lZFJvdyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBJcyB0aGUgY3VycmVudCB3cml0ZXIgY3JlYXRpbmcgUERGPwogICAgICoKICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwcm90ZWN0ZWQgJGlzUGRmID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0aGUgTmF2aWdhdGlvbiBibG9jawogICAgICoKICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwcml2YXRlICRnZW5lcmF0ZVNoZWV0TmF2aWdhdGlvbkJsb2NrID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBQSFBFeGNlbF9Xcml0ZXJfSFRNTAogICAgICoKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbCAgICAkcGhwRXhjZWwgICAgUEhQRXhjZWwgb2JqZWN0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdChQSFBFeGNlbCAkcGhwRXhjZWwpCiAgICB7CiAgICAgICAgJHRoaXMtPnBocEV4Y2VsID0gJHBocEV4Y2VsOwogICAgICAgICR0aGlzLT5kZWZhdWx0Rm9udCA9ICR0aGlzLT5waHBFeGNlbC0+Z2V0RGVmYXVsdFN0eWxlKCktPmdldEZvbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNhdmUgUEhQRXhjZWwgdG8gZmlsZQogICAgICoKICAgICAqIEBwYXJhbSAgICBzdHJpbmcgICAgICAgICRwRmlsZW5hbWUKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2F2ZSgkcEZpbGVuYW1lID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBnYXJiYWdlIGNvbGxlY3QKICAgICAgICAkdGhpcy0+cGhwRXhjZWwtPmdhcmJhZ2VDb2xsZWN0KCk7CgogICAgICAgICRzYXZlRGVidWdMb2cgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6Z2V0SW5zdGFuY2UoJHRoaXMtPnBocEV4Y2VsKS0+Z2V0RGVidWdMb2coKS0+Z2V0V3JpdGVEZWJ1Z0xvZygpOwogICAgICAgIFBIUEV4Y2VsX0NhbGN1bGF0aW9uOjpnZXRJbnN0YW5jZSgkdGhpcy0+cGhwRXhjZWwpLT5nZXREZWJ1Z0xvZygpLT5zZXRXcml0ZURlYnVnTG9nKGZhbHNlKTsKICAgICAgICAkc2F2ZUFycmF5UmV0dXJuVHlwZSA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uOjpnZXRBcnJheVJldHVyblR5cGUoKTsKICAgICAgICBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6c2V0QXJyYXlSZXR1cm5UeXBlKFBIUEV4Y2VsX0NhbGN1bGF0aW9uOjpSRVRVUk5fQVJSQVlfQVNfVkFMVUUpOwoKICAgICAgICAvLyBCdWlsZCBDU1MKICAgICAgICAkdGhpcy0+YnVpbGRDU1MoISR0aGlzLT51c2VJbmxpbmVDc3MpOwoKICAgICAgICAvLyBPcGVuIGZpbGUKICAgICAgICAkZmlsZUhhbmRsZSA9IGZvcGVuKCRwRmlsZW5hbWUsICd3YisnKTsKICAgICAgICBpZiAoJGZpbGVIYW5kbGUgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCJDb3VsZCBub3Qgb3BlbiBmaWxlICRwRmlsZW5hbWUgZm9yIHdyaXRpbmcuIik7CiAgICAgICAgfQoKICAgICAgICAvLyBXcml0ZSBoZWFkZXJzCiAgICAgICAgZndyaXRlKCRmaWxlSGFuZGxlLCAkdGhpcy0+Z2VuZXJhdGVIVE1MSGVhZGVyKCEkdGhpcy0+dXNlSW5saW5lQ3NzKSk7CgogICAgICAgIC8vIFdyaXRlIG5hdmlnYXRpb24gKHRhYnMpCiAgICAgICAgaWYgKCghJHRoaXMtPmlzUGRmKSAmJiAoJHRoaXMtPmdlbmVyYXRlU2hlZXROYXZpZ2F0aW9uQmxvY2spKSB7CiAgICAgICAgICAgIGZ3cml0ZSgkZmlsZUhhbmRsZSwgJHRoaXMtPmdlbmVyYXRlTmF2aWdhdGlvbigpKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIGRhdGEKICAgICAgICBmd3JpdGUoJGZpbGVIYW5kbGUsICR0aGlzLT5nZW5lcmF0ZVNoZWV0RGF0YSgpKTsKCiAgICAgICAgLy8gV3JpdGUgZm9vdGVyCiAgICAgICAgZndyaXRlKCRmaWxlSGFuZGxlLCAkdGhpcy0+Z2VuZXJhdGVIVE1MRm9vdGVyKCkpOwoKICAgICAgICAvLyBDbG9zZSBmaWxlCiAgICAgICAgZmNsb3NlKCRmaWxlSGFuZGxlKTsKCiAgICAgICAgUEhQRXhjZWxfQ2FsY3VsYXRpb246OnNldEFycmF5UmV0dXJuVHlwZSgkc2F2ZUFycmF5UmV0dXJuVHlwZSk7CiAgICAgICAgUEhQRXhjZWxfQ2FsY3VsYXRpb246OmdldEluc3RhbmNlKCR0aGlzLT5waHBFeGNlbCktPmdldERlYnVnTG9nKCktPnNldFdyaXRlRGVidWdMb2coJHNhdmVEZWJ1Z0xvZyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgVkFsaWduCiAgICAgKgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAgICAgJHZBbGlnbiAgICAgICAgVmVydGljYWwgYWxpZ25tZW50CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIG1hcFZBbGlnbigkdkFsaWduKQogICAgewogICAgICAgIHN3aXRjaCAoJHZBbGlnbikgewogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfQk9UVE9NOgogICAgICAgICAgICAgICAgcmV0dXJuICdib3R0b20nOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfVE9QOgogICAgICAgICAgICAgICAgcmV0dXJuICd0b3AnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfQ0VOVEVSOgogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfSlVTVElGWToKICAgICAgICAgICAgICAgIHJldHVybiAnbWlkZGxlJzsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAnYmFzZWxpbmUnOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1hcCBIQWxpZ24KICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICAgICAkaEFsaWduICAgICAgICBIb3Jpem9udGFsIGFsaWdubWVudAogICAgICogQHJldHVybiBzdHJpbmd8ZmFsc2UKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBtYXBIQWxpZ24oJGhBbGlnbikKICAgIHsKICAgICAgICBzd2l0Y2ggKCRoQWxpZ24pIHsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfR0VORVJBTDoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfTEVGVDoKICAgICAgICAgICAgICAgIHJldHVybiAnbGVmdCc7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX1JJR0hUOgogICAgICAgICAgICAgICAgcmV0dXJuICdyaWdodCc7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0NFTlRFUjoKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfQ0VOVEVSX0NPTlRJTlVPVVM6CiAgICAgICAgICAgICAgICByZXR1cm4gJ2NlbnRlcic7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0pVU1RJRlk6CiAgICAgICAgICAgICAgICByZXR1cm4gJ2p1c3RpZnknOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1hcCBib3JkZXIgc3R5bGUKICAgICAqCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkYm9yZGVyU3R5bGUgICAgICAgIFNoZWV0IGluZGV4CiAgICAgKiBAcmV0dXJuICAgIHN0cmluZwogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIG1hcEJvcmRlclN0eWxlKCRib3JkZXJTdHlsZSkKICAgIHsKICAgICAgICBzd2l0Y2ggKCRib3JkZXJTdHlsZSkgewogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX05PTkU6CiAgICAgICAgICAgICAgICByZXR1cm4gJ25vbmUnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RBU0hET1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gJzFweCBkYXNoZWQnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RBU0hET1RET1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gJzFweCBkb3R0ZWQnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0RBU0hFRDoKICAgICAgICAgICAgICAgIHJldHVybiAnMXB4IGRhc2hlZCc7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfRE9UVEVEOgogICAgICAgICAgICAgICAgcmV0dXJuICcxcHggZG90dGVkJzsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9ET1VCTEU6CiAgICAgICAgICAgICAgICByZXR1cm4gJzNweCBkb3VibGUnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX0hBSVI6CiAgICAgICAgICAgICAgICByZXR1cm4gJzFweCBzb2xpZCc7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfTUVESVVNOgogICAgICAgICAgICAgICAgcmV0dXJuICcycHggc29saWQnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hET1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gJzJweCBkYXNoZWQnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hET1RET1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gJzJweCBkb3R0ZWQnOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcjo6Qk9SREVSX01FRElVTURBU0hFRDoKICAgICAgICAgICAgICAgIHJldHVybiAnMnB4IGRhc2hlZCc7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfU3R5bGVfQm9yZGVyOjpCT1JERVJfU0xBTlREQVNIRE9UOgogICAgICAgICAgICAgICAgcmV0dXJuICcycHggZGFzaGVkJzsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9USElDSzoKICAgICAgICAgICAgICAgIHJldHVybiAnM3B4IHNvbGlkJzsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9USElOOgogICAgICAgICAgICAgICAgcmV0dXJuICcxcHggc29saWQnOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gbWFwIG90aGVycyB0byB0aGluCiAgICAgICAgICAgICAgICByZXR1cm4gJzFweCBzb2xpZCc7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2V0IHNoZWV0IGluZGV4CiAgICAgKgogICAgICogQHJldHVybiBpbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNoZWV0SW5kZXgoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+c2hlZXRJbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBzaGVldCBpbmRleAogICAgICoKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICRwVmFsdWUgICAgICAgIFNoZWV0IGluZGV4CiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dyaXRlcl9IVE1MCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRTaGVldEluZGV4KCRwVmFsdWUgPSAwKQogICAgewogICAgICAgICR0aGlzLT5zaGVldEluZGV4ID0gJHBWYWx1ZTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgc2hlZXQgaW5kZXgKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEdlbmVyYXRlU2hlZXROYXZpZ2F0aW9uQmxvY2soKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Z2VuZXJhdGVTaGVldE5hdmlnYXRpb25CbG9jazsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBzaGVldCBpbmRleAogICAgICoKICAgICAqIEBwYXJhbSAgICBib29sZWFuICAgICAgICAkcFZhbHVlICAgICAgICBGbGFnIGluZGljYXRpbmcgd2hldGhlciB0aGUgc2hlZXQgbmF2aWdhdGlvbiBibG9jayBzaG91bGQgYmUgZ2VuZXJhdGVkIG9yIG5vdAogICAgICogQHJldHVybiBQSFBFeGNlbF9Xcml0ZXJfSFRNTAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0R2VuZXJhdGVTaGVldE5hdmlnYXRpb25CbG9jaygkcFZhbHVlID0gdHJ1ZSkKICAgIHsKICAgICAgICAkdGhpcy0+Z2VuZXJhdGVTaGVldE5hdmlnYXRpb25CbG9jayA9IChib29sKSAkcFZhbHVlOwogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFdyaXRlIGFsbCBzaGVldHMgKHJlc2V0cyBzaGVldEluZGV4IHRvIE5VTEwpCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB3cml0ZUFsbFNoZWV0cygpCiAgICB7CiAgICAgICAgJHRoaXMtPnNoZWV0SW5kZXggPSBudWxsOwogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIEhUTUwgaGVhZGVyCiAgICAgKgogICAgICogQHBhcmFtICAgIGJvb2xlYW4gICAgICAgICRwSW5jbHVkZVN0eWxlcyAgICAgICAgSW5jbHVkZSBzdHlsZXM\/CiAgICAgKiBAcmV0dXJuICAgIHN0cmluZwogICAgICogQHRocm93cyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZW5lcmF0ZUhUTUxIZWFkZXIoJHBJbmNsdWRlU3R5bGVzID0gZmFsc2UpCiAgICB7CiAgICAgICAgLy8gUEhQRXhjZWwgb2JqZWN0IGtub3duPwogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5waHBFeGNlbCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24oJ0ludGVybmFsIFBIUEV4Y2VsIG9iamVjdCBub3Qgc2V0IHRvIGFuIGluc3RhbmNlIG9mIGFuIG9iamVjdC4nKTsKICAgICAgICB9CgogICAgICAgIC8vIENvbnN0cnVjdCBIVE1MCiAgICAgICAgJHByb3BlcnRpZXMgPSAkdGhpcy0+cGhwRXhjZWwtPmdldFByb3BlcnRpZXMoKTsKICAgICAgICAkaHRtbCA9ICc8IURPQ1RZUEUgaHRtbCBQVUJMSUMgIi0vL1czQy8vRFREIEhUTUwgNC4wMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9UUi9odG1sNC9zdHJpY3QuZHRkIj4nIC4gUEhQX0VPTDsKICAgICAgICAkaHRtbCAuPSAnPCEtLSBHZW5lcmF0ZWQgYnkgUEhQRXhjZWwgLSBodHRwOi8vd3d3LnBocGV4Y2VsLm5ldCAtLT4nIC4gUEhQX0VPTDsKICAgICAgICAkaHRtbCAuPSAnPGh0bWw+JyAuIFBIUF9FT0w7CiAgICAgICAgJGh0bWwgLj0gJyAgPGhlYWQ+JyAuIFBIUF9FT0w7CiAgICAgICAgJGh0bWwgLj0gJyAgICAgIDxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04Ij4nIC4gUEhQX0VPTDsKICAgICAgICBpZiAoJHByb3BlcnRpZXMtPmdldFRpdGxlKCkgPiAnJykgewogICAgICAgICAgICAkaHRtbCAuPSAnICAgICAgPHRpdGxlPicgLiBodG1sc3BlY2lhbGNoYXJzKCRwcm9wZXJ0aWVzLT5nZXRUaXRsZSgpKSAuICc8L3RpdGxlPicgLiBQSFBfRU9MOwogICAgICAgIH0KICAgICAgICBpZiAoJHByb3BlcnRpZXMtPmdldENyZWF0b3IoKSA+ICcnKSB7CiAgICAgICAgICAgICRodG1sIC49ICcgICAgICA8bWV0YSBuYW1lPSJhdXRob3IiIGNvbnRlbnQ9IicgLiBodG1sc3BlY2lhbGNoYXJzKCRwcm9wZXJ0aWVzLT5nZXRDcmVhdG9yKCkpIC4gJyIgLz4nIC4gUEhQX0VPTDsKICAgICAgICB9CiAgICAgICAgaWYgKCRwcm9wZXJ0aWVzLT5nZXRUaXRsZSgpID4gJycpIHsKICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgIDxtZXRhIG5hbWU9InRpdGxlIiBjb250ZW50PSInIC4gaHRtbHNwZWNpYWxjaGFycygkcHJvcGVydGllcy0+Z2V0VGl0bGUoKSkgLiAnIiAvPicgLiBQSFBfRU9MOwogICAgICAgIH0KICAgICAgICBpZiAoJHByb3BlcnRpZXMtPmdldERlc2NyaXB0aW9uKCkgPiAnJykgewogICAgICAgICAgICAkaHRtbCAuPSAnICAgICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IicgLiBodG1sc3BlY2lhbGNoYXJzKCRwcm9wZXJ0aWVzLT5nZXREZXNjcmlwdGlvbigpKSAuICciIC8+JyAuIFBIUF9FT0w7CiAgICAgICAgfQogICAgICAgIGlmICgkcHJvcGVydGllcy0+Z2V0U3ViamVjdCgpID4gJycpIHsKICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgIDxtZXRhIG5hbWU9InN1YmplY3QiIGNvbnRlbnQ9IicgLiBodG1sc3BlY2lhbGNoYXJzKCRwcm9wZXJ0aWVzLT5nZXRTdWJqZWN0KCkpIC4gJyIgLz4nIC4gUEhQX0VPTDsKICAgICAgICB9CiAgICAgICAgaWYgKCRwcm9wZXJ0aWVzLT5nZXRLZXl3b3JkcygpID4gJycpIHsKICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgIDxtZXRhIG5hbWU9ImtleXdvcmRzIiBjb250ZW50PSInIC4gaHRtbHNwZWNpYWxjaGFycygkcHJvcGVydGllcy0+Z2V0S2V5d29yZHMoKSkgLiAnIiAvPicgLiBQSFBfRU9MOwogICAgICAgIH0KICAgICAgICBpZiAoJHByb3BlcnRpZXMtPmdldENhdGVnb3J5KCkgPiAnJykgewogICAgICAgICAgICAkaHRtbCAuPSAnICAgICAgPG1ldGEgbmFtZT0iY2F0ZWdvcnkiIGNvbnRlbnQ9IicgLiBodG1sc3BlY2lhbGNoYXJzKCRwcm9wZXJ0aWVzLT5nZXRDYXRlZ29yeSgpKSAuICciIC8+JyAuIFBIUF9FT0w7CiAgICAgICAgfQogICAgICAgIGlmICgkcHJvcGVydGllcy0+Z2V0Q29tcGFueSgpID4gJycpIHsKICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgIDxtZXRhIG5hbWU9ImNvbXBhbnkiIGNvbnRlbnQ9IicgLiBodG1sc3BlY2lhbGNoYXJzKCRwcm9wZXJ0aWVzLT5nZXRDb21wYW55KCkpIC4gJyIgLz4nIC4gUEhQX0VPTDsKICAgICAgICB9CiAgICAgICAgaWYgKCRwcm9wZXJ0aWVzLT5nZXRNYW5hZ2VyKCkgPiAnJykgewogICAgICAgICAgICAkaHRtbCAuPSAnICAgICAgPG1ldGEgbmFtZT0ibWFuYWdlciIgY29udGVudD0iJyAuIGh0bWxzcGVjaWFsY2hhcnMoJHByb3BlcnRpZXMtPmdldE1hbmFnZXIoKSkgLiAnIiAvPicgLiBQSFBfRU9MOwogICAgICAgIH0KCiAgICAgICAgaWYgKCRwSW5jbHVkZVN0eWxlcykgewogICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+Z2VuZXJhdGVTdHlsZXModHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAkaHRtbCAuPSAnICA8L2hlYWQ+JyAuIFBIUF9FT0w7CiAgICAgICAgJGh0bWwgLj0gJycgLiBQSFBfRU9MOwogICAgICAgICRodG1sIC49ICcgIDxib2R5PicgLiBQSFBfRU9MOwoKICAgICAgICByZXR1cm4gJGh0bWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBzaGVldCBkYXRhCiAgICAgKgogICAgICogQHJldHVybiAgICBzdHJpbmcKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2VuZXJhdGVTaGVldERhdGEoKQogICAgewogICAgICAgIC8vIFBIUEV4Y2VsIG9iamVjdCBrbm93bj8KICAgICAgICBpZiAoaXNfbnVsbCgkdGhpcy0+cGhwRXhjZWwpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCdJbnRlcm5hbCBQSFBFeGNlbCBvYmplY3Qgbm90IHNldCB0byBhbiBpbnN0YW5jZSBvZiBhbiBvYmplY3QuJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBFbnN1cmUgdGhhdCBTcGFucyBoYXZlIGJlZW4gY2FsY3VsYXRlZD8KICAgICAgICBpZiAoJHRoaXMtPnNoZWV0SW5kZXggIT09IG51bGwgfHwgISR0aGlzLT5zcGFuc0FyZUNhbGN1bGF0ZWQpIHsKICAgICAgICAgICAgJHRoaXMtPmNhbGN1bGF0ZVNwYW5zKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBGZXRjaCBzaGVldHMKICAgICAgICAkc2hlZXRzID0gYXJyYXkoKTsKICAgICAgICBpZiAoaXNfbnVsbCgkdGhpcy0+c2hlZXRJbmRleCkpIHsKICAgICAgICAgICAgJHNoZWV0cyA9ICR0aGlzLT5waHBFeGNlbC0+Z2V0QWxsU2hlZXRzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHNoZWV0c1tdID0gJHRoaXMtPnBocEV4Y2VsLT5nZXRTaGVldCgkdGhpcy0+c2hlZXRJbmRleCk7CiAgICAgICAgfQoKICAgICAgICAvLyBDb25zdHJ1Y3QgSFRNTAogICAgICAgICRodG1sID0gJyc7CgogICAgICAgIC8vIExvb3AgYWxsIHNoZWV0cwogICAgICAgICRzaGVldElkID0gMDsKICAgICAgICBmb3JlYWNoICgkc2hlZXRzIGFzICRzaGVldCkgewogICAgICAgICAgICAvLyBXcml0ZSB0YWJsZSBoZWFkZXIKICAgICAgICAgICAgJGh0bWwgLj0gJHRoaXMtPmdlbmVyYXRlVGFibGVIZWFkZXIoJHNoZWV0KTsKCiAgICAgICAgICAgIC8vIEdldCB3b3Jrc2hlZXQgZGltZW5zaW9uCiAgICAgICAgICAgICRkaW1lbnNpb24gPSBleHBsb2RlKCc6JywgJHNoZWV0LT5jYWxjdWxhdGVXb3Jrc2hlZXREaW1lbnNpb24oKSk7CiAgICAgICAgICAgICRkaW1lbnNpb25bMF0gPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkZGltZW5zaW9uWzBdKTsKICAgICAgICAgICAgJGRpbWVuc2lvblswXVswXSA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkZGltZW5zaW9uWzBdWzBdKSAtIDE7CiAgICAgICAgICAgICRkaW1lbnNpb25bMV0gPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkZGltZW5zaW9uWzFdKTsKICAgICAgICAgICAgJGRpbWVuc2lvblsxXVswXSA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkZGltZW5zaW9uWzFdWzBdKSAtIDE7CgogICAgICAgICAgICAvLyByb3cgbWluLG1heAogICAgICAgICAgICAkcm93TWluID0gJGRpbWVuc2lvblswXVsxXTsKICAgICAgICAgICAgJHJvd01heCA9ICRkaW1lbnNpb25bMV1bMV07CgogICAgICAgICAgICAvLyBjYWxjdWxhdGUgc3RhcnQgb2YgPHRib2R5PiwgPHRoZWFkPgogICAgICAgICAgICAkdGJvZHlTdGFydCA9ICRyb3dNaW47CiAgICAgICAgICAgICR0aGVhZFN0YXJ0ID0gJHRoZWFkRW5kICAgPSAwOyAvLyBkZWZhdWx0OiBubyA8dGhlYWQ+ICAgIG5vIDwvdGhlYWQ+CiAgICAgICAgICAgIGlmICgkc2hlZXQtPmdldFBhZ2VTZXR1cCgpLT5pc1Jvd3NUb1JlcGVhdEF0VG9wU2V0KCkpIHsKICAgICAgICAgICAgICAgICRyb3dzVG9SZXBlYXRBdFRvcCA9ICRzaGVldC0+Z2V0UGFnZVNldHVwKCktPmdldFJvd3NUb1JlcGVhdEF0VG9wKCk7CgogICAgICAgICAgICAgICAgLy8gd2UgY2FuIG9ubHkgc3VwcG9ydCByZXBlYXRpbmcgcm93cyB0aGF0IHN0YXJ0IGF0IHRvcCByb3cKICAgICAgICAgICAgICAgIGlmICgkcm93c1RvUmVwZWF0QXRUb3BbMF0gPT0gMSkgewogICAgICAgICAgICAgICAgICAgICR0aGVhZFN0YXJ0ID0gJHJvd3NUb1JlcGVhdEF0VG9wWzBdOwogICAgICAgICAgICAgICAgICAgICR0aGVhZEVuZCAgID0gJHJvd3NUb1JlcGVhdEF0VG9wWzFdOwogICAgICAgICAgICAgICAgICAgICR0Ym9keVN0YXJ0ID0gJHJvd3NUb1JlcGVhdEF0VG9wWzFdICsgMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGNlbGxzCiAgICAgICAgICAgICRyb3cgPSAkcm93TWluLTE7CiAgICAgICAgICAgIHdoaWxlICgkcm93KysgPCAkcm93TWF4KSB7CiAgICAgICAgICAgICAgICAvLyA8dGhlYWQ+ID8KICAgICAgICAgICAgICAgIGlmICgkcm93ID09ICR0aGVhZFN0YXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgICAgPHRoZWFkPicgLiBQSFBfRU9MOwogICAgICAgICAgICAgICAgICAgICRjZWxsVHlwZSA9ICd0aCc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gPHRib2R5PiA\/CiAgICAgICAgICAgICAgICBpZiAoJHJvdyA9PSAkdGJvZHlTdGFydCkgewogICAgICAgICAgICAgICAgICAgICRodG1sIC49ICcgICAgICAgIDx0Ym9keT4nIC4gUEhQX0VPTDsKICAgICAgICAgICAgICAgICAgICAkY2VsbFR5cGUgPSAndGQnOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFdyaXRlIHJvdyBpZiB0aGVyZSBhcmUgSFRNTCB0YWJsZSBjZWxscyBpbiBpdAogICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+aXNTcGFubmVkUm93WyRzaGVldC0+Z2V0UGFyZW50KCktPmdldEluZGV4KCRzaGVldCldWyRyb3ddKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IGEgbmV3IHJvd0RhdGEKICAgICAgICAgICAgICAgICAgICAkcm93RGF0YSA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGNvbHVtbnMKICAgICAgICAgICAgICAgICAgICAkY29sdW1uID0gJGRpbWVuc2lvblswXVswXSAtIDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCRjb2x1bW4rKyA8ICRkaW1lbnNpb25bMV1bMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2VsbCBleGlzdHM\/CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2hlZXQtPmNlbGxFeGlzdHNCeUNvbHVtbkFuZFJvdygkY29sdW1uLCAkcm93KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvd0RhdGFbJGNvbHVtbl0gPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbHVtbikgLiAkcm93OwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvd0RhdGFbJGNvbHVtbl0gPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+Z2VuZXJhdGVSb3coJHNoZWV0LCAkcm93RGF0YSwgJHJvdyAtIDEsICRjZWxsVHlwZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gPC90aGVhZD4gPwogICAgICAgICAgICAgICAgaWYgKCRyb3cgPT0gJHRoZWFkRW5kKSB7CiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgICAgPC90aGVhZD4nIC4gUEhQX0VPTDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+ZXh0ZW5kUm93c0ZvckNoYXJ0c0FuZEltYWdlcygkc2hlZXQsICRyb3cpOwoKICAgICAgICAgICAgLy8gQ2xvc2UgdGFibGUgYm9keS4KICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgICAgPC90Ym9keT4nIC4gUEhQX0VPTDsKCiAgICAgICAgICAgIC8vIFdyaXRlIHRhYmxlIGZvb3RlcgogICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+Z2VuZXJhdGVUYWJsZUZvb3RlcigpOwoKICAgICAgICAgICAgLy8gV3JpdGluZyBQREY\/CiAgICAgICAgICAgIGlmICgkdGhpcy0+aXNQZGYpIHsKICAgICAgICAgICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5zaGVldEluZGV4KSAmJiAkc2hlZXRJZCArIDEgPCAkdGhpcy0+cGhwRXhjZWwtPmdldFNoZWV0Q291bnQoKSkgewogICAgICAgICAgICAgICAgICAgICRodG1sIC49ICc8ZGl2IHN0eWxlPSJwYWdlLWJyZWFrLWJlZm9yZTphbHdheXMiIC8+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTmV4dCBzaGVldAogICAgICAgICAgICArKyRzaGVldElkOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRodG1sOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgc2hlZXQgdGFicwogICAgICoKICAgICAqIEByZXR1cm4gICAgc3RyaW5nCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdlbmVyYXRlTmF2aWdhdGlvbigpCiAgICB7CiAgICAgICAgLy8gUEhQRXhjZWwgb2JqZWN0IGtub3duPwogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5waHBFeGNlbCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1dyaXRlcl9FeGNlcHRpb24oJ0ludGVybmFsIFBIUEV4Y2VsIG9iamVjdCBub3Qgc2V0IHRvIGFuIGluc3RhbmNlIG9mIGFuIG9iamVjdC4nKTsKICAgICAgICB9CgogICAgICAgIC8vIEZldGNoIHNoZWV0cwogICAgICAgICRzaGVldHMgPSBhcnJheSgpOwogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5zaGVldEluZGV4KSkgewogICAgICAgICAgICAkc2hlZXRzID0gJHRoaXMtPnBocEV4Y2VsLT5nZXRBbGxTaGVldHMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2hlZXRzW10gPSAkdGhpcy0+cGhwRXhjZWwtPmdldFNoZWV0KCR0aGlzLT5zaGVldEluZGV4KTsKICAgICAgICB9CgogICAgICAgIC8vIENvbnN0cnVjdCBIVE1MCiAgICAgICAgJGh0bWwgPSAnJzsKCiAgICAgICAgLy8gT25seSBpZiB0aGVyZSBhcmUgbW9yZSB0aGFuIDEgc2hlZXRzCiAgICAgICAgaWYgKGNvdW50KCRzaGVldHMpID4gMSkgewogICAgICAgICAgICAvLyBMb29wIGFsbCBzaGVldHMKICAgICAgICAgICAgJHNoZWV0SWQgPSAwOwoKICAgICAgICAgICAgJGh0bWwgLj0gJzx1bCBjbGFzcz0ibmF2aWdhdGlvbiI+JyAuIFBIUF9FT0w7CgogICAgICAgICAgICBmb3JlYWNoICgkc2hlZXRzIGFzICRzaGVldCkgewogICAgICAgICAgICAgICAgJGh0bWwgLj0gJyAgPGxpIGNsYXNzPSJzaGVldCcgLiAkc2hlZXRJZCAuICciPjxhIGhyZWY9IiNzaGVldCcgLiAkc2hlZXRJZCAuICciPicgLiAkc2hlZXQtPmdldFRpdGxlKCkgLiAnPC9hPjwvbGk+JyAuIFBIUF9FT0w7CiAgICAgICAgICAgICAgICArKyRzaGVldElkOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkaHRtbCAuPSAnPC91bD4nIC4gUEhQX0VPTDsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkaHRtbDsKICAgIH0KCiAgICBwcml2YXRlIGZ1bmN0aW9uIGV4dGVuZFJvd3NGb3JDaGFydHNBbmRJbWFnZXMoUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQsICRyb3cpCiAgICB7CiAgICAgICAgJHJvd01heCA9ICRyb3c7CiAgICAgICAgJGNvbE1heCA9ICdBJzsKICAgICAgICBpZiAoJHRoaXMtPmluY2x1ZGVDaGFydHMpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHBTaGVldC0+Z2V0Q2hhcnRDb2xsZWN0aW9uKCkgYXMgJGNoYXJ0KSB7CiAgICAgICAgICAgICAgICBpZiAoJGNoYXJ0IGluc3RhbmNlb2YgUEhQRXhjZWxfQ2hhcnQpIHsKICAgICAgICAgICAgICAgICAgICAkY2hhcnRDb29yZGluYXRlcyA9ICRjaGFydC0+Z2V0VG9wTGVmdFBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgJGNoYXJ0VEwgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkY2hhcnRDb29yZGluYXRlc1snY2VsbCddKTsKICAgICAgICAgICAgICAgICAgICAkY2hhcnRDb2wgPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNoYXJ0VExbMF0pOwogICAgICAgICAgICAgICAgICAgIGlmICgkY2hhcnRUTFsxXSA+ICRyb3dNYXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJvd01heCA9ICRjaGFydFRMWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNoYXJ0Q29sID4gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRjb2xNYXgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sTWF4ID0gJGNoYXJ0VExbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvcmVhY2ggKCRwU2hlZXQtPmdldERyYXdpbmdDb2xsZWN0aW9uKCkgYXMgJGRyYXdpbmcpIHsKICAgICAgICAgICAgaWYgKCRkcmF3aW5nIGluc3RhbmNlb2YgUEhQRXhjZWxfV29ya3NoZWV0X0RyYXdpbmcpIHsKICAgICAgICAgICAgICAgICRpbWFnZVRMID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJGRyYXdpbmctPmdldENvb3JkaW5hdGVzKCkpOwogICAgICAgICAgICAgICAgJGltYWdlQ29sID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRpbWFnZVRMWzBdKTsKICAgICAgICAgICAgICAgIGlmICgkaW1hZ2VUTFsxXSA+ICRyb3dNYXgpIHsKICAgICAgICAgICAgICAgICAgICAkcm93TWF4ID0gJGltYWdlVExbMV07CiAgICAgICAgICAgICAgICAgICAgaWYgKCRpbWFnZUNvbCA+IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkY29sTWF4KSkgewogICAgICAgICAgICAgICAgICAgICAgICAkY29sTWF4ID0gJGltYWdlVExbMF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkaHRtbCA9ICcnOwogICAgICAgICRjb2xNYXgrKzsKICAgICAgICB3aGlsZSAoJHJvdyA8PSAkcm93TWF4KSB7CiAgICAgICAgICAgICRodG1sIC49ICc8dHI+JzsKICAgICAgICAgICAgZm9yICgkY29sID0gJ0EnOyAkY29sICE9ICRjb2xNYXg7ICsrJGNvbCkgewogICAgICAgICAgICAgICAgJGh0bWwgLj0gJzx0ZD4nOwogICAgICAgICAgICAgICAgJGh0bWwgLj0gJHRoaXMtPndyaXRlSW1hZ2VJbkNlbGwoJHBTaGVldCwgJGNvbC4kcm93KTsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aW5jbHVkZUNoYXJ0cykgewogICAgICAgICAgICAgICAgICAgICRodG1sIC49ICR0aGlzLT53cml0ZUNoYXJ0SW5DZWxsKCRwU2hlZXQsICRjb2wuJHJvdyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkaHRtbCAuPSAnPC90ZD4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgICsrJHJvdzsKICAgICAgICAgICAgJGh0bWwgLj0gJzwvdHI+JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRodG1sOwogICAgfQoKCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGltYWdlIHRhZyBpbiBjZWxsCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAkcFNoZWV0ICAgICAgICAgICAgUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICAgICAgICAgICAgICRjb29yZGluYXRlcyAgICBDZWxsIGNvb3JkaW5hdGVzCiAgICAgKiBAcmV0dXJuICAgIHN0cmluZwogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVJbWFnZUluQ2VsbChQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCwgJGNvb3JkaW5hdGVzKQogICAgewogICAgICAgIC8vIENvbnN0cnVjdCBIVE1MCiAgICAgICAgJGh0bWwgPSAnJzsKCiAgICAgICAgLy8gV3JpdGUgaW1hZ2VzCiAgICAgICAgZm9yZWFjaCAoJHBTaGVldC0+Z2V0RHJhd2luZ0NvbGxlY3Rpb24oKSBhcyAkZHJhd2luZykgewogICAgICAgICAgICBpZiAoJGRyYXdpbmcgaW5zdGFuY2VvZiBQSFBFeGNlbF9Xb3Jrc2hlZXRfRHJhd2luZykgewogICAgICAgICAgICAgICAgaWYgKCRkcmF3aW5nLT5nZXRDb29yZGluYXRlcygpID09ICRjb29yZGluYXRlcykgewogICAgICAgICAgICAgICAgICAgICRmaWxlbmFtZSA9ICRkcmF3aW5nLT5nZXRQYXRoKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFN0cmlwIG9mZiBldmVudHVhbCAnLicKICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRmaWxlbmFtZSwgMCwgMSkgPT0gJy4nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlbmFtZSA9IHN1YnN0cigkZmlsZW5hbWUsIDEpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gUHJlcGVuZCBpbWFnZXMgcm9vdAogICAgICAgICAgICAgICAgICAgICRmaWxlbmFtZSA9ICR0aGlzLT5nZXRJbWFnZXNSb290KCkgLiAkZmlsZW5hbWU7CgogICAgICAgICAgICAgICAgICAgIC8vIFN0cmlwIG9mZiBldmVudHVhbCAnLicKICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRmaWxlbmFtZSwgMCwgMSkgPT0gJy4nICYmIHN1YnN0cigkZmlsZW5hbWUsIDAsIDIpICE9ICcuLycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lID0gc3Vic3RyKCRmaWxlbmFtZSwgMSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IFVURjggZGF0YSB0byBQQ0RBVEEKICAgICAgICAgICAgICAgICAgICAkZmlsZW5hbWUgPSBodG1sc3BlY2lhbGNoYXJzKCRmaWxlbmFtZSk7CgogICAgICAgICAgICAgICAgICAgICRodG1sIC49IFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgaWYgKCghJHRoaXMtPmVtYmVkSW1hZ2VzKSB8fCAoJHRoaXMtPmlzUGRmKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VEYXRhID0gJGZpbGVuYW1lOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZURldGFpbHMgPSBnZXRpbWFnZXNpemUoJGZpbGVuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRmcCA9IGZvcGVuKCRmaWxlbmFtZSwgInJiIiwgMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwaWN0dXJlID0gZnJlYWQoJGZwLCBmaWxlc2l6ZSgkZmlsZW5hbWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZjbG9zZSgkZnApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmFzZTY0IGVuY29kZSB0aGUgYmluYXJ5IGRhdGEsIHRoZW4gYnJlYWsgaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludG8gY2h1bmtzIGFjY29yZGluZyB0byBSRkMgMjA0NSBzZW1hbnRpY3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlNjQgPSBjaHVua19zcGxpdChiYXNlNjRfZW5jb2RlKCRwaWN0dXJlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VEYXRhID0gJ2RhdGE6Jy4kaW1hZ2VEZXRhaWxzWydtaW1lJ10uJztiYXNlNjQsJyAuICRiYXNlNjQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VEYXRhID0gJGZpbGVuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnPGRpdiBzdHlsZT0icG9zaXRpb246IHJlbGF0aXZlOyI+JzsKICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnPGltZyBzdHlsZT0icG9zaXRpb246IGFic29sdXRlOyB6LWluZGV4OiAxOyBsZWZ0OiAnIC4KICAgICAgICAgICAgICAgICAgICAgICAgJGRyYXdpbmctPmdldE9mZnNldFgoKSAuICdweDsgdG9wOiAnIC4gJGRyYXdpbmctPmdldE9mZnNldFkoKSAuICdweDsgd2lkdGg6ICcgLgogICAgICAgICAgICAgICAgICAgICAgICAkZHJhd2luZy0+Z2V0V2lkdGgoKSAuICdweDsgaGVpZ2h0OiAnIC4gJGRyYXdpbmctPmdldEhlaWdodCgpIC4gJ3B4OyIgc3JjPSInIC4KICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlRGF0YSAuICciIGJvcmRlcj0iMCIgLz4nOwogICAgICAgICAgICAgICAgICAgICRodG1sIC49ICc8L2Rpdj4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoJGRyYXdpbmcgaW5zdGFuY2VvZiBQSFBFeGNlbF9Xb3Jrc2hlZXRfTWVtb3J5RHJhd2luZykgewogICAgICAgICAgICAgICAgaWYgKCRkcmF3aW5nLT5nZXRDb29yZGluYXRlcygpICE9ICRjb29yZGluYXRlcykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb2Jfc3RhcnQoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBMZXQncyBzdGFydCBvdXRwdXQgYnVmZmVyaW5nLgogICAgICAgICAgICAgICAgaW1hZ2VwbmcoJGRyYXdpbmctPmdldEltYWdlUmVzb3VyY2UoKSk7ICAgIC8vICBUaGlzIHdpbGwgbm9ybWFsbHkgb3V0cHV0IHRoZSBpbWFnZSwgYnV0IGJlY2F1c2Ugb2Ygb2Jfc3RhcnQoKSwgaXQgd29uJ3QuCiAgICAgICAgICAgICAgICAkY29udGVudHMgPSBvYl9nZXRfY29udGVudHMoKTsgICAgICAgICAgICAgLy8gIEluc3RlYWQsIG91dHB1dCBhYm92ZSBpcyBzYXZlZCB0byAkY29udGVudHMKICAgICAgICAgICAgICAgIG9iX2VuZF9jbGVhbigpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgRW5kIHRoZSBvdXRwdXQgYnVmZmVyLgoKICAgICAgICAgICAgICAgICRkYXRhVXJpID0gImRhdGE6aW1hZ2UvanBlZztiYXNlNjQsIiAuIGJhc2U2NF9lbmNvZGUoJGNvbnRlbnRzKTsKCiAgICAgICAgICAgICAgICAvLyAgQmVjYXVzZSBvZiB0aGUgbmF0dXJlIG9mIHRhYmxlcywgd2lkdGggaXMgbW9yZSBpbXBvcnRhbnQgdGhhbiBoZWlnaHQuCiAgICAgICAgICAgICAgICAvLyAgbWF4LXdpZHRoOiAxMDAlIGVuc3VyZXMgdGhhdCBpbWFnZSBkb2VzbnQgb3ZlcmZsb3cgY29udGFpbmluZyBjZWxsCiAgICAgICAgICAgICAgICAvLyAgd2lkdGg6IFggc2V0cyB3aWR0aCBvZiBzdXBwbGllZCBpbWFnZS4KICAgICAgICAgICAgICAgIC8vICBBcyBhIHJlc3VsdCwgaW1hZ2VzIGJpZ2dlciB0aGFuIGNlbGwgd2lsbCBiZSBjb250YWluZWQgYW5kIGltYWdlcyBzbWFsbGVyIHdpbGwgbm90IGdldCBzdHJldGNoZWQKICAgICAgICAgICAgICAgICRodG1sIC49ICc8aW1nIHNyYz0iJy4kZGF0YVVyaS4nIiBzdHlsZT0ibWF4LXdpZHRoOjEwMCU7d2lkdGg6Jy4kZHJhd2luZy0+Z2V0V2lkdGgoKS4ncHg7IiAvPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkaHRtbDsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGNoYXJ0IHRhZyBpbiBjZWxsCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldCAgICAkcFNoZWV0ICAgICAgICAgICAgUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICAgICAgICAgICAgICRjb29yZGluYXRlcyAgICBDZWxsIGNvb3JkaW5hdGVzCiAgICAgKiBAcmV0dXJuICAgIHN0cmluZwogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gd3JpdGVDaGFydEluQ2VsbChQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCwgJGNvb3JkaW5hdGVzKQogICAgewogICAgICAgIC8vIENvbnN0cnVjdCBIVE1MCiAgICAgICAgJGh0bWwgPSAnJzsKCiAgICAgICAgLy8gV3JpdGUgY2hhcnRzCiAgICAgICAgZm9yZWFjaCAoJHBTaGVldC0+Z2V0Q2hhcnRDb2xsZWN0aW9uKCkgYXMgJGNoYXJ0KSB7CiAgICAgICAgICAgIGlmICgkY2hhcnQgaW5zdGFuY2VvZiBQSFBFeGNlbF9DaGFydCkgewogICAgICAgICAgICAgICAgJGNoYXJ0Q29vcmRpbmF0ZXMgPSAkY2hhcnQtPmdldFRvcExlZnRQb3NpdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKCRjaGFydENvb3JkaW5hdGVzWydjZWxsJ10gPT0gJGNvb3JkaW5hdGVzKSB7CiAgICAgICAgICAgICAgICAgICAgJGNoYXJ0RmlsZU5hbWUgPSBQSFBFeGNlbF9TaGFyZWRfRmlsZTo6c3lzX2dldF90ZW1wX2RpcigpLicvJy51bmlxaWQoKS4nLnBuZyc7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkY2hhcnQtPnJlbmRlcigkY2hhcnRGaWxlTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gUEhQX0VPTDsKICAgICAgICAgICAgICAgICAgICAkaW1hZ2VEZXRhaWxzID0gZ2V0aW1hZ2VzaXplKCRjaGFydEZpbGVOYW1lKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGZwID0gZm9wZW4oJGNoYXJ0RmlsZU5hbWUsICJyYiIsIDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRwaWN0dXJlID0gZnJlYWQoJGZwLCBmaWxlc2l6ZSgkY2hhcnRGaWxlTmFtZSkpOwogICAgICAgICAgICAgICAgICAgICAgICBmY2xvc2UoJGZwKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmFzZTY0IGVuY29kZSB0aGUgYmluYXJ5IGRhdGEsIHRoZW4gYnJlYWsgaXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW50byBjaHVua3MgYWNjb3JkaW5nIHRvIFJGQyAyMDQ1IHNlbWFudGljcwogICAgICAgICAgICAgICAgICAgICAgICAkYmFzZTY0ID0gY2h1bmtfc3BsaXQoYmFzZTY0X2VuY29kZSgkcGljdHVyZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VEYXRhID0gJ2RhdGE6Jy4kaW1hZ2VEZXRhaWxzWydtaW1lJ10uJztiYXNlNjQsJyAuICRiYXNlNjQ7CgogICAgICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnPGRpdiBzdHlsZT0icG9zaXRpb246IHJlbGF0aXZlOyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJzxpbWcgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgei1pbmRleDogMTsgbGVmdDogJyAuICRjaGFydENvb3JkaW5hdGVzWyd4T2Zmc2V0J10gLiAncHg7IHRvcDogJyAuICRjaGFydENvb3JkaW5hdGVzWyd5T2Zmc2V0J10gLiAncHg7IHdpZHRoOiAnIC4gJGltYWdlRGV0YWlsc1swXSAuICdweDsgaGVpZ2h0OiAnIC4gJGltYWdlRGV0YWlsc1sxXSAuICdweDsiIHNyYz0iJyAuICRpbWFnZURhdGEgLiAnIiBib3JkZXI9IjAiIC8+JyAuIFBIUF9FT0w7CiAgICAgICAgICAgICAgICAgICAgICAgICRodG1sIC49ICc8L2Rpdj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKCRjaGFydEZpbGVOYW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiAkaHRtbDsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIENTUyBzdHlsZXMKICAgICAqCiAgICAgKiBAcGFyYW0gICAgYm9vbGVhbiAgICAkZ2VuZXJhdGVTdXJyb3VuZGluZ0hUTUwgICAgR2VuZXJhdGUgc3Vycm91bmRpbmcgSFRNTCB0YWdzPyAoJmx0O3N0eWxlJmd0OyBhbmQgJmx0Oy9zdHlsZSZndDspCiAgICAgKiBAcmV0dXJuICAgIHN0cmluZwogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZW5lcmF0ZVN0eWxlcygkZ2VuZXJhdGVTdXJyb3VuZGluZ0hUTUwgPSB0cnVlKQogICAgewogICAgICAgIC8vIFBIUEV4Y2VsIG9iamVjdCBrbm93bj8KICAgICAgICBpZiAoaXNfbnVsbCgkdGhpcy0+cGhwRXhjZWwpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uKCdJbnRlcm5hbCBQSFBFeGNlbCBvYmplY3Qgbm90IHNldCB0byBhbiBpbnN0YW5jZSBvZiBhbiBvYmplY3QuJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBCdWlsZCBDU1MKICAgICAgICAkY3NzID0gJHRoaXMtPmJ1aWxkQ1NTKCRnZW5lcmF0ZVN1cnJvdW5kaW5nSFRNTCk7CgogICAgICAgIC8vIENvbnN0cnVjdCBIVE1MCiAgICAgICAgJGh0bWwgPSAnJzsKCiAgICAgICAgLy8gU3RhcnQgc3R5bGVzCiAgICAgICAgaWYgKCRnZW5lcmF0ZVN1cnJvdW5kaW5nSFRNTCkgewogICAgICAgICAgICAkaHRtbCAuPSAnICAgIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+JyAuIFBIUF9FT0w7CiAgICAgICAgICAgICRodG1sIC49ICcgICAgICBodG1sIHsgJyAuICR0aGlzLT5hc3NlbWJsZUNTUygkY3NzWydodG1sJ10pIC4gJyB9JyAuIFBIUF9FT0w7CiAgICAgICAgfQoKICAgICAgICAvLyBXcml0ZSBhbGwgb3RoZXIgc3R5bGVzCiAgICAgICAgZm9yZWFjaCAoJGNzcyBhcyAkc3R5bGVOYW1lID0+ICRzdHlsZURlZmluaXRpb24pIHsKICAgICAgICAgICAgaWYgKCRzdHlsZU5hbWUgIT0gJ2h0bWwnKSB7CiAgICAgICAgICAgICAgICAkaHRtbCAuPSAnICAgICAgJyAuICRzdHlsZU5hbWUgLiAnIHsgJyAuICR0aGlzLT5hc3NlbWJsZUNTUygkc3R5bGVEZWZpbml0aW9uKSAuICcgfScgLiBQSFBfRU9MOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBFbmQgc3R5bGVzCiAgICAgICAgaWYgKCRnZW5lcmF0ZVN1cnJvdW5kaW5nSFRNTCkgewogICAgICAgICAgICAkaHRtbCAuPSAnICAgIDwvc3R5bGU+JyAuIFBIUF9FT0w7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gJGh0bWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBCdWlsZCBDU1Mgc3R5bGVzCiAgICAgKgogICAgICogQHBhcmFtICAgIGJvb2xlYW4gICAgJGdlbmVyYXRlU3Vycm91bmRpbmdIVE1MICAgIEdlbmVyYXRlIHN1cnJvdW5kaW5nIEhUTUwgc3R5bGU\/IChodG1sIHsgfSkKICAgICAqIEByZXR1cm4gICAgYXJyYXkKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYnVpbGRDU1MoJGdlbmVyYXRlU3Vycm91bmRpbmdIVE1MID0gdHJ1ZSkKICAgIHsKICAgICAgICAvLyBQSFBFeGNlbCBvYmplY3Qga25vd24\/CiAgICAgICAgaWYgKGlzX251bGwoJHRoaXMtPnBocEV4Y2VsKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbignSW50ZXJuYWwgUEhQRXhjZWwgb2JqZWN0IG5vdCBzZXQgdG8gYW4gaW5zdGFuY2Ugb2YgYW4gb2JqZWN0LicpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FjaGVkPwogICAgICAgIGlmICghaXNfbnVsbCgkdGhpcy0+Y3NzU3R5bGVzKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmNzc1N0eWxlczsKICAgICAgICB9CgogICAgICAgIC8vIEVuc3VyZSB0aGF0IHNwYW5zIGhhdmUgYmVlbiBjYWxjdWxhdGVkCiAgICAgICAgaWYgKCEkdGhpcy0+c3BhbnNBcmVDYWxjdWxhdGVkKSB7CiAgICAgICAgICAgICR0aGlzLT5jYWxjdWxhdGVTcGFucygpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29uc3RydWN0IENTUwogICAgICAgICRjc3MgPSBhcnJheSgpOwoKICAgICAgICAvLyBTdGFydCBzdHlsZXMKICAgICAgICBpZiAoJGdlbmVyYXRlU3Vycm91bmRpbmdIVE1MKSB7CiAgICAgICAgICAgIC8vIGh0bWwgeyB9CiAgICAgICAgICAgICRjc3NbJ2h0bWwnXVsnZm9udC1mYW1pbHknXSAgICAgID0gJ0NhbGlicmksIEFyaWFsLCBIZWx2ZXRpY2EsIHNhbnMtc2VyaWYnOwogICAgICAgICAgICAkY3NzWydodG1sJ11bJ2ZvbnQtc2l6ZSddICAgICAgICA9ICcxMXB0JzsKICAgICAgICAgICAgJGNzc1snaHRtbCddWydiYWNrZ3JvdW5kLWNvbG9yJ10gPSAnd2hpdGUnOwogICAgICAgIH0KCgogICAgICAgIC8vIHRhYmxlIHsgfQogICAgICAgICRjc3NbJ3RhYmxlJ11bJ2JvcmRlci1jb2xsYXBzZSddICA9ICdjb2xsYXBzZSc7CiAgICAgICAgaWYgKCEkdGhpcy0+aXNQZGYpIHsKICAgICAgICAgICAgJGNzc1sndGFibGUnXVsncGFnZS1icmVhay1hZnRlciddID0gJ2Fsd2F5cyc7CiAgICAgICAgfQoKICAgICAgICAvLyAuZ3JpZGxpbmVzIHRkIHsgfQogICAgICAgICRjc3NbJy5ncmlkbGluZXMgdGQnXVsnYm9yZGVyJ10gPSAnMXB4IGRvdHRlZCBibGFjayc7CiAgICAgICAgJGNzc1snLmdyaWRsaW5lcyB0aCddWydib3JkZXInXSA9ICcxcHggZG90dGVkIGJsYWNrJzsKCiAgICAgICAgLy8gLmIge30KICAgICAgICAkY3NzWycuYiddWyd0ZXh0LWFsaWduJ10gPSAnY2VudGVyJzsgLy8gQk9PTAoKICAgICAgICAvLyAuZSB7fQogICAgICAgICRjc3NbJy5lJ11bJ3RleHQtYWxpZ24nXSA9ICdjZW50ZXInOyAvLyBFUlJPUgoKICAgICAgICAvLyAuZiB7fQogICAgICAgICRjc3NbJy5mJ11bJ3RleHQtYWxpZ24nXSA9ICdyaWdodCc7IC8vIEZPUk1VTEEKCiAgICAgICAgLy8gLmlubGluZVN0ciB7fQogICAgICAgICRjc3NbJy5pbmxpbmVTdHInXVsndGV4dC1hbGlnbiddID0gJ2xlZnQnOyAvLyBJTkxJTkUKCiAgICAgICAgLy8gLm4ge30KICAgICAgICAkY3NzWycubiddWyd0ZXh0LWFsaWduJ10gPSAncmlnaHQnOyAvLyBOVU1FUklDCgogICAgICAgIC8vIC5zIHt9CiAgICAgICAgJGNzc1snLnMnXVsndGV4dC1hbGlnbiddID0gJ2xlZnQnOyAvLyBTVFJJTkcKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGNlbGwgc3R5bGUgaGFzaGVzCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnBocEV4Y2VsLT5nZXRDZWxsWGZDb2xsZWN0aW9uKCkgYXMgJGluZGV4ID0+ICRzdHlsZSkgewogICAgICAgICAgICAkY3NzWyd0ZC5zdHlsZScgLiAkaW5kZXhdID0gJHRoaXMtPmNyZWF0ZUNTU1N0eWxlKCRzdHlsZSk7CiAgICAgICAgICAgICRjc3NbJ3RoLnN0eWxlJyAuICRpbmRleF0gPSAkdGhpcy0+Y3JlYXRlQ1NTU3R5bGUoJHN0eWxlKTsKICAgICAgICB9CgogICAgICAgIC8vIEZldGNoIHNoZWV0cwogICAgICAgICRzaGVldHMgPSBhcnJheSgpOwogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5zaGVldEluZGV4KSkgewogICAgICAgICAgICAkc2hlZXRzID0gJHRoaXMtPnBocEV4Y2VsLT5nZXRBbGxTaGVldHMoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2hlZXRzW10gPSAkdGhpcy0+cGhwRXhjZWwtPmdldFNoZWV0KCR0aGlzLT5zaGVldEluZGV4KTsKICAgICAgICB9CgogICAgICAgIC8vIEJ1aWxkIHN0eWxlcyBwZXIgc2hlZXQKICAgICAgICBmb3JlYWNoICgkc2hlZXRzIGFzICRzaGVldCkgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgaGFzaCBjb2RlCiAgICAgICAgICAgICRzaGVldEluZGV4ID0gJHNoZWV0LT5nZXRQYXJlbnQoKS0+Z2V0SW5kZXgoJHNoZWV0KTsKCiAgICAgICAgICAgIC8vIEJ1aWxkIHN0eWxlcwogICAgICAgICAgICAvLyBDYWxjdWxhdGUgY29sdW1uIHdpZHRocwogICAgICAgICAgICAkc2hlZXQtPmNhbGN1bGF0ZUNvbHVtbldpZHRocygpOwoKICAgICAgICAgICAgLy8gY29sIGVsZW1lbnRzLCBpbml0aWFsaXplCiAgICAgICAgICAgICRoaWdoZXN0Q29sdW1uSW5kZXggPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJHNoZWV0LT5nZXRIaWdoZXN0Q29sdW1uKCkpIC0gMTsKICAgICAgICAgICAgJGNvbHVtbiA9IC0xOwogICAgICAgICAgICB3aGlsZSAoJGNvbHVtbisrIDwgJGhpZ2hlc3RDb2x1bW5JbmRleCkgewogICAgICAgICAgICAgICAgJHRoaXMtPmNvbHVtbldpZHRoc1skc2hlZXRJbmRleF1bJGNvbHVtbl0gPSA0MjsgLy8gYXBwcm94aW1hdGlvbgogICAgICAgICAgICAgICAgJGNzc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIGNvbC5jb2wnIC4gJGNvbHVtbl1bJ3dpZHRoJ10gPSAnNDJwdCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNvbCBlbGVtZW50cywgbG9vcCB0aHJvdWdoIGNvbHVtbkRpbWVuc2lvbnMgYW5kIHNldCB3aWR0aAogICAgICAgICAgICBmb3JlYWNoICgkc2hlZXQtPmdldENvbHVtbkRpbWVuc2lvbnMoKSBhcyAkY29sdW1uRGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoKCR3aWR0aCA9IFBIUEV4Y2VsX1NoYXJlZF9EcmF3aW5nOjpjZWxsRGltZW5zaW9uVG9QaXhlbHMoJGNvbHVtbkRpbWVuc2lvbi0+Z2V0V2lkdGgoKSwgJHRoaXMtPmRlZmF1bHRGb250KSkgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICR3aWR0aCA9IFBIUEV4Y2VsX1NoYXJlZF9EcmF3aW5nOjpwaXhlbHNUb1BvaW50cygkd2lkdGgpOwogICAgICAgICAgICAgICAgICAgICRjb2x1bW4gPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNvbHVtbkRpbWVuc2lvbi0+Z2V0Q29sdW1uSW5kZXgoKSkgLSAxOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jb2x1bW5XaWR0aHNbJHNoZWV0SW5kZXhdWyRjb2x1bW5dID0gJHdpZHRoOwogICAgICAgICAgICAgICAgICAgICRjc3NbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyBjb2wuY29sJyAuICRjb2x1bW5dWyd3aWR0aCddID0gJHdpZHRoIC4gJ3B0JzsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb2x1bW5EaW1lbnNpb24tPmdldFZpc2libGUoKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNzc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIGNvbC5jb2wnIC4gJGNvbHVtbl1bJ3Zpc2liaWxpdHknXSA9ICdjb2xsYXBzZSc7CiAgICAgICAgICAgICAgICAgICAgICAgICRjc3NbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyBjb2wuY29sJyAuICRjb2x1bW5dWycqZGlzcGxheSddID0gJ25vbmUnOyAvLyB0YXJnZXQgSUU2KzcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERlZmF1bHQgcm93IGhlaWdodAogICAgICAgICAgICAkcm93RGltZW5zaW9uID0gJHNoZWV0LT5nZXREZWZhdWx0Um93RGltZW5zaW9uKCk7CgogICAgICAgICAgICAvLyB0YWJsZS5zaGVldE4gdHIgeyB9CiAgICAgICAgICAgICRjc3NbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyB0ciddID0gYXJyYXkoKTsKCiAgICAgICAgICAgIGlmICgkcm93RGltZW5zaW9uLT5nZXRSb3dIZWlnaHQoKSA9PSAtMSkgewogICAgICAgICAgICAgICAgJHB0X2hlaWdodCA9IFBIUEV4Y2VsX1NoYXJlZF9Gb250OjpnZXREZWZhdWx0Um93SGVpZ2h0QnlGb250KCR0aGlzLT5waHBFeGNlbC0+Z2V0RGVmYXVsdFN0eWxlKCktPmdldEZvbnQoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkcHRfaGVpZ2h0ID0gJHJvd0RpbWVuc2lvbi0+Z2V0Um93SGVpZ2h0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGNzc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIHRyJ11bJ2hlaWdodCddID0gJHB0X2hlaWdodCAuICdwdCc7CiAgICAgICAgICAgIGlmICgkcm93RGltZW5zaW9uLT5nZXRWaXNpYmxlKCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAkY3NzWyd0YWJsZS5zaGVldCcgLiAkc2hlZXRJbmRleCAuICcgdHInXVsnZGlzcGxheSddICAgID0gJ25vbmUnOwogICAgICAgICAgICAgICAgJGNzc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIHRyJ11bJ3Zpc2liaWxpdHknXSA9ICdoaWRkZW4nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDYWxjdWxhdGUgcm93IGhlaWdodHMKICAgICAgICAgICAgZm9yZWFjaCAoJHNoZWV0LT5nZXRSb3dEaW1lbnNpb25zKCkgYXMgJHJvd0RpbWVuc2lvbikgewogICAgICAgICAgICAgICAgJHJvdyA9ICRyb3dEaW1lbnNpb24tPmdldFJvd0luZGV4KCkgLSAxOwoKICAgICAgICAgICAgICAgIC8vIHRhYmxlLnNoZWV0TiB0ci5yb3dZWVlZWVkgeyB9CiAgICAgICAgICAgICAgICAkY3NzWyd0YWJsZS5zaGVldCcgLiAkc2hlZXRJbmRleCAuICcgdHIucm93JyAuICRyb3ddID0gYXJyYXkoKTsKCiAgICAgICAgICAgICAgICBpZiAoJHJvd0RpbWVuc2lvbi0+Z2V0Um93SGVpZ2h0KCkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAkcHRfaGVpZ2h0ID0gUEhQRXhjZWxfU2hhcmVkX0ZvbnQ6OmdldERlZmF1bHRSb3dIZWlnaHRCeUZvbnQoJHRoaXMtPnBocEV4Y2VsLT5nZXREZWZhdWx0U3R5bGUoKS0+Z2V0Rm9udCgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHB0X2hlaWdodCA9ICRyb3dEaW1lbnNpb24tPmdldFJvd0hlaWdodCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNzc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIHRyLnJvdycgLiAkcm93XVsnaGVpZ2h0J10gPSAkcHRfaGVpZ2h0IC4gJ3B0JzsKICAgICAgICAgICAgICAgIGlmICgkcm93RGltZW5zaW9uLT5nZXRWaXNpYmxlKCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgJGNzc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIHRyLnJvdycgLiAkcm93XVsnZGlzcGxheSddID0gJ25vbmUnOwogICAgICAgICAgICAgICAgICAgICRjc3NbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyB0ci5yb3cnIC4gJHJvd11bJ3Zpc2liaWxpdHknXSA9ICdoaWRkZW4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDYWNoZQogICAgICAgIGlmIChpc19udWxsKCR0aGlzLT5jc3NTdHlsZXMpKSB7CiAgICAgICAgICAgICR0aGlzLT5jc3NTdHlsZXMgPSAkY3NzOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuCiAgICAgICAgcmV0dXJuICRjc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgQ1NTIHN0eWxlCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1N0eWxlICAgICAgICAkcFN0eWxlICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGUKICAgICAqIEByZXR1cm4gICAgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBjcmVhdGVDU1NTdHlsZShQSFBFeGNlbF9TdHlsZSAkcFN0eWxlKQogICAgewogICAgICAgIC8vIENvbnN0cnVjdCBDU1MKICAgICAgICAkY3NzID0gJyc7CgogICAgICAgIC8vIENyZWF0ZSBDU1MKICAgICAgICAkY3NzID0gYXJyYXlfbWVyZ2UoCiAgICAgICAgICAgICR0aGlzLT5jcmVhdGVDU1NTdHlsZUFsaWdubWVudCgkcFN0eWxlLT5nZXRBbGlnbm1lbnQoKSksCiAgICAgICAgICAgICR0aGlzLT5jcmVhdGVDU1NTdHlsZUJvcmRlcnMoJHBTdHlsZS0+Z2V0Qm9yZGVycygpKSwKICAgICAgICAgICAgJHRoaXMtPmNyZWF0ZUNTU1N0eWxlRm9udCgkcFN0eWxlLT5nZXRGb250KCkpLAogICAgICAgICAgICAkdGhpcy0+Y3JlYXRlQ1NTU3R5bGVGaWxsKCRwU3R5bGUtPmdldEZpbGwoKSkKICAgICAgICApOwoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gJGNzczsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBDU1Mgc3R5bGUgKFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudCkKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50ICAgICAgICAkcFN0eWxlICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50CiAgICAgKiBAcmV0dXJuICAgIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gY3JlYXRlQ1NTU3R5bGVBbGlnbm1lbnQoUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50ICRwU3R5bGUpCiAgICB7CiAgICAgICAgLy8gQ29uc3RydWN0IENTUwogICAgICAgICRjc3MgPSBhcnJheSgpOwoKICAgICAgICAvLyBDcmVhdGUgQ1NTCiAgICAgICAgJGNzc1sndmVydGljYWwtYWxpZ24nXSA9ICR0aGlzLT5tYXBWQWxpZ24oJHBTdHlsZS0+Z2V0VmVydGljYWwoKSk7CiAgICAgICAgaWYgKCR0ZXh0QWxpZ24gPSAkdGhpcy0+bWFwSEFsaWduKCRwU3R5bGUtPmdldEhvcml6b250YWwoKSkpIHsKICAgICAgICAgICAgJGNzc1sndGV4dC1hbGlnbiddID0gJHRleHRBbGlnbjsKICAgICAgICAgICAgaWYgKGluX2FycmF5KCR0ZXh0QWxpZ24sIGFycmF5KCdsZWZ0JywgJ3JpZ2h0JykpKSB7CiAgICAgICAgICAgICAgICAkY3NzWydwYWRkaW5nLScuJHRleHRBbGlnbl0gPSAoc3RyaW5nKSgoaW50KSRwU3R5bGUtPmdldEluZGVudCgpICogOSkuJ3B4JzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRjc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgQ1NTIHN0eWxlIChQSFBFeGNlbF9TdHlsZV9Gb250KQogICAgICoKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9TdHlsZV9Gb250ICAgICAgICAkcFN0eWxlICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGVfRm9udAogICAgICogQHJldHVybiAgICBhcnJheQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGNyZWF0ZUNTU1N0eWxlRm9udChQSFBFeGNlbF9TdHlsZV9Gb250ICRwU3R5bGUpCiAgICB7CiAgICAgICAgLy8gQ29uc3RydWN0IENTUwogICAgICAgICRjc3MgPSBhcnJheSgpOwoKICAgICAgICAvLyBDcmVhdGUgQ1NTCiAgICAgICAgaWYgKCRwU3R5bGUtPmdldEJvbGQoKSkgewogICAgICAgICAgICAkY3NzWydmb250LXdlaWdodCddID0gJ2JvbGQnOwogICAgICAgIH0KICAgICAgICBpZiAoJHBTdHlsZS0+Z2V0VW5kZXJsaW5lKCkgIT0gUEhQRXhjZWxfU3R5bGVfRm9udDo6VU5ERVJMSU5FX05PTkUgJiYgJHBTdHlsZS0+Z2V0U3RyaWtldGhyb3VnaCgpKSB7CiAgICAgICAgICAgICRjc3NbJ3RleHQtZGVjb3JhdGlvbiddID0gJ3VuZGVybGluZSBsaW5lLXRocm91Z2gnOwogICAgICAgIH0gZWxzZWlmICgkcFN0eWxlLT5nZXRVbmRlcmxpbmUoKSAhPSBQSFBFeGNlbF9TdHlsZV9Gb250OjpVTkRFUkxJTkVfTk9ORSkgewogICAgICAgICAgICAkY3NzWyd0ZXh0LWRlY29yYXRpb24nXSA9ICd1bmRlcmxpbmUnOwogICAgICAgIH0gZWxzZWlmICgkcFN0eWxlLT5nZXRTdHJpa2V0aHJvdWdoKCkpIHsKICAgICAgICAgICAgJGNzc1sndGV4dC1kZWNvcmF0aW9uJ10gPSAnbGluZS10aHJvdWdoJzsKICAgICAgICB9CiAgICAgICAgaWYgKCRwU3R5bGUtPmdldEl0YWxpYygpKSB7CiAgICAgICAgICAgICRjc3NbJ2ZvbnQtc3R5bGUnXSA9ICdpdGFsaWMnOwogICAgICAgIH0KCiAgICAgICAgJGNzc1snY29sb3InXSAgICAgICA9ICcjJyAuICRwU3R5bGUtPmdldENvbG9yKCktPmdldFJHQigpOwogICAgICAgICRjc3NbJ2ZvbnQtZmFtaWx5J10gPSAnXCcnIC4gJHBTdHlsZS0+Z2V0TmFtZSgpIC4gJ1wnJzsKICAgICAgICAkY3NzWydmb250LXNpemUnXSAgID0gJHBTdHlsZS0+Z2V0U2l6ZSgpIC4gJ3B0JzsKCiAgICAgICAgcmV0dXJuICRjc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgQ1NTIHN0eWxlIChQSFBFeGNlbF9TdHlsZV9Cb3JkZXJzKQogICAgICoKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9TdHlsZV9Cb3JkZXJzICAgICAgICAkcFN0eWxlICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGVfQm9yZGVycwogICAgICogQHJldHVybiAgICBhcnJheQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGNyZWF0ZUNTU1N0eWxlQm9yZGVycyhQSFBFeGNlbF9TdHlsZV9Cb3JkZXJzICRwU3R5bGUpCiAgICB7CiAgICAgICAgLy8gQ29uc3RydWN0IENTUwogICAgICAgICRjc3MgPSBhcnJheSgpOwoKICAgICAgICAvLyBDcmVhdGUgQ1NTCiAgICAgICAgJGNzc1snYm9yZGVyLWJvdHRvbSddID0gJHRoaXMtPmNyZWF0ZUNTU1N0eWxlQm9yZGVyKCRwU3R5bGUtPmdldEJvdHRvbSgpKTsKICAgICAgICAkY3NzWydib3JkZXItdG9wJ10gICAgPSAkdGhpcy0+Y3JlYXRlQ1NTU3R5bGVCb3JkZXIoJHBTdHlsZS0+Z2V0VG9wKCkpOwogICAgICAgICRjc3NbJ2JvcmRlci1sZWZ0J10gICA9ICR0aGlzLT5jcmVhdGVDU1NTdHlsZUJvcmRlcigkcFN0eWxlLT5nZXRMZWZ0KCkpOwogICAgICAgICRjc3NbJ2JvcmRlci1yaWdodCddICA9ICR0aGlzLT5jcmVhdGVDU1NTdHlsZUJvcmRlcigkcFN0eWxlLT5nZXRSaWdodCgpKTsKCiAgICAgICAgcmV0dXJuICRjc3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgQ1NTIHN0eWxlIChQSFBFeGNlbF9TdHlsZV9Cb3JkZXIpCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1N0eWxlX0JvcmRlciAgICAgICAgJHBTdHlsZSAgICAgICAgICAgIFBIUEV4Y2VsX1N0eWxlX0JvcmRlcgogICAgICogQHJldHVybiAgICBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBjcmVhdGVDU1NTdHlsZUJvcmRlcihQSFBFeGNlbF9TdHlsZV9Cb3JkZXIgJHBTdHlsZSkKICAgIHsKICAgICAgICAvLyBDcmVhdGUgQ1NTCi8vICAgICAgICAkY3NzID0gJHRoaXMtPm1hcEJvcmRlclN0eWxlKCRwU3R5bGUtPmdldEJvcmRlclN0eWxlKCkpIC4gJyAjJyAuICRwU3R5bGUtPmdldENvbG9yKCktPmdldFJHQigpOwogICAgICAgIC8vICAgIENyZWF0ZSBDU1MgLSBhZGQgIWltcG9ydGFudCB0byBub24tbm9uZSBib3JkZXIgc3R5bGVzIGZvciBtZXJnZWQgY2VsbHMKICAgICAgICAkYm9yZGVyU3R5bGUgPSAkdGhpcy0+bWFwQm9yZGVyU3R5bGUoJHBTdHlsZS0+Z2V0Qm9yZGVyU3R5bGUoKSk7CiAgICAgICAgJGNzcyA9ICRib3JkZXJTdHlsZSAuICcgIycgLiAkcFN0eWxlLT5nZXRDb2xvcigpLT5nZXRSR0IoKSAuICgoJGJvcmRlclN0eWxlID09ICdub25lJykgPyAnJyA6ICcgIWltcG9ydGFudCcpOwoKICAgICAgICByZXR1cm4gJGNzczsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBDU1Mgc3R5bGUgKFBIUEV4Y2VsX1N0eWxlX0ZpbGwpCiAgICAgKgogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX1N0eWxlX0ZpbGwgICAgICAgICRwU3R5bGUgICAgICAgICAgICBQSFBFeGNlbF9TdHlsZV9GaWxsCiAgICAgKiBAcmV0dXJuICAgIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gY3JlYXRlQ1NTU3R5bGVGaWxsKFBIUEV4Y2VsX1N0eWxlX0ZpbGwgJHBTdHlsZSkKICAgIHsKICAgICAgICAvLyBDb25zdHJ1Y3QgSFRNTAogICAgICAgICRjc3MgPSBhcnJheSgpOwoKICAgICAgICAvLyBDcmVhdGUgQ1NTCiAgICAgICAgJHZhbHVlID0gJHBTdHlsZS0+Z2V0RmlsbFR5cGUoKSA9PSBQSFBFeGNlbF9TdHlsZV9GaWxsOjpGSUxMX05PTkUgPwogICAgICAgICAgICAnd2hpdGUnIDogJyMnIC4gJHBTdHlsZS0+Z2V0U3RhcnRDb2xvcigpLT5nZXRSR0IoKTsKICAgICAgICAkY3NzWydiYWNrZ3JvdW5kLWNvbG9yJ10gPSAkdmFsdWU7CgogICAgICAgIHJldHVybiAkY3NzOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgSFRNTCBmb290ZXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdlbmVyYXRlSFRNTEZvb3RlcigpCiAgICB7CiAgICAgICAgLy8gQ29uc3RydWN0IEhUTUwKICAgICAgICAkaHRtbCA9ICcnOwogICAgICAgICRodG1sIC49ICcgIDwvYm9keT4nIC4gUEhQX0VPTDsKICAgICAgICAkaHRtbCAuPSAnPC9odG1sPicgLiBQSFBfRU9MOwoKICAgICAgICByZXR1cm4gJGh0bWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSB0YWJsZSBoZWFkZXIKICAgICAqCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0ICAgICRwU2hlZXQgICAgICAgIFRoZSB3b3Jrc2hlZXQgZm9yIHRoZSB0YWJsZSB3ZSBhcmUgd3JpdGluZwogICAgICogQHJldHVybiAgICBzdHJpbmcKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGdlbmVyYXRlVGFibGVIZWFkZXIoJHBTaGVldCkKICAgIHsKICAgICAgICAkc2hlZXRJbmRleCA9ICRwU2hlZXQtPmdldFBhcmVudCgpLT5nZXRJbmRleCgkcFNoZWV0KTsKCiAgICAgICAgLy8gQ29uc3RydWN0IEhUTUwKICAgICAgICAkaHRtbCA9ICcnOwogICAgICAgICRodG1sIC49ICR0aGlzLT5zZXRNYXJnaW5zKCRwU2hlZXQpOwogICAgICAgICAgICAKICAgICAgICBpZiAoISR0aGlzLT51c2VJbmxpbmVDc3MpIHsKICAgICAgICAgICAgJGdyaWRsaW5lcyA9ICRwU2hlZXQtPmdldFNob3dHcmlkbGluZXMoKSA\/ICcgZ3JpZGxpbmVzJyA6ICcnOwogICAgICAgICAgICAkaHRtbCAuPSAnICAgIDx0YWJsZSBib3JkZXI9IjAiIGNlbGxwYWRkaW5nPSIwIiBjZWxsc3BhY2luZz0iMCIgaWQ9InNoZWV0JyAuICRzaGVldEluZGV4IC4gJyIgY2xhc3M9InNoZWV0JyAuICRzaGVldEluZGV4IC4gJGdyaWRsaW5lcyAuICciPicgLiBQSFBfRU9MOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzdHlsZSA9IGlzc2V0KCR0aGlzLT5jc3NTdHlsZXNbJ3RhYmxlJ10pID8KICAgICAgICAgICAgICAgICR0aGlzLT5hc3NlbWJsZUNTUygkdGhpcy0+Y3NzU3R5bGVzWyd0YWJsZSddKSA6ICcnOwoKICAgICAgICAgICAgaWYgKCR0aGlzLT5pc1BkZiAmJiAkcFNoZWV0LT5nZXRTaG93R3JpZGxpbmVzKCkpIHsKICAgICAgICAgICAgICAgICRodG1sIC49ICcgICAgPHRhYmxlIGJvcmRlcj0iMSIgY2VsbHBhZGRpbmc9IjEiIGlkPSJzaGVldCcgLiAkc2hlZXRJbmRleCAuICciIGNlbGxzcGFjaW5nPSIxIiBzdHlsZT0iJyAuICRzdHlsZSAuICciPicgLiBQSFBfRU9MOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGh0bWwgLj0gJyAgICA8dGFibGUgYm9yZGVyPSIwIiBjZWxscGFkZGluZz0iMSIgaWQ9InNoZWV0JyAuICRzaGVldEluZGV4IC4gJyIgY2VsbHNwYWNpbmc9IjAiIHN0eWxlPSInIC4gJHN0eWxlIC4gJyI+JyAuIFBIUF9FT0w7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIDxjb2w+IGVsZW1lbnRzCiAgICAgICAgJGhpZ2hlc3RDb2x1bW5JbmRleCA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkcFNoZWV0LT5nZXRIaWdoZXN0Q29sdW1uKCkpIC0gMTsKICAgICAgICAkaSA9IC0xOwogICAgICAgIHdoaWxlICgkaSsrIDwgJGhpZ2hlc3RDb2x1bW5JbmRleCkgewogICAgICAgICAgICBpZiAoISR0aGlzLT5pc1BkZikgewogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+dXNlSW5saW5lQ3NzKSB7CiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgICAgPGNvbCBjbGFzcz0iY29sJyAuICRpIC4gJyI+JyAuIFBIUF9FT0w7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRzdHlsZSA9IGlzc2V0KCR0aGlzLT5jc3NTdHlsZXNbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyBjb2wuY29sJyAuICRpXSkgPwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+YXNzZW1ibGVDU1MoJHRoaXMtPmNzc1N0eWxlc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIGNvbC5jb2wnIC4gJGldKSA6ICcnOwogICAgICAgICAgICAgICAgICAgICRodG1sIC49ICcgICAgICAgIDxjb2wgc3R5bGU9IicgLiAkc3R5bGUgLiAnIj4nIC4gUEhQX0VPTDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRodG1sOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgdGFibGUgZm9vdGVyCiAgICAgKgogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZ2VuZXJhdGVUYWJsZUZvb3RlcigpCiAgICB7CiAgICAgICAgJGh0bWwgPSAnICAgIDwvdGFibGU+JyAuIFBIUF9FT0w7CgogICAgICAgIHJldHVybiAkaHRtbDsKICAgIH0KCiAgICAvKioKICAgICAqIEdlbmVyYXRlIHJvdwogICAgICoKICAgICAqIEBwYXJhbSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQgICAgJHBTaGVldCAgICAgICAgICAgIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICogQHBhcmFtICAgIGFycmF5ICAgICAgICAgICAgICAgICRwVmFsdWVzICAgICAgICBBcnJheSBjb250YWluaW5nIGNlbGxzIGluIGEgcm93CiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAgICAgICAgICAgICAkcFJvdyAgICAgICAgICAgIFJvdyBudW1iZXIgKDAtYmFzZWQpCiAgICAgKiBAcmV0dXJuICAgIHN0cmluZwogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9Xcml0ZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZ2VuZXJhdGVSb3coUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQsICRwVmFsdWVzID0gbnVsbCwgJHBSb3cgPSAwLCAkY2VsbFR5cGUgPSAndGQnKQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkcFZhbHVlcykpIHsKICAgICAgICAgICAgLy8gQ29uc3RydWN0IEhUTUwKICAgICAgICAgICAgJGh0bWwgPSAnJzsKCiAgICAgICAgICAgIC8vIFNoZWV0IGluZGV4CiAgICAgICAgICAgICRzaGVldEluZGV4ID0gJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldEluZGV4KCRwU2hlZXQpOwoKICAgICAgICAgICAgLy8gRG9tUERGIGFuZCBicmVha3MKICAgICAgICAgICAgaWYgKCR0aGlzLT5pc1BkZiAmJiBjb3VudCgkcFNoZWV0LT5nZXRCcmVha3MoKSkgPiAwKSB7CiAgICAgICAgICAgICAgICAkYnJlYWtzID0gJHBTaGVldC0+Z2V0QnJlYWtzKCk7CgogICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgYSBicmVhayBpcyBuZWVkZWQgYmVmb3JlIHRoaXMgcm93CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGJyZWFrc1snQScgLiAkcFJvd10pKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgdGFibGU6IDwvdGFibGU+CiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJHRoaXMtPmdlbmVyYXRlVGFibGVGb290ZXIoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0IHBhZ2UgYnJlYWsKICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnPGRpdiBzdHlsZT0icGFnZS1icmVhay1iZWZvcmU6YWx3YXlzIiAvPic7CgogICAgICAgICAgICAgICAgICAgIC8vIG9wZW4gdGFibGUgYWdhaW46IDx0YWJsZT4gKyA8Y29sPiBldGMuCiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJHRoaXMtPmdlbmVyYXRlVGFibGVIZWFkZXIoJHBTaGVldCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFdyaXRlIHJvdyBzdGFydAogICAgICAgICAgICBpZiAoISR0aGlzLT51c2VJbmxpbmVDc3MpIHsKICAgICAgICAgICAgICAgICRodG1sIC49ICcgICAgICAgICAgPHRyIGNsYXNzPSJyb3cnIC4gJHBSb3cgLiAnIj4nIC4gUEhQX0VPTDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRzdHlsZSA9IGlzc2V0KCR0aGlzLT5jc3NTdHlsZXNbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyB0ci5yb3cnIC4gJHBSb3ddKQogICAgICAgICAgICAgICAgICAgID8gJHRoaXMtPmFzc2VtYmxlQ1NTKCR0aGlzLT5jc3NTdHlsZXNbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyB0ci5yb3cnIC4gJHBSb3ddKSA6ICcnOwoKICAgICAgICAgICAgICAgICRodG1sIC49ICcgICAgICAgICAgPHRyIHN0eWxlPSInIC4gJHN0eWxlIC4gJyI+JyAuIFBIUF9FT0w7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFdyaXRlIGNlbGxzCiAgICAgICAgICAgICRjb2xOdW0gPSAwOwogICAgICAgICAgICBmb3JlYWNoICgkcFZhbHVlcyBhcyAkY2VsbEFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICRjZWxsID0gKCRjZWxsQWRkcmVzcyA+ICcnKSA\/ICRwU2hlZXQtPmdldENlbGwoJGNlbGxBZGRyZXNzKSA6ICcnOwogICAgICAgICAgICAgICAgJGNvb3JkaW5hdGUgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbE51bSkgLiAoJHBSb3cgKyAxKTsKICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnVzZUlubGluZUNzcykgewogICAgICAgICAgICAgICAgICAgICRjc3NDbGFzcyA9ICcnOwogICAgICAgICAgICAgICAgICAgICRjc3NDbGFzcyA9ICdjb2x1bW4nIC4gJGNvbE51bTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGNzc0NsYXNzID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGNlbGxUeXBlID09ICd0aCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5jc3NTdHlsZXNbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyB0aC5jb2x1bW4nIC4gJGNvbE51bV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y3NzU3R5bGVzWyd0YWJsZS5zaGVldCcgLiAkc2hlZXRJbmRleCAuICcgdGguY29sdW1uJyAuICRjb2xOdW1dOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5jc3NTdHlsZXNbJ3RhYmxlLnNoZWV0JyAuICRzaGVldEluZGV4IC4gJyB0ZC5jb2x1bW4nIC4gJGNvbE51bV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Y3NzU3R5bGVzWyd0YWJsZS5zaGVldCcgLiAkc2hlZXRJbmRleCAuICcgdGQuY29sdW1uJyAuICRjb2xOdW1dOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNvbFNwYW4gPSAxOwogICAgICAgICAgICAgICAgJHJvd1NwYW4gPSAxOwoKICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemUKICAgICAgICAgICAgICAgICRjZWxsRGF0YSA9ICcmbmJzcDsnOwoKICAgICAgICAgICAgICAgIC8vIFBIUEV4Y2VsX0NlbGwKICAgICAgICAgICAgICAgIGlmICgkY2VsbCBpbnN0YW5jZW9mIFBIUEV4Y2VsX0NlbGwpIHsKICAgICAgICAgICAgICAgICAgICAkY2VsbERhdGEgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNfbnVsbCgkY2VsbC0+Z2V0UGFyZW50KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsLT5hdHRhY2goJHBTaGVldCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjZWxsLT5nZXRWYWx1ZSgpIGluc3RhbmNlb2YgUEhQRXhjZWxfUmljaFRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIHJpY2ggdGV4dCBlbGVtZW50cwogICAgICAgICAgICAgICAgICAgICAgICAkZWxlbWVudHMgPSAkY2VsbC0+Z2V0VmFsdWUoKS0+Z2V0UmljaFRleHRFbGVtZW50cygpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkZWxlbWVudHMgYXMgJGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJpY2ggdGV4dCBzdGFydD8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudCBpbnN0YW5jZW9mIFBIUEV4Y2VsX1JpY2hUZXh0X1J1bikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YSAuPSAnPHNwYW4gc3R5bGU9IicgLiAkdGhpcy0+YXNzZW1ibGVDU1MoJHRoaXMtPmNyZWF0ZUNTU1N0eWxlRm9udCgkZWxlbWVudC0+Z2V0Rm9udCgpKSkgLiAnIj4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGVsZW1lbnQtPmdldEZvbnQoKS0+Z2V0U3VwZXJTY3JpcHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbERhdGEgLj0gJzxzdXA+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGVsZW1lbnQtPmdldEZvbnQoKS0+Z2V0U3ViU2NyaXB0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhIC49ICc8c3ViPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgVVRGOCBkYXRhIHRvIFBDREFUQQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxUZXh0ID0gJGVsZW1lbnQtPmdldFRleHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YSAuPSBodG1sc3BlY2lhbGNoYXJzKCRjZWxsVGV4dCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVtZW50IGluc3RhbmNlb2YgUEhQRXhjZWxfUmljaFRleHRfUnVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRlbGVtZW50LT5nZXRGb250KCktPmdldFN1cGVyU2NyaXB0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhIC49ICc8L3N1cD4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZWxlbWVudC0+Z2V0Rm9udCgpLT5nZXRTdWJTY3JpcHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbERhdGEgLj0gJzwvc3ViPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbERhdGEgLj0gJzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5wcmVDYWxjdWxhdGVGb3JtdWxhcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhID0gUEhQRXhjZWxfU3R5bGVfTnVtYmVyRm9ybWF0Ojp0b0Zvcm1hdHRlZFN0cmluZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbC0+Z2V0Q2FsY3VsYXRlZFZhbHVlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldENlbGxYZkJ5SW5kZXgoJGNlbGwtPmdldFhmSW5kZXgoKSktPmdldE51bWJlckZvcm1hdCgpLT5nZXRGb3JtYXRDb2RlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXkoJHRoaXMsICdmb3JtYXRDb2xvcicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhID0gUEhQRXhjZWxfU3R5bGVfTnVtYmVyRm9ybWF0Ojp0b0Zvcm1hdHRlZFN0cmluZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbC0+Z2V0VmFsdWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcFNoZWV0LT5nZXRQYXJlbnQoKS0+Z2V0Q2VsbFhmQnlJbmRleCgkY2VsbC0+Z2V0WGZJbmRleCgpKS0+Z2V0TnVtYmVyRm9ybWF0KCktPmdldEZvcm1hdENvZGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheSgkdGhpcywgJ2Zvcm1hdENvbG9yJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhID0gaHRtbHNwZWNpYWxjaGFycygkY2VsbERhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldENlbGxYZkJ5SW5kZXgoJGNlbGwtPmdldFhmSW5kZXgoKSktPmdldEZvbnQoKS0+Z2V0U3VwZXJTY3JpcHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhID0gJzxzdXA+Jy4kY2VsbERhdGEuJzwvc3VwPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcFNoZWV0LT5nZXRQYXJlbnQoKS0+Z2V0Q2VsbFhmQnlJbmRleCgkY2VsbC0+Z2V0WGZJbmRleCgpKS0+Z2V0Rm9udCgpLT5nZXRTdWJTY3JpcHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhID0gJzxzdWI+Jy4kY2VsbERhdGEuJzwvc3ViPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnRzIHRoZSBjZWxsIGNvbnRlbnQgc28gdGhhdCBzcGFjZXMgb2NjdXJpbmcgYXQgYmVnaW5uaW5nIG9mIGVhY2ggbmV3IGxpbmUgYXJlIHJlcGxhY2VkIGJ5ICZuYnNwOwogICAgICAgICAgICAgICAgICAgIC8vIEV4YW1wbGU6ICIgIEhlbGxvXG4gdG8gdGhlIHdvcmxkIiBpcyBjb252ZXJ0ZWQgdG8gIiZuYnNwOyZuYnNwO0hlbGxvXG4mbmJzcDt0byB0aGUgd29ybGQiCiAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhID0gcHJlZ19yZXBsYWNlKCIvKD9tKSg\/Ol58XFxHKSAvIiwgJyZuYnNwOycsICRjZWxsRGF0YSk7CgogICAgICAgICAgICAgICAgICAgIC8vIGNvbnZlcnQgbmV3bGluZSAiXG4iIHRvICc8YnI+JwogICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YSA9IG5sMmJyKCRjZWxsRGF0YSk7CgogICAgICAgICAgICAgICAgICAgIC8vIEV4dGVuZCBDU1MgY2xhc3M\/CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+dXNlSW5saW5lQ3NzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjc3NDbGFzcyAuPSAnIHN0eWxlJyAuICRjZWxsLT5nZXRYZkluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjc3NDbGFzcyAuPSAnICcgLiAkY2VsbC0+Z2V0RGF0YVR5cGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNlbGxUeXBlID09ICd0aCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+Y3NzU3R5bGVzWyd0aC5zdHlsZScgLiAkY2VsbC0+Z2V0WGZJbmRleCgpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3NzQ2xhc3MgPSBhcnJheV9tZXJnZSgkY3NzQ2xhc3MsICR0aGlzLT5jc3NTdHlsZXNbJ3RoLnN0eWxlJyAuICRjZWxsLT5nZXRYZkluZGV4KCldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+Y3NzU3R5bGVzWyd0ZC5zdHlsZScgLiAkY2VsbC0+Z2V0WGZJbmRleCgpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3NzQ2xhc3MgPSBhcnJheV9tZXJnZSgkY3NzQ2xhc3MsICR0aGlzLT5jc3NTdHlsZXNbJ3RkLnN0eWxlJyAuICRjZWxsLT5nZXRYZkluZGV4KCldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2VuZXJhbCBob3Jpem9udGFsIGFsaWdubWVudDogQWN0dWFsIGhvcml6b250YWwgYWxpZ25tZW50IGRlcGVuZHMgb24gZGF0YVR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgJHNoYXJlZFN0eWxlID0gJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldENlbGxYZkJ5SW5kZXgoJGNlbGwtPmdldFhmSW5kZXgoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2hhcmVkU3R5bGUtPmdldEFsaWdubWVudCgpLT5nZXRIb3Jpem9udGFsKCkgPT0gUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX0dFTkVSQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIGlzc2V0KCR0aGlzLT5jc3NTdHlsZXNbJy4nIC4gJGNlbGwtPmdldERhdGFUeXBlKCldWyd0ZXh0LWFsaWduJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3NzQ2xhc3NbJ3RleHQtYWxpZ24nXSA9ICR0aGlzLT5jc3NTdHlsZXNbJy4nIC4gJGNlbGwtPmdldERhdGFUeXBlKCldWyd0ZXh0LWFsaWduJ107CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gSHlwZXJsaW5rPwogICAgICAgICAgICAgICAgaWYgKCRwU2hlZXQtPmh5cGVybGlua0V4aXN0cygkY29vcmRpbmF0ZSkgJiYgISRwU2hlZXQtPmdldEh5cGVybGluaygkY29vcmRpbmF0ZSktPmlzSW50ZXJuYWwoKSkgewogICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YSA9ICc8YSBocmVmPSInIC4gaHRtbHNwZWNpYWxjaGFycygkcFNoZWV0LT5nZXRIeXBlcmxpbmsoJGNvb3JkaW5hdGUpLT5nZXRVcmwoKSkgLiAnIiB0aXRsZT0iJyAuIGh0bWxzcGVjaWFsY2hhcnMoJHBTaGVldC0+Z2V0SHlwZXJsaW5rKCRjb29yZGluYXRlKS0+Z2V0VG9vbHRpcCgpKSAuICciPicgLiAkY2VsbERhdGEgLiAnPC9hPic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gU2hvdWxkIHRoZSBjZWxsIGJlIHdyaXR0ZW4gb3IgaXMgaXQgc3dhbGxvd2VkIGJ5IGEgcm93c3BhbiBvciBjb2xzcGFuPwogICAgICAgICAgICAgICAgJHdyaXRlQ2VsbCA9ICEoaXNzZXQoJHRoaXMtPmlzU3Bhbm5lZENlbGxbJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldEluZGV4KCRwU2hlZXQpXVskcFJvdyArIDFdWyRjb2xOdW1dKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgJHRoaXMtPmlzU3Bhbm5lZENlbGxbJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldEluZGV4KCRwU2hlZXQpXVskcFJvdyArIDFdWyRjb2xOdW1dKTsKCiAgICAgICAgICAgICAgICAvLyBDb2xzcGFuIGFuZCBSb3dzcGFuCiAgICAgICAgICAgICAgICAkY29sc3BhbiA9IDE7CiAgICAgICAgICAgICAgICAkcm93c3BhbiA9IDE7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPmlzQmFzZUNlbGxbJHBTaGVldC0+Z2V0UGFyZW50KCktPmdldEluZGV4KCRwU2hlZXQpXVskcFJvdyArIDFdWyRjb2xOdW1dKSkgewogICAgICAgICAgICAgICAgICAgICRzcGFucyA9ICR0aGlzLT5pc0Jhc2VDZWxsWyRwU2hlZXQtPmdldFBhcmVudCgpLT5nZXRJbmRleCgkcFNoZWV0KV1bJHBSb3cgKyAxXVskY29sTnVtXTsKICAgICAgICAgICAgICAgICAgICAkcm93U3BhbiA9ICRzcGFuc1sncm93c3BhbiddOwogICAgICAgICAgICAgICAgICAgICRjb2xTcGFuID0gJHNwYW5zWydjb2xzcGFuJ107CgogICAgICAgICAgICAgICAgICAgIC8vICAgIEFsc28gYXBwbHkgc3R5bGUgZnJvbSBsYXN0IGNlbGwgaW4gbWVyZ2UgdG8gZml4IGJvcmRlcnMgLQogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICByZWxpZXMgb24gIWltcG9ydGFudCBmb3Igbm9uLW5vbmUgYm9yZGVyIGRlY2xhcmF0aW9ucyBpbiBjcmVhdGVDU1NTdHlsZUJvcmRlcgogICAgICAgICAgICAgICAgICAgICRlbmRDZWxsQ29vcmQgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbE51bSArICRjb2xTcGFuIC0gMSkgLiAoJHBSb3cgKyAkcm93U3Bhbik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+dXNlSW5saW5lQ3NzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjc3NDbGFzcyAuPSAnIHN0eWxlJyAuICRwU2hlZXQtPmdldENlbGwoJGVuZENlbGxDb29yZCktPmdldFhmSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gV3JpdGUKICAgICAgICAgICAgICAgIGlmICgkd3JpdGVDZWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ29sdW1uIHN0YXJ0CiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgICAgICAgIDwnIC4gJGNlbGxUeXBlOwogICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnVzZUlubGluZUNzcykgewogICAgICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnIGNsYXNzPSInIC4gJGNzc0NsYXNzIC4gJyInOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vKiogTmVjZXNzYXJ5IHJlZHVuZGFudCBjb2RlIGZvciB0aGUgc2FrZSBvZiBQSFBFeGNlbF9Xcml0ZXJfUERGICoqCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIG11c3QgZXhwbGljaXRseSB3cml0ZSB0aGUgd2lkdGggb2YgdGhlIDx0ZD4gZWxlbWVudCBiZWNhdXNlIFRDUERGCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvZXMgbm90IHJlY29nbml6ZSBlLmcuIDxjb2wgc3R5bGU9IndpZHRoOjQycHQiPgogICAgICAgICAgICAgICAgICAgICAgICAkd2lkdGggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAkaSA9ICRjb2xOdW0gLSAxOwogICAgICAgICAgICAgICAgICAgICAgICAkZSA9ICRjb2xOdW0gKyAkY29sU3BhbiAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgkaSsrIDwgJGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+Y29sdW1uV2lkdGhzWyRzaGVldEluZGV4XVskaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpZHRoICs9ICR0aGlzLT5jb2x1bW5XaWR0aHNbJHNoZWV0SW5kZXhdWyRpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkY3NzQ2xhc3NbJ3dpZHRoJ10gPSAkd2lkdGggLiAncHQnOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgbXVzdCBhbHNvIGV4cGxpY2l0bHkgd3JpdGUgdGhlIGhlaWdodCBvZiB0aGUgPHRkPiBlbGVtZW50IGJlY2F1c2UgVENQREYKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9lcyBub3QgcmVjb2duaXplIGUuZy4gPHRyIHN0eWxlPSJoZWlnaHQ6NTBwdCI+CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+Y3NzU3R5bGVzWyd0YWJsZS5zaGVldCcgLiAkc2hlZXRJbmRleCAuICcgdHIucm93JyAuICRwUm93XVsnaGVpZ2h0J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGVpZ2h0ID0gJHRoaXMtPmNzc1N0eWxlc1sndGFibGUuc2hlZXQnIC4gJHNoZWV0SW5kZXggLiAnIHRyLnJvdycgLiAkcFJvd11bJ2hlaWdodCddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNzc0NsYXNzWydoZWlnaHQnXSA9ICRoZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8qKiBlbmQgb2YgcmVkdW5kYW50IGNvZGUgKioKCiAgICAgICAgICAgICAgICAgICAgICAgICRodG1sIC49ICcgc3R5bGU9IicgLiAkdGhpcy0+YXNzZW1ibGVDU1MoJGNzc0NsYXNzKSAuICciJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb2xTcGFuID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnIGNvbHNwYW49IicgLiAkY29sU3BhbiAuICciJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3dTcGFuID4gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnIHJvd3NwYW49IicgLiAkcm93U3BhbiAuICciJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGh0bWwgLj0gJz4nOwoKICAgICAgICAgICAgICAgICAgICAvLyBJbWFnZT8KICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+d3JpdGVJbWFnZUluQ2VsbCgkcFNoZWV0LCAkY29vcmRpbmF0ZSk7CgogICAgICAgICAgICAgICAgICAgIC8vIENoYXJ0PwogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aW5jbHVkZUNoYXJ0cykgewogICAgICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+d3JpdGVDaGFydEluQ2VsbCgkcFNoZWV0LCAkY29vcmRpbmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBDZWxsIGRhdGEKICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAkY2VsbERhdGE7CgogICAgICAgICAgICAgICAgICAgIC8vIENvbHVtbiBlbmQKICAgICAgICAgICAgICAgICAgICAkaHRtbCAuPSAnPC8nLiRjZWxsVHlwZS4nPicgLiBQSFBfRU9MOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIE5leHQgY29sdW1uCiAgICAgICAgICAgICAgICArKyRjb2xOdW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFdyaXRlIHJvdyBlbmQKICAgICAgICAgICAgJGh0bWwgLj0gJyAgICAgICAgICA8L3RyPicgLiBQSFBfRU9MOwoKICAgICAgICAgICAgLy8gUmV0dXJuCiAgICAgICAgICAgIHJldHVybiAkaHRtbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfV3JpdGVyX0V4Y2VwdGlvbigiSW52YWxpZCBwYXJhbWV0ZXJzIHBhc3NlZC4iKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUYWtlcyBhcnJheSB3aGVyZSBvZiBDU1MgcHJvcGVydGllcyAvIHZhbHVlcyBhbmQgY29udmVydHMgdG8gQ1NTIHN0cmluZwogICAgICoKICAgICAqIEBwYXJhbSBhcnJheQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBhc3NlbWJsZUNTUygkcFZhbHVlID0gYXJyYXkoKSkKICAgIHsKICAgICAgICAkcGFpcnMgPSBhcnJheSgpOwogICAgICAgIGZvcmVhY2ggKCRwVmFsdWUgYXMgJHByb3BlcnR5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAkcGFpcnNbXSA9ICRwcm9wZXJ0eSAuICc6JyAuICR2YWx1ZTsKICAgICAgICB9CiAgICAgICAgJHN0cmluZyA9IGltcGxvZGUoJzsgJywgJHBhaXJzKTsKCiAgICAgICAgcmV0dXJuICRzdHJpbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgaW1hZ2VzIHJvb3QKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0SW1hZ2VzUm9vdCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5pbWFnZXNSb290OwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGltYWdlcyByb290CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcFZhbHVlCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dyaXRlcl9IVE1MCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRJbWFnZXNSb290KCRwVmFsdWUgPSAnLicpCiAgICB7CiAgICAgICAgJHRoaXMtPmltYWdlc1Jvb3QgPSAkcFZhbHVlOwogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBlbWJlZCBpbWFnZXMKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEVtYmVkSW1hZ2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmVtYmVkSW1hZ2VzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGVtYmVkIGltYWdlcwogICAgICoKICAgICAqIEBwYXJhbSBib29sZWFuICRwVmFsdWUKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV3JpdGVyX0hUTUwKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldEVtYmVkSW1hZ2VzKCRwVmFsdWUgPSAnLicpCiAgICB7CiAgICAgICAgJHRoaXMtPmVtYmVkSW1hZ2VzID0gJHBWYWx1ZTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdXNlIGlubGluZSBDU1M\/CiAgICAgKgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRVc2VJbmxpbmVDc3MoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+dXNlSW5saW5lQ3NzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHVzZSBpbmxpbmUgQ1NTPwogICAgICoKICAgICAqIEBwYXJhbSBib29sZWFuICRwVmFsdWUKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV3JpdGVyX0hUTUwKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFVzZUlubGluZUNzcygkcFZhbHVlID0gZmFsc2UpCiAgICB7CiAgICAgICAgJHRoaXMtPnVzZUlubGluZUNzcyA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGNvbG9yIHRvIGZvcm1hdHRlZCBzdHJpbmcgYXMgaW5saW5lIHN0eWxlCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcFZhbHVlIFBsYWluIGZvcm1hdHRlZCB2YWx1ZSB3aXRob3V0IGNvbG9yCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwRm9ybWF0IEZvcm1hdCBjb2RlCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZm9ybWF0Q29sb3IoJHBWYWx1ZSwgJHBGb3JtYXQpCiAgICB7CiAgICAgICAgLy8gQ29sb3IgaW5mb3JtYXRpb24sIGUuZy4gW1JlZF0gaXMgYWx3YXlzIGF0IHRoZSBiZWdpbm5pbmcKICAgICAgICAkY29sb3IgPSBudWxsOyAvLyBpbml0aWFsaXplCiAgICAgICAgJG1hdGNoZXMgPSBhcnJheSgpOwoKICAgICAgICAkY29sb3JfcmVnZXggPSAnL15cXFtbYS16QS1aXStcXF0vJzsKICAgICAgICBpZiAocHJlZ19tYXRjaCgkY29sb3JfcmVnZXgsICRwRm9ybWF0LCAkbWF0Y2hlcykpIHsKICAgICAgICAgICAgJGNvbG9yID0gc3RyX3JlcGxhY2UoJ1snLCAnJywgJG1hdGNoZXNbMF0pOwogICAgICAgICAgICAkY29sb3IgPSBzdHJfcmVwbGFjZSgnXScsICcnLCAkY29sb3IpOwogICAgICAgICAgICAkY29sb3IgPSBzdHJ0b2xvd2VyKCRjb2xvcik7CiAgICAgICAgfQoKICAgICAgICAvLyBjb252ZXJ0IHRvIFBDREFUQQogICAgICAgICR2YWx1ZSA9IGh0bWxzcGVjaWFsY2hhcnMoJHBWYWx1ZSk7CgogICAgICAgIC8vIGNvbG9yIHNwYW4gdGFnCiAgICAgICAgaWYgKCRjb2xvciAhPT0gbnVsbCkgewogICAgICAgICAgICAkdmFsdWUgPSAnPHNwYW4gc3R5bGU9ImNvbG9yOicgLiAkY29sb3IgLiAnIj4nIC4gJHZhbHVlIC4gJzwvc3Bhbj4nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR2YWx1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGN1bGF0ZSBpbmZvcm1hdGlvbiBhYm91dCBIVE1MIGNvbHNwYW4gYW5kIHJvd3NwYW4gd2hpY2ggaXMgbm90IGFsd2F5cyB0aGUgc2FtZSBhcyBFeGNlbCdzCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gY2FsY3VsYXRlU3BhbnMoKQogICAgewogICAgICAgIC8vIElkZW50aWZ5IGFsbCBjZWxscyB0aGF0IHNob3VsZCBiZSBvbWl0dGVkIGluIEhUTUwgZHVlIHRvIGNlbGwgbWVyZ2UuCiAgICAgICAgLy8gSW4gSFRNTCBvbmx5IHRoZSB1cHBlci1sZWZ0IGNlbGwgc2hvdWxkIGJlIHdyaXR0ZW4gYW5kIGl0IHNob3VsZCBoYXZlCiAgICAgICAgLy8gICBhcHByb3ByaWF0ZSByb3dzcGFuIC8gY29sc3BhbiBhdHRyaWJ1dGUKICAgICAgICAkc2hlZXRJbmRleGVzID0gJHRoaXMtPnNoZWV0SW5kZXggIT09IG51bGwgPwogICAgICAgICAgICBhcnJheSgkdGhpcy0+c2hlZXRJbmRleCkgOiByYW5nZSgwLCAkdGhpcy0+cGhwRXhjZWwtPmdldFNoZWV0Q291bnQoKSAtIDEpOwoKICAgICAgICBmb3JlYWNoICgkc2hlZXRJbmRleGVzIGFzICRzaGVldEluZGV4KSB7CiAgICAgICAgICAgICRzaGVldCA9ICR0aGlzLT5waHBFeGNlbC0+Z2V0U2hlZXQoJHNoZWV0SW5kZXgpOwoKICAgICAgICAgICAgJGNhbmRpZGF0ZVNwYW5uZWRSb3cgID0gYXJyYXkoKTsKCiAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCBhbGwgRXhjZWwgbWVyZ2VkIGNlbGxzCiAgICAgICAgICAgIGZvcmVhY2ggKCRzaGVldC0+Z2V0TWVyZ2VDZWxscygpIGFzICRjZWxscykgewogICAgICAgICAgICAgICAgbGlzdCgkY2VsbHMsKSA9IFBIUEV4Y2VsX0NlbGw6OnNwbGl0UmFuZ2UoJGNlbGxzKTsKICAgICAgICAgICAgICAgICRmaXJzdCA9ICRjZWxsc1swXTsKICAgICAgICAgICAgICAgICRsYXN0ICA9ICRjZWxsc1sxXTsKCiAgICAgICAgICAgICAgICBsaXN0KCRmYywgJGZyKSA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRmaXJzdCk7CiAgICAgICAgICAgICAgICAkZmMgPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGZjKSAtIDE7CgogICAgICAgICAgICAgICAgbGlzdCgkbGMsICRscikgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkbGFzdCk7CiAgICAgICAgICAgICAgICAkbGMgPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGxjKSAtIDE7CgogICAgICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIHRoZSBpbmRpdmlkdWFsIGNlbGxzIGluIHRoZSBpbmRpdmlkdWFsIG1lcmdlCiAgICAgICAgICAgICAgICAkciA9ICRmciAtIDE7CiAgICAgICAgICAgICAgICB3aGlsZSAoJHIrKyA8ICRscikgewogICAgICAgICAgICAgICAgICAgIC8vIGFsc28sIGZsYWcgdGhpcyByb3cgYXMgYSBIVE1MIHJvdyB0aGF0IGlzIGNhbmRpZGF0ZSB0byBiZSBvbWl0dGVkCiAgICAgICAgICAgICAgICAgICAgJGNhbmRpZGF0ZVNwYW5uZWRSb3dbJHJdID0gJHI7CgogICAgICAgICAgICAgICAgICAgICRjID0gJGZjIC0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoJGMrKyA8ICRsYykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgkYyA9PSAkZmMgJiYgJHIgPT0gJGZyKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm90IHRoZSB1cHBlci1sZWZ0IGNlbGwgKHNob3VsZCBub3QgYmUgd3JpdHRlbiBpbiBIVE1MKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmlzU3Bhbm5lZENlbGxbJHNoZWV0SW5kZXhdWyRyXVskY10gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmFzZUNlbGwnID0+IGFycmF5KCRmciwgJGZjKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1cHBlci1sZWZ0IGlzIHRoZSBiYXNlIGNlbGwgdGhhdCBzaG91bGQgaG9sZCB0aGUgY29sc3Bhbi9yb3dzcGFuIGF0dHJpYnV0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmlzQmFzZUNlbGxbJHNoZWV0SW5kZXhdWyRyXVskY10gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAneGxyb3dzcGFuJyA9PiAkbHIgLSAkZnIgKyAxLCAvLyBFeGNlbCByb3dzcGFuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jvd3NwYW4nICAgPT4gJGxyIC0gJGZyICsgMSwgLy8gSFRNTCByb3dzcGFuLCB2YWx1ZSBtYXkgY2hhbmdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3hsY29sc3BhbicgPT4gJGxjIC0gJGZjICsgMSwgLy8gRXhjZWwgY29sc3BhbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb2xzcGFuJyAgID0+ICRsYyAtICRmYyArIDEsIC8vIEhUTUwgY29sc3BhbiwgdmFsdWUgbWF5IGNoYW5nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWRlbnRpZnkgd2hpY2ggcm93cyBzaG91bGQgYmUgb21pdHRlZCBpbiBIVE1MLiBUaGVzZSBhcmUgdGhlIHJvd3Mgd2hlcmUgYWxsIHRoZSBjZWxscwogICAgICAgICAgICAvLyAgIHBhcnRpY2lwYXRlIGluIGEgbWVyZ2UgYW5kIHRoZSB3aGVyZSBiYXNlIGNlbGxzIGFyZSBzb21ld2hlcmUgYWJvdmUuCiAgICAgICAgICAgICRjb3VudENvbHVtbnMgPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJHNoZWV0LT5nZXRIaWdoZXN0Q29sdW1uKCkpOwogICAgICAgICAgICBmb3JlYWNoICgkY2FuZGlkYXRlU3Bhbm5lZFJvdyBhcyAkcm93SW5kZXgpIHsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+aXNTcGFubmVkQ2VsbFskc2hlZXRJbmRleF1bJHJvd0luZGV4XSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPmlzU3Bhbm5lZENlbGxbJHNoZWV0SW5kZXhdWyRyb3dJbmRleF0pID09ICRjb3VudENvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmlzU3Bhbm5lZFJvd1skc2hlZXRJbmRleF1bJHJvd0luZGV4XSA9ICRyb3dJbmRleDsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGb3IgZWFjaCBvZiB0aGUgb21pdHRlZCByb3dzIHdlIGZvdW5kIGFib3ZlLCB0aGUgYWZmZWN0ZWQgcm93c3BhbnMgc2hvdWxkIGJlIHN1YnRyYWN0ZWQgYnkgMQogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPmlzU3Bhbm5lZFJvd1skc2hlZXRJbmRleF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+aXNTcGFubmVkUm93WyRzaGVldEluZGV4XSBhcyAkcm93SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAkYWRqdXN0ZWRCYXNlQ2VsbHMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgICRjID0gLTE7CiAgICAgICAgICAgICAgICAgICAgJGUgPSAkY291bnRDb2x1bW5zIC0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoJGMrKyA8ICRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRiYXNlQ2VsbCA9ICR0aGlzLT5pc1NwYW5uZWRDZWxsWyRzaGVldEluZGV4XVskcm93SW5kZXhdWyRjXVsnYmFzZUNlbGwnXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5fYXJyYXkoJGJhc2VDZWxsLCAkYWRqdXN0ZWRCYXNlQ2VsbHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdWJ0cmFjdCByb3dzcGFuIGJ5IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tJHRoaXMtPmlzQmFzZUNlbGxbJHNoZWV0SW5kZXhdWyAkYmFzZUNlbGxbMF0gXVsgJGJhc2VDZWxsWzFdIF1bJ3Jvd3NwYW4nXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhZGp1c3RlZEJhc2VDZWxsc1tdID0gJGJhc2VDZWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUT0RPOiBTYW1lIGZvciBjb2x1bW5zCiAgICAgICAgfQoKICAgICAgICAvLyBXZSBoYXZlIGNhbGN1bGF0ZWQgdGhlIHNwYW5zCiAgICAgICAgJHRoaXMtPnNwYW5zQXJlQ2FsY3VsYXRlZCA9IHRydWU7CiAgICB9CgogICAgcHJpdmF0ZSBmdW5jdGlvbiBzZXRNYXJnaW5zKFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0KQogICAgewogICAgICAgICRodG1sUGFnZSA9ICdAcGFnZSB7ICc7CiAgICAgICAgJGh0bWxCb2R5ID0gJ2JvZHkgeyAnOwoKICAgICAgICAkbGVmdCA9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkZvcm1hdE51bWJlcigkcFNoZWV0LT5nZXRQYWdlTWFyZ2lucygpLT5nZXRMZWZ0KCkpIC4gJ2luOyAnOwogICAgICAgICRodG1sUGFnZSAuPSAnbWFyZ2luLWxlZnQ6ICcgLiAkbGVmdDsKICAgICAgICAkaHRtbEJvZHkgLj0gJ21hcmdpbi1sZWZ0OiAnIC4gJGxlZnQ7CiAgICAgICAgJHJpZ2h0ID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Rm9ybWF0TnVtYmVyKCRwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPmdldFJpZ2h0KCkpIC4gJ2luOyAnOwogICAgICAgICRodG1sUGFnZSAuPSAnbWFyZ2luLXJpZ2h0OiAnIC4gJHJpZ2h0OwogICAgICAgICRodG1sQm9keSAuPSAnbWFyZ2luLXJpZ2h0OiAnIC4gJHJpZ2h0OwogICAgICAgICR0b3AgPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpGb3JtYXROdW1iZXIoJHBTaGVldC0+Z2V0UGFnZU1hcmdpbnMoKS0+Z2V0VG9wKCkpIC4gJ2luOyAnOwogICAgICAgICRodG1sUGFnZSAuPSAnbWFyZ2luLXRvcDogJyAuICR0b3A7CiAgICAgICAgJGh0bWxCb2R5IC49ICdtYXJnaW4tdG9wOiAnIC4gJHRvcDsKICAgICAgICAkYm90dG9tID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Rm9ybWF0TnVtYmVyKCRwU2hlZXQtPmdldFBhZ2VNYXJnaW5zKCktPmdldEJvdHRvbSgpKSAuICdpbjsgJzsKICAgICAgICAkaHRtbFBhZ2UgLj0gJ21hcmdpbi1ib3R0b206ICcgLiAkYm90dG9tOwogICAgICAgICRodG1sQm9keSAuPSAnbWFyZ2luLWJvdHRvbTogJyAuICRib3R0b207CgogICAgICAgICRodG1sUGFnZSAuPSAifVxuIjsKICAgICAgICAkaHRtbEJvZHkgLj0gIn1cbiI7CgogICAgICAgIHJldHVybiAiPHN0eWxlPlxuIiAuICRodG1sUGFnZSAuICRodG1sQm9keSAuICI8L3N0eWxlPlxuIjsKICAgIH0KfQo=",
    "size": "59453"
}