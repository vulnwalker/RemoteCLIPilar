{
    "namaFile": "lib\/jpgraph\/jpgraph.php",
    "lastUpdate": "2013-12-16+17:18:07.00",
    "contentFile": "PD9waHAKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBGaWxlOiAgICAgICAgSlBHUkFQSC5QSFAKLy8gRGVzY3JpcHRpb246IFBIUCBHcmFwaCBQbG90dGluZyBsaWJyYXJ5LiBCYXNlIG1vZHVsZS4KLy8gQ3JlYXRlZDogICAgIDIwMDEtMDEtMDgKLy8gVmVyOiAgICAgICAgICRJZDoganBncmFwaC5waHAgMTkyNCAyMDEwLTAxLTExIDE0OjAzOjI2WiBsanAgJAovLwovLyBDb3B5cmlnaHQgKGMpIEFzaWFsIENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKcmVxdWlyZV9vbmNlKCdqcGctY29uZmlnLmluYy5waHAnKTsKcmVxdWlyZV9vbmNlKCdqcGdyYXBoX2dyYWRpZW50LnBocCcpOwpyZXF1aXJlX29uY2UoJ2pwZ3JhcGhfZXJyaGFuZGxlci5pbmMucGhwJyk7CnJlcXVpcmVfb25jZSgnanBncmFwaF90dGYuaW5jLnBocCcpOwpyZXF1aXJlX29uY2UoJ2pwZ3JhcGhfcmdiLmluYy5waHAnKTsKcmVxdWlyZV9vbmNlKCdqcGdyYXBoX3RleHQuaW5jLnBocCcpOwpyZXF1aXJlX29uY2UoJ2pwZ3JhcGhfbGVnZW5kLmluYy5waHAnKTsKcmVxdWlyZV9vbmNlKCdqcGdyYXBoX3RoZW1lLmluYy5waHAnKTsKcmVxdWlyZV9vbmNlKCdnZF9pbWFnZS5pbmMucGhwJyk7CgovLyBWZXJzaW9uIGluZm8KZGVmaW5lKCdKUEdfVkVSU0lPTicsJzMuNS4wYjEnKTsKCi8vIE1pbmltdW0gcmVxdWlyZWQgUEhQIHZlcnNpb24KZGVmaW5lKCdNSU5fUEhQVkVSU0lPTicsJzUuMS4wJyk7CgovLyBTcGVjaWFsIGZpbGUgbmFtZSB0byBpbmRpY2F0ZSB0aGF0IHdlIG9ubHkgd2FudCB0byBjYWxjCi8vIHRoZSBpbWFnZSBtYXAgaW4gdGhlIGNhbGwgdG8gR3JhcGg6OlN0cm9rZSgpIHVzZWQKLy8gaW50ZXJuYWxseSBmcm9tIHRoZSBHZXRIVE1MQ1NJTSgpIG1ldGhvZC4KZGVmaW5lKCdfQ1NJTV9TUEVDSUFMRklMRScsJ19jc2ltX3NwZWNpYWxfJyk7CgovLyBIVFRQIEdFVCBhcmd1bWVudCB0aGF0IGlzIHVzZWQgd2l0aCBpbWFnZSBtYXAKLy8gdG8gaW5kaWNhdGUgdG8gdGhlIHNjcmlwdCB0byBqdXN0IGdlbmVyYXRlIHRoZSBpbWFnZQovLyBhbmQgbm90IHRoZSBmdWxsIENTSU0gSFRNTCBwYWdlLgpkZWZpbmUoJ19DU0lNX0RJU1BMQVknLCdfanBnX2NzaW1kJyk7CgovLyBTcGVjaWFsIGZpbGVuYW1lIGZvciBHcmFwaDo6U3Ryb2tlKCkuIElmIHRoaXMgZmlsZW5hbWUgaXMgZ2l2ZW4KLy8gdGhlbiB0aGUgaW1hZ2Ugd2lsbCBOT1QgYmUgc3RyZWFtZWQgdG8gYnJvd3NlciBvZiBmaWxlLiBJbnN0ZWFkIHRoZQovLyBTdHJva2UgY2FsbCB3aWxsIHJldHVybiB0aGUgaGFuZGxlciBmb3IgdGhlIGNyZWF0ZWQgR0QgaW1hZ2UuCmRlZmluZSgnX0lNR19IQU5ETEVSJywnX19oYW5kbGUnKTsKCi8vIFNwZWNpYWwgZmlsZW5hbWUgZm9yIEdyYXBoOjpTdHJva2UoKS4gSWYgdGhpcyBmaWxlbmFtZSBpcyBnaXZlbgovLyB0aGUgaW1hZ2Ugd2lsbCBiZSBzdHJva2VkIHRvIGEgZmlsZSB3aXRoIGEgbmFtZSBiYXNlZCBvbiB0aGUgc2NyaXB0IG5hbWUuCmRlZmluZSgnX0lNR19BVVRPJywnYXV0bycpOwoKLy8gVGljayBkZW5zaXR5CmRlZmluZSgiVElDS0RfREVOU0UiLDEpOwpkZWZpbmUoIlRJQ0tEX05PUk1BTCIsMik7CmRlZmluZSgiVElDS0RfU1BBUlNFIiwzKTsKZGVmaW5lKCJUSUNLRF9WRVJZU1BBUlNFIiw0KTsKCi8vIFNpZGUgZm9yIHRpY2tzIGFuZCBsYWJlbHMuCmRlZmluZSgiU0lERV9MRUZUIiwtMSk7CmRlZmluZSgiU0lERV9SSUdIVCIsMSk7CmRlZmluZSgiU0lERV9ET1dOIiwtMSk7CmRlZmluZSgiU0lERV9CT1RUT00iLC0xKTsKZGVmaW5lKCJTSURFX1VQIiwxKTsKZGVmaW5lKCJTSURFX1RPUCIsMSk7CgovLyBMZWdlbmQgdHlwZSBzdGFja2VkIHZlcnRpY2FsIG9yIGhvcml6b250YWwKZGVmaW5lKCJMRUdFTkRfVkVSVCIsMCk7CmRlZmluZSgiTEVHRU5EX0hPUiIsMSk7CgovLyBNYXJrIHR5cGVzIGZvciBwbG90IG1hcmtzCmRlZmluZSgiTUFSS19TUVVBUkUiLDEpOwpkZWZpbmUoIk1BUktfVVRSSUFOR0xFIiwyKTsKZGVmaW5lKCJNQVJLX0RUUklBTkdMRSIsMyk7CmRlZmluZSgiTUFSS19ESUFNT05EIiw0KTsKZGVmaW5lKCJNQVJLX0NJUkNMRSIsNSk7CmRlZmluZSgiTUFSS19GSUxMRURDSVJDTEUiLDYpOwpkZWZpbmUoIk1BUktfQ1JPU1MiLDcpOwpkZWZpbmUoIk1BUktfU1RBUiIsOCk7CmRlZmluZSgiTUFSS19YIiw5KTsKZGVmaW5lKCJNQVJLX0xFRlRUUklBTkdMRSIsMTApOwpkZWZpbmUoIk1BUktfUklHSFRUUklBTkdMRSIsMTEpOwpkZWZpbmUoIk1BUktfRkxBU0giLDEyKTsKZGVmaW5lKCJNQVJLX0lNRyIsMTMpOwpkZWZpbmUoIk1BUktfRkxBRzEiLDE0KTsKZGVmaW5lKCJNQVJLX0ZMQUcyIiwxNSk7CmRlZmluZSgiTUFSS19GTEFHMyIsMTYpOwpkZWZpbmUoIk1BUktfRkxBRzQiLDE3KTsKCi8vIEJ1aWx0aW4gaW1hZ2VzCmRlZmluZSgiTUFSS19JTUdfUFVTSFBJTiIsNTApOwpkZWZpbmUoIk1BUktfSU1HX1NQVVNIUElOIiw1MCk7CmRlZmluZSgiTUFSS19JTUdfTFBVU0hQSU4iLDUxKTsKZGVmaW5lKCJNQVJLX0lNR19ESUFNT05EIiw1Mik7CmRlZmluZSgiTUFSS19JTUdfU1FVQVJFIiw1Myk7CmRlZmluZSgiTUFSS19JTUdfU1RBUiIsNTQpOwpkZWZpbmUoIk1BUktfSU1HX0JBTEwiLDU1KTsKZGVmaW5lKCJNQVJLX0lNR19TQkFMTCIsNTUpOwpkZWZpbmUoIk1BUktfSU1HX01CQUxMIiw1Nik7CmRlZmluZSgiTUFSS19JTUdfTEJBTEwiLDU3KTsKZGVmaW5lKCJNQVJLX0lNR19CRVZFTCIsNTgpOwoKLy8gSW5saW5lIGRlZmluZXMKZGVmaW5lKCJJTkxJTkVfWUVTIiwxKTsKZGVmaW5lKCJJTkxJTkVfTk8iLDApOwoKLy8gRm9ybWF0IGZvciBiYWNrZ3JvdW5kIGltYWdlcwpkZWZpbmUoIkJHSU1HX0ZJTExQTE9UIiwxKTsKZGVmaW5lKCJCR0lNR19GSUxMRlJBTUUiLDIpOwpkZWZpbmUoIkJHSU1HX0NPUFkiLDMpOwpkZWZpbmUoIkJHSU1HX0NFTlRFUiIsNCk7CmRlZmluZSgiQkdJTUdfRlJFRSIsNSk7CgovLyBEZXB0aCBvZiBvYmplY3RzCmRlZmluZSgiREVQVEhfQkFDSyIsMCk7CmRlZmluZSgiREVQVEhfRlJPTlQiLDEpOwoKLy8gRGlyZWN0aW9uCmRlZmluZSgiVkVSVElDQUwiLDEpOwpkZWZpbmUoIkhPUklaT05UQUwiLDApOwoKLy8gQXhpcyBzdHlsZXMgZm9yIHNjaWVudGlmaWMgc3R5bGUgYXhpcwpkZWZpbmUoJ0FYU1RZTEVfU0lNUExFJywxKTsKZGVmaW5lKCdBWFNUWUxFX0JPWElOJywyKTsKZGVmaW5lKCdBWFNUWUxFX0JPWE9VVCcsMyk7CmRlZmluZSgnQVhTVFlMRV9ZQk9YSU4nLDQpOwpkZWZpbmUoJ0FYU1RZTEVfWUJPWE9VVCcsNSk7CgovLyBTdHlsZSBmb3IgdGl0bGUgYmFja2dyb3VuZHMKZGVmaW5lKCdUSVRMRUJLR19TVFlMRTEnLDEpOwpkZWZpbmUoJ1RJVExFQktHX1NUWUxFMicsMik7CmRlZmluZSgnVElUTEVCS0dfU1RZTEUzJywzKTsKZGVmaW5lKCdUSVRMRUJLR19GUkFNRV9OT05FJywwKTsKZGVmaW5lKCdUSVRMRUJLR19GUkFNRV9GVUxMJywxKTsKZGVmaW5lKCdUSVRMRUJLR19GUkFNRV9CT1RUT00nLDIpOwpkZWZpbmUoJ1RJVExFQktHX0ZSQU1FX0JFVkVMJywzKTsKZGVmaW5lKCdUSVRMRUJLR19GSUxMU1RZTEVfSFNUUklQRUQnLDEpOwpkZWZpbmUoJ1RJVExFQktHX0ZJTExTVFlMRV9WU1RSSVBFRCcsMik7CmRlZmluZSgnVElUTEVCS0dfRklMTFNUWUxFX1NPTElEJywzKTsKCi8vIFN0eWxlcyBmb3IgYXhpcyBsYWJlbHMgYmFja2dyb3VuZApkZWZpbmUoJ0xBQkVMQktHX05PTkUnLDApOwpkZWZpbmUoJ0xBQkVMQktHX1hBWElTJywxKTsKZGVmaW5lKCdMQUJFTEJLR19ZQVhJUycsMik7CmRlZmluZSgnTEFCRUxCS0dfWEFYSVNGVUxMJywzKTsKZGVmaW5lKCdMQUJFTEJLR19ZQVhJU0ZVTEwnLDQpOwpkZWZpbmUoJ0xBQkVMQktHX1hZRlVMTCcsNSk7CmRlZmluZSgnTEFCRUxCS0dfWFknLDYpOwoKCi8vIFN0eWxlIGZvciBiYWNrZ3JvdW5kIGdyYWRpZW50IGZpbGxzCmRlZmluZSgnQkdSQURfRlJBTUUnLDEpOwpkZWZpbmUoJ0JHUkFEX01BUkdJTicsMik7CmRlZmluZSgnQkdSQURfUExPVCcsMyk7CgovLyBXaWR0aCBvZiB0YWIgdGl0bGVzCmRlZmluZSgnVEFCVElUTEVfV0lEVEhGSVQnLDApOwpkZWZpbmUoJ1RBQlRJVExFX1dJRFRIRlVMTCcsLTEpOwoKLy8gRGVmaW5lcyBmb3IgM0Qgc2tldyBkaXJlY3Rpb25zCmRlZmluZSgnU0tFVzNEX1VQJywwKTsKZGVmaW5lKCdTS0VXM0RfRE9XTicsMSk7CmRlZmluZSgnU0tFVzNEX0xFRlQnLDIpOwpkZWZpbmUoJ1NLRVczRF9SSUdIVCcsMyk7CgovLyBGb3IgaW50ZXJuYWwgdXNlIG9ubHkKZGVmaW5lKCJfSlBHX0RFQlVHIixmYWxzZSk7CmRlZmluZSgiX0ZPUkNFX0lNR1RPRklMRSIsZmFsc2UpOwpkZWZpbmUoIl9GT1JDRV9JTUdESVIiLCcvdG1wL2pwZ2ltZy8nKTsKCgovLwovLyBBdXRvbWF0aWMgc2V0dGluZ3Mgb2YgcGF0aCBmb3IgY2FjaGUgYW5kIGZvbnQgZGlyZWN0b3J5Ci8vIGlmIHRoZXkgaGF2ZSBub3QgYmVlbiBwcmV2aW91c2x5IHNwZWNpZmllZAovLwppZihVU0VfQ0FDSEUpIHsKICAgIGlmICghZGVmaW5lZCgnQ0FDSEVfRElSJykpIHsKICAgICAgICBpZiAoIHN0cnN0ciggUEhQX09TLCAnV0lOJykgKSB7CiAgICAgICAgICAgIGlmKCBlbXB0eSgkX1NFUlZFUlsnVEVNUCddKSApIHsKICAgICAgICAgICAgICAgICR0ID0gbmV3IEVyck1zZ1RleHQoKTsKICAgICAgICAgICAgICAgICRtc2cgPSAkdC0+R2V0KDExLCRmaWxlLCRsaW5lbm8pOwogICAgICAgICAgICAgICAgZGllKCRtc2cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZGVmaW5lKCdDQUNIRV9ESVInLCAkX1NFUlZFUlsnVEVNUCddIC4gJy8nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlZmluZSgnQ0FDSEVfRElSJywnL3RtcC9qcGdyYXBoX2NhY2hlLycpOwogICAgICAgIH0KICAgIH0KfQplbHNlaWYoICFkZWZpbmVkKCdDQUNIRV9ESVInKSApIHsKICAgIGRlZmluZSgnQ0FDSEVfRElSJywgJycpOwp9CgovLwovLyBTZXR1cCBwYXRoIGZvciB3ZXN0ZXJuL2xhdGluIFRURiBmb250cwovLwppZiAoIWRlZmluZWQoJ1RURl9ESVInKSkgewogICAgaWYgKHN0cnN0ciggUEhQX09TLCAnV0lOJykgKSB7CiAgICAgICAgJHNyb290ID0gZ2V0ZW52KCdTeXN0ZW1Sb290Jyk7CiAgICAgICAgaWYoIGVtcHR5KCRzcm9vdCkgKSB7CiAgICAgICAgICAgICR0ID0gbmV3IEVyck1zZ1RleHQoKTsKICAgICAgICAgICAgJG1zZyA9ICR0LT5HZXQoMTIsJGZpbGUsJGxpbmVubyk7CiAgICAgICAgICAgIGRpZSgkbXNnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGRlZmluZSgnVFRGX0RJUicsICRzcm9vdC4nL2ZvbnRzLycpOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgZGVmaW5lKCdUVEZfRElSJywnL3Vzci9zaGFyZS9mb250cy90cnVldHlwZS8nKTsKICAgIH0KfQoKLy8KLy8gU2V0dXAgcGF0aCBmb3IgTXVsdGlCeXRlIFRURiBmb250cyAoamFwYW5lc2UsIGNoaW5lc2UgZXRjLikKLy8KaWYgKCFkZWZpbmVkKCdNQlRURl9ESVInKSkgewogICAgaWYgKHN0cnN0ciggUEhQX09TLCAnV0lOJykgKSB7CiAgICAgICAgJHNyb290ID0gZ2V0ZW52KCdTeXN0ZW1Sb290Jyk7CiAgICAgICAgaWYoIGVtcHR5KCRzcm9vdCkgKSB7CiAgICAgICAgICAgICR0ID0gbmV3IEVyck1zZ1RleHQoKTsKICAgICAgICAgICAgJG1zZyA9ICR0LT5HZXQoMTIsJGZpbGUsJGxpbmVubyk7CiAgICAgICAgICAgIGRpZSgkbXNnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGRlZmluZSgnTUJUVEZfRElSJywgJHNyb290LicvZm9udHMvJyk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBkZWZpbmUoJ01CVFRGX0RJUicsJy91c3Ivc2hhcmUvZm9udHMvdHJ1ZXR5cGUvJyk7CiAgICB9Cn0KCi8vCi8vIENoZWNrIG1pbmltdW0gUEhQIHZlcnNpb24KLy8KZnVuY3Rpb24gQ2hlY2tQSFBWZXJzaW9uKCRhTWluVmVyc2lvbikgewogICAgbGlzdCgkbWFqb3JDLCAkbWlub3JDLCAkZWRpdEMpID0gcHJlZ19zcGxpdCgnL1tcLy4tXS8nLCBQSFBfVkVSU0lPTik7CiAgICBsaXN0KCRtYWpvclIsICRtaW5vclIsICRlZGl0UikgPSBwcmVnX3NwbGl0KCcvW1wvLi1dLycsICRhTWluVmVyc2lvbik7CgogICAgaWYgKCRtYWpvckMgIT0gJG1ham9yUikgcmV0dXJuIGZhbHNlOwogICAgaWYgKCRtYWpvckMgPCAkbWFqb3JSKSByZXR1cm4gZmFsc2U7CiAgICAvLyBzYW1lIG1ham9yIC0gY2hlY2sgbWlub3IKICAgIGlmICgkbWlub3JDID4gJG1pbm9yUikgcmV0dXJuIHRydWU7CiAgICBpZiAoJG1pbm9yQyA8ICRtaW5vclIpIHJldHVybiBmYWxzZTsKICAgIC8vIGFuZCBzYW1lIG1pbm9yCiAgICBpZiAoJGVkaXRDICA+PSAkZWRpdFIpICByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwp9CgovLwovLyBNYWtlIHN1cmUgUEhQIHZlcnNpb24gaXMgaGlnaCBlbm91Z2gKLy8KaWYoICFDaGVja1BIUFZlcnNpb24oTUlOX1BIUFZFUlNJT04pICkgewogICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMTMsUEhQX1ZFUlNJT04sTUlOX1BIUFZFUlNJT04pOwogICAgZGllKCk7Cn0KCi8vCi8vIE1ha2UgR0Qgc2FuaXR5IGNoZWNrCi8vCmlmKCAhZnVuY3Rpb25fZXhpc3RzKCJpbWFnZXR5cGVzIikgfHwgIWZ1bmN0aW9uX2V4aXN0cygnaW1hZ2VjcmVhdGVmcm9tc3RyaW5nJykgKSB7CiAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAwMSk7CiAgICAvLygiVGhpcyBQSFAgaW5zdGFsbGF0aW9uIGlzIG5vdCBjb25maWd1cmVkIHdpdGggdGhlIEdEIGxpYnJhcnkuIFBsZWFzZSByZWNvbXBpbGUgUEhQIHdpdGggR0Qgc3VwcG9ydCB0byBydW4gSnBHcmFwaC4gKE5laXRoZXIgZnVuY3Rpb24gaW1hZ2V0eXBlcygpIG5vciBpbWFnZWNyZWF0ZWZyb21zdHJpbmcoKSBkb2VzIGV4aXN0KSIpOwp9CgovLwovLyBTZXR1cCBQSFAgZXJyb3IgaGFuZGxlcgovLwpmdW5jdGlvbiBfcGhwRXJyb3JIYW5kbGVyKCRlcnJubywkZXJybXNnLCRmaWxlbmFtZSwgJGxpbmVudW0sICR2YXJzKSB7CiAgICAvLyBSZXNwZWN0IGN1cnJlbnQgZXJyb3IgbGV2ZWwKICAgIGlmKCAkZXJybm8gJiBlcnJvcl9yZXBvcnRpbmcoKSApIHsKICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAwMyxiYXNlbmFtZSgkZmlsZW5hbWUpLCRsaW5lbnVtLCRlcnJtc2cpOwogICAgfQp9CgppZiggSU5TVEFMTF9QSFBfRVJSX0hBTkRMRVIgKSB7CiAgICBzZXRfZXJyb3JfaGFuZGxlcigiX3BocEVycm9ySGFuZGxlciIpOwp9CgovLwovLyBDaGVjayBpZiB0aGVyZSB3ZXJlIGFueSB3YXJuaW5ncywgcGVyaGFwcyBzb21lIHdyb25nIGluY2x1ZGVzIGJ5IHRoZSB1c2VyLiBJbiB0aGlzCi8vIGNhc2Ugd2UgcmFpc2UgaXQgaW1tZWRpYXRlbHkgc2luY2Ugb3RoZXJ3aXNlIHRoZSBpbWFnZSB3aWxsIG5vdCBzaG93IGFuZCBtYWtlcwovLyBkZWJ1Z2dpbmcgZGlmZmljdWx0LiBUaGlzIGlzIGNvbnRyb2xsZWQgYnkgdGhlIHVzZXIgc2V0dGluZyBDQVRDSF9QSFBFUlJNU0cKLy8KaWYoIGlzc2V0KCRHTE9CQUxTWydwaHBfZXJyb3Jtc2cnXSkgJiYgQ0FUQ0hfUEhQRVJSTVNHICYmICFwcmVnX21hdGNoKCcvfERlcHJlY2F0ZWR8L2knLCAkR0xPQkFMU1sncGhwX2Vycm9ybXNnJ10pICkgewogICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMDQsJEdMT0JBTFNbJ3BocF9lcnJvcm1zZyddKTsKfQoKLy8gVXNlZnVsIG1hdGhlbWF0aWNhbCBmdW5jdGlvbgpmdW5jdGlvbiBzaWduKCRhKSB7cmV0dXJuICRhID49IDAgPyAxIDogLTE7fQoKLy8KLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBnZW5lcmF0ZSBhbiBpbWFnZSBuYW1lIGJhc2VkIG9uIHRoZSBmaWxlbmFtZSB3ZQovLyBhcmUgcnVubmluZyBmcm9tIGFuZCBhc3N1bWluZyB3ZSB1c2UgYXV0byBkZXRlY3Rpb24gb2YgZ3JhcGhpYyBmb3JtYXQKLy8gKHRvcCBsZXZlbCksIGkuZSBpdCBpcyBzYWZlIHRvIGNhbGwgdGhpcyBmdW5jdGlvbgovLyBmcm9tIGEgc2NyaXB0IHRoYXQgdXNlcyBKcEdyYXBoCi8vCmZ1bmN0aW9uIEdlbkltZ05hbWUoKSB7CiAgICAvLyBEZXRlcm1pbmUgd2hhdCBmb3JtYXQgd2Ugc2hvdWxkIHVzZSB3aGVuIHdlIHNhdmUgdGhlIGltYWdlcwogICAgJHN1cHBvcnRlZCA9IGltYWdldHlwZXMoKTsKICAgIGlmKCAkc3VwcG9ydGVkICYgSU1HX1BORyApICAgICRpbWdfZm9ybWF0PSJwbmciOwogICAgZWxzZWlmKCAkc3VwcG9ydGVkICYgSU1HX0dJRiApICRpbWdfZm9ybWF0PSJnaWYiOwogICAgZWxzZWlmKCAkc3VwcG9ydGVkICYgSU1HX0pQRyApICRpbWdfZm9ybWF0PSJqcGVnIjsKICAgIGVsc2VpZiggJHN1cHBvcnRlZCAmIElNR19XQk1QICkgJGltZ19mb3JtYXQ9IndibXAiOwogICAgZWxzZWlmKCAkc3VwcG9ydGVkICYgSU1HX1hQTSApICRpbWdfZm9ybWF0PSJ4cG0iOwoKCiAgICBpZiggIWlzc2V0KCRfU0VSVkVSWydQSFBfU0VMRiddKSApIHsKICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAwNSk7CiAgICAgICAgLy8oIiBDYW4ndCBhY2Nlc3MgUEhQX1NFTEYsIFBIUCBnbG9iYWwgdmFyaWFibGUuIFlvdSBjYW4ndCBydW4gUEhQIGZyb20gY29tbWFuZCBsaW5lIGlmIHlvdSB3YW50IHRvIHVzZSB0aGUgJ2F1dG8nIG5hbWluZyBvZiBjYWNoZSBvciBpbWFnZSBmaWxlcy4iKTsKICAgIH0KICAgICRmbmFtZSA9IGJhc2VuYW1lKCRfU0VSVkVSWydQSFBfU0VMRiddKTsKICAgIGlmKCAhZW1wdHkoJF9TRVJWRVJbJ1FVRVJZX1NUUklORyddKSApIHsKICAgICAgICAkcSA9IEAkX1NFUlZFUlsnUVVFUllfU1RSSU5HJ107CiAgICAgICAgJGZuYW1lIC49ICdfJy5wcmVnX3JlcGxhY2UoIi9cVy8iLCAiXyIsICRxKS4nLicuJGltZ19mb3JtYXQ7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkZm5hbWUgPSBzdWJzdHIoJGZuYW1lLDAsc3RybGVuKCRmbmFtZSktNCkuJy4nLiRpbWdfZm9ybWF0OwogICAgfQogICAgcmV0dXJuICRmbmFtZTsKfQoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ0xBU1MgSnBnVGltZXIKLy8gRGVzY3JpcHRpb246IEdlbmVyYWwgdGltaW5nIHV0aWxpdHkgY2xhc3MgdG8gaGFuZGxlCi8vIHRpbWUgbWVhc3VyZW1lbnQgb2YgZ2VuZXJhdGluZyBncmFwaHMuIE11bHRpcGxlCi8vIHRpbWVycyBjYW4gYmUgc3RhcnRlZC4KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgSnBnVGltZXIgewogICAgcHJpdmF0ZSAkc3RhcnQsICRpZHg7CgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKSB7CiAgICAgICAgJHRoaXMtPmlkeD0wOwogICAgfQoKICAgIC8vIFB1c2ggYSBuZXcgdGltZXIgc3RhcnQgb24gc3RhY2sKICAgIGZ1bmN0aW9uIFB1c2goKSB7CiAgICAgICAgbGlzdCgkbXMsJHMpPWV4cGxvZGUoIiAiLG1pY3JvdGltZSgpKTsKICAgICAgICAkdGhpcy0+c3RhcnRbJHRoaXMtPmlkeCsrXT1mbG9vcigkbXMqMTAwMCkgKyAxMDAwKiRzOwogICAgfQoKICAgIC8vIFBvcCB0aGUgbGF0ZXN0IHRpbWVyIHN0YXJ0IGFuZCByZXR1cm4gdGhlIGRpZmYgd2l0aCB0aGUKICAgIC8vIGN1cnJlbnQgdGltZQogICAgZnVuY3Rpb24gUG9wKCkgewogICAgICAgIGFzc2VydCgkdGhpcy0+aWR4PjApOwogICAgICAgIGxpc3QoJG1zLCRzKT1leHBsb2RlKCIgIixtaWNyb3RpbWUoKSk7CiAgICAgICAgJGV0aW1lPWZsb29yKCRtcyoxMDAwKSArICgxMDAwKiRzKTsKICAgICAgICAkdGhpcy0+aWR4LS07CiAgICAgICAgcmV0dXJuICRldGltZS0kdGhpcy0+c3RhcnRbJHRoaXMtPmlkeF07CiAgICB9Cn0gLy8gQ2xhc3MKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIERhdGVMb2NhbGUKLy8gRGVzY3JpcHRpb246IEhvbGQgbG9jYWxpemVkIHRleHQgdXNlZCBpbiBkYXRlcwovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjbGFzcyBEYXRlTG9jYWxlIHsKCiAgICBwdWJsaWMgJGlMb2NhbGUgPSAnQyc7IC8vIGVudmlyb25tZW50YWwgbG9jYWxlIGJlIHVzZWQgYnkgZGVmYXVsdAogICAgcHJpdmF0ZSAkaURheUFiYiA9IG51bGwsICRpU2hvcnREYXkgPSBudWxsLCAkaVNob3J0TW9udGggPSBudWxsLCAkaU1vbnRoTmFtZSA9IG51bGw7CgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKSB7CiAgICAgICAgc2V0dHlwZSgkdGhpcy0+aURheUFiYiwgJ2FycmF5Jyk7CiAgICAgICAgc2V0dHlwZSgkdGhpcy0+aVNob3J0RGF5LCAnYXJyYXknKTsKICAgICAgICBzZXR0eXBlKCR0aGlzLT5pU2hvcnRNb250aCwgJ2FycmF5Jyk7CiAgICAgICAgc2V0dHlwZSgkdGhpcy0+aU1vbnRoTmFtZSwgJ2FycmF5Jyk7CiAgICAgICAgJHRoaXMtPlNldCgnQycpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldCgkYUxvY2FsZSkgewogICAgICAgIGlmICggaW5fYXJyYXkoJGFMb2NhbGUsIGFycmF5X2tleXMoJHRoaXMtPmlEYXlBYmIpKSApewogICAgICAgICAgICAkdGhpcy0+aUxvY2FsZSA9ICRhTG9jYWxlOwogICAgICAgICAgICByZXR1cm4gVFJVRTsgIC8vIGFscmVhZHkgY2FjaGVkIG5vdGhpbmcgZWxzZSB0byBkbyEKICAgICAgICB9CgogICAgICAgICRwTG9jYWxlID0gc2V0bG9jYWxlKExDX1RJTUUsIDApOyAvLyBnZXQgY3VycmVudCBsb2NhbGUgZm9yIExDX1RJTUUKCiAgICAgICAgaWYgKGlzX2FycmF5KCRhTG9jYWxlKSkgewogICAgICAgICAgICBmb3JlYWNoICgkYUxvY2FsZSBhcyAkbG9jKSB7CiAgICAgICAgICAgICAgICAkcmVzID0gQHNldGxvY2FsZShMQ19USU1FLCAkbG9jKTsKICAgICAgICAgICAgICAgIGlmICggJHJlcyApIHsKICAgICAgICAgICAgICAgICAgICAkYUxvY2FsZSA9ICRsb2M7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRyZXMgPSBAc2V0bG9jYWxlKExDX1RJTUUsICRhTG9jYWxlKTsKICAgICAgICB9CgogICAgICAgIGlmICggISAkcmVzICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAwNywkYUxvY2FsZSk7CiAgICAgICAgICAgIC8vKCJZb3UgYXJlIHRyeWluZyB0byB1c2UgdGhlIGxvY2FsZSAoJGFMb2NhbGUpIHdoaWNoIHlvdXIgUEhQIGluc3RhbGxhdGlvbiBkb2VzIG5vdCBzdXBwb3J0LiBIaW50OiBVc2UgJycgdG8gaW5kaWNhdGUgdGhlIGRlZmF1bHQgbG9jYWxlIGZvciB0aGlzIGdlb2dyYXBoaWMgcmVnaW9uLiIpOwogICAgICAgICAgICByZXR1cm4gRkFMU0U7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+aUxvY2FsZSA9ICRhTG9jYWxlOwogICAgICAgIGZvciggJGkgPSAwLCAkb2ZzID0gMCAtIHN0cmZ0aW1lKCcldycpOyAkaSA8IDc7ICRpKyssICRvZnMrKyApIHsKICAgICAgICAgICAgJGRheSA9IHN0cmZ0aW1lKCclYScsIHN0cnRvdGltZSgiJG9mcyBkYXkiKSk7CiAgICAgICAgICAgICRkYXlbMF0gPSBzdHJ0b3VwcGVyKCRkYXlbMF0pOwogICAgICAgICAgICAkdGhpcy0+aURheUFiYlskYUxvY2FsZV1bXT0gJGRheVswXTsKICAgICAgICAgICAgJHRoaXMtPmlTaG9ydERheVskYUxvY2FsZV1bXT0gJGRheTsKICAgICAgICB9CgogICAgICAgIGZvcigkaT0xOyAkaTw9MTI7ICsrJGkpIHsKICAgICAgICAgICAgbGlzdCgkc2hvcnQgLCRmdWxsKSA9IGV4cGxvZGUoJ3wnLCBzdHJmdGltZSgiJWJ8JUIiLHN0cnRvdGltZSgiMjAwMS0kaS0wMSIpKSk7CiAgICAgICAgICAgICR0aGlzLT5pU2hvcnRNb250aFskYUxvY2FsZV1bXSA9IHVjZmlyc3QoJHNob3J0KTsKICAgICAgICAgICAgJHRoaXMtPmlNb250aE5hbWUgWyRhTG9jYWxlXVtdID0gdWNmaXJzdCgkZnVsbCk7CiAgICAgICAgfQoKICAgICAgICBzZXRsb2NhbGUoTENfVElNRSwgJHBMb2NhbGUpOwoKICAgICAgICByZXR1cm4gVFJVRTsKICAgIH0KCgogICAgZnVuY3Rpb24gR2V0RGF5QWJiKCkgewogICAgICAgIHJldHVybiAkdGhpcy0+aURheUFiYlskdGhpcy0+aUxvY2FsZV07CiAgICB9CgogICAgZnVuY3Rpb24gR2V0U2hvcnREYXkoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5pU2hvcnREYXlbJHRoaXMtPmlMb2NhbGVdOwogICAgfQoKICAgIGZ1bmN0aW9uIEdldFNob3J0TW9udGgoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5pU2hvcnRNb250aFskdGhpcy0+aUxvY2FsZV07CiAgICB9CgogICAgZnVuY3Rpb24gR2V0U2hvcnRNb250aE5hbWUoJGFOYnIpIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmlTaG9ydE1vbnRoWyR0aGlzLT5pTG9jYWxlXVskYU5icl07CiAgICB9CgogICAgZnVuY3Rpb24gR2V0TG9uZ01vbnRoTmFtZSgkYU5icikgewogICAgICAgIHJldHVybiAkdGhpcy0+aU1vbnRoTmFtZVskdGhpcy0+aUxvY2FsZV1bJGFOYnJdOwogICAgfQoKICAgIGZ1bmN0aW9uIEdldE1vbnRoKCkgewogICAgICAgIHJldHVybiAkdGhpcy0+aU1vbnRoTmFtZVskdGhpcy0+aUxvY2FsZV07CiAgICB9Cn0KCi8vIEdsb2JhbCBvYmplY3QgaGFuZGxlcnMKJGdEYXRlTG9jYWxlID0gbmV3IERhdGVMb2NhbGUoKTsKJGdKcGdEYXRlTG9jYWxlID0gbmV3IERhdGVMb2NhbGUoKTsKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBGb290ZXIKLy8gRGVzY3JpcHRpb246IEVuY2Fwc3VsYXRlcyB0aGUgZm9vdGVyIGxpbmUgaW4gdGhlIEdyYXBoCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjbGFzcyBGb290ZXIgewogICAgcHVibGljICRpTGVmdE1hcmdpbiA9IDMsICRpUmlnaHRNYXJnaW4gPSAzLCAkaUJvdHRvbU1hcmdpbiA9IDMgOwogICAgcHVibGljICRsZWZ0LCRjZW50ZXIsJHJpZ2h0OwogICAgcHJpdmF0ZSAkaVRpbWVyPW51bGwsICRpdGltZXJwb3N0c3RyaW5nPScnOwoKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkgewogICAgICAgICR0aGlzLT5sZWZ0ID0gbmV3IFRleHQoKTsKICAgICAgICAkdGhpcy0+bGVmdC0+UGFyYWdyYXBoQWxpZ24oJ2xlZnQnKTsKICAgICAgICAkdGhpcy0+Y2VudGVyID0gbmV3IFRleHQoKTsKICAgICAgICAkdGhpcy0+Y2VudGVyLT5QYXJhZ3JhcGhBbGlnbignY2VudGVyJyk7CiAgICAgICAgJHRoaXMtPnJpZ2h0ID0gbmV3IFRleHQoKTsKICAgICAgICAkdGhpcy0+cmlnaHQtPlBhcmFncmFwaEFsaWduKCdyaWdodCcpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFRpbWVyKCRhVGltZXIsJGFUaW1lclBvc3RTdHJpbmc9JycpIHsKICAgICAgICAkdGhpcy0+aVRpbWVyID0gJGFUaW1lcjsKICAgICAgICAkdGhpcy0+aXRpbWVycG9zdHN0cmluZyA9ICRhVGltZXJQb3N0U3RyaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldE1hcmdpbigkYUxlZnQ9MywkYVJpZ2h0PTMsJGFCb3R0b209MykgewogICAgICAgICR0aGlzLT5pTGVmdE1hcmdpbiA9ICRhTGVmdDsKICAgICAgICAkdGhpcy0+aVJpZ2h0TWFyZ2luID0gJGFSaWdodDsKICAgICAgICAkdGhpcy0+aUJvdHRvbU1hcmdpbiA9ICRhQm90dG9tOwogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZSgkYUltZykgewogICAgICAgICR5ID0gJGFJbWctPmhlaWdodCAtICR0aGlzLT5pQm90dG9tTWFyZ2luOwogICAgICAgICR4ID0gJHRoaXMtPmlMZWZ0TWFyZ2luOwogICAgICAgICR0aGlzLT5sZWZ0LT5BbGlnbignbGVmdCcsJ2JvdHRvbScpOwogICAgICAgICR0aGlzLT5sZWZ0LT5TdHJva2UoJGFJbWcsJHgsJHkpOwoKICAgICAgICAkeCA9ICgkYUltZy0+d2lkdGggLSAkdGhpcy0+aUxlZnRNYXJnaW4gLSAkdGhpcy0+aVJpZ2h0TWFyZ2luKS8yOwogICAgICAgICR0aGlzLT5jZW50ZXItPkFsaWduKCdjZW50ZXInLCdib3R0b20nKTsKICAgICAgICAkdGhpcy0+Y2VudGVyLT5TdHJva2UoJGFJbWcsJHgsJHkpOwoKICAgICAgICAkeCA9ICRhSW1nLT53aWR0aCAtICR0aGlzLT5pUmlnaHRNYXJnaW47CiAgICAgICAgJHRoaXMtPnJpZ2h0LT5BbGlnbigncmlnaHQnLCdib3R0b20nKTsKICAgICAgICBpZiggJHRoaXMtPmlUaW1lciAhPSBudWxsICkgewogICAgICAgICAgICAkdGhpcy0+cmlnaHQtPlNldCggJHRoaXMtPnJpZ2h0LT50IC4gc3ByaW50ZignJS4zZicsJHRoaXMtPmlUaW1lci0+UG9wKCkvMTAwMC4wKSAuICR0aGlzLT5pdGltZXJwb3N0c3RyaW5nICk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5yaWdodC0+U3Ryb2tlKCRhSW1nLCR4LCR5KTsKICAgIH0KfQoKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIEdyYXBoCi8vIERlc2NyaXB0aW9uOiBNYWluIGNsYXNzIHRvIGhhbmRsZSBncmFwaHMKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgR3JhcGggewogICAgcHVibGljICRjYWNoZT1udWxsOyAgIC8vIENhY2hlIG9iamVjdCAoc2luZ2xldG9uKQogICAgcHVibGljICRpbWc9bnVsbDsgICAvLyBJbWcgb2JqZWN0IChzaW5nbGV0b24pCiAgICBwdWJsaWMgJHBsb3RzPWFycmF5KCk7ICAvLyBBcnJheSBvZiBhbGwgcGxvdCBvYmplY3QgaW4gdGhlIGdyYXBoIChmb3IgWSAxIGF4aXMpCiAgICBwdWJsaWMgJHkycGxvdHM9YXJyYXkoKTsgIC8vIEFycmF5IG9mIGFsbCBwbG90IG9iamVjdCBpbiB0aGUgZ3JhcGggKGZvciBZIDIgYXhpcykKICAgIHB1YmxpYyAkeW5wbG90cz1hcnJheSgpOwogICAgcHVibGljICR4c2NhbGU9bnVsbDsgIC8vIFggU2NhbGUgb2JqZWN0IChjb3VsZCBiZSBpbnN0YW5jZSBvZiBMaW5lYXJTY2FsZSBvciBMb2dTY2FsZQogICAgcHVibGljICR5c2NhbGU9bnVsbCwkeTJzY2FsZT1udWxsLCAkeW5zY2FsZT1hcnJheSgpOwogICAgcHVibGljICRpSWNvbnMgPSBhcnJheSgpOyAgLy8gQXJyYXkgb2YgSWNvbnMgdG8gYWRkIHRvCiAgICBwdWJsaWMgJGNhY2hlX25hbWU7ICAgLy8gRmlsZSBuYW1lIHRvIGJlIHVzZWQgZm9yIHRoZSBjdXJyZW50IGdyYXBoIGluIHRoZSBjYWNoZSBkaXJlY3RvcnkKICAgIHB1YmxpYyAkeGdyaWQ9bnVsbDsgICAvLyBYIEdyaWQgb2JqZWN0IChsaW5lYXIgb3IgbG9nYXJpdGhtaWMpCiAgICBwdWJsaWMgJHlncmlkPW51bGwsJHkyZ3JpZD1udWxsOyAvL2RpdG8gZm9yIFkKICAgIHB1YmxpYyAkZG9mcmFtZSwkZnJhbWVfY29sb3IsICRmcmFtZV93ZWlnaHQ7IC8vIEZyYW1lIGFyb3VuZCBncmFwaAogICAgcHVibGljICRib3hlZD1mYWxzZSwgJGJveF9jb2xvcj0nYmxhY2snLCAkYm94X3dlaWdodD0xOyAgLy8gQm94IGFyb3VuZCBwbG90IGFyZWEKICAgIHB1YmxpYyAkZG9zaGFkb3c9ZmFsc2UsJHNoYWRvd193aWR0aD00LCRzaGFkb3dfY29sb3I9J2dyYXlAMC41JzsgLy8gU2hhZG93IGZvciBncmFwaAogICAgcHVibGljICR4YXhpcz1udWxsOyAgIC8vIFgtYXhpcyAoaW5zdGFuZSBvZiBBeGlzIGNsYXNzKQogICAgcHVibGljICR5YXhpcz1udWxsLCAkeTJheGlzPW51bGwsICR5bmF4aXM9YXJyYXkoKTsgLy8gWSBheGlzIChpbnN0YW5jZSBvZiBBeGlzIGNsYXNzKQogICAgcHVibGljICRtYXJnaW5fY29sb3I7IC8vIE1hcmdpbiBjb2xvciBvZiBncmFwaAogICAgcHVibGljICRwbG90YXJlYV9jb2xvcj1hcnJheSgyNTUsMjU1LDI1NSk7IC8vIFBsb3QgYXJlYSBjb2xvcgogICAgcHVibGljICR0aXRsZSwkc3VidGl0bGUsJHN1YnN1YnRpdGxlOyAgLy8gVGl0bGUgYW5kIHN1YnRpdGxlKHMpIHRleHQgb2JqZWN0CiAgICBwdWJsaWMgJGF4dHlwZT0ibGlubGluIjsgIC8vIFR5cGUgb2YgYXhpcwogICAgcHVibGljICR4dGlja19mYWN0b3IsJHl0aWNrX2ZhY3RvcjsgLy8gRmFjdG9yIHRvIGRldGVybWluZSB0aGUgbWF4aW11bSBudW1iZXIgb2YgdGlja3MgZGVwZW5kaW5nIG9uIHRoZSBwbG90IHdpZHRoCiAgICBwdWJsaWMgJHRleHRzPW51bGwsICR5MnRleHRzPW51bGw7IC8vIFRleHQgb2JqZWN0IHRvIGdlIHNob3duIGluIHRoZSBncmFwaAogICAgcHVibGljICRsaW5lcz1udWxsLCAkeTJsaW5lcz1udWxsOwogICAgcHVibGljICRiYW5kcz1udWxsLCAkeTJiYW5kcz1udWxsOwogICAgcHVibGljICR0ZXh0X3NjYWxlX29mZj0wLCAkdGV4dF9zY2FsZV9hYnNjZW50ZXJvZmY9LTE7IC8vIFRleHQgc2NhbGUgaW4gZnJhY3Rpb25zIGFuZCBmb3IgY2VudGVyaW5nIGJhcnMKICAgIHB1YmxpYyAkYmFja2dyb3VuZF9pbWFnZT0nJywkYmFja2dyb3VuZF9pbWFnZV90eXBlPS0xLCRiYWNrZ3JvdW5kX2ltYWdlX2Zvcm1hdD0icG5nIjsKICAgIHB1YmxpYyAkYmFja2dyb3VuZF9pbWFnZV9icmlnaHQ9MCwkYmFja2dyb3VuZF9pbWFnZV9jb250cj0wLCRiYWNrZ3JvdW5kX2ltYWdlX3NhdD0wOwogICAgcHVibGljICRiYWNrZ3JvdW5kX2ltYWdlX3hwb3M9MCwkYmFja2dyb3VuZF9pbWFnZV95cG9zPTA7CiAgICBwdWJsaWMgJGltYWdlX2JyaWdodD0wLCAkaW1hZ2VfY29udHI9MCwgJGltYWdlX3NhdD0wOwogICAgcHVibGljICRpbmxpbmU7CiAgICBwdWJsaWMgJHNob3djc2ltPTAsJGNzaW1jb2xvcj0icmVkIjsvL2RlYnVnIHN0dWZmLCBkcmF3IHRoZSBjc2ltIGJvdW5kYXJpcyBvbiB0aGUgaW1hZ2UgaWYgPD4wCiAgICBwdWJsaWMgJGdyaWRfZGVwdGg9REVQVEhfQkFDSzsgLy8gRHJhdyBncmlkIHVuZGVyIGFsbCBwbG90cyBhcyBkZWZhdWx0CiAgICBwdWJsaWMgJGlBeGlzU3R5bGUgPSBBWFNUWUxFX1NJTVBMRTsKICAgIHB1YmxpYyAkaUNTSU1kaXNwbGF5PWZhbHNlLCRpSGFzU3Ryb2tlZCA9IGZhbHNlOwogICAgcHVibGljICRmb290ZXI7CiAgICBwdWJsaWMgJGNzaW1jYWNoZW5hbWUgPSAnJywgJGNzaW1jYWNoZXRpbWVvdXQgPSAwLCAkaUNTSU1JbWdBbHQ9Jyc7CiAgICBwdWJsaWMgJGlEb0NsaXBwaW5nID0gZmFsc2U7CiAgICBwdWJsaWMgJHkyb3JkZXJiYWNrPXRydWU7CiAgICBwdWJsaWMgJHRhYnRpdGxlOwogICAgcHVibGljICRia2dfZ3JhZHR5cGU9LTEsJGJrZ19ncmFkc3R5bGU9QkdSQURfTUFSR0lOOwogICAgcHVibGljICRia2dfZ3JhZGZyb209J25hdnknLCAkYmtnX2dyYWR0bz0nc2lsdmVyJzsKICAgIHB1YmxpYyAkcGxvdF9ncmFkdHlwZT0tMSwkcGxvdF9ncmFkc3R5bGU9QkdSQURfTUFSR0lOOwogICAgcHVibGljICRwbG90X2dyYWRmcm9tPSdzaWx2ZXInLCAkcGxvdF9ncmFkdG89J25hdnknOwoKICAgIHB1YmxpYyAkdGl0bGViYWNrZ3JvdW5kID0gZmFsc2U7CiAgICBwdWJsaWMgJHRpdGxlYmFja2dyb3VuZF9jb2xvciA9ICdsaWdodGJsdWUnLAogICAgICAgICAgICR0aXRsZWJhY2tncm91bmRfc3R5bGUgPSAxLAogICAgICAgICAgICR0aXRsZWJhY2tncm91bmRfZnJhbWVjb2xvciwKICAgICAgICAgICAkdGl0bGViYWNrZ3JvdW5kX2ZyYW1lc3R5bGUsCiAgICAgICAgICAgJHRpdGxlYmFja2dyb3VuZF9mcmFtZXdlaWdodCwKICAgICAgICAgICAkdGl0bGViYWNrZ3JvdW5kX2JldmVsaGVpZ2h0OwogICAgcHVibGljICR0aXRsZWJrZ19maWxsc3R5bGU9VElUTEVCS0dfRklMTFNUWUxFX1NPTElEOwogICAgcHVibGljICR0aXRsZWJrZ19zY29sb3IxPSdibGFjaycsJHRpdGxlYmtnX3Njb2xvcjI9J3doaXRlJzsKICAgIHB1YmxpYyAkZnJhbWViZXZlbCwgJGZyYW1lYmV2ZWxkZXB0aDsKICAgIHB1YmxpYyAkZnJhbWViZXZlbGJvcmRlciwgJGZyYW1lYmV2ZWxib3JkZXJjb2xvcjsKICAgIHB1YmxpYyAkZnJhbWViZXZlbGNvbG9yMSwgJGZyYW1lYmV2ZWxjb2xvcjI7CiAgICBwdWJsaWMgJGJhY2tncm91bmRfaW1hZ2VfbWl4PTEwMDsKICAgIHB1YmxpYyAkYmFja2dyb3VuZF9jZmxhZyA9ICcnOwogICAgcHVibGljICRiYWNrZ3JvdW5kX2NmbGFnX3R5cGUgPSBCR0lNR19GSUxMUExPVDsKICAgIHB1YmxpYyAkYmFja2dyb3VuZF9jZmxhZ19taXggPSAxMDA7CiAgICBwdWJsaWMgJGlJbWdUcmFucz1mYWxzZSwKICAgICAgICAgICAkaUltZ1RyYW5zSG9yaXpvbiA9IDEwMCwkaUltZ1RyYW5zU2tld0Rpc3Q9MTUwLAogICAgICAgICAgICRpSW1nVHJhbnNEaXJlY3Rpb24gPSAxLCAkaUltZ1RyYW5zTWluU2l6ZSA9IHRydWUsCiAgICAgICAgICAgJGlJbWdUcmFuc0ZpbGxDb2xvcj0nd2hpdGUnLCRpSW1nVHJhbnNIaWdoUT1mYWxzZSwKICAgICAgICAgICAkaUltZ1RyYW5zQm9yZGVyPWZhbHNlLCRpSW1nVHJhbnNIb3Jpem9uUG9zPTAuNTsKICAgIHB1YmxpYyAkbGVnZW5kOwogICAgcHVibGljICRncmFwaF90aGVtZTsKICAgIHByb3RlY3RlZCAkaVlBeGlzRGVsdGFQb3M9NTA7CiAgICBwcm90ZWN0ZWQgJGlJY29uRGVwdGg9REVQVEhfQkFDSzsKICAgIHByb3RlY3RlZCAkaUF4aXNMYmxCZ1R5cGUgPSAwLAogICAgICAgICAgICAgICRpWEF4aXNMYmxCZ0ZpbGxDb2xvciA9ICdsaWdodGdyYXknLCAkaVhBeGlzTGJsQmdDb2xvciA9ICdibGFjaycsCiAgICAgICAgICAgICAgJGlZQXhpc0xibEJnRmlsbENvbG9yID0gJ2xpZ2h0Z3JheScsICRpWUF4aXNMYmxCZ0NvbG9yID0gJ2JsYWNrJzsKICAgIHByb3RlY3RlZCAkaVRhYmxlcz1OVUxMOwoKICAgIHByb3RlY3RlZCAkaXNSdW5uaW5nQ2xlYXIgPSBmYWxzZTsKICAgIHByb3RlY3RlZCAkaW5wdXRWYWx1ZXM7CiAgICBwcm90ZWN0ZWQgJGlzQWZ0ZXJTZXRTY2FsZSA9IGZhbHNlOwoKICAgIC8vIGFXSWR0aCAgIFdpZHRoIGluIHBpeGVscyBvZiBpbWFnZQogICAgLy8gYUhlaWdodCAgIEhlaWdodCBpbiBwaXhlbHMgb2YgaW1hZ2UKICAgIC8vIGFDYWNoZWROYW1lIE5hbWUgZm9yIGltYWdlIGZpbGUgaW4gY2FjaGUgZGlyZWN0b3J5CiAgICAvLyBhVGltZU91dCAgVGltZW91dCBpbiBtaW51dGVzIGZvciBpbWFnZSBpbiBjYWNoZQogICAgLy8gYUlubGluZSAgSWYgdHJ1ZSB0aGUgaW1hZ2UgaXMgc3RyZWFtZWQgYmFjayBpbiB0aGUgY2FsbCB0byBTdHJva2UoKQogICAgLy8gICBJZiBmYWxzZSB0aGUgaW1hZ2UgaXMganVzdCBjcmVhdGVkIGluIHRoZSBjYWNoZQogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGFXaWR0aD0zMDAsJGFIZWlnaHQ9MjAwLCRhQ2FjaGVkTmFtZT0nJywkYVRpbWVvdXQ9MCwkYUlubGluZT10cnVlKSB7CgogICAgICAgIGlmKCAhaXNfbnVtZXJpYygkYVdpZHRoKSB8fCAhaXNfbnVtZXJpYygkYUhlaWdodCkgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDA4KTsvLygnSW1hZ2Ugd2lkdGgvaGVpZ2h0IGFyZ3VtZW50IGluIEdyYXBoOjpHcmFwaCgpIG11c3QgYmUgbnVtZXJpYycpOwogICAgICAgIH0KCiAgICAgICAgLy8gSW5pdGlhbGl6ZSBmcmFtZSBhbmQgbWFyZ2luCiAgICAgICAgJHRoaXMtPkluaXRpYWxpemVGcmFtZUFuZE1hcmdpbigpOwoKICAgICAgICAvLyBBdXRvbWF0aWNhbGx5IGdlbmVyYXRlIHRoZSBpbWFnZSBmaWxlIG5hbWUgYmFzZWQgb24gdGhlIG5hbWUgb2YgdGhlIHNjcmlwdCB0aGF0CiAgICAgICAgLy8gZ2VuZXJhdGVzIHRoZSBncmFwaAogICAgICAgIGlmKCAkYUNhY2hlZE5hbWUgPT0gJ2F1dG8nICkgewogICAgICAgICAgICAkYUNhY2hlZE5hbWU9R2VuSW1nTmFtZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gU2hvdWxkIHRoZSBpbWFnZSBiZSBzdHJlYW1lZCBiYWNrIHRvIHRoZSBicm93c2VyIG9yIG9ubHkgdG8gdGhlIGNhY2hlPwogICAgICAgICR0aGlzLT5pbmxpbmU9JGFJbmxpbmU7CgogICAgICAgICR0aGlzLT5pbWcgPSBuZXcgUm90SW1hZ2UoJGFXaWR0aCwkYUhlaWdodCk7CiAgICAgICAgJHRoaXMtPmNhY2hlICA9IG5ldyBJbWdTdHJlYW1DYWNoZSgpOwoKICAgICAgICAvLyBXaW5kb3cgZG9lc24ndCBsaWtlICc\/JyBpbiB0aGUgZmlsZSBuYW1lIHNvIHJlcGxhY2UgaXQgd2l0aCBhbiAnXycKICAgICAgICAkYUNhY2hlZE5hbWUgPSBzdHJfcmVwbGFjZSgiPyIsIl8iLCRhQ2FjaGVkTmFtZSk7CiAgICAgICAgJHRoaXMtPlNldHVwQ2FjaGUoJGFDYWNoZWROYW1lLCAkYVRpbWVvdXQpOwoKICAgICAgICAkdGhpcy0+dGl0bGUgPSBuZXcgVGV4dCgpOwogICAgICAgICR0aGlzLT50aXRsZS0+UGFyYWdyYXBoQWxpZ24oJ2NlbnRlcicpOwogICAgICAgICR0aGlzLT50aXRsZS0+U2V0Rm9udChGRl9ERUZBVUxULEZTX05PUk1BTCk7IC8vRkZfRk9OVDIsIEZTX0JPTEQKICAgICAgICAkdGhpcy0+dGl0bGUtPlNldE1hcmdpbig1KTsKICAgICAgICAkdGhpcy0+dGl0bGUtPlNldEFsaWduKCdjZW50ZXInKTsKCiAgICAgICAgJHRoaXMtPnN1YnRpdGxlID0gbmV3IFRleHQoKTsKICAgICAgICAkdGhpcy0+c3VidGl0bGUtPlBhcmFncmFwaEFsaWduKCdjZW50ZXInKTsKICAgICAgICAkdGhpcy0+c3VidGl0bGUtPlNldE1hcmdpbigzKTsKICAgICAgICAkdGhpcy0+c3VidGl0bGUtPlNldEFsaWduKCdjZW50ZXInKTsKCiAgICAgICAgJHRoaXMtPnN1YnN1YnRpdGxlID0gbmV3IFRleHQoKTsKICAgICAgICAkdGhpcy0+c3Vic3VidGl0bGUtPlBhcmFncmFwaEFsaWduKCdjZW50ZXInKTsKICAgICAgICAkdGhpcy0+c3Vic3VidGl0bGUtPlNldE1hcmdpbigzKTsKICAgICAgICAkdGhpcy0+c3Vic3VidGl0bGUtPlNldEFsaWduKCdjZW50ZXInKTsKCiAgICAgICAgJHRoaXMtPmxlZ2VuZCA9IG5ldyBMZWdlbmQoKTsKICAgICAgICAkdGhpcy0+Zm9vdGVyID0gbmV3IEZvb3RlcigpOwoKICAgICAgICAvLyBJZiB0aGUgY2FjaGVkIHZlcnNpb24gZXhpc3QganVzdCByZWFkIGl0IGRpcmVjdGx5IGZyb20gdGhlCiAgICAgICAgLy8gY2FjaGUsIHN0cmVhbSBpdCBiYWNrIHRvIGJyb3dzZXIgYW5kIGV4aXQKICAgICAgICBpZiggJGFDYWNoZWROYW1lIT0nJyAmJiBSRUFEX0NBQ0hFICYmICRhSW5saW5lICkgewogICAgICAgICAgICBpZiggJHRoaXMtPmNhY2hlLT5HZXRBbmRTdHJlYW0oJHRoaXMtPmltZywkYUNhY2hlZE5hbWUpICkgewogICAgICAgICAgICAgICAgZXhpdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+U2V0VGlja0RlbnNpdHkoKTsgLy8gTm9ybWFsIGRlbnNpdHkKCiAgICAgICAgJHRoaXMtPnRhYnRpdGxlID0gbmV3IEdyYXBoVGFiVGl0bGUoKTsKCiAgICAgICAgaWYgKCEkdGhpcy0+aXNSdW5uaW5nQ2xlYXIpIHsKICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzID0gYXJyYXkoKTsKICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhV2lkdGgnXSA9ICRhV2lkdGg7CiAgICAgICAgICAgICR0aGlzLT5pbnB1dFZhbHVlc1snYUhlaWdodCddID0gJGFIZWlnaHQ7CiAgICAgICAgICAgICR0aGlzLT5pbnB1dFZhbHVlc1snYUNhY2hlZE5hbWUnXSA9ICRhQ2FjaGVkTmFtZTsKICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhVGltZW91dCddID0gJGFUaW1lb3V0OwogICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FJbmxpbmUnXSA9ICRhSW5saW5lOwoKICAgICAgICAgICAgJHRoZW1lX2NsYXNzID0gREVGQVVMVF9USEVNRV9DTEFTUzsKICAgICAgICAgICAgaWYgKGNsYXNzX2V4aXN0cygkdGhlbWVfY2xhc3MpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+Z3JhcGhfdGhlbWUgPSBuZXcgJHRoZW1lX2NsYXNzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gSW5pdGlhbGl6ZUZyYW1lQW5kTWFyZ2luKCkgewogICAgICAgICR0aGlzLT5kb2ZyYW1lPXRydWU7CiAgICAgICAgJHRoaXMtPmZyYW1lX2NvbG9yPSdibGFjayc7CiAgICAgICAgJHRoaXMtPmZyYW1lX3dlaWdodD0xOyAKCiAgICAgICAgJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9mcmFtZWNvbG9yID0gJ2JsdWUnOwogICAgICAgICR0aGlzLT50aXRsZWJhY2tncm91bmRfZnJhbWVzdHlsZSA9IDI7CiAgICAgICAgJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9mcmFtZXdlaWdodCA9IDE7CiAgICAgICAgJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9iZXZlbGhlaWdodCA9IDM7CiAgICAgICAgJHRoaXMtPnRpdGxlYmtnX2ZpbGxzdHlsZT1USVRMRUJLR19GSUxMU1RZTEVfU09MSUQ7CiAgICAgICAgJHRoaXMtPnRpdGxlYmtnX3Njb2xvcjE9J2JsYWNrJzsKICAgICAgICAkdGhpcy0+dGl0bGVia2dfc2NvbG9yMj0nd2hpdGUnOwogICAgICAgICR0aGlzLT5mcmFtZWJldmVsID0gZmFsc2U7CiAgICAgICAgJHRoaXMtPmZyYW1lYmV2ZWxkZXB0aCA9IDI7CiAgICAgICAgJHRoaXMtPmZyYW1lYmV2ZWxib3JkZXIgPSBmYWxzZTsKICAgICAgICAkdGhpcy0+ZnJhbWViZXZlbGJvcmRlcmNvbG9yPSdibGFjayc7CiAgICAgICAgJHRoaXMtPmZyYW1lYmV2ZWxjb2xvcjE9J3doaXRlQDAuNCc7CiAgICAgICAgJHRoaXMtPmZyYW1lYmV2ZWxjb2xvcjI9J2JsYWNrQDAuNCc7CgogICAgICAgICR0aGlzLT5tYXJnaW5fY29sb3IgPSBhcnJheSgyNTAsMjUwLDI1MCk7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0dXBDYWNoZSgkYUZpbGVuYW1lLCRhVGltZW91dD02MCkgewogICAgICAgICR0aGlzLT5jYWNoZV9uYW1lID0gJGFGaWxlbmFtZTsKICAgICAgICAkdGhpcy0+Y2FjaGUtPlNldFRpbWVPdXQoJGFUaW1lb3V0KTsKICAgIH0KCiAgICAvLyBFbmFibGUgZmluYWwgaW1hZ2UgcGVyc3BlY3RpdmUgdHJhbnNmb3JtYXRpb24KICAgIGZ1bmN0aW9uIFNldDNEUGVyc3BlY3RpdmUoJGFEaXI9MSwkYUhvcml6b249MTAwLCRhU2tld0Rpc3Q9MTIwLCRhUXVhbGl0eT1mYWxzZSwkYUZpbGxDb2xvcj0nI0ZGRkZGRicsJGFCb3JkZXI9ZmFsc2UsJGFNaW5TaXplPXRydWUsJGFIb3Jpem9uUG9zPTAuNSkgewogICAgICAgICR0aGlzLT5pSW1nVHJhbnMgPSB0cnVlOwogICAgICAgICR0aGlzLT5pSW1nVHJhbnNIb3Jpem9uID0gJGFIb3Jpem9uOwogICAgICAgICR0aGlzLT5pSW1nVHJhbnNTa2V3RGlzdD0gJGFTa2V3RGlzdDsKICAgICAgICAkdGhpcy0+aUltZ1RyYW5zRGlyZWN0aW9uID0gJGFEaXI7CiAgICAgICAgJHRoaXMtPmlJbWdUcmFuc01pblNpemUgPSAkYU1pblNpemU7CiAgICAgICAgJHRoaXMtPmlJbWdUcmFuc0ZpbGxDb2xvcj0kYUZpbGxDb2xvcjsKICAgICAgICAkdGhpcy0+aUltZ1RyYW5zSGlnaFE9JGFRdWFsaXR5OwogICAgICAgICR0aGlzLT5pSW1nVHJhbnNCb3JkZXI9JGFCb3JkZXI7CiAgICAgICAgJHRoaXMtPmlJbWdUcmFuc0hvcml6b25Qb3M9JGFIb3Jpem9uUG9zOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFVzZXJGb250KCRhTm9ybWFsLCRhQm9sZD0nJywkYUl0YWxpYz0nJywkYUJvbGRJdD0nJykgewogICAgICAgICR0aGlzLT5pbWctPnR0Zi0+U2V0VXNlckZvbnQoJGFOb3JtYWwsJGFCb2xkLCRhSXRhbGljLCRhQm9sZEl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRVc2VyRm9udDEoJGFOb3JtYWwsJGFCb2xkPScnLCRhSXRhbGljPScnLCRhQm9sZEl0PScnKSB7CiAgICAgICAgJHRoaXMtPmltZy0+dHRmLT5TZXRVc2VyRm9udDEoJGFOb3JtYWwsJGFCb2xkLCRhSXRhbGljLCRhQm9sZEl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRVc2VyRm9udDIoJGFOb3JtYWwsJGFCb2xkPScnLCRhSXRhbGljPScnLCRhQm9sZEl0PScnKSB7CiAgICAgICAgJHRoaXMtPmltZy0+dHRmLT5TZXRVc2VyRm9udDIoJGFOb3JtYWwsJGFCb2xkLCRhSXRhbGljLCRhQm9sZEl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRVc2VyRm9udDMoJGFOb3JtYWwsJGFCb2xkPScnLCRhSXRhbGljPScnLCRhQm9sZEl0PScnKSB7CiAgICAgICAgJHRoaXMtPmltZy0+dHRmLT5TZXRVc2VyRm9udDMoJGFOb3JtYWwsJGFCb2xkLCRhSXRhbGljLCRhQm9sZEl0KTsKICAgIH0KCiAgICAvLyBTZXQgSW1hZ2UgZm9ybWF0IGFuZCBvcHRpb25hbCBxdWFsaXR5CiAgICBmdW5jdGlvbiBTZXRJbWdGb3JtYXQoJGFGb3JtYXQsJGFRdWFsaXR5PTc1KSB7CiAgICAgICAgJHRoaXMtPmltZy0+U2V0SW1nRm9ybWF0KCRhRm9ybWF0LCRhUXVhbGl0eSk7CiAgICB9CgogICAgLy8gU2hvdWxkIHRoZSBncmlkIGJlIGluIGZyb250IG9yIGJhY2sgb2YgdGhlIHBsb3Q\/CiAgICBmdW5jdGlvbiBTZXRHcmlkRGVwdGgoJGFEZXB0aCkgewogICAgICAgICR0aGlzLT5ncmlkX2RlcHRoPSRhRGVwdGg7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0SWNvbkRlcHRoKCRhRGVwdGgpIHsKICAgICAgICAkdGhpcy0+aUljb25EZXB0aD0kYURlcHRoOwogICAgfQoKICAgIC8vIFNwZWNpZnkgZ3JhcGggYW5nbGUgMC0zNjAgZGVncmVlcy4KICAgIGZ1bmN0aW9uIFNldEFuZ2xlKCRhQW5nbGUpIHsKICAgICAgICAkdGhpcy0+aW1nLT5TZXRBbmdsZSgkYUFuZ2xlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRBbHBoYUJsZW5kaW5nKCRhRmxnPXRydWUpIHsKICAgICAgICAkdGhpcy0+aW1nLT5TZXRBbHBoYUJsZW5kaW5nKCRhRmxnKTsKICAgIH0KCiAgICAvLyBTaG9ydGN1dCB0byBpbWFnZSBtYXJnaW4KICAgIGZ1bmN0aW9uIFNldE1hcmdpbigkbG0sJHJtLCR0bSwkYm0pIHsKICAgICAgICAkdGhpcy0+aW1nLT5TZXRNYXJnaW4oJGxtLCRybSwkdG0sJGJtKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRZMk9yZGVyQmFjaygkYUJhY2s9dHJ1ZSkgewogICAgICAgICR0aGlzLT55Mm9yZGVyYmFjayA9ICRhQmFjazsKICAgIH0KCiAgICAvLyBSb3RhdGUgdGhlIGdyYXBoIDkwIGRlZ3JlZXMgYW5kIHNldCB0aGUgbWFyZ2luCiAgICAvLyB3aGVuIHdlIGhhdmUgZG9uZSBhIDkwIGRlZ3JlZSByb3RhdGlvbgogICAgZnVuY3Rpb24gU2V0OTBBbmRNYXJnaW4oJGxtPTAsJHJtPTAsJHRtPTAsJGJtPTApIHsKICAgICAgICAkbG0gPSAkbG0gPT0wID8gZmxvb3IoMC4yICogJHRoaXMtPmltZy0+d2lkdGgpICA6ICRsbSA7CiAgICAgICAgJHJtID0gJHJtID09MCA\/IGZsb29yKDAuMSAqICR0aGlzLT5pbWctPndpZHRoKSAgOiAkcm0gOwogICAgICAgICR0bSA9ICR0bSA9PTAgPyBmbG9vcigwLjIgKiAkdGhpcy0+aW1nLT5oZWlnaHQpIDogJHRtIDsKICAgICAgICAkYm0gPSAkYm0gPT0wID8gZmxvb3IoMC4xICogJHRoaXMtPmltZy0+aGVpZ2h0KSA6ICRibSA7CgogICAgICAgICRhZGogPSAoJHRoaXMtPmltZy0+aGVpZ2h0IC0gJHRoaXMtPmltZy0+d2lkdGgpLzI7CiAgICAgICAgJHRoaXMtPmltZy0+U2V0TWFyZ2luKCR0bS0kYWRqLCRibS0kYWRqLCRybSskYWRqLCRsbSskYWRqKTsKICAgICAgICAkdGhpcy0+aW1nLT5TZXRDZW50ZXIoZmxvb3IoJHRoaXMtPmltZy0+d2lkdGgvMiksZmxvb3IoJHRoaXMtPmltZy0+aGVpZ2h0LzIpKTsKICAgICAgICAkdGhpcy0+U2V0QW5nbGUoOTApOwogICAgICAgIGlmKCBlbXB0eSgkdGhpcy0+eWF4aXMpIHx8IGVtcHR5KCR0aGlzLT54YXhpcykgKSB7CiAgICAgICAgICAgIEpwZ3JhcGhFcnJvcjo6UmFpc2VMKDI1MDA5KTsvLygnWW91IG11c3Qgc3BlY2lmeSB3aGF0IHNjYWxlIHRvIHVzZSB3aXRoIGEgY2FsbCB0byBHcmFwaDo6U2V0U2NhbGUoKScpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+eGF4aXMtPlNldExhYmVsQWxpZ24oJ3JpZ2h0JywnY2VudGVyJyk7CiAgICAgICAgJHRoaXMtPnlheGlzLT5TZXRMYWJlbEFsaWduKCdjZW50ZXInLCdib3R0b20nKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDbGlwcGluZygkYUZsZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmlEb0NsaXBwaW5nID0gJGFGbGcgOwogICAgfQoKICAgIC8vIEFkZCBhIHBsb3Qgb2JqZWN0IHRvIHRoZSBncmFwaAogICAgZnVuY3Rpb24gQWRkKCRhUGxvdCkgewogICAgICAgIGlmKCAkYVBsb3QgPT0gbnVsbCApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMTApOy8vKCJHcmFwaDo6QWRkKCkgWW91IHRyaWVkIHRvIGFkZCBhIG51bGwgcGxvdCB0byB0aGUgZ3JhcGguIik7CiAgICAgICAgfQogICAgICAgIGlmKCBpc19hcnJheSgkYVBsb3QpICYmIGNvdW50KCRhUGxvdCkgPiAwICkgewogICAgICAgICAgICAkY2wgPSAkYVBsb3RbMF07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkY2wgPSAkYVBsb3Q7CiAgICAgICAgfQoKICAgICAgICBpZiggJGNsIGluc3RhbmNlb2YgVGV4dCApICR0aGlzLT5BZGRUZXh0KCRhUGxvdCk7CiAgICAgICAgZWxzZWlmKCBjbGFzc19leGlzdHMoJ1Bsb3RMaW5lJyxmYWxzZSkgJiYgKCRjbCBpbnN0YW5jZW9mIFBsb3RMaW5lKSApICAkdGhpcy0+QWRkTGluZSgkYVBsb3QpOwogICAgICAgIGVsc2VpZiggY2xhc3NfZXhpc3RzKCdQbG90QmFuZCcsZmFsc2UpICYmICgkY2wgaW5zdGFuY2VvZiBQbG90QmFuZCkgKSAkdGhpcy0+QWRkQmFuZCgkYVBsb3QpOwogICAgICAgIGVsc2VpZiggY2xhc3NfZXhpc3RzKCdJY29uUGxvdCcsZmFsc2UpICYmICgkY2wgaW5zdGFuY2VvZiBJY29uUGxvdCkgKSAkdGhpcy0+QWRkSWNvbigkYVBsb3QpOwogICAgICAgIGVsc2VpZiggY2xhc3NfZXhpc3RzKCdHVGV4dFRhYmxlJyxmYWxzZSkgJiYgKCRjbCBpbnN0YW5jZW9mIEdUZXh0VGFibGUpICkgJHRoaXMtPkFkZFRhYmxlKCRhUGxvdCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkYVBsb3QpICkgewogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzID0gYXJyYXlfbWVyZ2UoJHRoaXMtPnBsb3RzLCRhUGxvdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbXSA9ICRhUGxvdDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5ncmFwaF90aGVtZSkgewogICAgICAgICAgICAkdGhpcy0+Z3JhcGhfdGhlbWUtPlNldHVwUGxvdCgkYVBsb3QpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBBZGRUYWJsZSgkYVRhYmxlKSB7CiAgICAgICAgaWYoIGlzX2FycmF5KCRhVGFibGUpICkgewogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkYVRhYmxlKTsgKyskaSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5pVGFibGVzW109JGFUYWJsZVskaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5pVGFibGVzW10gPSAkYVRhYmxlIDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQWRkSWNvbigkYUljb24pIHsKICAgICAgICBpZiggaXNfYXJyYXkoJGFJY29uKSApIHsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgY291bnQoJGFJY29uKTsgKyskaSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5pSWNvbnNbXT0kYUljb25bJGldOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+aUljb25zW10gPSAkYUljb24gOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBBZGQgcGxvdCB0byBzZWNvbmQgWS1zY2FsZQogICAgZnVuY3Rpb24gQWRkWTIoJGFQbG90KSB7CiAgICAgICAgaWYoICRhUGxvdCA9PSBudWxsICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAxMSk7Ly8oIkdyYXBoOjpBZGRZMigpIFlvdSB0cmllZCB0byBhZGQgYSBudWxsIHBsb3QgdG8gdGhlIGdyYXBoLiIpOwogICAgICAgIH0KCiAgICAgICAgaWYoIGlzX2FycmF5KCRhUGxvdCkgJiYgY291bnQoJGFQbG90KSA+IDAgKSB7CiAgICAgICAgICAgICRjbCA9ICRhUGxvdFswXTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRjbCA9ICRhUGxvdDsKICAgICAgICB9CgogICAgICAgIGlmKCAkY2wgaW5zdGFuY2VvZiBUZXh0ICkgewogICAgICAgICAgICAkdGhpcy0+QWRkVGV4dCgkYVBsb3QsdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggY2xhc3NfZXhpc3RzKCdQbG90TGluZScsZmFsc2UpICYmICgkY2wgaW5zdGFuY2VvZiBQbG90TGluZSkgKSB7CiAgICAgICAgICAgICR0aGlzLT5BZGRMaW5lKCRhUGxvdCx0cnVlKTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCBjbGFzc19leGlzdHMoJ1Bsb3RCYW5kJyxmYWxzZSkgJiYgKCRjbCBpbnN0YW5jZW9mIFBsb3RCYW5kKSApIHsKICAgICAgICAgICAgJHRoaXMtPkFkZEJhbmQoJGFQbG90LHRydWUpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnkycGxvdHNbXSA9ICRhUGxvdDsKICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+Z3JhcGhfdGhlbWUpIHsKICAgICAgICAgICAgJHRoaXMtPmdyYXBoX3RoZW1lLT5TZXR1cFBsb3QoJGFQbG90KTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQWRkIHBsb3QgdG8gdGhlIGV4dHJhIFktYXhpc2VzCiAgICBmdW5jdGlvbiBBZGRZKCRhTiwkYVBsb3QpIHsKCiAgICAgICAgaWYoICRhUGxvdCA9PSBudWxsICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAxMik7Ly8oIkdyYXBoOjpBZGRZTigpIFlvdSB0cmllZCB0byBhZGQgYSBudWxsIHBsb3QgdG8gdGhlIGdyYXBoLiIpOwogICAgICAgIH0KCiAgICAgICAgaWYoIGlzX2FycmF5KCRhUGxvdCkgJiYgY291bnQoJGFQbG90KSA+IDAgKSB7CiAgICAgICAgICAgICRjbCA9ICRhUGxvdFswXTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRjbCA9ICRhUGxvdDsKICAgICAgICB9CgogICAgICAgIGlmKCAoJGNsIGluc3RhbmNlb2YgVGV4dCkgfHwKICAgICAgICAgICAgKGNsYXNzX2V4aXN0cygnUGxvdExpbmUnLGZhbHNlKSAmJiAoJGNsIGluc3RhbmNlb2YgUGxvdExpbmUpKSB8fAogICAgICAgICAgICAoY2xhc3NfZXhpc3RzKCdQbG90QmFuZCcsZmFsc2UpICYmICgkY2wgaW5zdGFuY2VvZiBQbG90QmFuZCkpICkgewogICAgICAgICAgICBKcEdyYXBoOjpSYWlzZUwoMjUwMTMpOy8vKCdZb3UgY2FuIG9ubHkgYWRkIHN0YW5kYXJkIHBsb3RzIHRvIG11bHRpcGxlIFktYXhpcycpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnlucGxvdHNbJGFOXVtdID0gJGFQbG90OwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5ncmFwaF90aGVtZSkgewogICAgICAgICAgICAkdGhpcy0+Z3JhcGhfdGhlbWUtPlNldHVwUGxvdCgkYVBsb3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBBZGQgdGV4dCBvYmplY3QgdG8gdGhlIGdyYXBoCiAgICBmdW5jdGlvbiBBZGRUZXh0KCRhVHh0LCRhVG9ZMj1mYWxzZSkgewogICAgICAgIGlmKCAkYVR4dCA9PSBudWxsICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAxNCk7Ly8oIkdyYXBoOjpBZGRUZXh0KCkgWW91IHRyaWVkIHRvIGFkZCBhIG51bGwgdGV4dCB0byB0aGUgZ3JhcGguIik7CiAgICAgICAgfQogICAgICAgIGlmKCAkYVRvWTIgKSB7CiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkYVR4dCkgKSB7CiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkYVR4dCk7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnkydGV4dHNbXT0kYVR4dFskaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+eTJ0ZXh0c1tdID0gJGFUeHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkYVR4dCkgKSB7CiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkYVR4dCk7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnRleHRzW109JGFUeHRbJGldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHRoaXMtPnRleHRzW10gPSAkYVR4dDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBBZGQgYSBsaW5lIG9iamVjdCAoY2xhc3MgUGxvdExpbmUpIHRvIHRoZSBncmFwaAogICAgZnVuY3Rpb24gQWRkTGluZSgkYUxpbmUsJGFUb1kyPWZhbHNlKSB7CiAgICAgICAgaWYoICRhTGluZSA9PSBudWxsICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAxNSk7Ly8oIkdyYXBoOjpBZGRMaW5lKCkgWW91IHRyaWVkIHRvIGFkZCBhIG51bGwgbGluZSB0byB0aGUgZ3JhcGguIik7CiAgICAgICAgfQoKICAgICAgICBpZiggJGFUb1kyICkgewogICAgICAgICAgICBpZiggaXNfYXJyYXkoJGFMaW5lKSApIHsKICAgICAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8IGNvdW50KCRhTGluZSk7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8kdGhpcy0+eTJsaW5lc1tdPSRhTGluZVskaV07CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnkycGxvdHNbXT0kYUxpbmVbJGldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8kdGhpcy0+eTJsaW5lc1tdID0gJGFMaW5lOwogICAgICAgICAgICAgICAgJHRoaXMtPnkycGxvdHNbXT0kYUxpbmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCBpc19hcnJheSgkYUxpbmUpICkgewogICAgICAgICAgICAgICAgZm9yKCRpPTA7ICRpPGNvdW50KCRhTGluZSk7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8kdGhpcy0+bGluZXNbXT0kYUxpbmVbJGldOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1tdPSRhTGluZVskaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyR0aGlzLT5saW5lc1tdID0gJGFMaW5lOwogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzW10gPSAkYUxpbmU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gQWRkIHZlcnRpY2FsIG9yIGhvcml6b250YWwgYmFuZAogICAgZnVuY3Rpb24gQWRkQmFuZCgkYUJhbmQsJGFUb1kyPWZhbHNlKSB7CiAgICAgICAgaWYoICRhQmFuZCA9PSBudWxsICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAxNik7Ly8oIiBHcmFwaDo6QWRkQmFuZCgpIFlvdSB0cmllZCB0byBhZGQgYSBudWxsIGJhbmQgdG8gdGhlIGdyYXBoLiIpOwogICAgICAgIH0KCiAgICAgICAgaWYoICRhVG9ZMiApIHsKICAgICAgICAgICAgaWYoIGlzX2FycmF5KCRhQmFuZCkgKSB7CiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkYUJhbmQpOyArKyRpICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT55MmJhbmRzW10gPSAkYUJhbmRbJGldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHRoaXMtPnkyYmFuZHNbXSA9ICRhQmFuZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoIGlzX2FycmF5KCRhQmFuZCkgKSB7CiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkYUJhbmQpOyArKyRpICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5iYW5kc1tdID0gJGFCYW5kWyRpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICR0aGlzLT5iYW5kc1tdID0gJGFCYW5kOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFNldFBsb3RHcmFkaWVudCgkYUZyb209J25hdnknLCRhVG89J3NpbHZlcicsJGFHcmFkVHlwZT0yKSB7CiAgICAgICAgJHRoaXMtPnBsb3RfZ3JhZHR5cGU9JGFHcmFkVHlwZTsKICAgICAgICAkdGhpcy0+cGxvdF9ncmFkZnJvbSA9ICRhRnJvbTsKICAgICAgICAkdGhpcy0+cGxvdF9ncmFkdG8gPSAkYVRvOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEJhY2tncm91bmRHcmFkaWVudCgkYUZyb209J25hdnknLCRhVG89J3NpbHZlcicsJGFHcmFkVHlwZT0yLCRhU3R5bGU9QkdSQURfRlJBTUUpIHsKICAgICAgICAkdGhpcy0+YmtnX2dyYWR0eXBlPSRhR3JhZFR5cGU7CiAgICAgICAgJHRoaXMtPmJrZ19ncmFkc3R5bGU9JGFTdHlsZTsKICAgICAgICAkdGhpcy0+YmtnX2dyYWRmcm9tID0gJGFGcm9tOwogICAgICAgICR0aGlzLT5ia2dfZ3JhZHRvID0gJGFUbzsKICAgIH0KCiAgICAvLyBTZXQgYSBjb3VudHJ5IGZsYWcgaW4gdGhlIGJhY2tncm91bmQKICAgIGZ1bmN0aW9uIFNldEJhY2tncm91bmRDRmxhZygkYU5hbWUsJGFCZ1R5cGU9QkdJTUdfRklMTFBMT1QsJGFNaXg9MTAwKSB7CiAgICAgICAgJHRoaXMtPmJhY2tncm91bmRfY2ZsYWcgPSAkYU5hbWU7CiAgICAgICAgJHRoaXMtPmJhY2tncm91bmRfY2ZsYWdfdHlwZSA9ICRhQmdUeXBlOwogICAgICAgICR0aGlzLT5iYWNrZ3JvdW5kX2NmbGFnX21peCA9ICRhTWl4OwogICAgfQoKICAgIC8vIEFsaWFzIGZvciB0aGUgYWJvdmUgbWV0aG9kCiAgICBmdW5jdGlvbiBTZXRCYWNrZ3JvdW5kQ291bnRyeUZsYWcoJGFOYW1lLCRhQmdUeXBlPUJHSU1HX0ZJTExQTE9ULCRhTWl4PTEwMCkgewogICAgICAgICR0aGlzLT5iYWNrZ3JvdW5kX2NmbGFnID0gJGFOYW1lOwogICAgICAgICR0aGlzLT5iYWNrZ3JvdW5kX2NmbGFnX3R5cGUgPSAkYUJnVHlwZTsKICAgICAgICAkdGhpcy0+YmFja2dyb3VuZF9jZmxhZ19taXggPSAkYU1peDsKICAgIH0KCgogICAgLy8gU3BlY2lmeSBhIGJhY2tncm91bmQgaW1hZ2UKICAgIGZ1bmN0aW9uIFNldEJhY2tncm91bmRJbWFnZSgkYUZpbGVOYW1lLCRhQmdUeXBlPUJHSU1HX0ZJTExQTE9ULCRhSW1nRm9ybWF0PSdhdXRvJykgewoKICAgICAgICAvLyBHZXQgZXh0ZW5zaW9uIHRvIGRldGVybWluZSBpbWFnZSB0eXBlCiAgICAgICAgaWYoICRhSW1nRm9ybWF0ID09ICdhdXRvJyApIHsKICAgICAgICAgICAgJGUgPSBleHBsb2RlKCcuJywkYUZpbGVOYW1lKTsKICAgICAgICAgICAgaWYoICEkZSApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDE4LCRhRmlsZU5hbWUpOy8vKCdJbmNvcnJlY3QgZmlsZSBuYW1lIGZvciBHcmFwaDo6U2V0QmFja2dyb3VuZEltYWdlKCkgOiAnLiRhRmlsZU5hbWUuJyBNdXN0IGhhdmUgYSB2YWxpZCBpbWFnZSBleHRlbnNpb24gKGpwZyxnaWYscG5nKSB3aGVuIHVzaW5nIGF1dG9kZXRlY3Rpb24gb2YgaW1hZ2UgdHlwZScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdmFsaWRfZm9ybWF0cyA9IGFycmF5KCdwbmcnLCAnanBnJywgJ2dpZicpOwogICAgICAgICAgICAkYUltZ0Zvcm1hdCA9IHN0cnRvbG93ZXIoJGVbY291bnQoJGUpLTFdKTsKICAgICAgICAgICAgaWYgKCRhSW1nRm9ybWF0ID09ICdqcGVnJykgIHsKICAgICAgICAgICAgICAgICRhSW1nRm9ybWF0ID0gJ2pwZyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICghaW5fYXJyYXkoJGFJbWdGb3JtYXQsICR2YWxpZF9mb3JtYXRzKSApICB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAxOSwkYUltZ0Zvcm1hdCk7Ly8oJ1Vua25vd24gZmlsZSBleHRlbnNpb24gKCRhSW1nRm9ybWF0KSBpbiBHcmFwaDo6U2V0QmFja2dyb3VuZEltYWdlKCkgZm9yIGZpbGVuYW1lOiAnLiRhRmlsZU5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+YmFja2dyb3VuZF9pbWFnZSA9ICRhRmlsZU5hbWU7CiAgICAgICAgJHRoaXMtPmJhY2tncm91bmRfaW1hZ2VfdHlwZT0kYUJnVHlwZTsKICAgICAgICAkdGhpcy0+YmFja2dyb3VuZF9pbWFnZV9mb3JtYXQ9JGFJbWdGb3JtYXQ7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0QmFja2dyb3VuZEltYWdlTWl4KCRhTWl4KSB7CiAgICAgICAgJHRoaXMtPmJhY2tncm91bmRfaW1hZ2VfbWl4ID0gJGFNaXggOwogICAgfQoKICAgIC8vIEFkanVzdCBiYWNrZ3JvdW5kIGltYWdlIHBvc2l0aW9uCiAgICBmdW5jdGlvbiBTZXRCYWNrZ3JvdW5kSW1hZ2VQb3MoJGFYcG9zLCRhWXBvcykgewogICAgICAgICR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX3hwb3MgPSAkYVhwb3MgOwogICAgICAgICR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX3lwb3MgPSAkYVlwb3MgOwogICAgfQoKICAgIC8vIFNwZWNpZnkgYXhpcyBzdHlsZSAoYm94ZWQgb3Igc2luZ2xlKQogICAgZnVuY3Rpb24gU2V0QXhpc1N0eWxlKCRhU3R5bGUpIHsKICAgICAgICAkdGhpcy0+aUF4aXNTdHlsZSA9ICRhU3R5bGUgOwogICAgfQoKICAgIC8vIFNldCBhIGZyYW1lIGFyb3VuZCB0aGUgcGxvdCBhcmVhCiAgICBmdW5jdGlvbiBTZXRCb3goJGFEcmF3UGxvdEZyYW1lPXRydWUsJGFQbG90RnJhbWVDb2xvcj1hcnJheSgwLDAsMCksJGFQbG90RnJhbWVXZWlnaHQ9MSkgewogICAgICAgICR0aGlzLT5ib3hlZCA9ICRhRHJhd1Bsb3RGcmFtZTsKICAgICAgICAkdGhpcy0+Ym94X3dlaWdodCA9ICRhUGxvdEZyYW1lV2VpZ2h0OwogICAgICAgICR0aGlzLT5ib3hfY29sb3IgPSAkYVBsb3RGcmFtZUNvbG9yOwogICAgfQoKICAgIC8vIFNwZWNpZnkgY29sb3IgZm9yIHRoZSBwbG90YXJlYSAobm90IHRoZSBtYXJnaW5zKQogICAgZnVuY3Rpb24gU2V0Q29sb3IoJGFDb2xvcikgewogICAgICAgICR0aGlzLT5wbG90YXJlYV9jb2xvcj0kYUNvbG9yOwogICAgfQoKICAgIC8vIFNwZWNpZnkgY29sb3IgZm9yIHRoZSBtYXJnaW5zIChhbGwgYXJlYXMgb3V0c2lkZSB0aGUgcGxvdGFyZWEpCiAgICBmdW5jdGlvbiBTZXRNYXJnaW5Db2xvcigkYUNvbG9yKSB7CiAgICAgICAgJHRoaXMtPm1hcmdpbl9jb2xvcj0kYUNvbG9yOwogICAgfQoKICAgIC8vIFNldCBhIGZyYW1lIGFyb3VuZCB0aGUgZW50aXJlIGltYWdlCiAgICBmdW5jdGlvbiBTZXRGcmFtZSgkYURyYXdJbWdGcmFtZT10cnVlLCRhSW1nRnJhbWVDb2xvcj1hcnJheSgwLDAsMCksJGFJbWdGcmFtZVdlaWdodD0xKSB7CiAgICAgICAgJHRoaXMtPmRvZnJhbWUgPSAkYURyYXdJbWdGcmFtZTsKICAgICAgICAkdGhpcy0+ZnJhbWVfY29sb3IgPSAkYUltZ0ZyYW1lQ29sb3I7CiAgICAgICAgJHRoaXMtPmZyYW1lX3dlaWdodCA9ICRhSW1nRnJhbWVXZWlnaHQ7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0RnJhbWVCZXZlbCgkYURlcHRoPTMsJGFCb3JkZXI9ZmFsc2UsJGFCb3JkZXJDb2xvcj0nYmxhY2snLCRhQ29sb3IxPSd3aGl0ZUAwLjQnLCRhQ29sb3IyPSdkYXJrZ3JheUAwLjQnLCRhRmxnPXRydWUpIHsKICAgICAgICAkdGhpcy0+ZnJhbWViZXZlbCA9ICRhRmxnIDsKICAgICAgICAkdGhpcy0+ZnJhbWViZXZlbGRlcHRoID0gJGFEZXB0aCA7CiAgICAgICAgJHRoaXMtPmZyYW1lYmV2ZWxib3JkZXIgPSAkYUJvcmRlciA7CiAgICAgICAgJHRoaXMtPmZyYW1lYmV2ZWxib3JkZXJjb2xvciA9ICRhQm9yZGVyQ29sb3IgOwogICAgICAgICR0aGlzLT5mcmFtZWJldmVsY29sb3IxID0gJGFDb2xvcjEgOwogICAgICAgICR0aGlzLT5mcmFtZWJldmVsY29sb3IyID0gJGFDb2xvcjIgOwoKICAgICAgICAkdGhpcy0+ZG9zaGFkb3cgPSBmYWxzZSA7CiAgICB9CgogICAgLy8gU2V0IHRoZSBzaGFkb3cgYXJvdW5kIHRoZSB3aG9sZSBpbWFnZQogICAgZnVuY3Rpb24gU2V0U2hhZG93KCRhU2hvd1NoYWRvdz10cnVlLCRhU2hhZG93V2lkdGg9NSwkYVNoYWRvd0NvbG9yPSdkYXJrZ3JheScpIHsKICAgICAgICAkdGhpcy0+ZG9zaGFkb3cgPSAkYVNob3dTaGFkb3c7CiAgICAgICAgJHRoaXMtPnNoYWRvd19jb2xvciA9ICRhU2hhZG93Q29sb3I7CiAgICAgICAgJHRoaXMtPnNoYWRvd193aWR0aCA9ICRhU2hhZG93V2lkdGg7CiAgICAgICAgJHRoaXMtPmZvb3Rlci0+aUJvdHRvbU1hcmdpbiArPSAkYVNoYWRvd1dpZHRoOwogICAgICAgICR0aGlzLT5mb290ZXItPmlSaWdodE1hcmdpbiArPSAkYVNoYWRvd1dpZHRoOwogICAgfQoKICAgIC8vIFNwZWNpZnkgeCx5IHNjYWxlLiBOb3RlIHRoYXQgaWYgeW91IG1hbnVhbGx5IHNwZWNpZnkgdGhlIHNjYWxlCiAgICAvLyB5b3UgbXVzdCBhbHNvIHNwZWNpZnkgdGhlIHRpY2sgZGlzdGFuY2Ugd2l0aCBhIGNhbGwgdG8gVGlja3M6OlNldCgpCiAgICBmdW5jdGlvbiBTZXRTY2FsZSgkYUF4aXNUeXBlLCRhWU1pbj0xLCRhWU1heD0xLCRhWE1pbj0xLCRhWE1heD0xKSB7CiAgICAgICAgJHRoaXMtPmF4dHlwZSA9ICRhQXhpc1R5cGU7CgogICAgICAgIGlmKCAkYVlNYXggPCAkYVlNaW4gfHwgJGFYTWF4IDwgJGFYTWluICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAyMCk7Ly8oJ0dyYXBoOjpTZXRTY2FsZSgpOiBTcGVjaWZpZWQgTWF4IHZhbHVlIG11c3QgYmUgbGFyZ2VyIHRoYW4gdGhlIHNwZWNpZmllZCBNaW4gdmFsdWUuJyk7CiAgICAgICAgfQoKICAgICAgICAkeXQ9c3Vic3RyKCRhQXhpc1R5cGUsLTMsMyk7CiAgICAgICAgaWYoICR5dCA9PSAnbGluJyApIHsKICAgICAgICAgICAgJHRoaXMtPnlzY2FsZSA9IG5ldyBMaW5lYXJTY2FsZSgkYVlNaW4sJGFZTWF4KTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkeXQgPT0gJ2ludCcgKSB7CiAgICAgICAgICAgICR0aGlzLT55c2NhbGUgPSBuZXcgTGluZWFyU2NhbGUoJGFZTWluLCRhWU1heCk7CiAgICAgICAgICAgICR0aGlzLT55c2NhbGUtPlNldEludFNjYWxlKCk7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggJHl0ID09ICdsb2cnICkgewogICAgICAgICAgICAkdGhpcy0+eXNjYWxlID0gbmV3IExvZ1NjYWxlKCRhWU1pbiwkYVlNYXgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMjEsJGFBeGlzVHlwZSk7Ly8oIlVua25vd24gc2NhbGUgc3BlY2lmaWNhdGlvbiBmb3IgWS1zY2FsZS4gKCRhQXhpc1R5cGUpIik7CiAgICAgICAgfQoKICAgICAgICAkeHQ9c3Vic3RyKCRhQXhpc1R5cGUsMCwzKTsKICAgICAgICBpZiggJHh0ID09ICdsaW4nIHx8ICR4dCA9PSAndGV4JyApIHsKICAgICAgICAgICAgJHRoaXMtPnhzY2FsZSA9IG5ldyBMaW5lYXJTY2FsZSgkYVhNaW4sJGFYTWF4LCd4Jyk7CiAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPnRleHRzY2FsZSA9ICgkeHQgPT0gJ3RleCcpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR4dCA9PSAnaW50JyApIHsKICAgICAgICAgICAgJHRoaXMtPnhzY2FsZSA9IG5ldyBMaW5lYXJTY2FsZSgkYVhNaW4sJGFYTWF4LCd4Jyk7CiAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPlNldEludFNjYWxlKCk7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggJHh0ID09ICdkYXQnICkgewogICAgICAgICAgICAkdGhpcy0+eHNjYWxlID0gbmV3IERhdGVTY2FsZSgkYVhNaW4sJGFYTWF4LCd4Jyk7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggJHh0ID09ICdsb2cnICkgewogICAgICAgICAgICAkdGhpcy0+eHNjYWxlID0gbmV3IExvZ1NjYWxlKCRhWE1pbiwkYVhNYXgsJ3gnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDIyLCRhQXhpc1R5cGUpOy8vKCIgVW5rbm93biBzY2FsZSBzcGVjaWZpY2F0aW9uIGZvciBYLXNjYWxlLiAoJGFBeGlzVHlwZSkiKTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT54YXhpcyA9IG5ldyBBeGlzKCR0aGlzLT5pbWcsJHRoaXMtPnhzY2FsZSk7CiAgICAgICAgJHRoaXMtPnlheGlzID0gbmV3IEF4aXMoJHRoaXMtPmltZywkdGhpcy0+eXNjYWxlKTsKICAgICAgICAkdGhpcy0+eGdyaWQgPSBuZXcgR3JpZCgkdGhpcy0+eGF4aXMpOwogICAgICAgICR0aGlzLT55Z3JpZCA9IG5ldyBHcmlkKCR0aGlzLT55YXhpcyk7CiAgICAgICAgJHRoaXMtPnlncmlkLT5TaG93KCk7CgoKICAgICAgICBpZiAoISR0aGlzLT5pc1J1bm5pbmdDbGVhcikgewogICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FBeGlzVHlwZSddID0gJGFBeGlzVHlwZTsKICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhWU1pbiddID0gJGFZTWluOwogICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FZTWF4J10gPSAkYVlNYXg7CiAgICAgICAgICAgICR0aGlzLT5pbnB1dFZhbHVlc1snYVhNaW4nXSA9ICRhWE1pbjsKICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhWE1heCddID0gJGFYTWF4OwoKICAgICAgICAgICAgaWYgKCR0aGlzLT5ncmFwaF90aGVtZSkgewogICAgICAgICAgICAgICAgJHRoaXMtPmdyYXBoX3RoZW1lLT5BcHBseUdyYXBoKCR0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmlzQWZ0ZXJTZXRTY2FsZSA9IHRydWU7CiAgICB9CgogICAgLy8gU3BlY2lmeSBzZWNvbmRhcnkgWSBzY2FsZQogICAgZnVuY3Rpb24gU2V0WTJTY2FsZSgkYUF4aXNUeXBlPSdsaW4nLCRhWTJNaW49MSwkYVkyTWF4PTEpIHsKICAgICAgICBpZiggJGFBeGlzVHlwZSA9PSAnbGluJyApIHsKICAgICAgICAgICAgJHRoaXMtPnkyc2NhbGUgPSBuZXcgTGluZWFyU2NhbGUoJGFZMk1pbiwkYVkyTWF4KTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkYUF4aXNUeXBlID09ICdpbnQnICkgewogICAgICAgICAgICAkdGhpcy0+eTJzY2FsZSA9IG5ldyBMaW5lYXJTY2FsZSgkYVkyTWluLCRhWTJNYXgpOwogICAgICAgICAgICAkdGhpcy0+eTJzY2FsZS0+U2V0SW50U2NhbGUoKTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkYUF4aXNUeXBlID09ICdsb2cnICkgewogICAgICAgICAgICAkdGhpcy0+eTJzY2FsZSA9IG5ldyBMb2dTY2FsZSgkYVkyTWluLCRhWTJNYXgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMjMsJGFBeGlzVHlwZSk7Ly8oIkpwR3JhcGg6IFVuc3VwcG9ydGVkIFkyIGF4aXMgdHlwZTogJGFBeGlzVHlwZVxuTXVzdCBiZSBvbmUgb2YgKGxpbixsb2csaW50KSIpOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPnkyYXhpcyA9IG5ldyBBeGlzKCR0aGlzLT5pbWcsJHRoaXMtPnkyc2NhbGUpOwogICAgICAgICR0aGlzLT55MmF4aXMtPnNjYWxlLT50aWNrcy0+U2V0RGlyZWN0aW9uKFNJREVfTEVGVCk7CiAgICAgICAgJHRoaXMtPnkyYXhpcy0+U2V0TGFiZWxTaWRlKFNJREVfUklHSFQpOwogICAgICAgICR0aGlzLT55MmF4aXMtPlNldFBvcygnbWF4Jyk7CiAgICAgICAgJHRoaXMtPnkyYXhpcy0+U2V0VGl0bGVTaWRlKFNJREVfUklHSFQpOwoKICAgICAgICAvLyBEZWFmdWx0IHBvc2l0aW9uIGlzIHRoZSBtYXggeC12YWx1ZQogICAgICAgICR0aGlzLT55MmdyaWQgPSBuZXcgR3JpZCgkdGhpcy0+eTJheGlzKTsKCiAgICAgICAgaWYgKCR0aGlzLT5ncmFwaF90aGVtZSkgewogICAgICAgICAgJHRoaXMtPmdyYXBoX3RoZW1lLT5BcHBseUdyYXBoKCR0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gU2V0IHRoZSBkZWx0YSBwb3NpdGlvbiAoaW4gcGl4ZWxzKSBiZXR3ZWVuIHRoZSBtdWx0aXBsZSBZLWF4aXMKICAgIGZ1bmN0aW9uIFNldFlEZWx0YURpc3QoJGFEaXN0KSB7CiAgICAgICAgJHRoaXMtPmlZQXhpc0RlbHRhUG9zID0gJGFEaXN0OwogICAgfQoKICAgIC8vIFNwZWNpZnkgc2Vjb25kYXJ5IFkgc2NhbGUKICAgIGZ1bmN0aW9uIFNldFlTY2FsZSgkYU4sJGFBeGlzVHlwZT0ibGluIiwkYVlNaW49MSwkYVlNYXg9MSkgewoKICAgICAgICBpZiggJGFBeGlzVHlwZSA9PSAnbGluJyApIHsKICAgICAgICAgICAgJHRoaXMtPnluc2NhbGVbJGFOXSA9IG5ldyBMaW5lYXJTY2FsZSgkYVlNaW4sJGFZTWF4KTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkYUF4aXNUeXBlID09ICdpbnQnICkgewogICAgICAgICAgICAkdGhpcy0+eW5zY2FsZVskYU5dID0gbmV3IExpbmVhclNjYWxlKCRhWU1pbiwkYVlNYXgpOwogICAgICAgICAgICAkdGhpcy0+eW5zY2FsZVskYU5dLT5TZXRJbnRTY2FsZSgpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICRhQXhpc1R5cGUgPT0gJ2xvZycgKSB7CiAgICAgICAgICAgICR0aGlzLT55bnNjYWxlWyRhTl0gPSBuZXcgTG9nU2NhbGUoJGFZTWluLCRhWU1heCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAyNCwkYUF4aXNUeXBlKTsvLygiSnBHcmFwaDogVW5zdXBwb3J0ZWQgWSBheGlzIHR5cGU6ICRhQXhpc1R5cGVcbk11c3QgYmUgb25lIG9mIChsaW4sbG9nLGludCkiKTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT55bmF4aXNbJGFOXSA9IG5ldyBBeGlzKCR0aGlzLT5pbWcsJHRoaXMtPnluc2NhbGVbJGFOXSk7CiAgICAgICAgJHRoaXMtPnluYXhpc1skYU5dLT5zY2FsZS0+dGlja3MtPlNldERpcmVjdGlvbihTSURFX0xFRlQpOwogICAgICAgICR0aGlzLT55bmF4aXNbJGFOXS0+U2V0TGFiZWxTaWRlKFNJREVfUklHSFQpOwoKICAgICAgICBpZiAoJHRoaXMtPmdyYXBoX3RoZW1lKSB7CiAgICAgICAgICAgICR0aGlzLT5ncmFwaF90aGVtZS0+QXBwbHlHcmFwaCgkdGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFNwZWNpZnkgZGVuc2l0eSBvZiB0aWNrcyB3aGVuIGF1dG9zY2FsaW5nICdub3JtYWwnLCAnZGVuc2UnLCAnc3BhcnNlJywgJ3ZlcnlzcGFyc2UnCiAgICAvLyBUaGUgZGl2aWRpbmcgZmFjdG9yIGhhdmUgYmVlbiBkZXRlcm1pbmVkIGhldXJpc3RpY2FsbHkgYWNjb3JkaW5nIHRvIG15IGFlc3RoZXRpYwogICAgLy8gc2Vuc2UgKG9yIGxhY2sgb2ZmKSB5Lm0ubS52ICEKICAgIGZ1bmN0aW9uIFNldFRpY2tEZW5zaXR5KCRhWURlbnNpdHk9VElDS0RfTk9STUFMLCRhWERlbnNpdHk9VElDS0RfTk9STUFMKSB7CiAgICAgICAgJHRoaXMtPnh0aWNrX2ZhY3Rvcj0zMDsKICAgICAgICAkdGhpcy0+eXRpY2tfZmFjdG9yPTI1OwogICAgICAgIHN3aXRjaCggJGFZRGVuc2l0eSApIHsKICAgICAgICAgICAgY2FzZSBUSUNLRF9ERU5TRToKICAgICAgICAgICAgICAgICR0aGlzLT55dGlja19mYWN0b3I9MTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBUSUNLRF9OT1JNQUw6CiAgICAgICAgICAgICAgICAkdGhpcy0+eXRpY2tfZmFjdG9yPTI1OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVElDS0RfU1BBUlNFOgogICAgICAgICAgICAgICAgJHRoaXMtPnl0aWNrX2ZhY3Rvcj00MDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFRJQ0tEX1ZFUllTUEFSU0U6CiAgICAgICAgICAgICAgICAkdGhpcy0+eXRpY2tfZmFjdG9yPTEwMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMjUsJGRlbnN5KTsvLygiSnBHcmFwaDogVW5zdXBwb3J0ZWQgVGljayBkZW5zaXR5OiAkZGVuc3kiKTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoKCAkYVhEZW5zaXR5ICkgewogICAgICAgICAgICBjYXNlIFRJQ0tEX0RFTlNFOgogICAgICAgICAgICAgICAgJHRoaXMtPnh0aWNrX2ZhY3Rvcj0xNTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFRJQ0tEX05PUk1BTDoKICAgICAgICAgICAgICAgICR0aGlzLT54dGlja19mYWN0b3I9MzA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBUSUNLRF9TUEFSU0U6CiAgICAgICAgICAgICAgICAkdGhpcy0+eHRpY2tfZmFjdG9yPTQ1OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgVElDS0RfVkVSWVNQQVJTRToKICAgICAgICAgICAgICAgICR0aGlzLT54dGlja19mYWN0b3I9NjA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDI1LCRkZW5zeCk7Ly8oIkpwR3JhcGg6IFVuc3VwcG9ydGVkIFRpY2sgZGVuc2l0eTogJGRlbnN4Iik7CiAgICAgICAgfQogICAgfQoKCiAgICAvLyBHZXQgYSBzdHJpbmcgb2YgYWxsIGltYWdlIG1hcCBhcmVhcwogICAgZnVuY3Rpb24gR2V0Q1NJTWFyZWFzKCkgewogICAgICAgIGlmKCAhJHRoaXMtPmlIYXNTdHJva2VkICkgewogICAgICAgICAgICAkdGhpcy0+U3Ryb2tlKF9DU0lNX1NQRUNJQUxGSUxFKTsKICAgICAgICB9CgogICAgICAgICRjc2ltID0gJHRoaXMtPnRpdGxlLT5HZXRDU0lNQXJlYXMoKTsKICAgICAgICAkY3NpbSAuPSAkdGhpcy0+c3VidGl0bGUtPkdldENTSU1BcmVhcygpOwogICAgICAgICRjc2ltIC49ICR0aGlzLT5zdWJzdWJ0aXRsZS0+R2V0Q1NJTUFyZWFzKCk7CiAgICAgICAgJGNzaW0gLj0gJHRoaXMtPmxlZ2VuZC0+R2V0Q1NJTUFyZWFzKCk7CgogICAgICAgIGlmKCAkdGhpcy0+eTJheGlzICE9IE5VTEwgKSB7CiAgICAgICAgICAgICRjc2ltIC49ICR0aGlzLT55MmF4aXMtPnRpdGxlLT5HZXRDU0lNQXJlYXMoKTsKICAgICAgICB9CgogICAgICAgIGlmKCAkdGhpcy0+dGV4dHMgIT0gbnVsbCApIHsKICAgICAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+dGV4dHMpOwogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgICAgICRjc2ltIC49ICR0aGlzLT50ZXh0c1skaV0tPkdldENTSU1BcmVhcygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPnkydGV4dHMgIT0gbnVsbCAmJiAkdGhpcy0+eTJzY2FsZSAhPSBudWxsICkgewogICAgICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT55MnRleHRzKTsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAkY3NpbSAuPSAkdGhpcy0+eTJ0ZXh0c1skaV0tPkdldENTSU1BcmVhcygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPnlheGlzICE9IG51bGwgJiYgJHRoaXMtPnhheGlzICE9IG51bGwgKSB7CiAgICAgICAgICAgICRjc2ltIC49ICR0aGlzLT55YXhpcy0+dGl0bGUtPkdldENTSU1BcmVhcygpOwogICAgICAgICAgICAkY3NpbSAuPSAkdGhpcy0+eGF4aXMtPnRpdGxlLT5HZXRDU0lNQXJlYXMoKTsKICAgICAgICB9CgogICAgICAgICRuID0gY291bnQoJHRoaXMtPnBsb3RzKTsKICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgICRjc2ltIC49ICR0aGlzLT5wbG90c1skaV0tPkdldENTSU1hcmVhcygpOwogICAgICAgIH0KCiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+eTJwbG90cyk7CiAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAkY3NpbSAuPSAkdGhpcy0+eTJwbG90c1skaV0tPkdldENTSU1hcmVhcygpOwogICAgICAgIH0KCiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+eW5heGlzKTsKICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgICRtID0gY291bnQoJHRoaXMtPnlucGxvdHNbJGldKTsKICAgICAgICAgICAgZm9yKCRqPTA7ICRqIDwgJG07ICsrJGogKSB7CiAgICAgICAgICAgICAgICAkY3NpbSAuPSAkdGhpcy0+eW5wbG90c1skaV1bJGpdLT5HZXRDU0lNYXJlYXMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+aVRhYmxlcyk7CiAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAkY3NpbSAuPSAkdGhpcy0+aVRhYmxlc1skaV0tPkdldENTSU1hcmVhcygpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRjc2ltOwogICAgfQoKICAgIC8vIEdldCBhIGNvbXBsZXRlIDxNQVA+Li48L01BUD4gdGFnIGZvciB0aGUgZmluYWwgaW1hZ2UgbWFwCiAgICBmdW5jdGlvbiBHZXRIVE1MSW1hZ2VNYXAoJGFNYXBOYW1lKSB7CiAgICAgICAgJGltID0gIjxtYXAgbmFtZT1cIiRhTWFwTmFtZVwiIGlkPVwiJGFNYXBOYW1lXCIgPlxuIjsKICAgICAgICAkaW0gLj0gJHRoaXMtPkdldENTSU1hcmVhcygpOwogICAgICAgICRpbSAuPSAiPC9tYXA+IjsKICAgICAgICByZXR1cm4gJGltOwogICAgfQoKICAgIGZ1bmN0aW9uIENoZWNrQ1NJTUNhY2hlKCRhQ2FjaGVOYW1lLCRhVGltZU91dD02MCkgewogICAgICAgIGdsb2JhbCAkX1NFUlZFUjsKCiAgICAgICAgaWYoICRhQ2FjaGVOYW1lPT0nYXV0bycgKSB7CiAgICAgICAgICAgICRhQ2FjaGVOYW1lPWJhc2VuYW1lKCRfU0VSVkVSWydQSFBfU0VMRiddKTsKICAgICAgICB9CgogICAgICAgICR1cmxhcmcgPSAkdGhpcy0+R2V0VVJMQXJndW1lbnRzKCk7CiAgICAgICAgJHRoaXMtPmNzaW1jYWNoZW5hbWUgPSBDU0lNQ0FDSEVfRElSLiRhQ2FjaGVOYW1lLiR1cmxhcmc7CiAgICAgICAgJHRoaXMtPmNzaW1jYWNoZXRpbWVvdXQgPSAkYVRpbWVPdXQ7CgogICAgICAgIC8vIEZpcnN0IGRldGVybWluZSBpZiB3ZSBuZWVkIHRvIGNoZWNrIGZvciBhIGNhY2hlZCB2ZXJzaW9uCiAgICAgICAgLy8gVGhpcyBkaWZmZXJzIGZyb20gdGhlIHN0YW5kYXJkIGNhY2hlIGluIHRoZSBzZW5zZSB0aGF0IHRoZQogICAgICAgIC8vIGltYWdlIGFuZCBDU0lNIG1hcCBIVE1MIGZpbGUgaXMgd3JpdHRlbiByZWxhdGl2ZSB0byB0aGUgZGlyZWN0b3J5CiAgICAgICAgLy8gdGhlIHNjcmlwdCBleGVjdXRlcyBpbiBhbmQgbm90IHRoZSBzcGVjaWZpZWQgY2FjaGUgZGlyZWN0b3J5LgogICAgICAgIC8vIFRoZSByZWFzb24gZm9yIHRoaXMgaXMgdGhhdCB0aGUgY2FjaGUgZGlyZWN0b3J5IGlzIG5vdCBuZWNlc3NhcmlseQogICAgICAgIC8vIGFjY2Vzc2libGUgZnJvbSB0aGUgSFRUUCBzZXJ2ZXIuCiAgICAgICAgaWYoICR0aGlzLT5jc2ltY2FjaGVuYW1lICE9ICcnICkgewogICAgICAgICAgICAkZGlyID0gZGlybmFtZSgkdGhpcy0+Y3NpbWNhY2hlbmFtZSk7CiAgICAgICAgICAgICRiYXNlID0gYmFzZW5hbWUoJHRoaXMtPmNzaW1jYWNoZW5hbWUpOwogICAgICAgICAgICAkYmFzZSA9IHN0cnRvaygkYmFzZSwnLicpOwogICAgICAgICAgICAkc3VmZml4ID0gc3RydG9rKCcuJyk7CiAgICAgICAgICAgICRiYXNlY3NpbSA9ICRkaXIuJy8nLiRiYXNlLic\/Jy4kdXJsYXJnLidfY3NpbV8uaHRtbCc7CiAgICAgICAgICAgICRiYXNlaW1nID0gJGRpci4nLycuJGJhc2UuJz8nLiR1cmxhcmcuJy4nLiR0aGlzLT5pbWctPmltZ19mb3JtYXQ7CgogICAgICAgICAgICAkdGltZWRvdXQ9ZmFsc2U7CiAgICAgICAgICAgIC8vIERvZXMgaXQgZXhpc3QgYXQgYWxsID8KCiAgICAgICAgICAgIGlmKCBmaWxlX2V4aXN0cygkYmFzZWNzaW0pICYmIGZpbGVfZXhpc3RzKCRiYXNlaW1nKSApIHsKICAgICAgICAgICAgICAgIC8vIENoZWNrIHRoYXQgaXQgaGFzbid0IHRpbWVkIG91dAogICAgICAgICAgICAgICAgJGRpZmY9dGltZSgpLWZpbGVtdGltZSgkYmFzZWNzaW0pOwogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5jc2ltY2FjaGV0aW1lb3V0PjAgJiYgKCRkaWZmID4gJHRoaXMtPmNzaW1jYWNoZXRpbWVvdXQqNjApICkgewogICAgICAgICAgICAgICAgICAgICR0aW1lZG91dD10cnVlOwogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJGJhc2Vjc2ltKTsKICAgICAgICAgICAgICAgICAgICBAdW5saW5rKCRiYXNlaW1nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgkZmggPSBAZm9wZW4oJGJhc2Vjc2ltLCAiciIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZwYXNzdGhydSgkZmgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDI3LCRiYXNlY3NpbSk7Ly8oIiBDYW4ndCBvcGVuIGNhY2hlZCBDU0lNIFwiJGJhc2Vjc2ltXCIgZm9yIHJlYWRpbmcuIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBCdWlsZCB0aGUgYXJndW1lbnQgc3RyaW5nIHRvIGJlIHVzZWQgd2l0aCB0aGUgY3NpbSBpbWFnZXMKICAgIHN0YXRpYyBmdW5jdGlvbiBHZXRVUkxBcmd1bWVudHMoJGFBZGRSZWN1cnNpdmVCbG9ja2VyPWZhbHNlKSB7CgogICAgICAgIGlmKCAkYUFkZFJlY3Vyc2l2ZUJsb2NrZXIgKSB7CiAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBKUEdSQVBIIGludGVybmFsIGRlZmluZWQgdGhhdCBwcmV2ZW50cwogICAgICAgICAgICAvLyB1cyBmcm9tIHJlY3Vyc2l2ZWx5IGNvbWluZyBoZXJlIGFnYWluCiAgICAgICAgICAgICR1cmxhcmcgPSBfQ1NJTV9ESVNQTEFZLic9MSc7CiAgICAgICAgfQoKICAgICAgICAvLyBOb3cgcmVjb25zdHJ1Y3QgYW55IHVzZXIgVVJMIGFyZ3VtZW50CiAgICAgICAgcmVzZXQoJF9HRVQpOwogICAgICAgIHdoaWxlKCBsaXN0KCRrZXksJHZhbHVlKSA9IGVhY2goJF9HRVQpICkgewogICAgICAgICAgICBpZiggaXNfYXJyYXkoJHZhbHVlKSApIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCAkdmFsdWUgYXMgJGsgPT4gJHYgKSB7CiAgICAgICAgICAgICAgICAgICAgJHVybGFyZyAuPSAnJmFtcDsnLiRrZXkuJyU1QicuJGsuJyU1RD0nLnVybGVuY29kZSgkdik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkdXJsYXJnIC49ICcmYW1wOycuJGtleS4nPScudXJsZW5jb2RlKCR2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEl0J3Mgbm90IGlkZWFsIHRvIGNvbnZlcnQgUE9TVCBhcmd1bWVudCB0byBHRVQgYXJndW1lbnRzCiAgICAgICAgLy8gYnV0IHRoZXJlIGlzIGxpdHRsZSBlbHNlIHdlIGNhbiBkby4gT25lIGlkZWEgZm9yIHRoZQogICAgICAgIC8vIGZ1dHVyZSBtaWdodCBiZSByZWNyZWF0ZSB0aGUgUE9TVCBoZWFkZXIgaW4gY2FzZS4KICAgICAgICByZXNldCgkX1BPU1QpOwogICAgICAgIHdoaWxlKCBsaXN0KCRrZXksJHZhbHVlKSA9IGVhY2goJF9QT1NUKSApIHsKICAgICAgICAgICAgaWYoIGlzX2FycmF5KCR2YWx1ZSkgKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICggJHZhbHVlIGFzICRrID0+ICR2ICkgewogICAgICAgICAgICAgICAgICAgICR1cmxhcmcgLj0gJyZhbXA7Jy4ka2V5LiclNUInLiRrLiclNUQ9Jy51cmxlbmNvZGUoJHYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHVybGFyZyAuPSAnJmFtcDsnLiRrZXkuJz0nLnVybGVuY29kZSgkdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHVybGFyZzsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDU0lNSW1nQWx0KCRhQWx0KSB7CiAgICAgICAgJHRoaXMtPmlDU0lNSW1nQWx0ID0gJGFBbHQ7CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlQ1NJTSgkYVNjcmlwdE5hbWU9J2F1dG8nLCRhQ1NJTU5hbWU9JycsJGFCb3JkZXI9MCkgewogICAgICAgIGlmKCAkYUNTSU1OYW1lPT0nJyApIHsKICAgICAgICAgICAgLy8gY3JlYXRlIGEgcmFuZG9tIG1hcCBuYW1lCiAgICAgICAgICAgIHNyYW5kICgoZG91YmxlKSBtaWNyb3RpbWUoKSAqIDEwMDAwMDApOwogICAgICAgICAgICAkciA9IHJhbmQoMCwxMDAwMDApOwogICAgICAgICAgICAkYUNTSU1OYW1lPSdfX21hcG5hbWUnLiRyLidfXyc7CiAgICAgICAgfQoKICAgICAgICBpZiggJGFTY3JpcHROYW1lPT0nYXV0bycgKSB7CiAgICAgICAgICAgICRhU2NyaXB0TmFtZT1iYXNlbmFtZSgkX1NFUlZFUlsnUEhQX1NFTEYnXSk7CiAgICAgICAgfQoKICAgICAgICAkdXJsYXJnID0gJHRoaXMtPkdldFVSTEFyZ3VtZW50cyh0cnVlKTsKCiAgICAgICAgaWYoIGVtcHR5KCRfR0VUW19DU0lNX0RJU1BMQVldKSApIHsKICAgICAgICAgICAgLy8gRmlyc3QgZGV0ZXJtaW5lIGlmIHdlIG5lZWQgdG8gY2hlY2sgZm9yIGEgY2FjaGVkIHZlcnNpb24KICAgICAgICAgICAgLy8gVGhpcyBkaWZmZXJzIGZyb20gdGhlIHN0YW5kYXJkIGNhY2hlIGluIHRoZSBzZW5zZSB0aGF0IHRoZQogICAgICAgICAgICAvLyBpbWFnZSBhbmQgQ1NJTSBtYXAgSFRNTCBmaWxlIGlzIHdyaXR0ZW4gcmVsYXRpdmUgdG8gdGhlIGRpcmVjdG9yeQogICAgICAgICAgICAvLyB0aGUgc2NyaXB0IGV4ZWN1dGVzIGluIGFuZCBub3QgdGhlIHNwZWNpZmllZCBjYWNoZSBkaXJlY3RvcnkuCiAgICAgICAgICAgIC8vIFRoZSByZWFzb24gZm9yIHRoaXMgaXMgdGhhdCB0aGUgY2FjaGUgZGlyZWN0b3J5IGlzIG5vdCBuZWNlc3NhcmlseQogICAgICAgICAgICAvLyBhY2Nlc3NpYmxlIGZyb20gdGhlIEhUVFAgc2VydmVyLgogICAgICAgICAgICBpZiggJHRoaXMtPmNzaW1jYWNoZW5hbWUgIT0gJycgKSB7CiAgICAgICAgICAgICAgICAkZGlyID0gZGlybmFtZSgkdGhpcy0+Y3NpbWNhY2hlbmFtZSk7CiAgICAgICAgICAgICAgICAkYmFzZSA9IGJhc2VuYW1lKCR0aGlzLT5jc2ltY2FjaGVuYW1lKTsKICAgICAgICAgICAgICAgICRiYXNlID0gc3RydG9rKCRiYXNlLCcuJyk7CiAgICAgICAgICAgICAgICAkc3VmZml4ID0gc3RydG9rKCcuJyk7CiAgICAgICAgICAgICAgICAkYmFzZWNzaW0gPSAkZGlyLicvJy4kYmFzZS4nPycuJHVybGFyZy4nX2NzaW1fLmh0bWwnOwogICAgICAgICAgICAgICAgJGJhc2VpbWcgPSAkYmFzZS4nPycuJHVybGFyZy4nLicuJHRoaXMtPmltZy0+aW1nX2Zvcm1hdDsKCiAgICAgICAgICAgICAgICAvLyBDaGVjayB0aGF0IGFwYWNoZSBjYW4gd3JpdGUgdG8gZGlyZWN0b3J5IHNwZWNpZmllZAoKICAgICAgICAgICAgICAgIGlmKCBmaWxlX2V4aXN0cygkZGlyKSAmJiAhaXNfd3JpdGVhYmxlKCRkaXIpICkgewogICAgICAgICAgICAgICAgICAgIEpwZ3JhcGhFcnJvcjo6UmFpc2VMKDI1MDI4LCRkaXIpOy8vKCdBcGFjaGUvUEhQIGRvZXMgbm90IGhhdmUgcGVybWlzc2lvbiB0byB3cml0ZSB0byB0aGUgQ1NJTSBjYWNoZSBkaXJlY3RvcnkgKCcuJGRpci4nKS4gQ2hlY2sgcGVybWlzc2lvbnMuJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIGRpcmVjdG9yeSBleGlzdHMKICAgICAgICAgICAgICAgICR0aGlzLT5jYWNoZS0+TWFrZURpcnMoJGRpcik7CgogICAgICAgICAgICAgICAgLy8gV3JpdGUgdGhlIGltYWdlIGZpbGUKICAgICAgICAgICAgICAgICR0aGlzLT5TdHJva2UoQ1NJTUNBQ0hFX0RJUi4kYmFzZWltZyk7CgogICAgICAgICAgICAgICAgLy8gQ29uc3RydWN0IHdyYXBwZXIgSFRNTCBhbmQgd3JpdGUgdG8gZmlsZSBhbmQgc2VuZCBpdCBiYWNrIHRvIGJyb3dzZXIKCiAgICAgICAgICAgICAgICAvLyBJbiB0aGUgc3JjIFVSTCB3ZSBtdXN0IHJlcGxhY2UgdGhlICc\/JyB3aXRoIGl0cyBlbmNvZGluZyB0byBwcmV2ZW50IHRoZSBhcmd1bWVudHMKICAgICAgICAgICAgICAgIC8vIHRvIGJlIGNvbnZlcnRlZCB0byByZWFsIGFyZ3VtZW50cy4KICAgICAgICAgICAgICAgICR0bXAgPSBzdHJfcmVwbGFjZSgnPycsJyUzZicsJGJhc2VpbWcpOwogICAgICAgICAgICAgICAgJGh0bWx3cmFwID0gJHRoaXMtPkdldEhUTUxJbWFnZU1hcCgkYUNTSU1OYW1lKS4iXG4iLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpbWcgc3JjPSInLkNTSU1DQUNIRV9IVFRQX0RJUi4kdG1wLiciIGlzbWFwPSJpc21hcCIgdXNlbWFwPSIjJy4kYUNTSU1OYW1lLicgd2lkdGg9IicuJHRoaXMtPmltZy0+d2lkdGguJyIgaGVpZ2h0PSInLiR0aGlzLT5pbWctPmhlaWdodC4iXCIgYWx0PVwiIi4kdGhpcy0+aUNTSU1JbWdBbHQuIlwiIC8+XG4iOwoKICAgICAgICAgICAgICAgIGlmKCRmaCA9ICBAZm9wZW4oJGJhc2Vjc2ltLCd3JykgKSB7CiAgICAgICAgICAgICAgICAgICAgZndyaXRlKCRmaCwkaHRtbHdyYXApOwogICAgICAgICAgICAgICAgICAgIGZjbG9zZSgkZmgpOwogICAgICAgICAgICAgICAgICAgIGVjaG8gJGh0bWx3cmFwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMjksJGJhc2Vjc2ltKTsvLygiIENhbid0IHdyaXRlIENTSU0gXCIkYmFzZWNzaW1cIiBmb3Igd3JpdGluZy4gQ2hlY2sgZnJlZSBzcGFjZSBhbmQgcGVybWlzc2lvbnMuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgaWYoICRhU2NyaXB0TmFtZT09JycgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMzApOy8vKCdNaXNzaW5nIHNjcmlwdCBuYW1lIGluIGNhbGwgdG8gU3Ryb2tlQ1NJTSgpLiBZb3UgbXVzdCBzcGVjaWZ5IHRoZSBuYW1lIG9mIHRoZSBhY3R1YWwgaW1hZ2Ugc2NyaXB0IGFzIHRoZSBmaXJzdCBwYXJhbWV0ZXIgdG8gU3Ryb2tlQ1NJTSgpLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWNobyAkdGhpcy0+R2V0SFRNTEltYWdlTWFwKCRhQ1NJTU5hbWUpIC4gJHRoaXMtPkdldENTSU1JbWdIVE1MKCRhQ1NJTU5hbWUsICRhU2NyaXB0TmFtZSwgJGFCb3JkZXIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+U3Ryb2tlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZUNTSU1JbWFnZSgpIHsKICAgICAgICBpZiggQCRfR0VUW19DU0lNX0RJU1BMQVldID09IDEgKSB7CiAgICAgICAgICAgICR0aGlzLT5TdHJva2UoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gR2V0Q1NJTUltZ0hUTUwoJGFDU0lNTmFtZSwgJGFTY3JpcHROYW1lPSdhdXRvJywgJGFCb3JkZXI9MCApIHsKICAgICAgICBpZiggJGFTY3JpcHROYW1lPT0nYXV0bycgKSB7CiAgICAgICAgICAgICRhU2NyaXB0TmFtZT1iYXNlbmFtZSgkX1NFUlZFUlsnUEhQX1NFTEYnXSk7CiAgICAgICAgfQogICAgICAgICR1cmxhcmcgPSAkdGhpcy0+R2V0VVJMQXJndW1lbnRzKHRydWUpOwogICAgICAgIHJldHVybiAiPGltZyBzcmM9XCIiLiRhU2NyaXB0TmFtZS4nPycuJHVybGFyZy4iXCIgaXNtYXA9XCJpc21hcFwiIHVzZW1hcD1cIiMiLiRhQ1NJTU5hbWUuJyIgaGVpZ2h0PSInLiR0aGlzLT5pbWctPmhlaWdodC4iXCIgYWx0PVwiIi4kdGhpcy0+aUNTSU1JbWdBbHQuIlwiIC8+XG4iOwogICAgfQoKICAgIGZ1bmN0aW9uIEdldFRleHRzWU1pbk1heCgkYVkyPWZhbHNlKSB7CiAgICAgICAgaWYoICRhWTIgKSB7CiAgICAgICAgICAgICR0eHRzID0gJHRoaXMtPnkydGV4dHM7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdHh0cyA9ICR0aGlzLT50ZXh0czsKICAgICAgICB9CiAgICAgICAgJG4gPSBjb3VudCgkdHh0cyk7CiAgICAgICAgJG1pbj1udWxsOwogICAgICAgICRtYXg9bnVsbDsKICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgIGlmKCAkdHh0c1skaV0tPmlTY2FsZVBvc1kgIT09IG51bGwgJiYgJHR4dHNbJGldLT5pU2NhbGVQb3NYICE9PSBudWxsICApIHsKICAgICAgICAgICAgICAgIGlmKCAkbWluID09PSBudWxsICApIHsKICAgICAgICAgICAgICAgICAgICAkbWluID0gJG1heCA9ICR0eHRzWyRpXS0+aVNjYWxlUG9zWSA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbWluID0gbWluKCRtaW4sJHR4dHNbJGldLT5pU2NhbGVQb3NZKTsKICAgICAgICAgICAgICAgICAgICAkbWF4ID0gbWF4KCRtYXgsJHR4dHNbJGldLT5pU2NhbGVQb3NZKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiggJG1pbiAhPT0gbnVsbCApIHsKICAgICAgICAgICAgcmV0dXJuIGFycmF5KCRtaW4sJG1heCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gR2V0VGV4dHNYTWluTWF4KCRhWTI9ZmFsc2UpIHsKICAgICAgICBpZiggJGFZMiApIHsKICAgICAgICAgICAgJHR4dHMgPSAkdGhpcy0+eTJ0ZXh0czsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0eHRzID0gJHRoaXMtPnRleHRzOwogICAgICAgIH0KICAgICAgICAkbiA9IGNvdW50KCR0eHRzKTsKICAgICAgICAkbWluPW51bGw7CiAgICAgICAgJG1heD1udWxsOwogICAgICAgIGZvciggJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgaWYoICR0eHRzWyRpXS0+aVNjYWxlUG9zWSAhPT0gbnVsbCAmJiAkdHh0c1skaV0tPmlTY2FsZVBvc1ggIT09IG51bGwgICkgewogICAgICAgICAgICAgICAgaWYoICRtaW4gPT09IG51bGwgICkgewogICAgICAgICAgICAgICAgICAgICRtaW4gPSAkbWF4ID0gJHR4dHNbJGldLT5pU2NhbGVQb3NYIDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW4gPSBtaW4oJG1pbiwkdHh0c1skaV0tPmlTY2FsZVBvc1gpOwogICAgICAgICAgICAgICAgICAgICRtYXggPSBtYXgoJG1heCwkdHh0c1skaV0tPmlTY2FsZVBvc1gpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKCAkbWluICE9PSBudWxsICkgewogICAgICAgICAgICByZXR1cm4gYXJyYXkoJG1pbiwkbWF4KTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBHZXRYTWluTWF4KCkgewoKICAgICAgICBsaXN0KCRtaW4sJHltaW4pID0gJHRoaXMtPnBsb3RzWzBdLT5NaW4oKTsKICAgICAgICBsaXN0KCRtYXgsJHltYXgpID0gJHRoaXMtPnBsb3RzWzBdLT5NYXgoKTsKCiAgICAgICAgJGk9MDsKICAgICAgICAvLyBTb21lIHBsb3RzLCBlLmcuIFBsb3RMaW5lIHNob3VsZCBub3QgYWZmZWN0IHRoZSBzY2FsZQogICAgICAgIC8vIGFuZCB3aWxsIHJldHVybiAobnVsbCxudWxsKS4gV2Ugc2hvdWxkIGlnbm9yZSB0aG9zZQogICAgICAgIC8vIHZhbHVlcy4KICAgICAgICB3aGlsZSggKCRtaW49PT1udWxsIHx8ICRtYXggPT09IG51bGwpICYmICgkaSA8IGNvdW50KCR0aGlzLT5wbG90cyktMSkgKSB7CiAgICAgICAgICAgICsrJGk7CiAgICAgICAgICAgIGxpc3QoJG1pbiwkeW1pbikgPSAkdGhpcy0+cGxvdHNbJGldLT5NaW4oKTsKICAgICAgICAgICAgbGlzdCgkbWF4LCR5bWF4KSA9ICR0aGlzLT5wbG90c1skaV0tPk1heCgpOwogICAgICAgIH0KCiAgICAgICAgZm9yZWFjaCggJHRoaXMtPnBsb3RzIGFzICRwICkgewogICAgICAgICAgICBsaXN0KCR4bWluLCR5bWluKSA9ICRwLT5NaW4oKTsKICAgICAgICAgICAgbGlzdCgkeG1heCwkeW1heCkgPSAkcC0+TWF4KCk7CgogICAgICAgICAgICBpZiggJHhtaW4gIT09IG51bGwgJiYgJHhtYXggIT09IG51bGwgKSB7CiAgICAgICAgICAgICAgICAkbWluID0gTWluKCR4bWluLCRtaW4pOwogICAgICAgICAgICAgICAgJG1heCA9IE1heCgkeG1heCwkbWF4KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT55MmF4aXMgIT0gbnVsbCApIHsKICAgICAgICAgICAgZm9yZWFjaCggJHRoaXMtPnkycGxvdHMgYXMgJHAgKSB7CiAgICAgICAgICAgICAgICBsaXN0KCR4bWluLCR5bWluKSA9ICRwLT5NaW4oKTsKICAgICAgICAgICAgICAgIGxpc3QoJHhtYXgsJHltYXgpID0gJHAtPk1heCgpOwogICAgICAgICAgICAgICAgJG1pbiA9IE1pbigkeG1pbiwkbWluKTsKICAgICAgICAgICAgICAgICRtYXggPSBNYXgoJHhtYXgsJG1heCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRuID0gY291bnQoJHRoaXMtPnluYXhpcyk7CiAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICBpZiggJHRoaXMtPnluYXhpc1skaV0gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZm9yZWFjaCggJHRoaXMtPnlucGxvdHNbJGldIGFzICRwICkgewogICAgICAgICAgICAgICAgICAgIGxpc3QoJHhtaW4sJHltaW4pID0gJHAtPk1pbigpOwogICAgICAgICAgICAgICAgICAgIGxpc3QoJHhtYXgsJHltYXgpID0gJHAtPk1heCgpOwogICAgICAgICAgICAgICAgICAgICRtaW4gPSBNaW4oJHhtaW4sJG1pbik7CiAgICAgICAgICAgICAgICAgICAgJG1heCA9IE1heCgkeG1heCwkbWF4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyYXkoJG1pbiwkbWF4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBBZGp1c3RNYXJnaW5zRm9yVGl0bGVzKCkgewogICAgICAgICR0b3RyZXF1aXJlZCA9IAogICAgICAgICAgICAoJHRoaXMtPnRpdGxlLT50ICE9ICcnIAogICAgICAgICAgICAgICAgPyAkdGhpcy0+dGl0bGUtPkdldFRleHRIZWlnaHQoJHRoaXMtPmltZykgKyAkdGhpcy0+dGl0bGUtPm1hcmdpbiArIDUgKiBTVVBFUlNBTVBMSU5HX1NDQUxFCiAgICAgICAgICAgICAgICA6IDAgKSArCiAgICAgICAgICAgICgkdGhpcy0+c3VidGl0bGUtPnQgIT0gJycgCiAgICAgICAgICAgICAgICA\/ICR0aGlzLT5zdWJ0aXRsZS0+R2V0VGV4dEhlaWdodCgkdGhpcy0+aW1nKSArICR0aGlzLT5zdWJ0aXRsZS0+bWFyZ2luICsgNSAqIFNVUEVSU0FNUExJTkdfU0NBTEUKICAgICAgICAgICAgICAgIDogMCApICsKICAgICAgICAgICAgKCR0aGlzLT5zdWJzdWJ0aXRsZS0+dCAhPSAnJyAKICAgICAgICAgICAgICAgID8gJHRoaXMtPnN1YnN1YnRpdGxlLT5HZXRUZXh0SGVpZ2h0KCR0aGlzLT5pbWcpICsgJHRoaXMtPnN1YnN1YnRpdGxlLT5tYXJnaW4gKyA1ICogU1VQRVJTQU1QTElOR19TQ0FMRQogICAgICAgICAgICAgICAgOiAwICkgOwoKICAgICAgICAkYnRvdHJlcXVpcmVkID0gMDsKICAgICAgICBpZigkdGhpcy0+eGF4aXMgIT0gbnVsbCAmJiAgISR0aGlzLT54YXhpcy0+aGlkZSAmJiAhJHRoaXMtPnhheGlzLT5oaWRlX2xhYmVscyApIHsKICAgICAgICAgICAgLy8gTWluaW11bSBib3R0b20gbWFyZ2luCiAgICAgICAgICAgIGlmKCAkdGhpcy0+eGF4aXMtPnRpdGxlLT50ICE9ICcnICkgewogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5pbWctPmEgPT0gOTAgKSB7CiAgICAgICAgICAgICAgICAgICAgJGJ0b3RyZXF1aXJlZCA9ICR0aGlzLT55YXhpcy0+dGl0bGUtPkdldFRleHRIZWlnaHQoJHRoaXMtPmltZykgKyA3IDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRidG90cmVxdWlyZWQgPSAkdGhpcy0+eGF4aXMtPnRpdGxlLT5HZXRUZXh0SGVpZ2h0KCR0aGlzLT5pbWcpICsgNyA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkYnRvdHJlcXVpcmVkID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoICR0aGlzLT5pbWctPmEgPT0gOTAgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRGb250KCR0aGlzLT55YXhpcy0+Zm9udF9mYW1pbHksJHRoaXMtPnlheGlzLT5mb250X3N0eWxlLAogICAgICAgICAgICAgICAgJHRoaXMtPnlheGlzLT5mb250X3NpemUpOwogICAgICAgICAgICAgICAgJGxoID0gJHRoaXMtPmltZy0+R2V0VGV4dEhlaWdodCgnTWcnLCR0aGlzLT55YXhpcy0+bGFiZWxfYW5nbGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Rm9udCgkdGhpcy0+eGF4aXMtPmZvbnRfZmFtaWx5LCR0aGlzLT54YXhpcy0+Zm9udF9zdHlsZSwKICAgICAgICAgICAgICAgICR0aGlzLT54YXhpcy0+Zm9udF9zaXplKTsKICAgICAgICAgICAgICAgICRsaCA9ICR0aGlzLT5pbWctPkdldFRleHRIZWlnaHQoJ01nJywkdGhpcy0+eGF4aXMtPmxhYmVsX2FuZ2xlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGJ0b3RyZXF1aXJlZCArPSAkbGggKyA2OwogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT5pbWctPmEgPT0gOTAgKSB7CiAgICAgICAgICAgIC8vIERPIE5vdGhpbmcuIEl0IGdldHMgdG9vIG1lc3N5IHRvIGRvIHRoaXMgcHJvcGVybHkgZm9yIDkwIGRlZy4uLgogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICAvLyBuZWVkIG1vcmUgdG9wIG1hcmdpbgogICAgICAgICAgICBpZiggJHRoaXMtPmltZy0+dG9wX21hcmdpbiA8ICR0b3RyZXF1aXJlZCApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5TZXRNYXJnaW4oCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+cmF3X2xlZnRfbWFyZ2luLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPnJhd19yaWdodF9tYXJnaW4sCiAgICAgICAgICAgICAgICAgICAgJHRvdHJlcXVpcmVkIC8gU1VQRVJTQU1QTElOR19TQ0FMRSwgCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+cmF3X2JvdHRvbV9tYXJnaW4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5lZWQgbW9yZSBib3R0b20gbWFyZ2luCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aW1nLT5ib3R0b21fbWFyZ2luIDwgJGJ0b3RyZXF1aXJlZCApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5TZXRNYXJnaW4oCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+cmF3X2xlZnRfbWFyZ2luLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPnJhd19yaWdodF9tYXJnaW4sCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+cmF3X3RvcF9tYXJnaW4sCiAgICAgICAgICAgICAgICAgICAgJGJ0b3RyZXF1aXJlZCAvIFNVUEVSU0FNUExJTkdfU0NBTEUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlU3RvcmUoJGFTdHJva2VGaWxlTmFtZSkgewogICAgICAgIC8vIEdldCB0aGUgaGFuZGxlciB0byBwcmV2ZW50IHRoZSBsaWJyYXJ5IGZyb20gc2VuZGluZyB0aGUKICAgICAgICAvLyBpbWFnZSB0byB0aGUgYnJvd3NlcgogICAgICAgICRpaCA9ICR0aGlzLT5TdHJva2UoX0lNR19IQU5ETEVSKTsKCiAgICAgICAgLy8gU3Ryb2tlIGl0IHRvIGEgZmlsZQogICAgICAgICR0aGlzLT5pbWctPlN0cmVhbSgkYVN0cm9rZUZpbGVOYW1lKTsKCiAgICAgICAgLy8gU2VuZCBpdCBiYWNrIHRvIGJyb3dzZXIKICAgICAgICAkdGhpcy0+aW1nLT5IZWFkZXJzKCk7CiAgICAgICAgJHRoaXMtPmltZy0+U3RyZWFtKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZG9BdXRvc2NhbGVYQXhpcygpIHsKICAgIC8vQ2hlY2sgaWYgd2Ugc2hvdWxkIGF1dG9zY2FsZSB4LWF4aXMKICAgICAgICBpZiggISR0aGlzLT54c2NhbGUtPklzU3BlY2lmaWVkKCkgKSB7CiAgICAgICAgICAgIGlmKCBzdWJzdHIoJHRoaXMtPmF4dHlwZSwwLDQpID09ICJ0ZXh0IiApIHsKICAgICAgICAgICAgICAgICRtYXg9MDsKICAgICAgICAgICAgICAgICRuID0gY291bnQoJHRoaXMtPnBsb3RzKTsKICAgICAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAgICAgICAgICRwID0gJHRoaXMtPnBsb3RzWyRpXTsKICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHNvbWUgdW5mb3J0dW5hdGUgc3ViIGNsYXNzIGtub3dsZWRnZSBoZXJlIGluIG9yZGVyCiAgICAgICAgICAgICAgICAgICAgLy8gdG8gaW5jcmVhc2UgbnVtYmVyIG9mIGRhdGEgcG9pbnRzIGluIGNhc2UgaXQgaXMgYSBsaW5lIHBsb3QKICAgICAgICAgICAgICAgICAgICAvLyB3aGljaCBoYXMgdGhlIGJhcmNlbnRlciBzZXQuIElmIG5vdCBpdCBjb3VsZCBtZWFuIHRoYXQgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gbGFzdCBwb2ludCBvZiB0aGUgZGF0YSBpcyBvdXRzaWRlIHRoZSBzY2FsZSBzaW5jZSB0aGUgYmFyY2VudGVyCiAgICAgICAgICAgICAgICAgICAgLy8gc2V0dGluZ3MgbWVhbnMgdGhhdCB3ZSB3aWxsIHNoaWZ0IHRoZSBlbnRpcmUgcGxvdCBoYWxmIGEgdGljayBzdGVwCiAgICAgICAgICAgICAgICAgICAgLy8gdG8gdGhlIHJpZ2h0IGluIG9kZXIgdG8gYWxpZ24gd2l0aCB0aGUgY2VudGVyIG9mIHRoZSBiYXJzLgogICAgICAgICAgICAgICAgICAgIGlmKCBjbGFzc19leGlzdHMoJ0JhclBsb3QnLGZhbHNlKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNsID0gc3RydG9sb3dlcihnZXRfY2xhc3MoJHApKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIChjbGFzc19leGlzdHMoJ0JhclBsb3QnLGZhbHNlKSAmJiAoJHAgaW5zdGFuY2VvZiBCYXJQbG90KSkgfHwgZW1wdHkoJHAtPmJhcmNlbnRlcikgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWF4PW1heCgkbWF4LCRwLT5udW1wb2ludHMtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWF4PW1heCgkbWF4LCRwLT5udW1wb2ludHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiggZW1wdHkoJHAtPmJhcmNlbnRlcikgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWF4PW1heCgkbWF4LCRwLT5udW1wb2ludHMtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWF4PW1heCgkbWF4LCRwLT5udW1wb2ludHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG1pbj0wOwogICAgICAgICAgICAgICAgaWYoICR0aGlzLT55MmF4aXMgIT0gbnVsbCApIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCAkdGhpcy0+eTJwbG90cyBhcyAkcCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1heD1tYXgoJG1heCwkcC0+bnVtcG9pbnRzLTEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRuID0gY291bnQoJHRoaXMtPnluYXhpcyk7CiAgICAgICAgICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoICR0aGlzLT55bmF4aXNbJGldICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCggJHRoaXMtPnlucGxvdHNbJGldIGFzICRwICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1heD1tYXgoJG1heCwkcC0+bnVtcG9pbnRzLTEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPlVwZGF0ZSgkdGhpcy0+aW1nLCRtaW4sJG1heCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+eHNjYWxlLT50aWNrcy0+U2V0KCR0aGlzLT54YXhpcy0+dGlja19zdGVwLDEpOwogICAgICAgICAgICAgICAgJHRoaXMtPnhzY2FsZS0+dGlja3MtPlN1cHJlc3NNaW5vclRpY2tNYXJrcygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbGlzdCgkbWluLCRtYXgpID0gJHRoaXMtPkdldFhNaW5NYXgoKTsKCiAgICAgICAgICAgICAgICAkbHJlcyA9ICR0aGlzLT5HZXRMaW5lc1hNaW5NYXgoJHRoaXMtPmxpbmVzKTsKICAgICAgICAgICAgICAgIGlmKCAkbHJlcyApIHsKICAgICAgICAgICAgICAgICAgICBsaXN0KCRsaW5taW4sJGxpbm1heCkgPSAkbHJlcyA7CiAgICAgICAgICAgICAgICAgICAgJG1pbiA9IG1pbigkbWluLCRsaW5taW4pOwogICAgICAgICAgICAgICAgICAgICRtYXggPSBtYXgoJG1heCwkbGlubWF4KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkbHJlcyA9ICR0aGlzLT5HZXRMaW5lc1hNaW5NYXgoJHRoaXMtPnkybGluZXMpOwogICAgICAgICAgICAgICAgaWYoICRscmVzICkgewogICAgICAgICAgICAgICAgICAgIGxpc3QoJGxpbm1pbiwkbGlubWF4KSA9ICRscmVzIDsKICAgICAgICAgICAgICAgICAgICAkbWluID0gbWluKCRtaW4sJGxpbm1pbik7CiAgICAgICAgICAgICAgICAgICAgJG1heCA9IG1heCgkbWF4LCRsaW5tYXgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR0cmVzID0gJHRoaXMtPkdldFRleHRzWE1pbk1heCgpOwogICAgICAgICAgICAgICAgaWYoICR0cmVzICkgewogICAgICAgICAgICAgICAgICAgIGxpc3QoJHRtaW4sJHRtYXgpID0gJHRyZXMgOwogICAgICAgICAgICAgICAgICAgICRtaW4gPSBtaW4oJG1pbiwkdG1pbik7CiAgICAgICAgICAgICAgICAgICAgJG1heCA9IG1heCgkbWF4LCR0bWF4KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkdHJlcyA9ICR0aGlzLT5HZXRUZXh0c1hNaW5NYXgodHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiggJHRyZXMgKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkdG1pbiwkdG1heCkgPSAkdHJlcyA7CiAgICAgICAgICAgICAgICAgICAgJG1pbiA9IG1pbigkbWluLCR0bWluKTsKICAgICAgICAgICAgICAgICAgICAkbWF4ID0gbWF4KCRtYXgsJHRtYXgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPkF1dG9TY2FsZSgkdGhpcy0+aW1nLCRtaW4sJG1heCxyb3VuZCgkdGhpcy0+aW1nLT5wbG90d2lkdGgvJHRoaXMtPnh0aWNrX2ZhY3RvcikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0FkanVzdCBwb3NpdGlvbiBvZiB5LWF4aXMgYW5kIHkyLWF4aXMgdG8gbWluaW11bS9tYXhpbXVtIG9mIHgtc2NhbGUKICAgICAgICAgICAgaWYoICFpc19udW1lcmljKCR0aGlzLT55YXhpcy0+cG9zKSAmJiAhaXNfc3RyaW5nKCR0aGlzLT55YXhpcy0+cG9zKSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT55YXhpcy0+U2V0UG9zKCR0aGlzLT54c2NhbGUtPkdldE1pblZhbCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT54c2NhbGUtPklzU3BlY2lmaWVkKCkgJiYKICAgICAgICAgICAgICAgICggJHRoaXMtPnhzY2FsZS0+YXV0b190aWNrcyB8fCAhJHRoaXMtPnhzY2FsZS0+dGlja3MtPklzU3BlY2lmaWVkKCkpICkgewogICAgICAgICAgICAvLyBUaGUgdGljayBjYWxjdWxhdGlvbiB3aWxsIHVzZSB0aGUgdXNlciBzdXBsaWVkIG1pbi9tYXggdmFsdWVzIHRvIGRldGVybWluZQogICAgICAgICAgICAvLyB0aGUgdGlja3MuIElmIGF1dG9fdGlja3MgaXMgZmFsc2UgdGhlIGV4YWN0IHVzZXIgc3BlY2lmZWQgbWluIGFuZCBtYXgKICAgICAgICAgICAgLy8gdmFsdWVzIHdpbGwgYmUgdXNlZCBmb3IgdGhlIHNjYWxlLgogICAgICAgICAgICAvLyBJZiBhdXRvX3RpY2tzIGlzIHRydWUgdGhlbiB0aGUgc2NhbGUgbWlnaHQgYmUgc2xpZ2h0bHkgYWRqdXN0ZWQKICAgICAgICAgICAgLy8gc28gdGhhdCB0aGUgbWluIGFuZCBtYXggdmFsdWVzIGZhbGxzIG9uIGFuIGV2ZW4gbWFqb3Igc3RlcC4KICAgICAgICAgICAgJG1pbiA9ICR0aGlzLT54c2NhbGUtPnNjYWxlWzBdOwogICAgICAgICAgICAkbWF4ID0gJHRoaXMtPnhzY2FsZS0+c2NhbGVbMV07CiAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPkF1dG9TY2FsZSgkdGhpcy0+aW1nLCRtaW4sJG1heCxyb3VuZCgkdGhpcy0+aW1nLT5wbG90d2lkdGgvJHRoaXMtPnh0aWNrX2ZhY3RvciksZmFsc2UpOwoKICAgICAgICAgICAgLy8gTm93IG1ha2Ugc3VyZSB3ZSBzaG93IGVub3VnaCBwcmVjaXNpb24gdG8gYWNjdXJhdGUgZGlzcGxheSB0aGUKICAgICAgICAgICAgLy8gbGFiZWxzLiBJZiB0aGlzIGlzIG5vdCBkb25lIHRoZW4gdGhlIHVzZXIgbWlnaHQgZW5kIHVwIHdpdGgKICAgICAgICAgICAgLy8gYSBzY2FsZSB0aGF0IG1pZ2h0IGFjdHVhbGx5IHN0YXJ0IHdpdGgsIHNheSAxMy41LCBidXRkdWUgdG8gcm91bmRpbmcKICAgICAgICAgICAgLy8gdGhlIHNjYWxlIGxhYmVsIHdpbGwgb255IHNob3cgMTQuCiAgICAgICAgICAgIGlmKCBhYnMoZmxvb3IoJG1pbiktJG1pbikgPiAwICkgewoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSB1c2VyIGhhcyBzZXQgYSBmb3JtYXQgdGhlbiB3ZSBiYWlsIG91dAogICAgICAgICAgICAgICAgaWYoICR0aGlzLT54c2NhbGUtPnRpY2tzLT5sYWJlbF9mb3JtYXRzdHIgPT0gJycgJiYgJHRoaXMtPnhzY2FsZS0+dGlja3MtPmxhYmVsX2RhdGVmb3JtYXRzdHIgPT0gJycgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnhzY2FsZS0+dGlja3MtPnByZWNpc2lvbiA9IGFicyggZmxvb3IobG9nMTAoIGFicyhmbG9vcigkbWluKS0kbWluKSkpICkrMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUG9zaXRpb24gdGhlIG9wdGlvbmFsIFkyIGFuZCBZbiBheGlzIHRvIHRoZSByaWdodG1vc3QgcG9zaXRpb24gb2YgdGhlIHgtYXhpcwogICAgICAgIGlmKCAkdGhpcy0+eTJheGlzICE9IG51bGwgKSB7CiAgICAgICAgICAgIGlmKCAhaXNfbnVtZXJpYygkdGhpcy0+eTJheGlzLT5wb3MpICYmICFpc19zdHJpbmcoJHRoaXMtPnkyYXhpcy0+cG9zKSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT55MmF4aXMtPlNldFBvcygkdGhpcy0+eHNjYWxlLT5HZXRNYXhWYWwoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPnkyYXhpcy0+U2V0VGl0bGVTaWRlKFNJREVfUklHSFQpOwogICAgICAgIH0KCiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+eW5heGlzKTsKICAgICAgICAkblkyYWRqID0gJHRoaXMtPnkyYXhpcyAhPSBudWxsID8gJHRoaXMtPmlZQXhpc0RlbHRhUG9zIDogMDsKICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+eW5heGlzWyRpXSAhPSBudWxsICkgewogICAgICAgICAgICAgICAgaWYoICFpc19udW1lcmljKCR0aGlzLT55bmF4aXNbJGldLT5wb3MpICYmICFpc19zdHJpbmcoJHRoaXMtPnluYXhpc1skaV0tPnBvcykgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnluYXhpc1skaV0tPlNldFBvcygkdGhpcy0+eHNjYWxlLT5HZXRNYXhWYWwoKSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnluYXhpc1skaV0tPlNldFBvc0Fic0RlbHRhKCRpKiR0aGlzLT5pWUF4aXNEZWx0YVBvcyArICRuWTJhZGopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnluYXhpc1skaV0tPlNldFRpdGxlU2lkZShTSURFX1JJR0hUKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gZG9BdXRvU2NhbGVZbkF4aXMoKSB7CgogICAgICAgIGlmKCAkdGhpcy0+eTJzY2FsZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGlmKCAhJHRoaXMtPnkyc2NhbGUtPklzU3BlY2lmaWVkKCkgJiYgY291bnQoJHRoaXMtPnkycGxvdHMpPjAgKSB7CiAgICAgICAgICAgICAgICBsaXN0KCRtaW4sJG1heCkgPSAkdGhpcy0+R2V0UGxvdHNZTWluTWF4KCR0aGlzLT55MnBsb3RzKTsKCiAgICAgICAgICAgICAgICAkbHJlcyA9ICR0aGlzLT5HZXRMaW5lc1lNaW5NYXgoJHRoaXMtPnkybGluZXMpOwogICAgICAgICAgICAgICAgaWYoIGlzX2FycmF5KCRscmVzKSApIHsKICAgICAgICAgICAgICAgICAgICBsaXN0KCRsaW5taW4sJGxpbm1heCkgPSAkbHJlcyA7CiAgICAgICAgICAgICAgICAgICAgJG1pbiA9IG1pbigkbWluLCRsaW5taW4pOwogICAgICAgICAgICAgICAgICAgICRtYXggPSBtYXgoJG1heCwkbGlubWF4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0cmVzID0gJHRoaXMtPkdldFRleHRzWU1pbk1heCh0cnVlKTsKICAgICAgICAgICAgICAgIGlmKCBpc19hcnJheSgkdHJlcykgKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkdG1pbiwkdG1heCkgPSAkdHJlcyA7CiAgICAgICAgICAgICAgICAgICAgJG1pbiA9IG1pbigkbWluLCR0bWluKTsKICAgICAgICAgICAgICAgICAgICAkbWF4ID0gbWF4KCRtYXgsJHRtYXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnkyc2NhbGUtPkF1dG9TY2FsZSgkdGhpcy0+aW1nLCRtaW4sJG1heCwkdGhpcy0+aW1nLT5wbG90aGVpZ2h0LyR0aGlzLT55dGlja19mYWN0b3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnkyc2NhbGUtPklzU3BlY2lmaWVkKCkgJiYgKCAkdGhpcy0+eTJzY2FsZS0+YXV0b190aWNrcyB8fCAhJHRoaXMtPnkyc2NhbGUtPnRpY2tzLT5Jc1NwZWNpZmllZCgpKSApIHsKICAgICAgICAgICAgICAgIC8vIFRoZSB0aWNrIGNhbGN1bGF0aW9uIHdpbGwgdXNlIHRoZSB1c2VyIHN1cGxpZWQgbWluL21heCB2YWx1ZXMgdG8gZGV0ZXJtaW5lCiAgICAgICAgICAgICAgICAvLyB0aGUgdGlja3MuIElmIGF1dG9fdGlja3MgaXMgZmFsc2UgdGhlIGV4YWN0IHVzZXIgc3BlY2lmZWQgbWluIGFuZCBtYXgKICAgICAgICAgICAgICAgIC8vIHZhbHVlcyB3aWxsIGJlIHVzZWQgZm9yIHRoZSBzY2FsZS4KICAgICAgICAgICAgICAgIC8vIElmIGF1dG9fdGlja3MgaXMgdHJ1ZSB0aGVuIHRoZSBzY2FsZSBtaWdodCBiZSBzbGlnaHRseSBhZGp1c3RlZAogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB0aGUgbWluIGFuZCBtYXggdmFsdWVzIGZhbGxzIG9uIGFuIGV2ZW4gbWFqb3Igc3RlcC4KICAgICAgICAgICAgICAgICRtaW4gPSAkdGhpcy0+eTJzY2FsZS0+c2NhbGVbMF07CiAgICAgICAgICAgICAgICAkbWF4ID0gJHRoaXMtPnkyc2NhbGUtPnNjYWxlWzFdOwogICAgICAgICAgICAgICAgJHRoaXMtPnkyc2NhbGUtPkF1dG9TY2FsZSgkdGhpcy0+aW1nLCRtaW4sJG1heCwKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPnBsb3RoZWlnaHQvJHRoaXMtPnl0aWNrX2ZhY3RvciwKICAgICAgICAgICAgICAgICR0aGlzLT55MnNjYWxlLT5hdXRvX3RpY2tzKTsKCiAgICAgICAgICAgICAgICAvLyBOb3cgbWFrZSBzdXJlIHdlIHNob3cgZW5vdWdoIHByZWNpc2lvbiB0byBhY2N1cmF0ZSBkaXNwbGF5IHRoZQogICAgICAgICAgICAgICAgLy8gbGFiZWxzLiBJZiB0aGlzIGlzIG5vdCBkb25lIHRoZW4gdGhlIHVzZXIgbWlnaHQgZW5kIHVwIHdpdGgKICAgICAgICAgICAgICAgIC8vIGEgc2NhbGUgdGhhdCBtaWdodCBhY3R1YWxseSBzdGFydCB3aXRoLCBzYXkgMTMuNSwgYnV0ZHVlIHRvIHJvdW5kaW5nCiAgICAgICAgICAgICAgICAvLyB0aGUgc2NhbGUgbGFiZWwgd2lsbCBvbnkgc2hvdyAxNC4KICAgICAgICAgICAgICAgIGlmKCBhYnMoZmxvb3IoJG1pbiktJG1pbikgPiAwICkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSB1c2VyIGhhcyBzZXQgYSBmb3JtYXQgdGhlbiB3ZSBiYWlsIG91dAogICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+eTJzY2FsZS0+dGlja3MtPmxhYmVsX2Zvcm1hdHN0ciA9PSAnJyAmJiAkdGhpcy0+eTJzY2FsZS0+dGlja3MtPmxhYmVsX2RhdGVmb3JtYXRzdHIgPT0gJycgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT55MnNjYWxlLT50aWNrcy0+cHJlY2lzaW9uID0gYWJzKCBmbG9vcihsb2cxMCggYWJzKGZsb29yKCRtaW4pLSRtaW4pKSkgKSsxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvLwogICAgICAgIC8vIEF1dG9zY2FsZSB0aGUgZXh0cmEgWS1heGlzZXMKICAgICAgICAvLwogICAgICAgICRuID0gY291bnQoJHRoaXMtPnluYXhpcyk7CiAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICBpZiggJHRoaXMtPnluc2NhbGVbJGldICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmKCAhJHRoaXMtPnluc2NhbGVbJGldLT5Jc1NwZWNpZmllZCgpICYmIGNvdW50KCR0aGlzLT55bnBsb3RzWyRpXSk+MCApIHsKICAgICAgICAgICAgICAgICAgICBsaXN0KCRtaW4sJG1heCkgPSAkdGhpcy0+R2V0UGxvdHNZTWluTWF4KCR0aGlzLT55bnBsb3RzWyRpXSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnluc2NhbGVbJGldLT5BdXRvU2NhbGUoJHRoaXMtPmltZywkbWluLCRtYXgsJHRoaXMtPmltZy0+cGxvdGhlaWdodC8kdGhpcy0+eXRpY2tfZmFjdG9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnluc2NhbGVbJGldLT5Jc1NwZWNpZmllZCgpICYmICggJHRoaXMtPnluc2NhbGVbJGldLT5hdXRvX3RpY2tzIHx8ICEkdGhpcy0+eW5zY2FsZVskaV0tPnRpY2tzLT5Jc1NwZWNpZmllZCgpKSApIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgdGljayBjYWxjdWxhdGlvbiB3aWxsIHVzZSB0aGUgdXNlciBzdXBsaWVkIG1pbi9tYXggdmFsdWVzIHRvIGRldGVybWluZQogICAgICAgICAgICAgICAgICAgIC8vIHRoZSB0aWNrcy4gSWYgYXV0b190aWNrcyBpcyBmYWxzZSB0aGUgZXhhY3QgdXNlciBzcGVjaWZlZCBtaW4gYW5kIG1heAogICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlcyB3aWxsIGJlIHVzZWQgZm9yIHRoZSBzY2FsZS4KICAgICAgICAgICAgICAgICAgICAvLyBJZiBhdXRvX3RpY2tzIGlzIHRydWUgdGhlbiB0aGUgc2NhbGUgbWlnaHQgYmUgc2xpZ2h0bHkgYWRqdXN0ZWQKICAgICAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IHRoZSBtaW4gYW5kIG1heCB2YWx1ZXMgZmFsbHMgb24gYW4gZXZlbiBtYWpvciBzdGVwLgogICAgICAgICAgICAgICAgICAgICRtaW4gPSAkdGhpcy0+eW5zY2FsZVskaV0tPnNjYWxlWzBdOwogICAgICAgICAgICAgICAgICAgICRtYXggPSAkdGhpcy0+eW5zY2FsZVskaV0tPnNjYWxlWzFdOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT55bnNjYWxlWyRpXS0+QXV0b1NjYWxlKCR0aGlzLT5pbWcsJG1pbiwkbWF4LAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPnBsb3RoZWlnaHQvJHRoaXMtPnl0aWNrX2ZhY3RvciwKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+eW5zY2FsZVskaV0tPmF1dG9fdGlja3MpOwoKICAgICAgICAgICAgICAgICAgICAvLyBOb3cgbWFrZSBzdXJlIHdlIHNob3cgZW5vdWdoIHByZWNpc2lvbiB0byBhY2N1cmF0ZSBkaXNwbGF5IHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGxhYmVscy4gSWYgdGhpcyBpcyBub3QgZG9uZSB0aGVuIHRoZSB1c2VyIG1pZ2h0IGVuZCB1cCB3aXRoCiAgICAgICAgICAgICAgICAgICAgLy8gYSBzY2FsZSB0aGF0IG1pZ2h0IGFjdHVhbGx5IHN0YXJ0IHdpdGgsIHNheSAxMy41LCBidXRkdWUgdG8gcm91bmRpbmcKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2NhbGUgbGFiZWwgd2lsbCBvbnkgc2hvdyAxNC4KICAgICAgICAgICAgICAgICAgICBpZiggYWJzKGZsb29yKCRtaW4pLSRtaW4pID4gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgaGFzIHNldCBhIGZvcm1hdCB0aGVuIHdlIGJhaWwgb3V0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+eW5zY2FsZVskaV0tPnRpY2tzLT5sYWJlbF9mb3JtYXRzdHIgPT0gJycgJiYgJHRoaXMtPnluc2NhbGVbJGldLT50aWNrcy0+bGFiZWxfZGF0ZWZvcm1hdHN0ciA9PSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT55bnNjYWxlWyRpXS0+dGlja3MtPnByZWNpc2lvbiA9IGFicyggZmxvb3IobG9nMTAoIGFicyhmbG9vcigkbWluKS0kbWluKSkpICkrMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBkb0F1dG9TY2FsZVlBeGlzKCkgewoKICAgICAgICAvL0NoZWNrIGlmIHdlIHNob3VsZCBhdXRvc2NhbGUgeS1heGlzCiAgICAgICAgaWYoICEkdGhpcy0+eXNjYWxlLT5Jc1NwZWNpZmllZCgpICYmIGNvdW50KCR0aGlzLT5wbG90cyk+MCApIHsKICAgICAgICAgICAgbGlzdCgkbWluLCRtYXgpID0gJHRoaXMtPkdldFBsb3RzWU1pbk1heCgkdGhpcy0+cGxvdHMpOwogICAgICAgICAgICAkbHJlcyA9ICR0aGlzLT5HZXRMaW5lc1lNaW5NYXgoJHRoaXMtPmxpbmVzKTsKICAgICAgICAgICAgaWYoIGlzX2FycmF5KCRscmVzKSApIHsKICAgICAgICAgICAgICAgIGxpc3QoJGxpbm1pbiwkbGlubWF4KSA9ICRscmVzIDsKICAgICAgICAgICAgICAgICRtaW4gPSBtaW4oJG1pbiwkbGlubWluKTsKICAgICAgICAgICAgICAgICRtYXggPSBtYXgoJG1heCwkbGlubWF4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdHJlcyA9ICR0aGlzLT5HZXRUZXh0c1lNaW5NYXgoKTsKICAgICAgICAgICAgaWYoIGlzX2FycmF5KCR0cmVzKSApIHsKICAgICAgICAgICAgICAgIGxpc3QoJHRtaW4sJHRtYXgpID0gJHRyZXMgOwogICAgICAgICAgICAgICAgJG1pbiA9IG1pbigkbWluLCR0bWluKTsKICAgICAgICAgICAgICAgICRtYXggPSBtYXgoJG1heCwkdG1heCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPnlzY2FsZS0+QXV0b1NjYWxlKCR0aGlzLT5pbWcsJG1pbiwkbWF4LAogICAgICAgICAgICAkdGhpcy0+aW1nLT5wbG90aGVpZ2h0LyR0aGlzLT55dGlja19mYWN0b3IpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT55c2NhbGUtPklzU3BlY2lmaWVkKCkgJiYgKCAkdGhpcy0+eXNjYWxlLT5hdXRvX3RpY2tzIHx8ICEkdGhpcy0+eXNjYWxlLT50aWNrcy0+SXNTcGVjaWZpZWQoKSkgKSB7CiAgICAgICAgICAgIC8vIFRoZSB0aWNrIGNhbGN1bGF0aW9uIHdpbGwgdXNlIHRoZSB1c2VyIHN1cGxpZWQgbWluL21heCB2YWx1ZXMgdG8gZGV0ZXJtaW5lCiAgICAgICAgICAgIC8vIHRoZSB0aWNrcy4gSWYgYXV0b190aWNrcyBpcyBmYWxzZSB0aGUgZXhhY3QgdXNlciBzcGVjaWZlZCBtaW4gYW5kIG1heAogICAgICAgICAgICAvLyB2YWx1ZXMgd2lsbCBiZSB1c2VkIGZvciB0aGUgc2NhbGUuCiAgICAgICAgICAgIC8vIElmIGF1dG9fdGlja3MgaXMgdHJ1ZSB0aGVuIHRoZSBzY2FsZSBtaWdodCBiZSBzbGlnaHRseSBhZGp1c3RlZAogICAgICAgICAgICAvLyBzbyB0aGF0IHRoZSBtaW4gYW5kIG1heCB2YWx1ZXMgZmFsbHMgb24gYW4gZXZlbiBtYWpvciBzdGVwLgogICAgICAgICAgICAkbWluID0gJHRoaXMtPnlzY2FsZS0+c2NhbGVbMF07CiAgICAgICAgICAgICRtYXggPSAkdGhpcy0+eXNjYWxlLT5zY2FsZVsxXTsKICAgICAgICAgICAgJHRoaXMtPnlzY2FsZS0+QXV0b1NjYWxlKCR0aGlzLT5pbWcsJG1pbiwkbWF4LAogICAgICAgICAgICAkdGhpcy0+aW1nLT5wbG90aGVpZ2h0LyR0aGlzLT55dGlja19mYWN0b3IsCiAgICAgICAgICAgICR0aGlzLT55c2NhbGUtPmF1dG9fdGlja3MpOwoKICAgICAgICAgICAgLy8gTm93IG1ha2Ugc3VyZSB3ZSBzaG93IGVub3VnaCBwcmVjaXNpb24gdG8gYWNjdXJhdGUgZGlzcGxheSB0aGUKICAgICAgICAgICAgLy8gbGFiZWxzLiBJZiB0aGlzIGlzIG5vdCBkb25lIHRoZW4gdGhlIHVzZXIgbWlnaHQgZW5kIHVwIHdpdGgKICAgICAgICAgICAgLy8gYSBzY2FsZSB0aGF0IG1pZ2h0IGFjdHVhbGx5IHN0YXJ0IHdpdGgsIHNheSAxMy41LCBidXRkdWUgdG8gcm91bmRpbmcKICAgICAgICAgICAgLy8gdGhlIHNjYWxlIGxhYmVsIHdpbGwgb255IHNob3cgMTQuCiAgICAgICAgICAgIGlmKCBhYnMoZmxvb3IoJG1pbiktJG1pbikgPiAwICkgewoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSB1c2VyIGhhcyBzZXQgYSBmb3JtYXQgdGhlbiB3ZSBiYWlsIG91dAogICAgICAgICAgICAgICAgaWYoICR0aGlzLT55c2NhbGUtPnRpY2tzLT5sYWJlbF9mb3JtYXRzdHIgPT0gJycgJiYgJHRoaXMtPnlzY2FsZS0+dGlja3MtPmxhYmVsX2RhdGVmb3JtYXRzdHIgPT0gJycgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnlzY2FsZS0+dGlja3MtPnByZWNpc2lvbiA9IGFicyggZmxvb3IobG9nMTAoIGFicyhmbG9vcigkbWluKS0kbWluKSkpICkrMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgZnVuY3Rpb24gSW5pdFNjYWxlQ29uc3RhbnRzKCkgewogICAgICAgIC8vIFNldHVwIHNjYWxlIGNvbnN0YW50cwogICAgICAgIGlmKCAkdGhpcy0+eXNjYWxlICkgJHRoaXMtPnlzY2FsZS0+SW5pdENvbnN0YW50cygkdGhpcy0+aW1nKTsKICAgICAgICBpZiggJHRoaXMtPnhzY2FsZSApICR0aGlzLT54c2NhbGUtPkluaXRDb25zdGFudHMoJHRoaXMtPmltZyk7CiAgICAgICAgaWYoICR0aGlzLT55MnNjYWxlICkgJHRoaXMtPnkyc2NhbGUtPkluaXRDb25zdGFudHMoJHRoaXMtPmltZyk7CgogICAgICAgICRuPWNvdW50KCR0aGlzLT55bnNjYWxlKTsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSkgewogICAgICAgICAgICBpZiggJHRoaXMtPnluc2NhbGVbJGldICkgewogICAgICAgICAgICAgICAgJHRoaXMtPnluc2NhbGVbJGldLT5Jbml0Q29uc3RhbnRzKCR0aGlzLT5pbWcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRvUHJlc3Ryb2tlQWRqdXN0bWVudHMoKSB7CgogICAgICAgIC8vIERvIGFueSBwcmUtc3Ryb2tlIGFkanVzdG1lbnQgdGhhdCBpcyBuZWVkZWQgYnkgdGhlIGRpZmZlcmVudCBwbG90IHR5cGVzCiAgICAgICAgLy8gKGkuZSBiYXIgcGxvdHMgd2FudCdzIHRvIGFkZCBhbiBvZmZzZXQgdG8gdGhlIHgtbGFiZWxzIGV0YykKICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkdGhpcy0+cGxvdHMpIDsgKyskaSApIHsKICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+UHJlU3Ryb2tlQWRqdXN0KCR0aGlzKTsKICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+RG9MZWdlbmQoJHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gQW55IHBsb3RzIG9uIHRoZSBzZWNvbmQgWSBzY2FsZT8KICAgICAgICBpZiggJHRoaXMtPnkyc2NhbGUgIT0gbnVsbCApIHsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpPGNvdW50KCR0aGlzLT55MnBsb3RzKSA7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+eTJwbG90c1skaV0tPlByZVN0cm9rZUFkanVzdCgkdGhpcyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+eTJwbG90c1skaV0tPkRvTGVnZW5kKCR0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQW55IHBsb3RzIG9uIHRoZSBleHRyYSBZIGF4aXNlcz8KICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT55bmF4aXMpOwogICAgICAgIGZvcigkaT0wOyAkaTwkbiA7ICsrJGkgKSB7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+eW5wbG90cyA9PSBudWxsIHx8ICR0aGlzLT55bnBsb3RzWyRpXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAzMiwkaSk7Ly8oIk5vIHBsb3RzIGZvciBZLWF4aXMgbmJyOiRpIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG0gPSBjb3VudCgkdGhpcy0+eW5wbG90c1skaV0pOwogICAgICAgICAgICBmb3IoJGo9MDsgJGogPCAkbTsgKyskaiApIHsKICAgICAgICAgICAgICAgICR0aGlzLT55bnBsb3RzWyRpXVskal0tPlByZVN0cm9rZUFkanVzdCgkdGhpcyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+eW5wbG90c1skaV1bJGpdLT5Eb0xlZ2VuZCgkdGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlQmFuZHMoJGFEZXB0aCwkYUNTSU0pIHsKICAgIC8vIFN0cm9rZSBiYW5kcwogICAgICAgIGlmKCAkdGhpcy0+YmFuZHMgIT0gbnVsbCAmJiAhJGFDU0lNKSB7CiAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8IGNvdW50KCR0aGlzLT5iYW5kcyk7ICsrJGkpIHsKICAgICAgICAgICAgLy8gU3Ryb2tlIGFsbCBiYW5kcyB0aGF0IGFza3MgdG8gYmUgaW4gdGhlIGJhY2tncm91bmQKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+YmFuZHNbJGldLT5kZXB0aCA9PSAkYURlcHRoICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5iYW5kc1skaV0tPlN0cm9rZSgkdGhpcy0+aW1nLCR0aGlzLT54c2NhbGUsJHRoaXMtPnlzY2FsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCAkdGhpcy0+eTJiYW5kcyAhPSBudWxsICYmICR0aGlzLT55MnNjYWxlICE9IG51bGwgJiYgISRhQ1NJTSApIHsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgY291bnQoJHRoaXMtPnkyYmFuZHMpOyArKyRpKSB7CiAgICAgICAgICAgIC8vIFN0cm9rZSBhbGwgYmFuZHMgdGhhdCBhc2tzIHRvIGJlIGluIHRoZSBmb3JlZ3JvdW5kCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnkyYmFuZHNbJGldLT5kZXB0aCA9PSAkYURlcHRoICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT55MmJhbmRzWyRpXS0+U3Ryb2tlKCR0aGlzLT5pbWcsJHRoaXMtPnhzY2FsZSwkdGhpcy0+eTJzY2FsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8vIFN0cm9rZSB0aGUgZ3JhcGgKICAgIC8vICRhU3Ryb2tlRmlsZU5hbWUgSWYgIT0gIiIgdGhlIGltYWdlIHdpbGwgYmUgd3JpdHRlbiB0byB0aGlzIGZpbGUgYW5kIE5PVAogICAgLy8gc3RyZWFtZWQgYmFjayB0byB0aGUgYnJvd3NlcgogICAgZnVuY3Rpb24gU3Ryb2tlKCRhU3Ryb2tlRmlsZU5hbWU9JycpIHsKICAgICAgICAvLyBGaXN0IG1ha2UgYSBzYW5pdHkgY2hlY2sgdGhhdCB1c2VyIGhhcyBzcGVjaWZpZWQgYSBzY2FsZQogICAgICAgIGlmKCBlbXB0eSgkdGhpcy0+eXNjYWxlKSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMzEpOy8vKCdZb3UgbXVzdCBzcGVjaWZ5IHdoYXQgc2NhbGUgdG8gdXNlIHdpdGggYSBjYWxsIHRvIEdyYXBoOjpTZXRTY2FsZSgpLicpOwogICAgICAgIH0KCiAgICAgICAgLy8gU3RhcnQgYnkgYWRqdXN0aW5nIHRoZSBtYXJnaW4gc28gdGhhdCBwb3RlbnRpYWwgdGl0bGVzIHdpbGwgZml0LgogICAgICAgICR0aGlzLT5BZGp1c3RNYXJnaW5zRm9yVGl0bGVzKCk7CgogICAgICAgIC8vIEdpdmUgdGhlIHBsb3QgYSBjaGFuY2UgdG8gZG8gYW55IHNjYWxlIGFkanVtZW50cyB0aGUgaW5kaXZpZHVhbCBwbG90cwogICAgICAgIC8vIHdhbnRzIHRvIGRvLiBSaWdodCBub3cgdGhpcyBpcyBvbmx5IHVzZWQgYnkgdGhlIGNvbnRvdXIgcGxvdCB0byBzZXQgc2NhbGUKICAgICAgICAvLyBsaW1pdHMKICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkdGhpcy0+cGxvdHMpIDsgKyskaSApIHsKICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+UHJlU2NhbGVTZXR1cCgkdGhpcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBJbml0IHNjYWxlIGNvbnN0YW50cyB0aGF0IGFyZSB1c2VkIHRvIGNhbGN1bGF0ZSB0aGUgdHJhbnNmb3JtYXRpb24gZnJvbQogICAgICAgIC8vIHdvcmxkIHRvIHBpeGVsIGNvb3JkaW5hdGVzCiAgICAgICAgJHRoaXMtPkluaXRTY2FsZUNvbnN0YW50cygpOwoKICAgICAgICAvLyBJZiB0aGUgZmlsZW5hbWUgaXMgdGhlIHByZWRlZmluZWQgdmFsdWUgPSAnX2NzaW1fc3BlY2lhbF8nCiAgICAgICAgLy8gd2UgYXNzdW1lIHRoYXQgdGhlIGNhbGwgdG8gc3Ryb2tlIG9ubHkgbmVlZHMgdG8gZG8gZW5vdWdoCiAgICAgICAgLy8gdG8gY29ycmVjdGx5IGdlbmVyYXRlIHRoZSBDU0lNIG1hcHMuCiAgICAgICAgLy8gV2UgdXNlIHRoaXMgdmFyaWFibGUgdG8gc2tpcCB0aGluZ3Mgd2UgZG9uJ3Qgc3RyaWN0bHkgbmVlZAogICAgICAgIC8vIHRvIGRvIHRvIGdlbmVyYXRlIHRoZSBpbWFnZSBtYXAgdG8gaW1wcm92ZSBwZXJmb3JtYW5jZQogICAgICAgIC8vIGEgYmVzdCB3ZSBjYW4uIFRoZXJlZm9yIHlvdSB3aWxsIHNlZSBhIGxvdCBvZiB0ZXN0cyAhJF9jc2ltIGluIHRoZQogICAgICAgIC8vIGNvZGUgYmVsb3cuCiAgICAgICAgJF9jc2ltID0gKCRhU3Ryb2tlRmlsZU5hbWU9PT1fQ1NJTV9TUEVDSUFMRklMRSk7CgogICAgICAgIC8vIElmIHdlIGFyZSBjYWxsZWQgdGhlIHNlY29uZCB0aW1lIChwZXJoYXBzIHRoZSB1c2VyIGhhcyBjYWxsZWQgR2V0SFRNTEltYWdlTWFwKCkKICAgICAgICAvLyBoaW1zZWxmIHRoZW4gdGhlIGxlZ2VuZHMgaGF2ZSBhbHNyZWFkeSBiZWVuIHBvcHVsYXRlZCBvbmNlIGluIG9yZGVyIHRvIGdldCB0aGUKICAgICAgICAvLyBDU0lNIGNvb3JkaW5hdHMuIFNpbmNlIHdlIGRvIG5vdCB3YW50IHRoZSBsZWdlbmRzIHRvIGJlIHBvcHVsYXRlZCBhIHNlY29uZCB0aW1lCiAgICAgICAgLy8gd2UgY2xlYXIgdGhlIGxlZ2VuZHMKICAgICAgICAkdGhpcy0+bGVnZW5kLT5DbGVhcigpOwoKICAgICAgICAvLyBXZSBuZWVkIHRvIGtub3cgaWYgd2UgaGF2ZSBzdHJva2VkIHRoZSBwbG90IGluIHRoZQogICAgICAgIC8vIEdldENTSU1hcmVhcy4gT3RoZXJ3aXNlIHRoZSBDU0lNIGhhc24ndCBiZWVuIGdlbmVyYXRlZAogICAgICAgIC8vIGFuZCBpbiB0aGUgY2FzZSBvZiBHZXRDU0lNIGNhbGxlZCBiZWZvcmUgc3Ryb2tlIHRvIGdlbmVyYXRlCiAgICAgICAgLy8gQ1NJTSB3aXRob3V0IHN0b3JpbmcgYW4gaW1hZ2UgdG8gZGlzayBHZXRDU0lNIG11c3QgY2FsbCBTdHJva2UuCiAgICAgICAgJHRoaXMtPmlIYXNTdHJva2VkID0gdHJ1ZTsKCiAgICAgICAgLy8gU2V0dXAgcHJlLXN0cm9rZWQgYWRqdXN0bWVudHMgYW5kIExlZ2VuZHMKICAgICAgICAkdGhpcy0+ZG9QcmVzdHJva2VBZGp1c3RtZW50cygpOwoKICAgICAgICBpZiAoJHRoaXMtPmdyYXBoX3RoZW1lKSB7CiAgICAgICAgICAgICR0aGlzLT5ncmFwaF90aGVtZS0+UHJlU3Ryb2tlQXBwbHkoJHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gQmFpbCBvdXQgaWYgYW55IG9mIHRoZSBZLWF4aXMgbm90IGJlZW4gc3BlY2lmaWVkIGFuZAogICAgICAgIC8vIGhhcyBubyBwbG90cy4gKFRoaXMgbWVhbnMgaXQgaXMgaW1wb3NzaWJsZSB0byBkbyBhdXRvc2NhbGluZyBhbmQKICAgICAgICAvLyBubyBvdGhlciBzY2FsZSB3YXMgZ2l2ZW4gc28gd2UgY2FuJ3QgcG9zc2libGUgZHJhdyBhbnl0aGluZykuIElmIHlvdSB1c2UgbWFudWFsCiAgICAgICAgLy8gc2NhbGluZyB5b3UgYWxzbyBoYXZlIHRvIHN1cHBseSB0aGUgdGljayBzdGVwcyBhcyB3ZWxsLgogICAgICAgIGlmKCAoISR0aGlzLT55c2NhbGUtPklzU3BlY2lmaWVkKCkgJiYgY291bnQoJHRoaXMtPnBsb3RzKT09MCkgfHwKICAgICAgICAgICAgKCR0aGlzLT55MnNjYWxlIT1udWxsICYmICEkdGhpcy0+eTJzY2FsZS0+SXNTcGVjaWZpZWQoKSAmJiBjb3VudCgkdGhpcy0+eTJwbG90cyk9PTApICkgewogICAgICAgICAgICAvLyRlID0gIm49Ii5jb3VudCgkdGhpcy0+eTJwbG90cykuIlxuIjsKICAgICAgICAgICAgLy8gJGUgPSAiQ2FuJ3QgZHJhdyB1bnNwZWNpZmllZCBZLXNjYWxlLjxicj5cbllvdSBoYXZlIGVpdGhlcjo8YnI+XG4iOwogICAgICAgICAgICAvLyAkZSAuPSAiMS4gU3BlY2lmaWVkIGFuIFkgYXhpcyBmb3IgYXV0b3NjYWxpbmcgYnV0IGhhdmUgbm90IHN1cHBsaWVkIGFueSBwbG90czxicj5cbiI7CiAgICAgICAgICAgIC8vICRlIC49ICIyLiBTcGVjaWZpZWQgYSBzY2FsZSBtYW51YWxseSBidXQgaGF2ZSBmb3Jnb3QgdG8gc3BlY2lmeSB0aGUgdGljayBzdGVwcyI7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDI2KTsKICAgICAgICB9CgogICAgICAgIC8vIEJhaWwgb3V0IGlmIG5vIHBsb3RzIGFuZCBubyBzcGVjaWZpZWQgWC1zY2FsZQogICAgICAgIGlmKCAoISR0aGlzLT54c2NhbGUtPklzU3BlY2lmaWVkKCkgJiYgY291bnQoJHRoaXMtPnBsb3RzKT09MCAmJiBjb3VudCgkdGhpcy0+eTJwbG90cyk9PTApICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAzNCk7Ly8oIjxzdHJvbmc+SnBHcmFwaDogQ2FuJ3QgZHJhdyB1bnNwZWNpZmllZCBYLXNjYWxlLjwvc3Ryb25nPjxicj5ObyBwbG90cy48YnI+Iik7CiAgICAgICAgfQoKICAgICAgICAvLyBBdXRvc2NhbGUgdGhlIG5vcm1hbCBZLWF4aXMKICAgICAgICAkdGhpcy0+ZG9BdXRvU2NhbGVZQXhpcygpOwoKICAgICAgICAvLyBBdXRvc2NhbGUgYWxsIGFkZGl0aW9wbmFsIHktYXhpcwogICAgICAgICR0aGlzLT5kb0F1dG9TY2FsZVluQXhpcygpOwoKICAgICAgICAvLyBBdXRvc2NhbGUgdGhlIHJlZ3VsYXIgeC1heGlzIGFuZCBwb3NpdGlvbiB0aGUgeS1heGlzIHByb3Blcmx5CiAgICAgICAgJHRoaXMtPmRvQXV0b1NjYWxlWEF4aXMoKTsKCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIG5lZ2F0aXZlIHZhbHVlcyBhbmQgeC1heGlzIHBvc2l0aW9uIGlzIGF0IDAKICAgICAgICAvLyB3ZSBuZWVkIHRvIHN1cHJlc3MgdGhlIGZpcnN0IGFuZCBwb3NzaWJsZSB0aGUgbGFzdCB0aWNrIHNpbmNlCiAgICAgICAgLy8gdGhleSB3aWxsIGJlIGRyYXduIG9uIHRvcCBvZiB0aGUgeS1heGlzIChhbmQgcG9zc2libGUgeTIgYXhpcykKICAgICAgICAvLyBUaGUgdGVzdCBiZWxvdyBtaWdodCBzZWVtIHN0cmFuZ2UgdGhlIHJlYXNvbmUgYmVpbmcgdGhhdCBpZgogICAgICAgIC8vIHRoZSB1c2VyIGhhc24ndCBzcGVjaWZpZWQgYSB2YWx1ZSBmb3IgcG9zaXRpb24gdGhpcyB3aWxsIG5vdAogICAgICAgIC8vIGJlIHNldCB1bnRpbCB3ZSBkbyB0aGUgc3Ryb2tlIGZvciB0aGUgYXhpcyBzbyBhcyBvZiBub3cgaXQKICAgICAgICAvLyBpcyB1bmRlZmluZWQuCiAgICAgICAgLy8gRm9yIFgtdGV4dCBzY2FsZSB3ZSBpZ25vcmUgYWxsIHRoaXMgc2luY2UgdGhlIHRpY2sgYXJlIHVzdWFsbHkKICAgICAgICAvLyBtdWNoIGZ1cnRoZXIgaW4gYW5kIG5vdCBjbG9zZSB0byB0aGUgWS1heGlzLiBIZW5jZSB0aGUgdGVzdAogICAgICAgIC8vIGZvciAndGV4dCcKICAgICAgICBpZiggKCR0aGlzLT55YXhpcy0+cG9zPT0kdGhpcy0+eHNjYWxlLT5HZXRNaW5WYWwoKSB8fCAoaXNfc3RyaW5nKCR0aGlzLT55YXhpcy0+cG9zKSAmJiAkdGhpcy0+eWF4aXMtPnBvcz09J21pbicpKSAmJgogICAgICAgICAgICAhaXNfbnVtZXJpYygkdGhpcy0+eGF4aXMtPnBvcykgJiYgJHRoaXMtPnlzY2FsZS0+R2V0TWluVmFsKCkgPCAwICYmCiAgICAgICAgICAgIHN1YnN0cigkdGhpcy0+YXh0eXBlLDAsNCkgIT0gJ3RleHQnICYmICR0aGlzLT54YXhpcy0+cG9zICE9ICdtaW4nICkgewoKICAgICAgICAgICAgLy8kdGhpcy0+eXNjYWxlLT50aWNrcy0+U3VwcmVzc1plcm9MYWJlbChmYWxzZSk7CiAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPnRpY2tzLT5TdXByZXNzRmlyc3QoKTsKICAgICAgICAgICAgaWYoICR0aGlzLT55MmF4aXMgIT0gbnVsbCApIHsKICAgICAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPnRpY2tzLT5TdXByZXNzTGFzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggIWlzX251bWVyaWMoJHRoaXMtPnlheGlzLT5wb3MpICYmICR0aGlzLT55YXhpcy0+cG9zPT0nbWF4JyApIHsKICAgICAgICAgICAgJHRoaXMtPnhzY2FsZS0+dGlja3MtPlN1cHJlc3NMYXN0KCk7CiAgICAgICAgfQoKICAgICAgICBpZiggISRfY3NpbSApIHsKICAgICAgICAgICAgJHRoaXMtPlN0cm9rZVBsb3RBcmVhKCk7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+aUljb25EZXB0aCA9PSBERVBUSF9CQUNLICkgewogICAgICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUljb25zKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPlN0cm9rZUF4aXMoZmFsc2UpOwoKICAgICAgICAvLyBTdHJva2UgY29sb3JlZCBiYW5kcwogICAgICAgICR0aGlzLT5TdHJva2VCYW5kcyhERVBUSF9CQUNLLCRfY3NpbSk7CgogICAgICAgIGlmKCAkdGhpcy0+Z3JpZF9kZXB0aCA9PSBERVBUSF9CQUNLICYmICEkX2NzaW0pIHsKICAgICAgICAgICAgJHRoaXMtPnlncmlkLT5TdHJva2UoKTsKICAgICAgICAgICAgJHRoaXMtPnhncmlkLT5TdHJva2UoKTsKICAgICAgICB9CgogICAgICAgIC8vIFN0cm9rZSBZMi1heGlzCiAgICAgICAgaWYoICR0aGlzLT55MmF4aXMgIT0gbnVsbCAmJiAhJF9jc2ltKSB7CiAgICAgICAgICAgICR0aGlzLT55MmF4aXMtPlN0cm9rZSgkdGhpcy0+eHNjYWxlKTsKICAgICAgICAgICAgJHRoaXMtPnkyZ3JpZC0+U3Ryb2tlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdHJva2UgeW4tYXhpcwogICAgICAgICRuID0gY291bnQoJHRoaXMtPnluYXhpcyk7CiAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAkdGhpcy0+eW5heGlzWyRpXS0+U3Ryb2tlKCR0aGlzLT54c2NhbGUpOwogICAgICAgIH0KCiAgICAgICAgJG9sZG9mZj0kdGhpcy0+eHNjYWxlLT5vZmY7CiAgICAgICAgaWYoIHN1YnN0cigkdGhpcy0+YXh0eXBlLDAsNCkgPT0gJ3RleHQnICkgewogICAgICAgICAgICBpZiggJHRoaXMtPnRleHRfc2NhbGVfYWJzY2VudGVyb2ZmID4gLTEgKSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgYSB0ZXh0IHNjYWxlIHRoZSBzY2FsZSBmYWN0b3IgaXMgdGhlIG51bWJlciBvZiBwaXhlbCBwZXIgc3RlcC4KICAgICAgICAgICAgICAgIC8vIEhlbmNlIHdlIGNhbiB1c2UgdGhlIHNjYWxlIGZhY3RvciBhcyBhIHN1YnN0aXR1dGUgZm9yIG51bWJlciBvZiBwaXhlbHMKICAgICAgICAgICAgICAgIC8vIHBlciBtYWpvciBzY2FsZSBzdGVwIGFuZCB1c2UgdGhhdCBpbiBvcmRlciB0byBhZGp1c3QgdGhlIG9mZnNldCBzbyB0aGF0CiAgICAgICAgICAgICAgICAvLyBhbiBvYmplY3Qgb2Ygd2lkdGggImFic2NlbnRlcm9mZiIgYmVjb21lcyBjZW50ZXJlZC4KICAgICAgICAgICAgICAgICR0aGlzLT54c2NhbGUtPm9mZiArPSByb3VuZCgkdGhpcy0+eHNjYWxlLT5zY2FsZV9mYWN0b3IvMiktcm91bmQoJHRoaXMtPnRleHRfc2NhbGVfYWJzY2VudGVyb2ZmLzIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHRoaXMtPnhzY2FsZS0+b2ZmICs9IGNlaWwoJHRoaXMtPnhzY2FsZS0+c2NhbGVfZmFjdG9yKiR0aGlzLT50ZXh0X3NjYWxlX29mZiokdGhpcy0+eHNjYWxlLT50aWNrcy0+bWlub3Jfc3RlcCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCAkdGhpcy0+aURvQ2xpcHBpbmcgKSB7CiAgICAgICAgICAgICRvbGRpbWFnZSA9ICR0aGlzLT5pbWctPkNsb25lQ2FudmFzSCgpOwogICAgICAgIH0KCiAgICAgICAgaWYoICEgJHRoaXMtPnkyb3JkZXJiYWNrICkgewogICAgICAgICAgICAvLyBTdHJva2UgYWxsIHBsb3RzIGZvciBZMSBheGlzCiAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8IGNvdW50KCR0aGlzLT5wbG90cyk7ICsrJGkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skaV0tPlN0cm9rZSgkdGhpcy0+aW1nLCR0aGlzLT54c2NhbGUsJHRoaXMtPnlzY2FsZSk7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT5TdHJva2VNYXJnaW4oJHRoaXMtPmltZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFN0cm9rZSBhbGwgcGxvdHMgZm9yIFkyIGF4aXMKICAgICAgICBpZiggJHRoaXMtPnkyc2NhbGUgIT0gbnVsbCApIHsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpPCBjb3VudCgkdGhpcy0+eTJwbG90cyk7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+eTJwbG90c1skaV0tPlN0cm9rZSgkdGhpcy0+aW1nLCR0aGlzLT54c2NhbGUsJHRoaXMtPnkyc2NhbGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPnkyb3JkZXJiYWNrICkgewogICAgICAgICAgICAvLyBTdHJva2UgYWxsIHBsb3RzIGZvciBZMSBheGlzCiAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8IGNvdW50KCR0aGlzLT5wbG90cyk7ICsrJGkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skaV0tPlN0cm9rZSgkdGhpcy0+aW1nLCR0aGlzLT54c2NhbGUsJHRoaXMtPnlzY2FsZSk7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT5TdHJva2VNYXJnaW4oJHRoaXMtPmltZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRuID0gY291bnQoJHRoaXMtPnluYXhpcyk7CiAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAkbSA9IGNvdW50KCR0aGlzLT55bnBsb3RzWyRpXSk7CiAgICAgICAgICAgIGZvciggJGo9MDsgJGogPCAkbTsgKyskaiApIHsKICAgICAgICAgICAgICAgICR0aGlzLT55bnBsb3RzWyRpXVskal0tPlN0cm9rZSgkdGhpcy0+aW1nLCR0aGlzLT54c2NhbGUsJHRoaXMtPnluc2NhbGVbJGldKTsKICAgICAgICAgICAgICAgICR0aGlzLT55bnBsb3RzWyRpXVskal0tPlN0cm9rZU1hcmdpbigkdGhpcy0+aW1nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT5pSWNvbkRlcHRoID09IERFUFRIX0ZST05UKSB7CiAgICAgICAgICAgICR0aGlzLT5TdHJva2VJY29ucygpOwogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT5pRG9DbGlwcGluZyApIHsKICAgICAgICAgICAgLy8gQ2xpcHBpbmcgb25seSBzdXBwb3J0cyBncmFwaHMgYXQgMCBhbmQgOTAgZGVncmVlcwogICAgICAgICAgICBpZiggJHRoaXMtPmltZy0+YSA9PSAwICkgewogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+Q29weUNhbnZhc0goJG9sZGltYWdlLCR0aGlzLT5pbWctPmltZywKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPmxlZnRfbWFyZ2luLCR0aGlzLT5pbWctPnRvcF9tYXJnaW4sCiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbiwkdGhpcy0+aW1nLT50b3BfbWFyZ2luLAogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+cGxvdHdpZHRoKzEsJHRoaXMtPmltZy0+cGxvdGhlaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCAkdGhpcy0+aW1nLT5hID09IDkwICkgewogICAgICAgICAgICAgICAgJGFkaiA9ICgkdGhpcy0+aW1nLT5oZWlnaHQgLSAkdGhpcy0+aW1nLT53aWR0aCkvMjsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPkNvcHlDYW52YXNIKCRvbGRpbWFnZSwkdGhpcy0+aW1nLT5pbWcsCiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5ib3R0b21fbWFyZ2luLSRhZGosJHRoaXMtPmltZy0+bGVmdF9tYXJnaW4rJGFkaiwKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPmJvdHRvbV9tYXJnaW4tJGFkaiwkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbiskYWRqLAogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+cGxvdGhlaWdodCsxLCR0aGlzLT5pbWctPnBsb3R3aWR0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAzNSwkdGhpcy0+aW1nLT5hKTsvLygnWW91IGhhdmUgZW5hYmxlZCBjbGlwcGluZy4gQ2xpcGluZyBpcyBvbmx5IHN1cHBvcnRlZCBmb3IgZ3JhcGhzIGF0IDAgb3IgOTAgZGVncmVlcyByb3RhdGlvbi4gUGxlYXNlIGFkanVzdCB5b3UgY3VycmVudCBhbmdsZSAoPScuJHRoaXMtPmltZy0+YS4nIGRlZ3JlZXMpIG9yIGRpc2FibGUgY2xpcHBpbmcuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPmltZy0+RGVzdHJveSgpOwogICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRDYW52YXNIKCRvbGRpbWFnZSk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+eHNjYWxlLT5vZmY9JG9sZG9mZjsKCiAgICAgICAgaWYoICR0aGlzLT5ncmlkX2RlcHRoID09IERFUFRIX0ZST05UICYmICEkX2NzaW0gKSB7CiAgICAgICAgICAgICR0aGlzLT55Z3JpZC0+U3Ryb2tlKCk7CiAgICAgICAgICAgICR0aGlzLT54Z3JpZC0+U3Ryb2tlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdHJva2UgY29sb3JlZCBiYW5kcwogICAgICAgICR0aGlzLT5TdHJva2VCYW5kcyhERVBUSF9GUk9OVCwkX2NzaW0pOwoKICAgICAgICAvLyBGaW5hbGx5IGRyYXcgdGhlIGF4aXMgYWdhaW4gc2luY2Ugc29tZSBwbG90cyBtYXkgaGF2ZSBuYWdnZWQKICAgICAgICAvLyB0aGUgYXhpcyBpbiB0aGUgZWRnZXMuCiAgICAgICAgaWYoICEkX2NzaW0gKSB7CiAgICAgICAgICAgICR0aGlzLT5TdHJva2VBeGlzKCk7CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPnkyc2NhbGUgIT0gbnVsbCAmJiAhJF9jc2ltICkgewogICAgICAgICAgICAkdGhpcy0+eTJheGlzLT5TdHJva2UoJHRoaXMtPnhzY2FsZSxmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBpZiggISRfY3NpbSApIHsKICAgICAgICAgICAgJHRoaXMtPlN0cm9rZVBsb3RCb3goKTsKICAgICAgICB9CgogICAgICAgIC8vIFRoZSB0aXRsZXMgYW5kIGxlZ2VuZHMgbmV2ZXIgZ2V0cyByb3RhdGVkIHNvIG1ha2Ugc3VyZQogICAgICAgIC8vIHRoYXQgdGhlIGFuZ2xlIGlzIDAgYmVmb3JlIHN0cm9raW5nIHRoZW0KICAgICAgICAkYWEgPSAkdGhpcy0+aW1nLT5TZXRBbmdsZSgwKTsKICAgICAgICAkdGhpcy0+U3Ryb2tlVGl0bGVzKCk7CiAgICAgICAgJHRoaXMtPmZvb3Rlci0+U3Ryb2tlKCR0aGlzLT5pbWcpOwogICAgICAgICR0aGlzLT5sZWdlbmQtPlN0cm9rZSgkdGhpcy0+aW1nKTsKICAgICAgICAkdGhpcy0+aW1nLT5TZXRBbmdsZSgkYWEpOwogICAgICAgICR0aGlzLT5TdHJva2VUZXh0cygpOwogICAgICAgICR0aGlzLT5TdHJva2VUYWJsZXMoKTsKCiAgICAgICAgaWYoICEkX2NzaW0gKSB7CgogICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRBbmdsZSgkYWEpOwoKICAgICAgICAgICAgLy8gRHJhdyBhbiBvdXRsaW5lIGFyb3VuZCB0aGUgaW1hZ2UgbWFwCiAgICAgICAgICAgIGlmKF9KUEdfREVCVUcpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5EaXNwbGF5Q2xpZW50U2lkZWFJbWFnZU1hcEFyZWFzKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNob3VsZCB3ZSBkbyBhbnkgZmluYWwgaW1hZ2UgdHJhbnNmb3JtYXRpb24KICAgICAgICAgICAgaWYoICR0aGlzLT5pSW1nVHJhbnMgKSB7CiAgICAgICAgICAgICAgICBpZiggIWNsYXNzX2V4aXN0cygnSW1nVHJhbnMnLGZhbHNlKSApIHsKICAgICAgICAgICAgICAgICAgICByZXF1aXJlX29uY2UoJ2pwZ3JhcGhfaW1ndHJhbnMucGhwJyk7CiAgICAgICAgICAgICAgICAgICAgLy9KcEdyYXBoRXJyb3I6OlJhaXNlKCdJbiBvcmRlciB0byB1c2UgaW1hZ2UgdHJhbnNmb3JtYXRpb24geW91IG11c3QgaW5jbHVkZSB0aGUgZmlsZSBqcGdyYXBoX2ltZ3RyYW5zLnBocCBpbiB5b3VyIHNjcmlwdC4nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkdGZvcm0gPSBuZXcgSW1nVHJhbnMoJHRoaXMtPmltZy0+aW1nKTsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPmltZyA9ICR0Zm9ybS0+U2tldzNEKCR0aGlzLT5pSW1nVHJhbnNIb3Jpem9uLCR0aGlzLT5pSW1nVHJhbnNTa2V3RGlzdCwKICAgICAgICAgICAgICAgICR0aGlzLT5pSW1nVHJhbnNEaXJlY3Rpb24sJHRoaXMtPmlJbWdUcmFuc0hpZ2hRLAogICAgICAgICAgICAgICAgJHRoaXMtPmlJbWdUcmFuc01pblNpemUsJHRoaXMtPmlJbWdUcmFuc0ZpbGxDb2xvciwKICAgICAgICAgICAgICAgICR0aGlzLT5pSW1nVHJhbnNCb3JkZXIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBJZiB0aGUgZmlsZW5hbWUgaXMgZ2l2ZW4gYXMgdGhlIHNwZWNpYWwgIl9faGFuZGxlIgogICAgICAgICAgICAvLyB0aGVuIHRoZSBpbWFnZSBoYW5kbGVyIGlzIHJldHVybmVkIGFuZCB0aGUgaW1hZ2UgaXMgTk9UCiAgICAgICAgICAgIC8vIHN0cmVhbWVkIGJhY2sKICAgICAgICAgICAgaWYoICRhU3Ryb2tlRmlsZU5hbWUgPT0gX0lNR19IQU5ETEVSICkgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5pbWctPmltZzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZpbmFsbHkgc3RyZWFtIHRoZSBnZW5lcmF0ZWQgcGljdHVyZQogICAgICAgICAgICAgICAgJHRoaXMtPmNhY2hlLT5QdXRBbmRTdHJlYW0oJHRoaXMtPmltZywkdGhpcy0+Y2FjaGVfbmFtZSwkdGhpcy0+aW5saW5lLCRhU3Ryb2tlRmlsZU5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEF4aXNMYWJlbEJhY2tncm91bmQoJGFUeXBlLCRhWEZDb2xvcj0nbGlnaHRncmF5JywkYVhDb2xvcj0nYmxhY2snLCRhWUZDb2xvcj0nbGlnaHRncmF5JywkYVlDb2xvcj0nYmxhY2snKSB7CiAgICAgICAgJHRoaXMtPmlBeGlzTGJsQmdUeXBlID0gJGFUeXBlOwogICAgICAgICR0aGlzLT5pWEF4aXNMYmxCZ0ZpbGxDb2xvciA9ICRhWEZDb2xvcjsKICAgICAgICAkdGhpcy0+aVhBeGlzTGJsQmdDb2xvciA9ICRhWENvbG9yOwogICAgICAgICR0aGlzLT5pWUF4aXNMYmxCZ0ZpbGxDb2xvciA9ICRhWUZDb2xvcjsKICAgICAgICAkdGhpcy0+aVlBeGlzTGJsQmdDb2xvciA9ICRhWUNvbG9yOwogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZUF4aXNMYWJlbEJhY2tncm91bmQoKSB7CiAgICAgICAgLy8gVHlwZXMKICAgICAgICAvLyAwID0gTm8gYmFja2dyb3VuZAogICAgICAgIC8vIDEgPSBPbmx5IFgtbGFiZWxzLCBsZW5ndGggb2YgYXhpcwogICAgICAgIC8vIDIgPSBPbmx5IFktbGFiZWxzLCBsZW5ndGggb2YgYXhpcwogICAgICAgIC8vIDMgPSBBcyAxIGJ1dCBleHRlbmRzIHRvIHdpZHRoIG9mIGdyYXBoCiAgICAgICAgLy8gNCA9IEFzIDIgYnV0IGV4dGVuZHMgdG8gaGVpZ2h0IG9mIGdyYXBoCiAgICAgICAgLy8gNSA9IENvbWJpbmF0aW9uIG9mIDMgJiA0CiAgICAgICAgLy8gNiA9IENvbWJpbmF0aW9uIG9mIDEgJiAyCgogICAgICAgICR0ID0gJHRoaXMtPmlBeGlzTGJsQmdUeXBlIDsKICAgICAgICBpZiggJHQgPCAxICkgcmV0dXJuOwoKICAgICAgICAvLyBTdHJva2Ugb3B0aW9uYWwgWC1heGlzIGxhYmVsIGJhY2tncm91bmQgY29sb3IKICAgICAgICBpZiggJHQgPT0gMSB8fCAkdCA9PSAzIHx8ICR0ID09IDUgfHwgJHQgPT0gNiApIHsKICAgICAgICAgICAgJHRoaXMtPmltZy0+UHVzaENvbG9yKCR0aGlzLT5pWEF4aXNMYmxCZ0ZpbGxDb2xvcik7CiAgICAgICAgICAgIGlmKCAkdCA9PSAxIHx8ICR0ID09IDYgKSB7CiAgICAgICAgICAgICAgICAkeGwgPSAkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbjsKICAgICAgICAgICAgICAgICR5dSA9ICR0aGlzLT5pbWctPmhlaWdodCAtICR0aGlzLT5pbWctPmJvdHRvbV9tYXJnaW4gKyAxOwogICAgICAgICAgICAgICAgJHhyID0gJHRoaXMtPmltZy0+d2lkdGggLSAkdGhpcy0+aW1nLT5yaWdodF9tYXJnaW4gOwogICAgICAgICAgICAgICAgJHlsID0gJHRoaXMtPmltZy0+aGVpZ2h0LTEtJHRoaXMtPmZyYW1lX3dlaWdodDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsgLy8gdD09MyB8fCB0PT01CiAgICAgICAgICAgICAgICAkeGwgPSAkdGhpcy0+ZnJhbWVfd2VpZ2h0OwogICAgICAgICAgICAgICAgJHl1ID0gJHRoaXMtPmltZy0+aGVpZ2h0IC0gJHRoaXMtPmltZy0+Ym90dG9tX21hcmdpbiArIDE7CiAgICAgICAgICAgICAgICAkeHIgPSAkdGhpcy0+aW1nLT53aWR0aCAtIDEgLSAkdGhpcy0+ZnJhbWVfd2VpZ2h0OwogICAgICAgICAgICAgICAgJHlsID0gJHRoaXMtPmltZy0+aGVpZ2h0LTEtJHRoaXMtPmZyYW1lX3dlaWdodDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKCR4bCwkeXUsJHhyLCR5bCk7CiAgICAgICAgICAgICR0aGlzLT5pbWctPlBvcENvbG9yKCk7CgogICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSBzaG91bGQgYWRkIHRoZSB2ZXJ0aWNhbCBsaW5lcyBhdCBsZWZ0IGFuZCByaWdodCBlZGdlCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aVhBeGlzTGJsQmdDb2xvciAhPT0gJycgKSB7CiAgICAgICAgICAgICAgICAvLyBIYXJkY29kZSB0byBvbmUgcGl4ZWwgd2lkZQogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0TGluZVdlaWdodCgxKTsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlB1c2hDb2xvcigkdGhpcy0+aVhBeGlzTGJsQmdDb2xvcik7CiAgICAgICAgICAgICAgICBpZiggJHQgPT0gMSB8fCAkdCA9PSA2ICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPkxpbmUoJHhsLCR5dSwkeGwsJHlsKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lKCR4ciwkeXUsJHhyLCR5bCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkeGwgPSAkdGhpcy0+aW1nLT53aWR0aCAtICR0aGlzLT5pbWctPnJpZ2h0X21hcmdpbiA7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+TGluZSgkeGwsJHl1LTEsJHhyLCR5dS0xKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlBvcENvbG9yKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCAkdCA9PSAyIHx8ICR0ID09IDQgfHwgJHQgPT0gNSB8fCAkdCA9PSA2ICkgewogICAgICAgICAgICAkdGhpcy0+aW1nLT5QdXNoQ29sb3IoJHRoaXMtPmlZQXhpc0xibEJnRmlsbENvbG9yKTsKICAgICAgICAgICAgaWYoICR0ID09IDIgfHwgJHQgPT0gNiApIHsKICAgICAgICAgICAgICAgICR4bCA9ICR0aGlzLT5mcmFtZV93ZWlnaHQ7CiAgICAgICAgICAgICAgICAkeXUgPSAkdGhpcy0+ZnJhbWVfd2VpZ2h0KyR0aGlzLT5pbWctPnRvcF9tYXJnaW47CiAgICAgICAgICAgICAgICAkeHIgPSAkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbiAtIDE7CiAgICAgICAgICAgICAgICAkeWwgPSAkdGhpcy0+aW1nLT5oZWlnaHQgLSAkdGhpcy0+aW1nLT5ib3R0b21fbWFyZ2luICsgMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICR4bCA9ICR0aGlzLT5mcmFtZV93ZWlnaHQ7CiAgICAgICAgICAgICAgICAkeXUgPSAkdGhpcy0+ZnJhbWVfd2VpZ2h0OwogICAgICAgICAgICAgICAgJHhyID0gJHRoaXMtPmltZy0+bGVmdF9tYXJnaW4gLSAxOwogICAgICAgICAgICAgICAgJHlsID0gJHRoaXMtPmltZy0+aGVpZ2h0LTEtJHRoaXMtPmZyYW1lX3dlaWdodDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKCR4bCwkeXUsJHhyLCR5bCk7CiAgICAgICAgICAgICR0aGlzLT5pbWctPlBvcENvbG9yKCk7CgogICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSBzaG91bGQgYWRkIHRoZSB2ZXJ0aWNhbCBsaW5lcyBhdCBsZWZ0IGFuZCByaWdodCBlZGdlCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aVhBeGlzTGJsQmdDb2xvciAhPT0gJycgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5QdXNoQ29sb3IoJHRoaXMtPmlYQXhpc0xibEJnQ29sb3IpOwogICAgICAgICAgICAgICAgaWYoICR0ID09IDIgfHwgJHQgPT0gNiApIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lKCR4bCwkeXUtMSwkeHIsJHl1LTEpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPkxpbmUoJHhsLCR5bC0xLCR4ciwkeWwtMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lKCR4cisxLCR5dSwkeHIrMSwkdGhpcy0+aW1nLT50b3BfbWFyZ2luKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlBvcENvbG9yKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZUF4aXMoJGFTdHJva2VMYWJlbHM9dHJ1ZSkgewoKICAgICAgICBpZiggJGFTdHJva2VMYWJlbHMgKSB7CiAgICAgICAgICAgICR0aGlzLT5TdHJva2VBeGlzTGFiZWxCYWNrZ3JvdW5kKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdHJva2UgYXhpcwogICAgICAgIGlmKCAkdGhpcy0+aUF4aXNTdHlsZSAhPSBBWFNUWUxFX1NJTVBMRSApIHsKICAgICAgICAgICAgc3dpdGNoKCAkdGhpcy0+aUF4aXNTdHlsZSApIHsKICAgICAgICAgICAgICAgIGNhc2UgQVhTVFlMRV9CT1hJTiA6CiAgICAgICAgICAgICAgICAgICAgJHRvcHBvcyA9IFNJREVfRE9XTjsKICAgICAgICAgICAgICAgICAgICAkYm90dG9tcG9zID0gU0lERV9VUDsKICAgICAgICAgICAgICAgICAgICAkbGVmdHBvcyA9IFNJREVfUklHSFQ7CiAgICAgICAgICAgICAgICAgICAgJHJpZ2h0cG9zID0gU0lERV9MRUZUOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBWFNUWUxFX0JPWE9VVCA6CiAgICAgICAgICAgICAgICAgICAgJHRvcHBvcyA9IFNJREVfVVA7CiAgICAgICAgICAgICAgICAgICAgJGJvdHRvbXBvcyA9IFNJREVfRE9XTjsKICAgICAgICAgICAgICAgICAgICAkbGVmdHBvcyA9IFNJREVfTEVGVDsKICAgICAgICAgICAgICAgICAgICAkcmlnaHRwb3MgPSBTSURFX1JJR0hUOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBBWFNUWUxFX1lCT1hJTjoKICAgICAgICAgICAgICAgICAgICAkdG9wcG9zID0gRkFMU0U7CiAgICAgICAgICAgICAgICAgICAgJGJvdHRvbXBvcyA9IFNJREVfVVA7CiAgICAgICAgICAgICAgICAgICAgJGxlZnRwb3MgPSBTSURFX1JJR0hUOwogICAgICAgICAgICAgICAgICAgICRyaWdodHBvcyA9IFNJREVfTEVGVDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQVhTVFlMRV9ZQk9YT1VUOgogICAgICAgICAgICAgICAgICAgICR0b3Bwb3MgPSBGQUxTRTsKICAgICAgICAgICAgICAgICAgICAkYm90dG9tcG9zID0gU0lERV9ET1dOOwogICAgICAgICAgICAgICAgICAgICRsZWZ0cG9zID0gU0lERV9MRUZUOwogICAgICAgICAgICAgICAgICAgICRyaWdodHBvcyA9IFNJREVfUklHSFQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIEpwR1JhcGhFcnJvcjo6UmFpc2VMKDI1MDM2LCR0aGlzLT5pQXhpc1N0eWxlKTsgLy8oJ1Vua25vd24gQXhpc1N0eWxlKCkgOiAnLiR0aGlzLT5pQXhpc1N0eWxlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQnkgZGVmYXVsdCB3ZSBoaWRlIHRoZSBmaXJzdCBsYWJlbCBzbyBpdCBkb2Vzbid0IGNyb3NzIHRoZQogICAgICAgICAgICAvLyBZLWF4aXMgaW4gY2FzZSB0aGUgcG9zaXRvbiBoYXNuJ3QgYmVlbiBzZXQgYnkgdGhlIHVzZXIuCiAgICAgICAgICAgIC8vIEhvd2V2ZXIsIGlmIHdlIHVzZSBhIGJveCB3ZSBhbHdheXMgd2FudCB0aGUgZmlyc3QgdmFsdWUKICAgICAgICAgICAgLy8gZGlzcGxheWVkIHNvIHdlIG1ha2Ugc3VyZSBpdCB3aWxsIGJlIGRpc3BsYXllZC4KICAgICAgICAgICAgJHRoaXMtPnhzY2FsZS0+dGlja3MtPlN1cHJlc3NGaXJzdChmYWxzZSk7CgogICAgICAgICAgICAvLyBOb3cgZHJhdyB0aGUgYm90dG9tIFgtYXhpcwogICAgICAgICAgICAkdGhpcy0+eGF4aXMtPlNldFBvcygnbWluJyk7CiAgICAgICAgICAgICR0aGlzLT54YXhpcy0+U2V0TGFiZWxTaWRlKFNJREVfRE9XTik7CiAgICAgICAgICAgICR0aGlzLT54YXhpcy0+c2NhbGUtPnRpY2tzLT5TZXRTaWRlKCRib3R0b21wb3MpOwogICAgICAgICAgICAkdGhpcy0+eGF4aXMtPlN0cm9rZSgkdGhpcy0+eXNjYWxlLCRhU3Ryb2tlTGFiZWxzKTsKCiAgICAgICAgICAgIGlmKCAkdG9wcG9zICE9PSBGQUxTRSApIHsKICAgICAgICAgICAgICAgIC8vIFdlIGFsc28gd2FudCBhIHRvcCBYLWF4aXMKICAgICAgICAgICAgICAgICR0aGlzLT54YXhpcyA9ICR0aGlzLT54YXhpczsKICAgICAgICAgICAgICAgICR0aGlzLT54YXhpcy0+U2V0UG9zKCdtYXgnKTsKICAgICAgICAgICAgICAgICR0aGlzLT54YXhpcy0+U2V0TGFiZWxTaWRlKFNJREVfVVApOwogICAgICAgICAgICAgICAgLy8gTm8gdGl0bGUgZm9yIHRoZSB0b3AgWC1heGlzCiAgICAgICAgICAgICAgICBpZiggJGFTdHJva2VMYWJlbHMgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnhheGlzLT50aXRsZS0+U2V0KCcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT54YXhpcy0+c2NhbGUtPnRpY2tzLT5TZXRTaWRlKCR0b3Bwb3MpOwogICAgICAgICAgICAgICAgJHRoaXMtPnhheGlzLT5TdHJva2UoJHRoaXMtPnlzY2FsZSwkYVN0cm9rZUxhYmVscyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFN0cm9rZSB0aGUgbGVmdCBZLWF4aXMKICAgICAgICAgICAgJHRoaXMtPnlheGlzLT5TZXRQb3MoJ21pbicpOwogICAgICAgICAgICAkdGhpcy0+eWF4aXMtPlNldExhYmVsU2lkZShTSURFX0xFRlQpOwogICAgICAgICAgICAkdGhpcy0+eWF4aXMtPnNjYWxlLT50aWNrcy0+U2V0U2lkZSgkbGVmdHBvcyk7CiAgICAgICAgICAgICR0aGlzLT55YXhpcy0+U3Ryb2tlKCR0aGlzLT54c2NhbGUsJGFTdHJva2VMYWJlbHMpOwoKICAgICAgICAgICAgLy8gU3Ryb2tlIHRoZSAgcmlnaHQgWS1heGlzCiAgICAgICAgICAgICR0aGlzLT55YXhpcy0+U2V0UG9zKCdtYXgnKTsKICAgICAgICAgICAgLy8gTm8gdGl0bGUgZm9yIHRoZSByaWdodCBzaWRlCiAgICAgICAgICAgIGlmKCAkYVN0cm9rZUxhYmVscyApIHsKICAgICAgICAgICAgICAgICR0aGlzLT55YXhpcy0+dGl0bGUtPlNldCgnJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPnlheGlzLT5TZXRMYWJlbFNpZGUoU0lERV9SSUdIVCk7CiAgICAgICAgICAgICR0aGlzLT55YXhpcy0+c2NhbGUtPnRpY2tzLT5TZXRTaWRlKCRyaWdodHBvcyk7CiAgICAgICAgICAgICR0aGlzLT55YXhpcy0+U3Ryb2tlKCR0aGlzLT54c2NhbGUsJGFTdHJva2VMYWJlbHMpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnhheGlzLT5TdHJva2UoJHRoaXMtPnlzY2FsZSwkYVN0cm9rZUxhYmVscyk7CiAgICAgICAgICAgICR0aGlzLT55YXhpcy0+U3Ryb2tlKCR0aGlzLT54c2NhbGUsJGFTdHJva2VMYWJlbHMpOwogICAgICAgIH0KICAgIH0KCgogICAgLy8gUHJpdmF0ZSBoZWxwZXIgZnVuY3Rpb24gZm9yIGJhY2tnb3VuZCBpbWFnZQogICAgc3RhdGljIGZ1bmN0aW9uIExvYWRCa2dJbWFnZSgkYUltZ0Zvcm1hdD0nJywkYUZpbGU9JycsJGFJbWdTdHI9JycpIHsKICAgICAgICBpZiggJGFJbWdTdHIgIT0gJycgKSB7CiAgICAgICAgICAgIHJldHVybiBJbWFnZTo6Q3JlYXRlRnJvbVN0cmluZygkYUltZ1N0cik7CiAgICAgICAgfQoKICAgICAgICAvLyBSZW1vdmUgY2FzZSBzZW5zaXRpdml0eSBhbmQgc2V0dXAgYXBwcm9wcmlhdGUgZnVuY3Rpb24gdG8gY3JlYXRlIGltYWdlCiAgICAgICAgLy8gR2V0IGZpbGUgZXh0ZW5zaW9uLiBUaGlzIHNob3VsZCBiZSB0aGUgTEFTVCAnLicgc2VwYXJhdGVkIHBhcnQgb2YgdGhlIGZpbGVuYW1lCiAgICAgICAgJGUgPSBleHBsb2RlKCcuJywkYUZpbGUpOwogICAgICAgICRleHQgPSBzdHJ0b2xvd2VyKCRlW2NvdW50KCRlKS0xXSk7CiAgICAgICAgaWYgKCRleHQgPT0gImpwZWciKSAgewogICAgICAgICAgICAkZXh0ID0gImpwZyI7CiAgICAgICAgfQoKICAgICAgICBpZiggdHJpbSgkZXh0KSA9PSAnJyApIHsKICAgICAgICAgICAgJGV4dCA9ICdwbmcnOyAgLy8gQXNzdW1lIFBORyBpZiBubyBleHRlbnNpb24gc3BlY2lmaWVkCiAgICAgICAgfQoKICAgICAgICBpZiggJGFJbWdGb3JtYXQgPT0gJycgKSB7CiAgICAgICAgICAgICRpbWd0YWcgPSAkZXh0OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJGltZ3RhZyA9ICRhSW1nRm9ybWF0OwogICAgICAgIH0KCiAgICAgICAgJHN1cHBvcnRlZCA9IGltYWdldHlwZXMoKTsKICAgICAgICBpZiggKCAkZXh0ID09ICdqcGcnICYmICEoJHN1cHBvcnRlZCAmIElNR19KUEcpICkgfHwKICAgICAgICAgICAgKCAkZXh0ID09ICdnaWYnICYmICEoJHN1cHBvcnRlZCAmIElNR19HSUYpICkgfHwKICAgICAgICAgICAgKCAkZXh0ID09ICdwbmcnICYmICEoJHN1cHBvcnRlZCAmIElNR19QTkcpICkgfHwKICAgICAgICAgICAgKCAkZXh0ID09ICdibXAnICYmICEoJHN1cHBvcnRlZCAmIElNR19XQk1QKSApIHx8CiAgICAgICAgICAgICggJGV4dCA9PSAneHBtJyAmJiAhKCRzdXBwb3J0ZWQgJiBJTUdfWFBNKSApICkgewoKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwMzcsJGFGaWxlKTsvLygnVGhlIGltYWdlIGZvcm1hdCBvZiB5b3VyIGJhY2tncm91bmQgaW1hZ2UgKCcuJGFGaWxlLicpIGlzIG5vdCBzdXBwb3J0ZWQgaW4geW91ciBzeXN0ZW0gY29uZmlndXJhdGlvbi4gJyk7CiAgICAgICAgfQoKCiAgICAgICAgaWYoICRpbWd0YWcgPT0gImpwZyIgfHwgJGltZ3RhZyA9PSAianBlZyIpIHsKICAgICAgICAgICAgJGYgPSAiaW1hZ2VjcmVhdGVmcm9tanBlZyI7CiAgICAgICAgICAgICRpbWd0YWcgPSAianBnIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRmID0gImltYWdlY3JlYXRlZnJvbSIuJGltZ3RhZzsKICAgICAgICB9CgogICAgICAgIC8vIENvbXBhcmUgc3BlY2lmaWVkIGltYWdlIHR5cGUgYW5kIGZpbGUgZXh0ZW5zaW9uCiAgICAgICAgaWYoICRpbWd0YWcgIT0gJGV4dCApIHsKICAgICAgICAgICAgLy8kdCA9ICJCYWNrZ3JvdW5kIGltYWdlIHNlZW1zIHRvIGJlIG9mIGRpZmZlcmVudCB0eXBlIChoYXMgZGlmZmVyZW50IGZpbGUgZXh0ZW5zaW9uKSB0aGFuIHNwZWNpZmllZCBpbWFnZXR5cGUuIFNwZWNpZmllZDogJyIuJGFJbWdGb3JtYXQuIidGaWxlOiAnIi4kYUZpbGUuIiciOwogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAzOCwgJGFJbWdGb3JtYXQsICRhRmlsZSk7CiAgICAgICAgfQoKICAgICAgICAkaW1nID0gQCRmKCRhRmlsZSk7CiAgICAgICAgaWYoICEkaW1nICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTAzOSwkYUZpbGUpOy8vKCIgQ2FuJ3QgcmVhZCBiYWNrZ3JvdW5kIGltYWdlOiAnIi4kYUZpbGUuIiciKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRpbWc7CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlUGxvdEdyYWQoKSB7CiAgICAgICAgaWYoICR0aGlzLT5wbG90X2dyYWR0eXBlIDwgMCAgKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIAogICAgICAgICRncmFkID0gbmV3IEdyYWRpZW50KCR0aGlzLT5pbWcpOwogICAgICAgICR4bCA9ICR0aGlzLT5pbWctPmxlZnRfbWFyZ2luOwogICAgICAgICR5dCA9ICR0aGlzLT5pbWctPnRvcF9tYXJnaW47CiAgICAgICAgJHhyID0gJHhsICsgJHRoaXMtPmltZy0+cGxvdHdpZHRoKzEgOwogICAgICAgICR5YiA9ICR5dCArICR0aGlzLT5pbWctPnBsb3RoZWlnaHQgOwogICAgICAgICRncmFkLT5GaWxsZWRSZWN0YW5nbGUoJHhsLCR5dCwkeHIsJHliLCR0aGlzLT5wbG90X2dyYWRmcm9tLCR0aGlzLT5wbG90X2dyYWR0bywkdGhpcy0+cGxvdF9ncmFkdHlwZSk7CgogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZUJhY2tncm91bmRHcmFkKCkgewogICAgICAgIGlmKCAkdGhpcy0+YmtnX2dyYWR0eXBlIDwgMCAgKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgICRncmFkID0gbmV3IEdyYWRpZW50KCR0aGlzLT5pbWcpOwogICAgICAgIGlmKCAkdGhpcy0+YmtnX2dyYWRzdHlsZSA9PSBCR1JBRF9QTE9UICkgewogICAgICAgICAgICAkeGwgPSAkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbjsKICAgICAgICAgICAgJHl0ID0gJHRoaXMtPmltZy0+dG9wX21hcmdpbjsKICAgICAgICAgICAgJHhyID0gJHhsICsgJHRoaXMtPmltZy0+cGxvdHdpZHRoKzEgOwogICAgICAgICAgICAkeWIgPSAkeXQgKyAkdGhpcy0+aW1nLT5wbG90aGVpZ2h0IDsKICAgICAgICAgICAgJGdyYWQtPkZpbGxlZFJlY3RhbmdsZSgkeGwsJHl0LCR4ciwkeWIsJHRoaXMtPmJrZ19ncmFkZnJvbSwkdGhpcy0+YmtnX2dyYWR0bywkdGhpcy0+YmtnX2dyYWR0eXBlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR4bCA9IDA7CiAgICAgICAgICAgICR5dCA9IDA7CiAgICAgICAgICAgICR4ciA9ICR4bCArICR0aGlzLT5pbWctPndpZHRoIC0gMTsKICAgICAgICAgICAgJHliID0gJHl0ICsgJHRoaXMtPmltZy0+aGVpZ2h0IC0gMSA7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+ZG9zaGFkb3cgICkgewogICAgICAgICAgICAgICAgJHhyIC09ICR0aGlzLT5zaGFkb3dfd2lkdGg7CiAgICAgICAgICAgICAgICAkeWIgLT0gJHRoaXMtPnNoYWRvd193aWR0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggJHRoaXMtPmRvZnJhbWUgKSB7CiAgICAgICAgICAgICAgICAkeXQgKz0gJHRoaXMtPmZyYW1lX3dlaWdodDsKICAgICAgICAgICAgICAgICR5YiAtPSAkdGhpcy0+ZnJhbWVfd2VpZ2h0OwogICAgICAgICAgICAgICAgJHhsICs9ICR0aGlzLT5mcmFtZV93ZWlnaHQ7CiAgICAgICAgICAgICAgICAkeHIgLT0gJHRoaXMtPmZyYW1lX3dlaWdodDsKICAgICAgICAgICAgfQogICAgICAgICAgICAkYWEgPSAkdGhpcy0+aW1nLT5TZXRBbmdsZSgwKTsKICAgICAgICAgICAgJGdyYWQtPkZpbGxlZFJlY3RhbmdsZSgkeGwsJHl0LCR4ciwkeWIsJHRoaXMtPmJrZ19ncmFkZnJvbSwkdGhpcy0+YmtnX2dyYWR0bywkdGhpcy0+YmtnX2dyYWR0eXBlKTsKICAgICAgICAgICAgJGFhID0gJHRoaXMtPmltZy0+U2V0QW5nbGUoJGFhKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlRnJhbWVCYWNrZ3JvdW5kKCkgewogICAgICAgIGlmKCAkdGhpcy0+YmFja2dyb3VuZF9pbWFnZSAhPSAnJyAmJiAkdGhpcy0+YmFja2dyb3VuZF9jZmxhZyAhPSAnJyApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNDApOy8vKCdJdCBpcyBub3QgcG9zc2libGUgdG8gc3BlY2lmeSBib3RoIGEgYmFja2dyb3VuZCBpbWFnZSBhbmQgYSBiYWNrZ3JvdW5kIGNvdW50cnkgZmxhZy4nKTsKICAgICAgICB9CiAgICAgICAgaWYoICR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlICE9ICcnICkgewogICAgICAgICAgICAkYmtnaW1nID0gJHRoaXMtPkxvYWRCa2dJbWFnZSgkdGhpcy0+YmFja2dyb3VuZF9pbWFnZV9mb3JtYXQsJHRoaXMtPmJhY2tncm91bmRfaW1hZ2UpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT5iYWNrZ3JvdW5kX2NmbGFnICE9ICcnICkgewogICAgICAgICAgICBpZiggISBjbGFzc19leGlzdHMoJ0ZsYWdJbWFnZXMnLGZhbHNlKSApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDQxKTsvLygnSW4gb3JkZXIgdG8gdXNlIENvdW50cnkgZmxhZ3MgYXMgYmFja2dyb3VuZHMgeW91IG11c3QgaW5jbHVkZSB0aGUgImpwZ3JhcGhfZmxhZ3MucGhwIiBmaWxlLicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRmb2JqID0gbmV3IEZsYWdJbWFnZXMoRkxBR1NJWkU0KTsKICAgICAgICAgICAgJGR1bW15PScnOwogICAgICAgICAgICAkYmtnaW1nID0gJGZvYmotPkdldEltZ0J5TmFtZSgkdGhpcy0+YmFja2dyb3VuZF9jZmxhZywkZHVtbXkpOwogICAgICAgICAgICAkdGhpcy0+YmFja2dyb3VuZF9pbWFnZV9taXggPSAkdGhpcy0+YmFja2dyb3VuZF9jZmxhZ19taXg7CiAgICAgICAgICAgICR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX3R5cGUgPSAkdGhpcy0+YmFja2dyb3VuZF9jZmxhZ190eXBlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIDsKICAgICAgICB9CgogICAgICAgICRidyA9IEltYWdlU1goJGJrZ2ltZyk7CiAgICAgICAgJGJoID0gSW1hZ2VTWSgkYmtnaW1nKTsKCiAgICAgICAgLy8gTm8gbWF0dGVyIHdoYXQgdGhlIGFuZ2xlIGlzIHdlIGFsd2F5cyBzdHJva2UgdGhlIGltYWdlIGFuZCBmcmFtZQogICAgICAgIC8vIGFzc3VtaW5nIGl0IGlzIDAgZGVncmVlCiAgICAgICAgJGFhID0gJHRoaXMtPmltZy0+U2V0QW5nbGUoMCk7CgogICAgICAgIHN3aXRjaCggJHRoaXMtPmJhY2tncm91bmRfaW1hZ2VfdHlwZSApIHsKICAgICAgICAgICAgY2FzZSBCR0lNR19GSUxMUExPVDogLy8gUmVzaXplIHRvIGp1c3QgZmlsbCB0aGUgcGxvdGFyZWEKICAgICAgICAgICAgICAgICR0aGlzLT5GaWxsTWFyZ2luQXJlYSgpOwogICAgICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUZyYW1lKCk7CiAgICAgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UgdG8gaGFuZGUgOTAgZGVncmVlIHJvdGF0ZWQgZ3JhcGggY29yZWN0bHkKICAgICAgICAgICAgICAgIGlmKCAkYWEgPT0gOTAgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0QW5nbGUoOTApOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5GaWxsUGxvdEFyZWEoKTsKICAgICAgICAgICAgICAgICAgICAkYWEgPSAkdGhpcy0+aW1nLT5TZXRBbmdsZSgwKTsKICAgICAgICAgICAgICAgICAgICAkYWRqID0gKCR0aGlzLT5pbWctPmhlaWdodCAtICR0aGlzLT5pbWctPndpZHRoKS8yOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPkNvcHlNZXJnZSgkYmtnaW1nLAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5ib3R0b21fbWFyZ2luLSRhZGosJHRoaXMtPmltZy0+bGVmdF9tYXJnaW4rJGFkaiwKICAgICAgICAgICAgICAgICAgICAgICAgMCwwLAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5wbG90aGVpZ2h0KzEsJHRoaXMtPmltZy0+cGxvdHdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAkYncsJGJoLCR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX21peCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+RmlsbFBsb3RBcmVhKCk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+Q29weU1lcmdlKCRia2dpbWcsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPmxlZnRfbWFyZ2luLCR0aGlzLT5pbWctPnRvcF9tYXJnaW4rMSwKICAgICAgICAgICAgICAgICAgICAgICAgMCwwLCR0aGlzLT5pbWctPnBsb3R3aWR0aCsxLCR0aGlzLT5pbWctPnBsb3RoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICRidywkYmgsJHRoaXMtPmJhY2tncm91bmRfaW1hZ2VfbWl4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEJHSU1HX0ZJTExGUkFNRTogLy8gRmlsbCB0aGUgd2hvbGUgYXJlYSBmcm9tIHVwcGVyIGxlZnQgY29ybmVyLCByZXNpemUgdG8ganVzdCBmaXQKICAgICAgICAgICAgICAgICRoYWRqPTA7ICR2YWRqPTA7CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmRvc2hhZG93ICkgewogICAgICAgICAgICAgICAgICAgICRoYWRqID0gJHRoaXMtPnNoYWRvd193aWR0aDsKICAgICAgICAgICAgICAgICAgICAkdmFkaiA9ICR0aGlzLT5zaGFkb3dfd2lkdGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+RmlsbE1hcmdpbkFyZWEoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5GaWxsUGxvdEFyZWEoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPkNvcHlNZXJnZSgkYmtnaW1nLDAsMCwwLDAsJHRoaXMtPmltZy0+d2lkdGgtJGhhZGosJHRoaXMtPmltZy0+aGVpZ2h0LSR2YWRqLAogICAgICAgICAgICAgICAgJGJ3LCRiaCwkdGhpcy0+YmFja2dyb3VuZF9pbWFnZV9taXgpOwogICAgICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUZyYW1lKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBCR0lNR19DT1BZOiAvLyBKdXN0IGNvcHkgdGhlIGltYWdlIGZyb20gbGVmdCBjb3JuZXIsIG5vIHJlc2l6aW5nCiAgICAgICAgICAgICAgICAkdGhpcy0+RmlsbE1hcmdpbkFyZWEoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5GaWxsUGxvdEFyZWEoKTsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPkNvcHlNZXJnZSgkYmtnaW1nLDAsMCwwLDAsJGJ3LCRiaCwKICAgICAgICAgICAgICAgICRidywkYmgsJHRoaXMtPmJhY2tncm91bmRfaW1hZ2VfbWl4KTsKICAgICAgICAgICAgICAgICR0aGlzLT5TdHJva2VGcmFtZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQkdJTUdfQ0VOVEVSOiAvLyBDZW50ZXIgb3JpZ2luYWwgaW1hZ2UgaW4gdGhlIHBsb3QgYXJlYQogICAgICAgICAgICAgICAgJHRoaXMtPkZpbGxNYXJnaW5BcmVhKCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+RmlsbFBsb3RBcmVhKCk7CiAgICAgICAgICAgICAgICAkY2VudGVyeCA9IHJvdW5kKCR0aGlzLT5pbWctPnBsb3R3aWR0aC8yKyR0aGlzLT5pbWctPmxlZnRfbWFyZ2luLSRidy8yKTsKICAgICAgICAgICAgICAgICRjZW50ZXJ5ID0gcm91bmQoJHRoaXMtPmltZy0+cGxvdGhlaWdodC8yKyR0aGlzLT5pbWctPnRvcF9tYXJnaW4tJGJoLzIpOwogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+Q29weU1lcmdlKCRia2dpbWcsJGNlbnRlcngsJGNlbnRlcnksMCwwLCRidywkYmgsCiAgICAgICAgICAgICAgICAkYncsJGJoLCR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX21peCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+U3Ryb2tlRnJhbWUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEJHSU1HX0ZSRUU6IC8vIEp1c3QgY29weSB0aGUgaW1hZ2UgdG8gdGhlIHNwZWNpZmllZCBsb2NhdGlvbgogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+Q29weU1lcmdlKCRia2dpbWcsCiAgICAgICAgICAgICAgICAkdGhpcy0+YmFja2dyb3VuZF9pbWFnZV94cG9zLCR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX3lwb3MsCiAgICAgICAgICAgICAgICAwLDAsJGJ3LCRiaCwkYncsJGJoLCR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX21peCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+U3Ryb2tlRnJhbWUoKTsgLy8gTmV3CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDQyKTsvLygiIFVua25vd24gYmFja2dyb3VuZCBpbWFnZSBsYXlvdXQiKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmltZy0+U2V0QW5nbGUoJGFhKTsKICAgIH0KCiAgICAvLyBQcml2YXRlCiAgICAvLyBEcmF3IGEgZnJhbWUgYXJvdW5kIHRoZSBpbWFnZQogICAgZnVuY3Rpb24gU3Ryb2tlRnJhbWUoKSB7CiAgICAgICAgaWYoICEkdGhpcy0+ZG9mcmFtZSApIHJldHVybjsKCiAgICAgICAgaWYoICR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlX3R5cGUgPD0gMSAmJiAoJHRoaXMtPmJrZ19ncmFkdHlwZSA8IDAgfHwgKCR0aGlzLT5ia2dfZ3JhZHR5cGUgPiAwICYmICR0aGlzLT5ia2dfZ3JhZHN0eWxlPT1CR1JBRF9QTE9UKSkgKSB7CiAgICAgICAgICAgICRjID0gJHRoaXMtPm1hcmdpbl9jb2xvcjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRjID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPmRvc2hhZG93ICkgewogICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRDb2xvcigkdGhpcy0+ZnJhbWVfY29sb3IpOwogICAgICAgICAgICAkdGhpcy0+aW1nLT5TaGFkb3dSZWN0YW5nbGUoMCwwLCR0aGlzLT5pbWctPndpZHRoLCR0aGlzLT5pbWctPmhlaWdodCwKICAgICAgICAgICAgJGMsJHRoaXMtPnNoYWRvd193aWR0aCwkdGhpcy0+c2hhZG93X2NvbG9yKTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkdGhpcy0+ZnJhbWViZXZlbCApIHsKICAgICAgICAgICAgaWYoICRjICkgewogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Q29sb3IoJHRoaXMtPm1hcmdpbl9jb2xvcik7CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5GaWxsZWRSZWN0YW5nbGUoMCwwLCR0aGlzLT5pbWctPndpZHRoLTEsJHRoaXMtPmltZy0+aGVpZ2h0LTEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5pbWctPkJldmVsKDEsMSwkdGhpcy0+aW1nLT53aWR0aC0yLCR0aGlzLT5pbWctPmhlaWdodC0yLAogICAgICAgICAgICAkdGhpcy0+ZnJhbWViZXZlbGRlcHRoLAogICAgICAgICAgICAkdGhpcy0+ZnJhbWViZXZlbGNvbG9yMSwkdGhpcy0+ZnJhbWViZXZlbGNvbG9yMik7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+ZnJhbWViZXZlbGJvcmRlciApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldENvbG9yKCR0aGlzLT5mcmFtZWJldmVsYm9yZGVyY29sb3IpOwogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+UmVjdGFuZ2xlKDAsMCwkdGhpcy0+aW1nLT53aWR0aC0xLCR0aGlzLT5pbWctPmhlaWdodC0xKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0TGluZVdlaWdodCgkdGhpcy0+ZnJhbWVfd2VpZ2h0KTsKICAgICAgICAgICAgaWYoICRjICkgewogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Q29sb3IoJHRoaXMtPm1hcmdpbl9jb2xvcik7CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5GaWxsZWRSZWN0YW5nbGUoMCwwLCR0aGlzLT5pbWctPndpZHRoLTEsJHRoaXMtPmltZy0+aGVpZ2h0LTEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5pbWctPlNldENvbG9yKCR0aGlzLT5mcmFtZV9jb2xvcik7CiAgICAgICAgICAgICR0aGlzLT5pbWctPlJlY3RhbmdsZSgwLDAsJHRoaXMtPmltZy0+d2lkdGgtMSwkdGhpcy0+aW1nLT5oZWlnaHQtMSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEZpbGxNYXJnaW5BcmVhKCkgewogICAgICAgICRoYWRqPTA7ICR2YWRqPTA7CiAgICAgICAgaWYoICR0aGlzLT5kb3NoYWRvdyApIHsKICAgICAgICAgICAgJGhhZGogPSAkdGhpcy0+c2hhZG93X3dpZHRoOwogICAgICAgICAgICAkdmFkaiA9ICR0aGlzLT5zaGFkb3dfd2lkdGg7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+aW1nLT5TZXRDb2xvcigkdGhpcy0+bWFyZ2luX2NvbG9yKTsKICAgICAgICAkdGhpcy0+aW1nLT5GaWxsZWRSZWN0YW5nbGUoMCwwLCR0aGlzLT5pbWctPndpZHRoLTEtJGhhZGosJHRoaXMtPmltZy0+aGVpZ2h0LTEtJHZhZGopOwoKICAgICAgICAkdGhpcy0+aW1nLT5GaWxsZWRSZWN0YW5nbGUoMCwwLCR0aGlzLT5pbWctPndpZHRoLTEtJGhhZGosJHRoaXMtPmltZy0+dG9wX21hcmdpbik7CiAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKDAsJHRoaXMtPmltZy0+dG9wX21hcmdpbiwkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbiwkdGhpcy0+aW1nLT5oZWlnaHQtMS0kaGFkaik7CiAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKCR0aGlzLT5pbWctPmxlZnRfbWFyZ2luKzEsCiAgICAgICAgJHRoaXMtPmltZy0+aGVpZ2h0LSR0aGlzLT5pbWctPmJvdHRvbV9tYXJnaW4sCiAgICAgICAgJHRoaXMtPmltZy0+d2lkdGgtMS0kaGFkaiwKICAgICAgICAkdGhpcy0+aW1nLT5oZWlnaHQtMS0kaGFkaik7CiAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKCR0aGlzLT5pbWctPndpZHRoLSR0aGlzLT5pbWctPnJpZ2h0X21hcmdpbiwKICAgICAgICAkdGhpcy0+aW1nLT50b3BfbWFyZ2luKzEsCiAgICAgICAgJHRoaXMtPmltZy0+d2lkdGgtMS0kaGFkaiwKICAgICAgICAkdGhpcy0+aW1nLT5oZWlnaHQtJHRoaXMtPmltZy0+Ym90dG9tX21hcmdpbi0xKTsKICAgIH0KCiAgICBmdW5jdGlvbiBGaWxsUGxvdEFyZWEoKSB7CiAgICAgICAgJHRoaXMtPmltZy0+UHVzaENvbG9yKCR0aGlzLT5wbG90YXJlYV9jb2xvcik7CiAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKCR0aGlzLT5pbWctPmxlZnRfbWFyZ2luLAogICAgICAgICR0aGlzLT5pbWctPnRvcF9tYXJnaW4sCiAgICAgICAgJHRoaXMtPmltZy0+d2lkdGgtJHRoaXMtPmltZy0+cmlnaHRfbWFyZ2luLAogICAgICAgICR0aGlzLT5pbWctPmhlaWdodC0kdGhpcy0+aW1nLT5ib3R0b21fbWFyZ2luKTsKICAgICAgICAkdGhpcy0+aW1nLT5Qb3BDb2xvcigpOwogICAgfQoKICAgIC8vIFN0cm9rZSB0aGUgcGxvdCBhcmVhIHdpdGggZWl0aGVyIGEgc29saWQgY29sb3Igb3IgYSBiYWNrZ3JvdW5kIGltYWdlCiAgICBmdW5jdGlvbiBTdHJva2VQbG90QXJlYSgpIHsKICAgICAgICAvLyBOb3RlOiBUbyBiZSBjb25zaXN0ZW50IHdlIHJlYWxseSBzaG91bGQgdGFrZSBhIHBvc3NpYmxlIHNoYWRvdwogICAgICAgIC8vIGludG8gYWNjb3VudC4gSG93ZXZlciwgdGhhdCBjYXVzZXMgc29tZSBwcm9ibGVtIGZvciB0aGUgTGluZWFyU2NhbGUgY2xhc3MKICAgICAgICAvLyBzaW5jZSBpbiB0aGUgY3VycmVudCBkZXNpZ24gaXQgZG9lcyBub3QgaGF2ZSBhbnkgbGlua3MgdG8gY2xhc3MgR3JhcGggd2hpY2gKICAgICAgICAvLyBtZWFucyBpdCBoYXMgbm8gd2F5IG9mIGNvbXBlbnNhdGluZyBmb3IgdGhlIGFkanVzdGVkIHBsb3RhcmVhIGluIGNhc2Ugb2YgYQogICAgICAgIC8vIHNoYWRvdy4gU28sIHVudGlsIEkgcmVkZXNpZ24gTGluZWFyU2NhbGUgd2UgY2FuJ3QgY29tcGVuc2F0ZSBmb3IgdGhpcy4KICAgICAgICAvLyBTbyBqdXN0IHNldCB0aGUgdHdvIGFkanVzdG1lbnQgcGFyYW1ldGVycyB0byB6ZXJvIGZvciBub3cuCiAgICAgICAgJGJveGFkaiA9IDA7IC8vJHRoaXMtPmRvZnJhbWUgPyAkdGhpcy0+ZnJhbWVfd2VpZ2h0IDogMCA7CiAgICAgICAgJGFkaiA9IDA7IC8vJHRoaXMtPmRvc2hhZG93ID8gJHRoaXMtPnNoYWRvd193aWR0aCA6IDAgOwoKICAgICAgICBpZiggJHRoaXMtPmJhY2tncm91bmRfaW1hZ2UgIT0gJycgfHwgJHRoaXMtPmJhY2tncm91bmRfY2ZsYWcgIT0gJycgKSB7CiAgICAgICAgICAgICR0aGlzLT5TdHJva2VGcmFtZUJhY2tncm91bmQoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRhYSA9ICR0aGlzLT5pbWctPlNldEFuZ2xlKDApOwogICAgICAgICAgICAkdGhpcy0+U3Ryb2tlRnJhbWUoKTsKICAgICAgICAgICAgJGFhID0gJHRoaXMtPmltZy0+U2V0QW5nbGUoJGFhKTsKICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUJhY2tncm91bmRHcmFkKCk7IAogICAgICAgICAgICBpZiggJHRoaXMtPmJrZ19ncmFkdHlwZSA8IDAgfHwgKCR0aGlzLT5ia2dfZ3JhZHR5cGUgPiAwICYmICR0aGlzLT5ia2dfZ3JhZHN0eWxlPT1CR1JBRF9NQVJHSU4pICkgewogICAgICAgICAgICAgICAgJHRoaXMtPkZpbGxQbG90QXJlYSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5TdHJva2VQbG90R3JhZCgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2VJY29ucygpIHsKICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT5pSWNvbnMpOwogICAgICAgIGZvciggJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgJHRoaXMtPmlJY29uc1skaV0tPlN0cm9rZVdpdGhTY2FsZSgkdGhpcy0+aW1nLCR0aGlzLT54c2NhbGUsJHRoaXMtPnlzY2FsZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZVBsb3RCb3goKSB7CiAgICAgICAgLy8gU2hvdWxkIHdlIGRyYXcgYSBib3ggYXJvdW5kIHRoZSBwbG90IGFyZWE\/CiAgICAgICAgaWYoICR0aGlzLT5ib3hlZCApIHsKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0TGluZVdlaWdodCgxKTsKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0TGluZVN0eWxlKCdzb2xpZCcpOwogICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRDb2xvcigkdGhpcy0+Ym94X2NvbG9yKTsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgJHRoaXMtPmJveF93ZWlnaHQ7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5SZWN0YW5nbGUoCiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbi0kaSwkdGhpcy0+aW1nLT50b3BfbWFyZ2luLSRpLAogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+d2lkdGgtJHRoaXMtPmltZy0+cmlnaHRfbWFyZ2luKyRpLAogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+aGVpZ2h0LSR0aGlzLT5pbWctPmJvdHRvbV9tYXJnaW4rJGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFNldFRpdGxlQmFja2dyb3VuZEZpbGxTdHlsZSgkYVN0eWxlLCRhQ29sb3IxPSdibGFjaycsJGFDb2xvcjI9J3doaXRlJykgewogICAgICAgICR0aGlzLT50aXRsZWJrZ19maWxsc3R5bGUgPSAkYVN0eWxlOwogICAgICAgICR0aGlzLT50aXRsZWJrZ19zY29sb3IxID0gJGFDb2xvcjE7CiAgICAgICAgJHRoaXMtPnRpdGxlYmtnX3Njb2xvcjIgPSAkYUNvbG9yMjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRUaXRsZUJhY2tncm91bmQoJGFCYWNrQ29sb3I9J2dyYXknLCAkYVN0eWxlPVRJVExFQktHX1NUWUxFMSwgJGFGcmFtZVN0eWxlPVRJVExFQktHX0ZSQU1FX05PTkUsICRhRnJhbWVDb2xvcj0nYmxhY2snLCAkYUZyYW1lV2VpZ2h0PTEsICRhQmV2ZWxIZWlnaHQ9MywgJGFFbmFibGU9dHJ1ZSkgewogICAgICAgICR0aGlzLT50aXRsZWJhY2tncm91bmQgPSAkYUVuYWJsZTsKICAgICAgICAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX2NvbG9yID0gJGFCYWNrQ29sb3I7CiAgICAgICAgJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9zdHlsZSA9ICRhU3R5bGU7CiAgICAgICAgJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9mcmFtZWNvbG9yID0gJGFGcmFtZUNvbG9yOwogICAgICAgICR0aGlzLT50aXRsZWJhY2tncm91bmRfZnJhbWVzdHlsZSA9ICRhRnJhbWVTdHlsZTsKICAgICAgICAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX2ZyYW1ld2VpZ2h0ID0gJGFGcmFtZVdlaWdodDsKICAgICAgICAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX2JldmVsaGVpZ2h0ID0gJGFCZXZlbEhlaWdodCA7CiAgICB9CgoKICAgIGZ1bmN0aW9uIFN0cm9rZVRpdGxlcygpIHsKCiAgICAgICAgJG1hcmdpbj0zOwoKICAgICAgICBpZiggJHRoaXMtPnRpdGxlYmFja2dyb3VuZCApIHsKICAgICAgICAgICAgLy8gRmluZCBvdXQgaGVpZ2h0CiAgICAgICAgICAgICR0aGlzLT50aXRsZS0+bWFyZ2luICs9IDIgOwogICAgICAgICAgICAkaCA9ICR0aGlzLT50aXRsZS0+R2V0VGV4dEhlaWdodCgkdGhpcy0+aW1nKSskdGhpcy0+dGl0bGUtPm1hcmdpbiskbWFyZ2luOwogICAgICAgICAgICBpZiggJHRoaXMtPnN1YnRpdGxlLT50ICE9ICcnICYmICEkdGhpcy0+c3VidGl0bGUtPmhpZGUgKSB7CiAgICAgICAgICAgICAgICAkaCArPSAkdGhpcy0+c3VidGl0bGUtPkdldFRleHRIZWlnaHQoJHRoaXMtPmltZykrJG1hcmdpbisKICAgICAgICAgICAgICAgICR0aGlzLT5zdWJ0aXRsZS0+bWFyZ2luOwogICAgICAgICAgICAgICAgJGggKz0gMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggJHRoaXMtPnN1YnN1YnRpdGxlLT50ICE9ICcnICYmICEkdGhpcy0+c3Vic3VidGl0bGUtPmhpZGUgKSB7CiAgICAgICAgICAgICAgICAkaCArPSAkdGhpcy0+c3Vic3VidGl0bGUtPkdldFRleHRIZWlnaHQoJHRoaXMtPmltZykrJG1hcmdpbisKICAgICAgICAgICAgICAgICR0aGlzLT5zdWJzdWJ0aXRsZS0+bWFyZ2luOwogICAgICAgICAgICAgICAgJGggKz0gMjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+aW1nLT5QdXNoQ29sb3IoJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9jb2xvcik7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX3N0eWxlID09PSBUSVRMRUJLR19TVFlMRTEgKSB7CiAgICAgICAgICAgICAgICAvLyBJbnNpZGUgdGhlIGZyYW1lCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmZyYW1lYmV2ZWwgKSB7CiAgICAgICAgICAgICAgICAgICAgJHgxID0gJHkxID0gJHRoaXMtPmZyYW1lYmV2ZWxkZXB0aCArIDEgOwogICAgICAgICAgICAgICAgICAgICR4MiA9ICR0aGlzLT5pbWctPndpZHRoIC0gJHRoaXMtPmZyYW1lYmV2ZWxkZXB0aCAtIDIgOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT50aXRsZS0+bWFyZ2luICs9ICR0aGlzLT5mcmFtZWJldmVsZGVwdGggKyAxIDsKICAgICAgICAgICAgICAgICAgICAkaCArPSAkeTEgOwogICAgICAgICAgICAgICAgICAgICRoICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkeDEgPSAkeTEgPSAkdGhpcy0+ZnJhbWVfd2VpZ2h0OwogICAgICAgICAgICAgICAgICAgICR4MiA9ICR0aGlzLT5pbWctPndpZHRoIC0gJHRoaXMtPmZyYW1lX3dlaWdodC0xOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9zdHlsZSA9PT0gVElUTEVCS0dfU1RZTEUyICkgewogICAgICAgICAgICAgICAgLy8gQ292ZXIgdGhlIGZyYW1lIGFzIHdlbGwKICAgICAgICAgICAgICAgICR4MSA9ICR5MSA9IDA7CiAgICAgICAgICAgICAgICAkeDIgPSAkdGhpcy0+aW1nLT53aWR0aCAtIDEgOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9zdHlsZSA9PT0gVElUTEVCS0dfU1RZTEUzICkgewogICAgICAgICAgICAgICAgLy8gQ292ZXIgdGhlIGZyYW1lIGFzIHdlbGwgKHRoZSBkaWZmZXJlbmNlIGlzIHRoYXQKICAgICAgICAgICAgICAgIC8vIGZvciBzdHlsZT09MyBhIGJldmVsIGZyYW1lIGJvcmRlciBpcyBvbiB0b3AKICAgICAgICAgICAgICAgIC8vIG9mIHRoZSB0aXRsZSBiYWNrZ3JvdW5kKQogICAgICAgICAgICAgICAgJHgxID0gJHkxID0gMDsKICAgICAgICAgICAgICAgICR4MiA9ICR0aGlzLT5pbWctPndpZHRoIC0gMSA7CiAgICAgICAgICAgICAgICAkaCArPSAkdGhpcy0+ZnJhbWViZXZlbGRlcHRoIDsKICAgICAgICAgICAgICAgICR0aGlzLT50aXRsZS0+bWFyZ2luICs9ICR0aGlzLT5mcmFtZWJldmVsZGVwdGggOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNDMpOy8vKCdVbmtub3duIHRpdGxlIGJhY2tncm91bmQgc3R5bGUuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX2ZyYW1lc3R5bGUgPT09IDMgKSB7CiAgICAgICAgICAgICAgICAkaCArPSAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX2JldmVsaGVpZ2h0KjIgKyAxICA7CiAgICAgICAgICAgICAgICAkdGhpcy0+dGl0bGUtPm1hcmdpbiArPSAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX2JldmVsaGVpZ2h0IDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoICR0aGlzLT5kb3NoYWRvdyApIHsKICAgICAgICAgICAgICAgICR4MiAtPSAkdGhpcy0+c2hhZG93X3dpZHRoIDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGluZGVudD0wOwogICAgICAgICAgICBpZiggJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9mcmFtZXN0eWxlID09IFRJVExFQktHX0ZSQU1FX0JFVkVMICkgewogICAgICAgICAgICAgICAgJGluZGVudCA9ICR0aGlzLT50aXRsZWJhY2tncm91bmRfYmV2ZWxoZWlnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCAkdGhpcy0+dGl0bGVia2dfZmlsbHN0eWxlPT1USVRMRUJLR19GSUxMU1RZTEVfSFNUUklQRUQgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5GaWxsZWRSZWN0YW5nbGUyKCR4MSskaW5kZW50LCR5MSskaW5kZW50LCR4Mi0kaW5kZW50LCRoLSRpbmRlbnQsCiAgICAgICAgICAgICAgICAkdGhpcy0+dGl0bGVia2dfc2NvbG9yMSwKICAgICAgICAgICAgICAgICR0aGlzLT50aXRsZWJrZ19zY29sb3IyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICR0aGlzLT50aXRsZWJrZ19maWxsc3R5bGU9PVRJVExFQktHX0ZJTExTVFlMRV9WU1RSSVBFRCApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPkZpbGxlZFJlY3RhbmdsZTIoJHgxKyRpbmRlbnQsJHkxKyRpbmRlbnQsJHgyLSRpbmRlbnQsJGgtJGluZGVudCwKICAgICAgICAgICAgICAgICR0aGlzLT50aXRsZWJrZ19zY29sb3IxLAogICAgICAgICAgICAgICAgJHRoaXMtPnRpdGxlYmtnX3Njb2xvcjIsMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBTb2xpZCBmaWxsCiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5GaWxsZWRSZWN0YW5nbGUoJHgxLCR5MSwkeDIsJGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5pbWctPlBvcENvbG9yKCk7CgogICAgICAgICAgICAkdGhpcy0+aW1nLT5QdXNoQ29sb3IoJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9mcmFtZWNvbG9yKTsKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0TGluZVdlaWdodCgkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX2ZyYW1ld2VpZ2h0KTsKICAgICAgICAgICAgaWYoICR0aGlzLT50aXRsZWJhY2tncm91bmRfZnJhbWVzdHlsZSA9PSBUSVRMRUJLR19GUkFNRV9GVUxMICkgewogICAgICAgICAgICAgICAgLy8gRnJhbWUgYmFja2dyb3VuZAogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+UmVjdGFuZ2xlKCR4MSwkeTEsJHgyLCRoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICR0aGlzLT50aXRsZWJhY2tncm91bmRfZnJhbWVzdHlsZSA9PSBUSVRMRUJLR19GUkFNRV9CT1RUT00gKSB7CiAgICAgICAgICAgICAgICAvLyBCb3R0b20gbGluZSBvbmx5CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lKCR4MSwkaCwkeDIsJGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9mcmFtZXN0eWxlID09IFRJVExFQktHX0ZSQU1FX0JFVkVMICkgewogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+QmV2ZWwoJHgxLCR5MSwkeDIsJGgsJHRoaXMtPnRpdGxlYmFja2dyb3VuZF9iZXZlbGhlaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPmltZy0+UG9wQ29sb3IoKTsKCiAgICAgICAgICAgIC8vIFRoaXMgaXMgY2x1bXN5LiBCdXQgd2UgbmVlZWQgdG8gc3Ryb2tlIHRoZSB3aG9sZSBncmFwaCBmcmFtZSBpZiBpdCBpcwogICAgICAgICAgICAvLyBzZXQgdG8gYmV2ZWwgdG8gZ2V0IHRoZSBiZXZlbCBzaGFkaW5nIG9uIHRvcCBvZiB0aGUgdGV4dCBiYWNrZ3JvdW5kCiAgICAgICAgICAgIGlmKCAkdGhpcy0+ZnJhbWViZXZlbCAmJiAkdGhpcy0+ZG9mcmFtZSAmJiAkdGhpcy0+dGl0bGViYWNrZ3JvdW5kX3N0eWxlID09PSAzICkgewogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+QmV2ZWwoMSwxLCR0aGlzLT5pbWctPndpZHRoLTIsJHRoaXMtPmltZy0+aGVpZ2h0LTIsCiAgICAgICAgICAgICAgICAkdGhpcy0+ZnJhbWViZXZlbGRlcHRoLAogICAgICAgICAgICAgICAgJHRoaXMtPmZyYW1lYmV2ZWxjb2xvcjEsJHRoaXMtPmZyYW1lYmV2ZWxjb2xvcjIpOwogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5mcmFtZWJldmVsYm9yZGVyICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldENvbG9yKCR0aGlzLT5mcmFtZWJldmVsYm9yZGVyY29sb3IpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlJlY3RhbmdsZSgwLDAsJHRoaXMtPmltZy0+d2lkdGgtMSwkdGhpcy0+aW1nLT5oZWlnaHQtMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFN0cm9rZSB0aXRsZQogICAgICAgICR5ID0gJHRoaXMtPnRpdGxlLT5tYXJnaW47CiAgICAgICAgaWYoICR0aGlzLT50aXRsZS0+aGFsaWduID09ICdjZW50ZXInICkgewogICAgICAgICAgICAkdGhpcy0+dGl0bGUtPkNlbnRlcigwLCR0aGlzLT5pbWctPndpZHRoLCR5KTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkdGhpcy0+dGl0bGUtPmhhbGlnbiA9PSAnbGVmdCcgKSB7CiAgICAgICAgICAgICR0aGlzLT50aXRsZS0+U2V0UG9zKCR0aGlzLT50aXRsZS0+bWFyZ2luKzIsJHkpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT50aXRsZS0+aGFsaWduID09ICdyaWdodCcgKSB7CiAgICAgICAgICAgICRpbmRlbnQgPSAwOwogICAgICAgICAgICBpZiggJHRoaXMtPmRvc2hhZG93ICkgewogICAgICAgICAgICAgICAgJGluZGVudCA9ICR0aGlzLT5zaGFkb3dfd2lkdGgrMjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+dGl0bGUtPlNldFBvcygkdGhpcy0+aW1nLT53aWR0aC0kdGhpcy0+dGl0bGUtPm1hcmdpbi0kaW5kZW50LCR5LCdyaWdodCcpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+dGl0bGUtPlN0cm9rZSgkdGhpcy0+aW1nKTsKCiAgICAgICAgLy8gLi4uIGFuZCBzdWJ0aXRsZQogICAgICAgICR5ICs9ICR0aGlzLT50aXRsZS0+R2V0VGV4dEhlaWdodCgkdGhpcy0+aW1nKSArICRtYXJnaW4gKyAkdGhpcy0+c3VidGl0bGUtPm1hcmdpbjsKICAgICAgICBpZiggJHRoaXMtPnN1YnRpdGxlLT5oYWxpZ24gPT0gJ2NlbnRlcicgKSB7CiAgICAgICAgICAgICR0aGlzLT5zdWJ0aXRsZS0+Q2VudGVyKDAsJHRoaXMtPmltZy0+d2lkdGgsJHkpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT5zdWJ0aXRsZS0+aGFsaWduID09ICdsZWZ0JyApIHsKICAgICAgICAgICAgJHRoaXMtPnN1YnRpdGxlLT5TZXRQb3MoJHRoaXMtPnN1YnRpdGxlLT5tYXJnaW4rMiwkeSk7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggJHRoaXMtPnN1YnRpdGxlLT5oYWxpZ24gPT0gJ3JpZ2h0JyApIHsKICAgICAgICAgICAgJGluZGVudCA9IDA7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+ZG9zaGFkb3cgKQogICAgICAgICAgICAkaW5kZW50ID0gJHRoaXMtPnNoYWRvd193aWR0aCsyOwogICAgICAgICAgICAkdGhpcy0+c3VidGl0bGUtPlNldFBvcygkdGhpcy0+aW1nLT53aWR0aC0kdGhpcy0+c3VidGl0bGUtPm1hcmdpbi0kaW5kZW50LCR5LCdyaWdodCcpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+c3VidGl0bGUtPlN0cm9rZSgkdGhpcy0+aW1nKTsKCiAgICAgICAgLy8gLi4uIGFuZCBzdWJzdWJ0aXRsZQogICAgICAgICR5ICs9ICR0aGlzLT5zdWJ0aXRsZS0+R2V0VGV4dEhlaWdodCgkdGhpcy0+aW1nKSArICRtYXJnaW4gKyAkdGhpcy0+c3Vic3VidGl0bGUtPm1hcmdpbjsKICAgICAgICBpZiggJHRoaXMtPnN1YnN1YnRpdGxlLT5oYWxpZ24gPT0gJ2NlbnRlcicgKSB7CiAgICAgICAgICAgICR0aGlzLT5zdWJzdWJ0aXRsZS0+Q2VudGVyKDAsJHRoaXMtPmltZy0+d2lkdGgsJHkpOwogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT5zdWJzdWJ0aXRsZS0+aGFsaWduID09ICdsZWZ0JyApIHsKICAgICAgICAgICAgJHRoaXMtPnN1YnN1YnRpdGxlLT5TZXRQb3MoJHRoaXMtPnN1YnN1YnRpdGxlLT5tYXJnaW4rMiwkeSk7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggJHRoaXMtPnN1YnN1YnRpdGxlLT5oYWxpZ24gPT0gJ3JpZ2h0JyApIHsKICAgICAgICAgICAgJGluZGVudCA9IDA7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+ZG9zaGFkb3cgKQogICAgICAgICAgICAkaW5kZW50ID0gJHRoaXMtPnNoYWRvd193aWR0aCsyOwogICAgICAgICAgICAkdGhpcy0+c3Vic3VidGl0bGUtPlNldFBvcygkdGhpcy0+aW1nLT53aWR0aC0kdGhpcy0+c3Vic3VidGl0bGUtPm1hcmdpbi0kaW5kZW50LCR5LCdyaWdodCcpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+c3Vic3VidGl0bGUtPlN0cm9rZSgkdGhpcy0+aW1nKTsKCiAgICAgICAgLy8gLi4uIGFuZCBmYW5jeSB0aXRsZQogICAgICAgICR0aGlzLT50YWJ0aXRsZS0+U3Ryb2tlKCR0aGlzLT5pbWcpOwoKICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2VUZXh0cygpIHsKICAgICAgICAvLyBTdHJva2UgYW55IHVzZXIgYWRkZWQgdGV4dCBvYmplY3RzCiAgICAgICAgaWYoICR0aGlzLT50ZXh0cyAhPSBudWxsICkgewogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkdGhpcy0+dGV4dHMpOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+dGV4dHNbJGldLT5TdHJva2VXaXRoU2NhbGUoJHRoaXMtPmltZywkdGhpcy0+eHNjYWxlLCR0aGlzLT55c2NhbGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPnkydGV4dHMgIT0gbnVsbCAmJiAkdGhpcy0+eTJzY2FsZSAhPSBudWxsICkgewogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCBjb3VudCgkdGhpcy0+eTJ0ZXh0cyk7ICsrJGkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT55MnRleHRzWyRpXS0+U3Ryb2tlV2l0aFNjYWxlKCR0aGlzLT5pbWcsJHRoaXMtPnhzY2FsZSwkdGhpcy0+eTJzY2FsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZVRhYmxlcygpIHsKICAgICAgICBpZiggJHRoaXMtPmlUYWJsZXMgIT0gbnVsbCApIHsKICAgICAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+aVRhYmxlcyk7CiAgICAgICAgICAgIGZvciggJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5pVGFibGVzWyRpXS0+U3Ryb2tlV2l0aFNjYWxlKCR0aGlzLT5pbWcsJHRoaXMtPnhzY2FsZSwkdGhpcy0+eXNjYWxlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBEaXNwbGF5Q2xpZW50U2lkZWFJbWFnZU1hcEFyZWFzKCkgewogICAgICAgIC8vIERlYnVnIHN0dWZmIC0gZGlzcGxheSB0aGUgb3V0bGluZSBvZiB0aGUgaW1hZ2UgbWFwIGFyZWFzCiAgICAgICAgJGNzaW09Jyc7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnBsb3RzIGFzICRwKSB7CiAgICAgICAgICAgICRjc2ltLj0gJHAtPkdldENTSU1hcmVhcygpOwogICAgICAgIH0KICAgICAgICAkY3NpbSAuPSAkdGhpcy0+bGVnZW5kLT5HZXRDU0lNYXJlYXMoKTsKICAgICAgICBpZiAocHJlZ19tYXRjaF9hbGwoIi9hcmVhIHNoYXBlPVwiKFx3KylcIiBjb29yZHM9XCIoWzAtOVwsIF0rKVwiLyIsICRjc2ltLCAkY29vcmRzKSkgewogICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRDb2xvcigkdGhpcy0+Y3NpbWNvbG9yKTsKICAgICAgICAgICAgJG4gPSBjb3VudCgkY29vcmRzWzBdKTsKICAgICAgICAgICAgZm9yICgkaT0wOyAkaSA8ICRuOyAkaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoICRjb29yZHNbMV1bJGldID09ICdwb2x5JyApIHsKICAgICAgICAgICAgICAgICAgICBwcmVnX21hdGNoX2FsbCgnL1xzKihbMC05XSspXHMqLFxzKihbMC05XSspXHMqLCovJywkY29vcmRzWzJdWyRpXSwkcHRzKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRTdGFydFBvaW50KCRwdHNbMV1bY291bnQoJHB0c1swXSktMV0sJHB0c1syXVtjb3VudCgkcHRzWzBdKS0xXSk7CiAgICAgICAgICAgICAgICAgICAgJG0gPSBjb3VudCgkcHRzWzBdKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKCRqPTA7ICRqIDwgJG07ICRqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+TGluZVRvKCRwdHNbMV1bJGpdLCRwdHNbMl1bJGpdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoICRjb29yZHNbMV1bJGldID09ICdyZWN0JyApIHsKICAgICAgICAgICAgICAgICAgICAkcHRzID0gcHJlZ19zcGxpdCgnLywvJywgJGNvb3Jkc1syXVskaV0pOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFN0YXJ0UG9pbnQoJHB0c1swXSwkcHRzWzFdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1syXSwkcHRzWzFdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1syXSwkcHRzWzNdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1swXSwkcHRzWzNdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1swXSwkcHRzWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBUZXh0IHNjYWxlIG9mZnNldCBpbiB3b3JsZCBjb29yZGluYXRlcwogICAgZnVuY3Rpb24gU2V0VGV4dFNjYWxlT2ZmKCRhT2ZmKSB7CiAgICAgICAgJHRoaXMtPnRleHRfc2NhbGVfb2ZmID0gJGFPZmY7CiAgICAgICAgJHRoaXMtPnhzY2FsZS0+dGV4dF9zY2FsZV9vZmYgPSAkYU9mZjsKICAgIH0KCiAgICAvLyBUZXh0IHdpZHRoIG9mIGJhciB0byBiZSBjZW50ZXJlZCBpbiBhYnNvbHV0ZSBwaXhlbHMKICAgIGZ1bmN0aW9uIFNldFRleHRTY2FsZUFic0NlbnRlck9mZigkYU9mZikgewogICAgICAgICR0aGlzLT50ZXh0X3NjYWxlX2Fic2NlbnRlcm9mZiA9ICRhT2ZmOwogICAgfQoKICAgIC8vIEdldCBZIG1pbiBhbmQgbWF4IHZhbHVlcyBmb3IgYWRkZWQgbGluZXMKICAgIGZ1bmN0aW9uIEdldExpbmVzWU1pbk1heCggJGFMaW5lcyApIHsKICAgICAgICAkbiA9IGNvdW50KCRhTGluZXMpOwogICAgICAgIGlmKCAkbiA9PSAwICkgcmV0dXJuIGZhbHNlOwogICAgICAgICRtaW4gPSAkYUxpbmVzWzBdLT5zY2FsZXBvc2l0aW9uIDsKICAgICAgICAkbWF4ID0gJG1pbiA7CiAgICAgICAgJGZsZyA9IGZhbHNlOwogICAgICAgIGZvciggJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgaWYoICRhTGluZXNbJGldLT5kaXJlY3Rpb24gPT0gSE9SSVpPTlRBTCApIHsKICAgICAgICAgICAgICAgICRmbGcgPSB0cnVlIDsKICAgICAgICAgICAgICAgICR2ID0gJGFMaW5lc1skaV0tPnNjYWxlcG9zaXRpb24gOwogICAgICAgICAgICAgICAgaWYoICRtaW4gPiAkdiApICRtaW4gPSAkdiA7CiAgICAgICAgICAgICAgICBpZiggJG1heCA8ICR2ICkgJG1heCA9ICR2IDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGZsZyA\/IGFycmF5KCRtaW4sJG1heCkgOiBmYWxzZSA7CiAgICB9CgogICAgLy8gR2V0IFggbWluIGFuZCBtYXggdmFsdWVzIGZvciBhZGRlZCBsaW5lcwogICAgZnVuY3Rpb24gR2V0TGluZXNYTWluTWF4KCAkYUxpbmVzICkgewogICAgICAgICRuID0gY291bnQoJGFMaW5lcyk7CiAgICAgICAgaWYoICRuID09IDAgKSByZXR1cm4gZmFsc2UgOwogICAgICAgICRtaW4gPSAkYUxpbmVzWzBdLT5zY2FsZXBvc2l0aW9uIDsKICAgICAgICAkbWF4ID0gJG1pbiA7CiAgICAgICAgJGZsZyA9IGZhbHNlOwogICAgICAgIGZvciggJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgaWYoICRhTGluZXNbJGldLT5kaXJlY3Rpb24gPT0gVkVSVElDQUwgKSB7CiAgICAgICAgICAgICAgICAkZmxnID0gdHJ1ZSA7CiAgICAgICAgICAgICAgICAkdiA9ICRhTGluZXNbJGldLT5zY2FsZXBvc2l0aW9uIDsKICAgICAgICAgICAgICAgIGlmKCAkbWluID4gJHYgKSAkbWluID0gJHYgOwogICAgICAgICAgICAgICAgaWYoICRtYXggPCAkdiApICRtYXggPSAkdiA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRmbGcgPyBhcnJheSgkbWluLCRtYXgpIDogZmFsc2UgOwogICAgfQoKICAgIC8vIEdldCBtaW4gYW5kIG1heCB2YWx1ZXMgZm9yIGFsbCBpbmNsdWRlZCBwbG90cwogICAgZnVuY3Rpb24gR2V0UGxvdHNZTWluTWF4KCRhUGxvdHMpIHsKICAgICAgICAkbiA9IGNvdW50KCRhUGxvdHMpOwogICAgICAgICRpPTA7CiAgICAgICAgZG8gewogICAgICAgICAgICBsaXN0KCR4bWF4LCRtYXgpID0gJGFQbG90c1skaV0tPk1heCgpOwogICAgICAgIH0gd2hpbGUoICsrJGkgPCAkbiAmJiAhaXNfbnVtZXJpYygkbWF4KSApOwoKICAgICAgICAkaT0wOwogICAgICAgIGRvIHsKICAgICAgICAgICAgbGlzdCgkeG1pbiwkbWluKSA9ICRhUGxvdHNbJGldLT5NaW4oKTsKICAgICAgICB9IHdoaWxlKCArKyRpIDwgJG4gJiYgIWlzX251bWVyaWMoJG1pbikgKTsKCiAgICAgICAgaWYoICFpc19udW1lcmljKCRtaW4pIHx8ICFpc19udW1lcmljKCRtYXgpICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA0NCk7Ly8oJ0Nhbm5vdCB1c2UgYXV0b3NjYWxpbmcgc2luY2UgaXQgaXMgaW1wb3NzaWJsZSB0byBkZXRlcm1pbmUgYSB2YWxpZCBtaW4vbWF4IHZhbHVlICBvZiB0aGUgWS1heGlzIChvbmx5IG51bGwgdmFsdWVzKS4nKTsKICAgICAgICB9CgogICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICBsaXN0KCR4bWF4LCR5bWF4KT0kYVBsb3RzWyRpXS0+TWF4KCk7CiAgICAgICAgICAgIGxpc3QoJHhtaW4sJHltaW4pPSRhUGxvdHNbJGldLT5NaW4oKTsKICAgICAgICAgICAgaWYgKGlzX251bWVyaWMoJHltYXgpKSAkbWF4PW1heCgkbWF4LCR5bWF4KTsKICAgICAgICAgICAgaWYgKGlzX251bWVyaWMoJHltaW4pKSAkbWluPW1pbigkbWluLCR5bWluKTsKICAgICAgICB9CiAgICAgICAgaWYoICRtaW4gPT0gJycgKSAkbWluID0gMDsKICAgICAgICBpZiggJG1heCA9PSAnJyApICRtYXggPSAwOwogICAgICAgIGlmKCAkbWluID09IDAgJiYgJG1heCA9PSAwICkgewogICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UgaWYgYWxsIHZhbHVlcyBhcmUgMAogICAgICAgICAgICAkbWluPTA7JG1heD0xOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyYXkoJG1pbiwkbWF4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYXNMaW5lUGxvdEFuZEJhclBsb3QoKSB7CiAgICAgICAgJGhhc19saW5lID0gZmFsc2U7CiAgICAgICAgJGhhc19iYXIgID0gZmFsc2U7CgogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5wbG90cyBhcyAkcGxvdCkgewogICAgICAgICAgICBpZiAoJHBsb3QgaW5zdGFuY2VvZiBMaW5lUGxvdCkgewogICAgICAgICAgICAgICAgJGhhc19saW5lID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHBsb3QgaW5zdGFuY2VvZiBCYXJQbG90KSB7CiAgICAgICAgICAgICAgICAkaGFzX2JhciA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkaGFzX2xpbmUgJiYgJGhhc19iYXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0VGhlbWUoJGdyYXBoX3RoZW1lKSB7CgogICAgICAgIGlmICghKCR0aGlzIGluc3RhbmNlb2YgUGllR3JhcGgpKSB7CiAgICAgICAgICAgIGlmICghJHRoaXMtPmlzQWZ0ZXJTZXRTY2FsZSkgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMzMpOy8vKCdVc2UgR3JhcGg6OlNldFRoZW1lKCkgYWZ0ZXIgR3JhcGg6OlNldFNjYWxlKCkuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+Z3JhcGhfdGhlbWUpIHsKICAgICAgICAgICAgJHRoaXMtPkNsZWFyVGhlbWUoKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmdyYXBoX3RoZW1lID0gJGdyYXBoX3RoZW1lOwogICAgICAgICR0aGlzLT5ncmFwaF90aGVtZS0+QXBwbHlHcmFwaCgkdGhpcyk7CiAgICB9CgogICAgZnVuY3Rpb24gQ2xlYXJUaGVtZSgpIHsKICAgICAgICAkdGhpcy0+Z3JhcGhfdGhlbWUgPSBudWxsOwoKICAgICAgICAkdGhpcy0+aXNSdW5uaW5nQ2xlYXIgPSB0cnVlOwoKICAgICAgICAkdGhpcy0+X19jb25zdHJ1Y3QoCiAgICAgICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FXaWR0aCddLAogICAgICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhSGVpZ2h0J10sCiAgICAgICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FDYWNoZWROYW1lJ10sCiAgICAgICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FUaW1lb3V0J10sCiAgICAgICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FJbmxpbmUnXQogICAgICAgICAgICApOwogCiAgICAgICAgaWYgKCEoJHRoaXMgaW5zdGFuY2VvZiBQaWVHcmFwaCkpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5pc0FmdGVyU2V0U2NhbGUpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5TZXRTY2FsZSgKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhQXhpc1R5cGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhWU1pbiddLAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FZTWF4J10sCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbnB1dFZhbHVlc1snYVhNaW4nXSwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhWE1heCddCiAgICAgICAgICAgICAgICAgICAgKTsgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICR0aGlzLT5pc1J1bm5pbmdDbGVhciA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFN1cGVyc2FtcGxpbmcoJGRvID0gZmFsc2UsICRzY2FsZSA9IDIpIHsKICAgICAgICBpZiAoJGRvKSB7CiAgICAgICAgICAgIGRlZmluZSgnU1VQRVJTQU1QTElOR19TQ0FMRScsICRzY2FsZSk7CiAgICAgICAgICAgLy8gJHRoaXMtPmltZy0+c2NhbGUgPSAkc2NhbGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVmaW5lKCdTVVBFUlNBTVBMSU5HX1NDQUxFJywgMSk7CiAgICAgICAgICAgIC8vJHRoaXMtPmltZy0+c2NhbGUgPSAwOwogICAgICAgIH0KICAgIH0KCn0gLy8gQ2xhc3MKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIExpbmVQcm9wZXJ0eQovLyBEZXNjcmlwdGlvbjogSG9sZHMgcHJvcGVydGllcyBmb3IgYSBsaW5lCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIExpbmVQcm9wZXJ0eSB7CiAgICBwdWJsaWMgJGlXZWlnaHQ9MSwgJGlDb2xvcj0nYmxhY2snLCAkaVN0eWxlPSdzb2xpZCcsICRpU2hvdz1mYWxzZTsKCiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkYVdlaWdodD0xLCRhQ29sb3I9J2JsYWNrJywkYVN0eWxlPSdzb2xpZCcpIHsKICAgICAgICAkdGhpcy0+aVdlaWdodCA9ICRhV2VpZ2h0OwogICAgICAgICR0aGlzLT5pQ29sb3IgPSAkYUNvbG9yOwogICAgICAgICR0aGlzLT5pU3R5bGUgPSAkYVN0eWxlOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENvbG9yKCRhQ29sb3IpIHsKICAgICAgICAkdGhpcy0+aUNvbG9yID0gJGFDb2xvcjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRXZWlnaHQoJGFXZWlnaHQpIHsKICAgICAgICAkdGhpcy0+aVdlaWdodCA9ICRhV2VpZ2h0OwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFN0eWxlKCRhU3R5bGUpIHsKICAgICAgICAkdGhpcy0+aVN0eWxlID0gJGFTdHlsZTsKICAgIH0KCiAgICBmdW5jdGlvbiBTaG93KCRhU2hvdz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmlTaG93PSRhU2hvdzsKICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2UoJGFJbWcsJGFYMSwkYVkxLCRhWDIsJGFZMikgewogICAgICAgIGlmKCAkdGhpcy0+aVNob3cgKSB7CiAgICAgICAgICAgICRhSW1nLT5QdXNoQ29sb3IoJHRoaXMtPmlDb2xvcik7CiAgICAgICAgICAgICRvbGRscyA9ICRhSW1nLT5saW5lX3N0eWxlOwogICAgICAgICAgICAkb2xkbHcgPSAkYUltZy0+bGluZV93ZWlnaHQ7CiAgICAgICAgICAgICRhSW1nLT5TZXRMaW5lV2VpZ2h0KCR0aGlzLT5pV2VpZ2h0KTsKICAgICAgICAgICAgJGFJbWctPlNldExpbmVTdHlsZSgkdGhpcy0+aVN0eWxlKTsKICAgICAgICAgICAgJGFJbWctPlN0eWxlTGluZSgkYVgxLCRhWTEsJGFYMiwkYVkyKTsKICAgICAgICAgICAgJGFJbWctPlBvcENvbG9yKCR0aGlzLT5pQ29sb3IpOwogICAgICAgICAgICAkYUltZy0+bGluZV9zdHlsZSA9ICRvbGRsczsKICAgICAgICAgICAgJGFJbWctPmxpbmVfd2VpZ2h0ID0gJG9sZGx3OwoKICAgICAgICB9CiAgICB9Cn0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIEdyYXBoVGFiVGl0bGUKLy8gRGVzY3JpcHRpb246IERyYXcgInRhYiIgdGl0bGVzIG9uIHRvcCBvZiBncmFwaHMKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgR3JhcGhUYWJUaXRsZSBleHRlbmRzIFRleHR7CiAgICBwcml2YXRlICRjb3JuZXIgPSA2ICwgJHBvc3ggPSA3LCAkcG9zeSA9IDQ7CiAgICBwcml2YXRlICRmaWxsY29sb3I9J2xpZ2h0eWVsbG93JywkYm9yZGVyY29sb3I9J2JsYWNrJzsKICAgIHByaXZhdGUgJGFsaWduID0gJ2xlZnQnLCAkd2lkdGg9VEFCVElUTEVfV0lEVEhGSVQ7CiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpIHsKICAgICAgICAkdGhpcy0+dCA9ICcnOwogICAgICAgICR0aGlzLT5mb250X3N0eWxlID0gRlNfQk9MRDsKICAgICAgICAkdGhpcy0+aGlkZSA9IHRydWU7CiAgICAgICAgJHRoaXMtPmNvbG9yID0gJ2RhcmtyZWQnOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENvbG9yKCRhVHh0Q29sb3IsJGFGaWxsQ29sb3I9J2xpZ2h0eWVsbG93JywkYUJvcmRlckNvbG9yPSdibGFjaycpIHsKICAgICAgICAkdGhpcy0+Y29sb3IgPSAkYVR4dENvbG9yOwogICAgICAgICR0aGlzLT5maWxsY29sb3IgPSAkYUZpbGxDb2xvcjsKICAgICAgICAkdGhpcy0+Ym9yZGVyY29sb3IgPSAkYUJvcmRlckNvbG9yOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEZpbGxDb2xvcigkYUZpbGxDb2xvcikgewogICAgICAgICR0aGlzLT5maWxsY29sb3IgPSAkYUZpbGxDb2xvcjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRUYWJBbGlnbigkYUFsaWduKSB7CiAgICAgICAgJHRoaXMtPmFsaWduID0gJGFBbGlnbjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRXaWR0aCgkYVdpZHRoKSB7CiAgICAgICAgJHRoaXMtPndpZHRoID0gJGFXaWR0aCA7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0KCR0KSB7CiAgICAgICAgJHRoaXMtPnQgPSAkdDsKICAgICAgICAkdGhpcy0+aGlkZSA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENvcm5lcigkYUQpIHsKICAgICAgICAkdGhpcy0+Y29ybmVyID0gJGFEIDsKICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2UoJGFJbWcsJGFEdW1teTE9bnVsbCwkYUR1bW15Mj1udWxsKSB7CiAgICAgICAgaWYoICR0aGlzLT5oaWRlICkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICR0aGlzLT5ib3hlZCA9IGZhbHNlOwogICAgICAgICR3ID0gJHRoaXMtPkdldFdpZHRoKCRhSW1nKSArIDIqJHRoaXMtPnBvc3g7CiAgICAgICAgJGggPSAkdGhpcy0+R2V0VGV4dEhlaWdodCgkYUltZykgKyAyKiR0aGlzLT5wb3N5OwoKICAgICAgICAkeCA9ICRhSW1nLT5sZWZ0X21hcmdpbjsKICAgICAgICAkeSA9ICRhSW1nLT50b3BfbWFyZ2luOwoKICAgICAgICBpZiggJHRoaXMtPndpZHRoID09PSBUQUJUSVRMRV9XSURUSEZJVCApIHsKICAgICAgICAgICAgaWYoICR0aGlzLT5hbGlnbiA9PSAnbGVmdCcgKSB7CiAgICAgICAgICAgICAgICAkcCA9IGFycmF5KCR4LCAgICAgICAgICAgICAgICAkeSwKICAgICAgICAgICAgICAgICR4LCAgICAgICAgICAgICAgICAkeS0kaCskdGhpcy0+Y29ybmVyLAogICAgICAgICAgICAgICAgJHggKyAkdGhpcy0+Y29ybmVyLCR5LSRoLAogICAgICAgICAgICAgICAgJHggKyAkdyAtICR0aGlzLT5jb3JuZXIsICR5LSRoLAogICAgICAgICAgICAgICAgJHggKyAkdywgJHktJGgrJHRoaXMtPmNvcm5lciwKICAgICAgICAgICAgICAgICR4ICsgJHcsICR5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICR0aGlzLT5hbGlnbiA9PSAnY2VudGVyJyApIHsKICAgICAgICAgICAgICAgICR4ICs9IHJvdW5kKCRhSW1nLT5wbG90d2lkdGgvMikgLSByb3VuZCgkdy8yKTsKICAgICAgICAgICAgICAgICRwID0gYXJyYXkoJHgsICR5LAogICAgICAgICAgICAgICAgJHgsICR5LSRoKyR0aGlzLT5jb3JuZXIsCiAgICAgICAgICAgICAgICAkeCArICR0aGlzLT5jb3JuZXIsICR5LSRoLAogICAgICAgICAgICAgICAgJHggKyAkdyAtICR0aGlzLT5jb3JuZXIsICR5LSRoLAogICAgICAgICAgICAgICAgJHggKyAkdywgJHktJGgrJHRoaXMtPmNvcm5lciwKICAgICAgICAgICAgICAgICR4ICsgJHcsICR5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICR4ICs9ICRhSW1nLT5wbG90d2lkdGggLSR3OwogICAgICAgICAgICAgICAgJHAgPSBhcnJheSgkeCwgJHksCiAgICAgICAgICAgICAgICAkeCwgJHktJGgrJHRoaXMtPmNvcm5lciwKICAgICAgICAgICAgICAgICR4ICsgJHRoaXMtPmNvcm5lciwkeS0kaCwKICAgICAgICAgICAgICAgICR4ICsgJHcgLSAkdGhpcy0+Y29ybmVyLCAkeS0kaCwKICAgICAgICAgICAgICAgICR4ICsgJHcsICR5LSRoKyR0aGlzLT5jb3JuZXIsCiAgICAgICAgICAgICAgICAkeCArICR3LCAkeSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+d2lkdGggPT09IFRBQlRJVExFX1dJRFRIRlVMTCApIHsKICAgICAgICAgICAgICAgICR3ID0gJGFJbWctPnBsb3R3aWR0aCA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkdyA9ICR0aGlzLT53aWR0aCA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE1ha2UgdGhlIHRhYiBmaXQgdGhlIHdpZHRoIG9mIHRoZSBwbG90IGFyZWEKICAgICAgICAgICAgJHAgPSBhcnJheSgkeCwgJHksCiAgICAgICAgICAgICR4LCAkeS0kaCskdGhpcy0+Y29ybmVyLAogICAgICAgICAgICAkeCArICR0aGlzLT5jb3JuZXIsJHktJGgsCiAgICAgICAgICAgICR4ICsgJHcgLSAkdGhpcy0+Y29ybmVyLCAkeS0kaCwKICAgICAgICAgICAgJHggKyAkdywgJHktJGgrJHRoaXMtPmNvcm5lciwKICAgICAgICAgICAgJHggKyAkdywgJHkpOwoKICAgICAgICB9CiAgICAgICAgaWYoICR0aGlzLT5oYWxpZ24gPT0gJ2xlZnQnICkgewogICAgICAgICAgICAkYUltZy0+U2V0VGV4dEFsaWduKCdsZWZ0JywnYm90dG9tJyk7CiAgICAgICAgICAgICR4ICs9ICR0aGlzLT5wb3N4OwogICAgICAgICAgICAkeSAtPSAkdGhpcy0+cG9zeTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkdGhpcy0+aGFsaWduID09ICdjZW50ZXInICkgewogICAgICAgICAgICAkYUltZy0+U2V0VGV4dEFsaWduKCdjZW50ZXInLCdib3R0b20nKTsKICAgICAgICAgICAgJHggKz0gJHcvMjsKICAgICAgICAgICAgJHkgLT0gJHRoaXMtPnBvc3k7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkYUltZy0+U2V0VGV4dEFsaWduKCdyaWdodCcsJ2JvdHRvbScpOwogICAgICAgICAgICAkeCArPSAkdyAtICR0aGlzLT5wb3N4OwogICAgICAgICAgICAkeSAtPSAkdGhpcy0+cG9zeTsKICAgICAgICB9CgogICAgICAgICRhSW1nLT5TZXRDb2xvcigkdGhpcy0+ZmlsbGNvbG9yKTsKICAgICAgICAkYUltZy0+RmlsbGVkUG9seWdvbigkcCk7CgogICAgICAgICRhSW1nLT5TZXRDb2xvcigkdGhpcy0+Ym9yZGVyY29sb3IpOwogICAgICAgICRhSW1nLT5Qb2x5Z29uKCRwLHRydWUpOwoKICAgICAgICAkYUltZy0+U2V0Q29sb3IoJHRoaXMtPmNvbG9yKTsKICAgICAgICAkYUltZy0+U2V0Rm9udCgkdGhpcy0+Zm9udF9mYW1pbHksJHRoaXMtPmZvbnRfc3R5bGUsJHRoaXMtPmZvbnRfc2l6ZSk7CiAgICAgICAgJGFJbWctPlN0cm9rZVRleHQoJHgsJHksJHRoaXMtPnQsMCwnY2VudGVyJyk7CiAgICB9Cgp9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBTdXBlclNjcmlwdFRleHQKLy8gRGVzY3JpcHRpb246IEZvcm1hdCBhIHN1cGVyc2NyaXB0IHRleHQKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgU3VwZXJTY3JpcHRUZXh0IGV4dGVuZHMgVGV4dCB7CiAgICBwcml2YXRlICRpU3VwZXI9Jyc7CiAgICBwcml2YXRlICRzZm9udF9mYW1pbHk9JycsJHNmb250X3N0eWxlPScnLCRzZm9udF9zaXplPTg7CiAgICBwcml2YXRlICRpU3VwZXJNYXJnaW49MiwkaVZlcnRPdmVybGFwPTQsJGlTdXBlclNjYWxlPTAuNjU7CiAgICBwcml2YXRlICRpU0Rpcj0wOwogICAgcHJpdmF0ZSAkaVNpbXBsZT1mYWxzZTsKCiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkYVR4dD0nJywkYVN1cGVyPScnLCRhWEFic1Bvcz0wLCRhWUFic1Bvcz0wKSB7CiAgICAgICAgcGFyZW50OjpfX2NvbnN0cnVjdCgkYVR4dCwkYVhBYnNQb3MsJGFZQWJzUG9zKTsKICAgICAgICAkdGhpcy0+aVN1cGVyID0gJGFTdXBlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBGcm9tUmVhbCgkYVZhbCwkYVByZWNpc2lvbj0yKSB7CiAgICAgICAgLy8gQ29udmVydCBhIGZsb2F0aW5nIHBvaW50IG51bWJlciB0byBzY2llbnRpZmljIG5vdGF0aW9uCiAgICAgICAgJG5lZz0xLjA7CiAgICAgICAgaWYoICRhVmFsIDwgMCApIHsKICAgICAgICAgICAgJG5lZyA9IC0xLjA7CiAgICAgICAgICAgICRhVmFsID0gLSRhVmFsOwogICAgICAgIH0KCiAgICAgICAgJGwgPSBmbG9vcihsb2cxMCgkYVZhbCkpOwogICAgICAgICRhID0gc3ByaW50ZigiJTAuIi4kYVByZWNpc2lvbi4iZiIscm91bmQoJGFWYWwgLyBwb3coMTAsJGwpLCRhUHJlY2lzaW9uKSk7CiAgICAgICAgJGEgKj0gJG5lZzsKICAgICAgICBpZiggJHRoaXMtPmlTaW1wbGUgJiYgKCRhID09IDEgfHwgJGE9PS0xKSApICRhID0gJyc7CgogICAgICAgIGlmKCAkYSAhPSAnJyApIHsKICAgICAgICAgICAgJHRoaXMtPnQgPSAkYS4nICogMTAnOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoICRuZWcgPT0gMSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT50ID0gJzEwJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICR0aGlzLT50ID0gJy0xMCc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlTdXBlciA9ICRsOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldCgkYVR4dCwkYVN1cGVyPScnKSB7CiAgICAgICAgJHRoaXMtPnQgPSAkYVR4dDsKICAgICAgICAkdGhpcy0+aVN1cGVyID0gJGFTdXBlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRTdXBlckZvbnQoJGFGb250RmFtLCRhRm9udFN0eWxlPUZTX05PUk1BTCwkYUZvbnRTaXplPTgpIHsKICAgICAgICAkdGhpcy0+c2ZvbnRfZmFtaWx5ID0gJGFGb250RmFtOwogICAgICAgICR0aGlzLT5zZm9udF9zdHlsZSA9ICRhRm9udFN0eWxlOwogICAgICAgICR0aGlzLT5zZm9udF9zaXplID0gJGFGb250U2l6ZTsKICAgIH0KCiAgICAvLyBUb3RhbCB3aWR0aCBvZiB0ZXh0CiAgICBmdW5jdGlvbiBHZXRXaWR0aCgkYUltZykgewogICAgICAgICRhSW1nLT5TZXRGb250KCR0aGlzLT5mb250X2ZhbWlseSwkdGhpcy0+Zm9udF9zdHlsZSwkdGhpcy0+Zm9udF9zaXplKTsKICAgICAgICAkdyA9ICRhSW1nLT5HZXRUZXh0V2lkdGgoJHRoaXMtPnQpOwogICAgICAgICRhSW1nLT5TZXRGb250KCR0aGlzLT5zZm9udF9mYW1pbHksJHRoaXMtPnNmb250X3N0eWxlLCR0aGlzLT5zZm9udF9zaXplKTsKICAgICAgICAkdyArPSAkYUltZy0+R2V0VGV4dFdpZHRoKCR0aGlzLT5pU3VwZXIpOwogICAgICAgICR3ICs9ICR0aGlzLT5pU3VwZXJNYXJnaW47CiAgICAgICAgcmV0dXJuICR3OwogICAgfQoKICAgIC8vIEhpZ2h0IG9mIGZvbnQgKGFwcHJveGltYXRlIHRoZSBoZWlnaHQgb2YgdGhlIHRleHQpCiAgICBmdW5jdGlvbiBHZXRGb250SGVpZ2h0KCRhSW1nKSB7CiAgICAgICAgJGFJbWctPlNldEZvbnQoJHRoaXMtPmZvbnRfZmFtaWx5LCR0aGlzLT5mb250X3N0eWxlLCR0aGlzLT5mb250X3NpemUpOwogICAgICAgICRoID0gJGFJbWctPkdldEZvbnRIZWlnaHQoKTsKICAgICAgICAkYUltZy0+U2V0Rm9udCgkdGhpcy0+c2ZvbnRfZmFtaWx5LCR0aGlzLT5zZm9udF9zdHlsZSwkdGhpcy0+c2ZvbnRfc2l6ZSk7CiAgICAgICAgJGggKz0gJGFJbWctPkdldEZvbnRIZWlnaHQoKTsKICAgICAgICByZXR1cm4gJGg7CiAgICB9CgogICAgLy8gSGlnaHQgb2YgdGV4dAogICAgZnVuY3Rpb24gR2V0VGV4dEhlaWdodCgkYUltZykgewogICAgICAgICRhSW1nLT5TZXRGb250KCR0aGlzLT5mb250X2ZhbWlseSwkdGhpcy0+Zm9udF9zdHlsZSwkdGhpcy0+Zm9udF9zaXplKTsKICAgICAgICAkaCA9ICRhSW1nLT5HZXRUZXh0SGVpZ2h0KCR0aGlzLT50KTsKICAgICAgICAkYUltZy0+U2V0Rm9udCgkdGhpcy0+c2ZvbnRfZmFtaWx5LCR0aGlzLT5zZm9udF9zdHlsZSwkdGhpcy0+c2ZvbnRfc2l6ZSk7CiAgICAgICAgJGggKz0gJGFJbWctPkdldFRleHRIZWlnaHQoJHRoaXMtPmlTdXBlcik7CiAgICAgICAgcmV0dXJuICRoOwogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZSgkYUltZywkYXg9LTEsJGF5PS0xKSB7CgogICAgICAgIC8vIFRvIHBvc2l0aW9uIHRoZSBzdXBlciBzY3JpcHQgY29ycmVjdGx5IHdlIG5lZWQgZGlmZmVyZW50CiAgICAgICAgLy8gY2FzZXMgdG8gaGFuZGxlIHRoZSBhbGlnbm1ld250IHNwZWNpZmllZCBzaW5jZSB0aGF0IHdpbGwKICAgICAgICAvLyBkZXRlcm1pbmUgaG93IHdlIGNhbiBpbnRlcnByZXQgdGhlIHgseSBjb29yZGluYXRlcwoKICAgICAgICAkdyA9IHBhcmVudDo6R2V0V2lkdGgoJGFJbWcpOwogICAgICAgICRoID0gcGFyZW50OjpHZXRUZXh0SGVpZ2h0KCRhSW1nKTsKICAgICAgICBzd2l0Y2goICR0aGlzLT52YWxpZ24gKSB7CiAgICAgICAgICAgIGNhc2UgJ3RvcCc6CiAgICAgICAgICAgICAgICAkc3kgPSAkdGhpcy0+eTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdjZW50ZXInOgogICAgICAgICAgICAgICAgJHN5ID0gJHRoaXMtPnkgLSAkaC8yOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6CiAgICAgICAgICAgICAgICAkc3kgPSAkdGhpcy0+eSAtICRoOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA1Mik7Ly8oJ1BBTklDOiBJbnRlcm5hbCBlcnJvciBpbiBTdXBlclNjcmlwdDo6U3Ryb2tlKCkuIFVua25vd24gdmVydGljYWwgYWxpZ25tZW50IGZvciB0ZXh0Jyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCggJHRoaXMtPmhhbGlnbiApIHsKICAgICAgICAgICAgY2FzZSAnbGVmdCc6CiAgICAgICAgICAgICAgICAkc3ggPSAkdGhpcy0+eCArICR3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2NlbnRlcic6CiAgICAgICAgICAgICAgICAkc3ggPSAkdGhpcy0+eCArICR3LzI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAncmlnaHQnOgogICAgICAgICAgICAgICAgJHN4ID0gJHRoaXMtPng7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDUzKTsvLygnUEFOSUM6IEludGVybmFsIGVycm9yIGluIFN1cGVyU2NyaXB0OjpTdHJva2UoKS4gVW5rbm93biBob3Jpem9udGFsIGFsaWdubWVudCBmb3IgdGV4dCcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICAkc3ggKz0gJHRoaXMtPmlTdXBlck1hcmdpbjsKICAgICAgICAkc3kgKz0gJHRoaXMtPmlWZXJ0T3ZlcmxhcDsKCiAgICAgICAgLy8gU2hvdWxkIHdlIGF1dG9tYXRpY2FsbHkgZGV0ZXJtaW5lIHRoZSBmb250IG9yCiAgICAgICAgLy8gaGFzIHRoZSB1c2VyIHNwZWNpZmllZCBpdCBleHBsaWNldGx5PwogICAgICAgIGlmKCAkdGhpcy0+c2ZvbnRfZmFtaWx5ID09ICcnICkgewogICAgICAgICAgICBpZiggJHRoaXMtPmZvbnRfZmFtaWx5IDw9IEZGX0ZPTlQyICkgewogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5mb250X2ZhbWlseSA9PSBGRl9GT05UMCApIHsKICAgICAgICAgICAgICAgICAgICAkc2ZmID0gRkZfRk9OVDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoICR0aGlzLT5mb250X2ZhbWlseSA9PSBGRl9GT05UMSApIHsKICAgICAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmZvbnRfc3R5bGUgPT0gRlNfTk9STUFMICkgewogICAgICAgICAgICAgICAgICAgICAgICAkc2ZmID0gRkZfRk9OVDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkc2ZmID0gRkZfRk9OVDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHNmZiA9IEZGX0ZPTlQxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHNmcyA9ICR0aGlzLT5mb250X3N0eWxlOwogICAgICAgICAgICAgICAgJHNmeiA9ICR0aGlzLT5mb250X3NpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBUVEYgZm9udHMKICAgICAgICAgICAgICAgICRzZmYgPSAkdGhpcy0+Zm9udF9mYW1pbHk7CiAgICAgICAgICAgICAgICAkc2ZzID0gJHRoaXMtPmZvbnRfc3R5bGU7CiAgICAgICAgICAgICAgICAkc2Z6ID0gZmxvb3IoJHRoaXMtPmZvbnRfc2l6ZSokdGhpcy0+aVN1cGVyU2NhbGUpOwogICAgICAgICAgICAgICAgaWYoICRzZnogPCA4ICkgJHNmeiA9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPnNmb250X2ZhbWlseSA9ICRzZmY7CiAgICAgICAgICAgICR0aGlzLT5zZm9udF9zdHlsZSA9ICRzZnM7CiAgICAgICAgICAgICR0aGlzLT5zZm9udF9zaXplID0gJHNmejsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRzZmYgPSAkdGhpcy0+c2ZvbnRfZmFtaWx5OwogICAgICAgICAgICAkc2ZzID0gJHRoaXMtPnNmb250X3N0eWxlOwogICAgICAgICAgICAkc2Z6ID0gJHRoaXMtPnNmb250X3NpemU7CiAgICAgICAgfQoKICAgICAgICBwYXJlbnQ6OlN0cm9rZSgkYUltZywkYXgsJGF5KTsKCiAgICAgICAgLy8gRm9yIHRoZSBidWlsdGluIGZvbnRzIHdlIG5lZWQgdG8gcmVkdWNlIHRoZSBtYXJnaW5zCiAgICAgICAgLy8gc2luY2UgdGhlIGJvdW5kaW5nIGJ4IHJlcG9ydGVkIGZvciB0aGUgYnVpbHRpbiBmb250cwogICAgICAgIC8vIGFyZSBtdWNoIGxhcmdlciB0aGFuIGZvciB0aGUgVFRGIGZvbnRzLgogICAgICAgIGlmKCAkc2ZmIDw9IEZGX0ZPTlQyICkgewogICAgICAgICAgICAkc3ggLT0gMjsKICAgICAgICAgICAgJHN5ICs9IDM7CiAgICAgICAgfQoKICAgICAgICAkYUltZy0+U2V0VGV4dEFsaWduKCdsZWZ0JywnYm90dG9tJyk7CiAgICAgICAgJGFJbWctPlNldEZvbnQoJHNmZiwkc2ZzLCRzZnopOwogICAgICAgICRhSW1nLT5QdXNoQ29sb3IoJHRoaXMtPmNvbG9yKTsKICAgICAgICAkYUltZy0+U3Ryb2tlVGV4dCgkc3gsJHN5LCR0aGlzLT5pU3VwZXIsJHRoaXMtPmlTRGlyLCdsZWZ0Jyk7CiAgICAgICAgJGFJbWctPlBvcENvbG9yKCk7CiAgICB9Cn0KCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBHcmlkCi8vIERlc2NyaXB0aW9uOiByZXNwb25zaWJsZSBmb3IgZHJhd2luZyBncmlkIGxpbmVzIGluIGdyYXBoCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIEdyaWQgewogICAgcHJvdGVjdGVkICRpbWc7CiAgICBwcm90ZWN0ZWQgJHNjYWxlOwogICAgcHJvdGVjdGVkICRtYWpvcmNvbG9yPScjQ0NDQ0NDJywkbWlub3Jjb2xvcj0nI0RERERERCc7CiAgICBwcm90ZWN0ZWQgJG1ham9ydHlwZT0nc29saWQnLCRtaW5vcnR5cGU9J3NvbGlkJzsKICAgIHByb3RlY3RlZCAkc2hvdz1mYWxzZSwgJHNob3dNaW5vcj1mYWxzZSwkbWFqb3J3ZWlnaHQ9MSwkbWlub3J3ZWlnaHQ9MTsKICAgIHByb3RlY3RlZCAkZmlsbD1mYWxzZSwkZmlsbGNvbG9yPWFycmF5KCcjRUZFRkVGJywnI0JCQ0NGRicpOwoKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRhQXhpcykgewogICAgICAgICR0aGlzLT5zY2FsZSA9ICRhQXhpcy0+c2NhbGU7CiAgICAgICAgJHRoaXMtPmltZyA9ICRhQXhpcy0+aW1nOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENvbG9yKCRhTWFqQ29sb3IsJGFNaW5Db2xvcj1mYWxzZSkgewogICAgICAgICR0aGlzLT5tYWpvcmNvbG9yPSRhTWFqQ29sb3I7CiAgICAgICAgaWYoICRhTWluQ29sb3IgPT09IGZhbHNlICkgewogICAgICAgICAgICAkYU1pbkNvbG9yID0gJGFNYWpDb2xvciA7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5taW5vcmNvbG9yID0gJGFNaW5Db2xvcjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRXZWlnaHQoJGFNYWpvcldlaWdodCwkYU1pbm9yV2VpZ2h0PTEpIHsKICAgICAgICAkdGhpcy0+bWFqb3J3ZWlnaHQ9JGFNYWpvcldlaWdodDsKICAgICAgICAkdGhpcy0+bWlub3J3ZWlnaHQ9JGFNaW5vcldlaWdodDsKICAgIH0KCiAgICAvLyBTcGVjaWZ5IGlmIGdyaWQgc2hvdWxkIGJlIGRhc2hlZCwgZG90dGVkIG9yIHNvbGlkCiAgICBmdW5jdGlvbiBTZXRMaW5lU3R5bGUoJGFNYWpvclR5cGUsJGFNaW5vclR5cGU9J3NvbGlkJykgewogICAgICAgICR0aGlzLT5tYWpvcnR5cGUgPSAkYU1ham9yVHlwZTsKICAgICAgICAkdGhpcy0+bWlub3J0eXBlID0gJGFNaW5vclR5cGU7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0U3R5bGUoJGFNYWpvclR5cGUsJGFNaW5vclR5cGU9J3NvbGlkJykgewogICAgICAgICR0aGlzLT5TZXRMaW5lU3R5bGUoJGFNYWpvclR5cGUsJGFNaW5vclR5cGUpOwogICAgfQoKICAgIC8vIERlY2lkZSBpZiBib3RoIG1ham9yIGFuZCBtaW5vciBncmlkIHNob3VsZCBiZSBkaXNwbGF5ZWQKICAgIGZ1bmN0aW9uIFNob3coJGFTaG93TWFqb3I9dHJ1ZSwkYVNob3dNaW5vcj1mYWxzZSkgewogICAgICAgICR0aGlzLT5zaG93PSRhU2hvd01ham9yOwogICAgICAgICR0aGlzLT5zaG93TWlub3I9JGFTaG93TWlub3I7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0RmlsbCgkYUZsZz10cnVlLCRhQ29sb3IxPSdsaWdodGdyYXknLCRhQ29sb3IyPSdsaWdodGJsdWUnKSB7CiAgICAgICAgJHRoaXMtPmZpbGwgPSAkYUZsZzsKICAgICAgICAkdGhpcy0+ZmlsbGNvbG9yID0gYXJyYXkoICRhQ29sb3IxLCAkYUNvbG9yMiApOwogICAgfQoKICAgIC8vIERpc3BsYXkgdGhlIGdyaWQKICAgIGZ1bmN0aW9uIFN0cm9rZSgpIHsKICAgICAgICBpZiggJHRoaXMtPnNob3dNaW5vciAmJiAhJHRoaXMtPnNjYWxlLT50ZXh0c2NhbGUgKSB7CiAgICAgICAgICAgICR0aGlzLT5Eb1N0cm9rZSgkdGhpcy0+c2NhbGUtPnRpY2tzLT50aWNrc19wb3MsJHRoaXMtPm1pbm9ydHlwZSwkdGhpcy0+bWlub3Jjb2xvciwkdGhpcy0+bWlub3J3ZWlnaHQpOwogICAgICAgICAgICAkdGhpcy0+RG9TdHJva2UoJHRoaXMtPnNjYWxlLT50aWNrcy0+bWFqX3RpY2tzX3BvcywkdGhpcy0+bWFqb3J0eXBlLCR0aGlzLT5tYWpvcmNvbG9yLCR0aGlzLT5tYWpvcndlaWdodCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+RG9TdHJva2UoJHRoaXMtPnNjYWxlLT50aWNrcy0+bWFqX3RpY2tzX3BvcywkdGhpcy0+bWFqb3J0eXBlLCR0aGlzLT5tYWpvcmNvbG9yLCR0aGlzLT5tYWpvcndlaWdodCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLS0tLS0tLS0tLS0tLS0KICAgIC8vIFByaXZhdGUgbWV0aG9kcwogICAgLy8gRHJhdyB0aGUgZ3JpZAogICAgZnVuY3Rpb24gRG9TdHJva2UoJGFUaWNrc1BvcywkYVR5cGUsJGFDb2xvciwkYVdlaWdodCkgewogICAgICAgIGlmKCAhJHRoaXMtPnNob3cgKSByZXR1cm47CiAgICAgICAgJG5icmdyaWRzID0gY291bnQoJGFUaWNrc1Bvcyk7CgogICAgICAgIGlmKCAkdGhpcy0+c2NhbGUtPnR5cGUgPT0gJ3knICkgewogICAgICAgICAgICAkeGw9JHRoaXMtPmltZy0+bGVmdF9tYXJnaW47CiAgICAgICAgICAgICR4cj0kdGhpcy0+aW1nLT53aWR0aC0kdGhpcy0+aW1nLT5yaWdodF9tYXJnaW47CgogICAgICAgICAgICBpZiggJHRoaXMtPmZpbGwgKSB7CiAgICAgICAgICAgICAgICAvLyBEcmF3IGZpbGxlZCBhcmVhcwogICAgICAgICAgICAgICAgJHkyID0gJGFUaWNrc1Bvc1swXTsKICAgICAgICAgICAgICAgICRpPTE7CiAgICAgICAgICAgICAgICB3aGlsZSggJGkgPCAkbmJyZ3JpZHMgKSB7CiAgICAgICAgICAgICAgICAgICAgJHkxID0gJHkyOwogICAgICAgICAgICAgICAgICAgICR5MiA9ICRhVGlja3NQb3NbJGkrK107CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Q29sb3IoJHRoaXMtPmZpbGxjb2xvclskaSAmIDFdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5GaWxsZWRSZWN0YW5nbGUoJHhsLCR5MSwkeHIsJHkyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Q29sb3IoJGFDb2xvcik7CiAgICAgICAgICAgICR0aGlzLT5pbWctPlNldExpbmVXZWlnaHQoJGFXZWlnaHQpOwoKICAgICAgICAgICAgLy8gRHJhdyBncmlkIGxpbmVzCiAgICAgICAgICAgIHN3aXRjaCggJGFUeXBlICkgewogICAgICAgICAgICAgICAgY2FzZSAnc29saWQnOiAgJHN0eWxlID0gTElORVNUWUxFX1NPTElEOyBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2RvdHRlZCc6ICRzdHlsZSA9IExJTkVTVFlMRV9ET1RURUQ7IGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZGFzaGVkJzogJHN0eWxlID0gTElORVNUWUxFX0RBU0hFRDsgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdsb25nZGFzaGVkJzogJHN0eWxlID0gTElORVNUWUxFX0xPTkdEQVNIOyBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgJHN0eWxlID0gTElORVNUWUxFX1NPTElEOyBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG5icmdyaWRzOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkeT0kYVRpY2tzUG9zWyRpXTsKICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlN0eWxlTGluZSgkeGwsJHksJHhyLCR5LCRzdHlsZSx0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT5zY2FsZS0+dHlwZSA9PSAneCcgKSB7CiAgICAgICAgICAgICR5dT0kdGhpcy0+aW1nLT50b3BfbWFyZ2luOwogICAgICAgICAgICAkeWw9JHRoaXMtPmltZy0+aGVpZ2h0LSR0aGlzLT5pbWctPmJvdHRvbV9tYXJnaW47CiAgICAgICAgICAgICRsaW1pdD0kdGhpcy0+aW1nLT53aWR0aC0kdGhpcy0+aW1nLT5yaWdodF9tYXJnaW47CgogICAgICAgICAgICBpZiggJHRoaXMtPmZpbGwgKSB7CiAgICAgICAgICAgICAgICAvLyBEcmF3IGZpbGxlZCBhcmVhcwogICAgICAgICAgICAgICAgJHgyID0gJGFUaWNrc1Bvc1swXTsKICAgICAgICAgICAgICAgICRpPTE7CiAgICAgICAgICAgICAgICB3aGlsZSggJGkgPCAkbmJyZ3JpZHMgKSB7CiAgICAgICAgICAgICAgICAgICAgJHgxID0gJHgyOwogICAgICAgICAgICAgICAgICAgICR4MiA9IG1pbigkYVRpY2tzUG9zWyRpKytdLCRsaW1pdCkgOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldENvbG9yKCR0aGlzLT5maWxsY29sb3JbJGkgJiAxXSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKCR4MSwkeXUsJHgyLCR5bCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5pbWctPlNldENvbG9yKCRhQ29sb3IpOwogICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRMaW5lV2VpZ2h0KCRhV2VpZ2h0KTsKCiAgICAgICAgICAgIC8vIFdlIG11c3QgYWxzbyB0ZXN0IGZvciBsaW1pdCBzaW5jZSB3ZSBtaWdodCBoYXZlCiAgICAgICAgICAgIC8vIGFuIG9mZnNldCBhbmQgdGhlIG51bWJlciBvZiB0aWNrcyBpcyBjYWxjdWxhdGVkIHdpdGgKICAgICAgICAgICAgLy8gYXNzdW1wdGlvbiBvZmZzZXQ9PTAgc28gd2UgbWlnaHQgZW5kIHVwIGRyYXdpbmcgb25lCiAgICAgICAgICAgIC8vIHRvIG1hbnkgZ3JpZGxpbmVzCiAgICAgICAgICAgICRpPTA7CiAgICAgICAgICAgICR4PSRhVGlja3NQb3NbJGldOwogICAgICAgICAgICB3aGlsZSggJGk8Y291bnQoJGFUaWNrc1BvcykgJiYgKCR4PSRhVGlja3NQb3NbJGldKSA8PSAkbGltaXQgKSB7CiAgICAgICAgICAgICAgICBpZiAgICAoICRhVHlwZSA9PSAnc29saWQnICkgICAgICAkdGhpcy0+aW1nLT5MaW5lKCR4LCR5bCwkeCwkeXUpOwogICAgICAgICAgICAgICAgZWxzZWlmKCAkYVR5cGUgPT0gJ2RvdHRlZCcgKSAgICAgJHRoaXMtPmltZy0+RGFzaGVkTGluZUZvckdyaWQoJHgsJHlsLCR4LCR5dSwxLDYpOwogICAgICAgICAgICAgICAgZWxzZWlmKCAkYVR5cGUgPT0gJ2Rhc2hlZCcgKSAgICAgJHRoaXMtPmltZy0+RGFzaGVkTGluZUZvckdyaWQoJHgsJHlsLCR4LCR5dSwyLDQpOwogICAgICAgICAgICAgICAgZWxzZWlmKCAkYVR5cGUgPT0gJ2xvbmdkYXNoZWQnICkgJHRoaXMtPmltZy0+RGFzaGVkTGluZUZvckdyaWQoJHgsJHlsLCR4LCR5dSw4LDYpOwogICAgICAgICAgICAgICAgKyskaTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNTQsJHRoaXMtPnNjYWxlLT50eXBlKTsvLygnSW50ZXJuYWwgZXJyb3I6IFVua25vd24gZ3JpZCBheGlzIFsnLiR0aGlzLT5zY2FsZS0+dHlwZS4nXScpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfSAvLyBDbGFzcwoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ0xBU1MgQXhpcwovLyBEZXNjcmlwdGlvbjogRGVmaW5lcyBYIGFuZCBZIGF4aXMuIE5vdGVzIHRoYXQgYXQgdGhlCi8vIG1vbWVudCB0aGUgY29kZSBpcyBub3QgcmVhbGx5IGdvb2Qgc2luY2UgdGhlIGF4aXMgb24KLy8gc2V2ZXJhbCBvY2Nhc2lvbiBtdXN0IGtub3cgd2hldGVyIGl0J3MgYW4gWCBvciBZIGF4aXMuCi8vIFRoaXMgd2FzIGEgZGVzaWduIGRlY2lzaW9uIHRvIG1ha2UgdGhlIGNvZGUgZWFzaWVyIHRvCi8vIGZvbGxvdy4KLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgQXhpc1Byb3RvdHlwZSB7CiAgICBwdWJsaWMgJHNjYWxlPW51bGw7CiAgICBwdWJsaWMgJGltZz1udWxsOwogICAgcHVibGljICRoaWRlPWZhbHNlLCRoaWRlX2xhYmVscz1mYWxzZTsKICAgIHB1YmxpYyAkdGl0bGU9bnVsbDsKICAgIHB1YmxpYyAkZm9udF9mYW1pbHk9RkZfREVGQVVMVCwkZm9udF9zdHlsZT1GU19OT1JNQUwsJGZvbnRfc2l6ZT04LCRsYWJlbF9hbmdsZT0wOwogICAgcHVibGljICR0aWNrX3N0ZXA9MTsKICAgIHB1YmxpYyAkcG9zID0gZmFsc2U7CiAgICBwdWJsaWMgJHRpY2tzX2xhYmVsID0gYXJyYXkoKTsKCiAgICBwcm90ZWN0ZWQgJHdlaWdodD0xOwogICAgcHJvdGVjdGVkICRjb2xvcj1hcnJheSgwLDAsMCksJGxhYmVsX2NvbG9yPWFycmF5KDAsMCwwKTsKICAgIHByb3RlY3RlZCAkdGlja3NfbGFiZWxfY29sb3JzPW51bGw7CiAgICBwcm90ZWN0ZWQgJHNob3dfZmlyc3RfbGFiZWw9dHJ1ZSwkc2hvd19sYXN0X2xhYmVsPXRydWU7CiAgICBwcm90ZWN0ZWQgJGxhYmVsX3N0ZXA9MTsgLy8gVXNlZCBieSBhIHRleHQgYXhpcyB0byBzcGVjaWZ5IHdoYXQgbXVsdGlwbGUgb2YgbWFqb3Igc3RlcHMKICAgIC8vIHNob3VsZCBiZSBsYWJlbGVkLgogICAgcHJvdGVjdGVkICRsYWJlbFBvcz0wOyAgIC8vIFdoaWNoIHNpZGUgb2YgdGhlIGF4aXMgc2hvdWxkIHRoZSBsYWJlbHMgYmU\/CiAgICBwcm90ZWN0ZWQgJHRpdGxlX2FkanVzdCwkdGl0bGVfbWFyZ2luLCR0aXRsZV9zaWRlPVNJREVfTEVGVDsKICAgIHByb3RlY3RlZCAkdGlja19sYWJlbF9tYXJnaW49NTsKICAgIHByb3RlY3RlZCAkbGFiZWxfaGFsaWduID0gJycsJGxhYmVsX3ZhbGlnbiA9ICcnLCAkbGFiZWxfcGFyYV9hbGlnbj0nbGVmdCc7CiAgICBwcm90ZWN0ZWQgJGhpZGVfbGluZT1mYWxzZTsKICAgIHByb3RlY3RlZCAkaURlbHRhQWJzUG9zPTA7CgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGltZywkYVNjYWxlLCRjb2xvciA9IGFycmF5KDAsMCwwKSkgewogICAgICAgICR0aGlzLT5pbWcgPSAkaW1nOwogICAgICAgICR0aGlzLT5zY2FsZSA9ICRhU2NhbGU7CiAgICAgICAgJHRoaXMtPmNvbG9yID0gJGNvbG9yOwogICAgICAgICR0aGlzLT50aXRsZT1uZXcgVGV4dCgnJyk7CgogICAgICAgIGlmKCAkYVNjYWxlLT50eXBlID09ICd5JyApIHsKICAgICAgICAgICAgJHRoaXMtPnRpdGxlX21hcmdpbiA9IDI1OwogICAgICAgICAgICAkdGhpcy0+dGl0bGVfYWRqdXN0ID0gJ21pZGRsZSc7CiAgICAgICAgICAgICR0aGlzLT50aXRsZS0+U2V0T3JpZW50YXRpb24oOTApOwogICAgICAgICAgICAkdGhpcy0+dGlja19sYWJlbF9tYXJnaW49NzsKICAgICAgICAgICAgJHRoaXMtPmxhYmVsUG9zPVNJREVfTEVGVDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT50aXRsZV9tYXJnaW4gPSA1OwogICAgICAgICAgICAkdGhpcy0+dGl0bGVfYWRqdXN0ID0gJ2hpZ2gnOwogICAgICAgICAgICAkdGhpcy0+dGl0bGUtPlNldE9yaWVudGF0aW9uKDApOwogICAgICAgICAgICAkdGhpcy0+dGlja19sYWJlbF9tYXJnaW49NTsKICAgICAgICAgICAgJHRoaXMtPmxhYmVsUG9zPVNJREVfRE9XTjsKICAgICAgICAgICAgJHRoaXMtPnRpdGxlX3NpZGU9U0lERV9ET1dOOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMYWJlbEZvcm1hdCgkYUZvcm1TdHIpIHsKICAgICAgICAkdGhpcy0+c2NhbGUtPnRpY2tzLT5TZXRMYWJlbEZvcm1hdCgkYUZvcm1TdHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldExhYmVsRm9ybWF0U3RyaW5nKCRhRm9ybVN0ciwkYURhdGU9ZmFsc2UpIHsKICAgICAgICAkdGhpcy0+c2NhbGUtPnRpY2tzLT5TZXRMYWJlbEZvcm1hdCgkYUZvcm1TdHIsJGFEYXRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMYWJlbEZvcm1hdENhbGxiYWNrKCRhRnVuY05hbWUpIHsKICAgICAgICAkdGhpcy0+c2NhbGUtPnRpY2tzLT5TZXRGb3JtYXRDYWxsYmFjaygkYUZ1bmNOYW1lKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMYWJlbEFsaWduKCRhSEFsaWduLCRhVkFsaWduPSd0b3AnLCRhUGFyYWdyYXBoQWxpZ249J2xlZnQnKSB7CiAgICAgICAgJHRoaXMtPmxhYmVsX2hhbGlnbiA9ICRhSEFsaWduOwogICAgICAgICR0aGlzLT5sYWJlbF92YWxpZ24gPSAkYVZBbGlnbjsKICAgICAgICAkdGhpcy0+bGFiZWxfcGFyYV9hbGlnbiA9ICRhUGFyYWdyYXBoQWxpZ247CiAgICB9CgogICAgLy8gRG9uJ3QgZGlzcGxheSB0aGUgZmlyc3QgbGFiZWwKICAgIGZ1bmN0aW9uIEhpZGVGaXJzdFRpY2tMYWJlbCgkYVNob3c9ZmFsc2UpIHsKICAgICAgICAkdGhpcy0+c2hvd19maXJzdF9sYWJlbD0kYVNob3c7CiAgICB9CgogICAgZnVuY3Rpb24gSGlkZUxhc3RUaWNrTGFiZWwoJGFTaG93PWZhbHNlKSB7CiAgICAgICAgJHRoaXMtPnNob3dfbGFzdF9sYWJlbD0kYVNob3c7CiAgICB9CgogICAgLy8gTWFudWFsbHkgc3BlY2lmeSB0aGUgbWFqb3IgYW5kIChvcHRpb25hbCkgbWlub3IgdGljayBwb3NpdGlvbiBhbmQgbGFiZWxzCiAgICBmdW5jdGlvbiBTZXRUaWNrUG9zaXRpb25zKCRhTWFqUG9zLCRhTWluUG9zPU5VTEwsJGFMYWJlbHM9TlVMTCkgewogICAgICAgICR0aGlzLT5zY2FsZS0+dGlja3MtPlNldFRpY2tQb3NpdGlvbnMoJGFNYWpQb3MsJGFNaW5Qb3MsJGFMYWJlbHMpOwogICAgfQoKICAgIC8vIE1hbnVhbGx5IHNwZWNpZnkgbWFqb3IgdGljayBwb3NpdGlvbnMgYW5kIG9wdGlvbmFsIGxhYmVscwogICAgZnVuY3Rpb24gU2V0TWFqVGlja1Bvc2l0aW9ucygkYU1halBvcywkYUxhYmVscz1OVUxMKSB7CiAgICAgICAgJHRoaXMtPnNjYWxlLT50aWNrcy0+U2V0VGlja1Bvc2l0aW9ucygkYU1halBvcyxOVUxMLCRhTGFiZWxzKTsKICAgIH0KCiAgICAvLyBIaWRlIG1pbm9yIG9yIG1ham9yIHRpY2sgbWFya3MKICAgIGZ1bmN0aW9uIEhpZGVUaWNrcygkYUhpZGVNaW5vcj10cnVlLCRhSGlkZU1ham9yPXRydWUpIHsKICAgICAgICAkdGhpcy0+c2NhbGUtPnRpY2tzLT5TdXByZXNzTWlub3JUaWNrTWFya3MoJGFIaWRlTWlub3IpOwogICAgICAgICR0aGlzLT5zY2FsZS0+dGlja3MtPlN1cHJlc3NUaWNrTWFya3MoJGFIaWRlTWFqb3IpOwogICAgfQoKICAgIC8vIEhpZGUgemVybyBsYWJlbAogICAgZnVuY3Rpb24gSGlkZVplcm9MYWJlbCgkYUZsYWc9dHJ1ZSkgewogICAgICAgICR0aGlzLT5zY2FsZS0+dGlja3MtPlN1cHJlc3NaZXJvTGFiZWwoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBIaWRlRmlyc3RMYXN0TGFiZWwoKSB7CiAgICAgICAgLy8gVGhlIHR3byBmaXJzdCBjYWxscyB0byB0aWNrcyBtZXRob2Qgd2lsbCBzdXByZXNzCiAgICAgICAgLy8gYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgc2NhbGUgdmFsdWVzLiBIb3dldmVyLCB0aGF0CiAgICAgICAgLy8gd2lsbCBub3QgYWZmZWN0IG1hbnVhbGx5IHNwZWNpZmllZCB2YWx1ZSwgZS5nIHRleHQtc2NhbGVzLgogICAgICAgIC8vIHRoZXJlZm9yIHdlIGFsc28gbWFrZSBhIGtsdWRnZSBoZXJlIHRvIHN1cHJlc3MgbWFudWFsbHkKICAgICAgICAvLyBzcGVjaWZpZWQgc2NhbGUgbGFiZWxzLgogICAgICAgICR0aGlzLT5zY2FsZS0+dGlja3MtPlN1cHJlc3NMYXN0KCk7CiAgICAgICAgJHRoaXMtPnNjYWxlLT50aWNrcy0+U3VwcmVzc0ZpcnN0KCk7CiAgICAgICAgJHRoaXMtPnNob3dfZmlyc3RfbGFiZWwgPSBmYWxzZTsKICAgICAgICAkdGhpcy0+c2hvd19sYXN0X2xhYmVsID0gZmFsc2U7CiAgICB9CgogICAgLy8gSGlkZSB0aGUgYXhpcwogICAgZnVuY3Rpb24gSGlkZSgkYUhpZGU9dHJ1ZSkgewogICAgICAgICR0aGlzLT5oaWRlPSRhSGlkZTsKICAgIH0KCiAgICAvLyBIaWRlIHRoZSBhY3R1YWwgYXhpcy1saW5lLCBidXQgc3RpbGwgcHJpbnQgdGhlIGxhYmVscwogICAgZnVuY3Rpb24gSGlkZUxpbmUoJGFIaWRlPXRydWUpIHsKICAgICAgICAkdGhpcy0+aGlkZV9saW5lID0gJGFIaWRlOwogICAgfQoKICAgIGZ1bmN0aW9uIEhpZGVMYWJlbHMoJGFIaWRlPXRydWUpIHsKICAgICAgICAkdGhpcy0+aGlkZV9sYWJlbHMgPSAkYUhpZGU7CiAgICB9CgogICAgLy8gV2VpZ2h0IG9mIGF4aXMKICAgIGZ1bmN0aW9uIFNldFdlaWdodCgkYVdlaWdodCkgewogICAgICAgICR0aGlzLT53ZWlnaHQgPSAkYVdlaWdodDsKICAgIH0KCiAgICAvLyBBeGlzIGNvbG9yCiAgICBmdW5jdGlvbiBTZXRDb2xvcigkYUNvbG9yLCRhTGFiZWxDb2xvcj1mYWxzZSkgewogICAgICAgICR0aGlzLT5jb2xvciA9ICRhQ29sb3I7CiAgICAgICAgaWYoICEkYUxhYmVsQ29sb3IgKSAkdGhpcy0+bGFiZWxfY29sb3IgPSAkYUNvbG9yOwogICAgICAgIGVsc2UgJHRoaXMtPmxhYmVsX2NvbG9yID0gJGFMYWJlbENvbG9yOwogICAgfQoKICAgIC8vIFRpdGxlIG9uIGF4aXMKICAgIGZ1bmN0aW9uIFNldFRpdGxlKCRhVGl0bGUsJGFBZGp1c3RBbGlnbj0naGlnaCcpIHsKICAgICAgICAkdGhpcy0+dGl0bGUtPlNldCgkYVRpdGxlKTsKICAgICAgICAkdGhpcy0+dGl0bGVfYWRqdXN0PSRhQWRqdXN0QWxpZ247CiAgICB9CgogICAgLy8gU3BlY2lmeSBkaXN0YW5jZSBmcm9tIHRoZSBheGlzCiAgICBmdW5jdGlvbiBTZXRUaXRsZU1hcmdpbigkYU1hcmdpbikgewogICAgICAgICR0aGlzLT50aXRsZV9tYXJnaW49JGFNYXJnaW47CiAgICB9CgogICAgLy8gV2hpY2ggc2lkZSBvZiB0aGUgYXhpcyBzaG91bGQgdGhlIGF4aXMgdGl0bGUgYmU\/CiAgICBmdW5jdGlvbiBTZXRUaXRsZVNpZGUoJGFTaWRlT2ZBeGlzKSB7CiAgICAgICAgJHRoaXMtPnRpdGxlX3NpZGUgPSAkYVNpZGVPZkF4aXM7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0VGlja1NpZGUoJGFEaXIpIHsKICAgICAgICAkdGhpcy0+c2NhbGUtPnRpY2tzLT5TZXRTaWRlKCRhRGlyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRUaWNrU2l6ZSgkYU1halNpemUsJGFNaW5TaXplPTMpIHsKICAgICAgICAkdGhpcy0+c2NhbGUtPnRpY2tzLT5TZXRTaXplKCRhTWFqU2l6ZSwkYU1pblNpemU9Myk7CiAgICB9CgogICAgLy8gU3BlY2lmeSB0ZXh0IGxhYmVscyBmb3IgdGhlIHRpY2tzLiBPbmUgbGFiZWwgZm9yIGVhY2ggZGF0YSBwb2ludAogICAgZnVuY3Rpb24gU2V0VGlja0xhYmVscygkYUxhYmVsQXJyYXksJGFMYWJlbENvbG9yQXJyYXk9bnVsbCkgewogICAgICAgICR0aGlzLT50aWNrc19sYWJlbCA9ICRhTGFiZWxBcnJheTsKICAgICAgICAkdGhpcy0+dGlja3NfbGFiZWxfY29sb3JzID0gJGFMYWJlbENvbG9yQXJyYXk7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TGFiZWxNYXJnaW4oJGFNYXJnaW4pIHsKICAgICAgICAkdGhpcy0+dGlja19sYWJlbF9tYXJnaW49JGFNYXJnaW47CiAgICB9CgogICAgLy8gU3BlY2lmeSB0aGF0IGV2ZXJ5ICRzdGVwIG9mIHRoZSB0aWNrcyBzaG91bGQgYmUgZGlzcGxheWVkIHN0YXJ0aW5nCiAgICAvLyBhdCAkc3RhcnQKICAgIGZ1bmN0aW9uIFNldFRleHRUaWNrSW50ZXJ2YWwoJGFTdGVwLCRhU3RhcnQ9MCkgewogICAgICAgICR0aGlzLT5zY2FsZS0+dGlja3MtPlNldFRleHRMYWJlbFN0YXJ0KCRhU3RhcnQpOwogICAgICAgICR0aGlzLT50aWNrX3N0ZXA9JGFTdGVwOwogICAgfQoKICAgIC8vIFNwZWNpZnkgdGhhdCBldmVyeSAkc3RlcCB0aWNrIG1hcmsgc2hvdWxkIGhhdmUgYSBsYWJlbAogICAgLy8gc2hvdWxkIGJlIGRpc3BsYXllZCBzdGFydGluZwogICAgZnVuY3Rpb24gU2V0VGV4dExhYmVsSW50ZXJ2YWwoJGFTdGVwKSB7CiAgICAgICAgaWYoICRhU3RlcCA8IDEgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDU4KTsvLygiIFRleHQgbGFiZWwgaW50ZXJ2YWwgbXVzdCBiZSBzcGVjaWZpZWQgPj0gMS4iKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmxhYmVsX3N0ZXA9JGFTdGVwOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldExhYmVsU2lkZSgkYVNpZGVQb3MpIHsKICAgICAgICAkdGhpcy0+bGFiZWxQb3M9JGFTaWRlUG9zOwogICAgfQoKICAgIC8vIFNldCB0aGUgZm9udAogICAgZnVuY3Rpb24gU2V0Rm9udCgkYUZhbWlseSwkYVN0eWxlPUZTX05PUk1BTCwkYVNpemU9MTApIHsKICAgICAgICAkdGhpcy0+Zm9udF9mYW1pbHkgPSAkYUZhbWlseTsKICAgICAgICAkdGhpcy0+Zm9udF9zdHlsZSA9ICRhU3R5bGU7CiAgICAgICAgJHRoaXMtPmZvbnRfc2l6ZSA9ICRhU2l6ZTsKICAgIH0KCiAgICAvLyBQb3NpdGlvbiBmb3IgYXhpcyBsaW5lIG9uIHRoZSAib3RoZXIiIHNjYWxlCiAgICBmdW5jdGlvbiBTZXRQb3MoJGFQb3NPbk90aGVyU2NhbGUpIHsKICAgICAgICAkdGhpcy0+cG9zPSRhUG9zT25PdGhlclNjYWxlOwogICAgfQoKICAgIC8vIFNldCB0aGUgcG9zaXRpb24gb2YgdGhlIGF4aXMgdG8gYmUgWC1waXhlbHMgZGVsdGEgdG8gdGhlIHJpZ2h0CiAgICAvLyBvZiB0aGUgbWF4IFgtcG9zaXRpb24gKHVzZWQgdG8gcG9zaXRpb24gdGhlIG11bHRpcGxlIFktYXhpcykKICAgIGZ1bmN0aW9uIFNldFBvc0Fic0RlbHRhKCRhRGVsdGEpIHsKICAgICAgICAkdGhpcy0+aURlbHRhQWJzUG9zPSRhRGVsdGE7CiAgICB9CgogICAgLy8gU3BlY2lmeSB0aGUgYW5nbGUgZm9yIHRoZSB0aWNrIGxhYmVscwogICAgZnVuY3Rpb24gU2V0TGFiZWxBbmdsZSgkYUFuZ2xlKSB7CiAgICAgICAgJHRoaXMtPmxhYmVsX2FuZ2xlID0gJGFBbmdsZTsKICAgIH0KCn0gLy8gQ2xhc3MKCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBBeGlzCi8vIERlc2NyaXB0aW9uOiBEZWZpbmVzIFggYW5kIFkgYXhpcy4gTm90ZXMgdGhhdCBhdCB0aGUKLy8gbW9tZW50IHRoZSBjb2RlIGlzIG5vdCByZWFsbHkgZ29vZCBzaW5jZSB0aGUgYXhpcyBvbgovLyBzZXZlcmFsIG9jY2FzaW9uIG11c3Qga25vdyB3aGV0ZXIgaXQncyBhbiBYIG9yIFkgYXhpcy4KLy8gVGhpcyB3YXMgYSBkZXNpZ24gZGVjaXNpb24gdG8gbWFrZSB0aGUgY29kZSBlYXNpZXIgdG8KLy8gZm9sbG93LgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjbGFzcyBBeGlzIGV4dGVuZHMgQXhpc1Byb3RvdHlwZSB7CgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGltZywkYVNjYWxlLCRjb2xvcj0nYmxhY2snKSB7CiAgICAgICAgcGFyZW50OjpfX2NvbnN0cnVjdCgkaW1nLCRhU2NhbGUsJGNvbG9yKTsKICAgIH0KCiAgICAvLyBTdHJva2UgdGhlIGF4aXMuCiAgICBmdW5jdGlvbiBTdHJva2UoJGFPdGhlckF4aXNTY2FsZSwkYVN0cm9rZUxhYmVscz10cnVlKSB7CiAgICAgICAgaWYoICR0aGlzLT5oaWRlICkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmKCBpc19udW1lcmljKCR0aGlzLT5wb3MpICkgewogICAgICAgICAgICAkcG9zPSRhT3RoZXJBeGlzU2NhbGUtPlRyYW5zbGF0ZSgkdGhpcy0+cG9zKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7IC8vIERlZmF1bHQgdG8gbWluaW11bSBvZiBvdGhlciBzY2FsZSBpZiBwb3Mgbm90IHNldAogICAgICAgICAgICBpZiggKCRhT3RoZXJBeGlzU2NhbGUtPkdldE1pblZhbCgpID49IDAgJiYgJHRoaXMtPnBvcz09ZmFsc2UpIHx8ICR0aGlzLT5wb3MgPT0gJ21pbicgKSB7CiAgICAgICAgICAgICAgICAkcG9zID0gJGFPdGhlckF4aXNTY2FsZS0+c2NhbGVfYWJzWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkdGhpcy0+cG9zID09ICJtYXgiKSB7CiAgICAgICAgICAgICAgICAkcG9zID0gJGFPdGhlckF4aXNTY2FsZS0+c2NhbGVfYWJzWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyAvLyBJZiBuZWdhdGl2ZSBzZXQgeC1heGlzIGF0IDAKICAgICAgICAgICAgICAgICR0aGlzLT5wb3M9MDsKICAgICAgICAgICAgICAgICRwb3M9JGFPdGhlckF4aXNTY2FsZS0+VHJhbnNsYXRlKDApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkcG9zICs9ICR0aGlzLT5pRGVsdGFBYnNQb3M7CiAgICAgICAgJHRoaXMtPmltZy0+U2V0TGluZVdlaWdodCgkdGhpcy0+d2VpZ2h0KTsKICAgICAgICAkdGhpcy0+aW1nLT5TZXRDb2xvcigkdGhpcy0+Y29sb3IpOwogICAgICAgICR0aGlzLT5pbWctPlNldEZvbnQoJHRoaXMtPmZvbnRfZmFtaWx5LCR0aGlzLT5mb250X3N0eWxlLCR0aGlzLT5mb250X3NpemUpOwoKICAgICAgICBpZiggJHRoaXMtPnNjYWxlLT50eXBlID09ICJ4IiApIHsKICAgICAgICAgICAgaWYoICEkdGhpcy0+aGlkZV9saW5lICkgewogICAgICAgICAgICAgICAgLy8gU3Ryb2tlIFgtYXhpcwogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPmxlZnRfbWFyZ2luLAogICAgICAgICAgICAgICAgICAgICRwb3MsCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+d2lkdGggLSAkdGhpcy0+aW1nLT5yaWdodF9tYXJnaW4sCiAgICAgICAgICAgICAgICAgICAgJHBvcyArICR0aGlzLT53ZWlnaHQtMQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggJHRoaXMtPnRpdGxlX3NpZGUgPT0gU0lERV9ET1dOICkgewogICAgICAgICAgICAgICAgJHkgPSAkcG9zICsgJHRoaXMtPmltZy0+R2V0Rm9udEhlaWdodCgpICsgJHRoaXMtPnRpdGxlX21hcmdpbiArICR0aGlzLT50aXRsZS0+bWFyZ2luOwogICAgICAgICAgICAgICAgJHlhbGlnbiA9ICd0b3AnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHkgPSAkcG9zIC0gJHRoaXMtPmltZy0+R2V0Rm9udEhlaWdodCgpIC0gJHRoaXMtPnRpdGxlX21hcmdpbiAtICR0aGlzLT50aXRsZS0+bWFyZ2luOwogICAgICAgICAgICAgICAgJHlhbGlnbiA9ICdib3R0b20nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiggJHRoaXMtPnRpdGxlX2FkanVzdD09J2hpZ2gnICkgewogICAgICAgICAgICAgICAgJHRoaXMtPnRpdGxlLT5TZXRQb3MoJHRoaXMtPmltZy0+d2lkdGgtJHRoaXMtPmltZy0+cmlnaHRfbWFyZ2luLCR5LCdyaWdodCcsJHlhbGlnbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCAkdGhpcy0+dGl0bGVfYWRqdXN0PT0nbWlkZGxlJyB8fCAkdGhpcy0+dGl0bGVfYWRqdXN0PT0nY2VudGVyJyApIHsKICAgICAgICAgICAgICAgICR0aGlzLT50aXRsZS0+U2V0UG9zKCgkdGhpcy0+aW1nLT53aWR0aC0kdGhpcy0+aW1nLT5sZWZ0X21hcmdpbi0kdGhpcy0+aW1nLT5yaWdodF9tYXJnaW4pLzIrJHRoaXMtPmltZy0+bGVmdF9tYXJnaW4sJHksJ2NlbnRlcicsJHlhbGlnbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCR0aGlzLT50aXRsZV9hZGp1c3Q9PSdsb3cnKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+dGl0bGUtPlNldFBvcygkdGhpcy0+aW1nLT5sZWZ0X21hcmdpbiwkeSwnbGVmdCcsJHlhbGlnbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA2MCwkdGhpcy0+dGl0bGVfYWRqdXN0KTsvLygnVW5rbm93biBhbGlnbm1lbnQgc3BlY2lmaWVkIGZvciBYLWF4aXMgdGl0bGUuICgnLiR0aGlzLT50aXRsZV9hZGp1c3QuJyknKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT5zY2FsZS0+dHlwZSA9PSAieSIgKSB7CiAgICAgICAgICAgIC8vIEFkZCBsaW5lIHdlaWdodCB0byB0aGUgaGVpZ2h0IG9mIHRoZSBheGlzIHNpbmNlCiAgICAgICAgICAgIC8vIHRoZSB4LWF4aXMgY291bGQgaGF2ZSBhIHdpZHRoPjEgYW5kIHdlIHdhbnQgdGhlIGF4aXMgdG8gZml0IG5pY2VseSB0b2dldGhlci4KICAgICAgICAgICAgaWYoICEkdGhpcy0+aGlkZV9saW5lICkgewogICAgICAgICAgICAgICAgLy8gU3Ryb2tlIFktYXhpcwogICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKAogICAgICAgICAgICAgICAgICAgICRwb3MgLSAkdGhpcy0+d2VpZ2h0ICsgMSwgCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+dG9wX21hcmdpbiwKICAgICAgICAgICAgICAgICAgICAkcG9zLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPmhlaWdodCAtICR0aGlzLT5pbWctPmJvdHRvbV9tYXJnaW4gKyAkdGhpcy0+d2VpZ2h0IC0gMQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHg9JHBvcyA7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+dGl0bGVfc2lkZSA9PSBTSURFX0xFRlQgKSB7CiAgICAgICAgICAgICAgICAkeCAtPSAkdGhpcy0+dGl0bGVfbWFyZ2luOwogICAgICAgICAgICAgICAgJHggLT0gJHRoaXMtPnRpdGxlLT5tYXJnaW47CiAgICAgICAgICAgICAgICAkaGFsaWduID0gJ3JpZ2h0JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICR4ICs9ICR0aGlzLT50aXRsZV9tYXJnaW47CiAgICAgICAgICAgICAgICAkeCArPSAkdGhpcy0+dGl0bGUtPm1hcmdpbjsKICAgICAgICAgICAgICAgICRoYWxpZ24gPSAnbGVmdCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgaGFzIG1hbnVhbGx5IHNwZWNpZmllZCBhbiBob3IuIGFsaWduCiAgICAgICAgICAgIC8vIHRoZW4gd2Ugb3ZlcnJpZGUgdGhlIGF1dG9tYXRpYyBzZXR0aW5ncyB3aXRoIHRoaXMKICAgICAgICAgICAgLy8gc3BlY2lmZWQgc2V0dGluZy4gU2luY2UgZGVmYXVsdCBpcyAnbGVmdCcgd2UgY29tcGFyZQogICAgICAgICAgICAvLyB3aXRoIHRoYXQuIChUaGlzIG1lYW5zIGEgbWFudWFsbHkgc2V0ICdsZWZ0JyBhbGlnbgogICAgICAgICAgICAvLyB3aWxsIGhhdmUgbm8gZWZmZWN0LikKICAgICAgICAgICAgaWYoICR0aGlzLT50aXRsZS0+aGFsaWduICE9ICdsZWZ0JyApIHsKICAgICAgICAgICAgICAgICRoYWxpZ24gPSAkdGhpcy0+dGl0bGUtPmhhbGlnbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggJHRoaXMtPnRpdGxlX2FkanVzdCA9PSAnaGlnaCcgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+dGl0bGUtPlNldFBvcygkeCwkdGhpcy0+aW1nLT50b3BfbWFyZ2luLCRoYWxpZ24sJ3RvcCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZigkdGhpcy0+dGl0bGVfYWRqdXN0PT0nbWlkZGxlJyB8fCAkdGhpcy0+dGl0bGVfYWRqdXN0PT0nY2VudGVyJykgewogICAgICAgICAgICAgICAgJHRoaXMtPnRpdGxlLT5TZXRQb3MoJHgsKCR0aGlzLT5pbWctPmhlaWdodC0kdGhpcy0+aW1nLT50b3BfbWFyZ2luLSR0aGlzLT5pbWctPmJvdHRvbV9tYXJnaW4pLzIrJHRoaXMtPmltZy0+dG9wX21hcmdpbiwkaGFsaWduLCJjZW50ZXIiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoJHRoaXMtPnRpdGxlX2FkanVzdD09J2xvdycpIHsKICAgICAgICAgICAgICAgICR0aGlzLT50aXRsZS0+U2V0UG9zKCR4LCR0aGlzLT5pbWctPmhlaWdodC0kdGhpcy0+aW1nLT5ib3R0b21fbWFyZ2luLCRoYWxpZ24sJ2JvdHRvbScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNjEsJHRoaXMtPnRpdGxlX2FkanVzdCk7Ly8oJ1Vua25vd24gYWxpZ25tZW50IHNwZWNpZmllZCBmb3IgWS1heGlzIHRpdGxlLiAoJy4kdGhpcy0+dGl0bGVfYWRqdXN0LicpJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPnNjYWxlLT50aWNrcy0+U3Ryb2tlKCR0aGlzLT5pbWcsJHRoaXMtPnNjYWxlLCRwb3MpOwogICAgICAgIGlmKCAkYVN0cm9rZUxhYmVscyApIHsKICAgICAgICAgICAgaWYoICEkdGhpcy0+aGlkZV9sYWJlbHMgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+U3Ryb2tlTGFiZWxzKCRwb3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT50aXRsZS0+U3Ryb2tlKCR0aGlzLT5pbWcpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gUFJJVkFURSBNRVRIT0RTCiAgICAvLyBEcmF3IGFsbCB0aGUgdGljayBsYWJlbHMgb24gbWFqb3IgdGljayBtYXJrcwogICAgZnVuY3Rpb24gU3Ryb2tlTGFiZWxzKCRhUG9zLCRhTWlub3I9ZmFsc2UsJGFBYnNMYWJlbD1mYWxzZSkgewoKICAgICAgICBpZiggaXNfYXJyYXkoJHRoaXMtPmxhYmVsX2NvbG9yKSAmJiBjb3VudCgkdGhpcy0+bGFiZWxfY29sb3IpID4gMyApIHsKICAgICAgICAgICAgJHRoaXMtPnRpY2tzX2xhYmVsX2NvbG9ycyA9ICR0aGlzLT5sYWJlbF9jb2xvcjsKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Q29sb3IoJHRoaXMtPmxhYmVsX2NvbG9yWzBdKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5pbWctPlNldENvbG9yKCR0aGlzLT5sYWJlbF9jb2xvcik7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5pbWctPlNldEZvbnQoJHRoaXMtPmZvbnRfZmFtaWx5LCR0aGlzLT5mb250X3N0eWxlLCR0aGlzLT5mb250X3NpemUpOwogICAgICAgICR5b2ZmPSR0aGlzLT5pbWctPkdldEZvbnRIZWlnaHQoKS8yOwoKICAgICAgICAvLyBPbmx5IGRyYXcgbGFiZWxzIGF0IG1ham9yIHRpY2sgbWFya3MKICAgICAgICAkbmJyID0gY291bnQoJHRoaXMtPnNjYWxlLT50aWNrcy0+bWFqX3RpY2tzX2xhYmVsKTsKCiAgICAgICAgLy8gV2UgaGF2ZSB0aGUgb3B0aW9uIHRvIG5vdC1kaXNwbGF5IHRoZSB2ZXJ5IGZpcnN0IG1hcmsKICAgICAgICAvLyAoVXNlZnVsbCB3aGVuIHRoZSBmaXJzdCBsYWJlbCBtaWdodCBpbnRlcmZlcmUgd2l0aCBhbm90aGVyCiAgICAgICAgLy8gYXhpcy4pCiAgICAgICAgJGkgPSAkdGhpcy0+c2hvd19maXJzdF9sYWJlbCA\/IDAgOiAxIDsKICAgICAgICBpZiggISR0aGlzLT5zaG93X2xhc3RfbGFiZWwgKSB7CiAgICAgICAgICAgIC0tJG5icjsKICAgICAgICB9CiAgICAgICAgLy8gTm93IHJ1biB0aHJvdWdoIGFsbCBsYWJlbHMgbWFraW5nIHN1cmUgd2UgZG9uJ3Qgb3ZlcnNob290IHRoZSBlbmQKICAgICAgICAvLyBvZiB0aGUgc2NhbGUuCiAgICAgICAgJG5jb2xvcj0wOwogICAgICAgIGlmKCBpc3NldCgkdGhpcy0+dGlja3NfbGFiZWxfY29sb3JzKSApIHsKICAgICAgICAgICAgJG5jb2xvcj1jb3VudCgkdGhpcy0+dGlja3NfbGFiZWxfY29sb3JzKTsKICAgICAgICB9CiAgICAgICAgd2hpbGUoICRpIDwgJG5iciApIHsKICAgICAgICAgICAgLy8gJHRwb3MgaG9sZHMgdGhlIGFic29sdXRlIHRleHQgcG9zaXRpb24gZm9yIHRoZSBsYWJlbAogICAgICAgICAgICAkdHBvcz0kdGhpcy0+c2NhbGUtPnRpY2tzLT5tYWpfdGlja2xhYmVsc19wb3NbJGldOwoKICAgICAgICAgICAgLy8gTm90ZS4gdGhlICRsaW1pdCBpcyBvbmx5IHVzZWQgZm9yIHRoZSB4IGF4aXMgc2luY2Ugd2UKICAgICAgICAgICAgLy8gbWlnaHQgb3RoZXJ3aXNlIG92ZXJzaG9vdCBpZiB0aGUgc2NhbGUgaGFzIGJlZW4gY2VudGVyZWQKICAgICAgICAgICAgLy8gVGhpcyBpcyBkdWUgdG8gdXMgImxvb3NpbmciIHRoZSBsYXN0IHRpY2sgbWFyayBpZiB3ZSBjZW50ZXIuCiAgICAgICAgICAgIGlmKCAkdGhpcy0+c2NhbGUtPnR5cGUgPT0gJ3gnICYmICR0cG9zID4gJHRoaXMtPmltZy0+d2lkdGgtJHRoaXMtPmltZy0+cmlnaHRfbWFyZ2luKzEgKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gd2Ugb25seSBkcmF3IGV2ZXJ5ICRsYWJlbF9zdGVwIGxhYmVsCiAgICAgICAgICAgIGlmKCAoJGkgJSAkdGhpcy0+bGFiZWxfc3RlcCk9PTAgKSB7CgogICAgICAgICAgICAgICAgLy8gU2V0IHNwZWNpZmljIGxhYmVsIGNvbG9yIGlmIHNwZWNpZmllZAogICAgICAgICAgICAgICAgaWYoICRuY29sb3IgPiAwICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldENvbG9yKCR0aGlzLT50aWNrc19sYWJlbF9jb2xvcnNbJGkgJSAkbmNvbG9yXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGxhYmVsIGhhcyBiZWVuIHNwZWNpZmllZCB1c2UgdGhhdCBhbmQgaW4gb3RoZXIgY2FzZQogICAgICAgICAgICAgICAgLy8ganVzdCBsYWJlbCB0aGUgbWFyayB3aXRoIHRoZSBhY3R1YWwgc2NhbGUgdmFsdWUKICAgICAgICAgICAgICAgICRtPSR0aGlzLT5zY2FsZS0+dGlja3MtPkdldE1ham9yKCk7CgogICAgICAgICAgICAgICAgLy8gdGlja3NfbGFiZWwgaGFzIGFuIGVudHJ5IGZvciBlYWNoIGRhdGEgcG9pbnQgYW5kIGlzIHRoZSBhcnJheQogICAgICAgICAgICAgICAgLy8gdGhhdCBob2xkcyB0aGUgbGFiZWxzIHNldCBieSB0aGUgdXNlci4gSWYgdGhlIHVzZXIgaGFzbid0CiAgICAgICAgICAgICAgICAvLyBzcGVjaWZpZWQgYW55IHZhbHVlcyB3ZSB1c2Ugd2hhdHMgaW4gdGhlIGF1dG9tYXRpY2FsbHkgYXNpZ25lZAogICAgICAgICAgICAgICAgLy8gbGFiZWxzIGluIHRoZSBtYWpfdGlja3NfbGFiZWwKICAgICAgICAgICAgICAgIGlmKCBpc3NldCgkdGhpcy0+dGlja3NfbGFiZWxbJGkqJG1dKSApIHsKICAgICAgICAgICAgICAgICAgICAkbGFiZWw9JHRoaXMtPnRpY2tzX2xhYmVsWyRpKiRtXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmKCAkYUFic0xhYmVsICkgewogICAgICAgICAgICAgICAgICAgICAgICAkbGFiZWw9YWJzKCR0aGlzLT5zY2FsZS0+dGlja3MtPm1hal90aWNrc19sYWJlbFskaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGxhYmVsPSR0aGlzLT5zY2FsZS0+dGlja3MtPm1hal90aWNrc19sYWJlbFskaV07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBXZSBudW1iZXIgdGhlIHNjYWxlIGZyb20gMSBhbmQgbm90IGZyb20gMCBzbyBpbmNyZWFzZSBieSBvbmUKICAgICAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnNjYWxlLT50ZXh0c2NhbGUgJiYgCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zY2FsZS0+dGlja3MtPmxhYmVsX2Zvcm1mdW5jID09ICcnICYmCiAgICAgICAgICAgICAgICAgICAgICAgICEgJHRoaXMtPnNjYWxlLT50aWNrcy0+SGF2ZU1hbnVhbExhYmVscygpICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgKyskbGFiZWw7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnNjYWxlLT50eXBlID09ICJ4IiApIHsKICAgICAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmxhYmVsUG9zID09IFNJREVfRE9XTiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICR0aGlzLT5sYWJlbF9hbmdsZT09MCB8fCAkdGhpcy0+bGFiZWxfYW5nbGU9PTkwICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoICR0aGlzLT5sYWJlbF9oYWxpZ249PScnICYmICR0aGlzLT5sYWJlbF92YWxpZ249PScnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0VGV4dEFsaWduKCdjZW50ZXInLCd0b3AnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFRleHRBbGlnbigkdGhpcy0+bGFiZWxfaGFsaWduLCR0aGlzLT5sYWJlbF92YWxpZ24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWxfaGFsaWduPT0nJyAmJiAkdGhpcy0+bGFiZWxfdmFsaWduPT0nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFRleHRBbGlnbigicmlnaHQiLCJ0b3AiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFRleHRBbGlnbigkdGhpcy0+bGFiZWxfaGFsaWduLCR0aGlzLT5sYWJlbF92YWxpZ24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlN0cm9rZVRleHQoJHRwb3MsJGFQb3MrJHRoaXMtPnRpY2tfbGFiZWxfbWFyZ2luLCRsYWJlbCwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmxhYmVsX2FuZ2xlLCR0aGlzLT5sYWJlbF9wYXJhX2FsaWduKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWxfYW5nbGU9PTAgfHwgJHRoaXMtPmxhYmVsX2FuZ2xlPT05MCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWxfaGFsaWduPT0nJyAmJiAkdGhpcy0+bGFiZWxfdmFsaWduPT0nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFRleHRBbGlnbigiY2VudGVyIiwiYm90dG9tIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRUZXh0QWxpZ24oJHRoaXMtPmxhYmVsX2hhbGlnbiwkdGhpcy0+bGFiZWxfdmFsaWduKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWxfaGFsaWduPT0nJyAmJiAkdGhpcy0+bGFiZWxfdmFsaWduPT0nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFRleHRBbGlnbigicmlnaHQiLCJib3R0b20iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFRleHRBbGlnbigkdGhpcy0+bGFiZWxfaGFsaWduLCR0aGlzLT5sYWJlbF92YWxpZ24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlN0cm9rZVRleHQoJHRwb3MsJGFQb3MtJHRoaXMtPnRpY2tfbGFiZWxfbWFyZ2luLTEsJGxhYmVsLAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bGFiZWxfYW5nbGUsJHRoaXMtPmxhYmVsX3BhcmFfYWxpZ24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHNjYWxlLT50eXBlID09ICJ5IgogICAgICAgICAgICAgICAgICAgIC8vaWYoICR0aGlzLT5sYWJlbF9hbmdsZSE9MCApCiAgICAgICAgICAgICAgICAgICAgLy9KcEdyYXBoRXJyb3I6OlJhaXNlKCIgTGFiZWxzIGF0IGFuIGFuZ2xlIGFyZSBub3Qgc3VwcG9ydGVkIG9uIFktYXhpcyIpOwogICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWxQb3MgPT0gU0lERV9MRUZUICkgeyAvLyBUbyB0aGUgbGVmdCBvZiB5LWF4aXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICR0aGlzLT5sYWJlbF9oYWxpZ249PScnICYmICR0aGlzLT5sYWJlbF92YWxpZ249PScnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRUZXh0QWxpZ24oInJpZ2h0IiwiY2VudGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRUZXh0QWxpZ24oJHRoaXMtPmxhYmVsX2hhbGlnbiwkdGhpcy0+bGFiZWxfdmFsaWduKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TdHJva2VUZXh0KCRhUG9zLSR0aGlzLT50aWNrX2xhYmVsX21hcmdpbiwkdHBvcywkbGFiZWwsJHRoaXMtPmxhYmVsX2FuZ2xlLCR0aGlzLT5sYWJlbF9wYXJhX2FsaWduKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7IC8vIFRvIHRoZSByaWdodCBvZiB0aGUgeS1heGlzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWxfaGFsaWduPT0nJyAmJiAkdGhpcy0+bGFiZWxfdmFsaWduPT0nJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0VGV4dEFsaWduKCJsZWZ0IiwiY2VudGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRUZXh0QWxpZ24oJHRoaXMtPmxhYmVsX2hhbGlnbiwkdGhpcy0+bGFiZWxfdmFsaWduKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TdHJva2VUZXh0KCRhUG9zKyR0aGlzLT50aWNrX2xhYmVsX21hcmdpbiwkdHBvcywkbGFiZWwsJHRoaXMtPmxhYmVsX2FuZ2xlLCR0aGlzLT5sYWJlbF9wYXJhX2FsaWduKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKyskaTsKICAgICAgICB9CiAgICB9Cgp9CgoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ0xBU1MgVGlja3MKLy8gRGVzY3JpcHRpb246IEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGRyYXdpbmcgbGluZWFyIGFuZCBsb2dhcml0aG1pYwovLyB0aWNrIG1hcmtzIG9uIGF4aXMKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgVGlja3MgewogICAgcHVibGljICRsYWJlbF9mb3JtYXRzdHI9Jyc7ICAgLy8gQy1zdHlsZSBmb3JtYXQgc3RyaW5nIHRvIHVzZSBmb3IgbGFiZWxzCiAgICBwdWJsaWMgJGxhYmVsX2Zvcm1mdW5jPScnOwogICAgcHVibGljICRsYWJlbF9kYXRlZm9ybWF0c3RyPScnOwogICAgcHVibGljICRkaXJlY3Rpb249MTsgLy8gU2hvdWxkIHRpY2tzIGJlIGluKD0xKSB0aGUgcGxvdCBhcmVhIG9yIG91dHNpZGUgKD0tMSkKICAgIHB1YmxpYyAkc3VwcmVzc19sYXN0PWZhbHNlLCRzdXByZXNzX3RpY2ttYXJrcz1mYWxzZSwkc3VwcmVzc19taW5vcl90aWNrbWFya3M9ZmFsc2U7CiAgICBwdWJsaWMgJG1hal90aWNrc19wb3MgPSBhcnJheSgpLCAkbWFqX3RpY2tsYWJlbHNfcG9zID0gYXJyYXkoKSwKICAgICAgICAgICAkdGlja3NfcG9zID0gYXJyYXkoKSwgJG1hal90aWNrc19sYWJlbCA9IGFycmF5KCk7CiAgICBwdWJsaWMgJHByZWNpc2lvbjsKCiAgICBwcm90ZWN0ZWQgJG1pbm9yX2Fic19zaXplPTMsICRtYWpvcl9hYnNfc2l6ZT01OwogICAgcHJvdGVjdGVkICRzY2FsZTsKICAgIHByb3RlY3RlZCAkaXNfc2V0PWZhbHNlOwogICAgcHJvdGVjdGVkICRzdXByZXNzX3plcm9sYWJlbD1mYWxzZSwkc3VwcmVzc19maXJzdD1mYWxzZTsKICAgIHByb3RlY3RlZCAkbWluY29sb3I9JycsJG1hamNvbG9yPScnOwogICAgcHJvdGVjdGVkICR3ZWlnaHQ9MTsKICAgIHByb3RlY3RlZCAkbGFiZWxfdXNlZGF0ZWZvcm1hdD1GQUxTRTsKCiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkYVNjYWxlKSB7CiAgICAgICAgJHRoaXMtPnNjYWxlPSRhU2NhbGU7CiAgICAgICAgJHRoaXMtPnByZWNpc2lvbiA9IC0xOwogICAgfQoKICAgIC8vIFNldCBmb3JtYXQgc3RyaW5nIGZvciBhdXRvbWF0aWMgbGFiZWxzCiAgICBmdW5jdGlvbiBTZXRMYWJlbEZvcm1hdCgkYUZvcm1hdFN0cmluZywkYURhdGU9RkFMU0UpIHsKICAgICAgICAkdGhpcy0+bGFiZWxfZm9ybWF0c3RyPSRhRm9ybWF0U3RyaW5nOwogICAgICAgICR0aGlzLT5sYWJlbF91c2VkYXRlZm9ybWF0PSRhRGF0ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMYWJlbERhdGVGb3JtYXQoJGFGb3JtYXRTdHJpbmcpIHsKICAgICAgICAkdGhpcy0+bGFiZWxfZGF0ZWZvcm1hdHN0cj0kYUZvcm1hdFN0cmluZzsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRGb3JtYXRDYWxsYmFjaygkYUNhbGxiYWNrRnVuY05hbWUpIHsKICAgICAgICAkdGhpcy0+bGFiZWxfZm9ybWZ1bmMgPSAkYUNhbGxiYWNrRnVuY05hbWU7CiAgICB9CgogICAgLy8gRG9uJ3QgZGlzcGxheSB0aGUgZmlyc3QgemVybyBsYWJlbAogICAgZnVuY3Rpb24gU3VwcmVzc1plcm9MYWJlbCgkYUZsYWc9dHJ1ZSkgewogICAgICAgICR0aGlzLT5zdXByZXNzX3plcm9sYWJlbD0kYUZsYWc7CiAgICB9CgogICAgLy8gRG9uJ3QgZGlzcGxheSBtaW5vciB0aWNrIG1hcmtzCiAgICBmdW5jdGlvbiBTdXByZXNzTWlub3JUaWNrTWFya3MoJGFIaWRlPXRydWUpIHsKICAgICAgICAkdGhpcy0+c3VwcmVzc19taW5vcl90aWNrbWFya3M9JGFIaWRlOwogICAgfQoKICAgIC8vIERvbid0IGRpc3BsYXkgbWFqb3IgdGljayBtYXJrcwogICAgZnVuY3Rpb24gU3VwcmVzc1RpY2tNYXJrcygkYUhpZGU9dHJ1ZSkgewogICAgICAgICR0aGlzLT5zdXByZXNzX3RpY2ttYXJrcz0kYUhpZGU7CiAgICB9CgogICAgLy8gSGlkZSB0aGUgZmlyc3QgdGljayBtYXJrCiAgICBmdW5jdGlvbiBTdXByZXNzRmlyc3QoJGFIaWRlPXRydWUpIHsKICAgICAgICAkdGhpcy0+c3VwcmVzc19maXJzdD0kYUhpZGU7CiAgICB9CgogICAgLy8gSGlkZSB0aGUgbGFzdCB0aWNrIG1hcmsKICAgIGZ1bmN0aW9uIFN1cHJlc3NMYXN0KCRhSGlkZT10cnVlKSB7CiAgICAgICAgJHRoaXMtPnN1cHJlc3NfbGFzdD0kYUhpZGU7CiAgICB9CgogICAgLy8gU2l6ZSAoaW4gcGl4ZWxzKSBvZiBtaW5vciB0aWNrIG1hcmtzCiAgICBmdW5jdGlvbiBHZXRNaW5UaWNrQWJzU2l6ZSgpIHsKICAgICAgICByZXR1cm4gJHRoaXMtPm1pbm9yX2Fic19zaXplOwogICAgfQoKICAgIC8vIFNpemUgKGluIHBpeGVscykgb2YgbWFqb3IgdGljayBtYXJrcwogICAgZnVuY3Rpb24gR2V0TWFqVGlja0Fic1NpemUoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5tYWpvcl9hYnNfc2l6ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRTaXplKCRhTWFqU2l6ZSwkYU1pblNpemU9MykgewogICAgICAgICR0aGlzLT5tYWpvcl9hYnNfc2l6ZSA9ICRhTWFqU2l6ZTsKICAgICAgICAkdGhpcy0+bWlub3JfYWJzX3NpemUgPSAkYU1pblNpemU7CiAgICB9CgogICAgLy8gSGF2ZSB0aGUgdGlja3MgYmVlbiBzcGVjaWZpZWQKICAgIGZ1bmN0aW9uIElzU3BlY2lmaWVkKCkgewogICAgICAgIHJldHVybiAkdGhpcy0+aXNfc2V0OwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFNpZGUoJGFTaWRlKSB7CiAgICAgICAgJHRoaXMtPmRpcmVjdGlvbj0kYVNpZGU7CiAgICB9CgogICAgLy8gV2hpY2ggc2lkZSBvZiB0aGUgYXhpcyBzaG91bGQgdGhlIHRpY2tzIGJlIG9uCiAgICBmdW5jdGlvbiBTZXREaXJlY3Rpb24oJGFTaWRlPVNJREVfUklHSFQpIHsKICAgICAgICAkdGhpcy0+ZGlyZWN0aW9uPSRhU2lkZTsKICAgIH0KCiAgICAvLyBTZXQgY29sb3JzIGZvciBtYWpvciBhbmQgbWlub3IgdGljayBtYXJrcwogICAgZnVuY3Rpb24gU2V0TWFya0NvbG9yKCRhTWFqb3JDb2xvciwkYU1pbm9yQ29sb3I9JycpIHsKICAgICAgICAkdGhpcy0+U2V0Q29sb3IoJGFNYWpvckNvbG9yLCRhTWlub3JDb2xvcik7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Q29sb3IoJGFNYWpvckNvbG9yLCRhTWlub3JDb2xvcj0nJykgewogICAgICAgICR0aGlzLT5tYWpjb2xvcj0kYU1ham9yQ29sb3I7CgogICAgICAgIC8vIElmIG5vdCBzcGVjaWZpZWQgdXNlIHNhbWUgYXMgbWFqb3IKICAgICAgICBpZiggJGFNaW5vckNvbG9yID09ICcnICkgewogICAgICAgICAgICAkdGhpcy0+bWluY29sb3I9JGFNYWpvckNvbG9yOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPm1pbmNvbG9yPSRhTWlub3JDb2xvcjsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU2V0V2VpZ2h0KCRhV2VpZ2h0KSB7CiAgICAgICAgJHRoaXMtPndlaWdodD0kYVdlaWdodDsKICAgIH0KCn0gLy8gQ2xhc3MKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIExpbmVhclRpY2tzCi8vIERlc2NyaXB0aW9uOiBEcmF3IGxpbmVhciB0aWNrcyBvbiBheGlzCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIExpbmVhclRpY2tzIGV4dGVuZHMgVGlja3MgewogICAgcHVibGljICRtaW5vcl9zdGVwPTEsICRtYWpvcl9zdGVwPTI7CiAgICBwdWJsaWMgJHhsYWJlbF9vZmZzZXQ9MCwkeHRpY2tfb2Zmc2V0PTA7CiAgICBwcml2YXRlICRsYWJlbF9vZmZzZXQ9MDsgLy8gV2hhdCBvZmZzZXQgc2hvdWxkIHRoZSBkaXNwbGF5ZWQgbGFiZWwgaGF2ZQogICAgLy8gaS5lIHNob3VsZCB3ZSBkaXNwbGF5IDAsMSwyIG9yIDEsMiwzLDQgb3IgMiwzLDQgZXRjCiAgICBwcml2YXRlICR0ZXh0X2xhYmVsX3N0YXJ0PTA7CiAgICBwcml2YXRlICRpTWFudWFsVGlja1BvcyA9IE5VTEwsICRpTWFudWFsTWluVGlja1BvcyA9IE5VTEwsICRpTWFudWFsVGlja0xhYmVscyA9IE5VTEw7CiAgICBwcml2YXRlICRpQWRqdXN0Rm9yRFNUID0gZmFsc2U7IC8vIElmIGEgZGF0ZSBmYWxscyB3aXRoaW4gdGhlIERTVCBwZXJpb2QgYWRkIG9uZSBob3VyIHRvIHRoZSBkaWFwbHllZCB0aW1lCgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKSB7CiAgICAgICAgJHRoaXMtPnByZWNpc2lvbiA9IC0xOwogICAgfQoKICAgIC8vIFJldHVybiBtYWpvciBzdGVwIHNpemUgaW4gd29ybGQgY29vcmRpbmF0ZXMKICAgIGZ1bmN0aW9uIEdldE1ham9yKCkgewogICAgICAgIHJldHVybiAkdGhpcy0+bWFqb3Jfc3RlcDsKICAgIH0KCiAgICAvLyBSZXR1cm4gbWlub3Igc3RlcCBzaXplIGluIHdvcmxkIGNvb3JkaW5hdGVzCiAgICBmdW5jdGlvbiBHZXRNaW5vcigpIHsKICAgICAgICByZXR1cm4gJHRoaXMtPm1pbm9yX3N0ZXA7CiAgICB9CgogICAgLy8gU2V0IE1pbm9yIGFuZCBNYWpvciB0aWNrcyAoaW4gd29ybGQgY29vcmRpbmF0ZXMpCiAgICBmdW5jdGlvbiBTZXQoJGFNYWpTdGVwLCRhTWluU3RlcD1mYWxzZSkgewogICAgICAgIGlmKCAkYU1pblN0ZXA9PWZhbHNlICkgewogICAgICAgICAgICAkYU1pblN0ZXA9JGFNYWpTdGVwOwogICAgICAgIH0KCiAgICAgICAgaWYoICRhTWFqU3RlcCA8PSAwIHx8ICRhTWluU3RlcCA8PSAwICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA2NCk7CiAgICAgICAgICAgIC8vKCIgTWlub3Igb3IgbWFqb3Igc3RlcCBzaXplIGlzIDAuIENoZWNrIHRoYXQgeW91IGhhdmVuJ3QgZ290IGFuIGFjY2lkZW50YWwgU2V0VGV4dFRpY2tzKDApIGluIHlvdXIgY29kZS4gSWYgdGhpcyBpcyBub3QgdGhlIGNhc2UgeW91IG1pZ2h0IGhhdmUgc3R1bWJsZWQgdXBvbiBhIGJ1ZyBpbiBKcEdyYXBoLiBQbGVhc2UgcmVwb3J0IHRoaXMgYW5kIGlmIHBvc3NpYmxlIGluY2x1ZGUgdGhlIGRhdGEgdGhhdCBjYXVzZWQgdGhlIHByb2JsZW0uIik7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+bWFqb3Jfc3RlcD0kYU1halN0ZXA7CiAgICAgICAgJHRoaXMtPm1pbm9yX3N0ZXA9JGFNaW5TdGVwOwogICAgICAgICR0aGlzLT5pc19zZXQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldE1halRpY2tQb3NpdGlvbnMoJGFNYWpQb3MsJGFMYWJlbHM9TlVMTCkgewogICAgICAgICR0aGlzLT5TZXRUaWNrUG9zaXRpb25zKCRhTWFqUG9zLE5VTEwsJGFMYWJlbHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFRpY2tQb3NpdGlvbnMoJGFNYWpQb3MsJGFNaW5Qb3M9TlVMTCwkYUxhYmVscz1OVUxMKSB7CiAgICAgICAgaWYoICFpc19hcnJheSgkYU1halBvcykgfHwgKCRhTWluUG9zIT09TlVMTCAmJiAhaXNfYXJyYXkoJGFNaW5Qb3MpKSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNjUpOy8vKCdUaWNrIHBvc2l0aW9ucyBtdXN0IGJlIHNwZWNpZnVlZCBhcyBhbiBhcnJheSgpJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgJG49Y291bnQoJGFNYWpQb3MpOwogICAgICAgIGlmKCBpc19hcnJheSgkYUxhYmVscykgJiYgKGNvdW50KCRhTGFiZWxzKSAhPSAkbikgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDY2KTsvLygnV2hlbiBtYW51YWxseSBzcGVjaWZ5aW5nIHRpY2sgcG9zaXRpb25zIGFuZCBsYWJlbHMgdGhlIG51bWJlciBvZiBsYWJlbHMgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIHNwZWNpZmllZCB0aWNrcy4nKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlNYW51YWxUaWNrUG9zID0gJGFNYWpQb3M7CiAgICAgICAgJHRoaXMtPmlNYW51YWxNaW5UaWNrUG9zID0gJGFNaW5Qb3M7CiAgICAgICAgJHRoaXMtPmlNYW51YWxUaWNrTGFiZWxzID0gJGFMYWJlbHM7CiAgICB9CgogICAgZnVuY3Rpb24gSGF2ZU1hbnVhbExhYmVscygpIHsKICAgICAgICByZXR1cm4gY291bnQoJHRoaXMtPmlNYW51YWxUaWNrTGFiZWxzKSA+IDA7CiAgICB9CgogICAgLy8gU3BlY2lmeSBhbGwgdGhlIHRpY2sgcG9zaXRpb25zIG1hbnVhbGx5IGFuZCBwb3NzaWJsZSBhbHNvIHRoZSBleGFjdCBsYWJlbHMKICAgIGZ1bmN0aW9uIF9kb01hbnVhbFRpY2tQb3MoJGFTY2FsZSkgewogICAgICAgICRuPWNvdW50KCR0aGlzLT5pTWFudWFsVGlja1Bvcyk7CiAgICAgICAgJG09Y291bnQoJHRoaXMtPmlNYW51YWxNaW5UaWNrUG9zKTsKICAgICAgICAkZG9MYmw9Y291bnQoJHRoaXMtPmlNYW51YWxUaWNrTGFiZWxzKSA+IDA7CgogICAgICAgICR0aGlzLT5tYWpfdGlja3NfcG9zID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+bWFqX3RpY2tsYWJlbHNfcG9zID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+dGlja3NfcG9zID0gYXJyYXkoKTsKCiAgICAgICAgLy8gTm93IGxvb3AgdGhyb3VnaCB0aGUgc3VwcGxpZWQgcG9zaXRpb25zIGFuZCB0cmFuc2xhdGUgdGhlbSB0byBzY3JlZW4gY29vcmRpbmF0ZXMKICAgICAgICAvLyBhbmQgc3RvcmUgdGhlbSBpbiB0aGUgbWFqX2xhYmVsX3Bvc2l0aW9ucwogICAgICAgICRtaW5TY2FsZSA9ICRhU2NhbGUtPnNjYWxlWzBdOwogICAgICAgICRtYXhTY2FsZSA9ICRhU2NhbGUtPnNjYWxlWzFdOwogICAgICAgICRqPTA7CiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG4gOyArKyRpICkgewogICAgICAgICAgICAvLyBGaXJzdCBtYWtlIHN1cmUgdGhhdCB0aGUgZmlyc3QgdGljayBpcyBub3QgbG93ZXIgdGhhbiB0aGUgbG93ZXIgc2NhbGUgdmFsdWUKICAgICAgICAgICAgaWYoICFpc3NldCgkdGhpcy0+aU1hbnVhbFRpY2tQb3NbJGldKSB8fCAkdGhpcy0+aU1hbnVhbFRpY2tQb3NbJGldIDwgJG1pblNjYWxlICB8fCAkdGhpcy0+aU1hbnVhbFRpY2tQb3NbJGldID4gJG1heFNjYWxlKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPm1hal90aWNrc19wb3NbJGpdID0gJGFTY2FsZS0+VHJhbnNsYXRlKCR0aGlzLT5pTWFudWFsVGlja1Bvc1skaV0pOwogICAgICAgICAgICAkdGhpcy0+bWFqX3RpY2tsYWJlbHNfcG9zWyRqXSA9ICR0aGlzLT5tYWpfdGlja3NfcG9zWyRqXTsKCiAgICAgICAgICAgIC8vIFNldCB0aGUgbWlub3IgdGljayBtYXJrcyB0aGUgc2FtZSBhcyBtYWpvciBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgICAgIGlmKCAkbSA8PSAwICkgewogICAgICAgICAgICAgICAgJHRoaXMtPnRpY2tzX3Bvc1skal0gPSAkdGhpcy0+bWFqX3RpY2tzX3Bvc1skal07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoICRkb0xibCApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5tYWpfdGlja3NfbGFiZWxbJGpdID0gJHRoaXMtPmlNYW51YWxUaWNrTGFiZWxzWyRpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICR0aGlzLT5tYWpfdGlja3NfbGFiZWxbJGpdPSR0aGlzLT5fZG9MYWJlbEZvcm1hdCgkdGhpcy0+aU1hbnVhbFRpY2tQb3NbJGldLCRpLCRuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICArKyRqOwogICAgICAgIH0KCiAgICAgICAgLy8gU29tZSBzYW5pdHkgY2hlY2sKICAgICAgICBpZiggY291bnQoJHRoaXMtPm1hal90aWNrc19wb3MpIDwgMiApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNjcpOy8vKCdZb3VyIG1hbnVhbGx5IHNwZWNpZmllZCBzY2FsZSBhbmQgdGlja3MgaXMgbm90IGNvcnJlY3QuIFRoZSBzY2FsZSBzZWVtcyB0byBiZSB0b28gc21hbGwgdG8gaG9sZCBhbnkgb2YgdGhlIHNwZWNpZmllZCB0aWNrbCBtYXJrcy4nKTsKICAgICAgICB9CgogICAgICAgIC8vIFNldHVwIHRoZSBtaW5vciB0aWNrIG1hcmtzCiAgICAgICAgJGo9MDsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbTsgKyskaSApIHsKICAgICAgICAgICAgaWYoICBlbXB0eSgkdGhpcy0+aU1hbnVhbE1pblRpY2tQb3NbJGldKSB8fCAkdGhpcy0+aU1hbnVhbE1pblRpY2tQb3NbJGldIDwgJG1pblNjYWxlICB8fCAkdGhpcy0+aU1hbnVhbE1pblRpY2tQb3NbJGldID4gJG1heFNjYWxlKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+dGlja3NfcG9zWyRqXSA9ICRhU2NhbGUtPlRyYW5zbGF0ZSgkdGhpcy0+aU1hbnVhbE1pblRpY2tQb3NbJGldKTsKICAgICAgICAgICAgKyskajsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX2RvQXV0b1RpY2tQb3MoJGFTY2FsZSkgewogICAgICAgICRtYWpfc3RlcF9hYnMgPSAkYVNjYWxlLT5zY2FsZV9mYWN0b3IqJHRoaXMtPm1ham9yX3N0ZXA7CiAgICAgICAgJG1pbl9zdGVwX2FicyA9ICRhU2NhbGUtPnNjYWxlX2ZhY3RvciokdGhpcy0+bWlub3Jfc3RlcDsKCiAgICAgICAgaWYoICRtaW5fc3RlcF9hYnM9PTAgfHwgJG1hal9zdGVwX2Ficz09MCApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNjgpOy8vKCJBIHBsb3QgaGFzIGFuIGlsbGVnYWwgc2NhbGUuIFRoaXMgY291bGQgZm9yIGV4YW1wbGUgYmUgdGhhdCB5b3UgYXJlIHRyeWluZyB0byB1c2UgdGV4dCBhdXRvc2NhbGluZyB0byBkcmF3IGEgbGluZSBwbG90IHdpdGggb25seSBvbmUgcG9pbnQgb3IgdGhhdCB0aGUgcGxvdCBhcmVhIGlzIHRvbyBzbWFsbC4gSXQgY291bGQgYWxzbyBiZSB0aGF0IG5vIGlucHV0IGRhdGEgdmFsdWUgaXMgbnVtZXJpYyAocGVyaGFwcyBvbmx5ICctJyBvciAneCcpIik7CiAgICAgICAgfQogICAgICAgIC8vIFdlIG5lZWQgdG8gbWFrZSB0aGlzIGFuIGludCBzaW5jZSBjb21wYXJpbmcgaXQgYmVsb3cKICAgICAgICAvLyB3aXRoIHRoZSByZXN1bHQgZnJvbSByb3VuZCgpIGNhbiBnaXZlIHdyb25nIHJlc3VsdCwgc3VjaCB0aGF0CiAgICAgICAgLy8gKDQwIDwgNDApID09IFRSVUUgISEhCiAgICAgICAgJGxpbWl0ID0gKGludCkkYVNjYWxlLT5zY2FsZV9hYnNbMV07CgogICAgICAgIGlmKCAkYVNjYWxlLT50ZXh0c2NhbGUgKSB7CiAgICAgICAgICAgIC8vIFRoaXMgY2FuIG9ubHkgYmUgdHJ1ZSBmb3IgYSBYLXNjYWxlIChob3Jpem9udGFsKQogICAgICAgICAgICAvLyBEZWZpbmUgdGlja3MgZm9yIGEgdGV4dCBzY2FsZS4gVGhpcyBpcyBzbGlnaHRseSBkaWZmZXJlbnQgZnJvbSBhCiAgICAgICAgICAgIC8vIG5vcm1hbCBsaW5lYXIgdHlwZSBvZiBzY2FsZSBzaW5jZSB0aGUgcG9zaXRpb24gbWlnaHQgYmUgYWRqdXN0ZWQKICAgICAgICAgICAgLy8gYW5kIHRoZSBsYWJlbHMgc3RhcnQgYXQgb24KICAgICAgICAgICAgJGxhYmVsID0gKGZsb2F0KSRhU2NhbGUtPkdldE1pblZhbCgpKyR0aGlzLT50ZXh0X2xhYmVsX3N0YXJ0KyR0aGlzLT5sYWJlbF9vZmZzZXQ7CiAgICAgICAgICAgICRzdGFydF9hYnM9JGFTY2FsZS0+c2NhbGVfZmFjdG9yKiR0aGlzLT50ZXh0X2xhYmVsX3N0YXJ0OwogICAgICAgICAgICAkbmJybWFqdGlja3M9cm91bmQoKCRhU2NhbGUtPkdldE1heFZhbCgpLSRhU2NhbGUtPkdldE1pblZhbCgpLSR0aGlzLT50ZXh0X2xhYmVsX3N0YXJ0ICkvJHRoaXMtPm1ham9yX3N0ZXApKzE7CgogICAgICAgICAgICAkeCA9ICRhU2NhbGUtPnNjYWxlX2Fic1swXSskc3RhcnRfYWJzKyR0aGlzLT54bGFiZWxfb2Zmc2V0KiRtaW5fc3RlcF9hYnM7CiAgICAgICAgICAgIGZvciggJGk9MDsgJGxhYmVsIDw9ICRhU2NhbGUtPkdldE1heFZhbCgpKyR0aGlzLT5sYWJlbF9vZmZzZXQ7ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAvLyBBcHBseSBmb3JtYXQgdG8gbGFiZWwKICAgICAgICAgICAgICAgICR0aGlzLT5tYWpfdGlja3NfbGFiZWxbJGldPSR0aGlzLT5fZG9MYWJlbEZvcm1hdCgkbGFiZWwsJGksJG5icm1hanRpY2tzKTsKICAgICAgICAgICAgICAgICRsYWJlbCs9JHRoaXMtPm1ham9yX3N0ZXA7CgogICAgICAgICAgICAgICAgLy8gVGhlIHgtcG9zaXRpb24gb2YgdGhlIHRpY2sgbWFya3MgY2FuIGJlIGRpZmZlcmVudCBmcm9tIHRoZSBsYWJlbHMuCiAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgd2UgcmVjb3JkIHRoZSB0aWNrIHBvc2l0aW9uIChub3QgdGhlIGxhYmVsKSBzbyB0aGF0IHRoZSBncmlkCiAgICAgICAgICAgICAgICAvLyBoYXBwZW4gdXBvbiB0aWNrIG1hcmtzIGFuZCBub3QgbGFiZWxzLgogICAgICAgICAgICAgICAgJHh0aWNrPSRhU2NhbGUtPnNjYWxlX2Fic1swXSskc3RhcnRfYWJzKyR0aGlzLT54dGlja19vZmZzZXQqJG1pbl9zdGVwX2FicyskaSokbWFqX3N0ZXBfYWJzOwogICAgICAgICAgICAgICAgJHRoaXMtPm1hal90aWNrc19wb3NbJGldPSR4dGljazsKICAgICAgICAgICAgICAgICR0aGlzLT5tYWpfdGlja2xhYmVsc19wb3NbJGldID0gcm91bmQoJHgpOwogICAgICAgICAgICAgICAgJHggKz0gJG1hal9zdGVwX2FiczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJGxhYmVsID0gJGFTY2FsZS0+R2V0TWluVmFsKCk7CiAgICAgICAgICAgICRhYnNfcG9zID0gJGFTY2FsZS0+c2NhbGVfYWJzWzBdOwogICAgICAgICAgICAkaj0wOyAkaT0wOwogICAgICAgICAgICAkc3RlcCA9IHJvdW5kKCRtYWpfc3RlcF9hYnMvJG1pbl9zdGVwX2Ficyk7CiAgICAgICAgICAgIGlmKCAkYVNjYWxlLT50eXBlID09ICJ4IiApIHsKICAgICAgICAgICAgICAgIC8vIEZvciBhIG5vcm1hbCBsaW5lYXIgdHlwZSBvZiBzY2FsZSB0aGUgbWFqb3IgdGlja3Mgd2lsbCBhbHdheXMgYmUgbXVsdGlwbGVzCiAgICAgICAgICAgICAgICAvLyBvZiB0aGUgbWlub3IgdGlja3MuIEluIG9yZGVyIHRvIGF2b2lkIGFueSByb3VuZGluZyBpc3N1ZXMgdGhlIG1ham9yIHRpY2tzIGFyZQogICAgICAgICAgICAgICAgLy8gZGVmaW5lZCBhcyBldmVyeSAic3RlcCIgbWlub3IgdGlja3MgYW5kIG5vdCBjYWxjdWxhdGVkIHNlcGFyYXRlbHkKICAgICAgICAgICAgICAgICRuYnJtYWp0aWNrcz1yb3VuZCgoJGFTY2FsZS0+R2V0TWF4VmFsKCktJGFTY2FsZS0+R2V0TWluVmFsKCktJHRoaXMtPnRleHRfbGFiZWxfc3RhcnQgKS8kdGhpcy0+bWFqb3Jfc3RlcCkrMTsKICAgICAgICAgICAgICAgIHdoaWxlKCByb3VuZCgkYWJzX3BvcykgPD0gJGxpbWl0ICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT50aWNrc19wb3NbXSA9IHJvdW5kKCRhYnNfcG9zKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dGlja3NfbGFiZWxbXSA9ICRsYWJlbDsKICAgICAgICAgICAgICAgICAgICBpZiggJHN0ZXA9PSAwIHx8ICRpICUgJHN0ZXAgPT0gMCAmJiAkaiA8ICRuYnJtYWp0aWNrcyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm1hal90aWNrc19wb3NbJGpdID0gcm91bmQoJGFic19wb3MpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFqX3RpY2tsYWJlbHNfcG9zWyRqXSA9IHJvdW5kKCRhYnNfcG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm1hal90aWNrc19sYWJlbFskal09JHRoaXMtPl9kb0xhYmVsRm9ybWF0KCRsYWJlbCwkaiwkbmJybWFqdGlja3MpOwogICAgICAgICAgICAgICAgICAgICAgICArKyRqOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICArKyRpOwogICAgICAgICAgICAgICAgICAgICRhYnNfcG9zICs9ICRtaW5fc3RlcF9hYnM7CiAgICAgICAgICAgICAgICAgICAgJGxhYmVsKz0kdGhpcy0+bWlub3Jfc3RlcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICRhU2NhbGUtPnR5cGUgPT0gInkiICkgewogICAgICAgICAgICAgICAgLy9AdG9kbyAgcz0yOjIwLDEyICBzPTE6NTAsNiAgJHRoaXMtPm1ham9yX3N0ZXA6JG5icgogICAgICAgICAgICAgICAgLy8gYWJzX3BvaW50LGxpbWl0IHM9MToyNzAsODAgcz0yOjU0MCwxNjAKICAgICAgICAgICAgIC8vICR0aGlzLT5tYWpvcl9zdGVwID0gNTA7CiAgICAgICAgICAgICAgICAkbmJybWFqdGlja3M9cm91bmQoKCRhU2NhbGUtPkdldE1heFZhbCgpLSRhU2NhbGUtPkdldE1pblZhbCgpKS8kdGhpcy0+bWFqb3Jfc3RlcCkrMTsKLy8gICAgICAgICAgICAgICAgJHN0ZXAgPSA1OwogICAgICAgICAgICAgICAgd2hpbGUoIHJvdW5kKCRhYnNfcG9zKSA+PSAkbGltaXQgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnRpY2tzX3Bvc1skaV0gPSByb3VuZCgkYWJzX3Bvcyk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnRpY2tzX2xhYmVsWyRpXT0kbGFiZWw7CiAgICAgICAgICAgICAgICAgICAgaWYoICRzdGVwPT0gMCB8fCAkaSAlICRzdGVwID09IDAgJiYgJGogPCAkbmJybWFqdGlja3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm1hal90aWNrc19wb3NbJGpdID0gcm91bmQoJGFic19wb3MpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFqX3RpY2tsYWJlbHNfcG9zWyRqXSA9IHJvdW5kKCRhYnNfcG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm1hal90aWNrc19sYWJlbFskal09JHRoaXMtPl9kb0xhYmVsRm9ybWF0KCRsYWJlbCwkaiwkbmJybWFqdGlja3MpOwogICAgICAgICAgICAgICAgICAgICAgICArKyRqOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICArKyRpOwogICAgICAgICAgICAgICAgICAgICRhYnNfcG9zICs9ICRtaW5fc3RlcF9hYnM7CiAgICAgICAgICAgICAgICAgICAgJGxhYmVsICs9ICR0aGlzLT5taW5vcl9zdGVwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIEFkanVzdEZvckRTVCgkYUZsZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmlBZGp1c3RGb3JEU1QgPSAkYUZsZzsKICAgIH0KCgogICAgZnVuY3Rpb24gX2RvTGFiZWxGb3JtYXQoJGFWYWwsJGFJZHgsJGFOYnJUaWNrcykgewoKICAgICAgICAvLyBJZiBwcmVjaXNpb24gaGFzbid0IGJlZW4gc3BlY2lmaWVkIHNldCBpdCB0byBhIHNlbnNpYmxlIHZhbHVlCiAgICAgICAgaWYoICR0aGlzLT5wcmVjaXNpb249PS0xICkgewogICAgICAgICAgICAkdCA9IGxvZzEwKCR0aGlzLT5taW5vcl9zdGVwKTsKICAgICAgICAgICAgaWYoICR0ID4gMCApIHsKICAgICAgICAgICAgICAgICRwcmVjaXNpb24gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHByZWNpc2lvbiA9IC1mbG9vcigkdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRwcmVjaXNpb24gPSAkdGhpcy0+cHJlY2lzaW9uOwogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT5sYWJlbF9mb3JtZnVuYyAhPSAnJyApIHsKICAgICAgICAgICAgJGY9JHRoaXMtPmxhYmVsX2Zvcm1mdW5jOwogICAgICAgICAgICBpZiggJHRoaXMtPmxhYmVsX2Zvcm1hdHN0ciA9PSAnJyApIHsKICAgICAgICAgICAgICAgICRsID0gY2FsbF91c2VyX2Z1bmMoJGYsJGFWYWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGwgPSBzcHJpbnRmKCR0aGlzLT5sYWJlbF9mb3JtYXRzdHIsIGNhbGxfdXNlcl9mdW5jKCRmLCRhVmFsKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkdGhpcy0+bGFiZWxfZm9ybWF0c3RyICE9ICcnIHx8ICR0aGlzLT5sYWJlbF9kYXRlZm9ybWF0c3RyICE9ICcnICkgewogICAgICAgICAgICBpZiggJHRoaXMtPmxhYmVsX3VzZWRhdGVmb3JtYXQgKSB7CiAgICAgICAgICAgICAgICAvLyBBZGp1c3QgdGhlIHZhbHVlIHRvIHRha2UgZGF5bGlnaHQgc2F2aW5ncyBpbnRvIGFjY291bnQKICAgICAgICAgICAgICAgIGlmIChkYXRlKCJJIiwkYVZhbCk9PTEgJiYgJHRoaXMtPmlBZGp1c3RGb3JEU1QgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRFNUCiAgICAgICAgICAgICAgICAgICAgJGFWYWwrPTM2MDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGwgPSBkYXRlKCR0aGlzLT5sYWJlbF9mb3JtYXRzdHIsJGFWYWwpOwogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5sYWJlbF9mb3JtYXRzdHIgPT0gJ1cnICkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIHVzZSB3ZWVrIGZvcm1hdHRpbmcgdGhlbiBhZGQgYSBzaW5nbGUgJ3cnIGluIGZyb250IG9mIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIHdlZWsgbnVtYmVyIHRvIGRpZmZlcmVudGlhdGUgaXQgZnJvbSBkYXRlcwogICAgICAgICAgICAgICAgICAgICRsID0gJ3cnLiRsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5sYWJlbF9kYXRlZm9ybWF0c3RyICE9PSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAvLyBBZGp1c3QgdGhlIHZhbHVlIHRvIHRha2UgZGF5bGlnaHQgc2F2aW5ncyBpbnRvIGFjY291bnQKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZSgiSSIsJGFWYWwpPT0xICYmICR0aGlzLT5pQWRqdXN0Rm9yRFNUICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEU1QKICAgICAgICAgICAgICAgICAgICAgICAgJGFWYWwrPTM2MDA7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkbCA9IGRhdGUoJHRoaXMtPmxhYmVsX2RhdGVmb3JtYXRzdHIsJGFWYWwpOwogICAgICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWxfZm9ybWF0c3RyID09ICdXJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgdXNlIHdlZWsgZm9ybWF0dGluZyB0aGVuIGFkZCBhIHNpbmdsZSAndycgaW4gZnJvbnQgb2YgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlZWsgbnVtYmVyIHRvIGRpZmZlcmVudGlhdGUgaXQgZnJvbSBkYXRlcwogICAgICAgICAgICAgICAgICAgICAgICAkbCA9ICd3Jy4kbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbCA9IHNwcmludGYoJHRoaXMtPmxhYmVsX2Zvcm1hdHN0ciwkYVZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRsID0gc3ByaW50ZignJTAxLicuJHByZWNpc2lvbi4nZicscm91bmQoJGFWYWwsJHByZWNpc2lvbikpOwogICAgICAgIH0KCiAgICAgICAgaWYoICgkdGhpcy0+c3VwcmVzc196ZXJvbGFiZWwgJiYgJGw9PTApIHx8ICAoJHRoaXMtPnN1cHJlc3NfZmlyc3QgJiYgJGFJZHg9PTApIHx8ICgkdGhpcy0+c3VwcmVzc19sYXN0ICAmJiAkYUlkeD09JGFOYnJUaWNrcy0xKSApIHsKICAgICAgICAgICAgJGw9Jyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbDsKICAgIH0KCiAgICAvLyBTdHJva2UgdGlja3Mgb24gZWl0aGVyIFggb3IgWSBheGlzCiAgICBmdW5jdGlvbiBfU3Ryb2tlVGlja3MoJGFJbWcsJGFTY2FsZSwkYVBvcykgewogICAgICAgICRob3IgPSAkYVNjYWxlLT50eXBlID09ICd4JzsKICAgICAgICAkYUltZy0+U2V0TGluZVdlaWdodCgkdGhpcy0+d2VpZ2h0KTsKCiAgICAgICAgLy8gV2UgbmVlZCB0byBtYWtlIHRoaXMgYW4gaW50IHNpbmNlIGNvbXBhcmluZyBpdCBiZWxvdwogICAgICAgIC8vIHdpdGggdGhlIHJlc3VsdCBmcm9tIHJvdW5kKCkgY2FuIGdpdmUgd3JvbmcgcmVzdWx0LCBzdWNoIHRoYXQKICAgICAgICAvLyAoNDAgPCA0MCkgPT0gVFJVRSAhISEKICAgICAgICAkbGltaXQgPSAoaW50KSRhU2NhbGUtPnNjYWxlX2Fic1sxXTsKCiAgICAgICAgLy8gQSB0ZXh0IHNjYWxlIGRvZXNuJ3QgaGF2ZSBhbnkgbWlub3IgdGlja3MKICAgICAgICBpZiggISRhU2NhbGUtPnRleHRzY2FsZSApIHsKICAgICAgICAgICAgLy8gU3Ryb2tlIG1pbm9yIHRpY2tzCiAgICAgICAgICAgICR5dSA9ICRhUG9zIC0gJHRoaXMtPmRpcmVjdGlvbiokdGhpcy0+R2V0TWluVGlja0Fic1NpemUoKTsKICAgICAgICAgICAgJHhyID0gJGFQb3MgKyAkdGhpcy0+ZGlyZWN0aW9uKiR0aGlzLT5HZXRNaW5UaWNrQWJzU2l6ZSgpOwogICAgICAgICAgICAkbiA9IGNvdW50KCR0aGlzLT50aWNrc19wb3MpOwogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgICAgIGlmKCAhJHRoaXMtPnN1cHJlc3NfdGlja21hcmtzICYmICEkdGhpcy0+c3VwcmVzc19taW5vcl90aWNrbWFya3MpIHsKICAgICAgICAgICAgICAgICAgICBpZiggJHRoaXMtPm1pbmNvbG9yICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhSW1nLT5QdXNoQ29sb3IoJHRoaXMtPm1pbmNvbG9yKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoICRob3IgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYoICR0aGlzLT50aWNrc19wb3NbJGldIDw9ICRsaW1pdCApCiAgICAgICAgICAgICAgICAgICAgICAgICRhSW1nLT5MaW5lKCR0aGlzLT50aWNrc19wb3NbJGldLCRhUG9zLCR0aGlzLT50aWNrc19wb3NbJGldLCR5dSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvL2lmKCAkdGhpcy0+dGlja3NfcG9zWyRpXSA+PSAkbGltaXQgKQogICAgICAgICAgICAgICAgICAgICAgICAkYUltZy0+TGluZSgkYVBvcywkdGhpcy0+dGlja3NfcG9zWyRpXSwkeHIsJHRoaXMtPnRpY2tzX3Bvc1skaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiggJHRoaXMtPm1pbmNvbG9yICE9ICcnICkgewogICAgICAgICAgICAgICAgICAgICAgICAkYUltZy0+UG9wQ29sb3IoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFN0cm9rZSBtYWpvciB0aWNrcwogICAgICAgICR5dSA9ICRhUG9zIC0gJHRoaXMtPmRpcmVjdGlvbiokdGhpcy0+R2V0TWFqVGlja0Fic1NpemUoKTsKICAgICAgICAkeHIgPSAkYVBvcyArICR0aGlzLT5kaXJlY3Rpb24qJHRoaXMtPkdldE1halRpY2tBYnNTaXplKCk7CiAgICAgICAgJG5icm1hanRpY2tzPXJvdW5kKCgkYVNjYWxlLT5HZXRNYXhWYWwoKS0kYVNjYWxlLT5HZXRNaW5WYWwoKS0kdGhpcy0+dGV4dF9sYWJlbF9zdGFydCApLyR0aGlzLT5tYWpvcl9zdGVwKSsxOwogICAgICAgICRuID0gY291bnQoJHRoaXMtPm1hal90aWNrc19wb3MpOwogICAgICAgIGZvcigkaT0wOyAkaSA8ICRuIDsgKyskaSApIHsKICAgICAgICAgICAgaWYoISgkdGhpcy0+eHRpY2tfb2Zmc2V0ID4gMCAmJiAkaT09JG5icm1hanRpY2tzLTEpICYmICEkdGhpcy0+c3VwcmVzc190aWNrbWFya3MpIHsKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+bWFqY29sb3IgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAkYUltZy0+UHVzaENvbG9yKCR0aGlzLT5tYWpjb2xvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggJGhvciApIHsKICAgICAgICAgICAgICAgICAgICAvL2lmKCAkdGhpcy0+bWFqX3RpY2tzX3Bvc1skaV0gPD0gJGxpbWl0ICkKICAgICAgICAgICAgICAgICAgICAkYUltZy0+TGluZSgkdGhpcy0+bWFqX3RpY2tzX3Bvc1skaV0sJGFQb3MsJHRoaXMtPm1hal90aWNrc19wb3NbJGldLCR5dSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvL2lmKCAkdGhpcy0+bWFqX3RpY2tzX3Bvc1skaV0gPj0gJGxpbWl0ICkKICAgICAgICAgICAgICAgICAgICAkYUltZy0+TGluZSgkYVBvcywkdGhpcy0+bWFqX3RpY2tzX3Bvc1skaV0sJHhyLCR0aGlzLT5tYWpfdGlja3NfcG9zWyRpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPm1hamNvbG9yICE9ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgJGFJbWctPlBvcENvbG9yKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIC8vIERyYXcgbGluZWFyIHRpY2tzCiAgICBmdW5jdGlvbiBTdHJva2UoJGFJbWcsJGFTY2FsZSwkYVBvcykgewogICAgICAgIGlmKCAkdGhpcy0+aU1hbnVhbFRpY2tQb3MgIT0gTlVMTCApIHsKICAgICAgICAgICAgJHRoaXMtPl9kb01hbnVhbFRpY2tQb3MoJGFTY2FsZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+X2RvQXV0b1RpY2tQb3MoJGFTY2FsZSk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5fU3Ryb2tlVGlja3MoJGFJbWcsJGFTY2FsZSwkYVBvcywgJGFTY2FsZS0+dHlwZSA9PSAneCcgKTsKICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gUFJJVkFURSBNRVRIT0RTCiAgICAvLyBTcG9lY2lmeSB0aGUgb2Zmc2V0IG9mIHRoZSBkaXNwbGF5ZWQgdGljayBtYXJrIHdpdGggdGhlIHRpY2sgInNwYWNlIgogICAgLy8gTGVnYWwgdmFsdWVzIGZvciAkbyBpcyBbMCwxXSB1c2VkIHRvIGFkanVzdCB3aGVyZSB0aGUgdGljayBtYXJrcyBhbmQgbGFiZWwKICAgIC8vIHNob3VsZCBiZSBwb3NpdGlvbmVkIHdpdGhpbiB0aGUgbWFqb3IgdGljay1zaXplCiAgICAvLyAkbG8gc3BlY2lmaWVzIHRoZSBsYWJlbCBvZmZzZXQgYW5kICR0byBzcGVjaWZpZXMgdGhlIHRpY2sgb2Zmc2V0CiAgICAvLyB0aGlzIGNvbWVzIGluIGhhbmR5IGZvciBleGFtcGxlIGluIGJhciBncmFwaHMgd2hlcmUgd2Ugd29udCBubyBvZmZzZXQgZm9yIHRoZQogICAgLy8gdGljayBidXQgaGF2ZSB0aGUgbGFiZWxzIGRpc3BsYXllZCBoYWxmd2F5IHVuZGVyIHRoZSBiYXJzLgogICAgZnVuY3Rpb24gU2V0WExhYmVsT2Zmc2V0KCRhTGFiZWxPZmYsJGFUaWNrT2ZmPS0xKSB7CiAgICAgICAgJHRoaXMtPnhsYWJlbF9vZmZzZXQ9JGFMYWJlbE9mZjsKICAgICAgICBpZiggJGFUaWNrT2ZmPT0tMSApIHsKICAgICAgICAgICAgLy8gU2FtZSBhcyBsYWJlbCBvZmZzZXQKICAgICAgICAgICAgJHRoaXMtPnh0aWNrX29mZnNldD0kYUxhYmVsT2ZmOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnh0aWNrX29mZnNldD0kYVRpY2tPZmY7CiAgICAgICAgfQogICAgICAgIGlmKCAkYUxhYmVsT2ZmPjAgKSB7CiAgICAgICAgICAgICR0aGlzLT5TdXByZXNzTGFzdCgpOyAvLyBUaGUgbGFzdCB0aWNrIHdvbnQgZml0CiAgICAgICAgfQogICAgfQoKICAgIC8vIFdoaWNoIHRpY2sgbGFiZWwgc2hvdWxkIHdlIHN0YXJ0IHdpdGg\/CiAgICBmdW5jdGlvbiBTZXRUZXh0TGFiZWxTdGFydCgkYVRleHRMYWJlbE9mZikgewogICAgICAgICR0aGlzLT50ZXh0X2xhYmVsX3N0YXJ0PSRhVGV4dExhYmVsT2ZmOwogICAgfQoKfSAvLyBDbGFzcwoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gQ0xBU1MgTGluZWFyU2NhbGUKLy8gRGVzY3JpcHRpb246IEhhbmRsZSBsaW5lYXIgc2NhbGluZyBiZXR3ZWVuIHNjcmVlbiBhbmQgd29ybGQKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgTGluZWFyU2NhbGUgewogICAgcHVibGljICR0ZXh0c2NhbGU9ZmFsc2U7IC8vIEp1c3QgYSBmbGFnIHRvIGxldCB0aGUgUGxvdCBjbGFzcyBmaW5kIG91dCBpZgogICAgLy8gd2UgYXJlIGEgdGV4dHNjYWxlIG9yIG5vdC4gVGhpcyBpcyBhIGNsdWRnZSBzaW5jZQogICAgLy8gdGhpcyBpbmZvcm1hdGlvbiBpcyBhdmFpbGFibGUgaW4gR3JhcGg6OmF4dHlwZSBidXQKICAgIC8vIHdlIGRvbid0IGhhdmUgYWNjZXNzIHRvIHRoZSBncmFwaCBvYmplY3QgaW4gdGhlIFBsb3RzCiAgICAvLyBzdHJva2UgbWV0aG9kLiBTbyB3ZSBsZXQgZ3JhcGggc3RvcmUgdGhlIHN0YXR1cyBoZXJlCiAgICAvLyB3aGVuIHRoZSBsaW5lYXIgc2NhbGUgaXMgY3JlYXRlZC4gQSByZWFsIGNsdWRnZS4uLgogICAgcHVibGljICR0eXBlOyAvLyBpcyB0aGlzIHggb3IgeSBzY2FsZSA\/CiAgICBwdWJsaWMgJHRpY2tzPW51bGw7IC8vIFN0b3JlIHRpY2tzCiAgICBwdWJsaWMgJHRleHRfc2NhbGVfb2ZmID0gMDsKICAgIHB1YmxpYyAkc2NhbGVfYWJzPWFycmF5KDAsMCk7CiAgICBwdWJsaWMgJHNjYWxlX2ZhY3RvcjsgLy8gU2NhbGUgZmFjdG9yIGJldHdlZW4gd29ybGQgYW5kIHNjcmVlbgogICAgcHVibGljICRvZmY7IC8vIE9mZnNldCBiZXR3ZWVuIGltYWdlIGVkZ2UgYW5kIHBsb3QgYXJlYQogICAgcHVibGljICRzY2FsZT1hcnJheSgwLDApOwogICAgcHVibGljICRuYW1lID0gJ2xpbic7CiAgICBwdWJsaWMgJGF1dG9fdGlja3M9ZmFsc2U7IC8vIFdoZW4gdXNpbmcgbWFudWFsIHNjYWxlIHNob3VsZCB0aGUgdGlja3MgYmUgYXV0b21hdGljYWxseSBzZXQ\/CiAgICBwdWJsaWMgJHdvcmxkX2Fic19zaXplOyAvLyBQbG90IGFyZWEgc2l6ZSBpbiBwaXhlbHMgKE5lZWRlZCBwdWJsaWMgaW4ganBncmFwaF9yYWRhci5waHApCiAgICBwdWJsaWMgJGludHNjYWxlPWZhbHNlOyAvLyBSZXN0cmljdCBhdXRvc2NhbGUgdG8gaW50ZWdlcnMKICAgIHByb3RlY3RlZCAkYXV0b3NjYWxlX21pbj1mYWxzZTsgLy8gRm9yY2VkIG1pbmltdW0gdmFsdWUsIGF1dG8gZGV0ZXJtaW5lIG1heAogICAgcHJvdGVjdGVkICRhdXRvc2NhbGVfbWF4PWZhbHNlOyAvLyBGb3JjZWQgbWF4aW11bSB2YWx1ZSwgYXV0byBkZXRlcm1pbmUgbWluCiAgICBwcml2YXRlICRncmFjZXRvcD0wLCRncmFjZWJvdHRvbT0wOwoKICAgIHByaXZhdGUgJF93b3JsZF9zaXplOyAvLyBQbG90IGFyZWEgc2l6ZSBpbiB3b3JsZCBjb29yZGluYXRlcwoKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRhTWluPTAsJGFNYXg9MCwkYVR5cGU9J3knKSB7CiAgICAgICAgYXNzZXJ0KCRhVHlwZT09J3gnIHx8ICRhVHlwZT09J3knICk7CiAgICAgICAgYXNzZXJ0KCRhTWluPD0kYU1heCk7CgogICAgICAgICR0aGlzLT50eXBlPSRhVHlwZTsKICAgICAgICAkdGhpcy0+c2NhbGU9YXJyYXkoJGFNaW4sJGFNYXgpOwogICAgICAgICR0aGlzLT53b3JsZF9zaXplPSRhTWF4LSRhTWluOwogICAgICAgICR0aGlzLT50aWNrcyA9IG5ldyBMaW5lYXJUaWNrcygpOwogICAgfQoKICAgIC8vIENoZWNrIGlmIHNjYWxlIGlzIHNldCBvciBpZiB3ZSBzaG91bGQgYXV0b3NjYWxlCiAgICAvLyBXZSBzaG91bGQgZG8gdGhpcyBpcyBlaXRoZXIgc2NhbGUgb3IgdGlja3MgaGFzIG5vdCBiZWVuIHNldAogICAgZnVuY3Rpb24gSXNTcGVjaWZpZWQoKSB7CiAgICAgICAgaWYoICR0aGlzLT5HZXRNaW5WYWwoKT09JHRoaXMtPkdldE1heFZhbCgpICkgeyAgLy8gU2NhbGUgbm90IHNldAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFNldCB0aGUgbWluaW11bSBkYXRhIHZhbHVlIHdoZW4gdGhlIGF1dG9zY2FsaW5nIGlzIHVzZWQuCiAgICAvLyBVc2VmdWxsIGlmIHlvdSB3YW50IGEgZml4IG1pbmltdW0gKGxpa2UgMCkgYnV0IGhhdmUgYW4KICAgIC8vIGF1dG9tYXRpYyBtYXhpbXVtCiAgICBmdW5jdGlvbiBTZXRBdXRvTWluKCRhTWluKSB7CiAgICAgICAgJHRoaXMtPmF1dG9zY2FsZV9taW49JGFNaW47CiAgICB9CgogICAgLy8gU2V0IHRoZSBtaW5pbXVtIGRhdGEgdmFsdWUgd2hlbiB0aGUgYXV0b3NjYWxpbmcgaXMgdXNlZC4KICAgIC8vIFVzZWZ1bGwgaWYgeW91IHdhbnQgYSBmaXggbWluaW11bSAobGlrZSAwKSBidXQgaGF2ZSBhbgogICAgLy8gYXV0b21hdGljIG1heGltdW0KICAgIGZ1bmN0aW9uIFNldEF1dG9NYXgoJGFNYXgpIHsKICAgICAgICAkdGhpcy0+YXV0b3NjYWxlX21heD0kYU1heDsKICAgIH0KCiAgICAvLyBJZiB0aGUgdXNlciBtYW51YWxseSBzcGVjaWZpZXMgYSBzY2FsZSBzaG91bGQgdGhlIHRpY2tzCiAgICAvLyBzdGlsbCBiZSBzZXQgYXV0b21hdGljYWxseT8KICAgIGZ1bmN0aW9uIFNldEF1dG9UaWNrcygkYUZsYWc9dHJ1ZSkgewogICAgICAgICR0aGlzLT5hdXRvX3RpY2tzID0gJGFGbGFnOwogICAgfQoKICAgIC8vIFNwZWNpZnkgc2NhbGUgImdyYWNlIiB2YWx1ZSAodG9wIGFuZCBib3R0b20pCiAgICBmdW5jdGlvbiBTZXRHcmFjZSgkYUdyYWNlVG9wLCRhR3JhY2VCb3R0b209MCkgewogICAgICAgIGlmKCAkYUdyYWNlVG9wPDAgfHwgJGFHcmFjZUJvdHRvbSA8IDAgICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA2OSk7Ly8oIiBHcmFjZSBtdXN0IGJlIGxhcmdlciB0aGVuIDAiKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmdyYWNldG9wPSRhR3JhY2VUb3A7CiAgICAgICAgJHRoaXMtPmdyYWNlYm90dG9tPSRhR3JhY2VCb3R0b207CiAgICB9CgogICAgLy8gR2V0IHRoZSBtaW5pbXVtIHZhbHVlIGluIHRoZSBzY2FsZQogICAgZnVuY3Rpb24gR2V0TWluVmFsKCkgewogICAgICAgIHJldHVybiAkdGhpcy0+c2NhbGVbMF07CiAgICB9CgogICAgLy8gZ2V0IG1heGltdW0gdmFsdWUgZm9yIHNjYWxlCiAgICBmdW5jdGlvbiBHZXRNYXhWYWwoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zY2FsZVsxXTsKICAgIH0KCiAgICAvLyBTcGVjaWZ5IGEgbmV3IG1pbi9tYXggdmFsdWUgZm9yIHNjbGFlCiAgICBmdW5jdGlvbiBVcGRhdGUoJGFJbWcsJGFNaW4sJGFNYXgpIHsKICAgICAgICAkdGhpcy0+c2NhbGU9YXJyYXkoJGFNaW4sJGFNYXgpOwogICAgICAgICR0aGlzLT53b3JsZF9zaXplPSRhTWF4LSRhTWluOwogICAgICAgICR0aGlzLT5Jbml0Q29uc3RhbnRzKCRhSW1nKTsKICAgIH0KCiAgICAvLyBUcmFuc2xhdGUgYmV0d2VlbiB3b3JsZCBhbmQgc2NyZWVuCiAgICBmdW5jdGlvbiBUcmFuc2xhdGUoJGFDb29yZCkgewogICAgICAgIGlmKCAhaXNfbnVtZXJpYygkYUNvb3JkKSApIHsKICAgICAgICAgICAgaWYoICRhQ29vcmQgIT0gJycgJiYgJGFDb29yZCAhPSAnLScgJiYgJGFDb29yZCAhPSAneCcgKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA3MCk7Ly8oJ1lvdXIgZGF0YSBjb250YWlucyBub24tbnVtZXJpYyB2YWx1ZXMuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gcm91bmQoJHRoaXMtPm9mZisoJGFDb29yZCAtICR0aGlzLT5zY2FsZVswXSkgKiAkdGhpcy0+c2NhbGVfZmFjdG9yKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gUmVsYXRpdmUgdHJhbnNsYXRlIChkb24ndCBpbmNsdWRlIG9mZnNldCkgdXNlZnVsbCB3aGVuIHdlIGp1c3Qgd2FudAogICAgLy8gdG8ga25vdyB0aGUgcmVsYXRpdmUgcG9zaXRpb24gKGluIHBpeGVscykgb24gdGhlIGF4aXMKICAgIGZ1bmN0aW9uIFJlbFRyYW5zbGF0ZSgkYUNvb3JkKSB7CiAgICAgICAgaWYoICFpc19udW1lcmljKCRhQ29vcmQpICkgewogICAgICAgICAgICBpZiggJGFDb29yZCAhPSAnJyAmJiAkYUNvb3JkICE9ICctJyAmJiAkYUNvb3JkICE9ICd4JyAgKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA3MCk7Ly8oJ1lvdXIgZGF0YSBjb250YWlucyBub24tbnVtZXJpYyB2YWx1ZXMuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gKCRhQ29vcmQgLSAkdGhpcy0+c2NhbGVbMF0pICogJHRoaXMtPnNjYWxlX2ZhY3RvcjsKICAgICAgICB9CiAgICB9CgogICAgLy8gUmVzdHJpY3QgYXV0b3NjYWxpbmcgdG8gb25seSB1c2UgaW50ZWdlcnMKICAgIGZ1bmN0aW9uIFNldEludFNjYWxlKCRhSW50U2NhbGU9dHJ1ZSkgewogICAgICAgICR0aGlzLT5pbnRzY2FsZT0kYUludFNjYWxlOwogICAgfQoKICAgIC8vIENhbGN1bGF0ZSBhbiBpbnRlZ2VyIGF1dG9zY2FsZQogICAgZnVuY3Rpb24gSW50QXV0b1NjYWxlKCRpbWcsJG1pbiwkbWF4LCRtYXhzdGVwcywkbWFqZW5kPXRydWUpIHsKICAgICAgICAvLyBNYWtlIHN1cmUgbGltaXRzIGFyZSBpbnRlZ2VycwogICAgICAgICRtaW49Zmxvb3IoJG1pbik7CiAgICAgICAgJG1heD1jZWlsKCRtYXgpOwogICAgICAgIGlmKCBhYnMoJG1pbi0kbWF4KT09MCApIHsKICAgICAgICAgICAgLS0kbWluOyArKyRtYXg7CiAgICAgICAgfQogICAgICAgICRtYXhzdGVwcyA9IGZsb29yKCRtYXhzdGVwcyk7CgogICAgICAgICRncmFjZXRvcD1yb3VuZCgoJHRoaXMtPmdyYWNldG9wLzEwMC4wKSphYnMoJG1heC0kbWluKSk7CiAgICAgICAgJGdyYWNlYm90dG9tPXJvdW5kKCgkdGhpcy0+Z3JhY2Vib3R0b20vMTAwLjApKmFicygkbWF4LSRtaW4pKTsKICAgICAgICBpZiggaXNfbnVtZXJpYygkdGhpcy0+YXV0b3NjYWxlX21pbikgKSB7CiAgICAgICAgICAgICRtaW4gPSBjZWlsKCR0aGlzLT5hdXRvc2NhbGVfbWluKTsKICAgICAgICAgICAgaWYoICRtaW4gPj0gJG1heCApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDcxKTsvLygnWW91IGhhdmUgc3BlY2lmaWVkIGEgbWluIHZhbHVlIHdpdGggU2V0QXV0b01pbigpIHdoaWNoIGlzIGxhcmdlciB0aGFuIHRoZSBtYXhpbXVtIHZhbHVlIHVzZWQgZm9yIHRoZSBzY2FsZS4gVGhpcyBpcyBub3QgcG9zc2libGUuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCBpc19udW1lcmljKCR0aGlzLT5hdXRvc2NhbGVfbWF4KSApIHsKICAgICAgICAgICAgJG1heCA9IGNlaWwoJHRoaXMtPmF1dG9zY2FsZV9tYXgpOwogICAgICAgICAgICBpZiggJG1pbiA+PSAkbWF4ICkgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNzIpOy8vKCdZb3UgaGF2ZSBzcGVjaWZpZWQgYSBtYXggdmFsdWUgd2l0aCBTZXRBdXRvTWF4KCkgd2hpY2ggaXMgc21hbGxlciB0aGFuIHRoZSBtaW1pbnVtIHZhbHVlIHVzZWQgZm9yIHRoZSBzY2FsZS4gVGhpcyBpcyBub3QgcG9zc2libGUuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKCBhYnMoJG1pbi0kbWF4ICkgPT0gMCApIHsKICAgICAgICAgICAgKyskbWF4OwogICAgICAgICAgICAtLSRtaW47CiAgICAgICAgfQoKICAgICAgICAkbWluIC09ICRncmFjZWJvdHRvbTsKICAgICAgICAkbWF4ICs9ICRncmFjZXRvcDsKCiAgICAgICAgLy8gRmlyc3QgZ2V0IHRpY2ttYXJrcyBhcyBtdWx0aXBsZXMgb2YgMSwgMTAsIC4uLgogICAgICAgIGlmKCAkbWFqZW5kICkgewogICAgICAgICAgICBsaXN0KCRudW0xc3RlcHMsJGFkajFtaW4sJGFkajFtYXgsJG1hajFzdGVwKSA9ICR0aGlzLT5JbnRDYWxjVGlja3MoJG1heHN0ZXBzLCRtaW4sJG1heCwxKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRhZGoxbWluID0gJG1pbjsKICAgICAgICAgICAgJGFkajFtYXggPSAkbWF4OwogICAgICAgICAgICBsaXN0KCRudW0xc3RlcHMsJG1hajFzdGVwKSA9ICR0aGlzLT5JbnRDYWxjVGlja3NGcmVlemUoJG1heHN0ZXBzLCRtaW4sJG1heCwxKTsKICAgICAgICB9CgogICAgICAgIGlmKCBhYnMoJG1pbi0kbWF4KSA+IDIgKSB7CiAgICAgICAgICAgIC8vIFRoZW4gZ2V0IHRpY2sgbWFya3MgYXMgMjpzIDIsIDIwLCAuLi4KICAgICAgICAgICAgaWYoICRtYWplbmQgKSB7CiAgICAgICAgICAgICAgICBsaXN0KCRudW0yc3RlcHMsJGFkajJtaW4sJGFkajJtYXgsJG1hajJzdGVwKSA9ICR0aGlzLT5JbnRDYWxjVGlja3MoJG1heHN0ZXBzLCRtaW4sJG1heCw1KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRhZGoybWluID0gJG1pbjsKICAgICAgICAgICAgICAgICRhZGoybWF4ID0gJG1heDsKICAgICAgICAgICAgICAgIGxpc3QoJG51bTJzdGVwcywkbWFqMnN0ZXApID0gJHRoaXMtPkludENhbGNUaWNrc0ZyZWV6ZSgkbWF4c3RlcHMsJG1pbiwkbWF4LDUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkbnVtMnN0ZXBzID0gMTAwMDA7IC8vIER1bW15IGhpZ2ggdmFsdWUgc28gd2UgZG9uJ3QgY2hvb3NlIHRoaXMKICAgICAgICB9CgogICAgICAgIGlmKCBhYnMoJG1pbi0kbWF4KSA+IDUgKSB7CiAgICAgICAgICAgIC8vIFRoZW4gZ2V0IHRpY2ttYXJrcyBhcyA1OnMgNSwgNTAsIDUwMCwgLi4uCiAgICAgICAgICAgIGlmKCAkbWFqZW5kICkgewogICAgICAgICAgICAgICAgbGlzdCgkbnVtNXN0ZXBzLCRhZGo1bWluLCRhZGo1bWF4LCRtYWo1c3RlcCkgPSAkdGhpcy0+SW50Q2FsY1RpY2tzKCRtYXhzdGVwcywkbWluLCRtYXgsMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkYWRqNW1pbiA9ICRtaW47CiAgICAgICAgICAgICAgICAkYWRqNW1heCA9ICRtYXg7CiAgICAgICAgICAgICAgICBsaXN0KCRudW01c3RlcHMsJG1hajVzdGVwKSA9ICR0aGlzLT5JbnRDYWxjVGlja3NGcmVlemUoJG1heHN0ZXBzLCRtaW4sJG1heCwyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJG51bTVzdGVwcyA9IDEwMDAwOyAvLyBEdW1teSBoaWdoIHZhbHVlIHNvIHdlIGRvbid0IGNob29zZSB0aGlzCiAgICAgICAgfQoKICAgICAgICAvLyBDaGVjayB0byBzZWUgd2hpY2hvZiAxOnMsIDI6cyBvciA1OnMgZml0IGJldHRlciB3aXRoCiAgICAgICAgLy8gdGhlIHJlcXVlc3RlZCBudW1iZXIgb2YgbWFqb3IgdGlja3MKICAgICAgICAkbWF0Y2gxPWFicygkbnVtMXN0ZXBzLSRtYXhzdGVwcyk7CiAgICAgICAgJG1hdGNoMj1hYnMoJG51bTJzdGVwcy0kbWF4c3RlcHMpOwogICAgICAgIGlmKCAhZW1wdHkoJG1hajVzdGVwKSAmJiAkbWFqNXN0ZXAgPiAxICkgewogICAgICAgICAgICAkbWF0Y2g1PWFicygkbnVtNXN0ZXBzLSRtYXhzdGVwcyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkbWF0Y2g1PTEwMDAwOyAgLy8gRHVtbXkgaGlnaCB2YWx1ZQogICAgICAgIH0KCiAgICAgICAgLy8gQ29tcGFyZSB0aGVzZSB0aHJlZSB2YWx1ZXMgYW5kIHNlZSB3aGljaCBpcyB0aGUgY2xvc2VzdCBtYXRjaAogICAgICAgIC8vIFdlIHVzZSBhIDAuNiB3ZWlnaHQgdG8gZ3Jhdml0YXRlIHRvd2FyZHMgbXVsdGlwbGUgb2YgNTpzCiAgICAgICAgaWYoICRtYXRjaDEgPCAkbWF0Y2gyICkgewogICAgICAgICAgICBpZiggJG1hdGNoMSA8ICRtYXRjaDUgKSAkcj0xOwogICAgICAgICAgICBlbHNlICAkcj0zOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYoICRtYXRjaDIgPCAkbWF0Y2g1ICkgJHI9MjsKICAgICAgICAgICAgZWxzZSAkcj0zOwogICAgICAgIH0KICAgICAgICAvLyBNaW5zdGVwcyBhcmUgYWx3YXlzIHRoZSBzYW1lIGFzIG1heHN0ZXBzIGZvciBpbnRlZ2VyIHNjYWxlCiAgICAgICAgc3dpdGNoKCAkciApIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgJHRoaXMtPnRpY2tzLT5TZXQoJG1hajFzdGVwLCRtYWoxc3RlcCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+VXBkYXRlKCRpbWcsJGFkajFtaW4sJGFkajFtYXgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICR0aGlzLT50aWNrcy0+U2V0KCRtYWoyc3RlcCwkbWFqMnN0ZXApOwogICAgICAgICAgICAgICAgJHRoaXMtPlVwZGF0ZSgkaW1nLCRhZGoybWluLCRhZGoybWF4KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAkdGhpcy0+dGlja3MtPlNldCgkbWFqNXN0ZXAsJG1hajVzdGVwKTsKICAgICAgICAgICAgICAgICR0aGlzLT5VcGRhdGUoJGltZywkYWRqNW1pbiwkYWRqNW1heCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDczLCRyKTsvLygnSW50ZXJuYWwgZXJyb3IuIEludGVnZXIgc2NhbGUgYWxnb3JpdGhtIGNvbXBhcmlzb24gb3V0IG9mIGJvdW5kIChyPSRyKScpOwogICAgICAgIH0KICAgIH0KCgogICAgLy8gQ2FsY3VsYXRlIGF1dG9zY2FsZS4gVXNlZCBpZiB1c2VyIGhhc24ndCBnaXZlbiBhIHNjYWxlIGFuZCB0aWNrcwogICAgLy8gJG1heHN0ZXBzIGlzIHRoZSBtYXhpbXVtIG51bWJlciBvZiBtYWpvciB0aWNrbWFya3MgYWxsb3dlZC4KICAgIGZ1bmN0aW9uIEF1dG9TY2FsZSgkaW1nLCRtaW4sJG1heCwkbWF4c3RlcHMsJG1hamVuZD10cnVlKSB7CgogICAgICAgIGlmKCAhaXNfbnVtZXJpYygkbWluKSB8fCAhaXNfbnVtZXJpYygkbWF4KSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZSgyNTA0NCk7CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPmludHNjYWxlICkgewogICAgICAgICAgICAkdGhpcy0+SW50QXV0b1NjYWxlKCRpbWcsJG1pbiwkbWF4LCRtYXhzdGVwcywkbWFqZW5kKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiggYWJzKCRtaW4tJG1heCkgPCAwLjAwMDAxICkgewogICAgICAgICAgICAvLyBXZSBuZWVkIHNvbWUgZGlmZmVyZW5jZSB0byBiZSBhYmxlIHRvIGF1dG9zY2FsZQogICAgICAgICAgICAvLyBtYWtlIGl0IDUlIGFib3ZlIGFuZCA1JSBiZWxvdyB2YWx1ZQogICAgICAgICAgICBpZiggJG1pbj09MCAmJiAkbWF4PT0wICkgeyAgLy8gU3BlY2lhbCBjYXNlCiAgICAgICAgICAgICAgICAkbWluPS0xOyAkbWF4PTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkZGVsdGEgPSAoYWJzKCRtYXgpK2FicygkbWluKSkqMC4wMDU7CiAgICAgICAgICAgICAgICAkbWluIC09ICRkZWx0YTsKICAgICAgICAgICAgICAgICRtYXggKz0gJGRlbHRhOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkZ3JhY2V0b3A9KCR0aGlzLT5ncmFjZXRvcC8xMDAuMCkqYWJzKCRtYXgtJG1pbik7CiAgICAgICAgJGdyYWNlYm90dG9tPSgkdGhpcy0+Z3JhY2Vib3R0b20vMTAwLjApKmFicygkbWF4LSRtaW4pOwogICAgICAgIGlmKCBpc19udW1lcmljKCR0aGlzLT5hdXRvc2NhbGVfbWluKSApIHsKICAgICAgICAgICAgJG1pbiA9ICR0aGlzLT5hdXRvc2NhbGVfbWluOwogICAgICAgICAgICBpZiggJG1pbiA+PSAkbWF4ICkgewogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNzEpOy8vKCdZb3UgaGF2ZSBzcGVjaWZpZWQgYSBtaW4gdmFsdWUgd2l0aCBTZXRBdXRvTWluKCkgd2hpY2ggaXMgbGFyZ2VyIHRoYW4gdGhlIG1heGltdW0gdmFsdWUgdXNlZCBmb3IgdGhlIHNjYWxlLiBUaGlzIGlzIG5vdCBwb3NzaWJsZS4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggYWJzKCRtaW4tJG1heCApIDwgMC4wMDEgKSB7CiAgICAgICAgICAgICAgICAkbWF4ICo9IDEuMjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoIGlzX251bWVyaWMoJHRoaXMtPmF1dG9zY2FsZV9tYXgpICkgewogICAgICAgICAgICAkbWF4ID0gJHRoaXMtPmF1dG9zY2FsZV9tYXg7CiAgICAgICAgICAgIGlmKCAkbWluID49ICRtYXggKSB7CiAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTA3Mik7Ly8oJ1lvdSBoYXZlIHNwZWNpZmllZCBhIG1heCB2YWx1ZSB3aXRoIFNldEF1dG9NYXgoKSB3aGljaCBpcyBzbWFsbGVyIHRoYW4gdGhlIG1pbWludW0gdmFsdWUgdXNlZCBmb3IgdGhlIHNjYWxlLiBUaGlzIGlzIG5vdCBwb3NzaWJsZS4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggYWJzKCRtaW4tJG1heCApIDwgMC4wMDEgKSB7CiAgICAgICAgICAgICAgICAkbWluICo9IDAuODsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJG1pbiAtPSAkZ3JhY2Vib3R0b207CiAgICAgICAgJG1heCArPSAkZ3JhY2V0b3A7CgogICAgICAgIC8vIEZpcnN0IGdldCB0aWNrbWFya3MgYXMgbXVsdGlwbGVzIG9mIDAuMSwgMSwgMTAsIC4uLgogICAgICAgIGlmKCAkbWFqZW5kICkgewogICAgICAgICAgICBsaXN0KCRudW0xc3RlcHMsJGFkajFtaW4sJGFkajFtYXgsJG1pbjFzdGVwLCRtYWoxc3RlcCkgPSAkdGhpcy0+Q2FsY1RpY2tzKCRtYXhzdGVwcywkbWluLCRtYXgsMSwyKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRhZGoxbWluPSRtaW47CiAgICAgICAgICAgICRhZGoxbWF4PSRtYXg7CiAgICAgICAgICAgIGxpc3QoJG51bTFzdGVwcywkbWluMXN0ZXAsJG1hajFzdGVwKSA9ICR0aGlzLT5DYWxjVGlja3NGcmVlemUoJG1heHN0ZXBzLCRtaW4sJG1heCwxLDIsZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgLy8gVGhlbiBnZXQgdGljayBtYXJrcyBhcyAyOnMgMC4yLCAyLCAyMCwgLi4uCiAgICAgICAgaWYoICRtYWplbmQgKSB7CiAgICAgICAgICAgIGxpc3QoJG51bTJzdGVwcywkYWRqMm1pbiwkYWRqMm1heCwkbWluMnN0ZXAsJG1hajJzdGVwKSA9ICR0aGlzLT5DYWxjVGlja3MoJG1heHN0ZXBzLCRtaW4sJG1heCw1LDIpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJGFkajJtaW49JG1pbjsKICAgICAgICAgICAgJGFkajJtYXg9JG1heDsKICAgICAgICAgICAgbGlzdCgkbnVtMnN0ZXBzLCRtaW4yc3RlcCwkbWFqMnN0ZXApID0gJHRoaXMtPkNhbGNUaWNrc0ZyZWV6ZSgkbWF4c3RlcHMsJG1pbiwkbWF4LDUsMixmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBUaGVuIGdldCB0aWNrbWFya3MgYXMgNTpzIDAuMDUsIDAuNSwgNSwgNTAsIC4uLgogICAgICAgIGlmKCAkbWFqZW5kICkgewogICAgICAgICAgICBsaXN0KCRudW01c3RlcHMsJGFkajVtaW4sJGFkajVtYXgsJG1pbjVzdGVwLCRtYWo1c3RlcCkgPSAkdGhpcy0+Q2FsY1RpY2tzKCRtYXhzdGVwcywkbWluLCRtYXgsMiw1KTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRhZGo1bWluPSRtaW47CiAgICAgICAgICAgICRhZGo1bWF4PSRtYXg7CiAgICAgICAgICAgIGxpc3QoJG51bTVzdGVwcywkbWluNXN0ZXAsJG1hajVzdGVwKSA9ICR0aGlzLT5DYWxjVGlja3NGcmVlemUoJG1heHN0ZXBzLCRtaW4sJG1heCwyLDUsZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIHdoaWNob2YgMTpzLCAyOnMgb3IgNTpzIGZpdCBiZXR0ZXIgd2l0aAogICAgICAgIC8vIHRoZSByZXF1ZXN0ZWQgbnVtYmVyIG9mIG1ham9yIHRpY2tzCiAgICAgICAgJG1hdGNoMT1hYnMoJG51bTFzdGVwcy0kbWF4c3RlcHMpOwogICAgICAgICRtYXRjaDI9YWJzKCRudW0yc3RlcHMtJG1heHN0ZXBzKTsKICAgICAgICAkbWF0Y2g1PWFicygkbnVtNXN0ZXBzLSRtYXhzdGVwcyk7CgogICAgICAgIC8vIENvbXBhcmUgdGhlc2UgdGhyZWUgdmFsdWVzIGFuZCBzZWUgd2hpY2ggaXMgdGhlIGNsb3Nlc3QgbWF0Y2gKICAgICAgICAvLyBXZSB1c2UgYSAwLjggd2VpZ2h0IHRvIGdyYXZpdGF0ZSB0b3dhcmRzIG11bHRpcGxlIG9mIDU6cwogICAgICAgICRyPSR0aGlzLT5NYXRjaE1pbjMoJG1hdGNoMSwkbWF0Y2gyLCRtYXRjaDUsMC44KTsKICAgICAgICBzd2l0Y2goICRyICkgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAkdGhpcy0+VXBkYXRlKCRpbWcsJGFkajFtaW4sJGFkajFtYXgpOwogICAgICAgICAgICAgICAgJHRoaXMtPnRpY2tzLT5TZXQoJG1hajFzdGVwLCRtaW4xc3RlcCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgJHRoaXMtPlVwZGF0ZSgkaW1nLCRhZGoybWluLCRhZGoybWF4KTsKICAgICAgICAgICAgICAgICR0aGlzLT50aWNrcy0+U2V0KCRtYWoyc3RlcCwkbWluMnN0ZXApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICR0aGlzLT5VcGRhdGUoJGltZywkYWRqNW1pbiwkYWRqNW1heCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+dGlja3MtPlNldCgkbWFqNXN0ZXAsJG1pbjVzdGVwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gUFJJVkFURSBNRVRIT0RTCgogICAgLy8gVGhpcyBtZXRob2QgcmVjYWxjdWxhdGVzIGFsbCBjb25zdGFudHMgdGhhdCBhcmUgZGVwZW5kaW5nIG9uIHRoZQogICAgLy8gbWFyZ2lucyBpbiB0aGUgaW1hZ2UuIElmIHRoZSBtYXJnaW5zIGluIHRoZSBpbWFnZSBhcmUgY2hhbmdlZAogICAgLy8gdGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBmb3IgZXZlcnkgc2NhbGUgdGhhdCBpcyByZWdpc3RyZWQgd2l0aAogICAgLy8gdGhhdCBpbWFnZS4gU2hvdWxkIHJlYWxseSBiZSBpbnN0YWxsZWQgYXMgYW4gb2JzZXJ2ZXIgb2YgdGhhdCBpbWFnZS4KICAgIGZ1bmN0aW9uIEluaXRDb25zdGFudHMoJGltZykgewogICAgICAgIGlmKCAkdGhpcy0+dHlwZT09J3gnICkgewogICAgICAgICAgICAkdGhpcy0+d29ybGRfYWJzX3NpemU9JGltZy0+d2lkdGggLSAkaW1nLT5sZWZ0X21hcmdpbiAtICRpbWctPnJpZ2h0X21hcmdpbjsKICAgICAgICAgICAgJHRoaXMtPm9mZj0kaW1nLT5sZWZ0X21hcmdpbjsKICAgICAgICAgICAgJHRoaXMtPnNjYWxlX2ZhY3RvciA9IDA7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+d29ybGRfc2l6ZSA+IDAgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+c2NhbGVfZmFjdG9yPSR0aGlzLT53b3JsZF9hYnNfc2l6ZS8oJHRoaXMtPndvcmxkX3NpemUqMS4wKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsgLy8geSBzY2FsZQogICAgICAgICAgICAkdGhpcy0+d29ybGRfYWJzX3NpemU9JGltZy0+aGVpZ2h0IC0gJGltZy0+dG9wX21hcmdpbiAtICRpbWctPmJvdHRvbV9tYXJnaW47CiAgICAgICAgICAgICR0aGlzLT5vZmY9JGltZy0+dG9wX21hcmdpbiskdGhpcy0+d29ybGRfYWJzX3NpemU7CiAgICAgICAgICAgICR0aGlzLT5zY2FsZV9mYWN0b3IgPSAwOwogICAgICAgICAgICBpZiggJHRoaXMtPndvcmxkX3NpemUgPiAwICkgewogICAgICAgICAgICAgICAgJHRoaXMtPnNjYWxlX2ZhY3Rvcj0tJHRoaXMtPndvcmxkX2Fic19zaXplLygkdGhpcy0+d29ybGRfc2l6ZSoxLjApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRzaXplID0gJHRoaXMtPndvcmxkX3NpemUgKiAkdGhpcy0+c2NhbGVfZmFjdG9yOwogICAgICAgICR0aGlzLT5zY2FsZV9hYnM9YXJyYXkoJHRoaXMtPm9mZiwkdGhpcy0+b2ZmICsgJHNpemUpOwogICAgfQoKICAgIC8vIEluaXRpYWxpemUgdGhlIGNvbnZlcnNpb24gY29uc3RhbnRzIGZvciB0aGlzIHNjYWxlCiAgICAvLyBUaGlzIHRyaWVzIHRvIHByZS1jYWxjdWxhdGUgYXMgbXVjaCBhcyBwb3NzaWJsZSB0byBzcGVlZCB1cCB0aGUKICAgIC8vIGFjdHVhbCBjb252ZXJzaW9uICh3aXRoIFRyYW5zbGF0ZSgpKSBsYXRlciBvbgogICAgLy8gJHN0YXJ0ID1zY2FsZSBzdGFydCBpbiBhYnNvbHV0ZSBwaXhlbHMgKGZvciB4LXNjYWxlIHRoaXMgaXMgYW4geS1wb3NpdGlvbgogICAgLy8gICAgIGFuZCBmb3IgYW4geS1zY2FsZSB0aGlzIGlzIGFuIHgtcG9zaXRpb24KICAgIC8vICRsZW4gICA9YWJzb2x1dGUgbGVuZ3RoIGluIHBpeGVscyBvZiBzY2FsZQogICAgZnVuY3Rpb24gU2V0Q29uc3RhbnRzKCRhU3RhcnQsJGFMZW4pIHsKICAgICAgICAkdGhpcy0+d29ybGRfYWJzX3NpemU9JGFMZW47CiAgICAgICAgJHRoaXMtPm9mZj0kYVN0YXJ0OwoKICAgICAgICBpZiggJHRoaXMtPndvcmxkX3NpemU8PTAgKSB7CiAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIG5ldmVyIGV2ZXIgaGFwcGVuICEhCiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDc0KTsKICAgICAgICAgICAgLy8oIllvdSBoYXZlIHVuZm9ydHVuYXRlbHkgc3R1bWJsZWQgdXBvbiBhIGJ1ZyBpbiBKcEdyYXBoLiBJdCBzZWVtcyBsaWtlIHRoZSBzY2FsZSByYW5nZSBpcyAiLiR0aGlzLT53b3JsZF9zaXplLiIgW2ZvciAiLiR0aGlzLT50eXBlLiIgc2NhbGVdIDxicj4gUGxlYXNlIHJlcG9ydCBCdWcgIzAxIHRvIGluZm9AanBncmFwaC5uZXQgYW5kIGluY2x1ZGUgdGhlIHNjcmlwdCB0aGF0IGdhdmUgdGhpcyBlcnJvci4gVGhpcyBwcm9ibGVtIGNvdWxkIHBvdGVudGlhbGx5IGJlIGNhdXNlZCBieSB0cnlpbmcgdG8gdXNlIFwiaWxsZWdhbFwiIHZhbHVlcyBpbiB0aGUgaW5wdXQgZGF0YSBhcnJheXMgKGxpa2UgdHJ5aW5nIHRvIHNlbmQgaW4gc3RyaW5ncyBvciBvbmx5IE5VTEwgdmFsdWVzKSB3aGljaCBjYXVzZXMgdGhlIGF1dG9zY2FsaW5nIHRvIGZhaWwuIik7CiAgICAgICAgfQoKICAgICAgICAvLyBzY2FsZV9mYWN0b3IgPSBudW1iZXIgb2YgcGl4ZWxzIHBlciB3b3JsZCB1bml0CiAgICAgICAgJHRoaXMtPnNjYWxlX2ZhY3Rvcj0kdGhpcy0+d29ybGRfYWJzX3NpemUvKCR0aGlzLT53b3JsZF9zaXplKjEuMCk7CgogICAgICAgIC8vIHNjYWxlX2FicyA9IHN0YXJ0IGFuZCBlbmQgcG9pbnRzIG9mIHNjYWxlIGluIGFic29sdXRlIHBpeGVscwogICAgICAgICR0aGlzLT5zY2FsZV9hYnM9YXJyYXkoJHRoaXMtPm9mZiwkdGhpcy0+b2ZmKyR0aGlzLT53b3JsZF9zaXplKiR0aGlzLT5zY2FsZV9mYWN0b3IpOwogICAgfQoKCiAgICAvLyBDYWxjdWxhdGUgbnVtYmVyIG9mIHRpY2tzIHN0ZXBzIHdpdGggYSBzcGVjaWZpYyBkaXZpc2lvbgogICAgLy8gJGEgaXMgdGhlIGRpdmlzb3Igb2YgMTAqKnggdG8gZ2VuZXJhdGUgdGhlIGZpcnN0IG1haiB0aWNrIGludGVydmFsbAogICAgLy8gJGE9MSwgJGI9MiBnaXZlIG1ham9yIHRpY2tzIHdpdGggbXVsdGlwbGUgb2YgMTAsIC4uLiwwLjEsMSwxMCwuLi4KICAgIC8vICRhPTUsICRiPTIgZ2l2ZSBtYWpvciB0aWNrcyB3aXRoIG11bHRpcGxlIG9mIDI6cyAuLi4sMC4yLDIsMjAsLi4uCiAgICAvLyAkYT0yLCAkYj01IGdpdmUgbWFqb3IgdGlja3Mgd2l0aCBtdWx0aXBsZSBvZiA1OnMgLi4uLDAuNSw1LDUwLC4uLgogICAgLy8gV2UgcmV0dXJuIGEgdmVjdG9yIG9mCiAgICAvLyAgWyRudW1zdGVwcywkYWRqbWluLCRhZGptYXgsJG1pbnN0ZXAsJG1hanN0ZXBdCiAgICAvLyBJZiAkbWFqZW5kPT10cnVlIHRoZW4gdGhlIGZpcnN0IGFuZCBsYXN0IG1hcmtzIG9uIHRoZSBheGlzIHdpbGwgYmUgbWFqb3IKICAgIC8vIGxhYmVsZWQgdGljayBtYXJrcyBvdGhlcndpc2UgaXQgd2lsbCBiZSBhZGp1c3RlZCB0byB0aGUgY2xvc2VzdCBtaW4gdGljayBtYXJrCiAgICBmdW5jdGlvbiBDYWxjVGlja3MoJG1heHN0ZXBzLCRtaW4sJG1heCwkYSwkYiwkbWFqZW5kPXRydWUpIHsKICAgICAgICAkZGlmZj0kbWF4LSRtaW47CiAgICAgICAgaWYoICRkaWZmPT0wICkgewogICAgICAgICAgICAkbGQ9MDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRsZD1mbG9vcihsb2cxMCgkZGlmZikpOwogICAgICAgIH0KCiAgICAgICAgLy8gR3Jhdml0YXRlIG1pbiB0b3dhcmRzIHplcm8gaWYgd2UgYXJlIGNsb3NlCiAgICAgICAgaWYoICRtaW4+MCAmJiAkbWluIDwgcG93KDEwLCRsZCkgKSAkbWluPTA7CgogICAgICAgIC8vJG1hanN0ZXA9cG93KDEwLCRsZC0xKS8kYTsKICAgICAgICAkbWFqc3RlcD1wb3coMTAsJGxkKS8kYTsKICAgICAgICAkbWluc3RlcD0kbWFqc3RlcC8kYjsKCiAgICAgICAgJGFkam1heD1jZWlsKCRtYXgvJG1pbnN0ZXApKiRtaW5zdGVwOwogICAgICAgICRhZGptaW49Zmxvb3IoJG1pbi8kbWluc3RlcCkqJG1pbnN0ZXA7CiAgICAgICAgJGFkamRpZmYgPSAkYWRqbWF4LSRhZGptaW47CiAgICAgICAgJG51bXN0ZXBzPSRhZGpkaWZmLyRtYWpzdGVwOwoKICAgICAgICB3aGlsZSggJG51bXN0ZXBzPiRtYXhzdGVwcyApIHsKICAgICAgICAgICAgJG1hanN0ZXA9cG93KDEwLCRsZCkvJGE7CiAgICAgICAgICAgICRudW1zdGVwcz0kYWRqZGlmZi8kbWFqc3RlcDsKICAgICAgICAgICAgKyskbGQ7CiAgICAgICAgfQoKICAgICAgICAkbWluc3RlcD0kbWFqc3RlcC8kYjsKICAgICAgICAkYWRqbWluPWZsb29yKCRtaW4vJG1pbnN0ZXApKiRtaW5zdGVwOwogICAgICAgICRhZGpkaWZmID0gJGFkam1heC0kYWRqbWluOwogICAgICAgIGlmKCAkbWFqZW5kICkgewogICAgICAgICAgICAkYWRqbWluID0gZmxvb3IoJG1pbi8kbWFqc3RlcCkqJG1hanN0ZXA7CiAgICAgICAgICAgICRhZGpkaWZmID0gJGFkam1heC0kYWRqbWluOwogICAgICAgICAgICAkYWRqbWF4ID0gY2VpbCgkYWRqZGlmZi8kbWFqc3RlcCkqJG1hanN0ZXArJGFkam1pbjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRhZGptYXg9Y2VpbCgkbWF4LyRtaW5zdGVwKSokbWluc3RlcDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhcnJheSgkbnVtc3RlcHMsJGFkam1pbiwkYWRqbWF4LCRtaW5zdGVwLCRtYWpzdGVwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBDYWxjVGlja3NGcmVlemUoJG1heHN0ZXBzLCRtaW4sJG1heCwkYSwkYikgewogICAgICAgIC8vIFNhbWUgYXMgQ2FsY1RpY2tzIGJ1dCBkb24ndCBhZGp1c3QgbWluL21heCB2YWx1ZXMKICAgICAgICAkZGlmZj0kbWF4LSRtaW47CiAgICAgICAgaWYoICRkaWZmPT0wICkgewogICAgICAgICAgICAkbGQ9MDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRsZD1mbG9vcihsb2cxMCgkZGlmZikpOwogICAgICAgIH0KCiAgICAgICAgLy8kbWFqc3RlcD1wb3coMTAsJGxkLTEpLyRhOwogICAgICAgICRtYWpzdGVwPXBvdygxMCwkbGQpLyRhOwogICAgICAgICRtaW5zdGVwPSRtYWpzdGVwLyRiOwogICAgICAgICRudW1zdGVwcz1mbG9vcigkZGlmZi8kbWFqc3RlcCk7CgogICAgICAgIHdoaWxlKCAkbnVtc3RlcHMgPiAkbWF4c3RlcHMgKSB7CiAgICAgICAgICAgICRtYWpzdGVwPXBvdygxMCwkbGQpLyRhOwogICAgICAgICAgICAkbnVtc3RlcHM9Zmxvb3IoJGRpZmYvJG1hanN0ZXApOwogICAgICAgICAgICArKyRsZDsKICAgICAgICB9CiAgICAgICAgJG1pbnN0ZXA9JG1hanN0ZXAvJGI7CiAgICAgICAgcmV0dXJuIGFycmF5KCRudW1zdGVwcywkbWluc3RlcCwkbWFqc3RlcCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIEludENhbGNUaWNrcygkbWF4c3RlcHMsJG1pbiwkbWF4LCRhLCRtYWplbmQ9dHJ1ZSkgewogICAgICAgICRkaWZmPSRtYXgtJG1pbjsKICAgICAgICBpZiggJGRpZmY9PTAgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MDc1KTsvLygnQ2FuXCd0IGF1dG9tYXRpY2FsbHkgZGV0ZXJtaW5lIHRpY2tzIHNpbmNlIG1pbj09bWF4LicpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJGxkPWZsb29yKGxvZzEwKCRkaWZmKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBHcmF2aXRhdGUgbWluIHRvd2FyZHMgemVybyBpZiB3ZSBhcmUgY2xvc2UKICAgICAgICBpZiggJG1pbj4wICYmICRtaW4gPCBwb3coMTAsJGxkKSApIHsKICAgICAgICAgICAgJG1pbj0wOwogICAgICAgIH0KICAgICAgICBpZiggJGxkID09IDAgKSB7CiAgICAgICAgICAgICRsZD0xOwogICAgICAgIH0KICAgICAgICBpZiggJGEgPT0gMSApIHsKICAgICAgICAgICAgJG1hanN0ZXAgPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJG1hanN0ZXA9cG93KDEwLCRsZCkvJGE7CiAgICAgICAgfQogICAgICAgICRhZGptYXg9Y2VpbCgkbWF4LyRtYWpzdGVwKSokbWFqc3RlcDsKCiAgICAgICAgJGFkam1pbj1mbG9vcigkbWluLyRtYWpzdGVwKSokbWFqc3RlcDsKICAgICAgICAkYWRqZGlmZiA9ICRhZGptYXgtJGFkam1pbjsKICAgICAgICAkbnVtc3RlcHM9JGFkamRpZmYvJG1hanN0ZXA7CiAgICAgICAgd2hpbGUoICRudW1zdGVwcz4kbWF4c3RlcHMgKSB7CiAgICAgICAgICAgICRtYWpzdGVwPXBvdygxMCwkbGQpLyRhOwogICAgICAgICAgICAkbnVtc3RlcHM9JGFkamRpZmYvJG1hanN0ZXA7CiAgICAgICAgICAgICsrJGxkOwogICAgICAgIH0KCiAgICAgICAgJGFkam1pbj1mbG9vcigkbWluLyRtYWpzdGVwKSokbWFqc3RlcDsKICAgICAgICAkYWRqZGlmZiA9ICRhZGptYXgtJGFkam1pbjsKICAgICAgICBpZiggJG1hamVuZCApIHsKICAgICAgICAgICAgJGFkam1pbiA9IGZsb29yKCRtaW4vJG1hanN0ZXApKiRtYWpzdGVwOwogICAgICAgICAgICAkYWRqZGlmZiA9ICRhZGptYXgtJGFkam1pbjsKICAgICAgICAgICAgJGFkam1heCA9IGNlaWwoJGFkamRpZmYvJG1hanN0ZXApKiRtYWpzdGVwKyRhZGptaW47CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkYWRqbWF4PWNlaWwoJG1heC8kbWFqc3RlcCkqJG1hanN0ZXA7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXJyYXkoJG51bXN0ZXBzLCRhZGptaW4sJGFkam1heCwkbWFqc3RlcCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIEludENhbGNUaWNrc0ZyZWV6ZSgkbWF4c3RlcHMsJG1pbiwkbWF4LCRhKSB7CiAgICAgICAgLy8gU2FtZSBhcyBJbnRDYWxjVGljayBidXQgZG9uJ3QgY2hhbmdlIG1pbi9tYXggdmFsdWVzCiAgICAgICAgJGRpZmY9JG1heC0kbWluOwogICAgICAgIGlmKCAkZGlmZj09MCApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNzUpOy8vKCdDYW5cJ3QgYXV0b21hdGljYWxseSBkZXRlcm1pbmUgdGlja3Mgc2luY2UgbWluPT1tYXguJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkbGQ9Zmxvb3IobG9nMTAoJGRpZmYpKTsKICAgICAgICB9CiAgICAgICAgaWYoICRsZCA9PSAwICkgewogICAgICAgICAgICAkbGQ9MTsKICAgICAgICB9CiAgICAgICAgaWYoICRhID09IDEgKSB7CiAgICAgICAgICAgICRtYWpzdGVwID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRtYWpzdGVwPXBvdygxMCwkbGQpLyRhOwogICAgICAgIH0KCiAgICAgICAgJG51bXN0ZXBzPWZsb29yKCRkaWZmLyRtYWpzdGVwKTsKICAgICAgICB3aGlsZSggJG51bXN0ZXBzID4gJG1heHN0ZXBzICkgewogICAgICAgICAgICAkbWFqc3RlcD1wb3coMTAsJGxkKS8kYTsKICAgICAgICAgICAgJG51bXN0ZXBzPWZsb29yKCRkaWZmLyRtYWpzdGVwKTsKICAgICAgICAgICAgKyskbGQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXJyYXkoJG51bXN0ZXBzLCRtYWpzdGVwKTsKICAgIH0KCiAgICAvLyBEZXRlcm1pbmUgdGhlIG1pbmltdW0gb2YgdGhyZWUgdmFsdWVzIHdpdGhhICB3ZWlnaHQgZm9yIGxhc3QgdmFsdWUKICAgIGZ1bmN0aW9uIE1hdGNoTWluMygkYSwkYiwkYywkd2VpZ2h0KSB7CiAgICAgICAgaWYoICRhIDwgJGIgKSB7CiAgICAgICAgICAgIGlmKCAkYSA8ICgkYyokd2VpZ2h0KSApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxOyAvLyAkYSBzbWFsbGVzdAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDM7IC8vICRjIHNtYWxsZXN0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAkYiA8ICgkYyokd2VpZ2h0KSApIHsKICAgICAgICAgICAgcmV0dXJuIDI7IC8vICRiIHNtYWxsZXN0CiAgICAgICAgfQogICAgICAgIHJldHVybiAzOyAvLyAkYyBzbWFsbGVzdAogICAgfQoKICAgIGZ1bmN0aW9uIF9fZ2V0KCRuYW1lKSB7CiAgICAgICAgJHZhcmlhYmxlX25hbWUgPSAnXycgLiAkbmFtZTsgCgogICAgICAgIGlmIChpc3NldCgkdGhpcy0+JHZhcmlhYmxlX25hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+JHZhcmlhYmxlX25hbWUgKiBTVVBFUlNBTVBMSU5HX1NDQUxFOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKCcyNTEzMicsICRuYW1lKTsKICAgICAgICB9IAogICAgfQoKICAgIGZ1bmN0aW9uIF9fc2V0KCRuYW1lLCAkdmFsdWUpIHsKICAgICAgICAkdGhpcy0+eydfJy4kbmFtZX0gPSAkdmFsdWU7CiAgICB9Cn0gLy8gQ2xhc3MKCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBEaXNwbGF5VmFsdWUKLy8gRGVzY3JpcHRpb246IFVzZWQgdG8gcHJpbnQgZGF0YSB2YWx1ZXMgYXQgZGF0YSBwb2ludHMKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgRGlzcGxheVZhbHVlIHsKICAgIHB1YmxpYyAkbWFyZ2luPTU7CiAgICBwdWJsaWMgJHNob3c9ZmFsc2U7CiAgICBwdWJsaWMgJHZhbGlnbj0nJywkaGFsaWduPSdjZW50ZXInOwogICAgcHVibGljICRmb3JtYXQ9JyUuMWYnLCRuZWdmb3JtYXQ9Jyc7CiAgICBwcml2YXRlICRmZj1GRl9ERUZBVUxULCRmcz1GU19OT1JNQUwsJGZzaXplPTg7CiAgICBwcml2YXRlICRpRm9ybUNhbGxiYWNrPScnOwogICAgcHJpdmF0ZSAkYW5nbGU9MDsKICAgIHByaXZhdGUgJGNvbG9yPSduYXZ5JywkbmVnY29sb3I9Jyc7CiAgICBwcml2YXRlICRpSGlkZVplcm89ZmFsc2U7CiAgICBwdWJsaWMgJHR4dD1udWxsOwoKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkgewogICAgICAgICAgICAgICAgJHRoaXMtPnR4dCA9IG5ldyBUZXh0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gU2hvdygkYUZsYWc9dHJ1ZSkgewogICAgICAgICR0aGlzLT5zaG93PSRhRmxhZzsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDb2xvcigkYUNvbG9yLCRhTmVnY29sb3I9JycpIHsKICAgICAgICAkdGhpcy0+Y29sb3IgPSAkYUNvbG9yOwogICAgICAgICR0aGlzLT5uZWdjb2xvciA9ICRhTmVnY29sb3I7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Rm9udCgkYUZvbnRGYW1pbHksJGFGb250U3R5bGU9RlNfTk9STUFMLCRhRm9udFNpemU9OCkgewogICAgICAgICR0aGlzLT5mZj0kYUZvbnRGYW1pbHk7CiAgICAgICAgJHRoaXMtPmZzPSRhRm9udFN0eWxlOwogICAgICAgICR0aGlzLT5mc2l6ZT0kYUZvbnRTaXplOwogICAgfQoKICAgIGZ1bmN0aW9uIEFwcGx5Rm9udCgkYUltZykgewogICAgICAgICRhSW1nLT5TZXRGb250KCR0aGlzLT5mZiwkdGhpcy0+ZnMsJHRoaXMtPmZzaXplKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRNYXJnaW4oJGFNYXJnaW4pIHsKICAgICAgICAkdGhpcy0+bWFyZ2luID0gJGFNYXJnaW47CiAgICB9CgogICAgZnVuY3Rpb24gU2V0QW5nbGUoJGFBbmdsZSkgewogICAgICAgICR0aGlzLT5hbmdsZSA9ICRhQW5nbGU7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0QWxpZ24oJGFIQWxpZ24sJGFWQWxpZ249JycpIHsKICAgICAgICAkdGhpcy0+aGFsaWduID0gJGFIQWxpZ247CiAgICAgICAgJHRoaXMtPnZhbGlnbiA9ICRhVkFsaWduOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEZvcm1hdCgkYUZvcm1hdCwkYU5lZ0Zvcm1hdD0nJykgewogICAgICAgICR0aGlzLT5mb3JtYXQ9ICRhRm9ybWF0OwogICAgICAgICR0aGlzLT5uZWdmb3JtYXQ9ICRhTmVnRm9ybWF0OwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEZvcm1hdENhbGxiYWNrKCRhRnVuYykgewogICAgICAgICR0aGlzLT5pRm9ybUNhbGxiYWNrID0gJGFGdW5jOwogICAgfQoKICAgIGZ1bmN0aW9uIEhpZGVaZXJvKCRhRmxhZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmlIaWRlWmVybz0kYUZsYWc7CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlKCRpbWcsJGFWYWwsJHgsJHkpIHsKCiAgICAgICAgaWYoICR0aGlzLT5zaG93ICkKICAgICAgICB7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+bmVnZm9ybWF0PT0nJyApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5uZWdmb3JtYXQ9JHRoaXMtPmZvcm1hdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggJHRoaXMtPm5lZ2NvbG9yPT0nJyApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5uZWdjb2xvcj0kdGhpcy0+Y29sb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCAkYVZhbD09PU5VTEwgfHwgKGlzX3N0cmluZygkYVZhbCkgJiYgKCRhVmFsPT0nJyB8fCAkYVZhbD09Jy0nIHx8ICRhVmFsPT0neCcgKSApICkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiggaXNfbnVtZXJpYygkYVZhbCkgJiYgJGFWYWw9PTAgJiYgJHRoaXMtPmlIaWRlWmVybyApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU2luY2UgdGhlIHZhbHVlIGlzIHVzZWQgaW4gZGlmZmVyZW50IGNpcnVtc3RhbmNlcyB3ZSBuZWVkIHRvIGNoZWNrIHdoYXQKICAgICAgICAgICAgLy8ga2luZCBvZiBmb3JtYXR0aW5nIHdlIHNoYWxsIHVzZS4gRm9yIGV4YW1wbGUsIHRvIGRpc3BsYXkgdmFsdWVzIGluIGEgbGluZQogICAgICAgICAgICAvLyBncmFwaCB3ZSBzaW1wbHkgZGlzcGxheSB0aGUgZm9ybWF0dGVkIHZhbHVlLCBidXQgaW4gdGhlIGNhc2Ugd2hlcmUgdGhlIHVzZXIKICAgICAgICAgICAgLy8gaGFzIGFscmVhZHkgc3BlY2lmaWVkIGEgdGV4dCBzdHJpbmcgd2UgZG9uJ3QgZm8gYW55dGhpbmcuCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aUZvcm1DYWxsYmFjayAhPSAnJyApIHsKICAgICAgICAgICAgICAgICRmID0gJHRoaXMtPmlGb3JtQ2FsbGJhY2s7CiAgICAgICAgICAgICAgICAkc3ZhbCA9IGNhbGxfdXNlcl9mdW5jKCRmLCRhVmFsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoIGlzX251bWVyaWMoJGFWYWwpICkgewogICAgICAgICAgICAgICAgaWYoICRhVmFsID49IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgJHN2YWw9c3ByaW50ZigkdGhpcy0+Zm9ybWF0LCRhVmFsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRzdmFsPXNwcmludGYoJHRoaXMtPm5lZ2Zvcm1hdCwkYVZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkc3ZhbD0kYVZhbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHkgPSAkeS1zaWduKCRhVmFsKSokdGhpcy0+bWFyZ2luOwoKICAgICAgICAgICAgJHRoaXMtPnR4dC0+U2V0KCRzdmFsKTsKICAgICAgICAgICAgJHRoaXMtPnR4dC0+U2V0UG9zKCR4LCR5KTsKICAgICAgICAgICAgJHRoaXMtPnR4dC0+U2V0Rm9udCgkdGhpcy0+ZmYsJHRoaXMtPmZzLCR0aGlzLT5mc2l6ZSk7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+dmFsaWduID09ICcnICkgewogICAgICAgICAgICAgICAgaWYoICRhVmFsID49IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgJHZhbGlnbiA9ICJib3R0b20iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHZhbGlnbiA9ICJ0b3AiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHZhbGlnbiA9ICR0aGlzLT52YWxpZ247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPnR4dC0+QWxpZ24oJHRoaXMtPmhhbGlnbiwkdmFsaWduKTsKCiAgICAgICAgICAgICR0aGlzLT50eHQtPlNldE9yaWVudGF0aW9uKCR0aGlzLT5hbmdsZSk7CiAgICAgICAgICAgIGlmKCAkYVZhbCA+IDAgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+dHh0LT5TZXRDb2xvcigkdGhpcy0+Y29sb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHRoaXMtPnR4dC0+U2V0Q29sb3IoJHRoaXMtPm5lZ2NvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+dHh0LT5TdHJva2UoJGltZyk7CiAgICAgICAgfQogICAgfQp9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBQbG90Ci8vIERlc2NyaXB0aW9uOiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBhbGwgY29uY3JldGUgcGxvdCBjbGFzc2VzCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIFBsb3QgewogICAgcHVibGljICRudW1wb2ludHM9MDsKICAgIHB1YmxpYyAkdmFsdWU7CiAgICBwdWJsaWMgJGxlZ2VuZD0nJzsKICAgIHB1YmxpYyAkY29vcmRzPWFycmF5KCk7CiAgICBwdWJsaWMgJGNvbG9yPSdibGFjayc7CiAgICBwdWJsaWMgJGhpZGVsZWdlbmQ9ZmFsc2U7CiAgICBwdWJsaWMgJGxpbmVfd2VpZ2h0PTE7CiAgICBwdWJsaWMgJGNzaW10YXJnZXRzPWFycmF5KCksJGNzaW13aW50YXJnZXRzPWFycmF5KCk7IC8vIEFycmF5IG9mIHRhcmdldHMgZm9yIENTSU0KICAgIHB1YmxpYyAkY3NpbWFyZWFzPScnOyAgIC8vIFJlc3VsdGFudCBDU0lNIGFyZWEgdGFncwogICAgcHVibGljICRjc2ltYWx0cz1udWxsOyAgIC8vIEFMVDpzIGZvciBjb3JyZXNwb25kaW5nIHRhcmdldAogICAgcHVibGljICRsZWdlbmRjc2ltdGFyZ2V0PScnLCRsZWdlbmRjc2ltd2ludGFyZ2V0PScnOwogICAgcHVibGljICRsZWdlbmRjc2ltYWx0PScnOwogICAgcHJvdGVjdGVkICR3ZWlnaHQ9MTsKICAgIHByb3RlY3RlZCAkY2VudGVyPWZhbHNlOwoKICAgIHByb3RlY3RlZCAkaW5wdXRWYWx1ZXM7CiAgICBwcm90ZWN0ZWQgJGlzUnVubmluZ0NsZWFyID0gZmFsc2U7CgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGFEYXRheSwkYURhdGF4PWZhbHNlKSB7CiAgICAgICAgJHRoaXMtPm51bXBvaW50cyA9IGNvdW50KCRhRGF0YXkpOwogICAgICAgIGlmKCAkdGhpcy0+bnVtcG9pbnRzPT0wICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyNTEyMSk7Ly8oIkVtcHR5IGlucHV0IGRhdGEgYXJyYXkgc3BlY2lmaWVkIGZvciBwbG90LiBNdXN0IGhhdmUgYXQgbGVhc3Qgb25lIGRhdGEgcG9pbnQuIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoISR0aGlzLT5pc1J1bm5pbmdDbGVhcikgewogICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXMgPSBhcnJheSgpOwogICAgICAgICAgICAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FEYXRheSddID0gJGFEYXRheTsKICAgICAgICAgICAgJHRoaXMtPmlucHV0VmFsdWVzWydhRGF0YXgnXSA9ICRhRGF0YXg7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+Y29vcmRzWzBdPSRhRGF0YXk7CiAgICAgICAgaWYoIGlzX2FycmF5KCRhRGF0YXgpICkgewogICAgICAgICAgICAkdGhpcy0+Y29vcmRzWzFdPSRhRGF0YXg7CiAgICAgICAgICAgICRuID0gY291bnQoJGFEYXRheCk7CiAgICAgICAgICAgIGZvciggJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgICAgIGlmKCAhaXNfbnVtZXJpYygkYURhdGF4WyRpXSkgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUwNzApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT52YWx1ZSA9IG5ldyBEaXNwbGF5VmFsdWUoKTsKICAgIH0KCiAgICAvLyBTdHJva2UgdGhlIHBsb3QKICAgIC8vICJ2aXJ0dWFsIiBmdW5jdGlvbiB3aGljaCBtdXN0IGJlIGltcGxlbWVudGVkIGJ5CiAgICAvLyB0aGUgc3ViY2xhc3NlcwogICAgZnVuY3Rpb24gU3Ryb2tlKCRhSW1nLCRhWFNjYWxlLCRhWVNjYWxlKSB7CiAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjUxMjIpOy8vKCJKcEdyYXBoOiBTdHJva2UoKSBtdXN0IGJlIGltcGxlbWVudGVkIGJ5IGNvbmNyZXRlIHN1YmNsYXNzIHRvIGNsYXNzIFBsb3QiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBIaWRlTGVnZW5kKCRmPXRydWUpIHsKICAgICAgICAkdGhpcy0+aGlkZWxlZ2VuZCA9ICRmOwogICAgfQoKICAgIGZ1bmN0aW9uIERvTGVnZW5kKCRncmFwaCkgewogICAgICAgIGlmKCAhJHRoaXMtPmhpZGVsZWdlbmQgKQogICAgICAgICR0aGlzLT5MZWdlbmQoJGdyYXBoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2VEYXRhVmFsdWUoJGltZywkYVZhbCwkeCwkeSkgewogICAgICAgICR0aGlzLT52YWx1ZS0+U3Ryb2tlKCRpbWcsJGFWYWwsJHgsJHkpOwogICAgfQoKICAgIC8vIFNldCBocmVmIHRhcmdldHMgZm9yIENTSU0KICAgIGZ1bmN0aW9uIFNldENTSU1UYXJnZXRzKCRhVGFyZ2V0cywkYUFsdHM9JycsJGFXaW5UYXJnZXRzPScnKSB7CiAgICAgICAgJHRoaXMtPmNzaW10YXJnZXRzPSRhVGFyZ2V0czsKICAgICAgICAkdGhpcy0+Y3NpbXdpbnRhcmdldHM9JGFXaW5UYXJnZXRzOwogICAgICAgICR0aGlzLT5jc2ltYWx0cz0kYUFsdHM7CiAgICB9CgogICAgLy8gR2V0IGFsbCBjcmVhdGVkIGFyZWFzCiAgICBmdW5jdGlvbiBHZXRDU0lNYXJlYXMoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jc2ltYXJlYXM7CiAgICB9CgogICAgLy8gIlZpcnR1YWwiIGZ1bmN0aW9uIHdoaWNoIGdldHMgY2FsbGVkIGJlZm9yZSBhbnkgc2NhbGUKICAgIC8vIG9yIGF4aXMgYXJlIHN0cm9rZWQgdXNlZCB0byBkbyBhbnkgcGxvdCBzcGVjaWZpYyBhZGp1c3RtZW50CiAgICBmdW5jdGlvbiBQcmVTdHJva2VBZGp1c3QoJGFHcmFwaCkgewogICAgICAgIGlmKCBzdWJzdHIoJGFHcmFwaC0+YXh0eXBlLDAsNCkgPT0gInRleHQiICYmIChpc3NldCgkdGhpcy0+Y29vcmRzWzFdKSkgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDI1MTIzKTsvLygiSnBHcmFwaDogWW91IGNhbid0IHVzZSBhIHRleHQgWC1zY2FsZSB3aXRoIHNwZWNpZmllZCBYLWNvb3Jkcy4gVXNlIGEgXCJpbnRcIiBvciBcImxpblwiIHNjYWxlIGluc3RlYWQuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFZpcnR1YWwgZnVuY3Rpb24gdG8gdGhlIHRoZSBjb25jcmV0ZSBwbG90IGNsYXNzIHRvIG1ha2UgYW55IGNoYW5nZXMgdG8gdGhlIGdyYXBoCiAgICAvLyBhbmQgc2NhbGUgYmVmb3JlIHRoZSBzdHJva2UgcHJvY2VzcyBiZWdpbnMKICAgIGZ1bmN0aW9uIFByZVNjYWxlU2V0dXAoJGFHcmFwaCkgewogICAgICAgIC8vIEVtcHR5CiAgICB9CgogICAgLy8gR2V0IG1pbmltdW0gdmFsdWVzIGluIHBsb3QKICAgIGZ1bmN0aW9uIE1pbigpIHsKICAgICAgICBpZiggaXNzZXQoJHRoaXMtPmNvb3Jkc1sxXSkgKSB7CiAgICAgICAgICAgICR4PSR0aGlzLT5jb29yZHNbMV07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkeD0nJzsKICAgICAgICB9CiAgICAgICAgaWYoICR4ICE9ICcnICYmIGNvdW50KCR4KSA+IDAgKSB7CiAgICAgICAgICAgICR4bT1taW4oJHgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHhtPTA7CiAgICAgICAgfQogICAgICAgICR5PSR0aGlzLT5jb29yZHNbMF07CiAgICAgICAgJGNudCA9IGNvdW50KCR5KTsKICAgICAgICBpZiggJGNudCA+IDAgKSB7CiAgICAgICAgICAgICRpPTA7CiAgICAgICAgICAgIHdoaWxlKCAkaTwkY250ICYmICFpc19udW1lcmljKCR5bT0keVskaV0pICkgewogICAgICAgICAgICAgICAgJGkrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSggJGkgPCAkY250KSB7CiAgICAgICAgICAgICAgICBpZiggaXNfbnVtZXJpYygkeVskaV0pICkgewogICAgICAgICAgICAgICAgICAgICR5bT1taW4oJHltLCR5WyRpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICArKyRpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkeW09Jyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheSgkeG0sJHltKTsKICAgIH0KCiAgICAvLyBHZXQgbWF4aW11bSB2YWx1ZSBpbiBwbG90CiAgICBmdW5jdGlvbiBNYXgoKSB7CiAgICAgICAgaWYoIGlzc2V0KCR0aGlzLT5jb29yZHNbMV0pICkgewogICAgICAgICAgICAkeD0kdGhpcy0+Y29vcmRzWzFdOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHg9Jyc7CiAgICAgICAgfQoKICAgICAgICBpZiggJHghPScnICYmIGNvdW50KCR4KSA+IDAgKSB7CiAgICAgICAgICAgICR4bT1tYXgoJHgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHhtID0gJHRoaXMtPm51bXBvaW50cy0xOwogICAgICAgIH0KICAgICAgICAkeT0kdGhpcy0+Y29vcmRzWzBdOwogICAgICAgIGlmKCBjb3VudCgkeSkgPiAwICkgewogICAgICAgICAgICAkY250ID0gY291bnQoJHkpOwogICAgICAgICAgICAkaT0wOwogICAgICAgICAgICB3aGlsZSggJGk8JGNudCAmJiAhaXNfbnVtZXJpYygkeW09JHlbJGldKSApIHsKICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUoICRpIDwgJGNudCApIHsKICAgICAgICAgICAgICAgIGlmKCBpc19udW1lcmljKCR5WyRpXSkgKSB7CiAgICAgICAgICAgICAgICAgICAgJHltPW1heCgkeW0sJHlbJGldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICsrJGk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR5bT0nJzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFycmF5KCR4bSwkeW0pOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENvbG9yKCRhQ29sb3IpIHsKICAgICAgICAkdGhpcy0+Y29sb3I9JGFDb2xvcjsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMZWdlbmQoJGFMZWdlbmQsJGFDU0lNPScnLCRhQ1NJTUFsdD0nJywkYUNTSU1XaW5UYXJnZXQ9JycpIHsKICAgICAgICAkdGhpcy0+bGVnZW5kID0gJGFMZWdlbmQ7CiAgICAgICAgJHRoaXMtPmxlZ2VuZGNzaW10YXJnZXQgPSAkYUNTSU07CiAgICAgICAgJHRoaXMtPmxlZ2VuZGNzaW13aW50YXJnZXQgPSAkYUNTSU1XaW5UYXJnZXQ7CiAgICAgICAgJHRoaXMtPmxlZ2VuZGNzaW1hbHQgPSAkYUNTSU1BbHQ7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0V2VpZ2h0KCRhV2VpZ2h0KSB7CiAgICAgICAgJHRoaXMtPndlaWdodD0kYVdlaWdodDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMaW5lV2VpZ2h0KCRhV2VpZ2h0PTEpIHsKICAgICAgICAkdGhpcy0+bGluZV93ZWlnaHQ9JGFXZWlnaHQ7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Q2VudGVyKCRhQ2VudGVyPXRydWUpIHsKICAgICAgICAkdGhpcy0+Y2VudGVyID0gJGFDZW50ZXI7CiAgICB9CgogICAgLy8gVGhpcyBtZXRob2QgZ2V0cyBjYWxsZWQgYnkgR3JhcGggY2xhc3MgdG8gcGxvdCBhbnl0aGluZyB0aGF0IHNob3VsZCBnbwogICAgLy8gaW50byB0aGUgbWFyZ2luIGFmdGVyIHRoZSBtYXJnaW4gY29sb3IgaGFzIGJlZW4gc2V0LgogICAgZnVuY3Rpb24gU3Ryb2tlTWFyZ2luKCRhSW1nKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gRnJhbWV3b3JrIGZ1bmN0aW9uIHRoZSBjaGFuY2UgZm9yIGVhY2ggcGxvdCBjbGFzcyB0byBzZXQgYSBsZWdlbmQKICAgIGZ1bmN0aW9uIExlZ2VuZCgkYUdyYXBoKSB7CiAgICAgICAgaWYoICR0aGlzLT5sZWdlbmQgIT0gJycgKSB7CiAgICAgICAgICAgICRhR3JhcGgtPmxlZ2VuZC0+QWRkKCR0aGlzLT5sZWdlbmQsJHRoaXMtPmNvbG9yLCcnLDAsJHRoaXMtPmxlZ2VuZGNzaW10YXJnZXQsJHRoaXMtPmxlZ2VuZGNzaW1hbHQsJHRoaXMtPmxlZ2VuZGNzaW13aW50YXJnZXQpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBDbGVhcigpIHsKICAgICAgICAkdGhpcy0+aXNSdW5uaW5nQ2xlYXIgPSB0cnVlOwogICAgICAgICR0aGlzLT5fX2NvbnN0cnVjdCgkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FEYXRheSddLCAkdGhpcy0+aW5wdXRWYWx1ZXNbJ2FEYXRheCddKTsKICAgICAgICAkdGhpcy0+aXNSdW5uaW5nQ2xlYXIgPSBmYWxzZTsKICAgIH0KCn0gLy8gQ2xhc3MKCgovLyBQcm92aWRlIGEgZGV0ZXJtaW5pc3RpYyBsaXN0IG9mIG5ldyBjb2xvcnMgd2hlbmV2ZXIgdGhlIGdldENvbG9yKCkgbWV0aG9kCi8vIGlzIGNhbGxlZC4gVXNlZCB0byBhdXRvbWF0aWNhbGx5IHNldCBjb2xvcnMgb2YgcGxvdHMuCmNsYXNzIENvbG9yRmFjdG9yeSB7CgogICAgc3RhdGljIHByaXZhdGUgJGlJZHggPSAwOwogICAgc3RhdGljIHByaXZhdGUgJGlDb2xvckxpc3QgPSBhcnJheSgKICAgICAgICAnYmxhY2snLAogICAgICAgICdibHVlJywKICAgICAgICAnb3JhbmdlJywKICAgICAgICAnZGFya2dyZWVuJywKICAgICAgICAncmVkJywKICAgICAgICAnQW50aXF1ZVdoaXRlMycsCiAgICAgICAgJ2FxdWFtYXJpbmUzJywKICAgICAgICAnYXp1cmU0JywKICAgICAgICAnYnJvd24nLAogICAgICAgICdjYWRldGJsdWUzJywKICAgICAgICAnY2hhcnRyZXVzZTQnLAogICAgICAgICdjaG9jb2xhdGUnLAogICAgICAgICdkYXJrYmx1ZScsCiAgICAgICAgJ2Rhcmtnb2xkZW5yb2QzJywKICAgICAgICAnZGFya29yY2hpZDMnLAogICAgICAgICdkYXJrc2FsbW9uJywKICAgICAgICAnZGFya3NlYWdyZWVuNCcsCiAgICAgICAgJ2RlZXBza3libHVlMicsCiAgICAgICAgJ2RvZGdlcmJsdWU0JywKICAgICAgICAnZ29sZDMnLAogICAgICAgICdob3RwaW5rJywKICAgICAgICAnbGF3bmdyZWVuJywKICAgICAgICAnbGlnaHRjb3JhbCcsCiAgICAgICAgJ2xpZ2h0cGluazMnLAogICAgICAgICdsaWdodHNlYWdyZWVuJywKICAgICAgICAnbGlnaHRzbGF0ZWJsdWUnLAogICAgICAgICdtZWRpdW1wdXJwbGUnLAogICAgICAgICdvbGl2ZWRyYWInLAogICAgICAgICdvcmFuZ2VyZWQxJywKICAgICAgICAncGVydScsCiAgICAgICAgJ3NsYXRlZ3JheScsCiAgICAgICAgJ3llbGxvdzQnLAogICAgICAgICdzcHJpbmdncmVlbjInKTsKICAgIHN0YXRpYyBwcml2YXRlICRpTnVtID0gMzM7CgogICAgc3RhdGljIGZ1bmN0aW9uIGdldENvbG9yKCkgewogICAgICAgIGlmKCBDb2xvckZhY3Rvcnk6OiRpSWR4ID49IENvbG9yRmFjdG9yeTo6JGlOdW0gKQogICAgICAgICAgICBDb2xvckZhY3Rvcnk6OiRpSWR4ID0gMDsKICAgICAgICByZXR1cm4gQ29sb3JGYWN0b3J5OjokaUNvbG9yTGlzdFtDb2xvckZhY3Rvcnk6OiRpSWR4KytdOwogICAgfQoKfQoKLy8gPEVPRj4KPz4K",
    "size": "204582"
}