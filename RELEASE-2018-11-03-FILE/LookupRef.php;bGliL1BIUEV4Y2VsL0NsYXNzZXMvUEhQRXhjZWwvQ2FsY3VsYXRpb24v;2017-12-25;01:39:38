{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Calculation\/LookupRef.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KICAgIGRlZmluZSgnUEhQRVhDRUxfUk9PVCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8uLi8uLi8nKTsKICAgIHJlcXVpcmUoUEhQRVhDRUxfUk9PVCAuICdQSFBFeGNlbC9BdXRvbG9hZGVyLnBocCcpOwp9CgovKioKICogUEhQRXhjZWxfQ2FsY3VsYXRpb25fTG9va3VwUmVmCiAqCiAqIENvcHlyaWdodCAoYykgMjAwNiAtIDIwMTUgUEhQRXhjZWwKICoKICogVGhpcyBsaWJyYXJ5IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vcgogKiBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlcgogKiB2ZXJzaW9uIDIuMSBvZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KICoKICogVGhpcyBsaWJyYXJ5IGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBHTlUKICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KICoKICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3YXJlCiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgMDIxMTAtMTMwMSBVU0EKICoKICogQGNhdGVnb3J5ICAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgICAgICBQSFBFeGNlbF9DYWxjdWxhdGlvbgogKiBAY29weXJpZ2h0ICAgIENvcHlyaWdodCAoYykgMjAwNiAtIDIwMTUgUEhQRXhjZWwgKGh0dHA6Ly93d3cuY29kZXBsZXguY29tL1BIUEV4Y2VsKQogKiBAbGljZW5zZSAgICAgICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL29sZC1saWNlbnNlcy9sZ3BsLTIuMS50eHQgICAgTEdQTAogKiBAdmVyc2lvbiAgICAgICAgIyNWRVJTSU9OIyMsICMjREFURSMjCiAqLwpjbGFzcyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9Mb29rdXBSZWYKewogICAgLyoqCiAgICAgKiBDRUxMX0FERFJFU1MKICAgICAqCiAgICAgKiBDcmVhdGVzIGEgY2VsbCBhZGRyZXNzIGFzIHRleHQsIGdpdmVuIHNwZWNpZmllZCByb3cgYW5kIGNvbHVtbiBudW1iZXJzLgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgID1BRERSRVNTKHJvdywgY29sdW1uLCBbcmVsYXRpdml0eV0sIFtyZWZlcmVuY2VTdHlsZV0sIFtzaGVldFRleHRdKQogICAgICoKICAgICAqIEBwYXJhbSAgICByb3cgICAgICAgICAgICAgICAgUm93IG51bWJlciB0byB1c2UgaW4gdGhlIGNlbGwgcmVmZXJlbmNlCiAgICAgKiBAcGFyYW0gICAgY29sdW1uICAgICAgICAgICAgQ29sdW1uIG51bWJlciB0byB1c2UgaW4gdGhlIGNlbGwgcmVmZXJlbmNlCiAgICAgKiBAcGFyYW0gICAgcmVsYXRpdml0eSAgICAgICAgRmxhZyBpbmRpY2F0aW5nIHRoZSB0eXBlIG9mIHJlZmVyZW5jZSB0byByZXR1cm4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxIG9yIG9taXR0ZWQgICAgQWJzb2x1dGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAyICAgICAgICAgICAgICAgIEFic29sdXRlIHJvdzsgcmVsYXRpdmUgY29sdW1uCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMyAgICAgICAgICAgICAgICBSZWxhdGl2ZSByb3c7IGFic29sdXRlIGNvbHVtbgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQgICAgICAgICAgICAgICAgUmVsYXRpdmUKICAgICAqIEBwYXJhbSAgICByZWZlcmVuY2VTdHlsZSAgICBBIGxvZ2ljYWwgdmFsdWUgdGhhdCBzcGVjaWZpZXMgdGhlIEExIG9yIFIxQzEgcmVmZXJlbmNlIHN0eWxlLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRSVUUgb3Igb21pdHRlZCAgICAgICAgQ0VMTF9BRERSRVNTIHJldHVybnMgYW4gQTEtc3R5bGUgcmVmZXJlbmNlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRkFMU0UgICAgICAgICAgICAgICAgQ0VMTF9BRERSRVNTIHJldHVybnMgYW4gUjFDMS1zdHlsZSByZWZlcmVuY2UKICAgICAqIEBwYXJhbSAgICBzaGVldFRleHQgICAgICAgIE9wdGlvbmFsIE5hbWUgb2Ygd29ya3NoZWV0IHRvIHVzZQogICAgICogQHJldHVybiAgICBzdHJpbmcKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBDRUxMX0FERFJFU1MoJHJvdywgJGNvbHVtbiwgJHJlbGF0aXZpdHkgPSAxLCAkcmVmZXJlbmNlU3R5bGUgPSB0cnVlLCAkc2hlZXRUZXh0ID0gJycpCiAgICB7CiAgICAgICAgJHJvdyAgICAgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkcm93KTsKICAgICAgICAkY29sdW1uICAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRjb2x1bW4pOwogICAgICAgICRyZWxhdGl2aXR5ID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJHJlbGF0aXZpdHkpOwogICAgICAgICRzaGVldFRleHQgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJHNoZWV0VGV4dCk7CgogICAgICAgIGlmICgoJHJvdyA8IDEpIHx8ICgkY29sdW1uIDwgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CgogICAgICAgIGlmICgkc2hlZXRUZXh0ID4gJycpIHsKICAgICAgICAgICAgaWYgKHN0cnBvcygkc2hlZXRUZXh0LCAnICcpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgJHNoZWV0VGV4dCA9ICInIi4kc2hlZXRUZXh0LiInIjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkc2hlZXRUZXh0IC49JyEnOwogICAgICAgIH0KICAgICAgICBpZiAoKCFpc19ib29sKCRyZWZlcmVuY2VTdHlsZSkpIHx8ICRyZWZlcmVuY2VTdHlsZSkgewogICAgICAgICAgICAkcm93UmVsYXRpdmUgPSAkY29sdW1uUmVsYXRpdmUgPSAnJCc7CiAgICAgICAgICAgICRjb2x1bW4gPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNvbHVtbi0xKTsKICAgICAgICAgICAgaWYgKCgkcmVsYXRpdml0eSA9PSAyKSB8fCAoJHJlbGF0aXZpdHkgPT0gNCkpIHsKICAgICAgICAgICAgICAgICRjb2x1bW5SZWxhdGl2ZSA9ICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoJHJlbGF0aXZpdHkgPT0gMykgfHwgKCRyZWxhdGl2aXR5ID09IDQpKSB7CiAgICAgICAgICAgICAgICAkcm93UmVsYXRpdmUgPSAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHNoZWV0VGV4dC4kY29sdW1uUmVsYXRpdmUuJGNvbHVtbi4kcm93UmVsYXRpdmUuJHJvdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoKCRyZWxhdGl2aXR5ID09IDIpIHx8ICgkcmVsYXRpdml0eSA9PSA0KSkgewogICAgICAgICAgICAgICAgJGNvbHVtbiA9ICdbJy4kY29sdW1uLiddJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKCRyZWxhdGl2aXR5ID09IDMpIHx8ICgkcmVsYXRpdml0eSA9PSA0KSkgewogICAgICAgICAgICAgICAgJHJvdyA9ICdbJy4kcm93LiddJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHNoZWV0VGV4dC4nUicuJHJvdy4nQycuJGNvbHVtbjsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQ09MVU1OCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgY29sdW1uIG51bWJlciBvZiB0aGUgZ2l2ZW4gY2VsbCByZWZlcmVuY2UKICAgICAqIElmIHRoZSBjZWxsIHJlZmVyZW5jZSBpcyBhIHJhbmdlIG9mIGNlbGxzLCBDT0xVTU4gcmV0dXJucyB0aGUgY29sdW1uIG51bWJlcnMgb2YgZWFjaCBjb2x1bW4gaW4gdGhlIHJlZmVyZW5jZSBhcyBhIGhvcml6b250YWwgYXJyYXkuCiAgICAgKiBJZiBjZWxsIHJlZmVyZW5jZSBpcyBvbWl0dGVkLCBhbmQgdGhlIGZ1bmN0aW9uIGlzIGJlaW5nIGNhbGxlZCB0aHJvdWdoIHRoZSBjYWxjdWxhdGlvbiBlbmdpbmUsIHRoZW4gaXQgaXMgYXNzdW1lZCB0byBiZSB0aGUKICAgICAqICAgICAgICByZWZlcmVuY2Ugb2YgdGhlIGNlbGwgaW4gd2hpY2ggdGhlIENPTFVNTiBmdW5jdGlvbiBhcHBlYXJzOyBvdGhlcndpc2UgdGhpcyBmdW5jdGlvbiByZXR1cm5zIDAuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgPUNPTFVNTihbY2VsbEFkZHJlc3NdKQogICAgICoKICAgICAqIEBwYXJhbSAgICBjZWxsQWRkcmVzcyAgICAgICAgQSByZWZlcmVuY2UgdG8gYSByYW5nZSBvZiBjZWxscyBmb3Igd2hpY2ggeW91IHdhbnQgdGhlIGNvbHVtbiBudW1iZXJzCiAgICAgKiBAcmV0dXJuICAgIGludGVnZXIgb3IgYXJyYXkgb2YgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIENPTFVNTigkY2VsbEFkZHJlc3MgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19udWxsKCRjZWxsQWRkcmVzcykgfHwgdHJpbSgkY2VsbEFkZHJlc3MpID09PSAnJykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGlmIChpc19hcnJheSgkY2VsbEFkZHJlc3MpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRjZWxsQWRkcmVzcyBhcyAkY29sdW1uS2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgJGNvbHVtbktleSA9IHByZWdfcmVwbGFjZSgnL1teYS16XS9pJywgJycsICRjb2x1bW5LZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlZ2VyKSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGNvbHVtbktleSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoc3RycG9zKCRjZWxsQWRkcmVzcywgJyEnKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGxpc3QoJHNoZWV0LCAkY2VsbEFkZHJlc3MpID0gZXhwbG9kZSgnIScsICRjZWxsQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0cnBvcygkY2VsbEFkZHJlc3MsICc6JykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBsaXN0KCRzdGFydEFkZHJlc3MsICRlbmRBZGRyZXNzKSA9IGV4cGxvZGUoJzonLCAkY2VsbEFkZHJlc3MpOwogICAgICAgICAgICAgICAgJHN0YXJ0QWRkcmVzcyA9IHByZWdfcmVwbGFjZSgnL1teYS16XS9pJywgJycsICRzdGFydEFkZHJlc3MpOwogICAgICAgICAgICAgICAgJGVuZEFkZHJlc3MgPSBwcmVnX3JlcGxhY2UoJy9bXmEtel0vaScsICcnLCAkZW5kQWRkcmVzcyk7CiAgICAgICAgICAgICAgICAkcmV0dXJuVmFsdWUgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZVtdID0gKGludGVnZXIpIFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkc3RhcnRBZGRyZXNzKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKCRzdGFydEFkZHJlc3MrKyAhPSAkZW5kQWRkcmVzcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldHVyblZhbHVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGNlbGxBZGRyZXNzID0gcHJlZ19yZXBsYWNlKCcvW15hLXpdL2knLCAnJywgJGNlbGxBZGRyZXNzKTsKICAgICAgICAgICAgICAgIHJldHVybiAoaW50ZWdlcikgUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRjZWxsQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQ09MVU1OUwogICAgICoKICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBjb2x1bW5zIGluIGFuIGFycmF5IG9yIHJlZmVyZW5jZS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICA9Q09MVU1OUyhjZWxsQWRkcmVzcykKICAgICAqCiAgICAgKiBAcGFyYW0gICAgY2VsbEFkZHJlc3MgICAgICAgIEFuIGFycmF5IG9yIGFycmF5IGZvcm11bGEsIG9yIGEgcmVmZXJlbmNlIHRvIGEgcmFuZ2Ugb2YgY2VsbHMgZm9yIHdoaWNoIHlvdSB3YW50IHRoZSBudW1iZXIgb2YgY29sdW1ucwogICAgICogQHJldHVybiAgICBpbnRlZ2VyICAgICAgICAgICAgVGhlIG51bWJlciBvZiBjb2x1bW5zIGluIGNlbGxBZGRyZXNzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gQ09MVU1OUygkY2VsbEFkZHJlc3MgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19udWxsKCRjZWxsQWRkcmVzcykgfHwgJGNlbGxBZGRyZXNzID09PSAnJykgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9IGVsc2VpZiAoIWlzX2FycmF5KCRjZWxsQWRkcmVzcykpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CgogICAgICAgIHJlc2V0KCRjZWxsQWRkcmVzcyk7CiAgICAgICAgJGlzTWF0cml4ID0gKGlzX251bWVyaWMoa2V5KCRjZWxsQWRkcmVzcykpKTsKICAgICAgICBsaXN0KCRjb2x1bW5zLCAkcm93cykgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6X2dldE1hdHJpeERpbWVuc2lvbnMoJGNlbGxBZGRyZXNzKTsKCiAgICAgICAgaWYgKCRpc01hdHJpeCkgewogICAgICAgICAgICByZXR1cm4gJHJvd3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICRjb2x1bW5zOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBST1cKICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSByb3cgbnVtYmVyIG9mIHRoZSBnaXZlbiBjZWxsIHJlZmVyZW5jZQogICAgICogSWYgdGhlIGNlbGwgcmVmZXJlbmNlIGlzIGEgcmFuZ2Ugb2YgY2VsbHMsIFJPVyByZXR1cm5zIHRoZSByb3cgbnVtYmVycyBvZiBlYWNoIHJvdyBpbiB0aGUgcmVmZXJlbmNlIGFzIGEgdmVydGljYWwgYXJyYXkuCiAgICAgKiBJZiBjZWxsIHJlZmVyZW5jZSBpcyBvbWl0dGVkLCBhbmQgdGhlIGZ1bmN0aW9uIGlzIGJlaW5nIGNhbGxlZCB0aHJvdWdoIHRoZSBjYWxjdWxhdGlvbiBlbmdpbmUsIHRoZW4gaXQgaXMgYXNzdW1lZCB0byBiZSB0aGUKICAgICAqICAgICAgICByZWZlcmVuY2Ugb2YgdGhlIGNlbGwgaW4gd2hpY2ggdGhlIFJPVyBmdW5jdGlvbiBhcHBlYXJzOyBvdGhlcndpc2UgdGhpcyBmdW5jdGlvbiByZXR1cm5zIDAuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgPVJPVyhbY2VsbEFkZHJlc3NdKQogICAgICoKICAgICAqIEBwYXJhbSAgICBjZWxsQWRkcmVzcyAgICAgICAgQSByZWZlcmVuY2UgdG8gYSByYW5nZSBvZiBjZWxscyBmb3Igd2hpY2ggeW91IHdhbnQgdGhlIHJvdyBudW1iZXJzCiAgICAgKiBAcmV0dXJuICAgIGludGVnZXIgb3IgYXJyYXkgb2YgaW50ZWdlcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFJPVygkY2VsbEFkZHJlc3MgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19udWxsKCRjZWxsQWRkcmVzcykgfHwgdHJpbSgkY2VsbEFkZHJlc3MpID09PSAnJykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGlmIChpc19hcnJheSgkY2VsbEFkZHJlc3MpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRjZWxsQWRkcmVzcyBhcyAkY29sdW1uS2V5ID0+ICRyb3dWYWx1ZSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJvd1ZhbHVlIGFzICRyb3dLZXkgPT4gJGNlbGxWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoaW50ZWdlcikgcHJlZ19yZXBsYWNlKCcvW14wLTldL2knLCAnJywgJHJvd0tleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoc3RycG9zKCRjZWxsQWRkcmVzcywgJyEnKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGxpc3QoJHNoZWV0LCAkY2VsbEFkZHJlc3MpID0gZXhwbG9kZSgnIScsICRjZWxsQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0cnBvcygkY2VsbEFkZHJlc3MsICc6JykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBsaXN0KCRzdGFydEFkZHJlc3MsICRlbmRBZGRyZXNzKSA9IGV4cGxvZGUoJzonLCAkY2VsbEFkZHJlc3MpOwogICAgICAgICAgICAgICAgJHN0YXJ0QWRkcmVzcyA9IHByZWdfcmVwbGFjZSgnL1teMC05XS8nLCAnJywgJHN0YXJ0QWRkcmVzcyk7CiAgICAgICAgICAgICAgICAkZW5kQWRkcmVzcyA9IHByZWdfcmVwbGFjZSgnL1teMC05XS8nLCAnJywgJGVuZEFkZHJlc3MpOwogICAgICAgICAgICAgICAgJHJldHVyblZhbHVlID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAkcmV0dXJuVmFsdWVbXVtdID0gKGludGVnZXIpICRzdGFydEFkZHJlc3M7CiAgICAgICAgICAgICAgICB9IHdoaWxlICgkc3RhcnRBZGRyZXNzKysgIT0gJGVuZEFkZHJlc3MpOwogICAgICAgICAgICAgICAgcmV0dXJuICRyZXR1cm5WYWx1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxpc3QoJGNlbGxBZGRyZXNzKSA9IGV4cGxvZGUoJzonLCAkY2VsbEFkZHJlc3MpOwogICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlZ2VyKSBwcmVnX3JlcGxhY2UoJy9bXjAtOV0vJywgJycsICRjZWxsQWRkcmVzcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogUk9XUwogICAgICoKICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiByb3dzIGluIGFuIGFycmF5IG9yIHJlZmVyZW5jZS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICA9Uk9XUyhjZWxsQWRkcmVzcykKICAgICAqCiAgICAgKiBAcGFyYW0gICAgY2VsbEFkZHJlc3MgICAgICAgIEFuIGFycmF5IG9yIGFycmF5IGZvcm11bGEsIG9yIGEgcmVmZXJlbmNlIHRvIGEgcmFuZ2Ugb2YgY2VsbHMgZm9yIHdoaWNoIHlvdSB3YW50IHRoZSBudW1iZXIgb2Ygcm93cwogICAgICogQHJldHVybiAgICBpbnRlZ2VyICAgICAgICAgICAgVGhlIG51bWJlciBvZiByb3dzIGluIGNlbGxBZGRyZXNzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gUk9XUygkY2VsbEFkZHJlc3MgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19udWxsKCRjZWxsQWRkcmVzcykgfHwgJGNlbGxBZGRyZXNzID09PSAnJykgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9IGVsc2VpZiAoIWlzX2FycmF5KCRjZWxsQWRkcmVzcykpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CgogICAgICAgIHJlc2V0KCRjZWxsQWRkcmVzcyk7CiAgICAgICAgJGlzTWF0cml4ID0gKGlzX251bWVyaWMoa2V5KCRjZWxsQWRkcmVzcykpKTsKICAgICAgICBsaXN0KCRjb2x1bW5zLCAkcm93cykgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6X2dldE1hdHJpeERpbWVuc2lvbnMoJGNlbGxBZGRyZXNzKTsKCiAgICAgICAgaWYgKCRpc01hdHJpeCkgewogICAgICAgICAgICByZXR1cm4gJGNvbHVtbnM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICRyb3dzOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBIWVBFUkxJTksKICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICA9SFlQRVJMSU5LKGxpbmtVUkwsZGlzcGxheU5hbWUpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBMb2dpY2FsIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAgICAgICAgICRsaW5rVVJMICAgICAgICBWYWx1ZSB0byBjaGVjaywgaXMgYWxzbyB0aGUgdmFsdWUgcmV0dXJuZWQgd2hlbiBubyBlcnJvcgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAgICAgICAgICRkaXNwbGF5TmFtZSAgICBWYWx1ZSB0byByZXR1cm4gd2hlbiB0ZXN0VmFsdWUgaXMgYW4gZXJyb3IgY29uZGl0aW9uCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfQ2VsbCAgICAkcENlbGwgICAgICAgICAgICBUaGUgY2VsbCB0byBzZXQgdGhlIGh5cGVybGluayBpbgogICAgICogQHJldHVybiAgICBtaXhlZCAgICBUaGUgdmFsdWUgb2YgJGRpc3BsYXlOYW1lIChvciAkbGlua1VSTCBpZiAkZGlzcGxheU5hbWUgd2FzIGJsYW5rKQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIEhZUEVSTElOSygkbGlua1VSTCA9ICcnLCAkZGlzcGxheU5hbWUgPSBudWxsLCBQSFBFeGNlbF9DZWxsICRwQ2VsbCA9IG51bGwpCiAgICB7CiAgICAgICAgJGFyZ3MgPSBmdW5jX2dldF9hcmdzKCk7CiAgICAgICAgJHBDZWxsID0gYXJyYXlfcG9wKCRhcmdzKTsKCiAgICAgICAgJGxpbmtVUkwgICAgID0gKGlzX251bGwoJGxpbmtVUkwpKSAgICAgPyAnJyA6IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRsaW5rVVJMKTsKICAgICAgICAkZGlzcGxheU5hbWUgPSAoaXNfbnVsbCgkZGlzcGxheU5hbWUpKSA\/ICcnIDogUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGRpc3BsYXlOYW1lKTsKCiAgICAgICAgaWYgKCghaXNfb2JqZWN0KCRwQ2VsbCkpIHx8ICh0cmltKCRsaW5rVVJMKSA9PSAnJykpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVGKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoKGlzX29iamVjdCgkZGlzcGxheU5hbWUpKSB8fCB0cmltKCRkaXNwbGF5TmFtZSkgPT0gJycpIHsKICAgICAgICAgICAgJGRpc3BsYXlOYW1lID0gJGxpbmtVUkw7CiAgICAgICAgfQoKICAgICAgICAkcENlbGwtPmdldEh5cGVybGluaygpLT5zZXRVcmwoJGxpbmtVUkwpOwogICAgICAgICRwQ2VsbC0+Z2V0SHlwZXJsaW5rKCktPnNldFRvb2x0aXAoJGRpc3BsYXlOYW1lKTsKCiAgICAgICAgcmV0dXJuICRkaXNwbGF5TmFtZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBJTkRJUkVDVAogICAgICoKICAgICAqIFJldHVybnMgdGhlIHJlZmVyZW5jZSBzcGVjaWZpZWQgYnkgYSB0ZXh0IHN0cmluZy4KICAgICAqIFJlZmVyZW5jZXMgYXJlIGltbWVkaWF0ZWx5IGV2YWx1YXRlZCB0byBkaXNwbGF5IHRoZWlyIGNvbnRlbnRzLgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgID1JTkRJUkVDVChjZWxsQWRkcmVzcykKICAgICAqCiAgICAgKiBOT1RFIC0gSU5ESVJFQ1QoKSBkb2VzIG5vdCB5ZXQgc3VwcG9ydCB0aGUgb3B0aW9uYWwgYTEgcGFyYW1ldGVyIGludHJvZHVjZWQgaW4gRXhjZWwgMjAxMAogICAgICoKICAgICAqIEBwYXJhbSAgICBjZWxsQWRkcmVzcyAgICAgICAgJGNlbGxBZGRyZXNzICAgIFRoZSBjZWxsIGFkZHJlc3Mgb2YgdGhlIGN1cnJlbnQgY2VsbCAoY29udGFpbmluZyB0aGlzIGZvcm11bGEpCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfQ2VsbCAgICAkcENlbGwgICAgICAgICAgICBUaGUgY3VycmVudCBjZWxsIChjb250YWluaW5nIHRoaXMgZm9ybXVsYSkKICAgICAqIEByZXR1cm4gICAgbWl4ZWQgICAgICAgICAgICBUaGUgY2VsbHMgcmVmZXJlbmNlZCBieSBjZWxsQWRkcmVzcwogICAgICoKICAgICAqIEB0b2RvICAgIFN1cHBvcnQgZm9yIHRoZSBvcHRpb25hbCBhMSBwYXJhbWV0ZXIgaW50cm9kdWNlZCBpbiBFeGNlbCAyMDEwCiAgICAgKgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIElORElSRUNUKCRjZWxsQWRkcmVzcyA9IG51bGwsIFBIUEV4Y2VsX0NlbGwgJHBDZWxsID0gbnVsbCkKICAgIHsKICAgICAgICAkY2VsbEFkZHJlc3MgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkY2VsbEFkZHJlc3MpOwogICAgICAgIGlmIChpc19udWxsKCRjZWxsQWRkcmVzcykgfHwgJGNlbGxBZGRyZXNzID09PSAnJykgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRUYoKTsKICAgICAgICB9CgogICAgICAgICRjZWxsQWRkcmVzczEgPSAkY2VsbEFkZHJlc3M7CiAgICAgICAgJGNlbGxBZGRyZXNzMiA9IG51bGw7CiAgICAgICAgaWYgKHN0cnBvcygkY2VsbEFkZHJlc3MsICc6JykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIGxpc3QoJGNlbGxBZGRyZXNzMSwgJGNlbGxBZGRyZXNzMikgPSBleHBsb2RlKCc6JywgJGNlbGxBZGRyZXNzKTsKICAgICAgICB9CgogICAgICAgIGlmICgoIXByZWdfbWF0Y2goJy9eJy5QSFBFeGNlbF9DYWxjdWxhdGlvbjo6Q0FMQ1VMQVRJT05fUkVHRVhQX0NFTExSRUYuJyQvaScsICRjZWxsQWRkcmVzczEsICRtYXRjaGVzKSkgfHwKICAgICAgICAgICAgKCghaXNfbnVsbCgkY2VsbEFkZHJlc3MyKSkgJiYgKCFwcmVnX21hdGNoKCcvXicuUEhQRXhjZWxfQ2FsY3VsYXRpb246OkNBTENVTEFUSU9OX1JFR0VYUF9DRUxMUkVGLickL2knLCAkY2VsbEFkZHJlc3MyLCAkbWF0Y2hlcykpKSkgewogICAgICAgICAgICBpZiAoIXByZWdfbWF0Y2goJy9eJy5QSFBFeGNlbF9DYWxjdWxhdGlvbjo6Q0FMQ1VMQVRJT05fUkVHRVhQX05BTUVEUkFOR0UuJyQvaScsICRjZWxsQWRkcmVzczEsICRtYXRjaGVzKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVGKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdHJwb3MoJGNlbGxBZGRyZXNzLCAnIScpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgbGlzdCgkc2hlZXROYW1lLCAkY2VsbEFkZHJlc3MpID0gZXhwbG9kZSgnIScsICRjZWxsQWRkcmVzcyk7CiAgICAgICAgICAgICAgICAkc2hlZXROYW1lID0gdHJpbSgkc2hlZXROYW1lLCAiJyIpOwogICAgICAgICAgICAgICAgJHBTaGVldCA9ICRwQ2VsbC0+Z2V0V29ya3NoZWV0KCktPmdldFBhcmVudCgpLT5nZXRTaGVldEJ5TmFtZSgkc2hlZXROYW1lKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRwU2hlZXQgPSAkcENlbGwtPmdldFdvcmtzaGVldCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb246OmdldEluc3RhbmNlKCktPmV4dHJhY3ROYW1lZFJhbmdlKCRjZWxsQWRkcmVzcywgJHBTaGVldCwgZmFsc2UpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0cnBvcygkY2VsbEFkZHJlc3MsICchJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIGxpc3QoJHNoZWV0TmFtZSwgJGNlbGxBZGRyZXNzKSA9IGV4cGxvZGUoJyEnLCAkY2VsbEFkZHJlc3MpOwogICAgICAgICAgICAkc2hlZXROYW1lID0gdHJpbSgkc2hlZXROYW1lLCAiJyIpOwogICAgICAgICAgICAkcFNoZWV0ID0gJHBDZWxsLT5nZXRXb3Jrc2hlZXQoKS0+Z2V0UGFyZW50KCktPmdldFNoZWV0QnlOYW1lKCRzaGVldE5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwU2hlZXQgPSAkcENlbGwtPmdldFdvcmtzaGVldCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uOjpnZXRJbnN0YW5jZSgpLT5leHRyYWN0Q2VsbFJhbmdlKCRjZWxsQWRkcmVzcywgJHBTaGVldCwgZmFsc2UpOwogICAgfQoKCiAgICAvKioKICAgICAqIE9GRlNFVAogICAgICoKICAgICAqIFJldHVybnMgYSByZWZlcmVuY2UgdG8gYSByYW5nZSB0aGF0IGlzIGEgc3BlY2lmaWVkIG51bWJlciBvZiByb3dzIGFuZCBjb2x1bW5zIGZyb20gYSBjZWxsIG9yIHJhbmdlIG9mIGNlbGxzLgogICAgICogVGhlIHJlZmVyZW5jZSB0aGF0IGlzIHJldHVybmVkIGNhbiBiZSBhIHNpbmdsZSBjZWxsIG9yIGEgcmFuZ2Ugb2YgY2VsbHMuIFlvdSBjYW4gc3BlY2lmeSB0aGUgbnVtYmVyIG9mIHJvd3MgYW5kCiAgICAgKiB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgdG8gYmUgcmV0dXJuZWQuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgPU9GRlNFVChjZWxsQWRkcmVzcywgcm93cywgY29scywgW2hlaWdodF0sIFt3aWR0aF0pCiAgICAgKgogICAgICogQHBhcmFtICAgIGNlbGxBZGRyZXNzICAgICAgICBUaGUgcmVmZXJlbmNlIGZyb20gd2hpY2ggeW91IHdhbnQgdG8gYmFzZSB0aGUgb2Zmc2V0LiBSZWZlcmVuY2UgbXVzdCByZWZlciB0byBhIGNlbGwgb3IKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZSBvZiBhZGphY2VudCBjZWxsczsgb3RoZXJ3aXNlLCBPRkZTRVQgcmV0dXJucyB0aGUgI1ZBTFVFISBlcnJvciB2YWx1ZS4KICAgICAqIEBwYXJhbSAgICByb3dzICAgICAgICAgICAgVGhlIG51bWJlciBvZiByb3dzLCB1cCBvciBkb3duLCB0aGF0IHlvdSB3YW50IHRoZSB1cHBlci1sZWZ0IGNlbGwgdG8gcmVmZXIgdG8uCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNpbmcgNSBhcyB0aGUgcm93cyBhcmd1bWVudCBzcGVjaWZpZXMgdGhhdCB0aGUgdXBwZXItbGVmdCBjZWxsIGluIHRoZSByZWZlcmVuY2UgaXMKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXZlIHJvd3MgYmVsb3cgcmVmZXJlbmNlLiBSb3dzIGNhbiBiZSBwb3NpdGl2ZSAod2hpY2ggbWVhbnMgYmVsb3cgdGhlIHN0YXJ0aW5nIHJlZmVyZW5jZSkKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBuZWdhdGl2ZSAod2hpY2ggbWVhbnMgYWJvdmUgdGhlIHN0YXJ0aW5nIHJlZmVyZW5jZSkuCiAgICAgKiBAcGFyYW0gICAgY29scyAgICAgICAgICAgIFRoZSBudW1iZXIgb2YgY29sdW1ucywgdG8gdGhlIGxlZnQgb3IgcmlnaHQsIHRoYXQgeW91IHdhbnQgdGhlIHVwcGVyLWxlZnQgY2VsbCBvZiB0aGUgcmVzdWx0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gcmVmZXIgdG8uIFVzaW5nIDUgYXMgdGhlIGNvbHMgYXJndW1lbnQgc3BlY2lmaWVzIHRoYXQgdGhlIHVwcGVyLWxlZnQgY2VsbCBpbiB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2UgaXMgZml2ZSBjb2x1bW5zIHRvIHRoZSByaWdodCBvZiByZWZlcmVuY2UuIENvbHMgY2FuIGJlIHBvc2l0aXZlICh3aGljaCBtZWFucwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIHRoZSByaWdodCBvZiB0aGUgc3RhcnRpbmcgcmVmZXJlbmNlKSBvciBuZWdhdGl2ZSAod2hpY2ggbWVhbnMgdG8gdGhlIGxlZnQgb2YgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRpbmcgcmVmZXJlbmNlKS4KICAgICAqIEBwYXJhbSAgICBoZWlnaHQgICAgICAgICAgICBUaGUgaGVpZ2h0LCBpbiBudW1iZXIgb2Ygcm93cywgdGhhdCB5b3Ugd2FudCB0aGUgcmV0dXJuZWQgcmVmZXJlbmNlIHRvIGJlLiBIZWlnaHQgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlci4KICAgICAqIEBwYXJhbSAgICB3aWR0aCAgICAgICAgICAgIFRoZSB3aWR0aCwgaW4gbnVtYmVyIG9mIGNvbHVtbnMsIHRoYXQgeW91IHdhbnQgdGhlIHJldHVybmVkIHJlZmVyZW5jZSB0byBiZS4gV2lkdGggbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlci4KICAgICAqIEByZXR1cm4gICAgc3RyaW5nICAgICAgICAgICAgQSByZWZlcmVuY2UgdG8gYSBjZWxsIG9yIHJhbmdlIG9mIGNlbGxzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gT0ZGU0VUKCRjZWxsQWRkcmVzcyA9IG51bGwsICRyb3dzID0gMCwgJGNvbHVtbnMgPSAwLCAkaGVpZ2h0ID0gbnVsbCwgJHdpZHRoID0gbnVsbCkKICAgIHsKICAgICAgICAkcm93cyAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRyb3dzKTsKICAgICAgICAkY29sdW1ucyA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRjb2x1bW5zKTsKICAgICAgICAkaGVpZ2h0ICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRoZWlnaHQpOwogICAgICAgICR3aWR0aCAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJHdpZHRoKTsKICAgICAgICBpZiAoJGNlbGxBZGRyZXNzID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAkYXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAkcENlbGwgPSBhcnJheV9wb3AoJGFyZ3MpOwogICAgICAgIGlmICghaXNfb2JqZWN0KCRwQ2VsbCkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVGKCk7CiAgICAgICAgfQoKICAgICAgICAkc2hlZXROYW1lID0gbnVsbDsKICAgICAgICBpZiAoc3RycG9zKCRjZWxsQWRkcmVzcywgIiEiKSkgewogICAgICAgICAgICBsaXN0KCRzaGVldE5hbWUsICRjZWxsQWRkcmVzcykgPSBleHBsb2RlKCIhIiwgJGNlbGxBZGRyZXNzKTsKICAgICAgICAgICAgJHNoZWV0TmFtZSA9IHRyaW0oJHNoZWV0TmFtZSwgIiciKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cnBvcygkY2VsbEFkZHJlc3MsICI6IikpIHsKICAgICAgICAgICAgbGlzdCgkc3RhcnRDZWxsLCAkZW5kQ2VsbCkgPSBleHBsb2RlKCI6IiwgJGNlbGxBZGRyZXNzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc3RhcnRDZWxsID0gJGVuZENlbGwgPSAkY2VsbEFkZHJlc3M7CiAgICAgICAgfQogICAgICAgIGxpc3QoJHN0YXJ0Q2VsbENvbHVtbiwgJHN0YXJ0Q2VsbFJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkc3RhcnRDZWxsKTsKICAgICAgICBsaXN0KCRlbmRDZWxsQ29sdW1uLCAkZW5kQ2VsbFJvdykgPSBQSFBFeGNlbF9DZWxsOjpjb29yZGluYXRlRnJvbVN0cmluZygkZW5kQ2VsbCk7CgogICAgICAgICRzdGFydENlbGxSb3cgKz0gJHJvd3M7CiAgICAgICAgJHN0YXJ0Q2VsbENvbHVtbiA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkc3RhcnRDZWxsQ29sdW1uKSAtIDE7CiAgICAgICAgJHN0YXJ0Q2VsbENvbHVtbiArPSAkY29sdW1uczsKCiAgICAgICAgaWYgKCgkc3RhcnRDZWxsUm93IDw9IDApIHx8ICgkc3RhcnRDZWxsQ29sdW1uIDwgMCkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVGKCk7CiAgICAgICAgfQogICAgICAgICRlbmRDZWxsQ29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRlbmRDZWxsQ29sdW1uKSAtIDE7CiAgICAgICAgaWYgKCgkd2lkdGggIT0gbnVsbCkgJiYgKCFpc19vYmplY3QoJHdpZHRoKSkpIHsKICAgICAgICAgICAgJGVuZENlbGxDb2x1bW4gPSAkc3RhcnRDZWxsQ29sdW1uICsgJHdpZHRoIC0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkZW5kQ2VsbENvbHVtbiArPSAkY29sdW1uczsKICAgICAgICB9CiAgICAgICAgJHN0YXJ0Q2VsbENvbHVtbiA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkc3RhcnRDZWxsQ29sdW1uKTsKCiAgICAgICAgaWYgKCgkaGVpZ2h0ICE9IG51bGwpICYmICghaXNfb2JqZWN0KCRoZWlnaHQpKSkgewogICAgICAgICAgICAkZW5kQ2VsbFJvdyA9ICRzdGFydENlbGxSb3cgKyAkaGVpZ2h0IC0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkZW5kQ2VsbFJvdyArPSAkcm93czsKICAgICAgICB9CgogICAgICAgIGlmICgoJGVuZENlbGxSb3cgPD0gMCkgfHwgKCRlbmRDZWxsQ29sdW1uIDwgMCkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVGKCk7CiAgICAgICAgfQogICAgICAgICRlbmRDZWxsQ29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRlbmRDZWxsQ29sdW1uKTsKCiAgICAgICAgJGNlbGxBZGRyZXNzID0gJHN0YXJ0Q2VsbENvbHVtbi4kc3RhcnRDZWxsUm93OwogICAgICAgIGlmICgoJHN0YXJ0Q2VsbENvbHVtbiAhPSAkZW5kQ2VsbENvbHVtbikgfHwgKCRzdGFydENlbGxSb3cgIT0gJGVuZENlbGxSb3cpKSB7CiAgICAgICAgICAgICRjZWxsQWRkcmVzcyAuPSAnOicuJGVuZENlbGxDb2x1bW4uJGVuZENlbGxSb3c7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHNoZWV0TmFtZSAhPT0gbnVsbCkgewogICAgICAgICAgICAkcFNoZWV0ID0gJHBDZWxsLT5nZXRXb3Jrc2hlZXQoKS0+Z2V0UGFyZW50KCktPmdldFNoZWV0QnlOYW1lKCRzaGVldE5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwU2hlZXQgPSAkcENlbGwtPmdldFdvcmtzaGVldCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uOjpnZXRJbnN0YW5jZSgpLT5leHRyYWN0Q2VsbFJhbmdlKCRjZWxsQWRkcmVzcywgJHBTaGVldCwgZmFsc2UpOwogICAgfQoKCiAgICAvKioKICAgICAqIENIT09TRQogICAgICoKICAgICAqIFVzZXMgbG9va3VwX3ZhbHVlIHRvIHJldHVybiBhIHZhbHVlIGZyb20gdGhlIGxpc3Qgb2YgdmFsdWUgYXJndW1lbnRzLgogICAgICogVXNlIENIT09TRSB0byBzZWxlY3Qgb25lIG9mIHVwIHRvIDI1NCB2YWx1ZXMgYmFzZWQgb24gdGhlIGxvb2t1cF92YWx1ZS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICA9Q0hPT1NFKGluZGV4X251bSwgdmFsdWUxLCBbdmFsdWUyXSwgLi4uKQogICAgICoKICAgICAqIEBwYXJhbSAgICBpbmRleF9udW0gICAgICAgIFNwZWNpZmllcyB3aGljaCB2YWx1ZSBhcmd1bWVudCBpcyBzZWxlY3RlZC4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGV4X251bSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gMSBhbmQgMjU0LCBvciBhIGZvcm11bGEgb3IgcmVmZXJlbmNlIHRvIGEgY2VsbCBjb250YWluaW5nIGEgbnVtYmVyCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmV0d2VlbiAxIGFuZCAyNTQuCiAgICAgKiBAcGFyYW0gICAgdmFsdWUxLi4uICAgICAgICBWYWx1ZTEgaXMgcmVxdWlyZWQsIHN1YnNlcXVlbnQgdmFsdWVzIGFyZSBvcHRpb25hbC4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJldHdlZW4gMSB0byAyNTQgdmFsdWUgYXJndW1lbnRzIGZyb20gd2hpY2ggQ0hPT1NFIHNlbGVjdHMgYSB2YWx1ZSBvciBhbiBhY3Rpb24gdG8gcGVyZm9ybSBiYXNlZCBvbgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4X251bS4gVGhlIGFyZ3VtZW50cyBjYW4gYmUgbnVtYmVycywgY2VsbCByZWZlcmVuY2VzLCBkZWZpbmVkIG5hbWVzLCBmb3JtdWxhcywgZnVuY3Rpb25zLCBvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQuCiAgICAgKiBAcmV0dXJuICAgIG1peGVkICAgICAgICAgICAgVGhlIHNlbGVjdGVkIHZhbHVlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gQ0hPT1NFKCkKICAgIHsKICAgICAgICAkY2hvb3NlQXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAkY2hvc2VuRW50cnkgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheShhcnJheV9zaGlmdCgkY2hvb3NlQXJncykpOwogICAgICAgICRlbnRyeUNvdW50ID0gY291bnQoJGNob29zZUFyZ3MpIC0gMTsKCiAgICAgICAgaWYgKGlzX2FycmF5KCRjaG9zZW5FbnRyeSkpIHsKICAgICAgICAgICAgJGNob3NlbkVudHJ5ID0gYXJyYXlfc2hpZnQoJGNob3NlbkVudHJ5KTsKICAgICAgICB9CiAgICAgICAgaWYgKChpc19udW1lcmljKCRjaG9zZW5FbnRyeSkpICYmICghaXNfYm9vbCgkY2hvc2VuRW50cnkpKSkgewogICAgICAgICAgICAtLSRjaG9zZW5FbnRyeTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KICAgICAgICAkY2hvc2VuRW50cnkgPSBmbG9vcigkY2hvc2VuRW50cnkpOwogICAgICAgIGlmICgoJGNob3NlbkVudHJ5IDwgMCkgfHwgKCRjaG9zZW5FbnRyeSA+ICRlbnRyeUNvdW50KSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzX2FycmF5KCRjaG9vc2VBcmdzWyRjaG9zZW5FbnRyeV0pKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkY2hvb3NlQXJnc1skY2hvc2VuRW50cnldKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gJGNob29zZUFyZ3NbJGNob3NlbkVudHJ5XTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogTUFUQ0gKICAgICAqCiAgICAgKiBUaGUgTUFUQ0ggZnVuY3Rpb24gc2VhcmNoZXMgZm9yIGEgc3BlY2lmaWVkIGl0ZW0gaW4gYSByYW5nZSBvZiBjZWxscwogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgID1NQVRDSChsb29rdXBfdmFsdWUsIGxvb2t1cF9hcnJheSwgW21hdGNoX3R5cGVdKQogICAgICoKICAgICAqIEBwYXJhbSAgICBsb29rdXBfdmFsdWUgICAgVGhlIHZhbHVlIHRoYXQgeW91IHdhbnQgdG8gbWF0Y2ggaW4gbG9va3VwX2FycmF5CiAgICAgKiBAcGFyYW0gICAgbG9va3VwX2FycmF5ICAgIFRoZSByYW5nZSBvZiBjZWxscyBiZWluZyBzZWFyY2hlZAogICAgICogQHBhcmFtICAgIG1hdGNoX3R5cGUgICAgICAgIFRoZSBudW1iZXIgLTEsIDAsIG9yIDEuIC0xIG1lYW5zIGFib3ZlLCAwIG1lYW5zIGV4YWN0IG1hdGNoLCAxIG1lYW5zIGJlbG93LiBJZiBtYXRjaF90eXBlIGlzIDEgb3IgLTEsIHRoZSBsaXN0IGhhcyB0byBiZSBvcmRlcmVkLgogICAgICogQHJldHVybiAgICBpbnRlZ2VyICAgICAgICAgICAgVGhlIHJlbGF0aXZlIHBvc2l0aW9uIG9mIHRoZSBmb3VuZCBpdGVtCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gTUFUQ0goJGxvb2t1cF92YWx1ZSwgJGxvb2t1cF9hcnJheSwgJG1hdGNoX3R5cGUgPSAxKQogICAgewogICAgICAgICRsb29rdXBfYXJyYXkgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkbG9va3VwX2FycmF5KTsKICAgICAgICAkbG9va3VwX3ZhbHVlID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGxvb2t1cF92YWx1ZSk7CiAgICAgICAgJG1hdGNoX3R5cGUgICAgPSAoaXNfbnVsbCgkbWF0Y2hfdHlwZSkpID8gMSA6IChpbnQpIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRtYXRjaF90eXBlKTsKICAgICAgICAvLyAgICBNQVRDSCBpcyBub3QgY2FzZSBzZW5zaXRpdmUKICAgICAgICAkbG9va3VwX3ZhbHVlID0gc3RydG9sb3dlcigkbG9va3VwX3ZhbHVlKTsKCiAgICAgICAgLy8gICAgbG9va3VwX3ZhbHVlIHR5cGUgaGFzIHRvIGJlIG51bWJlciwgdGV4dCwgb3IgbG9naWNhbCB2YWx1ZXMKICAgICAgICBpZiAoKCFpc19udW1lcmljKCRsb29rdXBfdmFsdWUpKSAmJiAoIWlzX3N0cmluZygkbG9va3VwX3ZhbHVlKSkgJiYgKCFpc19ib29sKCRsb29rdXBfdmFsdWUpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOQSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgbWF0Y2hfdHlwZSBpcyAwLCAxIG9yIC0xCiAgICAgICAgaWYgKCgkbWF0Y2hfdHlwZSAhPT0gMCkgJiYgKCRtYXRjaF90eXBlICE9PSAtMSkgJiYgKCRtYXRjaF90eXBlICE9PSAxKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOQSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgbG9va3VwX2FycmF5IHNob3VsZCBub3QgYmUgZW1wdHkKICAgICAgICAkbG9va3VwQXJyYXlTaXplID0gY291bnQoJGxvb2t1cF9hcnJheSk7CiAgICAgICAgaWYgKCRsb29rdXBBcnJheVNpemUgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOQSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgbG9va3VwX2FycmF5IHNob3VsZCBjb250YWluIG9ubHkgbnVtYmVyLCB0ZXh0LCBvciBsb2dpY2FsIHZhbHVlcywgb3IgZW1wdHkgKG51bGwpIGNlbGxzCiAgICAgICAgZm9yZWFjaCAoJGxvb2t1cF9hcnJheSBhcyAkaSA9PiAkbG9va3VwQXJyYXlWYWx1ZSkgewogICAgICAgICAgICAvLyAgICBjaGVjayB0aGUgdHlwZSBvZiB0aGUgdmFsdWUKICAgICAgICAgICAgaWYgKCghaXNfbnVtZXJpYygkbG9va3VwQXJyYXlWYWx1ZSkpICYmICghaXNfc3RyaW5nKCRsb29rdXBBcnJheVZhbHVlKSkgJiYKICAgICAgICAgICAgICAgICghaXNfYm9vbCgkbG9va3VwQXJyYXlWYWx1ZSkpICYmICghaXNfbnVsbCgkbG9va3VwQXJyYXlWYWx1ZSkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOQSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICAgIGNvbnZlcnQgc3RyaW5ncyB0byBsb3dlcmNhc2UgZm9yIGNhc2UtaW5zZW5zaXRpdmUgdGVzdGluZwogICAgICAgICAgICBpZiAoaXNfc3RyaW5nKCRsb29rdXBBcnJheVZhbHVlKSkgewogICAgICAgICAgICAgICAgJGxvb2t1cF9hcnJheVskaV0gPSBzdHJ0b2xvd2VyKCRsb29rdXBBcnJheVZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGlzX251bGwoJGxvb2t1cEFycmF5VmFsdWUpKSAmJiAoKCRtYXRjaF90eXBlID09IDEpIHx8ICgkbWF0Y2hfdHlwZSA9PSAtMSkpKSB7CiAgICAgICAgICAgICAgICAkbG9va3VwX2FycmF5ID0gYXJyYXlfc2xpY2UoJGxvb2t1cF9hcnJheSwgMCwgJGktMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlmIG1hdGNoX3R5cGUgaXMgMSBvciAtMSwgdGhlIGxpc3QgaGFzIHRvIGJlIG9yZGVyZWQKICAgICAgICBpZiAoJG1hdGNoX3R5cGUgPT0gMSkgewogICAgICAgICAgICBhc29ydCgkbG9va3VwX2FycmF5KTsKICAgICAgICAgICAgJGtleVNldCA9IGFycmF5X2tleXMoJGxvb2t1cF9hcnJheSk7CiAgICAgICAgfSBlbHNlaWYgKCRtYXRjaF90eXBlID09IC0xKSB7CiAgICAgICAgICAgIGFyc29ydCgkbG9va3VwX2FycmF5KTsKICAgICAgICAgICAgJGtleVNldCA9IGFycmF5X2tleXMoJGxvb2t1cF9hcnJheSk7CiAgICAgICAgfQoKICAgICAgICAvLyAqKgogICAgICAgIC8vIGZpbmQgdGhlIG1hdGNoCiAgICAgICAgLy8gKioKICAgICAgICBmb3JlYWNoICgkbG9va3VwX2FycmF5IGFzICRpID0+ICRsb29rdXBBcnJheVZhbHVlKSB7CiAgICAgICAgICAgIGlmICgoJG1hdGNoX3R5cGUgPT0gMCkgJiYgKCRsb29rdXBBcnJheVZhbHVlID09ICRsb29rdXBfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAvLyAgICBleGFjdCBtYXRjaAogICAgICAgICAgICAgICAgcmV0dXJuICsrJGk7CiAgICAgICAgICAgIH0gZWxzZWlmICgoJG1hdGNoX3R5cGUgPT0gLTEpICYmICgkbG9va3VwQXJyYXlWYWx1ZSA8PSAkbG9va3VwX3ZhbHVlKSkgewogICAgICAgICAgICAgICAgJGkgPSBhcnJheV9zZWFyY2goJGksICRrZXlTZXQpOwogICAgICAgICAgICAgICAgLy8gaWYgbWF0Y2hfdHlwZSBpcyAtMSA8PT4gZmluZCB0aGUgc21hbGxlc3QgdmFsdWUgdGhhdCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gbG9va3VwX3ZhbHVlCiAgICAgICAgICAgICAgICBpZiAoJGkgPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gMXN0IGNlbGwgd2FzIGFscmVhZHkgc21hbGxlciB0aGFuIHRoZSBsb29rdXBfdmFsdWUKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHByZXZpb3VzIGNlbGwgd2FzIHRoZSBtYXRjaAogICAgICAgICAgICAgICAgICAgIHJldHVybiAka2V5U2V0WyRpLTFdKzE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmICgoJG1hdGNoX3R5cGUgPT0gMSkgJiYgKCRsb29rdXBBcnJheVZhbHVlID49ICRsb29rdXBfdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAkaSA9IGFycmF5X3NlYXJjaCgkaSwgJGtleVNldCk7CiAgICAgICAgICAgICAgICAvLyBpZiBtYXRjaF90eXBlIGlzIDEgPD0+IGZpbmQgdGhlIGxhcmdlc3QgdmFsdWUgdGhhdCBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gbG9va3VwX3ZhbHVlCiAgICAgICAgICAgICAgICBpZiAoJGkgPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gMXN0IGNlbGwgd2FzIGFscmVhZHkgYmlnZ2VyIHRoYW4gdGhlIGxvb2t1cF92YWx1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcHJldmlvdXMgY2VsbCB3YXMgdGhlIG1hdGNoCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRrZXlTZXRbJGktMV0rMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gICAgdW5zdWNjZXNzZnVsIGluIGZpbmRpbmcgYSBtYXRjaCwgcmV0dXJuICNOL0EgZXJyb3IgdmFsdWUKICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOQSgpOwogICAgfQoKCiAgICAvKioKICAgICAqIElOREVYCiAgICAgKgogICAgICogVXNlcyBhbiBpbmRleCB0byBjaG9vc2UgYSB2YWx1ZSBmcm9tIGEgcmVmZXJlbmNlIG9yIGFycmF5CiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgPUlOREVYKHJhbmdlX2FycmF5LCByb3dfbnVtLCBbY29sdW1uX251bV0pCiAgICAgKgogICAgICogQHBhcmFtICAgIHJhbmdlX2FycmF5ICAgICAgICBBIHJhbmdlIG9mIGNlbGxzIG9yIGFuIGFycmF5IGNvbnN0YW50CiAgICAgKiBAcGFyYW0gICAgcm93X251bSAgICAgICAgICAgIFRoZSByb3cgaW4gYXJyYXkgZnJvbSB3aGljaCB0byByZXR1cm4gYSB2YWx1ZS4gSWYgcm93X251bSBpcyBvbWl0dGVkLCBjb2x1bW5fbnVtIGlzIHJlcXVpcmVkLgogICAgICogQHBhcmFtICAgIGNvbHVtbl9udW0gICAgICAgIFRoZSBjb2x1bW4gaW4gYXJyYXkgZnJvbSB3aGljaCB0byByZXR1cm4gYSB2YWx1ZS4gSWYgY29sdW1uX251bSBpcyBvbWl0dGVkLCByb3dfbnVtIGlzIHJlcXVpcmVkLgogICAgICogQHJldHVybiAgICBtaXhlZCAgICAgICAgICAgIHRoZSB2YWx1ZSBvZiBhIHNwZWNpZmllZCBjZWxsIG9yIGFycmF5IG9mIGNlbGxzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gSU5ERVgoJGFycmF5VmFsdWVzLCAkcm93TnVtID0gMCwgJGNvbHVtbk51bSA9IDApCiAgICB7CiAgICAgICAgaWYgKCgkcm93TnVtIDwgMCkgfHwgKCRjb2x1bW5OdW0gPCAwKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc19hcnJheSgkYXJyYXlWYWx1ZXMpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFRigpOwogICAgICAgIH0KCiAgICAgICAgJHJvd0tleXMgPSBhcnJheV9rZXlzKCRhcnJheVZhbHVlcyk7CiAgICAgICAgJGNvbHVtbktleXMgPSBAYXJyYXlfa2V5cygkYXJyYXlWYWx1ZXNbJHJvd0tleXNbMF1dKTsKCiAgICAgICAgaWYgKCRjb2x1bW5OdW0gPiBjb3VudCgkY29sdW1uS2V5cykpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9IGVsc2VpZiAoJGNvbHVtbk51bSA9PSAwKSB7CiAgICAgICAgICAgIGlmICgkcm93TnVtID09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAkYXJyYXlWYWx1ZXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHJvd051bSA9ICRyb3dLZXlzWy0tJHJvd051bV07CiAgICAgICAgICAgICRyZXR1cm5BcnJheSA9IGFycmF5KCk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRhcnJheVZhbHVlcyBhcyAkYXJyYXlDb2x1bW4pIHsKICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkYXJyYXlDb2x1bW4pKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRhcnJheUNvbHVtblskcm93TnVtXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJldHVybkFycmF5W10gPSAkYXJyYXlDb2x1bW5bJHJvd051bV07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhcnJheVZhbHVlc1skcm93TnVtXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkYXJyYXlWYWx1ZXNbJHJvd051bV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRyZXR1cm5BcnJheTsKICAgICAgICB9CiAgICAgICAgJGNvbHVtbk51bSA9ICRjb2x1bW5LZXlzWy0tJGNvbHVtbk51bV07CiAgICAgICAgaWYgKCRyb3dOdW0gPiBjb3VudCgkcm93S2V5cykpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9IGVsc2VpZiAoJHJvd051bSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAkYXJyYXlWYWx1ZXNbJGNvbHVtbk51bV07CiAgICAgICAgfQogICAgICAgICRyb3dOdW0gPSAkcm93S2V5c1stLSRyb3dOdW1dOwoKICAgICAgICByZXR1cm4gJGFycmF5VmFsdWVzWyRyb3dOdW1dWyRjb2x1bW5OdW1dOwogICAgfQoKCiAgICAvKioKICAgICAqIFRSQU5TUE9TRQogICAgICoKICAgICAqIEBwYXJhbSAgICBhcnJheSAgICAkbWF0cml4RGF0YSAgICBBIG1hdHJpeCBvZiB2YWx1ZXMKICAgICAqIEByZXR1cm4gICAgYXJyYXkKICAgICAqCiAgICAgKiBVbmxpa2UgdGhlIEV4Y2VsIFRSQU5TUE9TRSBmdW5jdGlvbiwgd2hpY2ggd2lsbCBvbmx5IHdvcmsgb24gYSBzaW5nbGUgcm93IG9yIGNvbHVtbiwgdGhpcyBmdW5jdGlvbiB3aWxsIHRyYW5zcG9zZSBhIGZ1bGwgbWF0cml4LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFRSQU5TUE9TRSgkbWF0cml4RGF0YSkKICAgIHsKICAgICAgICAkcmV0dXJuTWF0cml4ID0gYXJyYXkoKTsKICAgICAgICBpZiAoIWlzX2FycmF5KCRtYXRyaXhEYXRhKSkgewogICAgICAgICAgICAkbWF0cml4RGF0YSA9IGFycmF5KGFycmF5KCRtYXRyaXhEYXRhKSk7CiAgICAgICAgfQoKICAgICAgICAkY29sdW1uID0gMDsKICAgICAgICBmb3JlYWNoICgkbWF0cml4RGF0YSBhcyAkbWF0cml4Um93KSB7CiAgICAgICAgICAgICRyb3cgPSAwOwogICAgICAgICAgICBmb3JlYWNoICgkbWF0cml4Um93IGFzICRtYXRyaXhDZWxsKSB7CiAgICAgICAgICAgICAgICAkcmV0dXJuTWF0cml4WyRyb3ddWyRjb2x1bW5dID0gJG1hdHJpeENlbGw7CiAgICAgICAgICAgICAgICArKyRyb3c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKyskY29sdW1uOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJldHVybk1hdHJpeDsKICAgIH0KCgogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gdmxvb2t1cFNvcnQoJGEsICRiKQogICAgewogICAgICAgIHJlc2V0KCRhKTsKICAgICAgICAkZmlyc3RDb2x1bW4gPSBrZXkoJGEpOwogICAgICAgIGlmICgoJGFMb3dlciA9IHN0cnRvbG93ZXIoJGFbJGZpcnN0Q29sdW1uXSkpID09ICgkYkxvd2VyID0gc3RydG9sb3dlcigkYlskZmlyc3RDb2x1bW5dKSkpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoJGFMb3dlciA8ICRiTG93ZXIpID8gLTEgOiAxOwogICAgfQoKCiAgICAvKioKICAgICAqIFZMT09LVVAKICAgICAqIFRoZSBWTE9PS1VQIGZ1bmN0aW9uIHNlYXJjaGVzIGZvciB2YWx1ZSBpbiB0aGUgbGVmdC1tb3N0IGNvbHVtbiBvZiBsb29rdXBfYXJyYXkgYW5kIHJldHVybnMgdGhlIHZhbHVlIGluIHRoZSBzYW1lIHJvdyBiYXNlZCBvbiB0aGUgaW5kZXhfbnVtYmVyLgogICAgICogQHBhcmFtICAgIGxvb2t1cF92YWx1ZSAgICBUaGUgdmFsdWUgdGhhdCB5b3Ugd2FudCB0byBtYXRjaCBpbiBsb29rdXBfYXJyYXkKICAgICAqIEBwYXJhbSAgICBsb29rdXBfYXJyYXkgICAgVGhlIHJhbmdlIG9mIGNlbGxzIGJlaW5nIHNlYXJjaGVkCiAgICAgKiBAcGFyYW0gICAgaW5kZXhfbnVtYmVyICAgIFRoZSBjb2x1bW4gbnVtYmVyIGluIHRhYmxlX2FycmF5IGZyb20gd2hpY2ggdGhlIG1hdGNoaW5nIHZhbHVlIG11c3QgYmUgcmV0dXJuZWQuIFRoZSBmaXJzdCBjb2x1bW4gaXMgMS4KICAgICAqIEBwYXJhbSAgICBub3RfZXhhY3RfbWF0Y2ggICAgRGV0ZXJtaW5lcyBpZiB5b3UgYXJlIGxvb2tpbmcgZm9yIGFuIGV4YWN0IG1hdGNoIGJhc2VkIG9uIGxvb2t1cF92YWx1ZS4KICAgICAqIEByZXR1cm4gICAgbWl4ZWQgICAgICAgICAgICBUaGUgdmFsdWUgb2YgdGhlIGZvdW5kIGNlbGwKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBWTE9PS1VQKCRsb29rdXBfdmFsdWUsICRsb29rdXBfYXJyYXksICRpbmRleF9udW1iZXIsICRub3RfZXhhY3RfbWF0Y2ggPSB0cnVlKQogICAgewogICAgICAgICRsb29rdXBfdmFsdWUgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbG9va3VwX3ZhbHVlKTsKICAgICAgICAkaW5kZXhfbnVtYmVyICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGluZGV4X251bWJlcik7CiAgICAgICAgJG5vdF9leGFjdF9tYXRjaCA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRub3RfZXhhY3RfbWF0Y2gpOwoKICAgICAgICAvLyBpbmRleF9udW1iZXIgbXVzdCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gMQogICAgICAgIGlmICgkaW5kZXhfbnVtYmVyIDwgMSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gaW5kZXhfbnVtYmVyIG11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBudW1iZXIgb2YgY29sdW1ucyBpbiBsb29rdXBfYXJyYXkKICAgICAgICBpZiAoKCFpc19hcnJheSgkbG9va3VwX2FycmF5KSkgfHwgKGVtcHR5KCRsb29rdXBfYXJyYXkpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRUYoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkZiA9IGFycmF5X2tleXMoJGxvb2t1cF9hcnJheSk7CiAgICAgICAgICAgICRmaXJzdFJvdyA9IGFycmF5X3BvcCgkZik7CiAgICAgICAgICAgIGlmICgoIWlzX2FycmF5KCRsb29rdXBfYXJyYXlbJGZpcnN0Um93XSkpIHx8ICgkaW5kZXhfbnVtYmVyID4gY291bnQoJGxvb2t1cF9hcnJheVskZmlyc3RSb3ddKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFRigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGNvbHVtbktleXMgPSBhcnJheV9rZXlzKCRsb29rdXBfYXJyYXlbJGZpcnN0Um93XSk7CiAgICAgICAgICAgICAgICAkcmV0dXJuQ29sdW1uID0gJGNvbHVtbktleXNbLS0kaW5kZXhfbnVtYmVyXTsKICAgICAgICAgICAgICAgICRmaXJzdENvbHVtbiA9IGFycmF5X3NoaWZ0KCRjb2x1bW5LZXlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCEkbm90X2V4YWN0X21hdGNoKSB7CiAgICAgICAgICAgIHVhc29ydCgkbG9va3VwX2FycmF5LCBhcnJheSgnc2VsZicsICd2bG9va3VwU29ydCcpKTsKICAgICAgICB9CgogICAgICAgICRyb3dOdW1iZXIgPSAkcm93VmFsdWUgPSBmYWxzZTsKICAgICAgICBmb3JlYWNoICgkbG9va3VwX2FycmF5IGFzICRyb3dLZXkgPT4gJHJvd0RhdGEpIHsKICAgICAgICAgICAgaWYgKChpc19udW1lcmljKCRsb29rdXBfdmFsdWUpICYmIGlzX251bWVyaWMoJHJvd0RhdGFbJGZpcnN0Q29sdW1uXSkgJiYgKCRyb3dEYXRhWyRmaXJzdENvbHVtbl0gPiAkbG9va3VwX3ZhbHVlKSkgfHwKICAgICAgICAgICAgICAgICghaXNfbnVtZXJpYygkbG9va3VwX3ZhbHVlKSAmJiAhaXNfbnVtZXJpYygkcm93RGF0YVskZmlyc3RDb2x1bW5dKSAmJiAoc3RydG9sb3dlcigkcm93RGF0YVskZmlyc3RDb2x1bW5dKSA+IHN0cnRvbG93ZXIoJGxvb2t1cF92YWx1ZSkpKSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHJvd051bWJlciA9ICRyb3dLZXk7CiAgICAgICAgICAgICRyb3dWYWx1ZSA9ICRyb3dEYXRhWyRmaXJzdENvbHVtbl07CiAgICAgICAgfQoKICAgICAgICBpZiAoJHJvd051bWJlciAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKCghJG5vdF9leGFjdF9tYXRjaCkgJiYgKCRyb3dWYWx1ZSAhPSAkbG9va3VwX3ZhbHVlKSkgewogICAgICAgICAgICAgICAgLy8gICAgaWYgYW4gZXhhY3QgbWF0Y2ggaXMgcmVxdWlyZWQsIHdlIGhhdmUgd2hhdCB3ZSBuZWVkIHRvIHJldHVybiBhbiBhcHByb3ByaWF0ZSByZXNwb25zZQogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TkEoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vICAgIG90aGVyd2lzZSByZXR1cm4gdGhlIGFwcHJvcHJpYXRlIHZhbHVlCiAgICAgICAgICAgICAgICByZXR1cm4gJGxvb2t1cF9hcnJheVskcm93TnVtYmVyXVskcmV0dXJuQ29sdW1uXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TkEoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBITE9PS1VQCiAgICAgKiBUaGUgSExPT0tVUCBmdW5jdGlvbiBzZWFyY2hlcyBmb3IgdmFsdWUgaW4gdGhlIHRvcC1tb3N0IHJvdyBvZiBsb29rdXBfYXJyYXkgYW5kIHJldHVybnMgdGhlIHZhbHVlIGluIHRoZSBzYW1lIGNvbHVtbiBiYXNlZCBvbiB0aGUgaW5kZXhfbnVtYmVyLgogICAgICogQHBhcmFtICAgIGxvb2t1cF92YWx1ZSAgICBUaGUgdmFsdWUgdGhhdCB5b3Ugd2FudCB0byBtYXRjaCBpbiBsb29rdXBfYXJyYXkKICAgICAqIEBwYXJhbSAgICBsb29rdXBfYXJyYXkgICAgVGhlIHJhbmdlIG9mIGNlbGxzIGJlaW5nIHNlYXJjaGVkCiAgICAgKiBAcGFyYW0gICAgaW5kZXhfbnVtYmVyICAgIFRoZSByb3cgbnVtYmVyIGluIHRhYmxlX2FycmF5IGZyb20gd2hpY2ggdGhlIG1hdGNoaW5nIHZhbHVlIG11c3QgYmUgcmV0dXJuZWQuIFRoZSBmaXJzdCByb3cgaXMgMS4KICAgICAqIEBwYXJhbSAgICBub3RfZXhhY3RfbWF0Y2ggRGV0ZXJtaW5lcyBpZiB5b3UgYXJlIGxvb2tpbmcgZm9yIGFuIGV4YWN0IG1hdGNoIGJhc2VkIG9uIGxvb2t1cF92YWx1ZS4KICAgICAqIEByZXR1cm4gICBtaXhlZCAgICAgICAgICAgVGhlIHZhbHVlIG9mIHRoZSBmb3VuZCBjZWxsCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gSExPT0tVUCgkbG9va3VwX3ZhbHVlLCAkbG9va3VwX2FycmF5LCAkaW5kZXhfbnVtYmVyLCAkbm90X2V4YWN0X21hdGNoID0gdHJ1ZSkKICAgIHsKICAgICAgICAkbG9va3VwX3ZhbHVlICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbG9va3VwX3ZhbHVlKTsKICAgICAgICAkaW5kZXhfbnVtYmVyICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkaW5kZXhfbnVtYmVyKTsKICAgICAgICAkbm90X2V4YWN0X21hdGNoICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJG5vdF9leGFjdF9tYXRjaCk7CgogICAgICAgIC8vIGluZGV4X251bWJlciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAxCiAgICAgICAgaWYgKCRpbmRleF9udW1iZXIgPCAxKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpbmRleF9udW1iZXIgbXVzdCBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBjb2x1bW5zIGluIGxvb2t1cF9hcnJheQogICAgICAgIGlmICgoIWlzX2FycmF5KCRsb29rdXBfYXJyYXkpKSB8fCAoZW1wdHkoJGxvb2t1cF9hcnJheSkpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFRigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRmID0gYXJyYXlfa2V5cygkbG9va3VwX2FycmF5KTsKICAgICAgICAgICAgJGZpcnN0Um93ID0gYXJyYXlfcG9wKCRmKTsKICAgICAgICAgICAgaWYgKCghaXNfYXJyYXkoJGxvb2t1cF9hcnJheVskZmlyc3RSb3ddKSkgfHwgKCRpbmRleF9udW1iZXIgPiBjb3VudCgkbG9va3VwX2FycmF5WyRmaXJzdFJvd10pKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVGKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkY29sdW1uS2V5cyA9IGFycmF5X2tleXMoJGxvb2t1cF9hcnJheVskZmlyc3RSb3ddKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmlyc3RrZXkgPSAkZlswXSAtIDE7CiAgICAgICAgICAgICAgICAkcmV0dXJuQ29sdW1uID0gJGZpcnN0a2V5ICsgJGluZGV4X251bWJlcjsKICAgICAgICAgICAgICAgICRmaXJzdENvbHVtbiA9IGFycmF5X3NoaWZ0KCRmKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCEkbm90X2V4YWN0X21hdGNoKSB7CiAgICAgICAgICAgICRmaXJzdFJvd0ggPSBhc29ydCgkbG9va3VwX2FycmF5WyRmaXJzdENvbHVtbl0pOwogICAgICAgIH0KCiAgICAgICAgJHJvd051bWJlciA9ICRyb3dWYWx1ZSA9IGZhbHNlOwogICAgICAgIGZvcmVhY2ggKCRsb29rdXBfYXJyYXlbJGZpcnN0Q29sdW1uXSBhcyAkcm93S2V5ID0+ICRyb3dEYXRhKSB7CiAgICAgICAgICAgIGlmICgoaXNfbnVtZXJpYygkbG9va3VwX3ZhbHVlKSAmJiBpc19udW1lcmljKCRyb3dEYXRhKSAmJiAoJHJvd0RhdGEgPiAkbG9va3VwX3ZhbHVlKSkgfHwKICAgICAgICAgICAgICAgICghaXNfbnVtZXJpYygkbG9va3VwX3ZhbHVlKSAmJiAhaXNfbnVtZXJpYygkcm93RGF0YSkgJiYgKHN0cnRvbG93ZXIoJHJvd0RhdGEpID4gc3RydG9sb3dlcigkbG9va3VwX3ZhbHVlKSkpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAkcm93TnVtYmVyID0gJHJvd0tleTsKICAgICAgICAgICAgJHJvd1ZhbHVlID0gJHJvd0RhdGE7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHJvd051bWJlciAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKCghJG5vdF9leGFjdF9tYXRjaCkgJiYgKCRyb3dWYWx1ZSAhPSAkbG9va3VwX3ZhbHVlKSkgewogICAgICAgICAgICAgICAgLy8gIGlmIGFuIGV4YWN0IG1hdGNoIGlzIHJlcXVpcmVkLCB3ZSBoYXZlIHdoYXQgd2UgbmVlZCB0byByZXR1cm4gYW4gYXBwcm9wcmlhdGUgcmVzcG9uc2UKICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5BKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAgb3RoZXJ3aXNlIHJldHVybiB0aGUgYXBwcm9wcmlhdGUgdmFsdWUKICAgICAgICAgICAgICAgIHJldHVybiAkbG9va3VwX2FycmF5WyRyZXR1cm5Db2x1bW5dWyRyb3dOdW1iZXJdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOQSgpOwogICAgfQoKCiAgICAvKioKICAgICAqIExPT0tVUAogICAgICogVGhlIExPT0tVUCBmdW5jdGlvbiBzZWFyY2hlcyBmb3IgdmFsdWUgZWl0aGVyIGZyb20gYSBvbmUtcm93IG9yIG9uZS1jb2x1bW4gcmFuZ2Ugb3IgZnJvbSBhbiBhcnJheS4KICAgICAqIEBwYXJhbSAgICBsb29rdXBfdmFsdWUgICAgVGhlIHZhbHVlIHRoYXQgeW91IHdhbnQgdG8gbWF0Y2ggaW4gbG9va3VwX2FycmF5CiAgICAgKiBAcGFyYW0gICAgbG9va3VwX3ZlY3RvciAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgYmVpbmcgc2VhcmNoZWQKICAgICAqIEBwYXJhbSAgICByZXN1bHRfdmVjdG9yICAgIFRoZSBjb2x1bW4gZnJvbSB3aGljaCB0aGUgbWF0Y2hpbmcgdmFsdWUgbXVzdCBiZSByZXR1cm5lZAogICAgICogQHJldHVybiAgICBtaXhlZCAgICAgICAgICAgIFRoZSB2YWx1ZSBvZiB0aGUgZm91bmQgY2VsbAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIExPT0tVUCgkbG9va3VwX3ZhbHVlLCAkbG9va3VwX3ZlY3RvciwgJHJlc3VsdF92ZWN0b3IgPSBudWxsKQogICAgewogICAgICAgICRsb29rdXBfdmFsdWUgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkbG9va3VwX3ZhbHVlKTsKCiAgICAgICAgaWYgKCFpc19hcnJheSgkbG9va3VwX3ZlY3RvcikpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TkEoKTsKICAgICAgICB9CiAgICAgICAgJGxvb2t1cFJvd3MgPSBjb3VudCgkbG9va3VwX3ZlY3Rvcik7CiAgICAgICAgJGwgPSBhcnJheV9rZXlzKCRsb29rdXBfdmVjdG9yKTsKICAgICAgICAkbCA9IGFycmF5X3NoaWZ0KCRsKTsKICAgICAgICAkbG9va3VwQ29sdW1ucyA9IGNvdW50KCRsb29rdXBfdmVjdG9yWyRsXSk7CiAgICAgICAgaWYgKCgoJGxvb2t1cFJvd3MgPT0gMSkgJiYgKCRsb29rdXBDb2x1bW5zID4gMSkpIHx8ICgoJGxvb2t1cFJvd3MgPT0gMikgJiYgKCRsb29rdXBDb2x1bW5zICE9IDIpKSkgewogICAgICAgICAgICAkbG9va3VwX3ZlY3RvciA9IHNlbGY6OlRSQU5TUE9TRSgkbG9va3VwX3ZlY3Rvcik7CiAgICAgICAgICAgICRsb29rdXBSb3dzID0gY291bnQoJGxvb2t1cF92ZWN0b3IpOwogICAgICAgICAgICAkbCA9IGFycmF5X2tleXMoJGxvb2t1cF92ZWN0b3IpOwogICAgICAgICAgICAkbG9va3VwQ29sdW1ucyA9IGNvdW50KCRsb29rdXBfdmVjdG9yW2FycmF5X3NoaWZ0KCRsKV0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzX251bGwoJHJlc3VsdF92ZWN0b3IpKSB7CiAgICAgICAgICAgICRyZXN1bHRfdmVjdG9yID0gJGxvb2t1cF92ZWN0b3I7CiAgICAgICAgfQogICAgICAgICRyZXN1bHRSb3dzID0gY291bnQoJHJlc3VsdF92ZWN0b3IpOwogICAgICAgICRsID0gYXJyYXlfa2V5cygkcmVzdWx0X3ZlY3Rvcik7CiAgICAgICAgJGwgPSBhcnJheV9zaGlmdCgkbCk7CiAgICAgICAgJHJlc3VsdENvbHVtbnMgPSBjb3VudCgkcmVzdWx0X3ZlY3RvclskbF0pOwogICAgICAgIGlmICgoKCRyZXN1bHRSb3dzID09IDEpICYmICgkcmVzdWx0Q29sdW1ucyA+IDEpKSB8fCAoKCRyZXN1bHRSb3dzID09IDIpICYmICgkcmVzdWx0Q29sdW1ucyAhPSAyKSkpIHsKICAgICAgICAgICAgJHJlc3VsdF92ZWN0b3IgPSBzZWxmOjpUUkFOU1BPU0UoJHJlc3VsdF92ZWN0b3IpOwogICAgICAgICAgICAkcmVzdWx0Um93cyA9IGNvdW50KCRyZXN1bHRfdmVjdG9yKTsKICAgICAgICAgICAgJHIgPSBhcnJheV9rZXlzKCRyZXN1bHRfdmVjdG9yKTsKICAgICAgICAgICAgJHJlc3VsdENvbHVtbnMgPSBjb3VudCgkcmVzdWx0X3ZlY3RvclthcnJheV9zaGlmdCgkcildKTsKICAgICAgICB9CgogICAgICAgIGlmICgkbG9va3VwUm93cyA9PSAyKSB7CiAgICAgICAgICAgICRyZXN1bHRfdmVjdG9yID0gYXJyYXlfcG9wKCRsb29rdXBfdmVjdG9yKTsKICAgICAgICAgICAgJGxvb2t1cF92ZWN0b3IgPSBhcnJheV9zaGlmdCgkbG9va3VwX3ZlY3Rvcik7CiAgICAgICAgfQogICAgICAgIGlmICgkbG9va3VwQ29sdW1ucyAhPSAyKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRsb29rdXBfdmVjdG9yIGFzICYkdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgJGsgPSBhcnJheV9rZXlzKCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgJGtleTEgPSAka2V5MiA9IGFycmF5X3NoaWZ0KCRrKTsKICAgICAgICAgICAgICAgICAgICAka2V5MisrOwogICAgICAgICAgICAgICAgICAgICRkYXRhVmFsdWUxID0gJHZhbHVlWyRrZXkxXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGtleTEgPSAwOwogICAgICAgICAgICAgICAgICAgICRrZXkyID0gMTsKICAgICAgICAgICAgICAgICAgICAkZGF0YVZhbHVlMSA9ICR2YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRkYXRhVmFsdWUyID0gYXJyYXlfc2hpZnQoJHJlc3VsdF92ZWN0b3IpOwogICAgICAgICAgICAgICAgaWYgKGlzX2FycmF5KCRkYXRhVmFsdWUyKSkgewogICAgICAgICAgICAgICAgICAgICRkYXRhVmFsdWUyID0gYXJyYXlfc2hpZnQoJGRhdGFWYWx1ZTIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHZhbHVlID0gYXJyYXkoJGtleTEgPT4gJGRhdGFWYWx1ZTEsICRrZXkyID0+ICRkYXRhVmFsdWUyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1bnNldCgkdmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY6OlZMT09LVVAoJGxvb2t1cF92YWx1ZSwgJGxvb2t1cF92ZWN0b3IsIDIpOwogICAgfQp9Cg==",
    "size": "37120"
}