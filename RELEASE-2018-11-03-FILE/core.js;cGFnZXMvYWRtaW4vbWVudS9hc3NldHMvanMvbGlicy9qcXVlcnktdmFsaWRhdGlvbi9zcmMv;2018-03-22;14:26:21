{
    "namaFile": "pages\/admin\/menu\/assets\/js\/libs\/jquery-validation\/src\/core.js",
    "lastUpdate": "2018-03-22+14:26:21.36",
    "contentFile": "JC5leHRlbmQoJC5mbiwgewoJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3ZhbGlkYXRlLwoJdmFsaWRhdGU6IGZ1bmN0aW9uKCBvcHRpb25zICkgewoKCQkvLyBpZiBub3RoaW5nIGlzIHNlbGVjdGVkLCByZXR1cm4gbm90aGluZzsgY2FuJ3QgY2hhaW4gYW55d2F5CgkJaWYgKCAhdGhpcy5sZW5ndGggKSB7CgkJCWlmICggb3B0aW9ucyAmJiBvcHRpb25zLmRlYnVnICYmIHdpbmRvdy5jb25zb2xlICkgewoJCQkJY29uc29sZS53YXJuKCAiTm90aGluZyBzZWxlY3RlZCwgY2FuJ3QgdmFsaWRhdGUsIHJldHVybmluZyBub3RoaW5nLiIgKTsKCQkJfQoJCQlyZXR1cm47CgkJfQoKCQkvLyBjaGVjayBpZiBhIHZhbGlkYXRvciBmb3IgdGhpcyBmb3JtIHdhcyBhbHJlYWR5IGNyZWF0ZWQKCQl2YXIgdmFsaWRhdG9yID0gJC5kYXRhKCB0aGlzWyAwIF0sICJ2YWxpZGF0b3IiICk7CgkJaWYgKCB2YWxpZGF0b3IgKSB7CgkJCXJldHVybiB2YWxpZGF0b3I7CgkJfQoKCQkvLyBBZGQgbm92YWxpZGF0ZSB0YWcgaWYgSFRNTDUuCgkJdGhpcy5hdHRyKCAibm92YWxpZGF0ZSIsICJub3ZhbGlkYXRlIiApOwoKCQl2YWxpZGF0b3IgPSBuZXcgJC52YWxpZGF0b3IoIG9wdGlvbnMsIHRoaXNbIDAgXSApOwoJCSQuZGF0YSggdGhpc1sgMCBdLCAidmFsaWRhdG9yIiwgdmFsaWRhdG9yICk7CgoJCWlmICggdmFsaWRhdG9yLnNldHRpbmdzLm9uc3VibWl0ICkgewoKCQkJdGhpcy52YWxpZGF0ZURlbGVnYXRlKCAiOnN1Ym1pdCIsICJjbGljayIsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggdmFsaWRhdG9yLnNldHRpbmdzLnN1Ym1pdEhhbmRsZXIgKSB7CgkJCQkJdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbiA9IGV2ZW50LnRhcmdldDsKCQkJCX0KCQkJCS8vIGFsbG93IHN1cHByZXNzaW5nIHZhbGlkYXRpb24gYnkgYWRkaW5nIGEgY2FuY2VsIGNsYXNzIHRvIHRoZSBzdWJtaXQgYnV0dG9uCgkJCQlpZiAoICQoIGV2ZW50LnRhcmdldCApLmhhc0NsYXNzKCAiY2FuY2VsIiApICkgewoJCQkJCXZhbGlkYXRvci5jYW5jZWxTdWJtaXQgPSB0cnVlOwoJCQkJfQoKCQkJCS8vIGFsbG93IHN1cHByZXNzaW5nIHZhbGlkYXRpb24gYnkgYWRkaW5nIHRoZSBodG1sNSBmb3Jtbm92YWxpZGF0ZSBhdHRyaWJ1dGUgdG8gdGhlIHN1Ym1pdCBidXR0b24KCQkJCWlmICggJCggZXZlbnQudGFyZ2V0ICkuYXR0ciggImZvcm1ub3ZhbGlkYXRlIiApICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJdmFsaWRhdG9yLmNhbmNlbFN1Ym1pdCA9IHRydWU7CgkJCQl9CgkJCX0pOwoKCQkJLy8gdmFsaWRhdGUgdGhlIGZvcm0gb24gc3VibWl0CgkJCXRoaXMuc3VibWl0KCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIHZhbGlkYXRvci5zZXR0aW5ncy5kZWJ1ZyApIHsKCQkJCQkvLyBwcmV2ZW50IGZvcm0gc3VibWl0IHRvIGJlIGFibGUgdG8gc2VlIGNvbnNvbGUgb3V0cHV0CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCX0KCQkJCWZ1bmN0aW9uIGhhbmRsZSgpIHsKCQkJCQl2YXIgaGlkZGVuLCByZXN1bHQ7CgkJCQkJaWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3Muc3VibWl0SGFuZGxlciApIHsKCQkJCQkJaWYgKCB2YWxpZGF0b3Iuc3VibWl0QnV0dG9uICkgewoJCQkJCQkJLy8gaW5zZXJ0IGEgaGlkZGVuIGlucHV0IGFzIGEgcmVwbGFjZW1lbnQgZm9yIHRoZSBtaXNzaW5nIHN1Ym1pdCBidXR0b24KCQkJCQkJCWhpZGRlbiA9ICQoICI8aW5wdXQgdHlwZT0naGlkZGVuJy8+IiApCgkJCQkJCQkJLmF0dHIoICJuYW1lIiwgdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbi5uYW1lICkKCQkJCQkJCQkudmFsKCAkKCB2YWxpZGF0b3Iuc3VibWl0QnV0dG9uICkudmFsKCkgKQoJCQkJCQkJCS5hcHBlbmRUbyggdmFsaWRhdG9yLmN1cnJlbnRGb3JtICk7CgkJCQkJCX0KCQkJCQkJcmVzdWx0ID0gdmFsaWRhdG9yLnNldHRpbmdzLnN1Ym1pdEhhbmRsZXIuY2FsbCggdmFsaWRhdG9yLCB2YWxpZGF0b3IuY3VycmVudEZvcm0sIGV2ZW50ICk7CgkJCQkJCWlmICggdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbiApIHsKCQkJCQkJCS8vIGFuZCBjbGVhbiB1cCBhZnRlcndhcmRzOyB0aGFua3MgdG8gbm8tYmxvY2stc2NvcGUsIGhpZGRlbiBjYW4gYmUgcmVmZXJlbmNlZAoJCQkJCQkJaGlkZGVuLnJlbW92ZSgpOwoJCQkJCQl9CgkJCQkJCWlmICggcmVzdWx0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCQlyZXR1cm4gcmVzdWx0OwoJCQkJCQl9CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgoJCQkJLy8gcHJldmVudCBzdWJtaXQgZm9yIGludmFsaWQgZm9ybXMgb3IgY3VzdG9tIHN1Ym1pdCBoYW5kbGVycwoJCQkJaWYgKCB2YWxpZGF0b3IuY2FuY2VsU3VibWl0ICkgewoJCQkJCXZhbGlkYXRvci5jYW5jZWxTdWJtaXQgPSBmYWxzZTsKCQkJCQlyZXR1cm4gaGFuZGxlKCk7CgkJCQl9CgkJCQlpZiAoIHZhbGlkYXRvci5mb3JtKCkgKSB7CgkJCQkJaWYgKCB2YWxpZGF0b3IucGVuZGluZ1JlcXVlc3QgKSB7CgkJCQkJCXZhbGlkYXRvci5mb3JtU3VibWl0dGVkID0gdHJ1ZTsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCQlyZXR1cm4gaGFuZGxlKCk7CgkJCQl9IGVsc2UgewoJCQkJCXZhbGlkYXRvci5mb2N1c0ludmFsaWQoKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0pOwoJCX0KCgkJcmV0dXJuIHZhbGlkYXRvcjsKCX0sCgkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvdmFsaWQvCgl2YWxpZDogZnVuY3Rpb24oKSB7CgkJdmFyIHZhbGlkLCB2YWxpZGF0b3I7CgoJCWlmICggJCggdGhpc1sgMCBdICkuaXMoICJmb3JtIiApICkgewoJCQl2YWxpZCA9IHRoaXMudmFsaWRhdGUoKS5mb3JtKCk7CgkJfSBlbHNlIHsKCQkJdmFsaWQgPSB0cnVlOwoJCQl2YWxpZGF0b3IgPSAkKCB0aGlzWyAwIF0uZm9ybSApLnZhbGlkYXRlKCk7CgkJCXRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQl2YWxpZCA9IHZhbGlkYXRvci5lbGVtZW50KCB0aGlzICkgJiYgdmFsaWQ7CgkJCX0pOwoJCX0KCQlyZXR1cm4gdmFsaWQ7Cgl9LAoJLy8gYXR0cmlidXRlczogc3BhY2Ugc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlcyB0byByZXRyaWV2ZSBhbmQgcmVtb3ZlCglyZW1vdmVBdHRyczogZnVuY3Rpb24oIGF0dHJpYnV0ZXMgKSB7CgkJdmFyIHJlc3VsdCA9IHt9LAoJCQkkZWxlbWVudCA9IHRoaXM7CgkJJC5lYWNoKCBhdHRyaWJ1dGVzLnNwbGl0KCAvXHMvICksIGZ1bmN0aW9uKCBpbmRleCwgdmFsdWUgKSB7CgkJCXJlc3VsdFsgdmFsdWUgXSA9ICRlbGVtZW50LmF0dHIoIHZhbHVlICk7CgkJCSRlbGVtZW50LnJlbW92ZUF0dHIoIHZhbHVlICk7CgkJfSk7CgkJcmV0dXJuIHJlc3VsdDsKCX0sCgkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcnVsZXMvCglydWxlczogZnVuY3Rpb24oIGNvbW1hbmQsIGFyZ3VtZW50ICkgewoJCXZhciBlbGVtZW50ID0gdGhpc1sgMCBdLAoJCQlzZXR0aW5ncywgc3RhdGljUnVsZXMsIGV4aXN0aW5nUnVsZXMsIGRhdGEsIHBhcmFtLCBmaWx0ZXJlZDsKCgkJaWYgKCBjb21tYW5kICkgewoJCQlzZXR0aW5ncyA9ICQuZGF0YSggZWxlbWVudC5mb3JtLCAidmFsaWRhdG9yIiApLnNldHRpbmdzOwoJCQlzdGF0aWNSdWxlcyA9IHNldHRpbmdzLnJ1bGVzOwoJCQlleGlzdGluZ1J1bGVzID0gJC52YWxpZGF0b3Iuc3RhdGljUnVsZXMoIGVsZW1lbnQgKTsKCQkJc3dpdGNoICggY29tbWFuZCApIHsKCQkJY2FzZSAiYWRkIjoKCQkJCSQuZXh0ZW5kKCBleGlzdGluZ1J1bGVzLCAkLnZhbGlkYXRvci5ub3JtYWxpemVSdWxlKCBhcmd1bWVudCApICk7CgkJCQkvLyByZW1vdmUgbWVzc2FnZXMgZnJvbSBydWxlcywgYnV0IGFsbG93IHRoZW0gdG8gYmUgc2V0IHNlcGFyYXRlbHkKCQkJCWRlbGV0ZSBleGlzdGluZ1J1bGVzLm1lc3NhZ2VzOwoJCQkJc3RhdGljUnVsZXNbIGVsZW1lbnQubmFtZSBdID0gZXhpc3RpbmdSdWxlczsKCQkJCWlmICggYXJndW1lbnQubWVzc2FnZXMgKSB7CgkJCQkJc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdID0gJC5leHRlbmQoIHNldHRpbmdzLm1lc3NhZ2VzWyBlbGVtZW50Lm5hbWUgXSwgYXJndW1lbnQubWVzc2FnZXMgKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQljYXNlICJyZW1vdmUiOgoJCQkJaWYgKCAhYXJndW1lbnQgKSB7CgkJCQkJZGVsZXRlIHN0YXRpY1J1bGVzWyBlbGVtZW50Lm5hbWUgXTsKCQkJCQlyZXR1cm4gZXhpc3RpbmdSdWxlczsKCQkJCX0KCQkJCWZpbHRlcmVkID0ge307CgkJCQkkLmVhY2goIGFyZ3VtZW50LnNwbGl0KCAvXHMvICksIGZ1bmN0aW9uKCBpbmRleCwgbWV0aG9kICkgewoJCQkJCWZpbHRlcmVkWyBtZXRob2QgXSA9IGV4aXN0aW5nUnVsZXNbIG1ldGhvZCBdOwoJCQkJCWRlbGV0ZSBleGlzdGluZ1J1bGVzWyBtZXRob2QgXTsKCQkJCQlpZiAoIG1ldGhvZCA9PT0gInJlcXVpcmVkIiApIHsKCQkJCQkJJCggZWxlbWVudCApLnJlbW92ZUF0dHIoICJhcmlhLXJlcXVpcmVkIiApOwoJCQkJCX0KCQkJCX0pOwoJCQkJcmV0dXJuIGZpbHRlcmVkOwoJCQl9CgkJfQoKCQlkYXRhID0gJC52YWxpZGF0b3Iubm9ybWFsaXplUnVsZXMoCgkJJC5leHRlbmQoCgkJCXt9LAoJCQkkLnZhbGlkYXRvci5jbGFzc1J1bGVzKCBlbGVtZW50ICksCgkJCSQudmFsaWRhdG9yLmF0dHJpYnV0ZVJ1bGVzKCBlbGVtZW50ICksCgkJCSQudmFsaWRhdG9yLmRhdGFSdWxlcyggZWxlbWVudCApLAoJCQkkLnZhbGlkYXRvci5zdGF0aWNSdWxlcyggZWxlbWVudCApCgkJKSwgZWxlbWVudCApOwoKCQkvLyBtYWtlIHN1cmUgcmVxdWlyZWQgaXMgYXQgZnJvbnQKCQlpZiAoIGRhdGEucmVxdWlyZWQgKSB7CgkJCXBhcmFtID0gZGF0YS5yZXF1aXJlZDsKCQkJZGVsZXRlIGRhdGEucmVxdWlyZWQ7CgkJCWRhdGEgPSAkLmV4dGVuZCggeyByZXF1aXJlZDogcGFyYW0gfSwgZGF0YSApOwoJCQkkKCBlbGVtZW50ICkuYXR0ciggImFyaWEtcmVxdWlyZWQiLCAidHJ1ZSIgKTsKCQl9CgoJCS8vIG1ha2Ugc3VyZSByZW1vdGUgaXMgYXQgYmFjawoJCWlmICggZGF0YS5yZW1vdGUgKSB7CgkJCXBhcmFtID0gZGF0YS5yZW1vdGU7CgkJCWRlbGV0ZSBkYXRhLnJlbW90ZTsKCQkJZGF0YSA9ICQuZXh0ZW5kKCBkYXRhLCB7IHJlbW90ZTogcGFyYW0gfSk7CgkJfQoKCQlyZXR1cm4gZGF0YTsKCX0KfSk7CgovLyBDdXN0b20gc2VsZWN0b3JzCiQuZXh0ZW5kKCAkLmV4cHJbICI6IiBdLCB7CgkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvYmxhbmstc2VsZWN0b3IvCglibGFuazogZnVuY3Rpb24oIGEgKSB7CgkJcmV0dXJuICEkLnRyaW0oICIiICsgJCggYSApLnZhbCgpICk7Cgl9LAoJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2ZpbGxlZC1zZWxlY3Rvci8KCWZpbGxlZDogZnVuY3Rpb24oIGEgKSB7CgkJcmV0dXJuICEhJC50cmltKCAiIiArICQoIGEgKS52YWwoKSApOwoJfSwKCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy91bmNoZWNrZWQtc2VsZWN0b3IvCgl1bmNoZWNrZWQ6IGZ1bmN0aW9uKCBhICkgewoJCXJldHVybiAhJCggYSApLnByb3AoICJjaGVja2VkIiApOwoJfQp9KTsKCi8vIGNvbnN0cnVjdG9yIGZvciB2YWxpZGF0b3IKJC52YWxpZGF0b3IgPSBmdW5jdGlvbiggb3B0aW9ucywgZm9ybSApIHsKCXRoaXMuc2V0dGluZ3MgPSAkLmV4dGVuZCggdHJ1ZSwge30sICQudmFsaWRhdG9yLmRlZmF1bHRzLCBvcHRpb25zICk7Cgl0aGlzLmN1cnJlbnRGb3JtID0gZm9ybTsKCXRoaXMuaW5pdCgpOwp9OwoKLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2pRdWVyeS52YWxpZGF0b3IuZm9ybWF0LwokLnZhbGlkYXRvci5mb3JtYXQgPSBmdW5jdGlvbiggc291cmNlLCBwYXJhbXMgKSB7CglpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKCkgewoJCQl2YXIgYXJncyA9ICQubWFrZUFycmF5KCBhcmd1bWVudHMgKTsKCQkJYXJncy51bnNoaWZ0KCBzb3VyY2UgKTsKCQkJcmV0dXJuICQudmFsaWRhdG9yLmZvcm1hdC5hcHBseSggdGhpcywgYXJncyApOwoJCX07Cgl9CglpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIHBhcmFtcy5jb25zdHJ1Y3RvciAhPT0gQXJyYXkgICkgewoJCXBhcmFtcyA9ICQubWFrZUFycmF5KCBhcmd1bWVudHMgKS5zbGljZSggMSApOwoJfQoJaWYgKCBwYXJhbXMuY29uc3RydWN0b3IgIT09IEFycmF5ICkgewoJCXBhcmFtcyA9IFsgcGFyYW1zIF07Cgl9CgkkLmVhY2goIHBhcmFtcywgZnVuY3Rpb24oIGksIG4gKSB7CgkJc291cmNlID0gc291cmNlLnJlcGxhY2UoIG5ldyBSZWdFeHAoICJcXHsiICsgaSArICJcXH0iLCAiZyIgKSwgZnVuY3Rpb24oKSB7CgkJCXJldHVybiBuOwoJCX0pOwoJfSk7CglyZXR1cm4gc291cmNlOwp9OwoKJC5leHRlbmQoICQudmFsaWRhdG9yLCB7CgoJZGVmYXVsdHM6IHsKCQltZXNzYWdlczoge30sCgkJZ3JvdXBzOiB7fSwKCQlydWxlczoge30sCgkJZXJyb3JDbGFzczogImVycm9yIiwKCQl2YWxpZENsYXNzOiAidmFsaWQiLAoJCWVycm9yRWxlbWVudDogImxhYmVsIiwKCQlmb2N1c0NsZWFudXA6IGZhbHNlLAoJCWZvY3VzSW52YWxpZDogdHJ1ZSwKCQllcnJvckNvbnRhaW5lcjogJCggW10gKSwKCQllcnJvckxhYmVsQ29udGFpbmVyOiAkKCBbXSApLAoJCW9uc3VibWl0OiB0cnVlLAoJCWlnbm9yZTogIjpoaWRkZW4iLAoJCWlnbm9yZVRpdGxlOiBmYWxzZSwKCQlvbmZvY3VzaW46IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCQl0aGlzLmxhc3RBY3RpdmUgPSBlbGVtZW50OwoKCQkJLy8gSGlkZSBlcnJvciBsYWJlbCBhbmQgcmVtb3ZlIGVycm9yIGNsYXNzIG9uIGZvY3VzIGlmIGVuYWJsZWQKCQkJaWYgKCB0aGlzLnNldHRpbmdzLmZvY3VzQ2xlYW51cCApIHsKCQkJCWlmICggdGhpcy5zZXR0aW5ncy51bmhpZ2hsaWdodCApIHsKCQkJCQl0aGlzLnNldHRpbmdzLnVuaGlnaGxpZ2h0LmNhbGwoIHRoaXMsIGVsZW1lbnQsIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcywgdGhpcy5zZXR0aW5ncy52YWxpZENsYXNzICk7CgkJCQl9CgkJCQl0aGlzLmhpZGVUaGVzZSggdGhpcy5lcnJvcnNGb3IoIGVsZW1lbnQgKSApOwoJCQl9CgkJfSwKCQlvbmZvY3Vzb3V0OiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQkJaWYgKCAhdGhpcy5jaGVja2FibGUoIGVsZW1lbnQgKSAmJiAoIGVsZW1lbnQubmFtZSBpbiB0aGlzLnN1Ym1pdHRlZCB8fCAhdGhpcy5vcHRpb25hbCggZWxlbWVudCApICkgKSB7CgkJCQl0aGlzLmVsZW1lbnQoIGVsZW1lbnQgKTsKCQkJfQoJCX0sCgkJb25rZXl1cDogZnVuY3Rpb24oIGVsZW1lbnQsIGV2ZW50ICkgewoJCQlpZiAoIGV2ZW50LndoaWNoID09PSA5ICYmIHRoaXMuZWxlbWVudFZhbHVlKCBlbGVtZW50ICkgPT09ICIiICkgewoJCQkJcmV0dXJuOwoJCQl9IGVsc2UgaWYgKCBlbGVtZW50Lm5hbWUgaW4gdGhpcy5zdWJtaXR0ZWQgfHwgZWxlbWVudCA9PT0gdGhpcy5sYXN0RWxlbWVudCApIHsKCQkJCXRoaXMuZWxlbWVudCggZWxlbWVudCApOwoJCQl9CgkJfSwKCQlvbmNsaWNrOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQkJLy8gY2xpY2sgb24gc2VsZWN0cywgcmFkaW9idXR0b25zIGFuZCBjaGVja2JveGVzCgkJCWlmICggZWxlbWVudC5uYW1lIGluIHRoaXMuc3VibWl0dGVkICkgewoJCQkJdGhpcy5lbGVtZW50KCBlbGVtZW50ICk7CgoJCQkvLyBvciBvcHRpb24gZWxlbWVudHMsIGNoZWNrIHBhcmVudCBzZWxlY3QgaW4gdGhhdCBjYXNlCgkJCX0gZWxzZSBpZiAoIGVsZW1lbnQucGFyZW50Tm9kZS5uYW1lIGluIHRoaXMuc3VibWl0dGVkICkgewoJCQkJdGhpcy5lbGVtZW50KCBlbGVtZW50LnBhcmVudE5vZGUgKTsKCQkJfQoJCX0sCgkJaGlnaGxpZ2h0OiBmdW5jdGlvbiggZWxlbWVudCwgZXJyb3JDbGFzcywgdmFsaWRDbGFzcyApIHsKCQkJaWYgKCBlbGVtZW50LnR5cGUgPT09ICJyYWRpbyIgKSB7CgkJCQl0aGlzLmZpbmRCeU5hbWUoIGVsZW1lbnQubmFtZSApLmFkZENsYXNzKCBlcnJvckNsYXNzICkucmVtb3ZlQ2xhc3MoIHZhbGlkQ2xhc3MgKTsKCQkJfSBlbHNlIHsKCQkJCSQoIGVsZW1lbnQgKS5hZGRDbGFzcyggZXJyb3JDbGFzcyApLnJlbW92ZUNsYXNzKCB2YWxpZENsYXNzICk7CgkJCX0KCQl9LAoJCXVuaGlnaGxpZ2h0OiBmdW5jdGlvbiggZWxlbWVudCwgZXJyb3JDbGFzcywgdmFsaWRDbGFzcyApIHsKCQkJaWYgKCBlbGVtZW50LnR5cGUgPT09ICJyYWRpbyIgKSB7CgkJCQl0aGlzLmZpbmRCeU5hbWUoIGVsZW1lbnQubmFtZSApLnJlbW92ZUNsYXNzKCBlcnJvckNsYXNzICkuYWRkQ2xhc3MoIHZhbGlkQ2xhc3MgKTsKCQkJfSBlbHNlIHsKCQkJCSQoIGVsZW1lbnQgKS5yZW1vdmVDbGFzcyggZXJyb3JDbGFzcyApLmFkZENsYXNzKCB2YWxpZENsYXNzICk7CgkJCX0KCQl9Cgl9LAoKCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9qUXVlcnkudmFsaWRhdG9yLnNldERlZmF1bHRzLwoJc2V0RGVmYXVsdHM6IGZ1bmN0aW9uKCBzZXR0aW5ncyApIHsKCQkkLmV4dGVuZCggJC52YWxpZGF0b3IuZGVmYXVsdHMsIHNldHRpbmdzICk7Cgl9LAoKCW1lc3NhZ2VzOiB7CgkJcmVxdWlyZWQ6ICJUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLiIsCgkJcmVtb3RlOiAiUGxlYXNlIGZpeCB0aGlzIGZpZWxkLiIsCgkJZW1haWw6ICJQbGVhc2UgZW50ZXIgYSB2YWxpZCBlbWFpbCBhZGRyZXNzLiIsCgkJdXJsOiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgVVJMLiIsCgkJZGF0ZTogIlBsZWFzZSBlbnRlciBhIHZhbGlkIGRhdGUuIiwKCQlkYXRlSVNPOiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgZGF0ZSAoIElTTyApLiIsCgkJbnVtYmVyOiAiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLiIsCgkJZGlnaXRzOiAiUGxlYXNlIGVudGVyIG9ubHkgZGlnaXRzLiIsCgkJY3JlZGl0Y2FyZDogIlBsZWFzZSBlbnRlciBhIHZhbGlkIGNyZWRpdCBjYXJkIG51bWJlci4iLAoJCWVxdWFsVG86ICJQbGVhc2UgZW50ZXIgdGhlIHNhbWUgdmFsdWUgYWdhaW4uIiwKCQltYXhsZW5ndGg6ICQudmFsaWRhdG9yLmZvcm1hdCggIlBsZWFzZSBlbnRlciBubyBtb3JlIHRoYW4gezB9IGNoYXJhY3RlcnMuIiApLAoJCW1pbmxlbmd0aDogJC52YWxpZGF0b3IuZm9ybWF0KCAiUGxlYXNlIGVudGVyIGF0IGxlYXN0IHswfSBjaGFyYWN0ZXJzLiIgKSwKCQlyYW5nZWxlbmd0aDogJC52YWxpZGF0b3IuZm9ybWF0KCAiUGxlYXNlIGVudGVyIGEgdmFsdWUgYmV0d2VlbiB7MH0gYW5kIHsxfSBjaGFyYWN0ZXJzIGxvbmcuIiApLAoJCXJhbmdlOiAkLnZhbGlkYXRvci5mb3JtYXQoICJQbGVhc2UgZW50ZXIgYSB2YWx1ZSBiZXR3ZWVuIHswfSBhbmQgezF9LiIgKSwKCQltYXg6ICQudmFsaWRhdG9yLmZvcm1hdCggIlBsZWFzZSBlbnRlciBhIHZhbHVlIGxlc3MgdGhhbiBvciBlcXVhbCB0byB7MH0uIiApLAoJCW1pbjogJC52YWxpZGF0b3IuZm9ybWF0KCAiUGxlYXNlIGVudGVyIGEgdmFsdWUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHswfS4iICkKCX0sCgoJYXV0b0NyZWF0ZVJhbmdlczogZmFsc2UsCgoJcHJvdG90eXBlOiB7CgoJCWluaXQ6IGZ1bmN0aW9uKCkgewoJCQl0aGlzLmxhYmVsQ29udGFpbmVyID0gJCggdGhpcy5zZXR0aW5ncy5lcnJvckxhYmVsQ29udGFpbmVyICk7CgkJCXRoaXMuZXJyb3JDb250ZXh0ID0gdGhpcy5sYWJlbENvbnRhaW5lci5sZW5ndGggJiYgdGhpcy5sYWJlbENvbnRhaW5lciB8fCAkKCB0aGlzLmN1cnJlbnRGb3JtICk7CgkJCXRoaXMuY29udGFpbmVycyA9ICQoIHRoaXMuc2V0dGluZ3MuZXJyb3JDb250YWluZXIgKS5hZGQoIHRoaXMuc2V0dGluZ3MuZXJyb3JMYWJlbENvbnRhaW5lciApOwoJCQl0aGlzLnN1Ym1pdHRlZCA9IHt9OwoJCQl0aGlzLnZhbHVlQ2FjaGUgPSB7fTsKCQkJdGhpcy5wZW5kaW5nUmVxdWVzdCA9IDA7CgkJCXRoaXMucGVuZGluZyA9IHt9OwoJCQl0aGlzLmludmFsaWQgPSB7fTsKCQkJdGhpcy5yZXNldCgpOwoKCQkJdmFyIGdyb3VwcyA9ICggdGhpcy5ncm91cHMgPSB7fSApLAoJCQkJcnVsZXM7CgkJCSQuZWFjaCggdGhpcy5zZXR0aW5ncy5ncm91cHMsIGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICkgewoJCQkJCXZhbHVlID0gdmFsdWUuc3BsaXQoIC9ccy8gKTsKCQkJCX0KCQkJCSQuZWFjaCggdmFsdWUsIGZ1bmN0aW9uKCBpbmRleCwgbmFtZSApIHsKCQkJCQlncm91cHNbIG5hbWUgXSA9IGtleTsKCQkJCX0pOwoJCQl9KTsKCQkJcnVsZXMgPSB0aGlzLnNldHRpbmdzLnJ1bGVzOwoJCQkkLmVhY2goIHJ1bGVzLCBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQkJCXJ1bGVzWyBrZXkgXSA9ICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGUoIHZhbHVlICk7CgkJCX0pOwoKCQkJZnVuY3Rpb24gZGVsZWdhdGUoIGV2ZW50ICkgewoJCQkJdmFyIHZhbGlkYXRvciA9ICQuZGF0YSggdGhpc1sgMCBdLmZvcm0sICJ2YWxpZGF0b3IiICksCgkJCQkJZXZlbnRUeXBlID0gIm9uIiArIGV2ZW50LnR5cGUucmVwbGFjZSggL152YWxpZGF0ZS8sICIiICksCgkJCQkJc2V0dGluZ3MgPSB2YWxpZGF0b3Iuc2V0dGluZ3M7CgkJCQlpZiAoIHNldHRpbmdzWyBldmVudFR5cGUgXSAmJiAhdGhpcy5pcyggc2V0dGluZ3MuaWdub3JlICkgKSB7CgkJCQkJc2V0dGluZ3NbIGV2ZW50VHlwZSBdLmNhbGwoIHZhbGlkYXRvciwgdGhpc1sgMCBdLCBldmVudCApOwoJCQkJfQoJCQl9CgkJCSQoIHRoaXMuY3VycmVudEZvcm0gKQoJCQkJLnZhbGlkYXRlRGVsZWdhdGUoICI6dGV4dCwgW3R5cGU9J3Bhc3N3b3JkJ10sIFt0eXBlPSdmaWxlJ10sIHNlbGVjdCwgdGV4dGFyZWEsICIgKwoJCQkJCSJbdHlwZT0nbnVtYmVyJ10sIFt0eXBlPSdzZWFyY2gnXSAsW3R5cGU9J3RlbCddLCBbdHlwZT0ndXJsJ10sICIgKwoJCQkJCSJbdHlwZT0nZW1haWwnXSwgW3R5cGU9J2RhdGV0aW1lJ10sIFt0eXBlPSdkYXRlJ10sIFt0eXBlPSdtb250aCddLCAiICsKCQkJCQkiW3R5cGU9J3dlZWsnXSwgW3R5cGU9J3RpbWUnXSwgW3R5cGU9J2RhdGV0aW1lLWxvY2FsJ10sICIgKwoJCQkJCSJbdHlwZT0ncmFuZ2UnXSwgW3R5cGU9J2NvbG9yJ10sIFt0eXBlPSdyYWRpbyddLCBbdHlwZT0nY2hlY2tib3gnXSIsCgkJCQkJImZvY3VzaW4gZm9jdXNvdXQga2V5dXAiLCBkZWxlZ2F0ZSkKCQkJCS8vIFN1cHBvcnQ6IENocm9tZSwgb2xkSUUKCQkJCS8vICJzZWxlY3QiIGlzIHByb3ZpZGVkIGFzIGV2ZW50LnRhcmdldCB3aGVuIGNsaWNraW5nIGEgb3B0aW9uCgkJCQkudmFsaWRhdGVEZWxlZ2F0ZSgic2VsZWN0LCBvcHRpb24sIFt0eXBlPSdyYWRpbyddLCBbdHlwZT0nY2hlY2tib3gnXSIsICJjbGljayIsIGRlbGVnYXRlKTsKCgkJCWlmICggdGhpcy5zZXR0aW5ncy5pbnZhbGlkSGFuZGxlciApIHsKCQkJCSQoIHRoaXMuY3VycmVudEZvcm0gKS5iaW5kKCAiaW52YWxpZC1mb3JtLnZhbGlkYXRlIiwgdGhpcy5zZXR0aW5ncy5pbnZhbGlkSGFuZGxlciApOwoJCQl9CgoJCQkvLyBBZGQgYXJpYS1yZXF1aXJlZCB0byBhbnkgU3RhdGljL0RhdGEvQ2xhc3MgcmVxdWlyZWQgZmllbGRzIGJlZm9yZSBmaXJzdCB2YWxpZGF0aW9uCgkJCS8vIFNjcmVlbiByZWFkZXJzIHJlcXVpcmUgdGhpcyBhdHRyaWJ1dGUgdG8gYmUgcHJlc2VudCBiZWZvcmUgdGhlIGluaXRpYWwgc3VibWlzc2lvbiBodHRwOi8vd3d3LnczLm9yZy9UUi9XQ0FHLVRFQ0hTL0FSSUEyLmh0bWwKCQkJJCggdGhpcy5jdXJyZW50Rm9ybSApLmZpbmQoICJbcmVxdWlyZWRdLCBbZGF0YS1ydWxlLXJlcXVpcmVkXSwgLnJlcXVpcmVkIiApLmF0dHIoICJhcmlhLXJlcXVpcmVkIiwgInRydWUiICk7CgkJfSwKCgkJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL1ZhbGlkYXRvci5mb3JtLwoJCWZvcm06IGZ1bmN0aW9uKCkgewoJCQl0aGlzLmNoZWNrRm9ybSgpOwoJCQkkLmV4dGVuZCggdGhpcy5zdWJtaXR0ZWQsIHRoaXMuZXJyb3JNYXAgKTsKCQkJdGhpcy5pbnZhbGlkID0gJC5leHRlbmQoe30sIHRoaXMuZXJyb3JNYXAgKTsKCQkJaWYgKCAhdGhpcy52YWxpZCgpICkgewoJCQkJJCggdGhpcy5jdXJyZW50Rm9ybSApLnRyaWdnZXJIYW5kbGVyKCAiaW52YWxpZC1mb3JtIiwgWyB0aGlzIF0pOwoJCQl9CgkJCXRoaXMuc2hvd0Vycm9ycygpOwoJCQlyZXR1cm4gdGhpcy52YWxpZCgpOwoJCX0sCgoJCWNoZWNrRm9ybTogZnVuY3Rpb24oKSB7CgkJCXRoaXMucHJlcGFyZUZvcm0oKTsKCQkJZm9yICggdmFyIGkgPSAwLCBlbGVtZW50cyA9ICggdGhpcy5jdXJyZW50RWxlbWVudHMgPSB0aGlzLmVsZW1lbnRzKCkgKTsgZWxlbWVudHNbIGkgXTsgaSsrICkgewoJCQkJdGhpcy5jaGVjayggZWxlbWVudHNbIGkgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzLnZhbGlkKCk7CgkJfSwKCgkJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL1ZhbGlkYXRvci5lbGVtZW50LwoJCWVsZW1lbnQ6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCQl2YXIgY2xlYW5FbGVtZW50ID0gdGhpcy5jbGVhbiggZWxlbWVudCApLAoJCQkJY2hlY2tFbGVtZW50ID0gdGhpcy52YWxpZGF0aW9uVGFyZ2V0Rm9yKCBjbGVhbkVsZW1lbnQgKSwKCQkJCXJlc3VsdCA9IHRydWU7CgoJCQl0aGlzLmxhc3RFbGVtZW50ID0gY2hlY2tFbGVtZW50OwoKCQkJaWYgKCBjaGVja0VsZW1lbnQgPT09IHVuZGVmaW5lZCApIHsKCQkJCWRlbGV0ZSB0aGlzLmludmFsaWRbIGNsZWFuRWxlbWVudC5uYW1lIF07CgkJCX0gZWxzZSB7CgkJCQl0aGlzLnByZXBhcmVFbGVtZW50KCBjaGVja0VsZW1lbnQgKTsKCQkJCXRoaXMuY3VycmVudEVsZW1lbnRzID0gJCggY2hlY2tFbGVtZW50ICk7CgoJCQkJcmVzdWx0ID0gdGhpcy5jaGVjayggY2hlY2tFbGVtZW50ICkgIT09IGZhbHNlOwoJCQkJaWYgKCByZXN1bHQgKSB7CgkJCQkJZGVsZXRlIHRoaXMuaW52YWxpZFsgY2hlY2tFbGVtZW50Lm5hbWUgXTsKCQkJCX0gZWxzZSB7CgkJCQkJdGhpcy5pbnZhbGlkWyBjaGVja0VsZW1lbnQubmFtZSBdID0gdHJ1ZTsKCQkJCX0KCQkJfQoJCQkvLyBBZGQgYXJpYS1pbnZhbGlkIHN0YXR1cyBmb3Igc2NyZWVuIHJlYWRlcnMKCQkJJCggZWxlbWVudCApLmF0dHIoICJhcmlhLWludmFsaWQiLCAhcmVzdWx0ICk7CgoJCQlpZiAoICF0aGlzLm51bWJlck9mSW52YWxpZHMoKSApIHsKCQkJCS8vIEhpZGUgZXJyb3IgY29udGFpbmVycyBvbiBsYXN0IGVycm9yCgkJCQl0aGlzLnRvSGlkZSA9IHRoaXMudG9IaWRlLmFkZCggdGhpcy5jb250YWluZXJzICk7CgkJCX0KCQkJdGhpcy5zaG93RXJyb3JzKCk7CgkJCXJldHVybiByZXN1bHQ7CgkJfSwKCgkJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL1ZhbGlkYXRvci5zaG93RXJyb3JzLwoJCXNob3dFcnJvcnM6IGZ1bmN0aW9uKCBlcnJvcnMgKSB7CgkJCWlmICggZXJyb3JzICkgewoJCQkJLy8gYWRkIGl0ZW1zIHRvIGVycm9yIGxpc3QgYW5kIG1hcAoJCQkJJC5leHRlbmQoIHRoaXMuZXJyb3JNYXAsIGVycm9ycyApOwoJCQkJdGhpcy5lcnJvckxpc3QgPSBbXTsKCQkJCWZvciAoIHZhciBuYW1lIGluIGVycm9ycyApIHsKCQkJCQl0aGlzLmVycm9yTGlzdC5wdXNoKHsKCQkJCQkJbWVzc2FnZTogZXJyb3JzWyBuYW1lIF0sCgkJCQkJCWVsZW1lbnQ6IHRoaXMuZmluZEJ5TmFtZSggbmFtZSApWyAwIF0KCQkJCQl9KTsKCQkJCX0KCQkJCS8vIHJlbW92ZSBpdGVtcyBmcm9tIHN1Y2Nlc3MgbGlzdAoJCQkJdGhpcy5zdWNjZXNzTGlzdCA9ICQuZ3JlcCggdGhpcy5zdWNjZXNzTGlzdCwgZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJCQkJcmV0dXJuICEoIGVsZW1lbnQubmFtZSBpbiBlcnJvcnMgKTsKCQkJCX0pOwoJCQl9CgkJCWlmICggdGhpcy5zZXR0aW5ncy5zaG93RXJyb3JzICkgewoJCQkJdGhpcy5zZXR0aW5ncy5zaG93RXJyb3JzLmNhbGwoIHRoaXMsIHRoaXMuZXJyb3JNYXAsIHRoaXMuZXJyb3JMaXN0ICk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLmRlZmF1bHRTaG93RXJyb3JzKCk7CgkJCX0KCQl9LAoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvVmFsaWRhdG9yLnJlc2V0Rm9ybS8KCQlyZXNldEZvcm06IGZ1bmN0aW9uKCkgewoJCQlpZiAoICQuZm4ucmVzZXRGb3JtICkgewoJCQkJJCggdGhpcy5jdXJyZW50Rm9ybSApLnJlc2V0Rm9ybSgpOwoJCQl9CgkJCXRoaXMuc3VibWl0dGVkID0ge307CgkJCXRoaXMubGFzdEVsZW1lbnQgPSBudWxsOwoJCQl0aGlzLnByZXBhcmVGb3JtKCk7CgkJCXRoaXMuaGlkZUVycm9ycygpOwoJCQl0aGlzLmVsZW1lbnRzKCkKCQkJCQkucmVtb3ZlQ2xhc3MoIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcyApCgkJCQkJLnJlbW92ZURhdGEoICJwcmV2aW91c1ZhbHVlIiApCgkJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWludmFsaWQiICk7CgkJfSwKCgkJbnVtYmVyT2ZJbnZhbGlkczogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB0aGlzLm9iamVjdExlbmd0aCggdGhpcy5pbnZhbGlkICk7CgkJfSwKCgkJb2JqZWN0TGVuZ3RoOiBmdW5jdGlvbiggb2JqICkgewoJCQkvKiBqc2hpbnQgdW51c2VkOiBmYWxzZSAqLwoJCQl2YXIgY291bnQgPSAwLAoJCQkJaTsKCQkJZm9yICggaSBpbiBvYmogKSB7CgkJCQljb3VudCsrOwoJCQl9CgkJCXJldHVybiBjb3VudDsKCQl9LAoKCQloaWRlRXJyb3JzOiBmdW5jdGlvbigpIHsKCQkJdGhpcy5oaWRlVGhlc2UoIHRoaXMudG9IaWRlICk7CgkJfSwKCgkJaGlkZVRoZXNlOiBmdW5jdGlvbiggZXJyb3JzICkgewoJCQllcnJvcnMubm90KCB0aGlzLmNvbnRhaW5lcnMgKS50ZXh0KCAiIiApOwoJCQl0aGlzLmFkZFdyYXBwZXIoIGVycm9ycyApLmhpZGUoKTsKCQl9LAoKCQl2YWxpZDogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB0aGlzLnNpemUoKSA9PT0gMDsKCQl9LAoKCQlzaXplOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHRoaXMuZXJyb3JMaXN0Lmxlbmd0aDsKCQl9LAoKCQlmb2N1c0ludmFsaWQ6IGZ1bmN0aW9uKCkgewoJCQlpZiAoIHRoaXMuc2V0dGluZ3MuZm9jdXNJbnZhbGlkICkgewoJCQkJdHJ5IHsKCQkJCQkkKCB0aGlzLmZpbmRMYXN0QWN0aXZlKCkgfHwgdGhpcy5lcnJvckxpc3QubGVuZ3RoICYmIHRoaXMuZXJyb3JMaXN0WyAwIF0uZWxlbWVudCB8fCBbXSkKCQkJCQkuZmlsdGVyKCAiOnZpc2libGUiICkKCQkJCQkuZm9jdXMoKQoJCQkJCS8vIG1hbnVhbGx5IHRyaWdnZXIgZm9jdXNpbiBldmVudDsgd2l0aG91dCBpdCwgZm9jdXNpbiBoYW5kbGVyIGlzbid0IGNhbGxlZCwgZmluZExhc3RBY3RpdmUgd29uJ3QgaGF2ZSBhbnl0aGluZyB0byBmaW5kCgkJCQkJLnRyaWdnZXIoICJmb2N1c2luIiApOwoJCQkJfSBjYXRjaCAoIGUgKSB7CgkJCQkJLy8gaWdub3JlIElFIHRocm93aW5nIGVycm9ycyB3aGVuIGZvY3VzaW5nIGhpZGRlbiBlbGVtZW50cwoJCQkJfQoJCQl9CgkJfSwKCgkJZmluZExhc3RBY3RpdmU6IGZ1bmN0aW9uKCkgewoJCQl2YXIgbGFzdEFjdGl2ZSA9IHRoaXMubGFzdEFjdGl2ZTsKCQkJcmV0dXJuIGxhc3RBY3RpdmUgJiYgJC5ncmVwKCB0aGlzLmVycm9yTGlzdCwgZnVuY3Rpb24oIG4gKSB7CgkJCQlyZXR1cm4gbi5lbGVtZW50Lm5hbWUgPT09IGxhc3RBY3RpdmUubmFtZTsKCQkJfSkubGVuZ3RoID09PSAxICYmIGxhc3RBY3RpdmU7CgkJfSwKCgkJZWxlbWVudHM6IGZ1bmN0aW9uKCkgewoJCQl2YXIgdmFsaWRhdG9yID0gdGhpcywKCQkJCXJ1bGVzQ2FjaGUgPSB7fTsKCgkJCS8vIHNlbGVjdCBhbGwgdmFsaWQgaW5wdXRzIGluc2lkZSB0aGUgZm9ybSAobm8gc3VibWl0IG9yIHJlc2V0IGJ1dHRvbnMpCgkJCXJldHVybiAkKCB0aGlzLmN1cnJlbnRGb3JtICkKCQkJLmZpbmQoICJpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYSIgKQoJCQkubm90KCAiOnN1Ym1pdCwgOnJlc2V0LCA6aW1hZ2UsIFtkaXNhYmxlZF0sIFtyZWFkb25seV0iICkKCQkJLm5vdCggdGhpcy5zZXR0aW5ncy5pZ25vcmUgKQoJCQkuZmlsdGVyKCBmdW5jdGlvbigpIHsKCQkJCWlmICggIXRoaXMubmFtZSAmJiB2YWxpZGF0b3Iuc2V0dGluZ3MuZGVidWcgJiYgd2luZG93LmNvbnNvbGUgKSB7CgkJCQkJY29uc29sZS5lcnJvciggIiVvIGhhcyBubyBuYW1lIGFzc2lnbmVkIiwgdGhpcyApOwoJCQkJfQoKCQkJCS8vIHNlbGVjdCBvbmx5IHRoZSBmaXJzdCBlbGVtZW50IGZvciBlYWNoIG5hbWUsIGFuZCBvbmx5IHRob3NlIHdpdGggcnVsZXMgc3BlY2lmaWVkCgkJCQlpZiAoIHRoaXMubmFtZSBpbiBydWxlc0NhY2hlIHx8ICF2YWxpZGF0b3Iub2JqZWN0TGVuZ3RoKCAkKCB0aGlzICkucnVsZXMoKSApICkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCgkJCQlydWxlc0NhY2hlWyB0aGlzLm5hbWUgXSA9IHRydWU7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSk7CgkJfSwKCgkJY2xlYW46IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJcmV0dXJuICQoIHNlbGVjdG9yIClbIDAgXTsKCQl9LAoKCQllcnJvcnM6IGZ1bmN0aW9uKCkgewoJCQl2YXIgZXJyb3JDbGFzcyA9IHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcy5zcGxpdCggIiAiICkuam9pbiggIi4iICk7CgkJCXJldHVybiAkKCB0aGlzLnNldHRpbmdzLmVycm9yRWxlbWVudCArICIuIiArIGVycm9yQ2xhc3MsIHRoaXMuZXJyb3JDb250ZXh0ICk7CgkJfSwKCgkJcmVzZXQ6IGZ1bmN0aW9uKCkgewoJCQl0aGlzLnN1Y2Nlc3NMaXN0ID0gW107CgkJCXRoaXMuZXJyb3JMaXN0ID0gW107CgkJCXRoaXMuZXJyb3JNYXAgPSB7fTsKCQkJdGhpcy50b1Nob3cgPSAkKCBbXSApOwoJCQl0aGlzLnRvSGlkZSA9ICQoIFtdICk7CgkJCXRoaXMuY3VycmVudEVsZW1lbnRzID0gJCggW10gKTsKCQl9LAoKCQlwcmVwYXJlRm9ybTogZnVuY3Rpb24oKSB7CgkJCXRoaXMucmVzZXQoKTsKCQkJdGhpcy50b0hpZGUgPSB0aGlzLmVycm9ycygpLmFkZCggdGhpcy5jb250YWluZXJzICk7CgkJfSwKCgkJcHJlcGFyZUVsZW1lbnQ6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCQl0aGlzLnJlc2V0KCk7CgkJCXRoaXMudG9IaWRlID0gdGhpcy5lcnJvcnNGb3IoIGVsZW1lbnQgKTsKCQl9LAoKCQllbGVtZW50VmFsdWU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCQl2YXIgdmFsLAoJCQkJJGVsZW1lbnQgPSAkKCBlbGVtZW50ICksCgkJCQl0eXBlID0gZWxlbWVudC50eXBlOwoKCQkJaWYgKCB0eXBlID09PSAicmFkaW8iIHx8IHR5cGUgPT09ICJjaGVja2JveCIgKSB7CgkJCQlyZXR1cm4gJCggImlucHV0W25hbWU9JyIgKyBlbGVtZW50Lm5hbWUgKyAiJ106Y2hlY2tlZCIgKS52YWwoKTsKCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gIm51bWJlciIgJiYgdHlwZW9mIGVsZW1lbnQudmFsaWRpdHkgIT09ICJ1bmRlZmluZWQiICkgewoJCQkJcmV0dXJuIGVsZW1lbnQudmFsaWRpdHkuYmFkSW5wdXQgPyBmYWxzZSA6ICRlbGVtZW50LnZhbCgpOwoJCQl9CgoJCQl2YWwgPSAkZWxlbWVudC52YWwoKTsKCQkJaWYgKCB0eXBlb2YgdmFsID09PSAic3RyaW5nIiApIHsKCQkJCXJldHVybiB2YWwucmVwbGFjZSgvXHIvZywgIiIgKTsKCQkJfQoJCQlyZXR1cm4gdmFsOwoJCX0sCgoJCWNoZWNrOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQkJZWxlbWVudCA9IHRoaXMudmFsaWRhdGlvblRhcmdldEZvciggdGhpcy5jbGVhbiggZWxlbWVudCApICk7CgoJCQl2YXIgcnVsZXMgPSAkKCBlbGVtZW50ICkucnVsZXMoKSwKCQkJCXJ1bGVzQ291bnQgPSAkLm1hcCggcnVsZXMsIGZ1bmN0aW9uKCBuLCBpICkgewoJCQkJCXJldHVybiBpOwoJCQkJfSkubGVuZ3RoLAoJCQkJZGVwZW5kZW5jeU1pc21hdGNoID0gZmFsc2UsCgkJCQl2YWwgPSB0aGlzLmVsZW1lbnRWYWx1ZSggZWxlbWVudCApLAoJCQkJcmVzdWx0LCBtZXRob2QsIHJ1bGU7CgoJCQlmb3IgKCBtZXRob2QgaW4gcnVsZXMgKSB7CgkJCQlydWxlID0geyBtZXRob2Q6IG1ldGhvZCwgcGFyYW1ldGVyczogcnVsZXNbIG1ldGhvZCBdIH07CgkJCQl0cnkgewoKCQkJCQlyZXN1bHQgPSAkLnZhbGlkYXRvci5tZXRob2RzWyBtZXRob2QgXS5jYWxsKCB0aGlzLCB2YWwsIGVsZW1lbnQsIHJ1bGUucGFyYW1ldGVycyApOwoKCQkJCQkvLyBpZiBhIG1ldGhvZCBpbmRpY2F0ZXMgdGhhdCB0aGUgZmllbGQgaXMgb3B0aW9uYWwgYW5kIHRoZXJlZm9yZSB2YWxpZCwKCQkJCQkvLyBkb24ndCBtYXJrIGl0IGFzIHZhbGlkIHdoZW4gdGhlcmUgYXJlIG5vIG90aGVyIHJ1bGVzCgkJCQkJaWYgKCByZXN1bHQgPT09ICJkZXBlbmRlbmN5LW1pc21hdGNoIiAmJiBydWxlc0NvdW50ID09PSAxICkgewoJCQkJCQlkZXBlbmRlbmN5TWlzbWF0Y2ggPSB0cnVlOwoJCQkJCQljb250aW51ZTsKCQkJCQl9CgkJCQkJZGVwZW5kZW5jeU1pc21hdGNoID0gZmFsc2U7CgoJCQkJCWlmICggcmVzdWx0ID09PSAicGVuZGluZyIgKSB7CgkJCQkJCXRoaXMudG9IaWRlID0gdGhpcy50b0hpZGUubm90KCB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApICk7CgkJCQkJCXJldHVybjsKCQkJCQl9CgoJCQkJCWlmICggIXJlc3VsdCApIHsKCQkJCQkJdGhpcy5mb3JtYXRBbmRBZGQoIGVsZW1lbnQsIHJ1bGUgKTsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCWlmICggdGhpcy5zZXR0aW5ncy5kZWJ1ZyAmJiB3aW5kb3cuY29uc29sZSApIHsKCQkJCQkJY29uc29sZS5sb2coICJFeGNlcHRpb24gb2NjdXJyZWQgd2hlbiBjaGVja2luZyBlbGVtZW50ICIgKyBlbGVtZW50LmlkICsgIiwgY2hlY2sgdGhlICciICsgcnVsZS5tZXRob2QgKyAiJyBtZXRob2QuIiwgZSApOwoJCQkJCX0KCQkJCQl0aHJvdyBlOwoJCQkJfQoJCQl9CgkJCWlmICggZGVwZW5kZW5jeU1pc21hdGNoICkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCWlmICggdGhpcy5vYmplY3RMZW5ndGgoIHJ1bGVzICkgKSB7CgkJCQl0aGlzLnN1Y2Nlc3NMaXN0LnB1c2goIGVsZW1lbnQgKTsKCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9LAoKCQkvLyByZXR1cm4gdGhlIGN1c3RvbSBtZXNzYWdlIGZvciB0aGUgZ2l2ZW4gZWxlbWVudCBhbmQgdmFsaWRhdGlvbiBtZXRob2QKCQkvLyBzcGVjaWZpZWQgaW4gdGhlIGVsZW1lbnQncyBIVE1MNSBkYXRhIGF0dHJpYnV0ZQoJCS8vIHJldHVybiB0aGUgZ2VuZXJpYyBtZXNzYWdlIGlmIHByZXNlbnQgYW5kIG5vIG1ldGhvZCBzcGVjaWZpYyBtZXNzYWdlIGlzIHByZXNlbnQKCQljdXN0b21EYXRhTWVzc2FnZTogZnVuY3Rpb24oIGVsZW1lbnQsIG1ldGhvZCApIHsKCQkJcmV0dXJuICQoIGVsZW1lbnQgKS5kYXRhKCAibXNnIiArIG1ldGhvZC5jaGFyQXQoIDAgKS50b1VwcGVyQ2FzZSgpICsKCQkJCW1ldGhvZC5zdWJzdHJpbmcoIDEgKS50b0xvd2VyQ2FzZSgpICkgfHwgJCggZWxlbWVudCApLmRhdGEoICJtc2ciICk7CgkJfSwKCgkJLy8gcmV0dXJuIHRoZSBjdXN0b20gbWVzc2FnZSBmb3IgdGhlIGdpdmVuIGVsZW1lbnQgbmFtZSBhbmQgdmFsaWRhdGlvbiBtZXRob2QKCQljdXN0b21NZXNzYWdlOiBmdW5jdGlvbiggbmFtZSwgbWV0aG9kICkgewoJCQl2YXIgbSA9IHRoaXMuc2V0dGluZ3MubWVzc2FnZXNbIG5hbWUgXTsKCQkJcmV0dXJuIG0gJiYgKCBtLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgPyBtIDogbVsgbWV0aG9kIF0pOwoJCX0sCgoJCS8vIHJldHVybiB0aGUgZmlyc3QgZGVmaW5lZCBhcmd1bWVudCwgYWxsb3dpbmcgZW1wdHkgc3RyaW5ncwoJCWZpbmREZWZpbmVkOiBmdW5jdGlvbigpIHsKCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAoIGFyZ3VtZW50c1sgaSBdICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuIGFyZ3VtZW50c1sgaSBdOwoJCQkJfQoJCQl9CgkJCXJldHVybiB1bmRlZmluZWQ7CgkJfSwKCgkJZGVmYXVsdE1lc3NhZ2U6IGZ1bmN0aW9uKCBlbGVtZW50LCBtZXRob2QgKSB7CgkJCXJldHVybiB0aGlzLmZpbmREZWZpbmVkKAoJCQkJdGhpcy5jdXN0b21NZXNzYWdlKCBlbGVtZW50Lm5hbWUsIG1ldGhvZCApLAoJCQkJdGhpcy5jdXN0b21EYXRhTWVzc2FnZSggZWxlbWVudCwgbWV0aG9kICksCgkJCQkvLyB0aXRsZSBpcyBuZXZlciB1bmRlZmluZWQsIHNvIGhhbmRsZSBlbXB0eSBzdHJpbmcgYXMgdW5kZWZpbmVkCgkJCQkhdGhpcy5zZXR0aW5ncy5pZ25vcmVUaXRsZSAmJiBlbGVtZW50LnRpdGxlIHx8IHVuZGVmaW5lZCwKCQkJCSQudmFsaWRhdG9yLm1lc3NhZ2VzWyBtZXRob2QgXSwKCQkJCSI8c3Ryb25nPldhcm5pbmc6IE5vIG1lc3NhZ2UgZGVmaW5lZCBmb3IgIiArIGVsZW1lbnQubmFtZSArICI8L3N0cm9uZz4iCgkJCSk7CgkJfSwKCgkJZm9ybWF0QW5kQWRkOiBmdW5jdGlvbiggZWxlbWVudCwgcnVsZSApIHsKCQkJdmFyIG1lc3NhZ2UgPSB0aGlzLmRlZmF1bHRNZXNzYWdlKCBlbGVtZW50LCBydWxlLm1ldGhvZCApLAoJCQkJdGhlcmVnZXggPSAvXCQ\/XHsoXGQrKVx9L2c7CgkJCWlmICggdHlwZW9mIG1lc3NhZ2UgPT09ICJmdW5jdGlvbiIgKSB7CgkJCQltZXNzYWdlID0gbWVzc2FnZS5jYWxsKCB0aGlzLCBydWxlLnBhcmFtZXRlcnMsIGVsZW1lbnQgKTsKCQkJfSBlbHNlIGlmICggdGhlcmVnZXgudGVzdCggbWVzc2FnZSApICkgewoJCQkJbWVzc2FnZSA9ICQudmFsaWRhdG9yLmZvcm1hdCggbWVzc2FnZS5yZXBsYWNlKCB0aGVyZWdleCwgInskMX0iICksIHJ1bGUucGFyYW1ldGVycyApOwoJCQl9CgkJCXRoaXMuZXJyb3JMaXN0LnB1c2goewoJCQkJbWVzc2FnZTogbWVzc2FnZSwKCQkJCWVsZW1lbnQ6IGVsZW1lbnQsCgkJCQltZXRob2Q6IHJ1bGUubWV0aG9kCgkJCX0pOwoKCQkJdGhpcy5lcnJvck1hcFsgZWxlbWVudC5uYW1lIF0gPSBtZXNzYWdlOwoJCQl0aGlzLnN1Ym1pdHRlZFsgZWxlbWVudC5uYW1lIF0gPSBtZXNzYWdlOwoJCX0sCgoJCWFkZFdyYXBwZXI6IGZ1bmN0aW9uKCB0b1RvZ2dsZSApIHsKCQkJaWYgKCB0aGlzLnNldHRpbmdzLndyYXBwZXIgKSB7CgkJCQl0b1RvZ2dsZSA9IHRvVG9nZ2xlLmFkZCggdG9Ub2dnbGUucGFyZW50KCB0aGlzLnNldHRpbmdzLndyYXBwZXIgKSApOwoJCQl9CgkJCXJldHVybiB0b1RvZ2dsZTsKCQl9LAoKCQlkZWZhdWx0U2hvd0Vycm9yczogZnVuY3Rpb24oKSB7CgkJCXZhciBpLCBlbGVtZW50cywgZXJyb3I7CgkJCWZvciAoIGkgPSAwOyB0aGlzLmVycm9yTGlzdFsgaSBdOyBpKysgKSB7CgkJCQllcnJvciA9IHRoaXMuZXJyb3JMaXN0WyBpIF07CgkJCQlpZiAoIHRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0ICkgewoJCQkJCXRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0LmNhbGwoIHRoaXMsIGVycm9yLmVsZW1lbnQsIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcywgdGhpcy5zZXR0aW5ncy52YWxpZENsYXNzICk7CgkJCQl9CgkJCQl0aGlzLnNob3dMYWJlbCggZXJyb3IuZWxlbWVudCwgZXJyb3IubWVzc2FnZSApOwoJCQl9CgkJCWlmICggdGhpcy5lcnJvckxpc3QubGVuZ3RoICkgewoJCQkJdGhpcy50b1Nob3cgPSB0aGlzLnRvU2hvdy5hZGQoIHRoaXMuY29udGFpbmVycyApOwoJCQl9CgkJCWlmICggdGhpcy5zZXR0aW5ncy5zdWNjZXNzICkgewoJCQkJZm9yICggaSA9IDA7IHRoaXMuc3VjY2Vzc0xpc3RbIGkgXTsgaSsrICkgewoJCQkJCXRoaXMuc2hvd0xhYmVsKCB0aGlzLnN1Y2Nlc3NMaXN0WyBpIF0gKTsKCQkJCX0KCQkJfQoJCQlpZiAoIHRoaXMuc2V0dGluZ3MudW5oaWdobGlnaHQgKSB7CgkJCQlmb3IgKCBpID0gMCwgZWxlbWVudHMgPSB0aGlzLnZhbGlkRWxlbWVudHMoKTsgZWxlbWVudHNbIGkgXTsgaSsrICkgewoJCQkJCXRoaXMuc2V0dGluZ3MudW5oaWdobGlnaHQuY2FsbCggdGhpcywgZWxlbWVudHNbIGkgXSwgdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzLCB0aGlzLnNldHRpbmdzLnZhbGlkQ2xhc3MgKTsKCQkJCX0KCQkJfQoJCQl0aGlzLnRvSGlkZSA9IHRoaXMudG9IaWRlLm5vdCggdGhpcy50b1Nob3cgKTsKCQkJdGhpcy5oaWRlRXJyb3JzKCk7CgkJCXRoaXMuYWRkV3JhcHBlciggdGhpcy50b1Nob3cgKS5zaG93KCk7CgkJfSwKCgkJdmFsaWRFbGVtZW50czogZnVuY3Rpb24oKSB7CgkJCXJldHVybiB0aGlzLmN1cnJlbnRFbGVtZW50cy5ub3QoIHRoaXMuaW52YWxpZEVsZW1lbnRzKCkgKTsKCQl9LAoKCQlpbnZhbGlkRWxlbWVudHM6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gJCggdGhpcy5lcnJvckxpc3QgKS5tYXAoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gdGhpcy5lbGVtZW50OwoJCQl9KTsKCQl9LAoKCQlzaG93TGFiZWw6IGZ1bmN0aW9uKCBlbGVtZW50LCBtZXNzYWdlICkgewoJCQl2YXIgcGxhY2UsIGdyb3VwLCBlcnJvcklELAoJCQkJZXJyb3IgPSB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApLAoJCQkJZWxlbWVudElEID0gdGhpcy5pZE9yTmFtZSggZWxlbWVudCApLAoJCQkJZGVzY3JpYmVkQnkgPSAkKCBlbGVtZW50ICkuYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiICk7CgkJCWlmICggZXJyb3IubGVuZ3RoICkgewoJCQkJLy8gcmVmcmVzaCBlcnJvci9zdWNjZXNzIGNsYXNzCgkJCQllcnJvci5yZW1vdmVDbGFzcyggdGhpcy5zZXR0aW5ncy52YWxpZENsYXNzICkuYWRkQ2xhc3MoIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcyApOwoJCQkJLy8gcmVwbGFjZSBtZXNzYWdlIG9uIGV4aXN0aW5nIGxhYmVsCgkJCQllcnJvci5odG1sKCBtZXNzYWdlICk7CgkJCX0gZWxzZSB7CgkJCQkvLyBjcmVhdGUgZXJyb3IgZWxlbWVudAoJCQkJZXJyb3IgPSAkKCAiPCIgKyB0aGlzLnNldHRpbmdzLmVycm9yRWxlbWVudCArICI+IiApCgkJCQkJLmF0dHIoICJpZCIsIGVsZW1lbnRJRCArICItZXJyb3IiICkKCQkJCQkuYWRkQ2xhc3MoIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcyApCgkJCQkJLmh0bWwoIG1lc3NhZ2UgfHwgIiIgKTsKCgkJCQkvLyBNYWludGFpbiByZWZlcmVuY2UgdG8gdGhlIGVsZW1lbnQgdG8gYmUgcGxhY2VkIGludG8gdGhlIERPTQoJCQkJcGxhY2UgPSBlcnJvcjsKCQkJCWlmICggdGhpcy5zZXR0aW5ncy53cmFwcGVyICkgewoJCQkJCS8vIG1ha2Ugc3VyZSB0aGUgZWxlbWVudCBpcyB2aXNpYmxlLCBldmVuIGluIElFCgkJCQkJLy8gYWN0dWFsbHkgc2hvd2luZyB0aGUgd3JhcHBlZCBlbGVtZW50IGlzIGhhbmRsZWQgZWxzZXdoZXJlCgkJCQkJcGxhY2UgPSBlcnJvci5oaWRlKCkuc2hvdygpLndyYXAoICI8IiArIHRoaXMuc2V0dGluZ3Mud3JhcHBlciArICIvPiIgKS5wYXJlbnQoKTsKCQkJCX0KCQkJCWlmICggdGhpcy5sYWJlbENvbnRhaW5lci5sZW5ndGggKSB7CgkJCQkJdGhpcy5sYWJlbENvbnRhaW5lci5hcHBlbmQoIHBsYWNlICk7CgkJCQl9IGVsc2UgaWYgKCB0aGlzLnNldHRpbmdzLmVycm9yUGxhY2VtZW50ICkgewoJCQkJCXRoaXMuc2V0dGluZ3MuZXJyb3JQbGFjZW1lbnQoIHBsYWNlLCAkKCBlbGVtZW50ICkgKTsKCQkJCX0gZWxzZSB7CgkJCQkJcGxhY2UuaW5zZXJ0QWZ0ZXIoIGVsZW1lbnQgKTsKCQkJCX0KCgkJCQkvLyBMaW5rIGVycm9yIGJhY2sgdG8gdGhlIGVsZW1lbnQKCQkJCWlmICggZXJyb3IuaXMoICJsYWJlbCIgKSApIHsKCQkJCQkvLyBJZiB0aGUgZXJyb3IgaXMgYSBsYWJlbCwgdGhlbiBhc3NvY2lhdGUgdXNpbmcgJ2ZvcicKCQkJCQllcnJvci5hdHRyKCAiZm9yIiwgZWxlbWVudElEICk7CgkJCQl9IGVsc2UgaWYgKCBlcnJvci5wYXJlbnRzKCAibGFiZWxbZm9yPSciICsgZWxlbWVudElEICsgIiddIiApLmxlbmd0aCA9PT0gMCApIHsKCQkJCQkvLyBJZiB0aGUgZWxlbWVudCBpcyBub3QgYSBjaGlsZCBvZiBhbiBhc3NvY2lhdGVkIGxhYmVsLCB0aGVuIGl0J3MgbmVjZXNzYXJ5CgkJCQkJLy8gdG8gZXhwbGljaXRseSBhcHBseSBhcmlhLWRlc2NyaWJlZGJ5CgoJCQkJCWVycm9ySUQgPSBlcnJvci5hdHRyKCAiaWQiICkucmVwbGFjZSggLyg6fFwufFxbfFxdKS9nLCAiXFwkMSIpOwoJCQkJCS8vIFJlc3BlY3QgZXhpc3Rpbmcgbm9uLWVycm9yIGFyaWEtZGVzY3JpYmVkYnkKCQkJCQlpZiAoICFkZXNjcmliZWRCeSApIHsKCQkJCQkJZGVzY3JpYmVkQnkgPSBlcnJvcklEOwoJCQkJCX0gZWxzZSBpZiAoICFkZXNjcmliZWRCeS5tYXRjaCggbmV3IFJlZ0V4cCggIlxcYiIgKyBlcnJvcklEICsgIlxcYiIgKSApICkgewoJCQkJCQkvLyBBZGQgdG8gZW5kIG9mIGxpc3QgaWYgbm90IGFscmVhZHkgcHJlc2VudAoJCQkJCQlkZXNjcmliZWRCeSArPSAiICIgKyBlcnJvcklEOwoJCQkJCX0KCQkJCQkkKCBlbGVtZW50ICkuYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiLCBkZXNjcmliZWRCeSApOwoKCQkJCQkvLyBJZiB0aGlzIGVsZW1lbnQgaXMgZ3JvdXBlZCwgdGhlbiBhc3NpZ24gdG8gYWxsIGVsZW1lbnRzIGluIHRoZSBzYW1lIGdyb3VwCgkJCQkJZ3JvdXAgPSB0aGlzLmdyb3Vwc1sgZWxlbWVudC5uYW1lIF07CgkJCQkJaWYgKCBncm91cCApIHsKCQkJCQkJJC5lYWNoKCB0aGlzLmdyb3VwcywgZnVuY3Rpb24oIG5hbWUsIHRlc3Rncm91cCApIHsKCQkJCQkJCWlmICggdGVzdGdyb3VwID09PSBncm91cCApIHsKCQkJCQkJCQkkKCAiW25hbWU9JyIgKyBuYW1lICsgIiddIiwgdGhpcy5jdXJyZW50Rm9ybSApCgkJCQkJCQkJCS5hdHRyKCAiYXJpYS1kZXNjcmliZWRieSIsIGVycm9yLmF0dHIoICJpZCIgKSApOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJaWYgKCAhbWVzc2FnZSAmJiB0aGlzLnNldHRpbmdzLnN1Y2Nlc3MgKSB7CgkJCQllcnJvci50ZXh0KCAiIiApOwoJCQkJaWYgKCB0eXBlb2YgdGhpcy5zZXR0aW5ncy5zdWNjZXNzID09PSAic3RyaW5nIiApIHsKCQkJCQllcnJvci5hZGRDbGFzcyggdGhpcy5zZXR0aW5ncy5zdWNjZXNzICk7CgkJCQl9IGVsc2UgewoJCQkJCXRoaXMuc2V0dGluZ3Muc3VjY2VzcyggZXJyb3IsIGVsZW1lbnQgKTsKCQkJCX0KCQkJfQoJCQl0aGlzLnRvU2hvdyA9IHRoaXMudG9TaG93LmFkZCggZXJyb3IgKTsKCQl9LAoKCQllcnJvcnNGb3I6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCQl2YXIgbmFtZSA9IHRoaXMuaWRPck5hbWUoIGVsZW1lbnQgKSwKCQkJCWRlc2NyaWJlciA9ICQoIGVsZW1lbnQgKS5hdHRyKCAiYXJpYS1kZXNjcmliZWRieSIgKSwKCQkJCXNlbGVjdG9yID0gImxhYmVsW2Zvcj0nIiArIG5hbWUgKyAiJ10sIGxhYmVsW2Zvcj0nIiArIG5hbWUgKyAiJ10gKiI7CgoJCQkvLyBhcmlhLWRlc2NyaWJlZGJ5IHNob3VsZCBkaXJlY3RseSByZWZlcmVuY2UgdGhlIGVycm9yIGVsZW1lbnQKCQkJaWYgKCBkZXNjcmliZXIgKSB7CgkJCQlzZWxlY3RvciA9IHNlbGVjdG9yICsgIiwgIyIgKyBkZXNjcmliZXIucmVwbGFjZSggL1xzKy9nLCAiLCAjIiApOwoJCQl9CgkJCXJldHVybiB0aGlzCgkJCQkuZXJyb3JzKCkKCQkJCS5maWx0ZXIoIHNlbGVjdG9yICk7CgkJfSwKCgkJaWRPck5hbWU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCQlyZXR1cm4gdGhpcy5ncm91cHNbIGVsZW1lbnQubmFtZSBdIHx8ICggdGhpcy5jaGVja2FibGUoIGVsZW1lbnQgKSA\/IGVsZW1lbnQubmFtZSA6IGVsZW1lbnQuaWQgfHwgZWxlbWVudC5uYW1lICk7CgkJfSwKCgkJdmFsaWRhdGlvblRhcmdldEZvcjogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgoJCQkvLyBJZiByYWRpby9jaGVja2JveCwgdmFsaWRhdGUgZmlyc3QgZWxlbWVudCBpbiBncm91cCBpbnN0ZWFkCgkJCWlmICggdGhpcy5jaGVja2FibGUoIGVsZW1lbnQgKSApIHsKCQkJCWVsZW1lbnQgPSB0aGlzLmZpbmRCeU5hbWUoIGVsZW1lbnQubmFtZSApOwoJCQl9CgoJCQkvLyBBbHdheXMgYXBwbHkgaWdub3JlIGZpbHRlcgoJCQlyZXR1cm4gJCggZWxlbWVudCApLm5vdCggdGhpcy5zZXR0aW5ncy5pZ25vcmUgKVsgMCBdOwoJCX0sCgoJCWNoZWNrYWJsZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJCXJldHVybiAoIC9yYWRpb3xjaGVja2JveC9pICkudGVzdCggZWxlbWVudC50eXBlICk7CgkJfSwKCgkJZmluZEJ5TmFtZTogZnVuY3Rpb24oIG5hbWUgKSB7CgkJCXJldHVybiAkKCB0aGlzLmN1cnJlbnRGb3JtICkuZmluZCggIltuYW1lPSciICsgbmFtZSArICInXSIgKTsKCQl9LAoKCQlnZXRMZW5ndGg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHsKCQkJc3dpdGNoICggZWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICkgewoJCQljYXNlICJzZWxlY3QiOgoJCQkJcmV0dXJuICQoICJvcHRpb246c2VsZWN0ZWQiLCBlbGVtZW50ICkubGVuZ3RoOwoJCQljYXNlICJpbnB1dCI6CgkJCQlpZiAoIHRoaXMuY2hlY2thYmxlKCBlbGVtZW50ICkgKSB7CgkJCQkJcmV0dXJuIHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICkuZmlsdGVyKCAiOmNoZWNrZWQiICkubGVuZ3RoOwoJCQkJfQoJCQl9CgkJCXJldHVybiB2YWx1ZS5sZW5ndGg7CgkJfSwKCgkJZGVwZW5kOiBmdW5jdGlvbiggcGFyYW0sIGVsZW1lbnQgKSB7CgkJCXJldHVybiB0aGlzLmRlcGVuZFR5cGVzW3R5cGVvZiBwYXJhbV0gPyB0aGlzLmRlcGVuZFR5cGVzW3R5cGVvZiBwYXJhbV0oIHBhcmFtLCBlbGVtZW50ICkgOiB0cnVlOwoJCX0sCgoJCWRlcGVuZFR5cGVzOiB7CgkJCSJib29sZWFuIjogZnVuY3Rpb24oIHBhcmFtICkgewoJCQkJcmV0dXJuIHBhcmFtOwoJCQl9LAoJCQkic3RyaW5nIjogZnVuY3Rpb24oIHBhcmFtLCBlbGVtZW50ICkgewoJCQkJcmV0dXJuICEhJCggcGFyYW0sIGVsZW1lbnQuZm9ybSApLmxlbmd0aDsKCQkJfSwKCQkJImZ1bmN0aW9uIjogZnVuY3Rpb24oIHBhcmFtLCBlbGVtZW50ICkgewoJCQkJcmV0dXJuIHBhcmFtKCBlbGVtZW50ICk7CgkJCX0KCQl9LAoKCQlvcHRpb25hbDogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJCXZhciB2YWwgPSB0aGlzLmVsZW1lbnRWYWx1ZSggZWxlbWVudCApOwoJCQlyZXR1cm4gISQudmFsaWRhdG9yLm1ldGhvZHMucmVxdWlyZWQuY2FsbCggdGhpcywgdmFsLCBlbGVtZW50ICkgJiYgImRlcGVuZGVuY3ktbWlzbWF0Y2giOwoJCX0sCgoJCXN0YXJ0UmVxdWVzdDogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJCWlmICggIXRoaXMucGVuZGluZ1sgZWxlbWVudC5uYW1lIF0gKSB7CgkJCQl0aGlzLnBlbmRpbmdSZXF1ZXN0Kys7CgkJCQl0aGlzLnBlbmRpbmdbIGVsZW1lbnQubmFtZSBdID0gdHJ1ZTsKCQkJfQoJCX0sCgoJCXN0b3BSZXF1ZXN0OiBmdW5jdGlvbiggZWxlbWVudCwgdmFsaWQgKSB7CgkJCXRoaXMucGVuZGluZ1JlcXVlc3QtLTsKCQkJLy8gc29tZXRpbWVzIHN5bmNocm9uaXphdGlvbiBmYWlscywgbWFrZSBzdXJlIHBlbmRpbmdSZXF1ZXN0IGlzIG5ldmVyIDwgMAoJCQlpZiAoIHRoaXMucGVuZGluZ1JlcXVlc3QgPCAwICkgewoJCQkJdGhpcy5wZW5kaW5nUmVxdWVzdCA9IDA7CgkJCX0KCQkJZGVsZXRlIHRoaXMucGVuZGluZ1sgZWxlbWVudC5uYW1lIF07CgkJCWlmICggdmFsaWQgJiYgdGhpcy5wZW5kaW5nUmVxdWVzdCA9PT0gMCAmJiB0aGlzLmZvcm1TdWJtaXR0ZWQgJiYgdGhpcy5mb3JtKCkgKSB7CgkJCQkkKCB0aGlzLmN1cnJlbnRGb3JtICkuc3VibWl0KCk7CgkJCQl0aGlzLmZvcm1TdWJtaXR0ZWQgPSBmYWxzZTsKCQkJfSBlbHNlIGlmICghdmFsaWQgJiYgdGhpcy5wZW5kaW5nUmVxdWVzdCA9PT0gMCAmJiB0aGlzLmZvcm1TdWJtaXR0ZWQgKSB7CgkJCQkkKCB0aGlzLmN1cnJlbnRGb3JtICkudHJpZ2dlckhhbmRsZXIoICJpbnZhbGlkLWZvcm0iLCBbIHRoaXMgXSk7CgkJCQl0aGlzLmZvcm1TdWJtaXR0ZWQgPSBmYWxzZTsKCQkJfQoJCX0sCgoJCXByZXZpb3VzVmFsdWU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCQlyZXR1cm4gJC5kYXRhKCBlbGVtZW50LCAicHJldmlvdXNWYWx1ZSIgKSB8fCAkLmRhdGEoIGVsZW1lbnQsICJwcmV2aW91c1ZhbHVlIiwgewoJCQkJb2xkOiBudWxsLAoJCQkJdmFsaWQ6IHRydWUsCgkJCQltZXNzYWdlOiB0aGlzLmRlZmF1bHRNZXNzYWdlKCBlbGVtZW50LCAicmVtb3RlIiApCgkJCX0pOwoJCX0KCgl9LAoKCWNsYXNzUnVsZVNldHRpbmdzOiB7CgkJcmVxdWlyZWQ6IHsgcmVxdWlyZWQ6IHRydWUgfSwKCQllbWFpbDogeyBlbWFpbDogdHJ1ZSB9LAoJCXVybDogeyB1cmw6IHRydWUgfSwKCQlkYXRlOiB7IGRhdGU6IHRydWUgfSwKCQlkYXRlSVNPOiB7IGRhdGVJU086IHRydWUgfSwKCQludW1iZXI6IHsgbnVtYmVyOiB0cnVlIH0sCgkJZGlnaXRzOiB7IGRpZ2l0czogdHJ1ZSB9LAoJCWNyZWRpdGNhcmQ6IHsgY3JlZGl0Y2FyZDogdHJ1ZSB9Cgl9LAoKCWFkZENsYXNzUnVsZXM6IGZ1bmN0aW9uKCBjbGFzc05hbWUsIHJ1bGVzICkgewoJCWlmICggY2xhc3NOYW1lLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgKSB7CgkJCXRoaXMuY2xhc3NSdWxlU2V0dGluZ3NbIGNsYXNzTmFtZSBdID0gcnVsZXM7CgkJfSBlbHNlIHsKCQkJJC5leHRlbmQoIHRoaXMuY2xhc3NSdWxlU2V0dGluZ3MsIGNsYXNzTmFtZSApOwoJCX0KCX0sCgoJY2xhc3NSdWxlczogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJdmFyIHJ1bGVzID0ge30sCgkJCWNsYXNzZXMgPSAkKCBlbGVtZW50ICkuYXR0ciggImNsYXNzIiApOwoKCQlpZiAoIGNsYXNzZXMgKSB7CgkJCSQuZWFjaCggY2xhc3Nlcy5zcGxpdCggIiAiICksIGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzIGluICQudmFsaWRhdG9yLmNsYXNzUnVsZVNldHRpbmdzICkgewoJCQkJCSQuZXh0ZW5kKCBydWxlcywgJC52YWxpZGF0b3IuY2xhc3NSdWxlU2V0dGluZ3NbIHRoaXMgXSk7CgkJCQl9CgkJCX0pOwoJCX0KCQlyZXR1cm4gcnVsZXM7Cgl9LAoKCWF0dHJpYnV0ZVJ1bGVzOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQl2YXIgcnVsZXMgPSB7fSwKCQkJJGVsZW1lbnQgPSAkKCBlbGVtZW50ICksCgkJCXR5cGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSggInR5cGUiICksCgkJCW1ldGhvZCwgdmFsdWU7CgoJCWZvciAoIG1ldGhvZCBpbiAkLnZhbGlkYXRvci5tZXRob2RzICkgewoKCQkJLy8gc3VwcG9ydCBmb3IgPGlucHV0IHJlcXVpcmVkPiBpbiBib3RoIGh0bWw1IGFuZCBvbGRlciBicm93c2VycwoJCQlpZiAoIG1ldGhvZCA9PT0gInJlcXVpcmVkIiApIHsKCQkJCXZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoIG1ldGhvZCApOwoJCQkJLy8gU29tZSBicm93c2VycyByZXR1cm4gYW4gZW1wdHkgc3RyaW5nIGZvciB0aGUgcmVxdWlyZWQgYXR0cmlidXRlCgkJCQkvLyBhbmQgbm9uLUhUTUw1IGJyb3dzZXJzIG1pZ2h0IGhhdmUgcmVxdWlyZWQ9IiIgbWFya3VwCgkJCQlpZiAoIHZhbHVlID09PSAiIiApIHsKCQkJCQl2YWx1ZSA9IHRydWU7CgkJCQl9CgkJCQkvLyBmb3JjZSBub24tSFRNTDUgYnJvd3NlcnMgdG8gcmV0dXJuIGJvb2wKCQkJCXZhbHVlID0gISF2YWx1ZTsKCQkJfSBlbHNlIHsKCQkJCXZhbHVlID0gJGVsZW1lbnQuYXR0ciggbWV0aG9kICk7CgkJCX0KCgkJCS8vIGNvbnZlcnQgdGhlIHZhbHVlIHRvIGEgbnVtYmVyIGZvciBudW1iZXIgaW5wdXRzLCBhbmQgZm9yIHRleHQgZm9yIGJhY2t3YXJkcyBjb21wYWJpbGl0eQoJCQkvLyBhbGxvd3MgdHlwZT0iZGF0ZSIgYW5kIG90aGVycyB0byBiZSBjb21wYXJlZCBhcyBzdHJpbmdzCgkJCWlmICggL21pbnxtYXgvLnRlc3QoIG1ldGhvZCApICYmICggdHlwZSA9PT0gbnVsbCB8fCAvbnVtYmVyfHJhbmdlfHRleHQvLnRlc3QoIHR5cGUgKSApICkgewoJCQkJdmFsdWUgPSBOdW1iZXIoIHZhbHVlICk7CgkJCX0KCgkJCWlmICggdmFsdWUgfHwgdmFsdWUgPT09IDAgKSB7CgkJCQlydWxlc1sgbWV0aG9kIF0gPSB2YWx1ZTsKCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gbWV0aG9kICYmIHR5cGUgIT09ICJyYW5nZSIgKSB7CgkJCQkvLyBleGNlcHRpb246IHRoZSBqcXVlcnkgdmFsaWRhdGUgJ3JhbmdlJyBtZXRob2QKCQkJCS8vIGRvZXMgbm90IHRlc3QgZm9yIHRoZSBodG1sNSAncmFuZ2UnIHR5cGUKCQkJCXJ1bGVzWyBtZXRob2QgXSA9IHRydWU7CgkJCX0KCQl9CgoJCS8vIG1heGxlbmd0aCBtYXkgYmUgcmV0dXJuZWQgYXMgLTEsIDIxNDc0ODM2NDcgKCBJRSApIGFuZCA1MjQyODggKCBzYWZhcmkgKSBmb3IgdGV4dCBpbnB1dHMKCQlpZiAoIHJ1bGVzLm1heGxlbmd0aCAmJiAvLTF8MjE0NzQ4MzY0N3w1MjQyODgvLnRlc3QoIHJ1bGVzLm1heGxlbmd0aCApICkgewoJCQlkZWxldGUgcnVsZXMubWF4bGVuZ3RoOwoJCX0KCgkJcmV0dXJuIHJ1bGVzOwoJfSwKCglkYXRhUnVsZXM6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCXZhciBtZXRob2QsIHZhbHVlLAoJCQlydWxlcyA9IHt9LCAkZWxlbWVudCA9ICQoIGVsZW1lbnQgKTsKCQlmb3IgKCBtZXRob2QgaW4gJC52YWxpZGF0b3IubWV0aG9kcyApIHsKCQkJdmFsdWUgPSAkZWxlbWVudC5kYXRhKCAicnVsZSIgKyBtZXRob2QuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArIG1ldGhvZC5zdWJzdHJpbmcoIDEgKS50b0xvd2VyQ2FzZSgpICk7CgkJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJ1bGVzWyBtZXRob2QgXSA9IHZhbHVlOwoJCQl9CgkJfQoJCXJldHVybiBydWxlczsKCX0sCgoJc3RhdGljUnVsZXM6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCXZhciBydWxlcyA9IHt9LAoJCQl2YWxpZGF0b3IgPSAkLmRhdGEoIGVsZW1lbnQuZm9ybSwgInZhbGlkYXRvciIgKTsKCgkJaWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3MucnVsZXMgKSB7CgkJCXJ1bGVzID0gJC52YWxpZGF0b3Iubm9ybWFsaXplUnVsZSggdmFsaWRhdG9yLnNldHRpbmdzLnJ1bGVzWyBlbGVtZW50Lm5hbWUgXSApIHx8IHt9OwoJCX0KCQlyZXR1cm4gcnVsZXM7Cgl9LAoKCW5vcm1hbGl6ZVJ1bGVzOiBmdW5jdGlvbiggcnVsZXMsIGVsZW1lbnQgKSB7CgkJLy8gaGFuZGxlIGRlcGVuZGVuY3kgY2hlY2sKCQkkLmVhY2goIHJ1bGVzLCBmdW5jdGlvbiggcHJvcCwgdmFsICkgewoJCQkvLyBpZ25vcmUgcnVsZSB3aGVuIHBhcmFtIGlzIGV4cGxpY2l0bHkgZmFsc2UsIGVnLiByZXF1aXJlZDpmYWxzZQoJCQlpZiAoIHZhbCA9PT0gZmFsc2UgKSB7CgkJCQlkZWxldGUgcnVsZXNbIHByb3AgXTsKCQkJCXJldHVybjsKCQkJfQoJCQlpZiAoIHZhbC5wYXJhbSB8fCB2YWwuZGVwZW5kcyApIHsKCQkJCXZhciBrZWVwUnVsZSA9IHRydWU7CgkJCQlzd2l0Y2ggKCB0eXBlb2YgdmFsLmRlcGVuZHMgKSB7CgkJCQljYXNlICJzdHJpbmciOgoJCQkJCWtlZXBSdWxlID0gISEkKCB2YWwuZGVwZW5kcywgZWxlbWVudC5mb3JtICkubGVuZ3RoOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAiZnVuY3Rpb24iOgoJCQkJCWtlZXBSdWxlID0gdmFsLmRlcGVuZHMuY2FsbCggZWxlbWVudCwgZWxlbWVudCApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJaWYgKCBrZWVwUnVsZSApIHsKCQkJCQlydWxlc1sgcHJvcCBdID0gdmFsLnBhcmFtICE9PSB1bmRlZmluZWQgPyB2YWwucGFyYW0gOiB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWxldGUgcnVsZXNbIHByb3AgXTsKCQkJCX0KCQkJfQoJCX0pOwoKCQkvLyBldmFsdWF0ZSBwYXJhbWV0ZXJzCgkJJC5lYWNoKCBydWxlcywgZnVuY3Rpb24oIHJ1bGUsIHBhcmFtZXRlciApIHsKCQkJcnVsZXNbIHJ1bGUgXSA9ICQuaXNGdW5jdGlvbiggcGFyYW1ldGVyICkgPyBwYXJhbWV0ZXIoIGVsZW1lbnQgKSA6IHBhcmFtZXRlcjsKCQl9KTsKCgkJLy8gY2xlYW4gbnVtYmVyIHBhcmFtZXRlcnMKCQkkLmVhY2goWyAibWlubGVuZ3RoIiwgIm1heGxlbmd0aCIgXSwgZnVuY3Rpb24oKSB7CgkJCWlmICggcnVsZXNbIHRoaXMgXSApIHsKCQkJCXJ1bGVzWyB0aGlzIF0gPSBOdW1iZXIoIHJ1bGVzWyB0aGlzIF0gKTsKCQkJfQoJCX0pOwoJCSQuZWFjaChbICJyYW5nZWxlbmd0aCIsICJyYW5nZSIgXSwgZnVuY3Rpb24oKSB7CgkJCXZhciBwYXJ0czsKCQkJaWYgKCBydWxlc1sgdGhpcyBdICkgewoJCQkJaWYgKCAkLmlzQXJyYXkoIHJ1bGVzWyB0aGlzIF0gKSApIHsKCQkJCQlydWxlc1sgdGhpcyBdID0gWyBOdW1iZXIoIHJ1bGVzWyB0aGlzIF1bIDAgXSksIE51bWJlciggcnVsZXNbIHRoaXMgXVsgMSBdICkgXTsKCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiBydWxlc1sgdGhpcyBdID09PSAic3RyaW5nIiApIHsKCQkJCQlwYXJ0cyA9IHJ1bGVzWyB0aGlzIF0ucmVwbGFjZSgvW1xbXF1dL2csICIiICkuc3BsaXQoIC9bXHMsXSsvICk7CgkJCQkJcnVsZXNbIHRoaXMgXSA9IFsgTnVtYmVyKCBwYXJ0c1sgMCBdKSwgTnVtYmVyKCBwYXJ0c1sgMSBdICkgXTsKCQkJCX0KCQkJfQoJCX0pOwoKCQlpZiAoICQudmFsaWRhdG9yLmF1dG9DcmVhdGVSYW5nZXMgKSB7CgkJCS8vIGF1dG8tY3JlYXRlIHJhbmdlcwoJCQlpZiAoIHJ1bGVzLm1pbiAhPSBudWxsICYmIHJ1bGVzLm1heCAhPSBudWxsICkgewoJCQkJcnVsZXMucmFuZ2UgPSBbIHJ1bGVzLm1pbiwgcnVsZXMubWF4IF07CgkJCQlkZWxldGUgcnVsZXMubWluOwoJCQkJZGVsZXRlIHJ1bGVzLm1heDsKCQkJfQoJCQlpZiAoIHJ1bGVzLm1pbmxlbmd0aCAhPSBudWxsICYmIHJ1bGVzLm1heGxlbmd0aCAhPSBudWxsICkgewoJCQkJcnVsZXMucmFuZ2VsZW5ndGggPSBbIHJ1bGVzLm1pbmxlbmd0aCwgcnVsZXMubWF4bGVuZ3RoIF07CgkJCQlkZWxldGUgcnVsZXMubWlubGVuZ3RoOwoJCQkJZGVsZXRlIHJ1bGVzLm1heGxlbmd0aDsKCQkJfQoJCX0KCgkJcmV0dXJuIHJ1bGVzOwoJfSwKCgkvLyBDb252ZXJ0cyBhIHNpbXBsZSBzdHJpbmcgdG8gYSB7c3RyaW5nOiB0cnVlfSBydWxlLCBlLmcuLCAicmVxdWlyZWQiIHRvIHtyZXF1aXJlZDp0cnVlfQoJbm9ybWFsaXplUnVsZTogZnVuY3Rpb24oIGRhdGEgKSB7CgkJaWYgKCB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgKSB7CgkJCXZhciB0cmFuc2Zvcm1lZCA9IHt9OwoJCQkkLmVhY2goIGRhdGEuc3BsaXQoIC9ccy8gKSwgZnVuY3Rpb24oKSB7CgkJCQl0cmFuc2Zvcm1lZFsgdGhpcyBdID0gdHJ1ZTsKCQkJfSk7CgkJCWRhdGEgPSB0cmFuc2Zvcm1lZDsKCQl9CgkJcmV0dXJuIGRhdGE7Cgl9LAoKCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9qUXVlcnkudmFsaWRhdG9yLmFkZE1ldGhvZC8KCWFkZE1ldGhvZDogZnVuY3Rpb24oIG5hbWUsIG1ldGhvZCwgbWVzc2FnZSApIHsKCQkkLnZhbGlkYXRvci5tZXRob2RzWyBuYW1lIF0gPSBtZXRob2Q7CgkJJC52YWxpZGF0b3IubWVzc2FnZXNbIG5hbWUgXSA9IG1lc3NhZ2UgIT09IHVuZGVmaW5lZCA\/IG1lc3NhZ2UgOiAkLnZhbGlkYXRvci5tZXNzYWdlc1sgbmFtZSBdOwoJCWlmICggbWV0aG9kLmxlbmd0aCA8IDMgKSB7CgkJCSQudmFsaWRhdG9yLmFkZENsYXNzUnVsZXMoIG5hbWUsICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGUoIG5hbWUgKSApOwoJCX0KCX0sCgoJbWV0aG9kczogewoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcmVxdWlyZWQtbWV0aG9kLwoJCXJlcXVpcmVkOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkgewoJCQkvLyBjaGVjayBpZiBkZXBlbmRlbmN5IGlzIG1ldAoJCQlpZiAoICF0aGlzLmRlcGVuZCggcGFyYW0sIGVsZW1lbnQgKSApIHsKCQkJCXJldHVybiAiZGVwZW5kZW5jeS1taXNtYXRjaCI7CgkJCX0KCQkJaWYgKCBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJzZWxlY3QiICkgewoJCQkJLy8gY291bGQgYmUgYW4gYXJyYXkgZm9yIHNlbGVjdC1tdWx0aXBsZSBvciBhIHN0cmluZywgYm90aCBhcmUgZmluZSB0aGlzIHdheQoJCQkJdmFyIHZhbCA9ICQoIGVsZW1lbnQgKS52YWwoKTsKCQkJCXJldHVybiB2YWwgJiYgdmFsLmxlbmd0aCA+IDA7CgkJCX0KCQkJaWYgKCB0aGlzLmNoZWNrYWJsZSggZWxlbWVudCApICkgewoJCQkJcmV0dXJuIHRoaXMuZ2V0TGVuZ3RoKCB2YWx1ZSwgZWxlbWVudCApID4gMDsKCQkJfQoJCQlyZXR1cm4gJC50cmltKCB2YWx1ZSApLmxlbmd0aCA+IDA7CgkJfSwKCgkJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2VtYWlsLW1ldGhvZC8KCQllbWFpbDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkgewoJCQkvLyBGcm9tIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3N0YXRlcy1vZi10aGUtdHlwZS1hdHRyaWJ1dGUuaHRtbCNlLW1haWwtc3RhdGUtJTI4dHlwZT1lbWFpbCUyOQoJCQkvLyBSZXRyaWV2ZWQgMjAxNC0wMS0xNAoJCQkvLyBJZiB5b3UgaGF2ZSBhIHByb2JsZW0gd2l0aCB0aGlzIGltcGxlbWVudGF0aW9uLCByZXBvcnQgYSBidWcgYWdhaW5zdCB0aGUgYWJvdmUgc3BlYwoJCQkvLyBPciB1c2UgY3VzdG9tIG1ldGhvZHMgdG8gaW1wbGVtZW50IHlvdXIgb3duIGVtYWlsIHZhbGlkYXRpb24KCQkJcmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAvXlthLXpBLVowLTkuISMkJSYnKitcLz0\/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg\/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8oPzpcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC8udGVzdCggdmFsdWUgKTsKCQl9LAoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvdXJsLW1ldGhvZC8KCQl1cmw6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHsKCQkJLy8gY29udHJpYnV0ZWQgYnkgU2NvdHQgR29uemFsZXo6IGh0dHA6Ly9wcm9qZWN0cy5zY290dHNwbGF5Z3JvdW5kLmNvbS9pcmkvCgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL14oaHR0cHM\/fHM\/ZnRwKTpcL1wvKCgoKFthLXpdfFxkfC18XC58X3x+fFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoJVtcZGEtZl17Mn0pfFshXCQmJ1woXClcKlwrLDs9XXw6KSpAKT8oKChcZHxbMS05XVxkfDFcZFxkfDJbMC00XVxkfDI1WzAtNV0pXC4oXGR8WzEtOV1cZHwxXGRcZHwyWzAtNF1cZHwyNVswLTVdKVwuKFxkfFsxLTldXGR8MVxkXGR8MlswLTRdXGR8MjVbMC01XSlcLihcZHxbMS05XVxkfDFcZFxkfDJbMC00XVxkfDI1WzAtNV0pKXwoKChbYS16XXxcZHxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KChbYS16XXxcZHxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pKihbYS16XXxcZHxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkpKVwuKSsoKFthLXpdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKXwoKFthLXpdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKShbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSkqKFthLXpdfFtcdTAwQTAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdKSkpXC4\/KSg6XGQqKT8pKFwvKCgoW2Etel18XGR8LXxcLnxffH58W1x1MDBBMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0pfCglW1xkYS1mXXsyfSl8WyFcJCYnXChcKVwqXCssOz1dfDp8QCkrKFwvKChbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KCVbXGRhLWZdezJ9KXxbIVwkJidcKFwpXCpcKyw7PV18OnxAKSopKik\/KT8oXD8oKChbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KCVbXGRhLWZdezJ9KXxbIVwkJidcKFwpXCpcKyw7PV18OnxAKXxbXHVFMDAwLVx1RjhGRl18XC98XD8pKik\/KCMoKChbYS16XXxcZHwtfFwufF98fnxbXHUwMEEwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSl8KCVbXGRhLWZdezJ9KXxbIVwkJidcKFwpXCpcKyw7PV18OnxAKXxcL3xcPykqKT8kL2kudGVzdCggdmFsdWUgKTsKCQl9LAoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZGF0ZS1tZXRob2QvCgkJZGF0ZTogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkgewoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8ICEvSW52YWxpZHxOYU4vLnRlc3QoIG5ldyBEYXRlKCB2YWx1ZSApLnRvU3RyaW5nKCkgKTsKCQl9LAoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZGF0ZUlTTy1tZXRob2QvCgkJZGF0ZUlTTzogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkgewoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IC9eXGR7NH1bXC9cLV0oMD9bMS05XXwxWzAxMl0pW1wvXC1dKDA\/WzEtOV18WzEyXVswLTldfDNbMDFdKSQvLnRlc3QoIHZhbHVlICk7CgkJfSwKCgkJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL251bWJlci1tZXRob2QvCgkJbnVtYmVyOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7CgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL14tPyg\/OlxkK3xcZHsxLDN9KD86LFxkezN9KSspPyg\/OlwuXGQrKT8kLy50ZXN0KCB2YWx1ZSApOwoJCX0sCgoJCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9kaWdpdHMtbWV0aG9kLwoJCWRpZ2l0czogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkgewoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IC9eXGQrJC8udGVzdCggdmFsdWUgKTsKCQl9LAoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvY3JlZGl0Y2FyZC1tZXRob2QvCgkJLy8gYmFzZWQgb24gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MdWhuLwoJCWNyZWRpdGNhcmQ6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHsKCQkJaWYgKCB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgKSB7CgkJCQlyZXR1cm4gImRlcGVuZGVuY3ktbWlzbWF0Y2giOwoJCQl9CgkJCS8vIGFjY2VwdCBvbmx5IHNwYWNlcywgZGlnaXRzIGFuZCBkYXNoZXMKCQkJaWYgKCAvW14wLTkgXC1dKy8udGVzdCggdmFsdWUgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQl2YXIgbkNoZWNrID0gMCwKCQkJCW5EaWdpdCA9IDAsCgkJCQliRXZlbiA9IGZhbHNlLAoJCQkJbiwgY0RpZ2l0OwoKCQkJdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCAvXEQvZywgIiIgKTsKCgkJCS8vIEJhc2luZyBtaW4gYW5kIG1heCBsZW5ndGggb24KCQkJLy8gaHR0cDovL2RldmVsb3Blci5lYW4uY29tL2dlbmVyYWxfaW5mby9WYWxpZF9DcmVkaXRfQ2FyZF9UeXBlcwoJCQlpZiAoIHZhbHVlLmxlbmd0aCA8IDEzIHx8IHZhbHVlLmxlbmd0aCA+IDE5ICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgoJCQlmb3IgKCBuID0gdmFsdWUubGVuZ3RoIC0gMTsgbiA+PSAwOyBuLS0pIHsKCQkJCWNEaWdpdCA9IHZhbHVlLmNoYXJBdCggbiApOwoJCQkJbkRpZ2l0ID0gcGFyc2VJbnQoIGNEaWdpdCwgMTAgKTsKCQkJCWlmICggYkV2ZW4gKSB7CgkJCQkJaWYgKCAoIG5EaWdpdCAqPSAyICkgPiA5ICkgewoJCQkJCQluRGlnaXQgLT0gOTsKCQkJCQl9CgkJCQl9CgkJCQluQ2hlY2sgKz0gbkRpZ2l0OwoJCQkJYkV2ZW4gPSAhYkV2ZW47CgkJCX0KCgkJCXJldHVybiAoIG5DaGVjayAlIDEwICkgPT09IDA7CgkJfSwKCgkJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL21pbmxlbmd0aC1tZXRob2QvCgkJbWlubGVuZ3RoOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkgewoJCQl2YXIgbGVuZ3RoID0gJC5pc0FycmF5KCB2YWx1ZSApID8gdmFsdWUubGVuZ3RoIDogdGhpcy5nZXRMZW5ndGgoIHZhbHVlLCBlbGVtZW50ICk7CgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgbGVuZ3RoID49IHBhcmFtOwoJCX0sCgoJCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9tYXhsZW5ndGgtbWV0aG9kLwoJCW1heGxlbmd0aDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHsKCQkJdmFyIGxlbmd0aCA9ICQuaXNBcnJheSggdmFsdWUgKSA\/IHZhbHVlLmxlbmd0aCA6IHRoaXMuZ2V0TGVuZ3RoKCB2YWx1ZSwgZWxlbWVudCApOwoJCQlyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IGxlbmd0aCA8PSBwYXJhbTsKCQl9LAoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcmFuZ2VsZW5ndGgtbWV0aG9kLwoJCXJhbmdlbGVuZ3RoOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkgewoJCQl2YXIgbGVuZ3RoID0gJC5pc0FycmF5KCB2YWx1ZSApID8gdmFsdWUubGVuZ3RoIDogdGhpcy5nZXRMZW5ndGgoIHZhbHVlLCBlbGVtZW50ICk7CgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgKCBsZW5ndGggPj0gcGFyYW1bIDAgXSAmJiBsZW5ndGggPD0gcGFyYW1bIDEgXSApOwoJCX0sCgoJCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9taW4tbWV0aG9kLwoJCW1pbjogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHsKCQkJcmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCB2YWx1ZSA+PSBwYXJhbTsKCQl9LAoKCQkvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvbWF4LW1ldGhvZC8KCQltYXg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7CgkJCXJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgdmFsdWUgPD0gcGFyYW07CgkJfSwKCgkJLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3JhbmdlLW1ldGhvZC8KCQlyYW5nZTogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHsKCQkJcmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAoIHZhbHVlID49IHBhcmFtWyAwIF0gJiYgdmFsdWUgPD0gcGFyYW1bIDEgXSApOwoJCX0sCgoJCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9lcXVhbFRvLW1ldGhvZC8KCQllcXVhbFRvOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkgewoJCQkvLyBiaW5kIHRvIHRoZSBibHVyIGV2ZW50IG9mIHRoZSB0YXJnZXQgaW4gb3JkZXIgdG8gcmV2YWxpZGF0ZSB3aGVuZXZlciB0aGUgdGFyZ2V0IGZpZWxkIGlzIHVwZGF0ZWQKCQkJLy8gVE9ETyBmaW5kIGEgd2F5IHRvIGJpbmQgdGhlIGV2ZW50IGp1c3Qgb25jZSwgYXZvaWRpbmcgdGhlIHVuYmluZC1yZWJpbmQgb3ZlcmhlYWQKCQkJdmFyIHRhcmdldCA9ICQoIHBhcmFtICk7CgkJCWlmICggdGhpcy5zZXR0aW5ncy5vbmZvY3Vzb3V0ICkgewoJCQkJdGFyZ2V0LnVuYmluZCggIi52YWxpZGF0ZS1lcXVhbFRvIiApLmJpbmQoICJibHVyLnZhbGlkYXRlLWVxdWFsVG8iLCBmdW5jdGlvbigpIHsKCQkJCQkkKCBlbGVtZW50ICkudmFsaWQoKTsKCQkJCX0pOwoJCQl9CgkJCXJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0LnZhbCgpOwoJCX0sCgoJCS8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9yZW1vdGUtbWV0aG9kLwoJCXJlbW90ZTogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHsKCQkJaWYgKCB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgKSB7CgkJCQlyZXR1cm4gImRlcGVuZGVuY3ktbWlzbWF0Y2giOwoJCQl9CgoJCQl2YXIgcHJldmlvdXMgPSB0aGlzLnByZXZpb3VzVmFsdWUoIGVsZW1lbnQgKSwKCQkJCXZhbGlkYXRvciwgZGF0YTsKCgkJCWlmICghdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0gKSB7CgkJCQl0aGlzLnNldHRpbmdzLm1lc3NhZ2VzWyBlbGVtZW50Lm5hbWUgXSA9IHt9OwoJCQl9CgkJCXByZXZpb3VzLm9yaWdpbmFsTWVzc2FnZSA9IHRoaXMuc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdLnJlbW90ZTsKCQkJdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0ucmVtb3RlID0gcHJldmlvdXMubWVzc2FnZTsKCgkJCXBhcmFtID0gdHlwZW9mIHBhcmFtID09PSAic3RyaW5nIiAmJiB7IHVybDogcGFyYW0gfSB8fCBwYXJhbTsKCgkJCWlmICggcHJldmlvdXMub2xkID09PSB2YWx1ZSApIHsKCQkJCXJldHVybiBwcmV2aW91cy52YWxpZDsKCQkJfQoKCQkJcHJldmlvdXMub2xkID0gdmFsdWU7CgkJCXZhbGlkYXRvciA9IHRoaXM7CgkJCXRoaXMuc3RhcnRSZXF1ZXN0KCBlbGVtZW50ICk7CgkJCWRhdGEgPSB7fTsKCQkJZGF0YVsgZWxlbWVudC5uYW1lIF0gPSB2YWx1ZTsKCQkJJC5hamF4KCAkLmV4dGVuZCggdHJ1ZSwgewoJCQkJdXJsOiBwYXJhbSwKCQkJCW1vZGU6ICJhYm9ydCIsCgkJCQlwb3J0OiAidmFsaWRhdGUiICsgZWxlbWVudC5uYW1lLAoJCQkJZGF0YVR5cGU6ICJqc29uIiwKCQkJCWRhdGE6IGRhdGEsCgkJCQljb250ZXh0OiB2YWxpZGF0b3IuY3VycmVudEZvcm0sCgkJCQlzdWNjZXNzOiBmdW5jdGlvbiggcmVzcG9uc2UgKSB7CgkJCQkJdmFyIHZhbGlkID0gcmVzcG9uc2UgPT09IHRydWUgfHwgcmVzcG9uc2UgPT09ICJ0cnVlIiwKCQkJCQkJZXJyb3JzLCBtZXNzYWdlLCBzdWJtaXR0ZWQ7CgoJCQkJCXZhbGlkYXRvci5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0ucmVtb3RlID0gcHJldmlvdXMub3JpZ2luYWxNZXNzYWdlOwoJCQkJCWlmICggdmFsaWQgKSB7CgkJCQkJCXN1Ym1pdHRlZCA9IHZhbGlkYXRvci5mb3JtU3VibWl0dGVkOwoJCQkJCQl2YWxpZGF0b3IucHJlcGFyZUVsZW1lbnQoIGVsZW1lbnQgKTsKCQkJCQkJdmFsaWRhdG9yLmZvcm1TdWJtaXR0ZWQgPSBzdWJtaXR0ZWQ7CgkJCQkJCXZhbGlkYXRvci5zdWNjZXNzTGlzdC5wdXNoKCBlbGVtZW50ICk7CgkJCQkJCWRlbGV0ZSB2YWxpZGF0b3IuaW52YWxpZFsgZWxlbWVudC5uYW1lIF07CgkJCQkJCXZhbGlkYXRvci5zaG93RXJyb3JzKCk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZXJyb3JzID0ge307CgkJCQkJCW1lc3NhZ2UgPSByZXNwb25zZSB8fCB2YWxpZGF0b3IuZGVmYXVsdE1lc3NhZ2UoIGVsZW1lbnQsICJyZW1vdGUiICk7CgkJCQkJCWVycm9yc1sgZWxlbWVudC5uYW1lIF0gPSBwcmV2aW91cy5tZXNzYWdlID0gJC5pc0Z1bmN0aW9uKCBtZXNzYWdlICkgPyBtZXNzYWdlKCB2YWx1ZSApIDogbWVzc2FnZTsKCQkJCQkJdmFsaWRhdG9yLmludmFsaWRbIGVsZW1lbnQubmFtZSBdID0gdHJ1ZTsKCQkJCQkJdmFsaWRhdG9yLnNob3dFcnJvcnMoIGVycm9ycyApOwoJCQkJCX0KCQkJCQlwcmV2aW91cy52YWxpZCA9IHZhbGlkOwoJCQkJCXZhbGlkYXRvci5zdG9wUmVxdWVzdCggZWxlbWVudCwgdmFsaWQgKTsKCQkJCX0KCQkJfSwgcGFyYW0gKSApOwoJCQlyZXR1cm4gInBlbmRpbmciOwoJCX0KCgl9Cgp9KTsKCiQuZm9ybWF0ID0gZnVuY3Rpb24gZGVwcmVjYXRlZCgpIHsKCXRocm93ICIkLmZvcm1hdCBoYXMgYmVlbiBkZXByZWNhdGVkLiBQbGVhc2UgdXNlICQudmFsaWRhdG9yLmZvcm1hdCBpbnN0ZWFkLiI7Cn07Cg==",
    "size": "40927"
}