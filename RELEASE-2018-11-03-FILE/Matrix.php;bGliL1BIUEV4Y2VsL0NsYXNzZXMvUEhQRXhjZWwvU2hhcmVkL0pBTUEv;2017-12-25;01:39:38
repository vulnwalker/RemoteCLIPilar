{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Shared\/JAMA\/Matrix.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKLyoqCiAqIEBwYWNrYWdlIEpBTUEKICovCgovKiogUEhQRXhjZWwgcm9vdCBkaXJlY3RvcnkgKi8KaWYgKCFkZWZpbmVkKCdQSFBFWENFTF9ST09UJykpIHsKICAgIC8qKgogICAgICogQGlnbm9yZQogICAgICovCiAgICBkZWZpbmUoJ1BIUEVYQ0VMX1JPT1QnLCBkaXJuYW1lKF9fRklMRV9fKSAuICcvLi4vLi4vLi4vJyk7CiAgICByZXF1aXJlKFBIUEVYQ0VMX1JPT1QgLiAnUEhQRXhjZWwvQXV0b2xvYWRlci5waHAnKTsKfQoKCi8qCiAqICAgIE1hdHJpeCBjbGFzcwogKgogKiAgICBAYXV0aG9yIFBhdWwgTWVhZ2hlcgogKiAgICBAYXV0aG9yIE1pY2hhZWwgQm9tbWFyaXRvCiAqICAgIEBhdXRob3IgTHVrYXN6IEthcmFwdWRhCiAqICAgIEBhdXRob3IgQmFydGVrIE1hdG9zaXVrCiAqICAgIEB2ZXJzaW9uIDEuOAogKiAgICBAbGljZW5zZSBQSFAgdjMuMAogKiAgICBAc2VlIGh0dHA6Ly9tYXRoLm5pc3QuZ292L2phdmFudW1lcmljcy9qYW1hLwogKi8KY2xhc3MgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4CnsKICAgIGNvbnN0IFBPTFlNT1JQSElDX0FSR1VNRU5UX0VYQ0VQVElPTiA9ICJJbnZhbGlkIGFyZ3VtZW50IHBhdHRlcm4gZm9yIHBvbHltb3JwaGljIGZ1bmN0aW9uLiI7CiAgICBjb25zdCBBUkdVTUVOVF9UWVBFX0VYQ0VQVElPTiAgICAgICAgPSAiSW52YWxpZCBhcmd1bWVudCB0eXBlLiI7CiAgICBjb25zdCBBUkdVTUVOVF9CT1VORFNfRVhDRVBUSU9OICAgICAgPSAiSW52YWxpZCBhcmd1bWVudCByYW5nZS4iOwogICAgY29uc3QgTUFUUklYX0RJTUVOU0lPTl9FWENFUFRJT04gICAgID0gIk1hdHJpeCBkaW1lbnNpb25zIGFyZSBub3QgZXF1YWwuIjsKICAgIGNvbnN0IEFSUkFZX0xFTkdUSF9FWENFUFRJT04gICAgICAgICA9ICJBcnJheSBsZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIG0uIjsKCiAgICAvKioKICAgICAqICAgIE1hdHJpeCBzdG9yYWdlCiAgICAgKgogICAgICogICAgQHZhciBhcnJheQogICAgICogICAgQGFjY2VzcyBwdWJsaWMKICAgICAqLwogICAgcHVibGljICRBID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqICAgIE1hdHJpeCByb3cgZGltZW5zaW9uCiAgICAgKgogICAgICogICAgQHZhciBpbnQKICAgICAqICAgIEBhY2Nlc3MgcHJpdmF0ZQogICAgICovCiAgICBwcml2YXRlICRtOwoKICAgIC8qKgogICAgICogICAgTWF0cml4IGNvbHVtbiBkaW1lbnNpb24KICAgICAqCiAgICAgKiAgICBAdmFyIGludAogICAgICogICAgQGFjY2VzcyBwcml2YXRlCiAgICAgKi8KICAgIHByaXZhdGUgJG47CgogICAgLyoqCiAgICAgKiAgICBQb2x5bW9ycGhpYyBjb25zdHJ1Y3RvcgogICAgICoKICAgICAqICAgIEFzIFBIUCBoYXMgbm8gc3VwcG9ydCBmb3IgcG9seW1vcnBoaWMgY29uc3RydWN0b3JzLCB3ZSBoYWNrIG91ciBvd24gc29ydCBvZiBwb2x5bW9ycGhpc20gdXNpbmcgZnVuY19udW1fYXJncywgZnVuY19nZXRfYXJnLCBhbmQgZ2V0dHlwZS4gSW4gZXNzZW5jZSwgd2UncmUganVzdCBpbXBsZW1lbnRpbmcgYSBzaW1wbGUgUlRUSSBmaWx0ZXIgYW5kIGNhbGxpbmcgdGhlIGFwcHJvcHJpYXRlIGNvbnN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKQogICAgewogICAgICAgIGlmIChmdW5jX251bV9hcmdzKCkgPiAwKSB7CiAgICAgICAgICAgICRhcmdzID0gZnVuY19nZXRfYXJncygpOwogICAgICAgICAgICAkbWF0Y2ggPSBpbXBsb2RlKCIsIiwgYXJyYXlfbWFwKCdnZXR0eXBlJywgJGFyZ3MpKTsKCiAgICAgICAgICAgIHN3aXRjaCAoJG1hdGNoKSB7CiAgICAgICAgICAgICAgICAvL1JlY3Rhbmd1bGFyIG1hdHJpeCAtIG0geCBuIGluaXRpYWxpemVkIGZyb20gMkQgYXJyYXkKICAgICAgICAgICAgICAgIGNhc2UgJ2FycmF5JzoKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bSA9IGNvdW50KCRhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+biA9IGNvdW50KCRhcmdzWzBdWzBdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QSA9ICRhcmdzWzBdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy9TcXVhcmUgbWF0cml4IC0gbiB4IG4KICAgICAgICAgICAgICAgIGNhc2UgJ2ludGVnZXInOgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5tID0gJGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm4gPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QSA9IGFycmF5X2ZpbGwoMCwgJHRoaXMtPm0sIGFycmF5X2ZpbGwoMCwgJHRoaXMtPm4sIDApKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vUmVjdGFuZ3VsYXIgbWF0cml4IC0gbSB4IG4KICAgICAgICAgICAgICAgIGNhc2UgJ2ludGVnZXIsaW50ZWdlcic6CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm0gPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+biA9ICRhcmdzWzFdOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5BID0gYXJyYXlfZmlsbCgwLCAkdGhpcy0+bSwgYXJyYXlfZmlsbCgwLCAkdGhpcy0+biwgMCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy9SZWN0YW5ndWxhciBtYXRyaXggLSBtIHggbiBpbml0aWFsaXplZCBmcm9tIHBhY2tlZCBhcnJheQogICAgICAgICAgICAgICAgY2FzZSAnYXJyYXksaW50ZWdlcic6CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm0gPSAkYXJnc1sxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPm0gIT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+biA9IGNvdW50KCRhcmdzWzBdKSAvICR0aGlzLT5tOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5uID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkdGhpcy0+bSAqICR0aGlzLT5uKSA9PSBjb3VudCgkYXJnc1swXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJHRoaXMtPm07ICsrJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiA8ICR0aGlzLT5uOyArKyRqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkFbJGldWyRqXSA9ICRhcmdzWzBdWyRpICsgJGogKiAkdGhpcy0+bV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSUkFZX0xFTkdUSF9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqICAgIGdldEFycmF5CiAgICAgKgogICAgICogICAgQHJldHVybiBhcnJheSBNYXRyaXggYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEFycmF5KCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPkE7CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBnZXRSb3dEaW1lbnNpb24KICAgICAqCiAgICAgKiAgICBAcmV0dXJuIGludCBSb3cgZGltZW5zaW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSb3dEaW1lbnNpb24oKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bTsKICAgIH0KCiAgICAvKioKICAgICAqICAgIGdldENvbHVtbkRpbWVuc2lvbgogICAgICoKICAgICAqICAgIEByZXR1cm4gaW50IENvbHVtbiBkaW1lbnNpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbkRpbWVuc2lvbigpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5uOwogICAgfQoKICAgIC8qKgogICAgICogICAgZ2V0CiAgICAgKgogICAgICogICAgR2V0IHRoZSBpLGotdGggZWxlbWVudCBvZiB0aGUgbWF0cml4LgogICAgICogICAgQHBhcmFtIGludCAkaSBSb3cgcG9zaXRpb24KICAgICAqICAgIEBwYXJhbSBpbnQgJGogQ29sdW1uIHBvc2l0aW9uCiAgICAgKiAgICBAcmV0dXJuIG1peGVkIEVsZW1lbnQgKGludC9mbG9hdC9kb3VibGUpCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXQoJGkgPSBudWxsLCAkaiA9IG51bGwpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5BWyRpXVskal07CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBnZXRNYXRyaXgKICAgICAqCiAgICAgKiAgICBHZXQgYSBzdWJtYXRyaXgKICAgICAqICAgIEBwYXJhbSBpbnQgJGkwIEluaXRpYWwgcm93IGluZGV4CiAgICAgKiAgICBAcGFyYW0gaW50ICRpRiBGaW5hbCByb3cgaW5kZXgKICAgICAqICAgIEBwYXJhbSBpbnQgJGowIEluaXRpYWwgY29sdW1uIGluZGV4CiAgICAgKiAgICBAcGFyYW0gaW50ICRqRiBGaW5hbCBjb2x1bW4gaW5kZXgKICAgICAqICAgIEByZXR1cm4gTWF0cml4IFN1Ym1hdHJpeAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWF0cml4KCkKICAgIHsKICAgICAgICBpZiAoZnVuY19udW1fYXJncygpID4gMCkgewogICAgICAgICAgICAkYXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAgICAgJG1hdGNoID0gaW1wbG9kZSgiLCIsIGFycmF5X21hcCgnZ2V0dHlwZScsICRhcmdzKSk7CgogICAgICAgICAgICBzd2l0Y2ggKCRtYXRjaCkgewogICAgICAgICAgICAgICAgLy9BKCRpMC4uLjsgJGowLi4uKQogICAgICAgICAgICAgICAgY2FzZSAnaW50ZWdlcixpbnRlZ2VyJzoKICAgICAgICAgICAgICAgICAgICBsaXN0KCRpMCwgJGowKSA9ICRhcmdzOwogICAgICAgICAgICAgICAgICAgIGlmICgkaTAgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkbSA9ICR0aGlzLT5tIC0gJGkwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfQk9VTkRTX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkajAgPj0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkbiA9ICR0aGlzLT5uIC0gJGowOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfQk9VTkRTX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRSID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkbSwgJG4pOwogICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAkaTA7ICRpIDwgJHRoaXMtPm07ICsrJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9ICRqMDsgJGogPCAkdGhpcy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFItPnNldCgkaSwgJGosICR0aGlzLT5BWyRpXVskal0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkUjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vQSgkaTAuLi4kaUY7ICRqMC4uLiRqRikKICAgICAgICAgICAgICAgIGNhc2UgJ2ludGVnZXIsaW50ZWdlcixpbnRlZ2VyLGludGVnZXInOgogICAgICAgICAgICAgICAgICAgIGxpc3QoJGkwLCAkaUYsICRqMCwgJGpGKSA9ICRhcmdzOwogICAgICAgICAgICAgICAgICAgIGlmICgoJGlGID4gJGkwKSAmJiAoJHRoaXMtPm0gPj0gJGlGKSAmJiAoJGkwID49IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtID0gJGlGIC0gJGkwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfQk9VTkRTX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgoJGpGID4gJGowKSAmJiAoJHRoaXMtPm4gPj0gJGpGKSAmJiAoJGowID49IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRuID0gJGpGIC0gJGowOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfQk9VTkRTX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRSID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkbSsxLCAkbisxKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gJGkwOyAkaSA8PSAkaUY7ICsrJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9ICRqMDsgJGogPD0gJGpGOyArKyRqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUi0+c2V0KCRpIC0gJGkwLCAkaiAtICRqMCwgJHRoaXMtPkFbJGldWyRqXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRSOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8kUiA9IGFycmF5IG9mIHJvdyBpbmRpY2VzOyAkQyA9IGFycmF5IG9mIGNvbHVtbiBpbmRpY2VzCiAgICAgICAgICAgICAgICBjYXNlICdhcnJheSxhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkUkwsICRDTCkgPSAkYXJnczsKICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQoJFJMKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG0gPSBjb3VudCgkUkwpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfQk9VTkRTX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCgkQ0wpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkbiA9IGNvdW50KCRDTCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9CT1VORFNfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFIgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRtLCAkbik7CiAgICAgICAgICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG07ICsrJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJG47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSLT5zZXQoJGkgLSAkaTAsICRqIC0gJGowLCAkdGhpcy0+QVskUkxbJGldXVskQ0xbJGpdXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRSOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8kUkwgPSBhcnJheSBvZiByb3cgaW5kaWNlczsgJENMID0gYXJyYXkgb2YgY29sdW1uIGluZGljZXMKICAgICAgICAgICAgICAgIGNhc2UgJ2FycmF5LGFycmF5JzoKICAgICAgICAgICAgICAgICAgICBsaXN0KCRSTCwgJENMKSA9ICRhcmdzOwogICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCgkUkwpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkbSA9IGNvdW50KCRSTCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9CT1VORFNfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50KCRDTCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRuID0gY291bnQoJENMKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX0JPVU5EU19FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkUiA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJG0sICRuKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkbTsgKyskaSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkbjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFItPnNldCgkaSwgJGosICR0aGlzLT5BWyRSTFskaV1dWyRDTFskal1dKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJFI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvL0EoJGkwLi4uJGlGKTsgJENMID0gYXJyYXkgb2YgY29sdW1uIGluZGljZXMKICAgICAgICAgICAgICAgIGNhc2UgJ2ludGVnZXIsaW50ZWdlcixhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkaTAsICRpRiwgJENMKSA9ICRhcmdzOwogICAgICAgICAgICAgICAgICAgIGlmICgoJGlGID4gJGkwKSAmJiAoJHRoaXMtPm0gPj0gJGlGKSAmJiAoJGkwID49IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtID0gJGlGIC0gJGkwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfQk9VTkRTX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCgkQ0wpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkbiA9IGNvdW50KCRDTCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9CT1VORFNfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFIgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRtLCAkbik7CiAgICAgICAgICAgICAgICAgICAgZm9yICgkaSA9ICRpMDsgJGkgPCAkaUY7ICsrJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJG47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSLT5zZXQoJGkgLSAkaTAsICRqLCAkdGhpcy0+QVskUkxbJGldXVskal0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkUjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIC8vJFJMID0gYXJyYXkgb2Ygcm93IGluZGljZXMKICAgICAgICAgICAgICAgIGNhc2UgJ2FycmF5LGludGVnZXIsaW50ZWdlcic6CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkUkwsICRqMCwgJGpGKSA9ICRhcmdzOwogICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCgkUkwpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkbSA9IGNvdW50KCRSTCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9CT1VORFNfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkakYgPj0gJGowKSAmJiAoJHRoaXMtPm4gPj0gJGpGKSAmJiAoJGowID49IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRuID0gJGpGIC0gJGowOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfQk9VTkRTX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRSID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkbSwgJG4rMSk7CiAgICAgICAgICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG07ICsrJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9ICRqMDsgJGogPD0gJGpGOyArKyRqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUi0+c2V0KCRpLCAkaiAtICRqMCwgJHRoaXMtPkFbJFJMWyRpXV1bJGpdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJFI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBjaGVja01hdHJpeERpbWVuc2lvbnMKICAgICAqCiAgICAgKiAgICBJcyBtYXRyaXggQiB0aGUgc2FtZSBzaXplPwogICAgICogICAgQHBhcmFtIE1hdHJpeCAkQiBNYXRyaXggQgogICAgICogICAgQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjaGVja01hdHJpeERpbWVuc2lvbnMoJEIgPSBudWxsKQogICAgewogICAgICAgIGlmICgkQiBpbnN0YW5jZW9mIFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCkgewogICAgICAgICAgICBpZiAoKCR0aGlzLT5tID09ICRCLT5nZXRSb3dEaW1lbnNpb24oKSkgJiYgKCR0aGlzLT5uID09ICRCLT5nZXRDb2x1bW5EaW1lbnNpb24oKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpNQVRSSVhfRElNRU5TSU9OX0VYQ0VQVElPTik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX1RZUEVfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9ICAgIC8vICAgIGZ1bmN0aW9uIGNoZWNrTWF0cml4RGltZW5zaW9ucygpCgogICAgLyoqCiAgICAgKiAgICBzZXQKICAgICAqCiAgICAgKiAgICBTZXQgdGhlIGksai10aCBlbGVtZW50IG9mIHRoZSBtYXRyaXguCiAgICAgKiAgICBAcGFyYW0gaW50ICRpIFJvdyBwb3NpdGlvbgogICAgICogICAgQHBhcmFtIGludCAkaiBDb2x1bW4gcG9zaXRpb24KICAgICAqICAgIEBwYXJhbSBtaXhlZCAkYyBJbnQvZmxvYXQvZG91YmxlIHZhbHVlCiAgICAgKiAgICBAcmV0dXJuIG1peGVkIEVsZW1lbnQgKGludC9mbG9hdC9kb3VibGUpCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXQoJGkgPSBudWxsLCAkaiA9IG51bGwsICRjID0gbnVsbCkKICAgIHsKICAgICAgICAvLyBPcHRpbWl6ZWQgc2V0IHZlcnNpb24ganVzdCBoYXMgdGhpcwogICAgICAgICR0aGlzLT5BWyRpXVskal0gPSAkYzsKICAgIH0gICAgLy8gICAgZnVuY3Rpb24gc2V0KCkKCiAgICAvKioKICAgICAqICAgIGlkZW50aXR5CiAgICAgKgogICAgICogICAgR2VuZXJhdGUgYW4gaWRlbnRpdHkgbWF0cml4LgogICAgICogICAgQHBhcmFtIGludCAkbSBSb3cgZGltZW5zaW9uCiAgICAgKiAgICBAcGFyYW0gaW50ICRuIENvbHVtbiBkaW1lbnNpb24KICAgICAqICAgIEByZXR1cm4gTWF0cml4IElkZW50aXR5IG1hdHJpeAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaWRlbnRpdHkoJG0gPSBudWxsLCAkbiA9IG51bGwpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5kaWFnb25hbCgkbSwgJG4sIDEpOwogICAgfQoKICAgIC8qKgogICAgICogICAgZGlhZ29uYWwKICAgICAqCiAgICAgKiAgICBHZW5lcmF0ZSBhIGRpYWdvbmFsIG1hdHJpeAogICAgICogICAgQHBhcmFtIGludCAkbSBSb3cgZGltZW5zaW9uCiAgICAgKiAgICBAcGFyYW0gaW50ICRuIENvbHVtbiBkaW1lbnNpb24KICAgICAqICAgIEBwYXJhbSBtaXhlZCAkYyBEaWFnb25hbCB2YWx1ZQogICAgICogICAgQHJldHVybiBNYXRyaXggRGlhZ29uYWwgbWF0cml4CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkaWFnb25hbCgkbSA9IG51bGwsICRuID0gbnVsbCwgJGMgPSAxKQogICAgewogICAgICAgICRSID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkbSwgJG4pOwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRtOyArKyRpKSB7CiAgICAgICAgICAgICRSLT5zZXQoJGksICRpLCAkYyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkUjsKICAgIH0KCiAgICAvKioKICAgICAqICAgIGdldE1hdHJpeEJ5Um93CiAgICAgKgogICAgICogICAgR2V0IGEgc3VibWF0cml4IGJ5IHJvdyBpbmRleC9yYW5nZQogICAgICogICAgQHBhcmFtIGludCAkaTAgSW5pdGlhbCByb3cgaW5kZXgKICAgICAqICAgIEBwYXJhbSBpbnQgJGlGIEZpbmFsIHJvdyBpbmRleAogICAgICogICAgQHJldHVybiBNYXRyaXggU3VibWF0cml4CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRNYXRyaXhCeVJvdygkaTAgPSBudWxsLCAkaUYgPSBudWxsKQogICAgewogICAgICAgIGlmIChpc19pbnQoJGkwKSkgewogICAgICAgICAgICBpZiAoaXNfaW50KCRpRikpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Z2V0TWF0cml4KCRpMCwgMCwgJGlGICsgMSwgJHRoaXMtPm4pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5nZXRNYXRyaXgoJGkwLCAwLCAkaTAgKyAxLCAkdGhpcy0+bik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX1RZUEVfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBnZXRNYXRyaXhCeUNvbAogICAgICoKICAgICAqICAgIEdldCBhIHN1Ym1hdHJpeCBieSBjb2x1bW4gaW5kZXgvcmFuZ2UKICAgICAqICAgIEBwYXJhbSBpbnQgJGkwIEluaXRpYWwgY29sdW1uIGluZGV4CiAgICAgKiAgICBAcGFyYW0gaW50ICRpRiBGaW5hbCBjb2x1bW4gaW5kZXgKICAgICAqICAgIEByZXR1cm4gTWF0cml4IFN1Ym1hdHJpeAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWF0cml4QnlDb2woJGowID0gbnVsbCwgJGpGID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAoaXNfaW50KCRqMCkpIHsKICAgICAgICAgICAgaWYgKGlzX2ludCgkakYpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmdldE1hdHJpeCgwLCAkajAsICR0aGlzLT5tLCAkakYgKyAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Z2V0TWF0cml4KDAsICRqMCwgJHRoaXMtPm0sICRqMCArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9UWVBFX0VYQ0VQVElPTik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogICAgdHJhbnNwb3NlCiAgICAgKgogICAgICogICAgVHJhbnBvc2UgbWF0cml4CiAgICAgKiAgICBAcmV0dXJuIE1hdHJpeCBUcmFuc3Bvc2VkIG1hdHJpeAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdHJhbnNwb3NlKCkKICAgIHsKICAgICAgICAkUiA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJHRoaXMtPm4sICR0aGlzLT5tKTsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdGhpcy0+bTsgKyskaSkgewogICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkdGhpcy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgJFItPnNldCgkaiwgJGksICR0aGlzLT5BWyRpXVskal0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkUjsKICAgIH0gICAgLy8gICAgZnVuY3Rpb24gdHJhbnNwb3NlKCkKCiAgICAvKioKICAgICAqICAgIHRyYWNlCiAgICAgKgogICAgICogICAgU3VtIG9mIGRpYWdvbmFsIGVsZW1lbnRzCiAgICAgKiAgICBAcmV0dXJuIGZsb2F0IFN1bSBvZiBkaWFnb25hbCBlbGVtZW50cwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdHJhY2UoKQogICAgewogICAgICAgICRzID0gMDsKICAgICAgICAkbiA9IG1pbigkdGhpcy0+bSwgJHRoaXMtPm4pOwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRuOyArKyRpKSB7CiAgICAgICAgICAgICRzICs9ICR0aGlzLT5BWyRpXVskaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiAkczsKICAgIH0KCiAgICAvKioKICAgICAqICAgIHVtaW51cwogICAgICoKICAgICAqICAgIFVuYXJ5IG1pbnVzIG1hdHJpeCAtQQogICAgICogICAgQHJldHVybiBNYXRyaXggVW5hcnkgbWludXMgbWF0cml4CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1bWludXMoKQogICAgewogICAgfQoKICAgIC8qKgogICAgICogICAgcGx1cwogICAgICoKICAgICAqICAgIEEgKyBCCiAgICAgKiAgICBAcGFyYW0gbWl4ZWQgJEIgTWF0cml4L0FycmF5CiAgICAgKiAgICBAcmV0dXJuIE1hdHJpeCBTdW0KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHBsdXMoKQogICAgewogICAgICAgIGlmIChmdW5jX251bV9hcmdzKCkgPiAwKSB7CiAgICAgICAgICAgICRhcmdzID0gZnVuY19nZXRfYXJncygpOwogICAgICAgICAgICAkbWF0Y2ggPSBpbXBsb2RlKCIsIiwgYXJyYXlfbWFwKCdnZXR0eXBlJywgJGFyZ3MpKTsKCiAgICAgICAgICAgIHN3aXRjaCAoJG1hdGNoKSB7CiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICAgICAgICAgIGlmICgkYXJnc1swXSBpbnN0YW5jZW9mIFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCkgewogICAgICAgICAgICAgICAgICAgICAgICAkTSA9ICRhcmdzWzBdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfVFlQRV9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2FycmF5JzoKICAgICAgICAgICAgICAgICAgICAkTSA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OlBPTFlNT1JQSElDX0FSR1VNRU5UX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPmNoZWNrTWF0cml4RGltZW5zaW9ucygkTSk7CiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICR0aGlzLT5tOyArKyRpKSB7CiAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkdGhpcy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICRNLT5zZXQoJGksICRqLCAkTS0+Z2V0KCRpLCAkaikgKyAkdGhpcy0+QVskaV1bJGpdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJE07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqICAgIHBsdXNFcXVhbHMKICAgICAqCiAgICAgKiAgICBBID0gQSArIEIKICAgICAqICAgIEBwYXJhbSBtaXhlZCAkQiBNYXRyaXgvQXJyYXkKICAgICAqICAgIEByZXR1cm4gTWF0cml4IFN1bQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcGx1c0VxdWFscygpCiAgICB7CiAgICAgICAgaWYgKGZ1bmNfbnVtX2FyZ3MoKSA+IDApIHsKICAgICAgICAgICAgJGFyZ3MgPSBmdW5jX2dldF9hcmdzKCk7CiAgICAgICAgICAgICRtYXRjaCA9IGltcGxvZGUoIiwiLCBhcnJheV9tYXAoJ2dldHR5cGUnLCAkYXJncykpOwoKICAgICAgICAgICAgc3dpdGNoICgkbWF0Y2gpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCRhcmdzWzBdIGluc3RhbmNlb2YgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNID0gJGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9UWVBFX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnYXJyYXknOgogICAgICAgICAgICAgICAgICAgICRNID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+Y2hlY2tNYXRyaXhEaW1lbnNpb25zKCRNKTsKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJHRoaXMtPm07ICsrJGkpIHsKICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiA8ICR0aGlzLT5uOyArKyRqKSB7CiAgICAgICAgICAgICAgICAgICAgJHZhbGlkVmFsdWVzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSAkTS0+Z2V0KCRpLCAkaik7CiAgICAgICAgICAgICAgICAgICAgaWYgKChpc19zdHJpbmcoJHRoaXMtPkFbJGldWyRqXSkpICYmIChzdHJsZW4oJHRoaXMtPkFbJGldWyRqXSkgPiAwKSAmJiAoIWlzX251bWVyaWMoJHRoaXMtPkFbJGldWyRqXSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5BWyRpXVskal0gPSB0cmltKCR0aGlzLT5BWyRpXVskal0sICciJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWxpZFZhbHVlcyAmPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpjb252ZXJ0VG9OdW1iZXJJZkZyYWN0aW9uKCR0aGlzLT5BWyRpXVskal0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKGlzX3N0cmluZygkdmFsdWUpKSAmJiAoc3RybGVuKCR2YWx1ZSkgPiAwKSAmJiAoIWlzX251bWVyaWMoJHZhbHVlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gdHJpbSgkdmFsdWUsICciJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWxpZFZhbHVlcyAmPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpjb252ZXJ0VG9OdW1iZXJJZkZyYWN0aW9uKCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdmFsaWRWYWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkFbJGldWyRqXSArPSAkdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkFbJGldWyRqXSA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdGhpczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OlBPTFlNT1JQSElDX0FSR1VNRU5UX0VYQ0VQVElPTik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogICAgbWludXMKICAgICAqCiAgICAgKiAgICBBIC0gQgogICAgICogICAgQHBhcmFtIG1peGVkICRCIE1hdHJpeC9BcnJheQogICAgICogICAgQHJldHVybiBNYXRyaXggU3VtCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBtaW51cygpCiAgICB7CiAgICAgICAgaWYgKGZ1bmNfbnVtX2FyZ3MoKSA+IDApIHsKICAgICAgICAgICAgJGFyZ3MgPSBmdW5jX2dldF9hcmdzKCk7CiAgICAgICAgICAgICRtYXRjaCA9IGltcGxvZGUoIiwiLCBhcnJheV9tYXAoJ2dldHR5cGUnLCAkYXJncykpOwoKICAgICAgICAgICAgc3dpdGNoICgkbWF0Y2gpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCRhcmdzWzBdIGluc3RhbmNlb2YgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNID0gJGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9UWVBFX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnYXJyYXknOgogICAgICAgICAgICAgICAgICAgICRNID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+Y2hlY2tNYXRyaXhEaW1lbnNpb25zKCRNKTsKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJHRoaXMtPm07ICsrJGkpIHsKICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiA8ICR0aGlzLT5uOyArKyRqKSB7CiAgICAgICAgICAgICAgICAgICAgJE0tPnNldCgkaSwgJGosICRNLT5nZXQoJGksICRqKSAtICR0aGlzLT5BWyRpXVskal0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkTTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OlBPTFlNT1JQSElDX0FSR1VNRU5UX0VYQ0VQVElPTik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogICAgbWludXNFcXVhbHMKICAgICAqCiAgICAgKiAgICBBID0gQSAtIEIKICAgICAqICAgIEBwYXJhbSBtaXhlZCAkQiBNYXRyaXgvQXJyYXkKICAgICAqICAgIEByZXR1cm4gTWF0cml4IFN1bQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbWludXNFcXVhbHMoKQogICAgewogICAgICAgIGlmIChmdW5jX251bV9hcmdzKCkgPiAwKSB7CiAgICAgICAgICAgICRhcmdzID0gZnVuY19nZXRfYXJncygpOwogICAgICAgICAgICAkbWF0Y2ggPSBpbXBsb2RlKCIsIiwgYXJyYXlfbWFwKCdnZXR0eXBlJywgJGFyZ3MpKTsKCiAgICAgICAgICAgIHN3aXRjaCAoJG1hdGNoKSB7CiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICAgICAgICAgIGlmICgkYXJnc1swXSBpbnN0YW5jZW9mIFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCkgewogICAgICAgICAgICAgICAgICAgICAgICAkTSA9ICRhcmdzWzBdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfVFlQRV9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2FycmF5JzoKICAgICAgICAgICAgICAgICAgICAkTSA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OlBPTFlNT1JQSElDX0FSR1VNRU5UX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPmNoZWNrTWF0cml4RGltZW5zaW9ucygkTSk7CiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICR0aGlzLT5tOyArKyRpKSB7CiAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkdGhpcy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICR2YWxpZFZhbHVlcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gJE0tPmdldCgkaSwgJGopOwogICAgICAgICAgICAgICAgICAgIGlmICgoaXNfc3RyaW5nKCR0aGlzLT5BWyRpXVskal0pKSAmJiAoc3RybGVuKCR0aGlzLT5BWyRpXVskal0pID4gMCkgJiYgKCFpc19udW1lcmljKCR0aGlzLT5BWyRpXVskal0pKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QVskaV1bJGpdID0gdHJpbSgkdGhpcy0+QVskaV1bJGpdLCAnIicpOwogICAgICAgICAgICAgICAgICAgICAgICAkdmFsaWRWYWx1ZXMgJj0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Y29udmVydFRvTnVtYmVySWZGcmFjdGlvbigkdGhpcy0+QVskaV1bJGpdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKChpc19zdHJpbmcoJHZhbHVlKSkgJiYgKHN0cmxlbigkdmFsdWUpID4gMCkgJiYgKCFpc19udW1lcmljKCR2YWx1ZSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9IHRyaW0oJHZhbHVlLCAnIicpOwogICAgICAgICAgICAgICAgICAgICAgICAkdmFsaWRWYWx1ZXMgJj0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Y29udmVydFRvTnVtYmVySWZGcmFjdGlvbigkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbGlkVmFsdWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5BWyRpXVskal0gLT0gJHZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5BWyRpXVskal0gPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHRoaXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqICAgIGFycmF5VGltZXMKICAgICAqCiAgICAgKiAgICBFbGVtZW50LWJ5LWVsZW1lbnQgbXVsdGlwbGljYXRpb24KICAgICAqICAgIENpaiA9IEFpaiAqIEJpagogICAgICogICAgQHBhcmFtIG1peGVkICRCIE1hdHJpeC9BcnJheQogICAgICogICAgQHJldHVybiBNYXRyaXggTWF0cml4IENpagogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXJyYXlUaW1lcygpCiAgICB7CiAgICAgICAgaWYgKGZ1bmNfbnVtX2FyZ3MoKSA+IDApIHsKICAgICAgICAgICAgJGFyZ3MgPSBmdW5jX2dldF9hcmdzKCk7CiAgICAgICAgICAgICRtYXRjaCA9IGltcGxvZGUoIiwiLCBhcnJheV9tYXAoJ2dldHR5cGUnLCAkYXJncykpOwoKICAgICAgICAgICAgc3dpdGNoICgkbWF0Y2gpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCRhcmdzWzBdIGluc3RhbmNlb2YgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNID0gJGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9UWVBFX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnYXJyYXknOgogICAgICAgICAgICAgICAgICAgICRNID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+Y2hlY2tNYXRyaXhEaW1lbnNpb25zKCRNKTsKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJHRoaXMtPm07ICsrJGkpIHsKICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiA8ICR0aGlzLT5uOyArKyRqKSB7CiAgICAgICAgICAgICAgICAgICAgJE0tPnNldCgkaSwgJGosICRNLT5nZXQoJGksICRqKSAqICR0aGlzLT5BWyRpXVskal0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkTTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OlBPTFlNT1JQSElDX0FSR1VNRU5UX0VYQ0VQVElPTik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogICAgYXJyYXlUaW1lc0VxdWFscwogICAgICoKICAgICAqICAgIEVsZW1lbnQtYnktZWxlbWVudCBtdWx0aXBsaWNhdGlvbgogICAgICogICAgQWlqID0gQWlqICogQmlqCiAgICAgKiAgICBAcGFyYW0gbWl4ZWQgJEIgTWF0cml4L0FycmF5CiAgICAgKiAgICBAcmV0dXJuIE1hdHJpeCBNYXRyaXggQWlqCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhcnJheVRpbWVzRXF1YWxzKCkKICAgIHsKICAgICAgICBpZiAoZnVuY19udW1fYXJncygpID4gMCkgewogICAgICAgICAgICAkYXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAgICAgJG1hdGNoID0gaW1wbG9kZSgiLCIsIGFycmF5X21hcCgnZ2V0dHlwZScsICRhcmdzKSk7CgogICAgICAgICAgICBzd2l0Y2ggKCRtYXRjaCkgewogICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgICAgICAgICAgICBpZiAoJGFyZ3NbMF0gaW5zdGFuY2VvZiBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE0gPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX1RZUEVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgJE0gPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5jaGVja01hdHJpeERpbWVuc2lvbnMoJE0pOwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdGhpcy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJHRoaXMtPm47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAkdmFsaWRWYWx1ZXMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9ICRNLT5nZXQoJGksICRqKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKGlzX3N0cmluZygkdGhpcy0+QVskaV1bJGpdKSkgJiYgKHN0cmxlbigkdGhpcy0+QVskaV1bJGpdKSA+IDApICYmICghaXNfbnVtZXJpYygkdGhpcy0+QVskaV1bJGpdKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkFbJGldWyRqXSA9IHRyaW0oJHRoaXMtPkFbJGldWyRqXSwgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbGlkVmFsdWVzICY9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OmNvbnZlcnRUb051bWJlcklmRnJhY3Rpb24oJHRoaXMtPkFbJGldWyRqXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgoaXNfc3RyaW5nKCR2YWx1ZSkpICYmIChzdHJsZW4oJHZhbHVlKSA+IDApICYmICghaXNfbnVtZXJpYygkdmFsdWUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSB0cmltKCR2YWx1ZSwgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbGlkVmFsdWVzICY9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OmNvbnZlcnRUb051bWJlcklmRnJhY3Rpb24oJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWxpZFZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QVskaV1bJGpdICo9ICR2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QVskaV1bJGpdID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBhcnJheVJpZ2h0RGl2aWRlCiAgICAgKgogICAgICogICAgRWxlbWVudC1ieS1lbGVtZW50IHJpZ2h0IGRpdmlzaW9uCiAgICAgKiAgICBBIC8gQgogICAgICogICAgQHBhcmFtIE1hdHJpeCAkQiBNYXRyaXggQgogICAgICogICAgQHJldHVybiBNYXRyaXggRGl2aXNpb24gcmVzdWx0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhcnJheVJpZ2h0RGl2aWRlKCkKICAgIHsKICAgICAgICBpZiAoZnVuY19udW1fYXJncygpID4gMCkgewogICAgICAgICAgICAkYXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAgICAgJG1hdGNoID0gaW1wbG9kZSgiLCIsIGFycmF5X21hcCgnZ2V0dHlwZScsICRhcmdzKSk7CgogICAgICAgICAgICBzd2l0Y2ggKCRtYXRjaCkgewogICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgICAgICAgICAgICBpZiAoJGFyZ3NbMF0gaW5zdGFuY2VvZiBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE0gPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX1RZUEVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgJE0gPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5jaGVja01hdHJpeERpbWVuc2lvbnMoJE0pOwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdGhpcy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJHRoaXMtPm47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAkdmFsaWRWYWx1ZXMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICR2YWx1ZSA9ICRNLT5nZXQoJGksICRqKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKGlzX3N0cmluZygkdGhpcy0+QVskaV1bJGpdKSkgJiYgKHN0cmxlbigkdGhpcy0+QVskaV1bJGpdKSA+IDApICYmICghaXNfbnVtZXJpYygkdGhpcy0+QVskaV1bJGpdKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkFbJGldWyRqXSA9IHRyaW0oJHRoaXMtPkFbJGldWyRqXSwgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbGlkVmFsdWVzICY9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OmNvbnZlcnRUb051bWJlcklmRnJhY3Rpb24oJHRoaXMtPkFbJGldWyRqXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgoaXNfc3RyaW5nKCR2YWx1ZSkpICYmIChzdHJsZW4oJHZhbHVlKSA+IDApICYmICghaXNfbnVtZXJpYygkdmFsdWUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSB0cmltKCR2YWx1ZSwgJyInKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbGlkVmFsdWVzICY9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OmNvbnZlcnRUb051bWJlcklmRnJhY3Rpb24oJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWxpZFZhbHVlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIFRyYXAgZm9yIERpdmlkZSBieSBaZXJvIGVycm9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTS0+c2V0KCRpLCAkaiwgJyNESVYvMCEnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNLT5zZXQoJGksICRqLCAkdGhpcy0+QVskaV1bJGpdIC8gJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNLT5zZXQoJGksICRqLCBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRNOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogICAgYXJyYXlSaWdodERpdmlkZUVxdWFscwogICAgICoKICAgICAqICAgIEVsZW1lbnQtYnktZWxlbWVudCByaWdodCBkaXZpc2lvbgogICAgICogICAgQWlqID0gQWlqIC8gQmlqCiAgICAgKiAgICBAcGFyYW0gbWl4ZWQgJEIgTWF0cml4L0FycmF5CiAgICAgKiAgICBAcmV0dXJuIE1hdHJpeCBNYXRyaXggQWlqCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhcnJheVJpZ2h0RGl2aWRlRXF1YWxzKCkKICAgIHsKICAgICAgICBpZiAoZnVuY19udW1fYXJncygpID4gMCkgewogICAgICAgICAgICAkYXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAgICAgJG1hdGNoID0gaW1wbG9kZSgiLCIsIGFycmF5X21hcCgnZ2V0dHlwZScsICRhcmdzKSk7CgogICAgICAgICAgICBzd2l0Y2ggKCRtYXRjaCkgewogICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgICAgICAgICAgICBpZiAoJGFyZ3NbMF0gaW5zdGFuY2VvZiBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE0gPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX1RZUEVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgJE0gPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5jaGVja01hdHJpeERpbWVuc2lvbnMoJE0pOwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdGhpcy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJHRoaXMtPm47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QVskaV1bJGpdID0gJHRoaXMtPkFbJGldWyRqXSAvICRNLT5nZXQoJGksICRqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJE07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiAgICBhcnJheUxlZnREaXZpZGUKICAgICAqCiAgICAgKiAgICBFbGVtZW50LWJ5LWVsZW1lbnQgTGVmdCBkaXZpc2lvbgogICAgICogICAgQSAvIEIKICAgICAqICAgIEBwYXJhbSBNYXRyaXggJEIgTWF0cml4IEIKICAgICAqICAgIEByZXR1cm4gTWF0cml4IERpdmlzaW9uIHJlc3VsdAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXJyYXlMZWZ0RGl2aWRlKCkKICAgIHsKICAgICAgICBpZiAoZnVuY19udW1fYXJncygpID4gMCkgewogICAgICAgICAgICAkYXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAgICAgJG1hdGNoID0gaW1wbG9kZSgiLCIsIGFycmF5X21hcCgnZ2V0dHlwZScsICRhcmdzKSk7CgogICAgICAgICAgICBzd2l0Y2ggKCRtYXRjaCkgewogICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgICAgICAgICAgICBpZiAoJGFyZ3NbMF0gaW5zdGFuY2VvZiBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE0gPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX1RZUEVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgJE0gPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5jaGVja01hdHJpeERpbWVuc2lvbnMoJE0pOwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdGhpcy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJHRoaXMtPm47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAkTS0+c2V0KCRpLCAkaiwgJE0tPmdldCgkaSwgJGopIC8gJHRoaXMtPkFbJGldWyRqXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRNOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogICAgYXJyYXlMZWZ0RGl2aWRlRXF1YWxzCiAgICAgKgogICAgICogICAgRWxlbWVudC1ieS1lbGVtZW50IExlZnQgZGl2aXNpb24KICAgICAqICAgIEFpaiA9IEFpaiAvIEJpagogICAgICogICAgQHBhcmFtIG1peGVkICRCIE1hdHJpeC9BcnJheQogICAgICogICAgQHJldHVybiBNYXRyaXggTWF0cml4IEFpagogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXJyYXlMZWZ0RGl2aWRlRXF1YWxzKCkKICAgIHsKICAgICAgICBpZiAoZnVuY19udW1fYXJncygpID4gMCkgewogICAgICAgICAgICAkYXJncyA9IGZ1bmNfZ2V0X2FyZ3MoKTsKICAgICAgICAgICAgJG1hdGNoID0gaW1wbG9kZSgiLCIsIGFycmF5X21hcCgnZ2V0dHlwZScsICRhcmdzKSk7CgogICAgICAgICAgICBzd2l0Y2ggKCRtYXRjaCkgewogICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgICAgICAgICAgICBpZiAoJGFyZ3NbMF0gaW5zdGFuY2VvZiBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE0gPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OkFSR1VNRU5UX1RZUEVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgJE0gPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5jaGVja01hdHJpeERpbWVuc2lvbnMoJE0pOwogICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdGhpcy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJHRoaXMtPm47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+QVskaV1bJGpdID0gJE0tPmdldCgkaSwgJGopIC8gJHRoaXMtPkFbJGldWyRqXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJE07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiAgICB0aW1lcwogICAgICoKICAgICAqICAgIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogICAgQHBhcmFtIG1peGVkICRuIE1hdHJpeC9BcnJheS9TY2FsYXIKICAgICAqICAgIEByZXR1cm4gTWF0cml4IFByb2R1Y3QKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHRpbWVzKCkKICAgIHsKICAgICAgICBpZiAoZnVuY19udW1fYXJncygpID4gMCkgewogICAgICAgICAgICAkYXJncyAgPSBmdW5jX2dldF9hcmdzKCk7CiAgICAgICAgICAgICRtYXRjaCA9IGltcGxvZGUoIiwiLCBhcnJheV9tYXAoJ2dldHR5cGUnLCAkYXJncykpOwoKICAgICAgICAgICAgc3dpdGNoICgkbWF0Y2gpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCRhcmdzWzBdIGluc3RhbmNlb2YgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRCID0gJGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9UWVBFX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+biA9PSAkQi0+bSkgewogICAgICAgICAgICAgICAgICAgICAgICAkQyA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJHRoaXMtPm0sICRCLT5uKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJEItPm47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGsgPSAwOyAkayA8ICR0aGlzLT5uOyArKyRrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEJjb2xqWyRrXSA9ICRCLT5BWyRrXVskal07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkdGhpcy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBcm93aSA9ICR0aGlzLT5BWyRpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkayA9IDA7ICRrIDwgJHRoaXMtPm47ICsrJGspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHMgKz0gJEFyb3dpWyRrXSAqICRCY29salska107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDLT5BWyRpXVskal0gPSAkczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJEM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihKQU1BRXJyb3IoTWF0cml4RGltZW5zaW9uTWlzbWF0Y2gpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhcnJheSc6CiAgICAgICAgICAgICAgICAgICAgJEIgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCRhcmdzWzBdKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPm4gPT0gJEItPm0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEMgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCR0aGlzLT5tLCAkQi0+bik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRDLT5tOyArKyRpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkQy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzID0gIjAiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGsgPSAwOyAkayA8ICRDLT5uOyArKyRrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzICs9ICR0aGlzLT5BWyRpXVska10gKiAkQi0+QVska11bJGpdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQy0+QVskaV1bJGpdID0gJHM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRDOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oSkFNQUVycm9yKE1hdHJpeERpbWVuc2lvbk1pc21hdGNoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2ludGVnZXInOgogICAgICAgICAgICAgICAgICAgICRDID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkdGhpcy0+QSk7CiAgICAgICAgICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJEMtPm07ICsrJGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgkaiA9IDA7ICRqIDwgJEMtPm47ICsrJGopIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDLT5BWyRpXVskal0gKj0gJGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRDOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZG91YmxlJzoKICAgICAgICAgICAgICAgICAgICAkQyA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJHRoaXMtPm0sICR0aGlzLT5uKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkQy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkQy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEMtPkFbJGldWyRqXSA9ICRhcmdzWzBdICogJHRoaXMtPkFbJGldWyRqXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJEM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdmbG9hdCc6CiAgICAgICAgICAgICAgICAgICAgJEMgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KCR0aGlzLT5BKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkQy0+bTsgKyskaSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkQy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEMtPkFbJGldWyRqXSAqPSAkYXJnc1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJEM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBwb3dlcgogICAgICoKICAgICAqICAgIEEgPSBBIF4gQgogICAgICogICAgQHBhcmFtIG1peGVkICRCIE1hdHJpeC9BcnJheQogICAgICogICAgQHJldHVybiBNYXRyaXggU3VtCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwb3dlcigpCiAgICB7CiAgICAgICAgaWYgKGZ1bmNfbnVtX2FyZ3MoKSA+IDApIHsKICAgICAgICAgICAgJGFyZ3MgPSBmdW5jX2dldF9hcmdzKCk7CiAgICAgICAgICAgICRtYXRjaCA9IGltcGxvZGUoIiwiLCBhcnJheV9tYXAoJ2dldHR5cGUnLCAkYXJncykpOwoKICAgICAgICAgICAgc3dpdGNoICgkbWF0Y2gpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgICAgICAgICAgICAgaWYgKCRhcmdzWzBdIGluc3RhbmNlb2YgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTWF0cml4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNID0gJGFyZ3NbMF07CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpBUkdVTUVOVF9UWVBFX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnYXJyYXknOgogICAgICAgICAgICAgICAgICAgICRNID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCgkYXJnc1swXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+Y2hlY2tNYXRyaXhEaW1lbnNpb25zKCRNKTsKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJHRoaXMtPm07ICsrJGkpIHsKICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiA8ICR0aGlzLT5uOyArKyRqKSB7CiAgICAgICAgICAgICAgICAgICAgJHZhbGlkVmFsdWVzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSAkTS0+Z2V0KCRpLCAkaik7CiAgICAgICAgICAgICAgICAgICAgaWYgKChpc19zdHJpbmcoJHRoaXMtPkFbJGldWyRqXSkpICYmIChzdHJsZW4oJHRoaXMtPkFbJGldWyRqXSkgPiAwKSAmJiAoIWlzX251bWVyaWMoJHRoaXMtPkFbJGldWyRqXSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5BWyRpXVskal0gPSB0cmltKCR0aGlzLT5BWyRpXVskal0sICciJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWxpZFZhbHVlcyAmPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpjb252ZXJ0VG9OdW1iZXJJZkZyYWN0aW9uKCR0aGlzLT5BWyRpXVskal0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKGlzX3N0cmluZygkdmFsdWUpKSAmJiAoc3RybGVuKCR2YWx1ZSkgPiAwKSAmJiAoIWlzX251bWVyaWMoJHZhbHVlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gdHJpbSgkdmFsdWUsICciJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICR2YWxpZFZhbHVlcyAmPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpjb252ZXJ0VG9OdW1iZXJJZkZyYWN0aW9uKCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkdmFsaWRWYWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkFbJGldWyRqXSA9IHBvdygkdGhpcy0+QVskaV1bJGpdLCAkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5BWyRpXVskal0gPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHRoaXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0V4Y2VwdGlvbihzZWxmOjpQT0xZTU9SUEhJQ19BUkdVTUVOVF9FWENFUFRJT04pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqICAgIGNvbmNhdAogICAgICoKICAgICAqICAgIEEgPSBBICYgQgogICAgICogICAgQHBhcmFtIG1peGVkICRCIE1hdHJpeC9BcnJheQogICAgICogICAgQHJldHVybiBNYXRyaXggU3VtCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjb25jYXQoKQogICAgewogICAgICAgIGlmIChmdW5jX251bV9hcmdzKCkgPiAwKSB7CiAgICAgICAgICAgICRhcmdzID0gZnVuY19nZXRfYXJncygpOwogICAgICAgICAgICAkbWF0Y2ggPSBpbXBsb2RlKCIsIiwgYXJyYXlfbWFwKCdnZXR0eXBlJywgJGFyZ3MpKTsKCiAgICAgICAgICAgIHN3aXRjaCAoJG1hdGNoKSB7CiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICAgICAgICAgIGlmICgkYXJnc1swXSBpbnN0YW5jZW9mIFBIUEV4Y2VsX1NoYXJlZF9KQU1BX01hdHJpeCkgewogICAgICAgICAgICAgICAgICAgICAgICAkTSA9ICRhcmdzWzBdOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6QVJHVU1FTlRfVFlQRV9FWENFUFRJT04pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgJ2FycmF5JzoKICAgICAgICAgICAgICAgICAgICAkTSA9IG5ldyBQSFBFeGNlbF9TaGFyZWRfSkFNQV9NYXRyaXgoJGFyZ3NbMF0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRXhjZXB0aW9uKHNlbGY6OlBPTFlNT1JQSElDX0FSR1VNRU5UX0VYQ0VQVElPTik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPmNoZWNrTWF0cml4RGltZW5zaW9ucygkTSk7CiAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICR0aGlzLT5tOyArKyRpKSB7CiAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogPCAkdGhpcy0+bjsgKyskaikgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5BWyRpXVskal0gPSB0cmltKCR0aGlzLT5BWyRpXVskal0sICciJykudHJpbSgkTS0+Z2V0KCRpLCAkaiksICciJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICR0aGlzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9DYWxjdWxhdGlvbl9FeGNlcHRpb24oc2VsZjo6UE9MWU1PUlBISUNfQVJHVU1FTlRfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBTb2x2ZSBBKlggPSBCLgogICAgICoKICAgICAqICAgIEBwYXJhbSBNYXRyaXggJEIgUmlnaHQgaGFuZCBzaWRlCiAgICAgKiAgICBAcmV0dXJuIE1hdHJpeCAuLi4gU29sdXRpb24gaWYgQSBpcyBzcXVhcmUsIGxlYXN0IHNxdWFyZXMgc29sdXRpb24gb3RoZXJ3aXNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzb2x2ZSgkQikKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPm0gPT0gJHRoaXMtPm4pIHsKICAgICAgICAgICAgJExVID0gbmV3IFBIUEV4Y2VsX1NoYXJlZF9KQU1BX0xVRGVjb21wb3NpdGlvbigkdGhpcyk7CiAgICAgICAgICAgIHJldHVybiAkTFUtPnNvbHZlKCRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkUVIgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfUVJEZWNvbXBvc2l0aW9uKCR0aGlzKTsKICAgICAgICAgICAgcmV0dXJuICRRUi0+c29sdmUoJEIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqICAgIE1hdHJpeCBpbnZlcnNlIG9yIHBzZXVkb2ludmVyc2UuCiAgICAgKgogICAgICogICAgQHJldHVybiBNYXRyaXggLi4uIEludmVyc2UoQSkgaWYgQSBpcyBzcXVhcmUsIHBzZXVkb2ludmVyc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW52ZXJzZSgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zb2x2ZSgkdGhpcy0+aWRlbnRpdHkoJHRoaXMtPm0sICR0aGlzLT5tKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBkZXQKICAgICAqCiAgICAgKiAgICBDYWxjdWxhdGUgZGV0ZXJtaW5hbnQKICAgICAqICAgIEByZXR1cm4gZmxvYXQgRGV0ZXJtaW5hbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRldCgpCiAgICB7CiAgICAgICAgJEwgPSBuZXcgUEhQRXhjZWxfU2hhcmVkX0pBTUFfTFVEZWNvbXBvc2l0aW9uKCR0aGlzKTsKICAgICAgICByZXR1cm4gJEwtPmRldCgpOwogICAgfQp9Cg==",
    "size": "41266"
}