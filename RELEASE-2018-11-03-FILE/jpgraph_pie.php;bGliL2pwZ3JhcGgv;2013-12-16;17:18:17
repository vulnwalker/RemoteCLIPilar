{
    "namaFile": "lib\/jpgraph\/jpgraph_pie.php",
    "lastUpdate": "2013-12-16+17:18:17.00",
    "contentFile": "PD9waHAKLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogLy8gRmlsZTogICAgICAgIEpQR1JBUEhfUElFLlBIUAogLy8gRGVzY3JpcHRpb246IFBpZSBwbG90IGV4dGVuc2lvbiBmb3IgSnBHcmFwaAogLy8gQ3JlYXRlZDogICAgIDIwMDEtMDItMTQKIC8vIFZlcjogICAgICAgICAkSWQ6IGpwZ3JhcGhfcGllLnBocCAxOTI2IDIwMTAtMDEtMTEgMTY6MzM6MDdaIGxqcCAkCiAvLwogLy8gQ29weXJpZ2h0IChjKSBBc2lhbCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAqLwoKCi8vIERlZmluZXMgZm9yIFBpZVBsb3Q6OlNldExhYmVsVHlwZSgpCmRlZmluZSgiUElFX1ZBTFVFX0FCUyIsMSk7CmRlZmluZSgiUElFX1ZBTFVFX1BFUiIsMCk7CmRlZmluZSgiUElFX1ZBTFVFX1BFUkNFTlRBR0UiLDApOwpkZWZpbmUoIlBJRV9WQUxVRV9BREpQRVJDRU5UQUdFIiwyKTsKZGVmaW5lKCJQSUVfVkFMVUVfQURKUEVSIiwyKTsKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIFBpZVBsb3QKLy8gRGVzY3JpcHRpb246IERyYXdzIGEgcGllIHBsb3QKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgUGllUGxvdCB7CiAgICBwdWJsaWMgJHBvc3g9MC41LCRwb3N5PTAuNTsKICAgIHB1YmxpYyAkaXNfdXNpbmdfcGxvdF90aGVtZSA9IGZhbHNlOwogICAgcHVibGljICR0aGVtZT0iZWFydGgiOwogICAgcHJvdGVjdGVkICR1c2VfcGxvdF90aGVtZV9jb2xvcnMgPSBmYWxzZTsKICAgIHByb3RlY3RlZCAkcmFkaXVzPTAuMzsKICAgIHByb3RlY3RlZCAkZXhwbG9kZV9yYWRpdXM9YXJyYXkoKSwkZXhwbG9kZV9hbGw9ZmFsc2UsJGV4cGxvZGVfcj0yMDsKICAgIHByb3RlY3RlZCAkbGFiZWxzPW51bGwsICRsZWdlbmRzPW51bGw7CiAgICBwcm90ZWN0ZWQgJGNzaW10YXJnZXRzPW51bGwsJGNzaW13aW50YXJnZXRzPW51bGw7ICAvLyBBcnJheSBvZiB0YXJnZXRzIGZvciBDU0lNCiAgICBwcm90ZWN0ZWQgJGNzaW1hcmVhcz0nJzsgIC8vIEdlbmVyYXRlZCBDU0lNIHRleHQKICAgIHByb3RlY3RlZCAkY3NpbWFsdHM9bnVsbDsgIC8vIEFMVCB0YWdzIGZvciBjb3JyZXNwb25kaW5nIHRhcmdldAogICAgcHJvdGVjdGVkICRkYXRhPW51bGw7CiAgICBwdWJsaWMgJHRpdGxlOwogICAgcHJvdGVjdGVkICRzdGFydGFuZ2xlPTA7CiAgICBwcm90ZWN0ZWQgJHdlaWdodD0xLCAkY29sb3I9ImJsYWNrIjsKICAgIHByb3RlY3RlZCAkbGVnZW5kX21hcmdpbj02LCRzaG93X2xhYmVscz10cnVlOwogICAgcHJvdGVjdGVkICR0aGVtZWFyciA9IGFycmF5KAogImVhcnRoIiAgPT4gYXJyYXkoMTM2LDM0LDQwLDQ1LDQ2LDYyLDYzLDEzNCw3NCwxMCwxMjAsMTM2LDE0MSwxNjgsMTgwLDc3LDIwOSwyMTgsMzQ2LDM5NSw4OSw0MzApLAogInBhc3RlbCIgPT4gYXJyYXkoMjcsNDE1LDEyOCw1OSw2Niw3OSwxMDUsMTEwLDQyLDE0NywxNTIsMjMwLDIzNiwyNDAsMzMxLDMzNyw0MDUsMzgpLAogIndhdGVyIiAgPT4gYXJyYXkoOCwzNzAsMjQsNDAsMzM1LDU2LDIxMywyMzcsMjY4LDE0LDMyNiwzODcsMTAsMzg4KSwKICJzYW5kIiAgID0+IGFycmF5KDI3LDE2OCwzNCwxNzAsMTksNTAsNjUsNzIsMTMxLDIwOSw0NiwzOTMpKTsKICAgIHByb3RlY3RlZCAkc2V0c2xpY2Vjb2xvcnM9YXJyYXkoKTsKICAgIHByb3RlY3RlZCAkbGFiZWx0eXBlPTA7IC8vIERlZmF1bHQgdG8gcGVyY2VudGFnZQogICAgcHJvdGVjdGVkICRwaWVfYm9yZGVyPXRydWUsJHBpZV9pbnRlcmlvcl9ib3JkZXI9dHJ1ZTsKICAgIHB1YmxpYyAkdmFsdWU7CiAgICBwcm90ZWN0ZWQgJGlzaGFkb3djb2xvcj0nJywkaXNoYWRvd2Ryb3A9NDsKICAgIHByb3RlY3RlZCAkaWxhYmVscG9zYWRqPTE7CiAgICBwcm90ZWN0ZWQgJGxlZ2VuZGNzaW10YXJnZXRzID0gYXJyYXkoKSwkbGVnZW5kY3NpbXdpbnRhcmdldHMgPSBhcnJheSgpOwogICAgcHJvdGVjdGVkICRsZWdlbmRjc2ltYWx0cyA9IGFycmF5KCk7CiAgICBwcm90ZWN0ZWQgJGFkanVzdGVkX2RhdGEgPSBhcnJheSgpOwogICAgcHVibGljICRndWlkZWxpbmUgPSBudWxsOwogICAgcHJvdGVjdGVkICRndWlkZWxpbmVtYXJnaW49MTAsJGlTaG93R3VpZGVMaW5lRm9yU2luZ2xlID0gZmFsc2U7CiAgICBwcm90ZWN0ZWQgJGlHdWlkZUxpbmVDdXJ2ZSA9IGZhbHNlLCRpR3VpZGVWRmFjdG9yPTEuNCwkaUd1aWRlTGluZVJGYWN0b3I9MC44OwogICAgcHJvdGVjdGVkICRsYSA9IGFycmF5KCk7IC8vIEhvbGRzIHRoZSBleGFjdCBhbmdsZSBmb3IgZWFjaCBsYWJlbAoKICAgIC8vLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBDT05TVFJVQ1RPUgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGRhdGEpIHsKICAgICAgICAkdGhpcy0+ZGF0YSA9IGFycmF5X3JldmVyc2UoJGRhdGEpOwogICAgICAgICR0aGlzLT50aXRsZSA9IG5ldyBUZXh0KCIiKTsKICAgICAgICAkdGhpcy0+dGl0bGUtPlNldEZvbnQoRkZfREVGQVVMVCxGU19CT0xEKTsKICAgICAgICAkdGhpcy0+dmFsdWUgPSBuZXcgRGlzcGxheVZhbHVlKCk7CiAgICAgICAgJHRoaXMtPnZhbHVlLT5TaG93KCk7CiAgICAgICAgJHRoaXMtPnZhbHVlLT5TZXRGb3JtYXQoJyUuMWYlJScpOwogICAgICAgICR0aGlzLT5ndWlkZWxpbmUgPSBuZXcgTGluZVByb3BlcnR5KCk7CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICBmdW5jdGlvbiBTZXRDZW50ZXIoJHgsJHk9MC41KSB7CiAgICAgICAgJHRoaXMtPnBvc3ggPSAkeDsKICAgICAgICAkdGhpcy0+cG9zeSA9ICR5OwogICAgfQoKICAgIC8vIEVuYWJsZSBndWlkZWxpbmUgYW5kIHNldCBkcndhaW5nIHBvbGljeQogICAgZnVuY3Rpb24gU2V0R3VpZGVMaW5lcygkYUZsZz10cnVlLCRhQ3VydmVkPXRydWUsJGFBbHdheXM9ZmFsc2UpIHsKICAgICAgICAkdGhpcy0+Z3VpZGVsaW5lLT5TaG93KCRhRmxnKTsKICAgICAgICAkdGhpcy0+aVNob3dHdWlkZUxpbmVGb3JTaW5nbGUgPSAkYUFsd2F5czsKICAgICAgICAkdGhpcy0+aUd1aWRlTGluZUN1cnZlID0gJGFDdXJ2ZWQ7CiAgICB9CgogICAgLy8gQWRqdXN0ZSB0aGUgZGlzdGFuY2UgYmV0d2VlbiBsYWJlbHMgYW5kIGxhYmVscyBhbmQgcGllCiAgICBmdW5jdGlvbiBTZXRHdWlkZUxpbmVzQWRqdXN0KCRhVkZhY3RvciwkYVJGYWN0b3I9MC44KSB7CiAgICAgICAgJHRoaXMtPmlHdWlkZVZGYWN0b3I9JGFWRmFjdG9yOwogICAgICAgICR0aGlzLT5pR3VpZGVMaW5lUkZhY3Rvcj0kYVJGYWN0b3I7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Q29sb3IoJGFDb2xvcikgewogICAgICAgICR0aGlzLT5jb2xvciA9ICRhQ29sb3I7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0U2xpY2VDb2xvcnMoJGFDb2xvcnMpIHsKICAgICAgICAkdGhpcy0+c2V0c2xpY2Vjb2xvcnMgPSAkYUNvbG9yczsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRTaGFkb3coJGFDb2xvcj0nZGFya2dyYXknLCRhRHJvcFdpZHRoPTQpIHsKICAgICAgICAkdGhpcy0+aXNoYWRvd2NvbG9yID0gJGFDb2xvcjsKICAgICAgICAkdGhpcy0+aXNoYWRvd2Ryb3AgPSAkYURyb3BXaWR0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDU0lNVGFyZ2V0cygkYVRhcmdldHMsJGFBbHRzPScnLCRhV2luVGFyZ2V0cz0nJykgewogICAgICAgICR0aGlzLT5jc2ltdGFyZ2V0cz1hcnJheV9yZXZlcnNlKCRhVGFyZ2V0cyk7CiAgICAgICAgaWYoIGlzX2FycmF5KCRhV2luVGFyZ2V0cykgKQogICAgICAgICR0aGlzLT5jc2ltd2ludGFyZ2V0cz1hcnJheV9yZXZlcnNlKCRhV2luVGFyZ2V0cyk7CiAgICAgICAgaWYoIGlzX2FycmF5KCRhQWx0cykgKQogICAgICAgICR0aGlzLT5jc2ltYWx0cz1hcnJheV9yZXZlcnNlKCRhQWx0cyk7CiAgICB9CgogICAgZnVuY3Rpb24gR2V0Q1NJTWFyZWFzKCkgewogICAgICAgIHJldHVybiAkdGhpcy0+Y3NpbWFyZWFzOwogICAgfQoKICAgIGZ1bmN0aW9uIEFkZFNsaWNlVG9DU0lNKCRpLCR4YywkeWMsJHJhZGl1cywkc2EsJGVhKSB7CiAgICAgICAgLy9TbGljZSBudW1iZXIsIGVsbGlwc2UgY2VudHJlICh4LHkpLCBoZWlnaHQsIHdpZHRoLCBzdGFydCBhbmdsZSwgZW5kIGFuZ2xlCiAgICAgICAgd2hpbGUoICRzYSA+IDIqTV9QSSApICRzYSA9ICRzYSAtIDIqTV9QSTsKICAgICAgICB3aGlsZSggJGVhID4gMipNX1BJICkgJGVhID0gJGVhIC0gMipNX1BJOwoKICAgICAgICAkc2EgPSAyKk1fUEkgLSAkc2E7CiAgICAgICAgJGVhID0gMipNX1BJIC0gJGVhOwoKICAgICAgICAvLyBTcGVjaWFsIGNhc2Ugd2hlbiB3ZSBoYXZlIG9ubHkgb25lIHNsaWNlIHNpbmNlIHRoZW4gYm90aCBzdGFydCBhbmQgZW5kCiAgICAgICAgLy8gYW5nbGUgd2lsbCBiZSA9PSAwCiAgICAgICAgaWYoIGFicygkc2EgLSAkZWEpIDwgMC4wMDAxICkgewogICAgICAgICAgICAkc2E9MipNX1BJOyAkZWE9MDsKICAgICAgICB9CgogICAgICAgIC8vYWRkIGNvb3JkaW5hdGVzIG9mIHRoZSBjZW50cmUgdG8gdGhlIG1hcAogICAgICAgICR4YyA9IGZsb29yKCR4Yyk7JHljPWZsb29yKCR5Yyk7CiAgICAgICAgJGNvb3JkcyA9ICIkeGMsICR5YyI7CgogICAgICAgIC8vYWRkIGNvb3JkaW5hdGVzIG9mIHRoZSBmaXJzdCBwb2ludCBvbiB0aGUgYXJjIHRvIHRoZSBtYXAKICAgICAgICAkeHAgPSBmbG9vcigoJHJhZGl1cypjb3MoJGVhKSkrJHhjKTsKICAgICAgICAkeXAgPSBmbG9vcigkeWMtJHJhZGl1cypzaW4oJGVhKSk7CiAgICAgICAgJGNvb3Jkcy49ICIsICR4cCwgJHlwIjsKCiAgICAgICAgLy9hZGQgY29vcmRpbmF0ZXMgZXZlcnkgMC4yIHJhZGlhbnMKICAgICAgICAkYT0kZWErMC4yOwoKICAgICAgICAvLyBJZiB3ZSBjcm9zcyB0aGUgMzYwLWxpbWl0IHdpdGggYSBzbGljZSB3ZSBuZWVkIHRvIGhhbmRsZQogICAgICAgIC8vIHRoZSBmYWN0IHRoYXQgZW5kIGFuZ2xlIGlzIHNtYWxsZXIgdGhhbiBzdGFydAogICAgICAgIGlmKCAkc2EgPCAkZWEgKSB7CiAgICAgICAgICAgIHdoaWxlICgkYSA8PSAyKk1fUEkpIHsKICAgICAgICAgICAgICAgICR4cCA9IGZsb29yKCRyYWRpdXMqY29zKCRhKSskeGMpOwogICAgICAgICAgICAgICAgJHlwID0gZmxvb3IoJHljLSRyYWRpdXMqc2luKCRhKSk7CiAgICAgICAgICAgICAgICAkY29vcmRzLj0gIiwgJHhwLCAkeXAiOwogICAgICAgICAgICAgICAgJGEgKz0gMC4yOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRhIC09IDIqTV9QSTsKICAgICAgICB9CgoKICAgICAgICB3aGlsZSAoJGEgPCAkc2EpIHsKICAgICAgICAgICAgJHhwID0gZmxvb3IoJHJhZGl1cypjb3MoJGEpKyR4Yyk7CiAgICAgICAgICAgICR5cCA9IGZsb29yKCR5Yy0kcmFkaXVzKnNpbigkYSkpOwogICAgICAgICAgICAkY29vcmRzLj0gIiwgJHhwLCAkeXAiOwogICAgICAgICAgICAkYSArPSAwLjI7CiAgICAgICAgfQoKICAgICAgICAvL0FkZCB0aGUgbGFzdCBwb2ludCBvbiB0aGUgYXJjCiAgICAgICAgJHhwID0gZmxvb3IoJHJhZGl1cypjb3MoJHNhKSskeGMpOwogICAgICAgICR5cCA9IGZsb29yKCR5Yy0kcmFkaXVzKnNpbigkc2EpKTsKICAgICAgICAkY29vcmRzLj0gIiwgJHhwLCAkeXAiOwogICAgICAgIGlmKCAhZW1wdHkoJHRoaXMtPmNzaW10YXJnZXRzWyRpXSkgKSB7CiAgICAgICAgICAgICR0aGlzLT5jc2ltYXJlYXMgLj0gIjxhcmVhIHNoYXBlPVwicG9seVwiIGNvb3Jkcz1cIiRjb29yZHNcIiBocmVmPVwiIi4kdGhpcy0+Y3NpbXRhcmdldHNbJGldLiJcIiI7CiAgICAgICAgICAgICR0bXA9IiI7CiAgICAgICAgICAgIGlmKCAhZW1wdHkoJHRoaXMtPmNzaW13aW50YXJnZXRzWyRpXSkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICIgdGFyZ2V0PVwiIi4kdGhpcy0+Y3NpbXdpbnRhcmdldHNbJGldLiJcIiAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAhZW1wdHkoJHRoaXMtPmNzaW1hbHRzWyRpXSkgKSB7CiAgICAgICAgICAgICAgICAkdG1wPXNwcmludGYoJHRoaXMtPmNzaW1hbHRzWyRpXSwkdGhpcy0+ZGF0YVskaV0pOwogICAgICAgICAgICAgICAgJHRoaXMtPmNzaW1hcmVhcyAuPSAiIHRpdGxlPVwiJHRtcFwiIGFsdD1cIiR0bXBcIiAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5jc2ltYXJlYXMgLj0gIiAvPlxuIjsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIFNldFRoZW1lKCRhVGhlbWUpIHsKLy8gICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDE1MDEyLCRhVGhlbWUpOwovLyAgICAgICAgcmV0dXJuOwoKICAgICAgICBpZiggaW5fYXJyYXkoJGFUaGVtZSxhcnJheV9rZXlzKCR0aGlzLT50aGVtZWFycikpICkgewogICAgICAgICAgICAkdGhpcy0+dGhlbWUgPSAkYVRoZW1lOwogICAgICAgICAgICAkdGhpcy0+aXNfdXNpbmdfcGxvdF90aGVtZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMTUwMDEsJGFUaGVtZSk7Ly8oIlBpZVBMb3Q6OlNldFRoZW1lKCkgVW5rbm93biB0aGVtZTogJGFUaGVtZSIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBFeHBsb2RlU2xpY2UoJGUsJHJhZGl1cz0yMCkgewogICAgICAgIGlmKCAhIGlzX2ludGVnZXIoJGUpICkKICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgxNTAwMik7Ly8oJ0FyZ3VtZW50IHRvIFBpZVBsb3Q6OkV4cGxvZGVTbGljZSgpIG11c3QgYmUgYW4gaW50ZWdlcicpOwogICAgICAgICR0aGlzLT5leHBsb2RlX3JhZGl1c1skZV09JHJhZGl1czsKICAgIH0KCiAgICBmdW5jdGlvbiBFeHBsb2RlQWxsKCRyYWRpdXM9MjApIHsKICAgICAgICAkdGhpcy0+ZXhwbG9kZV9hbGw9dHJ1ZTsKICAgICAgICAkdGhpcy0+ZXhwbG9kZV9yID0gJHJhZGl1czsKICAgIH0KCiAgICBmdW5jdGlvbiBFeHBsb2RlKCRhRXhwbG9kZUFycikgewogICAgICAgIGlmKCAhaXNfYXJyYXkoJGFFeHBsb2RlQXJyKSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMTUwMDMpOwogICAgICAgICAgICAvLygiQXJndW1lbnQgdG8gUGllUGxvdDo6RXhwbG9kZSgpIG11c3QgYmUgYW4gYXJyYXkgd2l0aCBpbnRlZ2VyIGRpc3RhbmNlcy4iKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmV4cGxvZGVfcmFkaXVzID0gJGFFeHBsb2RlQXJyOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFN0YXJ0QW5nbGUoJGFTdGFydCkgewogICAgICAgIGlmKCAkYVN0YXJ0IDwgMCB8fCAkYVN0YXJ0ID4gMzYwICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgxNTAwNCk7Ly8oJ1NsaWNlIHN0YXJ0IGFuZ2xlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAzNjAgZGVncmVlcy4nKTsKICAgICAgICB9CiAgICAgICAgaWYoICRhU3RhcnQgPT0gMCApIHsKICAgICAgICAgICAgJHRoaXMtPnN0YXJ0YW5nbGUgPSAwOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnN0YXJ0YW5nbGUgPSAzNjAtJGFTdGFydDsKICAgICAgICAgICAgJHRoaXMtPnN0YXJ0YW5nbGUgKj0gTV9QSS8xODA7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFNpemUgaW4gcGVyY2VudGFnZQogICAgZnVuY3Rpb24gU2V0U2l6ZSgkYVNpemUpIHsKICAgICAgICBpZiggKCRhU2l6ZT4wICYmICRhU2l6ZTw9MC41KSB8fCAoJGFTaXplPjEwICYmICRhU2l6ZTwxMDAwKSApCiAgICAgICAgJHRoaXMtPnJhZGl1cyA9ICRhU2l6ZTsKICAgICAgICBlbHNlCiAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMTUwMDYpOwogICAgICAgIC8vKCJQaWVQbG90OjpTZXRTaXplKCkgUmFkaXVzIGZvciBwaWUgbXVzdCBlaXRoZXIgYmUgc3BlY2lmaWVkIGFzIGEgZnJhY3Rpb24gWzAsIDAuNV0gb2YgdGhlIHNpemUgb2YgdGhlIGltYWdlIG9yIGFzIGFuIGFic29sdXRlIHNpemUgaW4gcGl4ZWxzICBpbiB0aGUgcmFuZ2UgWzEwLCAxMDAwXSIpOwogICAgfQoKICAgIC8vIFNldCBsYWJlbCBhcnJheXMKICAgIGZ1bmN0aW9uIFNldExlZ2VuZHMoJGFMZWdlbmQpIHsKICAgICAgICAkdGhpcy0+bGVnZW5kcyA9ICRhTGVnZW5kOwogICAgfQoKICAgIC8vIFNldCB0ZXh0IGxhYmVscyBmb3Igc2xpY2VzCiAgICBmdW5jdGlvbiBTZXRMYWJlbHMoJGFMYWJlbHMsJGFMYmxQb3NBZGo9ImF1dG8iKSB7CiAgICAgICAgJHRoaXMtPmxhYmVscyA9IGFycmF5X3JldmVyc2UoJGFMYWJlbHMpOwogICAgICAgICR0aGlzLT5pbGFiZWxwb3NhZGo9JGFMYmxQb3NBZGo7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TGFiZWxQb3MoJGFMYmxQb3NBZGopIHsKICAgICAgICAkdGhpcy0+aWxhYmVscG9zYWRqPSRhTGJsUG9zQWRqOwogICAgfQoKICAgIC8vIFNob3VsZCB3ZSBkaXNwbGF5IGFjdHVhbCB2YWx1ZSBvciBwZXJjZW50YWdlPwogICAgZnVuY3Rpb24gU2V0TGFiZWxUeXBlKCRhVHlwZSkgewogICAgICAgIGlmKCAkYVR5cGUgPCAwIHx8ICRhVHlwZSA+IDIgKQogICAgICAgIAlKcEdyYXBoRXJyb3I6OlJhaXNlTCgxNTAwOCwkYVR5cGUpOwoJICAgICAgICAvLygiUGllUGxvdDo6U2V0TGFiZWxUeXBlKCkgVHlwZSBmb3IgcGllIHBsb3RzIG11c3QgYmUgMCBvciAxIChub3QgJHQpLiIpOwogICAgICAgICR0aGlzLT5sYWJlbHR5cGUgPSAkYVR5cGU7CiAgICB9CgogICAgLy8gRGVwcmVjYXRlZC4KICAgIGZ1bmN0aW9uIFNldFZhbHVlVHlwZSgkYVR5cGUpIHsKICAgICAgICAkdGhpcy0+U2V0TGFiZWxUeXBlKCRhVHlwZSk7CiAgICB9CgogICAgLy8gU2hvdWxkIHRoZSBjaXJjbGUgYXJvdW5kIGEgcGllIHBsb3QgYmUgZGlzcGxheWVkCiAgICBmdW5jdGlvbiBTaG93Qm9yZGVyKCRleHRlcmlvcj10cnVlLCRpbnRlcmlvcj10cnVlKSB7CiAgICAgICAgJHRoaXMtPnBpZV9ib3JkZXIgPSAkZXh0ZXJpb3I7CiAgICAgICAgJHRoaXMtPnBpZV9pbnRlcmlvcl9ib3JkZXIgPSAkaW50ZXJpb3I7CiAgICB9CgogICAgLy8gU2V0dXAgdGhlIGxlZ2VuZHMKICAgIGZ1bmN0aW9uIExlZ2VuZCgkZ3JhcGgpIHsKICAgICAgICAkY29sb3JzID0gYXJyYXlfa2V5cygkZ3JhcGgtPmltZy0+cmdiLT5yZ2JfdGFibGUpOwogICAgICAgIHNvcnQoJGNvbG9ycyk7CiAgICAgICAgJHRhPSR0aGlzLT50aGVtZWFyclskdGhpcy0+dGhlbWVdOwogICAgICAgICRuID0gY291bnQoJHRoaXMtPmRhdGEpOwoKICAgICAgICBpZiggJHRoaXMtPnNldHNsaWNlY29sb3JzPT1udWxsICkgewogICAgICAgICAgICAkbnVtY29sb3JzPWNvdW50KCR0YSk7CiAgICAgICAgICAgIGlmKCBjbGFzc19leGlzdHMoJ1BpZVBsb3QzRCcsZmFsc2UpICYmICgkdGhpcyBpbnN0YW5jZW9mIFBpZVBsb3QzRCkgKSB7CiAgICAgICAgICAgICAgICAkdGEgPSBhcnJheV9yZXZlcnNlKGFycmF5X3NsaWNlKCR0YSwwLCRuKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRzbGljZWNvbG9ycyA9IGFycmF5X3NsaWNlKCR0aGlzLT5zZXRzbGljZWNvbG9ycywwLCRuKTsKICAgICAgICAgICAgJG51bWNvbG9ycz1jb3VudCgkdGhpcy0+c2V0c2xpY2Vjb2xvcnMpOwogICAgICAgICAgICBpZiggJGdyYXBoLT5waWVhYSAmJiAhKCR0aGlzIGluc3RhbmNlb2YgUGllUGxvdDNEKSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5zZXRzbGljZWNvbG9ycyA9IGFycmF5X3JldmVyc2UoJHRoaXMtPnNldHNsaWNlY29sb3JzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHN1bT0wOwogICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpKQogICAgICAgICAgICAkc3VtICs9ICR0aGlzLT5kYXRhWyRpXTsKCiAgICAgICAgLy8gQmFpbCBvdXQgd2l0aCBlcnJvciBpZiB0aGUgc3VtIGlzIDAKICAgICAgICBpZiggJHN1bT09MCApCiAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMTUwMDkpOy8vKCJJbGxlZ2FsIHBpZSBwbG90LiBTdW0gb2YgYWxsIGRhdGEgaXMgemVybyBmb3IgUGllISIpOwoKICAgICAgICAvLyBNYWtlIHN1cmUgd2UgZG9uJ3QgcGxvdCBtb3JlIHZhbHVlcyB0aGFuIGRhdGEgcG9pbnRzCiAgICAgICAgLy8gKGluIGNhc2UgdGhlIHVzZXIgYWRkZWQgbW9yZSBsZWdlbmRzIHRoYW4gZGF0YSBwb2ludHMpCiAgICAgICAgJG4gPSBtaW4oY291bnQoJHRoaXMtPmxlZ2VuZHMpLGNvdW50KCR0aGlzLT5kYXRhKSk7CiAgICAgICAgaWYoICR0aGlzLT5sZWdlbmRzICE9ICIiICkgewogICAgICAgICAgICAkdGhpcy0+bGVnZW5kcyA9IGFycmF5X3JldmVyc2UoYXJyYXlfc2xpY2UoJHRoaXMtPmxlZ2VuZHMsMCwkbikpOwogICAgICAgIH0KICAgICAgICBmb3IoICRpPSRuLTE7ICRpID49IDA7IC0tJGkgKSB7CiAgICAgICAgICAgICRsID0gJHRoaXMtPmxlZ2VuZHNbJGldOwogICAgICAgICAgICAvLyBSZXBsYWNlIHBvc3NpYmxlIGZvcm1hdCB3aXRoIGFjdHVhbCB2YWx1ZXMKICAgICAgICAgICAgaWYoIGNvdW50KCR0aGlzLT5jc2ltYWx0cykgPiAkaSApIHsKICAgICAgICAgICAgICAgICRmbXQgPSAkdGhpcy0+Y3NpbWFsdHNbJGldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGZtdCA9ICIlZCI7IC8vIERlYWZ1bHQgQWx0IGlmIG5vIG90aGVyIGhhcyBiZWVuIHNwZWNpZmllZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAkdGhpcy0+bGFiZWx0eXBlPT0wICkgewogICAgICAgICAgICAgICAgJGwgPSBzcHJpbnRmKCRsLDEwMCokdGhpcy0+ZGF0YVskaV0vJHN1bSk7CiAgICAgICAgICAgICAgICAkYWx0ID0gc3ByaW50ZigkZm10LCR0aGlzLT5kYXRhWyRpXSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPmxhYmVsdHlwZSA9PSAxKSAgewogICAgICAgICAgICAgICAgJGwgPSBzcHJpbnRmKCRsLCR0aGlzLT5kYXRhWyRpXSk7CiAgICAgICAgICAgICAgICAkYWx0ID0gc3ByaW50ZigkZm10LCR0aGlzLT5kYXRhWyRpXSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGwgPSBzcHJpbnRmKCRsLCR0aGlzLT5hZGp1c3RlZF9kYXRhWyRpXSk7CiAgICAgICAgICAgICAgICAkYWx0ID0gc3ByaW50ZigkZm10LCR0aGlzLT5hZGp1c3RlZF9kYXRhWyRpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCBlbXB0eSgkdGhpcy0+Y3NpbXdpbnRhcmdldHNbJGldKSApIHsKICAgICAgICAgICAgICAgICR3aW50YXJnID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkd2ludGFyZyA9ICR0aGlzLT5jc2ltd2ludGFyZ2V0c1skaV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCAkdGhpcy0+c2V0c2xpY2Vjb2xvcnM9PW51bGwgKSB7CiAgICAgICAgICAgICAgICAkZ3JhcGgtPmxlZ2VuZC0+QWRkKCRsLCRjb2xvcnNbJHRhWyRpJSRudW1jb2xvcnNdXSwiIiwwLCR0aGlzLT5jc2ltdGFyZ2V0c1skaV0sJGFsdCwkd2ludGFyZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkZ3JhcGgtPmxlZ2VuZC0+QWRkKCRsLCR0aGlzLT5zZXRzbGljZWNvbG9yc1skaSUkbnVtY29sb3JzXSwiIiwwLCR0aGlzLT5jc2ltdGFyZ2V0c1skaV0sJGFsdCwkd2ludGFyZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gQWRqdXN0IHRoZSByb3VuZGVkIHBlcmNldGFnZSB2YWx1ZSBzbyB0aGF0IHRoZSBzdW0gb2YKICAgIC8vIG9mIHRoZSBwaWUgc2xpY2VzIGFyZSBhbHdheXMgMTAwJQogICAgLy8gVXNpbmcgdGhlIEhhcmUvTmllbWV5ZXIgbWV0aG9kCiAgICBmdW5jdGlvbiBBZGpQZXJjZW50YWdlKCRhRGF0YSwkYVByZWM9MCkgewogICAgICAgICRtdWw9MTAwOwogICAgICAgIGlmKCAkYVByZWMgPiAwICYmICRhUHJlYyA8IDMgKSB7CiAgICAgICAgICAgIGlmKCAkYVByZWMgPT0gMSApCiAgICAgICAgICAgICRtdWw9MTAwMDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAkbXVsPTEwMDAwOwogICAgICAgIH0KCiAgICAgICAgJHRtcCA9IGFycmF5KCk7CiAgICAgICAgJHJlc3VsdCA9IGFycmF5KCk7CiAgICAgICAgJHF1b3RlX3N1bT0wOwogICAgICAgICRuID0gY291bnQoJGFEYXRhKSA7CiAgICAgICAgZm9yKCAkaT0wLCAkc3VtPTA7ICRpIDwgJG47ICsrJGkgKQogICAgICAgICRzdW0rPSRhRGF0YVskaV07CiAgICAgICAgZm9yZWFjaCgkYURhdGEgYXMgJGluZGV4ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAkdG1wX3BlcmNlbnRhZ2U9JHZhbHVlLyRzdW0qJG11bDsKICAgICAgICAgICAgJHJlc3VsdFskaW5kZXhdPWZsb29yKCR0bXBfcGVyY2VudGFnZSk7CiAgICAgICAgICAgICR0bXBbJGluZGV4XT0kdG1wX3BlcmNlbnRhZ2UtJHJlc3VsdFskaW5kZXhdOwogICAgICAgICAgICAkcXVvdGVfc3VtKz0kcmVzdWx0WyRpbmRleF07CiAgICAgICAgfQogICAgICAgIGlmKCAkcXVvdGVfc3VtID09ICRtdWwpIHsKICAgICAgICAgICAgaWYoICRtdWwgPiAxMDAgKSB7CiAgICAgICAgICAgICAgICAkdG1wID0gJG11bCAvIDEwMDsKICAgICAgICAgICAgICAgIGZvciggJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgICAgICAgICAkcmVzdWx0WyRpXSAvPSAkdG1wIDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgYXJzb3J0KCR0bXAsU09SVF9OVU1FUklDKTsKICAgICAgICByZXNldCgkdG1wKTsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbXVsLSRxdW90ZV9zdW07ICRpKyspCiAgICAgICAgewogICAgICAgICAgICAkcmVzdWx0W2tleSgkdG1wKV0rKzsKICAgICAgICAgICAgbmV4dCgkdG1wKTsKICAgICAgICB9CiAgICAgICAgaWYoICRtdWwgPiAxMDAgKSB7CiAgICAgICAgICAgICR0bXAgPSAkbXVsIC8gMTAwOwogICAgICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAkcmVzdWx0WyRpXSAvPSAkdG1wIDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCgogICAgZnVuY3Rpb24gU3Ryb2tlKCRpbWcsJGFhb3B0aW9uPTApIHsKICAgICAgICAvLyBhYW9wdGlvbiBpcyB1c2VkIHRvIGhhbmRsZSBhbnRpYWxpYXMKICAgICAgICAvLyBhYW9wdGlvbiA9PSAwIGEgbm9ybWFsIHBpZQogICAgICAgIC8vIGFhb3B0aW9uID09IDEganVzdCB0aGUgYm9keQogICAgICAgIC8vIGFhb3B0aW9uID09IDIganVzdCB0aGUgdmFsdWVzCgogICAgICAgIC8vIEV4cGxvZGUgc2NhbGluZy4gSWYgYW50aSBhbGlhcyB3ZSBzY2FsZSB0aGUgaW1hZ2UKICAgICAgICAvLyB0d2ljZSBhbmQgd2UgYWxzbyBuZWVkIHRvIHNjYWxlIHRoZSBleHBsb2RpbmcgZGlzdGFuY2UKICAgICAgICAkZXhwc2NhbGUgPSAkYWFvcHRpb24gPT09IDEgPyAyIDogMTsKCiAgICAgICAgaWYoICR0aGlzLT5sYWJlbHR5cGUgPT0gMiApIHsKICAgICAgICAgICAgLy8gQWRqdXN0IHRoZSBkYXRhIHNvIHRoYXQgaXQgd2lsbCBhZGQgdXAgdG8gMTAwJQogICAgICAgICAgICAkdGhpcy0+YWRqdXN0ZWRfZGF0YSA9ICR0aGlzLT5BZGpQZXJjZW50YWdlKCR0aGlzLT5kYXRhKTsKICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+dXNlX3Bsb3RfdGhlbWVfY29sb3JzKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRzbGljZWNvbG9ycyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICAkY29sb3JzID0gYXJyYXlfa2V5cygkaW1nLT5yZ2ItPnJnYl90YWJsZSk7CiAgICAgICAgc29ydCgkY29sb3JzKTsKICAgICAgICAkdGE9JHRoaXMtPnRoZW1lYXJyWyR0aGlzLT50aGVtZV07CiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+ZGF0YSk7CgogICAgICAgIGlmKCAkdGhpcy0+c2V0c2xpY2Vjb2xvcnM9PW51bGwgKSB7CiAgICAgICAgICAgICRudW1jb2xvcnM9Y291bnQoJHRhKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY3JlYXRlIGFuIGFycmF5IG9mIGNvbG9ycyBhcyBsb25nIGFzIHRoZSBkYXRhCiAgICAgICAgICAgIC8vIHNpbmNlIHdlIG5lZWQgdG8gcmV2ZXJzZSBpdCB0byBnZXQgdGhlIGNvbG9ycyBpbiB0aGUgcmlnaHQgb3JkZXIKICAgICAgICAgICAgJG51bWNvbG9ycz1jb3VudCgkdGhpcy0+c2V0c2xpY2Vjb2xvcnMpOwogICAgICAgICAgICAkaSA9IDIqJG51bWNvbG9yczsKICAgICAgICAgICAgd2hpbGUoICRuID4gJGkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0c2xpY2Vjb2xvcnMgPSBhcnJheV9tZXJnZSgkdGhpcy0+c2V0c2xpY2Vjb2xvcnMsJHRoaXMtPnNldHNsaWNlY29sb3JzKTsKICAgICAgICAgICAgICAgICRpICs9ICRuOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0dCA9IGFycmF5X3NsaWNlKCR0aGlzLT5zZXRzbGljZWNvbG9ycywwLCRuICUgJG51bWNvbG9ycyk7CiAgICAgICAgICAgICR0aGlzLT5zZXRzbGljZWNvbG9ycyA9IGFycmF5X21lcmdlKCR0aGlzLT5zZXRzbGljZWNvbG9ycywkdHQpOwogICAgICAgICAgICAkdGhpcy0+c2V0c2xpY2Vjb2xvcnMgPSBhcnJheV9yZXZlcnNlKCR0aGlzLT5zZXRzbGljZWNvbG9ycyk7CiAgICAgICAgfQoKICAgICAgICAvLyBEcmF3IHRoZSBzbGljZXMKICAgICAgICAkc3VtPTA7CiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG47ICsrJGkpCiAgICAgICAgICAgICRzdW0gKz0gJHRoaXMtPmRhdGFbJGldOwoKICAgICAgICAvLyBCYWlsIG91dCB3aXRoIGVycm9yIGlmIHRoZSBzdW0gaXMgMAogICAgICAgIGlmKCAkc3VtPT0wICkgewogICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgxNTAwOSk7Ly8oIlN1bSBvZiBhbGwgZGF0YSBpcyAwIGZvciBQaWUuIik7CiAgICAgICAgfQoKICAgICAgICAvLyBTZXQgdXAgdGhlIHBpZS1jaXJjbGUKICAgICAgICBpZiggJHRoaXMtPnJhZGl1cyA8PSAxICkgewogICAgICAgICAgICAkcmFkaXVzID0gZmxvb3IoJHRoaXMtPnJhZGl1cyptaW4oJGltZy0+d2lkdGgsJGltZy0+aGVpZ2h0KSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkcmFkaXVzID0gJGFhb3B0aW9uID09PSAxID8gJHRoaXMtPnJhZGl1cyoyIDogJHRoaXMtPnJhZGl1czsKICAgICAgICB9CgogICAgICAgIGlmKCAkdGhpcy0+cG9zeCA8PSAxICYmICR0aGlzLT5wb3N4ID4gMCApIHsKICAgICAgICAgICAgJHhjID0gcm91bmQoJHRoaXMtPnBvc3gqJGltZy0+d2lkdGgpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHhjID0gJHRoaXMtPnBvc3ggOwogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT5wb3N5IDw9IDEgJiYgJHRoaXMtPnBvc3kgPiAwICkgewogICAgICAgICAgICAkeWMgPSByb3VuZCgkdGhpcy0+cG9zeSokaW1nLT5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHljID0gJHRoaXMtPnBvc3kgOwogICAgICAgIH0KCiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+ZGF0YSk7CgogICAgICAgIGlmKCAkdGhpcy0+ZXhwbG9kZV9hbGwgKSB7CiAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZXhwbG9kZV9yYWRpdXNbJGldPSR0aGlzLT5leHBsb2RlX3I7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIElmIHdlIGhhdmUgYSBzaGFkb3cgYW5kIG5vdCBqdXN0IGRyYXdpbmcgdGhlIGxhYmVscwogICAgICAgIGlmKCAkdGhpcy0+aXNoYWRvd2NvbG9yICE9ICIiICYmICRhYW9wdGlvbiAhPT0gMikgewogICAgICAgICAgICAkYWNjc3VtPTA7CiAgICAgICAgICAgICRhbmdsZTIgPSAkdGhpcy0+c3RhcnRhbmdsZTsKICAgICAgICAgICAgJGltZy0+U2V0Q29sb3IoJHRoaXMtPmlzaGFkb3djb2xvcik7CiAgICAgICAgICAgIGZvcigkaT0wOyAkc3VtID4gMCAmJiAkaSA8ICRuOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkaiA9ICRuLSRpLTE7CiAgICAgICAgICAgICAgICAkZCA9ICR0aGlzLT5kYXRhWyRpXTsKICAgICAgICAgICAgICAgICRhbmdsZTEgPSAkYW5nbGUyOwogICAgICAgICAgICAgICAgJGFjY3N1bSArPSAkZDsKICAgICAgICAgICAgICAgICRhbmdsZTIgPSAkdGhpcy0+c3RhcnRhbmdsZSsyKk1fUEkqJGFjY3N1bS8kc3VtOwogICAgICAgICAgICAgICAgaWYoIGVtcHR5KCR0aGlzLT5leHBsb2RlX3JhZGl1c1skal0pICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5leHBsb2RlX3JhZGl1c1skal09MDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiggJGQgPCAwLjAwMDAxICkgY29udGludWU7CgogICAgICAgICAgICAgICAgJGxhID0gMipNX1BJIC0gKGFicygkYW5nbGUyLSRhbmdsZTEpLzIuMCskYW5nbGUxKTsKCiAgICAgICAgICAgICAgICAkeGNtID0gJHhjICsgJHRoaXMtPmV4cGxvZGVfcmFkaXVzWyRqXSpjb3MoJGxhKSokZXhwc2NhbGU7CiAgICAgICAgICAgICAgICAkeWNtID0gJHljIC0gJHRoaXMtPmV4cGxvZGVfcmFkaXVzWyRqXSpzaW4oJGxhKSokZXhwc2NhbGU7CgogICAgICAgICAgICAgICAgJHhjbSArPSAkdGhpcy0+aXNoYWRvd2Ryb3AqJGV4cHNjYWxlOwogICAgICAgICAgICAgICAgJHljbSArPSAkdGhpcy0+aXNoYWRvd2Ryb3AqJGV4cHNjYWxlOwoKICAgICAgICAgICAgICAgICRfc2EgPSByb3VuZCgkYW5nbGUxKjE4MC9NX1BJKTsKICAgICAgICAgICAgICAgICRfZWEgPSByb3VuZCgkYW5nbGUyKjE4MC9NX1BJKTsKCiAgICAgICAgICAgICAgICAvLyBUaGUgQ2FrZVNsaWNlIG1ldGhvZCBkcmF3cyBhIGZ1bGwgY2lyY2xlIGluIGNhc2Ugb2Ygc3RhcnQgYW5nbGUgPSBlbmQgYW5nbGUKICAgICAgICAgICAgICAgIC8vIGZvciBwaWUgc2xpY2VzIHdlIGRvbid0IHdhbnQgdGhpcyBiZWhhdmlvdXIgdW5sZXNzIHdlIG9ubHkgaGF2ZSBvbmUKICAgICAgICAgICAgICAgIC8vIHNsaWNlIGluIHRoZSBwaWUgaW4gY2FzZSBpdCBpcyB0aGUgd2FudGVkIGJlaGF2aW91cgogICAgICAgICAgICAgICAgaWYoICRfZWEtJF9zYSA+IDAuMSB8fCAkbj09MSApIHsKICAgICAgICAgICAgICAgICAgICAkaW1nLT5DYWtlU2xpY2UoJHhjbSwkeWNtLCRyYWRpdXMtMSwkcmFkaXVzLTEsCiAgICAgICAgICAgICAgICAgICAgJGFuZ2xlMSoxODAvTV9QSSwkYW5nbGUyKjE4MC9NX1BJLCR0aGlzLT5pc2hhZG93Y29sb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gVGhpcyBpcyB0aGUgbWFpbiBsb29wIHRvIGRyYXcgZWFjaCBjYWtlIHNsaWNlCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgICAvLyBTZXQgdXAgdGhlIGFjY3VtdWxhdGVkIHN1bSwgc3RhcnQgYW5nbGUgZm9yIGZpcnN0IHNsaWNlIGFuZCBib3JkZXIgY29sb3IKICAgICAgICAkYWNjc3VtPTA7CiAgICAgICAgJGFuZ2xlMiA9ICR0aGlzLT5zdGFydGFuZ2xlOwogICAgICAgICRpbWctPlNldENvbG9yKCR0aGlzLT5jb2xvcik7CgogICAgICAgIC8vIExvb3AgdGhvdWdoIGFsbCB0aGUgc2xpY2VzIGlmIHRoZXJlIGlzIGEgcGllIHRvIGRyYXcgKHN1bT4wKQogICAgICAgIC8vIFRoZXJlIGFyZSBuIHNsaWNlcyBpbiB0b3RhbAogICAgICAgIGZvcigkaT0wOyAkc3VtPjAgJiYgJGkgPCAkbjsgKyskaSkgewoKICAgICAgICAgICAgLy8gJGogaXMgdGhlIGFjdHVhbCBpbmRleCB1c2VkIGZvciB0aGUgc2xpY2UKICAgICAgICAgICAgJGogPSAkbi0kaS0xOwoKICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGhhdmVhICB2YWxpZCBkaXN0YW5jZSB0byBleHBsb2RlIHRoZSBzbGljZQogICAgICAgICAgICBpZiggZW1wdHkoJHRoaXMtPmV4cGxvZGVfcmFkaXVzWyRqXSkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZXhwbG9kZV9yYWRpdXNbJGpdPTA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRoZSBhY3R1YWwgbnVtZXJpYyB2YWx1ZSBmb3IgdGhlIHNsaWNlCiAgICAgICAgICAgICRkID0gJHRoaXMtPmRhdGFbJGldOwoKICAgICAgICAgICAgJGFuZ2xlMSA9ICRhbmdsZTI7CgogICAgICAgICAgICAvLyBBY2N1bWxhdGUgdGhlIHN1bQogICAgICAgICAgICAkYWNjc3VtICs9ICRkOwoKICAgICAgICAgICAgLy8gVGhlIG5ldyBhbmdsZSB3aGVuIHdlIGFkZCB0aGUgInNpemUiIG9mIHRoaXMgc2xpY2UKICAgICAgICAgICAgLy8gYW5nbGUxIGlzIHRoZW4gdGhlIHN0YXJ0IGFuZCBhbmdsZTIgdGhlIGVuZCBvZiB0aGlzIHNsaWNlCiAgICAgICAgICAgICRhbmdsZTIgPSAkdGhpcy0+Tm9ybUFuZ2xlKCR0aGlzLT5zdGFydGFuZ2xlKzIqTV9QSSokYWNjc3VtLyRzdW0pOwoKICAgICAgICAgICAgLy8gV2UgYXZvaWQgc29tZSB0cm91YmxlIGJ5IG5vdCBhbGxvd2luZyBlbmQgYW5nbGUgdG8gYmUgMCwgaW4gdGhhdCBjYXNlCiAgICAgICAgICAgIC8vIHdlIHRyYW5zbGF0ZSB0byAzNjAKCiAgICAgICAgICAgIC8vIGxhIGlzIHVzZWQgdG8gaG9sZCB0aGUgbGFiZWwgYW5nbGUsIHdoaWNoIGlzIGNlbnRlcmVkIG9uIHRoZSBzbGljZQogICAgICAgICAgICBpZiggJGFuZ2xlMiA8IDAuMDAwMSAmJiAkYW5nbGUxID4gMC4wMDAxICkgewogICAgICAgICAgICAgICAgJHRoaXMtPmxhWyRpXSA9IDIqTV9QSSAtIChhYnMoMipNX1BJLSRhbmdsZTEpLzIuMCskYW5nbGUxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICRhbmdsZTEgPiAkYW5nbGUyICkgewogICAgICAgICAgICAgICAgLy8gVGhlIGNhc2Ugd2hlcmUgdGhlIHNsaWNlIGNyb3NzZXMgdGhlIDMgYSdjbG9jayBsaW5lCiAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGF0IHRoZSBzbGljZXMgYXJlIGNvdW50ZWQgY2xvY2t3aXNlIGFuZAogICAgICAgICAgICAgICAgLy8gbGFiZWxzIGFyZSBjb3VudGVkIGNvdW50ZXIgY2xvY2t3aXNlIHNvIHdlIG5lZWQgdG8gcmV2ZXJ0IHdpdGggMiBQSQogICAgICAgICAgICAgICAgJHRoaXMtPmxhWyRpXSA9IDIqTV9QSS0kdGhpcy0+Tm9ybUFuZ2xlKCRhbmdsZTEgKyAoKDIqTV9QSSAtICRhbmdsZTEpKyRhbmdsZTIpLzIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJHRoaXMtPmxhWyRpXSA9IDIqTV9QSSAtIChhYnMoJGFuZ2xlMi0kYW5nbGUxKS8yLjArJGFuZ2xlMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRvbyBhdm9pZCByb3VuZGluZyBwcm9ibGVtcyB3ZSBza2lwIHRoZSBzbGljZSBpZiBpdCBpcyB0b28gc21hbGwKICAgICAgICAgICAgaWYoICRkIDwgMC4wMDAwMSApIGNvbnRpbnVlOwoKICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgaGFzIHNwZWNpZmllZCBhbiBhcnJheSBvZiBjb2xvcnMgZm9yIGVhY2ggc2xpY2UgdGhlbiB1c2UKICAgICAgICAgICAgLy8gdGhhdCBhIGNvbG9yIG90aGVyd2lzZSB1c2UgdGhlIHRoZW1lIGFycmF5ICh0YSkgb2YgY29sb3JzCiAgICAgICAgICAgIGlmKCAkdGhpcy0+c2V0c2xpY2Vjb2xvcnM9PW51bGwgKSB7CiAgICAgICAgICAgICAgICAkc2xpY2Vjb2xvcj0kY29sb3JzWyR0YVskaSUkbnVtY29sb3JzXV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkc2xpY2Vjb2xvcj0kdGhpcy0+c2V0c2xpY2Vjb2xvcnNbJGklJG51bWNvbG9yc107CiAgICAgICAgICAgIH0KCi8vICAgICAgICAgICAgJF9zYSA9IHJvdW5kKCRhbmdsZTEqMTgwL01fUEkpOwovLyAgICAgICAgICAgICRfZWEgPSByb3VuZCgkYW5nbGUyKjE4MC9NX1BJKTsKLy8gICAgICAgICAgICAkX2xhID0gcm91bmQoJHRoaXMtPmxhWyRpXSoxODAvTV9QSSk7Ci8vICAgICAgICAgICAgZWNobyAiU2xpY2UjJGk6IGFuZzE9JF9zYSAsIGFuZzI9JF9lYSwgbGE9JF9sYSwgY29sb3I9JHNsaWNlY29sb3I8YnI+IjsKCgogICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGVuYWJsZWQgYW50aWFsaWFzIHRoZW4gd2UgZG9uJ3QgZHJhdyBhbnkgYm9yZGVyIHNvCiAgICAgICAgICAgIC8vIG1ha2UgdGhlIGJvcmRlZHIgY29sb3IgdGhlIHNhbWUgYXMgdGhlIHNsaWNlIGNvbG9yCiAgICAgICAgICAgIGlmKCAkdGhpcy0+cGllX2ludGVyaW9yX2JvcmRlciAmJiAkYWFvcHRpb249PT0wICkgewogICAgICAgICAgICAgICAgJGltZy0+U2V0Q29sb3IoJHRoaXMtPmNvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRpbWctPlNldENvbG9yKCRzbGljZWNvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkYXJjY29sb3IgPSAkdGhpcy0+cGllX2JvcmRlciAmJiAkYWFvcHRpb249PT0wID8gJHRoaXMtPmNvbG9yIDogIiI7CgogICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHgseSBjb29yZGluYXRlcyBmb3IgdGhlIGJhc2Ugb2YgdGhpcyBzbGljZSB0YWtpbmcKICAgICAgICAgICAgLy8gdGhlIGV4cGxvZGVkIGRpc3RhbmNlIGludG8gYWNjb3VudC4gSGVyZSB3ZSB1c2UgdGhlIG1pZCBhbmdsZSBhcyB0aGUKICAgICAgICAgICAgLy8gcmF5IG9mIGV4dGVuc2lvbiBhbmQgd2UgaGF2ZSB0aGUgbWlkIGFuZ2xlIGhhbmR5IGFzIGl0IGlzIGFsc28gdGhlCiAgICAgICAgICAgIC8vIGxhYmVsIGFuZ2xlCiAgICAgICAgICAgICR4Y20gPSAkeGMgKyAkdGhpcy0+ZXhwbG9kZV9yYWRpdXNbJGpdKmNvcygkdGhpcy0+bGFbJGldKSokZXhwc2NhbGU7CiAgICAgICAgICAgICR5Y20gPSAkeWMgLSAkdGhpcy0+ZXhwbG9kZV9yYWRpdXNbJGpdKnNpbigkdGhpcy0+bGFbJGldKSokZXhwc2NhbGU7CgogICAgICAgICAgICAvLyBJZiB3ZSBhcmUgbm90IGp1c3QgZHJhd2luZyB0aGUgbGFiZWxzIHRoZW4gZHJhdyB0aGlzIGNha2Ugc2xpY2UKICAgICAgICAgICAgaWYoICRhYW9wdGlvbiAhPT0gMiApIHsKCiAgICAgICAgICAgICAgICAkX3NhID0gcm91bmQoJGFuZ2xlMSoxODAvTV9QSSk7CiAgICAgICAgICAgICAgICAkX2VhID0gcm91bmQoJGFuZ2xlMioxODAvTV9QSSk7CiAgICAgICAgICAgICAgICAkX2xhID0gcm91bmQoJHRoaXMtPmxhWyRpXSoxODAvTV9QSSk7CiAgICAgICAgICAgICAgICAvL2VjaG8gIlskaV0gc2E9JF9zYSwgZWE9JF9lYSwgbGFbJGldPSRfbGEsIChjb2xvcj0kc2xpY2Vjb2xvcik8YnI+IjsKCiAgICAgICAgICAgICAgICAvLyBUaGUgQ2FrZVNsaWNlIG1ldGhvZCBkcmF3cyBhIGZ1bGwgY2lyY2xlIGluIGNhc2Ugb2Ygc3RhcnQgYW5nbGUgPSBlbmQgYW5nbGUKICAgICAgICAgICAgICAgIC8vIGZvciBwaWUgc2xpY2VzIHdlIHdhbnQgdGhpcyBpbiBjYXNlIHRoZSBzbGljZSBoYXZlIGEgdmFsdWUgbGFyZ2VyIHRoYW4gOTklIG9mIHRoZQogICAgICAgICAgICAgICAgLy8gdG90YWwgc3VtCiAgICAgICAgICAgICAgICBpZiggYWJzKCRfZWEtJF9zYSkgPj0gMSB8fCAkZCA9PSAkc3VtICkgewogICAgICAgICAgICAgICAgICAgICRpbWctPkNha2VTbGljZSgkeGNtLCR5Y20sJHJhZGl1cy0xLCRyYWRpdXMtMSwkX3NhLCRfZWEsJHNsaWNlY29sb3IsJGFyY2NvbG9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIENTSU0gaXMgdXNlZCB0aGVuIG1ha2Ugc3VyZSB3ZSByZWdpc3RlciBhIENTSU0gYXJlYSBmb3IgdGhpcyBzbGljZSBhcyB3ZWxsCiAgICAgICAgICAgIGlmKCAkdGhpcy0+Y3NpbXRhcmdldHMgJiYgJGFhb3B0aW9uICE9PSAxICkgewogICAgICAgICAgICAgICAgJHRoaXMtPkFkZFNsaWNlVG9DU0lNKCRpLCR4Y20sJHljbSwkcmFkaXVzLCRhbmdsZTEsJGFuZ2xlMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEZvcm1hdCB0aGUgdGl0bGVzIGZvciBlYWNoIHNsaWNlCiAgICAgICAgaWYoICRhYW9wdGlvbiAhPT0gMiApIHsKICAgICAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpKSB7CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmxhYmVsdHlwZT09MCApIHsKICAgICAgICAgICAgICAgICAgICBpZiggJHN1bSAhPSAwICkKICAgICAgICAgICAgICAgICAgICAkbCA9IDEwMC4wKiR0aGlzLT5kYXRhWyRpXS8kc3VtOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAkbCA9IDAuMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiggJHRoaXMtPmxhYmVsdHlwZT09MSApIHsKICAgICAgICAgICAgICAgICAgICAkbCA9ICR0aGlzLT5kYXRhWyRpXSoxLjA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbCA9ICR0aGlzLT5hZGp1c3RlZF9kYXRhWyRpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCBpc3NldCgkdGhpcy0+bGFiZWxzWyRpXSkgJiYgaXNfc3RyaW5nKCR0aGlzLT5sYWJlbHNbJGldKSApCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFiZWxzWyRpXT1zcHJpbnRmKCR0aGlzLT5sYWJlbHNbJGldLCRsKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICR0aGlzLT5sYWJlbHNbJGldPSRsOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPnZhbHVlLT5zaG93ICYmICRhYW9wdGlvbiAhPT0gMSApIHsKICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUFsbExhYmVscygkaW1nLCR4YywkeWMsJHJhZGl1cyk7CiAgICAgICAgfQoKICAgICAgICAvLyBBZGp1c3QgdGl0bGUgcG9zaXRpb24KICAgICAgICBpZiggJGFhb3B0aW9uICE9PSAxICkgewogICAgICAgICAgICAkdGhpcy0+dGl0bGUtPlNldFBvcygkeGMsCiAgICAgICAgICAgICR5Yy0kdGhpcy0+dGl0bGUtPkdldEZvbnRIZWlnaHQoJGltZyktJHJhZGl1cy0kdGhpcy0+dGl0bGUtPm1hcmdpbiwKICAgICAiY2VudGVyIiwiYm90dG9tIik7CiAgICAgICAgICAgICR0aGlzLT50aXRsZS0+U3Ryb2tlKCRpbWcpOwogICAgICAgIH0KCiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBSSVZBVEUgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIE5vcm1BbmdsZSgkYSkgewogICAgICAgIHdoaWxlKCAkYSA8IDAgKSAkYSArPSAyKk1fUEk7CiAgICAgICAgd2hpbGUoICRhID4gMipNX1BJICkgJGEgLT0gMipNX1BJOwogICAgICAgIHJldHVybiAkYTsKICAgIH0KCiAgICBmdW5jdGlvbiBRdWFkcmFudCgkYSkgewogICAgICAgICRhPSR0aGlzLT5Ob3JtQW5nbGUoJGEpOwogICAgICAgIGlmKCAkYSA+IDAgJiYgJGEgPD0gTV9QSS8yICkKICAgICAgICByZXR1cm4gMDsKICAgICAgICBpZiggJGEgPiBNX1BJLzIgJiYgJGEgPD0gTV9QSSApCiAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYoICRhID4gTV9QSSAmJiAkYSA8PSAxLjUqTV9QSSApCiAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgaWYoICRhID4gMS41Kk1fUEkgKQogICAgICAgIHJldHVybiAzOwogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZUd1aWRlTGFiZWxzKCRpbWcsJHhjLCR5YywkcmFkaXVzKSB7CiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+bGFiZWxzKTsKCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIFN0ZXAgMSBvZiB0aGUgYWxnb3JpdGhtIGlzIHRvIGNvbnN0cnVjdCBhIG51bWJlciBvZiBjbHVzdGVycwogICAgICAgIC8vIGEgY2x1c3RlciBpcyBkZWZpbmVkIGFzIGFsbCBzbGljZXMgd2l0aGluIHRoZSBzYW1lIHF1YWRyYW50IChhbG1vc3QpCiAgICAgICAgLy8gdGhhdCBoYXMgYW4gYW5ndWxhciBkaXN0YW5jZSBsZXNzIHRoYW4gdGhlIHRyZXNob2xkCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICR0cmVzaF9ob2xkPTI1ICogTV9QSS8xODA7IC8vIDI1IGRlZ3JlZXMgZGlmZmVyZW5jZSB0byBiZSBpbiBhIGNsdXN0ZXIKICAgICAgICAkaW5jbHVzdGVyPWZhbHNlOyAvLyBmbGFnIGlmIHdlIGFyZSBjdXJyZW50bHkgaW4gYSBjbHVzdGVyIG9yIG5vdAogICAgICAgICRjbHVzdGVycyA9IGFycmF5KCk7IC8vIGFycmF5IG9mIGNsdXN0ZXJzCiAgICAgICAgJGNpZHg9LTE7ICAvLyBydW5uaW5nIGNsdXN0ZXIgaW5kZXgKCiAgICAgICAgLy8gR28gdGhyb3VnaCBhbGwgdGhlIGxhYmVscyBhbmQgY29uc3RydWN0IGEgbnVtYmVyIG9mIGNsdXN0ZXJzCiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG4tMTsgKyskaSkgewogICAgICAgICAgICAvLyBDYWxjIHRoZSBhbmdsZSBkaXN0YW5jZSBiZXR3ZWVuIHR3byBjb25zZWN1dGl2ZSBzbGljZXMKICAgICAgICAgICAgJGExPSR0aGlzLT5sYVskaV07CiAgICAgICAgICAgICRhMj0kdGhpcy0+bGFbJGkrMV07CiAgICAgICAgICAgICRxMSA9ICR0aGlzLT5RdWFkcmFudCgkYTEpOwogICAgICAgICAgICAkcTIgPSAkdGhpcy0+UXVhZHJhbnQoJGEyKTsKICAgICAgICAgICAgJGRpZmYgPSBhYnMoJGExLSRhMik7CiAgICAgICAgICAgIGlmKCAkZGlmZiA8ICR0cmVzaF9ob2xkICkgewogICAgICAgICAgICAgICAgaWYoICRpbmNsdXN0ZXIgKSB7CiAgICAgICAgICAgICAgICAgICAgJGNsdXN0ZXJzWyRjaWR4XVsxXSsrOwogICAgICAgICAgICAgICAgICAgIC8vIEVhY2ggY2x1c3RlciBjYW4gb25seSBjb3ZlciBvbmUgcXVhZHJhbnQKICAgICAgICAgICAgICAgICAgICAvLyBEbyB3ZSBjcm9zcyBhIHF1YWRyYW50ICggYW5kIG11c3QgYnJlYWsgdGhlIGNsdXN0ZXIpCiAgICAgICAgICAgICAgICAgICAgaWYoICRxMSAhPSAgJHEyICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSBjcm9zcyBhIHF1YWRyYW50IGJvdW5kYXJ5IHdlIG5vcm1hbGx5IHN0YXJ0IGEKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV3IGNsdXN0ZXIuIEhvd2V2ZXIgd2UgbmVlZCB0byB0YWtlIHRoZSAxMidhIGNsb2NrCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCA2J2EgY2xvY2sgcG9zaXRpb25zIGludG8gYSBzcGVjaWFsIGNvbnNpZGVyYXRpb24uCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhc2UgMTogV0UgZ28gZnJvbSBxPTEgdG8gcT0yIGlmIHRoZSBsYXN0IHNsaWNlIG9uCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBjbHVzdGVyIGZvciBxPTEgaXMgY2xvc2UgdG8gMTInYSBjbG9jayBhbmQgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IHNsaWNlIGluIHE9MCBpcyBzbWFsbCB3ZSBleHRlbmQgdGhlIHByZXZpb3VzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNsdXN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYoICRxMSA9PSAxICYmICRxMiA9PSAwICYmICRhMiA+ICg5MC0xNSkqTV9QSS8xODAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggJGkgPCAkbi0yICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhMyA9ICR0aGlzLT5sYVskaSsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpc24ndCBhIGNsdXN0ZXIgY29taW5nIHVwIHdpdGggdGhlIG5leHQtbmV4dCBzbGljZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGV4dGVuZCB0aGUgcHJldmlvdXMgY2x1c3RlciB0byBjb3ZlciB0aGlzIHNsaWNlIGFzIHdlbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggYWJzKCRhMy0kYTIpID49ICR0cmVzaF9ob2xkICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2x1c3RlcnNbJGNpZHhdWzFdKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiggJHExID09IDMgJiYgJHEyID09IDIgJiYgJGEyID4gKDI3MC0xNSkqTV9QSS8xODAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggJGkgPCAkbi0yICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhMyA9ICR0aGlzLT5sYVskaSsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpc24ndCBhIGNsdXN0ZXIgY29taW5nIHVwIHdpdGggdGhlIG5leHQtbmV4dCBzbGljZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGV4dGVuZCB0aGUgcHJldmlvdXMgY2x1c3RlciB0byBjb3ZlciB0aGlzIHNsaWNlIGFzIHdlbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggYWJzKCRhMy0kYTIpID49ICR0cmVzaF9ob2xkICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2x1c3RlcnNbJGNpZHhdWzFdKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiggJHExPT0yICYmICRxMj09MSAmJiAkYTIgPiAoMTgwLTE1KSpNX1BJLzE4MCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMV0rKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRpbmNsdXN0ZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoICRxMSA9PSAkcTIpICB7CiAgICAgICAgICAgICAgICAgICAgJGluY2x1c3RlciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgLy8gTm93IHdlIGhhdmUgYSBzcGVjaWFsIGNhc2UgZm9yIHF1YWRyYW50IDAuIElmIHdlIHByZXZpb3VzbHkKICAgICAgICAgICAgICAgICAgICAvLyBoYXZlIGEgY2x1c3RlciBvZiBvbmUgaW4gcXVhZHJhbnQgMCB3ZSBqdXN0IGV4dGVuZCB0aGF0CiAgICAgICAgICAgICAgICAgICAgLy8gY2x1c3Rlci4gSWYgd2UgZG9uJ3QgZG8gdGhpcyB0aGVuIHdlIHJpc2sgdGhhdCB0aGUgbGFiZWwKICAgICAgICAgICAgICAgICAgICAvLyBmb3IgdGhlIGNsdXN0ZXIgb2Ygb25lIHdpbGwgY3Jvc3MgdGhlIGd1aWRlLWxpbmUKICAgICAgICAgICAgICAgICAgICBpZiggJHExID09IDAgJiYgJGNpZHggPiAtMSAmJgogICAgICAgICAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMV0gPT0gMSAmJgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5RdWFkcmFudCgkdGhpcy0+bGFbJGNsdXN0ZXJzWyRjaWR4XVswXV0pID09IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMV0rKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjaWR4Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMF0gPSAkaTsKICAgICAgICAgICAgICAgICAgICAgICAgJGNsdXN0ZXJzWyRjaWR4XVsxXSA9IDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgImNsdXN0ZXIiIG9mIG9uZSBzaW5jZSB3ZSBhcmUganVzdCBjcm9zc2luZwogICAgICAgICAgICAgICAgICAgIC8vIGEgcXVhZHJhbnQKICAgICAgICAgICAgICAgICAgICAkY2lkeCsrOwogICAgICAgICAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMF0gPSAkaTsKICAgICAgICAgICAgICAgICAgICAkY2x1c3RlcnNbJGNpZHhdWzFdID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmKCAkaW5jbHVzdGVyICkgewogICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgbGFzdCBzbGljZQogICAgICAgICAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMV0rKzsKICAgICAgICAgICAgICAgICAgICAkaW5jbHVzdGVyID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ3JlYXRlIGEgImNsdXN0ZXIiIG9mIG9uZQogICAgICAgICAgICAgICAgICAgICRjaWR4Kys7CiAgICAgICAgICAgICAgICAgICAgJGNsdXN0ZXJzWyRjaWR4XVswXSA9ICRpOwogICAgICAgICAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMV0gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIEhhbmRsZSB0aGUgdmVyeSBsYXN0IHNsaWNlCiAgICAgICAgaWYoICRpbmNsdXN0ZXIgKSB7CiAgICAgICAgICAgICRjbHVzdGVyc1skY2lkeF1bMV0rKzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7IC8vIENyZWF0ZSBhICJjbHVzdGVyIiBvZiBvbmUKICAgICAgICAgICAgJGNpZHgrKzsKICAgICAgICAgICAgJGNsdXN0ZXJzWyRjaWR4XVswXSA9ICRpOwogICAgICAgICAgICAkY2x1c3RlcnNbJGNpZHhdWzFdID0gMTsKICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAgIGlmKCB0cnVlICkgewogICAgICAgICAvLyBEZWJ1ZyBwcmludG91dCBpbiBsYWJlbHMKICAgICAgICAgZm9yKCAkaT0wOyAkaSA8PSAkY2lkeDsgKyskaSApIHsKICAgICAgICAgZm9yKCAkaj0wOyAkaiA8ICRjbHVzdGVyc1skaV1bMV07ICsrJGogKSB7CiAgICAgICAgICRhID0gJHRoaXMtPmxhWyRjbHVzdGVyc1skaV1bMF0rJGpdOwogICAgICAgICAkYWEgPSByb3VuZCgkYSoxODAvTV9QSSk7CiAgICAgICAgICRxID0gJHRoaXMtPlF1YWRyYW50KCRhKTsKICAgICAgICAgJHRoaXMtPmxhYmVsc1skY2x1c3RlcnNbJGldWzBdKyRqXT0iWyRxOiRhYV0gJGk6JGoiOwogICAgICAgICB9CiAgICAgICAgIH0KICAgICAgICAgfQogICAgICAgICAqLwoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gU3RlcCAyIG9mIHRoZSBhbGdvcml0aG0gaXMgdXNlIHRoZSBjbHVzdGVycyBhbmQgZHJhdyB0aGUgbGFiZWxzCiAgICAgICAgLy8gYW5kIGd1aWRlbGluZXMKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgIC8vIFdlIHVzZSB0aGUgZm9udCBoZWlnaHQgYXMgdGhlIGJhc2UgZmFjdG9yIGZvciBob3cgZmFyIHdlIG5lZWQgdG8KICAgICAgICAvLyBzcHJlYWQgdGhlIGxhYmVscyBpbiB0aGUgWS1kaXJlY3Rpb24uCiAgICAgICAgJHRoaXMtPnZhbHVlLT5BcHBseUZvbnQoJGltZyk7CiAgICAgICAgJGZoID0gJGltZy0+R2V0Rm9udEhlaWdodCgpOwogICAgICAgICRvcmlndnN0ZXA9JGZoKiR0aGlzLT5pR3VpZGVWRmFjdG9yOwogICAgICAgICR0aGlzLT52YWx1ZS0+U2V0TWFyZ2luKDApOwoKICAgICAgICAvLyBOdW1iZXIgb2YgY2x1c3RlcnMgZm91bmQKICAgICAgICAkbmMgPSBjb3VudCgkY2x1c3RlcnMpOwoKICAgICAgICAvLyBXYWxrIHRocm91Z2ggYWxsIHRoZSBjbHVzdGVycwogICAgICAgIGZvcigkaT0wOyAkaSA8ICRuYzsgKyskaSkgewoKICAgICAgICAgICAgLy8gU3RhcnQgYW5nbGUgYW5kIG51bWJlciBvZiBzbGljZXMgaW4gdGhpcyBjbHVzdGVyCiAgICAgICAgICAgICRjc2l6ZSA9ICRjbHVzdGVyc1skaV1bMV07CiAgICAgICAgICAgICRhID0gJHRoaXMtPmxhWyRjbHVzdGVyc1skaV1bMF1dOwogICAgICAgICAgICAkcSA9ICR0aGlzLT5RdWFkcmFudCgkYSk7CgogICAgICAgICAgICAvLyBOb3cgc2V0IHVwIHRoZSBzdGFydCBhbmQgZW5kIGNvbmRpdGlvbnMgdG8gbWFrZSBzdXJlIHRoYXQKICAgICAgICAgICAgLy8gaW4gZWFjaCBjbHVzdGVyIHdlIHdhbGsgdGhyb3VnaCB0aGUgYWxsIHRoZSBzbGljZXMgc3RhcnRpbmcgd2l0aCB0aGUgc2xpY2UKICAgICAgICAgICAgLy8gY2xvc2VzdCB0byB0aGUgZXF1YXRvci4gU2luY2UgYWxsIHNsaWNlcyBhcmUgbnVtYmVyZWQgY2xvY2t3aXNlIGZyb20gIjMnYSBjbG9jayIKICAgICAgICAgICAgLy8gd2UgaGF2ZSBkaWZmZXJlbnQgY29uZGl0aW9ucyBkZXBlbmRpbmcgb24gaW4gd2hpY2ggcXVhZHJhbnQgdGhlIHNsaWNlIGxpZXMgd2l0aGluLgogICAgICAgICAgICBpZiggJHEgPT0gMCApIHsKICAgICAgICAgICAgICAgICRzdGFydCA9ICRjc2l6ZS0xOyAkaWR4ID0gJHN0YXJ0OyAkc3RlcCA9IC0xOyAkdnN0ZXAgPSAtJG9yaWd2c3RlcDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICRxID09IDEgKSB7CiAgICAgICAgICAgICAgICAkc3RhcnQgPSAwOyAkaWR4ID0gJHN0YXJ0OyAkc3RlcCA9IDE7ICR2c3RlcCA9IC0kb3JpZ3ZzdGVwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHEgPT0gMiApIHsKICAgICAgICAgICAgICAgICRzdGFydCA9ICRjc2l6ZS0xOyAkaWR4ID0gJHN0YXJ0OyAkc3RlcCA9IC0xOyAkdnN0ZXAgPSAkb3JpZ3ZzdGVwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiggJHEgPT0gMyApIHsKICAgICAgICAgICAgICAgICRzdGFydCA9IDA7ICRpZHggPSAkc3RhcnQ7ICRzdGVwID0gMTsgJHZzdGVwID0gJG9yaWd2c3RlcDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gV2FsayB0aHJvdWdoIGFsbCBzbGljZXMgd2l0aGluIHRoaXMgY2x1c3RlcgogICAgICAgICAgICBmb3IoJGo9MDsgJGogPCAkY3NpemU7ICsrJGopIHsKICAgICAgICAgICAgICAgIC8vIE5vdyBhZGp1c3QgdGhlIHBvc2l0aW9uIG9mIHRoZSBsYWJlbHMgaW4gZWFjaCBjbHVzdGVyIHN0YXJ0aW5nCiAgICAgICAgICAgICAgICAvLyB3aXRoIHRoZSBzbGljZSB0aGF0IGlzIGNsb3Nlc3QgdG8gdGhlIGVxdWF0b3Igb2YgdGhlIHBpZQogICAgICAgICAgICAgICAgJGEgPSAkdGhpcy0+bGFbJGNsdXN0ZXJzWyRpXVswXSskaWR4XTsKCiAgICAgICAgICAgICAgICAvLyBHdWlkZSBsaW5lIHN0YXJ0IGluIHRoZSBjZW50ZXIgb2YgdGhlIGFyYyBvZiB0aGUgc2xpY2UKICAgICAgICAgICAgICAgICRyID0gJHJhZGl1cyskdGhpcy0+ZXhwbG9kZV9yYWRpdXNbJG4tMS0oJGNsdXN0ZXJzWyRpXVswXSskaWR4KV07CiAgICAgICAgICAgICAgICAkeCA9IHJvdW5kKCRyKmNvcygkYSkrJHhjKTsKICAgICAgICAgICAgICAgICR5ID0gcm91bmQoJHljLSRyKnNpbigkYSkpOwoKICAgICAgICAgICAgICAgIC8vIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBhcmMgZGVwZW5kcyBvbiBjaG9zZW4gZm9udCBhbmQgdGhlICJSLUZhY3RvciIKICAgICAgICAgICAgICAgICRyICs9ICRmaCokdGhpcy0+aUd1aWRlTGluZVJGYWN0b3I7CgogICAgICAgICAgICAgICAgLy8gU2hvdWxkIHRoZSBsYWJlbHMgYmUgcGxhY2VkIGN1cnZlZCBhbG9uZyB0aGUgcGllIG9yIGluIHN0cmFpZ2h0IGNvbHVtbnMKICAgICAgICAgICAgICAgIC8vIG91dHNpZGUgdGhlIHBpZT8KICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+aUd1aWRlTGluZUN1cnZlICkKICAgICAgICAgICAgICAgICR4dD1yb3VuZCgkcipjb3MoJGEpKyR4Yyk7CgogICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyB0aGUgZmlyc3Qgc2xpY2UgaW4gdGhlIGNsdXN0ZXIgd2UgbmVlZCBzb21lIGZpcnN0IHRpbWUKICAgICAgICAgICAgICAgIC8vIHByb2Vzc2luZwogICAgICAgICAgICAgICAgaWYoICRpZHggPT0gJHN0YXJ0ICkgewogICAgICAgICAgICAgICAgICAgIGlmKCAhICR0aGlzLT5pR3VpZGVMaW5lQ3VydmUgKQogICAgICAgICAgICAgICAgICAgICR4dD1yb3VuZCgkcipjb3MoJGEpKyR4Yyk7CiAgICAgICAgICAgICAgICAgICAgJHl0PXJvdW5kKCR5Yy0kcipzaW4oJGEpKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gU29tZSBzcGVjaWFsIGNvbnNpZGVyYXRpb24gaW4gY2FzZSB0aGlzIGNsdXN0ZXIgc3RhcnRzCiAgICAgICAgICAgICAgICAgICAgLy8gaW4gcXVhZHJhbnQgMSBvciAzIHZlcnkgY2xvc2UgdG8gdGhlICJlcXVhdG9yIiAoPCAyMCBkZWdyZWVzKQogICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0aGUgcHJldmlvdXMgY2x1c3RlcnMgbGFzdCBzbGljZSBpcyB3aXRoaW4gdGhlIHRvbGVyYW5jZS4KICAgICAgICAgICAgICAgICAgICAvLyBJbiB0aGF0IGNhc2Ugd2UgYWRkIGEgZm9udCBoZWlnaHQgdG8gdGhpcyBsYWJlbHMgWS1wb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIC8vIHNvIGl0IGRvZXNuJ3QgY29sbGlkZSB3aXRoCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHNsaWNlIGluIHRoZSBwcmV2aW91cyBjbHVzdGVyCiAgICAgICAgICAgICAgICAgICAgJHByZXZjbHVzdGVyID0gKCRpICsgKCRuYy0xKSApICUgJG5jOwogICAgICAgICAgICAgICAgICAgICRwcmV2aWR4PSRjbHVzdGVyc1skcHJldmNsdXN0ZXJdWzBdKyRjbHVzdGVyc1skcHJldmNsdXN0ZXJdWzFdLTE7CiAgICAgICAgICAgICAgICAgICAgaWYoICRxID09IDEgJiYgJGEgPiAxNjAqTV9QSS8xODAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgYW5nbGUgZm9yIHRoZSBwcmV2aW91cyBjbHVzdGVycyBsYXN0IHNsaWNlCiAgICAgICAgICAgICAgICAgICAgICAgICRkaWZmID0gYWJzKCRhLSR0aGlzLT5sYVskcHJldmlkeF0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiggJGRpZmYgPCAkdHJlc2hfaG9sZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR5dCAtPSAkZmg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZWlmKCAkcSA9PSAzICYmICRhID4gMzQwKk1fUEkvMTgwICkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHN1YnRyYWN0IDM2MCB0byBjb21wYXJlIGFuZ2xlIGRpc3RhbmNlIGJldHdlZW4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gcT0wIGFuZCBxPTMKICAgICAgICAgICAgICAgICAgICAgICAgJGRpZmYgPSBhYnMoJGEtJHRoaXMtPmxhWyRwcmV2aWR4XS0zNjAqTV9QSS8xODApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiggJGRpZmYgPCAkdHJlc2hfaG9sZCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR5dCArPSAkZmg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHN0ZXAgaXMgYXQgbWluaW11bSAkdnN0ZXAgYnV0IGlmIHRoZSBzbGljZXMgYXJlIHJlbGF0aXZlbHkgbGFyZ2UKICAgICAgICAgICAgICAgICAgICAvLyB3ZSBtYWtlIHN1cmUgdGhhdCB3ZSBhZGQgYXQgbGVhc3QgYSBzdGVwIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIHZlcnRpY2FsCiAgICAgICAgICAgICAgICAgICAgLy8gZGlzdGFuY2UgYmV0d2VlbiB0aGUgY2VudGVycyBhdCB0aGUgYXJjIG9uIHRoZSBzbGljZQogICAgICAgICAgICAgICAgICAgICRwcmV2X2EgPSAkdGhpcy0+bGFbJGNsdXN0ZXJzWyRpXVswXSsoJGlkeC0kc3RlcCldOwogICAgICAgICAgICAgICAgICAgICRkeSA9IGFicygkcmFkaXVzKihzaW4oJGEpLXNpbigkcHJldl9hKSkqMS4yKTsKICAgICAgICAgICAgICAgICAgICBpZiggJHZzdGVwID4gMCApCiAgICAgICAgICAgICAgICAgICAgJHl0ICs9IG1heCgkdnN0ZXAsJGR5KTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgJHl0ICs9IG1pbigkdnN0ZXAsLSRkeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGxhYmVsID0gJHRoaXMtPmxhYmVsc1skY2x1c3RlcnNbJGldWzBdKyRpZHhdOwoKICAgICAgICAgICAgICAgIGlmKCAkY3NpemUgPT0gMSApIHsKICAgICAgICAgICAgICAgICAgICAvLyBBICJtZXRhIiBjbHVzdGVyIHdpdGggb25seSBvbmUgc2xpY2UKICAgICAgICAgICAgICAgICAgICAkciA9ICRyYWRpdXMrJHRoaXMtPmV4cGxvZGVfcmFkaXVzWyRuLTEtKCRjbHVzdGVyc1skaV1bMF0rJGlkeCldOwogICAgICAgICAgICAgICAgICAgICRyciA9ICRyKyRpbWctPkdldEZvbnRIZWlnaHQoKS8yOwogICAgICAgICAgICAgICAgICAgICR4dD1yb3VuZCgkcnIqY29zKCRhKSskeGMpOwogICAgICAgICAgICAgICAgICAgICR5dD1yb3VuZCgkeWMtJHJyKnNpbigkYSkpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TdHJva2VMYWJlbCgkbGFiZWwsJGltZywkeGMsJHljLCRhLCRyKTsKICAgICAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmlTaG93R3VpZGVMaW5lRm9yU2luZ2xlICkKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Z3VpZGVsaW5lLT5TdHJva2UoJGltZywkeCwkeSwkeHQsJHl0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5ndWlkZWxpbmUtPlN0cm9rZSgkaW1nLCR4LCR5LCR4dCwkeXQpOwogICAgICAgICAgICAgICAgICAgIGlmKCAkcT09MSB8fCAkcT09MiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGVmdCBzaWRlIG9mIFBpZQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Z3VpZGVsaW5lLT5TdHJva2UoJGltZywkeHQsJHl0LCR4dC0kdGhpcy0+Z3VpZGVsaW5lbWFyZ2luLCR5dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRsYmxhZGogPSAtJHRoaXMtPmd1aWRlbGluZW1hcmdpbi01OwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPmhhbGlnbiA9ICJyaWdodCI7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+dmFsaWduID0gImNlbnRlciI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBSaWdodCBzaWRlIG9mIHBpZQogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Z3VpZGVsaW5lLT5TdHJva2UoJGltZywkeHQsJHl0LCR4dCskdGhpcy0+Z3VpZGVsaW5lbWFyZ2luLCR5dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRsYmxhZGogPSAkdGhpcy0+Z3VpZGVsaW5lbWFyZ2luKzU7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+aGFsaWduID0gImxlZnQiOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPnZhbGlnbiA9ICJjZW50ZXIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+dmFsdWUtPlN0cm9rZSgkaW1nLCRsYWJlbCwkeHQrJGxibGFkaiwkeXQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFVkYXRlIGlkeCB0byBwb2ludCB0byBuZXh0IHNsaWNlIGluIHRoZSBjbHVzdGVyIHRvIHByb2Nlc3MKICAgICAgICAgICAgICAgICRpZHggKz0gJHN0ZXA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlQWxsTGFiZWxzKCRpbWcsJHhjLCR5YywkcmFkaXVzKSB7CiAgICAgICAgLy8gRmlyc3Qgbm9ybWFsaXplIGFsbCBhbmdsZXMgZm9yIGxhYmVscwogICAgICAgICRuID0gY291bnQoJHRoaXMtPmxhKTsKICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSkgewogICAgICAgICAgICAkdGhpcy0+bGFbJGldID0gJHRoaXMtPk5vcm1BbmdsZSgkdGhpcy0+bGFbJGldKTsKICAgICAgICB9CiAgICAgICAgaWYoICR0aGlzLT5ndWlkZWxpbmUtPmlTaG93ICkgewogICAgICAgICAgICAkdGhpcy0+U3Ryb2tlR3VpZGVMYWJlbHMoJGltZywkeGMsJHljLCRyYWRpdXMpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+bGFiZWxzKTsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG47ICsrJGkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5TdHJva2VMYWJlbCgkdGhpcy0+bGFiZWxzWyRpXSwkaW1nLCR4YywkeWMsCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFbJGldLAogICAgICAgICAgICAgICAgJHJhZGl1cyArICR0aGlzLT5leHBsb2RlX3JhZGl1c1skbi0xLSRpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gUG9zaXRpb24gdGhlIGxhYmVscyBvZiBlYWNoIHNsaWNlCiAgICBmdW5jdGlvbiBTdHJva2VMYWJlbCgkbGFiZWwsJGltZywkeGMsJHljLCRhLCRyKSB7CgogICAgICAgIC8vIERlZmF1bHQgdmFsdWUKICAgICAgICBpZiggJHRoaXMtPmlsYWJlbHBvc2FkaiA9PT0gJ2F1dG8nICkKICAgICAgICAkdGhpcy0+aWxhYmVscG9zYWRqID0gMC42NTsKCiAgICAgICAgLy8gV2UgcG9zaXRpb24gdGhlIHZhbHVlcyBkaWZlcmVudGx5IGRlcGVuZGluZyBvbiBpZiB0aGV5IGFyZSBpbnNpZGUKICAgICAgICAvLyBvciBvdXRzaWRlIHRoZSBwaWUKICAgICAgICBpZiggJHRoaXMtPmlsYWJlbHBvc2FkaiA8IDEuMCApIHsKCiAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U2V0QWxpZ24oJ2NlbnRlcicsJ2NlbnRlcicpOwogICAgICAgICAgICAkdGhpcy0+dmFsdWUtPm1hcmdpbiA9IDA7CgogICAgICAgICAgICAkeHQ9cm91bmQoJHRoaXMtPmlsYWJlbHBvc2Fkaiokcipjb3MoJGEpKyR4Yyk7CiAgICAgICAgICAgICR5dD1yb3VuZCgkeWMtJHRoaXMtPmlsYWJlbHBvc2FkaiokcipzaW4oJGEpKTsKCiAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+U3Ryb2tlKCRpbWcsJGxhYmVsLCR4dCwkeXQpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICR0aGlzLT52YWx1ZS0+aGFsaWduID0gImxlZnQiOwogICAgICAgICAgICAkdGhpcy0+dmFsdWUtPnZhbGlnbiA9ICJ0b3AiOwogICAgICAgICAgICAkdGhpcy0+dmFsdWUtPm1hcmdpbiA9IDA7CgogICAgICAgICAgICAvLyBQb3NpdGlvbiB0aGUgYXhpcyB0aXRsZS4KICAgICAgICAgICAgLy8gZHgsIGR5IGlzIHRoZSBvZmZzZXQgZnJvbSB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSBib3VuZGluZyBib3ggdGhhdCBzb3Jyb3VuZHMgdGhlIHRleHQKICAgICAgICAgICAgLy8gdGhhdCBpbnRlcnNlY3RzIHdpdGggdGhlIGV4dGVuc2lvbiBvZiB0aGUgY29ycmVzcG9uZGluZyBheGlzLiBUaGUgY29kZSBsb29rcyBhIGxpdHRsZQogICAgICAgICAgICAvLyBiaXQgbWVzc3kgYnV0IHRoaXMgaXMgcmVhbGx5IHRoZSBvbmx5IHdheSBvZiBoYXZpbmcgYSByZWFzb25hYmxlIHBvc2l0aW9uIG9mIHRoZQogICAgICAgICAgICAvLyBheGlzIHRpdGxlcy4KICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5BcHBseUZvbnQoJGltZyk7CiAgICAgICAgICAgICRoPSRpbWctPkdldFRleHRIZWlnaHQoJGxhYmVsKTsKICAgICAgICAgICAgLy8gRm9yIG51bWVyaWMgdmFsdWVzIHRoZSBmb3JtYXQgb2YgdGhlIGRpc3BsYXkgdmFsdWUKICAgICAgICAgICAgLy8gbXVzdCBiZSB0YWtlbiBpbnRvIGFjY291bnQKICAgICAgICAgICAgaWYoIGlzX251bWVyaWMoJGxhYmVsKSApIHsKICAgICAgICAgICAgICAgIGlmKCAkbGFiZWwgPiAwICkKICAgICAgICAgICAgICAgICR3PSRpbWctPkdldFRleHRXaWR0aChzcHJpbnRmKCR0aGlzLT52YWx1ZS0+Zm9ybWF0LCRsYWJlbCkpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgJHc9JGltZy0+R2V0VGV4dFdpZHRoKHNwcmludGYoJHRoaXMtPnZhbHVlLT5uZWdmb3JtYXQsJGxhYmVsKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAkdz0kaW1nLT5HZXRUZXh0V2lkdGgoJGxhYmVsKTsKCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aWxhYmVscG9zYWRqID4gMS4wICYmICR0aGlzLT5pbGFiZWxwb3NhZGogPCA1LjApIHsKICAgICAgICAgICAgICAgICRyICo9ICR0aGlzLT5pbGFiZWxwb3NhZGo7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRyICs9ICRpbWctPkdldEZvbnRIZWlnaHQoKS8xLjU7CgogICAgICAgICAgICAkeHQ9cm91bmQoJHIqY29zKCRhKSskeGMpOwogICAgICAgICAgICAkeXQ9cm91bmQoJHljLSRyKnNpbigkYSkpOwoKICAgICAgICAgICAgLy8gTm9ybWFsaXplIGFuZ2xlCiAgICAgICAgICAgIHdoaWxlKCAkYSA8IDAgKSAkYSArPSAyKk1fUEk7CiAgICAgICAgICAgIHdoaWxlKCAkYSA+IDIqTV9QSSApICRhIC09IDIqTV9QSTsKCiAgICAgICAgICAgIGlmKCAkYT49NypNX1BJLzQgfHwgJGEgPD0gTV9QSS80ICkgJGR4PTA7CiAgICAgICAgICAgIGlmKCAkYT49TV9QSS80ICYmICRhIDw9IDMqTV9QSS80ICkgJGR4PSgkYS1NX1BJLzQpKjIvTV9QSTsKICAgICAgICAgICAgaWYoICRhPj0zKk1fUEkvNCAmJiAkYSA8PSA1Kk1fUEkvNCApICRkeD0xOwogICAgICAgICAgICBpZiggJGE+PTUqTV9QSS80ICYmICRhIDw9IDcqTV9QSS80ICkgJGR4PSgxLSgkYS1NX1BJKjUvNCkqMi9NX1BJKTsKCiAgICAgICAgICAgIGlmKCAkYT49NypNX1BJLzQgKSAkZHk9KCgkYS1NX1BJKS0zKk1fUEkvNCkqMi9NX1BJOwogICAgICAgICAgICBpZiggJGE8PU1fUEkvNCApICRkeT0oMS0kYSoyL01fUEkpOwogICAgICAgICAgICBpZiggJGE+PU1fUEkvNCAmJiAkYSA8PSAzKk1fUEkvNCApICRkeT0xOwogICAgICAgICAgICBpZiggJGE+PTMqTV9QSS80ICYmICRhIDw9IDUqTV9QSS80ICkgJGR5PSgxLSgkYS0zKk1fUEkvNCkqMi9NX1BJKTsKICAgICAgICAgICAgaWYoICRhPj01Kk1fUEkvNCAmJiAkYSA8PSA3Kk1fUEkvNCApICRkeT0wOwoKICAgICAgICAgICAgJHRoaXMtPnZhbHVlLT5TdHJva2UoJGltZywkbGFiZWwsJHh0LSRkeCokdywkeXQtJGR5KiRoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gVXNlUGxvdFRoZW1lQ29sb3JzKCRmbGFnID0gdHJ1ZSkgewogICAgICAgICR0aGlzLT51c2VfcGxvdF90aGVtZV9jb2xvcnMgPSAkZmxhZzsKICAgIH0KfSAvLyBDbGFzcwoKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIFBpZVBsb3RDCi8vIERlc2NyaXB0aW9uOiBTYW1lIGFzIGEgbm9ybWFsIHBpZSBwbG90IGJ1dCB3aXRoIGEKLy8gZmlsbGVkIGNpcmNsZSBpbiB0aGUgY2VudGVyCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIFBpZVBsb3RDIGV4dGVuZHMgUGllUGxvdCB7CiAgICBwcml2YXRlICRpbWlkc2l6ZT0wLjU7ICAvLyBGcmFjdGlvbiBvZiB0b3RhbCB3aWR0aAogICAgcHJpdmF0ZSAkaW1pZGNvbG9yPSd3aGl0ZSc7CiAgICBwdWJsaWMgJG1pZHRpdGxlPScnOwogICAgcHJpdmF0ZSAkbWlkZGxlY3NpbXRhcmdldD0nJywkbWlkZGxlY3NpbXdpbnRhcmdldD0nJywkbWlkZGxlY3NpbWFsdD0nJzsKCiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkZGF0YSwkYUNlbnRlclRpdGxlPScnKSB7CiAgICAgICAgcGFyZW50OjpfX2NvbnN0cnVjdCgkZGF0YSk7CiAgICAgICAgJHRoaXMtPm1pZHRpdGxlID0gbmV3IFRleHQoKTsKICAgICAgICAkdGhpcy0+bWlkdGl0bGUtPlBhcmFncmFwaEFsaWduKCdjZW50ZXInKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRNaWQoJGFUaXRsZSwkYUNvbG9yPSd3aGl0ZScsJGFTaXplPTAuNSkgewogICAgICAgICR0aGlzLT5taWR0aXRsZS0+U2V0KCRhVGl0bGUpOwoKICAgICAgICAkdGhpcy0+aW1pZHNpemUgPSAkYVNpemUgOwogICAgICAgICR0aGlzLT5pbWlkY29sb3IgPSAkYUNvbG9yIDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRNaWRUaXRsZSgkYVRpdGxlKSB7CiAgICAgICAgJHRoaXMtPm1pZHRpdGxlLT5TZXQoJGFUaXRsZSk7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TWlkU2l6ZSgkYVNpemUpIHsKICAgICAgICAkdGhpcy0+aW1pZHNpemUgPSAkYVNpemUgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldE1pZENvbG9yKCRhQ29sb3IpIHsKICAgICAgICAkdGhpcy0+aW1pZGNvbG9yID0gJGFDb2xvciA7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TWlkQ1NJTSgkYVRhcmdldCwkYUFsdD0nJywkYVdpblRhcmdldD0nJykgewogICAgICAgICR0aGlzLT5taWRkbGVjc2ltdGFyZ2V0ID0gJGFUYXJnZXQ7CiAgICAgICAgJHRoaXMtPm1pZGRsZWNzaW13aW50YXJnZXQgPSAkYVdpblRhcmdldDsKICAgICAgICAkdGhpcy0+bWlkZGxlY3NpbWFsdCA9ICRhQWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIEFkZFNsaWNlVG9DU0lNKCRpLCR4YywkeWMsJHJhZGl1cywkc2EsJGVhKSB7CiAgICAgICAgLy9TbGljZSBudW1iZXIsIGVsbGlwc2UgY2VudHJlICh4LHkpLCByYWRpdXMsIHN0YXJ0IGFuZ2xlLCBlbmQgYW5nbGUKICAgICAgICB3aGlsZSggJHNhID4gMipNX1BJICkgJHNhID0gJHNhIC0gMipNX1BJOwogICAgICAgIHdoaWxlKCAkZWEgPiAyKk1fUEkgKSAkZWEgPSAkZWEgLSAyKk1fUEk7CgogICAgICAgICRzYSA9IDIqTV9QSSAtICRzYTsKICAgICAgICAkZWEgPSAyKk1fUEkgLSAkZWE7CgogICAgICAgIC8vIFNwZWNpYWwgY2FzZSB3aGVuIHdlIGhhdmUgb25seSBvbmUgc2xpY2Ugc2luY2UgdGhlbiBib3RoIHN0YXJ0IGFuZCBlbmQKICAgICAgICAvLyBhbmdsZSB3aWxsIGJlID09IDAKICAgICAgICBpZiggYWJzKCRzYSAtICRlYSkgPCAwLjAwMDEgKSB7CiAgICAgICAgICAgICRzYT0yKk1fUEk7ICRlYT0wOwogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIGlubmVyIGNpcmNsZSBmaXJzdCBwb2ludAogICAgICAgICR4cCA9IGZsb29yKCgkdGhpcy0+aW1pZHNpemUqJHJhZGl1cypjb3MoJGVhKSkrJHhjKTsKICAgICAgICAkeXAgPSBmbG9vcigkeWMtKCR0aGlzLT5pbWlkc2l6ZSokcmFkaXVzKnNpbigkZWEpKSk7CiAgICAgICAgJGNvb3JkcyA9ICIkeHAsICR5cCI7CgogICAgICAgIC8vYWRkIGNvb3JkaW5hdGVzIGV2ZXJ5IDAuMjUgcmFkaWFucwogICAgICAgICRhPSRlYSswLjI1OwoKICAgICAgICAvLyBJZiB3ZSBjcm9zcyB0aGUgMzYwLWxpbWl0IHdpdGggYSBzbGljZSB3ZSBuZWVkIHRvIGhhbmRsZQogICAgICAgIC8vIHRoZSBmYWN0IHRoYXQgZW5kIGFuZ2xlIGlzIHNtYWxsZXIgdGhhbiBzdGFydAogICAgICAgIGlmKCAkc2EgPCAkZWEgKSB7CiAgICAgICAgICAgIHdoaWxlICgkYSA8PSAyKk1fUEkpIHsKICAgICAgICAgICAgICAgICR4cCA9IGZsb29yKCRyYWRpdXMqY29zKCRhKSskeGMpOwogICAgICAgICAgICAgICAgJHlwID0gZmxvb3IoJHljLSRyYWRpdXMqc2luKCRhKSk7CiAgICAgICAgICAgICAgICAkY29vcmRzLj0gIiwgJHhwLCAkeXAiOwogICAgICAgICAgICAgICAgJGEgKz0gMC4yNTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkYSAtPSAyKk1fUEk7CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAoJGEgPCAkc2EpIHsKICAgICAgICAgICAgJHhwID0gZmxvb3IoKCR0aGlzLT5pbWlkc2l6ZSokcmFkaXVzKmNvcygkYSkrJHhjKSk7CiAgICAgICAgICAgICR5cCA9IGZsb29yKCR5Yy0oJHRoaXMtPmltaWRzaXplKiRyYWRpdXMqc2luKCRhKSkpOwogICAgICAgICAgICAkY29vcmRzLj0gIiwgJHhwLCAkeXAiOwogICAgICAgICAgICAkYSArPSAwLjI1OwogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGVuZCBhdCB0aGUgbGFzdCBwb2ludAogICAgICAgICR4cCA9IGZsb29yKCgkdGhpcy0+aW1pZHNpemUqJHJhZGl1cypjb3MoJHNhKSskeGMpKTsKICAgICAgICAkeXAgPSBmbG9vcigkeWMtKCR0aGlzLT5pbWlkc2l6ZSokcmFkaXVzKnNpbigkc2EpKSk7CiAgICAgICAgJGNvb3Jkcy49ICIsICR4cCwgJHlwIjsKCiAgICAgICAgLy8gU3RyYWlnaHQgbGluZSB0byBvdXRlciBjaXJjbGUKICAgICAgICAkeHAgPSBmbG9vcigkcmFkaXVzKmNvcygkc2EpKyR4Yyk7CiAgICAgICAgJHlwID0gZmxvb3IoJHljLSRyYWRpdXMqc2luKCRzYSkpOwogICAgICAgICRjb29yZHMuPSAiLCAkeHAsICR5cCI7CgogICAgICAgIC8vYWRkIGNvb3JkaW5hdGVzIGV2ZXJ5IDAuMjUgcmFkaWFucwogICAgICAgICRhPSRzYSAtIDAuMjU7CiAgICAgICAgd2hpbGUgKCRhID4gJGVhKSB7CiAgICAgICAgICAgICR4cCA9IGZsb29yKCRyYWRpdXMqY29zKCRhKSskeGMpOwogICAgICAgICAgICAkeXAgPSBmbG9vcigkeWMtJHJhZGl1cypzaW4oJGEpKTsKICAgICAgICAgICAgJGNvb3Jkcy49ICIsICR4cCwgJHlwIjsKICAgICAgICAgICAgJGEgLT0gMC4yNTsKICAgICAgICB9CgogICAgICAgIC8vQWRkIHRoZSBsYXN0IHBvaW50IG9uIHRoZSBhcmMKICAgICAgICAkeHAgPSBmbG9vcigkcmFkaXVzKmNvcygkZWEpKyR4Yyk7CiAgICAgICAgJHlwID0gZmxvb3IoJHljLSRyYWRpdXMqc2luKCRlYSkpOwogICAgICAgICRjb29yZHMuPSAiLCAkeHAsICR5cCI7CgogICAgICAgIC8vIENsb3NlIHRoZSBhcmMKICAgICAgICAkeHAgPSBmbG9vcigoJHRoaXMtPmltaWRzaXplKiRyYWRpdXMqY29zKCRlYSkpKyR4Yyk7CiAgICAgICAgJHlwID0gZmxvb3IoJHljLSgkdGhpcy0+aW1pZHNpemUqJHJhZGl1cypzaW4oJGVhKSkpOwogICAgICAgICRjb29yZHMgLj0gIiwgJHhwLCAkeXAiOwoKICAgICAgICBpZiggIWVtcHR5KCR0aGlzLT5jc2ltdGFyZ2V0c1skaV0pICkgewogICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICI8YXJlYSBzaGFwZT1cInBvbHlcIiBjb29yZHM9XCIkY29vcmRzXCIgaHJlZj1cIiIuCiAgICAgICAgICAgICR0aGlzLT5jc2ltdGFyZ2V0c1skaV0uIlwiIjsKICAgICAgICAgICAgaWYoICFlbXB0eSgkdGhpcy0+Y3NpbXdpbnRhcmdldHNbJGldKSApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5jc2ltYXJlYXMgLj0gIiB0YXJnZXQ9XCIiLiR0aGlzLT5jc2ltd2ludGFyZ2V0c1skaV0uIlwiICI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoICFlbXB0eSgkdGhpcy0+Y3NpbWFsdHNbJGldKSApIHsKICAgICAgICAgICAgICAgICR0bXA9c3ByaW50ZigkdGhpcy0+Y3NpbWFsdHNbJGldLCR0aGlzLT5kYXRhWyRpXSk7CiAgICAgICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICIgdGl0bGU9XCIkdG1wXCIgIGFsdD1cIiR0bXBcIiAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5jc2ltYXJlYXMgLj0gIiAvPlxuIjsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIFN0cm9rZSgkaW1nLCRhYW9wdGlvbj0wKSB7CgogICAgICAgIC8vIFN0cm9rZSB0aGUgcGllIGJ1dCBkb24ndCBzdHJva2UgdmFsdWVzCiAgICAgICAgJHRtcCA9ICAkdGhpcy0+dmFsdWUtPnNob3c7CiAgICAgICAgJHRoaXMtPnZhbHVlLT5zaG93ID0gZmFsc2U7CiAgICAgICAgcGFyZW50OjpTdHJva2UoJGltZywkYWFvcHRpb24pOwogICAgICAgICR0aGlzLT52YWx1ZS0+c2hvdyA9ICR0bXA7CgogICAgICAgICR4YyA9IHJvdW5kKCR0aGlzLT5wb3N4KiRpbWctPndpZHRoKTsKICAgICAgICAkeWMgPSByb3VuZCgkdGhpcy0+cG9zeSokaW1nLT5oZWlnaHQpOwoKICAgICAgICAkcmFkaXVzID0gZmxvb3IoJHRoaXMtPnJhZGl1cyAqIG1pbigkaW1nLT53aWR0aCwkaW1nLT5oZWlnaHQpKSA7CgoKICAgICAgICBpZiggJHRoaXMtPmltaWRzaXplID4gMCAmJiAkYWFvcHRpb24gIT09IDIgKSB7CgogICAgICAgICAgICBpZiggJHRoaXMtPmlzaGFkb3djb2xvciAhPSAiIiApIHsKICAgICAgICAgICAgICAgICRpbWctPlNldENvbG9yKCR0aGlzLT5pc2hhZG93Y29sb3IpOwogICAgICAgICAgICAgICAgJGltZy0+RmlsbGVkQ2lyY2xlKCR4YyskdGhpcy0+aXNoYWRvd2Ryb3AsJHljKyR0aGlzLT5pc2hhZG93ZHJvcCwKICAgICAgICAgICAgICAgIHJvdW5kKCRyYWRpdXMqJHRoaXMtPmltaWRzaXplKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRpbWctPlNldENvbG9yKCR0aGlzLT5pbWlkY29sb3IpOwogICAgICAgICAgICAkaW1nLT5GaWxsZWRDaXJjbGUoJHhjLCR5Yyxyb3VuZCgkcmFkaXVzKiR0aGlzLT5pbWlkc2l6ZSkpOwoKICAgICAgICAgICAgaWYoICAkdGhpcy0+cGllX2JvcmRlciAmJiAkYWFvcHRpb24gPT09IDAgKSB7CiAgICAgICAgICAgICAgICAkaW1nLT5TZXRDb2xvcigkdGhpcy0+Y29sb3IpOwogICAgICAgICAgICAgICAgJGltZy0+Q2lyY2xlKCR4YywkeWMscm91bmQoJHJhZGl1cyokdGhpcy0+aW1pZHNpemUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoICFlbXB0eSgkdGhpcy0+bWlkZGxlY3NpbXRhcmdldCkgKQogICAgICAgICAgICAkdGhpcy0+QWRkTWlkZGxlQ1NJTSgkeGMsJHljLHJvdW5kKCRyYWRpdXMqJHRoaXMtPmltaWRzaXplKSk7CgogICAgICAgIH0KCiAgICAgICAgaWYoICR0aGlzLT52YWx1ZS0+c2hvdyAmJiAkYWFvcHRpb24gIT09IDEpIHsKICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUFsbExhYmVscygkaW1nLCR4YywkeWMsJHJhZGl1cyk7CiAgICAgICAgICAgICR0aGlzLT5taWR0aXRsZS0+U2V0UG9zKCR4YywkeWMsJ2NlbnRlcicsJ2NlbnRlcicpOwogICAgICAgICAgICAkdGhpcy0+bWlkdGl0bGUtPlN0cm9rZSgkaW1nKTsKICAgICAgICB9CgogICAgfQoKICAgIGZ1bmN0aW9uIEFkZE1pZGRsZUNTSU0oJHhjLCR5YywkcikgewogICAgICAgICR4Yz1yb3VuZCgkeGMpOyR5Yz1yb3VuZCgkeWMpOyRyPXJvdW5kKCRyKTsKICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICI8YXJlYSBzaGFwZT1cImNpcmNsZVwiIGNvb3Jkcz1cIiR4YywkeWMsJHJcIiBocmVmPVwiIi4KICAgICAgICAkdGhpcy0+bWlkZGxlY3NpbXRhcmdldC4iXCIiOwogICAgICAgIGlmKCAhZW1wdHkoJHRoaXMtPm1pZGRsZWNzaW13aW50YXJnZXQpICkgewogICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICIgdGFyZ2V0PVwiIi4kdGhpcy0+bWlkZGxlY3NpbXdpbnRhcmdldC4iXCIiOwogICAgICAgIH0KICAgICAgICBpZiggIWVtcHR5KCR0aGlzLT5taWRkbGVjc2ltYWx0KSApIHsKICAgICAgICAgICAgJHRtcCA9ICR0aGlzLT5taWRkbGVjc2ltYWx0OwogICAgICAgICAgICAkdGhpcy0+Y3NpbWFyZWFzIC49ICIgdGl0bGU9XCIkdG1wXCIgYWx0PVwiJHRtcFwiICI7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5jc2ltYXJlYXMgLj0gIiAvPlxuIjsKICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2VMYWJlbCgkbGFiZWwsJGltZywkeGMsJHljLCRhLCRyKSB7CgogICAgICAgIGlmKCAkdGhpcy0+aWxhYmVscG9zYWRqID09PSAnYXV0bycgKQogICAgICAgICR0aGlzLT5pbGFiZWxwb3NhZGogPSAoMS0kdGhpcy0+aW1pZHNpemUpLzIrJHRoaXMtPmltaWRzaXplOwoKICAgICAgICBwYXJlbnQ6OlN0cm9rZUxhYmVsKCRsYWJlbCwkaW1nLCR4YywkeWMsJGEsJHIpOwoKICAgIH0KCn0KCgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBQaWVHcmFwaAovLyBEZXNjcmlwdGlvbjoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgUGllR3JhcGggZXh0ZW5kcyBHcmFwaCB7CiAgICBwcml2YXRlICRwb3N4LCAkcG9zeSwgJHJhZGl1czsKICAgIHByaXZhdGUgJGxlZ2VuZHM9YXJyYXkoKTsKICAgIHB1YmxpYyAkcGxvdHM9YXJyYXkoKTsKICAgIHB1YmxpYyAkcGllYWEgPSBmYWxzZSA7CiAgICAvLy0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ09OU1RSVUNUT1IKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCR3aWR0aD0zMDAsJGhlaWdodD0yMDAsJGNhY2hlZE5hbWU9IiIsJHRpbWVvdXQ9MCwkaW5saW5lPTEpIHsKICAgICAgICBwYXJlbnQ6Ol9fY29uc3RydWN0KCR3aWR0aCwkaGVpZ2h0LCRjYWNoZWROYW1lLCR0aW1lb3V0LCRpbmxpbmUpOwogICAgICAgICR0aGlzLT5wb3N4PSR3aWR0aC8yOwogICAgICAgICR0aGlzLT5wb3N5PSRoZWlnaHQvMjsKICAgICAgICAkdGhpcy0+U2V0Q29sb3IoYXJyYXkoMjU1LDI1NSwyNTUpKTsKCiAgICAgICAgaWYgKCR0aGlzLT5ncmFwaF90aGVtZSkgewogICAgICAgICAgJHRoaXMtPmdyYXBoX3RoZW1lLT5BcHBseUdyYXBoKCR0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICBmdW5jdGlvbiBBZGQoJGFPYmopIHsKCiAgICAgICAgaWYoIGlzX2FycmF5KCRhT2JqKSAmJiBjb3VudCgkYU9iaikgPiAwICkKICAgICAgICAkY2wgPSAkYU9ialswXTsKICAgICAgICBlbHNlCiAgICAgICAgJGNsID0gJGFPYmo7CgogICAgICAgIGlmKCAkY2wgaW5zdGFuY2VvZiBUZXh0ICkKICAgICAgICAkdGhpcy0+QWRkVGV4dCgkYU9iaik7CiAgICAgICAgZWxzZWlmKCBjbGFzc19leGlzdHMoJ0ljb25QbG90JyxmYWxzZSkgJiYgKCRjbCBpbnN0YW5jZW9mIEljb25QbG90KSApCiAgICAgICAgJHRoaXMtPkFkZEljb24oJGFPYmopOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiggaXNfYXJyYXkoJGFPYmopICkgewogICAgICAgICAgICAgICAgJG4gPSBjb3VudCgkYU9iaik7CiAgICAgICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSApIHsKICAgICAgICAgICAgICAgICAgICAvL2lmICgkYU9ialskaV0tPnRoZW1lKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgJHRoaXMtPkNsZWFyVGhlbWUoKTsKICAgICAgICAgICAgICAgICAgICAvL30KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbXSA9ICRhT2JqWyRpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vaWYgKCRhT2JqLT50aGVtZSkgewogICAgICAgICAgICAgICAgLy8gICAgJHRoaXMtPkNsZWFyVGhlbWUoKTsKICAgICAgICAgICAgICAgIC8vfQogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzW10gPSAkYU9iajsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5ncmFwaF90aGVtZSkgewogICAgICAgICAgICAkdGhpcy0+Z3JhcGhfdGhlbWUtPlNldHVwUGxvdCgkYU9iaik7CiAgICAgICAgICAgIGlmICgkYU9iai0+aXNfdXNpbmdfcGxvdF90aGVtZSkgewogICAgICAgICAgICAgICAgJGFPYmotPlVzZVBsb3RUaGVtZUNvbG9ycygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEFudGlBbGlhc2luZygkYUZsZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPnBpZWFhID0gJGFGbGc7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Q29sb3IoJGMpIHsKICAgICAgICAkdGhpcy0+U2V0TWFyZ2luQ29sb3IoJGMpOwogICAgfQoKCiAgICBmdW5jdGlvbiBEaXNwbGF5Q1NJTUFyZWFzKCkgewogICAgICAgICRjc2ltPSIiOwogICAgICAgIGZvcmVhY2goJHRoaXMtPnBsb3RzIGFzICRwICkgewogICAgICAgICAgICAkY3NpbSAuPSAkcC0+R2V0Q1NJTWFyZWFzKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICRjc2ltLj0gJHRoaXMtPmxlZ2VuZC0+R2V0Q1NJTWFyZWFzKCk7CiAgICAgICAgaWYgKHByZWdfbWF0Y2hfYWxsKCIvYXJlYSBzaGFwZT1cIihcdyspXCIgY29vcmRzPVwiKFswLTlcLCBdKylcIi8iLCAkY3NpbSwgJGNvb3JkcykpIHsKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Q29sb3IoJHRoaXMtPmNzaW1jb2xvcik7CiAgICAgICAgICAgICRuID0gY291bnQoJGNvb3Jkc1swXSk7CiAgICAgICAgICAgIGZvciAoJGk9MDsgJGkgPCAkbjsgJGkrKykgewogICAgICAgICAgICAgICAgaWYgKCRjb29yZHNbMV1bJGldPT0icG9seSIpIHsKICAgICAgICAgICAgICAgICAgICBwcmVnX21hdGNoX2FsbCgnL1xzKihbMC05XSspXHMqLFxzKihbMC05XSspXHMqLCovJywkY29vcmRzWzJdWyRpXSwkcHRzKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5TZXRTdGFydFBvaW50KCRwdHNbMV1bY291bnQoJHB0c1swXSktMV0sJHB0c1syXVtjb3VudCgkcHRzWzBdKS0xXSk7CiAgICAgICAgICAgICAgICAgICAgJG0gPSBjb3VudCgkcHRzWzBdKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKCRqPTA7ICRqIDwgJG07ICRqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmltZy0+TGluZVRvKCRwdHNbMV1bJGpdLCRwdHNbMl1bJGpdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRjb29yZHNbMV1bJGldPT0icmVjdCIpIHsKICAgICAgICAgICAgICAgICAgICAkcHRzID0gcHJlZ19zcGxpdCgnLywvJywgJGNvb3Jkc1syXVskaV0pOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5pbWctPlNldFN0YXJ0UG9pbnQoJHB0c1swXSwkcHRzWzFdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1syXSwkcHRzWzFdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1syXSwkcHRzWzNdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1swXSwkcHRzWzNdKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5MaW5lVG8oJHB0c1swXSwkcHRzWzFdKTsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gTWV0aG9kIGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBTdHJva2UoJGFTdHJva2VGaWxlTmFtZT0iIikgewoKICAgICAgICAvLyBJZiB0aGUgZmlsZW5hbWUgaXMgdGhlIHByZWRlZmluZWQgdmFsdWUgPSAnX2NzaW1fc3BlY2lhbF8nCiAgICAgICAgLy8gd2UgYXNzdW1lIHRoYXQgdGhlIGNhbGwgdG8gc3Ryb2tlIG9ubHkgbmVlZHMgdG8gZG8gZW5vdWdoCiAgICAgICAgLy8gdG8gY29ycmVjdGx5IGdlbmVyYXRlIHRoZSBDU0lNIG1hcHMuCiAgICAgICAgLy8gV2UgdXNlIHRoaXMgdmFyaWFibGUgdG8gc2tpcCB0aGluZ3Mgd2UgZG9uJ3Qgc3RyaWN0bHkgbmVlZAogICAgICAgIC8vIHRvIGRvIHRvIGdlbmVyYXRlIHRoZSBpbWFnZSBtYXAgdG8gaW1wcm92ZSBwZXJmb3JtYW5jZQogICAgICAgIC8vIGEgYmVzdCB3ZSBjYW4uIFRoZXJlZm9yIHlvdSB3aWxsIHNlZSBhIGxvdCBvZiB0ZXN0cyAhJF9jc2ltIGluIHRoZQogICAgICAgIC8vIGNvZGUgYmVsb3cuCiAgICAgICAgJF9jc2ltID0gKCRhU3Ryb2tlRmlsZU5hbWU9PT1fQ1NJTV9TUEVDSUFMRklMRSk7CgogICAgICAgIC8vIElmIHdlIGFyZSBjYWxsZWQgdGhlIHNlY29uZCB0aW1lIChwZXJoYXBzIHRoZSB1c2VyIGhhcyBjYWxsZWQgR2V0SFRNTEltYWdlTWFwKCkKICAgICAgICAvLyBoaW1zZWxmIHRoZW4gdGhlIGxlZ2VuZHMgaGF2ZSBhbHNyZWFkeSBiZWVuIHBvcHVsYXRlZCBvbmNlIGluIG9yZGVyIHRvIGdldCB0aGUKICAgICAgICAvLyBDU0lNIGNvb3JkaW5hdHMuIFNpbmNlIHdlIGRvIG5vdCB3YW50IHRoZSBsZWdlbmRzIHRvIGJlIHBvcHVsYXRlZCBhIHNlY29uZCB0aW1lCiAgICAgICAgLy8gd2UgY2xlYXIgdGhlIGxlZ2VuZHMKICAgICAgICAkdGhpcy0+bGVnZW5kLT5DbGVhcigpOwoKICAgICAgICAvLyBXZSBuZWVkIHRvIGtub3cgaWYgd2UgaGF2ZSBzdHJva2VkIHRoZSBwbG90IGluIHRoZQogICAgICAgIC8vIEdldENTSU1hcmVhcy4gT3RoZXJ3aXNlIHRoZSBDU0lNIGhhc24ndCBiZWVuIGdlbmVyYXRlZAogICAgICAgIC8vIGFuZCBpbiB0aGUgY2FzZSBvZiBHZXRDU0lNIGNhbGxlZCBiZWZvcmUgc3Ryb2tlIHRvIGdlbmVyYXRlCiAgICAgICAgLy8gQ1NJTSB3aXRob3V0IHN0b3JpbmcgYW4gaW1hZ2UgdG8gZGlzayBHZXRDU0lNIG11c3QgY2FsbCBTdHJva2UuCiAgICAgICAgJHRoaXMtPmlIYXNTdHJva2VkID0gdHJ1ZTsKCiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+cGxvdHMpOwoKICAgICAgICBpZiggJHRoaXMtPnBpZWFhICkgewoKICAgICAgICAgICAgaWYoICEkX2NzaW0gKSB7CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmJhY2tncm91bmRfaW1hZ2UgIT0gIiIgKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUZyYW1lQmFja2dyb3VuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUZyYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUJhY2tncm91bmRHcmFkKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAkdyA9ICR0aGlzLT5pbWctPndpZHRoOwogICAgICAgICAgICAkaCA9ICR0aGlzLT5pbWctPmhlaWdodDsKICAgICAgICAgICAgJG9sZGltZyA9ICR0aGlzLT5pbWctPmltZzsKCiAgICAgICAgICAgICR0aGlzLT5pbWctPkNyZWF0ZUltZ0NhbnZhcygyKiR3LDIqJGgpOwoKICAgICAgICAgICAgJHRoaXMtPmltZy0+U2V0Q29sb3IoICR0aGlzLT5tYXJnaW5fY29sb3IgKTsKICAgICAgICAgICAgJHRoaXMtPmltZy0+RmlsbGVkUmVjdGFuZ2xlKDAsMCwyKiR3LTEsMiokaC0xKTsKCiAgICAgICAgICAgIC8vIE1ha2UgYWxsIGljb25zICoyIGkgc2l6ZSBzaW5jZSB3ZSB3aWxsIGJlIHNjYWxpbmcgZG93biB0aGUKICAgICAgICAgICAgLy8gaW1haGUgdG8gZG8gdGhlIGFudGkgYWxpYXNpbmcKICAgICAgICAgICAgJG5pID0gY291bnQoJHRoaXMtPmlJY29ucyk7CiAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8ICRuaTsgKyskaSkgewogICAgICAgICAgICAgICAgJHRoaXMtPmlJY29uc1skaV0tPmlTY2FsZSAqPSAyIDsKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+aUljb25zWyRpXS0+aVggPiAxICkKICAgICAgICAgICAgICAgICR0aGlzLT5pSWNvbnNbJGldLT5pWCAqPSAyIDsKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+aUljb25zWyRpXS0+aVkgPiAxICkKICAgICAgICAgICAgICAgICR0aGlzLT5pSWNvbnNbJGldLT5pWSAqPSAyIDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUljb25zKCk7CgogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSkgewogICAgICAgICAgICAgICAgaWYoICR0aGlzLT5wbG90c1skaV0tPnBvc3ggPiAxICkKICAgICAgICAgICAgICAgICR0aGlzLT5wbG90c1skaV0tPnBvc3ggKj0gMiA7CiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnBsb3RzWyRpXS0+cG9zeSA+IDEgKQogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+cG9zeSAqPSAyIDsKCiAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT5TdHJva2UoJHRoaXMtPmltZywxKTsKCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPnBsb3RzWyRpXS0+cG9zeCA+IDEgKQogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+cG9zeCAvPSAyIDsKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+cGxvdHNbJGldLT5wb3N5ID4gMSApCiAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT5wb3N5IC89IDIgOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkaW5kZW50ID0gJHRoaXMtPmRvZnJhbWUgPyAoJHRoaXMtPmZyYW1lX3dlaWdodCArICgkdGhpcy0+ZG9zaGFkb3cgPyAkdGhpcy0+c2hhZG93X3dpZHRoIDogMCApKSA6IDAgOwogICAgICAgICAgICAkaW5kZW50ICs9ICR0aGlzLT5mcmFtZWJldmVsID8gJHRoaXMtPmZyYW1lYmV2ZWxkZXB0aCArIDEgOiAwIDsKICAgICAgICAgICAgJHRoaXMtPmltZy0+Q29weUNhbnZhc0goJG9sZGltZywkdGhpcy0+aW1nLT5pbWcsJGluZGVudCwkaW5kZW50LCRpbmRlbnQsJGluZGVudCwKICAgICAgICAgICAgJHctMiokaW5kZW50LCRoLTIqJGluZGVudCwyKigkdy0kaW5kZW50KSwyKigkaC0kaW5kZW50KSk7CgogICAgICAgICAgICAkdGhpcy0+aW1nLT5pbWcgPSAkb2xkaW1nIDsKICAgICAgICAgICAgJHRoaXMtPmltZy0+d2lkdGggPSAkdyA7CiAgICAgICAgICAgICR0aGlzLT5pbWctPmhlaWdodCA9ICRoIDsKCiAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+cGxvdHNbJGldLT5TdHJva2UoJHRoaXMtPmltZywyKTsgLy8gU3Ryb2tlIGxhYmVscwogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+TGVnZW5kKCR0aGlzKTsKICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICAgICAgZWxzZSB7CgogICAgICAgICAgICBpZiggISRfY3NpbSApIHsKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+YmFja2dyb3VuZF9pbWFnZSAhPSAiIiApIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U3Ryb2tlRnJhbWVCYWNrZ3JvdW5kKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U3Ryb2tlRnJhbWUoKTsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U3Ryb2tlQmFja2dyb3VuZEdyYWQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPlN0cm9rZUljb25zKCk7CgogICAgICAgICAgICBmb3IoJGk9MDsgJGkgPCAkbjsgKyskaSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+U3Ryb2tlKCR0aGlzLT5pbWcpOwogICAgICAgICAgICAgICAgJHRoaXMtPnBsb3RzWyRpXS0+TGVnZW5kKCR0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPmxlZ2VuZC0+U3Ryb2tlKCR0aGlzLT5pbWcpOwogICAgICAgICR0aGlzLT5mb290ZXItPlN0cm9rZSgkdGhpcy0+aW1nKTsKICAgICAgICAkdGhpcy0+U3Ryb2tlVGl0bGVzKCk7CgogICAgICAgIGlmKCAhJF9jc2ltICkgewoKICAgICAgICAgICAgLy8gU3Ryb2tlIHRleHRzCiAgICAgICAgICAgIGlmKCAkdGhpcy0+dGV4dHMgIT0gbnVsbCApIHsKICAgICAgICAgICAgICAgICRuID0gY291bnQoJHRoaXMtPnRleHRzKTsKICAgICAgICAgICAgICAgIGZvcigkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT50ZXh0c1skaV0tPlN0cm9rZSgkdGhpcy0+aW1nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoIF9KUEdfREVCVUcgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+RGlzcGxheUNTSU1BcmVhcygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBTaG91bGQgd2UgZG8gYW55IGZpbmFsIGltYWdlIHRyYW5zZm9ybWF0aW9uCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aUltZ1RyYW5zICkgewogICAgICAgICAgICAgICAgaWYoICFjbGFzc19leGlzdHMoJ0ltZ1RyYW5zJyxmYWxzZSkgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZV9vbmNlKCdqcGdyYXBoX2ltZ3RyYW5zLnBocCcpOwogICAgICAgICAgICAgICAgICAgIC8vSnBHcmFwaEVycm9yOjpSYWlzZSgnSW4gb3JkZXIgdG8gdXNlIGltYWdlIHRyYW5zZm9ybWF0aW9uIHlvdSBtdXN0IGluY2x1ZGUgdGhlIGZpbGUganBncmFwaF9pbWd0cmFucy5waHAgaW4geW91ciBzY3JpcHQuJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHRmb3JtID0gbmV3IEltZ1RyYW5zKCR0aGlzLT5pbWctPmltZyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+aW1nLT5pbWcgPSAkdGZvcm0tPlNrZXczRCgkdGhpcy0+aUltZ1RyYW5zSG9yaXpvbiwkdGhpcy0+aUltZ1RyYW5zU2tld0Rpc3QsCiAgICAgICAgICAgICAgICAkdGhpcy0+aUltZ1RyYW5zRGlyZWN0aW9uLCR0aGlzLT5pSW1nVHJhbnNIaWdoUSwKICAgICAgICAgICAgICAgICR0aGlzLT5pSW1nVHJhbnNNaW5TaXplLCR0aGlzLT5pSW1nVHJhbnNGaWxsQ29sb3IsCiAgICAgICAgICAgICAgICAkdGhpcy0+aUltZ1RyYW5zQm9yZGVyKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIElmIHRoZSBmaWxlbmFtZSBpcyBnaXZlbiBhcyB0aGUgc3BlY2lhbCAiX19oYW5kbGUiCiAgICAgICAgICAgIC8vIHRoZW4gdGhlIGltYWdlIGhhbmRsZXIgaXMgcmV0dXJuZWQgYW5kIHRoZSBpbWFnZSBpcyBOT1QKICAgICAgICAgICAgLy8gc3RyZWFtZWQgYmFjawogICAgICAgICAgICBpZiggJGFTdHJva2VGaWxlTmFtZSA9PSBfSU1HX0hBTkRMRVIgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmltZy0+aW1nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gRmluYWxseSBzdHJlYW0gdGhlIGdlbmVyYXRlZCBwaWN0dXJlCiAgICAgICAgICAgICAgICAkdGhpcy0+Y2FjaGUtPlB1dEFuZFN0cmVhbSgkdGhpcy0+aW1nLCR0aGlzLT5jYWNoZV9uYW1lLCR0aGlzLT5pbmxpbmUsCiAgICAgICAgICAgICAgICAkYVN0cm9rZUZpbGVOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfSAvLyBDbGFzcwoKLyogRU9GICovCj8+Cg==",
    "size": "54520"
}