{
    "namaFile": "pages\/admin\/menu\/assets\/js\/libs\/bootstrap-multiselect\/bootstrap-multiselect.js",
    "lastUpdate": "2018-03-22+14:19:04.87",
    "contentFile": "LyoqCiAqIEJvb3RzdHJhcCBNdWx0aXNlbGVjdCB2MC45LjggKGh0dHBzOi8vZ2l0aHViLmNvbS9kYXZpZHN0dXR6L2Jvb3RzdHJhcC1tdWx0aXNlbGVjdCkKICogCiAqIENvcHlyaWdodCAyMDEyIC0gMjAxNCBEYXZpZCBTdHV0egogKiAKICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgQlNELTMtQ2xhdXNlIGFuZCB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wLgogKi8KIWZ1bmN0aW9uKCQpIHsKIAogICAgInVzZSBzdHJpY3QiOy8vIGpzaGludCA7XzsKCiAgICBpZiAodHlwZW9mIGtvICE9PSAndW5kZWZpbmVkJyAmJiBrby5iaW5kaW5nSGFuZGxlcnMgJiYgIWtvLmJpbmRpbmdIYW5kbGVycy5tdWx0aXNlbGVjdCkgewogICAgICAgIGtvLmJpbmRpbmdIYW5kbGVycy5tdWx0aXNlbGVjdCA9IHsKCiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbGVtZW50LCB2YWx1ZUFjY2Vzc29yLCBhbGxCaW5kaW5nc0FjY2Vzc29yLCB2aWV3TW9kZWwsIGJpbmRpbmdDb250ZXh0KSB7CgogICAgICAgICAgICAgICAgdmFyIGxpc3RPZlNlbGVjdGVkSXRlbXMgPSBhbGxCaW5kaW5nc0FjY2Vzc29yKCkuc2VsZWN0ZWRPcHRpb25zOwogICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUodmFsdWVBY2Nlc3NvcigpKTsKCiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLm11bHRpc2VsZWN0KGNvbmZpZyk7CgogICAgICAgICAgICAgICAgaWYgKGlzT2JzZXJ2YWJsZUFycmF5KGxpc3RPZlNlbGVjdGVkSXRlbXMpKSB7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBpbml0aWFsIHNlbGVjdGlvbiBzdGF0ZSBvbiB0aGUgbXVsdGlzZWxlY3QgbGlzdC4KICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLm11bHRpc2VsZWN0KCdzZWxlY3QnLCBrby51dGlscy51bndyYXBPYnNlcnZhYmxlKGxpc3RPZlNlbGVjdGVkSXRlbXMpKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBTdWJzY3JpYmUgdG8gdGhlIHNlbGVjdGVkT3B0aW9uczoga28ub2JzZXJ2YWJsZUFycmF5CiAgICAgICAgICAgICAgICAgICAgbGlzdE9mU2VsZWN0ZWRJdGVtcy5zdWJzY3JpYmUoZnVuY3Rpb24gKGNoYW5nZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFkZGVkQXJyYXkgPSBbXSwgZGVsZXRlZEFycmF5ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGZvckVhY2goY2hhbmdlcywgZnVuY3Rpb24gKGNoYW5nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChjaGFuZ2Uuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWRkZWQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRlZEFycmF5LnB1c2goY2hhbmdlLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlZCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRBcnJheS5wdXNoKGNoYW5nZS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGRlZEFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkubXVsdGlzZWxlY3QoJ3NlbGVjdCcsIGFkZGVkQXJyYXkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZEFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkubXVsdGlzZWxlY3QoJ2Rlc2VsZWN0JywgZGVsZXRlZEFycmF5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIG51bGwsICJhcnJheUNoYW5nZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoZWxlbWVudCwgdmFsdWVBY2Nlc3NvciwgYWxsQmluZGluZ3NBY2Nlc3Nvciwgdmlld01vZGVsLCBiaW5kaW5nQ29udGV4dCkgewoKICAgICAgICAgICAgICAgIHZhciBsaXN0T2ZJdGVtcyA9IGFsbEJpbmRpbmdzQWNjZXNzb3IoKS5vcHRpb25zLAogICAgICAgICAgICAgICAgICAgIG1zID0gJChlbGVtZW50KS5kYXRhKCdtdWx0aXNlbGVjdCcpLAogICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IGtvLnV0aWxzLnVud3JhcE9ic2VydmFibGUodmFsdWVBY2Nlc3NvcigpKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNPYnNlcnZhYmxlQXJyYXkobGlzdE9mSXRlbXMpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU3Vic2NyaWJlIHRvIHRoZSBvcHRpb25zOiBrby5vYnNlcnZhYmxlQXJyYXkgaW5jYXNlIGl0IGNoYW5nZXMgbGF0ZXIKICAgICAgICAgICAgICAgICAgICBsaXN0T2ZJdGVtcy5zdWJzY3JpYmUoZnVuY3Rpb24gKHRoZUFycmF5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkubXVsdGlzZWxlY3QoJ3JlYnVpbGQnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIW1zKSB7CiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5tdWx0aXNlbGVjdChjb25maWcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbXMudXBkYXRlT3JpZ2luYWxPcHRpb25zKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGlzT2JzZXJ2YWJsZUFycmF5KG9iaikgewogICAgICAgIHJldHVybiBrby5pc09ic2VydmFibGUob2JqKSAmJiAhKG9iai5kZXN0cm95QWxsID09PSB1bmRlZmluZWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZvckVhY2goYXJyYXksIGNhbGxiYWNrKSB7CiAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGFycmF5Lmxlbmd0aDsgKytpbmRleCkgewogICAgICAgICAgICBjYWxsYmFjayhhcnJheVtpbmRleF0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIG5ldyBtdWx0aXNlbGVjdCB1c2luZyB0aGUgZ2l2ZW4gc2VsZWN0LgogICAgICogCiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gc2VsZWN0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICogQHJldHVybnMge011bHRpc2VsZWN0fQogICAgICovCiAgICBmdW5jdGlvbiBNdWx0aXNlbGVjdChzZWxlY3QsIG9wdGlvbnMpIHsKCiAgICAgICAgdGhpcy4kc2VsZWN0ID0gJChzZWxlY3QpOwogICAgICAgIHRoaXMub3B0aW9ucyA9IHRoaXMubWVyZ2VPcHRpb25zKCQuZXh0ZW5kKHt9LCBvcHRpb25zLCB0aGlzLiRzZWxlY3QuZGF0YSgpKSk7CgogICAgICAgIC8vIEluaXRpYWxpemF0aW9uLgogICAgICAgIC8vIFdlIGhhdmUgdG8gY2xvbmUgdG8gY3JlYXRlIGEgbmV3IHJlZmVyZW5jZS4KICAgICAgICB0aGlzLm9yaWdpbmFsT3B0aW9ucyA9IHRoaXMuJHNlbGVjdC5jbG9uZSgpWzBdLm9wdGlvbnM7CiAgICAgICAgdGhpcy5xdWVyeSA9ICcnOwogICAgICAgIHRoaXMuc2VhcmNoVGltZW91dCA9IG51bGw7CgogICAgICAgIHRoaXMub3B0aW9ucy5tdWx0aXBsZSA9IHRoaXMuJHNlbGVjdC5hdHRyKCdtdWx0aXBsZScpID09PSAibXVsdGlwbGUiOwogICAgICAgIHRoaXMub3B0aW9ucy5vbkNoYW5nZSA9ICQucHJveHkodGhpcy5vcHRpb25zLm9uQ2hhbmdlLCB0aGlzKTsKICAgICAgICB0aGlzLm9wdGlvbnMub25Ecm9wZG93blNob3cgPSAkLnByb3h5KHRoaXMub3B0aW9ucy5vbkRyb3Bkb3duU2hvdywgdGhpcyk7CiAgICAgICAgdGhpcy5vcHRpb25zLm9uRHJvcGRvd25IaWRlID0gJC5wcm94eSh0aGlzLm9wdGlvbnMub25Ecm9wZG93bkhpZGUsIHRoaXMpOwogICAgICAgIHRoaXMub3B0aW9ucy5vbkRyb3Bkb3duU2hvd24gPSAkLnByb3h5KHRoaXMub3B0aW9ucy5vbkRyb3Bkb3duU2hvd24sIHRoaXMpOwogICAgICAgIHRoaXMub3B0aW9ucy5vbkRyb3Bkb3duSGlkZGVuID0gJC5wcm94eSh0aGlzLm9wdGlvbnMub25Ecm9wZG93bkhpZGRlbiwgdGhpcyk7CiAgICAgICAgCiAgICAgICAgLy8gQnVpbGQgc2VsZWN0IGFsbCBpZiBlbmFibGVkLgogICAgICAgIHRoaXMuYnVpbGRDb250YWluZXIoKTsKICAgICAgICB0aGlzLmJ1aWxkQnV0dG9uKCk7CiAgICAgICAgdGhpcy5idWlsZERyb3Bkb3duKCk7CiAgICAgICAgdGhpcy5idWlsZFNlbGVjdEFsbCgpOwogICAgICAgIHRoaXMuYnVpbGREcm9wZG93bk9wdGlvbnMoKTsKICAgICAgICB0aGlzLmJ1aWxkRmlsdGVyKCk7CiAgICAgICAgCiAgICAgICAgdGhpcy51cGRhdGVCdXR0b25UZXh0KCk7CiAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RBbGwoKTsKICAgICAgICAKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRpc2FibGVJZkVtcHR5ICYmICQoJ29wdGlvbicsIHRoaXMuJHNlbGVjdCkubGVuZ3RoIDw9IDApIHsKICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRoaXMuJHNlbGVjdC5oaWRlKCkuYWZ0ZXIodGhpcy4kY29udGFpbmVyKTsKICAgIH07CgogICAgTXVsdGlzZWxlY3QucHJvdG90eXBlID0gewoKICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogRGVmYXVsdCB0ZXh0IGZ1bmN0aW9uIHdpbGwgZWl0aGVyIHByaW50ICdOb25lIHNlbGVjdGVkJyBpbiBjYXNlIG5vCiAgICAgICAgICAgICAqIG9wdGlvbiBpcyBzZWxlY3RlZCBvciBhIGxpc3Qgb2YgdGhlIHNlbGVjdGVkIG9wdGlvbnMgdXAgdG8gYSBsZW5ndGgKICAgICAgICAgICAgICogb2YgMyBzZWxlY3RlZCBvcHRpb25zLgogICAgICAgICAgICAgKiAKICAgICAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IG9wdGlvbnMKICAgICAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IHNlbGVjdAogICAgICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgYnV0dG9uVGV4dDogZnVuY3Rpb24ob3B0aW9ucywgc2VsZWN0KSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ub25TZWxlY3RlZFRleHQgKyAnIDxiIGNsYXNzPSJjYXJldCI+PC9iPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChvcHRpb25zLmxlbmd0aCA9PSAkKCdvcHRpb24nLCAkKHNlbGVjdCkpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFsbFNlbGVjdGVkVGV4dCArICcgPGIgY2xhc3M9ImNhcmV0Ij48L2I+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9wdGlvbnMubGVuZ3RoID4gdGhpcy5udW1iZXJEaXNwbGF5ZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5sZW5ndGggKyAnICcgKyB0aGlzLm5TZWxlY3RlZFRleHQgKyAnIDxiIGNsYXNzPSJjYXJldCI+PC9iPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSAnJzsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9ICgkKHRoaXMpLmF0dHIoJ2xhYmVsJykgIT09IHVuZGVmaW5lZCkgPyAkKHRoaXMpLmF0dHIoJ2xhYmVsJykgOiAkKHRoaXMpLmh0bWwoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkICs9IGxhYmVsICsgJywgJzsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWQuc3Vic3RyKDAsIHNlbGVjdGVkLmxlbmd0aCAtIDIpICsgJyA8YiBjbGFzcz0iY2FyZXQiPjwvYj4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVXBkYXRlcyB0aGUgdGl0bGUgb2YgdGhlIGJ1dHRvbiBzaW1pbGFyIHRvIHRoZSBidXR0b25UZXh0IGZ1bmN0aW9uLgogICAgICAgICAgICAgKiAKICAgICAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IG9wdGlvbnMKICAgICAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IHNlbGVjdAogICAgICAgICAgICAgKiBAcmV0dXJucyB7QGV4cDtzZWxlY3RlZEBjYWxsO3N1YnN0cn0KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGJ1dHRvblRpdGxlOiBmdW5jdGlvbihvcHRpb25zLCBzZWxlY3QpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vblNlbGVjdGVkVGV4dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9ICcnOwogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkICs9ICQodGhpcykudGV4dCgpICsgJywgJzsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWQuc3Vic3RyKDAsIHNlbGVjdGVkLmxlbmd0aCAtIDIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQ3JlYXRlIGEgbGFiZWwuCiAgICAgICAgICAgICAqIAogICAgICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWxlbWVudAogICAgICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uKGVsZW1lbnQpewogICAgICAgICAgICAgICAgcmV0dXJuICQoZWxlbWVudCkuYXR0cignbGFiZWwnKSB8fCAkKGVsZW1lbnQpLmh0bWwoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRyaWdnZXJlZCBvbiBjaGFuZ2Ugb2YgdGhlIG11bHRpc2VsZWN0LgogICAgICAgICAgICAgKiAKICAgICAgICAgICAgICogTm90IHRyaWdnZXJlZCB3aGVuIHNlbGVjdGluZy9kZXNlbGVjdGluZyBvcHRpb25zIG1hbnVhbGx5LgogICAgICAgICAgICAgKiAKICAgICAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IG9wdGlvbgogICAgICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGNoZWNrZWQKICAgICAgICAgICAgICovCiAgICAgICAgICAgIG9uQ2hhbmdlIDogZnVuY3Rpb24ob3B0aW9uLCBjaGVja2VkKSB7CgogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVHJpZ2dlcmVkIHdoZW4gdGhlIGRyb3Bkb3duIGlzIHNob3duLgogICAgICAgICAgICAgKiAKICAgICAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGV2ZW50CiAgICAgICAgICAgICAqLwogICAgICAgICAgICBvbkRyb3Bkb3duU2hvdzogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVHJpZ2dlcmVkIHdoZW4gdGhlIGRyb3Bkb3duIGlzIGhpZGRlbi4KICAgICAgICAgICAgICogCiAgICAgICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBldmVudAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgb25Ecm9wZG93bkhpZGU6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRyaWdnZXJlZCBhZnRlciB0aGUgZHJvcGRvd24gaXMgc2hvd24uCiAgICAgICAgICAgICAqIAogICAgICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZXZlbnQKICAgICAgICAgICAgICovCiAgICAgICAgICAgIG9uRHJvcGRvd25TaG93bjogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVHJpZ2dlcmVkIGFmdGVyIHRoZSBkcm9wZG93biBpcyBoaWRkZW4uCiAgICAgICAgICAgICAqIAogICAgICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZXZlbnQKICAgICAgICAgICAgICovCiAgICAgICAgICAgIG9uRHJvcGRvd25IaWRkZW46IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnV0dG9uQ2xhc3M6ICdidG4gYnRuLWRlZmF1bHQnLAogICAgICAgICAgICBidXR0b25XaWR0aDogJ2F1dG8nLAogICAgICAgICAgICBidXR0b25Db250YWluZXI6ICc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiIC8+JywKICAgICAgICAgICAgZHJvcFJpZ2h0OiBmYWxzZSwKICAgICAgICAgICAgc2VsZWN0ZWRDbGFzczogJ2FjdGl2ZScsCiAgICAgICAgICAgIC8vIE1heGltdW0gaGVpZ2h0IG9mIHRoZSBkcm9wZG93biBtZW51LgogICAgICAgICAgICAvLyBJZiBtYXhpbXVtIGhlaWdodCBpcyBleGNlZWRlZCBhIHNjcm9sbGJhciB3aWxsIGJlIGRpc3BsYXllZC4KICAgICAgICAgICAgbWF4SGVpZ2h0OiBmYWxzZSwKICAgICAgICAgICAgY2hlY2tib3hOYW1lOiBmYWxzZSwKICAgICAgICAgICAgaW5jbHVkZVNlbGVjdEFsbE9wdGlvbjogZmFsc2UsCiAgICAgICAgICAgIGluY2x1ZGVTZWxlY3RBbGxJZk1vcmVUaGFuOiAwLAogICAgICAgICAgICBzZWxlY3RBbGxUZXh0OiAnIFNlbGVjdCBhbGwnLAogICAgICAgICAgICBzZWxlY3RBbGxWYWx1ZTogJ211bHRpc2VsZWN0LWFsbCcsCiAgICAgICAgICAgIHNlbGVjdEFsbE5hbWU6IGZhbHNlLAogICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLAogICAgICAgICAgICBlbmFibGVDYXNlSW5zZW5zaXRpdmVGaWx0ZXJpbmc6IGZhbHNlLAogICAgICAgICAgICBlbmFibGVDbGlja2FibGVPcHRHcm91cHM6IGZhbHNlLAogICAgICAgICAgICBmaWx0ZXJQbGFjZWhvbGRlcjogJ1NlYXJjaCcsCiAgICAgICAgICAgIC8vIHBvc3NpYmxlIG9wdGlvbnM6ICd0ZXh0JywgJ3ZhbHVlJywgJ2JvdGgnCiAgICAgICAgICAgIGZpbHRlckJlaGF2aW9yOiAndGV4dCcsCiAgICAgICAgICAgIGluY2x1ZGVGaWx0ZXJDbGVhckJ0bjogdHJ1ZSwKICAgICAgICAgICAgcHJldmVudElucHV0Q2hhbmdlRXZlbnQ6IGZhbHNlLAogICAgICAgICAgICBub25TZWxlY3RlZFRleHQ6ICdOb25lIHNlbGVjdGVkJywKICAgICAgICAgICAgblNlbGVjdGVkVGV4dDogJ3NlbGVjdGVkJywKICAgICAgICAgICAgYWxsU2VsZWN0ZWRUZXh0OiAnQWxsIHNlbGVjdGVkJywKICAgICAgICAgICAgbnVtYmVyRGlzcGxheWVkOiAzLAogICAgICAgICAgICBkaXNhYmxlSWZFbXB0eTogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlczogewogICAgICAgICAgICAgICAgYnV0dG9uOiAnPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJtdWx0aXNlbGVjdCBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PC9idXR0b24+JywKICAgICAgICAgICAgICAgIHVsOiAnPHVsIGNsYXNzPSJtdWx0aXNlbGVjdC1jb250YWluZXIgZHJvcGRvd24tbWVudSI+PC91bD4nLAogICAgICAgICAgICAgICAgZmlsdGVyOiAnPGxpIGNsYXNzPSJtdWx0aXNlbGVjdC1pdGVtIGZpbHRlciI+PGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPjxzcGFuIGNsYXNzPSJpbnB1dC1ncm91cC1hZGRvbiI+PGkgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tc2VhcmNoIj48L2k+PC9zcGFuPjxpbnB1dCBjbGFzcz0iZm9ybS1jb250cm9sIG11bHRpc2VsZWN0LXNlYXJjaCIgdHlwZT0idGV4dCI+PC9kaXY+PC9saT4nLAogICAgICAgICAgICAgICAgZmlsdGVyQ2xlYXJCdG46ICc8c3BhbiBjbGFzcz0iaW5wdXQtZ3JvdXAtYnRuIj48YnV0dG9uIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQgbXVsdGlzZWxlY3QtY2xlYXItZmlsdGVyIiB0eXBlPSJidXR0b24iPjxpIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZS1jaXJjbGUiPjwvaT48L2J1dHRvbj48L3NwYW4+JywKICAgICAgICAgICAgICAgIGxpOiAnPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKTsiPjxsYWJlbD48L2xhYmVsPjwvYT48L2xpPicsCiAgICAgICAgICAgICAgICBkaXZpZGVyOiAnPGxpIGNsYXNzPSJtdWx0aXNlbGVjdC1pdGVtIGRpdmlkZXIiPjwvbGk+JywKICAgICAgICAgICAgICAgIGxpR3JvdXA6ICc8bGkgY2xhc3M9Im11bHRpc2VsZWN0LWl0ZW0gbXVsdGlzZWxlY3QtZ3JvdXAiPjxsYWJlbD48L2xhYmVsPjwvbGk+JwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgY29uc3RydWN0b3I6IE11bHRpc2VsZWN0LAoKICAgICAgICAvKioKICAgICAgICAgKiBCdWlsZHMgdGhlIGNvbnRhaW5lciBvZiB0aGUgbXVsdGlzZWxlY3QuCiAgICAgICAgICovCiAgICAgICAgYnVpbGRDb250YWluZXI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGlzLiRjb250YWluZXIgPSAkKHRoaXMub3B0aW9ucy5idXR0b25Db250YWluZXIpOwogICAgICAgICAgICB0aGlzLiRjb250YWluZXIub24oJ3Nob3cuYnMuZHJvcGRvd24nLCB0aGlzLm9wdGlvbnMub25Ecm9wZG93blNob3cpOwogICAgICAgICAgICB0aGlzLiRjb250YWluZXIub24oJ2hpZGUuYnMuZHJvcGRvd24nLCB0aGlzLm9wdGlvbnMub25Ecm9wZG93bkhpZGUpOwogICAgICAgICAgICB0aGlzLiRjb250YWluZXIub24oJ3Nob3duLmJzLmRyb3Bkb3duJywgdGhpcy5vcHRpb25zLm9uRHJvcGRvd25TaG93bik7CiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5vbignaGlkZGVuLmJzLmRyb3Bkb3duJywgdGhpcy5vcHRpb25zLm9uRHJvcGRvd25IaWRkZW4pOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEJ1aWxkcyB0aGUgYnV0dG9uIG9mIHRoZSBtdWx0aXNlbGVjdC4KICAgICAgICAgKi8KICAgICAgICBidWlsZEJ1dHRvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuJGJ1dHRvbiA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlcy5idXR0b24pLmFkZENsYXNzKHRoaXMub3B0aW9ucy5idXR0b25DbGFzcyk7CgogICAgICAgICAgICAvLyBBZG9wdCBhY3RpdmUgc3RhdGUuCiAgICAgICAgICAgIGlmICh0aGlzLiRzZWxlY3QucHJvcCgnZGlzYWJsZWQnKSkgewogICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmVuYWJsZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBNYW51YWxseSBhZGQgYnV0dG9uIHdpZHRoIGlmIHNldC4KICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5idXR0b25XaWR0aCAmJiB0aGlzLm9wdGlvbnMuYnV0dG9uV2lkdGggIT09ICdhdXRvJykgewogICAgICAgICAgICAgICAgdGhpcy4kYnV0dG9uLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJyA6IHRoaXMub3B0aW9ucy5idXR0b25XaWR0aAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLiRjb250YWluZXIuY3NzKHsKICAgICAgICAgICAgICAgICAgICAnd2lkdGgnOiB0aGlzLm9wdGlvbnMuYnV0dG9uV2lkdGgKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBLZWVwIHRoZSB0YWIgaW5kZXggZnJvbSB0aGUgc2VsZWN0LgogICAgICAgICAgICB2YXIgdGFiaW5kZXggPSB0aGlzLiRzZWxlY3QuYXR0cigndGFiaW5kZXgnKTsKICAgICAgICAgICAgaWYgKHRhYmluZGV4KSB7CiAgICAgICAgICAgICAgICB0aGlzLiRidXR0b24uYXR0cigndGFiaW5kZXgnLCB0YWJpbmRleCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5wcmVwZW5kKHRoaXMuJGJ1dHRvbik7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQnVpbGRzIHRoZSB1bCByZXByZXNlbnRpbmcgdGhlIGRyb3Bkb3duIG1lbnUuCiAgICAgICAgICovCiAgICAgICAgYnVpbGREcm9wZG93bjogZnVuY3Rpb24oKSB7CgogICAgICAgICAgICAvLyBCdWlsZCB1bC4KICAgICAgICAgICAgdGhpcy4kdWwgPSAkKHRoaXMub3B0aW9ucy50ZW1wbGF0ZXMudWwpOwoKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kcm9wUmlnaHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHVsLmFkZENsYXNzKCdwdWxsLXJpZ2h0Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNldCBtYXggaGVpZ2h0IG9mIGRyb3Bkb3duIG1lbnUgdG8gYWN0aXZhdGUgYXV0byBzY3JvbGxiYXIuCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWF4SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBBZGQgYSBjbGFzcyBmb3IgdGhpcyBvcHRpb24gdG8gbW92ZSB0aGUgY3NzIGRlY2xhcmF0aW9ucy4KICAgICAgICAgICAgICAgIHRoaXMuJHVsLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ21heC1oZWlnaHQnOiB0aGlzLm9wdGlvbnMubWF4SGVpZ2h0ICsgJ3B4JywKICAgICAgICAgICAgICAgICAgICAnb3ZlcmZsb3cteSc6ICdhdXRvJywKICAgICAgICAgICAgICAgICAgICAnb3ZlcmZsb3cteCc6ICdoaWRkZW4nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy4kY29udGFpbmVyLmFwcGVuZCh0aGlzLiR1bCk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQnVpbGQgdGhlIGRyb3Bkb3duIG9wdGlvbnMgYW5kIGJpbmRzIGFsbCBuZXNzZWNhcnkgZXZlbnRzLgogICAgICAgICAqIAogICAgICAgICAqIFVzZXMgY3JlYXRlRGl2aWRlciBhbmQgY3JlYXRlT3B0aW9uVmFsdWUgdG8gY3JlYXRlIHRoZSBuZWNlc3Nhcnkgb3B0aW9ucy4KICAgICAgICAgKi8KICAgICAgICBidWlsZERyb3Bkb3duT3B0aW9uczogZnVuY3Rpb24oKSB7CgogICAgICAgICAgICB0aGlzLiRzZWxlY3QuY2hpbGRyZW4oKS5lYWNoKCQucHJveHkoZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHsKCiAgICAgICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgICAgICAgICAgICAgLy8gU3VwcG9ydCBvcHRncm91cHMgYW5kIG9wdGlvbnMgd2l0aG91dCBhIGdyb3VwIHNpbXVsdGFuZW91c2x5LgogICAgICAgICAgICAgICAgdmFyIHRhZyA9ICRlbGVtZW50LnByb3AoJ3RhZ05hbWUnKQogICAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudC5wcm9wKCd2YWx1ZScpID09PSB0aGlzLm9wdGlvbnMuc2VsZWN0QWxsVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRhZyA9PT0gJ29wdGdyb3VwJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlT3B0Z3JvdXAoZWxlbWVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0YWcgPT09ICdvcHRpb24nKSB7CgogICAgICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudC5kYXRhKCdyb2xlJykgPT09ICdkaXZpZGVyJykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURpdmlkZXIoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlT3B0aW9uVmFsdWUoZWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gT3RoZXIgaWxsZWdhbCB0YWdzIHdpbGwgYmUgaWdub3JlZC4KICAgICAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICAgICAgLy8gQmluZCB0aGUgY2hhbmdlIGV2ZW50IG9uIHRoZSBkcm9wZG93biBlbGVtZW50cy4KICAgICAgICAgICAgJCgnbGkgaW5wdXQnLCB0aGlzLiR1bCkub24oJ2NoYW5nZScsICQucHJveHkoZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciAkdGFyZ2V0ID0gJChldmVudC50YXJnZXQpOwoKICAgICAgICAgICAgICAgIHZhciBjaGVja2VkID0gJHRhcmdldC5wcm9wKCdjaGVja2VkJykgfHwgZmFsc2U7CiAgICAgICAgICAgICAgICB2YXIgaXNTZWxlY3RBbGxPcHRpb24gPSAkdGFyZ2V0LnZhbCgpID09PSB0aGlzLm9wdGlvbnMuc2VsZWN0QWxsVmFsdWU7CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgb3IgdW5hcHBseSB0aGUgY29uZmlndXJlZCBzZWxlY3RlZCBjbGFzcy4KICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0ZWRDbGFzcykgewogICAgICAgICAgICAgICAgICAgIGlmIChjaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXQuY2xvc2VzdCgnbGknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXQuY2xvc2VzdCgnbGknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBjb3JyZXNwb25kaW5nIG9wdGlvbi4KICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICR0YXJnZXQudmFsKCk7CiAgICAgICAgICAgICAgICB2YXIgJG9wdGlvbiA9IHRoaXMuZ2V0T3B0aW9uQnlWYWx1ZSh2YWx1ZSk7CgogICAgICAgICAgICAgICAgdmFyICRvcHRpb25zTm90VGhpcyA9ICQoJ29wdGlvbicsIHRoaXMuJHNlbGVjdCkubm90KCRvcHRpb24pOwogICAgICAgICAgICAgICAgdmFyICRjaGVja2JveGVzTm90VGhpcyA9ICQoJ2lucHV0JywgdGhpcy4kY29udGFpbmVyKS5ub3QoJHRhcmdldCk7CgogICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0QWxsT3B0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RBbGwoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVzZWxlY3RBbGwoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoIWlzU2VsZWN0QWxsT3B0aW9uKXsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkb3B0aW9uLnByb3AoJ3NlbGVjdGVkJywgdHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm11bHRpcGxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTaW1wbHkgc2VsZWN0IGFkZGl0aW9uYWwgb3B0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbi5wcm9wKCdzZWxlY3RlZCcsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVW5zZWxlY3QgYWxsIG90aGVyIG9wdGlvbnMgYW5kIGNvcnJlc3BvbmRpbmcgY2hlY2tib3hlcy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0ZWRDbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJGNoZWNrYm94ZXNOb3RUaGlzKS5jbG9zZXN0KCdsaScpLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCRjaGVja2JveGVzTm90VGhpcykucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zTm90VGhpcy5wcm9wKCdzZWxlY3RlZCcsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJdCdzIGEgc2luZ2xlIHNlbGVjdGlvbiwgc28gY2xvc2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRidXR0b24uY2xpY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzID09PSAiYWN0aXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnNOb3RUaGlzLmNsb3Nlc3QoImEiKS5jc3MoIm91dGxpbmUiLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVuc2VsZWN0IG9wdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbi5wcm9wKCdzZWxlY3RlZCcsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy4kc2VsZWN0LmNoYW5nZSgpOwoKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQnV0dG9uVGV4dCgpOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RBbGwoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm9uQ2hhbmdlKCRvcHRpb24sIGNoZWNrZWQpOwoKICAgICAgICAgICAgICAgIGlmKHRoaXMub3B0aW9ucy5wcmV2ZW50SW5wdXRDaGFuZ2VFdmVudCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICAgICAgJCgnbGkgYScsIHRoaXMuJHVsKS5vbigndG91Y2hzdGFydCBjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgICAgICB2YXIgJHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KTsKCiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCkudHlwZSA9PT0gJ1JhbmdlJykgewogICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKS5maW5kKCJpbnB1dDpmaXJzdCIpOwoKICAgICAgICAgICAgICAgICAgJGlucHV0LnByb3AoImNoZWNrZWQiLCAhJGlucHV0LnByb3AoImNoZWNrZWQiKSkKICAgICAgICAgICAgICAgICAgICAgIC50cmlnZ2VyKCJjaGFuZ2UiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZCA9ICR0YXJnZXQucHJvcCgnY2hlY2tlZCcpIHx8IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJldiA9ICR0YXJnZXQuY2xvc2VzdCgnbGknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNpYmxpbmdzKCdsaVtjbGFzcz0iYWN0aXZlIl06Zmlyc3QnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SWR4ID0gJHRhcmdldC5jbG9zZXN0KCdsaScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByZXZJZHggPSBwcmV2LmluZGV4KCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudElkeCA+IHByZXZJZHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0YXJnZXQuY2xvc2VzdCgibGkiKS5wcmV2VW50aWwocHJldikuZWFjaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKCJpbnB1dDpmaXJzdCIpLnByb3AoImNoZWNrZWQiLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyaWdnZXIoImNoYW5nZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0LmNsb3Nlc3QoImxpIikubmV4dFVudGlsKHByZXYpLmVhY2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgiaW5wdXQ6Zmlyc3QiKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmlnZ2VyKCJjaGFuZ2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICR0YXJnZXQuYmx1cigpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEtleWJvYXJkIHN1cHBvcnQuCiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5vZmYoJ2tleWRvd24ubXVsdGlzZWxlY3QnKS5vbigna2V5ZG93bi5tdWx0aXNlbGVjdCcsICQucHJveHkoZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmICgkKCdpbnB1dFt0eXBlPSJ0ZXh0Il0nLCB0aGlzLiRjb250YWluZXIpLmlzKCc6Zm9jdXMnKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gOSAmJiB0aGlzLiRjb250YWluZXIuaGFzQ2xhc3MoJ29wZW4nKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGJ1dHRvbi5jbGljaygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpdGVtcyA9ICQodGhpcy4kY29udGFpbmVyKS5maW5kKCJsaTpub3QoLmRpdmlkZXIpOm5vdCguZGlzYWJsZWQpIGEiKS5maWx0ZXIoIjp2aXNpYmxlIik7CgogICAgICAgICAgICAgICAgICAgIGlmICghJGl0ZW1zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAkaXRlbXMuaW5kZXgoJGl0ZW1zLmZpbHRlcignOmZvY3VzJykpOwoKICAgICAgICAgICAgICAgICAgICAvLyBOYXZpZ2F0aW9uIHVwLgogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAzOCAmJiBpbmRleCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgtLTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gTmF2aWdhdGUgZG93bi4KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSA0MCAmJiBpbmRleCA8ICRpdGVtcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF+aW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyICRjdXJyZW50ID0gJGl0ZW1zLmVxKGluZGV4KTsKICAgICAgICAgICAgICAgICAgICAkY3VycmVudC5mb2N1cygpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzIgfHwgZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjaGVja2JveCA9ICRjdXJyZW50LmZpbmQoJ2lucHV0Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICAkY2hlY2tib3gucHJvcCgiY2hlY2tlZCIsICEkY2hlY2tib3gucHJvcCgiY2hlY2tlZCIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGNoZWNrYm94LmNoYW5nZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLmVuYWJsZUNsaWNrYWJsZU9wdEdyb3VwcyAmJiB0aGlzLm9wdGlvbnMubXVsdGlwbGUpIHsKICAgICAgICAgICAgICAgICQoJ2xpLm11bHRpc2VsZWN0LWdyb3VwJywgdGhpcy4kdWwpLm9uKCdjbGljaycsICQucHJveHkoZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwID0gJChldmVudC50YXJnZXQpLnBhcmVudCgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBTZWFyY2ggYWxsIG9wdGlvbiBpbiBvcHRncm91cAogICAgICAgICAgICAgICAgICAgIHZhciAkb3B0aW9ucyA9IGdyb3VwLm5leHRVbnRpbCgnbGkubXVsdGlzZWxlY3QtZ3JvdXAnKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgb3IgdW5jaGVjayBpdGVtcwogICAgICAgICAgICAgICAgICAgIHZhciBhbGxDaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9uSW5wdXRzID0gJG9wdGlvbnMuZmluZCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgICAgICBvcHRpb25JbnB1dHMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxsQ2hlY2tlZCA9IGFsbENoZWNrZWQgJiYgJCh0aGlzKS5wcm9wKCdjaGVja2VkJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIG9wdGlvbklucHV0cy5wcm9wKCdjaGVja2VkJywgIWFsbENoZWNrZWQpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGUgYW4gb3B0aW9uIHVzaW5nIHRoZSBnaXZlbiBzZWxlY3Qgb3B0aW9uLgogICAgICAgICAqIAogICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5fSBlbGVtZW50CiAgICAgICAgICovCiAgICAgICAgY3JlYXRlT3B0aW9uVmFsdWU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTsKICAgICAgICAgICAgaWYgKCRlbGVtZW50LmlzKCc6c2VsZWN0ZWQnKSkgewogICAgICAgICAgICAgICAgJGVsZW1lbnQucHJvcCgnc2VsZWN0ZWQnLCB0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU3VwcG9ydCB0aGUgbGFiZWwgYXR0cmlidXRlIG9uIG9wdGlvbnMuCiAgICAgICAgICAgIHZhciBsYWJlbCA9IHRoaXMub3B0aW9ucy5sYWJlbChlbGVtZW50KTsKICAgICAgICAgICAgdmFyIHZhbHVlID0gJGVsZW1lbnQudmFsKCk7CiAgICAgICAgICAgIHZhciBpbnB1dFR5cGUgPSB0aGlzLm9wdGlvbnMubXVsdGlwbGUgPyAiY2hlY2tib3giIDogInJhZGlvIjsKCiAgICAgICAgICAgIHZhciAkbGkgPSAkKHRoaXMub3B0aW9ucy50ZW1wbGF0ZXMubGkpOwogICAgICAgICAgICB2YXIgJGxhYmVsID0gJCgnbGFiZWwnLCAkbGkpOwogICAgICAgICAgICAkbGFiZWwuYWRkQ2xhc3MoaW5wdXRUeXBlKTsKCiAgICAgICAgICAgIHZhciAkY2hlY2tib3ggPSAkKCc8aW5wdXQvPicpLmF0dHIoJ3R5cGUnLCBpbnB1dFR5cGUpOwoKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jaGVja2JveE5hbWUpIHsKICAgICAgICAgICAgICAgICRjaGVja2JveC5hdHRyKCduYW1lJywgdGhpcy5vcHRpb25zLmNoZWNrYm94TmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGxhYmVsLmFwcGVuZCgkY2hlY2tib3gpOwoKICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gJGVsZW1lbnQucHJvcCgnc2VsZWN0ZWQnKSB8fCBmYWxzZTsKICAgICAgICAgICAgJGNoZWNrYm94LnZhbCh2YWx1ZSk7CgogICAgICAgICAgICBpZiAodmFsdWUgPT09IHRoaXMub3B0aW9ucy5zZWxlY3RBbGxWYWx1ZSkgewogICAgICAgICAgICAgICAgJGxpLmFkZENsYXNzKCJtdWx0aXNlbGVjdC1pdGVtIG11bHRpc2VsZWN0LWFsbCIpOwogICAgICAgICAgICAgICAgJGNoZWNrYm94LnBhcmVudCgpLnBhcmVudCgpCiAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdtdWx0aXNlbGVjdC1hbGwnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGxhYmVsLmFwcGVuZCgiICIgKyBsYWJlbCk7CiAgICAgICAgICAgICRsYWJlbC5hdHRyKCd0aXRsZScsICRlbGVtZW50LmF0dHIoJ3RpdGxlJykpOwoKICAgICAgICAgICAgdGhpcy4kdWwuYXBwZW5kKCRsaSk7CgogICAgICAgICAgICBpZiAoJGVsZW1lbnQuaXMoJzpkaXNhYmxlZCcpKSB7CiAgICAgICAgICAgICAgICAkY2hlY2tib3guYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKQogICAgICAgICAgICAgICAgICAgIC5wcm9wKCdkaXNhYmxlZCcsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoJ2EnKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ0YWJpbmRleCIsICItMSIpCiAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoJ2xpJykKICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRjaGVja2JveC5wcm9wKCdjaGVja2VkJywgc2VsZWN0ZWQpOwoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkICYmIHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKSB7CiAgICAgICAgICAgICAgICAkY2hlY2tib3guY2xvc2VzdCgnbGknKQogICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuc2VsZWN0ZWRDbGFzcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBDcmVhdGVzIGEgZGl2aWRlciB1c2luZyB0aGUgZ2l2ZW4gc2VsZWN0IG9wdGlvbi4KICAgICAgICAgKiAKICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeX0gZWxlbWVudAogICAgICAgICAqLwogICAgICAgIGNyZWF0ZURpdmlkZXI6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyICRkaXZpZGVyID0gJCh0aGlzLm9wdGlvbnMudGVtcGxhdGVzLmRpdmlkZXIpOwogICAgICAgICAgICB0aGlzLiR1bC5hcHBlbmQoJGRpdmlkZXIpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIENyZWF0ZXMgYW4gb3B0Z3JvdXAuCiAgICAgICAgICogCiAgICAgICAgICogQHBhcmFtIHtqUXVlcnl9IGdyb3VwCiAgICAgICAgICovCiAgICAgICAgY3JlYXRlT3B0Z3JvdXA6IGZ1bmN0aW9uKGdyb3VwKSB7CiAgICAgICAgICAgIHZhciBncm91cE5hbWUgPSAkKGdyb3VwKS5wcm9wKCdsYWJlbCcpOwoKICAgICAgICAgICAgLy8gQWRkIGEgaGVhZGVyIGZvciB0aGUgZ3JvdXAuCiAgICAgICAgICAgIHZhciAkbGkgPSAkKHRoaXMub3B0aW9ucy50ZW1wbGF0ZXMubGlHcm91cCk7CiAgICAgICAgICAgICQoJ2xhYmVsJywgJGxpKS50ZXh0KGdyb3VwTmFtZSk7CgogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVuYWJsZUNsaWNrYWJsZU9wdEdyb3VwcykgewogICAgICAgICAgICAgICAgJGxpLmFkZENsYXNzKCdtdWx0aXNlbGVjdC1ncm91cC1jbGlja2FibGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy4kdWwuYXBwZW5kKCRsaSk7CgogICAgICAgICAgICBpZiAoJChncm91cCkuaXMoJzpkaXNhYmxlZCcpKSB7CiAgICAgICAgICAgICAgICAkbGkuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFkZCB0aGUgb3B0aW9ucyBvZiB0aGUgZ3JvdXAuCiAgICAgICAgICAgICQoJ29wdGlvbicsIGdyb3VwKS5lYWNoKCQucHJveHkoZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlT3B0aW9uVmFsdWUoZWxlbWVudCk7CiAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBCdWlsZCB0aGUgc2VsY3QgYWxsLgogICAgICAgICAqIAogICAgICAgICAqIENoZWNrcyBpZiBhIHNlbGVjdCBhbGwgaGFzIGFscmVhZHkgYmVlbiBjcmVhdGVkLgogICAgICAgICAqLwogICAgICAgIGJ1aWxkU2VsZWN0QWxsOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuc2VsZWN0QWxsVmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc2VsZWN0QWxsVmFsdWUgPSB0aGlzLm9wdGlvbnMuc2VsZWN0QWxsVmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdmFyIGFscmVhZHlIYXNTZWxlY3RBbGwgPSB0aGlzLmhhc1NlbGVjdEFsbCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFhbHJlYWR5SGFzU2VsZWN0QWxsICYmIHRoaXMub3B0aW9ucy5pbmNsdWRlU2VsZWN0QWxsT3B0aW9uICYmIHRoaXMub3B0aW9ucy5tdWx0aXBsZQogICAgICAgICAgICAgICAgICAgICYmICQoJ29wdGlvbicsIHRoaXMuJHNlbGVjdCkubGVuZ3RoID4gdGhpcy5vcHRpb25zLmluY2x1ZGVTZWxlY3RBbGxJZk1vcmVUaGFuKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENoZWNrIHdoZXRoZXIgdG8gYWRkIGEgZGl2aWRlciBhZnRlciB0aGUgc2VsZWN0IGFsbC4KICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5jbHVkZVNlbGVjdEFsbERpdmlkZXIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiR1bC5wcmVwZW5kKCQodGhpcy5vcHRpb25zLnRlbXBsYXRlcy5kaXZpZGVyKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyICRsaSA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlcy5saSk7CiAgICAgICAgICAgICAgICAkKCdsYWJlbCcsICRsaSkuYWRkQ2xhc3MoImNoZWNrYm94Iik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0QWxsTmFtZSkgewogICAgICAgICAgICAgICAgICAgICQoJ2xhYmVsJywgJGxpKS5hcHBlbmQoJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0iJyArIHRoaXMub3B0aW9ucy5zZWxlY3RBbGxOYW1lICsgJyIgLz4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICQoJ2xhYmVsJywgJGxpKS5hcHBlbmQoJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgLz4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdmFyICRjaGVja2JveCA9ICQoJ2lucHV0JywgJGxpKTsKICAgICAgICAgICAgICAgICRjaGVja2JveC52YWwodGhpcy5vcHRpb25zLnNlbGVjdEFsbFZhbHVlKTsKCiAgICAgICAgICAgICAgICAkbGkuYWRkQ2xhc3MoIm11bHRpc2VsZWN0LWl0ZW0gbXVsdGlzZWxlY3QtYWxsIik7CiAgICAgICAgICAgICAgICAkY2hlY2tib3gucGFyZW50KCkucGFyZW50KCkKICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ211bHRpc2VsZWN0LWFsbCcpOwoKICAgICAgICAgICAgICAgICQoJ2xhYmVsJywgJGxpKS5hcHBlbmQoIiAiICsgdGhpcy5vcHRpb25zLnNlbGVjdEFsbFRleHQpOwoKICAgICAgICAgICAgICAgIHRoaXMuJHVsLnByZXBlbmQoJGxpKTsKCiAgICAgICAgICAgICAgICAkY2hlY2tib3gucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEJ1aWxkcyB0aGUgZmlsdGVyLgogICAgICAgICAqLwogICAgICAgIGJ1aWxkRmlsdGVyOiBmdW5jdGlvbigpIHsKCiAgICAgICAgICAgIC8vIEJ1aWxkIGZpbHRlciBpZiBmaWx0ZXJpbmcgT1IgY2FzZSBpbnNlbnNpdGl2ZSBmaWx0ZXJpbmcgaXMgZW5hYmxlZCBhbmQgdGhlIG51bWJlciBvZiBvcHRpb25zIGV4Y2VlZHMgKG9yIGVxdWFscykgZW5hYmxlRmlsdGVyTGVuZ3RoLgogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVuYWJsZUZpbHRlcmluZyB8fCB0aGlzLm9wdGlvbnMuZW5hYmxlQ2FzZUluc2Vuc2l0aXZlRmlsdGVyaW5nKSB7CiAgICAgICAgICAgICAgICB2YXIgZW5hYmxlRmlsdGVyTGVuZ3RoID0gTWF0aC5tYXgodGhpcy5vcHRpb25zLmVuYWJsZUZpbHRlcmluZywgdGhpcy5vcHRpb25zLmVuYWJsZUNhc2VJbnNlbnNpdGl2ZUZpbHRlcmluZyk7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuJHNlbGVjdC5maW5kKCdvcHRpb24nKS5sZW5ndGggPj0gZW5hYmxlRmlsdGVyTGVuZ3RoKSB7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuJGZpbHRlciA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlcy5maWx0ZXIpOwogICAgICAgICAgICAgICAgICAgICQoJ2lucHV0JywgdGhpcy4kZmlsdGVyKS5hdHRyKCdwbGFjZWhvbGRlcicsIHRoaXMub3B0aW9ucy5maWx0ZXJQbGFjZWhvbGRlcik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkcyBvcHRpb25hbCBmaWx0ZXIgY2xlYXIgYnV0dG9uCiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLmluY2x1ZGVGaWx0ZXJDbGVhckJ0bil7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGVhckJ0biA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlcy5maWx0ZXJDbGVhckJ0bik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyQnRuLm9uKCdjbGljaycsICQucHJveHkoZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2VhcmNoVGltZW91dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRmaWx0ZXIuZmluZCgnLm11bHRpc2VsZWN0LXNlYXJjaCcpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdsaScsIHRoaXMuJHVsKS5zaG93KCkucmVtb3ZlQ2xhc3MoImZpbHRlci1oaWRkZW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0QWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZmlsdGVyLmZpbmQoJy5pbnB1dC1ncm91cCcpLmFwcGVuZChjbGVhckJ0bik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRoaXMuJHVsLnByZXBlbmQodGhpcy4kZmlsdGVyKTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZmlsdGVyLnZhbCh0aGlzLnF1ZXJ5KS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB9KS5vbignaW5wdXQga2V5ZG93bicsICQucHJveHkoZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIGVudGVyIGtleSBkZWZhdWx0IGJlaGF2aW91cgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB1c2VmdWwgdG8gY2F0Y2ggImtleWRvd24iIGV2ZW50cyBhZnRlciB0aGUgYnJvd3NlciBoYXMgdXBkYXRlZCB0aGUgY29udHJvbC4KICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2VhcmNoVGltZW91dCk7CgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlYXJjaFRpbWVvdXQgPSB0aGlzLmFzeW5jRnVuY3Rpb24oJC5wcm94eShmdW5jdGlvbigpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5xdWVyeSAhPT0gZXZlbnQudGFyZ2V0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IGV2ZW50LnRhcmdldC52YWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRHcm91cCwgY3VycmVudEdyb3VwVmlzaWJsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goJCgnbGknLCB0aGlzLiR1bCksICQucHJveHkoZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJCgnaW5wdXQnLCBlbGVtZW50KS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSAkKCdsYWJlbCcsIGVsZW1lbnQpLnRleHQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJDYW5kaWRhdGUgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh0aGlzLm9wdGlvbnMuZmlsdGVyQmVoYXZpb3IgPT09ICd0ZXh0JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckNhbmRpZGF0ZSA9IHRleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHRoaXMub3B0aW9ucy5maWx0ZXJCZWhhdmlvciA9PT0gJ3ZhbHVlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckNhbmRpZGF0ZSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMub3B0aW9ucy5maWx0ZXJCZWhhdmlvciA9PT0gJ2JvdGgnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJDYW5kaWRhdGUgPSB0ZXh0ICsgJ1xuJyArIHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IHRoaXMub3B0aW9ucy5zZWxlY3RBbGxWYWx1ZSAmJiB0ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBCeSBkZWZhdWx0IGxldHMgYXNzdW1lIHRoYXQgZWxlbWVudCBpcyBub3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGludGVyZXN0aW5nIGZvciB0aGlzIHNlYXJjaC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaG93RWxlbWVudCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZW5hYmxlQ2FzZUluc2Vuc2l0aXZlRmlsdGVyaW5nICYmIGZpbHRlckNhbmRpZGF0ZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGhpcy5xdWVyeS50b0xvd2VyQ2FzZSgpKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0VsZW1lbnQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZmlsdGVyQ2FuZGlkYXRlLmluZGV4T2YodGhpcy5xdWVyeSkgPiAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dFbGVtZW50ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUb2dnbGUgY3VycmVudCBlbGVtZW50IChncm91cCBvciBncm91cCBpdGVtKSBhY2NvcmRpbmcgdG8gc2hvd0VsZW1lbnQgYm9vbGVhbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkudG9nZ2xlKHNob3dFbGVtZW50KS50b2dnbGVDbGFzcygnZmlsdGVyLWhpZGRlbicsICFzaG93RWxlbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpZmZlcmVudGlhdGUgZ3JvdXBzIGFuZCBncm91cCBpdGVtcy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKGVsZW1lbnQpLmhhc0NsYXNzKCdtdWx0aXNlbGVjdC1ncm91cCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtZW1iZXIgZ3JvdXAgc3RhdHVzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cCA9IGVsZW1lbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEdyb3VwVmlzaWJsZSA9IHNob3dFbGVtZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyBncm91cCBuYW1lIHdoZW4gYXQgbGVhc3Qgb25lIG9mIGl0cyBpdGVtcyBpcyB2aXNpYmxlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG93RWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRHcm91cCkuc2hvdygpLnJlbW92ZUNsYXNzKCdmaWx0ZXItaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNob3cgYWxsIGdyb3VwIGl0ZW1zIHdoZW4gZ3JvdXAgbmFtZSBzYXRpc2ZpZXMgZmlsdGVyLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2hvd0VsZW1lbnQgJiYgY3VycmVudEdyb3VwVmlzaWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNob3coKS5yZW1vdmVDbGFzcygnZmlsdGVyLWhpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdEFsbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSwgMzAwLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBVbmJpbmRzIHRoZSB3aG9sZSBwbHVnaW4uCiAgICAgICAgICovCiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuJGNvbnRhaW5lci5yZW1vdmUoKTsKICAgICAgICAgICAgdGhpcy4kc2VsZWN0LnNob3coKTsKICAgICAgICAgICAgdGhpcy4kc2VsZWN0LmRhdGEoJ211bHRpc2VsZWN0JywgbnVsbCk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmVmcmVzaHMgdGhlIG11bHRpc2VsZWN0IGJhc2VkIG9uIHRoZSBzZWxlY3RlZCBvcHRpb25zIG9mIHRoZSBzZWxlY3QuCiAgICAgICAgICovCiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICQoJ29wdGlvbicsIHRoaXMuJHNlbGVjdCkuZWFjaCgkLnByb3h5KGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCgnbGkgaW5wdXQnLCB0aGlzLiR1bCkuZmlsdGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLnZhbCgpID09PSAkKGVsZW1lbnQpLnZhbCgpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKCQoZWxlbWVudCkuaXMoJzpzZWxlY3RlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgJGlucHV0LnByb3AoJ2NoZWNrZWQnLCB0cnVlKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbnB1dC5jbG9zZXN0KCdsaScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3ModGhpcy5vcHRpb25zLnNlbGVjdGVkQ2xhc3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRpbnB1dC5wcm9wKCdjaGVja2VkJywgZmFsc2UpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNlbGVjdGVkQ2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LmNsb3Nlc3QoJ2xpJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuc2VsZWN0ZWRDbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkKGVsZW1lbnQpLmlzKCI6ZGlzYWJsZWQiKSkgewogICAgICAgICAgICAgICAgICAgICRpbnB1dC5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5wcm9wKCdkaXNhYmxlZCcsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIC5jbG9zZXN0KCdsaScpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRpbnB1dC5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAuY2xvc2VzdCgnbGknKQogICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgICAgIHRoaXMudXBkYXRlQnV0dG9uVGV4dCgpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdEFsbCgpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdCBhbGwgb3B0aW9ucyBvZiB0aGUgZ2l2ZW4gdmFsdWVzLgogICAgICAgICAqIAogICAgICAgICAqIElmIHRyaWdnZXJPbkNoYW5nZSBpcyBzZXQgdG8gdHJ1ZSwgdGhlIG9uIGNoYW5nZSBldmVudCBpcyB0cmlnZ2VyZWQgaWYKICAgICAgICAgKiBhbmQgb25seSBpZiBvbmUgdmFsdWUgaXMgcGFzc2VkLgogICAgICAgICAqIAogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHNlbGVjdFZhbHVlcwogICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdHJpZ2dlck9uQ2hhbmdlCiAgICAgICAgICovCiAgICAgICAgc2VsZWN0OiBmdW5jdGlvbihzZWxlY3RWYWx1ZXMsIHRyaWdnZXJPbkNoYW5nZSkgewogICAgICAgICAgICBpZighJC5pc0FycmF5KHNlbGVjdFZhbHVlcykpIHsKICAgICAgICAgICAgICAgIHNlbGVjdFZhbHVlcyA9IFtzZWxlY3RWYWx1ZXNdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdFZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gc2VsZWN0VmFsdWVzW2ldOwoKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyICRvcHRpb24gPSB0aGlzLmdldE9wdGlvbkJ5VmFsdWUodmFsdWUpOwogICAgICAgICAgICAgICAgdmFyICRjaGVja2JveCA9IHRoaXMuZ2V0SW5wdXRCeVZhbHVlKHZhbHVlKTsKCiAgICAgICAgICAgICAgICBpZigkb3B0aW9uID09PSB1bmRlZmluZWQgfHwgJGNoZWNrYm94ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMubXVsdGlwbGUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc2VsZWN0QWxsKGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgJGNoZWNrYm94LmNsb3Nlc3QoJ2xpJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkY2hlY2tib3gucHJvcCgnY2hlY2tlZCcsIHRydWUpOwogICAgICAgICAgICAgICAgJG9wdGlvbi5wcm9wKCdzZWxlY3RlZCcsIHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnVwZGF0ZUJ1dHRvblRleHQoKTsKICAgICAgICAgICAgdGhpcy51cGRhdGVTZWxlY3RBbGwoKTsKCiAgICAgICAgICAgIGlmICh0cmlnZ2VyT25DaGFuZ2UgJiYgc2VsZWN0VmFsdWVzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm9uQ2hhbmdlKCRvcHRpb24sIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2xlYXJzIGFsbCBzZWxlY3RlZCBpdGVtcy4KICAgICAgICAgKi8KICAgICAgICBjbGVhclNlbGVjdGlvbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmRlc2VsZWN0QWxsKGZhbHNlKTsKICAgICAgICAgICAgdGhpcy51cGRhdGVCdXR0b25UZXh0KCk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0QWxsKCk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogRGVzZWxlY3RzIGFsbCBvcHRpb25zIG9mIHRoZSBnaXZlbiB2YWx1ZXMuCiAgICAgICAgICogCiAgICAgICAgICogSWYgdHJpZ2dlck9uQ2hhbmdlIGlzIHNldCB0byB0cnVlLCB0aGUgb24gY2hhbmdlIGV2ZW50IGlzIHRyaWdnZXJlZCwgaWYKICAgICAgICAgKiBhbmQgb25seSBpZiBvbmUgdmFsdWUgaXMgcGFzc2VkLgogICAgICAgICAqIAogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGRlc2VsZWN0VmFsdWVzCiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSB0cmlnZ2VyT25DaGFuZ2UKICAgICAgICAgKi8KICAgICAgICBkZXNlbGVjdDogZnVuY3Rpb24oZGVzZWxlY3RWYWx1ZXMsIHRyaWdnZXJPbkNoYW5nZSkgewogICAgICAgICAgICBpZighJC5pc0FycmF5KGRlc2VsZWN0VmFsdWVzKSkgewogICAgICAgICAgICAgICAgZGVzZWxlY3RWYWx1ZXMgPSBbZGVzZWxlY3RWYWx1ZXNdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRlc2VsZWN0VmFsdWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkZXNlbGVjdFZhbHVlc1tpXTsKCiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciAkb3B0aW9uID0gdGhpcy5nZXRPcHRpb25CeVZhbHVlKHZhbHVlKTsKICAgICAgICAgICAgICAgIHZhciAkY2hlY2tib3ggPSB0aGlzLmdldElucHV0QnlWYWx1ZSh2YWx1ZSk7CgogICAgICAgICAgICAgICAgaWYoJG9wdGlvbiA9PT0gdW5kZWZpbmVkIHx8ICRjaGVja2JveCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgJGNoZWNrYm94LmNsb3Nlc3QoJ2xpJykKICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkY2hlY2tib3gucHJvcCgnY2hlY2tlZCcsIGZhbHNlKTsKICAgICAgICAgICAgICAgICRvcHRpb24ucHJvcCgnc2VsZWN0ZWQnLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMudXBkYXRlQnV0dG9uVGV4dCgpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdEFsbCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRyaWdnZXJPbkNoYW5nZSAmJiBkZXNlbGVjdFZhbHVlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5vbkNoYW5nZSgkb3B0aW9uLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIFNlbGVjdHMgYWxsIGVuYWJsZWQgJiB2aXNpYmxlIG9wdGlvbnMuCiAgICAgICAgICoKICAgICAgICAgKiBJZiBqdXN0VmlzaWJsZSBpcyB0cnVlIG9yIG5vdCBzcGVjaWZpZWQsIG9ubHkgdmlzaWJsZSBvcHRpb25zIGFyZSBzZWxlY3RlZC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0ganVzdFZpc2libGUKICAgICAgICAgKi8KICAgICAgICBzZWxlY3RBbGw6IGZ1bmN0aW9uIChqdXN0VmlzaWJsZSkgewogICAgICAgICAgICB2YXIganVzdFZpc2libGUgPSB0eXBlb2YganVzdFZpc2libGUgPT09ICd1bmRlZmluZWQnID8gdHJ1ZSA6IGp1c3RWaXNpYmxlOwogICAgICAgICAgICB2YXIgYWxsQ2hlY2tib3hlcyA9ICQoImxpIGlucHV0W3R5cGU9J2NoZWNrYm94J106ZW5hYmxlZCIsIHRoaXMuJHVsKTsKICAgICAgICAgICAgdmFyIHZpc2libGVDaGVja2JveGVzID0gYWxsQ2hlY2tib3hlcy5maWx0ZXIoIjp2aXNpYmxlIik7CiAgICAgICAgICAgIHZhciBhbGxDaGVja2JveGVzQ291bnQgPSBhbGxDaGVja2JveGVzLmxlbmd0aDsKICAgICAgICAgICAgdmFyIHZpc2libGVDaGVja2JveGVzQ291bnQgPSB2aXNpYmxlQ2hlY2tib3hlcy5sZW5ndGg7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihqdXN0VmlzaWJsZSkgewogICAgICAgICAgICAgICAgdmlzaWJsZUNoZWNrYm94ZXMucHJvcCgnY2hlY2tlZCcsIHRydWUpOwogICAgICAgICAgICAgICAgJCgibGk6bm90KC5kaXZpZGVyKTpub3QoLmRpc2FibGVkKSIsIHRoaXMuJHVsKS5maWx0ZXIoIjp2aXNpYmxlIikuYWRkQ2xhc3ModGhpcy5vcHRpb25zLnNlbGVjdGVkQ2xhc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYWxsQ2hlY2tib3hlcy5wcm9wKCdjaGVja2VkJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAkKCJsaTpub3QoLmRpdmlkZXIpOm5vdCguZGlzYWJsZWQpIiwgdGhpcy4kdWwpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChhbGxDaGVja2JveGVzQ291bnQgPT09IHZpc2libGVDaGVja2JveGVzQ291bnQgfHwganVzdFZpc2libGUgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAkKCJvcHRpb246ZW5hYmxlZCIsIHRoaXMuJHNlbGVjdCkucHJvcCgnc2VsZWN0ZWQnLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB2aXNpYmxlQ2hlY2tib3hlcy5tYXAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQodGhpcykudmFsKCk7CiAgICAgICAgICAgICAgICB9KS5nZXQoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJCgib3B0aW9uOmVuYWJsZWQiLCB0aGlzLiRzZWxlY3QpLmZpbHRlcihmdW5jdGlvbihpbmRleCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkLmluQXJyYXkoJCh0aGlzKS52YWwoKSwgdmFsdWVzKSAhPT0gLTE7CiAgICAgICAgICAgICAgICB9KS5wcm9wKCdzZWxlY3RlZCcsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogRGVzZWxlY3RzIGFsbCBvcHRpb25zLgogICAgICAgICAqIAogICAgICAgICAqIElmIGp1c3RWaXNpYmxlIGlzIHRydWUgb3Igbm90IHNwZWNpZmllZCwgb25seSB2aXNpYmxlIG9wdGlvbnMgYXJlIGRlc2VsZWN0ZWQuCiAgICAgICAgICogCiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBqdXN0VmlzaWJsZQogICAgICAgICAqLwogICAgICAgIGRlc2VsZWN0QWxsOiBmdW5jdGlvbiAoanVzdFZpc2libGUpIHsKICAgICAgICAgICAgdmFyIGp1c3RWaXNpYmxlID0gdHlwZW9mIGp1c3RWaXNpYmxlID09PSAndW5kZWZpbmVkJyA\/IHRydWUgOiBqdXN0VmlzaWJsZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKGp1c3RWaXNpYmxlKSB7ICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZhciB2aXNpYmxlQ2hlY2tib3hlcyA9ICQoImxpIGlucHV0W3R5cGU9J2NoZWNrYm94J106ZW5hYmxlZCIsIHRoaXMuJHVsKS5maWx0ZXIoIjp2aXNpYmxlIik7CiAgICAgICAgICAgICAgICB2aXNpYmxlQ2hlY2tib3hlcy5wcm9wKCdjaGVja2VkJywgZmFsc2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgdmFsdWVzID0gdmlzaWJsZUNoZWNrYm94ZXMubWFwKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLnZhbCgpOwogICAgICAgICAgICAgICAgfSkuZ2V0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICQoIm9wdGlvbjplbmFibGVkIiwgdGhpcy4kc2VsZWN0KS5maWx0ZXIoZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJC5pbkFycmF5KCQodGhpcykudmFsKCksIHZhbHVlcykgIT09IC0xOwogICAgICAgICAgICAgICAgfSkucHJvcCgnc2VsZWN0ZWQnLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0ZWRDbGFzcykgewogICAgICAgICAgICAgICAgICAgICQoImxpOm5vdCguZGl2aWRlcik6bm90KC5kaXNhYmxlZCkiLCB0aGlzLiR1bCkuZmlsdGVyKCI6dmlzaWJsZSIpLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICQoImxpIGlucHV0W3R5cGU9J2NoZWNrYm94J106ZW5hYmxlZCIsIHRoaXMuJHVsKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpOwogICAgICAgICAgICAgICAgJCgib3B0aW9uOmVuYWJsZWQiLCB0aGlzLiRzZWxlY3QpLnByb3AoJ3NlbGVjdGVkJywgZmFsc2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNlbGVjdGVkQ2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICAkKCJsaTpub3QoLmRpdmlkZXIpOm5vdCguZGlzYWJsZWQpIiwgdGhpcy4kdWwpLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5zZWxlY3RlZENsYXNzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFJlYnVpbGQgdGhlIHBsdWdpbi4KICAgICAgICAgKiAKICAgICAgICAgKiBSZWJ1aWxkcyB0aGUgZHJvcGRvd24sIHRoZSBmaWx0ZXIgYW5kIHRoZSBzZWxlY3QgYWxsIG9wdGlvbi4KICAgICAgICAgKi8KICAgICAgICByZWJ1aWxkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy4kdWwuaHRtbCgnJyk7CgogICAgICAgICAgICAvLyBJbXBvcnRhbnQgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiByYWRpb3MgYW5kIGNoZWNrYm94ZXMuCiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tdWx0aXBsZSA9IHRoaXMuJHNlbGVjdC5hdHRyKCdtdWx0aXBsZScpID09PSAibXVsdGlwbGUiOwoKICAgICAgICAgICAgdGhpcy5idWlsZFNlbGVjdEFsbCgpOwogICAgICAgICAgICB0aGlzLmJ1aWxkRHJvcGRvd25PcHRpb25zKCk7CiAgICAgICAgICAgIHRoaXMuYnVpbGRGaWx0ZXIoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMudXBkYXRlQnV0dG9uVGV4dCgpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdEFsbCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlSWZFbXB0eSAmJiAkKCdvcHRpb24nLCB0aGlzLiRzZWxlY3QpLmxlbmd0aCA8PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRpc2FibGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kcm9wUmlnaHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHVsLmFkZENsYXNzKCdwdWxsLXJpZ2h0Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBUaGUgcHJvdmlkZWQgZGF0YSB3aWxsIGJlIHVzZWQgdG8gYnVpbGQgdGhlIGRyb3Bkb3duLgogICAgICAgICAqLwogICAgICAgIGRhdGFwcm92aWRlcjogZnVuY3Rpb24oZGF0YXByb3ZpZGVyKSB7CiAgICAgICAgICAgIHZhciBvcHRpb25ET00gPSAiIjsKICAgICAgICAgICAgdmFyIGdyb3VwQ291bnRlciA9IDA7CiAgICAgICAgICAgIHZhciB0YWdzID0gJCgnJyk7IC8vIGNyZWF0ZSBlbXB0eSBqUXVlcnkgYXJyYXkKCiAgICAgICAgICAgICQuZWFjaChkYXRhcHJvdmlkZXIsIGZ1bmN0aW9uIChpbmRleCwgb3B0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgdGFnOwogICAgICAgICAgICAgICAgaWYgKCQuaXNBcnJheShvcHRpb24uY2hpbGRyZW4pKSB7IC8vIGNyZWF0ZSBvcHRpb25ncm91cCB0YWcKICAgICAgICAgICAgICAgICAgICBncm91cENvdW50ZXIrKzsKICAgICAgICAgICAgICAgICAgICB0YWcgPSAkKCc8b3B0Z3JvdXAvPicpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogb3B0aW9uLmxhYmVsIHx8ICdHcm91cCAnICsgZ3JvdXBDb3VudGVyCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZm9yRWFjaChvcHRpb24uY2hpbGRyZW4sIGZ1bmN0aW9uKHN1Yk9wdGlvbikgeyAvLyBhZGQgY2hpbGRyZW4gb3B0aW9uIHRhZ3MKICAgICAgICAgICAgICAgICAgICAgICAgdGFnLmFwcGVuZCgkKCc8b3B0aW9uLz4nKS5hdHRyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBzdWJPcHRpb24udmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogc3ViT3B0aW9uLmxhYmVsIHx8IHN1Yk9wdGlvbi52YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzdWJPcHRpb24udGl0bGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogISFzdWJPcHRpb24uc2VsZWN0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBvcHRpb25ET00gKz0gJzwvb3B0Z3JvdXA+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBjcmVhdGUgb3B0aW9uIHRhZwogICAgICAgICAgICAgICAgICAgIHRhZyA9ICQoJzxvcHRpb24vPicpLmF0dHIoewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb3B0aW9uLnZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogb3B0aW9uLmxhYmVsIHx8IG9wdGlvbi52YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG9wdGlvbi50aXRsZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6ICEhb3B0aW9uLnNlbGVjdGVkCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGFncyA9IHRhZ3MuYWRkKHRhZyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy4kc2VsZWN0LmVtcHR5KCkuYXBwZW5kKHRhZ3MpOwogICAgICAgICAgICB0aGlzLnJlYnVpbGQoKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBFbmFibGUgdGhlIG11bHRpc2VsZWN0LgogICAgICAgICAqLwogICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuJHNlbGVjdC5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTsKICAgICAgICAgICAgdGhpcy4kYnV0dG9uLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpCiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogRGlzYWJsZSB0aGUgbXVsdGlzZWxlY3QuCiAgICAgICAgICovCiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMuJHNlbGVjdC5wcm9wKCdkaXNhYmxlZCcsIHRydWUpOwogICAgICAgICAgICB0aGlzLiRidXR0b24ucHJvcCgnZGlzYWJsZWQnLCB0cnVlKQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCdkaXNhYmxlZCcpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFNldCB0aGUgb3B0aW9ucy4KICAgICAgICAgKiAKICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBvcHRpb25zCiAgICAgICAgICovCiAgICAgICAgc2V0T3B0aW9uczogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLm1lcmdlT3B0aW9ucyhvcHRpb25zKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBNZXJnZXMgdGhlIGdpdmVuIG9wdGlvbnMgd2l0aCB0aGUgZGVmYXVsdCBvcHRpb25zLgogICAgICAgICAqIAogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IG9wdGlvbnMKICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICAgICAgICovCiAgICAgICAgbWVyZ2VPcHRpb25zOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5kZWZhdWx0cywgb3B0aW9ucyk7CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBDaGVja3Mgd2hldGhlciBhIHNlbGVjdCBhbGwgY2hlY2tib3ggaXMgcHJlc2VudC4KICAgICAgICAgKiAKICAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0KICAgICAgICAgKi8KICAgICAgICBoYXNTZWxlY3RBbGw6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJCgnbGkuJyArIHRoaXMub3B0aW9ucy5zZWxlY3RBbGxWYWx1ZSwgdGhpcy4kdWwpLmxlbmd0aCA+IDA7CiAgICAgICAgfSwKICAgICAgICAKICAgICAgICAvKioKICAgICAgICAgKiBVcGRhdGVzIHRoZSBzZWxlY3QgYWxsIGNoZWNrYm94IGJhc2VkIG9uIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIGFuZCBzZWxlY3RlZCBjaGVja2JveGVzLgogICAgICAgICAqLwogICAgICAgIHVwZGF0ZVNlbGVjdEFsbDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmhhc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgICAgICB2YXIgYWxsQm94ZXMgPSAkKCJsaTpub3QoLm11bHRpc2VsZWN0LWl0ZW0pOm5vdCguZmlsdGVyLWhpZGRlbikgaW5wdXQ6ZW5hYmxlZCIsIHRoaXMuJHVsKTsKICAgICAgICAgICAgICAgIHZhciBhbGxCb3hlc0xlbmd0aCA9IGFsbEJveGVzLmxlbmd0aDsKICAgICAgICAgICAgICAgIHZhciBjaGVja2VkQm94ZXNMZW5ndGggPSBhbGxCb3hlcy5maWx0ZXIoIjpjaGVja2VkIikubGVuZ3RoOwogICAgICAgICAgICAgICAgdmFyIHNlbGVjdEFsbExpICA9ICQoImxpLiIgKyB0aGlzLm9wdGlvbnMuc2VsZWN0QWxsVmFsdWUsIHRoaXMuJHVsKTsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3RBbGxJbnB1dCA9IHNlbGVjdEFsbExpLmZpbmQoImlucHV0Iik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChjaGVja2VkQm94ZXNMZW5ndGggPiAwICYmIGNoZWNrZWRCb3hlc0xlbmd0aCA9PT0gYWxsQm94ZXNMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3RBbGxJbnB1dC5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0QWxsTGkuYWRkQ2xhc3ModGhpcy5vcHRpb25zLnNlbGVjdGVkQ2xhc3MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0QWxsSW5wdXQucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBzZWxlY3RBbGxMaS5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuc2VsZWN0ZWRDbGFzcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIAogICAgICAgIC8qKgogICAgICAgICAqIFVwZGF0ZSB0aGUgYnV0dG9uIHRleHQgYW5kIGl0cyB0aXRsZSBiYXNlZCBvbiB0aGUgY3VycmVudGx5IHNlbGVjdGVkIG9wdGlvbnMuCiAgICAgICAgICovCiAgICAgICAgdXBkYXRlQnV0dG9uVGV4dDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRTZWxlY3RlZCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRoZSBkaXNwbGF5ZWQgYnV0dG9uIHRleHQuCiAgICAgICAgICAgICQoJy5tdWx0aXNlbGVjdCcsIHRoaXMuJGNvbnRhaW5lcikuaHRtbCh0aGlzLm9wdGlvbnMuYnV0dG9uVGV4dChvcHRpb25zLCB0aGlzLiRzZWxlY3QpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE5vdyB1cGRhdGUgdGhlIHRpdGxlIGF0dHJpYnV0ZSBvZiB0aGUgYnV0dG9uLgogICAgICAgICAgICAkKCcubXVsdGlzZWxlY3QnLCB0aGlzLiRjb250YWluZXIpLmF0dHIoJ3RpdGxlJywgdGhpcy5vcHRpb25zLmJ1dHRvblRpdGxlKG9wdGlvbnMsIHRoaXMuJHNlbGVjdCkpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEdldCBhbGwgc2VsZWN0ZWQgb3B0aW9ucy4KICAgICAgICAgKiAKICAgICAgICAgKiBAcmV0dXJucyB7alFVZXJ5fQogICAgICAgICAqLwogICAgICAgIGdldFNlbGVjdGVkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICQoJ29wdGlvbicsIHRoaXMuJHNlbGVjdCkuZmlsdGVyKCI6c2VsZWN0ZWQiKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBHZXRzIGEgc2VsZWN0IG9wdGlvbiBieSBpdHMgdmFsdWUuCiAgICAgICAgICogCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlCiAgICAgICAgICogQHJldHVybnMge2pRdWVyeX0KICAgICAgICAgKi8KICAgICAgICBnZXRPcHRpb25CeVZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsKCiAgICAgICAgICAgIHZhciBvcHRpb25zID0gJCgnb3B0aW9uJywgdGhpcy4kc2VsZWN0KTsKICAgICAgICAgICAgdmFyIHZhbHVlVG9Db21wYXJlID0gdmFsdWUudG9TdHJpbmcoKTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkgPSBpICsgMSkgewogICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG9wdGlvbnNbaV07CiAgICAgICAgICAgICAgICBpZiAob3B0aW9uLnZhbHVlID09PSB2YWx1ZVRvQ29tcGFyZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkKG9wdGlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBHZXQgdGhlIGlucHV0IChyYWRpby9jaGVja2JveCkgYnkgaXRzIHZhbHVlLgogICAgICAgICAqIAogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZQogICAgICAgICAqIEByZXR1cm5zIHtqUXVlcnl9CiAgICAgICAgICovCiAgICAgICAgZ2V0SW5wdXRCeVZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsKCiAgICAgICAgICAgIHZhciBjaGVja2JveGVzID0gJCgnbGkgaW5wdXQnLCB0aGlzLiR1bCk7CiAgICAgICAgICAgIHZhciB2YWx1ZVRvQ29tcGFyZSA9IHZhbHVlLnRvU3RyaW5nKCk7CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoZWNrYm94ZXMubGVuZ3RoOyBpID0gaSArIDEpIHsKICAgICAgICAgICAgICAgIHZhciBjaGVja2JveCA9IGNoZWNrYm94ZXNbaV07CiAgICAgICAgICAgICAgICBpZiAoY2hlY2tib3gudmFsdWUgPT09IHZhbHVlVG9Db21wYXJlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQoY2hlY2tib3gpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogVXNlZCBmb3Iga25vY2tvdXQgaW50ZWdyYXRpb24uCiAgICAgICAgICovCiAgICAgICAgdXBkYXRlT3JpZ2luYWxPcHRpb25zOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5vcmlnaW5hbE9wdGlvbnMgPSB0aGlzLiRzZWxlY3QuY2xvbmUoKVswXS5vcHRpb25zOwogICAgICAgIH0sCgogICAgICAgIGFzeW5jRnVuY3Rpb246IGZ1bmN0aW9uKGNhbGxiYWNrLCB0aW1lb3V0LCBzZWxmKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAzKTsKICAgICAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzZWxmIHx8IHdpbmRvdywgYXJncyk7CiAgICAgICAgICAgIH0sIHRpbWVvdXQpOwogICAgICAgIH0KICAgIH07CgogICAgJC5mbi5tdWx0aXNlbGVjdCA9IGZ1bmN0aW9uKG9wdGlvbiwgcGFyYW1ldGVyLCBleHRyYU9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZGF0YSA9ICQodGhpcykuZGF0YSgnbXVsdGlzZWxlY3QnKTsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09PSAnb2JqZWN0JyAmJiBvcHRpb247CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBtdWx0aXNlbGVjdC4KICAgICAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICAgICAgICBkYXRhID0gbmV3IE11bHRpc2VsZWN0KHRoaXMsIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgJCh0aGlzKS5kYXRhKCdtdWx0aXNlbGVjdCcsIGRhdGEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDYWxsIG11bHRpc2VsZWN0IG1ldGhvZC4KICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb24gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICBkYXRhW29wdGlvbl0ocGFyYW1ldGVyLCBleHRyYU9wdGlvbnMpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAob3B0aW9uID09PSAnZGVzdHJveScpIHsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ211bHRpc2VsZWN0JywgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgICQuZm4ubXVsdGlzZWxlY3QuQ29uc3RydWN0b3IgPSBNdWx0aXNlbGVjdDsKCiAgICAkKGZ1bmN0aW9uKCkgewogICAgICAgICQoInNlbGVjdFtkYXRhLXJvbGU9bXVsdGlzZWxlY3RdIikubXVsdGlzZWxlY3QoKTsKICAgIH0pOwoKfSh3aW5kb3cualF1ZXJ5KTs=",
    "size": "47918"
}