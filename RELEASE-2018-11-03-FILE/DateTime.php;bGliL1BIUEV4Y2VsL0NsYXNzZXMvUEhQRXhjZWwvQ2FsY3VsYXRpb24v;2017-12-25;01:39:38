{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Calculation\/DateTime.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KICAgIGRlZmluZSgnUEhQRVhDRUxfUk9PVCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8uLi8uLi8nKTsKICAgIHJlcXVpcmUoUEhQRVhDRUxfUk9PVCAuICdQSFBFeGNlbC9BdXRvbG9hZGVyLnBocCcpOwp9CgovKioKICogUEhQRXhjZWxfQ2FsY3VsYXRpb25fRGF0ZVRpbWUKICoKICogQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbAogKgogKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCiAqIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQQogKgogKiBAY2F0ZWdvcnkgICAgUEhQRXhjZWwKICogQHBhY2thZ2UgICAgICAgIFBIUEV4Y2VsX0NhbGN1bGF0aW9uCiAqIEBjb3B5cmlnaHQgICAgQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbCAoaHR0cDovL3d3dy5jb2RlcGxleC5jb20vUEhQRXhjZWwpCiAqIEBsaWNlbnNlICAgICAgICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvb2xkLWxpY2Vuc2VzL2xncGwtMi4xLnR4dCAgICBMR1BMCiAqIEB2ZXJzaW9uICAgICAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCmNsYXNzIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0RhdGVUaW1lCnsKICAgIC8qKgogICAgICogSWRlbnRpZnkgaWYgYSB5ZWFyIGlzIGEgbGVhcCB5ZWFyIG9yIG5vdAogICAgICoKICAgICAqIEBwYXJhbSAgICBpbnRlZ2VyICAgICR5ZWFyICAgIFRoZSB5ZWFyIHRvIHRlc3QKICAgICAqIEByZXR1cm4gICAgYm9vbGVhbiAgICAgICAgICAgIFRSVUUgaWYgdGhlIHllYXIgaXMgYSBsZWFwIHllYXIsIG90aGVyd2lzZSBGQUxTRQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGlzTGVhcFllYXIoJHllYXIpCiAgICB7CiAgICAgICAgcmV0dXJuICgoKCR5ZWFyICUgNCkgPT0gMCkgJiYgKCgkeWVhciAlIDEwMCkgIT0gMCkgfHwgKCgkeWVhciAlIDQwMCkgPT0gMCkpOwogICAgfQoKCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIGRheXMgYmV0d2VlbiB0d28gZGF0ZXMgYmFzZWQgb24gYSAzNjAgZGF5IGNhbGVuZGFyCiAgICAgKgogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgJHN0YXJ0RGF5ICAgICAgICBEYXkgb2YgbW9udGggb2YgdGhlIHN0YXJ0IGRhdGUKICAgICAqIEBwYXJhbSAgICBpbnRlZ2VyICAgICRzdGFydE1vbnRoICAgICAgICBNb250aCBvZiB0aGUgc3RhcnQgZGF0ZQogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgJHN0YXJ0WWVhciAgICAgICAgWWVhciBvZiB0aGUgc3RhcnQgZGF0ZQogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgJGVuZERheSAgICAgICAgICAgIERheSBvZiBtb250aCBvZiB0aGUgc3RhcnQgZGF0ZQogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgJGVuZE1vbnRoICAgICAgICBNb250aCBvZiB0aGUgc3RhcnQgZGF0ZQogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgJGVuZFllYXIgICAgICAgIFllYXIgb2YgdGhlIHN0YXJ0IGRhdGUKICAgICAqIEBwYXJhbSAgICBib29sZWFuICRtZXRob2RVUyAgICAgICAgV2hldGhlciB0byB1c2UgdGhlIFVTIG1ldGhvZCBvciB0aGUgRXVyb3BlYW4gbWV0aG9kIG9mIGNhbGN1bGF0aW9uCiAgICAgKiBAcmV0dXJuICAgIGludGVnZXIgICAgTnVtYmVyIG9mIGRheXMgYmV0d2VlbiB0aGUgc3RhcnQgZGF0ZSBhbmQgdGhlIGVuZCBkYXRlCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGRhdGVEaWZmMzYwKCRzdGFydERheSwgJHN0YXJ0TW9udGgsICRzdGFydFllYXIsICRlbmREYXksICRlbmRNb250aCwgJGVuZFllYXIsICRtZXRob2RVUykKICAgIHsKICAgICAgICBpZiAoJHN0YXJ0RGF5ID09IDMxKSB7CiAgICAgICAgICAgIC0tJHN0YXJ0RGF5OwogICAgICAgIH0gZWxzZWlmICgkbWV0aG9kVVMgJiYgKCRzdGFydE1vbnRoID09IDIgJiYgKCRzdGFydERheSA9PSAyOSB8fCAoJHN0YXJ0RGF5ID09IDI4ICYmICFzZWxmOjppc0xlYXBZZWFyKCRzdGFydFllYXIpKSkpKSB7CiAgICAgICAgICAgICRzdGFydERheSA9IDMwOwogICAgICAgIH0KICAgICAgICBpZiAoJGVuZERheSA9PSAzMSkgewogICAgICAgICAgICBpZiAoJG1ldGhvZFVTICYmICRzdGFydERheSAhPSAzMCkgewogICAgICAgICAgICAgICAgJGVuZERheSA9IDE7CiAgICAgICAgICAgICAgICBpZiAoJGVuZE1vbnRoID09IDEyKSB7CiAgICAgICAgICAgICAgICAgICAgKyskZW5kWWVhcjsKICAgICAgICAgICAgICAgICAgICAkZW5kTW9udGggPSAxOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICArKyRlbmRNb250aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRlbmREYXkgPSAzMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRlbmREYXkgKyAkZW5kTW9udGggKiAzMCArICRlbmRZZWFyICogMzYwIC0gJHN0YXJ0RGF5IC0gJHN0YXJ0TW9udGggKiAzMCAtICRzdGFydFllYXIgKiAzNjA7CiAgICB9CgoKICAgIC8qKgogICAgICogZ2V0RGF0ZVZhbHVlCiAgICAgKgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAkZGF0ZVZhbHVlCiAgICAgKiBAcmV0dXJuICAgIG1peGVkICAgIEV4Y2VsIGRhdGUvdGltZSBzZXJpYWwgdmFsdWUsIG9yIHN0cmluZyBpZiBlcnJvcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldERhdGVWYWx1ZSgkZGF0ZVZhbHVlKQogICAgewogICAgICAgIGlmICghaXNfbnVtZXJpYygkZGF0ZVZhbHVlKSkgewogICAgICAgICAgICBpZiAoKGlzX3N0cmluZygkZGF0ZVZhbHVlKSkgJiYKICAgICAgICAgICAgICAgIChQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmdldENvbXBhdGliaWxpdHlNb2RlKCkgPT0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpDT01QQVRJQklMSVRZX0dOVU1FUklDKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGlzX29iamVjdCgkZGF0ZVZhbHVlKSkgJiYgKCRkYXRlVmFsdWUgaW5zdGFuY2VvZiBEYXRlVGltZSkpIHsKICAgICAgICAgICAgICAgICRkYXRlVmFsdWUgPSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6UEhQVG9FeGNlbCgkZGF0ZVZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRzYXZlUmV0dXJuRGF0ZVR5cGUgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmdldFJldHVybkRhdGVUeXBlKCk7CiAgICAgICAgICAgICAgICBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OnNldFJldHVybkRhdGVUeXBlKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9FWENFTCk7CiAgICAgICAgICAgICAgICAkZGF0ZVZhbHVlID0gc2VsZjo6REFURVZBTFVFKCRkYXRlVmFsdWUpOwogICAgICAgICAgICAgICAgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpzZXRSZXR1cm5EYXRlVHlwZSgkc2F2ZVJldHVybkRhdGVUeXBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJGRhdGVWYWx1ZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBnZXRUaW1lVmFsdWUKICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICR0aW1lVmFsdWUKICAgICAqIEByZXR1cm4gICAgbWl4ZWQgICAgRXhjZWwgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSwgb3Igc3RyaW5nIGlmIGVycm9yCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGdldFRpbWVWYWx1ZSgkdGltZVZhbHVlKQogICAgewogICAgICAgICRzYXZlUmV0dXJuRGF0ZVR5cGUgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmdldFJldHVybkRhdGVUeXBlKCk7CiAgICAgICAgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpzZXRSZXR1cm5EYXRlVHlwZShQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfRVhDRUwpOwogICAgICAgICR0aW1lVmFsdWUgPSBzZWxmOjpUSU1FVkFMVUUoJHRpbWVWYWx1ZSk7CiAgICAgICAgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpzZXRSZXR1cm5EYXRlVHlwZSgkc2F2ZVJldHVybkRhdGVUeXBlKTsKICAgICAgICByZXR1cm4gJHRpbWVWYWx1ZTsKICAgIH0KCgogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gYWRqdXN0RGF0ZUJ5TW9udGhzKCRkYXRlVmFsdWUgPSAwLCAkYWRqdXN0bWVudE1vbnRocyA9IDApCiAgICB7CiAgICAgICAgLy8gRXhlY3V0ZSBmdW5jdGlvbgogICAgICAgICRQSFBEYXRlT2JqZWN0ID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFBPYmplY3QoJGRhdGVWYWx1ZSk7CiAgICAgICAgJG9Nb250aCA9IChpbnQpICRQSFBEYXRlT2JqZWN0LT5mb3JtYXQoJ20nKTsKICAgICAgICAkb1llYXIgPSAoaW50KSAkUEhQRGF0ZU9iamVjdC0+Zm9ybWF0KCdZJyk7CgogICAgICAgICRhZGp1c3RtZW50TW9udGhzU3RyaW5nID0gKHN0cmluZykgJGFkanVzdG1lbnRNb250aHM7CiAgICAgICAgaWYgKCRhZGp1c3RtZW50TW9udGhzID4gMCkgewogICAgICAgICAgICAkYWRqdXN0bWVudE1vbnRoc1N0cmluZyA9ICcrJy4kYWRqdXN0bWVudE1vbnRoczsKICAgICAgICB9CiAgICAgICAgaWYgKCRhZGp1c3RtZW50TW9udGhzICE9IDApIHsKICAgICAgICAgICAgJFBIUERhdGVPYmplY3QtPm1vZGlmeSgkYWRqdXN0bWVudE1vbnRoc1N0cmluZy4nIG1vbnRocycpOwogICAgICAgIH0KICAgICAgICAkbk1vbnRoID0gKGludCkgJFBIUERhdGVPYmplY3QtPmZvcm1hdCgnbScpOwogICAgICAgICRuWWVhciA9IChpbnQpICRQSFBEYXRlT2JqZWN0LT5mb3JtYXQoJ1knKTsKCiAgICAgICAgJG1vbnRoRGlmZiA9ICgkbk1vbnRoIC0gJG9Nb250aCkgKyAoKCRuWWVhciAtICRvWWVhcikgKiAxMik7CiAgICAgICAgaWYgKCRtb250aERpZmYgIT0gJGFkanVzdG1lbnRNb250aHMpIHsKICAgICAgICAgICAgJGFkanVzdERheXMgPSAoaW50KSAkUEhQRGF0ZU9iamVjdC0+Zm9ybWF0KCdkJyk7CiAgICAgICAgICAgICRhZGp1c3REYXlzU3RyaW5nID0gJy0nLiRhZGp1c3REYXlzLicgZGF5cyc7CiAgICAgICAgICAgICRQSFBEYXRlT2JqZWN0LT5tb2RpZnkoJGFkanVzdERheXNTdHJpbmcpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJFBIUERhdGVPYmplY3Q7CiAgICB9CgoKICAgIC8qKgogICAgICogREFURVRJTUVOT1cKICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGRhdGUgYW5kIHRpbWUuCiAgICAgKiBUaGUgTk9XIGZ1bmN0aW9uIGlzIHVzZWZ1bCB3aGVuIHlvdSBuZWVkIHRvIGRpc3BsYXkgdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZSBvbiBhIHdvcmtzaGVldCBvcgogICAgICogY2FsY3VsYXRlIGEgdmFsdWUgYmFzZWQgb24gdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZSwgYW5kIGhhdmUgdGhhdCB2YWx1ZSB1cGRhdGVkIGVhY2ggdGltZSB5b3UKICAgICAqIG9wZW4gdGhlIHdvcmtzaGVldC4KICAgICAqCiAgICAgKiBOT1RFOiBXaGVuIHVzZWQgaW4gYSBDZWxsIEZvcm11bGEsIE1TIEV4Y2VsIGNoYW5nZXMgdGhlIGNlbGwgZm9ybWF0IHNvIHRoYXQgaXQgbWF0Y2hlcyB0aGUgZGF0ZQogICAgICogYW5kIHRpbWUgZm9ybWF0IG9mIHlvdXIgcmVnaW9uYWwgc2V0dGluZ3MuIFBIUEV4Y2VsIGRvZXMgbm90IGNoYW5nZSBjZWxsIGZvcm1hdHRpbmcgaW4gdGhpcyB3YXkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgTk9XKCkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGUvVGltZSBGdW5jdGlvbnMKICAgICAqIEByZXR1cm4gICAgbWl4ZWQgICAgRXhjZWwgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSwgUEhQIGRhdGUvdGltZSBzZXJpYWwgdmFsdWUgb3IgUEhQIGRhdGUvdGltZSBvYmplY3QsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGluZyBvbiB0aGUgdmFsdWUgb2YgdGhlIFJldHVybkRhdGVUeXBlIGZsYWcKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEQVRFVElNRU5PVygpCiAgICB7CiAgICAgICAgJHNhdmVUaW1lWm9uZSA9IGRhdGVfZGVmYXVsdF90aW1lem9uZV9nZXQoKTsKICAgICAgICBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCdVVEMnKTsKICAgICAgICAkcmV0VmFsdWUgPSBmYWxzZTsKICAgICAgICBzd2l0Y2ggKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Z2V0UmV0dXJuRGF0ZVR5cGUoKSkgewogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9FWENFTDoKICAgICAgICAgICAgICAgICRyZXRWYWx1ZSA9IChmbG9hdCkgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUFRvRXhjZWwodGltZSgpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9QSFBfTlVNRVJJQzoKICAgICAgICAgICAgICAgICRyZXRWYWx1ZSA9IChpbnRlZ2VyKSB0aW1lKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfUEhQX09CSkVDVDoKICAgICAgICAgICAgICAgICRyZXRWYWx1ZSA9IG5ldyBEYXRlVGltZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGRhdGVfZGVmYXVsdF90aW1lem9uZV9zZXQoJHNhdmVUaW1lWm9uZSk7CgogICAgICAgIHJldHVybiAkcmV0VmFsdWU7CiAgICB9CgoKICAgIC8qKgogICAgICogREFURU5PVwogICAgICoKICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgZGF0ZS4KICAgICAqIFRoZSBOT1cgZnVuY3Rpb24gaXMgdXNlZnVsIHdoZW4geW91IG5lZWQgdG8gZGlzcGxheSB0aGUgY3VycmVudCBkYXRlIGFuZCB0aW1lIG9uIGEgd29ya3NoZWV0IG9yCiAgICAgKiBjYWxjdWxhdGUgYSB2YWx1ZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkYXRlIGFuZCB0aW1lLCBhbmQgaGF2ZSB0aGF0IHZhbHVlIHVwZGF0ZWQgZWFjaCB0aW1lIHlvdQogICAgICogb3BlbiB0aGUgd29ya3NoZWV0LgogICAgICoKICAgICAqIE5PVEU6IFdoZW4gdXNlZCBpbiBhIENlbGwgRm9ybXVsYSwgTVMgRXhjZWwgY2hhbmdlcyB0aGUgY2VsbCBmb3JtYXQgc28gdGhhdCBpdCBtYXRjaGVzIHRoZSBkYXRlCiAgICAgKiBhbmQgdGltZSBmb3JtYXQgb2YgeW91ciByZWdpb25hbCBzZXR0aW5ncy4gUEhQRXhjZWwgZG9lcyBub3QgY2hhbmdlIGNlbGwgZm9ybWF0dGluZyBpbiB0aGlzIHdheS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBUT0RBWSgpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRlL1RpbWUgRnVuY3Rpb25zCiAgICAgKiBAcmV0dXJuICAgIG1peGVkICAgIEV4Y2VsIGRhdGUvdGltZSBzZXJpYWwgdmFsdWUsIFBIUCBkYXRlL3RpbWUgc2VyaWFsIHZhbHVlIG9yIFBIUCBkYXRlL3RpbWUgb2JqZWN0LAogICAgICogICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRpbmcgb24gdGhlIHZhbHVlIG9mIHRoZSBSZXR1cm5EYXRlVHlwZSBmbGFnCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gREFURU5PVygpCiAgICB7CiAgICAgICAgJHNhdmVUaW1lWm9uZSA9IGRhdGVfZGVmYXVsdF90aW1lem9uZV9nZXQoKTsKICAgICAgICBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCdVVEMnKTsKICAgICAgICAkcmV0VmFsdWUgPSBmYWxzZTsKICAgICAgICAkZXhjZWxEYXRlVGltZSA9IGZsb29yKFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpQSFBUb0V4Y2VsKHRpbWUoKSkpOwogICAgICAgIHN3aXRjaCAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRSZXR1cm5EYXRlVHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX0VYQ0VMOgogICAgICAgICAgICAgICAgJHJldFZhbHVlID0gKGZsb2F0KSAkZXhjZWxEYXRlVGltZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9QSFBfTlVNRVJJQzoKICAgICAgICAgICAgICAgICRyZXRWYWx1ZSA9IChpbnRlZ2VyKSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6RXhjZWxUb1BIUCgkZXhjZWxEYXRlVGltZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfUEhQX09CSkVDVDoKICAgICAgICAgICAgICAgICRyZXRWYWx1ZSA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQT2JqZWN0KCRleGNlbERhdGVUaW1lKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KCRzYXZlVGltZVpvbmUpOwoKICAgICAgICByZXR1cm4gJHJldFZhbHVlOwogICAgfQoKCiAgICAvKioKICAgICAqIERBVEUKICAgICAqCiAgICAgKiBUaGUgREFURSBmdW5jdGlvbiByZXR1cm5zIGEgdmFsdWUgdGhhdCByZXByZXNlbnRzIGEgcGFydGljdWxhciBkYXRlLgogICAgICoKICAgICAqIE5PVEU6IFdoZW4gdXNlZCBpbiBhIENlbGwgRm9ybXVsYSwgTVMgRXhjZWwgY2hhbmdlcyB0aGUgY2VsbCBmb3JtYXQgc28gdGhhdCBpdCBtYXRjaGVzIHRoZSBkYXRlCiAgICAgKiBmb3JtYXQgb2YgeW91ciByZWdpb25hbCBzZXR0aW5ncy4gUEhQRXhjZWwgZG9lcyBub3QgY2hhbmdlIGNlbGwgZm9ybWF0dGluZyBpbiB0aGlzIHdheS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBEQVRFKHllYXIsbW9udGgsZGF5KQogICAgICoKICAgICAqIFBIUEV4Y2VsIGlzIGEgbG90IG1vcmUgZm9yZ2l2aW5nIHRoYW4gTVMgRXhjZWwgd2hlbiBwYXNzaW5nIG5vbiBudW1lcmljIHZhbHVlcyB0byB0aGlzIGZ1bmN0aW9uLgogICAgICogQSBNb250aCBuYW1lIG9yIGFiYnJldmlhdGlvbiAoRW5nbGlzaCBvbmx5IGF0IHRoaXMgcG9pbnQpIHN1Y2ggYXMgJ0phbnVhcnknIG9yICdKYW4nIHdpbGwgc3RpbGwgYmUgYWNjZXB0ZWQsCiAgICAgKiAgICAgYXMgd2lsbCBhIGRheSB2YWx1ZSB3aXRoIGEgc3VmZml4IChlLmcuICcyMXN0JyByYXRoZXIgdGhhbiBzaW1wbHkgMjEpOyBhZ2FpbiBvbmx5IEVuZ2xpc2ggbGFuZ3VhZ2UuCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRlL1RpbWUgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgaW50ZWdlciAgICAgICAgJHllYXIgICAgVGhlIHZhbHVlIG9mIHRoZSB5ZWFyIGFyZ3VtZW50IGNhbiBpbmNsdWRlIG9uZSB0byBmb3VyIGRpZ2l0cy4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeGNlbCBpbnRlcnByZXRzIHRoZSB5ZWFyIGFyZ3VtZW50IGFjY29yZGluZyB0byB0aGUgY29uZmlndXJlZAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgc3lzdGVtOiAxOTAwIG9yIDE5MDQuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgeWVhciBpcyBiZXR3ZWVuIDAgKHplcm8pIGFuZCAxODk5IChpbmNsdXNpdmUpLCBFeGNlbCBhZGRzIHRoYXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSB0byAxOTAwIHRvIGNhbGN1bGF0ZSB0aGUgeWVhci4gRm9yIGV4YW1wbGUsIERBVEUoMTA4LDEsMikKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIEphbnVhcnkgMiwgMjAwOCAoMTkwMCsxMDgpLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHllYXIgaXMgYmV0d2VlbiAxOTAwIGFuZCA5OTk5IChpbmNsdXNpdmUpLCBFeGNlbCB1c2VzIHRoYXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSBhcyB0aGUgeWVhci4gRm9yIGV4YW1wbGUsIERBVEUoMjAwOCwxLDIpIHJldHVybnMgSmFudWFyeSAyLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIwMDguCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgeWVhciBpcyBsZXNzIHRoYW4gMCBvciBpcyAxMDAwMCBvciBncmVhdGVyLCBFeGNlbCByZXR1cm5zIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNOVU0hIGVycm9yIHZhbHVlLgogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgICAgICRtb250aCAgICBBIHBvc2l0aXZlIG9yIG5lZ2F0aXZlIGludGVnZXIgcmVwcmVzZW50aW5nIHRoZSBtb250aCBvZiB0aGUgeWVhcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gMSB0byAxMiAoSmFudWFyeSB0byBEZWNlbWJlcikuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgbW9udGggaXMgZ3JlYXRlciB0aGFuIDEyLCBtb250aCBhZGRzIHRoYXQgbnVtYmVyIG9mIG1vbnRocyB0bwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaXJzdCBtb250aCBpbiB0aGUgeWVhciBzcGVjaWZpZWQuIEZvciBleGFtcGxlLCBEQVRFKDIwMDgsMTQsMikKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIHRoZSBzZXJpYWwgbnVtYmVyIHJlcHJlc2VudGluZyBGZWJydWFyeSAyLCAyMDA5LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIG1vbnRoIGlzIGxlc3MgdGhhbiAxLCBtb250aCBzdWJ0cmFjdHMgdGhlIG1hZ25pdHVkZSBvZiB0aGF0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyIG9mIG1vbnRocywgcGx1cyAxLCBmcm9tIHRoZSBmaXJzdCBtb250aCBpbiB0aGUgeWVhcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmllZC4gRm9yIGV4YW1wbGUsIERBVEUoMjAwOCwtMywyKSByZXR1cm5zIHRoZSBzZXJpYWwgbnVtYmVyCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwcmVzZW50aW5nIFNlcHRlbWJlciAyLCAyMDA3LgogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgICAgICRkYXkgICAgQSBwb3NpdGl2ZSBvciBuZWdhdGl2ZSBpbnRlZ2VyIHJlcHJlc2VudGluZyB0aGUgZGF5IG9mIHRoZSBtb250aAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gMSB0byAzMS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiBkYXkgaXMgZ3JlYXRlciB0aGFuIHRoZSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgbW9udGggc3BlY2lmaWVkLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheSBhZGRzIHRoYXQgbnVtYmVyIG9mIGRheXMgdG8gdGhlIGZpcnN0IGRheSBpbiB0aGUgbW9udGguIEZvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4YW1wbGUsIERBVEUoMjAwOCwxLDM1KSByZXR1cm5zIHRoZSBzZXJpYWwgbnVtYmVyIHJlcHJlc2VudGluZwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZlYnJ1YXJ5IDQsIDIwMDguCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgZGF5IGlzIGxlc3MgdGhhbiAxLCBkYXkgc3VidHJhY3RzIHRoZSBtYWduaXR1ZGUgdGhhdCBudW1iZXIgb2YKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlzLCBwbHVzIG9uZSwgZnJvbSB0aGUgZmlyc3QgZGF5IG9mIHRoZSBtb250aCBzcGVjaWZpZWQuIEZvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4YW1wbGUsIERBVEUoMjAwOCwxLC0xNSkgcmV0dXJucyB0aGUgc2VyaWFsIG51bWJlciByZXByZXNlbnRpbmcKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNlbWJlciAxNiwgMjAwNy4KICAgICAqIEByZXR1cm4gICAgbWl4ZWQgICAgRXhjZWwgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSwgUEhQIGRhdGUvdGltZSBzZXJpYWwgdmFsdWUgb3IgUEhQIGRhdGUvdGltZSBvYmplY3QsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGluZyBvbiB0aGUgdmFsdWUgb2YgdGhlIFJldHVybkRhdGVUeXBlIGZsYWcKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEQVRFKCR5ZWFyID0gMCwgJG1vbnRoID0gMSwgJGRheSA9IDEpCiAgICB7CiAgICAgICAgJHllYXIgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJHllYXIpOwogICAgICAgICRtb250aCA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRtb250aCk7CiAgICAgICAgJGRheSAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGRheSk7CgogICAgICAgIGlmICgoJG1vbnRoICE9PSBudWxsKSAmJiAoIWlzX251bWVyaWMoJG1vbnRoKSkpIHsKICAgICAgICAgICAgJG1vbnRoID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6Om1vbnRoU3RyaW5nVG9OdW1iZXIoJG1vbnRoKTsKICAgICAgICB9CgogICAgICAgIGlmICgoJGRheSAhPT0gbnVsbCkgJiYgKCFpc19udW1lcmljKCRkYXkpKSkgewogICAgICAgICAgICAkZGF5ID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OmRheVN0cmluZ1RvTnVtYmVyKCRkYXkpOwogICAgICAgIH0KCiAgICAgICAgJHllYXIgPSAoJHllYXIgIT09IG51bGwpID8gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6dGVzdFN0cmluZ0FzTnVtZXJpYygkeWVhcikgOiAwOwogICAgICAgICRtb250aCA9ICgkbW9udGggIT09IG51bGwpID8gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6dGVzdFN0cmluZ0FzTnVtZXJpYygkbW9udGgpIDogMDsKICAgICAgICAkZGF5ID0gKCRkYXkgIT09IG51bGwpID8gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6dGVzdFN0cmluZ0FzTnVtZXJpYygkZGF5KSA6IDA7CiAgICAgICAgaWYgKCghaXNfbnVtZXJpYygkeWVhcikpIHx8CiAgICAgICAgICAgICghaXNfbnVtZXJpYygkbW9udGgpKSB8fAogICAgICAgICAgICAoIWlzX251bWVyaWMoJGRheSkpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQogICAgICAgICR5ZWFyICAgID0gKGludGVnZXIpICR5ZWFyOwogICAgICAgICRtb250aCAgICA9IChpbnRlZ2VyKSAkbW9udGg7CiAgICAgICAgJGRheSAgICA9IChpbnRlZ2VyKSAkZGF5OwoKICAgICAgICAkYmFzZVllYXIgPSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6Z2V0RXhjZWxDYWxlbmRhcigpOwogICAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnMKICAgICAgICBpZiAoJHllYXIgPCAoJGJhc2VZZWFyLTE5MDApKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KICAgICAgICBpZiAoKCgkYmFzZVllYXItMTkwMCkgIT0gMCkgJiYgKCR5ZWFyIDwgJGJhc2VZZWFyKSAmJiAoJHllYXIgPj0gMTkwMCkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoKCR5ZWFyIDwgJGJhc2VZZWFyKSAmJiAoJHllYXIgPj0gKCRiYXNlWWVhci0xOTAwKSkpIHsKICAgICAgICAgICAgJHllYXIgKz0gMTkwMDsKICAgICAgICB9CgogICAgICAgIGlmICgkbW9udGggPCAxKSB7CiAgICAgICAgICAgIC8vICAgIEhhbmRsZSB5ZWFyL21vbnRoIGFkanVzdG1lbnQgaWYgbW9udGggPCAxCiAgICAgICAgICAgIC0tJG1vbnRoOwogICAgICAgICAgICAkeWVhciArPSBjZWlsKCRtb250aCAvIDEyKSAtIDE7CiAgICAgICAgICAgICRtb250aCA9IDEzIC0gYWJzKCRtb250aCAlIDEyKTsKICAgICAgICB9IGVsc2VpZiAoJG1vbnRoID4gMTIpIHsKICAgICAgICAgICAgLy8gICAgSGFuZGxlIHllYXIvbW9udGggYWRqdXN0bWVudCBpZiBtb250aCA+IDEyCiAgICAgICAgICAgICR5ZWFyICs9IGZsb29yKCRtb250aCAvIDEyKTsKICAgICAgICAgICAgJG1vbnRoID0gKCRtb250aCAlIDEyKTsKICAgICAgICB9CgogICAgICAgIC8vIFJlLXZhbGlkYXRlIHRoZSB5ZWFyIHBhcmFtZXRlciBhZnRlciBhZGp1c3RtZW50cwogICAgICAgIGlmICgoJHllYXIgPCAkYmFzZVllYXIpIHx8ICgkeWVhciA+PSAxMDAwMCkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBFeGVjdXRlIGZ1bmN0aW9uCiAgICAgICAgJGV4Y2VsRGF0ZVZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkZvcm1hdHRlZFBIUFRvRXhjZWwoJHllYXIsICRtb250aCwgJGRheSk7CiAgICAgICAgc3dpdGNoIChQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmdldFJldHVybkRhdGVUeXBlKCkpIHsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfRVhDRUw6CiAgICAgICAgICAgICAgICByZXR1cm4gKGZsb2F0KSAkZXhjZWxEYXRlVmFsdWU7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX1BIUF9OVU1FUklDOgogICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlZ2VyKSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6RXhjZWxUb1BIUCgkZXhjZWxEYXRlVmFsdWUpOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9QSFBfT0JKRUNUOgogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQT2JqZWN0KCRleGNlbERhdGVWYWx1ZSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIFRJTUUKICAgICAqCiAgICAgKiBUaGUgVElNRSBmdW5jdGlvbiByZXR1cm5zIGEgdmFsdWUgdGhhdCByZXByZXNlbnRzIGEgcGFydGljdWxhciB0aW1lLgogICAgICoKICAgICAqIE5PVEU6IFdoZW4gdXNlZCBpbiBhIENlbGwgRm9ybXVsYSwgTVMgRXhjZWwgY2hhbmdlcyB0aGUgY2VsbCBmb3JtYXQgc28gdGhhdCBpdCBtYXRjaGVzIHRoZSB0aW1lCiAgICAgKiBmb3JtYXQgb2YgeW91ciByZWdpb25hbCBzZXR0aW5ncy4gUEhQRXhjZWwgZG9lcyBub3QgY2hhbmdlIGNlbGwgZm9ybWF0dGluZyBpbiB0aGlzIHdheS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBUSU1FKGhvdXIsbWludXRlLHNlY29uZCkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGUvVGltZSBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBpbnRlZ2VyICAgICAgICAkaG91ciAgICAgICAgQSBudW1iZXIgZnJvbSAwICh6ZXJvKSB0byAzMjc2NyByZXByZXNlbnRpbmcgdGhlIGhvdXIuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFueSB2YWx1ZSBncmVhdGVyIHRoYW4gMjMgd2lsbCBiZSBkaXZpZGVkIGJ5IDI0IGFuZCB0aGUgcmVtYWluZGVyCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbGwgYmUgdHJlYXRlZCBhcyB0aGUgaG91ciB2YWx1ZS4gRm9yIGV4YW1wbGUsIFRJTUUoMjcsMCwwKSA9CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRJTUUoMywwLDApID0gLjEyNSBvciAzOjAwIEFNLgogICAgICogQHBhcmFtICAgIGludGVnZXIgICAgICAgICRtaW51dGUgICAgICAgIEEgbnVtYmVyIGZyb20gMCB0byAzMjc2NyByZXByZXNlbnRpbmcgdGhlIG1pbnV0ZS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQW55IHZhbHVlIGdyZWF0ZXIgdGhhbiA1OSB3aWxsIGJlIGNvbnZlcnRlZCB0byBob3VycyBhbmQgbWludXRlcy4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9yIGV4YW1wbGUsIFRJTUUoMCw3NTAsMCkgPSBUSU1FKDEyLDMwLDApID0gLjUyMDgzMyBvciAxMjozMCBQTS4KICAgICAqIEBwYXJhbSAgICBpbnRlZ2VyICAgICAgICAkc2Vjb25kICAgICAgICBBIG51bWJlciBmcm9tIDAgdG8gMzI3NjcgcmVwcmVzZW50aW5nIHRoZSBzZWNvbmQuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFueSB2YWx1ZSBncmVhdGVyIHRoYW4gNTkgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gaG91cnMsIG1pbnV0ZXMsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBzZWNvbmRzLiBGb3IgZXhhbXBsZSwgVElNRSgwLDAsMjAwMCkgPSBUSU1FKDAsMzMsMjIpID0gLjAyMzE0OAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAxMjozMzoyMCBBTQogICAgICogQHJldHVybiAgICBtaXhlZCAgICBFeGNlbCBkYXRlL3RpbWUgc2VyaWFsIHZhbHVlLCBQSFAgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSBvciBQSFAgZGF0ZS90aW1lIG9iamVjdCwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSBvZiB0aGUgUmV0dXJuRGF0ZVR5cGUgZmxhZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFRJTUUoJGhvdXIgPSAwLCAkbWludXRlID0gMCwgJHNlY29uZCA9IDApCiAgICB7CiAgICAgICAgJGhvdXIgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkaG91cik7CiAgICAgICAgJG1pbnV0ZSA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRtaW51dGUpOwogICAgICAgICRzZWNvbmQgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkc2Vjb25kKTsKCiAgICAgICAgaWYgKCRob3VyID09ICcnKSB7CiAgICAgICAgICAgICRob3VyID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKCRtaW51dGUgPT0gJycpIHsKICAgICAgICAgICAgJG1pbnV0ZSA9IDA7CiAgICAgICAgfQogICAgICAgIGlmICgkc2Vjb25kID09ICcnKSB7CiAgICAgICAgICAgICRzZWNvbmQgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKCghaXNfbnVtZXJpYygkaG91cikpIHx8ICghaXNfbnVtZXJpYygkbWludXRlKSkgfHwgKCFpc19udW1lcmljKCRzZWNvbmQpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KICAgICAgICAkaG91ciA9IChpbnRlZ2VyKSAkaG91cjsKICAgICAgICAkbWludXRlID0gKGludGVnZXIpICRtaW51dGU7CiAgICAgICAgJHNlY29uZCA9IChpbnRlZ2VyKSAkc2Vjb25kOwoKICAgICAgICBpZiAoJHNlY29uZCA8IDApIHsKICAgICAgICAgICAgJG1pbnV0ZSArPSBmbG9vcigkc2Vjb25kIC8gNjApOwogICAgICAgICAgICAkc2Vjb25kID0gNjAgLSBhYnMoJHNlY29uZCAlIDYwKTsKICAgICAgICAgICAgaWYgKCRzZWNvbmQgPT0gNjApIHsKICAgICAgICAgICAgICAgICRzZWNvbmQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlaWYgKCRzZWNvbmQgPj0gNjApIHsKICAgICAgICAgICAgJG1pbnV0ZSArPSBmbG9vcigkc2Vjb25kIC8gNjApOwogICAgICAgICAgICAkc2Vjb25kID0gJHNlY29uZCAlIDYwOwogICAgICAgIH0KICAgICAgICBpZiAoJG1pbnV0ZSA8IDApIHsKICAgICAgICAgICAgJGhvdXIgKz0gZmxvb3IoJG1pbnV0ZSAvIDYwKTsKICAgICAgICAgICAgJG1pbnV0ZSA9IDYwIC0gYWJzKCRtaW51dGUgJSA2MCk7CiAgICAgICAgICAgIGlmICgkbWludXRlID09IDYwKSB7CiAgICAgICAgICAgICAgICAkbWludXRlID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZWlmICgkbWludXRlID49IDYwKSB7CiAgICAgICAgICAgICRob3VyICs9IGZsb29yKCRtaW51dGUgLyA2MCk7CiAgICAgICAgICAgICRtaW51dGUgPSAkbWludXRlICUgNjA7CiAgICAgICAgfQoKICAgICAgICBpZiAoJGhvdXIgPiAyMykgewogICAgICAgICAgICAkaG91ciA9ICRob3VyICUgMjQ7CiAgICAgICAgfSBlbHNlaWYgKCRob3VyIDwgMCkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICB9CgogICAgICAgIC8vIEV4ZWN1dGUgZnVuY3Rpb24KICAgICAgICBzd2l0Y2ggKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Z2V0UmV0dXJuRGF0ZVR5cGUoKSkgewogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9FWENFTDoKICAgICAgICAgICAgICAgICRkYXRlID0gMDsKICAgICAgICAgICAgICAgICRjYWxlbmRhciA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpnZXRFeGNlbENhbGVuZGFyKCk7CiAgICAgICAgICAgICAgICBpZiAoJGNhbGVuZGFyICE9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpDQUxFTkRBUl9XSU5ET1dTXzE5MDApIHsKICAgICAgICAgICAgICAgICAgICAkZGF0ZSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gKGZsb2F0KSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6Rm9ybWF0dGVkUEhQVG9FeGNlbCgkY2FsZW5kYXIsIDEsICRkYXRlLCAkaG91ciwgJG1pbnV0ZSwgJHNlY29uZCk7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX1BIUF9OVU1FUklDOgogICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlZ2VyKSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6RXhjZWxUb1BIUChQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6Rm9ybWF0dGVkUEhQVG9FeGNlbCgxOTcwLCAxLCAxLCAkaG91ciwgJG1pbnV0ZSwgJHNlY29uZCkpOyAgICAvLyAtMjE0NzQ2ODQwMDsgLy8gICAgLTIxNDc0NzIwMDAgKyAzNjAwCiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX1BIUF9PQkpFQ1Q6CiAgICAgICAgICAgICAgICAkZGF5QWRqdXN0ID0gMDsKICAgICAgICAgICAgICAgIGlmICgkaG91ciA8IDApIHsKICAgICAgICAgICAgICAgICAgICAkZGF5QWRqdXN0ID0gZmxvb3IoJGhvdXIgLyAyNCk7CiAgICAgICAgICAgICAgICAgICAgJGhvdXIgPSAyNCAtIGFicygkaG91ciAlIDI0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGhvdXIgPT0gMjQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGhvdXIgPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkaG91ciA+PSAyNCkgewogICAgICAgICAgICAgICAgICAgICRkYXlBZGp1c3QgPSBmbG9vcigkaG91ciAvIDI0KTsKICAgICAgICAgICAgICAgICAgICAkaG91ciA9ICRob3VyICUgMjQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkcGhwRGF0ZU9iamVjdCA9IG5ldyBEYXRlVGltZSgnMTkwMC0wMS0wMSAnLiRob3VyLic6Jy4kbWludXRlLic6Jy4kc2Vjb25kKTsKICAgICAgICAgICAgICAgIGlmICgkZGF5QWRqdXN0ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAkcGhwRGF0ZU9iamVjdC0+bW9kaWZ5KCRkYXlBZGp1c3QuJyBkYXlzJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJHBocERhdGVPYmplY3Q7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIERBVEVWQUxVRQogICAgICoKICAgICAqIFJldHVybnMgYSB2YWx1ZSB0aGF0IHJlcHJlc2VudHMgYSBwYXJ0aWN1bGFyIGRhdGUuCiAgICAgKiBVc2UgREFURVZBTFVFIHRvIGNvbnZlcnQgYSBkYXRlIHJlcHJlc2VudGVkIGJ5IGEgdGV4dCBzdHJpbmcgdG8gYW4gRXhjZWwgb3IgUEhQIGRhdGUvdGltZSBzdGFtcAogICAgICogdmFsdWUuCiAgICAgKgogICAgICogTk9URTogV2hlbiB1c2VkIGluIGEgQ2VsbCBGb3JtdWxhLCBNUyBFeGNlbCBjaGFuZ2VzIHRoZSBjZWxsIGZvcm1hdCBzbyB0aGF0IGl0IG1hdGNoZXMgdGhlIGRhdGUKICAgICAqIGZvcm1hdCBvZiB5b3VyIHJlZ2lvbmFsIHNldHRpbmdzLiBQSFBFeGNlbCBkb2VzIG5vdCBjaGFuZ2UgY2VsbCBmb3JtYXR0aW5nIGluIHRoaXMgd2F5LgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIERBVEVWQUxVRShkYXRlVmFsdWUpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRlL1RpbWUgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICRkYXRlVmFsdWUgICAgICAgIFRleHQgdGhhdCByZXByZXNlbnRzIGEgZGF0ZSBpbiBhIE1pY3Jvc29mdCBFeGNlbCBkYXRlIGZvcm1hdC4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9yIGV4YW1wbGUsICIxLzMwLzIwMDgiIG9yICIzMC1KYW4tMjAwOCIgYXJlIHRleHQgc3RyaW5ncyB3aXRoaW4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGF0aW9uIG1hcmtzIHRoYXQgcmVwcmVzZW50IGRhdGVzLiBVc2luZyB0aGUgZGVmYXVsdCBkYXRlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5c3RlbSBpbiBFeGNlbCBmb3IgV2luZG93cywgZGF0ZV90ZXh0IG11c3QgcmVwcmVzZW50IGEgZGF0ZSBmcm9tCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEphbnVhcnkgMSwgMTkwMCwgdG8gRGVjZW1iZXIgMzEsIDk5OTkuIFVzaW5nIHRoZSBkZWZhdWx0IGRhdGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lzdGVtIGluIEV4Y2VsIGZvciB0aGUgTWFjaW50b3NoLCBkYXRlX3RleHQgbXVzdCByZXByZXNlbnQgYSBkYXRlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gSmFudWFyeSAxLCAxOTA0LCB0byBEZWNlbWJlciAzMSwgOTk5OS4gREFURVZBTFVFIHJldHVybnMgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNWQUxVRSEgZXJyb3IgdmFsdWUgaWYgZGF0ZV90ZXh0IGlzIG91dCBvZiB0aGlzIHJhbmdlLgogICAgICogQHJldHVybiAgICBtaXhlZCAgICBFeGNlbCBkYXRlL3RpbWUgc2VyaWFsIHZhbHVlLCBQSFAgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSBvciBQSFAgZGF0ZS90aW1lIG9iamVjdCwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSBvZiB0aGUgUmV0dXJuRGF0ZVR5cGUgZmxhZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIERBVEVWQUxVRSgkZGF0ZVZhbHVlID0gMSkKICAgIHsKICAgICAgICAkZGF0ZVZhbHVlID0gdHJpbShQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkZGF0ZVZhbHVlKSwgJyInKTsKICAgICAgICAvLyAgICBTdHJpcCBhbnkgb3JkaW5hbHMgYmVjYXVzZSB0aGV5J3JlIGFsbG93ZWQgaW4gRXhjZWwgKEVuZ2xpc2ggb25seSkKICAgICAgICAkZGF0ZVZhbHVlID0gcHJlZ19yZXBsYWNlKCcvKFxkKShzdHxuZHxyZHx0aCkoWyAtXC9dKS9VaScsICckMSQzJywgJGRhdGVWYWx1ZSk7CiAgICAgICAgLy8gICAgQ29udmVydCBzZXBhcmF0b3JzICgvIC4gb3Igc3BhY2UpIHRvIGh5cGhlbnMgKHNob3VsZCBhbHNvIGhhbmRsZSBkb3QgdXNlZCBmb3Igb3JkaW5hbHMgaW4gc29tZSBjb3VudHJpZXMsIGUuZy4gRGVubWFyaywgR2VybWFueSkKICAgICAgICAkZGF0ZVZhbHVlICAgID0gc3RyX3JlcGxhY2UoYXJyYXkoJy8nLCAnLicsICctJywgJyAgJyksIGFycmF5KCcgJywgJyAnLCAnICcsICcgJyksICRkYXRlVmFsdWUpOwoKICAgICAgICAkeWVhckZvdW5kID0gZmFsc2U7CiAgICAgICAgJHQxID0gZXhwbG9kZSgnICcsICRkYXRlVmFsdWUpOwogICAgICAgIGZvcmVhY2ggKCR0MSBhcyAmJHQpIHsKICAgICAgICAgICAgaWYgKChpc19udW1lcmljKCR0KSkgJiYgKCR0ID4gMzEpKSB7CiAgICAgICAgICAgICAgICBpZiAoJHllYXJGb3VuZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgkdCA8IDEwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkdCArPSAxOTAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkeWVhckZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoKGNvdW50KCR0MSkgPT0gMSkgJiYgKHN0cnBvcygkdCwgJzonKSAhPSBmYWxzZSkpIHsKICAgICAgICAgICAgLy8gICAgV2UndmUgYmVlbiBmZWQgYSB0aW1lIHZhbHVlIHdpdGhvdXQgYW55IGRhdGUKICAgICAgICAgICAgcmV0dXJuIDAuMDsKICAgICAgICB9IGVsc2VpZiAoY291bnQoJHQxKSA9PSAyKSB7CiAgICAgICAgICAgIC8vICAgIFdlIG9ubHkgaGF2ZSB0d28gcGFydHMgb2YgdGhlIGRhdGU6IGVpdGhlciBkYXkvbW9udGggb3IgbW9udGgveWVhcgogICAgICAgICAgICBpZiAoJHllYXJGb3VuZCkgewogICAgICAgICAgICAgICAgYXJyYXlfdW5zaGlmdCgkdDEsIDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkdDEsIGRhdGUoJ1knKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdW5zZXQoJHQpOwogICAgICAgICRkYXRlVmFsdWUgPSBpbXBsb2RlKCcgJywgJHQxKTsKCiAgICAgICAgJFBIUERhdGVBcnJheSA9IGRhdGVfcGFyc2UoJGRhdGVWYWx1ZSk7CiAgICAgICAgaWYgKCgkUEhQRGF0ZUFycmF5ID09PSBmYWxzZSkgfHwgKCRQSFBEYXRlQXJyYXlbJ2Vycm9yX2NvdW50J10gPiAwKSkgewogICAgICAgICAgICAkdGVzdFZhbDEgPSBzdHJ0b2soJGRhdGVWYWx1ZSwgJy0gJyk7CiAgICAgICAgICAgIGlmICgkdGVzdFZhbDEgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAkdGVzdFZhbDIgPSBzdHJ0b2soJy0gJyk7CiAgICAgICAgICAgICAgICBpZiAoJHRlc3RWYWwyICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICR0ZXN0VmFsMyA9IHN0cnRvaygnLSAnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHRlc3RWYWwzID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGVzdFZhbDMgPSBzdHJmdGltZSgnJVknKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRQSFBEYXRlQXJyYXkgPSBkYXRlX3BhcnNlKCR0ZXN0VmFsMS4nLScuJHRlc3RWYWwyLictJy4kdGVzdFZhbDMpOwogICAgICAgICAgICBpZiAoKCRQSFBEYXRlQXJyYXkgPT09IGZhbHNlKSB8fCAoJFBIUERhdGVBcnJheVsnZXJyb3JfY291bnQnXSA+IDApKSB7CiAgICAgICAgICAgICAgICAkUEhQRGF0ZUFycmF5ID0gZGF0ZV9wYXJzZSgkdGVzdFZhbDIuJy0nLiR0ZXN0VmFsMS4nLScuJHRlc3RWYWwzKTsKICAgICAgICAgICAgICAgIGlmICgoJFBIUERhdGVBcnJheSA9PT0gZmFsc2UpIHx8ICgkUEhQRGF0ZUFycmF5WydlcnJvcl9jb3VudCddID4gMCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoKCRQSFBEYXRlQXJyYXkgIT09IGZhbHNlKSAmJiAoJFBIUERhdGVBcnJheVsnZXJyb3JfY291bnQnXSA9PSAwKSkgewogICAgICAgICAgICAvLyBFeGVjdXRlIGZ1bmN0aW9uCiAgICAgICAgICAgIGlmICgkUEhQRGF0ZUFycmF5Wyd5ZWFyJ10gPT0gJycpIHsKICAgICAgICAgICAgICAgICRQSFBEYXRlQXJyYXlbJ3llYXInXSA9IHN0cmZ0aW1lKCclWScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkUEhQRGF0ZUFycmF5Wyd5ZWFyJ10gPCAxOTAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkUEhQRGF0ZUFycmF5Wydtb250aCddID09ICcnKSB7CiAgICAgICAgICAgICAgICAkUEhQRGF0ZUFycmF5Wydtb250aCddID0gc3RyZnRpbWUoJyVtJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRQSFBEYXRlQXJyYXlbJ2RheSddID09ICcnKSB7CiAgICAgICAgICAgICAgICAkUEhQRGF0ZUFycmF5WydkYXknXSA9IHN0cmZ0aW1lKCclZCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRleGNlbERhdGVWYWx1ZSA9IGZsb29yKAogICAgICAgICAgICAgICAgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkZvcm1hdHRlZFBIUFRvRXhjZWwoCiAgICAgICAgICAgICAgICAgICAgJFBIUERhdGVBcnJheVsneWVhciddLAogICAgICAgICAgICAgICAgICAgICRQSFBEYXRlQXJyYXlbJ21vbnRoJ10sCiAgICAgICAgICAgICAgICAgICAgJFBIUERhdGVBcnJheVsnZGF5J10sCiAgICAgICAgICAgICAgICAgICAgJFBIUERhdGVBcnJheVsnaG91ciddLAogICAgICAgICAgICAgICAgICAgICRQSFBEYXRlQXJyYXlbJ21pbnV0ZSddLAogICAgICAgICAgICAgICAgICAgICRQSFBEYXRlQXJyYXlbJ3NlY29uZCddCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBzd2l0Y2ggKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Z2V0UmV0dXJuRGF0ZVR5cGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfRVhDRUw6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdCkgJGV4Y2VsRGF0ZVZhbHVlOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfUEhQX05VTUVSSUM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlZ2VyKSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6RXhjZWxUb1BIUCgkZXhjZWxEYXRlVmFsdWUpOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfUEhQX09CSkVDVDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGVUaW1lKCRQSFBEYXRlQXJyYXlbJ3llYXInXS4nLScuJFBIUERhdGVBcnJheVsnbW9udGgnXS4nLScuJFBIUERhdGVBcnJheVsnZGF5J10uJyAwMDowMDowMCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogVElNRVZBTFVFCiAgICAgKgogICAgICogUmV0dXJucyBhIHZhbHVlIHRoYXQgcmVwcmVzZW50cyBhIHBhcnRpY3VsYXIgdGltZS4KICAgICAqIFVzZSBUSU1FVkFMVUUgdG8gY29udmVydCBhIHRpbWUgcmVwcmVzZW50ZWQgYnkgYSB0ZXh0IHN0cmluZyB0byBhbiBFeGNlbCBvciBQSFAgZGF0ZS90aW1lIHN0YW1wCiAgICAgKiB2YWx1ZS4KICAgICAqCiAgICAgKiBOT1RFOiBXaGVuIHVzZWQgaW4gYSBDZWxsIEZvcm11bGEsIE1TIEV4Y2VsIGNoYW5nZXMgdGhlIGNlbGwgZm9ybWF0IHNvIHRoYXQgaXQgbWF0Y2hlcyB0aGUgdGltZQogICAgICogZm9ybWF0IG9mIHlvdXIgcmVnaW9uYWwgc2V0dGluZ3MuIFBIUEV4Y2VsIGRvZXMgbm90IGNoYW5nZSBjZWxsIGZvcm1hdHRpbmcgaW4gdGhpcyB3YXkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgVElNRVZBTFVFKHRpbWVWYWx1ZSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGUvVGltZSBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBzdHJpbmcgICAgJHRpbWVWYWx1ZSAgICAgICAgQSB0ZXh0IHN0cmluZyB0aGF0IHJlcHJlc2VudHMgYSB0aW1lIGluIGFueSBvbmUgb2YgdGhlIE1pY3Jvc29mdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFeGNlbCB0aW1lIGZvcm1hdHM7IGZvciBleGFtcGxlLCAiNjo0NSBQTSIgYW5kICIxODo0NSIgdGV4dCBzdHJpbmdzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGhpbiBxdW90YXRpb24gbWFya3MgdGhhdCByZXByZXNlbnQgdGltZS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0ZSBpbmZvcm1hdGlvbiBpbiB0aW1lX3RleHQgaXMgaWdub3JlZC4KICAgICAqIEByZXR1cm4gICAgbWl4ZWQgICAgRXhjZWwgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSwgUEhQIGRhdGUvdGltZSBzZXJpYWwgdmFsdWUgb3IgUEhQIGRhdGUvdGltZSBvYmplY3QsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGluZyBvbiB0aGUgdmFsdWUgb2YgdGhlIFJldHVybkRhdGVUeXBlIGZsYWcKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBUSU1FVkFMVUUoJHRpbWVWYWx1ZSkKICAgIHsKICAgICAgICAkdGltZVZhbHVlID0gdHJpbShQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkdGltZVZhbHVlKSwgJyInKTsKICAgICAgICAkdGltZVZhbHVlID0gc3RyX3JlcGxhY2UoYXJyYXkoJy8nLCAnLicpLCBhcnJheSgnLScsICctJyksICR0aW1lVmFsdWUpOwoKICAgICAgICAkUEhQRGF0ZUFycmF5ID0gZGF0ZV9wYXJzZSgkdGltZVZhbHVlKTsKICAgICAgICBpZiAoKCRQSFBEYXRlQXJyYXkgIT09IGZhbHNlKSAmJiAoJFBIUERhdGVBcnJheVsnZXJyb3JfY291bnQnXSA9PSAwKSkgewogICAgICAgICAgICBpZiAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRDb21wYXRpYmlsaXR5TW9kZSgpID09IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Q09NUEFUSUJJTElUWV9PUEVOT0ZGSUNFKSB7CiAgICAgICAgICAgICAgICAkZXhjZWxEYXRlVmFsdWUgPSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6Rm9ybWF0dGVkUEhQVG9FeGNlbCgKICAgICAgICAgICAgICAgICAgICAkUEhQRGF0ZUFycmF5Wyd5ZWFyJ10sCiAgICAgICAgICAgICAgICAgICAgJFBIUERhdGVBcnJheVsnbW9udGgnXSwKICAgICAgICAgICAgICAgICAgICAkUEhQRGF0ZUFycmF5WydkYXknXSwKICAgICAgICAgICAgICAgICAgICAkUEhQRGF0ZUFycmF5Wydob3VyJ10sCiAgICAgICAgICAgICAgICAgICAgJFBIUERhdGVBcnJheVsnbWludXRlJ10sCiAgICAgICAgICAgICAgICAgICAgJFBIUERhdGVBcnJheVsnc2Vjb25kJ10KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZXhjZWxEYXRlVmFsdWUgPSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6Rm9ybWF0dGVkUEhQVG9FeGNlbCgxOTAwLCAxLCAxLCAkUEhQRGF0ZUFycmF5Wydob3VyJ10sICRQSFBEYXRlQXJyYXlbJ21pbnV0ZSddLCAkUEhQRGF0ZUFycmF5WydzZWNvbmQnXSkgLSAxOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Z2V0UmV0dXJuRGF0ZVR5cGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfRVhDRUw6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdCkgJGV4Y2VsRGF0ZVZhbHVlOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfUEhQX05VTUVSSUM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlZ2VyKSAkcGhwRGF0ZVZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFAoJGV4Y2VsRGF0ZVZhbHVlKzI1NTY5KSAtIDM2MDA7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9QSFBfT0JKRUNUOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZVRpbWUoJzE5MDAtMDEtMDEgJy4kUEhQRGF0ZUFycmF5Wydob3VyJ10uJzonLiRQSFBEYXRlQXJyYXlbJ21pbnV0ZSddLic6Jy4kUEhQRGF0ZUFycmF5WydzZWNvbmQnXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBEQVRFRElGCiAgICAgKgogICAgICogQHBhcmFtICAgIG1peGVkICAgICRzdGFydERhdGUgICAgICAgIEV4Y2VsIGRhdGUgc2VyaWFsIHZhbHVlLCBQSFAgZGF0ZS90aW1lIHN0YW1wLCBQSFAgRGF0ZVRpbWUgb2JqZWN0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAkZW5kRGF0ZSAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUsIFBIUCBkYXRlL3RpbWUgc3RhbXAsIFBIUCBEYXRlVGltZSBvYmplY3QKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgYSBzdGFuZGFyZCBkYXRlIHN0cmluZwogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAkdW5pdAogICAgICogQHJldHVybiAgICBpbnRlZ2VyICAgIEludGVydmFsIGJldHdlZW4gdGhlIGRhdGVzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gREFURURJRigkc3RhcnREYXRlID0gMCwgJGVuZERhdGUgPSAwLCAkdW5pdCA9ICdEJykKICAgIHsKICAgICAgICAkc3RhcnREYXRlID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJHN0YXJ0RGF0ZSk7CiAgICAgICAgJGVuZERhdGUgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRlbmREYXRlKTsKICAgICAgICAkdW5pdCAgICAgID0gc3RydG91cHBlcihQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkdW5pdCkpOwoKICAgICAgICBpZiAoaXNfc3RyaW5nKCRzdGFydERhdGUgPSBzZWxmOjpnZXREYXRlVmFsdWUoJHN0YXJ0RGF0ZSkpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQogICAgICAgIGlmIChpc19zdHJpbmcoJGVuZERhdGUgPSBzZWxmOjpnZXREYXRlVmFsdWUoJGVuZERhdGUpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVycwogICAgICAgIGlmICgkc3RhcnREYXRlID49ICRlbmREYXRlKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KCiAgICAgICAgLy8gRXhlY3V0ZSBmdW5jdGlvbgogICAgICAgICRkaWZmZXJlbmNlID0gJGVuZERhdGUgLSAkc3RhcnREYXRlOwoKICAgICAgICAkUEhQU3RhcnREYXRlT2JqZWN0ID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFBPYmplY3QoJHN0YXJ0RGF0ZSk7CiAgICAgICAgJHN0YXJ0RGF5cyA9ICRQSFBTdGFydERhdGVPYmplY3QtPmZvcm1hdCgnaicpOwogICAgICAgICRzdGFydE1vbnRocyA9ICRQSFBTdGFydERhdGVPYmplY3QtPmZvcm1hdCgnbicpOwogICAgICAgICRzdGFydFllYXJzID0gJFBIUFN0YXJ0RGF0ZU9iamVjdC0+Zm9ybWF0KCdZJyk7CgogICAgICAgICRQSFBFbmREYXRlT2JqZWN0ID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFBPYmplY3QoJGVuZERhdGUpOwogICAgICAgICRlbmREYXlzID0gJFBIUEVuZERhdGVPYmplY3QtPmZvcm1hdCgnaicpOwogICAgICAgICRlbmRNb250aHMgPSAkUEhQRW5kRGF0ZU9iamVjdC0+Zm9ybWF0KCduJyk7CiAgICAgICAgJGVuZFllYXJzID0gJFBIUEVuZERhdGVPYmplY3QtPmZvcm1hdCgnWScpOwoKICAgICAgICAkcmV0VmFsID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICBzd2l0Y2ggKCR1bml0KSB7CiAgICAgICAgICAgIGNhc2UgJ0QnOgogICAgICAgICAgICAgICAgJHJldFZhbCA9IGludHZhbCgkZGlmZmVyZW5jZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnTSc6CiAgICAgICAgICAgICAgICAkcmV0VmFsID0gaW50dmFsKCRlbmRNb250aHMgLSAkc3RhcnRNb250aHMpICsgKGludHZhbCgkZW5kWWVhcnMgLSAkc3RhcnRZZWFycykgKiAxMik7CiAgICAgICAgICAgICAgICAvLyAgICBXZSdyZSBvbmx5IGludGVyZXN0ZWQgaW4gZnVsbCBtb250aHMKICAgICAgICAgICAgICAgIGlmICgkZW5kRGF5cyA8ICRzdGFydERheXMpIHsKICAgICAgICAgICAgICAgICAgICAtLSRyZXRWYWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnWSc6CiAgICAgICAgICAgICAgICAkcmV0VmFsID0gaW50dmFsKCRlbmRZZWFycyAtICRzdGFydFllYXJzKTsKICAgICAgICAgICAgICAgIC8vICAgIFdlJ3JlIG9ubHkgaW50ZXJlc3RlZCBpbiBmdWxsIG1vbnRocwogICAgICAgICAgICAgICAgaWYgKCRlbmRNb250aHMgPCAkc3RhcnRNb250aHMpIHsKICAgICAgICAgICAgICAgICAgICAtLSRyZXRWYWw7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoKCRlbmRNb250aHMgPT0gJHN0YXJ0TW9udGhzKSAmJiAoJGVuZERheXMgPCAkc3RhcnREYXlzKSkgewogICAgICAgICAgICAgICAgICAgIC0tJHJldFZhbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdNRCc6CiAgICAgICAgICAgICAgICBpZiAoJGVuZERheXMgPCAkc3RhcnREYXlzKSB7CiAgICAgICAgICAgICAgICAgICAgJHJldFZhbCA9ICRlbmREYXlzOwogICAgICAgICAgICAgICAgICAgICRQSFBFbmREYXRlT2JqZWN0LT5tb2RpZnkoJy0nLiRlbmREYXlzLicgZGF5cycpOwogICAgICAgICAgICAgICAgICAgICRhZGp1c3REYXlzID0gJFBIUEVuZERhdGVPYmplY3QtPmZvcm1hdCgnaicpOwogICAgICAgICAgICAgICAgICAgIGlmICgkYWRqdXN0RGF5cyA+ICRzdGFydERheXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJldFZhbCArPSAoJGFkanVzdERheXMgLSAkc3RhcnREYXlzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRyZXRWYWwgPSAkZW5kRGF5cyAtICRzdGFydERheXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnWU0nOgogICAgICAgICAgICAgICAgJHJldFZhbCA9IGludHZhbCgkZW5kTW9udGhzIC0gJHN0YXJ0TW9udGhzKTsKICAgICAgICAgICAgICAgIGlmICgkcmV0VmFsIDwgMCkgewogICAgICAgICAgICAgICAgICAgICRyZXRWYWwgKz0gMTI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyAgICBXZSdyZSBvbmx5IGludGVyZXN0ZWQgaW4gZnVsbCBtb250aHMKICAgICAgICAgICAgICAgIGlmICgkZW5kRGF5cyA8ICRzdGFydERheXMpIHsKICAgICAgICAgICAgICAgICAgICAtLSRyZXRWYWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnWUQnOgogICAgICAgICAgICAgICAgJHJldFZhbCA9IGludHZhbCgkZGlmZmVyZW5jZSk7CiAgICAgICAgICAgICAgICBpZiAoJGVuZFllYXJzID4gJHN0YXJ0WWVhcnMpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoJGVuZFllYXJzID4gJHN0YXJ0WWVhcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFBIUEVuZERhdGVPYmplY3QtPm1vZGlmeSgnLTEgeWVhcicpOwogICAgICAgICAgICAgICAgICAgICAgICAkZW5kWWVhcnMgPSAkUEhQRW5kRGF0ZU9iamVjdC0+Zm9ybWF0KCdZJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRyZXRWYWwgPSAkUEhQRW5kRGF0ZU9iamVjdC0+Zm9ybWF0KCd6JykgLSAkUEhQU3RhcnREYXRlT2JqZWN0LT5mb3JtYXQoJ3onKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJHJldFZhbCA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJldFZhbCArPSAzNjU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAkcmV0VmFsID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZXRWYWw7CiAgICB9CgoKICAgIC8qKgogICAgICogREFZUzM2MAogICAgICoKICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiBkYXlzIGJldHdlZW4gdHdvIGRhdGVzIGJhc2VkIG9uIGEgMzYwLWRheSB5ZWFyICh0d2VsdmUgMzAtZGF5IG1vbnRocyksCiAgICAgKiB3aGljaCBpcyB1c2VkIGluIHNvbWUgYWNjb3VudGluZyBjYWxjdWxhdGlvbnMuIFVzZSB0aGlzIGZ1bmN0aW9uIHRvIGhlbHAgY29tcHV0ZSBwYXltZW50cyBpZgogICAgICogeW91ciBhY2NvdW50aW5nIHN5c3RlbSBpcyBiYXNlZCBvbiB0d2VsdmUgMzAtZGF5IG1vbnRocy4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBEQVlTMzYwKHN0YXJ0RGF0ZSxlbmREYXRlWyxtZXRob2RdKQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgRGF0ZS9UaW1lIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIG1peGVkICAgICAgICAkc3RhcnREYXRlICAgICAgICBFeGNlbCBkYXRlIHNlcmlhbCB2YWx1ZSAoZmxvYXQpLCBQSFAgZGF0ZSB0aW1lc3RhbXAgKGludGVnZXIpLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEhQIERhdGVUaW1lIG9iamVjdCwgb3IgYSBzdGFuZGFyZCBkYXRlIHN0cmluZwogICAgICogQHBhcmFtICAgIG1peGVkICAgICAgICAkZW5kRGF0ZSAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUgdGltZXN0YW1wIChpbnRlZ2VyKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEBwYXJhbSAgICBib29sZWFuICAgICAgICAkbWV0aG9kICAgICAgICAgICAgVVMgb3IgRXVyb3BlYW4gTWV0aG9kCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGQUxTRSBvciBvbWl0dGVkOiBVLlMuIChOQVNEKSBtZXRob2QuIElmIHRoZSBzdGFydGluZyBkYXRlIGlzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgbGFzdCBkYXkgb2YgYSBtb250aCwgaXQgYmVjb21lcyBlcXVhbCB0byB0aGUgMzB0aCBvZiB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbWUgbW9udGguIElmIHRoZSBlbmRpbmcgZGF0ZSBpcyB0aGUgbGFzdCBkYXkgb2YgYSBtb250aCBhbmQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBzdGFydGluZyBkYXRlIGlzIGVhcmxpZXIgdGhhbiB0aGUgMzB0aCBvZiBhIG1vbnRoLCB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZGluZyBkYXRlIGJlY29tZXMgZXF1YWwgdG8gdGhlIDFzdCBvZiB0aGUgbmV4dCBtb250aDsKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG90aGVyd2lzZSB0aGUgZW5kaW5nIGRhdGUgYmVjb21lcyBlcXVhbCB0byB0aGUgMzB0aCBvZiB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbWUgbW9udGguCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFOiBFdXJvcGVhbiBtZXRob2QuIFN0YXJ0aW5nIGRhdGVzIGFuZCBlbmRpbmcgZGF0ZXMgdGhhdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2NjdXIgb24gdGhlIDMxc3Qgb2YgYSBtb250aCBiZWNvbWUgZXF1YWwgdG8gdGhlIDMwdGggb2YgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1lIG1vbnRoLgogICAgICogQHJldHVybiAgICBpbnRlZ2VyICAgICAgICBOdW1iZXIgb2YgZGF5cyBiZXR3ZWVuIHN0YXJ0IGRhdGUgYW5kIGVuZCBkYXRlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gREFZUzM2MCgkc3RhcnREYXRlID0gMCwgJGVuZERhdGUgPSAwLCAkbWV0aG9kID0gZmFsc2UpCiAgICB7CiAgICAgICAgJHN0YXJ0RGF0ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRzdGFydERhdGUpOwogICAgICAgICRlbmREYXRlICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGVuZERhdGUpOwoKICAgICAgICBpZiAoaXNfc3RyaW5nKCRzdGFydERhdGUgPSBzZWxmOjpnZXREYXRlVmFsdWUoJHN0YXJ0RGF0ZSkpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQogICAgICAgIGlmIChpc19zdHJpbmcoJGVuZERhdGUgPSBzZWxmOjpnZXREYXRlVmFsdWUoJGVuZERhdGUpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc19ib29sKCRtZXRob2QpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBFeGVjdXRlIGZ1bmN0aW9uCiAgICAgICAgJFBIUFN0YXJ0RGF0ZU9iamVjdCA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQT2JqZWN0KCRzdGFydERhdGUpOwogICAgICAgICRzdGFydERheSA9ICRQSFBTdGFydERhdGVPYmplY3QtPmZvcm1hdCgnaicpOwogICAgICAgICRzdGFydE1vbnRoID0gJFBIUFN0YXJ0RGF0ZU9iamVjdC0+Zm9ybWF0KCduJyk7CiAgICAgICAgJHN0YXJ0WWVhciA9ICRQSFBTdGFydERhdGVPYmplY3QtPmZvcm1hdCgnWScpOwoKICAgICAgICAkUEhQRW5kRGF0ZU9iamVjdCA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQT2JqZWN0KCRlbmREYXRlKTsKICAgICAgICAkZW5kRGF5ID0gJFBIUEVuZERhdGVPYmplY3QtPmZvcm1hdCgnaicpOwogICAgICAgICRlbmRNb250aCA9ICRQSFBFbmREYXRlT2JqZWN0LT5mb3JtYXQoJ24nKTsKICAgICAgICAkZW5kWWVhciA9ICRQSFBFbmREYXRlT2JqZWN0LT5mb3JtYXQoJ1knKTsKCiAgICAgICAgcmV0dXJuIHNlbGY6OmRhdGVEaWZmMzYwKCRzdGFydERheSwgJHN0YXJ0TW9udGgsICRzdGFydFllYXIsICRlbmREYXksICRlbmRNb250aCwgJGVuZFllYXIsICEkbWV0aG9kKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBZRUFSRlJBQwogICAgICoKICAgICAqIENhbGN1bGF0ZXMgdGhlIGZyYWN0aW9uIG9mIHRoZSB5ZWFyIHJlcHJlc2VudGVkIGJ5IHRoZSBudW1iZXIgb2Ygd2hvbGUgZGF5cyBiZXR3ZWVuIHR3byBkYXRlcwogICAgICogKHRoZSBzdGFydF9kYXRlIGFuZCB0aGUgZW5kX2RhdGUpLgogICAgICogVXNlIHRoZSBZRUFSRlJBQyB3b3Jrc2hlZXQgZnVuY3Rpb24gdG8gaWRlbnRpZnkgdGhlIHByb3BvcnRpb24gb2YgYSB3aG9sZSB5ZWFyJ3MgYmVuZWZpdHMgb3IKICAgICAqIG9ibGlnYXRpb25zIHRvIGFzc2lnbiB0byBhIHNwZWNpZmljIHRlcm0uCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgWUVBUkZSQUMoc3RhcnREYXRlLGVuZERhdGVbLG1ldGhvZF0pCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRlL1RpbWUgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgJHN0YXJ0RGF0ZSAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUgdGltZXN0YW1wIChpbnRlZ2VyKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEhQIERhdGVUaW1lIG9iamVjdCwgb3IgYSBzdGFuZGFyZCBkYXRlIHN0cmluZwogICAgICogQHBhcmFtICAgIG1peGVkICAgICRlbmREYXRlICAgICAgICBFeGNlbCBkYXRlIHNlcmlhbCB2YWx1ZSAoZmxvYXQpLCBQSFAgZGF0ZSB0aW1lc3RhbXAgKGludGVnZXIpLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQSFAgRGF0ZVRpbWUgb2JqZWN0LCBvciBhIHN0YW5kYXJkIGRhdGUgc3RyaW5nCiAgICAgKiBAcGFyYW0gICAgaW50ZWdlciAgICAkbWV0aG9kICAgICAgICAgICAgTWV0aG9kIHVzZWQgZm9yIHRoZSBjYWxjdWxhdGlvbgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCBvciBvbWl0dGVkICAgIFVTIChOQVNEKSAzMC8zNjAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgICAgICAgICAgICAgICAgQWN0dWFsL2FjdHVhbAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMiAgICAgICAgICAgICAgICBBY3R1YWwvMzYwCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzICAgICAgICAgICAgICAgIEFjdHVhbC8zNjUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQgICAgICAgICAgICAgICAgRXVyb3BlYW4gMzAvMzYwCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0ICAgIGZyYWN0aW9uIG9mIHRoZSB5ZWFyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gWUVBUkZSQUMoJHN0YXJ0RGF0ZSA9IDAsICRlbmREYXRlID0gMCwgJG1ldGhvZCA9IDApCiAgICB7CiAgICAgICAgJHN0YXJ0RGF0ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRzdGFydERhdGUpOwogICAgICAgICRlbmREYXRlICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGVuZERhdGUpOwogICAgICAgICRtZXRob2QgICAgICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJG1ldGhvZCk7CgogICAgICAgIGlmIChpc19zdHJpbmcoJHN0YXJ0RGF0ZSA9IHNlbGY6OmdldERhdGVWYWx1ZSgkc3RhcnREYXRlKSkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzX3N0cmluZygkZW5kRGF0ZSA9IHNlbGY6OmdldERhdGVWYWx1ZSgkZW5kRGF0ZSkpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoKChpc19udW1lcmljKCRtZXRob2QpKSAmJiAoIWlzX3N0cmluZygkbWV0aG9kKSkpIHx8ICgkbWV0aG9kID09ICcnKSkgewogICAgICAgICAgICBzd2l0Y2ggKCRtZXRob2QpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjo6REFZUzM2MCgkc3RhcnREYXRlLCAkZW5kRGF0ZSkgLyAzNjA7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgJGRheXMgPSBzZWxmOjpEQVRFRElGKCRzdGFydERhdGUsICRlbmREYXRlKTsKICAgICAgICAgICAgICAgICAgICAkc3RhcnRZZWFyID0gc2VsZjo6WUVBUigkc3RhcnREYXRlKTsKICAgICAgICAgICAgICAgICAgICAkZW5kWWVhciA9IHNlbGY6OllFQVIoJGVuZERhdGUpOwogICAgICAgICAgICAgICAgICAgICR5ZWFycyA9ICRlbmRZZWFyIC0gJHN0YXJ0WWVhciArIDE7CiAgICAgICAgICAgICAgICAgICAgJGxlYXBEYXlzID0gMDsKICAgICAgICAgICAgICAgICAgICBpZiAoJHllYXJzID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGY6OmlzTGVhcFllYXIoJGVuZFllYXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhcnRNb250aCA9IHNlbGY6Ok1PTlRIT0ZZRUFSKCRzdGFydERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVuZE1vbnRoID0gc2VsZjo6TU9OVEhPRllFQVIoJGVuZERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVuZERheSA9IHNlbGY6OkRBWU9GTU9OVEgoJGVuZERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkc3RhcnRNb250aCA8IDMpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCgkZW5kTW9udGggKiAxMDAgKyAkZW5kRGF5KSA+PSAoMiAqIDEwMCArIDI5KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlYXBEYXlzICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCR5ZWFyID0gJHN0YXJ0WWVhcjsgJHllYXIgPD0gJGVuZFllYXI7ICsrJHllYXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkeWVhciA9PSAkc3RhcnRZZWFyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXJ0TW9udGggPSBzZWxmOjpNT05USE9GWUVBUigkc3RhcnREYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhcnREYXkgPSBzZWxmOjpEQVlPRk1PTlRIKCRzdGFydERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc3RhcnRNb250aCA8IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlYXBEYXlzICs9IChzZWxmOjppc0xlYXBZZWFyKCR5ZWFyKSkgPyAxIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHllYXIgPT0gJGVuZFllYXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW5kTW9udGggPSBzZWxmOjpNT05USE9GWUVBUigkZW5kRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVuZERheSA9IHNlbGY6OkRBWU9GTU9OVEgoJGVuZERhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJGVuZE1vbnRoICogMTAwICsgJGVuZERheSkgPj0gKDIgKiAxMDAgKyAyOSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlYXBEYXlzICs9IChzZWxmOjppc0xlYXBZZWFyKCR5ZWFyKSkgPyAxIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZWFwRGF5cyArPSAoc2VsZjo6aXNMZWFwWWVhcigkeWVhcikpID8gMSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR5ZWFycyA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRsZWFwRGF5cyA9PSAwKSAmJiAoc2VsZjo6aXNMZWFwWWVhcigkc3RhcnRZZWFyKSkgJiYgKCRkYXlzID4gMzY1KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZWFwRGF5cyA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGRheXMgPCAzNjYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkeWVhcnMgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRsZWFwRGF5cyAvPSAkeWVhcnM7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkZGF5cyAvICgzNjUgKyAkbGVhcERheXMpOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOjpEQVRFRElGKCRzdGFydERhdGUsICRlbmREYXRlKSAvIDM2MDsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjo6REFURURJRigkc3RhcnREYXRlLCAkZW5kRGF0ZSkgLyAzNjU7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGY6OkRBWVMzNjAoJHN0YXJ0RGF0ZSwgJGVuZERhdGUsIHRydWUpIC8gMzYwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogTkVUV09SS0RBWVMKICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygd2hvbGUgd29ya2luZyBkYXlzIGJldHdlZW4gc3RhcnRfZGF0ZSBhbmQgZW5kX2RhdGUuIFdvcmtpbmcgZGF5cwogICAgICogZXhjbHVkZSB3ZWVrZW5kcyBhbmQgYW55IGRhdGVzIGlkZW50aWZpZWQgaW4gaG9saWRheXMuCiAgICAgKiBVc2UgTkVUV09SS0RBWVMgdG8gY2FsY3VsYXRlIGVtcGxveWVlIGJlbmVmaXRzIHRoYXQgYWNjcnVlIGJhc2VkIG9uIHRoZSBudW1iZXIgb2YgZGF5cwogICAgICogd29ya2VkIGR1cmluZyBhIHNwZWNpZmljIHRlcm0uCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgTkVUV09SS0RBWVMoc3RhcnREYXRlLGVuZERhdGVbLGhvbGlkYXlzWyxob2xpZGF5WywuLi5dXV0pCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRlL1RpbWUgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgICAgICAgICAkc3RhcnREYXRlICAgICAgICBFeGNlbCBkYXRlIHNlcmlhbCB2YWx1ZSAoZmxvYXQpLCBQSFAgZGF0ZSB0aW1lc3RhbXAgKGludGVnZXIpLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAgICAgICAgICRlbmREYXRlICAgICAgICBFeGNlbCBkYXRlIHNlcmlhbCB2YWx1ZSAoZmxvYXQpLCBQSFAgZGF0ZSB0aW1lc3RhbXAgKGludGVnZXIpLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAgICAgICAgICRob2xpZGF5cywuLi4gICAgT3B0aW9uYWwgc2VyaWVzIG9mIEV4Y2VsIGRhdGUgc2VyaWFsIHZhbHVlIChmbG9hdCksIFBIUCBkYXRlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wIChpbnRlZ2VyKSwgUEhQIERhdGVUaW1lIG9iamVjdCwgb3IgYSBzdGFuZGFyZCBkYXRlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5ncyB0aGF0IHdpbGwgYmUgZXhjbHVkZWQgZnJvbSB0aGUgd29ya2luZyBjYWxlbmRhciwgc3VjaAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIHN0YXRlIGFuZCBmZWRlcmFsIGhvbGlkYXlzIGFuZCBmbG9hdGluZyBob2xpZGF5cy4KICAgICAqIEByZXR1cm4gICAgaW50ZWdlciAgICAgICAgICAgIEludGVydmFsIGJldHdlZW4gdGhlIGRhdGVzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gTkVUV09SS0RBWVMoJHN0YXJ0RGF0ZSwgJGVuZERhdGUpCiAgICB7CiAgICAgICAgLy8gICAgUmV0cmlldmUgdGhlIG1hbmRhdG9yeSBzdGFydCBhbmQgZW5kIGRhdGUgdGhhdCBhcmUgcmVmZXJlbmNlZCBpbiB0aGUgZnVuY3Rpb24gZGVmaW5pdGlvbgogICAgICAgICRzdGFydERhdGUgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkc3RhcnREYXRlKTsKICAgICAgICAkZW5kRGF0ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRlbmREYXRlKTsKICAgICAgICAvLyAgICBGbHVzaCB0aGUgbWFuZGF0b3J5IHN0YXJ0IGFuZCBlbmQgZGF0ZSB0aGF0IGFyZSByZWZlcmVuY2VkIGluIHRoZSBmdW5jdGlvbiBkZWZpbml0aW9uLCBhbmQgZ2V0IHRoZSBvcHRpb25hbCBkYXlzCiAgICAgICAgJGRhdGVBcmdzID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuQXJyYXkoZnVuY19nZXRfYXJncygpKTsKICAgICAgICBhcnJheV9zaGlmdCgkZGF0ZUFyZ3MpOwogICAgICAgIGFycmF5X3NoaWZ0KCRkYXRlQXJncyk7CgogICAgICAgIC8vICAgIFZhbGlkYXRlIHRoZSBzdGFydCBhbmQgZW5kIGRhdGVzCiAgICAgICAgaWYgKGlzX3N0cmluZygkc3RhcnREYXRlID0gJHNEYXRlID0gc2VsZjo6Z2V0RGF0ZVZhbHVlKCRzdGFydERhdGUpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0KICAgICAgICAkc3RhcnREYXRlID0gKGZsb2F0KSBmbG9vcigkc3RhcnREYXRlKTsKICAgICAgICBpZiAoaXNfc3RyaW5nKCRlbmREYXRlID0gJGVEYXRlID0gc2VsZjo6Z2V0RGF0ZVZhbHVlKCRlbmREYXRlKSkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CiAgICAgICAgJGVuZERhdGUgPSAoZmxvYXQpIGZsb29yKCRlbmREYXRlKTsKCiAgICAgICAgaWYgKCRzRGF0ZSA+ICRlRGF0ZSkgewogICAgICAgICAgICAkc3RhcnREYXRlID0gJGVEYXRlOwogICAgICAgICAgICAkZW5kRGF0ZSA9ICRzRGF0ZTsKICAgICAgICB9CgogICAgICAgIC8vIEV4ZWN1dGUgZnVuY3Rpb24KICAgICAgICAkc3RhcnREb1cgPSA2IC0gc2VsZjo6REFZT0ZXRUVLKCRzdGFydERhdGUsIDIpOwogICAgICAgIGlmICgkc3RhcnREb1cgPCAwKSB7CiAgICAgICAgICAgICRzdGFydERvVyA9IDA7CiAgICAgICAgfQogICAgICAgICRlbmREb1cgPSBzZWxmOjpEQVlPRldFRUsoJGVuZERhdGUsIDIpOwogICAgICAgIGlmICgkZW5kRG9XID49IDYpIHsKICAgICAgICAgICAgJGVuZERvVyA9IDA7CiAgICAgICAgfQoKICAgICAgICAkd2hvbGVXZWVrRGF5cyA9IGZsb29yKCgkZW5kRGF0ZSAtICRzdGFydERhdGUpIC8gNykgKiA1OwogICAgICAgICRwYXJ0V2Vla0RheXMgPSAkZW5kRG9XICsgJHN0YXJ0RG9XOwogICAgICAgIGlmICgkcGFydFdlZWtEYXlzID4gNSkgewogICAgICAgICAgICAkcGFydFdlZWtEYXlzIC09IDU7CiAgICAgICAgfQoKICAgICAgICAvLyAgICBUZXN0IGFueSBleHRyYSBob2xpZGF5IHBhcmFtZXRlcnMKICAgICAgICAkaG9saWRheUNvdW50ZWRBcnJheSA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoJGRhdGVBcmdzIGFzICRob2xpZGF5RGF0ZSkgewogICAgICAgICAgICBpZiAoaXNfc3RyaW5nKCRob2xpZGF5RGF0ZSA9IHNlbGY6OmdldERhdGVWYWx1ZSgkaG9saWRheURhdGUpKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKCRob2xpZGF5RGF0ZSA+PSAkc3RhcnREYXRlKSAmJiAoJGhvbGlkYXlEYXRlIDw9ICRlbmREYXRlKSkgewogICAgICAgICAgICAgICAgaWYgKChzZWxmOjpEQVlPRldFRUsoJGhvbGlkYXlEYXRlLCAyKSA8IDYpICYmICghaW5fYXJyYXkoJGhvbGlkYXlEYXRlLCAkaG9saWRheUNvdW50ZWRBcnJheSkpKSB7CiAgICAgICAgICAgICAgICAgICAgLS0kcGFydFdlZWtEYXlzOwogICAgICAgICAgICAgICAgICAgICRob2xpZGF5Q291bnRlZEFycmF5W10gPSAkaG9saWRheURhdGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkc0RhdGUgPiAkZURhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIDAgLSAoJHdob2xlV2Vla0RheXMgKyAkcGFydFdlZWtEYXlzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR3aG9sZVdlZWtEYXlzICsgJHBhcnRXZWVrRGF5czsKICAgIH0KCgogICAgLyoqCiAgICAgKiBXT1JLREFZCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgZGF0ZSB0aGF0IGlzIHRoZSBpbmRpY2F0ZWQgbnVtYmVyIG9mIHdvcmtpbmcgZGF5cyBiZWZvcmUgb3IgYWZ0ZXIgYSBkYXRlICh0aGUKICAgICAqIHN0YXJ0aW5nIGRhdGUpLiBXb3JraW5nIGRheXMgZXhjbHVkZSB3ZWVrZW5kcyBhbmQgYW55IGRhdGVzIGlkZW50aWZpZWQgYXMgaG9saWRheXMuCiAgICAgKiBVc2UgV09SS0RBWSB0byBleGNsdWRlIHdlZWtlbmRzIG9yIGhvbGlkYXlzIHdoZW4geW91IGNhbGN1bGF0ZSBpbnZvaWNlIGR1ZSBkYXRlcywgZXhwZWN0ZWQKICAgICAqIGRlbGl2ZXJ5IHRpbWVzLCBvciB0aGUgbnVtYmVyIG9mIGRheXMgb2Ygd29yayBwZXJmb3JtZWQuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgV09SS0RBWShzdGFydERhdGUsZW5kRGF5c1ssaG9saWRheXNbLGhvbGlkYXlbLC4uLl1dXSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGUvVGltZSBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAgICAgJHN0YXJ0RGF0ZSAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUgdGltZXN0YW1wIChpbnRlZ2VyKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEBwYXJhbSAgICBpbnRlZ2VyICAgICAgICAkZW5kRGF5cyAgICAgICAgVGhlIG51bWJlciBvZiBub253ZWVrZW5kIGFuZCBub25ob2xpZGF5IGRheXMgYmVmb3JlIG9yIGFmdGVyCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGUuIEEgcG9zaXRpdmUgdmFsdWUgZm9yIGRheXMgeWllbGRzIGEgZnV0dXJlIGRhdGU7IGEKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZ2F0aXZlIHZhbHVlIHlpZWxkcyBhIHBhc3QgZGF0ZS4KICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAgICAgJGhvbGlkYXlzLC4uLiAgICBPcHRpb25hbCBzZXJpZXMgb2YgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCAoaW50ZWdlciksIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5ncyB0aGF0IHdpbGwgYmUgZXhjbHVkZWQgZnJvbSB0aGUgd29ya2luZyBjYWxlbmRhciwgc3VjaAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgc3RhdGUgYW5kIGZlZGVyYWwgaG9saWRheXMgYW5kIGZsb2F0aW5nIGhvbGlkYXlzLgogICAgICogQHJldHVybiAgICBtaXhlZCAgICBFeGNlbCBkYXRlL3RpbWUgc2VyaWFsIHZhbHVlLCBQSFAgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSBvciBQSFAgZGF0ZS90aW1lIG9iamVjdCwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSBvZiB0aGUgUmV0dXJuRGF0ZVR5cGUgZmxhZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIFdPUktEQVkoJHN0YXJ0RGF0ZSwgJGVuZERheXMpCiAgICB7CiAgICAgICAgLy8gICAgUmV0cmlldmUgdGhlIG1hbmRhdG9yeSBzdGFydCBkYXRlIGFuZCBkYXlzIHRoYXQgYXJlIHJlZmVyZW5jZWQgaW4gdGhlIGZ1bmN0aW9uIGRlZmluaXRpb24KICAgICAgICAkc3RhcnREYXRlICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJHN0YXJ0RGF0ZSk7CiAgICAgICAgJGVuZERheXMgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkZW5kRGF5cyk7CiAgICAgICAgLy8gICAgRmx1c2ggdGhlIG1hbmRhdG9yeSBzdGFydCBkYXRlIGFuZCBkYXlzIHRoYXQgYXJlIHJlZmVyZW5jZWQgaW4gdGhlIGZ1bmN0aW9uIGRlZmluaXRpb24sIGFuZCBnZXQgdGhlIG9wdGlvbmFsIGRheXMKICAgICAgICAkZGF0ZUFyZ3MgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheShmdW5jX2dldF9hcmdzKCkpOwogICAgICAgIGFycmF5X3NoaWZ0KCRkYXRlQXJncyk7CiAgICAgICAgYXJyYXlfc2hpZnQoJGRhdGVBcmdzKTsKCiAgICAgICAgaWYgKChpc19zdHJpbmcoJHN0YXJ0RGF0ZSA9IHNlbGY6OmdldERhdGVWYWx1ZSgkc3RhcnREYXRlKSkpIHx8ICghaXNfbnVtZXJpYygkZW5kRGF5cykpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQogICAgICAgICRzdGFydERhdGUgPSAoZmxvYXQpIGZsb29yKCRzdGFydERhdGUpOwogICAgICAgICRlbmREYXlzID0gKGludCkgZmxvb3IoJGVuZERheXMpOwogICAgICAgIC8vICAgIElmIGVuZERheXMgaXMgMCwgd2UgYWx3YXlzIHJldHVybiBzdGFydERhdGUKICAgICAgICBpZiAoJGVuZERheXMgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gJHN0YXJ0RGF0ZTsKICAgICAgICB9CgogICAgICAgICRkZWNyZW1lbnRpbmcgPSAoJGVuZERheXMgPCAwKSA\/IHRydWUgOiBmYWxzZTsKCiAgICAgICAgLy8gICAgQWRqdXN0IHRoZSBzdGFydCBkYXRlIGlmIGl0IGZhbGxzIG92ZXIgYSB3ZWVrZW5kCgogICAgICAgICRzdGFydERvVyA9IHNlbGY6OkRBWU9GV0VFSygkc3RhcnREYXRlLCAzKTsKICAgICAgICBpZiAoc2VsZjo6REFZT0ZXRUVLKCRzdGFydERhdGUsIDMpID49IDUpIHsKICAgICAgICAgICAgJHN0YXJ0RGF0ZSArPSAoJGRlY3JlbWVudGluZykgPyAtJHN0YXJ0RG9XICsgNDogNyAtICRzdGFydERvVzsKICAgICAgICAgICAgKCRkZWNyZW1lbnRpbmcpID8gJGVuZERheXMrKyA6ICRlbmREYXlzLS07CiAgICAgICAgfQoKICAgICAgICAvLyAgICBBZGQgZW5kRGF5cwogICAgICAgICRlbmREYXRlID0gKGZsb2F0KSAkc3RhcnREYXRlICsgKGludHZhbCgkZW5kRGF5cyAvIDUpICogNykgKyAoJGVuZERheXMgJSA1KTsKCiAgICAgICAgLy8gICAgQWRqdXN0IHRoZSBjYWxjdWxhdGVkIGVuZCBkYXRlIGlmIGl0IGZhbGxzIG92ZXIgYSB3ZWVrZW5kCiAgICAgICAgJGVuZERvVyA9IHNlbGY6OkRBWU9GV0VFSygkZW5kRGF0ZSwgMyk7CiAgICAgICAgaWYgKCRlbmREb1cgPj0gNSkgewogICAgICAgICAgICAkZW5kRGF0ZSArPSAoJGRlY3JlbWVudGluZykgPyAtJGVuZERvVyArIDQ6IDcgLSAkZW5kRG9XOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgVGVzdCBhbnkgZXh0cmEgaG9saWRheSBwYXJhbWV0ZXJzCiAgICAgICAgaWYgKCFlbXB0eSgkZGF0ZUFyZ3MpKSB7CiAgICAgICAgICAgICRob2xpZGF5Q291bnRlZEFycmF5ID0gJGhvbGlkYXlEYXRlcyA9IGFycmF5KCk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRkYXRlQXJncyBhcyAkaG9saWRheURhdGUpIHsKICAgICAgICAgICAgICAgIGlmICgoJGhvbGlkYXlEYXRlICE9PSBudWxsKSAmJiAodHJpbSgkaG9saWRheURhdGUpID4gJycpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX3N0cmluZygkaG9saWRheURhdGUgPSBzZWxmOjpnZXREYXRlVmFsdWUoJGhvbGlkYXlEYXRlKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGY6OkRBWU9GV0VFSygkaG9saWRheURhdGUsIDMpIDwgNSkgewogICAgICAgICAgICAgICAgICAgICAgICAkaG9saWRheURhdGVzW10gPSAkaG9saWRheURhdGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkZGVjcmVtZW50aW5nKSB7CiAgICAgICAgICAgICAgICByc29ydCgkaG9saWRheURhdGVzLCBTT1JUX05VTUVSSUMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc29ydCgkaG9saWRheURhdGVzLCBTT1JUX05VTUVSSUMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvcmVhY2ggKCRob2xpZGF5RGF0ZXMgYXMgJGhvbGlkYXlEYXRlKSB7CiAgICAgICAgICAgICAgICBpZiAoJGRlY3JlbWVudGluZykgewogICAgICAgICAgICAgICAgICAgIGlmICgoJGhvbGlkYXlEYXRlIDw9ICRzdGFydERhdGUpICYmICgkaG9saWRheURhdGUgPj0gJGVuZERhdGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5fYXJyYXkoJGhvbGlkYXlEYXRlLCAkaG9saWRheUNvdW50ZWRBcnJheSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tJGVuZERhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaG9saWRheUNvdW50ZWRBcnJheVtdID0gJGhvbGlkYXlEYXRlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKCRob2xpZGF5RGF0ZSA+PSAkc3RhcnREYXRlKSAmJiAoJGhvbGlkYXlEYXRlIDw9ICRlbmREYXRlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluX2FycmF5KCRob2xpZGF5RGF0ZSwgJGhvbGlkYXlDb3VudGVkQXJyYXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICArKyRlbmREYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhvbGlkYXlDb3VudGVkQXJyYXlbXSA9ICRob2xpZGF5RGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vICAgIEFkanVzdCB0aGUgY2FsY3VsYXRlZCBlbmQgZGF0ZSBpZiBpdCBmYWxscyBvdmVyIGEgd2Vla2VuZAogICAgICAgICAgICAgICAgJGVuZERvVyA9IHNlbGY6OkRBWU9GV0VFSygkZW5kRGF0ZSwgMyk7CiAgICAgICAgICAgICAgICBpZiAoJGVuZERvVyA+PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgJGVuZERhdGUgKz0gKCRkZWNyZW1lbnRpbmcpID8gLSRlbmREb1cgKyA0IDogNyAtICRlbmREb1c7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN3aXRjaCAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRSZXR1cm5EYXRlVHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX0VYQ0VMOgogICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdCkgJGVuZERhdGU7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX1BIUF9OVU1FUklDOgogICAgICAgICAgICAgICAgcmV0dXJuIChpbnRlZ2VyKSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6RXhjZWxUb1BIUCgkZW5kRGF0ZSk7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX1BIUF9PQkpFQ1Q6CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFBPYmplY3QoJGVuZERhdGUpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBEQVlPRk1PTlRICiAgICAgKgogICAgICogUmV0dXJucyB0aGUgZGF5IG9mIHRoZSBtb250aCwgZm9yIGEgc3BlY2lmaWVkIGRhdGUuIFRoZSBkYXkgaXMgZ2l2ZW4gYXMgYW4gaW50ZWdlcgogICAgICogcmFuZ2luZyBmcm9tIDEgdG8gMzEuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgREFZKGRhdGVWYWx1ZSkKICAgICAqCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgJGRhdGVWYWx1ZSAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUgdGltZXN0YW1wIChpbnRlZ2VyKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEhQIERhdGVUaW1lIG9iamVjdCwgb3IgYSBzdGFuZGFyZCBkYXRlIHN0cmluZwogICAgICogQHJldHVybiAgICBpbnQgICAgICAgIERheSBvZiB0aGUgbW9udGgKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEQVlPRk1PTlRIKCRkYXRlVmFsdWUgPSAxKQogICAgewogICAgICAgICRkYXRlVmFsdWUgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkZGF0ZVZhbHVlKTsKCiAgICAgICAgaWYgKCRkYXRlVmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgJGRhdGVWYWx1ZSA9IDE7CiAgICAgICAgfSBlbHNlaWYgKGlzX3N0cmluZygkZGF0ZVZhbHVlID0gc2VsZjo6Z2V0RGF0ZVZhbHVlKCRkYXRlVmFsdWUpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0gZWxzZWlmICgkZGF0ZVZhbHVlID09IDAuMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2VpZiAoJGRhdGVWYWx1ZSA8IDAuMCkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICB9CgogICAgICAgIC8vIEV4ZWN1dGUgZnVuY3Rpb24KICAgICAgICAkUEhQRGF0ZU9iamVjdCA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQT2JqZWN0KCRkYXRlVmFsdWUpOwoKICAgICAgICByZXR1cm4gKGludCkgJFBIUERhdGVPYmplY3QtPmZvcm1hdCgnaicpOwogICAgfQoKCiAgICAvKioKICAgICAqIERBWU9GV0VFSwogICAgICoKICAgICAqIFJldHVybnMgdGhlIGRheSBvZiB0aGUgd2VlayBmb3IgYSBzcGVjaWZpZWQgZGF0ZS4gVGhlIGRheSBpcyBnaXZlbiBhcyBhbiBpbnRlZ2VyCiAgICAgKiByYW5naW5nIGZyb20gMCB0byA3IChkZXBlbmRlbnQgb24gdGhlIHJlcXVlc3RlZCBzdHlsZSkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgV0VFS0RBWShkYXRlVmFsdWVbLHN0eWxlXSkKICAgICAqCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgJGRhdGVWYWx1ZSAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUgdGltZXN0YW1wIChpbnRlZ2VyKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEhQIERhdGVUaW1lIG9iamVjdCwgb3IgYSBzdGFuZGFyZCBkYXRlIHN0cmluZwogICAgICogQHBhcmFtICAgIGludCAgICAgICAgJHN0eWxlICAgICAgICAgICAgQSBudW1iZXIgdGhhdCBkZXRlcm1pbmVzIHRoZSB0eXBlIG9mIHJldHVybiB2YWx1ZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSBvciBvbWl0dGVkICAgIE51bWJlcnMgMSAoU3VuZGF5KSB0aHJvdWdoIDcgKFNhdHVyZGF5KS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIgICAgICAgICAgICAgICAgTnVtYmVycyAxIChNb25kYXkpIHRocm91Z2ggNyAoU3VuZGF5KS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMgICAgICAgICAgICAgICAgTnVtYmVycyAwIChNb25kYXkpIHRocm91Z2ggNiAoU3VuZGF5KS4KICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBEYXkgb2YgdGhlIHdlZWsgdmFsdWUKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEQVlPRldFRUsoJGRhdGVWYWx1ZSA9IDEsICRzdHlsZSA9IDEpCiAgICB7CiAgICAgICAgJGRhdGVWYWx1ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRkYXRlVmFsdWUpOwogICAgICAgICRzdHlsZSAgICAgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkc3R5bGUpOwoKICAgICAgICBpZiAoIWlzX251bWVyaWMoJHN0eWxlKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0gZWxzZWlmICgoJHN0eWxlIDwgMSkgfHwgKCRzdHlsZSA+IDMpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KICAgICAgICAkc3R5bGUgPSBmbG9vcigkc3R5bGUpOwoKICAgICAgICBpZiAoJGRhdGVWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgICAgICAkZGF0ZVZhbHVlID0gMTsKICAgICAgICB9IGVsc2VpZiAoaXNfc3RyaW5nKCRkYXRlVmFsdWUgPSBzZWxmOjpnZXREYXRlVmFsdWUoJGRhdGVWYWx1ZSkpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfSBlbHNlaWYgKCRkYXRlVmFsdWUgPCAwLjApIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBFeGVjdXRlIGZ1bmN0aW9uCiAgICAgICAgJFBIUERhdGVPYmplY3QgPSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6RXhjZWxUb1BIUE9iamVjdCgkZGF0ZVZhbHVlKTsKICAgICAgICAkRG9XID0gJFBIUERhdGVPYmplY3QtPmZvcm1hdCgndycpOwoKICAgICAgICAkZmlyc3REYXkgPSAxOwogICAgICAgIHN3aXRjaCAoJHN0eWxlKSB7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICsrJERvVzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAoJERvVyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJERvVyA9IDc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKCREb1cgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICREb1cgPSA3OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGZpcnN0RGF5ID0gMDsKICAgICAgICAgICAgICAgIC0tJERvVzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRDb21wYXRpYmlsaXR5TW9kZSgpID09IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Q09NUEFUSUJJTElUWV9FWENFTCkgewogICAgICAgICAgICAvLyAgICBUZXN0IGZvciBFeGNlbCdzIDE5MDAgbGVhcCB5ZWFyLCBhbmQgaW50cm9kdWNlIHRoZSBlcnJvciBhcyByZXF1aXJlZAogICAgICAgICAgICBpZiAoKCRQSFBEYXRlT2JqZWN0LT5mb3JtYXQoJ1knKSA9PSAxOTAwKSAmJiAoJFBIUERhdGVPYmplY3QtPmZvcm1hdCgnbicpIDw9IDIpKSB7CiAgICAgICAgICAgICAgICAtLSREb1c7CiAgICAgICAgICAgICAgICBpZiAoJERvVyA8ICRmaXJzdERheSkgewogICAgICAgICAgICAgICAgICAgICREb1cgKz0gNzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChpbnQpICREb1c7CiAgICB9CgoKICAgIC8qKgogICAgICogV0VFS09GWUVBUgogICAgICoKICAgICAqIFJldHVybnMgdGhlIHdlZWsgb2YgdGhlIHllYXIgZm9yIGEgc3BlY2lmaWVkIGRhdGUuCiAgICAgKiBUaGUgV0VFS05VTSBmdW5jdGlvbiBjb25zaWRlcnMgdGhlIHdlZWsgY29udGFpbmluZyBKYW51YXJ5IDEgdG8gYmUgdGhlIGZpcnN0IHdlZWsgb2YgdGhlIHllYXIuCiAgICAgKiBIb3dldmVyLCB0aGVyZSBpcyBhIEV1cm9wZWFuIHN0YW5kYXJkIHRoYXQgZGVmaW5lcyB0aGUgZmlyc3Qgd2VlayBhcyB0aGUgb25lIHdpdGggdGhlIG1ham9yaXR5CiAgICAgKiBvZiBkYXlzIChmb3VyIG9yIG1vcmUpIGZhbGxpbmcgaW4gdGhlIG5ldyB5ZWFyLiBUaGlzIG1lYW5zIHRoYXQgZm9yIHllYXJzIGluIHdoaWNoIHRoZXJlIGFyZQogICAgICogdGhyZWUgZGF5cyBvciBsZXNzIGluIHRoZSBmaXJzdCB3ZWVrIG9mIEphbnVhcnksIHRoZSBXRUVLTlVNIGZ1bmN0aW9uIHJldHVybnMgd2VlayBudW1iZXJzCiAgICAgKiB0aGF0IGFyZSBpbmNvcnJlY3QgYWNjb3JkaW5nIHRvIHRoZSBFdXJvcGVhbiBzdGFuZGFyZC4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBXRUVLTlVNKGRhdGVWYWx1ZVssc3R5bGVdKQogICAgICoKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAkZGF0ZVZhbHVlICAgICAgICBFeGNlbCBkYXRlIHNlcmlhbCB2YWx1ZSAoZmxvYXQpLCBQSFAgZGF0ZSB0aW1lc3RhbXAgKGludGVnZXIpLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQSFAgRGF0ZVRpbWUgb2JqZWN0LCBvciBhIHN0YW5kYXJkIGRhdGUgc3RyaW5nCiAgICAgKiBAcGFyYW0gICAgYm9vbGVhbiAgICAkbWV0aG9kICAgICAgICAgICAgV2VlayBiZWdpbnMgb24gU3VuZGF5IG9yIE1vbmRheQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMSBvciBvbWl0dGVkICAgIFdlZWsgYmVnaW5zIG9uIFN1bmRheS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIgICAgICAgICAgICAgICAgV2VlayBiZWdpbnMgb24gTW9uZGF5LgogICAgICogQHJldHVybiAgICBpbnQgICAgICAgIFdlZWsgTnVtYmVyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gV0VFS09GWUVBUigkZGF0ZVZhbHVlID0gMSwgJG1ldGhvZCA9IDEpCiAgICB7CiAgICAgICAgJGRhdGVWYWx1ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRkYXRlVmFsdWUpOwogICAgICAgICRtZXRob2QgICAgICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJG1ldGhvZCk7CgogICAgICAgIGlmICghaXNfbnVtZXJpYygkbWV0aG9kKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0gZWxzZWlmICgoJG1ldGhvZCA8IDEpIHx8ICgkbWV0aG9kID4gMikpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6TmFOKCk7CiAgICAgICAgfQogICAgICAgICRtZXRob2QgPSBmbG9vcigkbWV0aG9kKTsKCiAgICAgICAgaWYgKCRkYXRlVmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgJGRhdGVWYWx1ZSA9IDE7CiAgICAgICAgfSBlbHNlaWYgKGlzX3N0cmluZygkZGF0ZVZhbHVlID0gc2VsZjo6Z2V0RGF0ZVZhbHVlKCRkYXRlVmFsdWUpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0gZWxzZWlmICgkZGF0ZVZhbHVlIDwgMC4wKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KCiAgICAgICAgLy8gRXhlY3V0ZSBmdW5jdGlvbgogICAgICAgICRQSFBEYXRlT2JqZWN0ID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFBPYmplY3QoJGRhdGVWYWx1ZSk7CiAgICAgICAgJGRheU9mWWVhciA9ICRQSFBEYXRlT2JqZWN0LT5mb3JtYXQoJ3onKTsKICAgICAgICAkZG93ID0gJFBIUERhdGVPYmplY3QtPmZvcm1hdCgndycpOwogICAgICAgICRQSFBEYXRlT2JqZWN0LT5tb2RpZnkoJy0nIC4gJGRheU9mWWVhciAuICcgZGF5cycpOwogICAgICAgICRkb3cgPSAkUEhQRGF0ZU9iamVjdC0+Zm9ybWF0KCd3Jyk7CiAgICAgICAgJGRheXNJbkZpcnN0V2VlayA9IDcgLSAoKCRkb3cgKyAoMiAtICRtZXRob2QpKSAlIDcpOwogICAgICAgICRkYXlPZlllYXIgLT0gJGRheXNJbkZpcnN0V2VlazsKICAgICAgICAkd2Vla09mWWVhciA9IGNlaWwoJGRheU9mWWVhciAvIDcpICsgMTsKCiAgICAgICAgcmV0dXJuIChpbnQpICR3ZWVrT2ZZZWFyOwogICAgfQoKCiAgICAvKioKICAgICAqIE1PTlRIT0ZZRUFSCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgbW9udGggb2YgYSBkYXRlIHJlcHJlc2VudGVkIGJ5IGEgc2VyaWFsIG51bWJlci4KICAgICAqIFRoZSBtb250aCBpcyBnaXZlbiBhcyBhbiBpbnRlZ2VyLCByYW5naW5nIGZyb20gMSAoSmFudWFyeSkgdG8gMTIgKERlY2VtYmVyKS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBNT05USChkYXRlVmFsdWUpCiAgICAgKgogICAgICogQHBhcmFtICAgIG1peGVkICAgICRkYXRlVmFsdWUgICAgICAgIEV4Y2VsIGRhdGUgc2VyaWFsIHZhbHVlIChmbG9hdCksIFBIUCBkYXRlIHRpbWVzdGFtcCAoaW50ZWdlciksCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBNb250aCBvZiB0aGUgeWVhcgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIE1PTlRIT0ZZRUFSKCRkYXRlVmFsdWUgPSAxKQogICAgewogICAgICAgICRkYXRlVmFsdWUgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkZGF0ZVZhbHVlKTsKCiAgICAgICAgaWYgKCRkYXRlVmFsdWUgPT09IG51bGwpIHsKICAgICAgICAgICAgJGRhdGVWYWx1ZSA9IDE7CiAgICAgICAgfSBlbHNlaWYgKGlzX3N0cmluZygkZGF0ZVZhbHVlID0gc2VsZjo6Z2V0RGF0ZVZhbHVlKCRkYXRlVmFsdWUpKSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgIH0gZWxzZWlmICgkZGF0ZVZhbHVlIDwgMC4wKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KCiAgICAgICAgLy8gRXhlY3V0ZSBmdW5jdGlvbgogICAgICAgICRQSFBEYXRlT2JqZWN0ID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFBPYmplY3QoJGRhdGVWYWx1ZSk7CgogICAgICAgIHJldHVybiAoaW50KSAkUEhQRGF0ZU9iamVjdC0+Zm9ybWF0KCduJyk7CiAgICB9CgoKICAgIC8qKgogICAgICogWUVBUgogICAgICoKICAgICAqIFJldHVybnMgdGhlIHllYXIgY29ycmVzcG9uZGluZyB0byBhIGRhdGUuCiAgICAgKiBUaGUgeWVhciBpcyByZXR1cm5lZCBhcyBhbiBpbnRlZ2VyIGluIHRoZSByYW5nZSAxOTAwLTk5OTkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgWUVBUihkYXRlVmFsdWUpCiAgICAgKgogICAgICogQHBhcmFtICAgIG1peGVkICAgICRkYXRlVmFsdWUgICAgICAgIEV4Y2VsIGRhdGUgc2VyaWFsIHZhbHVlIChmbG9hdCksIFBIUCBkYXRlIHRpbWVzdGFtcCAoaW50ZWdlciksCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBZZWFyCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gWUVBUigkZGF0ZVZhbHVlID0gMSkKICAgIHsKICAgICAgICAkZGF0ZVZhbHVlICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGRhdGVWYWx1ZSk7CgogICAgICAgIGlmICgkZGF0ZVZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICAgICRkYXRlVmFsdWUgPSAxOwogICAgICAgIH0gZWxzZWlmIChpc19zdHJpbmcoJGRhdGVWYWx1ZSA9IHNlbGY6OmdldERhdGVWYWx1ZSgkZGF0ZVZhbHVlKSkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9IGVsc2VpZiAoJGRhdGVWYWx1ZSA8IDAuMCkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICB9CgogICAgICAgIC8vIEV4ZWN1dGUgZnVuY3Rpb24KICAgICAgICAkUEhQRGF0ZU9iamVjdCA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQT2JqZWN0KCRkYXRlVmFsdWUpOwoKICAgICAgICByZXR1cm4gKGludCkgJFBIUERhdGVPYmplY3QtPmZvcm1hdCgnWScpOwogICAgfQoKCiAgICAvKioKICAgICAqIEhPVVJPRkRBWQogICAgICoKICAgICAqIFJldHVybnMgdGhlIGhvdXIgb2YgYSB0aW1lIHZhbHVlLgogICAgICogVGhlIGhvdXIgaXMgZ2l2ZW4gYXMgYW4gaW50ZWdlciwgcmFuZ2luZyBmcm9tIDAgKDEyOjAwIEEuTS4pIHRvIDIzICgxMTowMCBQLk0uKS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBIT1VSKHRpbWVWYWx1ZSkKICAgICAqCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgJHRpbWVWYWx1ZSAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUgdGltZXN0YW1wIChpbnRlZ2VyKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUEhQIERhdGVUaW1lIG9iamVjdCwgb3IgYSBzdGFuZGFyZCB0aW1lIHN0cmluZwogICAgICogQHJldHVybiAgICBpbnQgICAgICAgIEhvdXIKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBIT1VST0ZEQVkoJHRpbWVWYWx1ZSA9IDApCiAgICB7CiAgICAgICAgJHRpbWVWYWx1ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCR0aW1lVmFsdWUpOwoKICAgICAgICBpZiAoIWlzX251bWVyaWMoJHRpbWVWYWx1ZSkpIHsKICAgICAgICAgICAgaWYgKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Z2V0Q29tcGF0aWJpbGl0eU1vZGUoKSA9PSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OkNPTVBBVElCSUxJVFlfR05VTUVSSUMpIHsKICAgICAgICAgICAgICAgICR0ZXN0VmFsID0gc3RydG9rKCR0aW1lVmFsdWUsICcvLTogJyk7CiAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCR0ZXN0VmFsKSA8IHN0cmxlbigkdGltZVZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRpbWVWYWx1ZSA9IHNlbGY6OmdldFRpbWVWYWx1ZSgkdGltZVZhbHVlKTsKICAgICAgICAgICAgaWYgKGlzX3N0cmluZygkdGltZVZhbHVlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBFeGVjdXRlIGZ1bmN0aW9uCiAgICAgICAgaWYgKCR0aW1lVmFsdWUgPj0gMSkgewogICAgICAgICAgICAkdGltZVZhbHVlID0gZm1vZCgkdGltZVZhbHVlLCAxKTsKICAgICAgICB9IGVsc2VpZiAoJHRpbWVWYWx1ZSA8IDAuMCkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICB9CiAgICAgICAgJHRpbWVWYWx1ZSA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQKCR0aW1lVmFsdWUpOwoKICAgICAgICByZXR1cm4gKGludCkgZ21kYXRlKCdHJywgJHRpbWVWYWx1ZSk7CiAgICB9CgoKICAgIC8qKgogICAgICogTUlOVVRFT0ZIT1VSCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgbWludXRlcyBvZiBhIHRpbWUgdmFsdWUuCiAgICAgKiBUaGUgbWludXRlIGlzIGdpdmVuIGFzIGFuIGludGVnZXIsIHJhbmdpbmcgZnJvbSAwIHRvIDU5LgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIE1JTlVURSh0aW1lVmFsdWUpCiAgICAgKgogICAgICogQHBhcmFtICAgIG1peGVkICAgICR0aW1lVmFsdWUgICAgICAgIEV4Y2VsIGRhdGUgc2VyaWFsIHZhbHVlIChmbG9hdCksIFBIUCBkYXRlIHRpbWVzdGFtcCAoaW50ZWdlciksCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgdGltZSBzdHJpbmcKICAgICAqIEByZXR1cm4gICAgaW50ICAgICAgICBNaW51dGUKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBNSU5VVEVPRkhPVVIoJHRpbWVWYWx1ZSA9IDApCiAgICB7CiAgICAgICAgJHRpbWVWYWx1ZSA9ICR0aW1lVGVzdGVyICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJHRpbWVWYWx1ZSk7CgogICAgICAgIGlmICghaXNfbnVtZXJpYygkdGltZVZhbHVlKSkgewogICAgICAgICAgICBpZiAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRDb21wYXRpYmlsaXR5TW9kZSgpID09IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Q09NUEFUSUJJTElUWV9HTlVNRVJJQykgewogICAgICAgICAgICAgICAgJHRlc3RWYWwgPSBzdHJ0b2soJHRpbWVWYWx1ZSwgJy8tOiAnKTsKICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJHRlc3RWYWwpIDwgc3RybGVuKCR0aW1lVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkdGltZVZhbHVlID0gc2VsZjo6Z2V0VGltZVZhbHVlKCR0aW1lVmFsdWUpOwogICAgICAgICAgICBpZiAoaXNfc3RyaW5nKCR0aW1lVmFsdWUpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpWQUxVRSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIEV4ZWN1dGUgZnVuY3Rpb24KICAgICAgICBpZiAoJHRpbWVWYWx1ZSA+PSAxKSB7CiAgICAgICAgICAgICR0aW1lVmFsdWUgPSBmbW9kKCR0aW1lVmFsdWUsIDEpOwogICAgICAgIH0gZWxzZWlmICgkdGltZVZhbHVlIDwgMC4wKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6Ok5hTigpOwogICAgICAgIH0KICAgICAgICAkdGltZVZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFAoJHRpbWVWYWx1ZSk7CgogICAgICAgIHJldHVybiAoaW50KSBnbWRhdGUoJ2knLCAkdGltZVZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBTRUNPTkRPRk1JTlVURQogICAgICoKICAgICAqIFJldHVybnMgdGhlIHNlY29uZHMgb2YgYSB0aW1lIHZhbHVlLgogICAgICogVGhlIHNlY29uZCBpcyBnaXZlbiBhcyBhbiBpbnRlZ2VyIGluIHRoZSByYW5nZSAwICh6ZXJvKSB0byA1OS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBTRUNPTkQodGltZVZhbHVlKQogICAgICoKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAkdGltZVZhbHVlICAgICAgICBFeGNlbCBkYXRlIHNlcmlhbCB2YWx1ZSAoZmxvYXQpLCBQSFAgZGF0ZSB0aW1lc3RhbXAgKGludGVnZXIpLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQSFAgRGF0ZVRpbWUgb2JqZWN0LCBvciBhIHN0YW5kYXJkIHRpbWUgc3RyaW5nCiAgICAgKiBAcmV0dXJuICAgIGludCAgICAgICAgU2Vjb25kCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gU0VDT05ET0ZNSU5VVEUoJHRpbWVWYWx1ZSA9IDApCiAgICB7CiAgICAgICAgJHRpbWVWYWx1ZSAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCR0aW1lVmFsdWUpOwoKICAgICAgICBpZiAoIWlzX251bWVyaWMoJHRpbWVWYWx1ZSkpIHsKICAgICAgICAgICAgaWYgKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Z2V0Q29tcGF0aWJpbGl0eU1vZGUoKSA9PSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OkNPTVBBVElCSUxJVFlfR05VTUVSSUMpIHsKICAgICAgICAgICAgICAgICR0ZXN0VmFsID0gc3RydG9rKCR0aW1lVmFsdWUsICcvLTogJyk7CiAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCR0ZXN0VmFsKSA8IHN0cmxlbigkdGltZVZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRpbWVWYWx1ZSA9IHNlbGY6OmdldFRpbWVWYWx1ZSgkdGltZVZhbHVlKTsKICAgICAgICAgICAgaWYgKGlzX3N0cmluZygkdGltZVZhbHVlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBFeGVjdXRlIGZ1bmN0aW9uCiAgICAgICAgaWYgKCR0aW1lVmFsdWUgPj0gMSkgewogICAgICAgICAgICAkdGltZVZhbHVlID0gZm1vZCgkdGltZVZhbHVlLCAxKTsKICAgICAgICB9IGVsc2VpZiAoJHRpbWVWYWx1ZSA8IDAuMCkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICB9CiAgICAgICAgJHRpbWVWYWx1ZSA9IFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpFeGNlbFRvUEhQKCR0aW1lVmFsdWUpOwoKICAgICAgICByZXR1cm4gKGludCkgZ21kYXRlKCdzJywgJHRpbWVWYWx1ZSk7CiAgICB9CgoKICAgIC8qKgogICAgICogRURBVEUKICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBzZXJpYWwgbnVtYmVyIHRoYXQgcmVwcmVzZW50cyB0aGUgZGF0ZSB0aGF0IGlzIHRoZSBpbmRpY2F0ZWQgbnVtYmVyIG9mIG1vbnRocwogICAgICogYmVmb3JlIG9yIGFmdGVyIGEgc3BlY2lmaWVkIGRhdGUgKHRoZSBzdGFydF9kYXRlKS4KICAgICAqIFVzZSBFREFURSB0byBjYWxjdWxhdGUgbWF0dXJpdHkgZGF0ZXMgb3IgZHVlIGRhdGVzIHRoYXQgZmFsbCBvbiB0aGUgc2FtZSBkYXkgb2YgdGhlIG1vbnRoCiAgICAgKiBhcyB0aGUgZGF0ZSBvZiBpc3N1ZS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBFREFURShkYXRlVmFsdWUsYWRqdXN0bWVudE1vbnRocykKICAgICAqCiAgICAgKiBAcGFyYW0gICAgbWl4ZWQgICAgJGRhdGVWYWx1ZSAgICAgICAgICAgIEV4Y2VsIGRhdGUgc2VyaWFsIHZhbHVlIChmbG9hdCksIFBIUCBkYXRlIHRpbWVzdGFtcCAoaW50ZWdlciksCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQSFAgRGF0ZVRpbWUgb2JqZWN0LCBvciBhIHN0YW5kYXJkIGRhdGUgc3RyaW5nCiAgICAgKiBAcGFyYW0gICAgaW50ICAgICAgICAkYWRqdXN0bWVudE1vbnRocyAgICBUaGUgbnVtYmVyIG9mIG1vbnRocyBiZWZvcmUgb3IgYWZ0ZXIgc3RhcnRfZGF0ZS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgcG9zaXRpdmUgdmFsdWUgZm9yIG1vbnRocyB5aWVsZHMgYSBmdXR1cmUgZGF0ZTsKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgbmVnYXRpdmUgdmFsdWUgeWllbGRzIGEgcGFzdCBkYXRlLgogICAgICogQHJldHVybiAgICBtaXhlZCAgICBFeGNlbCBkYXRlL3RpbWUgc2VyaWFsIHZhbHVlLCBQSFAgZGF0ZS90aW1lIHNlcmlhbCB2YWx1ZSBvciBQSFAgZGF0ZS90aW1lIG9iamVjdCwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZSBvZiB0aGUgUmV0dXJuRGF0ZVR5cGUgZmxhZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIEVEQVRFKCRkYXRlVmFsdWUgPSAxLCAkYWRqdXN0bWVudE1vbnRocyA9IDApCiAgICB7CiAgICAgICAgJGRhdGVWYWx1ZSAgICAgICAgICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGRhdGVWYWx1ZSk7CiAgICAgICAgJGFkanVzdG1lbnRNb250aHMgICAgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5TaW5nbGVWYWx1ZSgkYWRqdXN0bWVudE1vbnRocyk7CgogICAgICAgIGlmICghaXNfbnVtZXJpYygkYWRqdXN0bWVudE1vbnRocykpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CiAgICAgICAgJGFkanVzdG1lbnRNb250aHMgPSBmbG9vcigkYWRqdXN0bWVudE1vbnRocyk7CgogICAgICAgIGlmIChpc19zdHJpbmcoJGRhdGVWYWx1ZSA9IHNlbGY6OmdldERhdGVWYWx1ZSgkZGF0ZVZhbHVlKSkpIHsKICAgICAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6VkFMVUUoKTsKICAgICAgICB9CgogICAgICAgIC8vIEV4ZWN1dGUgZnVuY3Rpb24KICAgICAgICAkUEhQRGF0ZU9iamVjdCA9IHNlbGY6OmFkanVzdERhdGVCeU1vbnRocygkZGF0ZVZhbHVlLCAkYWRqdXN0bWVudE1vbnRocyk7CgogICAgICAgIHN3aXRjaCAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRSZXR1cm5EYXRlVHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX0VYQ0VMOgogICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdCkgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUFRvRXhjZWwoJFBIUERhdGVPYmplY3QpOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9QSFBfTlVNRVJJQzoKICAgICAgICAgICAgICAgIHJldHVybiAoaW50ZWdlcikgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFAoUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUFRvRXhjZWwoJFBIUERhdGVPYmplY3QpKTsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfUEhQX09CSkVDVDoKICAgICAgICAgICAgICAgIHJldHVybiAkUEhQRGF0ZU9iamVjdDsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogRU9NT05USAogICAgICoKICAgICAqIFJldHVybnMgdGhlIGRhdGUgdmFsdWUgZm9yIHRoZSBsYXN0IGRheSBvZiB0aGUgbW9udGggdGhhdCBpcyB0aGUgaW5kaWNhdGVkIG51bWJlciBvZiBtb250aHMKICAgICAqIGJlZm9yZSBvciBhZnRlciBzdGFydF9kYXRlLgogICAgICogVXNlIEVPTU9OVEggdG8gY2FsY3VsYXRlIG1hdHVyaXR5IGRhdGVzIG9yIGR1ZSBkYXRlcyB0aGF0IGZhbGwgb24gdGhlIGxhc3QgZGF5IG9mIHRoZSBtb250aC4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBFT01PTlRIKGRhdGVWYWx1ZSxhZGp1c3RtZW50TW9udGhzKQogICAgICoKICAgICAqIEBwYXJhbSAgICBtaXhlZCAgICAkZGF0ZVZhbHVlICAgICAgICAgICAgRXhjZWwgZGF0ZSBzZXJpYWwgdmFsdWUgKGZsb2F0KSwgUEhQIGRhdGUgdGltZXN0YW1wIChpbnRlZ2VyKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBIUCBEYXRlVGltZSBvYmplY3QsIG9yIGEgc3RhbmRhcmQgZGF0ZSBzdHJpbmcKICAgICAqIEBwYXJhbSAgICBpbnQgICAgICAgICRhZGp1c3RtZW50TW9udGhzICAgIFRoZSBudW1iZXIgb2YgbW9udGhzIGJlZm9yZSBvciBhZnRlciBzdGFydF9kYXRlLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSBwb3NpdGl2ZSB2YWx1ZSBmb3IgbW9udGhzIHlpZWxkcyBhIGZ1dHVyZSBkYXRlOwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBuZWdhdGl2ZSB2YWx1ZSB5aWVsZHMgYSBwYXN0IGRhdGUuCiAgICAgKiBAcmV0dXJuICAgIG1peGVkICAgIEV4Y2VsIGRhdGUvdGltZSBzZXJpYWwgdmFsdWUsIFBIUCBkYXRlL3RpbWUgc2VyaWFsIHZhbHVlIG9yIFBIUCBkYXRlL3RpbWUgb2JqZWN0LAogICAgICogICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRpbmcgb24gdGhlIHZhbHVlIG9mIHRoZSBSZXR1cm5EYXRlVHlwZSBmbGFnCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gRU9NT05USCgkZGF0ZVZhbHVlID0gMSwgJGFkanVzdG1lbnRNb250aHMgPSAwKQogICAgewogICAgICAgICRkYXRlVmFsdWUgICAgICAgICAgICA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6ZmxhdHRlblNpbmdsZVZhbHVlKCRkYXRlVmFsdWUpOwogICAgICAgICRhZGp1c3RtZW50TW9udGhzICAgID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGFkanVzdG1lbnRNb250aHMpOwoKICAgICAgICBpZiAoIWlzX251bWVyaWMoJGFkanVzdG1lbnRNb250aHMpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQogICAgICAgICRhZGp1c3RtZW50TW9udGhzID0gZmxvb3IoJGFkanVzdG1lbnRNb250aHMpOwoKICAgICAgICBpZiAoaXNfc3RyaW5nKCRkYXRlVmFsdWUgPSBzZWxmOjpnZXREYXRlVmFsdWUoJGRhdGVWYWx1ZSkpKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlZBTFVFKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBFeGVjdXRlIGZ1bmN0aW9uCiAgICAgICAgJFBIUERhdGVPYmplY3QgPSBzZWxmOjphZGp1c3REYXRlQnlNb250aHMoJGRhdGVWYWx1ZSwgJGFkanVzdG1lbnRNb250aHMrMSk7CiAgICAgICAgJGFkanVzdERheXMgPSAoaW50KSAkUEhQRGF0ZU9iamVjdC0+Zm9ybWF0KCdkJyk7CiAgICAgICAgJGFkanVzdERheXNTdHJpbmcgPSAnLScgLiAkYWRqdXN0RGF5cyAuICcgZGF5cyc7CiAgICAgICAgJFBIUERhdGVPYmplY3QtPm1vZGlmeSgkYWRqdXN0RGF5c1N0cmluZyk7CgogICAgICAgIHN3aXRjaCAoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpnZXRSZXR1cm5EYXRlVHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpSRVRVUk5EQVRFX0VYQ0VMOgogICAgICAgICAgICAgICAgcmV0dXJuIChmbG9hdCkgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUFRvRXhjZWwoJFBIUERhdGVPYmplY3QpOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9QSFBfTlVNRVJJQzoKICAgICAgICAgICAgICAgIHJldHVybiAoaW50ZWdlcikgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFAoUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUFRvRXhjZWwoJFBIUERhdGVPYmplY3QpKTsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OlJFVFVSTkRBVEVfUEhQX09CSkVDVDoKICAgICAgICAgICAgICAgIHJldHVybiAkUEhQRGF0ZU9iamVjdDsKICAgICAgICB9CiAgICB9Cn0K",
    "size": "69069"
}