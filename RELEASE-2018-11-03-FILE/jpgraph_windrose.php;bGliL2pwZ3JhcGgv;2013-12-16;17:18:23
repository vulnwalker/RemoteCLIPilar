{
    "namaFile": "lib\/jpgraph\/jpgraph_windrose.php",
    "lastUpdate": "2013-12-16+17:18:23.00",
    "contentFile": "PD9waHAKLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogLy8gRmlsZTogICAgICAgIEpQR1JBUEhfV0lORFJPU0UuUEhQCiAvLyBEZXNjcmlwdGlvbjogV2luZHJvc2UgZXh0ZW5zaW9uIGZvciBKcEdyYXBoCiAvLyBDcmVhdGVkOiAgICAgMjAwMy0wOS0xNwogLy8gVmVyOiAgICAgICAgICRJZDoganBncmFwaF93aW5kcm9zZS5waHAgMTkyOCAyMDEwLTAxLTExIDE5OjU2OjUxWiBsanAgJAogLy8KIC8vIENvcHlyaWdodCAoYykgQXNpYWwgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogKi8KCnJlcXVpcmVfb25jZSgnanBncmFwaF9nbGF5b3V0X3ZoLmluYy5waHAnKTsKCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIERldGVybWluZSBob3cgbWFueSBjb21wYXNzIGRpcmVjdGlvbnMgdG8gc2hvdwovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpkZWZpbmUoJ1dJTkRST1NFX1RZUEU0JywxKTsKZGVmaW5lKCdXSU5EUk9TRV9UWVBFOCcsMik7CmRlZmluZSgnV0lORFJPU0VfVFlQRTE2JywzKTsKZGVmaW5lKCdXSU5EUk9TRV9UWVBFRlJFRScsNCk7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBIb3cgc2hvdWxkIHRoZSBsYWJlbHMgZm9yIHRoZSBjaXJjdWxhciBncmlkcyBiZSBhbGlnbmVkCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmRlZmluZSgnTEJMQUxJR05fQ0VOVEVSJywxKTsKZGVmaW5lKCdMQkxBTElHTl9UT1AnLDIpOwoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gSG93IHNob3VsZCB0aGUgbGFiZWxzIGFyb3VuZCB0aGUgcGxvdCBiZSBhbGlnbgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpkZWZpbmUoJ0xCTFBPU0lUSU9OX0NFTlRFUicsMSk7CmRlZmluZSgnTEJMUE9TSVRJT05fRURHRScsMik7CgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBJbnRlcnByZXRhdGlvbiBvZiBvcmRpbmFsIHZhbHVlcyBpbiB0aGUgZGF0YQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpkZWZpbmUoJ0tFWUVOQ09ESU5HX0NMT0NLV0lTRScsMSk7CmRlZmluZSgnS0VZRU5DT0RJTkdfQU5USUNMT0NLV0lTRScsMik7CgovLyBJbnRlcm5hbCBkZWJ1ZyBmbGFnCmRlZmluZSgnX19ERUJVRycsZmFsc2UpOwoKCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIFdpbmRyb3NlUGxvdFNjYWxlCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmNsYXNzIFdpbmRyb3NlUGxvdFNjYWxlIHsKICAgIHByaXZhdGUgJGlNYXgsJGlEZWx0YT01OwogICAgcHJpdmF0ZSAkaU51bUNpcmM9MzsKICAgIHB1YmxpYyAkaU1heE51bT0wOwogICAgcHJpdmF0ZSAkaUxibEZtdD0nJS4wZiUlJzsKICAgIHB1YmxpYyAkaUZvbnRGYW1pbHk9RkZfVkVSREFOQSwkaUZvbnRTdHlsZT1GU19OT1JNQUwsJGlGb250U2l6ZT0xMDsKICAgIHB1YmxpYyAkaVpGb250RmFtaWx5PUZGX0FSSUFMLCRpWkZvbnRTdHlsZT1GU19OT1JNQUwsJGlaRm9udFNpemU9MTA7CiAgICBwdWJsaWMgJGlGb250Q29sb3I9J2JsYWNrJywkaVpGb250Q29sb3I9J2JsYWNrJzsKICAgIHByaXZhdGUgJGlGb250RnJhbWVDb2xvcj1mYWxzZSwgJGlGb250QmtnQ29sb3I9ZmFsc2U7CiAgICBwcml2YXRlICRpTGJsWmVyb1R4dD1udWxsOwogICAgcHJpdmF0ZSAkaUxibEFsaWduPUxCTEFMSUdOX0NFTlRFUjsKICAgIHB1YmxpYyAkaUFuZ2xlPSdhdXRvJzsKICAgIHByaXZhdGUgJGlNYW51YWxTY2FsZSA9IGZhbHNlOwogICAgcHJpdmF0ZSAkaUhpZGVMYWJlbHMgPSBmYWxzZTsKCiAgICBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkYURhdGEpIHsKICAgICAgICAkbWF4PTA7CiAgICAgICAgJHRvdGxlZ3N1bSA9IDA7CiAgICAgICAgJG1heG51bT0wOwogICAgICAgICR0aGlzLT5pWmVyb1N1bT0wOwogICAgICAgIGZvcmVhY2goICRhRGF0YSBhcyAkaWR4ID0+ICRsZWdkYXRhICkgewogICAgICAgICAgICAkbGVnc3VtID0gYXJyYXlfc3VtKCRsZWdkYXRhKTsKICAgICAgICAgICAgJG1heG51bSA9IG1heCgkbWF4bnVtLGNvdW50KCRsZWdkYXRhKS0xKTsKICAgICAgICAgICAgJG1heCA9IG1heCgkbGVnc3VtLSRsZWdkYXRhWzBdLCRtYXgpOwogICAgICAgICAgICAkdG90bGVnc3VtICs9ICRsZWdzdW07CiAgICAgICAgICAgICR0aGlzLT5pWmVyb1N1bSArPSAkbGVnZGF0YVswXSA7CiAgICAgICAgfQogICAgICAgIGlmKCByb3VuZCgkdG90bGVnc3VtKSA+IDEwMCApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjIwMDEsJGxlZ3N1bSk7CiAgICAgICAgICAgIC8vKCJUb3RhbCBwZXJjZW50YWdlIGZvciBhbGwgd2luZHJvc2UgbGVncyBpbiBhIHdpbmRyb3NlIHBsb3QgY2FuIG5vdCBleGNlZWQgIDEwMCUgIVxuKEN1cnJlbnQgbWF4IGlzOiAiLiRsZWdzdW0uJyknKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlNYXggPSAkbWF4IDsKICAgICAgICAkdGhpcy0+aU1heE51bSA9ICRtYXhudW07CiAgICAgICAgJHRoaXMtPmlOdW1DaXJjID0gJHRoaXMtPkdldE51bUNpcmMoKTsKICAgICAgICAkdGhpcy0+aU1heFZhbCA9ICR0aGlzLT5pTnVtQ2lyYyAqICR0aGlzLT5pRGVsdGEgOwogICAgfQoKICAgIC8vIFJldHVybiBudW1iZXIgb2YgZ3JpZCBjaXJjbGVzCiAgICBmdW5jdGlvbiBHZXROdW1DaXJjKCkgewogICAgICAgIC8vIE5ldmVyIHJldHVybiBsZXNzIHRoYW4gMSBjaXJjbGVzCiAgICAgICAgJG51bSA9IGNlaWwoJHRoaXMtPmlNYXggLyAkdGhpcy0+aURlbHRhKTsKICAgICAgICByZXR1cm4gbWF4KDEsJG51bSkgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldE1heFZhbHVlKCRhTWF4KSB7CiAgICAgICAgJHRoaXMtPmlNYXggPSAkYU1heDsKICAgICAgICAkdGhpcy0+aU51bUNpcmMgPSAkdGhpcy0+R2V0TnVtQ2lyYygpOwogICAgICAgICR0aGlzLT5pTWF4VmFsID0gJHRoaXMtPmlOdW1DaXJjICogJHRoaXMtPmlEZWx0YSA7CiAgICB9CgogICAgLy8gU2V0IHN0ZXAgc2l6ZSBmb3IgY2lyY3VsYXIgZ3JpZAogICAgZnVuY3Rpb24gU2V0KCRhTWF4LCRhRGVsdGE9bnVsbCkgewogICAgICAgIGlmKCAkYURlbHRhPT1udWxsICkgewogICAgICAgICAgICAkdGhpcy0+U2V0TWF4VmFsdWUoJGFNYXgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgICR0aGlzLT5pRGVsdGEgPSAkYURlbHRhOwogICAgICAgICR0aGlzLT5pTnVtQ2lyYyA9IGNlaWwoJGFNYXgvJGFEZWx0YSk7IC8vJHRoaXMtPkdldE51bUNpcmMoKTsKICAgICAgICAkdGhpcy0+aU1heFZhbCA9ICR0aGlzLT5pTnVtQ2lyYyAqICR0aGlzLT5pRGVsdGEgOwogICAgICAgICR0aGlzLT5pTWF4PSRhTWF4OwogICAgICAgIC8vIFJlbWVtYmVyIHRoYXQgdXNlciBoYXMgc3BlY2lmaWVkIGludGVydmFsIHNvIGRvbid0CiAgICAgICAgLy8gZG8gYXV0b3NjYWxpbmcKICAgICAgICAkdGhpcy0+aU1hbnVhbFNjYWxlID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBBdXRvU2NhbGUoJGFSYWRpdXMsJGFNaW5EaXN0PTMwKSB7CgogICAgICAgIGlmKCAkdGhpcy0+aU1hbnVhbFNjYWxlICkgcmV0dXJuOwoKICAgICAgICAvLyBNYWtlIHN1cmUgZGlzdGFuY2UgKGluIHBpeGVscykgYmV0d2VlbiB0d28gY2lyY2xlcwogICAgICAgIC8vIGlzIG5ldmVyIGxlc3MgdGhhbiAkYU1pbkRpc3QgcGl4ZWxzCiAgICAgICAgJHRzdCA9IGNlaWwoJGFSYWRpdXMgLyAkdGhpcy0+aU51bUNpcmMpIDsKCiAgICAgICAgd2hpbGUoICR0c3QgPD0gJGFNaW5EaXN0ICYmICR0aGlzLT5pRGVsdGEgPCAxMDAgKSB7CiAgICAgICAgICAgICR0aGlzLT5pRGVsdGEgKz0gNTsKICAgICAgICAgICAgJHRzdCA9IGNlaWwoJGFSYWRpdXMgLyAkdGhpcy0+R2V0TnVtQ2lyYygpKSA7CiAgICAgICAgfQoKICAgICAgICBpZiggJHRoaXMtPmlEZWx0YSA+PSAxMDAgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIyMDAyKTsvLygnR3JhcGggaXMgdG9vIHNtYWxsIHRvIGhhdmUgYSBzY2FsZS4gUGxlYXNlIG1ha2UgdGhlIGdyYXBoIGxhcmdlci4nKTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBkaXN0YW5jZSBpcyB0byBsYXJnZSB0cnkgd2l0aCBtdWx0aXBsZXMgb2YgMiBpbnN0ZWFkCiAgICAgICAgaWYoICR0c3QgPiAkYU1pbkRpc3QgKiAzICkgewogICAgICAgICAgICAkdGhpcy0+aURlbHRhID0gMjsKICAgICAgICAgICAgJHRzdCA9IGNlaWwoJGFSYWRpdXMgLyAkdGhpcy0+aU51bUNpcmMpIDsKCiAgICAgICAgICAgIHdoaWxlKCAkdHN0IDw9ICRhTWluRGlzdCAmJiAkdGhpcy0+aURlbHRhIDwgMTAwICkgewogICAgICAgICAgICAgICAgJHRoaXMtPmlEZWx0YSArPSAyOwogICAgICAgICAgICAgICAgJHRzdCA9IGNlaWwoJGFSYWRpdXMgLyAkdGhpcy0+R2V0TnVtQ2lyYygpKSA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aURlbHRhID49IDEwMCApIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIyMDAyKTsgLy8oJ0dyYXBoIGlzIHRvbyBzbWFsbCB0byBoYXZlIGEgc2NhbGUuIFBsZWFzZSBtYWtlIHRoZSBncmFwaCBsYXJnZXIuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICR0aGlzLT5pTnVtQ2lyYyA9ICR0aGlzLT5HZXROdW1DaXJjKCk7CiAgICAgICAgJHRoaXMtPmlNYXhWYWwgPSAkdGhpcy0+aU51bUNpcmMgKiAkdGhpcy0+aURlbHRhIDsKICAgIH0KCiAgICAvLyBSZXR1cm4gbWF4IG9mIGFsbCBsZWcgdmFsdWVzCiAgICBmdW5jdGlvbiBHZXRNYXgoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5pTWF4OwogICAgfQoKICAgIGZ1bmN0aW9uIEhpZGUoJGFGbGc9dHJ1ZSkgewogICAgICAgICR0aGlzLT5pSGlkZUxhYmVscyA9ICRhRmxnOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEFuZ2xlKCRhQW5nbGUpIHsKICAgICAgICAkdGhpcy0+aUFuZ2xlID0gJGFBbmdsZSA7CiAgICB9CgogICAgLy8gVHJhbnNsYXRlIGEgTGVnIHZhbHVlIHRvIHJhZGl1cyBkaXN0YW5jZQogICAgZnVuY3Rpb24gUmVsVHJhbnNsYXRlKCRhVmFsLCRyLCRyaSkgewogICAgICAgICR0diA9IHJvdW5kKCRhVmFsLyR0aGlzLT5pTWF4VmFsKigkci0kcmkpKTsKICAgICAgICByZXR1cm4gJHR2IDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMYWJlbEFsaWduKCRhQWxpZ24pIHsKICAgICAgICAkdGhpcy0+aUxibEFsaWduID0gJGFBbGlnbiA7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TGFiZWxGb3JtYXQoJGFGbXQpIHsKICAgICAgICAkdGhpcy0+aUxibEZtdCA9ICRhRm10IDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRMYWJlbEZpbGxDb2xvcigkYUJrZ0NvbG9yLCRhQm9yZGVyQ29sb3I9ZmFsc2UpIHsKCiAgICAgICAgJHRoaXMtPmlGb250QmtnQ29sb3IgPSAkYUJrZ0NvbG9yOwogICAgICAgIGlmKCAkYUJvcmRlckNvbG9yID09PSBmYWxzZSApIHsKICAgICAgICAgICAgJHRoaXMtPmlGb250RnJhbWVDb2xvciA9ICRhQmtnQ29sb3I7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+aUZvbnRGcmFtZUNvbG9yID0gJGFCb3JkZXJDb2xvcjsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Rm9udENvbG9yKCRhQ29sb3IpIHsKICAgICAgICAkdGhpcy0+aUZvbnRDb2xvciA9ICRhQ29sb3IgOwogICAgICAgICR0aGlzLT5pWkZvbnRDb2xvciA9ICRhQ29sb3IgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEZvbnQoJGFGb250RmFtaWx5LCRhRm9udFN0eWxlPUZTX05PUk1BTCwkYUZvbnRTaXplPTEwKSB7CiAgICAgICAgJHRoaXMtPmlGb250RmFtaWx5ID0gJGFGb250RmFtaWx5IDsKICAgICAgICAkdGhpcy0+aUZvbnRTdHlsZSA9ICRhRm9udFN0eWxlIDsKICAgICAgICAkdGhpcy0+aUZvbnRTaXplID0gJGFGb250U2l6ZSA7CiAgICAgICAgJHRoaXMtPlNldFpGb250KCRhRm9udEZhbWlseSwkYUZvbnRTdHlsZSwkYUZvbnRTaXplKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRaRm9udCgkYUZvbnRGYW1pbHksJGFGb250U3R5bGU9RlNfTk9STUFMLCRhRm9udFNpemU9MTApIHsKICAgICAgICAkdGhpcy0+aVpGb250RmFtaWx5ID0gJGFGb250RmFtaWx5IDsKICAgICAgICAkdGhpcy0+aVpGb250U3R5bGUgPSAkYUZvbnRTdHlsZSA7CiAgICAgICAgJHRoaXMtPmlaRm9udFNpemUgPSAkYUZvbnRTaXplIDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRaZXJvTGFiZWwoJGFUeHQpIHsKICAgICAgICAkdGhpcy0+aUxibFplcm9UeHQgPSAkYVR4dCA7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0WkZvbnRDb2xvcigkYUNvbG9yKSB7CiAgICAgICAgJHRoaXMtPmlaRm9udENvbG9yID0gJGFDb2xvciA7CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlTGFiZWxzKCRhSW1nLCR4YywkeWMsJHJpLCRycikgewoKICAgICAgICBpZiggJHRoaXMtPmlIaWRlTGFiZWxzICkgcmV0dXJuOwoKICAgICAgICAvLyBTZXR1cCBzb21lIGNvbnZpbmllbnQgdmFpcmFibGVzCiAgICAgICAgJGEgPSAkdGhpcy0+aUFuZ2xlICogTV9QSS8xODAuMDsKICAgICAgICAkbiA9ICR0aGlzLT5pTnVtQ2lyYzsKICAgICAgICAkZCA9ICR0aGlzLT5pRGVsdGE7CgogICAgICAgIC8vIFNldHVwIHRoZSBmb250IGFuZCBmb250IGNvbG9yCiAgICAgICAgJHZhbCA9IG5ldyBUZXh0KCk7CiAgICAgICAgJHZhbC0+U2V0Rm9udCgkdGhpcy0+aUZvbnRGYW1pbHksJHRoaXMtPmlGb250U3R5bGUsJHRoaXMtPmlGb250U2l6ZSk7CiAgICAgICAgJHZhbC0+U2V0Q29sb3IoJHRoaXMtPmlGb250Q29sb3IpOwoKICAgICAgICBpZiggJHRoaXMtPmlGb250QmtnQ29sb3IgIT09IGZhbHNlICkgewogICAgICAgICAgICAkdmFsLT5TZXRCb3goJHRoaXMtPmlGb250QmtnQ29sb3IsJHRoaXMtPmlGb250RnJhbWVDb2xvcik7CiAgICAgICAgfQoKICAgICAgICAvLyBQb3NpdGlvbiB0aGUgbGFiZWxzIHJlbGF0aXZlIHRvIHRoZSByYWRpYW50IGNpcmNsZXMKICAgICAgICBpZiggJHRoaXMtPmlMYmxBbGlnbiA9PSBMQkxBTElHTl9UT1AgKSB7CiAgICAgICAgICAgIGlmKCAkYSA+IDAgJiYgJGEgPD0gTV9QSS8yICkgewogICAgICAgICAgICAgICAgJHZhbC0+U2V0QWxpZ24oJ2xlZnQnLCdib3R0b20nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYoICRhID4gTV9QSS8yICYmICRhIDw9IE1fUEkgKSB7CiAgICAgICAgICAgICAgICAkdmFsLT5TZXRBbGlnbigncmlnaHQnLCdib3R0b20nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYoICR0aGlzLT5pTGJsQWxpZ24gPT0gTEJMQUxJR05fQ0VOVEVSICkgewogICAgICAgICAgICAkdmFsLT5TZXRBbGlnbignY2VudGVyJywnY2VudGVyJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdHJva2UgdGhlIGxhYmVscyBjbG9zZSB0byBlYWNoIGNpcmNsZQogICAgICAgICR2ID0gJGQgOwogICAgICAgICRzaSA9IHNpbigkYSk7CiAgICAgICAgJGNvID0gY29zKCRhKTsKICAgICAgICBmb3IoICRpPTA7ICRpIDwgJG47ICsrJGksICR2ICs9ICRkICkgewogICAgICAgICAgICAkciA9ICRyaSArICgkaSsxKSAqICRycjsKICAgICAgICAgICAgJHggPSAkeGMgKyAkY28gKiAkcjsKICAgICAgICAgICAgJHkgPSAkeWMgLSAkc2kgKiAkcjsKICAgICAgICAgICAgJHZhbC0+U2V0KHNwcmludGYoJHRoaXMtPmlMYmxGbXQsJHYpKTsKICAgICAgICAgICAgJHZhbC0+U3Ryb2tlKCRhSW1nLCR4LCR5KTsKICAgICAgICB9CgogICAgICAgIC8vIFByaW50IHRoZSB0ZXh0IGluIHRoZSB6ZXJvIGNpcmNsZQogICAgICAgIGlmKCAkdGhpcy0+aUxibFplcm9UeHQgPT09IG51bGwgKSB7CiAgICAgICAgICAgICR0aGlzLT5pTGJsWmVyb1R4dCA9IHNwcmludGYoJHRoaXMtPmlMYmxGbXQsJHRoaXMtPmlaZXJvU3VtKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5pTGJsWmVyb1R4dCA9IHNwcmludGYoJHRoaXMtPmlMYmxaZXJvVHh0LCR0aGlzLT5pWmVyb1N1bSk7CiAgICAgICAgfQoKICAgICAgICAkdmFsLT5TZXQoJHRoaXMtPmlMYmxaZXJvVHh0KTsKICAgICAgICAkdmFsLT5TZXRBbGlnbignY2VudGVyJywnY2VudGVyJyk7CiAgICAgICAgJHZhbC0+U2V0UGFyYWdyYXBoQWxpZ24oJ2NlbnRlcicpOwogICAgICAgICR2YWwtPlNldENvbG9yKCR0aGlzLT5pWkZvbnRDb2xvcik7CiAgICAgICAgJHZhbC0+U2V0Rm9udCgkdGhpcy0+aVpGb250RmFtaWx5LCR0aGlzLT5pWkZvbnRTdHlsZSwkdGhpcy0+aVpGb250U2l6ZSk7CiAgICAgICAgJHZhbC0+U3Ryb2tlKCRhSW1nLCR4YywkeWMpOwogICAgfQp9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBMZWdlbmRTdHlsZQovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpjbGFzcyBMZWdlbmRTdHlsZSB7CiAgICBwdWJsaWMgJGlMZW5ndGggPSA0MCwgJGlNYXJnaW4gPSAyMCAsICRpQm90dG9tTWFyZ2luPTU7CiAgICBwdWJsaWMgJGlDaXJjbGVXZWlnaHQ9MiwgICRpQ2lyY2xlUmFkaXVzID0gMTgsICRpQ2lyY2xlQ29sb3I9J2JsYWNrJzsKICAgIHB1YmxpYyAkaVR4dEZvbnRGYW1pbHk9RkZfVkVSREFOQSwkaVR4dEZvbnRTdHlsZT1GU19OT1JNQUwsJGlUeHRGb250U2l6ZT04OwogICAgcHVibGljICRpTGJsRm9udEZhbWlseT1GRl9WRVJEQU5BLCRpTGJsRm9udFN0eWxlPUZTX05PUk1BTCwkaUxibEZvbnRTaXplPTg7CiAgICBwdWJsaWMgJGlDaXJjbGVGb250RmFtaWx5PUZGX1ZFUkRBTkEsJGlDaXJjbGVGb250U3R5bGU9RlNfTk9STUFMLCRpQ2lyY2xlRm9udFNpemU9ODsKICAgIHB1YmxpYyAkaUxibEZvbnRDb2xvcj0nYmxhY2snLCRpVHh0Rm9udENvbG9yPSdibGFjaycsJGlDaXJjbGVGb250Q29sb3I9J2JsYWNrJzsKICAgIHB1YmxpYyAkaVNob3c9dHJ1ZTsKICAgIHB1YmxpYyAkaUZvcm1hdFN0cmluZz0nJS4xZic7CiAgICBwdWJsaWMgJGlUeHRNYXJnaW49NiwgJGlUeHQ9Jyc7CiAgICBwdWJsaWMgJGlaQ2lyY2xlVHh0PSdDYWxtJzsKCiAgICBmdW5jdGlvbiBTZXRGb250KCRhRm9udEZhbWlseSwkYUZvbnRTdHlsZT1GU19OT1JNQUwsJGFGb250U2l6ZT0xMCkgewogICAgICAgICR0aGlzLT5pTGJsRm9udEZhbWlseSA9ICRhRm9udEZhbWlseSA7CiAgICAgICAgJHRoaXMtPmlMYmxGb250U3R5bGUgPSAkYUZvbnRTdHlsZSA7CiAgICAgICAgJHRoaXMtPmlMYmxGb250U2l6ZSA9ICRhRm9udFNpemUgOwogICAgICAgICR0aGlzLT5pVHh0Rm9udEZhbWlseSA9ICRhRm9udEZhbWlseSA7CiAgICAgICAgJHRoaXMtPmlUeHRGb250U3R5bGUgPSAkYUZvbnRTdHlsZSA7CiAgICAgICAgJHRoaXMtPmlUeHRGb250U2l6ZSA9ICRhRm9udFNpemUgOwogICAgICAgICR0aGlzLT5pQ2lyY2xlRm9udEZhbWlseSA9ICRhRm9udEZhbWlseSA7CiAgICAgICAgJHRoaXMtPmlDaXJjbGVGb250U3R5bGUgPSAkYUZvbnRTdHlsZSA7CiAgICAgICAgJHRoaXMtPmlDaXJjbGVGb250U2l6ZSA9ICRhRm9udFNpemUgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldExGb250KCRhRm9udEZhbWlseSwkYUZvbnRTdHlsZT1GU19OT1JNQUwsJGFGb250U2l6ZT0xMCkgewogICAgICAgICR0aGlzLT5pTGJsRm9udEZhbWlseSA9ICRhRm9udEZhbWlseSA7CiAgICAgICAgJHRoaXMtPmlMYmxGb250U3R5bGUgPSAkYUZvbnRTdHlsZSA7CiAgICAgICAgJHRoaXMtPmlMYmxGb250U2l6ZSA9ICRhRm9udFNpemUgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFRGb250KCRhRm9udEZhbWlseSwkYUZvbnRTdHlsZT1GU19OT1JNQUwsJGFGb250U2l6ZT0xMCkgewogICAgICAgICR0aGlzLT5pVHh0Rm9udEZhbWlseSA9ICRhRm9udEZhbWlseSA7CiAgICAgICAgJHRoaXMtPmlUeHRGb250U3R5bGUgPSAkYUZvbnRTdHlsZSA7CiAgICAgICAgJHRoaXMtPmlUeHRGb250U2l6ZSA9ICRhRm9udFNpemUgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENGb250KCRhRm9udEZhbWlseSwkYUZvbnRTdHlsZT1GU19OT1JNQUwsJGFGb250U2l6ZT0xMCkgewogICAgICAgICR0aGlzLT5pQ2lyY2xlRm9udEZhbWlseSA9ICRhRm9udEZhbWlseSA7CiAgICAgICAgJHRoaXMtPmlDaXJjbGVGb250U3R5bGUgPSAkYUZvbnRTdHlsZSA7CiAgICAgICAgJHRoaXMtPmlDaXJjbGVGb250U2l6ZSA9ICRhRm9udFNpemUgOwogICAgfQoKCiAgICBmdW5jdGlvbiBTZXRGb250Q29sb3IoJGFDb2xvcikgewogICAgICAgICR0aGlzLT5pVHh0Rm9udENvbG9yID0gJGFDb2xvciA7CiAgICAgICAgJHRoaXMtPmlMYmxGb250Q29sb3IgPSAkYUNvbG9yIDsKICAgICAgICAkdGhpcy0+aUNpcmNsZUZvbnRDb2xvciA9ICRhQ29sb3IgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFRGb250Q29sb3IoJGFDb2xvcikgewogICAgICAgICR0aGlzLT5pVHh0Rm9udENvbG9yID0gJGFDb2xvciA7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TEZvbnRDb2xvcigkYUNvbG9yKSB7CiAgICAgICAgJHRoaXMtPmlMYmxGb250Q29sb3IgPSAkYUNvbG9yIDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDRm9udENvbG9yKCRhQ29sb3IpIHsKICAgICAgICAkdGhpcy0+aUNpcmNsZUZvbnRDb2xvciA9ICRhQ29sb3IgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENpcmNsZVdlaWdodCgkYVdlaWdodCkgewogICAgICAgICR0aGlzLT5pQ2lyY2xlV2VpZ2h0ID0gJGFXZWlnaHQ7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Q2lyY2xlUmFkaXVzKCRhUmFkaXVzKSB7CiAgICAgICAgJHRoaXMtPmlDaXJjbGVSYWRpdXMgPSAkYVJhZGl1czsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDaXJjbGVDb2xvcigkYUNvbG9yKSB7CiAgICAgICAgJHRoaXMtPmlDaXJjbGVDb2xvciA9ICRhQ29sb3IgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENpcmNsZVRleHQoJGFUeHQpIHsKICAgICAgICAkdGhpcy0+aVpDaXJjbGVUeHQgPSAkYVR4dDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRNYXJnaW4oJGFNYXJnLCRhQm90dG9tTWFyZ2luPTUpIHsKICAgICAgICAkdGhpcy0+aU1hcmdpbj0kYU1hcmc7CiAgICAgICAgJHRoaXMtPmlCb3R0b21NYXJnaW49JGFCb3R0b21NYXJnaW47CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TGVuZ3RoKCRhTGVuZ3RoKSB7CiAgICAgICAgJHRoaXMtPmlMZW5ndGggPSAkYUxlbmd0aCA7CiAgICB9CgogICAgZnVuY3Rpb24gU2hvdygkYUZsZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmlTaG93ID0gJGFGbGc7CiAgICB9CgogICAgZnVuY3Rpb24gSGlkZSgkYUZsZz10cnVlKSB7CiAgICAgICAgJHRoaXMtPmlTaG93ID0gISAkYUZsZzsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRGb3JtYXQoJGFGbXQpIHsKICAgICAgICAkdGhpcy0+aUZvcm1hdFN0cmluZz0kYUZtdDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRUZXh0KCRhVHh0KSB7CiAgICAgICAgJHRoaXMtPmlUeHQgPSAkYVR4dCA7CiAgICB9Cgp9CgpkZWZpbmUoJ1JBTkdFX09WRVJMQVBQSU5HJywwKTsKZGVmaW5lKCdSQU5HRV9ESVNDUkVURScsMSk7CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBDTEFTUyBXaW5kcm9zZVBsb3QKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgV2luZHJvc2VQbG90IHsKICAgIHByaXZhdGUgJGlBbnRpQWxpYXM9dHJ1ZTsKICAgIHByaXZhdGUgJGlEYXRhPWFycmF5KCk7CiAgICBwdWJsaWMgJGlYPTAuNSwkaVk9MC41OwogICAgcHVibGljICRpU2l6ZT0wLjU1OwogICAgcHJpdmF0ZSAkaUdyaWRDb2xvcjE9J2dyYXknLCRpR3JpZENvbG9yMj0nZGFya2dyZWVuJzsKICAgIHByaXZhdGUgJGlSYWRpYWxDb2xvckFycmF5PWFycmF5KCk7CiAgICBwcml2YXRlICRpUmFkaWFsV2VpZ2h0QXJyYXk9YXJyYXkoKTsKICAgIHByaXZhdGUgJGlSYWRpYWxTdHlsZUFycmF5PWFycmF5KCk7CiAgICBwcml2YXRlICRpUmFuZ2VzID0gYXJyYXkoMSwyLDMsNSw2LDEwLDEzLjUsOTkuMCk7CiAgICBwcml2YXRlICRpUmFuZ2VTdHlsZSA9IFJBTkdFX09WRVJMQVBQSU5HIDsKICAgIHB1YmxpYyAkaUNlbnRlclNpemU9NjA7CiAgICBwcml2YXRlICRpVHlwZSA9IFdJTkRST1NFX1RZUEUxNjsKICAgIHB1YmxpYyAkaUZvbnRGYW1pbHk9RkZfVkVSREFOQSwkaUZvbnRTdHlsZT1GU19OT1JNQUwsJGlGb250U2l6ZT0xMDsKICAgIHB1YmxpYyAkaUZvbnRDb2xvcj0nZGFya2dyYXknOwogICAgcHJpdmF0ZSAkaVJhZGlhbEdyaWRTdHlsZT0nbG9uZ2Rhc2hlZCc7CiAgICBwcml2YXRlICRpQWxsRGlyZWN0aW9uTGFiZWxzID0gIGFycmF5KCdFJywnRU5FJywnTkUnLCdOTkUnLCdOJywnTk5XJywnTlcnLCdXTlcnLCdXJywnV1NXJywnU1cnLCdTU1cnLCdTJywnU1NFJywnU0UnLCdFU0UnKTsKICAgIHByaXZhdGUgJGlTdGFuZGFyZERpcmVjdGlvbnMgPSBhcnJheSgpOwogICAgcHJpdmF0ZSAkaUNpcmNHcmlkV2VpZ2h0PTMsICRpUmFkaWFsR3JpZFdlaWdodD0xOwogICAgcHJpdmF0ZSAkaUxhYmVsTWFyZ2luPTEyOwogICAgcHJpdmF0ZSAkaUxlZ3dlaWdodHMgPSBhcnJheSgyLDQsNiw4LDEwLDEyLDE0LDE2LDE4LDIwKTsKICAgIHByaXZhdGUgJGlMZWdDb2xvcnMgPSBhcnJheSgnb3JhbmdlJywnYmxhY2snLCdibHVlJywncmVkJywnZ3JlZW4nLCdwdXJwbGUnLCduYXZ5JywneWVsbG93JywnYnJvd24nKTsKICAgIHByaXZhdGUgJGlMYWJlbEZvcm1hdFN0cmluZz0nJywgJGlMYWJlbHM9YXJyYXkoKTsKICAgIHByaXZhdGUgJGlMYWJlbFBvc2l0aW9uaW5nID0gTEJMUE9TSVRJT05fRURHRTsKICAgIHByaXZhdGUgJGlDb2xvcj0nd2hpdGUnOwogICAgcHJpdmF0ZSAkaVNob3dCb3g9ZmFsc2UsICRpQm94Q29sb3I9J2JsYWNrJywkaUJveFdlaWdodD0xLCRpQm94U3R5bGU9J3NvbGlkJzsKICAgIHByaXZhdGUgJGlPcmRpbmFsRW5jb2Rpbmc9S0VZRU5DT0RJTkdfQU5USUNMT0NLV0lTRTsKICAgIHB1YmxpYyAkbGVnZW5kPW51bGw7CgogICAgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGFEYXRhKSB7CiAgICAgICAgJHRoaXMtPmlEYXRhID0gJGFEYXRhOwogICAgICAgICR0aGlzLT5sZWdlbmQgPSBuZXcgTGVnZW5kU3R5bGUoKTsKCiAgICAgICAgLy8gU2V0dXAgdGhlIHNjYWxlCiAgICAgICAgJHRoaXMtPnNjYWxlID0gbmV3IFdpbmRyb3NlUGxvdFNjYWxlKCR0aGlzLT5pRGF0YSk7CgogICAgICAgIC8vIGRlZmF1bHQgbGFiZWwgZm9yIGZyZWUgdHlwZSBpIGFnbGUgYW5kIGEgZGVncmVlIHNpZ24KICAgICAgICAkdGhpcy0+aUxhYmVsRm9ybWF0U3RyaW5nID0gJyUuMWYnLlN5bUNoYXI6OkdldCgnZGVncmVlJyk7CgogICAgICAgICRkZWx0YSA9IDIqTV9QSS8xNjsKICAgICAgICBmb3IoICRpPTAsICRhPTA7ICRpIDwgMTY7ICsrJGksICRhICs9ICRkZWx0YSApIHsKICAgICAgICAgICAgJHRoaXMtPmlTdGFuZGFyZERpcmVjdGlvbnNbJHRoaXMtPmlBbGxEaXJlY3Rpb25MYWJlbHNbJGldXSA9ICRhOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBEdW1teSBtZXRob2QgdG8gbWFrZSB3aW5kb3cgcGxvdHMgaGF2ZSB0aGUgc2FtZSBzaWduYXR1cmUgYXMgdGhlCiAgICAvLyBsYXlvdXQgY2xhc3NlcyBzaW5jZSB3aW5kcm9zZSBwbG90cyBhcmUgImxlYWYiIGNsYXNzZXMgaW4gdGhlIGhpZXJhcmNoeQogICAgZnVuY3Rpb24gTGF5b3V0U2l6ZSgpIHsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRTaXplKCRhU2l6ZSkgewogICAgICAgICR0aGlzLT5pU2l6ZSA9ICRhU2l6ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXREYXRhS2V5RW5jb2RpbmcoJGFFbmNvZGluZykgewogICAgICAgICR0aGlzLT5pT3JkaW5hbEVuY29kaW5nID0gJGFFbmNvZGluZzsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDb2xvcigkYUNvbG9yKSB7CiAgICAgICAgJHRoaXMtPmlDb2xvciA9ICRhQ29sb3I7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0UmFkaWFsQ29sb3JzKCRhQ29sb3JzKSB7CiAgICAgICAgJHRoaXMtPmlSYWRpYWxDb2xvckFycmF5ID0gJGFDb2xvcnM7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0UmFkaWFsV2VpZ2h0cygkYVdlaWdodHMpIHsKICAgICAgICAkdGhpcy0+aVJhZGlhbFdlaWdodEFycmF5ID0gJGFXZWlnaHRzOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFJhZGlhbFN0eWxlcygkYVN0eWxlcykgewogICAgICAgICR0aGlzLT5pUmFkaWFsU3R5bGVBcnJheSA9ICRhU3R5bGVzOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldEJveCgkYUNvbG9yPSdibGFjaycsJGFXZWlnaHQ9MSwgJGFTdHlsZT0nc29saWQnLCAkYVNob3c9dHJ1ZSkgewogICAgICAgICR0aGlzLT5pU2hvd0JveCA9ICRhU2hvdyA7CiAgICAgICAgJHRoaXMtPmlCb3hDb2xvciA9ICRhQ29sb3IgOwogICAgICAgICR0aGlzLT5pQm94V2VpZ2h0ID0gJGFXZWlnaHQgOwogICAgICAgICR0aGlzLT5pQm94U3R5bGUgPSAkYVN0eWxlOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldExhYmVscygkYUxhYmVscykgewogICAgICAgICR0aGlzLT5pTGFiZWxzID0gJGFMYWJlbHMgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldExhYmVsTWFyZ2luKCRhTWFyZykgewogICAgICAgICR0aGlzLT5pTGFiZWxNYXJnaW4gPSAkYU1hcmcgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldExhYmVsRm9ybWF0KCRhTGJsRm9ybWF0KSB7CiAgICAgICAgJHRoaXMtPmlMYWJlbEZvcm1hdFN0cmluZyA9ICRhTGJsRm9ybWF0IDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDb21wYXNzTGFiZWxzKCRhTGFiZWxzKSB7CiAgICAgICAgaWYoIGNvdW50KCRhTGFiZWxzKSAhPSAxNiApIHsKICAgICAgICAgICAgSnBncmFwaEVycm9yOjpSYWlzZUwoMjIwMDQpOyAvLygnTGFiZWwgc3BlY2lmaWNhdGlvbiBmb3Igd2luZHJvc2UgZGlyZWN0aW9ucyBtdXN0IGhhdmUgMTYgdmFsdWVzIChvbmUgZm9yIGVhY2ggY29tcGFzcyBkaXJlY3Rpb24pLicpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+aUFsbERpcmVjdGlvbkxhYmVscyA9ICRhTGFiZWxzIDsKCiAgICAgICAgJGRlbHRhID0gMipNX1BJLzE2OwogICAgICAgIGZvciggJGk9MCwgJGE9MDsgJGkgPCAxNjsgKyskaSwgJGEgKz0gJGRlbHRhICkgewogICAgICAgICAgICAkdGhpcy0+aVN0YW5kYXJkRGlyZWN0aW9uc1skdGhpcy0+aUFsbERpcmVjdGlvbkxhYmVsc1skaV1dID0gJGE7CiAgICAgICAgfQoKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRDZW50ZXJTaXplKCRhU2l6ZSkgewogICAgICAgICR0aGlzLT5pQ2VudGVyU2l6ZSA9ICRhU2l6ZTsKICAgIH0KICAgIC8vIEFsaWFzIGZvciBTZXRDZW50ZXJTaXplCiAgICBmdW5jdGlvbiBTZXRaQ2lyY2xlU2l6ZSgkYVNpemUpIHsKICAgICAgICAkdGhpcy0+aUNlbnRlclNpemUgPSAkYVNpemU7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0Rm9udCgkYUZGYW0sJGFGU3R5bGU9RlNfTk9STUFMLCRhRlNpemU9MTApIHsKICAgICAgICAkdGhpcy0+aUZvbnRGYW1pbHkgPSAkYUZGYW0gOwogICAgICAgICR0aGlzLT5pRm9udFN0eWxlID0gJGFGU3R5bGUgOwogICAgICAgICR0aGlzLT5pRm9udFNpemUgPSAkYUZTaXplIDsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRGb250Q29sb3IoJGFDb2xvcikgewogICAgICAgICR0aGlzLT5pRm9udENvbG9yPSRhQ29sb3I7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0R3JpZENvbG9yKCRhQ29sb3IxLCRhQ29sb3IyKSB7CiAgICAgICAgJHRoaXMtPmlHcmlkQ29sb3IxID0gJGFDb2xvcjE7CiAgICAgICAgJHRoaXMtPmlHcmlkQ29sb3IyID0gJGFDb2xvcjI7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0R3JpZFdlaWdodCgkYUdyaWQxPTEsJGFHcmlkMj0yKSB7CiAgICAgICAgJHRoaXMtPmlDaXJjR3JpZFdlaWdodCA9ICRhR3JpZDEgOwogICAgICAgICR0aGlzLT5pUmFkaWFsR3JpZFdlaWdodCA9ICRhR3JpZDIgOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFJhZGlhbEdyaWRTdHlsZSgkYVN0eWxlKSB7CiAgICAgICAgJGFTdHlsZSA9IHN0cnRvbG93ZXIoJGFTdHlsZSk7CiAgICAgICAgaWYoICFpbl9hcnJheSgkYVN0eWxlLGFycmF5KCdzb2xpZCcsJ2RvdHRlZCcsJ2Rhc2hlZCcsJ2xvbmdkYXNoZWQnKSkgKSB7CiAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIyMDA1KTsgLy8oIkxpbmUgc3R5bGUgZm9yIHJhZGlhbCBsaW5lcyBtdXN0IGJlIG9uIG9mICgnc29saWQnLCdkb3R0ZWQnLCdkYXNoZWQnLCdsb25nZGFzaGVkJykgIik7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5pUmFkaWFsR3JpZFN0eWxlPSRhU3R5bGU7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0UmFuZ2VzKCRhUmFuZ2VzKSB7CiAgICAgICAgJHRoaXMtPmlSYW5nZXMgPSAkYVJhbmdlczsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRSYW5nZVN0eWxlKCRhU3R5bGUpIHsKICAgICAgICAkdGhpcy0+aVJhbmdlU3R5bGUgPSAkYVN0eWxlOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldFJhbmdlQ29sb3JzKCRhTGVnQ29sb3JzKSB7CiAgICAgICAgJHRoaXMtPmlMZWdDb2xvcnMgPSAkYUxlZ0NvbG9yczsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRSYW5nZVdlaWdodHMoJGFXZWlnaHRzKSB7CiAgICAgICAgJG49Y291bnQoJGFXZWlnaHRzKTsKICAgICAgICBmb3IoJGk9MDsgJGk8ICRuOyArKyRpICkgewogICAgICAgICAgICAkYVdlaWdodHNbJGldID0gZmxvb3IoJGFXZWlnaHRzWyRpXS8yKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlMZWd3ZWlnaHRzID0gJGFXZWlnaHRzOwoKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRUeXBlKCRhVHlwZSkgewogICAgICAgIGlmKCAkYVR5cGUgPCBXSU5EUk9TRV9UWVBFNCB8fCAkYVR5cGUgPiBXSU5EUk9TRV9UWVBFRlJFRSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjIwMDYpOyAvLygnSWxsZWdhbCB3aW5kcm9zZSB0eXBlIHNwZWNpZmllZC4nKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlUeXBlID0gJGFUeXBlOwogICAgfQoKICAgIC8vIEFsaWFzIGZvciBTZXRQb3MoKQogICAgZnVuY3Rpb24gU2V0Q2VudGVyUG9zKCRhWCwkYVkpIHsKICAgICAgICAkdGhpcy0+aVggPSAkYVg7CiAgICAgICAgJHRoaXMtPmlZID0gJGFZOyAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFNldFBvcygkYVgsJGFZKSB7CiAgICAgICAgJHRoaXMtPmlYID0gJGFYOwogICAgICAgICR0aGlzLT5pWSA9ICRhWTsKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRBbnRpQWxpYXMoJGFGbGFnKSB7CiAgICAgICAgJHRoaXMtPmlBbnRpQWxpYXMgPSAkYUZsYWcgOwogICAgICAgIGlmKCAhICRhRmxhZyApCiAgICAgICAgJHRoaXMtPmlDaXJjR3JpZFdlaWdodCA9IDE7CiAgICB9CgogICAgZnVuY3Rpb24gX1RoaWNrQ2lyY2xlKCRhSW1nLCRhWEMsJGFZQywkYVJhZCwkYVdlaWdodD0yLCRhQ29sb3IpIHsKCiAgICAgICAgJGFJbWctPlNldENvbG9yKCRhQ29sb3IpOwogICAgICAgICRhUmFkICo9IDIgOwogICAgICAgICRhSW1nLT5FbGxpcHNlKCRhWEMsJGFZQywkYVJhZCwkYVJhZCk7CiAgICAgICAgaWYoICRhV2VpZ2h0ID4gMSApIHsKICAgICAgICAgICAgJGFJbWctPkVsbGlwc2UoJGFYQywkYVlDLCRhUmFkKzEsJGFSYWQrMSk7CiAgICAgICAgICAgICRhSW1nLT5FbGxpcHNlKCRhWEMsJGFZQywkYVJhZCsyLCRhUmFkKzIpOwogICAgICAgICAgICBpZiggJGFXZWlnaHQgPiAyICkgewogICAgICAgICAgICAgICAgJGFJbWctPkVsbGlwc2UoJGFYQywkYVlDLCRhUmFkKzMsJGFSYWQrMyk7CiAgICAgICAgICAgICAgICAkYUltZy0+RWxsaXBzZSgkYVhDLCRhWUMsJGFSYWQrMywkYVJhZCs0KTsKICAgICAgICAgICAgICAgICRhSW1nLT5FbGxpcHNlKCRhWEMsJGFZQywkYVJhZCs0LCRhUmFkKzMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9TdHJva2VXaW5kTGVnKCRhSW1nLCR4YywkeWMsJGEsJHJpLCRyLCR3ZWlnaHQsJGNvbG9yKSB7CgogICAgICAgIC8vIElmIGxlc3MgdGhhbiAxIHB4IGxvbmcgdGhlbiB3ZSBhc3N1bWUgdGhpcyBoYXMgYmVlbiBjYXVzZWQgYnkgcm91bmRpbmcgcHJvYmxlbXMKICAgICAgICAvLyBhbmQgc2hvdWxkIG5vdCBiZSBzdHJva2VkCiAgICAgICAgaWYoICRyIDwgMSApIHJldHVybjsKCiAgICAgICAgJHh0ID0gJHhjICsgY29zKCRhKSokcmk7CiAgICAgICAgJHl0ID0gJHljIC0gc2luKCRhKSokcmk7CiAgICAgICAgJHh4dCA9ICR4YyArIGNvcygkYSkqKCRyaSskcik7CiAgICAgICAgJHl5dCA9ICR5YyAtIHNpbigkYSkqKCRyaSskcik7CgogICAgICAgICR4MSA9ICR4dCAtICR3ZWlnaHQqc2luKCRhKTsKICAgICAgICAkeTEgPSAkeXQgLSAkd2VpZ2h0KmNvcygkYSk7CiAgICAgICAgJHgyID0gJHh4dCAtICR3ZWlnaHQqc2luKCRhKTsKICAgICAgICAkeTIgPSAkeXl0IC0gJHdlaWdodCpjb3MoJGEpOwoKICAgICAgICAkeDMgPSAkeHh0ICsgJHdlaWdodCpzaW4oJGEpOwogICAgICAgICR5MyA9ICR5eXQgKyAkd2VpZ2h0KmNvcygkYSk7CiAgICAgICAgJHg0ID0gJHh0ICsgJHdlaWdodCpzaW4oJGEpOwogICAgICAgICR5NCA9ICR5dCArICR3ZWlnaHQqY29zKCRhKTsKCiAgICAgICAgJHB0cyA9IGFycmF5KCR4MSwkeTEsJHgyLCR5MiwkeDMsJHkzLCR4NCwkeTQpOwogICAgICAgICRhSW1nLT5TZXRDb2xvcigkY29sb3IpOwogICAgICAgICRhSW1nLT5GaWxsZWRQb2x5Z29uKCRwdHMpOwoKICAgIH0KCiAgICBmdW5jdGlvbiBfU3Ryb2tlTGVnZW5kKCRhSW1nLCR4LCR5LCRzY2FsaW5nPTEsJGFSZXR1cm5XaWR0aD1mYWxzZSkgewoKICAgICAgICBpZiggISAkdGhpcy0+bGVnZW5kLT5pU2hvdyApIHJldHVybiAwOwoKICAgICAgICAkbmxjID0gY291bnQoJHRoaXMtPmlMZWdDb2xvcnMpOwogICAgICAgICRubHcgPSBjb3VudCgkdGhpcy0+aUxlZ3dlaWdodHMpOwoKICAgICAgICAvLyBTZXR1cCBmb250IGZvciByYW5nZXMKICAgICAgICAkdmFsdWUgPSBuZXcgVGV4dCgpOwogICAgICAgICR2YWx1ZS0+U2V0QWxpZ24oJ2NlbnRlcicsJ2JvdHRvbScpOwogICAgICAgICR2YWx1ZS0+U2V0Rm9udCgkdGhpcy0+bGVnZW5kLT5pTGJsRm9udEZhbWlseSwKICAgICAgICAkdGhpcy0+bGVnZW5kLT5pTGJsRm9udFN0eWxlLAogICAgICAgICR0aGlzLT5sZWdlbmQtPmlMYmxGb250U2l6ZSokc2NhbGluZyk7CiAgICAgICAgJHZhbHVlLT5TZXRDb2xvcigkdGhpcy0+bGVnZW5kLT5pTGJsRm9udENvbG9yKTsKCiAgICAgICAgLy8gUmVtZW1iZXIgeC1jZW50ZXIKICAgICAgICAkeGNlbnRlciA9ICR4IDsKCiAgICAgICAgLy8gQ29uc3RydWN0IGZvcm1hdCBzdHJpbmcKICAgICAgICAkZm10ID0gJHRoaXMtPmxlZ2VuZC0+aUZvcm1hdFN0cmluZy4nLScuJHRoaXMtPmxlZ2VuZC0+aUZvcm1hdFN0cmluZzsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGxlbmd0aCBvZiBlYWNoIHJhbmdlIGlzIGVub3VnaCB0byBjb3ZlciB0aGUKICAgICAgICAvLyBzaXplIG9mIHRoZSBsYWJlbHMKICAgICAgICAkdHN0ID0gc3ByaW50ZigkZm10LCR0aGlzLT5pUmFuZ2VzWzBdLCR0aGlzLT5pUmFuZ2VzWzFdKTsKICAgICAgICAkdmFsdWUtPlNldCgkdHN0KTsKICAgICAgICAkdyA9ICR2YWx1ZS0+R2V0V2lkdGgoJGFJbWcpOwogICAgICAgICRsID0gcm91bmQobWF4KCR0aGlzLT5sZWdlbmQtPmlMZW5ndGggKiAkc2NhbGluZywkdyoxLjUpKTsKCiAgICAgICAgJHIgPSAkdGhpcy0+bGVnZW5kLT5pQ2lyY2xlUmFkaXVzICogJHNjYWxpbmcgOwogICAgICAgICRsZW4gPSAyKiRyICsgJHRoaXMtPnNjYWxlLT5pTWF4TnVtICogJGw7CgogICAgICAgIC8vIFdlIGFyZSBjYWxsZWQganVzdCB0byBmaW5kIG91dCB0aGUgd2lkdGgKICAgICAgICBpZiggJGFSZXR1cm5XaWR0aCApIHJldHVybiAkbGVuOwoKICAgICAgICAkeCAtPSByb3VuZCgkbGVuLzIpOwogICAgICAgICR4ICs9ICRyOwoKICAgICAgICAvLyA0IHBpeGVscyBleHRyYSB2ZXJ0aWNhbCBtYXJnaW4gc2luY2UgdGhlIGNpcmNsZSBzb21ldGltZXMgaXMgKy8tIDEgcGl4ZWwgb2YgdGhlCiAgICAgICAgLy8gdGhlb3JldGhpY2FsIHJhZGl1cyBkdWUgdG8gaW1wZXJmZWN0aW9uIGluIHRoZSBHRCBsaWJyYXJ5CiAgICAgICAgLy8keSAtPSByb3VuZChtYXgoJHIsJHNjYWxpbmcqJHRoaXMtPmlMZWd3ZWlnaHRzWygkdGhpcy0+c2NhbGUtPmlNYXhOdW0tMSkgJSAkbmx3XSkrNCokc2NhbGluZyk7CiAgICAgICAgJHkgLT0gKCR0aGlzLT5sZWdlbmQtPmlDaXJjbGVSYWRpdXMgKyAyKSokc2NhbGluZyskdGhpcy0+bGVnZW5kLT5pQm90dG9tTWFyZ2luKiRzY2FsaW5nOwoKICAgICAgICAvLyBBZGp1c3QgZm9yIGJvdHRvbSB0ZXh0CiAgICAgICAgaWYoICR0aGlzLT5sZWdlbmQtPmlUeHQgIT0gJycgKSB7CiAgICAgICAgICAgIC8vIFNldHVwIGZvbnQgZm9yIHRleHQKICAgICAgICAgICAgJHZhbHVlLT5TZXQoJHRoaXMtPmxlZ2VuZC0+aVR4dCk7CiAgICAgICAgICAgICR5IC09IC8qJHRoaXMtPmxlZ2VuZC0+aVR4dE1hcmdpbiArICovICR2YWx1ZS0+R2V0SGVpZ2h0KCRhSW1nKTsKICAgICAgICB9CgogICAgICAgIC8vIFN0cm9rZSAwLWNpcmNsZQogICAgICAgICR0aGlzLT5fVGhpY2tDaXJjbGUoJGFJbWcsJHgsJHksJHIsJHRoaXMtPmxlZ2VuZC0+aUNpcmNsZVdlaWdodCwKICAgICAgICAkdGhpcy0+bGVnZW5kLT5pQ2lyY2xlQ29sb3IpOwoKICAgICAgICAvLyBSZW1lbWJlciB0aGUgY2VudGVyIG9mIHRoZSBjaXJjZQogICAgICAgICR4Yz0keDsgJHljPSR5OwoKICAgICAgICAkdmFsdWUtPlNldEFsaWduKCdjZW50ZXInLCdib3R0b20nKTsKICAgICAgICAkeCArPSAkcisxOwoKICAgICAgICAvLyBTdHJva2UgYWxsIHVzZWQgcmFuZ2VzCiAgICAgICAgJHR4dHkgPSAkeSAtCiAgICAgICAgcm91bmQoJHRoaXMtPmlMZWd3ZWlnaHRzWygkdGhpcy0+c2NhbGUtPmlNYXhOdW0tMSklJG5sd10qJHNjYWxpbmcpIC0gNCokc2NhbGluZzsKICAgICAgICBpZiggJHRoaXMtPnNjYWxlLT5pTWF4TnVtID49IGNvdW50KCR0aGlzLT5pUmFuZ2VzKSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjIwMDcpOyAvLygnVG8gZmV3IHZhbHVlcyBmb3IgdGhlIHJhbmdlIGxlZ2VuZC4nKTsKICAgICAgICB9CiAgICAgICAgJGk9MDskaWR4PTA7CiAgICAgICAgd2hpbGUoICRpIDwgJHRoaXMtPnNjYWxlLT5pTWF4TnVtICkgewogICAgICAgICAgICAkeTEgPSAkeSAtIHJvdW5kKCR0aGlzLT5pTGVnd2VpZ2h0c1skaSAlICRubHddKiRzY2FsaW5nKTsKICAgICAgICAgICAgJHkyID0gJHkgKyByb3VuZCgkdGhpcy0+aUxlZ3dlaWdodHNbJGkgJSAkbmx3XSokc2NhbGluZyk7CiAgICAgICAgICAgICR4MiA9ICR4ICsgJGwgOwogICAgICAgICAgICAkYUltZy0+U2V0Q29sb3IoJHRoaXMtPmlMZWdDb2xvcnNbJGkgJSAkbmxjXSk7CiAgICAgICAgICAgICRhSW1nLT5GaWxsZWRSZWN0YW5nbGUoJHgsJHkxLCR4MiwkeTIpOwogICAgICAgICAgICBpZiggJHRoaXMtPmlSYW5nZVN0eWxlID09IFJBTkdFX09WRVJMQVBQSU5HICkgewogICAgICAgICAgICAgICAgJGxibCA9IHNwcmludGYoJGZtdCwkdGhpcy0+aVJhbmdlc1skaWR4XSwkdGhpcy0+aVJhbmdlc1skaWR4KzFdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRsYmwgPSBzcHJpbnRmKCRmbXQsJHRoaXMtPmlSYW5nZXNbJGlkeF0sJHRoaXMtPmlSYW5nZXNbJGlkeCsxXSk7CiAgICAgICAgICAgICAgICArKyRpZHg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHZhbHVlLT5TZXQoJGxibCk7CiAgICAgICAgICAgICR2YWx1ZS0+U3Ryb2tlKCRhSW1nLCR4KyRsLzIsJHR4dHkpOwogICAgICAgICAgICAkeCA9ICR4MjsKICAgICAgICAgICAgKyskaTsrKyRpZHg7CiAgICAgICAgfQoKICAgICAgICAvLyBTZXR1cCBjaXJjbGUgZm9udAogICAgICAgICR2YWx1ZS0+U2V0Rm9udCgkdGhpcy0+bGVnZW5kLT5pQ2lyY2xlRm9udEZhbWlseSwKICAgICAgICAkdGhpcy0+bGVnZW5kLT5pQ2lyY2xlRm9udFN0eWxlLAogICAgICAgICR0aGlzLT5sZWdlbmQtPmlDaXJjbGVGb250U2l6ZSokc2NhbGluZyk7CiAgICAgICAgJHZhbHVlLT5TZXRDb2xvcigkdGhpcy0+bGVnZW5kLT5pQ2lyY2xlRm9udENvbG9yKTsKCiAgICAgICAgLy8gU3Ryb2tlIDAtY2lyY2xlIHRleHQKICAgICAgICAkdmFsdWUtPlNldCgkdGhpcy0+bGVnZW5kLT5pWkNpcmNsZVR4dCk7CiAgICAgICAgJHZhbHVlLT5TZXRBbGlnbignY2VudGVyJywnY2VudGVyJyk7CiAgICAgICAgJHZhbHVlLT5QYXJhZ3JhcGhBbGlnbignY2VudGVyJyk7CiAgICAgICAgJHZhbHVlLT5TdHJva2UoJGFJbWcsJHhjLCR5Yyk7CgogICAgICAgIC8vIFNldHVwIGNpcmNsZSBmb250CiAgICAgICAgJHZhbHVlLT5TZXRGb250KCR0aGlzLT5sZWdlbmQtPmlUeHRGb250RmFtaWx5LAogICAgICAgICR0aGlzLT5sZWdlbmQtPmlUeHRGb250U3R5bGUsCiAgICAgICAgJHRoaXMtPmxlZ2VuZC0+aVR4dEZvbnRTaXplKiRzY2FsaW5nKTsKICAgICAgICAkdmFsdWUtPlNldENvbG9yKCR0aGlzLT5sZWdlbmQtPmlUeHRGb250Q29sb3IpOwoKICAgICAgICAvLyBEcmF3IHRoZSB0ZXh0IHVuZGVyIHRoZSBsZWdlbmQKICAgICAgICAkdmFsdWUtPlNldCgkdGhpcy0+bGVnZW5kLT5pVHh0KTsKICAgICAgICAkdmFsdWUtPlNldEFsaWduKCdjZW50ZXInLCd0b3AnKTsKICAgICAgICAkdmFsdWUtPlNldFBhcmFncmFwaEFsaWduKCdjZW50ZXInKTsKICAgICAgICAkdmFsdWUtPlN0cm9rZSgkYUltZywkeGNlbnRlciwkeTIrJHRoaXMtPmxlZ2VuZC0+aVR4dE1hcmdpbiokc2NhbGluZyk7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0QXV0b1NjYWxlQW5nbGUoJGFJc1JlZ1Jvc2U9dHJ1ZSkgewoKICAgICAgICAvLyBJZiB0aGUgdXNlciBhbHJlYWR5IGhhcyBtYW51YWxseSBzZXQgYW4gYW5nbGUgZG9uJ3QKICAgICAgICAvLyB0cnllIHRvIGZpbmQgYSBwb3NpdGlvbgogICAgICAgIGlmKCBpc19udW1lcmljKCR0aGlzLT5zY2FsZS0+aUFuZ2xlKSApCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgaWYoICRhSXNSZWdSb3NlICkgewoKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgY29tcGxldGUgZGF0YSBmb3IgYWxsIGRpcmVjdGlvbnMKICAgICAgICAgICAgLy8gYW5kIHRyYW5zbGF0ZSBzdHJpbmcgZGlyZWN0aW9ucyB0byBvcmRpbmFsIHZhbHVlcy4KICAgICAgICAgICAgLy8gVGhpcyB3aWxsIG11Y2ggc2ltcGxpZnkgdGhlIGxvZ2ljIGJlbG93CiAgICAgICAgICAgIGZvciggJGk9MDsgJGkgPCAxNjsgKyskaSApIHsKICAgICAgICAgICAgICAgICRkdHh0ID0gJHRoaXMtPmlBbGxEaXJlY3Rpb25MYWJlbHNbJGldOwogICAgICAgICAgICAgICAgaWYoICFlbXB0eSgkdGhpcy0+aURhdGFbJGR0eHRdKSApIHsKICAgICAgICAgICAgICAgICAgICAkZGF0YVskaV0gPSAkdGhpcy0+aURhdGFbJGR0eHRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmKCAhZW1wdHkoJHRoaXMtPmlEYXRhW3N0cnRvbG93ZXIoJGR0eHQpXSkgKSB7CiAgICAgICAgICAgICAgICAgICAgJGRhdGFbJGldID0gJHRoaXMtPmlEYXRhW3N0cnRvbG93ZXIoJGR0eHQpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiggIWVtcHR5KCR0aGlzLT5pRGF0YVskaV0pICkgewogICAgICAgICAgICAgICAgICAgICRkYXRhWyRpXSA9ICR0aGlzLT5pRGF0YVskaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkZGF0YVskaV0gPSBhcnJheSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaW5kIHRoZSBsZWcgd2hpY2ggaGFzIHRoZSBsb3dlc3Qgd2VpZ2h0ZWQgc3VtIG9mIG51bWJlciBvZiBkYXRhIGFyb3VuZCBpdAogICAgICAgICAgICAkYzAgPSBhcnJheV9zdW0oJGRhdGFbMF0pOwogICAgICAgICAgICAkYzEgPSBhcnJheV9zdW0oJGRhdGFbMV0pOwogICAgICAgICAgICAkZm91bmQgPSAxOwogICAgICAgICAgICAkbWluID0gJGMwKyRjMSoxMDA7IC8vIEluaXRpYWxpemUgdG8gYSBoaWdoIHZhbHVlCiAgICAgICAgICAgIGZvciggJGk9MTsgJGkgPCAxNTsgKyskaSApIHsKICAgICAgICAgICAgICAgICRjMiA9IGFycmF5X3N1bSgkZGF0YVskaSsxXSk7CgogICAgICAgICAgICAgICAgLy8gV2VpZ2h0IHRoZSBsZWcgd2Ugd2lsbCB1c2UgbW9yZSB0byBnaXZlIHByZWZlcmVuY2UKICAgICAgICAgICAgICAgIC8vIHRvIGEgc2hvcnQgbWlkZGxlIGxlZyBldmVuIGlmIHRoZSAzIHdheSBzdW0gaXMgc2ltaWxhaXIKICAgICAgICAgICAgICAgICR3ID0gJGMwICsgMyokYzEgKyAkYzIgOwogICAgICAgICAgICAgICAgaWYoICR3IDwgJG1pbiApIHsKICAgICAgICAgICAgICAgICAgICAkbWluID0gJHc7CiAgICAgICAgICAgICAgICAgICAgJGZvdW5kID0gJGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYzAgPSAkYzE7CiAgICAgICAgICAgICAgICAkYzEgPSAkYzI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPnNjYWxlLT5pQW5nbGUgPSAkZm91bmQqMjIuNTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRuID0gY291bnQoJHRoaXMtPmlEYXRhKTsKICAgICAgICAgICAgZm9yZWFjaCggJHRoaXMtPmlEYXRhIGFzICRkaXIgPT4gJGxlZyApIHsKICAgICAgICAgICAgICAgIGlmKCAhaXNfbnVtZXJpYygkZGlyKSApIHsKICAgICAgICAgICAgICAgICAgICAkcG9zID0gYXJyYXlfc2VhcmNoKHN0cnRvdXBwZXIoJGRpciksJHRoaXMtPmlBbGxEaXJlY3Rpb25MYWJlbHMpOwogICAgICAgICAgICAgICAgICAgIGlmKCAkcG9zICE9PSBmYWxzZSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpciA9ICRwb3MqMjIuNTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZGF0YVtyb3VuZCgkZGlyKV0gPSAkbGVnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBHZXQgYWxsIHRoZSBhbmdsZXMgZm9yIHRoZSBkYXRhIGFuZCBzb3J0IGl0CiAgICAgICAgICAgICRrZXlzID0gYXJyYXlfa2V5cygkZGF0YSk7CiAgICAgICAgICAgIHNvcnQoJGtleXMsIFNPUlRfTlVNRVJJQyk7CgogICAgICAgICAgICAkbiA9IGNvdW50KCRkYXRhKTsKICAgICAgICAgICAgJGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgICRtYXggPSAwIDsKICAgICAgICAgICAgZm9yKCAkaT0wOyAkaSA8IDE1OyArKyRpICkgewogICAgICAgICAgICAgICAgJHRyeV9hID0gcm91bmQoMjIuNSokaSk7CgogICAgICAgICAgICAgICAgaWYoICR0cnlfYSA+ICRrZXlzWyRuLTFdICkgYnJlYWs7CgogICAgICAgICAgICAgICAgaWYoIGluX2FycmF5KCR0cnlfYSwka2V5cykgKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyBGaW5kIHRoZSBhbmdsZSBqdXN0IGxvd2VyIHRoYW4gdGhpcwogICAgICAgICAgICAgICAgJGo9MDsKICAgICAgICAgICAgICAgIHdoaWxlKCAkaiA8ICRuICYmICRrZXlzWyRqXSA8PSAkdHJ5X2EgKSArKyRqOwogICAgICAgICAgICAgICAgaWYoICRqID09IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgJGtqID0gMDsgJGtleXNbJG4tMV07CiAgICAgICAgICAgICAgICAgICAgJGQxID0gMDsgYWJzKCRrai0kdHJ5X2EpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLS0kajsKICAgICAgICAgICAgICAgICAgICAka2ogPSAka2V5c1skal07CiAgICAgICAgICAgICAgICAgICAgJGQxID0gYWJzKCRrai0kdHJ5X2EpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIGFuZ2xlIGp1c3QgbGFyZ2VyIHRoYW4gdGhpcwogICAgICAgICAgICAgICAgJGw9JG4tMTsKICAgICAgICAgICAgICAgIHdoaWxlKCAkbCA+PSAwICYmICRrZXlzWyRsXSA+PSAkdHJ5X2EgKSAtLSRsOwogICAgICAgICAgICAgICAgaWYoICRsID09ICRuLTEpIHsKICAgICAgICAgICAgICAgICAgICAka2wgPSAka2V5c1swXTsKICAgICAgICAgICAgICAgICAgICAkZDIgPSBhYnMoJGtsLSR0cnlfYSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICArKyRsOwogICAgICAgICAgICAgICAgICAgICRrbCA9ICRrZXlzWyRsXTsKICAgICAgICAgICAgICAgICAgICAkZDIgPSBhYnMoJGtsLSR0cnlfYSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gV2VpZ2h0IHRoZSBkaXN0YW5jZSBzbyB0aGF0IGxlZ3Mgd2l0aCBsYXJnZSBzcHJlYWQKICAgICAgICAgICAgICAgIC8vIGdldHMgYSBiZXR0ZXIgd2VpZ2h0CiAgICAgICAgICAgICAgICAkdyA9ICRkMSArICRkMjsKICAgICAgICAgICAgICAgIGlmKCAkaSA9PSAwICkgewogICAgICAgICAgICAgICAgICAgICR3ID0gcm91bmQoMS40ICogJHcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGRpZmYgPSBhYnMoJGQxIC0gJGQyKTsKICAgICAgICAgICAgICAgICR3ICo9ICgzNjAtJGRpZmYpOwogICAgICAgICAgICAgICAgaWYoICR3ID4gJG1heCApIHsKICAgICAgICAgICAgICAgICAgICAkZm91bmQgPSAkaTsKICAgICAgICAgICAgICAgICAgICAkbWF4ID0gJHc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRhID0gJGZvdW5kKjIyLjU7CgogICAgICAgICAgICAvLyBTb21lIGhldXJpc3RpY3MgdG8gaGF2ZSBzb21lIHByZWZlcnJlZCBwb3NpdGlvbnMKICAgICAgICAgICAgaWYoICRrZXlzWyRuLTFdIDwgMjUgKSAkYSA9IDQ1OwogICAgICAgICAgICBlbHNlaWYoICRrZXlzWzBdID4gNjAgKSAkYSA9IDQ1OwogICAgICAgICAgICBlbHNlaWYoICRrZXlzWzBdID4gMjUgJiYgJGtleXNbJG4tMV0gPCAzNDAgKSAkYSA9IDA7CiAgICAgICAgICAgIGVsc2VpZiggJGtleXNbJG4tMV0gPCA3NSApICRhID0gOTA7CiAgICAgICAgICAgIGVsc2VpZiggJGtleXNbJG4tMV0gPCAxMjAgKSAkYSA9IDEzNTsKICAgICAgICAgICAgZWxzZWlmKCAka2V5c1skbi0xXSA8IDE2MCApICRhID0gMTgwOwoKICAgICAgICAgICAgJHRoaXMtPnNjYWxlLT5pQW5nbGUgPSAkYSA7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIE5vcm1BbmdsZSgkYSkgewogICAgICAgIHdoaWxlKCAkYSA+IDM2MCApIHsKICAgICAgICAgICAgJGEgLT0gMzYwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGE7CiAgICB9CgogICAgZnVuY3Rpb24gU2V0TGFiZWxQb3NpdGlvbigkYVBvcykgewogICAgICAgICR0aGlzLT5pTGFiZWxQb3NpdGlvbmluZyAgPSAkYVBvcyA7CiAgICB9CgogICAgZnVuY3Rpb24gX1N0cm9rZUZyZWVSb3NlKCRkYmxJbWcsJHZhbHVlLCRzY2FsaW5nLCR4YywkeWMsJHIsJHJpKSB7CgogICAgICAgIC8vIFBsb3QgcmFkaWFsIGdyaWQgbGluZXMgYW5kIHJlbWVtYmVyIHRoZSBlbmQgcG9zaXRpb24KICAgICAgICAvLyBhbmQgdGhlIGFuZ2xlIGZvciBsYXRlciB1c2Ugd2hlbiBwbG90dGluZyB0aGUgbGFiZWxzCiAgICAgICAgaWYoICR0aGlzLT5pVHlwZSAhPSBXSU5EUk9TRV9UWVBFRlJFRSApIHsKICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjIwMDgpOyAvLygnSW50ZXJuYWwgZXJyb3I6IFRyeWluZyB0byBwbG90IGZyZWUgV2luZHJvc2UgZXZlbiB0aG91Z2ggdHlwZSBpcyBub3QgYSBmcmVlIHdpbmRvcm9zZScpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgaWYgd2Ugc2hvdWxkIGF1dG8tcG9zaXRpb24gdGhlIGFuZ2xlIGZvciB0aGUKICAgICAgICAvLyBsYWJlbHMuIEJhc2ljYWxseSB3ZSB0cnkgdG8gZmluZCBhIGZpcmVjdGlvbiB3aXRoIHNtYWxsZXN0CiAgICAgICAgLy8gKG9yIG5vbmUpIGRhdGEuCiAgICAgICAgJHRoaXMtPlNldEF1dG9TY2FsZUFuZ2xlKGZhbHNlKTsKCiAgICAgICAgJG5sYyA9IGNvdW50KCR0aGlzLT5pTGVnQ29sb3JzKTsKICAgICAgICAkbmx3ID0gY291bnQoJHRoaXMtPmlMZWd3ZWlnaHRzKTsKCiAgICAgICAgLy8gU3Ryb2tlIGdyaWQgbGluZXMgZm9yIGRpcmVjdGlvbnMgYW5kIHJlbWVtYmVyIHRoZQogICAgICAgIC8vIHBvc2l0aW9uIGZvciB0aGUgbGFiZWxzCiAgICAgICAgJHR4dHBvcz1hcnJheSgpOwogICAgICAgICRudW0gPSBjb3VudCgkdGhpcy0+aURhdGEpOwoKICAgICAgICAka2V5cyA9IGFycmF5X2tleXMoJHRoaXMtPmlEYXRhKTsKCiAgICAgICAgZm9yZWFjaCggJHRoaXMtPmlEYXRhIGFzICRkaXIgPT4gJGxlZ2RhdGEgKSB7CiAgICAgICAgICAgIGlmKCBpbl9hcnJheSgkZGlyLCR0aGlzLT5pQWxsRGlyZWN0aW9uTGFiZWxzLHRydWUpID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAkYSA9ICR0aGlzLT5pU3RhbmRhcmREaXJlY3Rpb25zW3N0cnRvdXBwZXIoJGRpcildOwogICAgICAgICAgICAgICAgaWYoIGluX2FycmF5KCRhKjE4MC9NX1BJLCRrZXlzKSApIHsKICAgICAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyMjAwOSxyb3VuZCgkYSoxODAvTV9QSSkpOwogICAgICAgICAgICAgICAgICAgIC8vKCdZb3UgaGF2ZSBzcGVjaWZpZWQgdGhlIHNhbWUgZGlyZWN0aW9uIHR3aWNlLCBvbmNlIHdpdGggYW4gYW5nbGUgYW5kIG9uY2Ugd2l0aCBhIGNvbXBhc3MgZGlyZWN0aW9uICgnLiRhKjE4MC9NX1BJLicgZGVncmVlcy4pJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCBpc19udW1lcmljKCRkaXIpICkgewogICAgICAgICAgICAgICAgJHRoaXMtPk5vcm1BbmdsZSgkZGlyKTsKCiAgICAgICAgICAgICAgICBpZiggJHRoaXMtPmlPcmRpbmFsRW5jb2RpbmcgPT0gS0VZRU5DT0RJTkdfQ0xPQ0tXSVNFICkgewogICAgICAgICAgICAgICAgICAgICRkaXIgPSAzNjAtJGRpcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkYSA9ICRkaXIgKiBNX1BJLzE4MDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIyMDEwKTsvLygnRGlyZWN0aW9uIG11c3QgZWl0aGVyIGJlIGEgbnVtZXJpYyB2YWx1ZSBvciBvbmUgb2YgdGhlIDE2IGNvbXBhc3MgZGlyZWN0aW9ucycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkeHhjID0gcm91bmQoJHhjICsgY29zKCRhKSokcmkpOwogICAgICAgICAgICAkeXljID0gcm91bmQoJHljIC0gc2luKCRhKSokcmkpOwogICAgICAgICAgICAkeCA9IHJvdW5kKCR4YyArIGNvcygkYSkqJHIpOwogICAgICAgICAgICAkeSA9IHJvdW5kKCR5YyAtIHNpbigkYSkqJHIpOwogICAgICAgICAgICBpZiggZW1wdHkoJHRoaXMtPmlSYWRpYWxDb2xvckFycmF5WyRkaXJdKSApIHsKICAgICAgICAgICAgICAgICRkYmxJbWctPlNldENvbG9yKCR0aGlzLT5pR3JpZENvbG9yMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkZGJsSW1nLT5TZXRDb2xvcigkdGhpcy0+aVJhZGlhbENvbG9yQXJyYXlbJGRpcl0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCBlbXB0eSgkdGhpcy0+aVJhZGlhbFdlaWdodEFycmF5WyRkaXJdKSApIHsKICAgICAgICAgICAgICAgICRkYmxJbWctPlNldExpbmVXZWlnaHQoJHRoaXMtPmlSYWRpYWxHcmlkV2VpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRkYmxJbWctPlNldExpbmVXZWlnaHQoJHRoaXMtPmlSYWRpYWxXZWlnaHRBcnJheVskZGlyXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoIGVtcHR5KCR0aGlzLT5pUmFkaWFsU3R5bGVBcnJheVskZGlyXSkgKSB7CiAgICAgICAgICAgICAgICAkZGJsSW1nLT5TZXRMaW5lU3R5bGUoJHRoaXMtPmlSYWRpYWxHcmlkU3R5bGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGRibEltZy0+U2V0TGluZVN0eWxlKCR0aGlzLT5pUmFkaWFsU3R5bGVBcnJheVskZGlyXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGRibEltZy0+U3R5bGVMaW5lKCR4eGMsJHl5YywkeCwkeSk7CiAgICAgICAgICAgICR0eHRwb3NbXSA9IGFycmF5KCR4LCR5LCRhKTsKICAgICAgICB9CiAgICAgICAgJGRibEltZy0+U2V0TGluZVdlaWdodCgxKTsKCiAgICAgICAgLy8gU2V0dXAgbGFiZWxzCiAgICAgICAgJGxyID0gJHNjYWxpbmcgKiAkdGhpcy0+aUxhYmVsTWFyZ2luOwoKICAgICAgICBpZiggJHRoaXMtPmlMYWJlbFBvc2l0aW9uaW5nID09IExCTFBPU0lUSU9OX0VER0UgKSB7CiAgICAgICAgICAgICR2YWx1ZS0+U2V0QWxpZ24oJ2xlZnQnLCd0b3AnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICR2YWx1ZS0+U2V0QWxpZ24oJ2NlbnRlcicsJ2NlbnRlcicpOwogICAgICAgICAgICAkdmFsdWUtPlNldE1hcmdpbigwKTsKICAgICAgICB9CgogICAgICAgIGZvcigkaT0wOyAkaSA8ICRudW07ICsrJGkgKSB7CgogICAgICAgICAgICBsaXN0KCR4LCR5LCRhKSA9ICR0eHRwb3NbJGldOwoKICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBsYWJlbAoKICAgICAgICAgICAgJGRhID0gJGEqMTgwL01fUEk7CiAgICAgICAgICAgIGlmKCAkdGhpcy0+aU9yZGluYWxFbmNvZGluZyA9PSBLRVlFTkNPRElOR19DTE9DS1dJU0UgKSB7CiAgICAgICAgICAgICAgICAkZGEgPSAzNjAgLSAkZGE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vJGRhID0gMzYwLSRkYTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKCAhZW1wdHkoJHRoaXMtPmlMYWJlbHNbJGtleXNbJGldXSkgKSB7CiAgICAgICAgICAgICAgICAkbGJsID0gJHRoaXMtPmlMYWJlbHNbJGtleXNbJGldXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRsYmwgPSBzcHJpbnRmKCR0aGlzLT5pTGFiZWxGb3JtYXRTdHJpbmcsJGRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoICR0aGlzLT5pTGFiZWxQb3NpdGlvbmluZyA9PSBMQkxQT1NJVElPTl9DRU5URVIgKSB7CiAgICAgICAgICAgICAgICAkZHggPSAkZHkgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gTEJMUE9TSUlUT05fRURHRQogICAgICAgICAgICAgICAgaWYoICRhPj03Kk1fUEkvNCB8fCAkYSA8PSBNX1BJLzQgKSAkZHg9MDsKICAgICAgICAgICAgICAgIGlmKCAkYT49TV9QSS80ICYmICRhIDw9IDMqTV9QSS80ICkgJGR4PSgkYS1NX1BJLzQpKjIvTV9QSTsKICAgICAgICAgICAgICAgIGlmKCAkYT49MypNX1BJLzQgJiYgJGEgPD0gNSpNX1BJLzQgKSAkZHg9MTsKICAgICAgICAgICAgICAgIGlmKCAkYT49NSpNX1BJLzQgJiYgJGEgPD0gNypNX1BJLzQgKSAkZHg9KDEtKCRhLU1fUEkqNS80KSoyL01fUEkpOwoKICAgICAgICAgICAgICAgIGlmKCAkYT49NypNX1BJLzQgKSAkZHk9KCgkYS1NX1BJKS0zKk1fUEkvNCkqMi9NX1BJOwogICAgICAgICAgICAgICAgaWYoICRhPD1NX1BJLzQgKSAkZHk9KDAuNSskYSoyL01fUEkpOwogICAgICAgICAgICAgICAgaWYoICRhPj1NX1BJLzQgJiYgJGEgPD0gMypNX1BJLzQgKSAkZHk9MTsKICAgICAgICAgICAgICAgIGlmKCAkYT49MypNX1BJLzQgJiYgJGEgPD0gNSpNX1BJLzQgKSAkZHk9KDEtKCRhLTMqTV9QSS80KSoyL01fUEkpOwogICAgICAgICAgICAgICAgaWYoICRhPj01Kk1fUEkvNCAmJiAkYSA8PSA3Kk1fUEkvNCApICRkeT0wOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdmFsdWUtPlNldCgkbGJsKTsKICAgICAgICAgICAgJHRoID0gJHZhbHVlLT5HZXRIZWlnaHQoJGRibEltZyk7CiAgICAgICAgICAgICR0dyA9ICR2YWx1ZS0+R2V0V2lkdGgoJGRibEltZyk7CiAgICAgICAgICAgICR4dD1yb3VuZCgkbHIqY29zKCRhKSskeCkgLSAkZHgqJHR3OwogICAgICAgICAgICAkeXQ9cm91bmQoJHktJGxyKnNpbigkYSkpIC0gJGR5KiR0aDsKCiAgICAgICAgICAgICR2YWx1ZS0+U3Ryb2tlKCRkYmxJbWcsJHh0LCR5dCk7CiAgICAgICAgfQoKICAgICAgICBpZiggX19ERUJVRyApIHsKICAgICAgICAgICAgJGRibEltZy0+U2V0Q29sb3IoJ3JlZCcpOwogICAgICAgICAgICAkZGJsSW1nLT5DaXJjbGUoJHhjLCR5YywkbHIrJHIpOwogICAgICAgIH0KCiAgICAgICAgLy8gU3Ryb2tlIGFsbCB0aGUgbGVncwogICAgICAgIHJlc2V0KCR0aGlzLT5pRGF0YSk7CiAgICAgICAgJGk9MDsKICAgICAgICBmb3JlYWNoKCR0aGlzLT5pRGF0YSBhcyAkZGlyID0+ICRsZWdkYXRhKSB7CiAgICAgICAgICAgICRsZWdkYXRhID0gYXJyYXlfc2xpY2UoJGxlZ2RhdGEsMSk7CiAgICAgICAgICAgICRubiA9IGNvdW50KCRsZWdkYXRhKTsKCiAgICAgICAgICAgICRhID0gJHR4dHBvc1skaV1bMl07CiAgICAgICAgICAgICRycmkgPSAkcmkvJHNjYWxpbmc7CiAgICAgICAgICAgIGZvciggJGo9MDsgJGogPCAkbm47ICsrJGogKSB7CiAgICAgICAgICAgICAgICAvLyBXZSB3YW50IHRoZSBub24gc2NhbGVkIG9yaWdpbmFsIHJhZGl1cwogICAgICAgICAgICAgICAgJGxlZ3IgPSAkdGhpcy0+c2NhbGUtPlJlbFRyYW5zbGF0ZSgkbGVnZGF0YVskal0sJHIvJHNjYWxpbmcsJHJpLyRzY2FsaW5nKSA7CiAgICAgICAgICAgICAgICAkdGhpcy0+X1N0cm9rZVdpbmRMZWcoJGRibEltZywgJHhjLCAkeWMsICRhLAogICAgICAgICAgICAgICAgJHJyaSAqJHNjYWxpbmcsCiAgICAgICAgICAgICAgICAkbGVnciAqJHNjYWxpbmcsCiAgICAgICAgICAgICAgICAkdGhpcy0+aUxlZ3dlaWdodHNbJGogJSAkbmx3XSAqICRzY2FsaW5nLAogICAgICAgICAgICAgICAgJHRoaXMtPmlMZWdDb2xvcnNbJGogJSAkbmxjXSk7CiAgICAgICAgICAgICAgICAkcnJpICs9ICRsZWdyOwogICAgICAgICAgICB9CiAgICAgICAgICAgICsrJGk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFRyYW5zbGF0ZSBwb3RlbnRpYWwgc3RyaW5nIHNwZWNpZmllZCBjb21wYXNzIGxhYmVscyB0byB0aGVpcgogICAgLy8gY29ycmVzcG9uZGluZyBpbmRleC4KICAgIGZ1bmN0aW9uIEZpeHVwSW5kZXhlcygkYURhdGFBcnJheSwkbnVtKSB7CiAgICAgICAgJHJldCA9IGFycmF5KCk7CiAgICAgICAgJGtleXMgPSBhcnJheV9rZXlzKCRhRGF0YUFycmF5KTsKICAgICAgICBmb3JlYWNoKCRhRGF0YUFycmF5IGFzICRpZHggPT4gJGRhdGEpIHsKICAgICAgICAgICAgaWYoIGlzX3N0cmluZygkaWR4KSApIHsKICAgICAgICAgICAgICAgICRpZHggPSBzdHJ0b3VwcGVyKCRpZHgpOwogICAgICAgICAgICAgICAgJHJlcyA9IGFycmF5X3NlYXJjaCgkaWR4LCR0aGlzLT5pQWxsRGlyZWN0aW9uTGFiZWxzKTsKICAgICAgICAgICAgICAgIGlmKCAkcmVzID09PSBmYWxzZSApIHsKICAgICAgICAgICAgICAgICAgICBKcEdyYXBoRXJyb3I6OlJhaXNlTCgyMjAxMSwkaWR4KTsgLy8oJ1dpbmRyb3NlIGluZGV4IG11c3QgYmUgbnVtZXJpYyBvciBkaXJlY3Rpb24gbGFiZWwuIFlvdSBoYXZlIHNwZWNpZmllZCBpbmRleD0nLiRpZHgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGlkeCA9ICRyZXM7CiAgICAgICAgICAgICAgICBpZiggJGlkeCAlICgxNiAvICRudW0pICE9PSAwICkgewogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIyMDEyKTsgLy8oJ1dpbmRyb3NlIHJhZGlhbCBheGlzIHNwZWNpZmljYXRpb24gY29udGFpbnMgYSBkaXJlY3Rpb24gd2hpY2ggaXMgbm90IGVuYWJsZWQuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkaWR4IC89ICgxNi8kbnVtKSA7CgogICAgICAgICAgICAgICAgaWYoIGluX2FycmF5KCRpZHgsJGtleXMsMSkgKSB7CiAgICAgICAgICAgICAgICAgICAgSnBncmFwaEVycm9yOjpSYWlzZUwoMjIwMTMsJGlkeCk7IC8vKCdZb3UgaGF2ZSBzcGVjaWZpZWQgdGhlIGxvb2smZmVlbCBmb3IgdGhlIHNhbWUgY29tcGFzcyBkaXJlY3Rpb24gdHdpY2UsIG9uY2Ugd2l0aCB0ZXh0IGFuZCBvbmNlIHdpdGggaW5kZXggKEluZGV4PScuJGlkeC4nKScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCAkaWR4IDwgMCB8fCAkaWR4ID4gMTUgKSB7CiAgICAgICAgICAgICAgICBKcGdyYXBoRXJyb3I6OlJhaXNlTCgyMjAxNCk7IC8vKCdJbmRleCBmb3IgY29wbWFzcyBkaXJlY3Rpb24gbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDE1LicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRyZXRbJGlkeF0gPSAkZGF0YTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZXQ7CiAgICB9CgogICAgZnVuY3Rpb24gX1N0cm9rZVJlZ3VsYXJSb3NlKCRkYmxJbWcsJHZhbHVlLCRzY2FsaW5nLCR4YywkeWMsJHIsJHJpKSB7CiAgICAgICAgLy8gX1N0cm9rZVJlZ3VsYXJSb3NlKCRkYmxJbWcsJHhjLCR5YywkciwkcmkpCiAgICAgICAgLy8gUGxvdCByYWRpYWwgZ3JpZCBsaW5lcyBhbmQgcmVtZW1iZXIgdGhlIGVuZCBwb3NpdGlvbgogICAgICAgIC8vIGFuZCB0aGUgYW5nbGUgZm9yIGxhdGVyIHVzZSB3aGVuIHBsb3R0aW5nIHRoZSBsYWJlbHMKICAgICAgICBzd2l0Y2goICR0aGlzLT5pVHlwZSApIHsKICAgICAgICAgICAgY2FzZSBXSU5EUk9TRV9UWVBFNDoKICAgICAgICAgICAgICAgICRudW0gPSA0OyBicmVhazsKICAgICAgICAgICAgY2FzZSBXSU5EUk9TRV9UWVBFODoKICAgICAgICAgICAgICAgICRudW0gPSA4OyBicmVhazsKICAgICAgICAgICAgY2FzZSBXSU5EUk9TRV9UWVBFMTY6CiAgICAgICAgICAgICAgICAkbnVtID0gMTY7IGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgSnBHcmFwaEVycm9yOjpSYWlzZUwoMjIwMTUpOy8vKCdZb3UgaGF2ZSBzcGVjaWZpZWQgYW4gdW5kZWZpbmVkIFdpbmRyb3NlIHBsb3QgdHlwZS4nKTsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGlmIHdlIHNob3VsZCBhdXRvLXBvc2l0aW9uIHRoZSBhbmdsZSBmb3IgdGhlCiAgICAgICAgLy8gbGFiZWxzLiBCYXNpY2FsbHkgd2UgdHJ5IHRvIGZpbmQgYSBmaXJlY3Rpb24gd2l0aCBzbWFsbGVzdAogICAgICAgIC8vIChvciBub25lKSBkYXRhLgogICAgICAgICR0aGlzLT5TZXRBdXRvU2NhbGVBbmdsZSh0cnVlKTsKCiAgICAgICAgJG5sYyA9IGNvdW50KCR0aGlzLT5pTGVnQ29sb3JzKTsKICAgICAgICAkbmx3ID0gY291bnQoJHRoaXMtPmlMZWd3ZWlnaHRzKTsKCiAgICAgICAgJHRoaXMtPmlSYWRpYWxDb2xvckFycmF5ID0gJHRoaXMtPkZpeHVwSW5kZXhlcygkdGhpcy0+aVJhZGlhbENvbG9yQXJyYXksJG51bSk7CiAgICAgICAgJHRoaXMtPmlSYWRpYWxXZWlnaHRBcnJheSA9ICR0aGlzLT5GaXh1cEluZGV4ZXMoJHRoaXMtPmlSYWRpYWxXZWlnaHRBcnJheSwkbnVtKTsKICAgICAgICAkdGhpcy0+aVJhZGlhbFN0eWxlQXJyYXkgPSAkdGhpcy0+Rml4dXBJbmRleGVzKCR0aGlzLT5pUmFkaWFsU3R5bGVBcnJheSwkbnVtKTsKCiAgICAgICAgJHR4dHBvcz1hcnJheSgpOwogICAgICAgICRhID0gMipNX1BJLyRudW07CiAgICAgICAgJGRibEltZy0+U2V0Q29sb3IoJHRoaXMtPmlHcmlkQ29sb3IyKTsKICAgICAgICAkZGJsSW1nLT5TZXRMaW5lU3R5bGUoJHRoaXMtPmlSYWRpYWxHcmlkU3R5bGUpOwogICAgICAgICRkYmxJbWctPlNldExpbmVXZWlnaHQoJHRoaXMtPmlSYWRpYWxHcmlkV2VpZ2h0KTsKCiAgICAgICAgLy8gVHJhbnNsYXRlIGFueSBuYW1lIHNwZWNpZmllZCBkaXJlY3Rpb25zIHRvIHRoZSBpbmRleAogICAgICAgIC8vIHNvIHdlIGNhbiBlYXNpbHkgdXNlIGl0IGluIHRoZSBsb29wIGJlbG93CiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG51bTsgKyskaSApIHsKICAgICAgICAgICAgJHh4YyA9IHJvdW5kKCR4YyArIGNvcygkYSokaSkqJHJpKTsKICAgICAgICAgICAgJHl5YyA9IHJvdW5kKCR5YyAtIHNpbigkYSokaSkqJHJpKTsKICAgICAgICAgICAgJHggPSByb3VuZCgkeGMgKyBjb3MoJGEqJGkpKiRyKTsKICAgICAgICAgICAgJHkgPSByb3VuZCgkeWMgLSBzaW4oJGEqJGkpKiRyKTsKICAgICAgICAgICAgaWYoIGVtcHR5KCR0aGlzLT5pUmFkaWFsQ29sb3JBcnJheVskaV0pICkgewogICAgICAgICAgICAgICAgJGRibEltZy0+U2V0Q29sb3IoJHRoaXMtPmlHcmlkQ29sb3IyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRkYmxJbWctPlNldENvbG9yKCR0aGlzLT5pUmFkaWFsQ29sb3JBcnJheVskaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCBlbXB0eSgkdGhpcy0+aVJhZGlhbFdlaWdodEFycmF5WyRpXSkgKSB7CiAgICAgICAgICAgICAgICAkZGJsSW1nLT5TZXRMaW5lV2VpZ2h0KCR0aGlzLT5pUmFkaWFsR3JpZFdlaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkZGJsSW1nLT5TZXRMaW5lV2VpZ2h0KCR0aGlzLT5pUmFkaWFsV2VpZ2h0QXJyYXlbJGldKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggZW1wdHkoJHRoaXMtPmlSYWRpYWxTdHlsZUFycmF5WyRpXSkgKSB7CiAgICAgICAgICAgICAgICAkZGJsSW1nLT5TZXRMaW5lU3R5bGUoJHRoaXMtPmlSYWRpYWxHcmlkU3R5bGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJGRibEltZy0+U2V0TGluZVN0eWxlKCR0aGlzLT5pUmFkaWFsU3R5bGVBcnJheVskaV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGJsSW1nLT5TdHlsZUxpbmUoJHh4YywkeXljLCR4LCR5KTsKICAgICAgICAgICAgJHR4dHBvc1tdID0gYXJyYXkoJHgsJHksJGEqJGkpOwogICAgICAgIH0KICAgICAgICAkZGJsSW1nLT5TZXRMaW5lV2VpZ2h0KDEpOwoKICAgICAgICAkbHIgPSAkc2NhbGluZyAqICR0aGlzLT5pTGFiZWxNYXJnaW47CiAgICAgICAgaWYoICR0aGlzLT5pTGFiZWxQb3NpdGlvbmluZyA9PSBMQkxQT1NJVElPTl9DRU5URVIgKSB7CiAgICAgICAgICAgICR2YWx1ZS0+U2V0QWxpZ24oJ2NlbnRlcicsJ2NlbnRlcicpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHZhbHVlLT5TZXRBbGlnbignbGVmdCcsJ3RvcCcpOwogICAgICAgICAgICAkdmFsdWUtPlNldE1hcmdpbigwKTsKICAgICAgICAgICAgJGxyIC89IDIgOwogICAgICAgIH0KCiAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG51bTsgKyskaSApIHsKICAgICAgICAgICAgbGlzdCgkeCwkeSwkYSkgPSAkdHh0cG9zWyRpXTsKCiAgICAgICAgICAgIC8vIFNldCB0aGUgcG9zaXRpb24gb2YgdGhlIGxhYmVsCiAgICAgICAgICAgIGlmKCAkdGhpcy0+aUxhYmVsUG9zaXRpb25pbmcgPT0gTEJMUE9TSVRJT05fQ0VOVEVSICkgewogICAgICAgICAgICAgICAgJGR4ID0gJGR5ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIExCTFBPU0lJVE9OX0VER0UKICAgICAgICAgICAgICAgIGlmKCAkYT49NypNX1BJLzQgfHwgJGEgPD0gTV9QSS80ICkgJGR4PTA7CiAgICAgICAgICAgICAgICBpZiggJGE+PU1fUEkvNCAmJiAkYSA8PSAzKk1fUEkvNCApICRkeD0oJGEtTV9QSS80KSoyL01fUEk7CiAgICAgICAgICAgICAgICBpZiggJGE+PTMqTV9QSS80ICYmICRhIDw9IDUqTV9QSS80ICkgJGR4PTE7CiAgICAgICAgICAgICAgICBpZiggJGE+PTUqTV9QSS80ICYmICRhIDw9IDcqTV9QSS80ICkgJGR4PSgxLSgkYS1NX1BJKjUvNCkqMi9NX1BJKTsKCiAgICAgICAgICAgICAgICBpZiggJGE+PTcqTV9QSS80ICkgJGR5PSgoJGEtTV9QSSktMypNX1BJLzQpKjIvTV9QSTsKICAgICAgICAgICAgICAgIGlmKCAkYTw9TV9QSS80ICkgJGR5PSgwLjUrJGEqMi9NX1BJKTsKICAgICAgICAgICAgICAgIGlmKCAkYT49TV9QSS80ICYmICRhIDw9IDMqTV9QSS80ICkgJGR5PTE7CiAgICAgICAgICAgICAgICBpZiggJGE+PTMqTV9QSS80ICYmICRhIDw9IDUqTV9QSS80ICkgJGR5PSgxLSgkYS0zKk1fUEkvNCkqMi9NX1BJKTsKICAgICAgICAgICAgICAgIGlmKCAkYT49NSpNX1BJLzQgJiYgJGEgPD0gNypNX1BJLzQgKSAkZHk9MDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHZhbHVlLT5TZXQoJHRoaXMtPmlBbGxEaXJlY3Rpb25MYWJlbHNbJGkqKDE2LyRudW0pXSk7CiAgICAgICAgICAgICR0aCA9ICR2YWx1ZS0+R2V0SGVpZ2h0KCRkYmxJbWcpOwogICAgICAgICAgICAkdHcgPSAkdmFsdWUtPkdldFdpZHRoKCRkYmxJbWcpOwogICAgICAgICAgICAkeHQ9cm91bmQoJGxyKmNvcygkYSkrJHgpIC0gJGR4KiR0dzsKICAgICAgICAgICAgJHl0PXJvdW5kKCR5LSRscipzaW4oJGEpKSAtICRkeSokdGg7CgogICAgICAgICAgICAkdmFsdWUtPlN0cm9rZSgkZGJsSW1nLCR4dCwkeXQpOwogICAgICAgIH0KCiAgICAgICAgaWYoIF9fREVCVUcgKSB7CiAgICAgICAgICAgICRkYmxJbWctPlNldENvbG9yKCJyZWQiKTsKICAgICAgICAgICAgJGRibEltZy0+Q2lyY2xlKCR4YywkeWMsJGxyKyRyKTsKICAgICAgICB9CgogICAgICAgIC8vIFN0cm9rZSBhbGwgdGhlIGxlZ3MKICAgICAgICByZXNldCgkdGhpcy0+aURhdGEpOwogICAgICAgICRrZXlzID0gYXJyYXlfa2V5cygkdGhpcy0+aURhdGEpOwogICAgICAgIGZvcmVhY2goJHRoaXMtPmlEYXRhIGFzICRpZHggPT4gJGxlZ2RhdGEpIHsKICAgICAgICAgICAgJGxlZ2RhdGEgPSBhcnJheV9zbGljZSgkbGVnZGF0YSwxKTsKICAgICAgICAgICAgJG5uID0gY291bnQoJGxlZ2RhdGEpOwogICAgICAgICAgICBpZiggaXNfc3RyaW5nKCRpZHgpICkgewogICAgICAgICAgICAgICAgJGlkeCA9IHN0cnRvdXBwZXIoJGlkeCk7CiAgICAgICAgICAgICAgICAkaWR4ID0gYXJyYXlfc2VhcmNoKCRpZHgsJHRoaXMtPmlBbGxEaXJlY3Rpb25MYWJlbHMpOwogICAgICAgICAgICAgICAgaWYoICRpZHggPT09IGZhbHNlICkgewogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIyMDE2KTsvLygnV2luZHJvc2UgbGVnIGluZGV4IG11c3QgYmUgbnVtZXJpYyBvciBkaXJlY3Rpb24gbGFiZWwuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiggJGlkeCAlICgxNiAvICRudW0pICE9PSAwICkgewogICAgICAgICAgICAgICAgICAgIEpwR3JhcGhFcnJvcjo6UmFpc2VMKDIyMDE3KTsvLygnV2luZHJvc2UgZGF0YSBjb250YWlucyBhIGRpcmVjdGlvbiB3aGljaCBpcyBub3QgZW5hYmxlZC4gUGxlYXNlIGFkanVzdCB3aGF0IGxhYmVscyBhcmUgZGlzcGxheWVkLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGlkeCAvPSAoMTYvJG51bSkgOwoKICAgICAgICAgICAgICAgIGlmKCBpbl9hcnJheSgkaWR4LCRrZXlzLDEpICkgewogICAgICAgICAgICAgICAgICAgIEpwZ3JhcGhFcnJvcjo6UmFpc2VMKDIyMDE4LCRpZHgpOy8vKCdZb3UgaGF2ZSBzcGVjaWZpZWQgZGF0YSBmb3IgdGhlIHNhbWUgY29tcGFzcyBkaXJlY3Rpb24gdHdpY2UsIG9uY2Ugd2l0aCB0ZXh0IGFuZCBvbmNlIHdpdGggaW5kZXggKEluZGV4PScuJGlkeC4nKScpOwoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiggJGlkeCA8IDAgfHwgJGlkeCA+IDE1ICkgewogICAgICAgICAgICAgICAgSnBncmFwaEVycm9yOjpSYWlzZUwoMjIwMTkpOy8vKCdJbmRleCBmb3IgZGlyZWN0aW9uIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxNS4gWW91IGNhblwndCBzcGVjaWZ5IGFuZ2xlcyBmb3IgYSBSZWd1bGFyIFdpbmRwbG90LCBvbmx5IGluZGV4IGFuZCBjb21wYXNzIGRpcmVjdGlvbnMuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGEgPSAkaWR4ICogKDM2MCAvICRudW0pIDsKICAgICAgICAgICAgJGEgKj0gTV9QSS8xODAuMDsKICAgICAgICAgICAgJHJyaSA9ICRyaS8kc2NhbGluZzsKICAgICAgICAgICAgZm9yKCAkaj0wOyAkaiA8ICRubjsgKyskaiApIHsKICAgICAgICAgICAgICAgIC8vIFdlIHdhbnQgdGhlIG5vbiBzY2FsZWQgb3JpZ2luYWwgcmFkaXVzCiAgICAgICAgICAgICAgICAkbGVnciA9ICR0aGlzLT5zY2FsZS0+UmVsVHJhbnNsYXRlKCRsZWdkYXRhWyRqXSwgJHIvJHNjYWxpbmcsJHJpLyRzY2FsaW5nKSA7CiAgICAgICAgICAgICAgICAkdGhpcy0+X1N0cm9rZVdpbmRMZWcoJGRibEltZywgJHhjLCAkeWMsICRhLAogICAgICAgICAgICAgICAgJHJyaSAqJHNjYWxpbmcsCiAgICAgICAgICAgICAgICAkbGVnciAqJHNjYWxpbmcsCiAgICAgICAgICAgICAgICAkdGhpcy0+aUxlZ3dlaWdodHNbJGogJSAkbmx3XSAqICRzY2FsaW5nLAogICAgICAgICAgICAgICAgJHRoaXMtPmlMZWdDb2xvcnNbJGogJSAkbmxjXSk7CiAgICAgICAgICAgICAgICAkcnJpICs9ICRsZWdyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBnZXRXaWR0aCgkYUltZykgewoKICAgICAgICAkc2NhbGluZyA9IDE7Ly8kdGhpcy0+aUFudGlBbGlhcyA\/IDIgOiAxIDsKICAgICAgIAlpZiggJHRoaXMtPmlTaXplID4gMCAmJiAkdGhpcy0+aVNpemUgPCAxICkgewoJCQkkdGhpcy0+aVNpemUgKj0gbWluKCRhSW1nLT53aWR0aCwkYUltZy0+aGVpZ2h0KTsKICAgICAgIAl9CgoKICAgICAgICAkdmFsdWUgPSBuZXcgVGV4dCgpOwogICAgICAgICR2YWx1ZS0+U2V0Rm9udCgkdGhpcy0+aUZvbnRGYW1pbHksJHRoaXMtPmlGb250U3R5bGUsJHRoaXMtPmlGb250U2l6ZSokc2NhbGluZyk7CiAgICAgICAgJHZhbHVlLT5TZXRDb2xvcigkdGhpcy0+aUZvbnRDb2xvcik7CiAgICAgICAgLy8gU2V0dXAgZXh0cmEgc2l6ZSBhcm91bmQgdGhlIGdyYXBoIG5lZWRlZCBzbyB0aGF0IHRoZSBsYWJlbHMKICAgICAgICAvLyBkb2Vzbid0IGdldCBjdXQuIEZvciB0aGlzIHdlIG5lZWQgdG8gZmluZCB0aGUgbGFyZ2VzdCBsYWJlbC4KICAgICAgICAvLyBUaGUgY29kZSBiZWxvdyBnaXZlcyBhIHBvc3NpYmxlIGEgbGl0dGxlIHRvIGxhcmdlIG1hcmdpbi4gVGhlCiAgICAgICAgLy8gcmVhbGx5LCByZWFsbHkgcHJvcGVyIHdheSB3b3VsZCBiZSB0byBhY2NvdW50IGZvciB3aGF0IGFuZ2xlCiAgICAgICAgLy8gdGhlIGxhYmVsIGFyZSBhdAogICAgICAgICRuID0gY291bnQoJHRoaXMtPmlMYWJlbHMpOwogICAgICAgIGlmKCAkbiA+IDAgKSB7CiAgICAgICAgICAgICRtYXhoPTA7JG1heHc9MDsKICAgICAgICAgICAgZm9yZWFjaCgkdGhpcy0+aUxhYmVscyBhcyAka2V5ID0+ICRsYmwpIHsKICAgICAgICAgICAgICAgICR2YWx1ZS0+U2V0KCRsYmwpOwogICAgICAgICAgICAgICAgJG1heHcgPSBtYXgoJG1heHcsJHZhbHVlLT5HZXRXaWR0aCgkYUltZykpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdmFsdWUtPlNldCgnODg4Ljg4OCcpOyAvLyBEdW1teSB2YWx1ZSB0byBnZXQgd2lkdGgvaGVpZ2h0CiAgICAgICAgICAgICRtYXh3ID0gJHZhbHVlLT5HZXRXaWR0aCgkYUltZyk7CiAgICAgICAgfQogICAgICAgIC8vIEFkZCBhbiBleHRyYSBtYXJnaW4gb2YgNTAlIHRoZSBmb250IHNpemUKICAgICAgICAkbWF4dyArPSByb3VuZCgkdGhpcy0+aUZvbnRTaXplKiRzY2FsaW5nICogMC40KSA7CgogICAgICAgICR2YWx4bWFyZyA9IDEuNSokbWF4dysyKiR0aGlzLT5pTGFiZWxNYXJnaW4qJHNjYWxpbmc7CiAgICAgICAgJHcgPSByb3VuZCgkdGhpcy0+aVNpemUqJHNjYWxpbmcgKyAkdmFseG1hcmcpOwoKICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgd2lkdGggb2YgdGhlIGxlZ2VuZCBmaXRzCiAgICAgICAgJGxlZ2VuZHdpZHRoID0gJHRoaXMtPl9TdHJva2VMZWdlbmQoJGFJbWcsMCwwLCRzY2FsaW5nLHRydWUpKzEwKiRzY2FsaW5nOwogICAgICAgICR3ID0gbWF4KCR3LCRsZWdlbmR3aWR0aCk7CgogICAgICAgIHJldHVybiAkdzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRIZWlnaHQoJGFJbWcpIHsKCiAgICAgICAgJHNjYWxpbmcgPSAxOy8vJHRoaXMtPmlBbnRpQWxpYXMgPyAyIDogMSA7CiAgICAgICAJaWYoICR0aGlzLT5pU2l6ZSA+IDAgJiYgJHRoaXMtPmlTaXplIDwgMSApIHsKCQkJJHRoaXMtPmlTaXplICo9IG1pbigkYUltZy0+d2lkdGgsJGFJbWctPmhlaWdodCk7CiAgICAgICAJfQoKICAgICAgICAkdmFsdWUgPSBuZXcgVGV4dCgpOwogICAgICAgICR2YWx1ZS0+U2V0Rm9udCgkdGhpcy0+aUZvbnRGYW1pbHksJHRoaXMtPmlGb250U3R5bGUsJHRoaXMtPmlGb250U2l6ZSokc2NhbGluZyk7CiAgICAgICAgJHZhbHVlLT5TZXRDb2xvcigkdGhpcy0+aUZvbnRDb2xvcik7CiAgICAgICAgLy8gU2V0dXAgZXh0cmEgc2l6ZSBhcm91bmQgdGhlIGdyYXBoIG5lZWRlZCBzbyB0aGF0IHRoZSBsYWJlbHMKICAgICAgICAvLyBkb2Vzbid0IGdldCBjdXQuIEZvciB0aGlzIHdlIG5lZWQgdG8gZmluZCB0aGUgbGFyZ2VzdCBsYWJlbC4KICAgICAgICAvLyBUaGUgY29kZSBiZWxvdyBnaXZlcyBhIHBvc3NpYmxlIGEgbGl0dGxlIHRvIGxhcmdlIG1hcmdpbi4gVGhlCiAgICAgICAgLy8gcmVhbGx5LCByZWFsbHkgcHJvcGVyIHdheSB3b3VsZCBiZSB0byBhY2NvdW50IGZvciB3aGF0IGFuZ2xlCiAgICAgICAgLy8gdGhlIGxhYmVsIGFyZSBhdAogICAgICAgICRuID0gY291bnQoJHRoaXMtPmlMYWJlbHMpOwogICAgICAgIGlmKCAkbiA+IDAgKSB7CiAgICAgICAgICAgICRtYXhoPTA7JG1heHc9MDsKICAgICAgICAgICAgZm9yZWFjaCgkdGhpcy0+aUxhYmVscyBhcyAka2V5ID0+ICRsYmwpIHsKICAgICAgICAgICAgICAgICR2YWx1ZS0+U2V0KCRsYmwpOwogICAgICAgICAgICAgICAgJG1heGggPSBtYXgoJG1heGgsJHZhbHVlLT5HZXRIZWlnaHQoJGFJbWcpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJHZhbHVlLT5TZXQoJzE4MC44Jyk7IC8vIER1bW15IHZhbHVlIHRvIGdldCB3aWR0aC9oZWlnaHQKICAgICAgICAgICAgJG1heGggPSAkdmFsdWUtPkdldEhlaWdodCgkYUltZyk7CiAgICAgICAgfQogICAgICAgIC8vIEFkZCBhbiBleHRyYSBtYXJnaW4gb2YgNTAlIHRoZSBmb250IHNpemUKICAgICAgICAvLyRtYXhoICs9IHJvdW5kKCR0aGlzLT5pRm9udFNpemUqJHNjYWxpbmcgKiAwLjUpIDsKICAgICAgICAkdmFseW1hcmcgPSAyKiRtYXhoKzIqJHRoaXMtPmlMYWJlbE1hcmdpbiokc2NhbGluZzsKCiAgICAgICAgJGxlZ2VuZGhlaWdodCA9IHJvdW5kKCR0aGlzLT5sZWdlbmQtPmlTaG93ID8gMSA6IDApOwogICAgICAgICRsZWdlbmRoZWlnaHQgKj0gbWF4KCR0aGlzLT5sZWdlbmQtPmlDaXJjbGVSYWRpdXMqMiwkdGhpcy0+bGVnZW5kLT5pVHh0Rm9udFNpemUqMikrCiAgICAgICAgCQkJCSAkdGhpcy0+bGVnZW5kLT5pTWFyZ2luICsgJHRoaXMtPmxlZ2VuZC0+aUJvdHRvbU1hcmdpbiArIDI7CiAgICAgICAgJGxlZ2VuZGhlaWdodCAqPSAkc2NhbGluZzsKICAgICAgICAkaCA9IHJvdW5kKCR0aGlzLT5pU2l6ZSokc2NhbGluZyArICR2YWx5bWFyZykgKyAkbGVnZW5kaGVpZ2h0IDsKCiAgICAgICAgcmV0dXJuICRoOwogICAgfQoKICAgIGZ1bmN0aW9uIFN0cm9rZSgkYUdyYXBoKSB7CgoJCSRhSW1nID0gJGFHcmFwaC0+aW1nOwoKCQlpZiggJHRoaXMtPmlYID4gMCAmJiAkdGhpcy0+aVggPCAxICkgewoJCQkkdGhpcy0+aVggPSByb3VuZCggJGFJbWctPndpZHRoICogJHRoaXMtPmlYICkgOwoJCX0KCiAgICAgICAJaWYoICR0aGlzLT5pWSA+IDAgJiYgJHRoaXMtPmlZIDwgMSApIHsKICAgICAgIAkJJHRoaXMtPmlZID0gcm91bmQoICRhSW1nLT5oZWlnaHQgKiAkdGhpcy0+aVkgKSA7CiAgICAgICAJfQoKICAgICAgIAlpZiggJHRoaXMtPmlTaXplID4gMCAmJiAkdGhpcy0+aVNpemUgPCAxICkgewoJCQkkdGhpcy0+aVNpemUgKj0gbWluKCRhSW1nLT53aWR0aCwkYUltZy0+aGVpZ2h0KTsKICAgICAgIAl9CgogICAgICAgCWlmKCAkdGhpcy0+aUNlbnRlclNpemUgPiAwICYmICR0aGlzLT5pQ2VudGVyU2l6ZSA8IDEgKSB7CgkJCSR0aGlzLT5pQ2VudGVyU2l6ZSAqPSAkdGhpcy0+aVNpemU7CiAgICAgICAJfQoKICAgICAgICAkdGhpcy0+c2NhbGUtPkF1dG9TY2FsZSgoJHRoaXMtPmlTaXplIC0gJHRoaXMtPmlDZW50ZXJTaXplKS8yLCByb3VuZCgyLjUqJHRoaXMtPnNjYWxlLT5pRm9udFNpemUpKTsKCiAgICAgICAgJHNjYWxpbmcgPSAkdGhpcy0+aUFudGlBbGlhcyA\/IDIgOiAxIDsKCiAgICAgICAgJHZhbHVlID0gbmV3IFRleHQoKTsKICAgICAgICAkdmFsdWUtPlNldEZvbnQoJHRoaXMtPmlGb250RmFtaWx5LCR0aGlzLT5pRm9udFN0eWxlLCR0aGlzLT5pRm9udFNpemUqJHNjYWxpbmcpOwogICAgICAgICR2YWx1ZS0+U2V0Q29sb3IoJHRoaXMtPmlGb250Q29sb3IpOwoKICAgICAgICAkbGVnZW5kaGVpZ2h0ID0gcm91bmQoJHRoaXMtPmxlZ2VuZC0+aVNob3cgPyAxIDogMCk7CiAgICAgICAgJGxlZ2VuZGhlaWdodCAqPSBtYXgoJHRoaXMtPmxlZ2VuZC0+aUNpcmNsZVJhZGl1cyoyLCR0aGlzLT5sZWdlbmQtPmlUeHRGb250U2l6ZSoyKSsKICAgICAgICAkdGhpcy0+bGVnZW5kLT5pTWFyZ2luICsgJHRoaXMtPmxlZ2VuZC0+aUJvdHRvbU1hcmdpbiArIDI7CiAgICAgICAgJGxlZ2VuZGhlaWdodCAqPSAkc2NhbGluZzsKCiAgICAgICAgJHcgPSAkc2NhbGluZyokdGhpcy0+Z2V0V2lkdGgoJGFJbWcpOwogICAgICAgICRoID0gJHNjYWxpbmcqJHRoaXMtPmdldEhlaWdodCgkYUltZyk7CgogICAgICAgIC8vIENvcHkgYmFjayB0aGUgZG91YmxlIGJ1ZmZlcmVkIGltYWdlIHRvIHRoZSBwcm9wZXIgY2FudmFzCiAgICAgICAgJHd3ID0gJHcgLyAkc2NhbGluZyA7CiAgICAgICAgJGhoID0gJGggLyAkc2NhbGluZyA7CgogICAgICAgIC8vIENyZWF0ZSB0aGUgZG91YmxlIGJ1ZmZlcgogICAgICAgIGlmKCAkdGhpcy0+aUFudGlBbGlhcyApIHsKICAgICAgICAgICAgJGRibEltZyA9IG5ldyBSb3RJbWFnZSgkdywkaCk7CiAgICAgICAgICAgIC8vIFNldCB0aGUgYmFja2dyb3VuZCBjb2xvcgogICAgICAgICAgICAkZGJsSW1nLT5TZXRDb2xvcigkdGhpcy0+aUNvbG9yKTsKICAgICAgICAgICAgJGRibEltZy0+RmlsbGVkUmVjdGFuZ2xlKDAsMCwkdywkaCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkZGJsSW1nID0gJGFJbWcgOwogICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGl4IGFuZCBpdCBjb29yZGluYXRlcyBjb3JyZXBvbmQgdG8gdGhlIG5ldyB0b3AgbGVmdCBjZW50ZXIKICAgICAgICAgICAgJGRibEltZy0+U2V0VHJhbnNsYXRpb24oJHRoaXMtPmlYLSR3LzIsICR0aGlzLT5pWS0kaC8yKTsKICAgICAgICB9CgogICAgICAgIGlmKCBfX0RFQlVHICkgewogICAgICAgICAgICAkZGJsSW1nLT5TZXRDb2xvcigncmVkJyk7CiAgICAgICAgICAgICRkYmxJbWctPlJlY3RhbmdsZSgwLDAsJHctMSwkaC0xKTsKICAgICAgICB9CgogICAgICAgICRkYmxJbWctPlNldENvbG9yKCdibGFjaycpOwoKICAgICAgICBpZiggJHRoaXMtPmlTaG93Qm94ICkgewogICAgICAgICAgICAkZGJsSW1nLT5TZXRDb2xvcigkdGhpcy0+aUJveENvbG9yKTsKICAgICAgICAgICAgJG9sZCA9ICRkYmxJbWctPlNldExpbmVXZWlnaHQoJHRoaXMtPmlCb3hXZWlnaHQpOwogICAgICAgICAgICAkZGJsSW1nLT5TZXRMaW5lU3R5bGUoJHRoaXMtPmlCb3hTdHlsZSk7CiAgICAgICAgICAgICRkYmxJbWctPlJlY3RhbmdsZSgwLDAsJHctMSwkaC0xKTsKICAgICAgICAgICAgJGRibEltZy0+U2V0TGluZVdlaWdodCgkb2xkKTsKICAgICAgICB9CgogICAgICAgICR4YyA9IHJvdW5kKCR3LzIpOwogICAgICAgICR5YyA9IHJvdW5kKCgkaC0kbGVnZW5kaGVpZ2h0KS8yKTsKCiAgICAgICAgaWYoIF9fREVCVUcgKSB7CiAgICAgICAgICAgICRkYmxJbWctPlNldENvbG9yKCdyZWQnKTsKICAgICAgICAgICAgJG9sZCA9ICRkYmxJbWctPlNldExpbmVXZWlnaHQoMik7CiAgICAgICAgICAgICRkYmxJbWctPkxpbmUoJHhjLTUsJHljLTUsJHhjKzUsJHljKzUpOwoJCQkkZGJsSW1nLT5MaW5lKCR4Yys1LCR5Yy01LCR4Yy01LCR5Yys1KTsKCQkJJGRibEltZy0+U2V0TGluZVdlaWdodCgkb2xkKTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5pU2l6ZSAqPSAkc2NhbGluZzsKCiAgICAgICAgLy8gSW5uZXIgY2lyY2xlIHNpemUKICAgICAgICAkcmkgPSAkdGhpcy0+aUNlbnRlclNpemUvMiA7CgogICAgICAgIC8vIEZ1bGwgY2lyY2xlIHJhZGl1cwogICAgICAgICRyID0gcm91bmQoICR0aGlzLT5pU2l6ZS8yICk7CgogICAgICAgIC8vIEdldCBudW1iZXIgb2YgZ3JpZCBjaXJjbGVzCiAgICAgICAgJG4gPSAkdGhpcy0+c2NhbGUtPkdldE51bUNpcmMoKTsKCiAgICAgICAgLy8gUGxvdCBjaXJjbGUgZ3JpZHMKICAgICAgICAkcmkgKj0gJHNjYWxpbmcgOwogICAgICAgICRyciA9IHJvdW5kKCgkci0kcmkpLyRuKTsKICAgICAgICBmb3IoICRpID0gMTsgJGkgPD0gJG47ICsrJGkgKSB7CiAgICAgICAgICAgICR0aGlzLT5fVGhpY2tDaXJjbGUoJGRibEltZywkeGMsJHljLCRyciokaSskcmksCiAgICAgICAgICAgICR0aGlzLT5pQ2lyY0dyaWRXZWlnaHQsJHRoaXMtPmlHcmlkQ29sb3IxKTsKICAgICAgICB9CgogICAgICAgICRudW0gPSAwIDsKCiAgICAgICAgaWYoICR0aGlzLT5pVHlwZSA9PSBXSU5EUk9TRV9UWVBFRlJFRSApIHsKICAgICAgICAgICAgJHRoaXMtPl9TdHJva2VGcmVlUm9zZSgkZGJsSW1nLCR2YWx1ZSwkc2NhbGluZywkeGMsJHljLCRyLCRyaSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSBuZWVkIHRvIHJlLWNvZGUgdGhlIGludGVycHJldGF0aW9uIG9mIHRoZSBvcmRpbmFsCiAgICAgICAgICAgIC8vIG51bWJlciBpbiB0aGUgZGF0YS4gSW50ZXJuYWxseSBvcmRpbmFsIHZhbHVlIDAgaXMgRWFzdCBhbmQgdGhlbgogICAgICAgICAgICAvLyBjb3VudGVkIGFudGktY2xvY2t3aXNlLiBUaGUgdXNlciBtaWdodCBjaG9vc2UgYW4gZW5jb2RpbmcKICAgICAgICAgICAgLy8gdGhhdCBoYXZlIDAgYmVpbmcgdGhlIGZpcnN0IGF4aXMgdG8gdGhlIHJpZ2h0IG9mIHRoZSAiTiIgYXhpcyBhbmQgdGhlbgogICAgICAgICAgICAvLyBjb3VudGVkIGNsb2NrLXdpc2UKICAgICAgICAgICAgaWYoICR0aGlzLT5pT3JkaW5hbEVuY29kaW5nID09IEtFWUVOQ09ESU5HX0NMT0NLV0lTRSApIHsKICAgICAgICAgICAgICAgIGlmKCAkdGhpcy0+aVR5cGUgPT0gV0lORFJPU0VfVFlQRTE2ICkgewogICAgICAgICAgICAgICAgICAgICRjb25zdDEgPSAxOTsgJGNvbnN0MiA9IDE2OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmKCAkdGhpcy0+aVR5cGUgPT0gV0lORFJPU0VfVFlQRTggKSB7CiAgICAgICAgICAgICAgICAgICAgJGNvbnN0MSA9IDk7ICRjb25zdDIgPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGNvbnN0MSA9IDQ7ICRjb25zdDIgPSA0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRtcCA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAkbj1jb3VudCgkdGhpcy0+aURhdGEpOwogICAgICAgICAgICAgICAgZm9yZWFjaCggJHRoaXMtPmlEYXRhIGFzICRrZXkgPT4gJHZhbCApIHsKICAgICAgICAgICAgICAgICAgICBpZiggaXNfbnVtZXJpYygka2V5KSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGtleSA9ICgkY29uc3QxIC0gJGtleSkgJSAkY29uc3QyIDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHRtcFska2V5XSA9ICR2YWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+aURhdGEgPSAkdG1wOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5fU3Ryb2tlUmVndWxhclJvc2UoJGRibEltZywkdmFsdWUsJHNjYWxpbmcsJHhjLCR5YywkciwkcmkpOwogICAgICAgIH0KCiAgICAgICAgLy8gU3Ryb2tlIHRoZSBsYWJlbHMKICAgICAgICAkdGhpcy0+c2NhbGUtPmlGb250U2l6ZSAqPSAkc2NhbGluZzsKICAgICAgICAkdGhpcy0+c2NhbGUtPmlaRm9udFNpemUgKj0gJHNjYWxpbmc7CiAgICAgICAgJHRoaXMtPnNjYWxlLT5TdHJva2VMYWJlbHMoJGRibEltZywkeGMsJHljLCRyaSwkcnIpOwoKICAgICAgICAvLyBTdHJva2UgdGhlIGlubmVyIGNpcmNsZSBhZ2FpbiBzaW5jZSB0aGUgbGVncwogICAgICAgIC8vIG1pZ2h0IGhhdmUgd3JpdHRlbiBvdmVyIGl0CiAgICAgICAgJHRoaXMtPl9UaGlja0NpcmNsZSgkZGJsSW1nLCR4YywkeWMsJHJpLCR0aGlzLT5pQ2lyY0dyaWRXZWlnaHQsJHRoaXMtPmlHcmlkQ29sb3IxKTsKCiAgICAgICAgaWYoICR3dyA+ICRhSW1nLT53aWR0aCApIHsKICAgICAgICAgICAgSnBncmFwaEVycm9yOjpSYWlzZUwoMjIwMjApOwogICAgICAgICAgICAvLygnV2luZHJvc2UgcGxvdCBpcyB0b28gbGFyZ2UgdG8gZml0IHRoZSBzcGVjaWZpZWQgR3JhcGggc2l6ZS4gUGxlYXNlIHVzZSBXaW5kcm9zZVBsb3Q6OlNldFNpemUoKSB0byBtYWtlIHRoZSBwbG90IHNtYWxsZXIgb3IgaW5jcmVhc2UgdGhlIHNpemUgb2YgdGhlIEdyYXBoIGluIHRoZSBpbml0aWFsIFdpbmRyb3NlR3JhcGgoKSBjYWxsLicpOwogICAgICAgIH0KCiAgICAgICAgJHggPSAkeGM7CiAgICAgICAgJHkgPSAkaDsKICAgICAgICAkdGhpcy0+X1N0cm9rZUxlZ2VuZCgkZGJsSW1nLCR4LCR5LCRzY2FsaW5nKTsKCiAgICAgICAgaWYoICR0aGlzLT5pQW50aUFsaWFzICkgewogICAgICAgICAgICAkYUltZy0+Q29weSgkZGJsSW1nLT5pbWcsICR0aGlzLT5pWC0kd3cvMiwgJHRoaXMtPmlZLSRoaC8yLCAwLCAwLCAkd3csJGhoLCAkdywkaCk7CiAgICAgICAgfQoKICAgICAgICAvLyBXZSBuZWVkIHRvIHJlc3RvcmUgdGhlIHRyYW5zbGF0aW9uIG1hdHJpeAogICAgICAgICRhSW1nLT5TZXRUcmFuc2xhdGlvbigwLDApOwoKICAgIH0KCn0KCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENMQVNTIFdpbmRyb3NlR3JhcGgKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KY2xhc3MgV2luZHJvc2VHcmFwaCBleHRlbmRzIEdyYXBoIHsKICAgIHByaXZhdGUgJHBvc3gsICRwb3N5OwogICAgcHVibGljICRwbG90cz1hcnJheSgpOwoKICAgIGZ1bmN0aW9uIF9fY29uc3RydWN0KCR3aWR0aD0zMDAsJGhlaWdodD0yMDAsJGNhY2hlZE5hbWU9IiIsJHRpbWVvdXQ9MCwkaW5saW5lPTEpIHsKICAgICAgICBwYXJlbnQ6Ol9fY29uc3RydWN0KCR3aWR0aCwkaGVpZ2h0LCRjYWNoZWROYW1lLCR0aW1lb3V0LCRpbmxpbmUpOwogICAgICAgICR0aGlzLT5wb3N4PSR3aWR0aC8yOwogICAgICAgICR0aGlzLT5wb3N5PSRoZWlnaHQvMjsKICAgICAgICAkdGhpcy0+U2V0Q29sb3IoJ3doaXRlJyk7CiAgICAgICAgJHRoaXMtPnRpdGxlLT5TZXRGb250KEZGX1ZFUkRBTkEsRlNfTk9STUFMLDEyKTsKICAgICAgICAkdGhpcy0+dGl0bGUtPlNldE1hcmdpbig4KTsKICAgICAgICAkdGhpcy0+c3VidGl0bGUtPlNldEZvbnQoRkZfVkVSREFOQSxGU19OT1JNQUwsMTApOwogICAgICAgICR0aGlzLT5zdWJ0aXRsZS0+U2V0TWFyZ2luKDApOwogICAgICAgICR0aGlzLT5zdWJzdWJ0aXRsZS0+U2V0Rm9udChGRl9WRVJEQU5BLEZTX05PUk1BTCw4KTsKICAgICAgICAkdGhpcy0+c3Vic3VidGl0bGUtPlNldE1hcmdpbigwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBTdHJva2VUZXh0cygpIHsKICAgICAgICBpZiggJHRoaXMtPnRleHRzICE9IG51bGwgKSB7CiAgICAgICAgICAgICRuID0gY291bnQoJHRoaXMtPnRleHRzKTsKICAgICAgICAgICAgZm9yKCRpPTA7ICRpIDwgJG47ICsrJGkgKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+dGV4dHNbJGldLT5TdHJva2UoJHRoaXMtPmltZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gU3Ryb2tlSWNvbnMoKSB7CiAgICAgICAgaWYoICR0aGlzLT5pSWNvbnMgIT0gbnVsbCApIHsKICAgICAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+aUljb25zKTsKICAgICAgICAgICAgZm9yKCAkaT0wOyAkaSA8ICRuOyArKyRpICkgewogICAgICAgICAgICAgICAgLy8gU2luY2UgV2luZHJvc2UgZ3JhcGhzIGRvZXNuJ3QgaGF2ZSBhbnkgbGluZWFyIHNjYWxlIHRoZSBwb3NpdGlvbiBvZgogICAgICAgICAgICAgICAgLy8gZWFjaCBpY29uIGhhcyB0byBiZSBnaXZlbiBhcyBhYnNvbHV0ZSBjb29yZGluYXRlcwogICAgICAgICAgICAgICAgJHRoaXMtPmlJY29uc1skaV0tPl9TdHJva2UoJHRoaXMtPmltZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICBmdW5jdGlvbiBBZGQoJGFPYmopIHsKICAgICAgICBpZiggaXNfYXJyYXkoJGFPYmopICYmIGNvdW50KCRhT2JqKSA+IDAgKSB7CiAgICAgICAgICAgICRjbCA9ICRhT2JqWzBdOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJGNsID0gJGFPYmo7CiAgICAgICAgfQogICAgICAgIGlmKCAkY2wgaW5zdGFuY2VvZiBUZXh0ICkgewogICAgICAgICAgICAkdGhpcy0+QWRkVGV4dCgkYU9iaik7CiAgICAgICAgfQogICAgICAgIGVsc2VpZiggJGNsIGluc3RhbmNlb2YgSWNvblBsb3QgKSB7CiAgICAgICAgICAgICR0aGlzLT5BZGRJY29uKCRhT2JqKTsKICAgICAgICB9CiAgICAgICAgZWxzZWlmKCAoJGNsIGluc3RhbmNlb2YgV2luZHJvc2VQbG90KSB8fCAoJGNsIGluc3RhbmNlb2YgTGF5b3V0UmVjdCkgfHwgKCRjbCBpbnN0YW5jZW9mIExheW91dEhvcikpIHsKICAgICAgICAgICAgJHRoaXMtPnBsb3RzW10gPSAkYU9iajsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEpwZ3JhcGhFcnJvcjo6UmFpc2VMKDIyMDIxKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQWRkVGV4dCgkYVR4dCwkYVRvWTI9ZmFsc2UpIHsKICAgICAgICBwYXJlbnQ6OkFkZFRleHQoJGFUeHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIFNldENvbG9yKCRjKSB7CiAgICAgICAgJHRoaXMtPlNldE1hcmdpbkNvbG9yKCRjKTsKICAgIH0KCiAgICAvLyBNZXRob2QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIFN0cm9rZSgkYVN0cm9rZUZpbGVOYW1lPSIiKSB7CgogICAgICAgIC8vIElmIHRoZSBmaWxlbmFtZSBpcyB0aGUgcHJlZGVmaW5lZCB2YWx1ZSA9ICdfY3NpbV9zcGVjaWFsXycKICAgICAgICAvLyB3ZSBhc3N1bWUgdGhhdCB0aGUgY2FsbCB0byBzdHJva2Ugb25seSBuZWVkcyB0byBkbyBlbm91Z2gKICAgICAgICAvLyB0byBjb3JyZWN0bHkgZ2VuZXJhdGUgdGhlIENTSU0gbWFwcy4KICAgICAgICAvLyBXZSB1c2UgdGhpcyB2YXJpYWJsZSB0byBza2lwIHRoaW5ncyB3ZSBkb24ndCBzdHJpY3RseSBuZWVkCiAgICAgICAgLy8gdG8gZG8gdG8gZ2VuZXJhdGUgdGhlIGltYWdlIG1hcCB0byBpbXByb3ZlIHBlcmZvcm1hbmNlCiAgICAgICAgLy8gYXMgYmVzdCB3ZSBjYW4uIFRoZXJlZm9yZSB5b3Ugd2lsbCBzZWUgYSBsb3Qgb2YgdGVzdHMgISRfY3NpbSBpbiB0aGUKICAgICAgICAvLyBjb2RlIGJlbG93LgogICAgICAgICRfY3NpbSA9ICgkYVN0cm9rZUZpbGVOYW1lPT09X0NTSU1fU1BFQ0lBTEZJTEUpOwoKICAgICAgICAvLyBXZSBuZWVkIHRvIGtub3cgaWYgd2UgaGF2ZSBzdHJva2VkIHRoZSBwbG90IGluIHRoZQogICAgICAgIC8vIEdldENTSU1hcmVhcy4gT3RoZXJ3aXNlIHRoZSBDU0lNIGhhc24ndCBiZWVuIGdlbmVyYXRlZAogICAgICAgIC8vIGFuZCBpbiB0aGUgY2FzZSBvZiBHZXRDU0lNIGNhbGxlZCBiZWZvcmUgc3Ryb2tlIHRvIGdlbmVyYXRlCiAgICAgICAgLy8gQ1NJTSB3aXRob3V0IHN0b3JpbmcgYW4gaW1hZ2UgdG8gZGlzayBHZXRDU0lNIG11c3QgY2FsbCBTdHJva2UuCiAgICAgICAgJHRoaXMtPmlIYXNTdHJva2VkID0gdHJ1ZTsKCiAgICAgICAgaWYoICR0aGlzLT5iYWNrZ3JvdW5kX2ltYWdlICE9ICIiIHx8ICR0aGlzLT5iYWNrZ3JvdW5kX2NmbGFnICE9ICIiICkgewogICAgICAgICAgICAkdGhpcy0+U3Ryb2tlRnJhbWVCYWNrZ3JvdW5kKCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkdGhpcy0+U3Ryb2tlRnJhbWUoKTsKICAgICAgICB9CgogICAgICAgIC8vIG4gaG9sZHMgbnVtYmVyIG9mIHBsb3RzCiAgICAgICAgJG4gPSBjb3VudCgkdGhpcy0+cGxvdHMpOwogICAgICAgIGZvcigkaT0wOyAkaSA8ICRuIDsgKyskaSkgewogICAgIAkJJHRoaXMtPnBsb3RzWyRpXS0+U3Ryb2tlKCR0aGlzKTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5mb290ZXItPlN0cm9rZSgkdGhpcy0+aW1nKTsKICAgICAgICAkdGhpcy0+U3Ryb2tlSWNvbnMoKTsKICAgICAgICAkdGhpcy0+U3Ryb2tlVGV4dHMoKTsKICAgICAgICAkdGhpcy0+U3Ryb2tlVGl0bGVzKCk7CgogICAgICAgIC8vIElmIHRoZSBmaWxlbmFtZSBpcyBnaXZlbiBhcyB0aGUgc3BlY2lhbCAiX19oYW5kbGUiCiAgICAgICAgLy8gdGhlbiB0aGUgaW1hZ2UgaGFuZGxlciBpcyByZXR1cm5lZCBhbmQgdGhlIGltYWdlIGlzIE5PVAogICAgICAgIC8vIHN0cmVhbWVkIGJhY2sKICAgICAgICBpZiggJGFTdHJva2VGaWxlTmFtZSA9PSBfSU1HX0hBTkRMRVIgKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+aW1nLT5pbWc7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBGaW5hbGx5IHN0cmVhbSB0aGUgZ2VuZXJhdGVkIHBpY3R1cmUKICAgICAgICAgICAgJHRoaXMtPmNhY2hlLT5QdXRBbmRTdHJlYW0oJHRoaXMtPmltZywkdGhpcy0+Y2FjaGVfbmFtZSwkdGhpcy0+aW5saW5lLAogICAgICAgICAgICAkYVN0cm9rZUZpbGVOYW1lKTsKICAgICAgICB9CiAgICB9Cgp9IC8vIENsYXNzCgo\/Pgo=",
    "size": "53483"
}