{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Reader\/Excel2003XML.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KICAgIGRlZmluZSgnUEhQRVhDRUxfUk9PVCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8uLi8uLi8nKTsKICAgIHJlcXVpcmUoUEhQRVhDRUxfUk9PVCAuICdQSFBFeGNlbC9BdXRvbG9hZGVyLnBocCcpOwp9CgovKioKICogUEhQRXhjZWxfUmVhZGVyX0V4Y2VsMjAwM1hNTAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKICogdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBCiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsX1JlYWRlcgogKiBAY29weXJpZ2h0ICBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsIChodHRwOi8vd3d3LmNvZGVwbGV4LmNvbS9QSFBFeGNlbCkKICogQGxpY2Vuc2UgICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL29sZC1saWNlbnNlcy9sZ3BsLTIuMS50eHQgICAgTEdQTAogKiBAdmVyc2lvbiAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCmNsYXNzIFBIUEV4Y2VsX1JlYWRlcl9FeGNlbDIwMDNYTUwgZXh0ZW5kcyBQSFBFeGNlbF9SZWFkZXJfQWJzdHJhY3QgaW1wbGVtZW50cyBQSFBFeGNlbF9SZWFkZXJfSVJlYWRlcgp7CiAgICAvKioKICAgICAqIEZvcm1hdHMKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkc3R5bGVzID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIENoYXJhY3RlciBzZXQgdXNlZCBpbiB0aGUgZmlsZQogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCAkY2hhclNldCA9ICdVVEYtOCc7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgUEhQRXhjZWxfUmVhZGVyX0V4Y2VsMjAwM1hNTAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKQogICAgewogICAgICAgICR0aGlzLT5yZWFkRmlsdGVyID0gbmV3IFBIUEV4Y2VsX1JlYWRlcl9EZWZhdWx0UmVhZEZpbHRlcigpOwogICAgfQoKCiAgICAvKioKICAgICAqIENhbiB0aGUgY3VycmVudCBQSFBFeGNlbF9SZWFkZXJfSVJlYWRlciByZWFkIHRoZSBmaWxlPwogICAgICoKICAgICAqIEBwYXJhbSAgICAgc3RyaW5nICAgICAgICAgJHBGaWxlbmFtZQogICAgICogQHJldHVybiAgICAgYm9vbGVhbgogICAgICogQHRocm93cyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjYW5SZWFkKCRwRmlsZW5hbWUpCiAgICB7CgogICAgICAgIC8vICAgIE9mZmljZSAgICAgICAgICAgICAgICAgICAgeG1sbnM6bz0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6b2ZmaWNlIgogICAgICAgIC8vICAgIEV4Y2VsICAgICAgICAgICAgICAgICAgICB4bWxuczp4PSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTpleGNlbCIKICAgICAgICAvLyAgICBYTUwgU3ByZWFkc2hlZXQgICAgICAgICAgICB4bWxuczpzcz0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6c3ByZWFkc2hlZXQiCiAgICAgICAgLy8gICAgU3ByZWFkc2hlZXQgY29tcG9uZW50ICAgIHhtbG5zOmM9InVybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOmNvbXBvbmVudDpzcHJlYWRzaGVldCIKICAgICAgICAvLyAgICBYTUwgc2NoZW1hICAgICAgICAgICAgICAgICB4bWxuczpzPSJ1dWlkOkJEQzZFM0YwLTZEQTMtMTFkMS1BMkEzLTAwQUEwMEMxNDg4MiIKICAgICAgICAvLyAgICBYTUwgZGF0YSB0eXBlICAgICAgICAgICAgeG1sbnM6ZHQ9InV1aWQ6QzJGNDEwMTAtNjVCMy0xMWQxLUEyOUYtMDBBQTAwQzE0ODgyIgogICAgICAgIC8vICAgIE1TLXBlcnNpc3QgcmVjb3Jkc2V0ICAgIHhtbG5zOnJzPSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOnJvd3NldCIKICAgICAgICAvLyAgICBSb3dzZXQgICAgICAgICAgICAgICAgICAgIHhtbG5zOno9IiNSb3dzZXRTY2hlbWEiCiAgICAgICAgLy8KCiAgICAgICAgJHNpZ25hdHVyZSA9IGFycmF5KAogICAgICAgICAgICAgICAgJzw\/eG1sIHZlcnNpb249IjEuMCInLAogICAgICAgICAgICAgICAgJzw\/bXNvLWFwcGxpY2F0aW9uIHByb2dpZD0iRXhjZWwuU2hlZXQiPz4nCiAgICAgICAgICAgICk7CgogICAgICAgIC8vIE9wZW4gZmlsZQogICAgICAgICR0aGlzLT5vcGVuRmlsZSgkcEZpbGVuYW1lKTsKICAgICAgICAkZmlsZUhhbmRsZSA9ICR0aGlzLT5maWxlSGFuZGxlOwogICAgICAgIAogICAgICAgIC8vIFJlYWQgc2FtcGxlIGRhdGEgKGZpcnN0IDIgS0Igd2lsbCBkbykKICAgICAgICAkZGF0YSA9IGZyZWFkKCRmaWxlSGFuZGxlLCAyMDQ4KTsKICAgICAgICBmY2xvc2UoJGZpbGVIYW5kbGUpOwoKICAgICAgICAkdmFsaWQgPSB0cnVlOwogICAgICAgIGZvcmVhY2ggKCRzaWduYXR1cmUgYXMgJG1hdGNoKSB7CiAgICAgICAgICAgIC8vIGV2ZXJ5IHBhcnQgb2YgdGhlIHNpZ25hdHVyZSBtdXN0IGJlIHByZXNlbnQKICAgICAgICAgICAgaWYgKHN0cnBvcygkZGF0YSwgJG1hdGNoKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICR2YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vICAgIFJldHJpZXZlIGNoYXJzZXQgZW5jb2RpbmcKICAgICAgICBpZiAocHJlZ19tYXRjaCgnLzw\/eG1sLiplbmNvZGluZz1bXCciXSguKj8pW1wnIl0uKj8+L3VtJywgJGRhdGEsICRtYXRjaGVzKSkgewogICAgICAgICAgICAkdGhpcy0+Y2hhclNldCA9IHN0cnRvdXBwZXIoJG1hdGNoZXNbMV0pOwogICAgICAgIH0KLy8gICAgICAgIGVjaG8gJ0NoYXJhY3RlciBTZXQgaXMgJywgJHRoaXMtPmNoYXJTZXQsJzxiciAvPic7CgogICAgICAgIHJldHVybiAkdmFsaWQ7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVhZHMgbmFtZXMgb2YgdGhlIHdvcmtzaGVldHMgZnJvbSBhIGZpbGUsIHdpdGhvdXQgcGFyc2luZyB0aGUgd2hvbGUgZmlsZSB0byBhIFBIUEV4Y2VsIG9iamVjdAogICAgICoKICAgICAqIEBwYXJhbSAgICAgc3RyaW5nICAgICAgICAgJHBGaWxlbmFtZQogICAgICogQHRocm93cyAgICAgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbGlzdFdvcmtzaGVldE5hbWVzKCRwRmlsZW5hbWUpCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSBleGlzdHMKICAgICAgICBpZiAoIWZpbGVfZXhpc3RzKCRwRmlsZW5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCJDb3VsZCBub3Qgb3BlbiAiIC4gJHBGaWxlbmFtZSAuICIgZm9yIHJlYWRpbmchIEZpbGUgZG9lcyBub3QgZXhpc3QuIik7CiAgICAgICAgfQogICAgICAgIGlmICghJHRoaXMtPmNhblJlYWQoJHBGaWxlbmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24oJHBGaWxlbmFtZSAuICIgaXMgYW4gSW52YWxpZCBTcHJlYWRzaGVldCBmaWxlLiIpOwogICAgICAgIH0KCiAgICAgICAgJHdvcmtzaGVldE5hbWVzID0gYXJyYXkoKTsKCiAgICAgICAgJHhtbCA9IHNpbXBsZXhtbF9sb2FkX3N0cmluZygkdGhpcy0+c2VjdXJpdHlTY2FuKGZpbGVfZ2V0X2NvbnRlbnRzKCRwRmlsZW5hbWUpKSwgJ1NpbXBsZVhNTEVsZW1lbnQnLCBQSFBFeGNlbF9TZXR0aW5nczo6Z2V0TGliWG1sTG9hZGVyT3B0aW9ucygpKTsKICAgICAgICAkbmFtZXNwYWNlcyA9ICR4bWwtPmdldE5hbWVzcGFjZXModHJ1ZSk7CgogICAgICAgICR4bWxfc3MgPSAkeG1sLT5jaGlsZHJlbigkbmFtZXNwYWNlc1snc3MnXSk7CiAgICAgICAgZm9yZWFjaCAoJHhtbF9zcy0+V29ya3NoZWV0IGFzICR3b3Jrc2hlZXQpIHsKICAgICAgICAgICAgJHdvcmtzaGVldF9zcyA9ICR3b3Jrc2hlZXQtPmF0dHJpYnV0ZXMoJG5hbWVzcGFjZXNbJ3NzJ10pOwogICAgICAgICAgICAkd29ya3NoZWV0TmFtZXNbXSA9IHNlbGY6OmNvbnZlcnRTdHJpbmdFbmNvZGluZygoc3RyaW5nKSAkd29ya3NoZWV0X3NzWydOYW1lJ10sICR0aGlzLT5jaGFyU2V0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkd29ya3NoZWV0TmFtZXM7CiAgICB9CgoKICAgIC8qKgogICAgICogUmV0dXJuIHdvcmtzaGVldCBpbmZvIChOYW1lLCBMYXN0IENvbHVtbiBMZXR0ZXIsIExhc3QgQ29sdW1uIEluZGV4LCBUb3RhbCBSb3dzLCBUb3RhbCBDb2x1bW5zKQogICAgICoKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgJHBGaWxlbmFtZQogICAgICogQHRocm93cyAgIFBIUEV4Y2VsX1JlYWRlcl9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGxpc3RXb3Jrc2hlZXRJbmZvKCRwRmlsZW5hbWUpCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSBleGlzdHMKICAgICAgICBpZiAoIWZpbGVfZXhpc3RzKCRwRmlsZW5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCJDb3VsZCBub3Qgb3BlbiAiIC4gJHBGaWxlbmFtZSAuICIgZm9yIHJlYWRpbmchIEZpbGUgZG9lcyBub3QgZXhpc3QuIik7CiAgICAgICAgfQoKICAgICAgICAkd29ya3NoZWV0SW5mbyA9IGFycmF5KCk7CgogICAgICAgICR4bWwgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbihmaWxlX2dldF9jb250ZW50cygkcEZpbGVuYW1lKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7CiAgICAgICAgJG5hbWVzcGFjZXMgPSAkeG1sLT5nZXROYW1lc3BhY2VzKHRydWUpOwoKICAgICAgICAkd29ya3NoZWV0SUQgPSAxOwogICAgICAgICR4bWxfc3MgPSAkeG1sLT5jaGlsZHJlbigkbmFtZXNwYWNlc1snc3MnXSk7CiAgICAgICAgZm9yZWFjaCAoJHhtbF9zcy0+V29ya3NoZWV0IGFzICR3b3Jrc2hlZXQpIHsKICAgICAgICAgICAgJHdvcmtzaGVldF9zcyA9ICR3b3Jrc2hlZXQtPmF0dHJpYnV0ZXMoJG5hbWVzcGFjZXNbJ3NzJ10pOwoKICAgICAgICAgICAgJHRtcEluZm8gPSBhcnJheSgpOwogICAgICAgICAgICAkdG1wSW5mb1snd29ya3NoZWV0TmFtZSddID0gJyc7CiAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uTGV0dGVyJ10gPSAnQSc7CiAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uSW5kZXgnXSA9IDA7CiAgICAgICAgICAgICR0bXBJbmZvWyd0b3RhbFJvd3MnXSA9IDA7CiAgICAgICAgICAgICR0bXBJbmZvWyd0b3RhbENvbHVtbnMnXSA9IDA7CgogICAgICAgICAgICBpZiAoaXNzZXQoJHdvcmtzaGVldF9zc1snTmFtZSddKSkgewogICAgICAgICAgICAgICAgJHRtcEluZm9bJ3dvcmtzaGVldE5hbWUnXSA9IChzdHJpbmcpICR3b3Jrc2hlZXRfc3NbJ05hbWUnXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICR0bXBJbmZvWyd3b3Jrc2hlZXROYW1lJ10gPSAiV29ya3NoZWV0X3skd29ya3NoZWV0SUR9IjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzc2V0KCR3b3Jrc2hlZXQtPlRhYmxlLT5Sb3cpKSB7CiAgICAgICAgICAgICAgICAkcm93SW5kZXggPSAwOwoKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR3b3Jrc2hlZXQtPlRhYmxlLT5Sb3cgYXMgJHJvd0RhdGEpIHsKICAgICAgICAgICAgICAgICAgICAkY29sdW1uSW5kZXggPSAwOwogICAgICAgICAgICAgICAgICAgICRyb3dIYXNEYXRhID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyb3dEYXRhLT5DZWxsIGFzICRjZWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY2VsbC0+RGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0bXBJbmZvWydsYXN0Q29sdW1uSW5kZXgnXSA9IG1heCgkdG1wSW5mb1snbGFzdENvbHVtbkluZGV4J10sICRjb2x1bW5JbmRleCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93SGFzRGF0YSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICsrJGNvbHVtbkluZGV4OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgKyskcm93SW5kZXg7CgogICAgICAgICAgICAgICAgICAgIGlmICgkcm93SGFzRGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdG1wSW5mb1sndG90YWxSb3dzJ10gPSBtYXgoJHRtcEluZm9bJ3RvdGFsUm93cyddLCAkcm93SW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRtcEluZm9bJ2xhc3RDb2x1bW5MZXR0ZXInXSA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkdG1wSW5mb1snbGFzdENvbHVtbkluZGV4J10pOwogICAgICAgICAgICAkdG1wSW5mb1sndG90YWxDb2x1bW5zJ10gPSAkdG1wSW5mb1snbGFzdENvbHVtbkluZGV4J10gKyAxOwoKICAgICAgICAgICAgJHdvcmtzaGVldEluZm9bXSA9ICR0bXBJbmZvOwogICAgICAgICAgICArKyR3b3Jrc2hlZXRJRDsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkd29ya3NoZWV0SW5mbzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBMb2FkcyBQSFBFeGNlbCBmcm9tIGZpbGUKICAgICAqCiAgICAgKiBAcGFyYW0gICAgIHN0cmluZyAgICAgICAgICRwRmlsZW5hbWUKICAgICAqIEByZXR1cm4gICAgIFBIUEV4Y2VsCiAgICAgKiBAdGhyb3dzICAgICBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBsb2FkKCRwRmlsZW5hbWUpCiAgICB7CiAgICAgICAgLy8gQ3JlYXRlIG5ldyBQSFBFeGNlbAogICAgICAgICRvYmpQSFBFeGNlbCA9IG5ldyBQSFBFeGNlbCgpOwogICAgICAgICRvYmpQSFBFeGNlbC0+cmVtb3ZlU2hlZXRCeUluZGV4KDApOwoKICAgICAgICAvLyBMb2FkIGludG8gdGhpcyBpbnN0YW5jZQogICAgICAgIHJldHVybiAkdGhpcy0+bG9hZEludG9FeGlzdGluZygkcEZpbGVuYW1lLCAkb2JqUEhQRXhjZWwpOwogICAgfQoKICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gaWRlbnRpZnlGaXhlZFN0eWxlVmFsdWUoJHN0eWxlTGlzdCwgJiRzdHlsZUF0dHJpYnV0ZVZhbHVlKQogICAgewogICAgICAgICRzdHlsZUF0dHJpYnV0ZVZhbHVlID0gc3RydG9sb3dlcigkc3R5bGVBdHRyaWJ1dGVWYWx1ZSk7CiAgICAgICAgZm9yZWFjaCAoJHN0eWxlTGlzdCBhcyAkc3R5bGUpIHsKICAgICAgICAgICAgaWYgKCRzdHlsZUF0dHJpYnV0ZVZhbHVlID09IHN0cnRvbG93ZXIoJHN0eWxlKSkgewogICAgICAgICAgICAgICAgJHN0eWxlQXR0cmlidXRlVmFsdWUgPSAkc3R5bGU7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBwaXhlbCB1bml0cyB0byBleGNlbCB3aWR0aCB1bml0cyh1bml0cyBvZiAxLzI1NnRoIG9mIGEgY2hhcmFjdGVyIHdpZHRoKQogICAgICogQHBhcmFtIHB4cwogICAgICogQHJldHVybgogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZ1bmN0aW9uIHBpeGVsMldpZHRoVW5pdHMoJHB4cykKICAgIHsKICAgICAgICAkVU5JVF9PRkZTRVRfTUFQID0gYXJyYXkoMCwgMzYsIDczLCAxMDksIDE0NiwgMTgyLCAyMTkpOwoKICAgICAgICAkd2lkdGhVbml0cyA9IDI1NiAqICgkcHhzIC8gNyk7CiAgICAgICAgJHdpZHRoVW5pdHMgKz0gJFVOSVRfT0ZGU0VUX01BUFsoJHB4cyAlIDcpXTsKICAgICAgICByZXR1cm4gJHdpZHRoVW5pdHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBleGNlbCB3aWR0aCB1bml0cyh1bml0cyBvZiAxLzI1NnRoIG9mIGEgY2hhcmFjdGVyIHdpZHRoKSB0byBwaXhlbCB1bml0cwogICAgICogQHBhcmFtIHdpZHRoVW5pdHMKICAgICAqIEByZXR1cm4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiB3aWR0aFVuaXRzMlBpeGVsKCR3aWR0aFVuaXRzKQogICAgewogICAgICAgICRwaXhlbHMgPSAoJHdpZHRoVW5pdHMgLyAyNTYpICogNzsKICAgICAgICAkb2Zmc2V0V2lkdGhVbml0cyA9ICR3aWR0aFVuaXRzICUgMjU2OwogICAgICAgICRwaXhlbHMgKz0gcm91bmQoJG9mZnNldFdpZHRoVW5pdHMgLyAoMjU2IC8gNykpOwogICAgICAgIHJldHVybiAkcGl4ZWxzOwogICAgfQoKICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gaGV4MnN0cigkaGV4KQogICAgewogICAgICAgIHJldHVybiBjaHIoaGV4ZGVjKCRoZXhbMV0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIExvYWRzIFBIUEV4Y2VsIGZyb20gZmlsZSBpbnRvIFBIUEV4Y2VsIGluc3RhbmNlCiAgICAgKgogICAgICogQHBhcmFtICAgICBzdHJpbmcgICAgICAgICAkcEZpbGVuYW1lCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWwgICAgJG9ialBIUEV4Y2VsCiAgICAgKiBAcmV0dXJuICAgICBQSFBFeGNlbAogICAgICogQHRocm93cyAgICAgUEhQRXhjZWxfUmVhZGVyX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbG9hZEludG9FeGlzdGluZygkcEZpbGVuYW1lLCBQSFBFeGNlbCAkb2JqUEhQRXhjZWwpCiAgICB7CiAgICAgICAgJGZyb21Gb3JtYXRzICAgID0gYXJyYXkoJ1wtJywgJ1wgJyk7CiAgICAgICAgJHRvRm9ybWF0cyAgICAgID0gYXJyYXkoJy0nLCAnICcpOwoKICAgICAgICAkdW5kZXJsaW5lU3R5bGVzID0gYXJyYXkgKAogICAgICAgICAgICBQSFBFeGNlbF9TdHlsZV9Gb250OjpVTkRFUkxJTkVfTk9ORSwKICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGVfRm9udDo6VU5ERVJMSU5FX0RPVUJMRSwKICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGVfRm9udDo6VU5ERVJMSU5FX0RPVUJMRUFDQ09VTlRJTkcsCiAgICAgICAgICAgIFBIUEV4Y2VsX1N0eWxlX0ZvbnQ6OlVOREVSTElORV9TSU5HTEUsCiAgICAgICAgICAgIFBIUEV4Y2VsX1N0eWxlX0ZvbnQ6OlVOREVSTElORV9TSU5HTEVBQ0NPVU5USU5HCiAgICAgICAgKTsKICAgICAgICAkdmVydGljYWxBbGlnbm1lbnRTdHlsZXMgPSBhcnJheSAoCiAgICAgICAgICAgIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfQk9UVE9NLAogICAgICAgICAgICBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OlZFUlRJQ0FMX1RPUCwKICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpWRVJUSUNBTF9DRU5URVIsCiAgICAgICAgICAgIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6VkVSVElDQUxfSlVTVElGWQogICAgICAgICk7CiAgICAgICAgJGhvcml6b250YWxBbGlnbm1lbnRTdHlsZXMgPSBhcnJheSAoCiAgICAgICAgICAgIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6SE9SSVpPTlRBTF9HRU5FUkFMLAogICAgICAgICAgICBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfTEVGVCwKICAgICAgICAgICAgUEhQRXhjZWxfU3R5bGVfQWxpZ25tZW50OjpIT1JJWk9OVEFMX1JJR0hULAogICAgICAgICAgICBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfQ0VOVEVSLAogICAgICAgICAgICBQSFBFeGNlbF9TdHlsZV9BbGlnbm1lbnQ6OkhPUklaT05UQUxfQ0VOVEVSX0NPTlRJTlVPVVMsCiAgICAgICAgICAgIFBIUEV4Y2VsX1N0eWxlX0FsaWdubWVudDo6SE9SSVpPTlRBTF9KVVNUSUZZCiAgICAgICAgKTsKCiAgICAgICAgJHRpbWV6b25lT2JqID0gbmV3IERhdGVUaW1lWm9uZSgnRXVyb3BlL0xvbmRvbicpOwogICAgICAgICRHTVQgPSBuZXcgRGF0ZVRpbWVab25lKCdVVEMnKTsKCiAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSBleGlzdHMKICAgICAgICBpZiAoIWZpbGVfZXhpc3RzKCRwRmlsZW5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCJDb3VsZCBub3Qgb3BlbiAiIC4gJHBGaWxlbmFtZSAuICIgZm9yIHJlYWRpbmchIEZpbGUgZG9lcyBub3QgZXhpc3QuIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoISR0aGlzLT5jYW5SZWFkKCRwRmlsZW5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9SZWFkZXJfRXhjZXB0aW9uKCRwRmlsZW5hbWUgLiAiIGlzIGFuIEludmFsaWQgU3ByZWFkc2hlZXQgZmlsZS4iKTsKICAgICAgICB9CgogICAgICAgICR4bWwgPSBzaW1wbGV4bWxfbG9hZF9zdHJpbmcoJHRoaXMtPnNlY3VyaXR5U2NhbihmaWxlX2dldF9jb250ZW50cygkcEZpbGVuYW1lKSksICdTaW1wbGVYTUxFbGVtZW50JywgUEhQRXhjZWxfU2V0dGluZ3M6OmdldExpYlhtbExvYWRlck9wdGlvbnMoKSk7CiAgICAgICAgJG5hbWVzcGFjZXMgPSAkeG1sLT5nZXROYW1lc3BhY2VzKHRydWUpOwoKICAgICAgICAkZG9jUHJvcHMgPSAkb2JqUEhQRXhjZWwtPmdldFByb3BlcnRpZXMoKTsKICAgICAgICBpZiAoaXNzZXQoJHhtbC0+RG9jdW1lbnRQcm9wZXJ0aWVzWzBdKSkgewogICAgICAgICAgICBmb3JlYWNoICgkeG1sLT5Eb2N1bWVudFByb3BlcnRpZXNbMF0gYXMgJHByb3BlcnR5TmFtZSA9PiAkcHJvcGVydHlWYWx1ZSkgewogICAgICAgICAgICAgICAgc3dpdGNoICgkcHJvcGVydHlOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnVGl0bGUnOgogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldFRpdGxlKHNlbGY6OmNvbnZlcnRTdHJpbmdFbmNvZGluZygkcHJvcGVydHlWYWx1ZSwgJHRoaXMtPmNoYXJTZXQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnU3ViamVjdCc6CiAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQcm9wcy0+c2V0U3ViamVjdChzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJHByb3BlcnR5VmFsdWUsICR0aGlzLT5jaGFyU2V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0F1dGhvcic6CiAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQcm9wcy0+c2V0Q3JlYXRvcihzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJHByb3BlcnR5VmFsdWUsICR0aGlzLT5jaGFyU2V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0NyZWF0ZWQnOgogICAgICAgICAgICAgICAgICAgICAgICAkY3JlYXRpb25EYXRlID0gc3RydG90aW1lKCRwcm9wZXJ0eVZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXRDcmVhdGVkKCRjcmVhdGlvbkRhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdMYXN0QXV0aG9yJzoKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXRMYXN0TW9kaWZpZWRCeShzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJHByb3BlcnR5VmFsdWUsICR0aGlzLT5jaGFyU2V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xhc3RTYXZlZCc6CiAgICAgICAgICAgICAgICAgICAgICAgICRsYXN0U2F2ZURhdGUgPSBzdHJ0b3RpbWUoJHByb3BlcnR5VmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldE1vZGlmaWVkKCRsYXN0U2F2ZURhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdDb21wYW55JzoKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXRDb21wYW55KHNlbGY6OmNvbnZlcnRTdHJpbmdFbmNvZGluZygkcHJvcGVydHlWYWx1ZSwgJHRoaXMtPmNoYXJTZXQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnQ2F0ZWdvcnknOgogICAgICAgICAgICAgICAgICAgICAgICAkZG9jUHJvcHMtPnNldENhdGVnb3J5KHNlbGY6OmNvbnZlcnRTdHJpbmdFbmNvZGluZygkcHJvcGVydHlWYWx1ZSwgJHRoaXMtPmNoYXJTZXQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTWFuYWdlcic6CiAgICAgICAgICAgICAgICAgICAgICAgICRkb2NQcm9wcy0+c2V0TWFuYWdlcihzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJHByb3BlcnR5VmFsdWUsICR0aGlzLT5jaGFyU2V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0tleXdvcmRzJzoKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXRLZXl3b3JkcyhzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJHByb3BlcnR5VmFsdWUsICR0aGlzLT5jaGFyU2V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0Rlc2NyaXB0aW9uJzoKICAgICAgICAgICAgICAgICAgICAgICAgJGRvY1Byb3BzLT5zZXREZXNjcmlwdGlvbihzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJHByb3BlcnR5VmFsdWUsICR0aGlzLT5jaGFyU2V0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChpc3NldCgkeG1sLT5DdXN0b21Eb2N1bWVudFByb3BlcnRpZXMpKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCR4bWwtPkN1c3RvbURvY3VtZW50UHJvcGVydGllc1swXSBhcyAkcHJvcGVydHlOYW1lID0+ICRwcm9wZXJ0eVZhbHVlKSB7CiAgICAgICAgICAgICAgICAkcHJvcGVydHlBdHRyaWJ1dGVzID0gJHByb3BlcnR5VmFsdWUtPmF0dHJpYnV0ZXMoJG5hbWVzcGFjZXNbJ2R0J10pOwogICAgICAgICAgICAgICAgJHByb3BlcnR5TmFtZSA9IHByZWdfcmVwbGFjZV9jYWxsYmFjaygnL194KFswLTlhLXpdezR9KV8vJywgJ1BIUEV4Y2VsX1JlYWRlcl9FeGNlbDIwMDNYTUw6OmhleDJzdHInLCAkcHJvcGVydHlOYW1lKTsKICAgICAgICAgICAgICAgICRwcm9wZXJ0eVR5cGUgPSBQSFBFeGNlbF9Eb2N1bWVudFByb3BlcnRpZXM6OlBST1BFUlRZX1RZUEVfVU5LTk9XTjsKICAgICAgICAgICAgICAgIHN3aXRjaCAoKHN0cmluZykgJHByb3BlcnR5QXR0cmlidXRlcykgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9wZXJ0eVR5cGUgPSBQSFBFeGNlbF9Eb2N1bWVudFByb3BlcnRpZXM6OlBST1BFUlRZX1RZUEVfU1RSSU5HOwogICAgICAgICAgICAgICAgICAgICAgICAkcHJvcGVydHlWYWx1ZSA9IHRyaW0oJHByb3BlcnR5VmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzoKICAgICAgICAgICAgICAgICAgICAgICAgJHByb3BlcnR5VHlwZSA9IFBIUEV4Y2VsX0RvY3VtZW50UHJvcGVydGllczo6UFJPUEVSVFlfVFlQRV9CT09MRUFOOwogICAgICAgICAgICAgICAgICAgICAgICAkcHJvcGVydHlWYWx1ZSA9IChib29sKSAkcHJvcGVydHlWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW50ZWdlcic6CiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9wZXJ0eVR5cGUgPSBQSFBFeGNlbF9Eb2N1bWVudFByb3BlcnRpZXM6OlBST1BFUlRZX1RZUEVfSU5URUdFUjsKICAgICAgICAgICAgICAgICAgICAgICAgJHByb3BlcnR5VmFsdWUgPSBpbnR2YWwoJHByb3BlcnR5VmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdmbG9hdCc6CiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9wZXJ0eVR5cGUgPSBQSFBFeGNlbF9Eb2N1bWVudFByb3BlcnRpZXM6OlBST1BFUlRZX1RZUEVfRkxPQVQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9wZXJ0eVZhbHVlID0gZmxvYXR2YWwoJHByb3BlcnR5VmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdkYXRlVGltZS50eic6CiAgICAgICAgICAgICAgICAgICAgICAgICRwcm9wZXJ0eVR5cGUgPSBQSFBFeGNlbF9Eb2N1bWVudFByb3BlcnRpZXM6OlBST1BFUlRZX1RZUEVfREFURTsKICAgICAgICAgICAgICAgICAgICAgICAgJHByb3BlcnR5VmFsdWUgPSBzdHJ0b3RpbWUodHJpbSgkcHJvcGVydHlWYWx1ZSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRkb2NQcm9wcy0+c2V0Q3VzdG9tUHJvcGVydHkoJHByb3BlcnR5TmFtZSwgJHByb3BlcnR5VmFsdWUsICRwcm9wZXJ0eVR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3JlYWNoICgkeG1sLT5TdHlsZXNbMF0gYXMgJHN0eWxlKSB7CiAgICAgICAgICAgICRzdHlsZV9zcyA9ICRzdHlsZS0+YXR0cmlidXRlcygkbmFtZXNwYWNlc1snc3MnXSk7CiAgICAgICAgICAgICRzdHlsZUlEID0gKHN0cmluZykgJHN0eWxlX3NzWydJRCddOwovLyAgICAgICAgICAgIGVjaG8gJ1N0eWxlIElEID0gJy4kc3R5bGVJRC4nPGJyIC8+JzsKICAgICAgICAgICAgJHRoaXMtPnN0eWxlc1skc3R5bGVJRF0gPSAoaXNzZXQoJHRoaXMtPnN0eWxlc1snRGVmYXVsdCddKSkgPyAkdGhpcy0+c3R5bGVzWydEZWZhdWx0J10gOiBhcnJheSgpOwogICAgICAgICAgICBmb3JlYWNoICgkc3R5bGUgYXMgJHN0eWxlVHlwZSA9PiAkc3R5bGVEYXRhKSB7CiAgICAgICAgICAgICAgICAkc3R5bGVBdHRyaWJ1dGVzID0gJHN0eWxlRGF0YS0+YXR0cmlidXRlcygkbmFtZXNwYWNlc1snc3MnXSk7Ci8vICAgICAgICAgICAgICAgIGVjaG8gJHN0eWxlVHlwZS4nPGJyIC8+JzsKICAgICAgICAgICAgICAgIHN3aXRjaCAoJHN0eWxlVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0FsaWdubWVudCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzdHlsZUF0dHJpYnV0ZXMgYXMgJHN0eWxlQXR0cmlidXRlS2V5ID0+ICRzdHlsZUF0dHJpYnV0ZVZhbHVlKSB7Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICRzdHlsZUF0dHJpYnV0ZUtleS4nID0gJy4kc3R5bGVBdHRyaWJ1dGVWYWx1ZS4nPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdHlsZUF0dHJpYnV0ZVZhbHVlID0gKHN0cmluZykgJHN0eWxlQXR0cmlidXRlVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRzdHlsZUF0dHJpYnV0ZUtleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1ZlcnRpY2FsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGY6OmlkZW50aWZ5Rml4ZWRTdHlsZVZhbHVlKCR2ZXJ0aWNhbEFsaWdubWVudFN0eWxlcywgJHN0eWxlQXR0cmlidXRlVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c3R5bGVzWyRzdHlsZUlEXVsnYWxpZ25tZW50J11bJ3ZlcnRpY2FsJ10gPSAkc3R5bGVBdHRyaWJ1dGVWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdIb3Jpem9udGFsJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGY6OmlkZW50aWZ5Rml4ZWRTdHlsZVZhbHVlKCRob3Jpem9udGFsQWxpZ25tZW50U3R5bGVzLCAkc3R5bGVBdHRyaWJ1dGVWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zdHlsZXNbJHN0eWxlSURdWydhbGlnbm1lbnQnXVsnaG9yaXpvbnRhbCddID0gJHN0eWxlQXR0cmlidXRlVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnV3JhcFRleHQnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c3R5bGVzWyRzdHlsZUlEXVsnYWxpZ25tZW50J11bJ3dyYXAnXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0JvcmRlcnMnOgogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3R5bGVEYXRhLT5Cb3JkZXIgYXMgJGJvcmRlclN0eWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYm9yZGVyQXR0cmlidXRlcyA9ICRib3JkZXJTdHlsZS0+YXR0cmlidXRlcygkbmFtZXNwYWNlc1snc3MnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpc0JvcmRlciA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkYm9yZGVyQXR0cmlidXRlcyBhcyAkYm9yZGVyU3R5bGVLZXkgPT4gJGJvcmRlclN0eWxlVmFsdWUpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICRib3JkZXJTdHlsZUtleS4nID0gJy4kYm9yZGVyU3R5bGVWYWx1ZS4nPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRib3JkZXJTdHlsZUtleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdMaW5lU3R5bGUnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNCb3JkZXJbJ3N0eWxlJ10gPSBQSFBFeGNlbF9TdHlsZV9Cb3JkZXI6OkJPUkRFUl9NRURJVU07Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNCb3JkZXJbJ3N0eWxlJ10gPSAkYm9yZGVyU3R5bGVWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdXZWlnaHQnOgovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzQm9yZGVyWydzdHlsZSddID0gJGJvcmRlclN0eWxlVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnUG9zaXRpb24nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJvcmRlclBvc2l0aW9uID0gc3RydG9sb3dlcigkYm9yZGVyU3R5bGVWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnQ29sb3InOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJvcmRlckNvbG91ciA9IHN1YnN0cigkYm9yZGVyU3R5bGVWYWx1ZSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpc0JvcmRlclsnY29sb3InXVsncmdiJ10gPSAkYm9yZGVyQ29sb3VyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkdGhpc0JvcmRlcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRib3JkZXJQb3NpdGlvbiA9PSAnbGVmdCcpIHx8ICgkYm9yZGVyUG9zaXRpb24gPT0gJ3JpZ2h0JykgfHwgKCRib3JkZXJQb3NpdGlvbiA9PSAndG9wJykgfHwgKCRib3JkZXJQb3NpdGlvbiA9PSAnYm90dG9tJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnN0eWxlc1skc3R5bGVJRF1bJ2JvcmRlcnMnXVskYm9yZGVyUG9zaXRpb25dID0gJHRoaXNCb3JkZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0ZvbnQnOgogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3R5bGVBdHRyaWJ1dGVzIGFzICRzdHlsZUF0dHJpYnV0ZUtleSA9PiAkc3R5bGVBdHRyaWJ1dGVWYWx1ZSkgewovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAkc3R5bGVBdHRyaWJ1dGVLZXkuJyA9ICcuJHN0eWxlQXR0cmlidXRlVmFsdWUuJzxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3R5bGVBdHRyaWJ1dGVWYWx1ZSA9IChzdHJpbmcpICRzdHlsZUF0dHJpYnV0ZVZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgkc3R5bGVBdHRyaWJ1dGVLZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdGb250TmFtZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zdHlsZXNbJHN0eWxlSURdWydmb250J11bJ25hbWUnXSA9ICRzdHlsZUF0dHJpYnV0ZVZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdTaXplJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnN0eWxlc1skc3R5bGVJRF1bJ2ZvbnQnXVsnc2l6ZSddID0gJHN0eWxlQXR0cmlidXRlVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0NvbG9yJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnN0eWxlc1skc3R5bGVJRF1bJ2ZvbnQnXVsnY29sb3InXVsncmdiJ10gPSBzdWJzdHIoJHN0eWxlQXR0cmlidXRlVmFsdWUsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdCb2xkJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnN0eWxlc1skc3R5bGVJRF1bJ2ZvbnQnXVsnYm9sZCddID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnSXRhbGljJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnN0eWxlc1skc3R5bGVJRF1bJ2ZvbnQnXVsnaXRhbGljJ10gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdVbmRlcmxpbmUnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZjo6aWRlbnRpZnlGaXhlZFN0eWxlVmFsdWUoJHVuZGVybGluZVN0eWxlcywgJHN0eWxlQXR0cmlidXRlVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c3R5bGVzWyRzdHlsZUlEXVsnZm9udCddWyd1bmRlcmxpbmUnXSA9ICRzdHlsZUF0dHJpYnV0ZVZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0ludGVyaW9yJzoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHN0eWxlQXR0cmlidXRlcyBhcyAkc3R5bGVBdHRyaWJ1dGVLZXkgPT4gJHN0eWxlQXR0cmlidXRlVmFsdWUpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJHN0eWxlQXR0cmlidXRlS2V5LicgPSAnLiRzdHlsZUF0dHJpYnV0ZVZhbHVlLic8YnIgLz4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgkc3R5bGVBdHRyaWJ1dGVLZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdDb2xvcic6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5zdHlsZXNbJHN0eWxlSURdWydmaWxsJ11bJ2NvbG9yJ11bJ3JnYiddID0gc3Vic3RyKCRzdHlsZUF0dHJpYnV0ZVZhbHVlLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTnVtYmVyRm9ybWF0JzoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHN0eWxlQXR0cmlidXRlcyBhcyAkc3R5bGVBdHRyaWJ1dGVLZXkgPT4gJHN0eWxlQXR0cmlidXRlVmFsdWUpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJHN0eWxlQXR0cmlidXRlS2V5LicgPSAnLiRzdHlsZUF0dHJpYnV0ZVZhbHVlLic8YnIgLz4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlQXR0cmlidXRlVmFsdWUgPSBzdHJfcmVwbGFjZSgkZnJvbUZvcm1hdHMsICR0b0Zvcm1hdHMsICRzdHlsZUF0dHJpYnV0ZVZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoJHN0eWxlQXR0cmlidXRlVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdTaG9ydCBEYXRlJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlQXR0cmlidXRlVmFsdWUgPSAnZGQvbW0veXl5eSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzdHlsZUF0dHJpYnV0ZVZhbHVlID4gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c3R5bGVzWyRzdHlsZUlEXVsnbnVtYmVyZm9ybWF0J11bJ2NvZGUnXSA9ICRzdHlsZUF0dHJpYnV0ZVZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ1Byb3RlY3Rpb24nOgogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3R5bGVBdHRyaWJ1dGVzIGFzICRzdHlsZUF0dHJpYnV0ZUtleSA9PiAkc3R5bGVBdHRyaWJ1dGVWYWx1ZSkgewovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAkc3R5bGVBdHRyaWJ1dGVLZXkuJyA9ICcuJHN0eWxlQXR0cmlidXRlVmFsdWUuJzxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KLy8gICAgICAgICAgICBwcmludF9yKCR0aGlzLT5zdHlsZXNbJHN0eWxlSURdKTsKLy8gICAgICAgICAgICBlY2hvICc8aHIgLz4nOwogICAgICAgIH0KLy8gICAgICAgIGVjaG8gJzxociAvPic7CgogICAgICAgICR3b3Jrc2hlZXRJRCA9IDA7CiAgICAgICAgJHhtbF9zcyA9ICR4bWwtPmNoaWxkcmVuKCRuYW1lc3BhY2VzWydzcyddKTsKCiAgICAgICAgZm9yZWFjaCAoJHhtbF9zcy0+V29ya3NoZWV0IGFzICR3b3Jrc2hlZXQpIHsKICAgICAgICAgICAgJHdvcmtzaGVldF9zcyA9ICR3b3Jrc2hlZXQtPmF0dHJpYnV0ZXMoJG5hbWVzcGFjZXNbJ3NzJ10pOwoKICAgICAgICAgICAgaWYgKChpc3NldCgkdGhpcy0+bG9hZFNoZWV0c09ubHkpKSAmJiAoaXNzZXQoJHdvcmtzaGVldF9zc1snTmFtZSddKSkgJiYKICAgICAgICAgICAgICAgICghaW5fYXJyYXkoJHdvcmtzaGVldF9zc1snTmFtZSddLCAkdGhpcy0+bG9hZFNoZWV0c09ubHkpKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCi8vICAgICAgICAgICAgZWNobyAnPGgzPldvcmtzaGVldDogJywgJHdvcmtzaGVldF9zc1snTmFtZSddLCc8aDM+JzsKLy8KICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBXb3Jrc2hlZXQKICAgICAgICAgICAgJG9ialBIUEV4Y2VsLT5jcmVhdGVTaGVldCgpOwogICAgICAgICAgICAkb2JqUEhQRXhjZWwtPnNldEFjdGl2ZVNoZWV0SW5kZXgoJHdvcmtzaGVldElEKTsKICAgICAgICAgICAgaWYgKGlzc2V0KCR3b3Jrc2hlZXRfc3NbJ05hbWUnXSkpIHsKICAgICAgICAgICAgICAgICR3b3Jrc2hlZXROYW1lID0gc2VsZjo6Y29udmVydFN0cmluZ0VuY29kaW5nKChzdHJpbmcpICR3b3Jrc2hlZXRfc3NbJ05hbWUnXSwgJHRoaXMtPmNoYXJTZXQpOwogICAgICAgICAgICAgICAgLy8gICAgVXNlIGZhbHNlIGZvciAkdXBkYXRlRm9ybXVsYUNlbGxSZWZlcmVuY2VzIHRvIHByZXZlbnQgYWRqdXN0bWVudCBvZiB3b3Jrc2hlZXQgcmVmZXJlbmNlcyBpbgogICAgICAgICAgICAgICAgLy8gICAgICAgIGZvcm11bGEgY2VsbHMuLi4gZHVyaW5nIHRoZSBsb2FkLCBhbGwgZm9ybXVsYWUgc2hvdWxkIGJlIGNvcnJlY3QsIGFuZCB3ZSdyZSBzaW1wbHkgYnJpbmdpbmcKICAgICAgICAgICAgICAgIC8vICAgICAgICB0aGUgd29ya3NoZWV0IG5hbWUgaW4gbGluZSB3aXRoIHRoZSBmb3JtdWxhLCBub3QgdGhlIHJldmVyc2UKICAgICAgICAgICAgICAgICRvYmpQSFBFeGNlbC0+Z2V0QWN0aXZlU2hlZXQoKS0+c2V0VGl0bGUoJHdvcmtzaGVldE5hbWUsIGZhbHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGNvbHVtbklEID0gJ0EnOwogICAgICAgICAgICBpZiAoaXNzZXQoJHdvcmtzaGVldC0+VGFibGUtPkNvbHVtbikpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR3b3Jrc2hlZXQtPlRhYmxlLT5Db2x1bW4gYXMgJGNvbHVtbkRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAkY29sdW1uRGF0YV9zcyA9ICRjb2x1bW5EYXRhLT5hdHRyaWJ1dGVzKCRuYW1lc3BhY2VzWydzcyddKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGNvbHVtbkRhdGFfc3NbJ0luZGV4J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5JRCA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkY29sdW1uRGF0YV9zc1snSW5kZXgnXS0xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRjb2x1bW5EYXRhX3NzWydXaWR0aCddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uV2lkdGggPSAkY29sdW1uRGF0YV9zc1snV2lkdGgnXTsKLy8gICAgICAgICAgICAgICAgICAgICAgICBlY2hvICc8Yj5TZXR0aW5nIGNvbHVtbiB3aWR0aCBmb3IgJy4kY29sdW1uSUQuJyB0byAnLiRjb2x1bW5XaWR0aC4nPC9iPjxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmpQSFBFeGNlbC0+Z2V0QWN0aXZlU2hlZXQoKS0+Z2V0Q29sdW1uRGltZW5zaW9uKCRjb2x1bW5JRCktPnNldFdpZHRoKCRjb2x1bW5XaWR0aCAvIDUuNCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICsrJGNvbHVtbklEOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkcm93SUQgPSAxOwogICAgICAgICAgICBpZiAoaXNzZXQoJHdvcmtzaGVldC0+VGFibGUtPlJvdykpIHsKICAgICAgICAgICAgICAgICRhZGRpdGlvbmFsTWVyZ2VkQ2VsbHMgPSAwOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHdvcmtzaGVldC0+VGFibGUtPlJvdyBhcyAkcm93RGF0YSkgewogICAgICAgICAgICAgICAgICAgICRyb3dIYXNEYXRhID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgJHJvd19zcyA9ICRyb3dEYXRhLT5hdHRyaWJ1dGVzKCRuYW1lc3BhY2VzWydzcyddKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJvd19zc1snSW5kZXgnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJvd0lEID0gKGludGVnZXIpICRyb3dfc3NbJ0luZGV4J107CiAgICAgICAgICAgICAgICAgICAgfQovLyAgICAgICAgICAgICAgICAgICAgZWNobyAnPGI+Um93ICcuJHJvd0lELic8L2I+PGJyIC8+JzsKCiAgICAgICAgICAgICAgICAgICAgJGNvbHVtbklEID0gJ0EnOwogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyb3dEYXRhLT5DZWxsIGFzICRjZWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsX3NzID0gJGNlbGwtPmF0dHJpYnV0ZXMoJG5hbWVzcGFjZXNbJ3NzJ10pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGNlbGxfc3NbJ0luZGV4J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uSUQgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJGNlbGxfc3NbJ0luZGV4J10tMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxSYW5nZSA9ICRjb2x1bW5JRC4kcm93SUQ7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmdldFJlYWRGaWx0ZXIoKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+Z2V0UmVhZEZpbHRlcigpLT5yZWFkQ2VsbCgkY29sdW1uSUQsICRyb3dJRCwgJHdvcmtzaGVldE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJGNlbGxfc3NbJ01lcmdlQWNyb3NzJ10pKSB8fCAoaXNzZXQoJGNlbGxfc3NbJ01lcmdlRG93biddKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5UbyA9ICRjb2x1bW5JRDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY2VsbF9zc1snTWVyZ2VBY3Jvc3MnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWRkaXRpb25hbE1lcmdlZENlbGxzICs9IChpbnQpJGNlbGxfc3NbJ01lcmdlQWNyb3NzJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtblRvID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkY29sdW1uSUQpICsgJGNlbGxfc3NbJ01lcmdlQWNyb3NzJ10gLTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvd1RvID0gJHJvd0lEOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRjZWxsX3NzWydNZXJnZURvd24nXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93VG8gPSAkcm93VG8gKyAkY2VsbF9zc1snTWVyZ2VEb3duJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbFJhbmdlIC49ICc6Jy4kY29sdW1uVG8uJHJvd1RvOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialBIUEV4Y2VsLT5nZXRBY3RpdmVTaGVldCgpLT5tZXJnZUNlbGxzKCRjZWxsUmFuZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkY2VsbElzU2V0ID0gJGhhc0NhbGN1bGF0ZWRWYWx1ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAkY2VsbERhdGFGb3JtdWxhID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY2VsbF9zc1snRm9ybXVsYSddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhRm9ybXVsYSA9ICRjZWxsX3NzWydGb3JtdWxhJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGRlZCB0aGlzIGFzIGEgY2hlY2sgZm9yIGFycmF5IGZvcm11bGFzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGNlbGxfc3NbJ0FycmF5UmFuZ2UnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbERhdGFDU0VGb3JtdWxhID0gJGNlbGxfc3NbJ0FycmF5UmFuZ2UnXTsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gImZvdW5kIGFuIGFycmF5IGZvcm11bGEgYXQgIi4kY29sdW1uSUQuJHJvd0lELiI8YnIgLz4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhhc0NhbGN1bGF0ZWRWYWx1ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRjZWxsLT5EYXRhKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxWYWx1ZSA9ICRjZWxsRGF0YSA9ICRjZWxsLT5EYXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTEw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbERhdGFfc3MgPSAkY2VsbERhdGEtPmF0dHJpYnV0ZXMoJG5hbWVzcGFjZXNbJ3NzJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRjZWxsRGF0YV9zc1snVHlwZSddKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YVR5cGUgPSAkY2VsbERhdGFfc3NbJ1R5cGUnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRjZWxsRGF0YVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgVFlQRV9TVFJJTkcgICAgICAgID0gJ3MnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBUWVBFX0ZPUk1VTEEgICAgICAgID0gJ2YnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBUWVBFX05VTUVSSUMgICAgICAgID0gJ24nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBUWVBFX0JPT0wgICAgICAgICAgICA9ICdiJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgVFlQRV9OVUxMICAgICAgICAgICAgPSAnbnVsbCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFRZUEVfSU5MSU5FICAgICAgICA9ICdpbmxpbmVTdHInOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBUWVBFX0VSUk9SICAgICAgICA9ICdlJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnU3RyaW5nJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsVmFsdWUgPSBzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJGNlbGxWYWx1ZSwgJHRoaXMtPmNoYXJTZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX1NUUklORzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdOdW1iZXInOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTUVSSUM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbFZhbHVlID0gKGZsb2F0KSAkY2VsbFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZsb29yKCRjZWxsVmFsdWUpID09ICRjZWxsVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2VsbFZhbHVlID0gKGludGVnZXIpICRjZWxsVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnQm9vbGVhbic6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfQk9PTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsVmFsdWUgPSAoJGNlbGxWYWx1ZSAhPSAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdEYXRlVGltZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSA9IFBIUEV4Y2VsX0NlbGxfRGF0YVR5cGU6OlRZUEVfTlVNRVJJQzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsVmFsdWUgPSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6UEhQVG9FeGNlbChzdHJ0b3RpbWUoJGNlbGxWYWx1ZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ0Vycm9yJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0eXBlID0gUEhQRXhjZWxfQ2VsbF9EYXRhVHlwZTo6VFlQRV9FUlJPUjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGhhc0NhbGN1bGF0ZWRWYWx1ZSkgewovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnRk9STVVMQTxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX0ZPUk1VTEE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbk51bWJlciA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkY29sdW1uSUQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGNlbGxEYXRhRm9ybXVsYSwgMCwgMykgPT0gJ29mOicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxEYXRhRm9ybXVsYSA9IHN1YnN0cigkY2VsbERhdGFGb3JtdWxhLCAzKTsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdCZWZvcmU6ICcsICRjZWxsRGF0YUZvcm11bGEsJzxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0ZW1wID0gZXhwbG9kZSgnIicsICRjZWxsRGF0YUZvcm11bGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAka2V5ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR0ZW1wIGFzICYkdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIE9ubHkgcmVwbGFjZSBpbiBhbHRlcm5hdGUgYXJyYXkgZW50cmllcyAoaS5lLiBub24tcXVvdGVkIGJsb2NrcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgka2V5ID0gISRrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdmFsdWUgPSBzdHJfcmVwbGFjZShhcnJheSgnWy4nLCAnLicsICddJyksICcnLCAkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgQ29udmVydCBSMUMxIHN0eWxlIHJlZmVyZW5jZXMgdG8gQTEgc3R5bGUgcmVmZXJlbmNlcyAoYnV0IG9ubHkgd2hlbiBub3QgcXVvdGVkKQovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJ0JlZm9yZTogJywgJGNlbGxEYXRhRm9ybXVsYSwnPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRlbXAgPSBleHBsb2RlKCciJywgJGNlbGxEYXRhRm9ybXVsYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRrZXkgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRlbXAgYXMgJiR2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgT25seSByZXBsYWNlIGluIGFsdGVybmF0ZSBhcnJheSBlbnRyaWVzIChpLmUuIG5vbi1xdW90ZWQgYmxvY2tzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRrZXkgPSAhJGtleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWdfbWF0Y2hfYWxsKCcvKFIoXFs\/LT9cZCpcXT8pKShDKFxbPy0\/XGQqXF0\/KSkvJywgJHZhbHVlLCAkY2VsbFJlZmVyZW5jZXMsIFBSRUdfU0VUX09SREVSICsgUFJFR19PRkZTRVRfQ0FQVFVSRSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgUmV2ZXJzZSB0aGUgbWF0Y2hlcyBhcnJheSwgb3RoZXJ3aXNlIGFsbCBvdXIgb2Zmc2V0cyB3aWxsIGJlY29tZSBpbmNvcnJlY3QgaWYgd2UgbW9kaWZ5IG91ciB3YXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgdGhyb3VnaCB0aGUgZm9ybXVsYSBmcm9tIGxlZnQgdG8gcmlnaHQuIFJldmVyc2luZyBtZWFucyB0aGF0IHdlIHdvcmsgcmlnaHQgdG8gbGVmdC50aHJvdWdoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHRoZSBmb3JtdWxhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGxSZWZlcmVuY2VzID0gYXJyYXlfcmV2ZXJzZSgkY2VsbFJlZmVyZW5jZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIExvb3AgdGhyb3VnaCBlYWNoIFIxQzEgc3R5bGUgcmVmZXJlbmNlIGluIHR1cm4sIGNvbnZlcnRpbmcgaXQgdG8gaXRzIEExIHN0eWxlIGVxdWl2YWxlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHRoZW4gbW9kaWZ5IHRoZSBmb3JtdWxhIHRvIHVzZSB0aGF0IG5ldyByZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkY2VsbFJlZmVyZW5jZXMgYXMgJGNlbGxSZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvd1JlZmVyZW5jZSA9ICRjZWxsUmVmZXJlbmNlWzJdWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBFbXB0eSBSIHJlZmVyZW5jZSBpcyB0aGUgY3VycmVudCByb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRyb3dSZWZlcmVuY2UgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb3dSZWZlcmVuY2UgPSAkcm93SUQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgQnJhY2tldGVkIFIgcmVmZXJlbmNlcyBhcmUgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcm93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcm93UmVmZXJlbmNlezB9ID09ICdbJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvd1JlZmVyZW5jZSA9ICRyb3dJRCArIHRyaW0oJHJvd1JlZmVyZW5jZSwgJ1tdJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtblJlZmVyZW5jZSA9ICRjZWxsUmVmZXJlbmNlWzRdWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBFbXB0eSBDIHJlZmVyZW5jZSBpcyB0aGUgY3VycmVudCBjb2x1bW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRjb2x1bW5SZWZlcmVuY2UgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5SZWZlcmVuY2UgPSAkY29sdW1uTnVtYmVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIEJyYWNrZXRlZCBDIHJlZmVyZW5jZXMgYXJlIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IGNvbHVtbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbHVtblJlZmVyZW5jZXswfSA9PSAnWycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5SZWZlcmVuY2UgPSAkY29sdW1uTnVtYmVyICsgdHJpbSgkY29sdW1uUmVmZXJlbmNlLCAnW10nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQTFDZWxsUmVmZXJlbmNlID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjb2x1bW5SZWZlcmVuY2UtMSkuJHJvd1JlZmVyZW5jZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZhbHVlID0gc3Vic3RyX3JlcGxhY2UoJHZhbHVlLCAkQTFDZWxsUmVmZXJlbmNlLCAkY2VsbFJlZmVyZW5jZVswXVsxXSwgc3RybGVuKCRjZWxsUmVmZXJlbmNlWzBdWzBdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCR2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgVGhlbiByZWJ1aWxkIHRoZSBmb3JtdWxhIHN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsRGF0YUZvcm11bGEgPSBpbXBsb2RlKCciJywgJHRlbXApOwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnQWZ0ZXI6ICcsICRjZWxsRGF0YUZvcm11bGEsJzxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdDZWxsICcuJGNvbHVtbklELiRyb3dJRC4nIGlzIGEgJy4kdHlwZS4nIHdpdGggYSB2YWx1ZSBvZiAnLigoJGhhc0NhbGN1bGF0ZWRWYWx1ZSkgPyAkY2VsbERhdGFGb3JtdWxhIDogJGNlbGxWYWx1ZSkuJzxiciAvPic7Ci8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqUEhQRXhjZWwtPmdldEFjdGl2ZVNoZWV0KCktPmdldENlbGwoJGNvbHVtbklELiRyb3dJRCktPnNldFZhbHVlRXhwbGljaXQoKCgkaGFzQ2FsY3VsYXRlZFZhbHVlKSA\/ICRjZWxsRGF0YUZvcm11bGEgOiAkY2VsbFZhbHVlKSwgJHR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRoYXNDYWxjdWxhdGVkVmFsdWUpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJ0Zvcm11bGEgcmVzdWx0IGlzICcuJGNlbGxWYWx1ZS4nPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqUEhQRXhjZWwtPmdldEFjdGl2ZVNoZWV0KCktPmdldENlbGwoJGNvbHVtbklELiRyb3dJRCktPnNldENhbGN1bGF0ZWRWYWx1ZSgkY2VsbFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsSXNTZXQgPSAkcm93SGFzRGF0YSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY2VsbC0+Q29tbWVudCkpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnPGI+Y29tbWVudCBmb3VuZDwvYj48YnIgLz4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbW1lbnRBdHRyaWJ1dGVzID0gJGNlbGwtPkNvbW1lbnQtPmF0dHJpYnV0ZXMoJG5hbWVzcGFjZXNbJ3NzJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF1dGhvciA9ICd1bmtub3duJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkY29tbWVudEF0dHJpYnV0ZXMtPkF1dGhvcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXV0aG9yID0gKHN0cmluZykkY29tbWVudEF0dHJpYnV0ZXMtPkF1dGhvcjsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJ0F1dGhvcjogJywgJGF1dGhvciwnPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRub2RlID0gJGNlbGwtPkNvbW1lbnQtPkRhdGEtPmFzWE1MKCk7Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhbm5vdGF0aW9uID0gc3RyX3JlcGxhY2UoJ2h0bWw6JywnJyxzdWJzdHIoJG5vZGUsNDksLTEwKSk7Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJGFubm90YXRpb24sJzxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYW5ub3RhdGlvbiA9IHN0cmlwX3RhZ3MoJG5vZGUpOwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBlY2hvICdBbm5vdGF0aW9uOiAnLCAkYW5ub3RhdGlvbiwnPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvYmpQSFBFeGNlbC0+Z2V0QWN0aXZlU2hlZXQoKS0+Z2V0Q29tbWVudCgkY29sdW1uSUQuJHJvd0lEKS0+c2V0QXV0aG9yKHNlbGY6OmNvbnZlcnRTdHJpbmdFbmNvZGluZygkYXV0aG9yLCAkdGhpcy0+Y2hhclNldCkpLT5zZXRUZXh0KCR0aGlzLT5wYXJzZVJpY2hUZXh0KCRhbm5vdGF0aW9uKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJGNlbGxJc1NldCkgJiYgKGlzc2V0KCRjZWxsX3NzWydTdHlsZUlEJ10pKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlID0gKHN0cmluZykgJGNlbGxfc3NbJ1N0eWxlSUQnXTsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnQ2VsbCBzdHlsZSBmb3IgJy4kY29sdW1uSUQuJHJvd0lELicgaXMgJy4kc3R5bGUuJzxiciAvPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlzc2V0KCR0aGlzLT5zdHlsZXNbJHN0eWxlXSkpICYmICghZW1wdHkoJHRoaXMtPnN0eWxlc1skc3R5bGVdKSkpIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJ0NlbGwgJy4kY29sdW1uSUQuJHJvd0lELic8YnIgLz4nOwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRfcigkdGhpcy0+c3R5bGVzWyRzdHlsZV0pOwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNobyAnPGJyIC8+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISRvYmpQSFBFeGNlbC0+Z2V0QWN0aXZlU2hlZXQoKS0+Y2VsbEV4aXN0cygkY29sdW1uSUQuJHJvd0lEKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqUEhQRXhjZWwtPmdldEFjdGl2ZVNoZWV0KCktPmdldENlbGwoJGNvbHVtbklELiRyb3dJRCktPnNldFZhbHVlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb2JqUEhQRXhjZWwtPmdldEFjdGl2ZVNoZWV0KCktPmdldFN0eWxlKCRjZWxsUmFuZ2UpLT5hcHBseUZyb21BcnJheSgkdGhpcy0+c3R5bGVzWyRzdHlsZV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICsrJGNvbHVtbklEOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoJGFkZGl0aW9uYWxNZXJnZWRDZWxscyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrJGNvbHVtbklEOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFkZGl0aW9uYWxNZXJnZWRDZWxscy0tOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoJHJvd0hhc0RhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyb3dfc3NbJ1N0eWxlSUQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb3dTdHlsZSA9ICRyb3dfc3NbJ1N0eWxlSUQnXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHJvd19zc1snSGVpZ2h0J10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm93SGVpZ2h0ID0gJHJvd19zc1snSGVpZ2h0J107Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVjaG8gJzxiPlNldHRpbmcgcm93IGhlaWdodCB0byAnLiRyb3dIZWlnaHQuJzwvYj48YnIgLz4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9ialBIUEV4Y2VsLT5nZXRBY3RpdmVTaGVldCgpLT5nZXRSb3dEaW1lbnNpb24oJHJvd0lEKS0+c2V0Um93SGVpZ2h0KCRyb3dIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICArKyRyb3dJRDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICArKyR3b3Jrc2hlZXRJRDsKICAgICAgICB9CgogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiAkb2JqUEhQRXhjZWw7CiAgICB9CgoKICAgIHByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gY29udmVydFN0cmluZ0VuY29kaW5nKCRzdHJpbmcsICRjaGFyc2V0KQogICAgewogICAgICAgIGlmICgkY2hhcnNldCAhPSAnVVRGLTgnKSB7CiAgICAgICAgICAgIHJldHVybiBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb252ZXJ0RW5jb2RpbmcoJHN0cmluZywgJ1VURi04JywgJGNoYXJzZXQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHN0cmluZzsKICAgIH0KCgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHBhcnNlUmljaFRleHQoJGlzID0gJycpCiAgICB7CiAgICAgICAgJHZhbHVlID0gbmV3IFBIUEV4Y2VsX1JpY2hUZXh0KCk7CgogICAgICAgICR2YWx1ZS0+Y3JlYXRlVGV4dChzZWxmOjpjb252ZXJ0U3RyaW5nRW5jb2RpbmcoJGlzLCAkdGhpcy0+Y2hhclNldCkpOwoKICAgICAgICByZXR1cm4gJHZhbHVlOwogICAgfQp9Cg==",
    "size": "38896"
}