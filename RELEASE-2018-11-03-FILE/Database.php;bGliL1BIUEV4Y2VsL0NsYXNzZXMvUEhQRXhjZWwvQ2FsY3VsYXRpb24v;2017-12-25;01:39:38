{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Calculation\/Database.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgLyoqCiAgICAgKiBAaWdub3JlCiAgICAgKi8KICAgIGRlZmluZSgnUEhQRVhDRUxfUk9PVCcsIGRpcm5hbWUoX19GSUxFX18pIC4gJy8uLi8uLi8nKTsKICAgIHJlcXVpcmUoUEhQRVhDRUxfUk9PVCAuICdQSFBFeGNlbC9BdXRvbG9hZGVyLnBocCcpOwp9CgovKioKICogUEhQRXhjZWxfQ2FsY3VsYXRpb25fRGF0YWJhc2UKICoKICogQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbAogKgogKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCiAqIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxIFVTQQogKgogKiBAY2F0ZWdvcnkgICAgUEhQRXhjZWwKICogQHBhY2thZ2UgICAgICAgIFBIUEV4Y2VsX0NhbGN1bGF0aW9uCiAqIEBjb3B5cmlnaHQgICAgQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbCAoaHR0cDovL3d3dy5jb2RlcGxleC5jb20vUEhQRXhjZWwpCiAqIEBsaWNlbnNlICAgICAgICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvb2xkLWxpY2Vuc2VzL2xncGwtMi4xLnR4dCAgICBMR1BMCiAqIEB2ZXJzaW9uICAgICAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCmNsYXNzIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0RhdGFiYXNlCnsKICAgIC8qKgogICAgICogZmllbGRFeHRyYWN0CiAgICAgKgogICAgICogRXh0cmFjdHMgdGhlIGNvbHVtbiBJRCB0byB1c2UgZm9yIHRoZSBkYXRhIGZpZWxkLgogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHJpdmF0ZQogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICRkYXRhYmFzZSAgICAgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgbWFrZXMgdXAgdGhlIGxpc3Qgb3IgZGF0YWJhc2UuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIGRhdGFiYXNlIGlzIGEgbGlzdCBvZiByZWxhdGVkIGRhdGEgaW4gd2hpY2ggcm93cyBvZiByZWxhdGVkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvcm1hdGlvbiBhcmUgcmVjb3JkcywgYW5kIGNvbHVtbnMgb2YgZGF0YSBhcmUgZmllbGRzLiBUaGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0IHJvdyBvZiB0aGUgbGlzdCBjb250YWlucyBsYWJlbHMgZm9yIGVhY2ggY29sdW1uLgogICAgICogQHBhcmFtICAgIG1peGVkICAgICAgICAkZmllbGQgICAgICAgICAgICBJbmRpY2F0ZXMgd2hpY2ggY29sdW1uIGlzIHVzZWQgaW4gdGhlIGZ1bmN0aW9uLiBFbnRlciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbiBsYWJlbCBlbmNsb3NlZCBiZXR3ZWVuIGRvdWJsZSBxdW90YXRpb24gbWFya3MsIHN1Y2ggYXMKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBZ2UiIG9yICJZaWVsZCwiIG9yIGEgbnVtYmVyICh3aXRob3V0IHF1b3RhdGlvbiBtYXJrcykgdGhhdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwcmVzZW50cyB0aGUgcG9zaXRpb24gb2YgdGhlIGNvbHVtbiB3aXRoaW4gdGhlIGxpc3Q6IDEgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgZmlyc3QgY29sdW1uLCAyIGZvciB0aGUgc2Vjb25kIGNvbHVtbiwgYW5kIHNvIG9uLgogICAgICogQHJldHVybiAgICBzdHJpbmd8TlVMTAogICAgICoKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gZmllbGRFeHRyYWN0KCRkYXRhYmFzZSwgJGZpZWxkKQogICAgewogICAgICAgICRmaWVsZCA9IHN0cnRvdXBwZXIoUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpmbGF0dGVuU2luZ2xlVmFsdWUoJGZpZWxkKSk7CiAgICAgICAgJGZpZWxkTmFtZXMgPSBhcnJheV9tYXAoJ3N0cnRvdXBwZXInLCBhcnJheV9zaGlmdCgkZGF0YWJhc2UpKTsKCiAgICAgICAgaWYgKGlzX251bWVyaWMoJGZpZWxkKSkgewogICAgICAgICAgICAka2V5cyA9IGFycmF5X2tleXMoJGZpZWxkTmFtZXMpOwogICAgICAgICAgICByZXR1cm4gJGtleXNbJGZpZWxkLTFdOwogICAgICAgIH0KICAgICAgICAka2V5ID0gYXJyYXlfc2VhcmNoKCRmaWVsZCwgJGZpZWxkTmFtZXMpOwogICAgICAgIHJldHVybiAoJGtleSkgPyAka2V5IDogbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIGZpbHRlcgogICAgICoKICAgICAqIFBhcnNlcyB0aGUgc2VsZWN0aW9uIGNyaXRlcmlhLCBleHRyYWN0cyB0aGUgZGF0YWJhc2Ugcm93cyB0aGF0IG1hdGNoIHRob3NlIGNyaXRlcmlhLCBhbmQKICAgICAqIHJldHVybnMgdGhhdCBzdWJzZXQgb2Ygcm93cy4KICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHByaXZhdGUKICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAkZGF0YWJhc2UgICAgICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IG1ha2VzIHVwIHRoZSBsaXN0IG9yIGRhdGFiYXNlLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSBkYXRhYmFzZSBpcyBhIGxpc3Qgb2YgcmVsYXRlZCBkYXRhIGluIHdoaWNoIHJvd3Mgb2YgcmVsYXRlZAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb3JtYXRpb24gYXJlIHJlY29yZHMsIGFuZCBjb2x1bW5zIG9mIGRhdGEgYXJlIGZpZWxkcy4gVGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCByb3cgb2YgdGhlIGxpc3QgY29udGFpbnMgbGFiZWxzIGZvciBlYWNoIGNvbHVtbi4KICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAkY3JpdGVyaWEgICAgICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IGNvbnRhaW5zIHRoZSBjb25kaXRpb25zIHlvdSBzcGVjaWZ5LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91IGNhbiB1c2UgYW55IHJhbmdlIGZvciB0aGUgY3JpdGVyaWEgYXJndW1lbnQsIGFzIGxvbmcgYXMgaXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVzIGF0IGxlYXN0IG9uZSBjb2x1bW4gbGFiZWwgYW5kIGF0IGxlYXN0IG9uZSBjZWxsIGJlbG93CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY29sdW1uIGxhYmVsIGluIHdoaWNoIHlvdSBzcGVjaWZ5IGEgY29uZGl0aW9uIGZvciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi4KICAgICAqIEByZXR1cm4gICAgYXJyYXkgb2YgbWl4ZWQKICAgICAqCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGZ1bmN0aW9uIGZpbHRlcigkZGF0YWJhc2UsICRjcml0ZXJpYSkKICAgIHsKICAgICAgICAkZmllbGROYW1lcyA9IGFycmF5X3NoaWZ0KCRkYXRhYmFzZSk7CiAgICAgICAgJGNyaXRlcmlhTmFtZXMgPSBhcnJheV9zaGlmdCgkY3JpdGVyaWEpOwoKICAgICAgICAvLyAgICBDb252ZXJ0IHRoZSBjcml0ZXJpYSBpbnRvIGEgc2V0IG9mIEFORC9PUiBjb25kaXRpb25zIHdpdGggWzpwbGFjZWhvbGRlcnNdCiAgICAgICAgJHRlc3RDb25kaXRpb25zID0gJHRlc3RWYWx1ZXMgPSBhcnJheSgpOwogICAgICAgICR0ZXN0Q29uZGl0aW9uc0NvdW50ID0gMDsKICAgICAgICBmb3JlYWNoICgkY3JpdGVyaWFOYW1lcyBhcyAka2V5ID0+ICRjcml0ZXJpYU5hbWUpIHsKICAgICAgICAgICAgJHRlc3RDb25kaXRpb24gPSBhcnJheSgpOwogICAgICAgICAgICAkdGVzdENvbmRpdGlvbkNvdW50ID0gMDsKICAgICAgICAgICAgZm9yZWFjaCAoJGNyaXRlcmlhIGFzICRyb3cgPT4gJGNyaXRlcmlvbikgewogICAgICAgICAgICAgICAgaWYgKCRjcml0ZXJpb25bJGtleV0gPiAnJykgewogICAgICAgICAgICAgICAgICAgICR0ZXN0Q29uZGl0aW9uW10gPSAnWzonLiRjcml0ZXJpYU5hbWUuJ10nLlBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6aWZDb25kaXRpb24oJGNyaXRlcmlvblska2V5XSk7CiAgICAgICAgICAgICAgICAgICAgJHRlc3RDb25kaXRpb25Db3VudCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkdGVzdENvbmRpdGlvbkNvdW50ID4gMSkgewogICAgICAgICAgICAgICAgJHRlc3RDb25kaXRpb25zW10gPSAnT1IoJyAuIGltcGxvZGUoJywnLCAkdGVzdENvbmRpdGlvbikgLiAnKSc7CiAgICAgICAgICAgICAgICAkdGVzdENvbmRpdGlvbnNDb3VudCsrOwogICAgICAgICAgICB9IGVsc2VpZiAoJHRlc3RDb25kaXRpb25Db3VudCA9PSAxKSB7CiAgICAgICAgICAgICAgICAkdGVzdENvbmRpdGlvbnNbXSA9ICR0ZXN0Q29uZGl0aW9uWzBdOwogICAgICAgICAgICAgICAgJHRlc3RDb25kaXRpb25zQ291bnQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCR0ZXN0Q29uZGl0aW9uc0NvdW50ID4gMSkgewogICAgICAgICAgICAkdGVzdENvbmRpdGlvblNldCA9ICdBTkQoJyAuIGltcGxvZGUoJywnLCAkdGVzdENvbmRpdGlvbnMpIC4gJyknOwogICAgICAgIH0gZWxzZWlmICgkdGVzdENvbmRpdGlvbnNDb3VudCA9PSAxKSB7CiAgICAgICAgICAgICR0ZXN0Q29uZGl0aW9uU2V0ID0gJHRlc3RDb25kaXRpb25zWzBdOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgTG9vcCB0aHJvdWdoIGVhY2ggcm93IG9mIHRoZSBkYXRhYmFzZQogICAgICAgIGZvcmVhY2ggKCRkYXRhYmFzZSBhcyAkZGF0YVJvdyA9PiAkZGF0YVZhbHVlcykgewogICAgICAgICAgICAvLyAgICBTdWJzdGl0dXRlIGFjdHVhbCB2YWx1ZXMgZnJvbSB0aGUgZGF0YWJhc2Ugcm93IGZvciBvdXIgWzpwbGFjZWhvbGRlcnNdCiAgICAgICAgICAgICR0ZXN0Q29uZGl0aW9uTGlzdCA9ICR0ZXN0Q29uZGl0aW9uU2V0OwogICAgICAgICAgICBmb3JlYWNoICgkY3JpdGVyaWFOYW1lcyBhcyAka2V5ID0+ICRjcml0ZXJpYU5hbWUpIHsKICAgICAgICAgICAgICAgICRrID0gYXJyYXlfc2VhcmNoKCRjcml0ZXJpYU5hbWUsICRmaWVsZE5hbWVzKTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZGF0YVZhbHVlc1ska10pKSB7CiAgICAgICAgICAgICAgICAgICAgJGRhdGFWYWx1ZSA9ICRkYXRhVmFsdWVzWyRrXTsKICAgICAgICAgICAgICAgICAgICAkZGF0YVZhbHVlID0gKGlzX3N0cmluZygkZGF0YVZhbHVlKSkgPyBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6d3JhcFJlc3VsdChzdHJ0b3VwcGVyKCRkYXRhVmFsdWUpKSA6ICRkYXRhVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgJHRlc3RDb25kaXRpb25MaXN0ID0gc3RyX3JlcGxhY2UoJ1s6JyAuICRjcml0ZXJpYU5hbWUgLiAnXScsICRkYXRhVmFsdWUsICR0ZXN0Q29uZGl0aW9uTGlzdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gICAgZXZhbHVhdGUgdGhlIGNyaXRlcmlhIGFnYWluc3QgdGhlIHJvdyBkYXRhCiAgICAgICAgICAgICRyZXN1bHQgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6Z2V0SW5zdGFuY2UoKS0+X2NhbGN1bGF0ZUZvcm11bGFWYWx1ZSgnPScuJHRlc3RDb25kaXRpb25MaXN0KTsKICAgICAgICAgICAgLy8gICAgSWYgdGhlIHJvdyBmYWlsZWQgdG8gbWVldCB0aGUgY3JpdGVyaWEsIHJlbW92ZSBpdCBmcm9tIHRoZSBkYXRhYmFzZQogICAgICAgICAgICBpZiAoISRyZXN1bHQpIHsKICAgICAgICAgICAgICAgIHVuc2V0KCRkYXRhYmFzZVskZGF0YVJvd10pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGRhdGFiYXNlOwogICAgfQoKCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBnZXRGaWx0ZXJlZENvbHVtbigkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKQogICAgewogICAgICAgIC8vICAgIHJlZHVjZSB0aGUgZGF0YWJhc2UgdG8gYSBzZXQgb2Ygcm93cyB0aGF0IG1hdGNoIGFsbCB0aGUgY3JpdGVyaWEKICAgICAgICAkZGF0YWJhc2UgPSBzZWxmOjpmaWx0ZXIoJGRhdGFiYXNlLCAkY3JpdGVyaWEpOwogICAgICAgIC8vICAgIGV4dHJhY3QgYW4gYXJyYXkgb2YgdmFsdWVzIGZvciB0aGUgcmVxdWVzdGVkIGNvbHVtbgogICAgICAgICRjb2xEYXRhID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkZGF0YWJhc2UgYXMgJHJvdykgewogICAgICAgICAgICAkY29sRGF0YVtdID0gJHJvd1skZmllbGRdOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gJGNvbERhdGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBEQVZFUkFHRQogICAgICoKICAgICAqIEF2ZXJhZ2VzIHRoZSB2YWx1ZXMgaW4gYSBjb2x1bW4gb2YgYSBsaXN0IG9yIGRhdGFiYXNlIHRoYXQgbWF0Y2ggY29uZGl0aW9ucyB5b3Ugc3BlY2lmeS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBEQVZFUkFHRShkYXRhYmFzZSxmaWVsZCxjcml0ZXJpYSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGFiYXNlIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkZGF0YWJhc2UgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgbWFrZXMgdXAgdGhlIGxpc3Qgb3IgZGF0YWJhc2UuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIGRhdGFiYXNlIGlzIGEgbGlzdCBvZiByZWxhdGVkIGRhdGEgaW4gd2hpY2ggcm93cyBvZiByZWxhdGVkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvcm1hdGlvbiBhcmUgcmVjb3JkcywgYW5kIGNvbHVtbnMgb2YgZGF0YSBhcmUgZmllbGRzLiBUaGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0IHJvdyBvZiB0aGUgbGlzdCBjb250YWlucyBsYWJlbHMgZm9yIGVhY2ggY29sdW1uLgogICAgICogQHBhcmFtICAgIHN0cmluZ3xpbnRlZ2VyICAgICRmaWVsZCAgICAgICAgSW5kaWNhdGVzIHdoaWNoIGNvbHVtbiBpcyB1c2VkIGluIHRoZSBmdW5jdGlvbi4gRW50ZXIgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4gbGFiZWwgZW5jbG9zZWQgYmV0d2VlbiBkb3VibGUgcXVvdGF0aW9uIG1hcmtzLCBzdWNoIGFzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWdlIiBvciAiWWllbGQsIiBvciBhIG51bWJlciAod2l0aG91dCBxdW90YXRpb24gbWFya3MpIHRoYXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcHJlc2VudHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBjb2x1bW4gd2l0aGluIHRoZSBsaXN0OiAxIGZvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGZpcnN0IGNvbHVtbiwgMiBmb3IgdGhlIHNlY29uZCBjb2x1bW4sIGFuZCBzbyBvbi4KICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGNyaXRlcmlhICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IGNvbnRhaW5zIHRoZSBjb25kaXRpb25zIHlvdSBzcGVjaWZ5LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91IGNhbiB1c2UgYW55IHJhbmdlIGZvciB0aGUgY3JpdGVyaWEgYXJndW1lbnQsIGFzIGxvbmcgYXMgaXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVzIGF0IGxlYXN0IG9uZSBjb2x1bW4gbGFiZWwgYW5kIGF0IGxlYXN0IG9uZSBjZWxsIGJlbG93CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY29sdW1uIGxhYmVsIGluIHdoaWNoIHlvdSBzcGVjaWZ5IGEgY29uZGl0aW9uIGZvciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi4KICAgICAqIEByZXR1cm4gICAgZmxvYXQKICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gREFWRVJBR0UoJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgIHsKICAgICAgICAkZmllbGQgPSBzZWxmOjpmaWVsZEV4dHJhY3QoJGRhdGFiYXNlLCAkZmllbGQpOwogICAgICAgIGlmIChpc19udWxsKCRmaWVsZCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fU3RhdGlzdGljYWw6OkFWRVJBR0UoCiAgICAgICAgICAgIHNlbGY6OmdldEZpbHRlcmVkQ29sdW1uKCRkYXRhYmFzZSwgJGZpZWxkLCAkY3JpdGVyaWEpCiAgICAgICAgKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBEQ09VTlQKICAgICAqCiAgICAgKiBDb3VudHMgdGhlIGNlbGxzIHRoYXQgY29udGFpbiBudW1iZXJzIGluIGEgY29sdW1uIG9mIGEgbGlzdCBvciBkYXRhYmFzZSB0aGF0IG1hdGNoIGNvbmRpdGlvbnMKICAgICAqIHRoYXQgeW91IHNwZWNpZnkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgRENPVU5UKGRhdGFiYXNlLFtmaWVsZF0sY3JpdGVyaWEpCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgREFWRVJBR0UoZGF0YWJhc2UsZmllbGQsY3JpdGVyaWEpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRhYmFzZSBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGRhdGFiYXNlICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IG1ha2VzIHVwIHRoZSBsaXN0IG9yIGRhdGFiYXNlLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSBkYXRhYmFzZSBpcyBhIGxpc3Qgb2YgcmVsYXRlZCBkYXRhIGluIHdoaWNoIHJvd3Mgb2YgcmVsYXRlZAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb3JtYXRpb24gYXJlIHJlY29yZHMsIGFuZCBjb2x1bW5zIG9mIGRhdGEgYXJlIGZpZWxkcy4gVGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCByb3cgb2YgdGhlIGxpc3QgY29udGFpbnMgbGFiZWxzIGZvciBlYWNoIGNvbHVtbi4KICAgICAqIEBwYXJhbSAgICBzdHJpbmd8aW50ZWdlciAgICAkZmllbGQgICAgICAgIEluZGljYXRlcyB3aGljaCBjb2x1bW4gaXMgdXNlZCBpbiB0aGUgZnVuY3Rpb24uIEVudGVyIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uIGxhYmVsIGVuY2xvc2VkIGJldHdlZW4gZG91YmxlIHF1b3RhdGlvbiBtYXJrcywgc3VjaCBhcwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFnZSIgb3IgIllpZWxkLCIgb3IgYSBudW1iZXIgKHdpdGhvdXQgcXVvdGF0aW9uIG1hcmtzKSB0aGF0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXByZXNlbnRzIHRoZSBwb3NpdGlvbiBvZiB0aGUgY29sdW1uIHdpdGhpbiB0aGUgbGlzdDogMSBmb3IKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaXJzdCBjb2x1bW4sIDIgZm9yIHRoZSBzZWNvbmQgY29sdW1uLCBhbmQgc28gb24uCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgICAgICRjcml0ZXJpYSAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgdGhhdCBjb250YWlucyB0aGUgY29uZGl0aW9ucyB5b3Ugc3BlY2lmeS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFlvdSBjYW4gdXNlIGFueSByYW5nZSBmb3IgdGhlIGNyaXRlcmlhIGFyZ3VtZW50LCBhcyBsb25nIGFzIGl0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlcyBhdCBsZWFzdCBvbmUgY29sdW1uIGxhYmVsIGFuZCBhdCBsZWFzdCBvbmUgY2VsbCBiZWxvdwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbHVtbiBsYWJlbCBpbiB3aGljaCB5b3Ugc3BlY2lmeSBhIGNvbmRpdGlvbiBmb3IgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4uCiAgICAgKiBAcmV0dXJuICAgIGludGVnZXIKICAgICAqCiAgICAgKiBAVE9ETyAgICBUaGUgZmllbGQgYXJndW1lbnQgaXMgb3B0aW9uYWwuIElmIGZpZWxkIGlzIG9taXR0ZWQsIERDT1VOVCBjb3VudHMgYWxsIHJlY29yZHMgaW4gdGhlCiAgICAgKiAgICAgICAgICAgIGRhdGFiYXNlIHRoYXQgbWF0Y2ggdGhlIGNyaXRlcmlhLgogICAgICoKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEQ09VTlQoJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgIHsKICAgICAgICAkZmllbGQgPSBzZWxmOjpmaWVsZEV4dHJhY3QoJGRhdGFiYXNlLCAkZmllbGQpOwogICAgICAgIGlmIChpc19udWxsKCRmaWVsZCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fU3RhdGlzdGljYWw6OkNPVU5UKAogICAgICAgICAgICBzZWxmOjpnZXRGaWx0ZXJlZENvbHVtbigkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKQogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogRENPVU5UQQogICAgICoKICAgICAqIENvdW50cyB0aGUgbm9uYmxhbmsgY2VsbHMgaW4gYSBjb2x1bW4gb2YgYSBsaXN0IG9yIGRhdGFiYXNlIHRoYXQgbWF0Y2ggY29uZGl0aW9ucyB0aGF0IHlvdSBzcGVjaWZ5LgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIERDT1VOVEEoZGF0YWJhc2UsW2ZpZWxkXSxjcml0ZXJpYSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGFiYXNlIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkZGF0YWJhc2UgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgbWFrZXMgdXAgdGhlIGxpc3Qgb3IgZGF0YWJhc2UuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIGRhdGFiYXNlIGlzIGEgbGlzdCBvZiByZWxhdGVkIGRhdGEgaW4gd2hpY2ggcm93cyBvZiByZWxhdGVkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvcm1hdGlvbiBhcmUgcmVjb3JkcywgYW5kIGNvbHVtbnMgb2YgZGF0YSBhcmUgZmllbGRzLiBUaGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0IHJvdyBvZiB0aGUgbGlzdCBjb250YWlucyBsYWJlbHMgZm9yIGVhY2ggY29sdW1uLgogICAgICogQHBhcmFtICAgIHN0cmluZ3xpbnRlZ2VyICAgICRmaWVsZCAgICAgICAgSW5kaWNhdGVzIHdoaWNoIGNvbHVtbiBpcyB1c2VkIGluIHRoZSBmdW5jdGlvbi4gRW50ZXIgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4gbGFiZWwgZW5jbG9zZWQgYmV0d2VlbiBkb3VibGUgcXVvdGF0aW9uIG1hcmtzLCBzdWNoIGFzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWdlIiBvciAiWWllbGQsIiBvciBhIG51bWJlciAod2l0aG91dCBxdW90YXRpb24gbWFya3MpIHRoYXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcHJlc2VudHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBjb2x1bW4gd2l0aGluIHRoZSBsaXN0OiAxIGZvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGZpcnN0IGNvbHVtbiwgMiBmb3IgdGhlIHNlY29uZCBjb2x1bW4sIGFuZCBzbyBvbi4KICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGNyaXRlcmlhICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IGNvbnRhaW5zIHRoZSBjb25kaXRpb25zIHlvdSBzcGVjaWZ5LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91IGNhbiB1c2UgYW55IHJhbmdlIGZvciB0aGUgY3JpdGVyaWEgYXJndW1lbnQsIGFzIGxvbmcgYXMgaXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVzIGF0IGxlYXN0IG9uZSBjb2x1bW4gbGFiZWwgYW5kIGF0IGxlYXN0IG9uZSBjZWxsIGJlbG93CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY29sdW1uIGxhYmVsIGluIHdoaWNoIHlvdSBzcGVjaWZ5IGEgY29uZGl0aW9uIGZvciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi4KICAgICAqIEByZXR1cm4gICAgaW50ZWdlcgogICAgICoKICAgICAqIEBUT0RPICAgIFRoZSBmaWVsZCBhcmd1bWVudCBpcyBvcHRpb25hbC4gSWYgZmllbGQgaXMgb21pdHRlZCwgRENPVU5UQSBjb3VudHMgYWxsIHJlY29yZHMgaW4gdGhlCiAgICAgKiAgICAgICAgICAgIGRhdGFiYXNlIHRoYXQgbWF0Y2ggdGhlIGNyaXRlcmlhLgogICAgICoKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEQ09VTlRBKCRkYXRhYmFzZSwgJGZpZWxkLCAkY3JpdGVyaWEpCiAgICB7CiAgICAgICAgJGZpZWxkID0gc2VsZjo6ZmllbGRFeHRyYWN0KCRkYXRhYmFzZSwgJGZpZWxkKTsKICAgICAgICBpZiAoaXNfbnVsbCgkZmllbGQpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgcmVkdWNlIHRoZSBkYXRhYmFzZSB0byBhIHNldCBvZiByb3dzIHRoYXQgbWF0Y2ggYWxsIHRoZSBjcml0ZXJpYQogICAgICAgICRkYXRhYmFzZSA9IHNlbGY6OmZpbHRlcigkZGF0YWJhc2UsICRjcml0ZXJpYSk7CiAgICAgICAgLy8gICAgZXh0cmFjdCBhbiBhcnJheSBvZiB2YWx1ZXMgZm9yIHRoZSByZXF1ZXN0ZWQgY29sdW1uCiAgICAgICAgJGNvbERhdGEgPSBhcnJheSgpOwogICAgICAgIGZvcmVhY2ggKCRkYXRhYmFzZSBhcyAkcm93KSB7CiAgICAgICAgICAgICRjb2xEYXRhW10gPSAkcm93WyRmaWVsZF07CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fU3RhdGlzdGljYWw6OkNPVU5UQSgKICAgICAgICAgICAgc2VsZjo6Z2V0RmlsdGVyZWRDb2x1bW4oJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgICAgICApOwogICAgfQoKCiAgICAvKioKICAgICAqIERHRVQKICAgICAqCiAgICAgKiBFeHRyYWN0cyBhIHNpbmdsZSB2YWx1ZSBmcm9tIGEgY29sdW1uIG9mIGEgbGlzdCBvciBkYXRhYmFzZSB0aGF0IG1hdGNoZXMgY29uZGl0aW9ucyB0aGF0IHlvdQogICAgICogc3BlY2lmeS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBER0VUKGRhdGFiYXNlLGZpZWxkLGNyaXRlcmlhKQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgRGF0YWJhc2UgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgICAgICRkYXRhYmFzZSAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgdGhhdCBtYWtlcyB1cCB0aGUgbGlzdCBvciBkYXRhYmFzZS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgZGF0YWJhc2UgaXMgYSBsaXN0IG9mIHJlbGF0ZWQgZGF0YSBpbiB3aGljaCByb3dzIG9mIHJlbGF0ZWQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm9ybWF0aW9uIGFyZSByZWNvcmRzLCBhbmQgY29sdW1ucyBvZiBkYXRhIGFyZSBmaWVsZHMuIFRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Qgcm93IG9mIHRoZSBsaXN0IGNvbnRhaW5zIGxhYmVscyBmb3IgZWFjaCBjb2x1bW4uCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nfGludGVnZXIgICAgJGZpZWxkICAgICAgICBJbmRpY2F0ZXMgd2hpY2ggY29sdW1uIGlzIHVzZWQgaW4gdGhlIGZ1bmN0aW9uLiBFbnRlciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbiBsYWJlbCBlbmNsb3NlZCBiZXR3ZWVuIGRvdWJsZSBxdW90YXRpb24gbWFya3MsIHN1Y2ggYXMKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBZ2UiIG9yICJZaWVsZCwiIG9yIGEgbnVtYmVyICh3aXRob3V0IHF1b3RhdGlvbiBtYXJrcykgdGhhdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwcmVzZW50cyB0aGUgcG9zaXRpb24gb2YgdGhlIGNvbHVtbiB3aXRoaW4gdGhlIGxpc3Q6IDEgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgZmlyc3QgY29sdW1uLCAyIGZvciB0aGUgc2Vjb25kIGNvbHVtbiwgYW5kIHNvIG9uLgogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkY3JpdGVyaWEgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgY29udGFpbnMgdGhlIGNvbmRpdGlvbnMgeW91IHNwZWNpZnkuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZb3UgY2FuIHVzZSBhbnkgcmFuZ2UgZm9yIHRoZSBjcml0ZXJpYSBhcmd1bWVudCwgYXMgbG9uZyBhcyBpdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZXMgYXQgbGVhc3Qgb25lIGNvbHVtbiBsYWJlbCBhbmQgYXQgbGVhc3Qgb25lIGNlbGwgYmVsb3cKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBjb2x1bW4gbGFiZWwgaW4gd2hpY2ggeW91IHNwZWNpZnkgYSBjb25kaXRpb24gZm9yIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLgogICAgICogQHJldHVybiAgICBtaXhlZAogICAgICoKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBER0VUKCRkYXRhYmFzZSwgJGZpZWxkLCAkY3JpdGVyaWEpCiAgICB7CiAgICAgICAgJGZpZWxkID0gc2VsZjo6ZmllbGRFeHRyYWN0KCRkYXRhYmFzZSwgJGZpZWxkKTsKICAgICAgICBpZiAoaXNfbnVsbCgkZmllbGQpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuCiAgICAgICAgJGNvbERhdGEgPSBzZWxmOjpnZXRGaWx0ZXJlZENvbHVtbigkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKTsKICAgICAgICBpZiAoY291bnQoJGNvbERhdGEpID4gMSkgewogICAgICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpOYU4oKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkY29sRGF0YVswXTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBETUFYCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgbGFyZ2VzdCBudW1iZXIgaW4gYSBjb2x1bW4gb2YgYSBsaXN0IG9yIGRhdGFiYXNlIHRoYXQgbWF0Y2hlcyBjb25kaXRpb25zIHlvdSB0aGF0CiAgICAgKiBzcGVjaWZ5LgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIERNQVgoZGF0YWJhc2UsZmllbGQsY3JpdGVyaWEpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRhYmFzZSBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGRhdGFiYXNlICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IG1ha2VzIHVwIHRoZSBsaXN0IG9yIGRhdGFiYXNlLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSBkYXRhYmFzZSBpcyBhIGxpc3Qgb2YgcmVsYXRlZCBkYXRhIGluIHdoaWNoIHJvd3Mgb2YgcmVsYXRlZAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb3JtYXRpb24gYXJlIHJlY29yZHMsIGFuZCBjb2x1bW5zIG9mIGRhdGEgYXJlIGZpZWxkcy4gVGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCByb3cgb2YgdGhlIGxpc3QgY29udGFpbnMgbGFiZWxzIGZvciBlYWNoIGNvbHVtbi4KICAgICAqIEBwYXJhbSAgICBzdHJpbmd8aW50ZWdlciAgICAkZmllbGQgICAgICAgIEluZGljYXRlcyB3aGljaCBjb2x1bW4gaXMgdXNlZCBpbiB0aGUgZnVuY3Rpb24uIEVudGVyIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uIGxhYmVsIGVuY2xvc2VkIGJldHdlZW4gZG91YmxlIHF1b3RhdGlvbiBtYXJrcywgc3VjaCBhcwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFnZSIgb3IgIllpZWxkLCIgb3IgYSBudW1iZXIgKHdpdGhvdXQgcXVvdGF0aW9uIG1hcmtzKSB0aGF0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXByZXNlbnRzIHRoZSBwb3NpdGlvbiBvZiB0aGUgY29sdW1uIHdpdGhpbiB0aGUgbGlzdDogMSBmb3IKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaXJzdCBjb2x1bW4sIDIgZm9yIHRoZSBzZWNvbmQgY29sdW1uLCBhbmQgc28gb24uCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgICAgICRjcml0ZXJpYSAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgdGhhdCBjb250YWlucyB0aGUgY29uZGl0aW9ucyB5b3Ugc3BlY2lmeS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFlvdSBjYW4gdXNlIGFueSByYW5nZSBmb3IgdGhlIGNyaXRlcmlhIGFyZ3VtZW50LCBhcyBsb25nIGFzIGl0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlcyBhdCBsZWFzdCBvbmUgY29sdW1uIGxhYmVsIGFuZCBhdCBsZWFzdCBvbmUgY2VsbCBiZWxvdwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbHVtbiBsYWJlbCBpbiB3aGljaCB5b3Ugc3BlY2lmeSBhIGNvbmRpdGlvbiBmb3IgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4uCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0CiAgICAgKgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIERNQVgoJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgIHsKICAgICAgICAkZmllbGQgPSBzZWxmOjpmaWVsZEV4dHJhY3QoJGRhdGFiYXNlLCAkZmllbGQpOwogICAgICAgIGlmIChpc19udWxsKCRmaWVsZCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fU3RhdGlzdGljYWw6Ok1BWCgKICAgICAgICAgICAgc2VsZjo6Z2V0RmlsdGVyZWRDb2x1bW4oJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgICAgICApOwogICAgfQoKCiAgICAvKioKICAgICAqIERNSU4KICAgICAqCiAgICAgKiBSZXR1cm5zIHRoZSBzbWFsbGVzdCBudW1iZXIgaW4gYSBjb2x1bW4gb2YgYSBsaXN0IG9yIGRhdGFiYXNlIHRoYXQgbWF0Y2hlcyBjb25kaXRpb25zIHlvdSB0aGF0CiAgICAgKiBzcGVjaWZ5LgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIERNSU4oZGF0YWJhc2UsZmllbGQsY3JpdGVyaWEpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRhYmFzZSBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGRhdGFiYXNlICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IG1ha2VzIHVwIHRoZSBsaXN0IG9yIGRhdGFiYXNlLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSBkYXRhYmFzZSBpcyBhIGxpc3Qgb2YgcmVsYXRlZCBkYXRhIGluIHdoaWNoIHJvd3Mgb2YgcmVsYXRlZAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb3JtYXRpb24gYXJlIHJlY29yZHMsIGFuZCBjb2x1bW5zIG9mIGRhdGEgYXJlIGZpZWxkcy4gVGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCByb3cgb2YgdGhlIGxpc3QgY29udGFpbnMgbGFiZWxzIGZvciBlYWNoIGNvbHVtbi4KICAgICAqIEBwYXJhbSAgICBzdHJpbmd8aW50ZWdlciAgICAkZmllbGQgICAgICAgIEluZGljYXRlcyB3aGljaCBjb2x1bW4gaXMgdXNlZCBpbiB0aGUgZnVuY3Rpb24uIEVudGVyIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uIGxhYmVsIGVuY2xvc2VkIGJldHdlZW4gZG91YmxlIHF1b3RhdGlvbiBtYXJrcywgc3VjaCBhcwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFnZSIgb3IgIllpZWxkLCIgb3IgYSBudW1iZXIgKHdpdGhvdXQgcXVvdGF0aW9uIG1hcmtzKSB0aGF0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXByZXNlbnRzIHRoZSBwb3NpdGlvbiBvZiB0aGUgY29sdW1uIHdpdGhpbiB0aGUgbGlzdDogMSBmb3IKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaXJzdCBjb2x1bW4sIDIgZm9yIHRoZSBzZWNvbmQgY29sdW1uLCBhbmQgc28gb24uCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgICAgICRjcml0ZXJpYSAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgdGhhdCBjb250YWlucyB0aGUgY29uZGl0aW9ucyB5b3Ugc3BlY2lmeS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFlvdSBjYW4gdXNlIGFueSByYW5nZSBmb3IgdGhlIGNyaXRlcmlhIGFyZ3VtZW50LCBhcyBsb25nIGFzIGl0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlcyBhdCBsZWFzdCBvbmUgY29sdW1uIGxhYmVsIGFuZCBhdCBsZWFzdCBvbmUgY2VsbCBiZWxvdwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbHVtbiBsYWJlbCBpbiB3aGljaCB5b3Ugc3BlY2lmeSBhIGNvbmRpdGlvbiBmb3IgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4uCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0CiAgICAgKgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIERNSU4oJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgIHsKICAgICAgICAkZmllbGQgPSBzZWxmOjpmaWVsZEV4dHJhY3QoJGRhdGFiYXNlLCAkZmllbGQpOwogICAgICAgIGlmIChpc19udWxsKCRmaWVsZCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fU3RhdGlzdGljYWw6Ok1JTigKICAgICAgICAgICAgc2VsZjo6Z2V0RmlsdGVyZWRDb2x1bW4oJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgICAgICApOwogICAgfQoKCiAgICAvKioKICAgICAqIERQUk9EVUNUCiAgICAgKgogICAgICogTXVsdGlwbGllcyB0aGUgdmFsdWVzIGluIGEgY29sdW1uIG9mIGEgbGlzdCBvciBkYXRhYmFzZSB0aGF0IG1hdGNoIGNvbmRpdGlvbnMgdGhhdCB5b3Ugc3BlY2lmeS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBEUFJPRFVDVChkYXRhYmFzZSxmaWVsZCxjcml0ZXJpYSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGFiYXNlIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkZGF0YWJhc2UgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgbWFrZXMgdXAgdGhlIGxpc3Qgb3IgZGF0YWJhc2UuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIGRhdGFiYXNlIGlzIGEgbGlzdCBvZiByZWxhdGVkIGRhdGEgaW4gd2hpY2ggcm93cyBvZiByZWxhdGVkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvcm1hdGlvbiBhcmUgcmVjb3JkcywgYW5kIGNvbHVtbnMgb2YgZGF0YSBhcmUgZmllbGRzLiBUaGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0IHJvdyBvZiB0aGUgbGlzdCBjb250YWlucyBsYWJlbHMgZm9yIGVhY2ggY29sdW1uLgogICAgICogQHBhcmFtICAgIHN0cmluZ3xpbnRlZ2VyICAgICRmaWVsZCAgICAgICAgSW5kaWNhdGVzIHdoaWNoIGNvbHVtbiBpcyB1c2VkIGluIHRoZSBmdW5jdGlvbi4gRW50ZXIgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4gbGFiZWwgZW5jbG9zZWQgYmV0d2VlbiBkb3VibGUgcXVvdGF0aW9uIG1hcmtzLCBzdWNoIGFzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWdlIiBvciAiWWllbGQsIiBvciBhIG51bWJlciAod2l0aG91dCBxdW90YXRpb24gbWFya3MpIHRoYXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcHJlc2VudHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBjb2x1bW4gd2l0aGluIHRoZSBsaXN0OiAxIGZvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGZpcnN0IGNvbHVtbiwgMiBmb3IgdGhlIHNlY29uZCBjb2x1bW4sIGFuZCBzbyBvbi4KICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGNyaXRlcmlhICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IGNvbnRhaW5zIHRoZSBjb25kaXRpb25zIHlvdSBzcGVjaWZ5LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91IGNhbiB1c2UgYW55IHJhbmdlIGZvciB0aGUgY3JpdGVyaWEgYXJndW1lbnQsIGFzIGxvbmcgYXMgaXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVzIGF0IGxlYXN0IG9uZSBjb2x1bW4gbGFiZWwgYW5kIGF0IGxlYXN0IG9uZSBjZWxsIGJlbG93CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY29sdW1uIGxhYmVsIGluIHdoaWNoIHlvdSBzcGVjaWZ5IGEgY29uZGl0aW9uIGZvciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi4KICAgICAqIEByZXR1cm4gICAgZmxvYXQKICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gRFBST0RVQ1QoJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgIHsKICAgICAgICAkZmllbGQgPSBzZWxmOjpmaWVsZEV4dHJhY3QoJGRhdGFiYXNlLCAkZmllbGQpOwogICAgICAgIGlmIChpc19udWxsKCRmaWVsZCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gUEhQRXhjZWxfQ2FsY3VsYXRpb25fTWF0aFRyaWc6OlBST0RVQ1QoCiAgICAgICAgICAgIHNlbGY6OmdldEZpbHRlcmVkQ29sdW1uKCRkYXRhYmFzZSwgJGZpZWxkLCAkY3JpdGVyaWEpCiAgICAgICAgKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBEU1RERVYKICAgICAqCiAgICAgKiBFc3RpbWF0ZXMgdGhlIHN0YW5kYXJkIGRldmlhdGlvbiBvZiBhIHBvcHVsYXRpb24gYmFzZWQgb24gYSBzYW1wbGUgYnkgdXNpbmcgdGhlIG51bWJlcnMgaW4gYQogICAgICogY29sdW1uIG9mIGEgbGlzdCBvciBkYXRhYmFzZSB0aGF0IG1hdGNoIGNvbmRpdGlvbnMgdGhhdCB5b3Ugc3BlY2lmeS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBEU1RERVYoZGF0YWJhc2UsZmllbGQsY3JpdGVyaWEpCiAgICAgKgogICAgICogQGFjY2VzcyAgICBwdWJsaWMKICAgICAqIEBjYXRlZ29yeSBEYXRhYmFzZSBGdW5jdGlvbnMKICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGRhdGFiYXNlICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IG1ha2VzIHVwIHRoZSBsaXN0IG9yIGRhdGFiYXNlLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQSBkYXRhYmFzZSBpcyBhIGxpc3Qgb2YgcmVsYXRlZCBkYXRhIGluIHdoaWNoIHJvd3Mgb2YgcmVsYXRlZAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mb3JtYXRpb24gYXJlIHJlY29yZHMsIGFuZCBjb2x1bW5zIG9mIGRhdGEgYXJlIGZpZWxkcy4gVGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdCByb3cgb2YgdGhlIGxpc3QgY29udGFpbnMgbGFiZWxzIGZvciBlYWNoIGNvbHVtbi4KICAgICAqIEBwYXJhbSAgICBzdHJpbmd8aW50ZWdlciAgICAkZmllbGQgICAgICAgIEluZGljYXRlcyB3aGljaCBjb2x1bW4gaXMgdXNlZCBpbiB0aGUgZnVuY3Rpb24uIEVudGVyIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uIGxhYmVsIGVuY2xvc2VkIGJldHdlZW4gZG91YmxlIHF1b3RhdGlvbiBtYXJrcywgc3VjaCBhcwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFnZSIgb3IgIllpZWxkLCIgb3IgYSBudW1iZXIgKHdpdGhvdXQgcXVvdGF0aW9uIG1hcmtzKSB0aGF0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXByZXNlbnRzIHRoZSBwb3NpdGlvbiBvZiB0aGUgY29sdW1uIHdpdGhpbiB0aGUgbGlzdDogMSBmb3IKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaXJzdCBjb2x1bW4sIDIgZm9yIHRoZSBzZWNvbmQgY29sdW1uLCBhbmQgc28gb24uCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgICAgICRjcml0ZXJpYSAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgdGhhdCBjb250YWlucyB0aGUgY29uZGl0aW9ucyB5b3Ugc3BlY2lmeS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFlvdSBjYW4gdXNlIGFueSByYW5nZSBmb3IgdGhlIGNyaXRlcmlhIGFyZ3VtZW50LCBhcyBsb25nIGFzIGl0CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlcyBhdCBsZWFzdCBvbmUgY29sdW1uIGxhYmVsIGFuZCBhdCBsZWFzdCBvbmUgY2VsbCBiZWxvdwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbHVtbiBsYWJlbCBpbiB3aGljaCB5b3Ugc3BlY2lmeSBhIGNvbmRpdGlvbiBmb3IgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4uCiAgICAgKiBAcmV0dXJuICAgIGZsb2F0CiAgICAgKgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIERTVERFVigkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKQogICAgewogICAgICAgICRmaWVsZCA9IHNlbGY6OmZpZWxkRXh0cmFjdCgkZGF0YWJhc2UsICRmaWVsZCk7CiAgICAgICAgaWYgKGlzX251bGwoJGZpZWxkKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9TdGF0aXN0aWNhbDo6U1RERVYoCiAgICAgICAgICAgIHNlbGY6OmdldEZpbHRlcmVkQ29sdW1uKCRkYXRhYmFzZSwgJGZpZWxkLCAkY3JpdGVyaWEpCiAgICAgICAgKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBEU1RERVZQCiAgICAgKgogICAgICogQ2FsY3VsYXRlcyB0aGUgc3RhbmRhcmQgZGV2aWF0aW9uIG9mIGEgcG9wdWxhdGlvbiBiYXNlZCBvbiB0aGUgZW50aXJlIHBvcHVsYXRpb24gYnkgdXNpbmcgdGhlCiAgICAgKiBudW1iZXJzIGluIGEgY29sdW1uIG9mIGEgbGlzdCBvciBkYXRhYmFzZSB0aGF0IG1hdGNoIGNvbmRpdGlvbnMgdGhhdCB5b3Ugc3BlY2lmeS4KICAgICAqCiAgICAgKiBFeGNlbCBGdW5jdGlvbjoKICAgICAqICAgICAgICBEU1RERVZQKGRhdGFiYXNlLGZpZWxkLGNyaXRlcmlhKQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgRGF0YWJhc2UgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgICAgICRkYXRhYmFzZSAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgdGhhdCBtYWtlcyB1cCB0aGUgbGlzdCBvciBkYXRhYmFzZS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgZGF0YWJhc2UgaXMgYSBsaXN0IG9mIHJlbGF0ZWQgZGF0YSBpbiB3aGljaCByb3dzIG9mIHJlbGF0ZWQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm9ybWF0aW9uIGFyZSByZWNvcmRzLCBhbmQgY29sdW1ucyBvZiBkYXRhIGFyZSBmaWVsZHMuIFRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Qgcm93IG9mIHRoZSBsaXN0IGNvbnRhaW5zIGxhYmVscyBmb3IgZWFjaCBjb2x1bW4uCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nfGludGVnZXIgICAgJGZpZWxkICAgICAgICBJbmRpY2F0ZXMgd2hpY2ggY29sdW1uIGlzIHVzZWQgaW4gdGhlIGZ1bmN0aW9uLiBFbnRlciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbiBsYWJlbCBlbmNsb3NlZCBiZXR3ZWVuIGRvdWJsZSBxdW90YXRpb24gbWFya3MsIHN1Y2ggYXMKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBZ2UiIG9yICJZaWVsZCwiIG9yIGEgbnVtYmVyICh3aXRob3V0IHF1b3RhdGlvbiBtYXJrcykgdGhhdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwcmVzZW50cyB0aGUgcG9zaXRpb24gb2YgdGhlIGNvbHVtbiB3aXRoaW4gdGhlIGxpc3Q6IDEgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgZmlyc3QgY29sdW1uLCAyIGZvciB0aGUgc2Vjb25kIGNvbHVtbiwgYW5kIHNvIG9uLgogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkY3JpdGVyaWEgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgY29udGFpbnMgdGhlIGNvbmRpdGlvbnMgeW91IHNwZWNpZnkuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZb3UgY2FuIHVzZSBhbnkgcmFuZ2UgZm9yIHRoZSBjcml0ZXJpYSBhcmd1bWVudCwgYXMgbG9uZyBhcyBpdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZXMgYXQgbGVhc3Qgb25lIGNvbHVtbiBsYWJlbCBhbmQgYXQgbGVhc3Qgb25lIGNlbGwgYmVsb3cKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBjb2x1bW4gbGFiZWwgaW4gd2hpY2ggeW91IHNwZWNpZnkgYSBjb25kaXRpb24gZm9yIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLgogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICoKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEU1RERVZQKCRkYXRhYmFzZSwgJGZpZWxkLCAkY3JpdGVyaWEpCiAgICB7CiAgICAgICAgJGZpZWxkID0gc2VsZjo6ZmllbGRFeHRyYWN0KCRkYXRhYmFzZSwgJGZpZWxkKTsKICAgICAgICBpZiAoaXNfbnVsbCgkZmllbGQpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuCiAgICAgICAgcmV0dXJuIFBIUEV4Y2VsX0NhbGN1bGF0aW9uX1N0YXRpc3RpY2FsOjpTVERFVlAoCiAgICAgICAgICAgIHNlbGY6OmdldEZpbHRlcmVkQ29sdW1uKCRkYXRhYmFzZSwgJGZpZWxkLCAkY3JpdGVyaWEpCiAgICAgICAgKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBEU1VNCiAgICAgKgogICAgICogQWRkcyB0aGUgbnVtYmVycyBpbiBhIGNvbHVtbiBvZiBhIGxpc3Qgb3IgZGF0YWJhc2UgdGhhdCBtYXRjaCBjb25kaXRpb25zIHRoYXQgeW91IHNwZWNpZnkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgRFNVTShkYXRhYmFzZSxmaWVsZCxjcml0ZXJpYSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGFiYXNlIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkZGF0YWJhc2UgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgbWFrZXMgdXAgdGhlIGxpc3Qgb3IgZGF0YWJhc2UuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIGRhdGFiYXNlIGlzIGEgbGlzdCBvZiByZWxhdGVkIGRhdGEgaW4gd2hpY2ggcm93cyBvZiByZWxhdGVkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvcm1hdGlvbiBhcmUgcmVjb3JkcywgYW5kIGNvbHVtbnMgb2YgZGF0YSBhcmUgZmllbGRzLiBUaGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0IHJvdyBvZiB0aGUgbGlzdCBjb250YWlucyBsYWJlbHMgZm9yIGVhY2ggY29sdW1uLgogICAgICogQHBhcmFtICAgIHN0cmluZ3xpbnRlZ2VyICAgICRmaWVsZCAgICAgICAgSW5kaWNhdGVzIHdoaWNoIGNvbHVtbiBpcyB1c2VkIGluIHRoZSBmdW5jdGlvbi4gRW50ZXIgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4gbGFiZWwgZW5jbG9zZWQgYmV0d2VlbiBkb3VibGUgcXVvdGF0aW9uIG1hcmtzLCBzdWNoIGFzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWdlIiBvciAiWWllbGQsIiBvciBhIG51bWJlciAod2l0aG91dCBxdW90YXRpb24gbWFya3MpIHRoYXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcHJlc2VudHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBjb2x1bW4gd2l0aGluIHRoZSBsaXN0OiAxIGZvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGZpcnN0IGNvbHVtbiwgMiBmb3IgdGhlIHNlY29uZCBjb2x1bW4sIGFuZCBzbyBvbi4KICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGNyaXRlcmlhICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IGNvbnRhaW5zIHRoZSBjb25kaXRpb25zIHlvdSBzcGVjaWZ5LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91IGNhbiB1c2UgYW55IHJhbmdlIGZvciB0aGUgY3JpdGVyaWEgYXJndW1lbnQsIGFzIGxvbmcgYXMgaXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVzIGF0IGxlYXN0IG9uZSBjb2x1bW4gbGFiZWwgYW5kIGF0IGxlYXN0IG9uZSBjZWxsIGJlbG93CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY29sdW1uIGxhYmVsIGluIHdoaWNoIHlvdSBzcGVjaWZ5IGEgY29uZGl0aW9uIGZvciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi4KICAgICAqIEByZXR1cm4gICAgZmxvYXQKICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gRFNVTSgkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKQogICAgewogICAgICAgICRmaWVsZCA9IHNlbGY6OmZpZWxkRXh0cmFjdCgkZGF0YWJhc2UsICRmaWVsZCk7CiAgICAgICAgaWYgKGlzX251bGwoJGZpZWxkKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9NYXRoVHJpZzo6U1VNKAogICAgICAgICAgICBzZWxmOjpnZXRGaWx0ZXJlZENvbHVtbigkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKQogICAgICAgICk7CiAgICB9CgoKICAgIC8qKgogICAgICogRFZBUgogICAgICoKICAgICAqIEVzdGltYXRlcyB0aGUgdmFyaWFuY2Ugb2YgYSBwb3B1bGF0aW9uIGJhc2VkIG9uIGEgc2FtcGxlIGJ5IHVzaW5nIHRoZSBudW1iZXJzIGluIGEgY29sdW1uCiAgICAgKiBvZiBhIGxpc3Qgb3IgZGF0YWJhc2UgdGhhdCBtYXRjaCBjb25kaXRpb25zIHRoYXQgeW91IHNwZWNpZnkuCiAgICAgKgogICAgICogRXhjZWwgRnVuY3Rpb246CiAgICAgKiAgICAgICAgRFZBUihkYXRhYmFzZSxmaWVsZCxjcml0ZXJpYSkKICAgICAqCiAgICAgKiBAYWNjZXNzICAgIHB1YmxpYwogICAgICogQGNhdGVnb3J5IERhdGFiYXNlIEZ1bmN0aW9ucwogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkZGF0YWJhc2UgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgbWFrZXMgdXAgdGhlIGxpc3Qgb3IgZGF0YWJhc2UuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIGRhdGFiYXNlIGlzIGEgbGlzdCBvZiByZWxhdGVkIGRhdGEgaW4gd2hpY2ggcm93cyBvZiByZWxhdGVkCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvcm1hdGlvbiBhcmUgcmVjb3JkcywgYW5kIGNvbHVtbnMgb2YgZGF0YSBhcmUgZmllbGRzLiBUaGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0IHJvdyBvZiB0aGUgbGlzdCBjb250YWlucyBsYWJlbHMgZm9yIGVhY2ggY29sdW1uLgogICAgICogQHBhcmFtICAgIHN0cmluZ3xpbnRlZ2VyICAgICRmaWVsZCAgICAgICAgSW5kaWNhdGVzIHdoaWNoIGNvbHVtbiBpcyB1c2VkIGluIHRoZSBmdW5jdGlvbi4gRW50ZXIgdGhlCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4gbGFiZWwgZW5jbG9zZWQgYmV0d2VlbiBkb3VibGUgcXVvdGF0aW9uIG1hcmtzLCBzdWNoIGFzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWdlIiBvciAiWWllbGQsIiBvciBhIG51bWJlciAod2l0aG91dCBxdW90YXRpb24gbWFya3MpIHRoYXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcHJlc2VudHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBjb2x1bW4gd2l0aGluIHRoZSBsaXN0OiAxIGZvcgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGZpcnN0IGNvbHVtbiwgMiBmb3IgdGhlIHNlY29uZCBjb2x1bW4sIGFuZCBzbyBvbi4KICAgICAqIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAgICAgJGNyaXRlcmlhICAgIFRoZSByYW5nZSBvZiBjZWxscyB0aGF0IGNvbnRhaW5zIHRoZSBjb25kaXRpb25zIHlvdSBzcGVjaWZ5LgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91IGNhbiB1c2UgYW55IHJhbmdlIGZvciB0aGUgY3JpdGVyaWEgYXJndW1lbnQsIGFzIGxvbmcgYXMgaXQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGVzIGF0IGxlYXN0IG9uZSBjb2x1bW4gbGFiZWwgYW5kIGF0IGxlYXN0IG9uZSBjZWxsIGJlbG93CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgY29sdW1uIGxhYmVsIGluIHdoaWNoIHlvdSBzcGVjaWZ5IGEgY29uZGl0aW9uIGZvciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi4KICAgICAqIEByZXR1cm4gICAgZmxvYXQKICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gRFZBUigkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKQogICAgewogICAgICAgICRmaWVsZCA9IHNlbGY6OmZpZWxkRXh0cmFjdCgkZGF0YWJhc2UsICRmaWVsZCk7CiAgICAgICAgaWYgKGlzX251bGwoJGZpZWxkKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9TdGF0aXN0aWNhbDo6VkFSRnVuYygKICAgICAgICAgICAgc2VsZjo6Z2V0RmlsdGVyZWRDb2x1bW4oJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgICAgICApOwogICAgfQoKCiAgICAvKioKICAgICAqIERWQVJQCiAgICAgKgogICAgICogQ2FsY3VsYXRlcyB0aGUgdmFyaWFuY2Ugb2YgYSBwb3B1bGF0aW9uIGJhc2VkIG9uIHRoZSBlbnRpcmUgcG9wdWxhdGlvbiBieSB1c2luZyB0aGUgbnVtYmVycwogICAgICogaW4gYSBjb2x1bW4gb2YgYSBsaXN0IG9yIGRhdGFiYXNlIHRoYXQgbWF0Y2ggY29uZGl0aW9ucyB0aGF0IHlvdSBzcGVjaWZ5LgogICAgICoKICAgICAqIEV4Y2VsIEZ1bmN0aW9uOgogICAgICogICAgICAgIERWQVJQKGRhdGFiYXNlLGZpZWxkLGNyaXRlcmlhKQogICAgICoKICAgICAqIEBhY2Nlc3MgICAgcHVibGljCiAgICAgKiBAY2F0ZWdvcnkgRGF0YWJhc2UgRnVuY3Rpb25zCiAgICAgKiBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgICAgICRkYXRhYmFzZSAgICBUaGUgcmFuZ2Ugb2YgY2VsbHMgdGhhdCBtYWtlcyB1cCB0aGUgbGlzdCBvciBkYXRhYmFzZS4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgZGF0YWJhc2UgaXMgYSBsaXN0IG9mIHJlbGF0ZWQgZGF0YSBpbiB3aGljaCByb3dzIG9mIHJlbGF0ZWQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm9ybWF0aW9uIGFyZSByZWNvcmRzLCBhbmQgY29sdW1ucyBvZiBkYXRhIGFyZSBmaWVsZHMuIFRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Qgcm93IG9mIHRoZSBsaXN0IGNvbnRhaW5zIGxhYmVscyBmb3IgZWFjaCBjb2x1bW4uCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nfGludGVnZXIgICAgJGZpZWxkICAgICAgICBJbmRpY2F0ZXMgd2hpY2ggY29sdW1uIGlzIHVzZWQgaW4gdGhlIGZ1bmN0aW9uLiBFbnRlciB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbiBsYWJlbCBlbmNsb3NlZCBiZXR3ZWVuIGRvdWJsZSBxdW90YXRpb24gbWFya3MsIHN1Y2ggYXMKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBZ2UiIG9yICJZaWVsZCwiIG9yIGEgbnVtYmVyICh3aXRob3V0IHF1b3RhdGlvbiBtYXJrcykgdGhhdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwcmVzZW50cyB0aGUgcG9zaXRpb24gb2YgdGhlIGNvbHVtbiB3aXRoaW4gdGhlIGxpc3Q6IDEgZm9yCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgZmlyc3QgY29sdW1uLCAyIGZvciB0aGUgc2Vjb25kIGNvbHVtbiwgYW5kIHNvIG9uLgogICAgICogQHBhcmFtICAgIG1peGVkW10gICAgICAgICAgICAkY3JpdGVyaWEgICAgVGhlIHJhbmdlIG9mIGNlbGxzIHRoYXQgY29udGFpbnMgdGhlIGNvbmRpdGlvbnMgeW91IHNwZWNpZnkuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZb3UgY2FuIHVzZSBhbnkgcmFuZ2UgZm9yIHRoZSBjcml0ZXJpYSBhcmd1bWVudCwgYXMgbG9uZyBhcyBpdAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZXMgYXQgbGVhc3Qgb25lIGNvbHVtbiBsYWJlbCBhbmQgYXQgbGVhc3Qgb25lIGNlbGwgYmVsb3cKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBjb2x1bW4gbGFiZWwgaW4gd2hpY2ggeW91IHNwZWNpZnkgYSBjb25kaXRpb24gZm9yIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLgogICAgICogQHJldHVybiAgICBmbG9hdAogICAgICoKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBEVkFSUCgkZGF0YWJhc2UsICRmaWVsZCwgJGNyaXRlcmlhKQogICAgewogICAgICAgICRmaWVsZCA9IHNlbGY6OmZpZWxkRXh0cmFjdCgkZGF0YWJhc2UsICRmaWVsZCk7CiAgICAgICAgaWYgKGlzX251bGwoJGZpZWxkKSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbl9TdGF0aXN0aWNhbDo6VkFSUCgKICAgICAgICAgICAgc2VsZjo6Z2V0RmlsdGVyZWRDb2x1bW4oJGRhdGFiYXNlLCAkZmllbGQsICRjcml0ZXJpYSkKICAgICAgICApOwogICAgfQp9Cg==",
    "size": "33331"
}