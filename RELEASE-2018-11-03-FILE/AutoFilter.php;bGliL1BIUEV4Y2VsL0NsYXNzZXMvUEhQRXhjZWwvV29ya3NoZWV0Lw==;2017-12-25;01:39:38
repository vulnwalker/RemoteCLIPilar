{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Worksheet\/AutoFilter.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKgogKiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKICogdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBCiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsX1dvcmtzaGVldAogKiBAY29weXJpZ2h0ICBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsIChodHRwOi8vd3d3LmNvZGVwbGV4LmNvbS9QSFBFeGNlbCkKICogQGxpY2Vuc2UgICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL29sZC1saWNlbnNlcy9sZ3BsLTIuMS50eHQgICAgTEdQTAogKiBAdmVyc2lvbiAgICAjI1ZFUlNJT04jIywgIyNEQVRFIyMKICovCmNsYXNzIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyCnsKICAgIC8qKgogICAgICogQXV0b2ZpbHRlciBXb3Jrc2hlZXQKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwcml2YXRlICR3b3JrU2hlZXQ7CgoKICAgIC8qKgogICAgICogQXV0b2ZpbHRlciBSYW5nZQogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByaXZhdGUgJHJhbmdlID0gJyc7CgoKICAgIC8qKgogICAgICogQXV0b2ZpbHRlciBDb2x1bW4gUnVsZXNldAogICAgICoKICAgICAqIEB2YXIgYXJyYXkgb2YgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uCiAgICAgKi8KICAgIHByaXZhdGUgJGNvbHVtbnMgPSBhcnJheSgpOwoKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcgogICAgICoKICAgICAqICAgIEBwYXJhbSAgICBzdHJpbmcgICAgICAgICRwUmFuZ2UgICAgICAgIENlbGwgcmFuZ2UgKGkuZS4gQTE6RTEwKQogICAgICogQHBhcmFtIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkcFJhbmdlID0gJycsIFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAkdGhpcy0+cmFuZ2UgPSAkcFJhbmdlOwogICAgICAgICR0aGlzLT53b3JrU2hlZXQgPSAkcFNoZWV0OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IEF1dG9GaWx0ZXIgUGFyZW50IFdvcmtzaGVldAogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQYXJlbnQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+d29ya1NoZWV0OwogICAgfQoKICAgIC8qKgogICAgICogU2V0IEF1dG9GaWx0ZXIgUGFyZW50IFdvcmtzaGVldAogICAgICoKICAgICAqIEBwYXJhbSBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldAogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0UGFyZW50KFBIUEV4Y2VsX1dvcmtzaGVldCAkcFNoZWV0ID0gbnVsbCkKICAgIHsKICAgICAgICAkdGhpcy0+d29ya1NoZWV0ID0gJHBTaGVldDsKCiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IEF1dG9GaWx0ZXIgUmFuZ2UKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UmFuZ2UoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+cmFuZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBTZXQgQXV0b0ZpbHRlciBSYW5nZQogICAgICoKICAgICAqICAgIEBwYXJhbSAgICBzdHJpbmcgICAgICAgICRwUmFuZ2UgICAgICAgIENlbGwgcmFuZ2UgKGkuZS4gQTE6RTEwKQogICAgICogICAgQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqICAgIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFJhbmdlKCRwUmFuZ2UgPSAnJykKICAgIHsKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRjZWxsQWRkcmVzcyA9IGV4cGxvZGUoJyEnLCBzdHJ0b3VwcGVyKCRwUmFuZ2UpKTsKICAgICAgICBpZiAoY291bnQoJGNlbGxBZGRyZXNzKSA+IDEpIHsKICAgICAgICAgICAgbGlzdCgkd29ya3NoZWV0LCAkcFJhbmdlKSA9ICRjZWxsQWRkcmVzczsKICAgICAgICB9CgogICAgICAgIGlmIChzdHJwb3MoJHBSYW5nZSwgJzonKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJHRoaXMtPnJhbmdlID0gJHBSYW5nZTsKICAgICAgICB9IGVsc2VpZiAoZW1wdHkoJHBSYW5nZSkpIHsKICAgICAgICAgICAgJHRoaXMtPnJhbmdlID0gJyc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignQXV0b2ZpbHRlciBtdXN0IGJlIHNldCBvbiBhIHJhbmdlIG9mIGNlbGxzLicpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGVtcHR5KCRwUmFuZ2UpKSB7CiAgICAgICAgICAgIC8vICAgIERpc2NhcmQgYWxsIGNvbHVtbiBydWxlcwogICAgICAgICAgICAkdGhpcy0+Y29sdW1ucyA9IGFycmF5KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gICAgRGlzY2FyZCBhbnkgY29sdW1uIHJ1bGVzIHRoYXQgYXJlIG5vIGxvbmdlciB2YWxpZCB3aXRoaW4gdGhpcyByYW5nZQogICAgICAgICAgICBsaXN0KCRyYW5nZVN0YXJ0LCAkcmFuZ2VFbmQpID0gUEhQRXhjZWxfQ2VsbDo6cmFuZ2VCb3VuZGFyaWVzKCR0aGlzLT5yYW5nZSk7CiAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jb2x1bW5zIGFzICRrZXkgPT4gJHZhbHVlKSB7CiAgICAgICAgICAgICAgICAkY29sSW5kZXggPSBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGtleSk7CiAgICAgICAgICAgICAgICBpZiAoKCRyYW5nZVN0YXJ0WzBdID4gJGNvbEluZGV4KSB8fCAoJHJhbmdlRW5kWzBdIDwgJGNvbEluZGV4KSkgewogICAgICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5jb2x1bW5zWyRrZXldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFsbCBBdXRvRmlsdGVyIENvbHVtbnMKICAgICAqCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBhcnJheSBvZiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y29sdW1uczsKICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIHRoYXQgdGhlIHNwZWNpZmllZCBjb2x1bW4gaXMgaW4gdGhlIEF1dG9GaWx0ZXIgcmFuZ2UKICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICRjb2x1bW4gICAgICAgICAgICBDb2x1bW4gbmFtZSAoZS5nLiBBKQogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqIEByZXR1cm4gICAgaW50ZWdlciAgICBUaGUgY29sdW1uIG9mZnNldCB3aXRoaW4gdGhlIGF1dG9maWx0ZXIgcmFuZ2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHRlc3RDb2x1bW5JblJhbmdlKCRjb2x1bW4pCiAgICB7CiAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5yYW5nZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiTm8gYXV0b2ZpbHRlciByYW5nZSBpcyBkZWZpbmVkLiIpOwogICAgICAgIH0KCiAgICAgICAgJGNvbHVtbkluZGV4ID0gUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRjb2x1bW4pOwogICAgICAgIGxpc3QoJHJhbmdlU3RhcnQsICRyYW5nZUVuZCkgPSBQSFBFeGNlbF9DZWxsOjpyYW5nZUJvdW5kYXJpZXMoJHRoaXMtPnJhbmdlKTsKICAgICAgICBpZiAoKCRyYW5nZVN0YXJ0WzBdID4gJGNvbHVtbkluZGV4KSB8fCAoJHJhbmdlRW5kWzBdIDwgJGNvbHVtbkluZGV4KSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCJDb2x1bW4gaXMgb3V0c2lkZSBvZiBjdXJyZW50IGF1dG9maWx0ZXIgcmFuZ2UuIik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGNvbHVtbkluZGV4IC0gJHJhbmdlU3RhcnRbMF07CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBzcGVjaWZpZWQgQXV0b0ZpbHRlciBDb2x1bW4gT2Zmc2V0IHdpdGhpbiB0aGUgZGVmaW5lZCBBdXRvRmlsdGVyIHJhbmdlCiAgICAgKgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAkcENvbHVtbiAgICAgICAgQ29sdW1uIG5hbWUgKGUuZy4gQSkKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIGludGVnZXIgICAgVGhlIG9mZnNldCBvZiB0aGUgc3BlY2lmaWVkIGNvbHVtbiB3aXRoaW4gdGhlIGF1dG9maWx0ZXIgcmFuZ2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbk9mZnNldCgkcENvbHVtbikKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnRlc3RDb2x1bW5JblJhbmdlKCRwQ29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhIHNwZWNpZmllZCBBdXRvRmlsdGVyIENvbHVtbgogICAgICoKICAgICAqIEBwYXJhbSAgICBzdHJpbmcgICAgJHBDb2x1bW4gICAgICAgIENvbHVtbiBuYW1lIChlLmcuIEEpCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbigkcENvbHVtbikKICAgIHsKICAgICAgICAkdGhpcy0+dGVzdENvbHVtbkluUmFuZ2UoJHBDb2x1bW4pOwoKICAgICAgICBpZiAoIWlzc2V0KCR0aGlzLT5jb2x1bW5zWyRwQ29sdW1uXSkpIHsKICAgICAgICAgICAgJHRoaXMtPmNvbHVtbnNbJHBDb2x1bW5dID0gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbigkcENvbHVtbiwgJHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5jb2x1bW5zWyRwQ29sdW1uXTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhIHNwZWNpZmllZCBBdXRvRmlsdGVyIENvbHVtbiBieSBpdCdzIG9mZnNldAogICAgICoKICAgICAqIEBwYXJhbSAgICBpbnRlZ2VyICAgICRwQ29sdW1uT2Zmc2V0ICAgICAgICBDb2x1bW4gb2Zmc2V0IHdpdGhpbiByYW5nZSAoc3RhcnRpbmcgZnJvbSAwKQogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDb2x1bW5CeU9mZnNldCgkcENvbHVtbk9mZnNldCA9IDApCiAgICB7CiAgICAgICAgbGlzdCgkcmFuZ2VTdGFydCwgJHJhbmdlRW5kKSA9IFBIUEV4Y2VsX0NlbGw6OnJhbmdlQm91bmRhcmllcygkdGhpcy0+cmFuZ2UpOwogICAgICAgICRwQ29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRyYW5nZVN0YXJ0WzBdICsgJHBDb2x1bW5PZmZzZXQgLSAxKTsKCiAgICAgICAgcmV0dXJuICR0aGlzLT5nZXRDb2x1bW4oJHBDb2x1bW4pOwogICAgfQoKICAgIC8qKgogICAgICogICAgU2V0IEF1dG9GaWx0ZXIKICAgICAqCiAgICAgKiAgICBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1ufHN0cmluZyAgICAgICAgJHBDb2x1bW4KICAgICAqICAgICAgICAgICAgQSBzaW1wbGUgc3RyaW5nIGNvbnRhaW5pbmcgYSBDb2x1bW4gSUQgbGlrZSAnQScgaXMgcGVybWl0dGVkCiAgICAgKiAgICBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogICAgQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0Q29sdW1uKCRwQ29sdW1uKQogICAgewogICAgICAgIGlmICgoaXNfc3RyaW5nKCRwQ29sdW1uKSkgJiYgKCFlbXB0eSgkcENvbHVtbikpKSB7CiAgICAgICAgICAgICRjb2x1bW4gPSAkcENvbHVtbjsKICAgICAgICB9IGVsc2VpZiAoaXNfb2JqZWN0KCRwQ29sdW1uKSAmJiAoJHBDb2x1bW4gaW5zdGFuY2VvZiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW4pKSB7CiAgICAgICAgICAgICRjb2x1bW4gPSAkcENvbHVtbi0+Z2V0Q29sdW1uSW5kZXgoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCJDb2x1bW4gaXMgbm90IHdpdGhpbiB0aGUgYXV0b2ZpbHRlciByYW5nZS4iKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPnRlc3RDb2x1bW5JblJhbmdlKCRjb2x1bW4pOwoKICAgICAgICBpZiAoaXNfc3RyaW5nKCRwQ29sdW1uKSkgewogICAgICAgICAgICAkdGhpcy0+Y29sdW1uc1skcENvbHVtbl0gPSBuZXcgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uKCRwQ29sdW1uLCAkdGhpcyk7CiAgICAgICAgfSBlbHNlaWYgKGlzX29iamVjdCgkcENvbHVtbikgJiYgKCRwQ29sdW1uIGluc3RhbmNlb2YgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uKSkgewogICAgICAgICAgICAkcENvbHVtbi0+c2V0UGFyZW50KCR0aGlzKTsKICAgICAgICAgICAgJHRoaXMtPmNvbHVtbnNbJGNvbHVtbl0gPSAkcENvbHVtbjsKICAgICAgICB9CiAgICAgICAga3NvcnQoJHRoaXMtPmNvbHVtbnMpOwoKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhIHNwZWNpZmllZCBBdXRvRmlsdGVyIENvbHVtbgogICAgICoKICAgICAqIEBwYXJhbSAgICBzdHJpbmcgICRwQ29sdW1uICAgIENvbHVtbiBuYW1lIChlLmcuIEEpCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJDb2x1bW4oJHBDb2x1bW4pCiAgICB7CiAgICAgICAgJHRoaXMtPnRlc3RDb2x1bW5JblJhbmdlKCRwQ29sdW1uKTsKCiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5jb2x1bW5zWyRwQ29sdW1uXSkpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmNvbHVtbnNbJHBDb2x1bW5dKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqICAgIFNoaWZ0IGFuIEF1dG9GaWx0ZXIgQ29sdW1uIFJ1bGUgdG8gYSBkaWZmZXJlbnQgY29sdW1uCiAgICAgKgogICAgICogICAgTm90ZTogVGhpcyBtZXRob2QgYnlwYXNzZXMgdmFsaWRhdGlvbiBvZiB0aGUgZGVzdGluYXRpb24gY29sdW1uIHRvIGVuc3VyZSBpdCBpcyB3aXRoaW4gdGhpcyBBdXRvRmlsdGVyIHJhbmdlLgogICAgICogICAgICAgIE5vciBkb2VzIGl0IHZlcmlmeSB3aGV0aGVyIGFueSBjb2x1bW4gcnVsZSBhbHJlYWR5IGV4aXN0cyBhdCAkdG9Db2x1bW4sIGJ1dCB3aWxsIHNpbXBseSBvdmVycmlkZWFueSBleGlzdGluZyB2YWx1ZS4KICAgICAqICAgICAgICBVc2Ugd2l0aCBjYXV0aW9uLgogICAgICoKICAgICAqICAgIEBwYXJhbSAgICBzdHJpbmcgICAgJGZyb21Db2x1bW4gICAgICAgIENvbHVtbiBuYW1lIChlLmcuIEEpCiAgICAgKiAgICBAcGFyYW0gICAgc3RyaW5nICAgICR0b0NvbHVtbiAgICAgICAgQ29sdW1uIG5hbWUgKGUuZy4gQikKICAgICAqICAgIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNoaWZ0Q29sdW1uKCRmcm9tQ29sdW1uID0gbnVsbCwgJHRvQ29sdW1uID0gbnVsbCkKICAgIHsKICAgICAgICAkZnJvbUNvbHVtbiA9IHN0cnRvdXBwZXIoJGZyb21Db2x1bW4pOwogICAgICAgICR0b0NvbHVtbiA9IHN0cnRvdXBwZXIoJHRvQ29sdW1uKTsKCiAgICAgICAgaWYgKCgkZnJvbUNvbHVtbiAhPT0gbnVsbCkgJiYgKGlzc2V0KCR0aGlzLT5jb2x1bW5zWyRmcm9tQ29sdW1uXSkpICYmICgkdG9Db2x1bW4gIT09IG51bGwpKSB7CiAgICAgICAgICAgICR0aGlzLT5jb2x1bW5zWyRmcm9tQ29sdW1uXS0+c2V0UGFyZW50KCk7CiAgICAgICAgICAgICR0aGlzLT5jb2x1bW5zWyRmcm9tQ29sdW1uXS0+c2V0Q29sdW1uSW5kZXgoJHRvQ29sdW1uKTsKICAgICAgICAgICAgJHRoaXMtPmNvbHVtbnNbJHRvQ29sdW1uXSA9ICR0aGlzLT5jb2x1bW5zWyRmcm9tQ29sdW1uXTsKICAgICAgICAgICAgJHRoaXMtPmNvbHVtbnNbJHRvQ29sdW1uXS0+c2V0UGFyZW50KCR0aGlzKTsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmNvbHVtbnNbJGZyb21Db2x1bW5dKTsKCiAgICAgICAgICAgIGtzb3J0KCR0aGlzLT5jb2x1bW5zKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCgogICAgLyoqCiAgICAgKiAgICBUZXN0IGlmIGNlbGwgdmFsdWUgaXMgaW4gdGhlIGRlZmluZWQgc2V0IG9mIHZhbHVlcwogICAgICoKICAgICAqICAgIEBwYXJhbSAgICBtaXhlZCAgICAgICAgJGNlbGxWYWx1ZQogICAgICogICAgQHBhcmFtICAgIG1peGVkW10gICAgICAgICRkYXRhU2V0CiAgICAgKiAgICBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gZmlsdGVyVGVzdEluU2ltcGxlRGF0YVNldCgkY2VsbFZhbHVlLCAkZGF0YVNldCkKICAgIHsKICAgICAgICAkZGF0YVNldFZhbHVlcyA9ICRkYXRhU2V0WydmaWx0ZXJWYWx1ZXMnXTsKICAgICAgICAkYmxhbmtzID0gJGRhdGFTZXRbJ2JsYW5rcyddOwogICAgICAgIGlmICgoJGNlbGxWYWx1ZSA9PSAnJykgfHwgKCRjZWxsVmFsdWUgPT09IG51bGwpKSB7CiAgICAgICAgICAgIHJldHVybiAkYmxhbmtzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW5fYXJyYXkoJGNlbGxWYWx1ZSwgJGRhdGFTZXRWYWx1ZXMpOwogICAgfQoKICAgIC8qKgogICAgICogICAgVGVzdCBpZiBjZWxsIHZhbHVlIGlzIGluIHRoZSBkZWZpbmVkIHNldCBvZiBFeGNlbCBkYXRlIHZhbHVlcwogICAgICoKICAgICAqICAgIEBwYXJhbSAgICBtaXhlZCAgICAgICAgJGNlbGxWYWx1ZQogICAgICogICAgQHBhcmFtICAgIG1peGVkW10gICAgICAgICRkYXRhU2V0CiAgICAgKiAgICBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gZmlsdGVyVGVzdEluRGF0ZUdyb3VwU2V0KCRjZWxsVmFsdWUsICRkYXRhU2V0KQogICAgewogICAgICAgICRkYXRlU2V0ID0gJGRhdGFTZXRbJ2ZpbHRlclZhbHVlcyddOwogICAgICAgICRibGFua3MgPSAkZGF0YVNldFsnYmxhbmtzJ107CiAgICAgICAgaWYgKCgkY2VsbFZhbHVlID09ICcnKSB8fCAoJGNlbGxWYWx1ZSA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgcmV0dXJuICRibGFua3M7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNfbnVtZXJpYygkY2VsbFZhbHVlKSkgewogICAgICAgICAgICAkZGF0ZVZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX0RhdGU6OkV4Y2VsVG9QSFAoJGNlbGxWYWx1ZSk7CiAgICAgICAgICAgIGlmICgkY2VsbFZhbHVlIDwgMSkgewogICAgICAgICAgICAgICAgLy8gICAgSnVzdCB0aGUgdGltZSBwYXJ0CiAgICAgICAgICAgICAgICAkZHRWYWwgPSBkYXRlKCdIaXMnLCAkZGF0ZVZhbHVlKTsKICAgICAgICAgICAgICAgICRkYXRlU2V0ID0gJGRhdGVTZXRbJ3RpbWUnXTsKICAgICAgICAgICAgfSBlbHNlaWYgKCRjZWxsVmFsdWUgPT0gZmxvb3IoJGNlbGxWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIC8vICAgIEp1c3QgdGhlIGRhdGUgcGFydAogICAgICAgICAgICAgICAgJGR0VmFsID0gZGF0ZSgnWW1kJywgJGRhdGVWYWx1ZSk7CiAgICAgICAgICAgICAgICAkZGF0ZVNldCA9ICRkYXRlU2V0WydkYXRlJ107CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAgICBkYXRlIGFuZCB0aW1lIHBhcnRzCiAgICAgICAgICAgICAgICAkZHRWYWwgPSBkYXRlKCdZbWRIaXMnLCAkZGF0ZVZhbHVlKTsKICAgICAgICAgICAgICAgICRkYXRlU2V0ID0gJGRhdGVTZXRbJ2RhdGVUaW1lJ107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yZWFjaCAoJGRhdGVTZXQgYXMgJGRhdGVWYWx1ZSkgewogICAgICAgICAgICAgICAgLy8gICAgVXNlIG9mIHN1YnN0ciB0byBleHRyYWN0IHZhbHVlIGF0IHRoZSBhcHByb3ByaWF0ZSBncm91cCBsZXZlbAogICAgICAgICAgICAgICAgaWYgKHN1YnN0cigkZHRWYWwsIDAsIHN0cmxlbigkZGF0ZVZhbHVlKSkgPT0gJGRhdGVWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqICAgIFRlc3QgaWYgY2VsbCB2YWx1ZSBpcyB3aXRoaW4gYSBzZXQgb2YgdmFsdWVzIGRlZmluZWQgYnkgYSBydWxlc2V0CiAgICAgKgogICAgICogICAgQHBhcmFtICAgIG1peGVkICAgICAgICAkY2VsbFZhbHVlCiAgICAgKiAgICBAcGFyYW0gICAgbWl4ZWRbXSAgICAgICAgJHJ1bGVTZXQKICAgICAqICAgIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBmaWx0ZXJUZXN0SW5DdXN0b21EYXRhU2V0KCRjZWxsVmFsdWUsICRydWxlU2V0KQogICAgewogICAgICAgICRkYXRhU2V0ID0gJHJ1bGVTZXRbJ2ZpbHRlclJ1bGVzJ107CiAgICAgICAgJGpvaW4gPSAkcnVsZVNldFsnam9pbiddOwogICAgICAgICRjdXN0b21SdWxlRm9yQmxhbmtzID0gaXNzZXQoJHJ1bGVTZXRbJ2N1c3RvbVJ1bGVGb3JCbGFua3MnXSkgPyAkcnVsZVNldFsnY3VzdG9tUnVsZUZvckJsYW5rcyddIDogZmFsc2U7CgogICAgICAgIGlmICghJGN1c3RvbVJ1bGVGb3JCbGFua3MpIHsKICAgICAgICAgICAgLy8gICAgQmxhbmsgY2VsbHMgYXJlIGFsd2F5cyBpZ25vcmVkLCBzbyByZXR1cm4gYSBGQUxTRQogICAgICAgICAgICBpZiAoKCRjZWxsVmFsdWUgPT0gJycpIHx8ICgkY2VsbFZhbHVlID09PSBudWxsKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRyZXR1cm5WYWwgPSAoJGpvaW4gPT0gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0NPTFVNTl9KT0lOX0FORCk7CiAgICAgICAgZm9yZWFjaCAoJGRhdGFTZXQgYXMgJHJ1bGUpIHsKICAgICAgICAgICAgaWYgKGlzX251bWVyaWMoJHJ1bGVbJ3ZhbHVlJ10pKSB7CiAgICAgICAgICAgICAgICAvLyAgICBOdW1lcmljIHZhbHVlcyBhcmUgdGVzdGVkIHVzaW5nIHRoZSBhcHByb3ByaWF0ZSBvcGVyYXRvcgogICAgICAgICAgICAgICAgc3dpdGNoICgkcnVsZVsnb3BlcmF0b3InXSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfRVFVQUw6CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRWYWwgICAgPSAoJGNlbGxWYWx1ZSA9PSAkcnVsZVsndmFsdWUnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfTk9URVFVQUw6CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRWYWwgICAgPSAoJGNlbGxWYWx1ZSAhPSAkcnVsZVsndmFsdWUnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfR1JFQVRFUlRIQU46CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRWYWwgICAgPSAoJGNlbGxWYWx1ZSA+ICRydWxlWyd2YWx1ZSddKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9HUkVBVEVSVEhBTk9SRVFVQUw6CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRWYWwgICAgPSAoJGNlbGxWYWx1ZSA+PSAkcnVsZVsndmFsdWUnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfTEVTU1RIQU46CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRWYWwgICAgPSAoJGNlbGxWYWx1ZSA8ICRydWxlWyd2YWx1ZSddKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9MRVNTVEhBTk9SRVFVQUw6CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXRWYWwgICAgPSAoJGNlbGxWYWx1ZSA8PSAkcnVsZVsndmFsdWUnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2VpZiAoJHJ1bGVbJ3ZhbHVlJ10gPT0gJycpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoJHJ1bGVbJ29wZXJhdG9yJ10pIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX0NPTFVNTl9SVUxFX0VRVUFMOgogICAgICAgICAgICAgICAgICAgICAgICAkcmV0VmFsICAgID0gKCgkY2VsbFZhbHVlID09ICcnKSB8fCAoJGNlbGxWYWx1ZSA9PT0gbnVsbCkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX0NPTFVNTl9SVUxFX05PVEVRVUFMOgogICAgICAgICAgICAgICAgICAgICAgICAkcmV0VmFsICAgID0gKCgkY2VsbFZhbHVlICE9ICcnKSAmJiAoJGNlbGxWYWx1ZSAhPT0gbnVsbCkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICAkcmV0VmFsICAgID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAgICBTdHJpbmcgdmFsdWVzIGFyZSBhbHdheXMgdGVzdGVkIGZvciBlcXVhbGl0eSwgZmFjdG9yaW5nIGluIGZvciB3aWxkY2FyZHMgKGhlbmNlIGEgcmVnZXhwIHRlc3QpCiAgICAgICAgICAgICAgICAkcmV0VmFsICAgID0gcHJlZ19tYXRjaCgnL14nLiRydWxlWyd2YWx1ZSddLickL2knLCAkY2VsbFZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAgICBJZiB0aGVyZSBhcmUgbXVsdGlwbGUgY29uZGl0aW9ucywgdGhlbiB3ZSBuZWVkIHRvIHRlc3QgYm90aCB1c2luZyB0aGUgYXBwcm9wcmlhdGUgam9pbiBvcGVyYXRvcgogICAgICAgICAgICBzd2l0Y2ggKCRqb2luKSB7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbjo6QVVUT0ZJTFRFUl9DT0xVTU5fSk9JTl9PUjoKICAgICAgICAgICAgICAgICAgICAkcmV0dXJuVmFsID0gJHJldHVyblZhbCB8fCAkcmV0VmFsOwogICAgICAgICAgICAgICAgICAgIC8vICAgIEJyZWFrIGFzIHNvb24gYXMgd2UgaGF2ZSBhIFRSVUUgbWF0Y2ggZm9yIE9SIGpvaW5zLAogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICB0byBhdm9pZCB1bm5lY2Vzc2FyeSBhZGRpdGlvbmFsIGNvZGUgZXhlY3V0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKCRyZXR1cm5WYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRyZXR1cm5WYWw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW46OkFVVE9GSUxURVJfQ09MVU1OX0pPSU5fQU5EOgogICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWwgPSAkcmV0dXJuVmFsICYmICRyZXRWYWw7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmV0dXJuVmFsOwogICAgfQoKICAgIC8qKgogICAgICogICAgVGVzdCBpZiBjZWxsIGRhdGUgdmFsdWUgaXMgbWF0Y2hlcyBhIHNldCBvZiB2YWx1ZXMgZGVmaW5lZCBieSBhIHNldCBvZiBtb250aHMKICAgICAqCiAgICAgKiAgICBAcGFyYW0gICAgbWl4ZWQgICAgICAgICRjZWxsVmFsdWUKICAgICAqICAgIEBwYXJhbSAgICBtaXhlZFtdICAgICAgICAkbW9udGhTZXQKICAgICAqICAgIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBmaWx0ZXJUZXN0SW5QZXJpb2REYXRlU2V0KCRjZWxsVmFsdWUsICRtb250aFNldCkKICAgIHsKICAgICAgICAvLyAgICBCbGFuayBjZWxscyBhcmUgYWx3YXlzIGlnbm9yZWQsIHNvIHJldHVybiBhIEZBTFNFCiAgICAgICAgaWYgKCgkY2VsbFZhbHVlID09ICcnKSB8fCAoJGNlbGxWYWx1ZSA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzX251bWVyaWMoJGNlbGxWYWx1ZSkpIHsKICAgICAgICAgICAgJGRhdGVWYWx1ZSA9IGRhdGUoJ20nLCBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6RXhjZWxUb1BIUCgkY2VsbFZhbHVlKSk7CiAgICAgICAgICAgIGlmIChpbl9hcnJheSgkZGF0ZVZhbHVlLCAkbW9udGhTZXQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogICAgU2VhcmNoL1JlcGxhY2UgYXJyYXlzIHRvIGNvbnZlcnQgRXhjZWwgd2lsZGNhcmQgc3ludGF4IHRvIGEgcmVnZXhwIHN5bnRheCBmb3IgcHJlZ19tYXRjaGluZwogICAgICoKICAgICAqICAgIEB2YXIgICAgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgJGZyb21SZXBsYWNlID0gYXJyYXkoJ1wqJywgJ1w\/JywgJ35+JywgJ34uKicsICd+Lj8nKTsKICAgIHByaXZhdGUgc3RhdGljICR0b1JlcGxhY2UgICA9IGFycmF5KCcuKicsICcuJywgICd+JywgICdcKicsICAnXD8nKTsKCgogICAgLyoqCiAgICAgKiAgICBDb252ZXJ0IGEgZHluYW1pYyBydWxlIGRhdGVyYW5nZSB0byBhIGN1c3RvbSBmaWx0ZXIgcmFuZ2UgZXhwcmVzc2lvbiBmb3IgZWFzZSBvZiBjYWxjdWxhdGlvbgogICAgICoKICAgICAqICAgIEBwYXJhbSAgICBzdHJpbmcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGR5bmFtaWNSdWxlVHlwZQogICAgICogICAgQHBhcmFtICAgIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbiAgICAgICAgJiRmaWx0ZXJDb2x1bW4KICAgICAqICAgIEByZXR1cm4gbWl4ZWRbXQogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGR5bmFtaWNGaWx0ZXJEYXRlUmFuZ2UoJGR5bmFtaWNSdWxlVHlwZSwgJiRmaWx0ZXJDb2x1bW4pCiAgICB7CiAgICAgICAgJHJEYXRlVHlwZSA9IFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6Z2V0UmV0dXJuRGF0ZVR5cGUoKTsKICAgICAgICBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OnNldFJldHVybkRhdGVUeXBlKFBIUEV4Y2VsX0NhbGN1bGF0aW9uX0Z1bmN0aW9uczo6UkVUVVJOREFURV9QSFBfTlVNRVJJQyk7CiAgICAgICAgJHZhbCA9ICRtYXhWYWwgPSBudWxsOwoKICAgICAgICAkcnVsZVZhbHVlcyA9IGFycmF5KCk7CiAgICAgICAgJGJhc2VEYXRlID0gUEhQRXhjZWxfQ2FsY3VsYXRpb25fRGF0ZVRpbWU6OkRBVEVOT1coKTsKICAgICAgICAvLyAgICBDYWxjdWxhdGUgc3RhcnQvZW5kIGRhdGVzIGZvciB0aGUgcmVxdWlyZWQgZGF0ZSByYW5nZSBiYXNlZCBvbiBjdXJyZW50IGRhdGUKICAgICAgICBzd2l0Y2ggKCRkeW5hbWljUnVsZVR5cGUpIHsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX0xBU1RXRUVLOgogICAgICAgICAgICAgICAgJGJhc2VEYXRlID0gc3RydG90aW1lKCctNyBkYXlzJywgJGJhc2VEYXRlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfTkVYVFdFRUs6CiAgICAgICAgICAgICAgICAkYmFzZURhdGUgPSBzdHJ0b3RpbWUoJy03IGRheXMnLCAkYmFzZURhdGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19MQVNUTU9OVEg6CiAgICAgICAgICAgICAgICAkYmFzZURhdGUgPSBzdHJ0b3RpbWUoJy0xIG1vbnRoJywgZ21ta3RpbWUoMCwgMCwgMCwgMSwgZGF0ZSgnbScsICRiYXNlRGF0ZSksIGRhdGUoJ1knLCAkYmFzZURhdGUpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX05FWFRNT05USDoKICAgICAgICAgICAgICAgICRiYXNlRGF0ZSA9IHN0cnRvdGltZSgnKzEgbW9udGgnLCBnbW1rdGltZSgwLCAwLCAwLCAxLCBkYXRlKCdtJywgJGJhc2VEYXRlKSwgZGF0ZSgnWScsICRiYXNlRGF0ZSkpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfTEFTVFFVQVJURVI6CiAgICAgICAgICAgICAgICAkYmFzZURhdGUgPSBzdHJ0b3RpbWUoJy0zIG1vbnRoJywgZ21ta3RpbWUoMCwgMCwgMCwgMSwgZGF0ZSgnbScsICRiYXNlRGF0ZSksIGRhdGUoJ1knLCAkYmFzZURhdGUpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX05FWFRRVUFSVEVSOgogICAgICAgICAgICAgICAgJGJhc2VEYXRlID0gc3RydG90aW1lKCcrMyBtb250aCcsIGdtbWt0aW1lKDAsIDAsIDAsIDEsIGRhdGUoJ20nLCAkYmFzZURhdGUpLCBkYXRlKCdZJywgJGJhc2VEYXRlKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19MQVNUWUVBUjoKICAgICAgICAgICAgICAgICRiYXNlRGF0ZSA9IHN0cnRvdGltZSgnLTEgeWVhcicsIGdtbWt0aW1lKDAsIDAsIDAsIDEsIGRhdGUoJ20nLCAkYmFzZURhdGUpLCBkYXRlKCdZJywgJGJhc2VEYXRlKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19ORVhUWUVBUjoKICAgICAgICAgICAgICAgICRiYXNlRGF0ZSA9IHN0cnRvdGltZSgnKzEgeWVhcicsIGdtbWt0aW1lKDAsIDAsIDAsIDEsIGRhdGUoJ20nLCAkYmFzZURhdGUpLCBkYXRlKCdZJywgJGJhc2VEYXRlKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKCRkeW5hbWljUnVsZVR5cGUpIHsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX1RPREFZOgogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfWUVTVEVSREFZOgogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfVE9NT1JST1c6CiAgICAgICAgICAgICAgICAkbWF4VmFsID0gKGludCkgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUHRvRXhjZWwoc3RydG90aW1lKCcrMSBkYXknLCAkYmFzZURhdGUpKTsKICAgICAgICAgICAgICAgICR2YWwgPSAoaW50KSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6UEhQVG9FeGNlbCgkYmFzZURhdGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19ZRUFSVE9EQVRFOgogICAgICAgICAgICAgICAgJG1heFZhbCA9IChpbnQpIFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpQSFB0b0V4Y2VsKHN0cnRvdGltZSgnKzEgZGF5JywgJGJhc2VEYXRlKSk7CiAgICAgICAgICAgICAgICAkdmFsID0gKGludCkgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUFRvRXhjZWwoZ21ta3RpbWUoMCwgMCwgMCwgMSwgMSwgZGF0ZSgnWScsICRiYXNlRGF0ZSkpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfVEhJU1lFQVI6CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19MQVNUWUVBUjoKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX05FWFRZRUFSOgogICAgICAgICAgICAgICAgJG1heFZhbCA9IChpbnQpIFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpQSFBUb0V4Y2VsKGdtbWt0aW1lKDAsIDAsIDAsIDMxLCAxMiwgZGF0ZSgnWScsICRiYXNlRGF0ZSkpKTsKICAgICAgICAgICAgICAgICsrJG1heFZhbDsKICAgICAgICAgICAgICAgICR2YWwgPSAoaW50KSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6UEhQVG9FeGNlbChnbW1rdGltZSgwLCAwLCAwLCAxLCAxLCBkYXRlKCdZJywgJGJhc2VEYXRlKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19USElTUVVBUlRFUjoKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX0xBU1RRVUFSVEVSOgogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfTkVYVFFVQVJURVI6CiAgICAgICAgICAgICAgICAkdGhpc01vbnRoID0gZGF0ZSgnbScsICRiYXNlRGF0ZSk7CiAgICAgICAgICAgICAgICAkdGhpc1F1YXJ0ZXIgPSBmbG9vcigtLSR0aGlzTW9udGggLyAzKTsKICAgICAgICAgICAgICAgICRtYXhWYWwgPSAoaW50KSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6UEhQdG9FeGNlbChnbW1rdGltZSgwLCAwLCAwLCBkYXRlKCd0JywgJGJhc2VEYXRlKSwgKDErJHRoaXNRdWFydGVyKSozLCBkYXRlKCdZJywgJGJhc2VEYXRlKSkpOwogICAgICAgICAgICAgICAgKyskbWF4VmFsOwogICAgICAgICAgICAgICAgJHZhbCA9IChpbnQpIFBIUEV4Y2VsX1NoYXJlZF9EYXRlOjpQSFBUb0V4Y2VsKGdtbWt0aW1lKDAsIDAsIDAsIDEsIDErJHRoaXNRdWFydGVyKjMsIGRhdGUoJ1knLCAkYmFzZURhdGUpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX1RISVNNT05USDoKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX0xBU1RNT05USDoKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX05FWFRNT05USDoKICAgICAgICAgICAgICAgICRtYXhWYWwgPSAoaW50KSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6UEhQdG9FeGNlbChnbW1rdGltZSgwLCAwLCAwLCBkYXRlKCd0JywgJGJhc2VEYXRlKSwgZGF0ZSgnbScsICRiYXNlRGF0ZSksIGRhdGUoJ1knLCAkYmFzZURhdGUpKSk7CiAgICAgICAgICAgICAgICArKyRtYXhWYWw7CiAgICAgICAgICAgICAgICAkdmFsID0gKGludCkgUEhQRXhjZWxfU2hhcmVkX0RhdGU6OlBIUFRvRXhjZWwoZ21ta3RpbWUoMCwgMCwgMCwgMSwgZGF0ZSgnbScsICRiYXNlRGF0ZSksIGRhdGUoJ1knLCAkYmFzZURhdGUpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EWU5BTUlDX1RISVNXRUVLOgogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfTEFTVFdFRUs6CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19ORVhUV0VFSzoKICAgICAgICAgICAgICAgICRkYXlPZldlZWsgPSBkYXRlKCd3JywgJGJhc2VEYXRlKTsKICAgICAgICAgICAgICAgICR2YWwgPSAoaW50KSBQSFBFeGNlbF9TaGFyZWRfRGF0ZTo6UEhQVG9FeGNlbCgkYmFzZURhdGUpIC0gJGRheU9mV2VlazsKICAgICAgICAgICAgICAgICRtYXhWYWwgPSAkdmFsICsgNzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICgkZHluYW1pY1J1bGVUeXBlKSB7CiAgICAgICAgICAgIC8vICAgIEFkanVzdCBUb2RheSBkYXRlcyBmb3IgWWVzdGVyZGF5IGFuZCBUb21vcnJvdwogICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfWUVTVEVSREFZOgogICAgICAgICAgICAgICAgLS0kbWF4VmFsOwogICAgICAgICAgICAgICAgLS0kdmFsOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19UT01PUlJPVzoKICAgICAgICAgICAgICAgICsrJG1heFZhbDsKICAgICAgICAgICAgICAgICsrJHZhbDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLy8gICAgU2V0IHRoZSBmaWx0ZXIgY29sdW1uIHJ1bGUgYXR0cmlidXRlcyByZWFkeSBmb3Igd3JpdGluZwogICAgICAgICRmaWx0ZXJDb2x1bW4tPnNldEF0dHJpYnV0ZXMoYXJyYXkoJ3ZhbCcgPT4gJHZhbCwgJ21heFZhbCcgPT4gJG1heFZhbCkpOwoKICAgICAgICAvLyAgICBTZXQgdGhlIHJ1bGVzIGZvciBpZGVudGlmeWluZyByb3dzIGZvciBoaWRlL3Nob3cKICAgICAgICAkcnVsZVZhbHVlc1tdID0gYXJyYXkoJ29wZXJhdG9yJyA9PiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9HUkVBVEVSVEhBTk9SRVFVQUwsICd2YWx1ZScgPT4gJHZhbCk7CiAgICAgICAgJHJ1bGVWYWx1ZXNbXSA9IGFycmF5KCdvcGVyYXRvcicgPT4gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfTEVTU1RIQU4sICd2YWx1ZScgPT4gJG1heFZhbCk7CiAgICAgICAgUEhQRXhjZWxfQ2FsY3VsYXRpb25fRnVuY3Rpb25zOjpzZXRSZXR1cm5EYXRlVHlwZSgkckRhdGVUeXBlKTsKCiAgICAgICAgcmV0dXJuIGFycmF5KCdtZXRob2QnID0+ICdmaWx0ZXJUZXN0SW5DdXN0b21EYXRhU2V0JywgJ2FyZ3VtZW50cycgPT4gYXJyYXkoJ2ZpbHRlclJ1bGVzJyA9PiAkcnVsZVZhbHVlcywgJ2pvaW4nID0+IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbjo6QVVUT0ZJTFRFUl9DT0xVTU5fSk9JTl9BTkQpKTsKICAgIH0KCiAgICBwcml2YXRlIGZ1bmN0aW9uIGNhbGN1bGF0ZVRvcFRlblZhbHVlKCRjb2x1bW5JRCwgJHN0YXJ0Um93LCAkZW5kUm93LCAkcnVsZVR5cGUsICRydWxlVmFsdWUpCiAgICB7CiAgICAgICAgJHJhbmdlID0gJGNvbHVtbklELiRzdGFydFJvdy4nOicuJGNvbHVtbklELiRlbmRSb3c7CiAgICAgICAgJGRhdGFWYWx1ZXMgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbl9GdW5jdGlvbnM6OmZsYXR0ZW5BcnJheSgkdGhpcy0+d29ya1NoZWV0LT5yYW5nZVRvQXJyYXkoJHJhbmdlLCBudWxsLCB0cnVlLCBmYWxzZSkpOwoKICAgICAgICAkZGF0YVZhbHVlcyA9IGFycmF5X2ZpbHRlcigkZGF0YVZhbHVlcyk7CiAgICAgICAgaWYgKCRydWxlVHlwZSA9PSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9UT1BURU5fVE9QKSB7CiAgICAgICAgICAgIHJzb3J0KCRkYXRhVmFsdWVzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzb3J0KCRkYXRhVmFsdWVzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhcnJheV9wb3AoYXJyYXlfc2xpY2UoJGRhdGFWYWx1ZXMsIDAsICRydWxlVmFsdWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqICAgIEFwcGx5IHRoZSBBdXRvRmlsdGVyIHJ1bGVzIHRvIHRoZSBBdXRvRmlsdGVyIFJhbmdlCiAgICAgKgogICAgICogICAgQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqICAgIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNob3dIaWRlUm93cygpCiAgICB7CiAgICAgICAgbGlzdCgkcmFuZ2VTdGFydCwgJHJhbmdlRW5kKSA9IFBIUEV4Y2VsX0NlbGw6OnJhbmdlQm91bmRhcmllcygkdGhpcy0+cmFuZ2UpOwoKICAgICAgICAvLyAgICBUaGUgaGVhZGluZyByb3cgc2hvdWxkIGFsd2F5cyBiZSB2aXNpYmxlCi8vICAgICAgICBlY2hvICdBdXRvRmlsdGVyIEhlYWRpbmcgUm93ICcsICRyYW5nZVN0YXJ0WzFdLCcgaXMgYWx3YXlzIFNIT1dOJyxQSFBfRU9MOwogICAgICAgICR0aGlzLT53b3JrU2hlZXQtPmdldFJvd0RpbWVuc2lvbigkcmFuZ2VTdGFydFsxXSktPnNldFZpc2libGUodHJ1ZSk7CgogICAgICAgICRjb2x1bW5GaWx0ZXJUZXN0cyA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmNvbHVtbnMgYXMgJGNvbHVtbklEID0+ICRmaWx0ZXJDb2x1bW4pIHsKICAgICAgICAgICAgJHJ1bGVzID0gJGZpbHRlckNvbHVtbi0+Z2V0UnVsZXMoKTsKICAgICAgICAgICAgc3dpdGNoICgkZmlsdGVyQ29sdW1uLT5nZXRGaWx0ZXJUeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0ZJTFRFUlRZUEVfRklMVEVSOgogICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWVzID0gYXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAvLyAgICBCdWlsZCBhIGxpc3Qgb2YgdGhlIGZpbHRlciB2YWx1ZSBzZWxlY3Rpb25zCiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJ1bGVzIGFzICRydWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVHlwZSA9ICRydWxlLT5nZXRSdWxlVHlwZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAkcnVsZVZhbHVlc1tdID0gJHJ1bGUtPmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vICAgIFRlc3QgaWYgd2Ugd2FudCB0byBpbmNsdWRlIGJsYW5rcyBpbiBvdXIgZmlsdGVyIGNyaXRlcmlhCiAgICAgICAgICAgICAgICAgICAgJGJsYW5rcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICRydWxlRGF0YVNldCA9IGFycmF5X2ZpbHRlcigkcnVsZVZhbHVlcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50KCRydWxlVmFsdWVzKSAhPSBjb3VudCgkcnVsZURhdGFTZXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRibGFua3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHJ1bGVUeXBlID09IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0ZJTFRFUikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBGaWx0ZXIgb24gYWJzb2x1dGUgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5GaWx0ZXJUZXN0c1skY29sdW1uSURdID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWV0aG9kJyA9PiAnZmlsdGVyVGVzdEluU2ltcGxlRGF0YVNldCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXJndW1lbnRzJyA9PiBhcnJheSgnZmlsdGVyVmFsdWVzJyA9PiAkcnVsZURhdGFTZXQsICdibGFua3MnID0+ICRibGFua3MpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgRmlsdGVyIG9uIGRhdGUgZ3JvdXAgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgICAgICRhcmd1bWVudHMgPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJyA9PiBhcnJheSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbWUnID0+IGFycmF5KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGF0ZVRpbWUnID0+IGFycmF5KCksCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRydWxlRGF0YVNldCBhcyAkcnVsZVZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGF0ZSA9ICR0aW1lID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlzc2V0KCRydWxlVmFsdWVbUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQX1lFQVJdKSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJHJ1bGVWYWx1ZVtQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EQVRFR1JPVVBfWUVBUl0gIT09ICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkYXRlIC49IHNwcmludGYoJyUwNGQnLCAkcnVsZVZhbHVlW1BIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RBVEVHUk9VUF9ZRUFSXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlzc2V0KCRydWxlVmFsdWVbUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQX01PTlRIXSkpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCRydWxlVmFsdWVbUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQX01PTlRIXSAhPSAnJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGF0ZSAuPSBzcHJpbnRmKCclMDJkJywgJHJ1bGVWYWx1ZVtQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EQVRFR1JPVVBfTU9OVEhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHJ1bGVWYWx1ZVtQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EQVRFR1JPVVBfREFZXSkpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCRydWxlVmFsdWVbUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQX0RBWV0gIT09ICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkYXRlIC49IHNwcmludGYoJyUwMmQnLCAkcnVsZVZhbHVlW1BIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RBVEVHUk9VUF9EQVldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHJ1bGVWYWx1ZVtQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EQVRFR1JPVVBfSE9VUl0pKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgkcnVsZVZhbHVlW1BIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RBVEVHUk9VUF9IT1VSXSAhPT0gJycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWUgLj0gc3ByaW50ZignJTAyZCcsICRydWxlVmFsdWVbUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQX0hPVVJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHJ1bGVWYWx1ZVtQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EQVRFR1JPVVBfTUlOVVRFXSkpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCRydWxlVmFsdWVbUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQX01JTlVURV0gIT09ICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lIC49IHNwcmludGYoJyUwMmQnLCAkcnVsZVZhbHVlW1BIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RBVEVHUk9VUF9NSU5VVEVdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXNzZXQoJHJ1bGVWYWx1ZVtQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9SVUxFVFlQRV9EQVRFR1JPVVBfU0VDT05EXSkpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCRydWxlVmFsdWVbUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfREFURUdST1VQX1NFQ09ORF0gIT09ICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lIC49IHNwcmludGYoJyUwMmQnLCAkcnVsZVZhbHVlW1BIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RBVEVHUk9VUF9TRUNPTkRdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkYXRlVGltZSA9ICRkYXRlIC4gJHRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXJndW1lbnRzWydkYXRlJ11bXSA9ICRkYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3VtZW50c1sndGltZSddW10gPSAkdGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhcmd1bWVudHNbJ2RhdGVUaW1lJ11bXSA9ICRkYXRlVGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBSZW1vdmUgZW1wdHkgZWxlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgJGFyZ3VtZW50c1snZGF0ZSddID0gYXJyYXlfZmlsdGVyKCRhcmd1bWVudHNbJ2RhdGUnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcmd1bWVudHNbJ3RpbWUnXSA9IGFycmF5X2ZpbHRlcigkYXJndW1lbnRzWyd0aW1lJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAkYXJndW1lbnRzWydkYXRlVGltZSddID0gYXJyYXlfZmlsdGVyKCRhcmd1bWVudHNbJ2RhdGVUaW1lJ10pOwogICAgICAgICAgICAgICAgICAgICAgICAkY29sdW1uRmlsdGVyVGVzdHNbJGNvbHVtbklEXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ2ZpbHRlclRlc3RJbkRhdGVHcm91cFNldCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXJndW1lbnRzJyA9PiBhcnJheSgnZmlsdGVyVmFsdWVzJyA9PiAkYXJndW1lbnRzLCAnYmxhbmtzJyA9PiAkYmxhbmtzKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0ZJTFRFUlRZUEVfQ1VTVE9NRklMVEVSOgogICAgICAgICAgICAgICAgICAgICRjdXN0b21SdWxlRm9yQmxhbmtzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgJHJ1bGVWYWx1ZXMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgIC8vICAgIEJ1aWxkIGEgbGlzdCBvZiB0aGUgZmlsdGVyIHZhbHVlIHNlbGVjdGlvbnMKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcnVsZXMgYXMgJHJ1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bGVUeXBlID0gJHJ1bGUtPmdldFJ1bGVUeXBlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWUgPSAkcnVsZS0+Z2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc19udW1lcmljKCRydWxlVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBDb252ZXJ0IHRvIGEgcmVnZXhwIGFsbG93aW5nIGZvciByZWdleHAgcmVzZXJ2ZWQgY2hhcmFjdGVycywgd2lsZGNhcmRzIGFuZCBlc2NhcGVkIHdpbGRjYXJkcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bGVWYWx1ZSA9IHByZWdfcXVvdGUoJHJ1bGVWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcnVsZVZhbHVlID0gc3RyX3JlcGxhY2Uoc2VsZjo6JGZyb21SZXBsYWNlLCBzZWxmOjokdG9SZXBsYWNlLCAkcnVsZVZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmltKCRydWxlVmFsdWUpID09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGN1c3RvbVJ1bGVGb3JCbGFua3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWUgPSB0cmltKCRydWxlVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWVzW10gPSBhcnJheSgnb3BlcmF0b3InID0+ICRydWxlLT5nZXRPcGVyYXRvcigpLCAndmFsdWUnID0+ICRydWxlVmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkam9pbiA9ICRmaWx0ZXJDb2x1bW4tPmdldEpvaW4oKTsKICAgICAgICAgICAgICAgICAgICAkY29sdW1uRmlsdGVyVGVzdHNbJGNvbHVtbklEXSA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAnbWV0aG9kJyA9PiAnZmlsdGVyVGVzdEluQ3VzdG9tRGF0YVNldCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdhcmd1bWVudHMnID0+IGFycmF5KCdmaWx0ZXJSdWxlcycgPT4gJHJ1bGVWYWx1ZXMsICdqb2luJyA9PiAkam9pbiwgJ2N1c3RvbVJ1bGVGb3JCbGFua3MnID0+ICRjdXN0b21SdWxlRm9yQmxhbmtzKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbjo6QVVUT0ZJTFRFUl9GSUxURVJUWVBFX0RZTkFNSUNGSUxURVI6CiAgICAgICAgICAgICAgICAgICAgJHJ1bGVWYWx1ZXMgPSBhcnJheSgpOwogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRydWxlcyBhcyAkcnVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBXZSBzaG91bGQgb25seSBldmVyIGhhdmUgb25lIER5bmFtaWMgRmlsdGVyIFJ1bGUgYW55d2F5CiAgICAgICAgICAgICAgICAgICAgICAgICRkeW5hbWljUnVsZVR5cGUgPSAkcnVsZS0+Z2V0R3JvdXBpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgkZHluYW1pY1J1bGVUeXBlID09IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfQUJPVkVBVkVSQUdFKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKCRkeW5hbWljUnVsZVR5cGUgPT0gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfUlVMRVRZUEVfRFlOQU1JQ19CRUxPV0FWRVJBR0UpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBOdW1iZXIgKEF2ZXJhZ2UpIGJhc2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBDYWxjdWxhdGUgdGhlIGF2ZXJhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhdmVyYWdlRm9ybXVsYSA9ICc9QVZFUkFHRSgnLiRjb2x1bW5JRC4oJHJhbmdlU3RhcnRbMV0rMSkuJzonLiRjb2x1bW5JRC4kcmFuZ2VFbmRbMV0uJyknOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF2ZXJhZ2UgPSBQSFBFeGNlbF9DYWxjdWxhdGlvbjo6Z2V0SW5zdGFuY2UoKS0+Y2FsY3VsYXRlRm9ybXVsYSgkYXZlcmFnZUZvcm11bGEsIG51bGwsICR0aGlzLT53b3JrU2hlZXQtPmdldENlbGwoJ0ExJykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgU2V0IGFib3ZlL2JlbG93IHJ1bGUgYmFzZWQgb24gZ3JlYXRlclRoYW4gb3IgTGVzc1RhbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yID0gKCRkeW5hbWljUnVsZVR5cGUgPT09IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX1JVTEVUWVBFX0RZTkFNSUNfQUJPVkVBVkVSQUdFKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uX1J1bGU6OkFVVE9GSUxURVJfQ09MVU1OX1JVTEVfR1JFQVRFUlRIQU4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX0NPTFVNTl9SVUxFX0xFU1NUSEFOOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bGVWYWx1ZXNbXSA9IGFycmF5KCdvcGVyYXRvcicgPT4gJG9wZXJhdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+ICRhdmVyYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbkZpbHRlclRlc3RzWyRjb2x1bW5JRF0gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWV0aG9kJyA9PiAnZmlsdGVyVGVzdEluQ3VzdG9tRGF0YVNldCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FyZ3VtZW50cycgPT4gYXJyYXkoJ2ZpbHRlclJ1bGVzJyA9PiAkcnVsZVZhbHVlcywgJ2pvaW4nID0+IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbjo6QVVUT0ZJTFRFUl9DT0xVTU5fSk9JTl9PUikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBEYXRlIGJhc2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGR5bmFtaWNSdWxlVHlwZXswfSA9PSAnTScgfHwgJGR5bmFtaWNSdWxlVHlwZXswfSA9PSAnUScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBNb250aCBvciBRdWFydGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3NjYW5mKCRkeW5hbWljUnVsZVR5cGUsICclW0EtWl0lZCcsICRwZXJpb2RUeXBlLCAkcGVyaW9kKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHBlcmlvZFR5cGUgPT0gJ00nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWVzID0gYXJyYXkoJHBlcmlvZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0kcGVyaW9kOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGVyaW9kRW5kID0gKDErJHBlcmlvZCkqMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBlcmlvZFN0YXJ0ID0gMSskcGVyaW9kKjM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWVzID0gcmFuZ2UoJHBlcmlvZFN0YXJ0LCAkcGVyaW9kRW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvbHVtbkZpbHRlclRlc3RzWyRjb2x1bW5JRF0gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ2ZpbHRlclRlc3RJblBlcmlvZERhdGVTZXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXJndW1lbnRzJyA9PiAkcnVsZVZhbHVlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpbHRlckNvbHVtbi0+c2V0QXR0cmlidXRlcyhhcnJheSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgRGF0ZSBSYW5nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb2x1bW5GaWx0ZXJUZXN0c1skY29sdW1uSURdID0gJHRoaXMtPmR5bmFtaWNGaWx0ZXJEYXRlUmFuZ2UoJGR5bmFtaWNSdWxlVHlwZSwgJGZpbHRlckNvbHVtbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbjo6QVVUT0ZJTFRFUl9GSUxURVJUWVBFX1RPUFRFTkZJTFRFUjoKICAgICAgICAgICAgICAgICAgICAkcnVsZVZhbHVlcyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgJGRhdGFSb3dDb3VudCA9ICRyYW5nZUVuZFsxXSAtICRyYW5nZVN0YXJ0WzFdOwogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRydWxlcyBhcyAkcnVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBXZSBzaG91bGQgb25seSBldmVyIGhhdmUgb25lIER5bmFtaWMgRmlsdGVyIFJ1bGUgYW55d2F5CiAgICAgICAgICAgICAgICAgICAgICAgICR0b3B0ZW5SdWxlVHlwZSA9ICRydWxlLT5nZXRHcm91cGluZygpOwogICAgICAgICAgICAgICAgICAgICAgICAkcnVsZVZhbHVlID0gJHJ1bGUtPmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRydWxlT3BlcmF0b3IgPSAkcnVsZS0+Z2V0T3BlcmF0b3IoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRydWxlT3BlcmF0b3IgPT09IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX0NPTFVNTl9SVUxFX1RPUFRFTl9QRVJDRU5UKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWUgPSBmbG9vcigkcnVsZVZhbHVlICogKCRkYXRhUm93Q291bnQgLyAxMDApKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRydWxlVmFsdWUgPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRydWxlVmFsdWUgPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHJ1bGVWYWx1ZSA+IDUwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcnVsZVZhbHVlID0gNTAwOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJG1heFZhbCA9ICR0aGlzLT5jYWxjdWxhdGVUb3BUZW5WYWx1ZSgkY29sdW1uSUQsICRyYW5nZVN0YXJ0WzFdKzEsICRyYW5nZUVuZFsxXSwgJHRvcHRlblJ1bGVUeXBlLCAkcnVsZVZhbHVlKTsKCiAgICAgICAgICAgICAgICAgICAgJG9wZXJhdG9yID0gKCR0b3B0ZW5SdWxlVHlwZSA9PSBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcl9Db2x1bW5fUnVsZTo6QVVUT0ZJTFRFUl9DT0xVTU5fUlVMRV9UT1BURU5fVE9QKQogICAgICAgICAgICAgICAgICAgICAgICA\/IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX0NPTFVNTl9SVUxFX0dSRUFURVJUSEFOT1JFUVVBTAogICAgICAgICAgICAgICAgICAgICAgICA6IFBIUEV4Y2VsX1dvcmtzaGVldF9BdXRvRmlsdGVyX0NvbHVtbl9SdWxlOjpBVVRPRklMVEVSX0NPTFVNTl9SVUxFX0xFU1NUSEFOT1JFUVVBTDsKICAgICAgICAgICAgICAgICAgICAkcnVsZVZhbHVlc1tdID0gYXJyYXkoJ29wZXJhdG9yJyA9PiAkb3BlcmF0b3IsICd2YWx1ZScgPT4gJG1heFZhbCk7CiAgICAgICAgICAgICAgICAgICAgJGNvbHVtbkZpbHRlclRlc3RzWyRjb2x1bW5JRF0gPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgJ21ldGhvZCcgPT4gJ2ZpbHRlclRlc3RJbkN1c3RvbURhdGFTZXQnLAogICAgICAgICAgICAgICAgICAgICAgICAnYXJndW1lbnRzJyA9PiBhcnJheSgnZmlsdGVyUnVsZXMnID0+ICRydWxlVmFsdWVzLCAnam9pbicgPT4gUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJfQ29sdW1uOjpBVVRPRklMVEVSX0NPTFVNTl9KT0lOX09SKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJGZpbHRlckNvbHVtbi0+c2V0QXR0cmlidXRlcyhhcnJheSgnbWF4VmFsJyA9PiAkbWF4VmFsKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgovLyAgICAgICAgZWNobyAnQ29sdW1uIEZpbHRlciBUZXN0IENSSVRFUklBJyxQSFBfRU9MOwovLyAgICAgICAgdmFyX2R1bXAoJGNvbHVtbkZpbHRlclRlc3RzKTsKLy8KICAgICAgICAvLyAgICBFeGVjdXRlIHRoZSBjb2x1bW4gdGVzdHMgZm9yIGVhY2ggcm93IGluIHRoZSBhdXRvRmlsdGVyIHJhbmdlIHRvIGRldGVybWluZSBzaG93L2hpZGUsCiAgICAgICAgZm9yICgkcm93ID0gJHJhbmdlU3RhcnRbMV0rMTsgJHJvdyA8PSAkcmFuZ2VFbmRbMV07ICsrJHJvdykgewovLyAgICAgICAgICAgIGVjaG8gJ1Rlc3RpbmcgUm93ID0gJywgJHJvdyxQSFBfRU9MOwogICAgICAgICAgICAkcmVzdWx0ID0gdHJ1ZTsKICAgICAgICAgICAgZm9yZWFjaCAoJGNvbHVtbkZpbHRlclRlc3RzIGFzICRjb2x1bW5JRCA9PiAkY29sdW1uRmlsdGVyVGVzdCkgewovLyAgICAgICAgICAgICAgICBlY2hvICdUZXN0aW5nIGNlbGwgJywgJGNvbHVtbklELiRyb3csUEhQX0VPTDsKICAgICAgICAgICAgICAgICRjZWxsVmFsdWUgPSAkdGhpcy0+d29ya1NoZWV0LT5nZXRDZWxsKCRjb2x1bW5JRC4kcm93KS0+Z2V0Q2FsY3VsYXRlZFZhbHVlKCk7Ci8vICAgICAgICAgICAgICAgIGVjaG8gJ1ZhbHVlIGlzICcsICRjZWxsVmFsdWUsUEhQX0VPTDsKICAgICAgICAgICAgICAgIC8vICAgIEV4ZWN1dGUgdGhlIGZpbHRlciB0ZXN0CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJHJlc3VsdCAmJgogICAgICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KAogICAgICAgICAgICAgICAgICAgICAgICBhcnJheSgnUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXInLCAkY29sdW1uRmlsdGVyVGVzdFsnbWV0aG9kJ10pLAogICAgICAgICAgICAgICAgICAgICAgICBhcnJheSgkY2VsbFZhbHVlLCAkY29sdW1uRmlsdGVyVGVzdFsnYXJndW1lbnRzJ10pCiAgICAgICAgICAgICAgICAgICAgKTsKLy8gICAgICAgICAgICAgICAgZWNobyAoKCRyZXN1bHQpID8gJ1ZBTElEJyA6ICdJTlZBTElEJyksUEhQX0VPTDsKICAgICAgICAgICAgICAgIC8vICAgIElmIGZpbHRlciB0ZXN0IGhhcyByZXN1bHRlZCBpbiBGQUxTRSwgZXhpdCB0aGUgbG9vcCBzdHJhaWdodGF3YXkgcmF0aGVyIHRoYW4gcnVubmluZyBhbnkgbW9yZSB0ZXN0cwogICAgICAgICAgICAgICAgaWYgKCEkcmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gICAgU2V0IHNob3cvaGlkZSBmb3IgdGhlIHJvdyBiYXNlZCBvbiB0aGUgcmVzdWx0IG9mIHRoZSBhdXRvRmlsdGVyIHJlc3VsdAovLyAgICAgICAgICAgIGVjaG8gKCgkcmVzdWx0KSA\/ICdTSE9XJyA6ICdISURFJyksUEhQX0VPTDsKICAgICAgICAgICAgJHRoaXMtPndvcmtTaGVldC0+Z2V0Um93RGltZW5zaW9uKCRyb3cpLT5zZXRWaXNpYmxlKCRyZXN1bHQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKCiAgICAvKioKICAgICAqIEltcGxlbWVudCBQSFAgX19jbG9uZSB0byBjcmVhdGUgYSBkZWVwIGNsb25lLCBub3QganVzdCBhIHNoYWxsb3cgY29weS4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIF9fY2xvbmUoKQogICAgewogICAgICAgICR2YXJzID0gZ2V0X29iamVjdF92YXJzKCR0aGlzKTsKICAgICAgICBmb3JlYWNoICgkdmFycyBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICBpZiAoaXNfb2JqZWN0KCR2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIGlmICgka2V5ID09ICd3b3JrU2hlZXQnKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgRGV0YWNoIGZyb20gd29ya3NoZWV0CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnska2V5fSA9IG51bGw7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT57JGtleX0gPSBjbG9uZSAkdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmICgoaXNfYXJyYXkoJHZhbHVlKSkgJiYgKCRrZXkgPT0gJ2NvbHVtbnMnKSkgewogICAgICAgICAgICAgICAgLy8gICAgVGhlIGNvbHVtbnMgYXJyYXkgb2YgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXIgb2JqZWN0cwogICAgICAgICAgICAgICAgJHRoaXMtPnska2V5fSA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdmFsdWUgYXMgJGsgPT4gJHYpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+eyRrZXl9WyRrXSA9IGNsb25lICR2OwogICAgICAgICAgICAgICAgICAgIC8vIGF0dGFjaCB0aGUgbmV3IGNsb25lZCBDb2x1bW4gdG8gdGhpcyBuZXcgY2xvbmVkIEF1dG9maWx0ZXIgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnska2V5fVska10tPnNldFBhcmVudCgkdGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+eyRrZXl9ID0gJHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogdG9TdHJpbmcgbWV0aG9kIHJlcGxpY2F0ZXMgcHJldmlvdXMgYmVoYXZpb3IgYnkgcmV0dXJuaW5nIHRoZSByYW5nZSBpZiBvYmplY3QgaXMKICAgICAqICAgIHJlZmVyZW5jZWQgYXMgYSBwcm9wZXJ0eSBvZiBpdHMgcGFyZW50LgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX190b1N0cmluZygpCiAgICB7CiAgICAgICAgcmV0dXJuIChzdHJpbmcpICR0aGlzLT5yYW5nZTsKICAgIH0KfQo=",
    "size": "39278"
}