{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKiBQSFBFeGNlbCByb290IGRpcmVjdG9yeSAqLwppZiAoIWRlZmluZWQoJ1BIUEVYQ0VMX1JPT1QnKSkgewogICAgZGVmaW5lKCdQSFBFWENFTF9ST09UJywgZGlybmFtZShfX0ZJTEVfXykgLiAnLycpOwogICAgcmVxdWlyZShQSFBFWENFTF9ST09UIC4gJ1BIUEV4Y2VsL0F1dG9sb2FkZXIucGhwJyk7Cn0KCi8qKgogKiBQSFBFeGNlbAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMDYgLSAyMDE1IFBIUEV4Y2VsCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIKICogdmVyc2lvbiAyLjEgb2YgdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFRoaXMgbGlicmFyeSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVQogKiBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljCiAqIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIGxpYnJhcnk7IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKICogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSAgVVNBCiAqCiAqIEBjYXRlZ29yeSAgIFBIUEV4Y2VsCiAqIEBwYWNrYWdlICAgIFBIUEV4Y2VsCiAqIEBjb3B5cmlnaHQgIENvcHlyaWdodCAoYykgMjAwNiAtIDIwMTUgUEhQRXhjZWwgKGh0dHA6Ly93d3cuY29kZXBsZXguY29tL1BIUEV4Y2VsKQogKiBAbGljZW5zZSAgICBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvb2xkLWxpY2Vuc2VzL2xncGwtMi4xLnR4dCAgICBMR1BMCiAqIEB2ZXJzaW9uICAgICMjVkVSU0lPTiMjLCAjI0RBVEUjIwogKi8KY2xhc3MgUEhQRXhjZWwKewogICAgLyoqCiAgICAgKiBVbmlxdWUgSUQKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICR1bmlxdWVJRDsKCiAgICAvKioKICAgICAqIERvY3VtZW50IHByb3BlcnRpZXMKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX0RvY3VtZW50UHJvcGVydGllcwogICAgICovCiAgICBwcml2YXRlICRwcm9wZXJ0aWVzOwoKICAgIC8qKgogICAgICogRG9jdW1lbnQgc2VjdXJpdHkKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX0RvY3VtZW50U2VjdXJpdHkKICAgICAqLwogICAgcHJpdmF0ZSAkc2VjdXJpdHk7CgogICAgLyoqCiAgICAgKiBDb2xsZWN0aW9uIG9mIFdvcmtzaGVldCBvYmplY3RzCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9Xb3Jrc2hlZXRbXQogICAgICovCiAgICBwcml2YXRlICR3b3JrU2hlZXRDb2xsZWN0aW9uID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIENhbGN1bGF0aW9uIEVuZ2luZQogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfQ2FsY3VsYXRpb24KICAgICAqLwogICAgcHJpdmF0ZSAkY2FsY3VsYXRpb25FbmdpbmU7CgogICAgLyoqCiAgICAgKiBBY3RpdmUgc2hlZXQgaW5kZXgKICAgICAqCiAgICAgKiBAdmFyIGludGVnZXIKICAgICAqLwogICAgcHJpdmF0ZSAkYWN0aXZlU2hlZXRJbmRleCA9IDA7CgogICAgLyoqCiAgICAgKiBOYW1lZCByYW5nZXMKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX05hbWVkUmFuZ2VbXQogICAgICovCiAgICBwcml2YXRlICRuYW1lZFJhbmdlcyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBDZWxsWGYgc3VwZXJ2aXNvcgogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfU3R5bGUKICAgICAqLwogICAgcHJpdmF0ZSAkY2VsbFhmU3VwZXJ2aXNvcjsKCiAgICAvKioKICAgICAqIENlbGxYZiBjb2xsZWN0aW9uCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9TdHlsZVtdCiAgICAgKi8KICAgIHByaXZhdGUgJGNlbGxYZkNvbGxlY3Rpb24gPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogQ2VsbFN0eWxlWGYgY29sbGVjdGlvbgogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfU3R5bGVbXQogICAgICovCiAgICBwcml2YXRlICRjZWxsU3R5bGVYZkNvbGxlY3Rpb24gPSBhcnJheSgpOwoKICAgIC8qKgogICAgKiBoYXNNYWNyb3MgOiB0aGlzIHdvcmtib29rIGhhdmUgbWFjcm9zID8KICAgICoKICAgICogQHZhciBib29sCiAgICAqLwogICAgcHJpdmF0ZSAkaGFzTWFjcm9zID0gZmFsc2U7CgogICAgLyoqCiAgICAqIG1hY3Jvc0NvZGUgOiBhbGwgbWFjcm9zIGNvZGUgKHRoZSB2YmFQcm9qZWN0LmJpbiBmaWxlLCB0aGlzIGluY2x1ZGUgZm9ybSwgY29kZSwgIGV0Yy4pLCBudWxsIGlmIG5vIG1hY3JvCiAgICAqCiAgICAqIEB2YXIgYmluYXJ5CiAgICAqLwogICAgcHJpdmF0ZSAkbWFjcm9zQ29kZTsKICAgIC8qKgogICAgKiBtYWNyb3NDZXJ0aWZpY2F0ZSA6IGlmIG1hY3JvcyBhcmUgc2lnbmVkLCBjb250YWlucyB2YmFQcm9qZWN0U2lnbmF0dXJlLmJpbiBmaWxlLCBudWxsIGlmIG5vdCBzaWduZWQKICAgICoKICAgICogQHZhciBiaW5hcnkKICAgICovCiAgICBwcml2YXRlICRtYWNyb3NDZXJ0aWZpY2F0ZTsKCiAgICAvKioKICAgICogcmliYm9uWE1MRGF0YSA6IG51bGwgaWYgd29ya2Jvb2sgaXMnbnQgRXhjZWwgMjAwNyBvciBub3QgY29udGFpbiBhIGN1c3RvbWl6ZWQgVUkKICAgICoKICAgICogQHZhciBudWxsfHN0cmluZwogICAgKi8KICAgIHByaXZhdGUgJHJpYmJvblhNTERhdGE7CgogICAgLyoqCiAgICAqIHJpYmJvbkJpbk9iamVjdHMgOiBudWxsIGlmIHdvcmtib29rIGlzJ250IEV4Y2VsIDIwMDcgb3Igbm90IGNvbnRhaW4gZW1iZWRkZWQgb2JqZWN0cyAocGljdHVyZShzKSkgZm9yIFJpYmJvbiBFbGVtZW50cwogICAgKiBpZ25vcmVkIGlmICRyaWJib25YTUxEYXRhIGlzIG51bGwKICAgICoKICAgICogQHZhciBudWxsfGFycmF5CiAgICAqLwogICAgcHJpdmF0ZSAkcmliYm9uQmluT2JqZWN0czsKCiAgICAvKioKICAgICogVGhlIHdvcmtib29rIGhhcyBtYWNyb3MgPwogICAgKgogICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZSBpZiB3b3JrYm9vayBoYXMgbWFjcm9zLCBmYWxzZSBpZiBub3QKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFzTWFjcm9zKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmhhc01hY3JvczsKICAgIH0KCiAgICAvKioKICAgICogRGVmaW5lIGlmIGEgd29ya2Jvb2sgaGFzIG1hY3JvcwogICAgKgogICAgKiBAcGFyYW0gYm9vbGVhbiAkaGFzTWFjcm9zIHRydWV8ZmFsc2UKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0SGFzTWFjcm9zKCRoYXNNYWNyb3MgPSBmYWxzZSkKICAgIHsKICAgICAgICAkdGhpcy0+aGFzTWFjcm9zID0gKGJvb2wpICRoYXNNYWNyb3M7CiAgICB9CgogICAgLyoqCiAgICAqIFNldCB0aGUgbWFjcm9zIGNvZGUKICAgICoKICAgICogQHBhcmFtIHN0cmluZyAkTWFjcm9zQ29kZSBzdHJpbmd8bnVsbAogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRNYWNyb3NDb2RlKCRNYWNyb3NDb2RlID0gbnVsbCkKICAgIHsKICAgICAgICAkdGhpcy0+bWFjcm9zQ29kZT0kTWFjcm9zQ29kZTsKICAgICAgICAkdGhpcy0+c2V0SGFzTWFjcm9zKCFpc19udWxsKCRNYWNyb3NDb2RlKSk7CiAgICB9CgogICAgLyoqCiAgICAqIFJldHVybiB0aGUgbWFjcm9zIGNvZGUKICAgICoKICAgICogQHJldHVybiBzdHJpbmd8bnVsbAogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRNYWNyb3NDb2RlKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPm1hY3Jvc0NvZGU7CiAgICB9CgogICAgLyoqCiAgICAqIFNldCB0aGUgbWFjcm9zIGNlcnRpZmljYXRlCiAgICAqCiAgICAqIEBwYXJhbSBzdHJpbmd8bnVsbCAkQ2VydGlmaWNhdGUKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0TWFjcm9zQ2VydGlmaWNhdGUoJENlcnRpZmljYXRlID0gbnVsbCkKICAgIHsKICAgICAgICAkdGhpcy0+bWFjcm9zQ2VydGlmaWNhdGU9JENlcnRpZmljYXRlOwogICAgfQoKICAgIC8qKgogICAgKiBJcyB0aGUgcHJvamVjdCBzaWduZWQgPwogICAgKgogICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZXxmYWxzZQogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNNYWNyb3NDZXJ0aWZpY2F0ZSgpCiAgICB7CiAgICAgICAgcmV0dXJuICFpc19udWxsKCR0aGlzLT5tYWNyb3NDZXJ0aWZpY2F0ZSk7CiAgICB9CgogICAgLyoqCiAgICAqIFJldHVybiB0aGUgbWFjcm9zIGNlcnRpZmljYXRlCiAgICAqCiAgICAqIEByZXR1cm4gc3RyaW5nfG51bGwKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWFjcm9zQ2VydGlmaWNhdGUoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bWFjcm9zQ2VydGlmaWNhdGU7CiAgICB9CgogICAgLyoqCiAgICAqIFJlbW92ZSBhbGwgbWFjcm9zLCBjZXJ0aWZpY2F0ZSBmcm9tIHNwcmVhZHNoZWV0CiAgICAqCiAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRpc2NhcmRNYWNyb3MoKQogICAgewogICAgICAgICR0aGlzLT5oYXNNYWNyb3M9ZmFsc2U7CiAgICAgICAgJHRoaXMtPm1hY3Jvc0NvZGU9bnVsbDsKICAgICAgICAkdGhpcy0+bWFjcm9zQ2VydGlmaWNhdGU9bnVsbDsKICAgIH0KCiAgICAvKioKICAgICogc2V0IHJpYmJvbiBYTUwgZGF0YQogICAgKgogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRSaWJib25YTUxEYXRhKCRUYXJnZXQgPSBudWxsLCAkWE1MRGF0YSA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCFpc19udWxsKCRUYXJnZXQpICYmICFpc19udWxsKCRYTUxEYXRhKSkgewogICAgICAgICAgICAkdGhpcy0+cmliYm9uWE1MRGF0YSA9IGFycmF5KCd0YXJnZXQnID0+ICRUYXJnZXQsICdkYXRhJyA9PiAkWE1MRGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnJpYmJvblhNTERhdGEgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogcmV0cmlldmUgcmliYm9uIFhNTCBEYXRhCiAgICAqCiAgICAqIHJldHVybiBzdHJpbmd8bnVsbHxhcnJheQogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSaWJib25YTUxEYXRhKCRXaGF0ID0gJ2FsbCcpIC8vd2UgbmVlZCBzb21lIGNvbnN0YW50cyBoZXJlLi4uCiAgICB7CiAgICAgICAgJFJldHVybkRhdGEgPSBudWxsOwogICAgICAgICRXaGF0ID0gc3RydG9sb3dlcigkV2hhdCk7CiAgICAgICAgc3dpdGNoICgkV2hhdCl7CiAgICAgICAgICAgIGNhc2UgJ2FsbCc6CiAgICAgICAgICAgICAgICAkUmV0dXJuRGF0YSA9ICR0aGlzLT5yaWJib25YTUxEYXRhOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RhcmdldCc6CiAgICAgICAgICAgIGNhc2UgJ2RhdGEnOgogICAgICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR0aGlzLT5yaWJib25YTUxEYXRhKSAmJiBhcnJheV9rZXlfZXhpc3RzKCRXaGF0LCAkdGhpcy0+cmliYm9uWE1MRGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICAkUmV0dXJuRGF0YSA9ICR0aGlzLT5yaWJib25YTUxEYXRhWyRXaGF0XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRSZXR1cm5EYXRhOwogICAgfQoKICAgIC8qKgogICAgKiBzdG9yZSBiaW5hcmllcyByaWJib24gb2JqZWN0cyAocGljdHVyZXMpCiAgICAqCiAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFJpYmJvbkJpbk9iamVjdHMoJEJpbk9iamVjdHNOYW1lcyA9IG51bGwsICRCaW5PYmplY3RzRGF0YSA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCFpc19udWxsKCRCaW5PYmplY3RzTmFtZXMpICYmICFpc19udWxsKCRCaW5PYmplY3RzRGF0YSkpIHsKICAgICAgICAgICAgJHRoaXMtPnJpYmJvbkJpbk9iamVjdHMgPSBhcnJheSgnbmFtZXMnID0+ICRCaW5PYmplY3RzTmFtZXMsICdkYXRhJyA9PiAkQmluT2JqZWN0c0RhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5yaWJib25CaW5PYmplY3RzID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICogcmV0dXJuIHRoZSBleHRlbnNpb24gb2YgYSBmaWxlbmFtZS4gSW50ZXJuYWwgdXNlIGZvciBhIGFycmF5X21hcCBjYWxsYmFjayAocGhwPDUuMyBkb24ndCBsaWtlIGxhbWJkYSBmdW5jdGlvbikKICAgICoKICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGdldEV4dGVuc2lvbk9ubHkoJFRoZVBhdGgpCiAgICB7CiAgICAgICAgcmV0dXJuIHBhdGhpbmZvKCRUaGVQYXRoLCBQQVRISU5GT19FWFRFTlNJT04pOwogICAgfQoKICAgIC8qKgogICAgKiByZXRyaWV2ZSBCaW5hcmllcyBSaWJib24gT2JqZWN0cwogICAgKgogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSaWJib25CaW5PYmplY3RzKCRXaGF0ID0gJ2FsbCcpCiAgICB7CiAgICAgICAgJFJldHVybkRhdGEgPSBudWxsOwogICAgICAgICRXaGF0ID0gc3RydG9sb3dlcigkV2hhdCk7CiAgICAgICAgc3dpdGNoKCRXaGF0KSB7CiAgICAgICAgICAgIGNhc2UgJ2FsbCc6CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnJpYmJvbkJpbk9iamVjdHM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbmFtZXMnOgogICAgICAgICAgICBjYXNlICdkYXRhJzoKICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkdGhpcy0+cmliYm9uQmluT2JqZWN0cykgJiYgYXJyYXlfa2V5X2V4aXN0cygkV2hhdCwgJHRoaXMtPnJpYmJvbkJpbk9iamVjdHMpKSB7CiAgICAgICAgICAgICAgICAgICAgJFJldHVybkRhdGE9JHRoaXMtPnJpYmJvbkJpbk9iamVjdHNbJFdoYXRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3R5cGVzJzoKICAgICAgICAgICAgICAgIGlmIChpc19hcnJheSgkdGhpcy0+cmliYm9uQmluT2JqZWN0cykgJiYKICAgICAgICAgICAgICAgICAgICBhcnJheV9rZXlfZXhpc3RzKCdkYXRhJywgJHRoaXMtPnJpYmJvbkJpbk9iamVjdHMpICYmIGlzX2FycmF5KCR0aGlzLT5yaWJib25CaW5PYmplY3RzWydkYXRhJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJHRtcFR5cGVzPWFycmF5X2tleXMoJHRoaXMtPnJpYmJvbkJpbk9iamVjdHNbJ2RhdGEnXSk7CiAgICAgICAgICAgICAgICAgICAgJFJldHVybkRhdGEgPSBhcnJheV91bmlxdWUoYXJyYXlfbWFwKGFycmF5KCR0aGlzLCAnZ2V0RXh0ZW5zaW9uT25seScpLCAkdG1wVHlwZXMpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFJldHVybkRhdGE9YXJyYXkoKTsgLy8gdGhlIGNhbGxlciB3YW50IGFuIGFycmF5Li4uIG5vdCBudWxsIGlmIGVtcHR5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRSZXR1cm5EYXRhOwogICAgfQoKICAgIC8qKgogICAgKiBUaGlzIHdvcmtib29rIGhhdmUgYSBjdXN0b20gVUkgPwogICAgKgogICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZXxmYWxzZQogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNSaWJib24oKQogICAgewogICAgICAgIHJldHVybiAhaXNfbnVsbCgkdGhpcy0+cmliYm9uWE1MRGF0YSk7CiAgICB9CgogICAgLyoqCiAgICAqIFRoaXMgd29ya2Jvb2sgaGF2ZSBhZGRpdGlvbm5hbCBvYmplY3QgZm9yIHRoZSByaWJib24gPwogICAgKgogICAgKiBAcmV0dXJuIGJvb2xlYW4gdHJ1ZXxmYWxzZQogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoYXNSaWJib25CaW5PYmplY3RzKCkKICAgIHsKICAgICAgICByZXR1cm4gIWlzX251bGwoJHRoaXMtPnJpYmJvbkJpbk9iamVjdHMpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBzaGVldCB3aXRoIGEgc3BlY2lmaWVkIGNvZGUgbmFtZSBhbHJlYWR5IGV4aXN0cwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBTaGVldENvZGVOYW1lICBOYW1lIG9mIHRoZSB3b3Jrc2hlZXQgdG8gY2hlY2sKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hlZXRDb2RlTmFtZUV4aXN0cygkcFNoZWV0Q29kZU5hbWUpCiAgICB7CiAgICAgICAgcmV0dXJuICgkdGhpcy0+Z2V0U2hlZXRCeUNvZGVOYW1lKCRwU2hlZXRDb2RlTmFtZSkgIT09IG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHNoZWV0IGJ5IGNvZGUgbmFtZS4gV2FybmluZyA6IHNoZWV0IGRvbid0IGhhdmUgYWx3YXlzIGEgY29kZSBuYW1lICEKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwTmFtZSBTaGVldCBuYW1lCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2hlZXRCeUNvZGVOYW1lKCRwTmFtZSA9ICcnKQogICAgewogICAgICAgICR3b3Jrc2hlZXRDb3VudCA9IGNvdW50KCR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uKTsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkd29ya3NoZWV0Q291bnQ7ICsrJGkpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uWyRpXS0+Z2V0Q29kZU5hbWUoKSA9PSAkcE5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvblskaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBQSFBFeGNlbCB3aXRoIG9uZSBXb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkKICAgIHsKICAgICAgICAkdGhpcy0+dW5pcXVlSUQgPSB1bmlxaWQoKTsKICAgICAgICAkdGhpcy0+Y2FsY3VsYXRpb25FbmdpbmUgPSBuZXcgUEhQRXhjZWxfQ2FsY3VsYXRpb24oJHRoaXMpOwoKICAgICAgICAvLyBJbml0aWFsaXNlIHdvcmtzaGVldCBjb2xsZWN0aW9uIGFuZCBhZGQgb25lIHdvcmtzaGVldAogICAgICAgICR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvbltdID0gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldCgkdGhpcyk7CiAgICAgICAgJHRoaXMtPmFjdGl2ZVNoZWV0SW5kZXggPSAwOwoKICAgICAgICAvLyBDcmVhdGUgZG9jdW1lbnQgcHJvcGVydGllcwogICAgICAgICR0aGlzLT5wcm9wZXJ0aWVzID0gbmV3IFBIUEV4Y2VsX0RvY3VtZW50UHJvcGVydGllcygpOwoKICAgICAgICAvLyBDcmVhdGUgZG9jdW1lbnQgc2VjdXJpdHkKICAgICAgICAkdGhpcy0+c2VjdXJpdHkgPSBuZXcgUEhQRXhjZWxfRG9jdW1lbnRTZWN1cml0eSgpOwoKICAgICAgICAvLyBTZXQgbmFtZWQgcmFuZ2VzCiAgICAgICAgJHRoaXMtPm5hbWVkUmFuZ2VzID0gYXJyYXkoKTsKCiAgICAgICAgLy8gQ3JlYXRlIHRoZSBjZWxsWGYgc3VwZXJ2aXNvcgogICAgICAgICR0aGlzLT5jZWxsWGZTdXBlcnZpc29yID0gbmV3IFBIUEV4Y2VsX1N0eWxlKHRydWUpOwogICAgICAgICR0aGlzLT5jZWxsWGZTdXBlcnZpc29yLT5iaW5kUGFyZW50KCR0aGlzKTsKCiAgICAgICAgLy8gQ3JlYXRlIHRoZSBkZWZhdWx0IHN0eWxlCiAgICAgICAgJHRoaXMtPmFkZENlbGxYZihuZXcgUEhQRXhjZWxfU3R5bGUpOwogICAgICAgICR0aGlzLT5hZGRDZWxsU3R5bGVYZihuZXcgUEhQRXhjZWxfU3R5bGUpOwogICAgfQoKICAgIC8qKgogICAgICogQ29kZSB0byBleGVjdXRlIHdoZW4gdGhpcyB3b3Jrc2hlZXQgaXMgdW5zZXQoKQogICAgICoKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIF9fZGVzdHJ1Y3QoKQogICAgewogICAgICAgICR0aGlzLT5jYWxjdWxhdGlvbkVuZ2luZSA9IG51bGw7CiAgICAgICAgJHRoaXMtPmRpc2Nvbm5lY3RXb3Jrc2hlZXRzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNjb25uZWN0IGFsbCB3b3Jrc2hlZXRzIGZyb20gdGhpcyBQSFBFeGNlbCB3b3JrYm9vayBvYmplY3QsCiAgICAgKiAgICB0eXBpY2FsbHkgc28gdGhhdCB0aGUgUEhQRXhjZWwgb2JqZWN0IGNhbiBiZSB1bnNldAogICAgICoKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRpc2Nvbm5lY3RXb3Jrc2hlZXRzKCkKICAgIHsKICAgICAgICAkd29ya3NoZWV0ID0gbnVsbDsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvbiBhcyAkayA9PiAmJHdvcmtzaGVldCkgewogICAgICAgICAgICAkd29ya3NoZWV0LT5kaXNjb25uZWN0Q2VsbHMoKTsKICAgICAgICAgICAgJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb25bJGtdID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgdW5zZXQoJHdvcmtzaGVldCk7CiAgICAgICAgJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb24gPSBhcnJheSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBjYWxjdWxhdGlvbiBlbmdpbmUgZm9yIHRoaXMgd29ya3NoZWV0CiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9DYWxjdWxhdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2FsY3VsYXRpb25FbmdpbmUoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y2FsY3VsYXRpb25FbmdpbmU7CiAgICB9ICAgIC8vICAgIGZ1bmN0aW9uIGdldENlbGxDYWNoZUNvbnRyb2xsZXIoKQoKICAgIC8qKgogICAgICogR2V0IHByb3BlcnRpZXMKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX0RvY3VtZW50UHJvcGVydGllcwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UHJvcGVydGllcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5wcm9wZXJ0aWVzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHByb3BlcnRpZXMKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWxfRG9jdW1lbnRQcm9wZXJ0aWVzICAgICRwVmFsdWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFByb3BlcnRpZXMoUEhQRXhjZWxfRG9jdW1lbnRQcm9wZXJ0aWVzICRwVmFsdWUpCiAgICB7CiAgICAgICAgJHRoaXMtPnByb3BlcnRpZXMgPSAkcFZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHNlY3VyaXR5CiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Eb2N1bWVudFNlY3VyaXR5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZWN1cml0eSgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zZWN1cml0eTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBzZWN1cml0eQogICAgICoKICAgICAqIEBwYXJhbSBQSFBFeGNlbF9Eb2N1bWVudFNlY3VyaXR5ICAgICRwVmFsdWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFNlY3VyaXR5KFBIUEV4Y2VsX0RvY3VtZW50U2VjdXJpdHkgJHBWYWx1ZSkKICAgIHsKICAgICAgICAkdGhpcy0+c2VjdXJpdHkgPSAkcFZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFjdGl2ZSBzaGVldAogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKgogICAgICogQHRocm93cyBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEFjdGl2ZVNoZWV0KCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmdldFNoZWV0KCR0aGlzLT5hY3RpdmVTaGVldEluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBzaGVldCBhbmQgYWRkIGl0IHRvIHRoaXMgd29ya2Jvb2sKICAgICAqCiAgICAgKiBAcGFyYW0gIGludHxudWxsICRpU2hlZXRJbmRleCBJbmRleCB3aGVyZSBzaGVldCBzaG91bGQgZ28gKDAsMSwuLi4sIG9yIG51bGwgZm9yIGxhc3QpCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICogQHRocm93cyBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZVNoZWV0KCRpU2hlZXRJbmRleCA9IG51bGwpCiAgICB7CiAgICAgICAgJG5ld1NoZWV0ID0gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldCgkdGhpcyk7CiAgICAgICAgJHRoaXMtPmFkZFNoZWV0KCRuZXdTaGVldCwgJGlTaGVldEluZGV4KTsKICAgICAgICByZXR1cm4gJG5ld1NoZWV0OwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBzaGVldCB3aXRoIGEgc3BlY2lmaWVkIG5hbWUgYWxyZWFkeSBleGlzdHMKICAgICAqCiAgICAgKiBAcGFyYW0gIHN0cmluZyAkcFNoZWV0TmFtZSAgTmFtZSBvZiB0aGUgd29ya3NoZWV0IHRvIGNoZWNrCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNoZWV0TmFtZUV4aXN0cygkcFNoZWV0TmFtZSkKICAgIHsKICAgICAgICByZXR1cm4gKCR0aGlzLT5nZXRTaGVldEJ5TmFtZSgkcFNoZWV0TmFtZSkgIT09IG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIHNoZWV0CiAgICAgKgogICAgICogQHBhcmFtICBQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldAogICAgICogQHBhcmFtICBpbnR8bnVsbCAkaVNoZWV0SW5kZXggSW5kZXggd2hlcmUgc2hlZXQgc2hvdWxkIGdvICgwLDEsLi4uLCBvciBudWxsIGZvciBsYXN0KQogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTaGVldChQSFBFeGNlbF9Xb3Jrc2hlZXQgJHBTaGVldCwgJGlTaGVldEluZGV4ID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPnNoZWV0TmFtZUV4aXN0cygkcFNoZWV0LT5nZXRUaXRsZSgpKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgIldvcmtib29rIGFscmVhZHkgY29udGFpbnMgYSB3b3Jrc2hlZXQgbmFtZWQgJ3skcFNoZWV0LT5nZXRUaXRsZSgpfScuIFJlbmFtZSB0aGlzIHdvcmtzaGVldCBmaXJzdC4iCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoJGlTaGVldEluZGV4ID09PSBudWxsKSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+YWN0aXZlU2hlZXRJbmRleCA8IDApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5hY3RpdmVTaGVldEluZGV4ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvbltdID0gJHBTaGVldDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBJbnNlcnQgdGhlIHNoZWV0IGF0IHRoZSByZXF1ZXN0ZWQgaW5kZXgKICAgICAgICAgICAgYXJyYXlfc3BsaWNlKAogICAgICAgICAgICAgICAgJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb24sCiAgICAgICAgICAgICAgICAkaVNoZWV0SW5kZXgsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgYXJyYXkoJHBTaGVldCkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIC8vIEFkanVzdCBhY3RpdmUgc2hlZXQgaW5kZXggaWYgbmVjZXNzYXJ5CiAgICAgICAgICAgIGlmICgkdGhpcy0+YWN0aXZlU2hlZXRJbmRleCA+PSAkaVNoZWV0SW5kZXgpIHsKICAgICAgICAgICAgICAgICsrJHRoaXMtPmFjdGl2ZVNoZWV0SW5kZXg7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkcFNoZWV0LT5nZXRQYXJlbnQoKSA9PT0gbnVsbCkgewogICAgICAgICAgICAkcFNoZWV0LT5yZWJpbmRQYXJlbnQoJHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRwU2hlZXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgc2hlZXQgYnkgaW5kZXgKICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAkcEluZGV4IEFjdGl2ZSBzaGVldCBpbmRleAogICAgICogQHRocm93cyBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlbW92ZVNoZWV0QnlJbmRleCgkcEluZGV4ID0gMCkKICAgIHsKCiAgICAgICAgJG51bVNoZWV0cyA9IGNvdW50KCR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uKTsKICAgICAgICBpZiAoJHBJbmRleCA+ICRudW1TaGVldHMgLSAxKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAiWW91IHRyaWVkIHRvIHJlbW92ZSBhIHNoZWV0IGJ5IHRoZSBvdXQgb2YgYm91bmRzIGluZGV4OiB7JHBJbmRleH0uIFRoZSBhY3R1YWwgbnVtYmVyIG9mIHNoZWV0cyBpcyB7JG51bVNoZWV0c30uIgogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFycmF5X3NwbGljZSgkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvbiwgJHBJbmRleCwgMSk7CiAgICAgICAgfQogICAgICAgIC8vIEFkanVzdCBhY3RpdmUgc2hlZXQgaW5kZXggaWYgbmVjZXNzYXJ5CiAgICAgICAgaWYgKCgkdGhpcy0+YWN0aXZlU2hlZXRJbmRleCA+PSAkcEluZGV4KSAmJgogICAgICAgICAgICAoJHBJbmRleCA+IGNvdW50KCR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uKSAtIDEpKSB7CiAgICAgICAgICAgIC0tJHRoaXMtPmFjdGl2ZVNoZWV0SW5kZXg7CiAgICAgICAgfQoKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBzaGVldCBieSBpbmRleAogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICRwSW5kZXggU2hlZXQgaW5kZXgKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2hlZXQoJHBJbmRleCA9IDApCiAgICB7CiAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvblskcEluZGV4XSkpIHsKICAgICAgICAgICAgJG51bVNoZWV0cyA9ICR0aGlzLT5nZXRTaGVldENvdW50KCk7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAiWW91ciByZXF1ZXN0ZWQgc2hlZXQgaW5kZXg6IHskcEluZGV4fSBpcyBvdXQgb2YgYm91bmRzLiBUaGUgYWN0dWFsIG51bWJlciBvZiBzaGVldHMgaXMgeyRudW1TaGVldHN9LiIKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvblskcEluZGV4XTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhbGwgc2hlZXRzCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRbXQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsU2hlZXRzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgc2hlZXQgYnkgbmFtZQogICAgICoKICAgICAqIEBwYXJhbSAgc3RyaW5nICRwTmFtZSBTaGVldCBuYW1lCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2hlZXRCeU5hbWUoJHBOYW1lID0gJycpCiAgICB7CiAgICAgICAgJHdvcmtzaGVldENvdW50ID0gY291bnQoJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb24pOwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICR3b3Jrc2hlZXRDb3VudDsgKyskaSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb25bJGldLT5nZXRUaXRsZSgpID09PSAkcE5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvblskaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGluZGV4IGZvciBzaGVldAogICAgICoKICAgICAqIEBwYXJhbSAgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQKICAgICAqIEByZXR1cm4gaW50IFNoZWV0IGluZGV4CiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0SW5kZXgoUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb24gYXMgJGtleSA9PiAkdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCR2YWx1ZS0+Z2V0SGFzaENvZGUoKSA9PSAkcFNoZWV0LT5nZXRIYXNoQ29kZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJGtleTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiU2hlZXQgZG9lcyBub3QgZXhpc3QuIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgaW5kZXggZm9yIHNoZWV0IGJ5IHNoZWV0IG5hbWUuCiAgICAgKgogICAgICogQHBhcmFtICBzdHJpbmcgJHNoZWV0TmFtZSBTaGVldCBuYW1lIHRvIG1vZGlmeSBpbmRleCBmb3IKICAgICAqIEBwYXJhbSAgaW50ICRuZXdJbmRleCBOZXcgaW5kZXggZm9yIHRoZSBzaGVldAogICAgICogQHJldHVybiBpbnQgTmV3IHNoZWV0IGluZGV4CiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0SW5kZXhCeU5hbWUoJHNoZWV0TmFtZSwgJG5ld0luZGV4KQogICAgewogICAgICAgICRvbGRJbmRleCA9ICR0aGlzLT5nZXRJbmRleCgkdGhpcy0+Z2V0U2hlZXRCeU5hbWUoJHNoZWV0TmFtZSkpOwogICAgICAgICRwU2hlZXQgPSBhcnJheV9zcGxpY2UoCiAgICAgICAgICAgICR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uLAogICAgICAgICAgICAkb2xkSW5kZXgsCiAgICAgICAgICAgIDEKICAgICAgICApOwogICAgICAgIGFycmF5X3NwbGljZSgKICAgICAgICAgICAgJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb24sCiAgICAgICAgICAgICRuZXdJbmRleCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgJHBTaGVldAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRuZXdJbmRleDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBzaGVldCBjb3VudAogICAgICoKICAgICAqIEByZXR1cm4gaW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTaGVldENvdW50KCkKICAgIHsKICAgICAgICByZXR1cm4gY291bnQoJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb24pOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGFjdGl2ZSBzaGVldCBpbmRleAogICAgICoKICAgICAqIEByZXR1cm4gaW50IEFjdGl2ZSBzaGVldCBpbmRleAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWN0aXZlU2hlZXRJbmRleCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hY3RpdmVTaGVldEluZGV4OwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGFjdGl2ZSBzaGVldCBpbmRleAogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICRwSW5kZXggQWN0aXZlIHNoZWV0IGluZGV4CiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldEFjdGl2ZVNoZWV0SW5kZXgoJHBJbmRleCA9IDApCiAgICB7CiAgICAgICAgJG51bVNoZWV0cyA9IGNvdW50KCR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uKTsKCiAgICAgICAgaWYgKCRwSW5kZXggPiAkbnVtU2hlZXRzIC0gMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgIllvdSB0cmllZCB0byBzZXQgYSBzaGVldCBhY3RpdmUgYnkgdGhlIG91dCBvZiBib3VuZHMgaW5kZXg6IHskcEluZGV4fS4gVGhlIGFjdHVhbCBudW1iZXIgb2Ygc2hlZXRzIGlzIHskbnVtU2hlZXRzfS4iCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmFjdGl2ZVNoZWV0SW5kZXggPSAkcEluZGV4OwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmdldEFjdGl2ZVNoZWV0KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYWN0aXZlIHNoZWV0IGluZGV4IGJ5IG5hbWUKICAgICAqCiAgICAgKiBAcGFyYW0gIHN0cmluZyAkcFZhbHVlIFNoZWV0IHRpdGxlCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICogQHRocm93cyBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldEFjdGl2ZVNoZWV0SW5kZXhCeU5hbWUoJHBWYWx1ZSA9ICcnKQogICAgewogICAgICAgIGlmICgoJHdvcmtzaGVldCA9ICR0aGlzLT5nZXRTaGVldEJ5TmFtZSgkcFZhbHVlKSkgaW5zdGFuY2VvZiBQSFBFeGNlbF9Xb3Jrc2hlZXQpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEFjdGl2ZVNoZWV0SW5kZXgoJHRoaXMtPmdldEluZGV4KCR3b3Jrc2hlZXQpKTsKICAgICAgICAgICAgcmV0dXJuICR3b3Jrc2hlZXQ7CiAgICAgICAgfQoKICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCdXb3JrYm9vayBkb2VzIG5vdCBjb250YWluIHNoZWV0OicgLiAkcFZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBzaGVldCBuYW1lcwogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nW10KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNoZWV0TmFtZXMoKQogICAgewogICAgICAgICRyZXR1cm5WYWx1ZSA9IGFycmF5KCk7CiAgICAgICAgJHdvcmtzaGVldENvdW50ID0gJHRoaXMtPmdldFNoZWV0Q291bnQoKTsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkd29ya3NoZWV0Q291bnQ7ICsrJGkpIHsKICAgICAgICAgICAgJHJldHVyblZhbHVlW10gPSAkdGhpcy0+Z2V0U2hlZXQoJGkpLT5nZXRUaXRsZSgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRyZXR1cm5WYWx1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBleHRlcm5hbCBzaGVldAogICAgICoKICAgICAqIEBwYXJhbSAgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgRXh0ZXJuYWwgc2hlZXQgdG8gYWRkCiAgICAgKiBAcGFyYW0gIGludHxudWxsICRpU2hlZXRJbmRleCBJbmRleCB3aGVyZSBzaGVldCBzaG91bGQgZ28gKDAsMSwuLi4sIG9yIG51bGwgZm9yIGxhc3QpCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZEV4dGVybmFsU2hlZXQoUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQsICRpU2hlZXRJbmRleCA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5zaGVldE5hbWVFeGlzdHMoJHBTaGVldC0+Z2V0VGl0bGUoKSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiV29ya2Jvb2sgYWxyZWFkeSBjb250YWlucyBhIHdvcmtzaGVldCBuYW1lZCAneyRwU2hlZXQtPmdldFRpdGxlKCl9Jy4gUmVuYW1lIHRoZSBleHRlcm5hbCBzaGVldCBmaXJzdC4iKTsKICAgICAgICB9CgogICAgICAgIC8vIGNvdW50IGhvdyBtYW55IGNlbGxYZnMgdGhlcmUgYXJlIGluIHRoaXMgd29ya2Jvb2sgY3VycmVudGx5LCB3ZSB3aWxsIG5lZWQgdGhpcyBiZWxvdwogICAgICAgICRjb3VudENlbGxYZnMgPSBjb3VudCgkdGhpcy0+Y2VsbFhmQ29sbGVjdGlvbik7CgogICAgICAgIC8vIGNvcHkgYWxsIHRoZSBzaGFyZWQgY2VsbFhmcyBmcm9tIHRoZSBleHRlcm5hbCB3b3JrYm9vayBhbmQgYXBwZW5kIHRoZW0gdG8gdGhlIGN1cnJlbnQKICAgICAgICBmb3JlYWNoICgkcFNoZWV0LT5nZXRQYXJlbnQoKS0+Z2V0Q2VsbFhmQ29sbGVjdGlvbigpIGFzICRjZWxsWGYpIHsKICAgICAgICAgICAgJHRoaXMtPmFkZENlbGxYZihjbG9uZSAkY2VsbFhmKTsKICAgICAgICB9CgogICAgICAgIC8vIG1vdmUgc2hlZXQgdG8gdGhpcyB3b3JrYm9vawogICAgICAgICRwU2hlZXQtPnJlYmluZFBhcmVudCgkdGhpcyk7CgogICAgICAgIC8vIHVwZGF0ZSB0aGUgY2VsbFhmcwogICAgICAgIGZvcmVhY2ggKCRwU2hlZXQtPmdldENlbGxDb2xsZWN0aW9uKGZhbHNlKSBhcyAkY2VsbElEKSB7CiAgICAgICAgICAgICRjZWxsID0gJHBTaGVldC0+Z2V0Q2VsbCgkY2VsbElEKTsKICAgICAgICAgICAgJGNlbGwtPnNldFhmSW5kZXgoJGNlbGwtPmdldFhmSW5kZXgoKSArICRjb3VudENlbGxYZnMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRTaGVldCgkcFNoZWV0LCAkaVNoZWV0SW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IG5hbWVkIHJhbmdlcwogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfTmFtZWRSYW5nZVtdCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXROYW1lZFJhbmdlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5uYW1lZFJhbmdlczsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBuYW1lZCByYW5nZQogICAgICoKICAgICAqIEBwYXJhbSAgUEhQRXhjZWxfTmFtZWRSYW5nZSAkbmFtZWRSYW5nZQogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGROYW1lZFJhbmdlKFBIUEV4Y2VsX05hbWVkUmFuZ2UgJG5hbWVkUmFuZ2UpCiAgICB7CiAgICAgICAgaWYgKCRuYW1lZFJhbmdlLT5nZXRTY29wZSgpID09IG51bGwpIHsKICAgICAgICAgICAgLy8gZ2xvYmFsIHNjb3BlCiAgICAgICAgICAgICR0aGlzLT5uYW1lZFJhbmdlc1skbmFtZWRSYW5nZS0+Z2V0TmFtZSgpXSA9ICRuYW1lZFJhbmdlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGxvY2FsIHNjb3BlCiAgICAgICAgICAgICR0aGlzLT5uYW1lZFJhbmdlc1skbmFtZWRSYW5nZS0+Z2V0U2NvcGUoKS0+Z2V0VGl0bGUoKS4nIScuJG5hbWVkUmFuZ2UtPmdldE5hbWUoKV0gPSAkbmFtZWRSYW5nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgbmFtZWQgcmFuZ2UKICAgICAqCiAgICAgKiBAcGFyYW0gIHN0cmluZyAkbmFtZWRSYW5nZQogICAgICogQHBhcmFtICBQSFBFeGNlbF9Xb3Jrc2hlZXR8bnVsbCAkcFNoZWV0IFNjb3BlLiBVc2UgbnVsbCBmb3IgZ2xvYmFsIHNjb3BlCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX05hbWVkUmFuZ2V8bnVsbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TmFtZWRSYW5nZSgkbmFtZWRSYW5nZSwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsKQogICAgewogICAgICAgICRyZXR1cm5WYWx1ZSA9IG51bGw7CgogICAgICAgIGlmICgkbmFtZWRSYW5nZSAhPSAnJyAmJiAoJG5hbWVkUmFuZ2UgIT09IG51bGwpKSB7CiAgICAgICAgICAgIC8vIGZpcnN0IGxvb2sgZm9yIGdsb2JhbCBkZWZpbmVkIG5hbWUKICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5uYW1lZFJhbmdlc1skbmFtZWRSYW5nZV0pKSB7CiAgICAgICAgICAgICAgICAkcmV0dXJuVmFsdWUgPSAkdGhpcy0+bmFtZWRSYW5nZXNbJG5hbWVkUmFuZ2VdOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB0aGVuIGxvb2sgZm9yIGxvY2FsIGRlZmluZWQgbmFtZSAoaGFzIHByaW9yaXR5IG92ZXIgZ2xvYmFsIGRlZmluZWQgbmFtZSBpZiBib3RoIG5hbWVzIGV4aXN0KQogICAgICAgICAgICBpZiAoKCRwU2hlZXQgIT09IG51bGwpICYmIGlzc2V0KCR0aGlzLT5uYW1lZFJhbmdlc1skcFNoZWV0LT5nZXRUaXRsZSgpIC4gJyEnIC4gJG5hbWVkUmFuZ2VdKSkgewogICAgICAgICAgICAgICAgJHJldHVyblZhbHVlID0gJHRoaXMtPm5hbWVkUmFuZ2VzWyRwU2hlZXQtPmdldFRpdGxlKCkgLiAnIScgLiAkbmFtZWRSYW5nZV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmV0dXJuVmFsdWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgbmFtZWQgcmFuZ2UKICAgICAqCiAgICAgKiBAcGFyYW0gIHN0cmluZyAgJG5hbWVkUmFuZ2UKICAgICAqIEBwYXJhbSAgUEhQRXhjZWxfV29ya3NoZWV0fG51bGwgICRwU2hlZXQgIFNjb3BlOiB1c2UgbnVsbCBmb3IgZ2xvYmFsIHNjb3BlLgogICAgICogQHJldHVybiBQSFBFeGNlbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVtb3ZlTmFtZWRSYW5nZSgkbmFtZWRSYW5nZSwgUEhQRXhjZWxfV29ya3NoZWV0ICRwU2hlZXQgPSBudWxsKQogICAgewogICAgICAgIGlmICgkcFNoZWV0ID09PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+bmFtZWRSYW5nZXNbJG5hbWVkUmFuZ2VdKSkgewogICAgICAgICAgICAgICAgdW5zZXQoJHRoaXMtPm5hbWVkUmFuZ2VzWyRuYW1lZFJhbmdlXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPm5hbWVkUmFuZ2VzWyRwU2hlZXQtPmdldFRpdGxlKCkgLiAnIScgLiAkbmFtZWRSYW5nZV0pKSB7CiAgICAgICAgICAgICAgICB1bnNldCgkdGhpcy0+bmFtZWRSYW5nZXNbJHBTaGVldC0+Z2V0VGl0bGUoKSAuICchJyAuICRuYW1lZFJhbmdlXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHdvcmtzaGVldCBpdGVyYXRvcgogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0SXRlcmF0b3IKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFdvcmtzaGVldEl0ZXJhdG9yKCkKICAgIHsKICAgICAgICByZXR1cm4gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldEl0ZXJhdG9yKCR0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgd29ya2Jvb2sgKCE9IGNsb25lISkKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjb3B5KCkKICAgIHsKICAgICAgICAkY29waWVkID0gY2xvbmUgJHRoaXM7CgogICAgICAgICR3b3Jrc2hlZXRDb3VudCA9IGNvdW50KCR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uKTsKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkd29ya3NoZWV0Q291bnQ7ICsrJGkpIHsKICAgICAgICAgICAgJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb25bJGldID0gJHRoaXMtPndvcmtTaGVldENvbGxlY3Rpb25bJGldLT5jb3B5KCk7CiAgICAgICAgICAgICR0aGlzLT53b3JrU2hlZXRDb2xsZWN0aW9uWyRpXS0+cmViaW5kUGFyZW50KCR0aGlzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkY29waWVkOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IFBIUCBfX2Nsb25lIHRvIGNyZWF0ZSBhIGRlZXAgY2xvbmUsIG5vdCBqdXN0IGEgc2hhbGxvdyBjb3B5LgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jbG9uZSgpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMgYXMgJGtleSA9PiAkdmFsKSB7CiAgICAgICAgICAgIGlmIChpc19vYmplY3QoJHZhbCkgfHwgKGlzX2FycmF5KCR2YWwpKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnska2V5fSA9IHVuc2VyaWFsaXplKHNlcmlhbGl6ZSgkdmFsKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHdvcmtib29rIGNvbGxlY3Rpb24gb2YgY2VsbFhmcwogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfU3R5bGVbXQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2VsbFhmQ29sbGVjdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGNlbGxYZiBieSBpbmRleAogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICRwSW5kZXgKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfU3R5bGUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENlbGxYZkJ5SW5kZXgoJHBJbmRleCA9IDApCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uWyRwSW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGNlbGxYZiBieSBoYXNoIGNvZGUKICAgICAqCiAgICAgKiBAcGFyYW0gIHN0cmluZyAkcFZhbHVlCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1N0eWxlfGJvb2xlYW4gRmFsc2UgaWYgbm8gbWF0Y2ggZm91bmQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENlbGxYZkJ5SGFzaENvZGUoJHBWYWx1ZSA9ICcnKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uIGFzICRjZWxsWGYpIHsKICAgICAgICAgICAgaWYgKCRjZWxsWGYtPmdldEhhc2hDb2RlKCkgPT0gJHBWYWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRjZWxsWGY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgc3R5bGUgZXhpc3RzIGluIHN0eWxlIGNvbGxlY3Rpb24KICAgICAqCiAgICAgKiBAcGFyYW0gIFBIUEV4Y2VsX1N0eWxlICRwQ2VsbFN0eWxlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNlbGxYZkV4aXN0cygkcENlbGxTdHlsZSA9IG51bGwpCiAgICB7CiAgICAgICAgcmV0dXJuIGluX2FycmF5KCRwQ2VsbFN0eWxlLCAkdGhpcy0+Y2VsbFhmQ29sbGVjdGlvbiwgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgZGVmYXVsdCBzdHlsZQogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfU3R5bGUKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXREZWZhdWx0U3R5bGUoKQogICAgewogICAgICAgIGlmIChpc3NldCgkdGhpcy0+Y2VsbFhmQ29sbGVjdGlvblswXSkpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uWzBdOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCdObyBkZWZhdWx0IHN0eWxlIGZvdW5kIGZvciB0aGlzIHdvcmtib29rJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBjZWxsWGYgdG8gdGhlIHdvcmtib29rCiAgICAgKgogICAgICogQHBhcmFtIFBIUEV4Y2VsX1N0eWxlICRzdHlsZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ2VsbFhmKFBIUEV4Y2VsX1N0eWxlICRzdHlsZSkKICAgIHsKICAgICAgICAkdGhpcy0+Y2VsbFhmQ29sbGVjdGlvbltdID0gJHN0eWxlOwogICAgICAgICRzdHlsZS0+c2V0SW5kZXgoY291bnQoJHRoaXMtPmNlbGxYZkNvbGxlY3Rpb24pIC0gMSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgY2VsbFhmIGJ5IGluZGV4LiBJdCBpcyBlbnN1cmVkIHRoYXQgYWxsIGNlbGxzIGdldCB0aGVpciB4ZiBpbmRleCB1cGRhdGVkLgogICAgICoKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRwSW5kZXggSW5kZXggdG8gY2VsbFhmCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVtb3ZlQ2VsbFhmQnlJbmRleCgkcEluZGV4ID0gMCkKICAgIHsKICAgICAgICBpZiAoJHBJbmRleCA+IGNvdW50KCR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uKSAtIDEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiQ2VsbFhmIGluZGV4IGlzIG91dCBvZiBib3VuZHMuIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gZmlyc3QgcmVtb3ZlIHRoZSBjZWxsWGYKICAgICAgICAgICAgYXJyYXlfc3BsaWNlKCR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uLCAkcEluZGV4LCAxKTsKCiAgICAgICAgICAgIC8vIHRoZW4gdXBkYXRlIGNlbGxYZiBpbmRleGVzIGZvciBjZWxscwogICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+d29ya1NoZWV0Q29sbGVjdGlvbiBhcyAkd29ya3NoZWV0KSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkd29ya3NoZWV0LT5nZXRDZWxsQ29sbGVjdGlvbihmYWxzZSkgYXMgJGNlbGxJRCkgewogICAgICAgICAgICAgICAgICAgICRjZWxsID0gJHdvcmtzaGVldC0+Z2V0Q2VsbCgkY2VsbElEKTsKICAgICAgICAgICAgICAgICAgICAkeGZJbmRleCA9ICRjZWxsLT5nZXRYZkluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR4ZkluZGV4ID4gJHBJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWNyZWFzZSB4ZiBpbmRleCBieSAxCiAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsLT5zZXRYZkluZGV4KCR4ZkluZGV4IC0gMSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCR4ZkluZGV4ID09ICRwSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRvIGRlZmF1bHQgeGYgaW5kZXggMAogICAgICAgICAgICAgICAgICAgICAgICAkY2VsbC0+c2V0WGZJbmRleCgwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNlbGxYZiBzdXBlcnZpc29yCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9TdHlsZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2VsbFhmU3VwZXJ2aXNvcigpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jZWxsWGZTdXBlcnZpc29yOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JrYm9vayBjb2xsZWN0aW9uIG9mIGNlbGxTdHlsZVhmcwogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfU3R5bGVbXQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2VsbFN0eWxlWGZDb2xsZWN0aW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmNlbGxTdHlsZVhmQ29sbGVjdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjZWxsU3R5bGVYZiBieSBpbmRleAogICAgICoKICAgICAqIEBwYXJhbSBpbnRlZ2VyICRwSW5kZXggSW5kZXggdG8gY2VsbFhmCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1N0eWxlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDZWxsU3R5bGVYZkJ5SW5kZXgoJHBJbmRleCA9IDApCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jZWxsU3R5bGVYZkNvbGxlY3Rpb25bJHBJbmRleF07CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY2VsbFN0eWxlWGYgYnkgaGFzaCBjb2RlCiAgICAgKgogICAgICogQHBhcmFtICBzdHJpbmcgJHBWYWx1ZQogICAgICogQHJldHVybiBQSFBFeGNlbF9TdHlsZXxib29sZWFuIEZhbHNlIGlmIG5vIG1hdGNoIGZvdW5kCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDZWxsU3R5bGVYZkJ5SGFzaENvZGUoJHBWYWx1ZSA9ICcnKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jZWxsU3R5bGVYZkNvbGxlY3Rpb24gYXMgJGNlbGxTdHlsZVhmKSB7CiAgICAgICAgICAgIGlmICgkY2VsbFN0eWxlWGYtPmdldEhhc2hDb2RlKCkgPT0gJHBWYWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRjZWxsU3R5bGVYZjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBjZWxsU3R5bGVYZiB0byB0aGUgd29ya2Jvb2sKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWxfU3R5bGUgJHBTdHlsZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ2VsbFN0eWxlWGYoUEhQRXhjZWxfU3R5bGUgJHBTdHlsZSkKICAgIHsKICAgICAgICAkdGhpcy0+Y2VsbFN0eWxlWGZDb2xsZWN0aW9uW10gPSAkcFN0eWxlOwogICAgICAgICRwU3R5bGUtPnNldEluZGV4KGNvdW50KCR0aGlzLT5jZWxsU3R5bGVYZkNvbGxlY3Rpb24pIC0gMSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgY2VsbFN0eWxlWGYgYnkgaW5kZXgKICAgICAqCiAgICAgKiBAcGFyYW0gaW50ZWdlciAkcEluZGV4IEluZGV4IHRvIGNlbGxYZgogICAgICogQHRocm93cyBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlbW92ZUNlbGxTdHlsZVhmQnlJbmRleCgkcEluZGV4ID0gMCkKICAgIHsKICAgICAgICBpZiAoJHBJbmRleCA+IGNvdW50KCR0aGlzLT5jZWxsU3R5bGVYZkNvbGxlY3Rpb24pIC0gMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCJDZWxsU3R5bGVYZiBpbmRleCBpcyBvdXQgb2YgYm91bmRzLiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFycmF5X3NwbGljZSgkdGhpcy0+Y2VsbFN0eWxlWGZDb2xsZWN0aW9uLCAkcEluZGV4LCAxKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbGltaW5hdGUgYWxsIHVubmVlZGVkIGNlbGxYZiBhbmQgYWZ0ZXJ3YXJkcyB1cGRhdGUgdGhlIHhmSW5kZXggZm9yIGFsbCBjZWxscwogICAgICogYW5kIGNvbHVtbnMgaW4gdGhlIHdvcmtib29rCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnYXJiYWdlQ29sbGVjdCgpCiAgICB7CiAgICAgICAgLy8gaG93IG1hbnkgcmVmZXJlbmNlcyBhcmUgdGhlcmUgdG8gZWFjaCBjZWxsWGYgPwogICAgICAgICRjb3VudFJlZmVyZW5jZXNDZWxsWGYgPSBhcnJheSgpOwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uIGFzICRpbmRleCA9PiAkY2VsbFhmKSB7CiAgICAgICAgICAgICRjb3VudFJlZmVyZW5jZXNDZWxsWGZbJGluZGV4XSA9IDA7CiAgICAgICAgfQoKICAgICAgICBmb3JlYWNoICgkdGhpcy0+Z2V0V29ya3NoZWV0SXRlcmF0b3IoKSBhcyAkc2hlZXQpIHsKICAgICAgICAgICAgLy8gZnJvbSBjZWxscwogICAgICAgICAgICBmb3JlYWNoICgkc2hlZXQtPmdldENlbGxDb2xsZWN0aW9uKGZhbHNlKSBhcyAkY2VsbElEKSB7CiAgICAgICAgICAgICAgICAkY2VsbCA9ICRzaGVldC0+Z2V0Q2VsbCgkY2VsbElEKTsKICAgICAgICAgICAgICAgICsrJGNvdW50UmVmZXJlbmNlc0NlbGxYZlskY2VsbC0+Z2V0WGZJbmRleCgpXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZnJvbSByb3cgZGltZW5zaW9ucwogICAgICAgICAgICBmb3JlYWNoICgkc2hlZXQtPmdldFJvd0RpbWVuc2lvbnMoKSBhcyAkcm93RGltZW5zaW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoJHJvd0RpbWVuc2lvbi0+Z2V0WGZJbmRleCgpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgKyskY291bnRSZWZlcmVuY2VzQ2VsbFhmWyRyb3dEaW1lbnNpb24tPmdldFhmSW5kZXgoKV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZyb20gY29sdW1uIGRpbWVuc2lvbnMKICAgICAgICAgICAgZm9yZWFjaCAoJHNoZWV0LT5nZXRDb2x1bW5EaW1lbnNpb25zKCkgYXMgJGNvbHVtbkRpbWVuc2lvbikgewogICAgICAgICAgICAgICAgKyskY291bnRSZWZlcmVuY2VzQ2VsbFhmWyRjb2x1bW5EaW1lbnNpb24tPmdldFhmSW5kZXgoKV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZSBjZWxsWGZzIHdpdGhvdXQgcmVmZXJlbmNlcyBhbmQgY3JlYXRlIG1hcHBpbmcgc28gd2UgY2FuIHVwZGF0ZSB4ZkluZGV4CiAgICAgICAgLy8gZm9yIGFsbCBjZWxscyBhbmQgY29sdW1ucwogICAgICAgICRjb3VudE5lZWRlZENlbGxYZnMgPSAwOwogICAgICAgICRtYXAgPSBhcnJheSgpOwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uIGFzICRpbmRleCA9PiAkY2VsbFhmKSB7CiAgICAgICAgICAgIGlmICgkY291bnRSZWZlcmVuY2VzQ2VsbFhmWyRpbmRleF0gPiAwIHx8ICRpbmRleCA9PSAwKSB7IC8vIHdlIG11c3QgbmV2ZXIgcmVtb3ZlIHRoZSBmaXJzdCBjZWxsWGYKICAgICAgICAgICAgICAgICsrJGNvdW50TmVlZGVkQ2VsbFhmczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uWyRpbmRleF0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRtYXBbJGluZGV4XSA9ICRjb3VudE5lZWRlZENlbGxYZnMgLSAxOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+Y2VsbFhmQ29sbGVjdGlvbiA9IGFycmF5X3ZhbHVlcygkdGhpcy0+Y2VsbFhmQ29sbGVjdGlvbik7CgogICAgICAgIC8vIHVwZGF0ZSB0aGUgaW5kZXggZm9yIGFsbCBjZWxsWGZzCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmNlbGxYZkNvbGxlY3Rpb24gYXMgJGkgPT4gJGNlbGxYZikgewogICAgICAgICAgICAkY2VsbFhmLT5zZXRJbmRleCgkaSk7CiAgICAgICAgfQoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhlcmUgaXMgYWx3YXlzIGF0IGxlYXN0IG9uZSBjZWxsWGYgKHRoZXJlIHNob3VsZCBiZSkKICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPmNlbGxYZkNvbGxlY3Rpb24pKSB7CiAgICAgICAgICAgICR0aGlzLT5jZWxsWGZDb2xsZWN0aW9uW10gPSBuZXcgUEhQRXhjZWxfU3R5bGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSB0aGUgeGZJbmRleCBmb3IgYWxsIGNlbGxzLCByb3cgZGltZW5zaW9ucywgY29sdW1uIGRpbWVuc2lvbnMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+Z2V0V29ya3NoZWV0SXRlcmF0b3IoKSBhcyAkc2hlZXQpIHsKICAgICAgICAgICAgLy8gZm9yIGFsbCBjZWxscwogICAgICAgICAgICBmb3JlYWNoICgkc2hlZXQtPmdldENlbGxDb2xsZWN0aW9uKGZhbHNlKSBhcyAkY2VsbElEKSB7CiAgICAgICAgICAgICAgICAkY2VsbCA9ICRzaGVldC0+Z2V0Q2VsbCgkY2VsbElEKTsKICAgICAgICAgICAgICAgICRjZWxsLT5zZXRYZkluZGV4KCRtYXBbJGNlbGwtPmdldFhmSW5kZXgoKV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBmb3IgYWxsIHJvdyBkaW1lbnNpb25zCiAgICAgICAgICAgIGZvcmVhY2ggKCRzaGVldC0+Z2V0Um93RGltZW5zaW9ucygpIGFzICRyb3dEaW1lbnNpb24pIHsKICAgICAgICAgICAgICAgIGlmICgkcm93RGltZW5zaW9uLT5nZXRYZkluZGV4KCkgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAkcm93RGltZW5zaW9uLT5zZXRYZkluZGV4KCRtYXBbJHJvd0RpbWVuc2lvbi0+Z2V0WGZJbmRleCgpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZvciBhbGwgY29sdW1uIGRpbWVuc2lvbnMKICAgICAgICAgICAgZm9yZWFjaCAoJHNoZWV0LT5nZXRDb2x1bW5EaW1lbnNpb25zKCkgYXMgJGNvbHVtbkRpbWVuc2lvbikgewogICAgICAgICAgICAgICAgJGNvbHVtbkRpbWVuc2lvbi0+c2V0WGZJbmRleCgkbWFwWyRjb2x1bW5EaW1lbnNpb24tPmdldFhmSW5kZXgoKV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhbHNvIGRvIGdhcmJhZ2UgY29sbGVjdGlvbiBmb3IgYWxsIHRoZSBzaGVldHMKICAgICAgICAgICAgJHNoZWV0LT5nYXJiYWdlQ29sbGVjdCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgdW5pcXVlIElEIHZhbHVlIGFzc2lnbmVkIHRvIHRoaXMgc3ByZWFkc2hlZXQgd29ya2Jvb2sKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0SUQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+dW5pcXVlSUQ7CiAgICB9Cn0K",
    "size": "31533"
}