{
    "namaFile": "lib\/PHPExcel\/Classes\/PHPExcel\/Worksheet.php",
    "lastUpdate": "2017-12-25+01:39:38.00",
    "contentFile": "PD9waHAKCi8qKgogKiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICoKICogQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbAogKgogKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCiAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMKICogTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyCiAqIHZlcnNpb24gMi4xIG9mIHRoZSBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgogKgogKiBUaGlzIGxpYnJhcnkgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUKICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KICoKICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYwogKiBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5OyBpZiBub3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3YXJlCiAqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgIDAyMTEwLTEzMDEgIFVTQQogKgogKiBAY2F0ZWdvcnkgICBQSFBFeGNlbAogKiBAcGFja2FnZSAgICBQSFBFeGNlbF9Xb3Jrc2hlZXQKICogQGNvcHlyaWdodCAgQ29weXJpZ2h0IChjKSAyMDA2IC0gMjAxNSBQSFBFeGNlbCAoaHR0cDovL3d3dy5jb2RlcGxleC5jb20vUEhQRXhjZWwpCiAqIEBsaWNlbnNlICAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9vbGQtbGljZW5zZXMvbGdwbC0yLjEudHh0ICAgIExHUEwKICogQHZlcnNpb24gICAgIyNWRVJTSU9OIyMsICMjREFURSMjCiAqLwpjbGFzcyBQSFBFeGNlbF9Xb3Jrc2hlZXQgaW1wbGVtZW50cyBQSFBFeGNlbF9JQ29tcGFyYWJsZQp7CiAgICAvKiBCcmVhayB0eXBlcyAqLwogICAgY29uc3QgQlJFQUtfTk9ORSAgID0gMDsKICAgIGNvbnN0IEJSRUFLX1JPVyAgICA9IDE7CiAgICBjb25zdCBCUkVBS19DT0xVTU4gPSAyOwoKICAgIC8qIFNoZWV0IHN0YXRlICovCiAgICBjb25zdCBTSEVFVFNUQVRFX1ZJU0lCTEUgICAgPSAndmlzaWJsZSc7CiAgICBjb25zdCBTSEVFVFNUQVRFX0hJRERFTiAgICAgPSAnaGlkZGVuJzsKICAgIGNvbnN0IFNIRUVUU1RBVEVfVkVSWUhJRERFTiA9ICd2ZXJ5SGlkZGVuJzsKCiAgICAvKioKICAgICAqIEludmFsaWQgY2hhcmFjdGVycyBpbiBzaGVldCB0aXRsZQogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgJGludmFsaWRDaGFyYWN0ZXJzID0gYXJyYXkoJyonLCAnOicsICcvJywgJ1xcJywgJz8nLCAnWycsICddJyk7CgogICAgLyoqCiAgICAgKiBQYXJlbnQgc3ByZWFkc2hlZXQKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsCiAgICAgKi8KICAgIHByaXZhdGUgJHBhcmVudDsKCiAgICAvKioKICAgICAqIENhY2hlYWJsZSBjb2xsZWN0aW9uIG9mIGNlbGxzCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9DYWNoZWRPYmplY3RTdG9yYWdlX3h4eAogICAgICovCiAgICBwcml2YXRlICRjZWxsQ29sbGVjdGlvbjsKCiAgICAvKioKICAgICAqIENvbGxlY3Rpb24gb2Ygcm93IGRpbWVuc2lvbnMKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX1dvcmtzaGVldF9Sb3dEaW1lbnNpb25bXQogICAgICovCiAgICBwcml2YXRlICRyb3dEaW1lbnNpb25zID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIERlZmF1bHQgcm93IGRpbWVuc2lvbgogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfV29ya3NoZWV0X1Jvd0RpbWVuc2lvbgogICAgICovCiAgICBwcml2YXRlICRkZWZhdWx0Um93RGltZW5zaW9uOwoKICAgIC8qKgogICAgICogQ29sbGVjdGlvbiBvZiBjb2x1bW4gZGltZW5zaW9ucwogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfV29ya3NoZWV0X0NvbHVtbkRpbWVuc2lvbltdCiAgICAgKi8KICAgIHByaXZhdGUgJGNvbHVtbkRpbWVuc2lvbnMgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogRGVmYXVsdCBjb2x1bW4gZGltZW5zaW9uCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9Xb3Jrc2hlZXRfQ29sdW1uRGltZW5zaW9uCiAgICAgKi8KICAgIHByaXZhdGUgJGRlZmF1bHRDb2x1bW5EaW1lbnNpb24gPSBudWxsOwoKICAgIC8qKgogICAgICogQ29sbGVjdGlvbiBvZiBkcmF3aW5ncwogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfV29ya3NoZWV0X0Jhc2VEcmF3aW5nW10KICAgICAqLwogICAgcHJpdmF0ZSAkZHJhd2luZ0NvbGxlY3Rpb24gPSBudWxsOwoKICAgIC8qKgogICAgICogQ29sbGVjdGlvbiBvZiBDaGFydCBvYmplY3RzCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9DaGFydFtdCiAgICAgKi8KICAgIHByaXZhdGUgJGNoYXJ0Q29sbGVjdGlvbiA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBXb3Jrc2hlZXQgdGl0bGUKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICR0aXRsZTsKCiAgICAvKioKICAgICAqIFNoZWV0IHN0YXRlCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSAkc2hlZXRTdGF0ZTsKCiAgICAvKioKICAgICAqIFBhZ2Ugc2V0dXAKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX1dvcmtzaGVldF9QYWdlU2V0dXAKICAgICAqLwogICAgcHJpdmF0ZSAkcGFnZVNldHVwOwoKICAgIC8qKgogICAgICogUGFnZSBtYXJnaW5zCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9Xb3Jrc2hlZXRfUGFnZU1hcmdpbnMKICAgICAqLwogICAgcHJpdmF0ZSAkcGFnZU1hcmdpbnM7CgogICAgLyoqCiAgICAgKiBQYWdlIGhlYWRlci9mb290ZXIKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX1dvcmtzaGVldF9IZWFkZXJGb290ZXIKICAgICAqLwogICAgcHJpdmF0ZSAkaGVhZGVyRm9vdGVyOwoKICAgIC8qKgogICAgICogU2hlZXQgdmlldwogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfV29ya3NoZWV0X1NoZWV0VmlldwogICAgICovCiAgICBwcml2YXRlICRzaGVldFZpZXc7CgogICAgLyoqCiAgICAgKiBQcm90ZWN0aW9uCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9Xb3Jrc2hlZXRfUHJvdGVjdGlvbgogICAgICovCiAgICBwcml2YXRlICRwcm90ZWN0aW9uOwoKICAgIC8qKgogICAgICogQ29sbGVjdGlvbiBvZiBzdHlsZXMKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX1N0eWxlW10KICAgICAqLwogICAgcHJpdmF0ZSAkc3R5bGVzID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIENvbmRpdGlvbmFsIHN0eWxlcy4gSW5kZXhlZCBieSBjZWxsIGNvb3JkaW5hdGUsIGUuZy4gJ0ExJwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkY29uZGl0aW9uYWxTdHlsZXNDb2xsZWN0aW9uID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIElzIHRoZSBjdXJyZW50IGNlbGwgY29sbGVjdGlvbiBzb3J0ZWQgYWxyZWFkeT8KICAgICAqCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSAkY2VsbENvbGxlY3Rpb25Jc1NvcnRlZCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogQ29sbGVjdGlvbiBvZiBicmVha3MKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByaXZhdGUgJGJyZWFrcyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBDb2xsZWN0aW9uIG9mIG1lcmdlZCBjZWxsIHJhbmdlcwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkbWVyZ2VDZWxscyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBDb2xsZWN0aW9uIG9mIHByb3RlY3RlZCBjZWxsIHJhbmdlcwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkcHJvdGVjdGVkQ2VsbHMgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogQXV0b2ZpbHRlciBSYW5nZSBhbmQgc2VsZWN0aW9uCiAgICAgKgogICAgICogQHZhciBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcgogICAgICovCiAgICBwcml2YXRlICRhdXRvRmlsdGVyOwoKICAgIC8qKgogICAgICogRnJlZXplIHBhbmUKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICRmcmVlemVQYW5lID0gJyc7CgogICAgLyoqCiAgICAgKiBTaG93IGdyaWRsaW5lcz8KICAgICAqCiAgICAgKiBAdmFyIGJvb2xlYW4KICAgICAqLwogICAgcHJpdmF0ZSAkc2hvd0dyaWRsaW5lcyA9IHRydWU7CgogICAgLyoqCiAgICAqIFByaW50IGdyaWRsaW5lcz8KICAgICoKICAgICogQHZhciBib29sZWFuCiAgICAqLwogICAgcHJpdmF0ZSAkcHJpbnRHcmlkbGluZXMgPSBmYWxzZTsKCiAgICAvKioKICAgICogU2hvdyByb3cgYW5kIGNvbHVtbiBoZWFkZXJzPwogICAgKgogICAgKiBAdmFyIGJvb2xlYW4KICAgICovCiAgICBwcml2YXRlICRzaG93Um93Q29sSGVhZGVycyA9IHRydWU7CgogICAgLyoqCiAgICAgKiBTaG93IHN1bW1hcnkgYmVsb3c\/IChSb3cvQ29sdW1uIG91dGxpbmUpCiAgICAgKgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHByaXZhdGUgJHNob3dTdW1tYXJ5QmVsb3cgPSB0cnVlOwoKICAgIC8qKgogICAgICogU2hvdyBzdW1tYXJ5IHJpZ2h0PyAoUm93L0NvbHVtbiBvdXRsaW5lKQogICAgICoKICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwcml2YXRlICRzaG93U3VtbWFyeVJpZ2h0ID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIENvbGxlY3Rpb24gb2YgY29tbWVudHMKICAgICAqCiAgICAgKiBAdmFyIFBIUEV4Y2VsX0NvbW1lbnRbXQogICAgICovCiAgICBwcml2YXRlICRjb21tZW50cyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBBY3RpdmUgY2VsbC4gKE9ubHkgb25lISkKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICRhY3RpdmVDZWxsID0gJ0ExJzsKCiAgICAvKioKICAgICAqIFNlbGVjdGVkIGNlbGxzCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJpdmF0ZSAkc2VsZWN0ZWRDZWxscyA9ICdBMSc7CgogICAgLyoqCiAgICAgKiBDYWNoZWQgaGlnaGVzdCBjb2x1bW4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICRjYWNoZWRIaWdoZXN0Q29sdW1uID0gJ0EnOwoKICAgIC8qKgogICAgICogQ2FjaGVkIGhpZ2hlc3Qgcm93CiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJpdmF0ZSAkY2FjaGVkSGlnaGVzdFJvdyA9IDE7CgogICAgLyoqCiAgICAgKiBSaWdodC10by1sZWZ0PwogICAgICoKICAgICAqIEB2YXIgYm9vbGVhbgogICAgICovCiAgICBwcml2YXRlICRyaWdodFRvTGVmdCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogSHlwZXJsaW5rcy4gSW5kZXhlZCBieSBjZWxsIGNvb3JkaW5hdGUsIGUuZy4gJ0ExJwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkaHlwZXJsaW5rQ29sbGVjdGlvbiA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiBEYXRhIHZhbGlkYXRpb24gb2JqZWN0cy4gSW5kZXhlZCBieSBjZWxsIGNvb3JkaW5hdGUsIGUuZy4gJ0ExJwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJpdmF0ZSAkZGF0YVZhbGlkYXRpb25Db2xsZWN0aW9uID0gYXJyYXkoKTsKCiAgICAvKioKICAgICAqIFRhYiBjb2xvcgogICAgICoKICAgICAqIEB2YXIgUEhQRXhjZWxfU3R5bGVfQ29sb3IKICAgICAqLwogICAgcHJpdmF0ZSAkdGFiQ29sb3I7CgogICAgLyoqCiAgICAgKiBEaXJ0eSBmbGFnCiAgICAgKgogICAgICogQHZhciBib29sZWFuCiAgICAgKi8KICAgIHByaXZhdGUgJGRpcnR5ID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIEhhc2gKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcml2YXRlICRoYXNoOwoKICAgIC8qKgogICAgKiBDb2RlTmFtZQogICAgKgogICAgKiBAdmFyIHN0cmluZwogICAgKi8KICAgIHByaXZhdGUgJGNvZGVOYW1lID0gbnVsbDsKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB3b3Jrc2hlZXQKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWwgICAgICAgICRwUGFyZW50CiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgICAkcFRpdGxlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdChQSFBFeGNlbCAkcFBhcmVudCA9IG51bGwsICRwVGl0bGUgPSAnV29ya3NoZWV0JykKICAgIHsKICAgICAgICAvLyBTZXQgcGFyZW50IGFuZCB0aXRsZQogICAgICAgICR0aGlzLT5wYXJlbnQgPSAkcFBhcmVudDsKICAgICAgICAkdGhpcy0+c2V0VGl0bGUoJHBUaXRsZSwgZmFsc2UpOwogICAgICAgIC8vIHNldFRpdGxlIGNhbiBjaGFuZ2UgJHBUaXRsZQogICAgICAgICR0aGlzLT5zZXRDb2RlTmFtZSgkdGhpcy0+Z2V0VGl0bGUoKSk7CiAgICAgICAgJHRoaXMtPnNldFNoZWV0U3RhdGUoUEhQRXhjZWxfV29ya3NoZWV0OjpTSEVFVFNUQVRFX1ZJU0lCTEUpOwoKICAgICAgICAkdGhpcy0+Y2VsbENvbGxlY3Rpb24gICAgICAgICA9IFBIUEV4Y2VsX0NhY2hlZE9iamVjdFN0b3JhZ2VGYWN0b3J5OjpnZXRJbnN0YW5jZSgkdGhpcyk7CiAgICAgICAgLy8gU2V0IHBhZ2Ugc2V0dXAKICAgICAgICAkdGhpcy0+cGFnZVNldHVwICAgICAgICAgICAgICA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfUGFnZVNldHVwKCk7CiAgICAgICAgLy8gU2V0IHBhZ2UgbWFyZ2lucwogICAgICAgICR0aGlzLT5wYWdlTWFyZ2lucyAgICAgICAgICAgID0gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldF9QYWdlTWFyZ2lucygpOwogICAgICAgIC8vIFNldCBwYWdlIGhlYWRlci9mb290ZXIKICAgICAgICAkdGhpcy0+aGVhZGVyRm9vdGVyICAgICAgICAgICA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfSGVhZGVyRm9vdGVyKCk7CiAgICAgICAgLy8gU2V0IHNoZWV0IHZpZXcKICAgICAgICAkdGhpcy0+c2hlZXRWaWV3ICAgICAgICAgICAgICA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfU2hlZXRWaWV3KCk7CiAgICAgICAgLy8gRHJhd2luZyBjb2xsZWN0aW9uCiAgICAgICAgJHRoaXMtPmRyYXdpbmdDb2xsZWN0aW9uICAgICAgPSBuZXcgQXJyYXlPYmplY3QoKTsKICAgICAgICAvLyBDaGFydCBjb2xsZWN0aW9uCiAgICAgICAgJHRoaXMtPmNoYXJ0Q29sbGVjdGlvbiAgICAgICAgPSBuZXcgQXJyYXlPYmplY3QoKTsKICAgICAgICAvLyBQcm90ZWN0aW9uCiAgICAgICAgJHRoaXMtPnByb3RlY3Rpb24gICAgICAgICAgICAgPSBuZXcgUEhQRXhjZWxfV29ya3NoZWV0X1Byb3RlY3Rpb24oKTsKICAgICAgICAvLyBEZWZhdWx0IHJvdyBkaW1lbnNpb24KICAgICAgICAkdGhpcy0+ZGVmYXVsdFJvd0RpbWVuc2lvbiAgICA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfUm93RGltZW5zaW9uKG51bGwpOwogICAgICAgIC8vIERlZmF1bHQgY29sdW1uIGRpbWVuc2lvbgogICAgICAgICR0aGlzLT5kZWZhdWx0Q29sdW1uRGltZW5zaW9uID0gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldF9Db2x1bW5EaW1lbnNpb24obnVsbCk7CiAgICAgICAgJHRoaXMtPmF1dG9GaWx0ZXIgICAgICAgICAgICAgPSBuZXcgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXIobnVsbCwgJHRoaXMpOwogICAgfQoKCiAgICAvKioKICAgICAqIERpc2Nvbm5lY3QgYWxsIGNlbGxzIGZyb20gdGhpcyBQSFBFeGNlbF9Xb3Jrc2hlZXQgb2JqZWN0LAogICAgICogICAgdHlwaWNhbGx5IHNvIHRoYXQgdGhlIHdvcmtzaGVldCBvYmplY3QgY2FuIGJlIHVuc2V0CiAgICAgKgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZGlzY29ubmVjdENlbGxzKCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPmNlbGxDb2xsZWN0aW9uICE9PSBudWxsKSB7CiAgICAgICAgICAgICR0aGlzLT5jZWxsQ29sbGVjdGlvbi0+dW5zZXRXb3Jrc2hlZXRDZWxscygpOwogICAgICAgICAgICAkdGhpcy0+Y2VsbENvbGxlY3Rpb24gPSBudWxsOwogICAgICAgIH0KICAgICAgICAvLyAgICBkZXRhY2ggb3Vyc2VsZiBmcm9tIHRoZSB3b3JrYm9vaywgc28gdGhhdCBpdCBjYW4gdGhlbiBkZWxldGUgdGhpcyB3b3Jrc2hlZXQgc3VjY2Vzc2Z1bGx5CiAgICAgICAgJHRoaXMtPnBhcmVudCA9IG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb2RlIHRvIGV4ZWN1dGUgd2hlbiB0aGlzIHdvcmtzaGVldCBpcyB1bnNldCgpCiAgICAgKgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19kZXN0cnVjdCgpCiAgICB7CiAgICAgICAgUEhQRXhjZWxfQ2FsY3VsYXRpb246OmdldEluc3RhbmNlKCR0aGlzLT5wYXJlbnQpLT5jbGVhckNhbGN1bGF0aW9uQ2FjaGVGb3JXb3Jrc2hlZXQoJHRoaXMtPnRpdGxlKTsKCiAgICAgICAgJHRoaXMtPmRpc2Nvbm5lY3RDZWxscygpOwogICAgfQoKICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNhY2hlIGNvbnRyb2xsZXIgZm9yIHRoZSBjZWxsIGNvbGxlY3Rpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX0NhY2hlZE9iamVjdFN0b3JhZ2VfeHh4CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDZWxsQ2FjaGVDb250cm9sbGVyKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmNlbGxDb2xsZWN0aW9uOwogICAgfQoKCiAgICAvKioKICAgICAqIEdldCBhcnJheSBvZiBpbnZhbGlkIGNoYXJhY3RlcnMgZm9yIHNoZWV0IHRpdGxlCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldEludmFsaWRDaGFyYWN0ZXJzKCkKICAgIHsKICAgICAgICByZXR1cm4gc2VsZjo6JGludmFsaWRDaGFyYWN0ZXJzOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgc2hlZXQgY29kZSBuYW1lIGZvciB2YWxpZCBFeGNlbCBzeW50YXgKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwVmFsdWUgVGhlIHN0cmluZyB0byBjaGVjawogICAgICogQHJldHVybiBzdHJpbmcgVGhlIHZhbGlkIHN0cmluZwogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgZnVuY3Rpb24gY2hlY2tTaGVldENvZGVOYW1lKCRwVmFsdWUpCiAgICB7CiAgICAgICAgJENoYXJDb3VudCA9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkNvdW50Q2hhcmFjdGVycygkcFZhbHVlKTsKICAgICAgICBpZiAoJENoYXJDb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ1NoZWV0IGNvZGUgbmFtZSBjYW5ub3QgYmUgZW1wdHkuJyk7CiAgICAgICAgfQogICAgICAgIC8vIFNvbWUgb2YgdGhlIHByaW50YWJsZSBBU0NJSSBjaGFyYWN0ZXJzIGFyZSBpbnZhbGlkOiAgKiA6IC8gXCA\/IFsgXSBhbmQgIGZpcnN0IGFuZCBsYXN0IGNoYXJhY3RlcnMgY2Fubm90IGJlIGEgIiciCiAgICAgICAgaWYgKChzdHJfcmVwbGFjZShzZWxmOjokaW52YWxpZENoYXJhY3RlcnMsICcnLCAkcFZhbHVlKSAhPT0gJHBWYWx1ZSkgfHwKICAgICAgICAgICAgKFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OlN1YnN0cmluZygkcFZhbHVlLCAtMSwgMSk9PSdcJycpIHx8CiAgICAgICAgICAgIChQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpTdWJzdHJpbmcoJHBWYWx1ZSwgMCwgMSk9PSdcJycpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ0ludmFsaWQgY2hhcmFjdGVyIGZvdW5kIGluIHNoZWV0IGNvZGUgbmFtZScpOwogICAgICAgIH0KCiAgICAgICAgLy8gTWF4aW11bSAzMSBjaGFyYWN0ZXJzIGFsbG93ZWQgZm9yIHNoZWV0IHRpdGxlCiAgICAgICAgaWYgKCRDaGFyQ291bnQgPiAzMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCdNYXhpbXVtIDMxIGNoYXJhY3RlcnMgYWxsb3dlZCBpbiBzaGVldCBjb2RlIG5hbWUuJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHBWYWx1ZTsKICAgIH0KCiAgIC8qKgogICAgICogQ2hlY2sgc2hlZXQgdGl0bGUgZm9yIHZhbGlkIEV4Y2VsIHN5bnRheAogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBWYWx1ZSBUaGUgc3RyaW5nIHRvIGNoZWNrCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgdmFsaWQgc3RyaW5nCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBmdW5jdGlvbiBjaGVja1NoZWV0VGl0bGUoJHBWYWx1ZSkKICAgIHsKICAgICAgICAvLyBTb21lIG9mIHRoZSBwcmludGFibGUgQVNDSUkgY2hhcmFjdGVycyBhcmUgaW52YWxpZDogICogOiAvIFwgPyBbIF0KICAgICAgICBpZiAoc3RyX3JlcGxhY2Uoc2VsZjo6JGludmFsaWRDaGFyYWN0ZXJzLCAnJywgJHBWYWx1ZSkgIT09ICRwVmFsdWUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignSW52YWxpZCBjaGFyYWN0ZXIgZm91bmQgaW4gc2hlZXQgdGl0bGUnKTsKICAgICAgICB9CgogICAgICAgIC8vIE1heGltdW0gMzEgY2hhcmFjdGVycyBhbGxvd2VkIGZvciBzaGVldCB0aXRsZQogICAgICAgIGlmIChQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb3VudENoYXJhY3RlcnMoJHBWYWx1ZSkgPiAzMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCdNYXhpbXVtIDMxIGNoYXJhY3RlcnMgYWxsb3dlZCBpbiBzaGVldCB0aXRsZS4nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcFZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGNvbGxlY3Rpb24gb2YgY2VsbHMKICAgICAqCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkcFNvcnRlZCBBbHNvIHNvcnQgdGhlIGNlbGwgY29sbGVjdGlvbj8KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfQ2VsbFtdCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDZWxsQ29sbGVjdGlvbigkcFNvcnRlZCA9IHRydWUpCiAgICB7CiAgICAgICAgaWYgKCRwU29ydGVkKSB7CiAgICAgICAgICAgIC8vIFJlLW9yZGVyIGNlbGwgY29sbGVjdGlvbgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNvcnRDZWxsQ29sbGVjdGlvbigpOwogICAgICAgIH0KICAgICAgICBpZiAoJHRoaXMtPmNlbGxDb2xsZWN0aW9uICE9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmdldENlbGxMaXN0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheSgpOwogICAgfQoKICAgIC8qKgogICAgICogU29ydCBjb2xsZWN0aW9uIG9mIGNlbGxzCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNvcnRDZWxsQ29sbGVjdGlvbigpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5jZWxsQ29sbGVjdGlvbiAhPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5nZXRTb3J0ZWRDZWxsTGlzdCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyYXkoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjb2xsZWN0aW9uIG9mIHJvdyBkaW1lbnNpb25zCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfUm93RGltZW5zaW9uW10KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFJvd0RpbWVuc2lvbnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+cm93RGltZW5zaW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBkZWZhdWx0IHJvdyBkaW1lbnNpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldF9Sb3dEaW1lbnNpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldERlZmF1bHRSb3dEaW1lbnNpb24oKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+ZGVmYXVsdFJvd0RpbWVuc2lvbjsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjb2xsZWN0aW9uIG9mIGNvbHVtbiBkaW1lbnNpb25zCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQ29sdW1uRGltZW5zaW9uW10KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENvbHVtbkRpbWVuc2lvbnMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y29sdW1uRGltZW5zaW9uczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBkZWZhdWx0IGNvbHVtbiBkaW1lbnNpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldF9Db2x1bW5EaW1lbnNpb24KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldERlZmF1bHRDb2x1bW5EaW1lbnNpb24oKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+ZGVmYXVsdENvbHVtbkRpbWVuc2lvbjsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjb2xsZWN0aW9uIG9mIGRyYXdpbmdzCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQmFzZURyYXdpbmdbXQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RHJhd2luZ0NvbGxlY3Rpb24oKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+ZHJhd2luZ0NvbGxlY3Rpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29sbGVjdGlvbiBvZiBjaGFydHMKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX0NoYXJ0W10KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENoYXJ0Q29sbGVjdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5jaGFydENvbGxlY3Rpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgY2hhcnQKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWxfQ2hhcnQgJHBDaGFydAogICAgICogQHBhcmFtIGludHxudWxsICRpQ2hhcnRJbmRleCBJbmRleCB3aGVyZSBjaGFydCBzaG91bGQgZ28gKDAsMSwuLi4sIG9yIG51bGwgZm9yIGxhc3QpCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX0NoYXJ0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRDaGFydChQSFBFeGNlbF9DaGFydCAkcENoYXJ0ID0gbnVsbCwgJGlDaGFydEluZGV4ID0gbnVsbCkKICAgIHsKICAgICAgICAkcENoYXJ0LT5zZXRXb3Jrc2hlZXQoJHRoaXMpOwogICAgICAgIGlmIChpc19udWxsKCRpQ2hhcnRJbmRleCkpIHsKICAgICAgICAgICAgJHRoaXMtPmNoYXJ0Q29sbGVjdGlvbltdID0gJHBDaGFydDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBJbnNlcnQgdGhlIGNoYXJ0IGF0IHRoZSByZXF1ZXN0ZWQgaW5kZXgKICAgICAgICAgICAgYXJyYXlfc3BsaWNlKCR0aGlzLT5jaGFydENvbGxlY3Rpb24sICRpQ2hhcnRJbmRleCwgMCwgYXJyYXkoJHBDaGFydCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRwQ2hhcnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvdW50IG9mIGNoYXJ0cyBvbiB0aGlzIHdvcmtzaGVldAogICAgICoKICAgICAqIEByZXR1cm4gaW50ICAgICAgICBUaGUgbnVtYmVyIG9mIGNoYXJ0cwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2hhcnRDb3VudCgpCiAgICB7CiAgICAgICAgcmV0dXJuIGNvdW50KCR0aGlzLT5jaGFydENvbGxlY3Rpb24pOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGEgY2hhcnQgYnkgaXRzIGluZGV4IHBvc2l0aW9uCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkaW5kZXggQ2hhcnQgaW5kZXggcG9zaXRpb24KICAgICAqIEByZXR1cm4gZmFsc2V8UEhQRXhjZWxfQ2hhcnQKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDaGFydEJ5SW5kZXgoJGluZGV4ID0gbnVsbCkKICAgIHsKICAgICAgICAkY2hhcnRDb3VudCA9IGNvdW50KCR0aGlzLT5jaGFydENvbGxlY3Rpb24pOwogICAgICAgIGlmICgkY2hhcnRDb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzX251bGwoJGluZGV4KSkgewogICAgICAgICAgICAkaW5kZXggPSAtLSRjaGFydENvdW50OwogICAgICAgIH0KICAgICAgICBpZiAoIWlzc2V0KCR0aGlzLT5jaGFydENvbGxlY3Rpb25bJGluZGV4XSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5jaGFydENvbGxlY3Rpb25bJGluZGV4XTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhbiBhcnJheSBvZiB0aGUgbmFtZXMgb2YgY2hhcnRzIG9uIHRoaXMgd29ya3NoZWV0CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmdbXSBUaGUgbmFtZXMgb2YgY2hhcnRzCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2hhcnROYW1lcygpCiAgICB7CiAgICAgICAgJGNoYXJ0TmFtZXMgPSBhcnJheSgpOwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jaGFydENvbGxlY3Rpb24gYXMgJGNoYXJ0KSB7CiAgICAgICAgICAgICRjaGFydE5hbWVzW10gPSAkY2hhcnQtPmdldE5hbWUoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRjaGFydE5hbWVzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGEgY2hhcnQgYnkgbmFtZQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNoYXJ0TmFtZSBDaGFydCBuYW1lCiAgICAgKiBAcmV0dXJuIGZhbHNlfFBIUEV4Y2VsX0NoYXJ0CiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2hhcnRCeU5hbWUoJGNoYXJ0TmFtZSA9ICcnKQogICAgewogICAgICAgICRjaGFydENvdW50ID0gY291bnQoJHRoaXMtPmNoYXJ0Q29sbGVjdGlvbik7CiAgICAgICAgaWYgKCRjaGFydENvdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBmb3JlYWNoICgkdGhpcy0+Y2hhcnRDb2xsZWN0aW9uIGFzICRpbmRleCA9PiAkY2hhcnQpIHsKICAgICAgICAgICAgaWYgKCRjaGFydC0+Z2V0TmFtZSgpID09ICRjaGFydE5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Y2hhcnRDb2xsZWN0aW9uWyRpbmRleF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogUmVmcmVzaCBjb2x1bW4gZGltZW5zaW9ucwogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZWZyZXNoQ29sdW1uRGltZW5zaW9ucygpCiAgICB7CiAgICAgICAgJGN1cnJlbnRDb2x1bW5EaW1lbnNpb25zID0gJHRoaXMtPmdldENvbHVtbkRpbWVuc2lvbnMoKTsKICAgICAgICAkbmV3Q29sdW1uRGltZW5zaW9ucyA9IGFycmF5KCk7CgogICAgICAgIGZvcmVhY2ggKCRjdXJyZW50Q29sdW1uRGltZW5zaW9ucyBhcyAkb2JqQ29sdW1uRGltZW5zaW9uKSB7CiAgICAgICAgICAgICRuZXdDb2x1bW5EaW1lbnNpb25zWyRvYmpDb2x1bW5EaW1lbnNpb24tPmdldENvbHVtbkluZGV4KCldID0gJG9iakNvbHVtbkRpbWVuc2lvbjsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5jb2x1bW5EaW1lbnNpb25zID0gJG5ld0NvbHVtbkRpbWVuc2lvbnM7CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlZnJlc2ggcm93IGRpbWVuc2lvbnMKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVmcmVzaFJvd0RpbWVuc2lvbnMoKQogICAgewogICAgICAgICRjdXJyZW50Um93RGltZW5zaW9ucyA9ICR0aGlzLT5nZXRSb3dEaW1lbnNpb25zKCk7CiAgICAgICAgJG5ld1Jvd0RpbWVuc2lvbnMgPSBhcnJheSgpOwoKICAgICAgICBmb3JlYWNoICgkY3VycmVudFJvd0RpbWVuc2lvbnMgYXMgJG9ialJvd0RpbWVuc2lvbikgewogICAgICAgICAgICAkbmV3Um93RGltZW5zaW9uc1skb2JqUm93RGltZW5zaW9uLT5nZXRSb3dJbmRleCgpXSA9ICRvYmpSb3dEaW1lbnNpb247CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+cm93RGltZW5zaW9ucyA9ICRuZXdSb3dEaW1lbnNpb25zOwoKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgd29ya3NoZWV0IGRpbWVuc2lvbgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nICBTdHJpbmcgY29udGFpbmluZyB0aGUgZGltZW5zaW9uIG9mIHRoaXMgd29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjYWxjdWxhdGVXb3Jrc2hlZXREaW1lbnNpb24oKQogICAgewogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiAnQTEnIC4gJzonIC4gICR0aGlzLT5nZXRIaWdoZXN0Q29sdW1uKCkgLiAkdGhpcy0+Z2V0SGlnaGVzdFJvdygpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHdvcmtzaGVldCBkYXRhIGRpbWVuc2lvbgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nICBTdHJpbmcgY29udGFpbmluZyB0aGUgZGltZW5zaW9uIG9mIHRoaXMgd29ya3NoZWV0IHRoYXQgYWN0dWFsbHkgY29udGFpbiBkYXRhCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjYWxjdWxhdGVXb3Jrc2hlZXREYXRhRGltZW5zaW9uKCkKICAgIHsKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gJ0ExJyAuICc6JyAuICAkdGhpcy0+Z2V0SGlnaGVzdERhdGFDb2x1bW4oKSAuICR0aGlzLT5nZXRIaWdoZXN0RGF0YVJvdygpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHdpZHRocyBmb3IgYXV0by1zaXplIGNvbHVtbnMKICAgICAqCiAgICAgKiBAcGFyYW0gIGJvb2xlYW4gICRjYWxjdWxhdGVNZXJnZUNlbGxzICBDYWxjdWxhdGUgbWVyZ2UgY2VsbCB3aWR0aAogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQ7CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjYWxjdWxhdGVDb2x1bW5XaWR0aHMoJGNhbGN1bGF0ZU1lcmdlQ2VsbHMgPSBmYWxzZSkKICAgIHsKICAgICAgICAvLyBpbml0aWFsaXplICRhdXRvU2l6ZXMgYXJyYXkKICAgICAgICAkYXV0b1NpemVzID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+Z2V0Q29sdW1uRGltZW5zaW9ucygpIGFzICRjb2xEaW1lbnNpb24pIHsKICAgICAgICAgICAgaWYgKCRjb2xEaW1lbnNpb24tPmdldEF1dG9TaXplKCkpIHsKICAgICAgICAgICAgICAgICRhdXRvU2l6ZXNbJGNvbERpbWVuc2lvbi0+Z2V0Q29sdW1uSW5kZXgoKV0gPSAtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVGhlcmUgaXMgb25seSBzb21ldGhpbmcgdG8gZG8gaWYgdGhlcmUgYXJlIHNvbWUgYXV0by1zaXplIGNvbHVtbnMKICAgICAgICBpZiAoIWVtcHR5KCRhdXRvU2l6ZXMpKSB7CiAgICAgICAgICAgIC8vIGJ1aWxkIGxpc3Qgb2YgY2VsbHMgcmVmZXJlbmNlcyB0aGF0IHBhcnRpY2lwYXRlIGluIGEgbWVyZ2UKICAgICAgICAgICAgJGlzTWVyZ2VDZWxsID0gYXJyYXkoKTsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmdldE1lcmdlQ2VsbHMoKSBhcyAkY2VsbHMpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKFBIUEV4Y2VsX0NlbGw6OmV4dHJhY3RBbGxDZWxsUmVmZXJlbmNlc0luUmFuZ2UoJGNlbGxzKSBhcyAkY2VsbFJlZmVyZW5jZSkgewogICAgICAgICAgICAgICAgICAgICRpc01lcmdlQ2VsbFskY2VsbFJlZmVyZW5jZV0gPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggYWxsIGNlbGxzIGluIHRoZSB3b3Jrc2hlZXQKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmdldENlbGxDb2xsZWN0aW9uKGZhbHNlKSBhcyAkY2VsbElEKSB7CiAgICAgICAgICAgICAgICAkY2VsbCA9ICR0aGlzLT5nZXRDZWxsKCRjZWxsSUQsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmICgkY2VsbCAhPT0gbnVsbCAmJiBpc3NldCgkYXV0b1NpemVzWyR0aGlzLT5jZWxsQ29sbGVjdGlvbi0+Z2V0Q3VycmVudENvbHVtbigpXSkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBEZXRlcm1pbmUgd2lkdGggaWYgY2VsbCBkb2VzIG5vdCBwYXJ0aWNpcGF0ZSBpbiBhIG1lcmdlCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkaXNNZXJnZUNlbGxbJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5nZXRDdXJyZW50QWRkcmVzcygpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlZCB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUbyBmb3JtYXR0ZWQgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsVmFsdWUgPSBQSFBFeGNlbF9TdHlsZV9OdW1iZXJGb3JtYXQ6OnRvRm9ybWF0dGVkU3RyaW5nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNlbGwtPmdldENhbGN1bGF0ZWRWYWx1ZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmdldFBhcmVudCgpLT5nZXRDZWxsWGZCeUluZGV4KCRjZWxsLT5nZXRYZkluZGV4KCkpLT5nZXROdW1iZXJGb3JtYXQoKS0+Z2V0Rm9ybWF0Q29kZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAkYXV0b1NpemVzWyR0aGlzLT5jZWxsQ29sbGVjdGlvbi0+Z2V0Q3VycmVudENvbHVtbigpXSA9IG1heCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmbG9hdCkgJGF1dG9TaXplc1skdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmdldEN1cnJlbnRDb2x1bW4oKV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZmxvYXQpUEhQRXhjZWxfU2hhcmVkX0ZvbnQ6OmNhbGN1bGF0ZUNvbHVtbldpZHRoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5nZXRQYXJlbnQoKS0+Z2V0Q2VsbFhmQnlJbmRleCgkY2VsbC0+Z2V0WGZJbmRleCgpKS0+Z2V0Rm9udCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjZWxsVmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmdldFBhcmVudCgpLT5nZXRDZWxsWGZCeUluZGV4KCRjZWxsLT5nZXRYZkluZGV4KCkpLT5nZXRBbGlnbm1lbnQoKS0+Z2V0VGV4dFJvdGF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmdldERlZmF1bHRTdHlsZSgpLT5nZXRGb250KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFkanVzdCBjb2x1bW4gd2lkdGhzCiAgICAgICAgICAgIGZvcmVhY2ggKCRhdXRvU2l6ZXMgYXMgJGNvbHVtbkluZGV4ID0+ICR3aWR0aCkgewogICAgICAgICAgICAgICAgaWYgKCR3aWR0aCA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICR3aWR0aCA9ICR0aGlzLT5nZXREZWZhdWx0Q29sdW1uRGltZW5zaW9uKCktPmdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+Z2V0Q29sdW1uRGltZW5zaW9uKCRjb2x1bW5JbmRleCktPnNldFdpZHRoKCR3aWR0aCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBwYXJlbnQKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQYXJlbnQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+cGFyZW50OwogICAgfQoKICAgIC8qKgogICAgICogUmUtYmluZCBwYXJlbnQKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWwgJHBhcmVudAogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlYmluZFBhcmVudChQSFBFeGNlbCAkcGFyZW50KQogICAgewogICAgICAgIGlmICgkdGhpcy0+cGFyZW50ICE9PSBudWxsKSB7CiAgICAgICAgICAgICRuYW1lZFJhbmdlcyA9ICR0aGlzLT5wYXJlbnQtPmdldE5hbWVkUmFuZ2VzKCk7CiAgICAgICAgICAgIGZvcmVhY2ggKCRuYW1lZFJhbmdlcyBhcyAkbmFtZWRSYW5nZSkgewogICAgICAgICAgICAgICAgJHBhcmVudC0+YWRkTmFtZWRSYW5nZSgkbmFtZWRSYW5nZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5wYXJlbnQtPnJlbW92ZVNoZWV0QnlJbmRleCgKICAgICAgICAgICAgICAgICR0aGlzLT5wYXJlbnQtPmdldEluZGV4KCR0aGlzKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+cGFyZW50ID0gJHBhcmVudDsKCiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRpdGxlCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFRpdGxlKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnRpdGxlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRpdGxlCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcFZhbHVlIFN0cmluZyBjb250YWluaW5nIHRoZSBkaW1lbnNpb24gb2YgdGhpcyB3b3Jrc2hlZXQKICAgICAqIEBwYXJhbSBzdHJpbmcgJHVwZGF0ZUZvcm11bGFDZWxsUmVmZXJlbmNlcyBib29sZWFuIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIGNlbGwgcmVmZXJlbmNlcyBpbiBmb3JtdWxhZSBzaG91bGQKICAgICAqICAgICAgICAgICAgYmUgdXBkYXRlZCB0byByZWZsZWN0IHRoZSBuZXcgc2hlZXQgbmFtZS4KICAgICAqICAgICAgICAgIFRoaXMgc2hvdWxkIGJlIGxlZnQgYXMgdGhlIGRlZmF1bHQgdHJ1ZSwgdW5sZXNzIHlvdSBhcmUKICAgICAqICAgICAgICAgIGNlcnRhaW4gdGhhdCBubyBmb3JtdWxhIGNlbGxzIG9uIGFueSB3b3Jrc2hlZXQgY29udGFpbgogICAgICogICAgICAgICAgcmVmZXJlbmNlcyB0byB0aGlzIHdvcmtzaGVldAogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFRpdGxlKCRwVmFsdWUgPSAnV29ya3NoZWV0JywgJHVwZGF0ZUZvcm11bGFDZWxsUmVmZXJlbmNlcyA9IHRydWUpCiAgICB7CiAgICAgICAgLy8gSXMgdGhpcyBhICdyZW5hbWUnIG9yIG5vdD8KICAgICAgICBpZiAoJHRoaXMtPmdldFRpdGxlKCkgPT0gJHBWYWx1ZSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXM7CiAgICAgICAgfQoKICAgICAgICAvLyBTeW50YXggY2hlY2sKICAgICAgICBzZWxmOjpjaGVja1NoZWV0VGl0bGUoJHBWYWx1ZSk7CgogICAgICAgIC8vIE9sZCB0aXRsZQogICAgICAgICRvbGRUaXRsZSA9ICR0aGlzLT5nZXRUaXRsZSgpOwoKICAgICAgICBpZiAoJHRoaXMtPnBhcmVudCkgewogICAgICAgICAgICAvLyBJcyB0aGVyZSBhbHJlYWR5IHN1Y2ggc2hlZXQgbmFtZT8KICAgICAgICAgICAgaWYgKCR0aGlzLT5wYXJlbnQtPnNoZWV0TmFtZUV4aXN0cygkcFZhbHVlKSkgewogICAgICAgICAgICAgICAgLy8gVXNlIG5hbWUsIGJ1dCBhcHBlbmQgd2l0aCBsb3dlc3QgcG9zc2libGUgaW50ZWdlcgoKICAgICAgICAgICAgICAgIGlmIChQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb3VudENoYXJhY3RlcnMoJHBWYWx1ZSkgPiAyOSkgewogICAgICAgICAgICAgICAgICAgICRwVmFsdWUgPSBQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpTdWJzdHJpbmcoJHBWYWx1ZSwgMCwgMjkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGkgPSAxOwogICAgICAgICAgICAgICAgd2hpbGUgKCR0aGlzLT5wYXJlbnQtPnNoZWV0TmFtZUV4aXN0cygkcFZhbHVlIC4gJyAnIC4gJGkpKSB7CiAgICAgICAgICAgICAgICAgICAgKyskaTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGkgPT0gMTApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkNvdW50Q2hhcmFjdGVycygkcFZhbHVlKSA+IDI4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcFZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6U3Vic3RyaW5nKCRwVmFsdWUsIDAsIDI4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkaSA9PSAxMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OkNvdW50Q2hhcmFjdGVycygkcFZhbHVlKSA+IDI3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcFZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6U3Vic3RyaW5nKCRwVmFsdWUsIDAsIDI3KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkYWx0VGl0bGUgPSAkcFZhbHVlIC4gJyAnIC4gJGk7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNldFRpdGxlKCRhbHRUaXRsZSwgJHVwZGF0ZUZvcm11bGFDZWxsUmVmZXJlbmNlcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFNldCB0aXRsZQogICAgICAgICR0aGlzLT50aXRsZSA9ICRwVmFsdWU7CiAgICAgICAgJHRoaXMtPmRpcnR5ID0gdHJ1ZTsKCiAgICAgICAgaWYgKCR0aGlzLT5wYXJlbnQgJiYgJHRoaXMtPnBhcmVudC0+Z2V0Q2FsY3VsYXRpb25FbmdpbmUoKSkgewogICAgICAgICAgICAvLyBOZXcgdGl0bGUKICAgICAgICAgICAgJG5ld1RpdGxlID0gJHRoaXMtPmdldFRpdGxlKCk7CiAgICAgICAgICAgICR0aGlzLT5wYXJlbnQtPmdldENhbGN1bGF0aW9uRW5naW5lKCkKICAgICAgICAgICAgICAgIC0+cmVuYW1lQ2FsY3VsYXRpb25DYWNoZUZvcldvcmtzaGVldCgkb2xkVGl0bGUsICRuZXdUaXRsZSk7CiAgICAgICAgICAgIGlmICgkdXBkYXRlRm9ybXVsYUNlbGxSZWZlcmVuY2VzKSB7CiAgICAgICAgICAgICAgICBQSFBFeGNlbF9SZWZlcmVuY2VIZWxwZXI6OmdldEluc3RhbmNlKCktPnVwZGF0ZU5hbWVkRm9ybXVsYXMoJHRoaXMtPnBhcmVudCwgJG9sZFRpdGxlLCAkbmV3VGl0bGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgc2hlZXQgc3RhdGUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBTaGVldCBzdGF0ZSAodmlzaWJsZSwgaGlkZGVuLCB2ZXJ5SGlkZGVuKQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2hlZXRTdGF0ZSgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zaGVldFN0YXRlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHNoZWV0IHN0YXRlCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkdmFsdWUgU2hlZXQgc3RhdGUgKHZpc2libGUsIGhpZGRlbiwgdmVyeUhpZGRlbikKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRTaGVldFN0YXRlKCR2YWx1ZSA9IFBIUEV4Y2VsX1dvcmtzaGVldDo6U0hFRVRTVEFURV9WSVNJQkxFKQogICAgewogICAgICAgICR0aGlzLT5zaGVldFN0YXRlID0gJHZhbHVlOwogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBwYWdlIHNldHVwCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfUGFnZVNldHVwCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQYWdlU2V0dXAoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+cGFnZVNldHVwOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHBhZ2Ugc2V0dXAKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWxfV29ya3NoZWV0X1BhZ2VTZXR1cCAgICAkcFZhbHVlCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0UGFnZVNldHVwKFBIUEV4Y2VsX1dvcmtzaGVldF9QYWdlU2V0dXAgJHBWYWx1ZSkKICAgIHsKICAgICAgICAkdGhpcy0+cGFnZVNldHVwID0gJHBWYWx1ZTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgcGFnZSBtYXJnaW5zCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfUGFnZU1hcmdpbnMKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFBhZ2VNYXJnaW5zKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnBhZ2VNYXJnaW5zOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHBhZ2UgbWFyZ2lucwogICAgICoKICAgICAqIEBwYXJhbSBQSFBFeGNlbF9Xb3Jrc2hlZXRfUGFnZU1hcmdpbnMgICAgJHBWYWx1ZQogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFBhZ2VNYXJnaW5zKFBIUEV4Y2VsX1dvcmtzaGVldF9QYWdlTWFyZ2lucyAkcFZhbHVlKQogICAgewogICAgICAgICR0aGlzLT5wYWdlTWFyZ2lucyA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHBhZ2UgaGVhZGVyL2Zvb3RlcgogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X0hlYWRlckZvb3RlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0SGVhZGVyRm9vdGVyKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmhlYWRlckZvb3RlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBwYWdlIGhlYWRlci9mb290ZXIKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWxfV29ya3NoZWV0X0hlYWRlckZvb3RlciAgICAkcFZhbHVlCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0SGVhZGVyRm9vdGVyKFBIUEV4Y2VsX1dvcmtzaGVldF9IZWFkZXJGb290ZXIgJHBWYWx1ZSkKICAgIHsKICAgICAgICAkdGhpcy0+aGVhZGVyRm9vdGVyID0gJHBWYWx1ZTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgc2hlZXQgdmlldwogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X1NoZWV0VmlldwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2hlZXRWaWV3KCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNoZWV0VmlldzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBzaGVldCB2aWV3CiAgICAgKgogICAgICogQHBhcmFtIFBIUEV4Y2VsX1dvcmtzaGVldF9TaGVldFZpZXcgICAgJHBWYWx1ZQogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldFNoZWV0VmlldyhQSFBFeGNlbF9Xb3Jrc2hlZXRfU2hlZXRWaWV3ICRwVmFsdWUpCiAgICB7CiAgICAgICAgJHRoaXMtPnNoZWV0VmlldyA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IFByb3RlY3Rpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldF9Qcm90ZWN0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQcm90ZWN0aW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnByb3RlY3Rpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgUHJvdGVjdGlvbgogICAgICoKICAgICAqIEBwYXJhbSBQSFBFeGNlbF9Xb3Jrc2hlZXRfUHJvdGVjdGlvbiAgICAkcFZhbHVlCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0UHJvdGVjdGlvbihQSFBFeGNlbF9Xb3Jrc2hlZXRfUHJvdGVjdGlvbiAkcFZhbHVlKQogICAgewogICAgICAgICR0aGlzLT5wcm90ZWN0aW9uID0gJHBWYWx1ZTsKICAgICAgICAkdGhpcy0+ZGlydHkgPSB0cnVlOwoKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgaGlnaGVzdCB3b3Jrc2hlZXQgY29sdW1uCiAgICAgKgogICAgICogQHBhcmFtICAgc3RyaW5nICAgICAkcm93ICAgICAgICBSZXR1cm4gdGhlIGRhdGEgaGlnaGVzdCBjb2x1bW4gZm9yIHRoZSBzcGVjaWZpZWQgcm93LAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgdGhlIGhpZ2hlc3QgY29sdW1uIG9mIGFueSByb3cgaWYgbm8gcm93IG51bWJlciBpcyBwYXNzZWQKICAgICAqIEByZXR1cm4gc3RyaW5nIEhpZ2hlc3QgY29sdW1uIG5hbWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEhpZ2hlc3RDb2x1bW4oJHJvdyA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCRyb3cgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmNhY2hlZEhpZ2hlc3RDb2x1bW47CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+Z2V0SGlnaGVzdERhdGFDb2x1bW4oJHJvdyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgaGlnaGVzdCB3b3Jrc2hlZXQgY29sdW1uIHRoYXQgY29udGFpbnMgZGF0YQogICAgICoKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgJHJvdyAgICAgICAgUmV0dXJuIHRoZSBoaWdoZXN0IGRhdGEgY29sdW1uIGZvciB0aGUgc3BlY2lmaWVkIHJvdywKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHRoZSBoaWdoZXN0IGRhdGEgY29sdW1uIG9mIGFueSByb3cgaWYgbm8gcm93IG51bWJlciBpcyBwYXNzZWQKICAgICAqIEByZXR1cm4gc3RyaW5nIEhpZ2hlc3QgY29sdW1uIG5hbWUgdGhhdCBjb250YWlucyBkYXRhCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRIaWdoZXN0RGF0YUNvbHVtbigkcm93ID0gbnVsbCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5nZXRIaWdoZXN0Q29sdW1uKCRyb3cpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGhpZ2hlc3Qgd29ya3NoZWV0IHJvdwogICAgICoKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgJGNvbHVtbiAgICAgUmV0dXJuIHRoZSBoaWdoZXN0IGRhdGEgcm93IGZvciB0aGUgc3BlY2lmaWVkIGNvbHVtbiwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHRoZSBoaWdoZXN0IHJvdyBvZiBhbnkgY29sdW1uIGlmIG5vIGNvbHVtbiBsZXR0ZXIgaXMgcGFzc2VkCiAgICAgKiBAcmV0dXJuIGludCBIaWdoZXN0IHJvdyBudW1iZXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEhpZ2hlc3RSb3coJGNvbHVtbiA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCRjb2x1bW4gPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmNhY2hlZEhpZ2hlc3RSb3c7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+Z2V0SGlnaGVzdERhdGFSb3coJGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgaGlnaGVzdCB3b3Jrc2hlZXQgcm93IHRoYXQgY29udGFpbnMgZGF0YQogICAgICoKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICAgJGNvbHVtbiAgICAgUmV0dXJuIHRoZSBoaWdoZXN0IGRhdGEgcm93IGZvciB0aGUgc3BlY2lmaWVkIGNvbHVtbiwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHRoZSBoaWdoZXN0IGRhdGEgcm93IG9mIGFueSBjb2x1bW4gaWYgbm8gY29sdW1uIGxldHRlciBpcyBwYXNzZWQKICAgICAqIEByZXR1cm4gc3RyaW5nIEhpZ2hlc3Qgcm93IG51bWJlciB0aGF0IGNvbnRhaW5zIGRhdGEKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEhpZ2hlc3REYXRhUm93KCRjb2x1bW4gPSBudWxsKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmdldEhpZ2hlc3RSb3coJGNvbHVtbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgaGlnaGVzdCB3b3Jrc2hlZXQgY29sdW1uIGFuZCBoaWdoZXN0IHJvdyB0aGF0IGhhdmUgY2VsbCByZWNvcmRzCiAgICAgKgogICAgICogQHJldHVybiBhcnJheSBIaWdoZXN0IGNvbHVtbiBuYW1lIGFuZCBoaWdoZXN0IHJvdyBudW1iZXIKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEhpZ2hlc3RSb3dBbmRDb2x1bW4oKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmdldEhpZ2hlc3RSb3dBbmRDb2x1bW4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGNlbGwgdmFsdWUKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ29vcmRpbmF0ZSBDb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gbWl4ZWQgJHBWYWx1ZSBWYWx1ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIGJvb2wgJHJldHVybkNlbGwgICBSZXR1cm4gdGhlIHdvcmtzaGVldCAoZmFsc2UsIGRlZmF1bHQpIG9yIHRoZSBjZWxsICh0cnVlKQogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXR8UEhQRXhjZWxfQ2VsbCAgICBEZXBlbmRpbmcgb24gdGhlIGxhc3QgcGFyYW1ldGVyIGJlaW5nIHNwZWNpZmllZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0Q2VsbFZhbHVlKCRwQ29vcmRpbmF0ZSA9ICdBMScsICRwVmFsdWUgPSBudWxsLCAkcmV0dXJuQ2VsbCA9IGZhbHNlKQogICAgewogICAgICAgICRjZWxsID0gJHRoaXMtPmdldENlbGwoc3RydG91cHBlcigkcENvb3JkaW5hdGUpKS0+c2V0VmFsdWUoJHBWYWx1ZSk7CiAgICAgICAgcmV0dXJuICgkcmV0dXJuQ2VsbCkgPyAkY2VsbCA6ICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGEgY2VsbCB2YWx1ZSBieSB1c2luZyBudW1lcmljIGNlbGwgY29vcmRpbmF0ZXMKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ29sdW1uIE51bWVyaWMgY29sdW1uIGNvb3JkaW5hdGUgb2YgdGhlIGNlbGwgKEEgPSAwKQogICAgICogQHBhcmFtIHN0cmluZyAkcFJvdyBOdW1lcmljIHJvdyBjb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gbWl4ZWQgJHBWYWx1ZSBWYWx1ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIGJvb2wgJHJldHVybkNlbGwgUmV0dXJuIHRoZSB3b3Jrc2hlZXQgKGZhbHNlLCBkZWZhdWx0KSBvciB0aGUgY2VsbCAodHJ1ZSkKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0fFBIUEV4Y2VsX0NlbGwgICAgRGVwZW5kaW5nIG9uIHRoZSBsYXN0IHBhcmFtZXRlciBiZWluZyBzcGVjaWZpZWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldENlbGxWYWx1ZUJ5Q29sdW1uQW5kUm93KCRwQ29sdW1uID0gMCwgJHBSb3cgPSAxLCAkcFZhbHVlID0gbnVsbCwgJHJldHVybkNlbGwgPSBmYWxzZSkKICAgIHsKICAgICAgICAkY2VsbCA9ICR0aGlzLT5nZXRDZWxsQnlDb2x1bW5BbmRSb3coJHBDb2x1bW4sICRwUm93KS0+c2V0VmFsdWUoJHBWYWx1ZSk7CiAgICAgICAgcmV0dXJuICgkcmV0dXJuQ2VsbCkgPyAkY2VsbCA6ICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGEgY2VsbCB2YWx1ZQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDb29yZGluYXRlIENvb3JkaW5hdGUgb2YgdGhlIGNlbGwKICAgICAqIEBwYXJhbSBtaXhlZCAgJHBWYWx1ZSBWYWx1ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIHN0cmluZyAkcERhdGFUeXBlIEV4cGxpY2l0IGRhdGEgdHlwZQogICAgICogQHBhcmFtIGJvb2wgJHJldHVybkNlbGwgUmV0dXJuIHRoZSB3b3Jrc2hlZXQgKGZhbHNlLCBkZWZhdWx0KSBvciB0aGUgY2VsbCAodHJ1ZSkKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0fFBIUEV4Y2VsX0NlbGwgICAgRGVwZW5kaW5nIG9uIHRoZSBsYXN0IHBhcmFtZXRlciBiZWluZyBzcGVjaWZpZWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldENlbGxWYWx1ZUV4cGxpY2l0KCRwQ29vcmRpbmF0ZSA9ICdBMScsICRwVmFsdWUgPSBudWxsLCAkcERhdGFUeXBlID0gUEhQRXhjZWxfQ2VsbF9EYXRhVHlwZTo6VFlQRV9TVFJJTkcsICRyZXR1cm5DZWxsID0gZmFsc2UpCiAgICB7CiAgICAgICAgLy8gU2V0IHZhbHVlCiAgICAgICAgJGNlbGwgPSAkdGhpcy0+Z2V0Q2VsbChzdHJ0b3VwcGVyKCRwQ29vcmRpbmF0ZSkpLT5zZXRWYWx1ZUV4cGxpY2l0KCRwVmFsdWUsICRwRGF0YVR5cGUpOwogICAgICAgIHJldHVybiAoJHJldHVybkNlbGwpID8gJGNlbGwgOiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBhIGNlbGwgdmFsdWUgYnkgdXNpbmcgbnVtZXJpYyBjZWxsIGNvb3JkaW5hdGVzCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcENvbHVtbiBOdW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwUm93IE51bWVyaWMgcm93IGNvb3JkaW5hdGUgb2YgdGhlIGNlbGwKICAgICAqIEBwYXJhbSBtaXhlZCAkcFZhbHVlIFZhbHVlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwRGF0YVR5cGUgRXhwbGljaXQgZGF0YSB0eXBlCiAgICAgKiBAcGFyYW0gYm9vbCAkcmV0dXJuQ2VsbCBSZXR1cm4gdGhlIHdvcmtzaGVldCAoZmFsc2UsIGRlZmF1bHQpIG9yIHRoZSBjZWxsICh0cnVlKQogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXR8UEhQRXhjZWxfQ2VsbCAgICBEZXBlbmRpbmcgb24gdGhlIGxhc3QgcGFyYW1ldGVyIGJlaW5nIHNwZWNpZmllZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0Q2VsbFZhbHVlRXhwbGljaXRCeUNvbHVtbkFuZFJvdygkcENvbHVtbiA9IDAsICRwUm93ID0gMSwgJHBWYWx1ZSA9IG51bGwsICRwRGF0YVR5cGUgPSBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX1NUUklORywgJHJldHVybkNlbGwgPSBmYWxzZSkKICAgIHsKICAgICAgICAkY2VsbCA9ICR0aGlzLT5nZXRDZWxsQnlDb2x1bW5BbmRSb3coJHBDb2x1bW4sICRwUm93KS0+c2V0VmFsdWVFeHBsaWNpdCgkcFZhbHVlLCAkcERhdGFUeXBlKTsKICAgICAgICByZXR1cm4gKCRyZXR1cm5DZWxsKSA\/ICRjZWxsIDogJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY2VsbCBhdCBhIHNwZWNpZmljIGNvb3JkaW5hdGUKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ29vcmRpbmF0ZSAgICBDb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkY3JlYXRlSWZOb3RFeGlzdHMgIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIGEgbmV3IGNlbGwgc2hvdWxkIGJlIGNyZWF0ZWQgaWYgaXQgZG9lc24ndAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5IGV4aXN0LCBvciBhIG51bGwgc2hvdWxkIGJlIHJldHVybmVkIGluc3RlYWQKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIG51bGx8UEhQRXhjZWxfQ2VsbCBDZWxsIHRoYXQgd2FzIGZvdW5kL2NyZWF0ZWQgb3IgbnVsbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2VsbCgkcENvb3JkaW5hdGUgPSAnQTEnLCAkY3JlYXRlSWZOb3RFeGlzdHMgPSB0cnVlKQogICAgewogICAgICAgIC8vIENoZWNrIGNlbGwgY29sbGVjdGlvbgogICAgICAgIGlmICgkdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmlzRGF0YVNldChzdHJ0b3VwcGVyKCRwQ29vcmRpbmF0ZSkpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmdldENhY2hlRGF0YSgkcENvb3JkaW5hdGUpOwogICAgICAgIH0KCiAgICAgICAgLy8gV29ya3NoZWV0IHJlZmVyZW5jZT8KICAgICAgICBpZiAoc3RycG9zKCRwQ29vcmRpbmF0ZSwgJyEnKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJHdvcmtzaGVldFJlZmVyZW5jZSA9IFBIUEV4Y2VsX1dvcmtzaGVldDo6ZXh0cmFjdFNoZWV0VGl0bGUoJHBDb29yZGluYXRlLCB0cnVlKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5wYXJlbnQtPmdldFNoZWV0QnlOYW1lKCR3b3Jrc2hlZXRSZWZlcmVuY2VbMF0pLT5nZXRDZWxsKHN0cnRvdXBwZXIoJHdvcmtzaGVldFJlZmVyZW5jZVsxXSksICRjcmVhdGVJZk5vdEV4aXN0cyk7CiAgICAgICAgfQoKICAgICAgICAvLyBOYW1lZCByYW5nZT8KICAgICAgICBpZiAoKCFwcmVnX21hdGNoKCcvXicuUEhQRXhjZWxfQ2FsY3VsYXRpb246OkNBTENVTEFUSU9OX1JFR0VYUF9DRUxMUkVGLickL2knLCAkcENvb3JkaW5hdGUsICRtYXRjaGVzKSkgJiYKICAgICAgICAgICAgKHByZWdfbWF0Y2goJy9eJy5QSFBFeGNlbF9DYWxjdWxhdGlvbjo6Q0FMQ1VMQVRJT05fUkVHRVhQX05BTUVEUkFOR0UuJyQvaScsICRwQ29vcmRpbmF0ZSwgJG1hdGNoZXMpKSkgewogICAgICAgICAgICAkbmFtZWRSYW5nZSA9IFBIUEV4Y2VsX05hbWVkUmFuZ2U6OnJlc29sdmVSYW5nZSgkcENvb3JkaW5hdGUsICR0aGlzKTsKICAgICAgICAgICAgaWYgKCRuYW1lZFJhbmdlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAkcENvb3JkaW5hdGUgPSAkbmFtZWRSYW5nZS0+Z2V0UmFuZ2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiAkbmFtZWRSYW5nZS0+Z2V0V29ya3NoZWV0KCktPmdldENlbGwoJHBDb29yZGluYXRlLCAkY3JlYXRlSWZOb3RFeGlzdHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwQ29vcmRpbmF0ZSA9IHN0cnRvdXBwZXIoJHBDb29yZGluYXRlKTsKCiAgICAgICAgaWYgKHN0cnBvcygkcENvb3JkaW5hdGUsICc6JykgIT09IGZhbHNlIHx8IHN0cnBvcygkcENvb3JkaW5hdGUsICcsJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ0NlbGwgY29vcmRpbmF0ZSBjYW4gbm90IGJlIGEgcmFuZ2Ugb2YgY2VsbHMuJyk7CiAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkcENvb3JkaW5hdGUsICckJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ0NlbGwgY29vcmRpbmF0ZSBtdXN0IG5vdCBiZSBhYnNvbHV0ZS4nKTsKICAgICAgICB9CgogICAgICAgIC8vIENyZWF0ZSBuZXcgY2VsbCBvYmplY3QsIGlmIHJlcXVpcmVkCiAgICAgICAgcmV0dXJuICRjcmVhdGVJZk5vdEV4aXN0cyA\/ICR0aGlzLT5jcmVhdGVOZXdDZWxsKCRwQ29vcmRpbmF0ZSkgOiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGNlbGwgYXQgYSBzcGVjaWZpYyBjb29yZGluYXRlIGJ5IHVzaW5nIG51bWVyaWMgY2VsbCBjb29yZGluYXRlcwogICAgICoKICAgICAqIEBwYXJhbSAgc3RyaW5nICRwQ29sdW1uIE51bWVyaWMgY29sdW1uIGNvb3JkaW5hdGUgb2YgdGhlIGNlbGwgKHN0YXJ0aW5nIGZyb20gMCkKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBSb3cgTnVtZXJpYyByb3cgY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIGJvb2xlYW4gJGNyZWF0ZUlmTm90RXhpc3RzICBGbGFnIGluZGljYXRpbmcgd2hldGhlciBhIG5ldyBjZWxsIHNob3VsZCBiZSBjcmVhdGVkIGlmIGl0IGRvZXNuJ3QKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxyZWFkeSBleGlzdCwgb3IgYSBudWxsIHNob3VsZCBiZSByZXR1cm5lZCBpbnN0ZWFkCiAgICAgKiBAcmV0dXJuIG51bGx8UEhQRXhjZWxfQ2VsbCBDZWxsIHRoYXQgd2FzIGZvdW5kL2NyZWF0ZWQgb3IgbnVsbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2VsbEJ5Q29sdW1uQW5kUm93KCRwQ29sdW1uID0gMCwgJHBSb3cgPSAxLCAkY3JlYXRlSWZOb3RFeGlzdHMgPSB0cnVlKQogICAgewogICAgICAgICRjb2x1bW5MZXR0ZXIgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4pOwogICAgICAgICRjb29yZGluYXRlID0gJGNvbHVtbkxldHRlciAuICRwUm93OwoKICAgICAgICBpZiAoJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5pc0RhdGFTZXQoJGNvb3JkaW5hdGUpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmdldENhY2hlRGF0YSgkY29vcmRpbmF0ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBDcmVhdGUgbmV3IGNlbGwgb2JqZWN0LCBpZiByZXF1aXJlZAogICAgICAgIHJldHVybiAkY3JlYXRlSWZOb3RFeGlzdHMgPyAkdGhpcy0+Y3JlYXRlTmV3Q2VsbCgkY29vcmRpbmF0ZSkgOiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGNlbGwgYXQgdGhlIHNwZWNpZmllZCBjb29yZGluYXRlCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcENvb3JkaW5hdGUgICAgQ29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHJldHVybiBQSFBFeGNlbF9DZWxsIENlbGwgdGhhdCB3YXMgY3JlYXRlZAogICAgICovCiAgICBwcml2YXRlIGZ1bmN0aW9uIGNyZWF0ZU5ld0NlbGwoJHBDb29yZGluYXRlKQogICAgewogICAgICAgICRjZWxsID0gJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5hZGRDYWNoZURhdGEoCiAgICAgICAgICAgICRwQ29vcmRpbmF0ZSwKICAgICAgICAgICAgbmV3IFBIUEV4Y2VsX0NlbGwobnVsbCwgUEhQRXhjZWxfQ2VsbF9EYXRhVHlwZTo6VFlQRV9OVUxMLCAkdGhpcykKICAgICAgICApOwogICAgICAgICR0aGlzLT5jZWxsQ29sbGVjdGlvbklzU29ydGVkID0gZmFsc2U7CgogICAgICAgIC8vIENvb3JkaW5hdGVzCiAgICAgICAgJGFDb29yZGluYXRlcyA9IFBIUEV4Y2VsX0NlbGw6OmNvb3JkaW5hdGVGcm9tU3RyaW5nKCRwQ29vcmRpbmF0ZSk7CiAgICAgICAgaWYgKFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkdGhpcy0+Y2FjaGVkSGlnaGVzdENvbHVtbikgPCBQSFBFeGNlbF9DZWxsOjpjb2x1bW5JbmRleEZyb21TdHJpbmcoJGFDb29yZGluYXRlc1swXSkpIHsKICAgICAgICAgICAgJHRoaXMtPmNhY2hlZEhpZ2hlc3RDb2x1bW4gPSAkYUNvb3JkaW5hdGVzWzBdOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+Y2FjaGVkSGlnaGVzdFJvdyA9IG1heCgkdGhpcy0+Y2FjaGVkSGlnaGVzdFJvdywgJGFDb29yZGluYXRlc1sxXSk7CgogICAgICAgIC8vIENlbGwgbmVlZHMgYXBwcm9wcmlhdGUgeGZJbmRleCBmcm9tIGRpbWVuc2lvbnMgcmVjb3JkcwogICAgICAgIC8vICAgIGJ1dCBkb24ndCBjcmVhdGUgZGltZW5zaW9uIHJlY29yZHMgaWYgdGhleSBkb24ndCBhbHJlYWR5IGV4aXN0CiAgICAgICAgJHJvd0RpbWVuc2lvbiAgICA9ICR0aGlzLT5nZXRSb3dEaW1lbnNpb24oJGFDb29yZGluYXRlc1sxXSwgZmFsc2UpOwogICAgICAgICRjb2x1bW5EaW1lbnNpb24gPSAkdGhpcy0+Z2V0Q29sdW1uRGltZW5zaW9uKCRhQ29vcmRpbmF0ZXNbMF0sIGZhbHNlKTsKCiAgICAgICAgaWYgKCRyb3dEaW1lbnNpb24gIT09IG51bGwgJiYgJHJvd0RpbWVuc2lvbi0+Z2V0WGZJbmRleCgpID4gMCkgewogICAgICAgICAgICAvLyB0aGVuIHRoZXJlIGlzIGEgcm93IGRpbWVuc2lvbiB3aXRoIGV4cGxpY2l0IHN0eWxlLCBhc3NpZ24gaXQgdG8gdGhlIGNlbGwKICAgICAgICAgICAgJGNlbGwtPnNldFhmSW5kZXgoJHJvd0RpbWVuc2lvbi0+Z2V0WGZJbmRleCgpKTsKICAgICAgICB9IGVsc2VpZiAoJGNvbHVtbkRpbWVuc2lvbiAhPT0gbnVsbCAmJiAkY29sdW1uRGltZW5zaW9uLT5nZXRYZkluZGV4KCkgPiAwKSB7CiAgICAgICAgICAgIC8vIHRoZW4gdGhlcmUgaXMgYSBjb2x1bW4gZGltZW5zaW9uLCBhc3NpZ24gaXQgdG8gdGhlIGNlbGwKICAgICAgICAgICAgJGNlbGwtPnNldFhmSW5kZXgoJGNvbHVtbkRpbWVuc2lvbi0+Z2V0WGZJbmRleCgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkY2VsbDsKICAgIH0KCiAgICAvKioKICAgICAqIERvZXMgdGhlIGNlbGwgYXQgYSBzcGVjaWZpYyBjb29yZGluYXRlIGV4aXN0PwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDb29yZGluYXRlICBDb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjZWxsRXhpc3RzKCRwQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAvLyBXb3Jrc2hlZXQgcmVmZXJlbmNlPwogICAgICAgIGlmIChzdHJwb3MoJHBDb29yZGluYXRlLCAnIScpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkd29ya3NoZWV0UmVmZXJlbmNlID0gUEhQRXhjZWxfV29ya3NoZWV0OjpleHRyYWN0U2hlZXRUaXRsZSgkcENvb3JkaW5hdGUsIHRydWUpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnBhcmVudC0+Z2V0U2hlZXRCeU5hbWUoJHdvcmtzaGVldFJlZmVyZW5jZVswXSktPmNlbGxFeGlzdHMoc3RydG91cHBlcigkd29ya3NoZWV0UmVmZXJlbmNlWzFdKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBOYW1lZCByYW5nZT8KICAgICAgICBpZiAoKCFwcmVnX21hdGNoKCcvXicuUEhQRXhjZWxfQ2FsY3VsYXRpb246OkNBTENVTEFUSU9OX1JFR0VYUF9DRUxMUkVGLickL2knLCAkcENvb3JkaW5hdGUsICRtYXRjaGVzKSkgJiYKICAgICAgICAgICAgKHByZWdfbWF0Y2goJy9eJy5QSFBFeGNlbF9DYWxjdWxhdGlvbjo6Q0FMQ1VMQVRJT05fUkVHRVhQX05BTUVEUkFOR0UuJyQvaScsICRwQ29vcmRpbmF0ZSwgJG1hdGNoZXMpKSkgewogICAgICAgICAgICAkbmFtZWRSYW5nZSA9IFBIUEV4Y2VsX05hbWVkUmFuZ2U6OnJlc29sdmVSYW5nZSgkcENvb3JkaW5hdGUsICR0aGlzKTsKICAgICAgICAgICAgaWYgKCRuYW1lZFJhbmdlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAkcENvb3JkaW5hdGUgPSAkbmFtZWRSYW5nZS0+Z2V0UmFuZ2UoKTsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+Z2V0SGFzaENvZGUoKSAhPSAkbmFtZWRSYW5nZS0+Z2V0V29ya3NoZWV0KCktPmdldEhhc2hDb2RlKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoISRuYW1lZFJhbmdlLT5nZXRMb2NhbE9ubHkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJG5hbWVkUmFuZ2UtPmdldFdvcmtzaGVldCgpLT5jZWxsRXhpc3RzKCRwQ29vcmRpbmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignTmFtZWQgcmFuZ2UgJyAuICRuYW1lZFJhbmdlLT5nZXROYW1lKCkgLiAnIGlzIG5vdCBhY2Nlc3NpYmxlIGZyb20gd2l0aGluIHNoZWV0ICcgLiAkdGhpcy0+Z2V0VGl0bGUoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwQ29vcmRpbmF0ZSA9IHN0cnRvdXBwZXIoJHBDb29yZGluYXRlKTsKCiAgICAgICAgaWYgKHN0cnBvcygkcENvb3JkaW5hdGUsICc6JykgIT09IGZhbHNlIHx8IHN0cnBvcygkcENvb3JkaW5hdGUsICcsJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ0NlbGwgY29vcmRpbmF0ZSBjYW4gbm90IGJlIGEgcmFuZ2Ugb2YgY2VsbHMuJyk7CiAgICAgICAgfSBlbHNlaWYgKHN0cnBvcygkcENvb3JkaW5hdGUsICckJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ0NlbGwgY29vcmRpbmF0ZSBtdXN0IG5vdCBiZSBhYnNvbHV0ZS4nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBDb29yZGluYXRlcwogICAgICAgICAgICAkYUNvb3JkaW5hdGVzID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHBDb29yZGluYXRlKTsKCiAgICAgICAgICAgIC8vIENlbGwgZXhpc3RzPwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5pc0RhdGFTZXQoJHBDb29yZGluYXRlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDZWxsIGF0IGEgc3BlY2lmaWMgY29vcmRpbmF0ZSBieSB1c2luZyBudW1lcmljIGNlbGwgY29vcmRpbmF0ZXMgZXhpc3RzPwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDb2x1bW4gTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIHN0cmluZyAkcFJvdyBOdW1lcmljIHJvdyBjb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNlbGxFeGlzdHNCeUNvbHVtbkFuZFJvdygkcENvbHVtbiA9IDAsICRwUm93ID0gMSkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmNlbGxFeGlzdHMoUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRwQ29sdW1uKSAuICRwUm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCByb3cgZGltZW5zaW9uIGF0IGEgc3BlY2lmaWMgcm93CiAgICAgKgogICAgICogQHBhcmFtIGludCAkcFJvdyBOdW1lcmljIGluZGV4IG9mIHRoZSByb3cKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X1Jvd0RpbWVuc2lvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Um93RGltZW5zaW9uKCRwUm93ID0gMSwgJGNyZWF0ZSA9IHRydWUpCiAgICB7CiAgICAgICAgLy8gRm91bmQKICAgICAgICAkZm91bmQgPSBudWxsOwoKICAgICAgICAvLyBHZXQgcm93IGRpbWVuc2lvbgogICAgICAgIGlmICghaXNzZXQoJHRoaXMtPnJvd0RpbWVuc2lvbnNbJHBSb3ddKSkgewogICAgICAgICAgICBpZiAoISRjcmVhdGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5yb3dEaW1lbnNpb25zWyRwUm93XSA9IG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfUm93RGltZW5zaW9uKCRwUm93KTsKCiAgICAgICAgICAgICR0aGlzLT5jYWNoZWRIaWdoZXN0Um93ID0gbWF4KCR0aGlzLT5jYWNoZWRIaWdoZXN0Um93LCAkcFJvdyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+cm93RGltZW5zaW9uc1skcFJvd107CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29sdW1uIGRpbWVuc2lvbiBhdCBhIHNwZWNpZmljIGNvbHVtbgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDb2x1bW4gU3RyaW5nIGluZGV4IG9mIHRoZSBjb2x1bW4KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0X0NvbHVtbkRpbWVuc2lvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q29sdW1uRGltZW5zaW9uKCRwQ29sdW1uID0gJ0EnLCAkY3JlYXRlID0gdHJ1ZSkKICAgIHsKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwQ29sdW1uID0gc3RydG91cHBlcigkcENvbHVtbik7CgogICAgICAgIC8vIEZldGNoIGRpbWVuc2lvbnMKICAgICAgICBpZiAoIWlzc2V0KCR0aGlzLT5jb2x1bW5EaW1lbnNpb25zWyRwQ29sdW1uXSkpIHsKICAgICAgICAgICAgaWYgKCEkY3JlYXRlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+Y29sdW1uRGltZW5zaW9uc1skcENvbHVtbl0gPSBuZXcgUEhQRXhjZWxfV29ya3NoZWV0X0NvbHVtbkRpbWVuc2lvbigkcENvbHVtbik7CgogICAgICAgICAgICBpZiAoUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCR0aGlzLT5jYWNoZWRIaWdoZXN0Q29sdW1uKSA8IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkcENvbHVtbikpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5jYWNoZWRIaWdoZXN0Q29sdW1uID0gJHBDb2x1bW47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5jb2x1bW5EaW1lbnNpb25zWyRwQ29sdW1uXTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjb2x1bW4gZGltZW5zaW9uIGF0IGEgc3BlY2lmaWMgY29sdW1uIGJ5IHVzaW5nIG51bWVyaWMgY2VsbCBjb29yZGluYXRlcwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDb2x1bW4gTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQ29sdW1uRGltZW5zaW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDb2x1bW5EaW1lbnNpb25CeUNvbHVtbigkcENvbHVtbiA9IDApCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5nZXRDb2x1bW5EaW1lbnNpb24oUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRwQ29sdW1uKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgc3R5bGVzCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9TdHlsZVtdCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTdHlsZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+c3R5bGVzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGRlZmF1bHQgc3R5bGUgb2Ygd29ya2Jvb2suCiAgICAgKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfU3R5bGUKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXREZWZhdWx0U3R5bGUoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+cGFyZW50LT5nZXREZWZhdWx0U3R5bGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBkZWZhdWx0IHN0eWxlIC0gc2hvdWxkIG9ubHkgYmUgdXNlZCBieSBQSFBFeGNlbF9JUmVhZGVyIGltcGxlbWVudGF0aW9ucyEKICAgICAqCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICogQHBhcmFtIFBIUEV4Y2VsX1N0eWxlICRwVmFsdWUKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0RGVmYXVsdFN0eWxlKFBIUEV4Y2VsX1N0eWxlICRwVmFsdWUpCiAgICB7CiAgICAgICAgJHRoaXMtPnBhcmVudC0+Z2V0RGVmYXVsdFN0eWxlKCktPmFwcGx5RnJvbUFycmF5KGFycmF5KAogICAgICAgICAgICAnZm9udCcgPT4gYXJyYXkoCiAgICAgICAgICAgICAgICAnbmFtZScgPT4gJHBWYWx1ZS0+Z2V0Rm9udCgpLT5nZXROYW1lKCksCiAgICAgICAgICAgICAgICAnc2l6ZScgPT4gJHBWYWx1ZS0+Z2V0Rm9udCgpLT5nZXRTaXplKCksCiAgICAgICAgICAgICksCiAgICAgICAgKSk7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHN0eWxlIGZvciBjZWxsCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcENlbGxDb29yZGluYXRlIENlbGwgY29vcmRpbmF0ZSAob3IgcmFuZ2UpIHRvIGdldCBzdHlsZSBmb3IKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfU3R5bGUKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTdHlsZSgkcENlbGxDb29yZGluYXRlID0gJ0ExJykKICAgIHsKICAgICAgICAvLyBzZXQgdGhpcyBzaGVldCBhcyBhY3RpdmUKICAgICAgICAkdGhpcy0+cGFyZW50LT5zZXRBY3RpdmVTaGVldEluZGV4KCR0aGlzLT5wYXJlbnQtPmdldEluZGV4KCR0aGlzKSk7CgogICAgICAgIC8vIHNldCBjZWxsIGNvb3JkaW5hdGUgYXMgYWN0aXZlCiAgICAgICAgJHRoaXMtPnNldFNlbGVjdGVkQ2VsbHMoc3RydG91cHBlcigkcENlbGxDb29yZGluYXRlKSk7CgogICAgICAgIHJldHVybiAkdGhpcy0+cGFyZW50LT5nZXRDZWxsWGZTdXBlcnZpc29yKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29uZGl0aW9uYWwgc3R5bGVzIGZvciBhIGNlbGwKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ29vcmRpbmF0ZQogICAgICogQHJldHVybiBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbFtdCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDb25kaXRpb25hbFN0eWxlcygkcENvb3JkaW5hdGUgPSAnQTEnKQogICAgewogICAgICAgICRwQ29vcmRpbmF0ZSA9IHN0cnRvdXBwZXIoJHBDb29yZGluYXRlKTsKICAgICAgICBpZiAoIWlzc2V0KCR0aGlzLT5jb25kaXRpb25hbFN0eWxlc0NvbGxlY3Rpb25bJHBDb29yZGluYXRlXSkpIHsKICAgICAgICAgICAgJHRoaXMtPmNvbmRpdGlvbmFsU3R5bGVzQ29sbGVjdGlvblskcENvb3JkaW5hdGVdID0gYXJyYXkoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5jb25kaXRpb25hbFN0eWxlc0NvbGxlY3Rpb25bJHBDb29yZGluYXRlXTsKICAgIH0KCiAgICAvKioKICAgICAqIERvIGNvbmRpdGlvbmFsIHN0eWxlcyBleGlzdCBmb3IgdGhpcyBjZWxsPwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDb29yZGluYXRlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNvbmRpdGlvbmFsU3R5bGVzRXhpc3RzKCRwQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5jb25kaXRpb25hbFN0eWxlc0NvbGxlY3Rpb25bc3RydG91cHBlcigkcENvb3JkaW5hdGUpXSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZXMgY29uZGl0aW9uYWwgc3R5bGVzIGZvciBhIGNlbGwKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ29vcmRpbmF0ZQogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlbW92ZUNvbmRpdGlvbmFsU3R5bGVzKCRwQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAgdW5zZXQoJHRoaXMtPmNvbmRpdGlvbmFsU3R5bGVzQ29sbGVjdGlvbltzdHJ0b3VwcGVyKCRwQ29vcmRpbmF0ZSldKTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29sbGVjdGlvbiBvZiBjb25kaXRpb25hbCBzdHlsZXMKICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDb25kaXRpb25hbFN0eWxlc0NvbGxlY3Rpb24oKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y29uZGl0aW9uYWxTdHlsZXNDb2xsZWN0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGNvbmRpdGlvbmFsIHN0eWxlcwogICAgICoKICAgICAqIEBwYXJhbSAkcENvb3JkaW5hdGUgc3RyaW5nIEUuZy4gJ0ExJwogICAgICogQHBhcmFtICRwVmFsdWUgUEhQRXhjZWxfU3R5bGVfQ29uZGl0aW9uYWxbXQogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldENvbmRpdGlvbmFsU3R5bGVzKCRwQ29vcmRpbmF0ZSA9ICdBMScsICRwVmFsdWUpCiAgICB7CiAgICAgICAgJHRoaXMtPmNvbmRpdGlvbmFsU3R5bGVzQ29sbGVjdGlvbltzdHJ0b3VwcGVyKCRwQ29vcmRpbmF0ZSldID0gJHBWYWx1ZTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgc3R5bGUgZm9yIGNlbGwgYnkgdXNpbmcgbnVtZXJpYyBjZWxsIGNvb3JkaW5hdGVzCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcENvbHVtbiAgTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIGludCAkcFJvdyBOdW1lcmljIHJvdyBjb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gaW50IHBDb2x1bW4yIE51bWVyaWMgY29sdW1uIGNvb3JkaW5hdGUgb2YgdGhlIHJhbmdlIGNlbGwKICAgICAqIEBwYXJhbSBpbnQgcFJvdzIgTnVtZXJpYyByb3cgY29vcmRpbmF0ZSBvZiB0aGUgcmFuZ2UgY2VsbAogICAgICogQHJldHVybiBQSFBFeGNlbF9TdHlsZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U3R5bGVCeUNvbHVtbkFuZFJvdygkcENvbHVtbiA9IDAsICRwUm93ID0gMSwgJHBDb2x1bW4yID0gbnVsbCwgJHBSb3cyID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAoIWlzX251bGwoJHBDb2x1bW4yKSAmJiAhaXNfbnVsbCgkcFJvdzIpKSB7CiAgICAgICAgICAgICRjZWxsUmFuZ2UgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4pIC4gJHBSb3cgLiAnOicgLiBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4yKSAuICRwUm93MjsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5nZXRTdHlsZSgkY2VsbFJhbmdlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpcy0+Z2V0U3R5bGUoUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRwQ29sdW1uKSAuICRwUm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBzaGFyZWQgY2VsbCBzdHlsZSB0byBhIHJhbmdlIG9mIGNlbGxzCiAgICAgKgogICAgICogUGxlYXNlIG5vdGUgdGhhdCB0aGlzIHdpbGwgb3ZlcndyaXRlIGV4aXN0aW5nIGNlbGwgc3R5bGVzIGZvciBjZWxscyBpbiByYW5nZSEKICAgICAqCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICogQHBhcmFtIFBIUEV4Y2VsX1N0eWxlICRwU2hhcmVkQ2VsbFN0eWxlIENlbGwgc3R5bGUgdG8gc2hhcmUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBSYW5nZSBSYW5nZSBvZiBjZWxscyAoaS5lLiAiQTE6QjEwIiksIG9yIGp1c3Qgb25lIGNlbGwgKGkuZS4gIkExIikKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U2hhcmVkU3R5bGUoUEhQRXhjZWxfU3R5bGUgJHBTaGFyZWRDZWxsU3R5bGUgPSBudWxsLCAkcFJhbmdlID0gJycpCiAgICB7CiAgICAgICAgJHRoaXMtPmR1cGxpY2F0ZVN0eWxlKCRwU2hhcmVkQ2VsbFN0eWxlLCAkcFJhbmdlKTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBEdXBsaWNhdGUgY2VsbCBzdHlsZSB0byBhIHJhbmdlIG9mIGNlbGxzCiAgICAgKgogICAgICogUGxlYXNlIG5vdGUgdGhhdCB0aGlzIHdpbGwgb3ZlcndyaXRlIGV4aXN0aW5nIGNlbGwgc3R5bGVzIGZvciBjZWxscyBpbiByYW5nZSEKICAgICAqCiAgICAgKiBAcGFyYW0gUEhQRXhjZWxfU3R5bGUgJHBDZWxsU3R5bGUgQ2VsbCBzdHlsZSB0byBkdXBsaWNhdGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBSYW5nZSBSYW5nZSBvZiBjZWxscyAoaS5lLiAiQTE6QjEwIiksIG9yIGp1c3Qgb25lIGNlbGwgKGkuZS4gIkExIikKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZHVwbGljYXRlU3R5bGUoUEhQRXhjZWxfU3R5bGUgJHBDZWxsU3R5bGUgPSBudWxsLCAkcFJhbmdlID0gJycpCiAgICB7CiAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGhhdmUgYSByZWFsIHN0eWxlIGFuZCBub3Qgc3VwZXJ2aXNvcgogICAgICAgICRzdHlsZSA9ICRwQ2VsbFN0eWxlLT5nZXRJc1N1cGVydmlzb3IoKSA\/ICRwQ2VsbFN0eWxlLT5nZXRTaGFyZWRDb21wb25lbnQoKSA6ICRwQ2VsbFN0eWxlOwoKICAgICAgICAvLyBBZGQgdGhlIHN0eWxlIHRvIHRoZSB3b3JrYm9vayBpZiBuZWNlc3NhcnkKICAgICAgICAkd29ya2Jvb2sgPSAkdGhpcy0+cGFyZW50OwogICAgICAgIGlmICgkZXhpc3RpbmdTdHlsZSA9ICR0aGlzLT5wYXJlbnQtPmdldENlbGxYZkJ5SGFzaENvZGUoJHBDZWxsU3R5bGUtPmdldEhhc2hDb2RlKCkpKSB7CiAgICAgICAgICAgIC8vIHRoZXJlIGlzIGFscmVhZHkgc3VjaCBjZWxsIFhmIGluIG91ciBjb2xsZWN0aW9uCiAgICAgICAgICAgICR4ZkluZGV4ID0gJGV4aXN0aW5nU3R5bGUtPmdldEluZGV4KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgaGF2ZSBzdWNoIGEgY2VsbCBYZiwgbmVlZCB0byBhZGQKICAgICAgICAgICAgJHdvcmtib29rLT5hZGRDZWxsWGYoJHBDZWxsU3R5bGUpOwogICAgICAgICAgICAkeGZJbmRleCA9ICRwQ2VsbFN0eWxlLT5nZXRJbmRleCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIHJhbmdlIG91dGVyIGJvcmRlcnMKICAgICAgICBsaXN0KCRyYW5nZVN0YXJ0LCAkcmFuZ2VFbmQpID0gUEhQRXhjZWxfQ2VsbDo6cmFuZ2VCb3VuZGFyaWVzKCRwUmFuZ2UgLiAnOicgLiAkcFJhbmdlKTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGNhbiBsb29wIHVwd2FyZHMgb24gcm93cyBhbmQgY29sdW1ucwogICAgICAgIGlmICgkcmFuZ2VTdGFydFswXSA+ICRyYW5nZUVuZFswXSAmJiAkcmFuZ2VTdGFydFsxXSA+ICRyYW5nZUVuZFsxXSkgewogICAgICAgICAgICAkdG1wID0gJHJhbmdlU3RhcnQ7CiAgICAgICAgICAgICRyYW5nZVN0YXJ0ID0gJHJhbmdlRW5kOwogICAgICAgICAgICAkcmFuZ2VFbmQgPSAkdG1wOwogICAgICAgIH0KCiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGNlbGxzIGFuZCBhcHBseSBzdHlsZXMKICAgICAgICBmb3IgKCRjb2wgPSAkcmFuZ2VTdGFydFswXTsgJGNvbCA8PSAkcmFuZ2VFbmRbMF07ICsrJGNvbCkgewogICAgICAgICAgICBmb3IgKCRyb3cgPSAkcmFuZ2VTdGFydFsxXTsgJHJvdyA8PSAkcmFuZ2VFbmRbMV07ICsrJHJvdykgewogICAgICAgICAgICAgICAgJHRoaXMtPmdldENlbGwoUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRjb2wgLSAxKSAuICRyb3cpLT5zZXRYZkluZGV4KCR4ZkluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogRHVwbGljYXRlIGNvbmRpdGlvbmFsIHN0eWxlIHRvIGEgcmFuZ2Ugb2YgY2VsbHMKICAgICAqCiAgICAgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgd2lsbCBvdmVyd3JpdGUgZXhpc3RpbmcgY2VsbCBzdHlsZXMgZm9yIGNlbGxzIGluIHJhbmdlIQogICAgICoKICAgICAqIEBwYXJhbSAgICBhcnJheSBvZiBQSFBFeGNlbF9TdHlsZV9Db25kaXRpb25hbCAgICAkcENlbGxTdHlsZSAgICBDZWxsIHN0eWxlIHRvIGR1cGxpY2F0ZQogICAgICogQHBhcmFtIHN0cmluZyAkcFJhbmdlIFJhbmdlIG9mIGNlbGxzIChpLmUuICJBMTpCMTAiKSwgb3IganVzdCBvbmUgY2VsbCAoaS5lLiAiQTEiKQogICAgICogQHRocm93cyBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkdXBsaWNhdGVDb25kaXRpb25hbFN0eWxlKGFycmF5ICRwQ2VsbFN0eWxlID0gbnVsbCwgJHBSYW5nZSA9ICcnKQogICAgewogICAgICAgIGZvcmVhY2ggKCRwQ2VsbFN0eWxlIGFzICRjZWxsU3R5bGUpIHsKICAgICAgICAgICAgaWYgKCEoJGNlbGxTdHlsZSBpbnN0YW5jZW9mIFBIUEV4Y2VsX1N0eWxlX0NvbmRpdGlvbmFsKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignU3R5bGUgaXMgbm90IGEgY29uZGl0aW9uYWwgc3R5bGUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIHJhbmdlIG91dGVyIGJvcmRlcnMKICAgICAgICBsaXN0KCRyYW5nZVN0YXJ0LCAkcmFuZ2VFbmQpID0gUEhQRXhjZWxfQ2VsbDo6cmFuZ2VCb3VuZGFyaWVzKCRwUmFuZ2UgLiAnOicgLiAkcFJhbmdlKTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGNhbiBsb29wIHVwd2FyZHMgb24gcm93cyBhbmQgY29sdW1ucwogICAgICAgIGlmICgkcmFuZ2VTdGFydFswXSA+ICRyYW5nZUVuZFswXSAmJiAkcmFuZ2VTdGFydFsxXSA+ICRyYW5nZUVuZFsxXSkgewogICAgICAgICAgICAkdG1wID0gJHJhbmdlU3RhcnQ7CiAgICAgICAgICAgICRyYW5nZVN0YXJ0ID0gJHJhbmdlRW5kOwogICAgICAgICAgICAkcmFuZ2VFbmQgPSAkdG1wOwogICAgICAgIH0KCiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGNlbGxzIGFuZCBhcHBseSBzdHlsZXMKICAgICAgICBmb3IgKCRjb2wgPSAkcmFuZ2VTdGFydFswXTsgJGNvbCA8PSAkcmFuZ2VFbmRbMF07ICsrJGNvbCkgewogICAgICAgICAgICBmb3IgKCRyb3cgPSAkcmFuZ2VTdGFydFsxXTsgJHJvdyA8PSAkcmFuZ2VFbmRbMV07ICsrJHJvdykgewogICAgICAgICAgICAgICAgJHRoaXMtPnNldENvbmRpdGlvbmFsU3R5bGVzKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkY29sIC0gMSkgLiAkcm93LCAkcENlbGxTdHlsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIER1cGxpY2F0ZSBjZWxsIHN0eWxlIGFycmF5IHRvIGEgcmFuZ2Ugb2YgY2VsbHMKICAgICAqCiAgICAgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgd2lsbCBvdmVyd3JpdGUgZXhpc3RpbmcgY2VsbCBzdHlsZXMgZm9yIGNlbGxzIGluIHJhbmdlLAogICAgICogaWYgdGhleSBhcmUgaW4gdGhlIHN0eWxlcyBhcnJheS4gRm9yIGV4YW1wbGUsIGlmIHlvdSBkZWNpZGUgdG8gc2V0IGEgcmFuZ2Ugb2YKICAgICAqIGNlbGxzIHRvIGZvbnQgYm9sZCwgb25seSBpbmNsdWRlIGZvbnQgYm9sZCBpbiB0aGUgc3R5bGVzIGFycmF5LgogICAgICoKICAgICAqIEBkZXByZWNhdGVkCiAgICAgKiBAcGFyYW0gYXJyYXkgJHBTdHlsZXMgQXJyYXkgY29udGFpbmluZyBzdHlsZSBpbmZvcm1hdGlvbgogICAgICogQHBhcmFtIHN0cmluZyAkcFJhbmdlIFJhbmdlIG9mIGNlbGxzIChpLmUuICJBMTpCMTAiKSwgb3IganVzdCBvbmUgY2VsbCAoaS5lLiAiQTEiKQogICAgICogQHBhcmFtIGJvb2xlYW4gJHBBZHZhbmNlZCBBZHZhbmNlZCBtb2RlIGZvciBzZXR0aW5nIGJvcmRlcnMuCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGR1cGxpY2F0ZVN0eWxlQXJyYXkoJHBTdHlsZXMgPSBudWxsLCAkcFJhbmdlID0gJycsICRwQWR2YW5jZWQgPSB0cnVlKQogICAgewogICAgICAgICR0aGlzLT5nZXRTdHlsZSgkcFJhbmdlKS0+YXBwbHlGcm9tQXJyYXkoJHBTdHlsZXMsICRwQWR2YW5jZWQpOwogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBicmVhayBvbiBhIGNlbGwKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ2VsbCBDZWxsIGNvb3JkaW5hdGUgKGUuZy4gQTEpCiAgICAgKiBAcGFyYW0gaW50ICRwQnJlYWsgQnJlYWsgdHlwZSAodHlwZSBvZiBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLXyopCiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNldEJyZWFrKCRwQ2VsbCA9ICdBMScsICRwQnJlYWsgPSBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLX05PTkUpCiAgICB7CiAgICAgICAgLy8gVXBwZXJjYXNlIGNvb3JkaW5hdGUKICAgICAgICAkcENlbGwgPSBzdHJ0b3VwcGVyKCRwQ2VsbCk7CgogICAgICAgIGlmICgkcENlbGwgIT0gJycpIHsKICAgICAgICAgICAgaWYgKCRwQnJlYWsgPT0gUEhQRXhjZWxfV29ya3NoZWV0OjpCUkVBS19OT05FKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPmJyZWFrc1skcENlbGxdKSkgewogICAgICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5icmVha3NbJHBDZWxsXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+YnJlYWtzWyRwQ2VsbF0gPSAkcEJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignTm8gY2VsbCBjb29yZGluYXRlIHNwZWNpZmllZC4nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBicmVhayBvbiBhIGNlbGwgYnkgdXNpbmcgbnVtZXJpYyBjZWxsIGNvb3JkaW5hdGVzCiAgICAgKgogICAgICogQHBhcmFtIGludGVnZXIgJHBDb2x1bW4gTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIGludGVnZXIgJHBSb3cgTnVtZXJpYyByb3cgY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtICBpbnRlZ2VyICRwQnJlYWsgQnJlYWsgdHlwZSAodHlwZSBvZiBQSFBFeGNlbF9Xb3Jrc2hlZXQ6OkJSRUFLXyopCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0QnJlYWtCeUNvbHVtbkFuZFJvdygkcENvbHVtbiA9IDAsICRwUm93ID0gMSwgJHBCcmVhayA9IFBIUEV4Y2VsX1dvcmtzaGVldDo6QlJFQUtfTk9ORSkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNldEJyZWFrKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcENvbHVtbikgLiAkcFJvdywgJHBCcmVhayk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYnJlYWtzCiAgICAgKgogICAgICogQHJldHVybiBhcnJheVtdCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCcmVha3MoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YnJlYWtzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IG1lcmdlIG9uIGEgY2VsbCByYW5nZQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBSYW5nZSAgQ2VsbCByYW5nZSAoZS5nLiBBMTpFMSkKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbWVyZ2VDZWxscygkcFJhbmdlID0gJ0ExOkExJykKICAgIHsKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwUmFuZ2UgPSBzdHJ0b3VwcGVyKCRwUmFuZ2UpOwoKICAgICAgICBpZiAoc3RycG9zKCRwUmFuZ2UsICc6JykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICR0aGlzLT5tZXJnZUNlbGxzWyRwUmFuZ2VdID0gJHBSYW5nZTsKCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBjZWxscyBhcmUgY3JlYXRlZAoKICAgICAgICAgICAgLy8gZ2V0IHRoZSBjZWxscyBpbiB0aGUgcmFuZ2UKICAgICAgICAgICAgJGFSZWZlcmVuY2VzID0gUEhQRXhjZWxfQ2VsbDo6ZXh0cmFjdEFsbENlbGxSZWZlcmVuY2VzSW5SYW5nZSgkcFJhbmdlKTsKCiAgICAgICAgICAgIC8vIGNyZWF0ZSB1cHBlciBsZWZ0IGNlbGwgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdAogICAgICAgICAgICAkdXBwZXJMZWZ0ID0gJGFSZWZlcmVuY2VzWzBdOwogICAgICAgICAgICBpZiAoISR0aGlzLT5jZWxsRXhpc3RzKCR1cHBlckxlZnQpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+Z2V0Q2VsbCgkdXBwZXJMZWZ0KS0+c2V0VmFsdWVFeHBsaWNpdChudWxsLCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTEwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBCbGFuayBvdXQgdGhlIHJlc3Qgb2YgdGhlIGNlbGxzIGluIHRoZSByYW5nZSAoaWYgdGhleSBleGlzdCkKICAgICAgICAgICAgJGNvdW50ID0gY291bnQoJGFSZWZlcmVuY2VzKTsKICAgICAgICAgICAgZm9yICgkaSA9IDE7ICRpIDwgJGNvdW50OyAkaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmNlbGxFeGlzdHMoJGFSZWZlcmVuY2VzWyRpXSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Z2V0Q2VsbCgkYVJlZmVyZW5jZXNbJGldKS0+c2V0VmFsdWVFeHBsaWNpdChudWxsLCBQSFBFeGNlbF9DZWxsX0RhdGFUeXBlOjpUWVBFX05VTEwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignTWVyZ2UgbXVzdCBiZSBzZXQgb24gYSByYW5nZSBvZiBjZWxscy4nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBtZXJnZSBvbiBhIGNlbGwgcmFuZ2UgYnkgdXNpbmcgbnVtZXJpYyBjZWxsIGNvb3JkaW5hdGVzCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcENvbHVtbjEgICAgTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgZmlyc3QgY2VsbAogICAgICogQHBhcmFtIGludCAkcFJvdzEgICAgICAgIE51bWVyaWMgcm93IGNvb3JkaW5hdGUgb2YgdGhlIGZpcnN0IGNlbGwKICAgICAqIEBwYXJhbSBpbnQgJHBDb2x1bW4yICAgIE51bWVyaWMgY29sdW1uIGNvb3JkaW5hdGUgb2YgdGhlIGxhc3QgY2VsbAogICAgICogQHBhcmFtIGludCAkcFJvdzIgICAgICAgIE51bWVyaWMgcm93IGNvb3JkaW5hdGUgb2YgdGhlIGxhc3QgY2VsbAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBtZXJnZUNlbGxzQnlDb2x1bW5BbmRSb3coJHBDb2x1bW4xID0gMCwgJHBSb3cxID0gMSwgJHBDb2x1bW4yID0gMCwgJHBSb3cyID0gMSkKICAgIHsKICAgICAgICAkY2VsbFJhbmdlID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRwQ29sdW1uMSkgLiAkcFJvdzEgLiAnOicgLiBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4yKSAuICRwUm93MjsKICAgICAgICByZXR1cm4gJHRoaXMtPm1lcmdlQ2VsbHMoJGNlbGxSYW5nZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgbWVyZ2Ugb24gYSBjZWxsIHJhbmdlCiAgICAgKgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAgICAgICAgICRwUmFuZ2UgICAgICAgIENlbGwgcmFuZ2UgKGUuZy4gQTE6RTEpCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHVubWVyZ2VDZWxscygkcFJhbmdlID0gJ0ExOkExJykKICAgIHsKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwUmFuZ2UgPSBzdHJ0b3VwcGVyKCRwUmFuZ2UpOwoKICAgICAgICBpZiAoc3RycG9zKCRwUmFuZ2UsICc6JykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+bWVyZ2VDZWxsc1skcFJhbmdlXSkpIHsKICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5tZXJnZUNlbGxzWyRwUmFuZ2VdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ0NlbGwgcmFuZ2UgJyAuICRwUmFuZ2UgLiAnIG5vdCBrbm93biBhcyBtZXJnZWQuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCdNZXJnZSBjYW4gb25seSBiZSByZW1vdmVkIGZyb20gYSByYW5nZSBvZiBjZWxscy4nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBtZXJnZSBvbiBhIGNlbGwgcmFuZ2UgYnkgdXNpbmcgbnVtZXJpYyBjZWxsIGNvb3JkaW5hdGVzCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcENvbHVtbjEgICAgTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgZmlyc3QgY2VsbAogICAgICogQHBhcmFtIGludCAkcFJvdzEgICAgICAgIE51bWVyaWMgcm93IGNvb3JkaW5hdGUgb2YgdGhlIGZpcnN0IGNlbGwKICAgICAqIEBwYXJhbSBpbnQgJHBDb2x1bW4yICAgIE51bWVyaWMgY29sdW1uIGNvb3JkaW5hdGUgb2YgdGhlIGxhc3QgY2VsbAogICAgICogQHBhcmFtIGludCAkcFJvdzIgICAgICAgIE51bWVyaWMgcm93IGNvb3JkaW5hdGUgb2YgdGhlIGxhc3QgY2VsbAogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1bm1lcmdlQ2VsbHNCeUNvbHVtbkFuZFJvdygkcENvbHVtbjEgPSAwLCAkcFJvdzEgPSAxLCAkcENvbHVtbjIgPSAwLCAkcFJvdzIgPSAxKQogICAgewogICAgICAgICRjZWxsUmFuZ2UgPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4xKSAuICRwUm93MSAuICc6JyAuIFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcENvbHVtbjIpIC4gJHBSb3cyOwogICAgICAgIHJldHVybiAkdGhpcy0+dW5tZXJnZUNlbGxzKCRjZWxsUmFuZ2UpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IG1lcmdlIGNlbGxzIGFycmF5LgogICAgICoKICAgICAqIEByZXR1cm4gYXJyYXlbXQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0TWVyZ2VDZWxscygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5tZXJnZUNlbGxzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IG1lcmdlIGNlbGxzIGFycmF5IGZvciB0aGUgZW50aXJlIHNoZWV0LiBVc2UgaW5zdGVhZCBtZXJnZUNlbGxzKCkgdG8gbWVyZ2UKICAgICAqIGEgc2luZ2xlIGNlbGwgcmFuZ2UuCiAgICAgKgogICAgICogQHBhcmFtIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRNZXJnZUNlbGxzKCRwVmFsdWUgPSBhcnJheSgpKQogICAgewogICAgICAgICR0aGlzLT5tZXJnZUNlbGxzID0gJHBWYWx1ZTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgcHJvdGVjdGlvbiBvbiBhIGNlbGwgcmFuZ2UKICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICAgICAgICAgJHBSYW5nZSAgICAgICAgICAgICAgICBDZWxsIChlLmcuIEExKSBvciBjZWxsIHJhbmdlIChlLmcuIEExOkUxKQogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAgICAgICAgICRwUGFzc3dvcmQgICAgICAgICAgICBQYXNzd29yZCB0byB1bmxvY2sgdGhlIHByb3RlY3Rpb24KICAgICAqIEBwYXJhbSAgICBib29sZWFuICAgICAgICAkcEFscmVhZHlIYXNoZWQgICAgSWYgdGhlIHBhc3N3b3JkIGhhcyBhbHJlYWR5IGJlZW4gaGFzaGVkLCBzZXQgdGhpcyB0byB0cnVlCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHByb3RlY3RDZWxscygkcFJhbmdlID0gJ0ExJywgJHBQYXNzd29yZCA9ICcnLCAkcEFscmVhZHlIYXNoZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwUmFuZ2UgPSBzdHJ0b3VwcGVyKCRwUmFuZ2UpOwoKICAgICAgICBpZiAoISRwQWxyZWFkeUhhc2hlZCkgewogICAgICAgICAgICAkcFBhc3N3b3JkID0gUEhQRXhjZWxfU2hhcmVkX1Bhc3N3b3JkSGFzaGVyOjpoYXNoUGFzc3dvcmQoJHBQYXNzd29yZCk7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5wcm90ZWN0ZWRDZWxsc1skcFJhbmdlXSA9ICRwUGFzc3dvcmQ7CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBwcm90ZWN0aW9uIG9uIGEgY2VsbCByYW5nZSBieSB1c2luZyBudW1lcmljIGNlbGwgY29vcmRpbmF0ZXMKICAgICAqCiAgICAgKiBAcGFyYW0gaW50ICAkcENvbHVtbjEgICAgICAgICAgICBOdW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBmaXJzdCBjZWxsCiAgICAgKiBAcGFyYW0gaW50ICAkcFJvdzEgICAgICAgICAgICAgICAgTnVtZXJpYyByb3cgY29vcmRpbmF0ZSBvZiB0aGUgZmlyc3QgY2VsbAogICAgICogQHBhcmFtIGludCAgJHBDb2x1bW4yICAgICAgICAgICAgTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgbGFzdCBjZWxsCiAgICAgKiBAcGFyYW0gaW50ICAkcFJvdzIgICAgICAgICAgICAgICAgTnVtZXJpYyByb3cgY29vcmRpbmF0ZSBvZiB0aGUgbGFzdCBjZWxsCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwUGFzc3dvcmQgICAgICAgICAgICBQYXNzd29yZCB0byB1bmxvY2sgdGhlIHByb3RlY3Rpb24KICAgICAqIEBwYXJhbSAgICBib29sZWFuICRwQWxyZWFkeUhhc2hlZCAgICBJZiB0aGUgcGFzc3dvcmQgaGFzIGFscmVhZHkgYmVlbiBoYXNoZWQsIHNldCB0aGlzIHRvIHRydWUKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJvdGVjdENlbGxzQnlDb2x1bW5BbmRSb3coJHBDb2x1bW4xID0gMCwgJHBSb3cxID0gMSwgJHBDb2x1bW4yID0gMCwgJHBSb3cyID0gMSwgJHBQYXNzd29yZCA9ICcnLCAkcEFscmVhZHlIYXNoZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICAkY2VsbFJhbmdlID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRwQ29sdW1uMSkgLiAkcFJvdzEgLiAnOicgLiBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4yKSAuICRwUm93MjsKICAgICAgICByZXR1cm4gJHRoaXMtPnByb3RlY3RDZWxscygkY2VsbFJhbmdlLCAkcFBhc3N3b3JkLCAkcEFscmVhZHlIYXNoZWQpOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHByb3RlY3Rpb24gb24gYSBjZWxsIHJhbmdlCiAgICAgKgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAgICAgICAgICRwUmFuZ2UgICAgICAgIENlbGwgKGUuZy4gQTEpIG9yIGNlbGwgcmFuZ2UgKGUuZy4gQTE6RTEpCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHVucHJvdGVjdENlbGxzKCRwUmFuZ2UgPSAnQTEnKQogICAgewogICAgICAgIC8vIFVwcGVyY2FzZSBjb29yZGluYXRlCiAgICAgICAgJHBSYW5nZSA9IHN0cnRvdXBwZXIoJHBSYW5nZSk7CgogICAgICAgIGlmIChpc3NldCgkdGhpcy0+cHJvdGVjdGVkQ2VsbHNbJHBSYW5nZV0pKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5wcm90ZWN0ZWRDZWxsc1skcFJhbmdlXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignQ2VsbCByYW5nZSAnIC4gJHBSYW5nZSAuICcgbm90IGtub3duIGFzIHByb3RlY3RlZC4nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHByb3RlY3Rpb24gb24gYSBjZWxsIHJhbmdlIGJ5IHVzaW5nIG51bWVyaWMgY2VsbCBjb29yZGluYXRlcwogICAgICoKICAgICAqIEBwYXJhbSBpbnQgICRwQ29sdW1uMSAgICAgICAgICAgIE51bWVyaWMgY29sdW1uIGNvb3JkaW5hdGUgb2YgdGhlIGZpcnN0IGNlbGwKICAgICAqIEBwYXJhbSBpbnQgICRwUm93MSAgICAgICAgICAgICAgICBOdW1lcmljIHJvdyBjb29yZGluYXRlIG9mIHRoZSBmaXJzdCBjZWxsCiAgICAgKiBAcGFyYW0gaW50ICAkcENvbHVtbjIgICAgICAgICAgICBOdW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBsYXN0IGNlbGwKICAgICAqIEBwYXJhbSBpbnQgJHBSb3cyICAgICAgICAgICAgICAgIE51bWVyaWMgcm93IGNvb3JkaW5hdGUgb2YgdGhlIGxhc3QgY2VsbAogICAgICogQHBhcmFtIHN0cmluZyAkcFBhc3N3b3JkICAgICAgICAgICAgUGFzc3dvcmQgdG8gdW5sb2NrIHRoZSBwcm90ZWN0aW9uCiAgICAgKiBAcGFyYW0gICAgYm9vbGVhbiAkcEFscmVhZHlIYXNoZWQgICAgSWYgdGhlIHBhc3N3b3JkIGhhcyBhbHJlYWR5IGJlZW4gaGFzaGVkLCBzZXQgdGhpcyB0byB0cnVlCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHVucHJvdGVjdENlbGxzQnlDb2x1bW5BbmRSb3coJHBDb2x1bW4xID0gMCwgJHBSb3cxID0gMSwgJHBDb2x1bW4yID0gMCwgJHBSb3cyID0gMSwgJHBQYXNzd29yZCA9ICcnLCAkcEFscmVhZHlIYXNoZWQgPSBmYWxzZSkKICAgIHsKICAgICAgICAkY2VsbFJhbmdlID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRwQ29sdW1uMSkgLiAkcFJvdzEgLiAnOicgLiBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4yKSAuICRwUm93MjsKICAgICAgICByZXR1cm4gJHRoaXMtPnVucHJvdGVjdENlbGxzKCRjZWxsUmFuZ2UsICRwUGFzc3dvcmQsICRwQWxyZWFkeUhhc2hlZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgcHJvdGVjdGVkIGNlbGxzCiAgICAgKgogICAgICogQHJldHVybiBhcnJheVtdCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQcm90ZWN0ZWRDZWxscygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5wcm90ZWN0ZWRDZWxsczsKICAgIH0KCiAgICAvKioKICAgICAqICAgIEdldCBBdXRvZmlsdGVyCiAgICAgKgogICAgICogICAgQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXV0b0ZpbHRlcigpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hdXRvRmlsdGVyOwogICAgfQoKICAgIC8qKgogICAgICogICAgU2V0IEF1dG9GaWx0ZXIKICAgICAqCiAgICAgKiAgICBAcGFyYW0gICAgUEhQRXhjZWxfV29ya3NoZWV0X0F1dG9GaWx0ZXJ8c3RyaW5nICAgJHBWYWx1ZQogICAgICogICAgICAgICAgICBBIHNpbXBsZSBzdHJpbmcgY29udGFpbmluZyBhIENlbGwgcmFuZ2UgbGlrZSAnQTE6RTEwJyBpcyBwZXJtaXR0ZWQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkKICAgICAqICAgIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiAgICBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0QXV0b0ZpbHRlcigkcFZhbHVlKQogICAgewogICAgICAgICRwUmFuZ2UgPSBzdHJ0b3VwcGVyKCRwVmFsdWUpOwogICAgICAgIGlmIChpc19zdHJpbmcoJHBWYWx1ZSkpIHsKICAgICAgICAgICAgJHRoaXMtPmF1dG9GaWx0ZXItPnNldFJhbmdlKCRwVmFsdWUpOwogICAgICAgIH0gZWxzZWlmIChpc19vYmplY3QoJHBWYWx1ZSkgJiYgKCRwVmFsdWUgaW5zdGFuY2VvZiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcikpIHsKICAgICAgICAgICAgJHRoaXMtPmF1dG9GaWx0ZXIgPSAkcFZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiAgICBTZXQgQXV0b2ZpbHRlciBSYW5nZSBieSB1c2luZyBudW1lcmljIGNlbGwgY29vcmRpbmF0ZXMKICAgICAqCiAgICAgKiAgICBAcGFyYW0gIGludGVnZXIgICRwQ29sdW1uMSAgICBOdW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBmaXJzdCBjZWxsCiAgICAgKiAgICBAcGFyYW0gIGludGVnZXIgICRwUm93MSAgICAgICBOdW1lcmljIHJvdyBjb29yZGluYXRlIG9mIHRoZSBmaXJzdCBjZWxsCiAgICAgKiAgICBAcGFyYW0gIGludGVnZXIgICRwQ29sdW1uMiAgICBOdW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBzZWNvbmQgY2VsbAogICAgICogICAgQHBhcmFtICBpbnRlZ2VyICAkcFJvdzIgICAgICAgTnVtZXJpYyByb3cgY29vcmRpbmF0ZSBvZiB0aGUgc2Vjb25kIGNlbGwKICAgICAqICAgIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiAgICBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0QXV0b0ZpbHRlckJ5Q29sdW1uQW5kUm93KCRwQ29sdW1uMSA9IDAsICRwUm93MSA9IDEsICRwQ29sdW1uMiA9IDAsICRwUm93MiA9IDEpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zZXRBdXRvRmlsdGVyKAogICAgICAgICAgICBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4xKSAuICRwUm93MQogICAgICAgICAgICAuICc6JyAuCiAgICAgICAgICAgIFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcENvbHVtbjIpIC4gJHBSb3cyCiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSBhdXRvZmlsdGVyCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlbW92ZUF1dG9GaWx0ZXIoKQogICAgewogICAgICAgICR0aGlzLT5hdXRvRmlsdGVyLT5zZXRSYW5nZShudWxsKTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgRnJlZXplIFBhbmUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RnJlZXplUGFuZSgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5mcmVlemVQYW5lOwogICAgfQoKICAgIC8qKgogICAgICogRnJlZXplIFBhbmUKICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICAgICAkcENlbGwgICAgICAgIENlbGwgKGkuZS4gQTIpCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4YW1wbGVzOgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQTIgd2lsbCBmcmVlemUgdGhlIHJvd3MgYWJvdmUgY2VsbCBBMiAoaS5lIHJvdyAxKQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQjEgd2lsbCBmcmVlemUgdGhlIGNvbHVtbnMgdG8gdGhlIGxlZnQgb2YgY2VsbCBCMSAoaS5lIGNvbHVtbiBBKQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQjIgd2lsbCBmcmVlemUgdGhlIHJvd3MgYWJvdmUgYW5kIHRvIHRoZSBsZWZ0IG9mIGNlbGwgQTIKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaS5lIHJvdyAxIGFuZCBjb2x1bW4gQSkKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZnJlZXplUGFuZSgkcENlbGwgPSAnJykKICAgIHsKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwQ2VsbCA9IHN0cnRvdXBwZXIoJHBDZWxsKTsKICAgICAgICBpZiAoc3RycG9zKCRwQ2VsbCwgJzonKSA9PT0gZmFsc2UgJiYgc3RycG9zKCRwQ2VsbCwgJywnKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgJHRoaXMtPmZyZWV6ZVBhbmUgPSAkcENlbGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignRnJlZXplIHBhbmUgY2FuIG5vdCBiZSBzZXQgb24gYSByYW5nZSBvZiBjZWxscy4nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogRnJlZXplIFBhbmUgYnkgdXNpbmcgbnVtZXJpYyBjZWxsIGNvb3JkaW5hdGVzCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcENvbHVtbiAgICBOdW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gaW50ICRwUm93ICAgICAgICBOdW1lcmljIHJvdyBjb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGZyZWV6ZVBhbmVCeUNvbHVtbkFuZFJvdygkcENvbHVtbiA9IDAsICRwUm93ID0gMSkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmZyZWV6ZVBhbmUoUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRwQ29sdW1uKSAuICRwUm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIFVuZnJlZXplIFBhbmUKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdW5mcmVlemVQYW5lKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmZyZWV6ZVBhbmUoJycpOwogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0IGEgbmV3IHJvdywgdXBkYXRpbmcgYWxsIHBvc3NpYmxlIHJlbGF0ZWQgZGF0YQogICAgICoKICAgICAqIEBwYXJhbSBpbnQgJHBCZWZvcmUgICAgSW5zZXJ0IGJlZm9yZSB0aGlzIG9uZQogICAgICogQHBhcmFtIGludCAkcE51bVJvd3MgICAgTnVtYmVyIG9mIHJvd3MgdG8gaW5zZXJ0CiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGluc2VydE5ld1Jvd0JlZm9yZSgkcEJlZm9yZSA9IDEsICRwTnVtUm93cyA9IDEpCiAgICB7CiAgICAgICAgaWYgKCRwQmVmb3JlID49IDEpIHsKICAgICAgICAgICAgJG9ialJlZmVyZW5jZUhlbHBlciA9IFBIUEV4Y2VsX1JlZmVyZW5jZUhlbHBlcjo6Z2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgJG9ialJlZmVyZW5jZUhlbHBlci0+aW5zZXJ0TmV3QmVmb3JlKCdBJyAuICRwQmVmb3JlLCAwLCAkcE51bVJvd3MsICR0aGlzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCJSb3dzIGNhbiBvbmx5IGJlIGluc2VydGVkIGJlZm9yZSBhdCBsZWFzdCByb3cgMS4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogSW5zZXJ0IGEgbmV3IGNvbHVtbiwgdXBkYXRpbmcgYWxsIHBvc3NpYmxlIHJlbGF0ZWQgZGF0YQogICAgICoKICAgICAqIEBwYXJhbSBpbnQgJHBCZWZvcmUgICAgSW5zZXJ0IGJlZm9yZSB0aGlzIG9uZQogICAgICogQHBhcmFtIGludCAkcE51bUNvbHMgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5zZXJ0CiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGluc2VydE5ld0NvbHVtbkJlZm9yZSgkcEJlZm9yZSA9ICdBJywgJHBOdW1Db2xzID0gMSkKICAgIHsKICAgICAgICBpZiAoIWlzX251bWVyaWMoJHBCZWZvcmUpKSB7CiAgICAgICAgICAgICRvYmpSZWZlcmVuY2VIZWxwZXIgPSBQSFBFeGNlbF9SZWZlcmVuY2VIZWxwZXI6OmdldEluc3RhbmNlKCk7CiAgICAgICAgICAgICRvYmpSZWZlcmVuY2VIZWxwZXItPmluc2VydE5ld0JlZm9yZSgkcEJlZm9yZSAuICcxJywgJHBOdW1Db2xzLCAwLCAkdGhpcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiQ29sdW1uIHJlZmVyZW5jZXMgc2hvdWxkIG5vdCBiZSBudW1lcmljLiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnNlcnQgYSBuZXcgY29sdW1uLCB1cGRhdGluZyBhbGwgcG9zc2libGUgcmVsYXRlZCBkYXRhCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcEJlZm9yZSAgICBJbnNlcnQgYmVmb3JlIHRoaXMgb25lIChudW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBjZWxsKQogICAgICogQHBhcmFtIGludCAkcE51bUNvbHMgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gaW5zZXJ0CiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGluc2VydE5ld0NvbHVtbkJlZm9yZUJ5SW5kZXgoJHBCZWZvcmUgPSAwLCAkcE51bUNvbHMgPSAxKQogICAgewogICAgICAgIGlmICgkcEJlZm9yZSA+PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+aW5zZXJ0TmV3Q29sdW1uQmVmb3JlKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcEJlZm9yZSksICRwTnVtQ29scyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiQ29sdW1ucyBjYW4gb25seSBiZSBpbnNlcnRlZCBiZWZvcmUgYXQgbGVhc3QgY29sdW1uIEEgKDApLiIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlbGV0ZSBhIHJvdywgdXBkYXRpbmcgYWxsIHBvc3NpYmxlIHJlbGF0ZWQgZGF0YQogICAgICoKICAgICAqIEBwYXJhbSBpbnQgJHBSb3cgICAgICAgIFJlbW92ZSBzdGFydGluZyB3aXRoIHRoaXMgb25lCiAgICAgKiBAcGFyYW0gaW50ICRwTnVtUm93cyAgICBOdW1iZXIgb2Ygcm93cyB0byByZW1vdmUKICAgICAqIEB0aHJvd3MgICAgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVtb3ZlUm93KCRwUm93ID0gMSwgJHBOdW1Sb3dzID0gMSkKICAgIHsKICAgICAgICBpZiAoJHBSb3cgPj0gMSkgewogICAgICAgICAgICAkaGlnaGVzdFJvdyA9ICR0aGlzLT5nZXRIaWdoZXN0RGF0YVJvdygpOwogICAgICAgICAgICAkb2JqUmVmZXJlbmNlSGVscGVyID0gUEhQRXhjZWxfUmVmZXJlbmNlSGVscGVyOjpnZXRJbnN0YW5jZSgpOwogICAgICAgICAgICAkb2JqUmVmZXJlbmNlSGVscGVyLT5pbnNlcnROZXdCZWZvcmUoJ0EnIC4gKCRwUm93ICsgJHBOdW1Sb3dzKSwgMCwgLSRwTnVtUm93cywgJHRoaXMpOwogICAgICAgICAgICBmb3IgKCRyID0gMDsgJHIgPCAkcE51bVJvd3M7ICsrJHIpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5nZXRDZWxsQ2FjaGVDb250cm9sbGVyKCktPnJlbW92ZVJvdygkaGlnaGVzdFJvdyk7CiAgICAgICAgICAgICAgICAtLSRoaWdoZXN0Um93OwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbigiUm93cyB0byBiZSBkZWxldGVkIHNob3VsZCBhdCBsZWFzdCBzdGFydCBmcm9tIHJvdyAxLiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBjb2x1bW4sIHVwZGF0aW5nIGFsbCBwb3NzaWJsZSByZWxhdGVkIGRhdGEKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICRwQ29sdW1uICAgICBSZW1vdmUgc3RhcnRpbmcgd2l0aCB0aGlzIG9uZQogICAgICogQHBhcmFtIGludCAgICAgICAkcE51bUNvbHMgICAgTnVtYmVyIG9mIGNvbHVtbnMgdG8gcmVtb3ZlCiAgICAgKiBAdGhyb3dzICAgIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlbW92ZUNvbHVtbigkcENvbHVtbiA9ICdBJywgJHBOdW1Db2xzID0gMSkKICAgIHsKICAgICAgICBpZiAoIWlzX251bWVyaWMoJHBDb2x1bW4pKSB7CiAgICAgICAgICAgICRoaWdoZXN0Q29sdW1uID0gJHRoaXMtPmdldEhpZ2hlc3REYXRhQ29sdW1uKCk7CiAgICAgICAgICAgICRwQ29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkcENvbHVtbikgLSAxICsgJHBOdW1Db2xzKTsKICAgICAgICAgICAgJG9ialJlZmVyZW5jZUhlbHBlciA9IFBIUEV4Y2VsX1JlZmVyZW5jZUhlbHBlcjo6Z2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgJG9ialJlZmVyZW5jZUhlbHBlci0+aW5zZXJ0TmV3QmVmb3JlKCRwQ29sdW1uIC4gJzEnLCAtJHBOdW1Db2xzLCAwLCAkdGhpcyk7CiAgICAgICAgICAgIGZvciAoJGMgPSAwOyAkYyA8ICRwTnVtQ29sczsgKyskYykgewogICAgICAgICAgICAgICAgJHRoaXMtPmdldENlbGxDYWNoZUNvbnRyb2xsZXIoKS0+cmVtb3ZlQ29sdW1uKCRoaWdoZXN0Q29sdW1uKTsKICAgICAgICAgICAgICAgICRoaWdoZXN0Q29sdW1uID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkaGlnaGVzdENvbHVtbikgLSAyKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oIkNvbHVtbiByZWZlcmVuY2VzIHNob3VsZCBub3QgYmUgbnVtZXJpYy4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgY29sdW1uLCB1cGRhdGluZyBhbGwgcG9zc2libGUgcmVsYXRlZCBkYXRhCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcENvbHVtbiAgICBSZW1vdmUgc3RhcnRpbmcgd2l0aCB0aGlzIG9uZSAobnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgY2VsbCkKICAgICAqIEBwYXJhbSBpbnQgJHBOdW1Db2xzICAgIE51bWJlciBvZiBjb2x1bW5zIHRvIHJlbW92ZQogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZW1vdmVDb2x1bW5CeUluZGV4KCRwQ29sdW1uID0gMCwgJHBOdW1Db2xzID0gMSkKICAgIHsKICAgICAgICBpZiAoJHBDb2x1bW4gPj0gMCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnJlbW92ZUNvbHVtbihQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJHBDb2x1bW4pLCAkcE51bUNvbHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oIkNvbHVtbnMgdG8gYmUgZGVsZXRlZCBzaG91bGQgYXQgbGVhc3Qgc3RhcnQgZnJvbSBjb2x1bW4gMCIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgZ3JpZGxpbmVzPwogICAgICoKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2hvd0dyaWRsaW5lcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zaG93R3JpZGxpbmVzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHNob3cgZ3JpZGxpbmVzCiAgICAgKgogICAgICogQHBhcmFtIGJvb2xlYW4gJHBWYWx1ZSAgICBTaG93IGdyaWRsaW5lcyAodHJ1ZS9mYWxzZSkKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRTaG93R3JpZGxpbmVzKCRwVmFsdWUgPSBmYWxzZSkKICAgIHsKICAgICAgICAkdGhpcy0+c2hvd0dyaWRsaW5lcyA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgKiBQcmludCBncmlkbGluZXM\/CiAgICAqCiAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRQcmludEdyaWRsaW5lcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5wcmludEdyaWRsaW5lczsKICAgIH0KCiAgICAvKioKICAgICogU2V0IHByaW50IGdyaWRsaW5lcwogICAgKgogICAgKiBAcGFyYW0gYm9vbGVhbiAkcFZhbHVlIFByaW50IGdyaWRsaW5lcyAodHJ1ZS9mYWxzZSkKICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0UHJpbnRHcmlkbGluZXMoJHBWYWx1ZSA9IGZhbHNlKQogICAgewogICAgICAgICR0aGlzLT5wcmludEdyaWRsaW5lcyA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgKiBTaG93IHJvdyBhbmQgY29sdW1uIGhlYWRlcnM\/CiAgICAqCiAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTaG93Um93Q29sSGVhZGVycygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zaG93Um93Q29sSGVhZGVyczsKICAgIH0KCiAgICAvKioKICAgICogU2V0IHNob3cgcm93IGFuZCBjb2x1bW4gaGVhZGVycwogICAgKgogICAgKiBAcGFyYW0gYm9vbGVhbiAkcFZhbHVlIFNob3cgcm93IGFuZCBjb2x1bW4gaGVhZGVycyAodHJ1ZS9mYWxzZSkKICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U2hvd1Jvd0NvbEhlYWRlcnMoJHBWYWx1ZSA9IGZhbHNlKQogICAgewogICAgICAgICR0aGlzLT5zaG93Um93Q29sSGVhZGVycyA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogU2hvdyBzdW1tYXJ5IGJlbG93PyAoUm93L0NvbHVtbiBvdXRsaW5pbmcpCiAgICAgKgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTaG93U3VtbWFyeUJlbG93KCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNob3dTdW1tYXJ5QmVsb3c7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgc2hvdyBzdW1tYXJ5IGJlbG93CiAgICAgKgogICAgICogQHBhcmFtIGJvb2xlYW4gJHBWYWx1ZSAgICBTaG93IHN1bW1hcnkgYmVsb3cgKHRydWUvZmFsc2UpCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U2hvd1N1bW1hcnlCZWxvdygkcFZhbHVlID0gdHJ1ZSkKICAgIHsKICAgICAgICAkdGhpcy0+c2hvd1N1bW1hcnlCZWxvdyA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogU2hvdyBzdW1tYXJ5IHJpZ2h0PyAoUm93L0NvbHVtbiBvdXRsaW5pbmcpCiAgICAgKgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTaG93U3VtbWFyeVJpZ2h0KCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNob3dTdW1tYXJ5UmlnaHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgc2hvdyBzdW1tYXJ5IHJpZ2h0CiAgICAgKgogICAgICogQHBhcmFtIGJvb2xlYW4gJHBWYWx1ZSAgICBTaG93IHN1bW1hcnkgcmlnaHQgKHRydWUvZmFsc2UpCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U2hvd1N1bW1hcnlSaWdodCgkcFZhbHVlID0gdHJ1ZSkKICAgIHsKICAgICAgICAkdGhpcy0+c2hvd1N1bW1hcnlSaWdodCA9ICRwVmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGNvbW1lbnRzCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Db21tZW50W10KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldENvbW1lbnRzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmNvbW1lbnRzOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGNvbW1lbnRzIGFycmF5IGZvciB0aGUgZW50aXJlIHNoZWV0LgogICAgICoKICAgICAqIEBwYXJhbSBhcnJheSBvZiBQSFBFeGNlbF9Db21tZW50CiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0Q29tbWVudHMoJHBWYWx1ZSA9IGFycmF5KCkpCiAgICB7CiAgICAgICAgJHRoaXMtPmNvbW1lbnRzID0gJHBWYWx1ZTsKCiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGNvbW1lbnQgZm9yIGNlbGwKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ2VsbENvb3JkaW5hdGUgICAgQ2VsbCBjb29yZGluYXRlIHRvIGdldCBjb21tZW50IGZvcgogICAgICogQHJldHVybiBQSFBFeGNlbF9Db21tZW50CiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q29tbWVudCgkcENlbGxDb29yZGluYXRlID0gJ0ExJykKICAgIHsKICAgICAgICAvLyBVcHBlcmNhc2UgY29vcmRpbmF0ZQogICAgICAgICRwQ2VsbENvb3JkaW5hdGUgPSBzdHJ0b3VwcGVyKCRwQ2VsbENvb3JkaW5hdGUpOwoKICAgICAgICBpZiAoc3RycG9zKCRwQ2VsbENvb3JkaW5hdGUsICc6JykgIT09IGZhbHNlIHx8IHN0cnBvcygkcENlbGxDb29yZGluYXRlLCAnLCcpICE9PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUEhQRXhjZWxfRXhjZXB0aW9uKCdDZWxsIGNvb3JkaW5hdGUgc3RyaW5nIGNhbiBub3QgYmUgYSByYW5nZSBvZiBjZWxscy4nKTsKICAgICAgICB9IGVsc2VpZiAoc3RycG9zKCRwQ2VsbENvb3JkaW5hdGUsICckJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ0NlbGwgY29vcmRpbmF0ZSBzdHJpbmcgbXVzdCBub3QgYmUgYWJzb2x1dGUuJyk7CiAgICAgICAgfSBlbHNlaWYgKCRwQ2VsbENvb3JkaW5hdGUgPT0gJycpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFBIUEV4Y2VsX0V4Y2VwdGlvbignQ2VsbCBjb29yZGluYXRlIGNhbiBub3QgYmUgemVyby1sZW5ndGggc3RyaW5nLicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlIGFscmVhZHkgaGF2ZSBhIGNvbW1lbnQgZm9yIHRoaXMgY2VsbC4KICAgICAgICAgICAgLy8gSWYgbm90LCBjcmVhdGUgYSBuZXcgY29tbWVudC4KICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5jb21tZW50c1skcENlbGxDb29yZGluYXRlXSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Y29tbWVudHNbJHBDZWxsQ29vcmRpbmF0ZV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkbmV3Q29tbWVudCA9IG5ldyBQSFBFeGNlbF9Db21tZW50KCk7CiAgICAgICAgICAgICAgICAkdGhpcy0+Y29tbWVudHNbJHBDZWxsQ29vcmRpbmF0ZV0gPSAkbmV3Q29tbWVudDsKICAgICAgICAgICAgICAgIHJldHVybiAkbmV3Q29tbWVudDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdldCBjb21tZW50IGZvciBjZWxsIGJ5IHVzaW5nIG51bWVyaWMgY2VsbCBjb29yZGluYXRlcwogICAgICoKICAgICAqIEBwYXJhbSBpbnQgJHBDb2x1bW4gICAgTnVtZXJpYyBjb2x1bW4gY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHBhcmFtIGludCAkcFJvdyAgICAgICAgTnVtZXJpYyByb3cgY29vcmRpbmF0ZSBvZiB0aGUgY2VsbAogICAgICogQHJldHVybiBQSFBFeGNlbF9Db21tZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDb21tZW50QnlDb2x1bW5BbmRSb3coJHBDb2x1bW4gPSAwLCAkcFJvdyA9IDEpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5nZXRDb21tZW50KFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcENvbHVtbikgLiAkcFJvdyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgc2VsZWN0ZWQgY2VsbAogICAgICoKICAgICAqIEBkZXByZWNhdGVkCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2VsZWN0ZWRDZWxsKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmdldFNlbGVjdGVkQ2VsbHMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBhY3RpdmUgY2VsbAogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nIEV4YW1wbGU6ICdBMScKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEFjdGl2ZUNlbGwoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWN0aXZlQ2VsbDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBzZWxlY3RlZCBjZWxscwogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZWxlY3RlZENlbGxzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNlbGVjdGVkQ2VsbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3RlZCBjZWxsCiAgICAgKgogICAgICogQHBhcmFtICAgIHN0cmluZyAgICAgICAgJHBDb29yZGluYXRlICAgIENlbGwgKGkuZS4gQTEpCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U2VsZWN0ZWRDZWxsKCRwQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zZXRTZWxlY3RlZENlbGxzKCRwQ29vcmRpbmF0ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZWxlY3QgYSByYW5nZSBvZiBjZWxscy4KICAgICAqCiAgICAgKiBAcGFyYW0gICAgc3RyaW5nICAgICAgICAkcENvb3JkaW5hdGUgICAgQ2VsbCByYW5nZSwgZXhhbXBsZXM6ICdBMScsICdCMjpHNScsICdBOkMnLCAnMzo2JwogICAgICogQHRocm93cyAgICBQSFBFeGNlbF9FeGNlcHRpb24KICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRTZWxlY3RlZENlbGxzKCRwQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAgLy8gVXBwZXJjYXNlIGNvb3JkaW5hdGUKICAgICAgICAkcENvb3JkaW5hdGUgPSBzdHJ0b3VwcGVyKCRwQ29vcmRpbmF0ZSk7CgogICAgICAgIC8vIENvbnZlcnQgJ0EnIHRvICdBOkEnCiAgICAgICAgJHBDb29yZGluYXRlID0gcHJlZ19yZXBsYWNlKCcvXihbQS1aXSspJC8nLCAnJHsxfTokezF9JywgJHBDb29yZGluYXRlKTsKCiAgICAgICAgLy8gQ29udmVydCAnMScgdG8gJzE6MScKICAgICAgICAkcENvb3JkaW5hdGUgPSBwcmVnX3JlcGxhY2UoJy9eKFswLTldKykkLycsICckezF9OiR7MX0nLCAkcENvb3JkaW5hdGUpOwoKICAgICAgICAvLyBDb252ZXJ0ICdBOkMnIHRvICdBMTpDMTA0ODU3NicKICAgICAgICAkcENvb3JkaW5hdGUgPSBwcmVnX3JlcGxhY2UoJy9eKFtBLVpdKyk6KFtBLVpdKykkLycsICckezF9MTokezJ9MTA0ODU3NicsICRwQ29vcmRpbmF0ZSk7CgogICAgICAgIC8vIENvbnZlcnQgJzE6MycgdG8gJ0ExOlhGRDMnCiAgICAgICAgJHBDb29yZGluYXRlID0gcHJlZ19yZXBsYWNlKCcvXihbMC05XSspOihbMC05XSspJC8nLCAnQSR7MX06WEZEJHsyfScsICRwQ29vcmRpbmF0ZSk7CgogICAgICAgIGlmIChzdHJwb3MoJHBDb29yZGluYXRlLCAnOicpICE9PSBmYWxzZSB8fCBzdHJwb3MoJHBDb29yZGluYXRlLCAnLCcpICE9PSBmYWxzZSkgewogICAgICAgICAgICBsaXN0KCRmaXJzdCwgKSA9IFBIUEV4Y2VsX0NlbGw6OnNwbGl0UmFuZ2UoJHBDb29yZGluYXRlKTsKICAgICAgICAgICAgJHRoaXMtPmFjdGl2ZUNlbGwgPSAkZmlyc3RbMF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmFjdGl2ZUNlbGwgPSAkcENvb3JkaW5hdGU7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5zZWxlY3RlZENlbGxzID0gJHBDb29yZGluYXRlOwogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdGVkIGNlbGwgYnkgdXNpbmcgbnVtZXJpYyBjZWxsIGNvb3JkaW5hdGVzCiAgICAgKgogICAgICogQHBhcmFtIGludCAkcENvbHVtbiBOdW1lcmljIGNvbHVtbiBjb29yZGluYXRlIG9mIHRoZSBjZWxsCiAgICAgKiBAcGFyYW0gaW50ICRwUm93IE51bWVyaWMgcm93IGNvb3JkaW5hdGUgb2YgdGhlIGNlbGwKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U2VsZWN0ZWRDZWxsQnlDb2x1bW5BbmRSb3coJHBDb2x1bW4gPSAwLCAkcFJvdyA9IDEpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zZXRTZWxlY3RlZENlbGxzKFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcENvbHVtbikgLiAkcFJvdyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgcmlnaHQtdG8tbGVmdAogICAgICoKICAgICAqIEByZXR1cm4gYm9vbGVhbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0UmlnaHRUb0xlZnQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+cmlnaHRUb0xlZnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgcmlnaHQtdG8tbGVmdAogICAgICoKICAgICAqIEBwYXJhbSBib29sZWFuICR2YWx1ZSAgICBSaWdodC10by1sZWZ0IHRydWUvZmFsc2UKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRSaWdodFRvTGVmdCgkdmFsdWUgPSBmYWxzZSkKICAgIHsKICAgICAgICAkdGhpcy0+cmlnaHRUb0xlZnQgPSAkdmFsdWU7CiAgICAgICAgcmV0dXJuICR0aGlzOwogICAgfQoKICAgIC8qKgogICAgICogRmlsbCB3b3Jrc2hlZXQgZnJvbSB2YWx1ZXMgaW4gYXJyYXkKICAgICAqCiAgICAgKiBAcGFyYW0gYXJyYXkgJHNvdXJjZSBTb3VyY2UgYXJyYXkKICAgICAqIEBwYXJhbSBtaXhlZCAkbnVsbFZhbHVlIFZhbHVlIGluIHNvdXJjZSBhcnJheSB0aGF0IHN0YW5kcyBmb3IgYmxhbmsgY2VsbAogICAgICogQHBhcmFtIHN0cmluZyAkc3RhcnRDZWxsIEluc2VydCBhcnJheSBzdGFydGluZyBmcm9tIHRoaXMgY2VsbCBhZGRyZXNzIGFzIHRoZSB0b3AgbGVmdCBjb29yZGluYXRlCiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkc3RyaWN0TnVsbENvbXBhcmlzb24gQXBwbHkgc3RyaWN0IGNvbXBhcmlzb24gd2hlbiB0ZXN0aW5nIGZvciBudWxsIHZhbHVlcyBpbiB0aGUgYXJyYXkKICAgICAqIEB0aHJvd3MgUEhQRXhjZWxfRXhjZXB0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZnJvbUFycmF5KCRzb3VyY2UgPSBudWxsLCAkbnVsbFZhbHVlID0gbnVsbCwgJHN0YXJ0Q2VsbCA9ICdBMScsICRzdHJpY3ROdWxsQ29tcGFyaXNvbiA9IGZhbHNlKQogICAgewogICAgICAgIGlmIChpc19hcnJheSgkc291cmNlKSkgewogICAgICAgICAgICAvLyAgICBDb252ZXJ0IGEgMS1EIGFycmF5IHRvIDItRCAoZm9yIGVhc2Ugb2YgbG9vcGluZykKICAgICAgICAgICAgaWYgKCFpc19hcnJheShlbmQoJHNvdXJjZSkpKSB7CiAgICAgICAgICAgICAgICAkc291cmNlID0gYXJyYXkoJHNvdXJjZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHN0YXJ0IGNvb3JkaW5hdGUKICAgICAgICAgICAgbGlzdCAoJHN0YXJ0Q29sdW1uLCAkc3RhcnRSb3cpID0gUEhQRXhjZWxfQ2VsbDo6Y29vcmRpbmF0ZUZyb21TdHJpbmcoJHN0YXJ0Q2VsbCk7CgogICAgICAgICAgICAvLyBMb29wIHRocm91Z2ggJHNvdXJjZQogICAgICAgICAgICBmb3JlYWNoICgkc291cmNlIGFzICRyb3dEYXRhKSB7CiAgICAgICAgICAgICAgICAkY3VycmVudENvbHVtbiA9ICRzdGFydENvbHVtbjsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyb3dEYXRhIGFzICRjZWxsVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJHN0cmljdE51bGxDb21wYXJpc29uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkY2VsbFZhbHVlICE9PSAkbnVsbFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgY2VsbCB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmdldENlbGwoJGN1cnJlbnRDb2x1bW4gLiAkc3RhcnRSb3cpLT5zZXRWYWx1ZSgkY2VsbFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkY2VsbFZhbHVlICE9ICRudWxsVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBjZWxsIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Z2V0Q2VsbCgkY3VycmVudENvbHVtbiAuICRzdGFydFJvdyktPnNldFZhbHVlKCRjZWxsVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICsrJGN1cnJlbnRDb2x1bW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICArKyRzdGFydFJvdzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oIlBhcmFtZXRlciBcJHNvdXJjZSBzaG91bGQgYmUgYW4gYXJyYXkuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBhcnJheSBmcm9tIGEgcmFuZ2Ugb2YgY2VsbHMKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwUmFuZ2UgUmFuZ2Ugb2YgY2VsbHMgKGkuZS4gIkExOkIxMCIpLCBvciBqdXN0IG9uZSBjZWxsIChpLmUuICJBMSIpCiAgICAgKiBAcGFyYW0gbWl4ZWQgJG51bGxWYWx1ZSBWYWx1ZSByZXR1cm5lZCBpbiB0aGUgYXJyYXkgZW50cnkgaWYgYSBjZWxsIGRvZXNuJ3QgZXhpc3QKICAgICAqIEBwYXJhbSBib29sZWFuICRjYWxjdWxhdGVGb3JtdWxhcyBTaG91bGQgZm9ybXVsYXMgYmUgY2FsY3VsYXRlZD8KICAgICAqIEBwYXJhbSBib29sZWFuICRmb3JtYXREYXRhIFNob3VsZCBmb3JtYXR0aW5nIGJlIGFwcGxpZWQgdG8gY2VsbCB2YWx1ZXM\/CiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkcmV0dXJuQ2VsbFJlZiBGYWxzZSAtIFJldHVybiBhIHNpbXBsZSBhcnJheSBvZiByb3dzIGFuZCBjb2x1bW5zIGluZGV4ZWQgYnkgbnVtYmVyIGNvdW50aW5nIGZyb20gemVybwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJ1ZSAtIFJldHVybiByb3dzIGFuZCBjb2x1bW5zIGluZGV4ZWQgYnkgdGhlaXIgYWN0dWFsIHJvdyBhbmQgY29sdW1uIElEcwogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmFuZ2VUb0FycmF5KCRwUmFuZ2UgPSAnQTEnLCAkbnVsbFZhbHVlID0gbnVsbCwgJGNhbGN1bGF0ZUZvcm11bGFzID0gdHJ1ZSwgJGZvcm1hdERhdGEgPSB0cnVlLCAkcmV0dXJuQ2VsbFJlZiA9IGZhbHNlKQogICAgewogICAgICAgIC8vIFJldHVybnZhbHVlCiAgICAgICAgJHJldHVyblZhbHVlID0gYXJyYXkoKTsKICAgICAgICAvLyAgICBJZGVudGlmeSB0aGUgcmFuZ2UgdGhhdCB3ZSBuZWVkIHRvIGV4dHJhY3QgZnJvbSB0aGUgd29ya3NoZWV0CiAgICAgICAgbGlzdCgkcmFuZ2VTdGFydCwgJHJhbmdlRW5kKSA9IFBIUEV4Y2VsX0NlbGw6OnJhbmdlQm91bmRhcmllcygkcFJhbmdlKTsKICAgICAgICAkbWluQ29sID0gUEhQRXhjZWxfQ2VsbDo6c3RyaW5nRnJvbUNvbHVtbkluZGV4KCRyYW5nZVN0YXJ0WzBdIC0xKTsKICAgICAgICAkbWluUm93ID0gJHJhbmdlU3RhcnRbMV07CiAgICAgICAgJG1heENvbCA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkcmFuZ2VFbmRbMF0gLTEpOwogICAgICAgICRtYXhSb3cgPSAkcmFuZ2VFbmRbMV07CgogICAgICAgICRtYXhDb2wrKzsKICAgICAgICAvLyBMb29wIHRocm91Z2ggcm93cwogICAgICAgICRyID0gLTE7CiAgICAgICAgZm9yICgkcm93ID0gJG1pblJvdzsgJHJvdyA8PSAkbWF4Um93OyArKyRyb3cpIHsKICAgICAgICAgICAgJHJSZWYgPSAoJHJldHVybkNlbGxSZWYpID8gJHJvdyA6ICsrJHI7CiAgICAgICAgICAgICRjID0gLTE7CiAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBjb2x1bW5zIGluIHRoZSBjdXJyZW50IHJvdwogICAgICAgICAgICBmb3IgKCRjb2wgPSAkbWluQ29sOyAkY29sICE9ICRtYXhDb2w7ICsrJGNvbCkgewogICAgICAgICAgICAgICAgJGNSZWYgPSAoJHJldHVybkNlbGxSZWYpID8gJGNvbCA6ICsrJGM7CiAgICAgICAgICAgICAgICAvLyAgICBVc2luZyBnZXRDZWxsKCkgd2lsbCBjcmVhdGUgYSBuZXcgY2VsbCBpZiBpdCBkb2Vzbid0IGFscmVhZHkgZXhpc3QuIFdlIGRvbid0IHdhbnQgdGhhdCB0byBoYXBwZW4KICAgICAgICAgICAgICAgIC8vICAgICAgICBzbyB3ZSB0ZXN0IGFuZCByZXRyaWV2ZSBkaXJlY3RseSBhZ2FpbnN0IGNlbGxDb2xsZWN0aW9uCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5pc0RhdGFTZXQoJGNvbC4kcm93KSkgewogICAgICAgICAgICAgICAgICAgIC8vIENlbGwgZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgJGNlbGwgPSAkdGhpcy0+Y2VsbENvbGxlY3Rpb24tPmdldENhY2hlRGF0YSgkY29sLiRyb3cpOwogICAgICAgICAgICAgICAgICAgIGlmICgkY2VsbC0+Z2V0VmFsdWUoKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNlbGwtPmdldFZhbHVlKCkgaW5zdGFuY2VvZiBQSFBFeGNlbF9SaWNoVGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJldHVyblZhbHVlWyRyUmVmXVskY1JlZl0gPSAkY2VsbC0+Z2V0VmFsdWUoKS0+Z2V0UGxhaW5UZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNhbGN1bGF0ZUZvcm11bGFzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJldHVyblZhbHVlWyRyUmVmXVskY1JlZl0gPSAkY2VsbC0+Z2V0Q2FsY3VsYXRlZFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZVskclJlZl1bJGNSZWZdID0gJGNlbGwtPmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZm9ybWF0RGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0eWxlID0gJHRoaXMtPnBhcmVudC0+Z2V0Q2VsbFhmQnlJbmRleCgkY2VsbC0+Z2V0WGZJbmRleCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZVskclJlZl1bJGNSZWZdID0gUEhQRXhjZWxfU3R5bGVfTnVtYmVyRm9ybWF0Ojp0b0Zvcm1hdHRlZFN0cmluZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmV0dXJuVmFsdWVbJHJSZWZdWyRjUmVmXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoJHN0eWxlICYmICRzdHlsZS0+Z2V0TnVtYmVyRm9ybWF0KCkpID8gJHN0eWxlLT5nZXROdW1iZXJGb3JtYXQoKS0+Z2V0Rm9ybWF0Q29kZSgpIDogUEhQRXhjZWxfU3R5bGVfTnVtYmVyRm9ybWF0OjpGT1JNQVRfR0VORVJBTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENlbGwgaG9sZHMgYSBOVUxMCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZVskclJlZl1bJGNSZWZdID0gJG51bGxWYWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIENlbGwgZG9lc24ndCBleGlzdAogICAgICAgICAgICAgICAgICAgICRyZXR1cm5WYWx1ZVskclJlZl1bJGNSZWZdID0gJG51bGxWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuCiAgICAgICAgcmV0dXJuICRyZXR1cm5WYWx1ZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYXJyYXkgZnJvbSBhIHJhbmdlIG9mIGNlbGxzCiAgICAgKgogICAgICogQHBhcmFtICBzdHJpbmcgJHBOYW1lZFJhbmdlIE5hbWUgb2YgdGhlIE5hbWVkIFJhbmdlCiAgICAgKiBAcGFyYW0gIG1peGVkICAkbnVsbFZhbHVlIFZhbHVlIHJldHVybmVkIGluIHRoZSBhcnJheSBlbnRyeSBpZiBhIGNlbGwgZG9lc24ndCBleGlzdAogICAgICogQHBhcmFtICBib29sZWFuICRjYWxjdWxhdGVGb3JtdWxhcyAgU2hvdWxkIGZvcm11bGFzIGJlIGNhbGN1bGF0ZWQ\/CiAgICAgKiBAcGFyYW0gIGJvb2xlYW4gJGZvcm1hdERhdGEgIFNob3VsZCBmb3JtYXR0aW5nIGJlIGFwcGxpZWQgdG8gY2VsbCB2YWx1ZXM\/CiAgICAgKiBAcGFyYW0gIGJvb2xlYW4gJHJldHVybkNlbGxSZWYgRmFsc2UgLSBSZXR1cm4gYSBzaW1wbGUgYXJyYXkgb2Ygcm93cyBhbmQgY29sdW1ucyBpbmRleGVkIGJ5IG51bWJlciBjb3VudGluZyBmcm9tIHplcm8KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnVlIC0gUmV0dXJuIHJvd3MgYW5kIGNvbHVtbnMgaW5kZXhlZCBieSB0aGVpciBhY3R1YWwgcm93IGFuZCBjb2x1bW4gSURzCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKiBAdGhyb3dzIFBIUEV4Y2VsX0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gbmFtZWRSYW5nZVRvQXJyYXkoJHBOYW1lZFJhbmdlID0gJycsICRudWxsVmFsdWUgPSBudWxsLCAkY2FsY3VsYXRlRm9ybXVsYXMgPSB0cnVlLCAkZm9ybWF0RGF0YSA9IHRydWUsICRyZXR1cm5DZWxsUmVmID0gZmFsc2UpCiAgICB7CiAgICAgICAgJG5hbWVkUmFuZ2UgPSBQSFBFeGNlbF9OYW1lZFJhbmdlOjpyZXNvbHZlUmFuZ2UoJHBOYW1lZFJhbmdlLCAkdGhpcyk7CiAgICAgICAgaWYgKCRuYW1lZFJhbmdlICE9PSBudWxsKSB7CiAgICAgICAgICAgICRwV29ya1NoZWV0ID0gJG5hbWVkUmFuZ2UtPmdldFdvcmtzaGVldCgpOwogICAgICAgICAgICAkcENlbGxSYW5nZSA9ICRuYW1lZFJhbmdlLT5nZXRSYW5nZSgpOwoKICAgICAgICAgICAgcmV0dXJuICRwV29ya1NoZWV0LT5yYW5nZVRvQXJyYXkoJHBDZWxsUmFuZ2UsICRudWxsVmFsdWUsICRjYWxjdWxhdGVGb3JtdWxhcywgJGZvcm1hdERhdGEsICRyZXR1cm5DZWxsUmVmKTsKICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBQSFBFeGNlbF9FeGNlcHRpb24oJ05hbWVkIFJhbmdlICcuJHBOYW1lZFJhbmdlLicgZG9lcyBub3QgZXhpc3QuJyk7CiAgICB9CgoKICAgIC8qKgogICAgICogQ3JlYXRlIGFycmF5IGZyb20gd29ya3NoZWV0CiAgICAgKgogICAgICogQHBhcmFtIG1peGVkICRudWxsVmFsdWUgVmFsdWUgcmV0dXJuZWQgaW4gdGhlIGFycmF5IGVudHJ5IGlmIGEgY2VsbCBkb2Vzbid0IGV4aXN0CiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkY2FsY3VsYXRlRm9ybXVsYXMgU2hvdWxkIGZvcm11bGFzIGJlIGNhbGN1bGF0ZWQ\/CiAgICAgKiBAcGFyYW0gYm9vbGVhbiAkZm9ybWF0RGF0YSAgU2hvdWxkIGZvcm1hdHRpbmcgYmUgYXBwbGllZCB0byBjZWxsIHZhbHVlcz8KICAgICAqIEBwYXJhbSBib29sZWFuICRyZXR1cm5DZWxsUmVmIEZhbHNlIC0gUmV0dXJuIGEgc2ltcGxlIGFycmF5IG9mIHJvd3MgYW5kIGNvbHVtbnMgaW5kZXhlZCBieSBudW1iZXIgY291bnRpbmcgZnJvbSB6ZXJvCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcnVlIC0gUmV0dXJuIHJvd3MgYW5kIGNvbHVtbnMgaW5kZXhlZCBieSB0aGVpciBhY3R1YWwgcm93IGFuZCBjb2x1bW4gSURzCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB0b0FycmF5KCRudWxsVmFsdWUgPSBudWxsLCAkY2FsY3VsYXRlRm9ybXVsYXMgPSB0cnVlLCAkZm9ybWF0RGF0YSA9IHRydWUsICRyZXR1cm5DZWxsUmVmID0gZmFsc2UpCiAgICB7CiAgICAgICAgLy8gR2FyYmFnZSBjb2xsZWN0Li4uCiAgICAgICAgJHRoaXMtPmdhcmJhZ2VDb2xsZWN0KCk7CgogICAgICAgIC8vICAgIElkZW50aWZ5IHRoZSByYW5nZSB0aGF0IHdlIG5lZWQgdG8gZXh0cmFjdCBmcm9tIHRoZSB3b3Jrc2hlZXQKICAgICAgICAkbWF4Q29sID0gJHRoaXMtPmdldEhpZ2hlc3RDb2x1bW4oKTsKICAgICAgICAkbWF4Um93ID0gJHRoaXMtPmdldEhpZ2hlc3RSb3coKTsKICAgICAgICAvLyBSZXR1cm4KICAgICAgICByZXR1cm4gJHRoaXMtPnJhbmdlVG9BcnJheSgnQTE6Jy4kbWF4Q29sLiRtYXhSb3csICRudWxsVmFsdWUsICRjYWxjdWxhdGVGb3JtdWxhcywgJGZvcm1hdERhdGEsICRyZXR1cm5DZWxsUmVmKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCByb3cgaXRlcmF0b3IKICAgICAqCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgJHN0YXJ0Um93ICAgVGhlIHJvdyBudW1iZXIgYXQgd2hpY2ggdG8gc3RhcnQgaXRlcmF0aW5nCiAgICAgKiBAcGFyYW0gICBpbnRlZ2VyICAgJGVuZFJvdyAgICAgVGhlIHJvdyBudW1iZXIgYXQgd2hpY2ggdG8gc3RvcCBpdGVyYXRpbmcKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldF9Sb3dJdGVyYXRvcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Um93SXRlcmF0b3IoJHN0YXJ0Um93ID0gMSwgJGVuZFJvdyA9IG51bGwpCiAgICB7CiAgICAgICAgcmV0dXJuIG5ldyBQSFBFeGNlbF9Xb3Jrc2hlZXRfUm93SXRlcmF0b3IoJHRoaXMsICRzdGFydFJvdywgJGVuZFJvdyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29sdW1uIGl0ZXJhdG9yCiAgICAgKgogICAgICogQHBhcmFtICAgc3RyaW5nICAgJHN0YXJ0Q29sdW1uIFRoZSBjb2x1bW4gYWRkcmVzcyBhdCB3aGljaCB0byBzdGFydCBpdGVyYXRpbmcKICAgICAqIEBwYXJhbSAgIHN0cmluZyAgICRlbmRDb2x1bW4gICBUaGUgY29sdW1uIGFkZHJlc3MgYXQgd2hpY2ggdG8gc3RvcCBpdGVyYXRpbmcKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldF9Db2x1bW5JdGVyYXRvcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q29sdW1uSXRlcmF0b3IoJHN0YXJ0Q29sdW1uID0gJ0EnLCAkZW5kQ29sdW1uID0gbnVsbCkKICAgIHsKICAgICAgICByZXR1cm4gbmV3IFBIUEV4Y2VsX1dvcmtzaGVldF9Db2x1bW5JdGVyYXRvcigkdGhpcywgJHN0YXJ0Q29sdW1uLCAkZW5kQ29sdW1uKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJ1biBQSFBFeGNlbCBnYXJhYmFnZSBjb2xsZWN0b3IuCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9Xb3Jrc2hlZXQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdhcmJhZ2VDb2xsZWN0KCkKICAgIHsKICAgICAgICAvLyBGbHVzaCBjYWNoZQogICAgICAgICR0aGlzLT5jZWxsQ29sbGVjdGlvbi0+Z2V0Q2FjaGVEYXRhKCdBMScpOwogICAgICAgIC8vIEJ1aWxkIGEgcmVmZXJlbmNlIHRhYmxlIGZyb20gaW1hZ2VzCi8vICAgICAgICAkaW1hZ2VDb29yZGluYXRlcyA9IGFycmF5KCk7Ci8vICAgICAgICAkaXRlcmF0b3IgPSAkdGhpcy0+Z2V0RHJhd2luZ0NvbGxlY3Rpb24oKS0+Z2V0SXRlcmF0b3IoKTsKLy8gICAgICAgIHdoaWxlICgkaXRlcmF0b3ItPnZhbGlkKCkpIHsKLy8gICAgICAgICAgICAkaW1hZ2VDb29yZGluYXRlc1skaXRlcmF0b3ItPmN1cnJlbnQoKS0+Z2V0Q29vcmRpbmF0ZXMoKV0gPSB0cnVlOwovLwovLyAgICAgICAgICAgICRpdGVyYXRvci0+bmV4dCgpOwovLyAgICAgICAgfQovLwogICAgICAgIC8vIExvb2t1cCBoaWdoZXN0IGNvbHVtbiBhbmQgaGlnaGVzdCByb3cgaWYgY2VsbHMgYXJlIGNsZWFuZWQKICAgICAgICAkY29sUm93ID0gJHRoaXMtPmNlbGxDb2xsZWN0aW9uLT5nZXRIaWdoZXN0Um93QW5kQ29sdW1uKCk7CiAgICAgICAgJGhpZ2hlc3RSb3cgPSAkY29sUm93Wydyb3cnXTsKICAgICAgICAkaGlnaGVzdENvbHVtbiA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkY29sUm93Wydjb2x1bW4nXSk7CgogICAgICAgIC8vIExvb3AgdGhyb3VnaCBjb2x1bW4gZGltZW5zaW9ucwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5jb2x1bW5EaW1lbnNpb25zIGFzICRkaW1lbnNpb24pIHsKICAgICAgICAgICAgJGhpZ2hlc3RDb2x1bW4gPSBtYXgoJGhpZ2hlc3RDb2x1bW4sIFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkZGltZW5zaW9uLT5nZXRDb2x1bW5JbmRleCgpKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBMb29wIHRocm91Z2ggcm93IGRpbWVuc2lvbnMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+cm93RGltZW5zaW9ucyBhcyAkZGltZW5zaW9uKSB7CiAgICAgICAgICAgICRoaWdoZXN0Um93ID0gbWF4KCRoaWdoZXN0Um93LCAkZGltZW5zaW9uLT5nZXRSb3dJbmRleCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIENhY2hlIHZhbHVlcwogICAgICAgIGlmICgkaGlnaGVzdENvbHVtbiA8IDApIHsKICAgICAgICAgICAgJHRoaXMtPmNhY2hlZEhpZ2hlc3RDb2x1bW4gPSAnQSc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmNhY2hlZEhpZ2hlc3RDb2x1bW4gPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoLS0kaGlnaGVzdENvbHVtbik7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5jYWNoZWRIaWdoZXN0Um93ID0gJGhpZ2hlc3RSb3c7CgogICAgICAgIC8vIFJldHVybgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBoYXNoIGNvZGUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyAgICBIYXNoIGNvZGUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEhhc2hDb2RlKCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPmRpcnR5KSB7CiAgICAgICAgICAgICR0aGlzLT5oYXNoID0gbWQ1KCR0aGlzLT50aXRsZSAuICR0aGlzLT5hdXRvRmlsdGVyIC4gKCR0aGlzLT5wcm90ZWN0aW9uLT5pc1Byb3RlY3Rpb25FbmFibGVkKCkgPyAndCcgOiAnZicpIC4gX19DTEFTU19fKTsKICAgICAgICAgICAgJHRoaXMtPmRpcnR5ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+aGFzaDsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3Qgd29ya3NoZWV0IHRpdGxlIGZyb20gcmFuZ2UuCiAgICAgKgogICAgICogRXhhbXBsZTogZXh0cmFjdFNoZWV0VGl0bGUoInRlc3RTaGVldCFBMSIpID09PiAnQTEnCiAgICAgKiBFeGFtcGxlOiBleHRyYWN0U2hlZXRUaXRsZSgiJ3Rlc3RTaGVldCAxJyFBMSIsIHRydWUpID09PiBhcnJheSgndGVzdFNoZWV0IDEnLCAnQTEnKTsKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwUmFuZ2UgICAgUmFuZ2UgdG8gZXh0cmFjdCB0aXRsZSBmcm9tCiAgICAgKiBAcGFyYW0gYm9vbCAkcmV0dXJuUmFuZ2UgICAgUmV0dXJuIHJhbmdlPyAoc2VlIGV4YW1wbGUpCiAgICAgKiBAcmV0dXJuIG1peGVkCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZXh0cmFjdFNoZWV0VGl0bGUoJHBSYW5nZSwgJHJldHVyblJhbmdlID0gZmFsc2UpCiAgICB7CiAgICAgICAgLy8gU2hlZXQgdGl0bGUgaW5jbHVkZWQ\/CiAgICAgICAgaWYgKCgkc2VwID0gc3RycG9zKCRwUmFuZ2UsICchJykpID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHJldHVyblJhbmdlKSB7CiAgICAgICAgICAgIHJldHVybiBhcnJheSh0cmltKHN1YnN0cigkcFJhbmdlLCAwLCAkc2VwKSwgIiciKSwgc3Vic3RyKCRwUmFuZ2UsICRzZXAgKyAxKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3Vic3RyKCRwUmFuZ2UsICRzZXAgKyAxKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBoeXBlcmxpbmsKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ2VsbENvb3JkaW5hdGUgICAgQ2VsbCBjb29yZGluYXRlIHRvIGdldCBoeXBlcmxpbmsgZm9yCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRIeXBlcmxpbmsoJHBDZWxsQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAgLy8gcmV0dXJuIGh5cGVybGluayBpZiB3ZSBhbHJlYWR5IGhhdmUgb25lCiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5oeXBlcmxpbmtDb2xsZWN0aW9uWyRwQ2VsbENvb3JkaW5hdGVdKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmh5cGVybGlua0NvbGxlY3Rpb25bJHBDZWxsQ29vcmRpbmF0ZV07CiAgICAgICAgfQoKICAgICAgICAvLyBlbHNlIGNyZWF0ZSBoeXBlcmxpbmsKICAgICAgICAkdGhpcy0+aHlwZXJsaW5rQ29sbGVjdGlvblskcENlbGxDb29yZGluYXRlXSA9IG5ldyBQSFBFeGNlbF9DZWxsX0h5cGVybGluaygpOwogICAgICAgIHJldHVybiAkdGhpcy0+aHlwZXJsaW5rQ29sbGVjdGlvblskcENlbGxDb29yZGluYXRlXTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBoeXBlcmxuawogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDZWxsQ29vcmRpbmF0ZSAgICBDZWxsIGNvb3JkaW5hdGUgdG8gaW5zZXJ0IGh5cGVybGluawogICAgICogQHBhcmFtICAgIFBIUEV4Y2VsX0NlbGxfSHlwZXJsaW5rICAgICRwSHlwZXJsaW5rCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0SHlwZXJsaW5rKCRwQ2VsbENvb3JkaW5hdGUgPSAnQTEnLCBQSFBFeGNlbF9DZWxsX0h5cGVybGluayAkcEh5cGVybGluayA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCRwSHlwZXJsaW5rID09PSBudWxsKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5oeXBlcmxpbmtDb2xsZWN0aW9uWyRwQ2VsbENvb3JkaW5hdGVdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+aHlwZXJsaW5rQ29sbGVjdGlvblskcENlbGxDb29yZGluYXRlXSA9ICRwSHlwZXJsaW5rOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBIeXBlcmxpbmsgYXQgYSBzcGVjaWZpYyBjb29yZGluYXRlIGV4aXN0cz8KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwQ29vcmRpbmF0ZQogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoeXBlcmxpbmtFeGlzdHMoJHBDb29yZGluYXRlID0gJ0ExJykKICAgIHsKICAgICAgICByZXR1cm4gaXNzZXQoJHRoaXMtPmh5cGVybGlua0NvbGxlY3Rpb25bJHBDb29yZGluYXRlXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29sbGVjdGlvbiBvZiBoeXBlcmxpbmtzCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9DZWxsX0h5cGVybGlua1tdCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRIeXBlcmxpbmtDb2xsZWN0aW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmh5cGVybGlua0NvbGxlY3Rpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgZGF0YSB2YWxpZGF0aW9uCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcENlbGxDb29yZGluYXRlIENlbGwgY29vcmRpbmF0ZSB0byBnZXQgZGF0YSB2YWxpZGF0aW9uIGZvcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGF0YVZhbGlkYXRpb24oJHBDZWxsQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAgLy8gcmV0dXJuIGRhdGEgdmFsaWRhdGlvbiBpZiB3ZSBhbHJlYWR5IGhhdmUgb25lCiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5kYXRhVmFsaWRhdGlvbkNvbGxlY3Rpb25bJHBDZWxsQ29vcmRpbmF0ZV0pKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZGF0YVZhbGlkYXRpb25Db2xsZWN0aW9uWyRwQ2VsbENvb3JkaW5hdGVdOwogICAgICAgIH0KCiAgICAgICAgLy8gZWxzZSBjcmVhdGUgZGF0YSB2YWxpZGF0aW9uCiAgICAgICAgJHRoaXMtPmRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvblskcENlbGxDb29yZGluYXRlXSA9IG5ldyBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uKCk7CiAgICAgICAgcmV0dXJuICR0aGlzLT5kYXRhVmFsaWRhdGlvbkNvbGxlY3Rpb25bJHBDZWxsQ29vcmRpbmF0ZV07CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZGF0YSB2YWxpZGF0aW9uCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcENlbGxDb29yZGluYXRlICAgIENlbGwgY29vcmRpbmF0ZSB0byBpbnNlcnQgZGF0YSB2YWxpZGF0aW9uCiAgICAgKiBAcGFyYW0gICAgUEhQRXhjZWxfQ2VsbF9EYXRhVmFsaWRhdGlvbiAgICAkcERhdGFWYWxpZGF0aW9uCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1dvcmtzaGVldAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0RGF0YVZhbGlkYXRpb24oJHBDZWxsQ29vcmRpbmF0ZSA9ICdBMScsIFBIUEV4Y2VsX0NlbGxfRGF0YVZhbGlkYXRpb24gJHBEYXRhVmFsaWRhdGlvbiA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKCRwRGF0YVZhbGlkYXRpb24gPT09IG51bGwpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvblskcENlbGxDb29yZGluYXRlXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmRhdGFWYWxpZGF0aW9uQ29sbGVjdGlvblskcENlbGxDb29yZGluYXRlXSA9ICRwRGF0YVZhbGlkYXRpb247CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIERhdGEgdmFsaWRhdGlvbiBhdCBhIHNwZWNpZmljIGNvb3JkaW5hdGUgZXhpc3RzPwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBDb29yZGluYXRlCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGRhdGFWYWxpZGF0aW9uRXhpc3RzKCRwQ29vcmRpbmF0ZSA9ICdBMScpCiAgICB7CiAgICAgICAgcmV0dXJuIGlzc2V0KCR0aGlzLT5kYXRhVmFsaWRhdGlvbkNvbGxlY3Rpb25bJHBDb29yZGluYXRlXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29sbGVjdGlvbiBvZiBkYXRhIHZhbGlkYXRpb25zCiAgICAgKgogICAgICogQHJldHVybiBQSFBFeGNlbF9DZWxsX0RhdGFWYWxpZGF0aW9uW10KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldERhdGFWYWxpZGF0aW9uQ29sbGVjdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5kYXRhVmFsaWRhdGlvbkNvbGxlY3Rpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBBY2NlcHRzIGEgcmFuZ2UsIHJldHVybmluZyBpdCBhcyBhIHJhbmdlIHRoYXQgZmFsbHMgd2l0aGluIHRoZSBjdXJyZW50IGhpZ2hlc3Qgcm93IGFuZCBjb2x1bW4gb2YgdGhlIHdvcmtzaGVldAogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHJhbmdlCiAgICAgKiBAcmV0dXJuIHN0cmluZyBBZGp1c3RlZCByYW5nZSB2YWx1ZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hyaW5rUmFuZ2VUb0ZpdCgkcmFuZ2UpCiAgICB7CiAgICAgICAgJG1heENvbCA9ICR0aGlzLT5nZXRIaWdoZXN0Q29sdW1uKCk7CiAgICAgICAgJG1heFJvdyA9ICR0aGlzLT5nZXRIaWdoZXN0Um93KCk7CiAgICAgICAgJG1heENvbCA9IFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkbWF4Q29sKTsKCiAgICAgICAgJHJhbmdlQmxvY2tzID0gZXhwbG9kZSgnICcsICRyYW5nZSk7CiAgICAgICAgZm9yZWFjaCAoJHJhbmdlQmxvY2tzIGFzICYkcmFuZ2VTZXQpIHsKICAgICAgICAgICAgJHJhbmdlQm91bmRhcmllcyA9IFBIUEV4Y2VsX0NlbGw6OmdldFJhbmdlQm91bmRhcmllcygkcmFuZ2VTZXQpOwoKICAgICAgICAgICAgaWYgKFBIUEV4Y2VsX0NlbGw6OmNvbHVtbkluZGV4RnJvbVN0cmluZygkcmFuZ2VCb3VuZGFyaWVzWzBdWzBdKSA+ICRtYXhDb2wpIHsKICAgICAgICAgICAgICAgICRyYW5nZUJvdW5kYXJpZXNbMF1bMF0gPSBQSFBFeGNlbF9DZWxsOjpzdHJpbmdGcm9tQ29sdW1uSW5kZXgoJG1heENvbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRyYW5nZUJvdW5kYXJpZXNbMF1bMV0gPiAkbWF4Um93KSB7CiAgICAgICAgICAgICAgICAkcmFuZ2VCb3VuZGFyaWVzWzBdWzFdID0gJG1heFJvdzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoUEhQRXhjZWxfQ2VsbDo6Y29sdW1uSW5kZXhGcm9tU3RyaW5nKCRyYW5nZUJvdW5kYXJpZXNbMV1bMF0pID4gJG1heENvbCkgewogICAgICAgICAgICAgICAgJHJhbmdlQm91bmRhcmllc1sxXVswXSA9IFBIUEV4Y2VsX0NlbGw6OnN0cmluZ0Zyb21Db2x1bW5JbmRleCgkbWF4Q29sKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHJhbmdlQm91bmRhcmllc1sxXVsxXSA+ICRtYXhSb3cpIHsKICAgICAgICAgICAgICAgICRyYW5nZUJvdW5kYXJpZXNbMV1bMV0gPSAkbWF4Um93OwogICAgICAgICAgICB9CiAgICAgICAgICAgICRyYW5nZVNldCA9ICRyYW5nZUJvdW5kYXJpZXNbMF1bMF0uJHJhbmdlQm91bmRhcmllc1swXVsxXS4nOicuJHJhbmdlQm91bmRhcmllc1sxXVswXS4kcmFuZ2VCb3VuZGFyaWVzWzFdWzFdOwogICAgICAgIH0KICAgICAgICB1bnNldCgkcmFuZ2VTZXQpOwogICAgICAgICRzdFJhbmdlID0gaW1wbG9kZSgnICcsICRyYW5nZUJsb2Nrcyk7CgogICAgICAgIHJldHVybiAkc3RSYW5nZTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0YWIgY29sb3IKICAgICAqCiAgICAgKiBAcmV0dXJuIFBIUEV4Y2VsX1N0eWxlX0NvbG9yCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRUYWJDb2xvcigpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT50YWJDb2xvciA9PT0gbnVsbCkgewogICAgICAgICAgICAkdGhpcy0+dGFiQ29sb3IgPSBuZXcgUEhQRXhjZWxfU3R5bGVfQ29sb3IoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT50YWJDb2xvcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJlc2V0IHRhYiBjb2xvcgogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZXNldFRhYkNvbG9yKCkKICAgIHsKICAgICAgICAkdGhpcy0+dGFiQ29sb3IgPSBudWxsOwogICAgICAgIHVuc2V0KCR0aGlzLT50YWJDb2xvcik7CgogICAgICAgIHJldHVybiAkdGhpczsKICAgIH0KCiAgICAvKioKICAgICAqIFRhYiBjb2xvciBzZXQ\/CiAgICAgKgogICAgICogQHJldHVybiBib29sZWFuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1RhYkNvbG9yU2V0KCkKICAgIHsKICAgICAgICByZXR1cm4gKCR0aGlzLT50YWJDb2xvciAhPT0gbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb3B5IHdvcmtzaGVldCAoIT0gY2xvbmUhKQogICAgICoKICAgICAqIEByZXR1cm4gUEhQRXhjZWxfV29ya3NoZWV0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjb3B5KCkKICAgIHsKICAgICAgICAkY29waWVkID0gY2xvbmUgJHRoaXM7CgogICAgICAgIHJldHVybiAkY29waWVkOwogICAgfQoKICAgIC8qKgogICAgICogSW1wbGVtZW50IFBIUCBfX2Nsb25lIHRvIGNyZWF0ZSBhIGRlZXAgY2xvbmUsIG5vdCBqdXN0IGEgc2hhbGxvdyBjb3B5LgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jbG9uZSgpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMgYXMgJGtleSA9PiAkdmFsKSB7CiAgICAgICAgICAgIGlmICgka2V5ID09ICdwYXJlbnQnKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzX29iamVjdCgkdmFsKSB8fCAoaXNfYXJyYXkoJHZhbCkpKSB7CiAgICAgICAgICAgICAgICBpZiAoJGtleSA9PSAnY2VsbENvbGxlY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgJG5ld0NvbGxlY3Rpb24gPSBjbG9uZSAkdGhpcy0+Y2VsbENvbGxlY3Rpb247CiAgICAgICAgICAgICAgICAgICAgJG5ld0NvbGxlY3Rpb24tPmNvcHlDZWxsQ29sbGVjdGlvbigkdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNlbGxDb2xsZWN0aW9uID0gJG5ld0NvbGxlY3Rpb247CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGtleSA9PSAnZHJhd2luZ0NvbGxlY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgJG5ld0NvbGxlY3Rpb24gPSBjbG9uZSAkdGhpcy0+ZHJhd2luZ0NvbGxlY3Rpb247CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmRyYXdpbmdDb2xsZWN0aW9uID0gJG5ld0NvbGxlY3Rpb247CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoKCRrZXkgPT0gJ2F1dG9GaWx0ZXInKSAmJiAoJHRoaXMtPmF1dG9GaWx0ZXIgaW5zdGFuY2VvZiBQSFBFeGNlbF9Xb3Jrc2hlZXRfQXV0b0ZpbHRlcikpIHsKICAgICAgICAgICAgICAgICAgICAkbmV3QXV0b0ZpbHRlciA9IGNsb25lICR0aGlzLT5hdXRvRmlsdGVyOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5hdXRvRmlsdGVyID0gJG5ld0F1dG9GaWx0ZXI7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmF1dG9GaWx0ZXItPnNldFBhcmVudCgkdGhpcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT57JGtleX0gPSB1bnNlcmlhbGl6ZShzZXJpYWxpemUoJHZhbCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQovKioKICAgICAqIERlZmluZSB0aGUgY29kZSBuYW1lIG9mIHRoZSBzaGVldAogICAgICoKICAgICAqIEBwYXJhbSBudWxsfHN0cmluZyBTYW1lIHJ1bGUgYXMgVGl0bGUgbWludXMgc3BhY2Ugbm90IGFsbG93ZWQgKGJ1dCwgbGlrZSBFeGNlbCwgY2hhbmdlIHNpbGVudGx5IHNwYWNlIHRvIHVuZGVyc2NvcmUpCiAgICAgKiBAcmV0dXJuIG9ialdvcmtzaGVldAogICAgICogQHRocm93cyBQSFBFeGNlbF9FeGNlcHRpb24KICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0Q29kZU5hbWUoJHBWYWx1ZSA9IG51bGwpCiAgICB7CiAgICAgICAgLy8gSXMgdGhpcyBhICdyZW5hbWUnIG9yIG5vdD8KICAgICAgICBpZiAoJHRoaXMtPmdldENvZGVOYW1lKCkgPT0gJHBWYWx1ZSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXM7CiAgICAgICAgfQogICAgICAgICRwVmFsdWUgPSBzdHJfcmVwbGFjZSgnICcsICdfJywgJHBWYWx1ZSk7Ly9FeGNlbCBkb2VzIHRoaXMgYXV0b21hdGljYWxseSB3aXRob3V0IGZsaW5jaGluZywgd2UgYXJlIGRvaW5nIHRoZSBzYW1lCiAgICAgICAgLy8gU3ludGF4IGNoZWNrCiAgICAgICAgLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIG5vdCB2YWxpZAogICAgICAgIHNlbGY6OmNoZWNrU2hlZXRDb2RlTmFtZSgkcFZhbHVlKTsKCiAgICAgICAgLy8gV2UgdXNlIHRoZSBzYW1lIGNvZGUgdGhhdCBzZXRUaXRsZSB0byBmaW5kIGEgdmFsaWQgY29kZU5hbWUgZWxzZSBub3QgdXNpbmcgYSBzcGFjZSAoRXhjZWwgZG9uJ3QgbGlrZSkgYnV0IGEgJ18nCgogICAgICAgIGlmICgkdGhpcy0+Z2V0UGFyZW50KCkpIHsKICAgICAgICAgICAgLy8gSXMgdGhlcmUgYWxyZWFkeSBzdWNoIHNoZWV0IG5hbWU\/CiAgICAgICAgICAgIGlmICgkdGhpcy0+Z2V0UGFyZW50KCktPnNoZWV0Q29kZU5hbWVFeGlzdHMoJHBWYWx1ZSkpIHsKICAgICAgICAgICAgICAgIC8vIFVzZSBuYW1lLCBidXQgYXBwZW5kIHdpdGggbG93ZXN0IHBvc3NpYmxlIGludGVnZXIKCiAgICAgICAgICAgICAgICBpZiAoUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6Q291bnRDaGFyYWN0ZXJzKCRwVmFsdWUpID4gMjkpIHsKICAgICAgICAgICAgICAgICAgICAkcFZhbHVlID0gUEhQRXhjZWxfU2hhcmVkX1N0cmluZzo6U3Vic3RyaW5nKCRwVmFsdWUsIDAsIDI5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRpID0gMTsKICAgICAgICAgICAgICAgIHdoaWxlICgkdGhpcy0+Z2V0UGFyZW50KCktPnNoZWV0Q29kZU5hbWVFeGlzdHMoJHBWYWx1ZSAuICdfJyAuICRpKSkgewogICAgICAgICAgICAgICAgICAgICsrJGk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRpID09IDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb3VudENoYXJhY3RlcnMoJHBWYWx1ZSkgPiAyOCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBWYWx1ZSA9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OlN1YnN0cmluZygkcFZhbHVlLCAwLCAyOCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJGkgPT0gMTAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChQSFBFeGNlbF9TaGFyZWRfU3RyaW5nOjpDb3VudENoYXJhY3RlcnMoJHBWYWx1ZSkgPiAyNykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBWYWx1ZSA9IFBIUEV4Y2VsX1NoYXJlZF9TdHJpbmc6OlN1YnN0cmluZygkcFZhbHVlLCAwLCAyNyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHBWYWx1ZSA9ICRwVmFsdWUgLiAnXycgLiAkaTsvLyBvaywgd2UgaGF2ZSBhIHZhbGlkIG5hbWUKICAgICAgICAgICAgICAgIC8vY29kZU5hbWUgaXMnbnQgdXNlZCBpbiBmb3JtdWxhIDogbm8gbmVlZCB0byBjYWxsIGZvciBhbiB1cGRhdGUKICAgICAgICAgICAgICAgIC8vcmV0dXJuICR0aGlzLT5zZXRUaXRsZSgkYWx0VGl0bGUsICR1cGRhdGVGb3JtdWxhQ2VsbFJlZmVyZW5jZXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+Y29kZU5hbWU9JHBWYWx1ZTsKICAgICAgICByZXR1cm4gJHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29kZSBuYW1lIG9mIHRoZSBzaGVldAogICAgICoKICAgICAqIEByZXR1cm4gbnVsbHxzdHJpbmcKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q29kZU5hbWUoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y29kZU5hbWU7CiAgICB9CiAgICAvKioKICAgICAqIFNoZWV0IGhhcyBhIGNvZGUgbmFtZSA\/CiAgICAgKiBAcmV0dXJuIGJvb2xlYW4KICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFzQ29kZU5hbWUoKQogICAgewogICAgICAgIHJldHVybiAhKGlzX251bGwoJHRoaXMtPmNvZGVOYW1lKSk7CiAgICB9Cn0K",
    "size": "94317"
}